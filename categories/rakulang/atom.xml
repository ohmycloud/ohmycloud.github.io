<?xml version="1.0" encoding="utf-8"?> 
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-us">
    <generator uri="https://gohugo.io/" version="0.85.0">Hugo</generator><title type="html"><![CDATA[rakulang on ç„‰çŸ¥éé±¼]]></title>
    
        <subtitle type="html"><![CDATA[rakulang, dartlang, nimlang, golang, rustlang, lang lang no see]]></subtitle>
    
    
    
            <link href="https://ohmyweekly.github.io/categories/rakulang/" rel="alternate" type="text/html" title="HTML" />
            <link href="https://ohmyweekly.github.io/categories/rakulang/index.xml" rel="alternate" type="application/rss+xml" title="RSS" />
            <link href="https://ohmyweekly.github.io/categories/rakulang/atom.xml" rel="self" type="application/atom+xml" title="Atom" />
            <link href="https://ohmyweekly.github.io/categories/rakulang/jf2feed.json" rel="alternate" type="application/jf2feed+json" title="jf2feed" />
    <updated>2021-07-15T22:25:28+08:00</updated>
    
    
    
    
        <id>https://ohmyweekly.github.io/categories/rakulang/</id>
    
        
        <entry>
            <title type="html"><![CDATA[Raku Types]]></title>
            <link href="https://ohmyweekly.github.io/notes/2016-08-02-raku-types/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2015-03-19-subset/?utm_source=atom_feed" rel="related" type="text/html" title="Subset" />
            
                <id>https://ohmyweekly.github.io/notes/2016-08-02-raku-types/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-15T00:00:00+08:00</published>
            <updated>2021-07-15T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Raku Types</blockquote><h1 id="raku-types-æˆäººä¹‹ç¾">Raku Types: æˆäººä¹‹ç¾</h1>
<p>åœ¨æˆ‘çš„ç¬¬ä¸€æ¬¡å¤§å­¦ç¼–ç¨‹è¯­è¨€è¯¾ä¸­, æˆ‘è¢«å‘ŠçŸ¥ Pascal è¯­è¨€åœ¨å…¶å®ƒç±»å‹ä¹‹å¤–è¿˜æ‹¥æœ‰ <strong>Integer</strong>ã€<strong>Boolen</strong> å’Œ <strong>Stirng</strong> ç±»å‹ã€‚æˆ‘çŸ¥é“äº†ç±»å‹æœ¬æ¥å°±è¯¥å­˜åœ¨å› ä¸ºè®¡ç®—æœºå¾ˆç¬¨ã€‚å½“æˆ‘åœ¨ C è¯­è¨€ä¸­æ¶‰çŒçš„æ—¶å€™, æˆ‘å­¦åˆ°äº†æ›´å¤šæœ‰å…³ <em>int</em>ã€ <em>char</em> å’Œå…¶å®ƒåƒåœ¨æš–å’Œçš„åœ°æ–¹é‡Œåœ°å¯„ç”Ÿè™«, è¿˜æœ‰æˆ‘è¯¾æ¡Œåº•ä¸‹å—¡å—¡çš„é‡‘å±ç›’çš„å£°éŸ³ã€‚</p>
<p>Perl 5 æ²¡æœ‰ç±»å‹, å®ƒç»™æˆ‘çš„æ„Ÿè§‰å°±åƒéª‘ç€è‡ªè¡Œè½¦æ— æ‹˜æ— æŸçš„è¿½é£å°‘å¹´, æ²¿ç€æ–œå¡è€Œä¸‹ã€‚ä¸ä¹…ä¹‹åæˆ‘ä¸€é—¨å¿ƒæ€é’»åˆ°è®¡ç®—æœºç¡¬ä»¶çš„ç¼éš™ä¸­ã€‚æˆ‘æ‹¥æœ‰æ•°æ®å¹¶ä¸”æˆ‘èƒ½ç”¨å®ƒåšä»»ä½•æˆ‘æƒ³åšçš„äº‹, åªè¦æˆ‘å¾—åˆ°çš„ä¸æ˜¯é”™è¯¯çš„æ•°æ®ã€‚å½“æˆ‘æå®šçš„æ—¶å€™, æˆ‘ä»è‡ªè¡Œè½¦ä¸Šæ‰äº†ä¸‹æ¥å¹¶åˆ®ç ´äº†æˆ‘çš„è†ç›–ã€‚</p>
<p>æœ‰äº† Raku, é±¼å’Œç†ŠæŒå¯ä»¥å…¼å¾—ã€‚ä½ å¯ä»¥ä½¿ç”¨ç±»å‹æ¥é¿å…å®ƒä»¬ã€‚ä½ å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªå¹¿åŸŸçš„ç±»å‹æ¥æ¥æ”¶å¾ˆå¤šç§ç±»çš„å€¼æˆ–çª„ç±»å‹ã€‚å¹¶ä¸”ä½ å¯ä»¥äº«å—ä»£è¡¨æœºå™¨æ™ºåŠ›çš„ç±»å‹çš„é€Ÿåº¦, æˆ–è€…ä½ å¯ä»¥äº«å—ä½ è‡ªå®šä¹‰çš„ä»£è¡¨ä½ è‡ªå·±æ„å¿—çš„ç±»å‹çš„ç²¾åº¦, ç±»å‹ä¸ºäººç±»è€Œç”Ÿã€‚</p>
<h2 id="æ¸è¿›ç±»å‹">æ¸è¿›ç±»å‹</h2>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span>       <span class="nv">$a</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">whatever</span><span class="p">&#34;;</span>
<span class="k">my</span> <span class="nb">Str</span>   <span class="nv">$b</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">strings only</span><span class="p">&#34;;</span>
<span class="k">my</span> <span class="nb">Str:D</span> <span class="nv">$c</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">defined strings only</span><span class="p">&#34;;</span>
<span class="k">my</span> <span class="nb">int</span>   <span class="nv">$d</span> <span class="o">=</span> <span class="mi">14</span><span class="p">;</span> <span class="c1"># native int</span>

<span class="k">sub</span> <span class="nf">foo</span> <span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$x</span> <span class="o">+</span> <span class="mi">2</span> <span class="p">}</span>
<span class="k">sub</span> <span class="nf">bar</span> <span class="p">(</span><span class="nb">Int:D</span> <span class="nv">$x</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Int</span> <span class="p">{</span> <span class="nv">$x</span> <span class="o">+</span> <span class="mi">2</span> <span class="p">}</span>
</code></pre></div><p>Raku æ‹¥æœ‰æ¸è¿›ç±»å‹, è¿™æ„å‘³ç€ä½ è¦ä¹ˆå¯ä»¥ä½¿ç”¨å®ƒä»¬, è¦ä¹ˆé¿å…ä½¿ç”¨å®ƒä»¬ã€‚æ‰€ä»¥ç©¶ç«Ÿä¸ºä»€ä¹ˆè¦æ‰“æ‰°å®ƒä»¬å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆ, ç±»å‹çº¦æŸäº†ä½ çš„å˜é‡ä¸­èƒ½åŒ…å«çš„, ä½ çš„æ–¹æ³•æˆ–å­ä¾‹ç¨‹æ¥å—çš„æˆ–è¿”å›çš„å€¼çš„èŒƒå›´ã€‚è¿™ä¸ªå‡½æ•°å³ä½œä¸ºæ•°æ®æ ¡éªŒåˆä½œä¸ºå®‰å…¨ç½‘ä»¥è¿‡æ»¤æ‰ä¸æ­£ç¡®ä»£ç æ‰€ç”Ÿæˆçš„åƒåœ¾æ•°æ®ã€‚</p>
<p>è¿˜æœ‰, å½“ä½¿ç”¨åŸç”Ÿçš„, æœºå™¨æ„å¿—çš„ç±»å‹çš„æ—¶å€™, ä½ å¯ä»¥è·å¾—æ›´å¥½åœ°æ€§èƒ½å¹¶å‡å°‘å†…å­˜ä½¿ç”¨, å‡å¦‚å®ƒä»¬å¯¹äºä½ å¾—æ•°æ®æ¥è¯´æ˜¯åˆé€‚çš„å·¥å…·çš„è¯ã€‚</p>
<h2 id="å†…ç½®ç±»å‹">å†…ç½®ç±»å‹</h2>
<p>æœ‰ä¸€ä¸ªåå‰¯å…¶å®çš„è‡ªåŠ©å¼çš„ <a href="http://docs.raku.org/type.html">Raku ä¸­å¾—å†…ç½®ç±»å‹</a>ã€‚å¦‚æœä½ çš„å­ä¾‹ç¨‹åªå¯¹æ•´æ•°æœ‰æ„ä¹‰, é‚£ä¹ˆä¸ºä½ çš„å‚æ•°ä½¿ç”¨ <strong>Int</strong> ç±»å‹ã€‚å¦‚æœè´Ÿæ•°æ²¡æœ‰æ„ä¹‰, é‚£ä¹ˆä½¿ç”¨ <strong>UInt</strong> - ä¸€ä¸ªæ— ç¬¦å·çš„ <strong>Int</strong> æ¥è¿›ä¸€æ­¥é™åˆ¶å€¼çš„èŒƒå›´ã€‚å¦ä¸€æ–¹é¢, å¦‚æœä½ æƒ³å¤„ç†ä¸€ä¸ªè¾ƒå¹¿çš„èŒƒå›´, é‚£ä¹ˆ <strong>Numeric</strong> ç±»å‹å¯èƒ½æ›´åˆé€‚ã€‚</p>
<p>å¦‚æœä½ æƒ³ä¸€æ¢ç©¶ç«Ÿ, Raku ä¹Ÿæä¾›äº†ä¸€ç³»åˆ—çš„æ˜ å°„åˆ°ä½ å¸¸å¸¸è§åˆ°çš„, ä¾‹å¦‚ C è¯­è¨€ä¸­çš„åŸç”Ÿç±»å‹ã€‚ä½¿ç”¨è¿™äº›åŸç”Ÿç±»å‹å¯èƒ½ä¼šæä¾›æ€§èƒ½æå‡æˆ–å†…å­˜ä½¿ç”¨çš„å‡å°‘ã€‚å¯ç”¨çš„åŸç”Ÿç±»å‹æœ‰ï¼šint, int8, int16, int32, int64, uint, uint8, uint16, uint32, uint64, num, num32, num64ã€‚ç±»å‹åå­—ä¸­çš„æ•°å­—è¡¨ç¤ºå¯å¾—çš„å­—èŠ‚, ä¸å«æ•°å­—çš„ç±»å‹æ˜¯å¹³å°æ— å…³çš„ã€‚</p>
<p>è¯¸å¦‚ int1, int2 å’Œ int4 çš„å­å­—èŠ‚ç±»å‹ä¹Ÿè®¡åˆ’åœ¨æœªæ¥å®ç°ã€‚</p>
<h2 id="ç¬‘è„¸ç¬¦å·">ç¬‘è„¸ç¬¦å·</h2>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="nf">foo</span> <span class="p">(</span><span class="nb">Int:U</span> <span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#39;</span><span class="s1">Y U NO define $x?</span><span class="p">&#39;</span>         <span class="p">}</span>
<span class="k">multi</span> <span class="nf">foo</span> <span class="p">(</span><span class="nb">Int:D</span> <span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">The Square of </span><span class="nv">$x</span><span class="s2"> is </span><span class="p">{</span><span class="nv">$x</span>Â²<span class="p">}&#34;</span> <span class="p">}</span>

<span class="k">my</span> <span class="nb">Int</span> <span class="nv">$x</span><span class="p">;</span>
<span class="nb">say</span> <span class="n">foo</span> <span class="nv">$x</span><span class="p">;</span>
<span class="nv">$x</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
<span class="nb">say</span> <span class="n">foo</span> <span class="nv">$x</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># Y U NO define $x?</span>
<span class="c1"># The square of 42 is 1764</span>
</code></pre></div><p>ç¬‘è„¸ç¬¦å·æ˜¯è¿½åŠ åœ¨ç±»å‹ååé¢çš„ <em><code>:U</code></em>ã€<em><code>:D</code></em> æˆ– <code>:_</code>ã€‚åœ¨ä½ æ²¡æœ‰æŒ‡å®šç¬‘è„¸ç¬¦å·çš„æ—¶å€™, <code>:_</code> æ˜¯ä½ è·å¾—çš„é»˜è®¤ç¬‘è„¸ç¬¦å·ã€‚<em><code>:U</code></em> åªæŒ‡å®šæœªå®šä¹‰(undefined)å€¼, è€Œ <code>:D</code> åªæŒ‡å®šå®šä¹‰(defined)å€¼ã€‚</p>
<p>é€šè¿‡åœ¨è°ƒç”¨è€…èº«ä¸Šä½¿ç”¨ä¸¤ä¸ªå¸¦æœ‰ <em><code>:U</code></em> å’Œ <em><code>:D</code></em> çš„ multis, æˆ‘ä»¬èƒ½çŸ¥é“æ–¹æ³•æ˜¯åœ¨ç±»ä¸Šè°ƒç”¨çš„è¿˜æ˜¯åœ¨å®ä¾‹ä¸Šè°ƒç”¨çš„ã€‚å¦‚æœä½ åœ¨æ ¸åŠ¨åŠ›è£…ç½®ä¸Šå·¥ä½œ, ç¡®ä¿ä½ çš„é²æ£’æ’å…¥å­ä¾‹ç¨‹ç»å¯¹ä¸ä¼šæ’å…¥ä»»ä½•æœªå®šä¹‰çš„é‡ä¹Ÿæ˜¯ä¸€ä»¶å¥½äº‹æƒ…, æˆ‘æƒ³ã€‚</p>
<h2 id="subsetså®šåˆ¶çš„ç±»å‹">Subsetsï¼šå®šåˆ¶çš„ç±»å‹</h2>
<p>å†…ç½®çš„ç±»å‹å¾ˆé…·, ä½†æ˜¯ç¨‹åºå‘˜å·¥ä½œçš„å¤§éƒ¨åˆ†æ•°æ®æ²¡æœ‰ç²¾ç¡®åœ°åŒ¹é…ã€‚è¿™å°±æ˜¯ Raku subsets è¿›åœºçš„æ—¶å€™äº†ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">subset</span> <span class="nc">Prime</span> <span class="k">of</span> <span class="nb">Int</span> <span class="k">where</span> <span class="o">*.</span><span class="nb">is-prime</span><span class="p">;</span>
<span class="k">my</span> <span class="n">Prime</span> <span class="nv">$x</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="nv">$x</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span> <span class="c1"># works</span>
<span class="nv">$x</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>  <span class="c1"># å¤±è´¥, ç±»å‹ä¸åŒ¹é…ã€‚</span>
</code></pre></div><p>ä½¿ç”¨ <em>subset</em> å…³é”®å­—, æˆ‘ä»¬å°±åœ°åˆ›å»ºäº†ä¸€ä¸ªå«åš <strong>Prime</strong> çš„ç±»å‹ã€‚å®ƒæ˜¯ <strong>Int</strong> ç±»å‹çš„ä¸€ä¸ªå­é›†(subset), æ‰€ä»¥ä»»ä½•é Int æ•°ä¸åŒ¹é…è¿™ä¸ªç±»å‹ã€‚æˆ‘ä»¬è¿˜ä½¿ç”¨ <em>where</em> å…³é”®å­—æŒ‡å®šäº†ä¸€ä¸ªé¢å¤–çš„çº¦æŸï¼›é‚£ä¸ªçº¦æŸæ˜¯åœ¨ç»™å®šå€¼èº«ä¸Šè°ƒç”¨çš„ <em>.is-prime</em> æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ª true å€¼ã€‚</p>
<p>ä½¿ç”¨é‚£ä¸ªå•è¡Œä»£ç , æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç‰¹å®šçš„ç±»å‹å¹¶å¯ä»¥åƒå†…ç½®ç±»å‹é‚£æ ·ä½¿ç”¨å®ƒï¼æˆ‘ä»¬ä¸ä»…å¯ä»¥ç”¨å®ƒæ¥æŒ‡å®šå˜é‡çš„ç±»å‹ã€å­ä¾‹ç¨‹/æ–¹æ³•çš„å‚æ•°ç±»å‹å’Œè¿”å›å€¼ç±»å‹, æˆ‘ä»¬è¿˜èƒ½ä½¿ç”¨æ™ºèƒ½åŒ¹é…æ“ä½œç¬¦æ¥æµ‹è¯•ä»»æ„å€¼, å°±åƒæˆ‘ä»¬åœ¨å†…ç½®ç±»å‹ä¸­åšå¾—é‚£æ ·ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">subset</span> <span class="nc">Prime</span> <span class="k">of</span> <span class="nb">Int</span> <span class="k">where</span> <span class="o">*.</span><span class="nb">is-prime</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">It is an Int</span><span class="p">&#34;</span> <span class="k">if</span> <span class="p">&#39;</span><span class="s1">foo</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="nb">Int</span><span class="p">;</span>   <span class="c1"># false, it&#39;s a Str</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">It&#39;s a prime</span><span class="p">&#34;</span> <span class="k">if</span> <span class="mi">31337</span> <span class="o">~~</span> <span class="n">Prime</span><span class="p">;</span> <span class="c1"># true, it&#39;s a prime number</span>
</code></pre></div><p>å¦‚æœä½ çš„ç±»å‹æ˜¯ä¸€æ¬¡æ€§çš„ä¸œè¥¿, ä½ åªæƒ³æŠŠå®ƒåº”ç”¨åˆ°å•ä¸ªå˜é‡ä¸Šå‘¢ï¼Ÿä½ ä¸€ç‚¹ä¹Ÿä¸å¿…å•ç‹¬å£°æ˜ä¸€ä¸ª subsetï¼å°±åœ¨å˜é‡åé¢ä½¿ç”¨ <em>where</em> å…³é”®å­—å¥½äº†, ä½ å¾ˆå¥½çš„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="nf">is-a-prime</span> <span class="p">(</span> <span class="nb">Int</span> <span class="nv">$</span> <span class="k">where</span> <span class="o">*.</span><span class="nb">is-prime</span> <span class="k">--&gt;</span> <span class="p">&#39;</span><span class="s1">Yup</span><span class="p">&#39;</span> <span class="p">)</span> <span class="p">{}</span>
<span class="k">multi</span> <span class="nf">is-a-prime</span> <span class="p">(</span> <span class="nb">Any</span>                    <span class="k">--&gt;</span> <span class="p">&#39;</span><span class="s1">Nope</span><span class="p">&#39;)</span> <span class="p">{}</span>

<span class="nb">say</span> <span class="n">is-a-prime</span> <span class="mi">3</span><span class="p">;</span>     <span class="c1"># Yup</span>
<span class="nb">say</span> <span class="n">is-a-prime</span> <span class="mi">4</span><span class="p">;</span>     <span class="c1"># Nope</span>
<span class="nb">say</span> <span class="n">is-a-prime</span> <span class="p">&#39;</span><span class="s1">foo</span><span class="p">&#39;;</span> <span class="c1"># Nope</span>
</code></pre></div><p>ä¸Šé¢çš„ç­¾åä¸­çš„ <strong><code>--&gt;</code></strong> æ˜¯è¡¨ç¤ºè¿”å›å€¼ç±»å‹çš„å¦å¤–ä¸€ç§æ–¹å¼, æˆ–è€…åœ¨è¿™ç§æƒ…å†µä¸‹, æ˜¯ä¸€ç§å…·ä½“çš„è¿”å›å€¼ã€‚æ‰€ä»¥æˆ‘ä»¬æ‹¥æœ‰äº†ä¸¤ä¸ªå«æœ‰ä¸åŒç­¾åçš„ multiesã€‚ç¬¬ä¸€ä¸ªæ¥æ”¶ä¸€ä¸ª <strong>Int</strong> ç±»å‹çš„è´¨æ•°, ç¬¬äºŒä¸ªæ¥å—å‰©ä¸‹çš„ä»»ä½•ä¸œè¥¿ã€‚æˆ‘ä»¬çš„ multies å‡½æ•°ä½“ä¸­æ²¡æœ‰ä»»ä½•ä»£ç , å°±å†™äº†ä¸€ä¸ªå­ä¾‹ç¨‹å‘Šè¯‰ä½ ä¸€ä¸ªæ•°å­—æ˜¯å¦æ˜¯è´¨æ•°ï¼</p>
<h2 id="æ‰“åŒ…é‡ç”¨">æ‰“åŒ…é‡ç”¨</h2>
<p>ç›®å‰ä¸ºæ­¢æˆ‘ä»¬å­¦åˆ°çš„å¾ˆé…·, ä½†æ˜¯é…·ä¸æ˜¯ awesomeï¼ä½ å¯èƒ½ä¼šå¾ˆé¢‘ç¹åœ°ä½¿ç”¨æŸäº›ä½ è‡ªå®šä¹‰çš„ç±»å‹ã€‚åœ¨å‚é‡Œé¢å·¥ä½œ, äº§å“å·è‡³å¤šæœ‰20ä¸ªå­—ç¬¦, ä»¥æŸç§æ ¼å¼ï¼Ÿéå¸¸å¥½ï¼æˆ‘ä»¬ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªå­ç±»å‹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">subset</span> <span class="nc">ProductNumber</span> <span class="k">of</span> <span class="nb">Str</span> <span class="k">where</span> <span class="p">{</span> <span class="o">.</span><span class="nb">chars</span> <span class="o">&lt;=</span><span class="mi">20</span> <span class="ow">and</span> <span class="k">m</span><span class="p">/</span><span class="ni">^</span><span class="sr"> </span><span class="se">\d</span><span class="o">**</span><span class="mi">3</span><span class="sr"> </span><span class="p">&lt;[</span><span class="sr">-#</span><span class="p">]&gt;</span><span class="sr"> </span><span class="p">/</span> <span class="p">};</span>
<span class="k">my</span> <span class="n">ProductNumber</span> <span class="nv">$num</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">333-FOOBAR</span><span class="p">&#39;;</span>
</code></pre></div><p>è¿™å¥½æäº†, ä½†æ˜¯æˆ‘ä»¬ä¸æƒ³åœ¨æ‰€æœ‰çš„åœ°æ–¹éƒ½é‡å¤è¿™ä¸ª subsetã€‚æˆ‘ä»¬æ¥æŠŠå®ƒæ¨åˆ°ä¸€ä¸ªå•ç‹¬çš„æ¨¡å—ä¸­ã€‚æˆ‘ä¼šåˆ›å»º <code>/opt/local/Raku/Company/Types.pm6</code> å› ä¸º <code>/opt/local/Raku</code> æ˜¯åŒ…å«åœ¨æˆ‘ä¸ºè¿™ä¸ªè™šæ„çš„å‚æ‰€å†™çš„æ‰€æœ‰ apps ä¸­çš„æ¨¡å—æœç´¢è·¯å¾„ä¸­çš„è·¯å¾„ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­, æˆ‘ä¼šæœ‰ä¸‹é¢çš„ä»£ç ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">unit</span> <span class="k">module</span> <span class="nn">Company::Types</span><span class="p">;</span>

<span class="k">my</span> <span class="nb">package</span> <span class="nn">EXPORT::DEFAULT</span> <span class="p">{</span>
    <span class="k">subset</span> <span class="nc">ProductNumber</span> <span class="k">of</span> <span class="nb">Str</span> <span class="k">where</span> <span class="p">{</span> <span class="o">.</span><span class="nb">chars</span> <span class="o">&lt;=</span><span class="mi">20</span> <span class="ow">and</span> <span class="k">m</span><span class="p">/</span><span class="ni">^</span><span class="sr"> </span><span class="se">\d</span><span class="o">**</span><span class="mi">3</span><span class="sr"> </span><span class="p">&lt;[</span><span class="sr">-#</span><span class="p">]&gt;</span><span class="sr"> </span><span class="p">/</span> <span class="p">};</span>
<span class="p">}</span>
</code></pre></div><p>æˆ‘ä»¬ç»™æˆ‘ä»¬çš„æ¨¡å—èµ·äº†ä¸€ä¸ªåå­—å¹¶é»˜è®¤å¯¼å‡ºæˆ‘ä»¬å¯çˆ±çš„ subsetsã€‚æˆ‘ä»¬çš„ä»£ç çœ‹èµ·æ¥æ€ä¹ˆæ ·äº†ï¼Ÿå®ƒçœ‹èµ·æ¥é…·æ¯™äº† - ä¸, ç­‰ç­‰, AWESOME - è¿™ä¸€æ¬¡ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">use</span> <span class="nn">Company::Types</span><span class="p">;</span>

<span class="k">my</span> <span class="n">ProductNumber</span> <span class="nv">$num1</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">333-FOOBAR</span><span class="p">&#39;;</span> <span class="c1"># succeeds</span>
<span class="k">my</span> <span class="n">ProductNumber</span> <span class="nv">$num2</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">meow</span><span class="p">&#39;;</span>       <span class="c1"># fails</span>
</code></pre></div><p>è¿™æ ·, æˆ‘ä»¬ä½¿ç”¨å•ä¸ª use è¯­å¥æ‰©å±•äº† Raku ä»¥ä¸ºæˆ‘ä»¬æä¾›å®šåˆ¶çš„ç±»å‹, å®ƒç²¾ç¡®åœ°åŒ¹é…äº†æˆ‘ä»¬æƒ³è¦çš„æ•°æ®æˆä¸ºä»€ä¹ˆæ ·å­ã€‚</p>
<h2 id="awesome-error-messages-for-subsets">Awesome Error Messages for Subsets</h2>
<p>å¦‚æœä½ å°è¯•è¿‡æ‰€æœ‰è¿™äº›ä¾‹å­, ä½ å¯èƒ½æ³¨æ„åˆ°ä¸€ç‚¹å°ç‘•ç–µã€‚ä½ å¾—åˆ°çš„é”™è¯¯ä¿¡æ¯ä¸å¤Ÿç»™åŠ›ï¼</p>
<pre><code>Type check failed in assignment to $num2;
expected Company::Types::EXPORT::DEFAULT::ProductNumber but got Str (&quot;meow&quot;)
in block &lt;unit&gt; at test.p6 line 3
</code></pre><p>å½“ç»™ä½ æ˜¯ä½ çš„ç›®æ ‡çš„æ—¶å€™, ä½ è‚¯å®šæœ‰æå‡é‚£äº›ä¿¡æ¯çš„æ–¹æ³•ã€‚å†æ¬¡æ‰“å¼€æˆ‘ä»¬çš„ <strong>Company::Types</strong> æ–‡ä»¶, å¹¶æ‰©å±•æˆ‘ä»¬çš„ <strong>ProductNumber</strong> çš„ <em>where</em> ä»å¥ä»¥åŒ…æ‹¬ç»™åŠ›çš„é”™è¯¯ä¿¡æ¯ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">subset</span> <span class="nc">ProductNumber</span> <span class="k">of</span> <span class="nb">Str</span> <span class="k">where</span> <span class="p">{</span>
    <span class="o">.</span><span class="nb">chars</span> <span class="o">&lt;=</span> <span class="mi">20</span> <span class="ow">and</span> <span class="k">m</span><span class="p">/</span><span class="ni">^</span><span class="sr"> </span><span class="se">\d</span><span class="o">**</span><span class="mi">3</span><span class="sr"> </span><span class="p">&lt;[</span><span class="sr">-#</span><span class="p">]&gt;</span><span class="sr"> </span><span class="p">/</span>
        <span class="ow">or</span> <span class="nb">warn</span> <span class="p">&#39;</span><span class="s1">ProductNumber type expects a string at most 20 chars long</span><span class="p">&#39;</span>
            <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> with the first 4 characters in the format of \d\d\d[-|#]</span><span class="p">&#39;</span>
<span class="p">}</span>
</code></pre></div><p>ç°åœ¨, åœ¨ä¸œè¥¿ä¸åŒ¹é…æˆ‘ä»¬çš„ç±»å‹çš„æ—¶å€™, ä¿¡æ¯ä¼šåœ¨ <strong>Type</strong> æ£€æŸ¥ä¿¡æ¯å’Œæ ˆè¿½è¸ªä¹‹å‰è¢«åŒ…æ‹¬è¿›æ¥, ä¸ºæˆ‘ä»¬æä¾›æ‰€æœŸæœ›çš„ä¸œè¥¿çš„æ›´å¤šä¿¡æ¯ã€‚ å¦‚æœä½ æƒ³, è¿™å„¿ä½ ä¹Ÿå¯ä»¥è°ƒç”¨ <em>fail</em> ä»£æ›¿ <em>warn</em>, è¿™æ—¶ Type check&hellip; ä¿¡æ¯ä¸ä¼šè¢«æ‰“å°å‡ºæ¥, ç»™ä½ æ›´å¤šæ§åˆ¶ã€‚</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/subset" term="subset" label="subset" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä¸­çš„æ¢³å­]]></title>
            <link href="https://ohmyweekly.github.io/notes/2016-06-07-07-comb-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2016-02-03-comb-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="comb - æ“ä½œå­—ç¬¦ä¸²çš„åˆ©å™¨" />
            
                <id>https://ohmyweekly.github.io/notes/2016-06-07-07-comb-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-15T00:00:00+08:00</published>
            <updated>2021-07-15T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Comb in Raku</blockquote><h1 id="raku-ä¸­çš„æ¢³å­">Raku ä¸­çš„æ¢³å­!</h1>
<p>åœ¨ Perl 5 ä¸­, æˆ‘å¾ˆæ„Ÿæ¿€æœ‰è¿™æ ·ä¸¤ä¸ªä¾¿åˆ©çš„ç»“æ„:</p>
<div class="highlight"><pre class="chroma"><code class="language-perl" data-lang="perl"><span class="k">my</span> <span class="nv">@things</span> <span class="o">=</span> <span class="nv">$text</span> <span class="o">=~</span><span class="sr"> /thing/g</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">%things</span> <span class="o">=</span> <span class="nv">$text</span> <span class="o">=~</span><span class="sr"> /(key)...(value)/g</span><span class="p">;</span>
</code></pre></div><p>ä½ æ‹¿å‡ºä¸€å°æ®µå¯ä»¥é¢„è§çš„æ–‡æœ¬, å¹¶ç»™å®ƒä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼, å¼å¼, ä½ å¾—åˆ°äº†ä¸€ä¸ªåˆ—è¡¨å’Œæ•£åˆ—, åƒå˜é­”æœ¯ä¸€èˆ¬ï¼æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ Raku ä¸­ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼, ä½†æ˜¯ <strong><a href="http://docs.raku.org/routine/comb">comb</a></strong> æ›´é€‚åˆåšè¿™ä¸ªå·¥ä½œã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/326727-29a3966bbb8e437f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="img"></p>
<h2 id="æœ´ç´ çš„å­—ç¬¦">æœ´ç´ çš„å­—ç¬¦</h2>
<p>ä½ å¯ä»¥æŠŠ <em>comb</em> ç”¨ä½œå­ä¾‹ç¨‹æˆ–æ–¹æ³•ã€‚åœ¨å®ƒçš„æœ€åŸºæœ¬çš„å½¢å¼ä¸­, <em>comb</em> ä¼šæŠŠå­—ç¬¦ä¸²åˆ†è§£ä¸ºå­—ç¬¦:</p>
<div class="highlight"><pre class="chroma"><code class="language-Raku" data-lang="Raku"><span class="p">&#39;</span><span class="s1">foobar moobar é§±é§é“bar</span><span class="p">&#39;</span><span class="o">.</span><span class="nb">comb</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;</span><span class="s1">|</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>
<span class="p">&#39;</span><span class="s1">foobar moobar é§±é§é“bar</span><span class="p">&#39;</span><span class="o">.</span><span class="nb">comb</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;</span><span class="s1">|</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># f|o|o|b|a|r| |m|o|o|b|a|r| |é§±|é§|é“|b|a|r</span>
<span class="c1"># foobar| mooba|r é§±é§é“b|ar</span>
</code></pre></div><p>ä¸é€‚ç”¨ä»»ä½•å‚æ•°çš„ <em>comb</em> ä½ ä¼šå¾—åˆ°å„ä¸ªå•ç‹¬çš„å­—ç¬¦ã€‚ç»™ <em>comb</em> æä¾›ä¸€ä¸ªæ•´æ•° <code>$n</code>, é‚£ä¹ˆä½ ä¼šå¾—åˆ°é•¿åº¦è‡³å¤šä¸º <code>$n</code> ä¸ªå­—ç¬¦çš„ä¸€ä¸ªåˆ—è¡¨, å¹¶ä¸”å¦‚æœæ²¡æœ‰å‰©ä¸‹çš„å­—ç¬¦ä¸å¤Ÿçš„è¯, è¿™ä¸ªåˆ—è¡¨ä¼šæ¥æ”¶è¾ƒçŸ­çš„è¿™ä¸ªå­—ç¬¦ä¸²ã€‚è¿™ä¸ªæ–¹æ³•æ¯”ä½¿ç”¨æ­£åˆ™è¡¨å¿«äº† 30 å€ã€‚</p>
<h2 id="limits">Limits</h2>
<p>ä½ ä¹Ÿå¯ä»¥ä¸º <em>comb</em> æä¾›ç¬¬äºŒä¸ªæ•´æ•°å‚æ•°, å³ <em>limit</em>, æ¥æ ‡ç¤ºæ¯ä¸ªåˆ—è¡¨ä¸­æœ€å¤šå«æœ‰ limit ä¸ªå…ƒç´ :</p>
<div class="highlight"><pre class="chroma"><code class="language-Raku" data-lang="Raku"><span class="p">&#39;</span><span class="s1">foobar moobar é§±é§é“bar</span><span class="p">&#39;</span><span class="o">.</span><span class="nb">comb</span><span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;</span><span class="s1">|</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>
<span class="p">&#39;</span><span class="s1">foobar moobar é§±é§é“bar</span><span class="p">&#39;</span><span class="o">.</span><span class="nb">comb</span><span class="p">(</span><span class="mi">6</span><span class="o">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;</span><span class="s1">|</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># f|o|o|b|a</span>
<span class="c1"># foobar| mooba</span>
</code></pre></div><p>è¿™é€‚ç”¨äºä½¿ç”¨ <em>comb</em> æ–¹æ³•/å‡½æ•°çš„æ‰€æœ‰å½¢å¼, è€Œä¸ä»…ä»…æ˜¯ä¸Šé¢å±•ç¤ºçš„é‚£æ ·ã€‚</p>
<h2 id="è®¡æ•°">è®¡æ•°</h2>
<p><em>comb</em> ä¹Ÿæ¥æ”¶æ™®é€šçš„ <a href="http://docs.raku.org/type/Str">Str</a> ä½œä¸ºå‚æ•°, è¿”å›ä¸€ä¸ªåŒ…å«é‚£ä¸ªå­—ç¬¦ä¸²çš„åŒ¹é…çš„åˆ—è¡¨ã€‚æ‰€ä»¥è¿™åœ¨è®¡ç®—å­å­—ç¬¦ä¸²åœ¨å­—ç¬¦ä¸²ä¸­å‡ºç°çš„æ¬¡æ•°æ—¶å¾ˆæœ‰ç”¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-Raku" data-lang="Raku"><span class="p">&#39;</span><span class="s1">The ğŸˆ ran after a ğŸ, but the ğŸ ran away</span><span class="p">&#39;</span><span class="o">.</span><span class="nb">comb</span><span class="p">(&#39;</span><span class="s1">ğŸˆ</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">Int</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>
<span class="p">&#39;</span><span class="s1">The ğŸˆ ran after a ğŸ, but the ğŸ ran away</span><span class="p">&#39;</span><span class="o">.</span><span class="nb">comb</span><span class="p">(&#39;</span><span class="s1">ran</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">Int</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># 1</span>
<span class="c1"># 2</span>
</code></pre></div><h2 id="ç®€å•çš„åŒ¹é…">ç®€å•çš„åŒ¹é…</h2>
<p><em>comb</em> çš„å‚æ•°ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼, æ•´ä¸ªåŒ¹é…ä¼šä½œä¸ºä¸€ä¸ªæ ‡é‡è¢«è¿”å›ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-Raku" data-lang="Raku"><span class="n">foobar</span> <span class="n">moobar</span> <span class="n">é§±é§é“bar&#39;</span><span class="o">.</span><span class="nb">comb</span><span class="p">(/&lt;[</span><span class="sr">a</span><span class="o">..</span><span class="sr">z</span><span class="p">]&gt;</span><span class="o">+</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">bar</span><span class="p">&#39;/)</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;</span><span class="s1">|</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># foobar|moobar</span>
</code></pre></div><h2 id="é™åˆ¶æ‰€åŒ¹é…çš„ä¸œè¥¿">é™åˆ¶æ‰€åŒ¹é…çš„ä¸œè¥¿</h2>
<p>ä½ å¯ä»¥ä½¿ç”¨<a href="http://docs.raku.org/language/regexes#Look-around_assertions">ç¯è§†æ–­è¨€</a>æˆ–è€…æ›´ç®€å•çš„ <code>&lt;(</code> å’Œ <code>)&gt;</code> æ­£åˆ™è¡¨è¾¾å¼æ•è·è®°å·:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">&#39;</span><span class="s1">moo=meow ping=pong</span><span class="p">&#39;</span><span class="o">.</span><span class="nb">comb</span><span class="p">(/</span><span class="se">\w</span><span class="o">+</span><span class="sr">    </span><span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">&lt;(</span><span class="sr"> </span><span class="se">\w</span><span class="o">**</span><span class="mi">4</span><span class="p">/)</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;</span><span class="s1">|</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span> <span class="c1"># values</span>
<span class="p">&#39;</span><span class="s1">moo=meow ping=pong</span><span class="p">&#39;</span><span class="o">.</span><span class="nb">comb</span><span class="p">(/</span><span class="se">\w</span><span class="o">+</span><span class="sr"> </span><span class="o">)&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span><span class="sr">    </span><span class="se">\w</span><span class="o">**</span><span class="mi">4</span><span class="p">/)</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;</span><span class="s1">|</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span> <span class="c1"># keys</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># meow|pong</span>
<span class="c1"># moo|ping</span>
</code></pre></div><p>ä½ å¯ä»¥ä½¿ç”¨ <code>&lt;(</code> å’Œ <code>)&gt;</code> ä¸¤è€…ä¹‹ä¸€æˆ–ä¸¤è€…éƒ½ä½¿ç”¨ã€‚<code>&lt;(</code> ä»åŒ¹é…ä¸­æ’é™¤ä»»ä½•å®ƒä¹‹å‰çš„ä¸œè¥¿, è€Œ <code>)&gt;</code> ä¼šæ’é™¤ä¹‹åçš„ä»»ä½•ä¸œè¥¿ã€‚å³ <code>/'foo' &lt;('bar')&gt; 'ber'/</code> ä¼šåŒ¹é…åŒ…å« <em>foobarber</em> çš„ä¸œè¥¿, ä½†æ˜¯ä» <em>comb</em> ä¸­è¿”å›çš„ä¸œè¥¿åªä¼šæœ‰ <em>bar</em>ã€‚</p>
<h2 id="å¤šä¸ªæ•è·">å¤šä¸ªæ•è·</h2>
<p>æ€ä¹ˆæ ·å¾—å‡º Perl 5 é‚£æ ·çš„é”®/å€¼å¯¹å„¿å‘¢ï¼Ÿ</p>
<div class="highlight"><pre class="chroma"><code class="language-Raku" data-lang="Raku"><span class="k">my</span> <span class="nv">%things</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">moo=meow ping=pong</span><span class="p">&#39;</span><span class="o">.</span><span class="nb">comb</span><span class="p">(/(</span><span class="se">\w</span><span class="o">+</span><span class="p">)</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">(</span><span class="se">\w</span><span class="o">+</span><span class="p">)/</span><span class="o">,</span> <span class="p">:</span><span class="s">match</span><span class="p">)</span><span class="o">Â».</span><span class="nb">Slip</span><span class="o">Â».</span><span class="nb">Str</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">%things</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># moo =&gt; meow, ping =&gt; pong</span>
</code></pre></div><p>åœ†æ‹¬å·ç”¨äºæ•è·ã€‚<code>:match</code> å‚æ•°ä½¿ <em>comb</em> è¿”å›ä¸€ä¸ª <strong>Match</strong> å¯¹è±¡çš„åˆ—è¡¨, è€Œéè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ã€‚ä¸‹ä¸€æ­¥, æˆ‘ä»¬ä½¿ç”¨ä¸¤ä¸ª hyper è¿ç®—ç¬¦æŠŠ <strong>Matches</strong> è½¬æ¢ä¸º <a href="http://docs.raku.org/type/Slip">Slips</a>, è¿™ä¼šç»™æˆ‘ä»¬ä¸€ä¸ªæ•è·çš„åˆ—è¡¨, ä½†æ˜¯å®ƒä»¬ä»æ—§æ˜¯ <strong>Match</strong> å¯¹è±¡, è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜è¦æŠŠå®ƒä»¬è½¬æ¢ä¸º <strong>Str</strong> çš„åŸå› ã€‚</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å…·åæ•è·ä½¿ä»£ç æ›´æ¸…æ™°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-Raku" data-lang="Raku"><span class="k">my</span> <span class="nv">%things</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">moo=meow ping=pong</span><span class="p">&#39;</span>
    <span class="o">.</span><span class="nb">comb</span><span class="p">(/</span><span class="nv">$&lt;key&gt;</span><span class="o">=</span><span class="se">\w</span><span class="o">+</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span><span class="sr"> </span><span class="nv">$&lt;value&gt;</span><span class="o">=</span><span class="se">\w</span><span class="o">+</span><span class="p">/</span><span class="o">,</span> <span class="p">:</span><span class="s">match</span><span class="p">)</span>
    <span class="o">.</span><span class="nb">map</span><span class="p">({</span> <span class="o">.</span><span class="p">&lt;</span><span class="s">key</span><span class="p">&gt;</span> <span class="o">=&gt;</span> <span class="o">.</span><span class="p">&lt;</span><span class="s">value</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">Str</span> <span class="p">});</span>
<span class="nb">say</span> <span class="nv">%things</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># moo =&gt; meow, ping =&gt; pong</span>
</code></pre></div><p>ä½ è¿˜å¯ä»¥æŠŠä¸Šé¢çš„ä»£ç å†™æˆè¿™æ ·ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-Raku" data-lang="Raku"><span class="k">my</span> <span class="nv">%things</span> <span class="o">=</span> <span class="p">(&#39;</span><span class="s1">moo=meow ping=pong</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="k">m</span><span class="p">:</span><span class="na">g</span><span class="p">/(</span><span class="se">\w</span><span class="o">+</span><span class="p">)</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">(</span><span class="se">\w</span><span class="o">+</span><span class="p">)/)</span><span class="o">Â».</span><span class="nb">Slip</span><span class="o">Â».</span><span class="nb">Str</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">%things</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># moo =&gt; meow, ping =&gt; pong</span>
</code></pre></div><h2 id="ç»“è®º">ç»“è®º</h2>
<p>æŠŠ <em>comb</em> å’Œ <em><a href="http://blogs.perl.org/users/zoffix_znet/2016/01/perl-6-rotor-the-king-of-list-manipulation.html">rotor</a></em> ç»“åˆèµ·æ¥ç”¨ä¼šå¾ˆå¼ºå¤§ã€‚</p>
<h2 id="è¯„è®º">è¯„è®º</h2>
<p>ä»£æ›¿ä½¿ç”¨å¸¦æœ‰ <code>:match</code> å‚æ•°çš„ <code>.comb</code>, ä½ æœ€å¥½å°±ä½¿ç”¨ <code>.match</code> æ–¹æ³•å¥½äº†:</p>
<div class="highlight"><pre class="chroma"><code class="language-Raku" data-lang="Raku"><span class="p">&#39;</span><span class="s1">moo=meow ping=pong</span><span class="p">&#39;</span><span class="o">.</span><span class="nb">match</span><span class="p">(/(</span><span class="se">\w</span><span class="o">+</span><span class="p">)</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">(</span><span class="se">\w</span><span class="o">+</span><span class="p">)/</span><span class="o">,</span> <span class="p">:</span><span class="s">g</span><span class="p">)</span>
</code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/comb" term="comb" label="comb" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[roundrobin]]></title>
            <link href="https://ohmyweekly.github.io/notes/2016-06-07-18-roundrobin/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2016-06-07-18-roundrobin/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-15T00:00:00+08:00</published>
            <updated>2021-07-15T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Roundrobin</blockquote><p>roundrobin çš„å®šä¹‰ä¸º:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="nb">roundrobin</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span> <span class="k">--&gt;</span> <span class="nb">Seq</span><span class="p">)</span>
</code></pre></div><p>ç”¨æ³•:</p>
<pre><code>roundrobin LISTS
</code></pre><h2 id="round-robin-merge-two-lists-of-different-length">Round-Robin Merge Two Lists of Different Length</h2>
<p><strong>roundrobin</strong> å¾ˆåƒ <strong>zip</strong>ã€‚ä¸åŒä¹‹å¤„æ˜¯, <code>roundrobin</code> ä¸ä¼šåœ¨ç”¨å…‰å…ƒç´ çš„åˆ—è¡¨ä¸Šåœæ­¢è€Œæ˜¯ä»…ä»…è·³è¿‡ä»»ä½•æœªå®šä¹‰çš„å€¼ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">@b</span> <span class="o">=</span> <span class="mi">1</span><span class="o">..</span><span class="mi">2</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">@c</span> <span class="o">=</span> <span class="mi">1</span><span class="o">..</span><span class="mi">3</span><span class="p">;</span>

<span class="k">for</span> <span class="nb">flat</span> <span class="nb">roundrobin</span><span class="p">(</span><span class="nv">@a</span><span class="o">,</span> <span class="nv">@b</span><span class="o">,</span> <span class="nv">@c</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nv">$x</span> <span class="p">{</span> 
    <span class="nv">$x</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>
    <span class="c1"># 1,1,1,2,2,3</span>
<span class="p">}</span> 
</code></pre></div><p>å®ƒåªæ˜¯è·³è¿‡äº†æœªå®šçš„å€¼, ç›´åˆ°æœ€é•¿çš„é‚£ä¸ªåˆ—è¡¨çš„å…ƒç´ ç”¨å®Œã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@list1</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;</span> <span class="o">..</span> <span class="p">&#39;</span><span class="s1">h</span><span class="p">&#39;;</span>
<span class="k">my</span> <span class="nv">@list2</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">x y</span><span class="p">&gt;;</span>

<span class="nb">say</span> <span class="nb">flat</span> <span class="nb">roundrobin</span> <span class="nv">@list1</span><span class="o">,</span> <span class="nv">@list2</span><span class="p">;</span>
<span class="c1"># a x b y c d e f g h</span>
</code></pre></div><p><strong>roundrobin</strong> è¿”å›çš„æ˜¯ä¸€åˆ— <code>Seq</code>, æ‰€ä»¥ä½¿ç”¨ flat è¿›è¡Œå±•å¼€ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@list1</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;</span> <span class="o">..</span> <span class="p">&#39;</span><span class="s1">h</span><span class="p">&#39;;</span>
<span class="k">my</span> <span class="nv">@list2</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">x y</span><span class="p">&gt;;</span>
<span class="k">my</span> <span class="nv">$n</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

<span class="nb">say</span> <span class="nb">flat</span> <span class="nb">roundrobin</span> <span class="nv">@list1</span><span class="o">.</span><span class="nb">rotor</span><span class="p">(</span><span class="nv">$n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">,</span> <span class="p">:</span><span class="s">partial</span><span class="p">)</span><span class="o">,</span> <span class="nv">@list2</span><span class="p">;</span>

<span class="c1"># OUTPUT: Â«a b x c d y e f g hÂ»</span>
</code></pre></div><p><code>.rotor</code> æ–¹æ³•æŠŠä¸€ä¸ªåˆ—è¡¨åˆ†è§£ä¸ºå­åˆ—è¡¨ã€‚</p>
<h2 id="äº¤å‰ä¸¤ä¸ªå­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦">äº¤å‰ä¸¤ä¸ªå­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦</h2>
<pre><code>#Given:
u = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
l = 'abcdefghijklmnopqrstuvwxyz'

#Wanted:
'AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz'
</code></pre><p>æ–¹æ³•ä¸€:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nb">join</span> <span class="p">&#39;&#39;</span><span class="o">,</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="nb">comb</span> <span class="ow">Z</span> <span class="nb">l</span><span class="o">.</span><span class="nb">comb</span><span class="p">);</span>
</code></pre></div><p>æ–¹æ³•äºŒ:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="o">[~]</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="nb">comb</span> <span class="ow">Z</span> <span class="nb">l</span><span class="o">.</span><span class="nb">comb</span><span class="p">);</span>
</code></pre></div><p>æ–¹æ³•ä¸‰:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="o">[~]</span> <span class="nb">flat</span> <span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="nb">comb</span> <span class="ow">Z</span> <span class="nb">l</span><span class="o">.</span><span class="nb">comb</span><span class="p">);</span>
</code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/roundrobin" term="roundrobin" label="roundrobin" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Actions å’ŒæŠ½è±¡è¯­æ³•æ ‘]]></title>
            <link href="https://ohmyweekly.github.io/notes/2016-05-12-actions-and-ast-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2016-05-12-actions-and-ast-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-13T00:00:00+08:00</published>
            <updated>2021-07-13T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Actions and Ast in Raku</blockquote><p>æœ‰ä¸€æ®µç»“æ„åŒ–çš„æ–‡æœ¬, å†™ä¸€ä¸ª Grammar æ¥è§£æå®ƒï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">name = Animal Facts
author = jnthn

[cat]
desc = The smartest and cutest
cuteness = 100000

[dugong]
desc = The cow of the sea
cuteness = -10

[magpie]
desc = crow; raven; rook; jackdaw; chough; magpie; jay
cuteness = 99
</code></pre></div><p>æ¯ä¸€æ®µéƒ½æ˜¯ä¸€ä¸ªç« èŠ‚, æœ‰çš„ç« èŠ‚æ²¡æœ‰ <code>[cat]</code> è¿™æ ·çš„æ ‡é¢˜, è¦æ±‚ Grammar ç”Ÿæˆä¸€ä¸ªæ•£åˆ—, æ•£åˆ—çš„é”®æ˜¯æ–¹æ‹¬å·ä¸­çš„å•è¯, å¦‚æœæ²¡æœ‰å°±é»˜è®¤ä¸º <code>_</code>, æ•£åˆ—çš„å€¼æ˜¯ä¸€ä¸ªæ•£åˆ—çš„æ•°ç»„, æ•°ç»„é‡Œé¢çš„æ¯ä¸ªæ•£åˆ—çš„é”®ä¸ºç­‰å·å·¦è¾¹çš„å•è¯, é”®å€¼ä¸ºç­‰å·å³è¾¹çš„å­—ç¬¦ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">grammar</span> <span class="nc">INIFile::Grammar</span> <span class="p">{</span>
    <span class="k">token</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="ni">^</span><span class="sr">
</span><span class="sr">        </span><span class="p">&lt;</span><span class="nf">entries</span><span class="p">&gt;</span><span class="sr">     </span><span class="c1"># æ¡ç›®
</span><span class="c1"></span><span class="sr">        </span><span class="p">&lt;</span><span class="nf">section</span><span class="p">&gt;</span><span class="o">+</span><span class="sr">    </span><span class="c1"># ç« èŠ‚
</span><span class="c1"></span><span class="sr">        </span><span class="ni">$</span><span class="sr">
</span><span class="sr">    </span><span class="p">}</span>

    <span class="k">token</span> <span class="nf">section</span> <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="p">&#39;</span><span class="s1">[</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">~</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">]</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">key</span><span class="p">&gt;</span><span class="sr"> </span><span class="se">\n</span><span class="sr">
</span><span class="sr">        </span><span class="p">&lt;</span><span class="nf">entries</span><span class="p">&gt;</span><span class="sr"> </span><span class="c1"># æ¯ä¸ªç« èŠ‚å«æœ‰å¤šä¸ªæ¡ç›® entry
</span><span class="c1"></span><span class="sr">    </span><span class="p">}</span>

    <span class="k">token</span> <span class="nf">entries</span> <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="p">[</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">entry</span><span class="p">&gt;</span><span class="sr"> </span><span class="se">\n</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="se">\n</span><span class="sr"> </span><span class="c1"># entry å¯ä»¥ä¸ºç©º
</span><span class="c1"></span><span class="sr">        </span><span class="p">]</span><span class="o">+</span><span class="sr">
</span><span class="sr">    </span><span class="p">}</span>

    <span class="k">token</span> <span class="nf">entry</span>   <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">key</span><span class="p">&gt;</span><span class="sr"> </span><span class="se">\h</span><span class="o">*</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\h</span><span class="o">*</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">value</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">}</span>
    <span class="k">token</span> <span class="nf">key</span>     <span class="p">{</span><span class="sr"> </span><span class="se">\w</span><span class="o">+</span><span class="sr">                       </span><span class="p">}</span>
    <span class="k">token</span> <span class="nf">value</span>   <span class="p">{</span><span class="sr"> </span><span class="se">\N</span><span class="o">+</span><span class="sr">                       </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">INIFileActions</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">entries</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">%entries</span><span class="p">;</span>
        <span class="k">for</span> <span class="nv">$&lt;entry&gt;</span> <span class="k">-&gt;</span> <span class="nv">$e</span> <span class="p">{</span>
            <span class="nv">%entries</span><span class="p">{</span><span class="nv">$e</span><span class="p">&lt;</span><span class="s">key</span><span class="p">&gt;}</span> <span class="o">:=</span> <span class="o">~</span><span class="nv">$e</span><span class="p">&lt;</span><span class="s">value</span><span class="p">&gt;;</span>
        <span class="p">}</span>
        <span class="k">make</span> <span class="nv">%entries</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">TOP</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">%result</span><span class="p">;</span>
        <span class="nv">%result</span><span class="p">&lt;</span><span class="s">_</span><span class="p">&gt;</span> <span class="o">:=</span> <span class="nv">$&lt;entries&gt;</span><span class="o">.</span><span class="nb">ast</span><span class="p">;</span>
        <span class="k">for</span> <span class="nv">$&lt;section&gt;</span> <span class="k">-&gt;</span> <span class="nv">$sec</span> <span class="p">{</span>
            <span class="nv">%result</span><span class="p">{</span><span class="nv">$sec</span><span class="p">&lt;</span><span class="s">key</span><span class="p">&gt;}</span> <span class="o">:=</span> <span class="nv">$sec</span><span class="p">&lt;</span><span class="s">entries</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">ast</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">make</span> <span class="nv">%result</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$m</span> <span class="o">:=</span> <span class="n">INIFile::Grammar</span><span class="o">.</span><span class="nb">parse</span><span class="p">(</span><span class="k">Q</span><span class="p">{</span><span class="s">
</span><span class="s">name = Animal Facts
</span><span class="s">author = jnthn
</span><span class="s">
</span><span class="s">[cat]
</span><span class="s">desc = The smartest and cutest
</span><span class="s">cuteness = 100000
</span><span class="s">
</span><span class="s">[dugong]
</span><span class="s">desc = The cow of the sea
</span><span class="s">cuteness = -10
</span><span class="s">
</span><span class="s">[magpie]
</span><span class="s">desc = crow; raven; rook; jackdaw; chough; magpie; jay
</span><span class="s">cuteness = 99
</span><span class="s"></span><span class="p">}</span><span class="o">,</span> <span class="p">:</span><span class="s">actions</span><span class="p">(</span><span class="n">INIFileActions</span><span class="p">));</span>

<span class="k">my</span> <span class="nv">%sections</span> <span class="o">:=</span> <span class="nv">$m</span><span class="o">.</span><span class="nb">ast</span><span class="p">;</span>

<span class="k">for</span> <span class="nv">%sections</span> <span class="k">-&gt;</span> <span class="nv">$sec</span> <span class="p">{</span>
    <span class="nb">say</span><span class="p">(&#34;</span><span class="s2">ç« èŠ‚: </span><span class="p">{</span><span class="nv">$sec</span><span class="o">.</span><span class="nb">key</span><span class="p">}&#34;);</span>
    <span class="k">for</span> <span class="nv">$sec</span><span class="o">.</span><span class="nb">value</span> <span class="k">-&gt;</span> <span class="nv">$entry</span> <span class="p">{</span>
        <span class="nb">say</span><span class="p">(&#34;</span><span class="s2">    </span><span class="p">{</span><span class="nv">$entry</span><span class="o">.</span><span class="nb">key</span><span class="p">}</span><span class="s2">: </span><span class="p">{</span><span class="nv">$entry</span><span class="o">.</span><span class="nb">value</span><span class="p">}&#34;);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p><code>make</code> æ˜¯ä¸€ä¸ªå‡½æ•°, æ¥æ”¶å•ä¸ªå‚æ•°, <code>make</code> çš„ä½œç”¨æ˜¯, å¯¹äºæ¯ä¸€ä¸ª <code>method</code> ä¸­å¯¹åº”çš„ <code>$_</code> , å­˜å‚¨ç”Ÿæˆçš„æŠ½è±¡è¯­æ³•æ ‘(AST)(ç‰‡æ®µ)åˆ° <code>$/</code> ä¸­ã€‚<code>.ast</code> ç”¨äºä»å·²ä¿å­˜çš„ AST æŠ½è±¡è¯­æ³•æ ‘ä¸­æ£€ç´¢æå– AST (ç‰‡æ®µ), <code>Â»</code> ç›¸å½“äºä¸€ä¸ªå¾ªç¯, å³æ£€ç´¢æ¯ä¸€ä¸ª <code>$&lt;entry&gt;</code> ä¹‹ç±»çš„è¯­æ³•æ ‘ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">grammar</span> <span class="nc">INIFile::Grammar</span> <span class="p">{</span>
    <span class="k">token</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="ni">^</span><span class="sr">
</span><span class="sr">        </span><span class="p">&lt;</span><span class="nf">section</span><span class="p">&gt;</span><span class="o">+</span><span class="sr">    </span><span class="c1"># ç« èŠ‚
</span><span class="c1"></span><span class="sr">        </span><span class="ni">$</span><span class="sr">
</span><span class="sr">    </span><span class="p">}</span>

    <span class="k">token</span> <span class="nf">section</span> <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="p">[</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">[</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">~</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">]</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">key</span><span class="p">&gt;</span><span class="sr"> </span><span class="se">\n</span><span class="sr"> </span><span class="p">]</span><span class="o">?</span><span class="sr">   </span><span class="c1"># [key] è¿™ä¸€è¡Œæ˜¯å¯é€‰çš„
</span><span class="c1"></span><span class="sr">        </span><span class="p">&lt;</span><span class="nf">entries</span><span class="p">&gt;</span><span class="sr">                 </span><span class="c1"># æ¯ä¸ªç« èŠ‚å«æœ‰å¤šä¸ªæ¡ç›® entry
</span><span class="c1"></span><span class="sr">    </span><span class="p">}</span>

    <span class="k">token</span> <span class="nf">entries</span> <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="p">[</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">entry</span><span class="p">&gt;</span><span class="sr"> </span><span class="se">\n</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="se">\n</span><span class="sr"> </span><span class="c1"># entry å¯ä»¥ä¸ºç©º
</span><span class="c1"></span><span class="sr">        </span><span class="p">]</span><span class="o">+</span><span class="sr">
</span><span class="sr">    </span><span class="p">}</span>

    <span class="k">token</span> <span class="nf">entry</span>   <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">key</span><span class="p">&gt;</span><span class="sr"> </span><span class="se">\h</span><span class="o">*</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\h</span><span class="o">*</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">value</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">}</span>
    <span class="k">token</span> <span class="nf">key</span>     <span class="p">{</span><span class="sr"> </span><span class="se">\w</span><span class="o">+</span><span class="sr">                       </span><span class="p">}</span>
    <span class="k">token</span> <span class="nf">value</span>   <span class="p">{</span><span class="sr"> </span><span class="se">\N</span><span class="o">+</span><span class="sr">                       </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">INIFileActions</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nb">key</span>    <span class="p">(</span><span class="nv">$/</span><span class="p">)</span>  <span class="p">{</span> <span class="nv">$/</span><span class="o">.</span><span class="nb">make</span><span class="o">:</span> <span class="o">~</span><span class="nv">$/</span>                                 <span class="p">}</span>
    <span class="k">method</span> <span class="nb">value</span>  <span class="p">(</span><span class="nv">$/</span><span class="p">)</span>  <span class="p">{</span> <span class="nv">$/</span><span class="o">.</span><span class="nb">make</span><span class="o">:</span> <span class="o">~</span><span class="nv">$/</span>                                 <span class="p">}</span>
    <span class="k">method</span> <span class="nf">entry</span>  <span class="p">(</span><span class="nv">$/</span><span class="p">)</span>  <span class="p">{</span> <span class="nv">$/</span><span class="o">.</span><span class="nb">make</span><span class="o">:</span> <span class="nv">$&lt;key&gt;</span><span class="o">.</span><span class="s">ast</span> <span class="o">=&gt;</span> <span class="nv">$&lt;value&gt;</span><span class="o">.</span><span class="nb">ast</span>          <span class="p">}</span>
    <span class="k">method</span> <span class="nf">entries</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span>  <span class="p">{</span> <span class="nv">$/</span><span class="o">.</span><span class="nb">make</span><span class="o">:</span> <span class="nv">$&lt;entry&gt;</span><span class="o">Â».</span><span class="nb">ast</span>                       <span class="p">}</span>
    <span class="k">method</span> <span class="nf">section</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span>  <span class="p">{</span> <span class="nv">$/</span><span class="o">.</span><span class="nb">make</span><span class="o">:</span> <span class="nv">$&lt;key&gt;</span><span class="o">.</span><span class="nb">ast</span> <span class="o">//</span> <span class="p">&#39;</span><span class="s1">_</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="nv">$&lt;entries&gt;</span><span class="o">.</span><span class="nb">ast</span> <span class="p">}</span> <span class="c1"># å¦‚æœ key ä¸å­˜åœ¨å°±é»˜è®¤ä¸º `_`</span>

    <span class="k">method</span> <span class="nf">TOP</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$/</span><span class="o">.</span><span class="nb">make</span><span class="o">:</span> <span class="nv">$&lt;section&gt;</span><span class="o">Â».</span><span class="nb">ast</span><span class="p">;</span>  <span class="c1"># ç­‰ä»·äº $/.make($&lt;section&gt;Â».ast);</span>
        <span class="c1"># &#39;-&#39; =&gt; $&lt;entries&gt;.ast    # &#39;_&#39; æ²¡æœ‰ ast æ–¹æ³•</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$m</span> <span class="o">=</span> <span class="n">INIFile::Grammar</span><span class="o">.</span><span class="nb">parse</span><span class="p">(</span><span class="k">Q</span><span class="p">{</span><span class="s">
</span><span class="s">name = Animal Facts
</span><span class="s">author = jnthn
</span><span class="s">
</span><span class="s">[cat]
</span><span class="s">desc = The smartest and cutest
</span><span class="s">cuteness = 100000
</span><span class="s">
</span><span class="s">[dugong]
</span><span class="s">desc = The cow of the sea
</span><span class="s">cuteness = -10
</span><span class="s">
</span><span class="s">[magpie]
</span><span class="s">desc = crow; raven; rook; jackdaw; chough; magpie; jay
</span><span class="s">cuteness = 99
</span><span class="s"></span><span class="p">}</span><span class="o">,</span> <span class="p">:</span><span class="s">actions</span><span class="p">(</span><span class="n">INIFileActions</span><span class="p">))</span><span class="o">.</span><span class="nb">ast</span><span class="p">;</span>

<span class="k">for</span> <span class="nv">@$m</span> <span class="k">-&gt;</span> <span class="nv">$sec</span> <span class="p">{</span>
    <span class="nb">say</span><span class="p">(&#34;</span><span class="s2">ç« èŠ‚: </span><span class="p">{</span><span class="nv">$sec</span><span class="o">.</span><span class="nb">key</span><span class="p">}&#34;);</span>

    <span class="k">for</span> <span class="nv">$sec</span><span class="o">.</span><span class="nb">value</span> <span class="k">-&gt;</span> <span class="nv">$entry</span> <span class="p">{</span>
        <span class="nb">say</span><span class="p">(&#34;</span><span class="s2">    </span><span class="p">{</span><span class="nv">$entry</span><span class="o">.</span><span class="nb">key</span><span class="p">}</span><span class="s2">: </span><span class="p">{</span><span class="nv">$entry</span><span class="o">.</span><span class="nb">value</span><span class="p">}&#34;);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>Grammar çš„è§£ææ˜¯ä»ä¸Šè‡³ä¸‹çš„, ä» top-level (<code>TOP</code>) å¼€å§‹, åˆ°åˆ†æ”¯(branch)ã€‚Actions ä¸­çš„æ–¹æ³•æ˜¯éšç€è§£æè€Œæ‰§è¡Œçš„, ä½†æ˜¯æŠ½è±¡è¯­æ³•æ ‘(AST) çš„å­˜å‚¨å’Œæ£€ç´¢æ˜¯è‡ªä¸‹è€Œä¸Šçš„, åªæœ‰åº•éƒ¨çš„å­˜å‚¨å®Œäº†, å…¶ä¸Šå±‚éƒ¨åˆ†æ‰å¯ä»¥ä½¿ç”¨ <code>.ast</code> æˆ– <code>.made</code> æ–¹æ³•è¿›è¡Œæ£€ç´¢, æ£€ç´¢åˆ°ä¹‹åå„è‡ªè¿›è¡Œå¤„ç†åå†æ¬¡å­˜å‚¨, ä»¥ä¾›å®ƒçš„ä¸Šå±‚éƒ¨åˆ†ä½¿ç”¨, ä»¥æ­¤ç±»æ¨ã€‚</p>
<p>æ³¨æ„, ç¬¬ä¸€æ®µä»£ç ä¸­ <code>$m</code> å­˜å‚¨çš„æ­»æ•£åˆ—, è€Œç¬¬äºŒæ®µä»£ç ä¸­, <code>$m</code> å­˜å‚¨çš„æ˜¯æ•°ç»„! è¿™è¯´æ˜å¯ä»¥è¿”å›æ•£åˆ—å’Œæ•°ç»„ä¸¤ç§å½¢å¼ã€‚</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/actions" term="actions" label="actions" />
                             
                                <category scheme="https://ohmyweekly.github.io/tags/ast" term="ast" label="ast" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä¸­çš„ Subscripts]]></title>
            <link href="https://ohmyweekly.github.io/notes/2016-06-01-accessing-data-structure-elements-by-index-or-key/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2016-06-01-accessing-data-structure-elements-by-index-or-key/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-13T00:00:00+08:00</published>
            <updated>2021-07-13T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Accessing Data Structure Elements by Index or Key</blockquote><h1 id="subscriptshttpsdocsrakuorglanguagesubscripts"><a href="https://docs.raku.org/language/subscripts">Subscripts</a></h1>
<p>é€šè¿‡ç´¢å¼•æˆ–é”®è®¿é—®æ•°æ®ç»“æ„ä¸­çš„å…ƒç´ ã€‚</p>
<p>é€šå¸¸, äººä»¬éœ€è¦å¼•ç”¨é›†åˆæˆ–æ•°æ®ç»“æ„ä¸­çš„ä¸€ä¸ªç‰¹å®šçš„å…ƒç´ (æˆ–ç‰¹å®šçš„å…ƒç´ åˆ‡ç‰‡)ã€‚ä»æ•°å­¦æ ‡è®°æ³•ä¸­å·å­¦åˆ°çš„, å‘é‡ <code>v</code> çš„ç»„æˆéƒ¨åˆ†ç”¨ <em>vâ‚, vâ‚‚, vâ‚ƒ</em> æ¥å¼•ç”¨, åœ¨ Raku ä¸­è¿™ä¸ªæ¦‚å¿µå«åš â€œä¸‹æ ‡â€ (æˆ–â€œç´¢å¼•â€)ã€‚</p>
<h1 id="basics">Basics</h1>
<p>Raku æä¾›äº†ä¸¤ä¸ªé€šç”¨çš„ä¸‹æ ‡æ¥å£ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left">elements are identified by</th>
<th style="text-align:left">interface name</th>
<th style="text-align:left">supported by</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">[ ]</td>
<td style="text-align:left">zero-based indices</td>
<td style="text-align:left">Positional</td>
<td style="text-align:left">Array, List, Buf, Match, &hellip;</td>
</tr>
<tr>
<td style="text-align:left">{ }</td>
<td style="text-align:left">string or object keys</td>
<td style="text-align:left">Associative</td>
<td style="text-align:left">Hash, Bag, Mix, Match, &hellip;</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>Positional</strong> ä¸‹æ ‡ (é€šè¿‡ <a href="http://doc.raku.org/language/operators#postcircumfix_%5B_%5D">postcircumfix <input disabled="" type="checkbox"> </a> é€šè¿‡å…ƒç´ åœ¨æœ‰åºé›†åˆä¸­çš„ä½ç½®æ¥å¯»å€å…ƒç´ ã€‚)ç´¢å¼• 0 å¼•ç”¨ç¬¬ä¸€ä¸ªå…ƒç´ , ç´¢å¼• 1 å¼•ç”¨ç¬¬äºŒä¸ªå…ƒç´ , ä»¥æ­¤ç±»æ¨ï¼š</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@chores</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">buy groceries</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">feed dog</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">wash car</span><span class="p">&#34;;</span>

<span class="nb">say</span> <span class="nv">@chores</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>  <span class="c1"># buy groceries</span>
<span class="nb">say</span> <span class="nv">@chores</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>  <span class="c1"># feed dog</span>
<span class="nb">say</span> <span class="nv">@chores</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span>  <span class="c1"># wash car</span>
</code></pre></div><ul>
<li><strong>Associative</strong> ä¸‹æ ‡ (é€šè¿‡ <a href="http://doc.raku.org/language/operators#postcircumfix_%7B_%7D">postcircumfix { }</a>), ä¸è¦æ±‚é›†åˆä»¥ä»»ä½•ç‰¹å®šçš„é¡ºåºä¿å­˜å…ƒç´  - ç›¸å, å®ƒä½¿ç”¨ä¸€ä¸ªå”¯ä¸€çš„é”®æ¥å¯»å€æ¯ä¸ªå€¼ã€‚é”®çš„ç§ç±»å–å†³äºä½¿ç”¨çš„é›†åˆï¼š ä¸¾ä¸ªä¾‹å­, ä¸€ä¸ªæ ‡å‡†çš„<a href="http://doc.raku.org/type/Hash">æ•£åˆ—</a> ä½¿ç”¨å­—ç¬¦ä¸²ä½œä¸ºé”®, è€Œä¸€ä¸ª <a href="http://doc.raku.org/type/Mix">Mix</a> èƒ½ä½¿ç”¨ä»»æ„çš„å¯¹è±¡ä½œä¸ºé”®, ç­‰ç­‰:</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%grade</span> <span class="o">=</span> <span class="s">Zoe</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">C</span><span class="p">&#34;</span>, <span class="s">Ben</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">B+</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="nv">%grade</span><span class="p">{&#34;</span><span class="s2">Zoe</span><span class="p">&#34;};</span>  <span class="c1"># C</span>
<span class="nb">say</span> <span class="nv">%grade</span><span class="p">{&#34;</span><span class="s2">Ben</span><span class="p">&#34;};</span>  <span class="c1"># B+</span>

<span class="k">my</span> <span class="nv">$stats</span> <span class="o">=</span> <span class="p">(</span> <span class="nb">Date</span><span class="o">.</span><span class="s">today</span> <span class="o">=&gt;</span> <span class="mf">4.18</span>, <span class="nb">Date</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="mi">2015</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="mf">17.253</span> <span class="p">)</span><span class="o">.</span><span class="nb">Mix</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$stats</span><span class="p">{</span> <span class="nb">Date</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="mi">2015</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="p">)</span> <span class="p">};</span>  <span class="c1"># 17.253</span>
</code></pre></div><p>ç›¸å¯¹äºä¼ é€’å•ä¸ª-å•è¯å­—ç¬¦ä¸²é”®ç»™ <code>{ }</code>, ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨<a href="http://doc.raku.org/language/quoting#Word_quoting:_qw">ä»¥å°–æ‹¬å·å¼•èµ·å•è¯çš„ç»“æ„</a>, å°±åƒå®ƒä»¬æ˜¯åç¼€æ“ä½œç¬¦ä¸€æ ·ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nv">%grade</span><span class="p">&lt;</span><span class="s">Zoe</span><span class="p">&gt;;</span>    <span class="c1"># C</span>
<span class="nb">say</span> <span class="nv">%grade</span><span class="p">&lt;</span><span class="s">Ben</span><span class="p">&gt;;</span>    <span class="c1"># B+</span>
</code></pre></div><p>è¿™å®é™…ä¸Šä»…ä»…æ˜¯åœ¨ç¼–è¯‘æ—¶è¢«è½¬æ¢ä¸ºå¯¹åº” <code>{ }</code> å½¢å¼çš„è¯­æ³•ç³–ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">%hash</span><span class="p">&lt;</span><span class="s">foo bar</span><span class="p">&gt;;</span>     <span class="c1"># same as %hash{ &lt;foo bar&gt; }</span>
<span class="nv">%hash</span><span class="p">Â«</span><span class="s2">foo </span><span class="nv">$var</span><span class="p">Â»;</span>    <span class="c1"># same as %hash{ Â«foo $varÂ» }</span>
<span class="nv">%hash</span><span class="p">&lt;&lt;</span><span class="s2">foo </span><span class="nv">$var</span><span class="p">&gt;&gt;;</span>  <span class="c1"># same as %hash{ &lt;&lt;foo $var&gt;&gt; }</span>
</code></pre></div><p>ä¸‹æ ‡èƒ½åº”ç”¨åˆ°èƒ½è¿”å›å¯ä¸‹æ ‡åŒ–å¯¹è±¡çš„ä»»ä½•è¡¨è¾¾å¼ä¸Š, è€Œä¸ä»…ä»…åº”ç”¨åˆ°å˜é‡ä¸Šï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">__Hello__</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">match</span><span class="p">(/</span><span class="sr">__</span><span class="p">(</span><span class="ni">.</span><span class="o">*</span><span class="p">)</span><span class="sr">__</span><span class="p">/)</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>   <span class="c1"># ï½¢Helloï½£</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">__Hello__</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">match</span><span class="p">(/</span><span class="sr">__</span><span class="p">(</span><span class="ni">.</span><span class="o">*</span><span class="p">)</span><span class="sr">__</span><span class="p">/)</span><span class="o">.[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>  <span class="c1"># same, in method notation</span>
</code></pre></div><p>Positional å’Œ associative ä¸‹æ ‡å¹¶ä¸äº’ç›¸æ’æ–¥ - ä¸¾ä¸ªä¾‹å­, <code>Match</code> å¯¹è±¡ä¸¤ä¸ªéƒ½æ”¯æŒ(æ¯ä¸ªè®¿é—®ä¸åŒçš„æ•°æ®é›†)ã€‚è¿˜æœ‰, ä¸ºäº†è®©åˆ—è¡¨å¤„ç†æ›´æ–¹ä¾¿, ç±» <code>Any</code> ä¸ºä½ç½®ä¸‹æ ‡æä¾›äº†å¤‡ç”¨çš„å®ç°, è¿™ä¼šæŠŠè°ƒç”¨è€…çœ‹ä½œå«æœ‰ä¸€ä¸ªå…ƒç´ çš„åˆ—è¡¨ã€‚(ä½†æ˜¯å¯¹äºå…³ç³»ä¸‹æ ‡, æ²¡æœ‰è¿™æ ·çš„å¤‡ç”¨å®ç°, æ‰€ä»¥ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸, å½“ä¸‹æ ‡è¢«åº”ç”¨åˆ°æ²¡æœ‰å®ç°æ”¯æŒçš„å¯¹è±¡ä¸Šæ—¶ã€‚)</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="mi">42</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>    <span class="c1"># 42</span>
<span class="nb">say</span> <span class="mi">42</span><span class="o">&lt;</span><span class="n">foo</span><span class="o">&gt;</span><span class="p">;</span>  <span class="c1"># ERROR: postcircumfix { } not defined for type Int</span>
</code></pre></div><h1 id="nonexistent-elements">Nonexistent elements</h1>
<p>å½“é€šè¿‡ä¸‹æ ‡å¯»å€ä¸€ä¸ªä¸å­˜åœ¨çš„å…ƒç´ æ‰€å‘ç”Ÿçš„äº‹æƒ…å–å†³äºæ­£åœ¨ä½¿ç”¨çš„é›†åˆç±»å‹ã€‚æ ‡å‡†çš„ Array å’Œ Hash é›†åˆè¿”å›å®ƒä»¬çš„<a href="http://doc.raku.org/routine/of">value type constraint</a>  çš„ç±»å‹å¯¹è±¡(è¿™é»˜è®¤æ˜¯ <code>Any</code>)ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@array1</span><span class="p">;</span>     <span class="nb">say</span> <span class="nv">@array1</span><span class="o">[</span><span class="mi">10</span><span class="o">]</span><span class="p">;</span>  <span class="c1"># (Any)</span>
<span class="k">my</span> <span class="nb">Int</span> <span class="nv">@array2</span><span class="p">;</span> <span class="nb">say</span> <span class="nv">@array2</span><span class="o">[</span><span class="mi">10</span><span class="o">]</span><span class="p">;</span>  <span class="c1"># (Int)</span>

<span class="k">my</span> <span class="nv">%hash1</span><span class="p">;</span>      <span class="nb">say</span> <span class="nv">%hash1</span><span class="o">&lt;</span><span class="n">foo</span><span class="o">&gt;</span><span class="p">;</span>  <span class="c1"># (Any)</span>
<span class="k">my</span> <span class="nb">Int</span> <span class="nv">%hash2</span><span class="p">;</span>  <span class="nb">say</span> <span class="nv">%hash2</span><span class="o">&lt;</span><span class="n">foo</span><span class="o">&gt;</span><span class="p">;</span>  <span class="c1"># (Int)</span>
</code></pre></div><p>ç„¶è€Œ, å…¶å®ƒç±»å‹çš„é›†åˆå¯èƒ½åœ¨å¯»å€ä¸å­˜åœ¨çš„å…ƒç´ çš„ä¸‹æ ‡æ—¶ååº”ä¹Ÿä¸ç”¨ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">20</span><span class="p">)</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="p">;</span>       <span class="c1"># Nil</span>
<span class="nb">say</span> <span class="nb">bag</span><span class="p">(&lt;</span><span class="s">a a b b b</span><span class="p">&gt;)&lt;</span><span class="s">c</span><span class="p">&gt;;</span>  <span class="c1"># 0</span>
</code></pre></div><p>ä¸ºäº†åœ¨ä¸‹æ ‡æ“ä½œä¸­é»˜é»˜åœ°è·³è¿‡ä¸å­˜åœ¨çš„å…ƒç´ , æŸ¥çœ‹ <a href="http://doc.raku.org/language/subscripts#Truncating_slices">#Truncating slices</a>  å’Œ <a href="http://doc.raku.org/language/subscripts#%3Av"><code>#:v</code></a> å‰¯è¯ã€‚</p>
<h1 id="from-the-end">From the end</h1>
<p>Positional ç´¢å¼•æ˜¯ä»é›†åˆçš„å¼€å¤´è®¡æ•°çš„, ä½†æ˜¯ä¹Ÿæœ‰ä¸€ç§æ ‡è®°æ³•ç”¨äº, é€šè¿‡ç›¸å¯¹äºæœ«å°¾çš„ä½ç½®æ¥å¯»å€å…ƒç´ ï¼š<code>*-1</code> å¼•ç”¨æœ€åä¸€ä¸ªå…ƒç´ , <code>*-2</code> å¼•ç”¨å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ , ä»¥æ­¤ç±»æ¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@alphabet</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">A</span><span class="p">&#39;</span> <span class="o">..</span> <span class="p">&#39;</span><span class="s1">Z</span><span class="p">&#39;;</span>
<span class="nb">say</span> <span class="nv">@alphabet</span><span class="o">[*-</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>  <span class="c1"># Z</span>
<span class="nb">say</span> <span class="nv">@alphabet</span><span class="o">[*-</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span>  <span class="c1"># Y</span>
<span class="nb">say</span> <span class="nv">@alphabet</span><span class="o">[*-</span><span class="mi">3</span><span class="o">]</span><span class="p">;</span>  <span class="c1"># X</span>
</code></pre></div><p>æ³¨æ„ï¼šæ˜Ÿå·å¾ˆé‡è¦ã€‚åœ¨ Raku ä¸­, å¦‚æœåƒåœ¨å¾ˆå¤šå…¶å®ƒç¼–ç¨‹è¯­è¨€ä¸­é‚£æ ·ä¼ é€’ä¸€ä¸ªè£¸çš„è´Ÿæ•´æ•°(ä¾‹å¦‚ <code>@alphabet[-1]</code>), ä¼šæŠ›å‡ºé”™è¯¯ã€‚</p>
<p>è¿™é‡Œå®é™…å‘ç”Ÿçš„æ˜¯, <code>*-1</code> é‚£æ ·çš„è¡¨è¾¾å¼é€šè¿‡ <a href="http://doc.raku.org/type/Whatever">Whatever</a> æŸ¯é‡ŒåŒ–å£°æ˜äº†ä¸€ä¸ªä»£ç å¯¹è±¡ - <code>[ ]</code> ä¼šæŠŠä»£ç å¯¹è±¡ä½œä¸ºç´¢å¼•, é€šè¿‡é›†åˆçš„é•¿åº¦ä½œä¸ºå‚æ•°æ¥è°ƒç”¨å®ƒå¹¶ä½¿ç”¨ç»“æœå€¼ä½œä¸ºå®é™…çš„ç´¢å¼•ã€‚æ¢å¥è¯è¯´, <code>@alphabet[*-1]</code> å˜æˆäº† <code>@alphabet[@alphabet.elems - 1]</code>ã€‚</p>
<p>è¿™æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•ä¾èµ–äºé›†åˆå°ºå¯¸çš„è¡¨è¾¾å¼ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nv">@array</span><span class="o">[*</span> <span class="ow">div</span> <span class="mi">2</span><span class="o">]</span><span class="p">;</span>  <span class="c1"># é€‰æ‹©æœ€ä¸­é—´çš„é‚£ä¸ªå…ƒç´ </span>
<span class="nb">say</span> <span class="nv">@array</span><span class="o">[</span><span class="nv">$i</span> <span class="nv">%</span> <span class="o">*]</span><span class="p">;</span>   <span class="c1"># wrap around a given index (&#34;æ¨¡è¿ç®—&#34;)</span>
<span class="nb">say</span> <span class="nv">@array</span><span class="o">[</span> <span class="k">-&gt;</span> <span class="nv">$size</span> <span class="p">{</span> <span class="nv">$i</span> <span class="nv">%</span> <span class="nv">$size</span> <span class="p">}</span> <span class="o">]</span><span class="p">;</span>  <span class="c1"># same as previous</span>
</code></pre></div><h1 id="slices">Slices</h1>
<p>å½“éœ€è¦è®¿é—®é›†åˆä¸­çš„å¤šä¸ªå…ƒç´ æ—¶, æœ‰ä¸€ä¸ªå¿«æ·æ–¹å¼ç”¨äºå¤„ç†å¤šä¸ªå•ç‹¬çš„ä¸‹æ ‡æ“ä½œï¼šä»…ä»…åœ¨ä¸‹æ ‡ä¸­æŒ‡å®šä¸€ä¸ªç´¢å¼•/é”®çš„åˆ—è¡¨, æ¥å–å›ä¸€ä¸ªå…ƒç´ çš„åˆ—è¡¨ - ä¹Ÿè¢«å«åš&quot;åˆ‡ç‰‡&quot; - ä»¥ç›¸åŒçš„é¡ºåºã€‚</p>
<p>å¯¹äº positional åˆ‡ç‰‡, ä½ å¯ä»¥æ··åˆæ™®é€šåˆ‡ç‰‡å’Œ <a href="http://doc.raku.org/language/subscripts#From_the_end">from-the-end</a> åˆ‡ç‰‡ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@alphabet</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;</span> <span class="o">..</span> <span class="p">&#39;</span><span class="s1">z</span><span class="p">&#39;;</span>
<span class="n">dd</span> <span class="nv">@alphabet</span><span class="o">[</span><span class="mi">15</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="o">*-</span><span class="mi">9</span><span class="o">,</span> <span class="mi">11</span><span class="o">]</span><span class="p">;</span>  <span class="c1"># (&#34;p&#34;, &#34;e&#34;, &#34;r&#34;, &#34;l&#34;)</span>
</code></pre></div><p>å¯¹äº associative åˆ‡ç‰‡, å°–æ‹¬å·å½¢å¼çš„åˆ‡ç‰‡é€šå¸¸ä¼šå¾ˆæ–¹ä¾¿ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%color</span> <span class="o">=</span> <span class="s">kiwi</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">green</span><span class="p">&#34;</span>, <span class="s">banana</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">yellow</span><span class="p">&#34;</span>, <span class="s">cherry</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">red</span><span class="p">&#34;;</span>

<span class="n">dd</span> <span class="nv">%color</span><span class="p">{&#34;</span><span class="s2">cherry</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">kiwi</span><span class="p">&#34;};</span>  <span class="c1"># (&#34;red&#34;, &#34;green&#34;)</span>
<span class="n">dd</span> <span class="nv">%color</span><span class="p">&lt;</span><span class="s">cherry kiwi</span><span class="p">&gt;;</span>       <span class="c1"># (&#34;red&#34;, &#34;green&#34;)</span>
<span class="n">dd</span> <span class="nv">%color</span><span class="p">{</span><span class="o">*</span><span class="p">};</span>                 <span class="c1"># (&#34;green&#34;, &#34;red&#34;, &#34;yellow&#34;)</span>
</code></pre></div><p>è¦çŸ¥é“åˆ‡ç‰‡æ˜¯ç”±ä¼ å…¥ (<a href="http://doc.raku.org/language/subscripts#Multiple_dimensions">one dimension of</a>)ä¸‹æ ‡çš„ç±»å‹æ§åˆ¶çš„, è€Œéå®ƒçš„é•¿åº¦ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">subscript</th>
<th style="text-align:left">result</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">any Positional object not covered below</td>
<td style="text-align:left">normal slice</td>
</tr>
<tr>
<td style="text-align:left">a Range or infinite sequence</td>
<td style="text-align:left">truncating slice (only for positional subscripts)</td>
</tr>
<tr>
<td style="text-align:left">* (Whatever-star)</td>
<td style="text-align:left">full slice (as if all keys/indices were specified)</td>
</tr>
<tr>
<td style="text-align:left">any other object</td>
<td style="text-align:left">single-element access rather than a slice</td>
</tr>
<tr>
<td style="text-align:left">empty</td>
<td style="text-align:left">Zen slice</td>
</tr>
</tbody>
</table>
<p>æ‰€ä»¥, å³ä½¿ä¸€ä¸ªå•ä¸ªå…ƒç´ çš„åˆ—è¡¨ä¹Ÿä¼šè¿”å›ä¸€ä¸ªåˆ‡ç‰‡, è€Œä¸€ä¸ªè£¸çš„æ ‡é‡å€¼ä¸ä¼šï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="n">dd</span> <span class="nv">@alphabet</span><span class="o">[</span><span class="mi">2</span><span class="o">,]</span><span class="p">;</span>  <span class="c1"># (&#34;c&#34;,)</span>
<span class="n">dd</span> <span class="nv">@alphabet</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span>   <span class="c1"># &#34;c&#34;</span>
</code></pre></div><p>(å°–æ‹¬å·å½¢å¼çš„ associative ä¸‹æ ‡ä¹Ÿæ²¡æœ‰é—®é¢˜, å› ä¸º <a href="http://doc.raku.org/language/quoting#Word_quoting:_qw">word quoting</a> åœ¨å•ä¸ªå•è¯çš„æƒ…å†µä¸‹å¾ˆæ–¹ä¾¿çš„è¿”å›ä¸€ä¸ª Strã€‚</p>
<p>å¯¹äºæ™®é€šçš„åˆ‡ç‰‡, ä¸‹æ ‡çš„å†…å®¹ (<a href="http://doc.raku.org/language/subscripts#Multiple_dimensions">the current dimension of</a>) åœ¨å®ƒçš„å…ƒç´ è¢«è§£é‡Šä¸ºç´¢å¼•/é”®ä¹‹å‰ä¼šè¢«å±•å¹³(flattened)ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="n">dd</span> <span class="nv">@alphabet</span><span class="o">[</span><span class="mi">0</span><span class="o">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">2</span><span class="o">,</span> <span class="p">(</span><span class="mi">3</span><span class="o">,</span><span class="p">)))</span><span class="o">]</span><span class="p">;</span>  <span class="c1"># (&#34;a&#34;, &#34;b&#34;, &#34;c&#34;, &#34;d&#34;)</span>
</code></pre></div><h2 id="truncating-slices">Truncating slices</h2>
<p>é€šå¸¸, åœ¨åˆ‡ç‰‡ä¸‹æ ‡ä¸­å¼•ç”¨ä¸å­˜åœ¨çš„å…ƒç´ ä¼šè®©è¾“å‡ºåˆ—è¡¨åŒ…å«æœªå®šä¹‰çš„å€¼ã€‚ç„¶è€Œ, å¦‚æœä¼ é€’ç»™ä½ç½®ä¸‹æ ‡çš„å¯¹è±¡æ˜¯ä¸€ä¸ª Range æˆ–ä½¿ç”¨åºåˆ—æ“ä½œç¬¦æ„å»ºçš„æ— é™åºåˆ—, å®ƒä¼šè¢«è‡ªåŠ¨æˆªæ–­åˆ°é›†åˆçš„å®é™…å°ºå¯¸ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@letters</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">a b c d e f</span><span class="p">&gt;;</span>
<span class="n">dd</span> <span class="nv">@letters</span><span class="o">[</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">7</span><span class="o">]</span><span class="p">;</span>  <span class="c1"># (&#34;d&#34;, &#34;e&#34;, &#34;f&#34;, Any, Any)</span>
<span class="n">dd</span> <span class="nv">@letters</span><span class="o">[</span><span class="mi">3</span> <span class="o">..</span> <span class="mi">7</span><span class="o">]</span><span class="p">;</span>         <span class="c1"># (&#34;d&#34;, &#34;e&#34;, &#34;f&#34;)</span>
</code></pre></div><p><a href="http://doc.raku.org/language/subscripts#From_the_end">From-the-end</a> ç´¢å¼•è¢«å…è®¸ä½œä¸ºèŒƒå›´çš„ç«¯ç‚¹, ä»£è¡¨æ— é™çš„èŒƒå›´å’Œåºåˆ—ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nv">@array</span><span class="o">[*-</span><span class="mi">3</span> <span class="o">..</span> <span class="o">*]</span><span class="p">;</span>       <span class="c1"># select the last three elements</span>
<span class="nb">say</span> <span class="nv">@array</span><span class="o">[</span><span class="mi">0</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">4</span> <span class="o">...</span> <span class="o">*]</span><span class="p">;</span>  <span class="c1"># select all elements with even indices</span>
</code></pre></div><p>å¦‚æœä½ ä¸æƒ³æŠŠä½ çš„åˆ‡ç‰‡æŒ‡å®šä¸º <code>range/sequence</code> ä½†ä»æ—§æƒ³é»˜é»˜åœ°è·³è¿‡ä¸å­˜åœ¨çš„å…ƒç´ , ä½ å¯ä»¥ä½¿ç”¨ <a href="http://doc.raku.org/language/subscripts#%3Av">#:v</a> å‰¯è¯ã€‚</p>
<h2 id="zen-slices">Zen slices</h2>
<p>å¦‚æœä½ å†™çš„ä¸‹æ ‡æ²¡æœ‰æŒ‡å®šä»»ä½•ç´¢å¼•/é”®, é‚£å®ƒå°±ä¼šè¿”å›è¢«è„šæ³¨çš„å¯¹è±¡è‡ªèº«ã€‚å› ä¸ºå®ƒæ˜¯ç©ºçš„ä½†æ˜¯è¿”å›äº†å…¨éƒ¨ä¸œè¥¿, è¿™å°±æ˜¯æ‰€è°“çš„ &ldquo;Zen slice&rdquo;ã€‚</p>
<p>è¿™å’Œä¼ é€’ä¸€ä¸ª Whatever-star, è¿˜æœ‰ä¼ é€’ä¸€ä¸ªç©ºçš„åˆ—è¡¨éƒ½ä¸åŒ(å®ƒè¿”å›ä¸€ä¸ªç©ºçš„åˆ‡ç‰‡)ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%bag</span> <span class="o">:=</span> <span class="p">(&#34;</span><span class="s2">orange</span><span class="p">&#34;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">apple</span><span class="p">&#34;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="nb">Bag</span><span class="p">;</span>
<span class="n">dd</span> <span class="nv">%bag</span><span class="o">&lt;&gt;</span><span class="p">;</span>    <span class="c1"># (&#34;orange&#34;=&gt;1,&#34;apple&#34;=&gt;3).Bag</span>
<span class="n">dd</span> <span class="nv">%bag</span><span class="p">{};</span>    <span class="c1"># (&#34;orange&#34;=&gt;1,&#34;apple&#34;=&gt;3).Bag</span>
<span class="n">dd</span> <span class="nv">%bag</span><span class="p">{</span><span class="o">*</span><span class="p">};</span>   <span class="c1"># (1, 3)</span>
<span class="n">dd</span> <span class="nv">%bag</span><span class="p">{()};</span>  <span class="c1"># ()</span>
</code></pre></div><p>è¿™é€šå¸¸è¢«ç”¨äºæŠŠæ•´ä¸ªæ•°ç»„/æ•£åˆ—æ’å€¼åˆ°å­—ç¬¦ä¸²ä¸­ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@words</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">cruel</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">world</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hello, </span><span class="nv">@words</span><span class="o">[]</span><span class="s2">!</span><span class="p">&#34;</span>  <span class="c1"># Hello, cruel world!</span>
</code></pre></div><h1 id="autovivification">Autovivification</h1>
<p>ä¸‹æ ‡å‚ä¸ &ldquo;autovivification&rdquo;, è¿™æ˜¯ä¸€ç§æ•°ç»„å’Œæ•£åˆ—åœ¨éœ€è¦æ—¶ä¼šè‡ªåŠ¨å­˜åœ¨çš„å¤„ç†, ä»¥è‡³äºä½ æ²¡æœ‰å¿…è¦åœ¨æ¯ä¸€å±‚çº§é¢„å£°æ˜é›†åˆçš„ç±»å‹æ¥æ„å»ºåµŒå¥—çš„æ•°æ®ç»“æ„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$beatles</span><span class="p">;</span>
<span class="nv">$beatles</span><span class="p">{&#34;</span><span class="s2">White Album</span><span class="p">&#34;}</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">Back in the U.S.S.R.</span><span class="p">&#34;;</span>  <span class="c1"># autovivification!</span>
<span class="nb">say</span> <span class="nv">$beatles</span><span class="o">.</span><span class="nb">perl</span><span class="p">;</span>  <span class="c1"># {&#34;White Album&#34; =&gt; [&#34;Back in the U.S.S.R.&#34;]}</span>
</code></pre></div><p><code>$beatles</code> ä»æœªå®šä¹‰å¼€å§‹, ä½†æ˜¯å®ƒå˜æˆäº†ä¸€ä¸ª Hash å¯¹è±¡, å› ä¸ºå®ƒåœ¨èµ‹å€¼æ—¶ç”¨ <code>{ }</code> æ ‡æ³¨äº†ã€‚ç±»ä¼¼åœ°, <code>$beatles{&quot;White Albumâ€}</code> å˜æˆä¸€ä¸ª Array å¯¹è±¡, å› ä¸ºå®ƒåœ¨èµ‹å€¼æ—¶ç”¨ <code>[ ]</code> æ ‡æ³¨äº†ã€‚</p>
<p>æ³¨æ„ä¸‹æ ‡æœ¬èº«ä¸ä¼šå¼•èµ· autovivification, å®ƒåªå‘ç”Ÿåœ¨ä¸‹æ ‡é“¾çš„ç»“æœè¢«èµ‹å€¼æ—¶(æˆ–å˜åŒ–æ—¶)ã€‚</p>
<h1 id="binding">Binding</h1>
<p>ä¸‹æ ‡è¡¨è¾¾å¼ä¹Ÿå¯ä»¥ç”¨åœ¨ç»‘å®šè¯­å¥çš„å·¦ä¾§ã€‚å¦‚æœè¢«æ ‡æ³¨çš„é›†åˆçš„ç±»å‹æ”¯æŒ, è¿™ä¼šä½¿ç”¨æŒ‡å®šçš„å®¹å™¨æ›¿æ¢é›†åˆé‡Œçš„æ’æ§½çš„å€¼:</p>
<p>å†…ç½®çš„ Array å’Œ Hash ç±»å‹æ”¯æŒè¿™ç§ç»‘å®š, ä¸ºäº†å…è®¸æ„å»ºå¤æ‚çš„è”åŠ¨çš„æ•°æ®ç»“æ„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@a</span> <span class="o">=</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">11</span><span class="o">,</span> <span class="mi">12</span><span class="o">,</span> <span class="mi">13</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$x</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="nv">@a</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="o">:=</span> <span class="nv">$x</span><span class="p">;</span>  <span class="c1"># binding! (@a[2] and $x refer to the same container now.)</span>

<span class="nv">$x</span><span class="o">++</span><span class="p">;</span> <span class="nv">@a</span><span class="o">[</span><span class="mi">2</span><span class="o">]++</span><span class="p">;</span>

<span class="n">dd</span> <span class="nv">@a</span><span class="p">;</span>  <span class="c1"># [10, 11, 3, 13]&lt;&gt;</span>
<span class="n">dd</span> <span class="nv">$x</span><span class="p">;</span>  <span class="c1"># 3</span>
</code></pre></div><p>æŸ¥çœ‹ <a href="http://doc.raku.org/language/subscripts#method_BIND-POS">#method BIND-POS</a> å’Œ <a href="http://doc.raku.org/language/subscripts#method_BIND-KEY">#method BIND-KEY</a> äº†è§£åº•å±‚æœºåˆ¶.</p>
<h1 id="adverbs">Adverbs</h1>
<p>ä¸‹æ ‡æ“ä½œçš„è¿”å›å€¼å’Œå¯èƒ½å­˜åœ¨çš„å‰¯ä½œç”¨èƒ½å¤Ÿä½¿ç”¨å‰¯è¯æ¥æ§åˆ¶ã€‚</p>
<p>è¦çŸ¥é“å‰¯è¯æ“ä½œç¬¦çš„ä¼˜å…ˆçº§ç›¸å¯¹å®½æ¾, è¿™å¯èƒ½éœ€è¦ä½ åœ¨åˆæˆè¡¨è¾¾å¼ä¸­æ·»åŠ æ‹¬å·ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="nv">$foo</span> <span class="o">||</span> <span class="nv">%hash</span><span class="p">&lt;</span><span class="s">key</span><span class="p">&gt;:</span><span class="s">exists</span> <span class="p">{</span> <span class="o">...</span> <span class="p">};</span>    <span class="c1"># WRONG, tries to adverb the || op</span>
<span class="k">if</span> <span class="nv">$foo</span> <span class="o">||</span> <span class="p">(</span><span class="nv">%hash</span><span class="p">&lt;</span><span class="s">key</span><span class="p">&gt;:</span><span class="s">exists</span><span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">};</span>  <span class="c1"># correct</span>
</code></pre></div><p>æ”¯æŒçš„å‰¯è¯æœ‰:</p>
<h2 id="exists">:exists</h2>
<p>è¿”å›è¯·æ±‚çš„å…ƒç´ æ˜¯å¦å­˜åœ¨, è€Œä¸æ˜¯è¿”å›å…ƒç´ å®é™…çš„å€¼ã€‚è¿™èƒ½å¤Ÿç”¨äºåŒºåˆ«æœªå®šä¹‰å€¼çš„å…ƒç´ å’Œä¸€ç‚¹å„¿ä¹Ÿä¸å±äºé›†åˆéƒ¨åˆ†çš„å…ƒç´ ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@foo</span> <span class="o">=</span> <span class="nb">Any</span><span class="o">,</span> <span class="mi">10</span><span class="p">;</span>
<span class="n">dd</span> <span class="nv">@foo</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="nb">defined</span><span class="p">;</span>    <span class="c1"># False</span>
<span class="n">dd</span> <span class="nv">@foo</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">:</span><span class="s">exists</span><span class="p">;</span>     <span class="c1"># True</span>
<span class="n">dd</span> <span class="nv">@foo</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">:</span><span class="s">exists</span><span class="p">;</span>     <span class="c1"># False</span>
<span class="n">dd</span> <span class="nv">@foo</span><span class="o">[</span><span class="mi">0</span><span class="o">,</span> <span class="mi">2</span><span class="o">]</span><span class="p">:</span><span class="s">exists</span><span class="p">;</span>  <span class="c1"># (True, False)</span>

<span class="k">my</span> <span class="nv">%fruit</span> <span class="o">=</span> <span class="s">apple</span> <span class="o">=&gt;</span> <span class="nb">Any</span>, <span class="s">orange</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">;</span>
<span class="n">dd</span> <span class="nv">%fruit</span><span class="p">&lt;</span><span class="s">apple</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">defined</span><span class="p">;</span>       <span class="c1"># False</span>
<span class="n">dd</span> <span class="nv">%fruit</span><span class="p">&lt;</span><span class="s">apple</span><span class="p">&gt;:</span><span class="s">exists</span><span class="p">;</span>        <span class="c1"># True</span>
<span class="n">dd</span> <span class="nv">%fruit</span><span class="p">&lt;</span><span class="s">banana</span><span class="p">&gt;:</span><span class="s">exists</span><span class="p">;</span>       <span class="c1"># False</span>
<span class="n">dd</span> <span class="nv">%fruit</span><span class="p">&lt;</span><span class="s">apple banana</span><span class="p">&gt;:</span><span class="s">exists</span><span class="p">;</span> <span class="c1"># (True, False)</span>
</code></pre></div><p>ä¹Ÿå¯ä»¥å¯¹å‰¯è¯å–åæ¥æµ‹è¯•ä¸å­˜åœ¨ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="n">dd</span> <span class="nv">%fruit</span><span class="p">&lt;</span><span class="s">apple banana</span><span class="p">&gt;:!</span><span class="s">exists</span><span class="p">;</span> <span class="c1"># (False, True)</span>
</code></pre></div><p>è¦æ£€æŸ¥åˆ‡ç‰‡çš„æ‰€æœ‰å…ƒç´ æ˜¯å¦å­˜åœ¨, ä½¿ç”¨ <a href="http://doc.raku.org/routine/all">all</a> junction:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="nb">all</span> <span class="nv">%fruit</span><span class="p">&lt;</span><span class="s">apple orange banana</span><span class="p">&gt;:</span><span class="s">exists</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div><p><code>:exists</code> å¯ä»¥å’Œ  <a href="http://doc.raku.org/language/subscripts#%3Adelete">:delete</a> è¿˜æœ‰ <code>:p/:kv</code> å‰¯è¯ç»„åˆ - è¿™æ—¶è¡¨è¾¾å¼çš„è¡Œä¸ºå°±ç”±é‚£äº›å‰¯è¯å†³å®š, é™¤äº†ä½¿ç”¨è¡¨æ˜å…ƒç´ å­˜åœ¨çš„å¯¹åº” Bool å€¼æ›¿æ¢è¿”å›çš„å…ƒç´ å€¼ä¹‹å¤–ã€‚</p>
<p>æŸ¥çœ‹ <a href="http://doc.raku.org/language/subscripts#method_EXISTS-POS">method EXISTS-POS</a> å’Œ <a href="http://doc.raku.org/language/subscripts#method_EXISTS-KEY">method EXISTS-KEY</a> äº†è§£åº•å±‚æœºåˆ¶.</p>
<h2 id="delete">:delete</h2>
<p>ä»é›†åˆä¸­åˆ é™¤å…ƒç´ , é™¤äº†è¿”å›å®ƒä»¬çš„å€¼ä»¥å¤–ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@tens</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">20</span><span class="o">,</span> <span class="mi">30</span><span class="p">;</span>
<span class="n">dd</span> <span class="nv">@tens</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="p">:</span><span class="s">delete</span><span class="p">;</span>     <span class="c1"># 30</span>
<span class="n">dd</span> <span class="nv">@tens</span><span class="p">;</span>               <span class="c1"># [0, 10, 20]&lt;&gt;</span>

<span class="k">my</span> <span class="nv">%fruit</span> <span class="o">=</span> <span class="s">apple</span> <span class="o">=&gt;</span> <span class="mi">5</span>, <span class="s">orange</span> <span class="o">=&gt;</span> <span class="mi">10</span>, <span class="s">banana</span> <span class="o">=&gt;</span> <span class="mi">4</span>, <span class="s">peach</span> <span class="o">=&gt;</span> <span class="mi">17</span><span class="p">;</span>
<span class="n">dd</span> <span class="nv">%fruit</span><span class="p">&lt;</span><span class="s">apple</span><span class="p">&gt;:</span><span class="s">delete</span><span class="p">;</span>         <span class="c1"># 5</span>
<span class="n">dd</span> <span class="nv">%fruit</span><span class="p">&lt;</span><span class="s">peach orange</span><span class="p">&gt;:</span><span class="s">delete</span><span class="p">;</span>  <span class="c1"># (17, 10)</span>
<span class="n">dd</span> <span class="nv">%fruit</span><span class="p">;</span>                       <span class="c1"># {banana =&gt; 4}&lt;&gt;</span>
</code></pre></div><p>ä½¿ç”¨å¦å®šå½¢å¼çš„å‰¯è¯, å…ƒç´ å®é™…ä¸Šä¸ä¼šè¢«åˆ é™¤ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä¼ é€’ä¸€ä¸ªæ ‡è®°, è®©å®ƒå˜æˆæœ‰æ¡ä»¶çš„åˆ é™¤ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="n">dd</span> <span class="nv">%fruit</span><span class="p">&lt;</span><span class="s">apple</span><span class="p">&gt;</span> <span class="p">:</span><span class="s">delete</span><span class="p">(</span><span class="nv">$flag</span><span class="p">);</span>  <span class="c1"># deletes the element only if $flag is</span>
                                  <span class="c1"># true, but always returns the value.</span>
</code></pre></div><p>èƒ½å’Œ <code>:exists</code> è¿˜æœ‰ <code>:p/:kv/:k/:v</code> å‰¯è¯ç»„åˆ - è¿™æ—¶è¿”å›å€¼ç”±é‚£äº›å‰¯è¯å†³å®š, ä½†æ˜¯åŒæ—¶å…ƒç´ ä¹Ÿä¼šè¢«åˆ é™¤ã€‚</p>
<p>æŸ¥çœ‹ <a href="http://doc.raku.org/language/subscripts#method_DELETE-POS">method DELETE-POS</a> and <a href="http://doc.raku.org/language/subscripts#method_DELETE-KEY">method DELETE-KEY</a> äº†è§£åº•å±‚æœºåˆ¶.</p>
<h2 id="p">:p</h2>
<p>ä»¥ Pair çš„å½¢å¼, è¿”å›å…ƒç´ çš„ç´¢å¼•/é”®å’Œå…ƒç´ å€¼, å¹¶é»˜é»˜è·³è¿‡ä¸å­˜åœ¨çš„å…ƒç´ ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@tens</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">20</span><span class="o">,</span> <span class="mi">30</span><span class="p">;</span>
<span class="n">dd</span> <span class="nv">@tens</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">:</span><span class="s">p</span><span class="p">;</span>        <span class="c1"># 1 =&gt; 10</span>
<span class="n">dd</span> <span class="nv">@tens</span><span class="o">[</span><span class="mi">0</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">2</span><span class="o">]</span><span class="p">:</span><span class="s">p</span><span class="p">;</span>  <span class="c1"># (0 =&gt; 0, 2 =&gt; 20)</span>

<span class="k">my</span> <span class="nv">%month</span> <span class="o">=</span> <span class="s">Jan</span> <span class="o">=&gt;</span> <span class="mi">1</span>, <span class="s">Feb</span> <span class="o">=&gt;</span> <span class="mi">2</span>, <span class="s">Mar</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">;</span>
<span class="n">dd</span> <span class="nv">%month</span><span class="p">&lt;</span><span class="s">Feb</span><span class="p">&gt;:</span><span class="s">p</span><span class="p">;</span>          <span class="c1"># &#34;Feb&#34; =&gt; 2</span>
<span class="n">dd</span> <span class="nv">%month</span><span class="p">&lt;</span><span class="s">Jan Foo Mar</span><span class="p">&gt;:</span><span class="s">p</span><span class="p">;</span>  <span class="c1"># (&#34;Jan&#34; =&gt; 1, &#34;Mar&#34; =&gt; 3)</span>
</code></pre></div><p>å¦‚æœä½ ä¸æƒ³è·³è¿‡ä¸å­˜åœ¨çš„å…ƒç´ , ä½¿ç”¨å¦å®šå½¢å¼:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="n">dd</span> <span class="nv">%month</span><span class="p">&lt;</span><span class="s">Jan Foo Mar</span><span class="p">&gt;:!</span><span class="s">p</span><span class="p">;</span>  <span class="c1"># (&#34;Jan&#34; =&gt; 1, &#34;Foo&#34; =&gt; Any, &#34;Mar&#34; =&gt; 3)</span>
</code></pre></div><p>èƒ½å’Œ <code>:exists</code> è¿˜æœ‰ <code>:delete</code> ç»„åˆã€‚</p>
<p>ä¹Ÿå¯ä»¥æŸ¥çœ‹ <a href="http://doc.raku.org/routine/pairs">pairs</a> å­ä¾‹ç¨‹.</p>
<h2 id="kv">:kv</h2>
<p>ä»¥åˆ—è¡¨çš„å½¢å¼è¿”å›å…ƒç´ çš„ç´¢å¼•/é”®å’Œå€¼, å¹¶é»˜é»˜åœ°è·³è¿‡ä¸å­˜åœ¨çš„å…ƒç´ ã€‚å½“ä½œç”¨åœ¨åˆ‡ç‰‡ä¸Šæ—¶, è¿”å›å€¼æ˜¯ä¸€ä¸ªå±•å¹³çš„é”®å’Œå€¼äº¤å‰ç€çš„å•ä¸ªåˆ—è¡¨ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@tens</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">20</span><span class="o">,</span> <span class="mi">30</span><span class="p">;</span>
<span class="n">dd</span> <span class="nv">@tens</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">:</span><span class="s">kv</span><span class="p">;</span>        <span class="c1"># (1, 10)</span>
<span class="n">dd</span> <span class="nv">@tens</span><span class="o">[</span><span class="mi">0</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">2</span><span class="o">]</span><span class="p">:</span><span class="s">kv</span><span class="p">;</span>  <span class="c1"># (0, 0, 2, 20)</span>

<span class="k">my</span> <span class="nv">%month</span> <span class="o">=</span> <span class="s">Jan</span> <span class="o">=&gt;</span> <span class="mi">1</span>, <span class="s">Feb</span> <span class="o">=&gt;</span> <span class="mi">2</span>, <span class="s">Mar</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">;</span>
<span class="n">dd</span> <span class="nv">%month</span><span class="p">&lt;</span><span class="s">Feb</span><span class="p">&gt;:</span><span class="s">kv</span><span class="p">;</span>          <span class="c1"># (&#34;Feb&#34;, 2)</span>
<span class="n">dd</span> <span class="nv">%month</span><span class="p">&lt;</span><span class="s">Jan Foo Mar</span><span class="p">&gt;:</span><span class="s">kv</span><span class="p">;</span>  <span class="c1"># (&#34;Jan&#34;, 1, &#34;Mar&#34;, 3)</span>
</code></pre></div><p>å¦‚æœä½ ä¸æƒ³è·³è¿‡ä¸å­˜åœ¨çš„å…ƒç´ , ä½¿ç”¨å¦å®šå½¢å¼:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="n">dd</span> <span class="nv">%month</span><span class="p">&lt;</span><span class="s">Jan Foo Mar</span><span class="p">&gt;:!</span><span class="s">kv</span><span class="p">;</span>  <span class="c1"># (&#34;Jan&#34;, 1, &#34;Foo&#34;, Any, &#34;Mar&#34;, 3)</span>
</code></pre></div><p>è¿™ä¸ªå‰¯è¯ä¸€èˆ¬ç”¨äºéå†åˆ‡ç‰‡ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="nv">%month</span><span class="p">&lt;</span><span class="s">Feb Mar</span><span class="p">&gt;:</span><span class="s">kv</span> <span class="k">-&gt;</span> <span class="nv">$month</span><span class="o">,</span> <span class="nv">$i</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$month</span><span class="s2"> had </span><span class="p">{</span><span class="nb">Date</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="mi">2015</span><span class="o">,</span> <span class="nv">$i</span><span class="o">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="nb">days-in-month</span><span class="p">}</span><span class="s2"> days in 2015</span><span class="p">&#34;</span>
<span class="p">}</span>
</code></pre></div><p>èƒ½å’Œ <code>:exists</code> è¿˜æœ‰ <code>:delete</code> ç»„åˆã€‚</p>
<p>ä¹Ÿå¯ä»¥æŸ¥çœ‹  <a href="http://doc.raku.org/routine/kv">kv</a> å­ä¾‹ç¨‹.</p>
<h2 id="k">:k</h2>
<p>åªè¿”å›å…ƒç´ çš„ç´¢å¼•/é”®, è€Œä¸æ˜¯å®ƒä»¬çš„å€¼, å¹¶é»˜é»˜åœ°è·³è¿‡ä¸å­˜åœ¨çš„å…ƒç´ ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@tens</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">20</span><span class="o">,</span> <span class="mi">30</span><span class="p">;</span>
<span class="n">dd</span> <span class="nv">@tens</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">:</span><span class="s">k</span><span class="p">;</span>        <span class="c1"># 1</span>
<span class="n">dd</span> <span class="nv">@tens</span><span class="o">[</span><span class="mi">0</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">2</span><span class="o">]</span><span class="p">:</span><span class="s">k</span><span class="p">;</span>  <span class="c1"># (0, 2)</span>

<span class="k">my</span> <span class="nv">%month</span> <span class="o">=</span> <span class="s">Jan</span> <span class="o">=&gt;</span> <span class="mi">1</span>, <span class="s">Feb</span> <span class="o">=&gt;</span> <span class="mi">2</span>, <span class="s">Mar</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">;</span>
<span class="n">dd</span> <span class="nv">%month</span><span class="p">&lt;</span><span class="s">Feb</span><span class="p">&gt;:</span><span class="s">k</span><span class="p">;</span>          <span class="c1"># &#34;Feb&#34;</span>
<span class="n">dd</span> <span class="nv">%month</span><span class="p">&lt;</span><span class="s">Jan Foo Mar</span><span class="p">&gt;:</span><span class="s">k</span><span class="p">;</span>  <span class="c1"># (&#34;Jan&#34;, &#34;Mar&#34;)</span>
</code></pre></div><p>å¦‚æœä½ ä¸æƒ³è·³è¿‡ä¸å­˜åœ¨çš„å…ƒç´ , ä½¿ç”¨å¦å®šå½¢å¼:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="n">dd</span> <span class="nv">%month</span><span class="p">&lt;</span><span class="s">Jan Foo Mar</span><span class="p">&gt;:!</span><span class="s">k</span><span class="p">;</span>  <span class="c1"># (&#34;Jan&#34;, &#34;Foo&#34;, &#34;Mar&#34;)</span>
</code></pre></div><p>è¿˜å¯ä»¥æŸ¥çœ‹ <a href="http://doc.raku.org/routine/keys">keys</a> å­ä¾‹ç¨‹.</p>
<h2 id="v">:v</h2>
<p>è¿”å›å…ƒç´ çš„è£¸å€¼(ä¸æ˜¯æœ‰å¯èƒ½è¿”å›ä¸€ä¸ªå¯å˜å€¼å®¹å™¨), å¹¶é»˜é»˜è·³è¿‡ä¸å­˜åœ¨çš„å…ƒç´ ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@tens</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">10</span><span class="o">,</span> <span class="mi">20</span><span class="o">,</span> <span class="mi">30</span><span class="p">;</span>
<span class="n">dd</span> <span class="nv">@tens</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">:</span><span class="s">v</span><span class="p">;</span>        <span class="c1"># 10</span>
<span class="n">dd</span> <span class="nv">@tens</span><span class="o">[</span><span class="mi">0</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">2</span><span class="o">]</span><span class="p">:</span><span class="s">v</span><span class="p">;</span>  <span class="c1"># (0, 20)</span>
<span class="nv">@tens</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span> <span class="o">=</span> <span class="mi">31</span><span class="p">;</span>        <span class="c1"># OK</span>
<span class="nv">@tens</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="p">:</span><span class="s">v</span> <span class="o">=</span> <span class="mi">31</span><span class="p">;</span>      <span class="c1"># ERROR, cannot assign to immutable integer value</span>

<span class="k">my</span> <span class="nv">%month</span> <span class="o">=</span> <span class="s">Jan</span> <span class="o">=&gt;</span> <span class="mi">1</span>, <span class="s">Feb</span> <span class="o">=&gt;</span> <span class="mi">2</span>, <span class="s">Mar</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">;</span>
<span class="n">dd</span> <span class="nv">%month</span><span class="p">&lt;</span><span class="s">Feb</span><span class="p">&gt;:</span><span class="s">v</span><span class="p">;</span>          <span class="c1"># 2</span>
<span class="n">dd</span> <span class="nv">%month</span><span class="p">&lt;</span><span class="s">Jan Foo Mar</span><span class="p">&gt;:</span><span class="s">v</span><span class="p">;</span>  <span class="c1"># (1, 3)</span>
</code></pre></div><p>å¦‚æœä½ ä¸æƒ³è·³è¿‡ä¸å­˜åœ¨çš„å…ƒç´ , ä½¿ç”¨å¦å®šå½¢å¼:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="n">dd</span> <span class="nv">%month</span><span class="p">&lt;</span><span class="s">Jan Foo Mar</span><span class="p">&gt;:!</span><span class="s">v</span><span class="p">;</span>  <span class="c1"># (1, Any, 3)</span>
</code></pre></div><p>è¿˜å¯ä»¥æŸ¥çœ‹  <a href="http://doc.raku.org/routine/values">values</a> å­ä¾‹ç¨‹.</p>
<h1 id="custom-types">Custom types</h1>
<p>è¿™é¡µæè¿°çš„ä¸‹æ ‡æ¥å£å¹¶ä¸æ„å‘³ç€å’Œ Raku çš„å†…ç½®é›†åˆç±»å‹ç›¸æ’æ–¥ - ä½ å¯ä»¥(å¹¶ä¸”åº”è¯¥)ä¸ºä»»ä½•æƒ³é€šè¿‡ç´¢å¼•æˆ–é”®æä¾›æ•°æ®è®¿é—®çš„è‡ªå®šä¹‰ç±»å‹é‡ç”¨å®ƒä»¬ã€‚</p>
<p>ä½ ä¸å¿…æ‰‹åŠ¨é‡è½½ <a href="http://doc.raku.org/routine/%5B%20%5D#postcircumfix_%5B_%5D">postcircumfix [ ]</a> å’Œ  <a href="http://doc.raku.org/">postcircumfix { }</a> æ“ä½œç¬¦å¹¶é‡æ–°å®ç°å®ƒä»¬æ‰€æœ‰çš„æˆæ³•, ä¸ºäº†å®ç°å®ƒ, ç›¸å, ä½ å¯ä»¥ä¾èµ–è¿™ä¸ªäº‹å®, åœ¨å¹•å, å®ƒä»¬çš„æ ‡å‡†å®ç°åˆ†æ´¾ç»™äº†ä¸€ä¸ªå®šä¹‰è‰¯å¥½çš„åº•å±‚æ–¹æ³•é›†ã€‚ä¾‹å¦‚ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">å½“ä½ è¿™æ ·å†™</th>
<th style="text-align:left">è¿™ä¼šåœ¨å¹•åè°ƒç”¨å¦‚ä¸‹åº•å±‚æ–¹æ³•</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">%foo<!-- raw HTML omitted --></td>
<td style="text-align:left">%foo.AT-KEY(&ldquo;aa&rdquo;)</td>
</tr>
<tr>
<td style="text-align:left">%foo<!-- raw HTML omitted -->:delete</td>
<td style="text-align:left">%foo.DELETE-KEY(&ldquo;aa&rdquo;)</td>
</tr>
<tr>
<td style="text-align:left">@foo[3,4,5]</td>
<td style="text-align:left">@foo.AT-POS(3), @foo.AT-POS(4), @foo.AT-POS(5)</td>
</tr>
<tr>
<td style="text-align:left">@foo[*-1]</td>
<td style="text-align:left">@foo.AT-POS(@foo.elems - 1)</td>
</tr>
</tbody>
</table>
<p>æ‰€ä»¥, ä¸ºäº†è®©ä½ çš„ä¸‹æ ‡å·¥ä½œ, ä½ åªéœ€è¦ä¸ºä½ çš„è‡ªå®šä¹‰ç±»å‹å®ç°æˆ–å§”æ‰˜é‚£äº›åº•å±‚æ–¹æ³•(<a href="http://doc.raku.org/language/subscripts#Methods_to_implement_for_positional_subscripting">ä¸‹é¢æè¿°è¯¦æƒ…</a>)ã€‚</p>
<p>å¦‚æœä½ è¿™æ ·åšäº†, ä½ è¿˜åº”è¯¥è®©ä½ çš„ç±»å‹å„è‡ªéµå®ˆ <a href="http://doc.raku.org/type/Positional">Positional</a> æˆ– <a href="http://doc.raku.org/type/Associative">Associative</a> role</p>
<h2 id="custom-type-example">Custom type example</h2>
<p>è®¾æƒ³ä¸€ä¸‹ <code>HTTP::Header</code> ç±»å‹, å°½ç®¡å®ƒä½œä¸ºä¸€ä¸ªæœ‰ç‰¹å®šè¡Œä¸ºçš„è‡ªå®šä¹‰ç±», å´èƒ½åƒæ•£åˆ—é‚£æ ·ç´¢å¼•ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$request</span> <span class="o">=</span> <span class="n">HTTP::Request</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">GET</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">raku.org</span><span class="p">&#34;);</span>
<span class="nb">say</span> <span class="nv">$request</span><span class="o">.</span><span class="nf">header</span><span class="o">.</span><span class="nb">WHAT</span><span class="p">;</span>  <span class="c1"># (HTTP::Header)</span>

<span class="nv">$request</span><span class="o">.</span><span class="nf">header</span><span class="p">&lt;</span><span class="s">Accept</span><span class="p">&gt;</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">text/plain</span><span class="p">&#34;;</span>
<span class="nv">$request</span><span class="o">.</span><span class="nf">header</span><span class="p">{&#39;</span><span class="s1">Accept-</span><span class="p">&#39;</span> <span class="ow">X</span><span class="o">~</span> <span class="p">&lt;</span><span class="s">Charset Encoding Language</span><span class="p">&gt;}</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">utf-8 gzip en</span><span class="p">&gt;;</span>
<span class="nv">$request</span><span class="o">.</span><span class="nf">header</span><span class="o">.</span><span class="nb">push</span><span class="p">(&#39;</span><span class="s1">Accept-Language</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">fr</span><span class="p">&#34;);</span>  <span class="c1"># like .push on a Hash</span>

<span class="nb">say</span> <span class="nv">$request</span><span class="o">.</span><span class="nf">header</span><span class="p">&lt;</span><span class="s">Accept-Language</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">perl</span><span class="p">;</span>  <span class="c1"># [&#34;en&#34;, &#34;fr&#34;]</span>

<span class="k">my</span> <span class="nv">$rawheader</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">.</span><span class="nf">header</span><span class="o">.</span><span class="nb">Str</span><span class="p">;</span>  <span class="c1"># stringify according to HTTP spec</span>
</code></pre></div><p>å®ç°è¿™ä¸ªç±»çš„æœ€ç®€å•çš„æ–¹æ³•æ˜¯, ç»™å®ƒä¸€ä¸ª Hash ç±»å‹çš„å±æ€§, å¹¶æŠŠæ‰€æœ‰çš„ä¸‹æ ‡å’Œè¿­ä»£ç›¸å…³åŠŸèƒ½æ€§å§”æ‰˜ç»™é‚£ä¸ªå±æ€§ã€‚(ä½¿ç”¨ä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹çº¦æŸæ¥ç¡®ä¿ä½¿ç”¨è€…ä¸ä¼šåœ¨é‡Œé¢æ’å…¥ä»»ä½•ä¸åˆæ³•çš„å€¼)ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">HTTP::Header</span> <span class="k">does</span> <span class="nb">Associative</span> <span class="k">is</span> <span class="nb">Iterable</span> <span class="p">{</span>
    <span class="k">subset</span> <span class="nc">StrOrArrayOfStr</span> <span class="k">where</span> <span class="nb">Str</span> <span class="o">|</span> <span class="p">(</span> <span class="nb">Array</span> <span class="o">&amp;</span> <span class="p">{</span><span class="o">.</span><span class="nb">all</span> <span class="o">~~</span> <span class="nb">Str</span><span class="p">}</span> <span class="p">);</span>

    <span class="k">has</span> <span class="nv">%!fields</span> <span class="k">of</span> <span class="nc">StrOrArrayOfStr</span>
                 <span class="nb">handles</span> <span class="p">&lt;</span><span class="s">AT-KEY EXISTS-KEY DELETE-KEY push
</span><span class="s">                          iterator list kv keys values</span><span class="p">&gt;;</span>

    <span class="k">method</span> <span class="nb">Str</span> <span class="p">{</span> <span class="cm">#`[not shown, for brevity]</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>ç„¶è€Œ, HTTP header å­—æ®µåè¢«è®¤ä¸ºæ˜¯å¤§å°å†™æ— å…³çš„(æ›´åå¥½é©¼å³°æ³•)ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æŠŠ <code>*-key</code> å’Œ <code>push</code> æ–¹æ³•æ‹¿åˆ° <code>handles</code> åˆ—è¡¨çš„å¤–é¢æ¥å®¹çº³å®ƒ, å¹¶åƒè¿™æ ·å„è‡ªå®ç°å®ƒä»¬ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">method</span> <span class="nb">AT-KEY</span>     <span class="p">(</span><span class="nv">$key</span><span class="p">)</span> <span class="k">is</span> <span class="k">rw</span> <span class="p">{</span> <span class="nv">%!fields</span><span class="p">{</span><span class="n">normalize-key</span> <span class="nv">$key</span><span class="p">}</span>        <span class="p">}</span>
<span class="k">method</span> <span class="nb">EXISTS-KEY</span> <span class="p">(</span><span class="nv">$key</span><span class="p">)</span>       <span class="p">{</span> <span class="nv">%!fields</span><span class="p">{</span><span class="n">normalize-key</span> <span class="nv">$key</span><span class="p">}:</span><span class="s">exists</span> <span class="p">}</span>
<span class="k">method</span> <span class="nb">DELETE-KEY</span> <span class="p">(</span><span class="nv">$key</span><span class="p">)</span>       <span class="p">{</span> <span class="nv">%!fields</span><span class="p">{</span><span class="n">normalize-key</span> <span class="nv">$key</span><span class="p">}:</span><span class="s">delete</span> <span class="p">}</span>
<span class="k">method</span> <span class="nb">push</span> <span class="p">(</span><span class="o">*</span><span class="nv">@_</span><span class="p">)</span> <span class="p">{</span> <span class="cm">#`[not shown, for brevity]</span> <span class="p">}</span>

<span class="k">sub</span> <span class="nf">normalize-key</span> <span class="p">(</span><span class="nv">$key</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$key</span><span class="o">.</span><span class="nb">subst</span><span class="p">(/</span><span class="se">\w</span><span class="o">+</span><span class="p">/</span><span class="o">,</span> <span class="o">*.</span><span class="nb">tc</span><span class="o">,</span> <span class="p">:</span><span class="s">g</span><span class="p">)</span> <span class="p">}</span>
</code></pre></div><p>æ³¨æ„ä¸‹æ ‡  <code>%!fields</code> è¿”å›ä¸€ä¸ªé€‚å½“çš„ rw å®¹å™¨, è€Œæˆ‘ä»¬çš„ <code>AT-KEY</code> èƒ½å¤Ÿç®€å•åœ°ä¼ é€’ã€‚</p>
<p>ç„¶è€Œ, æˆ‘ä»¬å¯èƒ½å€¾å‘äºå°‘ä¸€ç‚¹å¯¹ç”¨æˆ·è¾“å…¥çš„é™åˆ¶, ç›¸åæˆ‘ä»¬è‡ªå·±å…³å¿ƒå­—æ®µå€¼çš„æ¶ˆæ¯’ã€‚é‚£ç§æƒ…å†µä¸‹, æˆ‘ä»¬å¯ä»¥ç§»é™¤ <code>%!fields</code> ä¸Šçš„ <code>StrOrArrayOfStr</code> ç±»å‹çº¦æŸ, å¹¶åœ¨èµ‹å€¼æ—¶ä½¿ç”¨è¿”å›è‡ªå®šä¹‰çš„å…³å¿ƒæ¶ˆæ¯’å€¼çš„ Proxy å®¹å™¨æ¥æ›¿æ¢æˆ‘ä»¬çš„ <code>AT-KEY</code> å®ç°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">method</span> <span class="nb">AT-KEY</span> <span class="p">(</span><span class="vg">::?CLASS:D</span><span class="o">:</span> <span class="nv">$key</span><span class="p">)</span> <span class="k">is</span> <span class="k">rw</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$element</span> <span class="o">:=</span> <span class="nv">%!fields</span><span class="p">{</span><span class="n">normalize-key</span> <span class="nv">$key</span><span class="p">};</span>

    <span class="nb">Proxy</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span>
        <span class="s">FETCH</span> <span class="o">=&gt;</span> <span class="k">method</span> <span class="p">()</span> <span class="p">{</span> <span class="nv">$element</span> <span class="p">}</span>,

        <span class="s">STORE</span> <span class="o">=&gt;</span> <span class="k">method</span> <span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$element</span> <span class="o">=</span> <span class="nb">do</span> <span class="k">given</span> <span class="nv">$value</span><span class="o">Â».</span><span class="nb">split</span><span class="p">(/&#39;</span><span class="s1">,</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\s</span><span class="o">+</span><span class="p">/)</span><span class="o">.</span><span class="nb">flat</span> <span class="p">{</span>
                <span class="k">when</span> <span class="mi">1</span>  <span class="p">{</span> <span class="o">.[</span><span class="mi">0</span><span class="o">]</span> <span class="p">}</span>    <span class="c1"># a single value is stored as a string</span>
                <span class="k">default</span> <span class="p">{</span> <span class="o">.</span><span class="nb">Array</span> <span class="p">}</span>  <span class="c1"># multiple values are stored as an array</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>æ³¨æ„æŠŠæ–¹æ³•å£°æ˜ä¸º <code>multi</code> å¹¶æŠŠå®ƒé™åˆ¶ä¸º <code>:D</code> (defined invocants) ç¡®ä¿æœªå®šä¹‰æƒ…å†µè¢«ä¼ é€’ç»™ç”± Any æä¾›çš„é»˜è®¤å®ç°ã€‚</p>
<h2 id="methods-to-implement-for-positional-subscripting">Methods to implement for positional subscripting</h2>
<p>ä¸ºäº†é€šè¿‡ <a href="http://doc.raku.org/routine/%5B%20%5D#postcircumfix_%5B_%5D">postcircumfix [ ]</a> è®©åŸºäºç´¢å¼•çš„ä¸‹æ ‡åœ¨ä½ çš„è‡ªå®šä¹‰ç±»å‹ä¸­å·¥ä½œ, ä½ åº”è¯¥è‡³å°‘å®ç°ä¸‹é¢çš„ <code>elems</code>, <code>AT-POS</code> å’Œ <code>EXISTS-POS-</code> è¿˜æœ‰å…¶å®ƒå¯é€‰é¡¹ã€‚</p>
<h3 id="elems-æ–¹æ³•">elems æ–¹æ³•</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">method</span> <span class="nb">elems</span> <span class="p">(</span><span class="vg">::?CLASS:D</span><span class="o">:</span><span class="p">)</span>
</code></pre></div><p>é¢„æœŸè¿”å›ä¸€ä¸ªæ•°å­—, ç”¨äºè¡¨æ˜å¯¹è±¡ä¸­æœ‰å¤šå°‘ä¸ªå¯æ ‡æ³¨çš„å…ƒç´ ã€‚å¯èƒ½è¢«ç”¨æˆ·ç›´æ¥è°ƒç”¨, å¹¶ä¸”å½“ä»æœ«å°¾ç´¢å¼•å…ƒç´ çš„æ—¶å€™, è¿˜ä¼šè¢«  <code>postcircumfix [ ]</code> è°ƒç”¨, å°±åƒ <code>@foo[*-1]</code> ä¸­é‚£æ ·ã€‚</p>
<p>å¦‚æœæ²¡æœ‰å®ç°è¿™ä¸ªæ–¹æ³•, ä½ çš„ç±»å‹ä¼šä» Any ç»§æ‰¿é»˜è®¤çš„å®ç°, å¯¹å®šä¹‰è¿‡çš„è°ƒç”¨è€…è¿™æ€»æ˜¯è¿”å› 1 - è¿™æœ€ä¸å¯èƒ½æ˜¯ä½ æƒ³è¦çš„ã€‚æ‰€ä»¥, å¦‚æœä¸èƒ½ä»ä½ çš„ä½ç½®ç±»å‹çŸ¥æ™“å…ƒç´ çš„ä¸ªæ•°, é‚£å°±æ·»åŠ ä¸€ä¸ª fails æˆ– dies å®ç°, ä»¥é¿å…æ²‰é»˜åœ°åšäº†é”™äº‹ã€‚</p>
<h3 id="at-pos-æ–¹æ³•">AT-POS æ–¹æ³•</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">method</span> <span class="nb">AT-POS</span> <span class="p">(</span><span class="vg">::?CLASS:D</span><span class="o">:</span> <span class="nv">$index</span><span class="p">)</span>
</code></pre></div><p>æœŸæœ›è¿”å› <code>$index</code> ä½ç½®å¤„çš„å…ƒç´ ã€‚è¿™å°±æ˜¯ <code>postcircumfix [ ]</code> é€šå¸¸è°ƒç”¨çš„æ–¹æ³•ã€‚
å¦‚æœä½ æƒ³è®©å…ƒç´ å¯å˜(åƒå®ƒä»¬ç”¨äº Array ç±»å‹é‚£æ ·), ä½ å°±å¿…é¡»ç¡®ä¿ä»¥ item å®¹å™¨çš„å½¢å¼è¿”å›å®ƒ, å¹¶åœ¨è¢«èµ‹å€¼æ—¶æ›´æ–°å®ƒã€‚(è®°å¾—ä½¿ç”¨ <code>return-rw</code> æˆ– <code>rw</code> å­ä¾‹ç¨‹ trait ä»¥ä½¿å®ƒå·¥ä½œã€‚)</p>
<h3 id="exists-pos-æ–¹æ³•">EXISTS-POS æ–¹æ³•</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">method</span> <span class="nb">EXISTS-POS</span> <span class="p">(</span><span class="vg">::?CLASS:D</span><span class="o">:</span> <span class="nv">$index</span><span class="p">)</span>
</code></pre></div><p>è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ä»¥è¡¨æ˜åœ¨ <code>$index</code> ä½ç½®å¤„æ˜¯å¦æœ‰å…ƒç´ ã€‚è¿™å°±æ˜¯å¼•ç”¨ <code>@foo[42]:exists</code> æ—¶, <code>postcircumfix [ ]</code> æ‰€è°ƒç”¨çš„æ–¹æ³•ã€‚</p>
<p>å…ƒç´ &quot;å­˜åœ¨&quot;æ„å‘³ç€ä»€ä¹ˆ, å–å†³äºä½ çš„ç±»å‹ã€‚</p>
<p>å¦‚æœä½ æ²¡æœ‰å®ç°å®ƒ, ä½ çš„ç±»å‹ä¼šä» <code>Any</code> é‚£å„¿ç»§æ‰¿é»˜è®¤çš„å®ç°, å¯¹äºç´¢å¼• 0 å®ƒä¼šè¿”å› True, å¯¹äº å…¶å®ƒç´¢å¼•å®ƒä¼šè¿”å› <code>false</code> - è¿™å¯èƒ½ä¸æ˜¯ä½ æƒ³è¦çš„ã€‚æ‰€ä»¥å¦‚æœä½ çš„ç±»å‹ä¸èƒ½åšå…ƒç´ å­˜åœ¨æ£€æµ‹, é‚£å°±æ·»åŠ ä¸€ä¸ª fails æˆ– die å®ç°, ä»¥é¿å…é™é»˜åœ°åšé”™äº‹æƒ…ã€‚</p>
<h3 id="delete-pos-æ–¹æ³•">DELETE-POS æ–¹æ³•</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">method</span> <span class="nb">DELETE-POS</span> <span class="p">(</span><span class="vg">::?CLASS:D</span><span class="o">:</span> <span class="nv">$index</span><span class="p">)</span>
</code></pre></div><p>åˆ é™¤ <code>$index</code> å¤„çš„å…ƒç´ , å¹¶è¿”å›å®ƒæ‰€åˆ é™¤çš„è¿™ä¸ªå…ƒç´ ã€‚è¿™å°±æ˜¯å¼•ç”¨ <code>@foo[42]:delete</code> æ—¶, <code>postcircumfix [ ]</code> æ‰€è°ƒç”¨çš„æ–¹æ³•ã€‚</p>
<p>&ldquo;åˆ é™¤&quot;å…ƒç´ çš„æ„æ€æ˜¯ä»€ä¹ˆ, å–å†³äºä½ çš„ç±»å‹ã€‚</p>
<p>å®ç°è¿™ä¸ªæ–¹æ³•æ˜¯å¯é€‰çš„; å¦‚æœä½ æ²¡æœ‰å®ç°å®ƒ, é‚£ä¹ˆç”¨æˆ·å°è¯•ä»è¿™ç§ç±»å‹çš„å¯¹è±¡ä¸­åˆ é™¤å…ƒç´ ä¼šå¾—åˆ°ä¸€ä¸ªåˆé€‚çš„é”™è¯¯ä¿¡æ¯ã€‚</p>
<h3 id="assign-pos-æ–¹æ³•">ASSIGN-POS æ–¹æ³•</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">method</span> <span class="nb">ASSIGN-POS</span> <span class="p">(</span><span class="vg">::?CLASS:D</span><span class="o">:</span> <span class="nv">$index</span><span class="o">,</span> <span class="nv">$new</span><span class="p">)</span>
</code></pre></div><p>æŠŠ <code>$index</code> ä½ç½®å¤„çš„å…ƒç´ è®¾ç½®ä¸º <code>$new</code> å€¼ã€‚å®ç°è¿™ä¸ªæ–¹æ³•å®Œå…¨æ˜¯å¯é€‰çš„; å¦‚æœä½ æ²¡æœ‰å®ç°è¿™ä¸ªæ–¹æ³•, é‚£ä¹ˆä¼šä½¿ç”¨ <code>self.AT-POS($index) = $new</code> ä»£æ›¿, å¦‚æœä½ ç¡®å®å®ç°äº†è¯¥æ–¹æ³•, é‚£ä¹ˆç¡®ä¿å®ƒæ‹¥æœ‰ç›¸åŒçš„æ•ˆæœã€‚</p>
<p>è¿™æ„å‘³ç€ opt-in æ€§èƒ½ä¼˜åŒ–, ä»¥è‡³äºç®€å•çš„è¯¸å¦‚ <code>@numbers[5] = &quot;five&quot;</code> çš„èµ‹å€¼èƒ½åœ¨ä¸è°ƒç”¨ <code>AT-POS</code>(è¿™å¿…é¡»åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªæ½œåœ¨çš„æ˜‚è´µçš„å®¹å™¨å¯¹è±¡) æ–¹æ³•æ—¶æ“ä½œã€‚</p>
<p>æ³¨æ„, å®ç° <code>ASSIGN-POS</code> ä¸èƒ½è§£é™¤è®© <code>AT-POS</code> å˜æˆä¸€ä¸ª <code>rw</code> æ–¹æ³•, å› ä¸ºè¯¸å¦‚ <code>@numbers[5]++</code> çš„ä¸å¤ªé‡è¦çš„èµ‹å€¼/ä¿®æ”¹ä»æ—§ä¼šä½¿ç”¨ <code>AT-POS</code>ã€‚</p>
<h3 id="bind-pos-æ–¹æ³•">BIND-POS æ–¹æ³•</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">method</span> <span class="nb">BIND-POS</span> <span class="p">(</span><span class="vg">::?CLASS:D</span><span class="o">:</span> <span class="nv">$index</span><span class="o">,</span> \<span class="nb">new</span><span class="p">)</span>
</code></pre></div><p>æŠŠå€¼æˆ–å®¹å™¨ <code>new</code> ç»‘å®šç»™ä½ç½® <code>$index</code> å¤„çš„æ’æ§½ä¸Š, æ›¿æ¢é‚£å„¿èƒ½æ‰¾åˆ°çš„ä»»ä½•å®¹å™¨ã€‚è¿™æ˜¯å½“ä½ è¿™æ ·å†™çš„æ—¶å€™æ‰€è°ƒç”¨çš„ä¸œè¥¿:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$x</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="nv">@numbers</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span> <span class="o">:=</span> <span class="nv">$x</span><span class="p">;</span>
</code></pre></div><p>ä¸€èˆ¬çš„æ•°ç»„ç±»æ”¯æŒè¿™ä»¥å…è®¸åˆ›å»ºå¤æ‚çš„é“¾æ¥æ•°æ®ç»“æ„, ä½†æ˜¯å¯¹äºæ›´ç‰¹å®šé¢†åŸŸç±»å‹å®ƒå¯èƒ½æ²¡æœ‰æ„ä¹‰, æ‰€ä»¥ä¸å¼ºæ±‚å»å®ç°å®ƒã€‚å¦‚æœä½ æ²¡æœ‰å®ç°è¯¥æ–¹æ³•, ç”¨æˆ·ä¼šè·å¾—ä¸€ä¸ªåˆé€‚çš„é”™è¯¯ä¿¡æ¯, å½“å®ƒä»¬å°è¯•ç»‘å®šåˆ°è¿™ç§ç±»å‹çš„å¯¹è±¡çš„ä¸€ä¸ªä½ç½®æ’æ§½ä¸Šæ—¶ã€‚</p>
<h2 id="methods-to-implement-for-associative-subscripting">Methods to implement for associative subscripting</h2>
<p>ä¸ºäº†é€šè¿‡ <code>postcircumfix { }</code> è®©åŸºäºé”®çš„ä¸‹æ ‡èƒ½å¤Ÿå·¥ä½œäºä½ çš„è‡ªå®šä¹‰ç±»å‹ä¸­, ä½ åº”è¯¥è‡³å°‘å®ç° <code>AT-KEY</code> å’Œ <code>EXISTS-KEY</code> - è¿˜æœ‰å¯é€‰åœ°å®ç°ä¸‹é¢çš„æ–¹æ³•ã€‚</p>
<h3 id="at-key-æ–¹æ³•">AT-KEY æ–¹æ³•</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">method</span> <span class="nb">AT-KEY</span> <span class="p">(</span><span class="vg">::?CLASS:D</span><span class="o">:</span> <span class="nv">$key</span><span class="p">)</span>
</code></pre></div><p>è¿”å›å’Œ <code>$key</code> ç›¸å…³è”çš„å…ƒç´ ã€‚è¿™æ­£æ˜¯ <code>postcircumfix { }</code> é€šå¸¸æ‰€è°ƒç”¨çš„æ–¹æ³•ã€‚</p>
<p>å¦‚æœä½ æƒ³è®©å…ƒç´ å¯å˜(å°±åƒå®ƒä»¬æ˜¯ä¸ºäº†å†…ç½®çš„ Hash ç±»å‹), ä½ å¿…é¡»ç¡®ä¿ä»¥ item å®¹å™¨çš„å½¢å¼è¿”å›å®ƒ, å¹¶åœ¨è¢«èµ‹å€¼æ—¶æ›´æ–°å®ƒã€‚(è®°å¾—ä½¿ç”¨ <code>return-rw</code> æˆ– <code>is rw</code> å­ä¾‹ç¨‹ trait ä»¥ä½¿å…¶æœ‰æ•ˆ; æŸ¥çœ‹ä¾‹å­ã€‚)</p>
<p>å¦ä¸€æ–¹é¢, å¦‚æœä½ æƒ³è®©ä½ çš„é›†åˆåªè¯», è¯·ç›´æ¥è¿”å›éå®¹å™¨å€¼ã€‚</p>
<h3 id="exists-key-æ–¹æ³•">EXISTS-KEY æ–¹æ³•</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">method</span> <span class="nb">EXISTS-KEY</span> <span class="p">(</span><span class="vg">::?CLASS:D</span><span class="o">:</span> <span class="nv">$key</span><span class="p">)</span>
</code></pre></div><p>è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ä»¥è¡¨æ˜å’Œ <code>$key</code> ç›¸å…³è”çš„å…ƒç´ æ˜¯å¦å­˜åœ¨ã€‚è¿™å°±æ˜¯å¼•ç”¨ <code>%foo&lt;aa&gt;:exists</code> æ—¶, <code>postcircumfix { }</code> æ‰€è°ƒç”¨çš„æ–¹æ³•ã€‚</p>
<p>å…ƒç´ &quot;å­˜åœ¨&quot;æ„å‘³ç€ä»€ä¹ˆ, å–å†³äºä½ çš„ç±»å‹ã€‚</p>
<p>å¦‚æœä½ æ²¡æœ‰å®ç°å®ƒ, ä½ çš„ç±»å‹ä¼šä» <code>Any</code> é‚£å„¿ç»§æ‰¿é»˜è®¤çš„å®ç°, è¿™é€šå¸¸è¿”å› False - è¿™å¯èƒ½ä¸æ˜¯ä½ æƒ³è¦çš„ã€‚æ‰€ä»¥å¦‚æœä½ çš„ç±»å‹ä¸èƒ½åšå…ƒç´ å­˜åœ¨æ£€æµ‹, é‚£å°±æ·»åŠ ä¸€ä¸ª fails æˆ– die å®ç°, ä»¥é¿å…é™é»˜åœ°åšé”™äº‹æƒ…</p>
<h3 id="delete-key-æ–¹æ³•">DELETE-KEY æ–¹æ³•</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">method</span> <span class="nb">DELETE-KEY</span> <span class="p">(</span><span class="vg">::?CLASS:D</span><span class="o">:</span> <span class="nv">$key</span><span class="p">)</span>
</code></pre></div><p>åˆ é™¤å’Œ <code>$key</code> ç›¸å…³è”çš„å…ƒç´ , å¹¶è¿”å›å®ƒæ‰€åˆ é™¤çš„è¿™ä¸ªå…ƒç´ ã€‚è¿™å°±æ˜¯å¼•ç”¨ <code>%foo&lt;aa&gt;:delete</code> æ—¶, <code>postcircumfix { }</code> æ‰€è°ƒç”¨çš„æ–¹æ³•ã€‚</p>
<p>&ldquo;åˆ é™¤&quot;å…ƒç´ çš„æ„æ€æ˜¯ä»€ä¹ˆ, å–å†³äºä½ çš„ç±»å‹ - å°½ç®¡å®ƒé€šå¸¸è®© <code>EXISTS-KEY</code> å› ä¸ºé‚£ä¸ªé”®å˜ä¸º <code>False</code>ã€‚</p>
<p>å®ç°è¿™ä¸ªæ–¹æ³•æ˜¯å¯é€‰çš„; å¦‚æœä½ æ²¡æœ‰å®ç°å®ƒ, é‚£ä¹ˆç”¨æˆ·å°è¯•ä»è¿™ç§ç±»å‹çš„å¯¹è±¡ä¸­åˆ é™¤å…ƒç´ ä¼šå¾—åˆ°ä¸€ä¸ªåˆé€‚çš„é”™è¯¯ä¿¡æ¯ã€‚</p>
<h3 id="assign-key-æ–¹æ³•">ASSIGN-KEY æ–¹æ³•</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">method</span> <span class="nb">ASSIGN-KEY</span> <span class="p">(</span><span class="vg">::?CLASS:D</span><span class="o">:</span> <span class="nv">$key</span><span class="o">,</span> <span class="nv">$new</span><span class="p">)</span>
</code></pre></div><p>æŠŠå’Œ <code>$key</code>  ç›¸å…³è”çš„å…ƒç´ è®¾ç½®ä¸º <code>$new</code> å€¼ã€‚å®ç°è¿™ä¸ªæ–¹æ³•å®Œå…¨æ˜¯å¯é€‰çš„; å¦‚æœä½ æ²¡æœ‰å®ç°è¿™ä¸ªæ–¹æ³•, é‚£ä¹ˆä¼šä½¿ç”¨ <code>self.AT-KEY($key) = $new</code> ä»£æ›¿, å¦‚æœä½ ç¡®å®å®ç°äº†è¯¥æ–¹æ³•, é‚£ä¹ˆç¡®ä¿å®ƒæ‹¥æœ‰ç›¸åŒçš„æ•ˆæœã€‚</p>
<p>è¿™æ„å‘³ç€ opt-in æ€§èƒ½ä¼˜åŒ–, ä»¥è‡³äºç®€å•çš„è¯¸å¦‚ <code>%age&lt;Claire&gt; = 29</code> çš„èµ‹å€¼èƒ½åœ¨ä¸è°ƒç”¨ <code>AT-KEY</code>(è¿™å¿…é¡»åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªæ½œåœ¨çš„æ˜‚è´µçš„å®¹å™¨å¯¹è±¡) æ–¹æ³•æ—¶æ“ä½œã€‚</p>
<p>æ³¨æ„, å®ç° <code>ASSIGN-KEY</code> ä¸èƒ½è§£é™¤è®© <code>AT-KEY</code> å˜æˆä¸€ä¸ª <code>rw</code> æ–¹æ³•, å› ä¸ºè¯¸å¦‚ <code>%age&lt;Claire&gt;++</code> çš„ä¸å¤ªé‡è¦çš„èµ‹å€¼/ä¿®æ”¹ ä»æ—§ä¼šä½¿ç”¨ <code>AT-KEY</code>ã€‚</p>
<h3 id="bind-key-æ–¹æ³•">BIND-KEY æ–¹æ³•</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">method</span> <span class="nb">BIND-KEY</span> <span class="p">(</span><span class="vg">::?CLASS:D</span><span class="o">:</span> <span class="nv">$key</span><span class="o">,</span> \<span class="nb">new</span><span class="p">)</span>
</code></pre></div><p>æŠŠå€¼æˆ–å®¹å™¨ <code>new</code> ç»‘å®šç»™è·Ÿ <code>$key</code> ç›¸å…³è”çš„æ’æ§½ä¸Š, æ›¿æ¢é‚£å„¿èƒ½æ‰¾åˆ°çš„ä»»ä½•å®¹å™¨ã€‚è¿™æ˜¯å½“ä½ è¿™æ ·å†™çš„æ—¶å€™æ‰€è°ƒç”¨çš„ä¸œè¥¿:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$x</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="nv">%age</span><span class="p">&lt;</span><span class="s">Claire</span><span class="p">&gt;</span> <span class="o">:=</span> <span class="nv">$x</span><span class="p">;</span>
</code></pre></div><p>ä¸€èˆ¬çš„æ•£åˆ—ç±»æ”¯æŒè¿™ä»¥å…è®¸åˆ›å»ºå¤æ‚çš„é“¾æ¥æ•°æ®ç»“æ„, ä½†æ˜¯å¯¹äºæ›´ç‰¹å®šé¢†åŸŸç±»å‹å®ƒå¯èƒ½æ²¡æœ‰æ„ä¹‰, æ‰€ä»¥ä¸å¼ºæ±‚å»å®ç°å®ƒã€‚å¦‚æœä½ æ²¡æœ‰å®ç°è¯¥æ–¹æ³•, ç”¨æˆ·ä¼šè·å¾—ä¸€ä¸ªåˆé€‚çš„é”™è¯¯ä¿¡æ¯, å½“å®ƒä»¬å°è¯•ç»‘å®šåˆ°è¿™ç§ç±»å‹çš„å¯¹è±¡çš„ä¸€ä¸ªä½ç½®æ’æ§½ä¸Šæ—¶ã€‚</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/subscripts" term="subscripts" label="subscripts" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[ä¹°æ°´æœ]]></title>
            <link href="https://ohmyweekly.github.io/notes/2016-04-12-janes-fruit/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2016-04-12-janes-fruit/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-13T00:00:00+08:00</published>
            <updated>2021-07-13T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Janes Fruit</blockquote><h2 id="é—®é¢˜æè¿°">é—®é¢˜æè¿°</h2>
<p>å°è©¹å¦®æ‹¿ç€ 5 ç¾å…ƒå»è¶…å¸‚ä¹°ä¸œè¥¿,  ä¸ºæ–°æ¬æ¥çš„é‚»å±…ä¹°æ°´æœç¯®ç¤¼ç‰©ã€‚å› ä¸ºå¥¹æ˜¯ä¸ªå‹¤å¥‹å¹¶ç¼ºä¹æƒ³è±¡åŠ›çš„å­©çº¸, å¥¹æ‰“ç®—æ­£å¥½èŠ± 5 ç¾å…ƒ, ä¸å¤šä¹Ÿä¸å°‘ã€‚</p>
<p>äº‹å®ä¸Šè¶…å¸‚é‡Œæ°´æœçš„ä»·æ ¼å¹¶éæ•´æ•°, æ­£å¥½èŠ±å…‰ 5 ç¾å…ƒå¹¶ä¸å®¹æ˜“ã€‚ - ä½†æ˜¯è©¹å¦®å·²ç»å‡†å¤‡å¥½äº†ã€‚å¥¹ä»èƒŒåŒ…é‡Œæ‹¿å‡ºä¸Šç½‘æœ¬, è¾“å…¥å¥¹çœ‹åˆ°è¿‡çš„æ°´æœçš„å•ä»·, å¹¶ä¸”å¼€å¯äº†ä¸€ä¸ªç¨‹åºä¸ºå¥¹æ”¶é›† â€” å°±æ˜¯è¿™æ ·, 5 ç¾å…ƒèƒ½ä¹°çš„æ°´æœçš„ç»„åˆå°±å‡ºç°åœ¨å±å¹•ä¸Šã€‚</p>
<p>æŒ‘æˆ˜: ç”¨ä½ é€‰æ‹©çš„è¯­è¨€å±•ç¤ºè©¹å¦®çš„ç¨‹åºæ˜¯ä»€ä¹ˆæ ·å­ã€‚</p>
<ul>
<li>ç›®æ ‡å°±æ˜¯ 500 ç¾åˆ† (ç­‰äº 5 ç¾å…ƒ)</li>
<li>è§£å†³æ–¹æ³•å¯ä»¥åŒ…å«å¤šç§åŒç±»å‹çš„æ°´æœ - å‡è®¾å®ƒä»¬æ•°é‡æ²¡æœ‰é™åˆ¶</li>
<li>è§£å†³æ–¹æ³•æ²¡æœ‰å¿…è¦åŒ…å«æ‰€æœ‰æ°´æœç±»å‹</li>
<li>å¯¹ç»™å®šçš„è¾“å…¥æ£€æµ‹æ‰€æœ‰å¯èƒ½çš„æ–¹æ³•</li>
</ul>
<h2 id="è¾“å…¥æè¿°">è¾“å…¥æè¿°</h2>
<p>æ¯è¡Œä¸€ç§æ°´æœ â€” è§„å®šäº†æ°´æœçš„åå­—(ä¸å«ç©ºæ ¼çš„å•è¯)å’Œæ°´æœçš„å•ä»·(å•ä½ä¸ºç¾åˆ†, æ•´æ•°)</p>
<h2 id="è¾“å‡ºæè¿°">è¾“å‡ºæè¿°</h2>
<p>æ¯ä¸ªè§£å†³æ–¹æ³•ä¸€è¡Œ â€” ç”¨ä»¥é€—å·åˆ†å‰²çš„æ•°é‡+åå­—å¯¹å„¿, æè¿°äº†é‚£ç§ç±»å‹è¦ä¹°çš„æ°´æœæ•°ã€‚</p>
<p>ä¸è¦åˆ—å‡ºæ•°é‡ä¸º 0 çš„æ°´æœã€‚å¦‚æœä¸ºå¤æ•°å°±ç»™åå­—åŠ  <strong>s</strong>ã€‚</p>
<h2 id="è¾“å…¥æ ·æœ¬">è¾“å…¥æ ·æœ¬</h2>
<pre><code>banana 32
kiwi 41
mango 97
papaya 254
pineapple 399
</code></pre><h2 id="è¾“å‡ºæ ·æœ¬">è¾“å‡ºæ ·æœ¬</h2>
<pre><code>6 kiwis, 1 papaya
7 bananas, 2 kiwis, 2 mangos
</code></pre><h2 id="æœ‰æŒ‘æˆ˜çš„è¾“å…¥">æœ‰æŒ‘æˆ˜çš„è¾“å…¥</h2>
<pre><code>apple 59
banana 32
coconut 155
grapefruit 128
jackfruit 1100
kiwi 41
lemon 70
mango 97
orange 73
papaya 254
pear 37
pineapple 399
watermelon 500
</code></pre><p>æ³¨æ„, è¿™ç§è¾“å…¥æœ‰ 180 ç§è§£å†³æ–¹æ³•ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="p">(</span><span class="nv">@names</span><span class="o">,</span> <span class="nv">@prices</span><span class="p">)</span> <span class="o">:=</span> <span class="p">(</span><span class="nv">$_</span><span class="o">Â»[</span><span class="mi">0</span><span class="o">],</span> <span class="nv">$_</span><span class="o">Â»[</span><span class="mi">1</span><span class="o">]Â».</span><span class="nb">Int</span> <span class="k">given</span> <span class="nb">lines</span><span class="o">Â».</span><span class="nb">words</span><span class="p">);</span>

<span class="k">for</span> <span class="nf">find-coefficients</span><span class="p">(</span><span class="mi">500</span><span class="o">,</span> <span class="nv">@prices</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nv">@quantities</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">(</span><span class="nv">@names</span> <span class="ow">Z</span> <span class="nv">@quantities</span><span class="p">)</span>
        <span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">-&gt;</span> <span class="o">[</span><span class="nv">$name</span><span class="o">,</span> <span class="nv">$qty</span><span class="o">]</span> <span class="p">{</span> <span class="p">&#34;</span><span class="nv">$qty</span><span class="s2"> </span><span class="nv">$name</span><span class="p">&#34;</span><span class="o">~</span><span class="p">(&#34;</span><span class="s2">s</span><span class="p">&#34;</span> <span class="k">if</span> <span class="nv">$qty</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="nv">$qty</span> <span class="p">})</span>
        <span class="o">.</span><span class="nb">join</span><span class="p">(&#34;</span><span class="s2">, </span><span class="p">&#34;);</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">find-coefficients</span> <span class="p">(</span><span class="nv">$goal</span><span class="o">,</span> <span class="nv">@terms</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">gather</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">@coefficients</span><span class="p">;</span>

        <span class="k">loop</span> <span class="p">(</span><span class="k">my</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="nv">@terms</span><span class="p">;</span> <span class="nv">@coefficients</span><span class="o">[</span><span class="nv">$i</span><span class="o">]++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">given</span> <span class="o">[+]</span><span class="p">(</span><span class="nv">@coefficients</span> <span class="ow">Z</span><span class="o">*</span> <span class="nv">@terms</span><span class="p">)</span> <span class="o">&lt;=&gt;</span> <span class="nv">$goal</span> <span class="p">{</span>
                <span class="k">when</span> <span class="nb">Less</span> <span class="p">{</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span>                      <span class="p">}</span>
                <span class="k">when</span> <span class="nb">More</span> <span class="p">{</span> <span class="nv">@coefficients</span><span class="o">[</span><span class="nv">$i</span><span class="o">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++</span> <span class="p">}</span>
                <span class="k">when</span> <span class="nb">Same</span> <span class="p">{</span> <span class="nb">take</span> <span class="nv">@coefficients</span><span class="o">.</span><span class="nb">values</span>   <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>åœ¨å¾ªç¯çš„æ¯ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œæ•°ç»„ <code>@coefficients</code> è¢«&quot;å¢ä¸€&quot;ï¼Œå°±åƒå®ƒçš„å…ƒç´ æ˜¯ä¸€ä¸ªæ•°å­—çš„ä½æ•°ä¸€æ · - ä½†ä¸æ˜¯ä¸€ä¸ªæœ‰å›ºå®šåŸºæ•°çš„æ•°å­—ï¼šç›¸åï¼Œåªè¦è¶…è¿‡äº†æœç´¢æ¡ä»¶ï¼ˆsum &gt; goalï¼‰ï¼Œå®ƒå°±ä¼šæº¢å‡º&quot;æ•°å­—&quot;ã€‚</p>
<p>åŒæ ·çš„äº‹æƒ…ä¹Ÿå¯ä»¥ç”¨é€’å½’çš„æ–¹å¼æ›´ä¼˜é›…åœ°å®Œæˆã€‚å¯¹äºé‚£äº›ä¸å–œæ¬¢å¤©çœŸçš„æš´åŠ›è§£å†³æ–¹æ³•çš„äººæ¥è¯´ï¼Œè¿™ä¸ªæŒ‘æˆ˜ä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªå°è¯•ä¸€äº›<a href="https://en.wikipedia.org/wiki/Dynamic_programming">åŠ¨æ€ç¼–ç¨‹</a>æŠ€æœ¯çš„å¥½æœºä¼šã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@fruits</span> <span class="o">=</span> <span class="nb">lines</span><span class="o">Â».</span><span class="nb">split</span><span class="p">(&#34;</span><span class="s2"> </span><span class="p">&#34;)</span><span class="o">.</span><span class="nb">sort</span><span class="p">(</span><span class="o">-*[</span><span class="mi">1</span><span class="o">]</span><span class="p">);</span>
<span class="k">my</span> <span class="nv">@names</span>  <span class="o">=</span> <span class="nv">@fruits</span><span class="o">Â»[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">@prices</span> <span class="o">=</span> <span class="nv">@fruits</span><span class="o">Â»[</span><span class="mi">1</span><span class="o">]Â».</span><span class="nb">Int</span><span class="p">;</span>

<span class="k">for</span> <span class="nf">find-coefficients</span><span class="p">(</span><span class="mi">500</span><span class="o">,</span> <span class="nv">@prices</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nv">@quantities</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">(</span><span class="nv">@names</span> <span class="ow">Z</span> <span class="nv">@quantities</span><span class="p">)</span>
        <span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="k">-&gt;</span> <span class="o">[</span><span class="nv">$name</span><span class="o">,</span> <span class="nv">$qty</span><span class="o">]</span> <span class="p">{</span> <span class="p">&#34;</span><span class="nv">$qty</span><span class="s2"> </span><span class="nv">$name</span><span class="p">&#34;</span><span class="o">~</span><span class="p">(&#34;</span><span class="s2">s</span><span class="p">&#34;</span> <span class="k">if</span> <span class="nv">$qty</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="nv">$qty</span> <span class="p">})</span>
        <span class="o">.</span><span class="nb">join</span><span class="p">(&#34;</span><span class="s2">, </span><span class="p">&#34;);</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">find-coefficients</span> <span class="p">(</span><span class="nv">$goal</span><span class="o">,</span> <span class="nv">@terms</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">gather</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">@initial</span> <span class="o">=</span> <span class="mi">0</span> <span class="ow">xx</span> <span class="nv">@terms</span><span class="p">;</span>

        <span class="k">my</span> <span class="nv">%partials</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="nv">@initial</span><span class="o">,]</span><span class="p">);</span>
        <span class="k">my</span> <span class="nv">@todo</span> <span class="o">=</span> <span class="p">(</span><span class="nv">@initial</span><span class="o">,</span><span class="p">);</span>
        <span class="k">my</span> <span class="nv">%seen-partials</span> <span class="o">:=</span> <span class="nb">SetHash</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>
        <span class="k">my</span> <span class="nv">%seen-solutions</span> <span class="o">:=</span> <span class="nb">SetHash</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>

        <span class="k">while</span> <span class="nv">@todo</span> <span class="p">{</span>
            <span class="k">my</span> <span class="nv">@current</span> <span class="o">:=</span> <span class="nv">@todo</span><span class="o">.</span><span class="nb">shift</span><span class="p">;</span>
            <span class="k">my</span> <span class="nv">$sum</span> <span class="o">=</span> <span class="o">[+]</span> <span class="nv">@current</span> <span class="ow">Z</span><span class="o">*</span> <span class="nv">@terms</span><span class="p">;</span>

            <span class="nb">next</span> <span class="k">if</span> <span class="nv">$sum</span> <span class="o">&gt;</span> <span class="nv">$goal</span><span class="p">;</span>

            <span class="nv">%partials</span><span class="p">{</span><span class="nv">$sum</span><span class="p">}</span><span class="o">.</span><span class="nb">push</span><span class="o">:</span> <span class="nv">@current</span><span class="p">;</span>

            <span class="c1"># Find solutions by adding known partials to the current partial</span>
            <span class="k">for</span> <span class="nv">%partials</span><span class="p">{</span><span class="nv">$goal</span> <span class="o">-</span> <span class="nv">$sum</span><span class="p">}</span><span class="o">[*]</span> <span class="k">-&gt;</span> <span class="nv">@known</span> <span class="p">{</span>
                <span class="o">.</span><span class="nb">take</span> <span class="k">if</span> <span class="o">!</span><span class="nv">%seen-solutions</span><span class="p">{</span><span class="o">~</span><span class="nv">$_</span><span class="p">}</span><span class="o">++</span> <span class="k">given</span> <span class="nb">list</span> <span class="nv">@current</span> <span class="ow">Z</span><span class="o">+</span> <span class="nv">@known</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1"># Schedule additional iterations</span>
            <span class="k">if</span> <span class="nv">$sum</span> <span class="o">&lt;=</span> <span class="nv">$goal</span> <span class="ow">div</span> <span class="mi">2</span> <span class="p">{</span>
                <span class="k">for</span> <span class="nv">@terms</span><span class="o">.</span><span class="nb">keys</span> <span class="p">{</span>
                    <span class="k">my</span> <span class="nv">@next</span> <span class="o">=</span> <span class="nv">@current</span><span class="p">;</span>
                    <span class="nv">@next</span><span class="o">[</span><span class="nv">$_</span><span class="o">]++</span><span class="p">;</span>
                    <span class="nv">@todo</span><span class="o">.</span><span class="nb">push</span><span class="o">:</span> <span class="nv">@next</span> <span class="k">if</span> <span class="o">!</span><span class="nv">%seen-partials</span><span class="p">{</span><span class="o">~</span><span class="nv">@next</span><span class="p">}</span><span class="o">++</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>æ³¨æ„:</p>
<ul>
<li>å¯¹äºæŒ‘æˆ˜çš„è¾“å…¥(è§£ç©ºé—´=1,127,153,664)ï¼Œå®ƒåªéœ€è¦ 4296 æ¬¡è¿­ä»£ï¼Œè€Œæ¯æ¬¡è¿­ä»£éƒ½è¦èŠ±è´¹å‡ æ¬¡å“ˆå¸ŒæŸ¥è¯¢ã€‚</li>
</ul>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/gather" term="gather" label="gather" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[åˆ—è¡¨è§£æ]]></title>
            <link href="https://ohmyweekly.github.io/notes/2016-05-11-list-comprehensions/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2016-05-11-list-comprehensions/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-13T00:00:00+08:00</published>
            <updated>2021-07-13T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>List Comprehensions</blockquote><h2 id="åˆ—è¡¨è§£æ">åˆ—è¡¨è§£æ</h2>
<p>åˆ—è¡¨è§£æå³ List Comprehensionsã€‚</p>
<p>ç”Ÿæˆ <code>1x1, 2x2, 3x3, ..., 10x10</code> çš„åˆ—è¡¨ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">(</span><span class="nv">$_</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">);</span>
</code></pre></div><p><code>for</code> è¯­å¥å‰é¢è¿˜å¯ä»¥æ·»åŠ  if ä¿®é¥°ç¬¦ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä»…ç­›é€‰å‡ºå¶æ•°çš„å¹³æ–¹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">(</span><span class="nv">$_</span><span class="o">**</span><span class="mi">2</span> <span class="k">if</span> <span class="o">!</span><span class="p">(</span><span class="nv">$_</span> <span class="nv">%</span> <span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">);</span>
<span class="p">(</span><span class="nv">$_</span><span class="o">**</span><span class="mi">2</span> <span class="k">if</span> <span class="nv">$_</span> <span class="nv">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># åŒä¸Š</span>
</code></pre></div><p>ç»„åˆå¤šä¸ª if æ¡ä»¶:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@list</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$_</span> <span class="k">if</span> <span class="nv">$_</span> <span class="nv">%2</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nv">$_</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="mi">6</span> <span class="p">);</span> <span class="c1"># [3 5]   </span>
</code></pre></div><p>è¿˜å¯ä»¥ç”Ÿæˆå…¨æ’åˆ—ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">(</span><span class="nv">$_</span> <span class="k">for</span> <span class="p">&#34;</span><span class="s2">ABC</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">comb</span> <span class="ow">X</span><span class="o">~</span> <span class="p">&#34;</span><span class="s2">XYZ</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">comb</span><span class="p">);</span>
<span class="c1"># (&#34;AX&#34;, &#34;AY&#34;, &#34;AZ&#34;, &#34;BX&#34;, &#34;BY&#34;, &#34;BZ&#34;, &#34;CX&#34;, &#34;CY&#34;, &#34;CZ&#34;)</span>

<span class="k">my</span> <span class="nv">@a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="p">);</span>
<span class="k">my</span> <span class="nv">@b</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">6</span><span class="p">);</span>
<span class="k">my</span> <span class="nv">@list</span> <span class="o">=</span> <span class="p">(</span><span class="nv">@a</span> <span class="ow">X</span> <span class="nv">@b</span><span class="p">);</span> <span class="c1"># è¿™å„¿ä¹Ÿå¯ä»¥ç”¨åœ†æ‹¬å·, ä¹Ÿå¯ä»¥ä¸ç”¨</span>
<span class="c1"># [(1 2) (1 4) (1 6) (3 2) (3 4) (3 6) (4 2) (4 4) (4 6)]</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">&gt; <span class="o">(</span><span class="nv">$_</span> when /7$/ <span class="k">for</span> 1..99<span class="o">)</span>
<span class="o">(</span><span class="m">7</span> <span class="m">17</span> <span class="m">27</span> <span class="m">37</span> <span class="m">47</span> <span class="m">57</span> <span class="m">67</span> <span class="m">77</span> <span class="m">87</span> 97<span class="o">)</span>
</code></pre></div><p>å¤§å°å†™è½¬æ¢ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@a</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">Hello World IBM Apple</span><span class="p">&gt;;</span>
<span class="p">(</span><span class="o">.</span><span class="nb">lc</span> <span class="k">for</span> <span class="nv">@a</span><span class="p">);</span> <span class="c1"># hello world ibm apple</span>
</code></pre></div><p>åˆ é™¤å­—ç¬¦ä¸²æœ«å°¾çš„ç©ºç™½ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@freshfruit</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1"> banana</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1"> loganberry </span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">passion fruit </span><span class="p">&#39;;</span>
<span class="p">(</span><span class="o">.</span><span class="nb">trim</span> <span class="k">for</span> <span class="nv">@freshfruit</span><span class="p">);</span> <span class="c1"># &#34;banana&#34; &#34;loganberry&#34; &#34;passion fruit&#34;</span>
</code></pre></div><p>å‘é‡è¿ç®—ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@vec</span> <span class="o">=</span> <span class="mi">2</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">6</span><span class="p">;</span>
<span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="nv">$_</span> <span class="k">for</span> <span class="nv">@vec</span><span class="p">);</span>            <span class="c1"># 6 12 18</span>
<span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="nv">$_</span> <span class="k">if</span> <span class="nv">$_</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="k">for</span> <span class="nv">@vec</span><span class="p">);</span>  <span class="c1"># 12 18</span>
<span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="nv">$_</span> <span class="k">if</span> <span class="nv">$_</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="k">for</span> <span class="nv">@vec</span><span class="p">);</span>  <span class="c1"># ()</span>
</code></pre></div><p>åµŒå¥—æ•°ç»„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@vec</span> <span class="o">=</span> <span class="mi">2</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">6</span><span class="p">;</span>
<span class="p">(</span><span class="o">[</span><span class="nv">$_</span><span class="o">,</span> <span class="nv">$_</span><span class="o">**</span><span class="mi">2</span><span class="o">].</span><span class="nb">perl</span> <span class="k">for</span> <span class="nv">@vec</span><span class="p">);</span> <span class="c1"># [2, 4] [4, 16] [6, 36]</span>
<span class="p">(</span><span class="o">[</span><span class="nv">$_</span><span class="o">,</span> <span class="nv">$_</span><span class="o">**</span><span class="mi">2</span><span class="o">].</span><span class="nb">WHAT</span> <span class="k">for</span> <span class="nv">@vec</span><span class="p">);</span> <span class="c1"># (Array) (Array) (Array)</span>
</code></pre></div><p>å¤šä¸ªåˆ—è¡¨ä¹‹é—´çš„åˆ—è¡¨è§£æ:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@vec1</span> <span class="o">=</span> <span class="mi">2</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">6</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">@vec2</span> <span class="o">=</span> <span class="mi">4</span><span class="o">,</span><span class="mi">3</span><span class="o">,-</span><span class="mi">9</span><span class="p">;</span>
<span class="p">(</span><span class="nv">$_</span> <span class="k">for</span> <span class="nv">@vec1</span> <span class="ow">X</span><span class="o">*</span> <span class="nv">@vec2</span><span class="p">);</span>     <span class="c1"># 8 6 -18 16 12 -36 24 18 -54</span>
<span class="p">(</span><span class="nv">$_</span> <span class="k">for</span> <span class="nv">@vec1</span> <span class="ow">X</span><span class="o">+</span> <span class="nv">@vec2</span><span class="p">);</span>     <span class="c1"># 5 -7 8 7 -5 10 9 -3</span>
<span class="p">(</span><span class="nv">$_</span> <span class="k">for</span> <span class="nv">@vec1</span> <span class="ow">Z</span><span class="o">*</span> <span class="nv">@vec2</span><span class="p">);</span>     <span class="c1"># 8 12 -54</span>
<span class="p">(</span><span class="nv">$_</span> <span class="k">for</span> <span class="nv">@vec1</span> <span class="o">&gt;&gt;*&lt;&lt;</span> <span class="nv">@vec2</span><span class="p">);</span>  <span class="c1"># 8 12 -54</span>
</code></pre></div><p>ä½¿ç”¨åˆ—è¡¨è§£æå¤„ç†çŸ©é˜µ:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">&gt; my @a <span class="o">=</span> <span class="o">([</span>1,2,3<span class="o">]</span>, <span class="o">[</span>4,5,6<span class="o">]</span>, <span class="o">[</span>7,8,9<span class="o">])</span><span class="p">;</span>
&gt; @a<span class="o">[</span>0<span class="o">]</span>                    <span class="c1"># 1 2 3</span>
&gt; @a<span class="o">[</span>0<span class="o">][</span>1<span class="o">]</span>                 <span class="c1"># 2</span>
&gt; @a<span class="o">[</span>0<span class="o">][</span>2<span class="o">]</span>                 <span class="c1"># 3</span>
&gt; <span class="o">(</span><span class="nv">$_</span><span class="o">[</span>1<span class="o">]</span> <span class="k">for</span> @a<span class="o">)</span>           <span class="c1"># 2 5 8</span>
&gt; <span class="o">(</span><span class="nv">$_</span><span class="o">[</span>2<span class="o">]</span> <span class="k">for</span> @a<span class="o">)</span>           <span class="c1"># 3 6 9</span>
&gt; <span class="o">(</span><span class="nv">$_</span><span class="o">[</span>2<span class="o">]</span>-1 <span class="k">for</span> @a<span class="o">)</span>         <span class="c1"># 2 5 8</span>
&gt; <span class="o">(</span>@a<span class="o">[</span><span class="nv">$_</span><span class="o">][</span><span class="nv">$_</span><span class="o">]</span> <span class="k">for</span> 0..2<span class="o">)</span>    <span class="c1"># 1 5 9</span>
</code></pre></div><p>çŸ©é˜µè½¬ç½®:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">transpose</span> <span class="p">(</span><span class="nv">@m</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">@m</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="nb">keys</span><span class="o">.</span><span class="nb">map</span><span class="o">:</span> <span class="p">{</span><span class="o">[</span> <span class="nv">@m</span><span class="o">Â»[</span><span class="nv">$_</span><span class="o">]</span> <span class="o">]</span><span class="p">};</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">@a</span> <span class="o">=</span> <span class="o">[</span><span class="p">&lt;</span><span class="s"> a b c d e </span><span class="p">&gt;</span><span class="o">],</span>
        <span class="o">[</span><span class="p">&lt;</span><span class="s"> f g h i j </span><span class="p">&gt;</span><span class="o">],</span>
        <span class="o">[</span><span class="p">&lt;</span><span class="s"> k l m n o </span><span class="p">&gt;</span><span class="o">],</span>
        <span class="o">[</span><span class="p">&lt;</span><span class="s"> p q r s t </span><span class="p">&gt;</span><span class="o">]</span><span class="p">;</span>

<span class="p">(</span><span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="nv">@a</span><span class="o">.&amp;</span><span class="nf">transpose</span><span class="p">);</span>
</code></pre></div><pre><code>a f k p
b g l q
c h m r
d i n s
e j o t
</code></pre><p>ä¸€ä¸¢ä¸¢è§£é‡Šï¼š<code>@m[0].keys</code> è·å– <code>column index</code>, æ ¹æ®è·å–åˆ°çš„åˆ—ç´¢å¼•, ä½¿ç”¨è¶…è¿ç®—ç¬¦ <code>Â»</code> éå†æ•°ç»„ä¸­å¯¹åº”åˆ—ç´¢å¼•ä½ç½®çš„å…ƒç´ ã€‚æ³¨æ„ <code>[]</code> å®é™…ä¸Šæ˜¯åç¼€æ“ä½œç¬¦, åŸæ¥ä½¿ç”¨ <code>Â».[]</code> çš„è¯­æ³•æ˜¯é”™è¯¯çš„ã€‚</p>
<p>ä½¿ç”¨ gather è¿›è¡Œåˆ—è¡¨è§£æï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@s</span> <span class="o">=</span> <span class="k">gather</span> <span class="p">{</span> <span class="k">for</span> <span class="o">^</span><span class="mi">100</span> <span class="p">{</span> <span class="nb">take</span> <span class="mi">2</span> <span class="o">*</span> <span class="nv">$_</span> <span class="k">if</span> <span class="nv">$_</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="p">}</span> <span class="p">};</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># 1åˆ°20ä¹‹é—´å“ªäº›æ•°å­—ç»„æˆç›´è§’ï¼Ÿ</span>
<span class="k">my</span> <span class="nv">$n</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">@a</span> <span class="o">=</span> <span class="k">gather</span> <span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="nv">$n</span> <span class="k">-&gt;</span> <span class="nv">$x</span> <span class="p">{</span>
    <span class="k">for</span> <span class="nv">$x</span><span class="o">..</span><span class="nv">$n</span> <span class="k">-&gt;</span> <span class="nv">$y</span> <span class="p">{</span>
        <span class="k">for</span> <span class="nv">$y</span><span class="o">..</span><span class="nv">$n</span> <span class="k">-&gt;</span> <span class="nv">$z</span> <span class="p">{</span>
            <span class="nb">take</span> <span class="nv">$x</span><span class="o">,</span><span class="nv">$y</span><span class="o">,</span><span class="nv">$z</span> <span class="k">if</span> <span class="nv">$x</span><span class="o">*</span><span class="nv">$x</span> <span class="o">+</span> <span class="nv">$y</span><span class="o">*</span><span class="nv">$y</span> <span class="o">==</span> <span class="nv">$z</span><span class="o">*</span><span class="nv">$z</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nb">say</span> <span class="p">&#34;</span><span class="nv">@a</span><span class="o">[]</span><span class="p">&#34;;</span>

<span class="c1"># 3 4 5 5 12 13 6 8 10 8 15 17 9 12 15 12 16 20Â  Â  Â  Â </span>
</code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/list-comprehensions" term="list-comprehensions" label="List Comprehensions" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä¸­çš„åŠ¨æ€å˜é‡]]></title>
            <link href="https://ohmyweekly.github.io/notes/2016-02-29-dynamic-variables-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2016-02-29-dynamic-variables-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-12T00:00:00+08:00</published>
            <updated>2021-07-12T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Dynamic Variables in Raku</blockquote><p>Raku ä¸­çš„<a href="http://qiita.com/B73W56H84/items/18053bf37de8bb2bb808#err">åŠ¨æ€å˜é‡</a></p>
<h2 id="argfiles">$*ARGFILES</h2>
<blockquote>
<p>$*ARGFILES Magic command-line input handle.</p>
</blockquote>
<p><strong><code>argfiles.raku</code></strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="vg">$*ARGFILES</span><span class="o">.</span><span class="nb">raku</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span> <span class="c1"># IO::Handle.new(:path(Any),:chomp)</span>

<span class="c1"># æŒ‰è¡Œè¯»å–</span>
<span class="k">for</span> <span class="vg">$*ARGFILES</span><span class="o">.</span><span class="nb">lines</span> <span class="k">-&gt;</span> <span class="nv">$line</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$line</span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="c1"># ä¸€æ¬¡æ€§è¯»å–</span>
<span class="c1"># say $*ARGFILES.slurp;</span>
</code></pre></div><p><strong><code>USAGE</code></strong></p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ raku argfiles.raku file1 file2 file3 ...
</code></pre></div><ul>
<li><a href="http://doc.raku.org/type/IO::Handle">class IO::Handle - Raku Documentation</a></li>
<li><a href="http://doc.raku.org/language/io">Input/Output - Raku Documentation</a></li>
<li><a href="http://qiita.com/syohex/items/0a7782920968ab105ba0">Rakuæ–‡ä»¶æ“ä½œ - Qiita</a></li>
</ul>
<h2 id="args">@*ARGS</h2>
<blockquote>
<p>@*ARGS - Arguments from the command line. å‘½ä»¤è¡Œä¸­çš„å‚æ•°ã€‚</p>
</blockquote>
<p><strong><code>agrs.raku</code></strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="vg">@*ARGS</span><span class="o">.</span><span class="nf">WAHT</span><span class="p">;</span>    <span class="c1"># (Array)</span>
<span class="nb">say</span> <span class="vg">@*ARGS</span><span class="p">;</span>         <span class="c1"># [a b c d e]</span>
<span class="nb">say</span> <span class="vg">@*ARGS</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>    <span class="c1"># [&#34;a&#34;, &#34;b&#34;, &#34;c&#34;, &#34;d&#34;, &#34;e&#34;]</span>
</code></pre></div><p><strong><code>USAGE</code></strong></p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ raku args.raku a b c d e
</code></pre></div><ul>
<li><a href="http://doc.raku.org/type/Array">class Array - Raku Documentation</a></li>
</ul>
<h2 id="in">$*IN</h2>
<blockquote>
<p>$*IN - æ ‡å‡†è¾“å…¥æ–‡ä»¶å¥æŸ„, ç­‰åŒäº stdin</p>
</blockquote>
<p><strong><code>in.raku</code></strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="vg">$*IN</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>   <span class="c1"># IO::Handle.new(:path(IO::Special.new(what  &#34;&lt;STDIN&gt;&#34;)),:chomp)</span>
<span class="nb">say</span> <span class="vg">$*IN</span><span class="o">.</span><span class="nb">path</span><span class="p">;</span>   <span class="c1"># IO::Special.new(what  &#34;&lt;STDIN&gt;&#34;)</span>
<span class="nb">say</span> <span class="vg">$*IN</span><span class="o">.</span><span class="nb">chomp</span><span class="p">;</span>  <span class="c1"># True</span>

<span class="k">for</span> <span class="vg">$*IN</span><span class="o">.</span><span class="nb">lines</span> <span class="k">-&gt;</span> <span class="nv">$line</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$line</span><span class="p">&#34;;</span>
<span class="p">}</span>
</code></pre></div><p><strong><code>USAGE</code></strong></p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ raku in.raku
äººåŠ›
...

$ cat somefile.txt <span class="p">|</span> raku in.raku
</code></pre></div><h2 id="out">$*OUT</h2>
<blockquote>
<p>$*OUT - æ ‡å‡†è¾“å‡ºæ–‡ä»¶å¥æŸ„, ç­‰åŒäº stdout</p>
</blockquote>
<p><strong><code>out.raku</code></strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="vg">$*OUT</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>   <span class="c1"># IO::Handle.new(:path(IO::Special.new(what  &#34;&lt;STDOUT&gt;&#34;)),:chomp)</span>
<span class="nb">say</span> <span class="vg">$*OUT</span><span class="o">.</span><span class="nb">path</span><span class="p">;</span>   <span class="c1"># IO::Special.new(what  &#34;&lt;STDOUT&gt;&#34;)</span>
<span class="nb">say</span> <span class="vg">$*OUT</span><span class="o">.</span><span class="nb">chomp</span><span class="p">;</span>  <span class="c1"># True</span>

<span class="vg">$*OUT</span><span class="o">.</span><span class="nb">say</span><span class="p">(</span> <span class="k">q</span><span class="sa">:to</span><span class="p">/æ–°å¹´å¿«ä¹/ </span><span class="s">);
</span><span class="s">    ç¥ä½ </span><span class="p">æ–°å¹´å¿«ä¹</span>
    <span class="mf">2016.01.23</span>
    <span class="n">è®©æˆ‘å†è¯´ä¸€æ¬¡</span>
<span class="n">æ–°å¹´å¿«ä¹</span>

<span class="c1"># é€šå¸¸æˆ‘ä»¬ä¼šåœ¨æ‰“å°æ—¶çœç•¥ $*OUT</span>
<span class="c1"># say &#34;å“ˆåˆ©è·¯äºš&#34;;</span>
</code></pre></div><p>æœ€åä¸€æ®µä»£ç ä¸­ <code>//</code> ä¸­é—´çš„å­—ç¬¦æ˜¯åˆ†å‰²ç¬¦ã€‚è¿™æ‰“å°å‡º:</p>
<pre><code>ç¥ä½ æ–°å¹´å¿«ä¹
2016.01.23
è®©æˆ‘å†è¯´ä¸€æ¬¡
</code></pre><p><strong><code>USAGE</code></strong></p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ raku out.raku
$ raku out.raku &gt; result.txt
</code></pre></div><ul>
<li><a href="http://doc.raku.org/type/IO">role IO - Raku Documentation</a></li>
</ul>
<h2 id="err">$*ERR</h2>
<blockquote>
<p>$*ERR - æ ‡å‡†é”™è¯¯æ–‡ä»¶å¥æŸ„, ç­‰åŒäº stderr</p>
</blockquote>
<p><strong><code>err.raku</code></strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="vg">$*ERR</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>   <span class="c1"># IO::Handle.new(:path(IO::Special.new(what  &#34;&lt;STDERR&gt;&#34;)),:chomp)</span>
<span class="nb">say</span> <span class="vg">$*ERR</span><span class="o">.</span><span class="nb">path</span><span class="p">;</span>   <span class="c1"># IO::Special.new(what  &#34;&lt;STDERR&gt;&#34;)</span>
<span class="nb">say</span> <span class="vg">$*ERR</span><span class="o">.</span><span class="nb">chomp</span><span class="p">;</span>  <span class="c1"># True</span>

<span class="vg">$*ERR</span><span class="o">.</span><span class="nb">say</span><span class="p">(&#34;</span><span class="s2">æˆ‘é”™äº†</span><span class="p">&#34;);</span>

<span class="c1"># å¹³æ—¶å¯ä»¥ä½¿ç”¨ note</span>
<span class="c1"># note &#34;å‰æ–¹é«˜èƒ½é¢„è­¦&#34;;</span>
</code></pre></div><p><strong><code>USAGE</code></strong></p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ raku err.raku &gt; /dev/null
æˆ‘é”™äº†
</code></pre></div><h2 id="repo">$*REPO</h2>
<blockquote>
<p>$*REPO A variable holding information about modules installed/loaded</p>
</blockquote>
<p><strong><code>repo.raku</code></strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="vg">$*REPO</span><span class="p">;</span>
<span class="nb">say</span> <span class="vg">$*REPO</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>
<span class="nb">say</span> <span class="vg">$*REPO</span><span class="o">.</span><span class="nb">id</span><span class="p">;</span>
<span class="nb">say</span> <span class="vg">$*REPO</span><span class="o">.</span><span class="nf">path-spec</span><span class="p">;</span>
<span class="nb">say</span> <span class="vg">$*REPO</span><span class="o">.</span><span class="nb">loaded</span><span class="p">;</span>
<span class="nb">say</span> <span class="vg">$*REPO</span><span class="o">.</span><span class="nf">repo-chain</span><span class="p">;</span>
</code></pre></div><h2 id="tz">$*TZ</h2>
<blockquote>
<p>$*TZ The system&rsquo;s local timezone.</p>
</blockquote>
<p><strong><code>tz.raku</code></strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="vg">$*TZ</span><span class="p">;</span>      <span class="c1"># 32400</span>
<span class="nb">say</span> <span class="vg">$*TZ</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span> <span class="c1"># 32400</span>
<span class="nb">say</span> <span class="vg">$*TZ</span><span class="o">.</span><span class="nb">WHAT</span><span class="p">;</span> <span class="c1"># (Int)</span>
</code></pre></div><h2 id="cwd">$*CWD</h2>
<blockquote>
<p>$*CWD The Current Working Directory.</p>
</blockquote>
<p><strong><code>cwd.raku</code></strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="vg">$*CWD</span><span class="p">;</span>       <span class="c1"># &#34;/Users/kujira&#34;.IO</span>
<span class="nb">say</span> <span class="vg">$*CWD</span><span class="o">.</span><span class="nb">path</span><span class="p">;</span>  <span class="c1"># /Users/kujira</span>
<span class="nb">say</span> <span class="vg">$*CWD</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>  <span class="c1"># &#34;/Users/kujira&#34;.IO(:SPEC(IO::Spec::Unix),:CWD(&#34;/Users/kujira&#34;))</span>
</code></pre></div><h2 id="kernel">$*KERNEL</h2>
<blockquote>
<p>$*KERNEL Which kernel am I compiled for?</p>
</blockquote>
<p><strong><code>kernel.raku</code></strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="vg">$*KERNEL</span><span class="p">;</span>            <span class="c1"># darwin (15.2.0)</span>
<span class="nb">say</span> <span class="vg">$*KERNEL</span><span class="o">.</span><span class="nb">release</span><span class="p">;</span>    <span class="c1"># Darwin Kernel Version 15.2.0: Fri Nov 13 19:56:56 PST 2015; root:xnu-3248.20.55~2/RELEASE_X86_64</span>
<span class="nb">say</span> <span class="vg">$*KERNEL</span><span class="o">.</span><span class="nb">name</span><span class="p">;</span>       <span class="c1"># darwin</span>
<span class="nb">say</span> <span class="vg">$*KERNEL</span><span class="o">.</span><span class="nb">auth</span><span class="p">;</span>       <span class="c1"># unknown</span>
<span class="nb">say</span> <span class="vg">$*KERNEL</span><span class="o">.</span><span class="nb">version</span><span class="p">;</span>    <span class="c1"># v15.2.0</span>
<span class="nb">say</span> <span class="vg">$*KERNEL</span><span class="o">.</span><span class="nb">signature</span><span class="p">;</span>  <span class="c1"># (Blob)</span>
<span class="nb">say</span> <span class="vg">$*KERNEL</span><span class="o">.</span><span class="nb">desc</span><span class="p">;</span>       <span class="c1"># (Str)</span>

<span class="nb">say</span> <span class="vg">$*KERNEL</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>        <span class="c1"># Kernel.new(release  Str, name  &#34;darwin&#34;, auth  &#34;unknown&#34;, version  Version.new(&#39;15.2.0&#39;), signature  Blob, desc  Str)</span>
<span class="nb">say</span> <span class="vg">$*KERNEL</span><span class="o">.</span><span class="nb">WHAT</span><span class="p">;</span>        <span class="c1"># (Kernel)</span>
</code></pre></div><h2 id="distro">$*DISTRO</h2>
<blockquote>
<p>$*DISTRO Which OS distribution am I compiling under?</p>
</blockquote>
<p><strong><code>distro.raku</code></strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="vg">$*DISTRO</span><span class="p">;</span>           <span class="c1"># macosx (10.11.2)</span>
<span class="nb">say</span> <span class="vg">$*DISTRO</span><span class="o">.</span><span class="nb">name</span><span class="p">;</span>      <span class="c1"># macosx</span>
<span class="nb">say</span> <span class="vg">$*DISTRO</span><span class="o">.</span><span class="nb">is-win</span><span class="p">;</span>    <span class="c1"># False</span>
<span class="nb">say</span> <span class="vg">$*DISTRO</span><span class="o">.</span><span class="nb">version</span><span class="p">;</span>   <span class="c1"># v11.4</span>
<span class="nb">say</span> <span class="vg">$*DISTRO</span><span class="o">.</span><span class="nb">path-sep</span><span class="p">;</span>  <span class="c1"># :</span>
<span class="nb">say</span> <span class="vg">$*DISTRO</span><span class="o">.</span><span class="nb">auth</span><span class="p">;</span>      <span class="c1"># Apple Computer, Inc.</span>
<span class="nb">say</span> <span class="vg">$*DISTRO</span><span class="o">.</span><span class="nb">desc</span><span class="p">;</span>      <span class="c1"># unknown</span>
<span class="nb">say</span> <span class="vg">$*DISTRO</span><span class="o">.</span><span class="nb">release</span><span class="p">;</span>   <span class="c1"># 20F71</span>
<span class="nb">say</span> <span class="vg">$*DISTRO</span><span class="o">.</span><span class="nb">signature</span><span class="p">;</span> <span class="c1"># (Blob)</span>
<span class="nb">say</span> <span class="vg">$*DISTRO</span><span class="o">.</span><span class="nb">gist</span><span class="p">;</span>      <span class="c1"># macosx (11.4)</span>
<span class="nb">say</span> <span class="vg">$*DISTRO</span><span class="o">.</span><span class="nb">Str</span><span class="p">;</span>       <span class="c1"># macosx</span>
<span class="nb">say</span> <span class="vg">$*DISTRO</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>      <span class="c1"># Distro.new(release  &#34;20F71&#34;, path-sep  &#34;:&#34;, name  &#34;macos&#34;, auth  &#34;Apple Inc.&#34;, version  v11.4, signature  Blob, desc  &#34;unknown&#34;)</span>
</code></pre></div><ul>
<li><a href="http://blog.64p.org/entry/2015/09/05/225701">Raku ã§ windows ã‹ã©ã†ã‹åˆ¤å®šã—ãŸã„ - tokuhirom&rsquo;s blog</a></li>
<li><a href="https://github.com/raku/roast/blob/master/S02-magicals/DISTRO.t">DISTRO.t</a></li>
</ul>
<h2 id="vm">$*VM</h2>
<blockquote>
<p>$*VM Which virtual machine am I compiling under?</p>
</blockquote>
<p><strong><code>vm.raku</code></strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="vg">$*VM</span><span class="p">;</span>         <span class="c1"># moar (2021.06)</span>
<span class="nb">say</span> <span class="vg">$*VM</span><span class="o">.</span><span class="nb">config</span><span class="p">;</span>
<span class="nb">say</span> <span class="vg">$*VM</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>
</code></pre></div><h2 id="raku">$*RAKU</h2>
<blockquote>
<p>$*RAKU Which Raku am I compiled for?</p>
</blockquote>
<p><strong><code>perl.raku</code></strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="vg">$*RAKU</span><span class="p">;</span>          <span class="c1"># Raku (6.d)</span>
<span class="nb">say</span> <span class="vg">$*RAKU</span><span class="o">.</span><span class="nb">compiler</span><span class="p">;</span> <span class="c1"># rakudo (2021.06)</span>

<span class="nb">say</span> <span class="vg">$*RAKU</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>     <span class="c1"># Raku.new(compiler  Compiler.new(id  &#34;24F69C23F0D9F44910DEB9B097353B0DD30C7E96&#34;, release  &#34;&#34;, codename  &#34;&#34;, name  &#34;rakudo&#34;, auth  &#34;The Perl Foundation&#34;, version  v2021.06, signature  Blob, desc  Str), name  &#34;Raku&#34;, auth  &#34;The Perl Foundation&#34;, version  v6.d, signature  Blob, desc  Str)</span>
</code></pre></div><h2 id="pid">$*PID</h2>
<blockquote>
<p>$*PID Process ID of the current process.</p>
</blockquote>
<p><strong><code>pid.raku</code></strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="vg">$*PID</span><span class="p">;</span>      <span class="c1"># 35480</span>
<span class="nb">say</span> <span class="vg">$*PID</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span> <span class="c1"># 35480</span>
<span class="nb">say</span> <span class="vg">$*PID</span><span class="o">.</span><span class="nb">WHAT</span><span class="p">;</span> <span class="c1"># (Int)</span>
</code></pre></div><h2 id="program-name">$*PROGRAM-NAME</h2>
<blockquote>
<p>$*PROGRAM-NAME Path to the current executable as it was entered on the command line, or C&lt;-e&gt; if perl was invoked with the -e flag.</p>
</blockquote>
<p><strong><code>program-name.raku</code></strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="vg">$*PROGRAM-NAME</span><span class="p">;</span>
<span class="nb">say</span> <span class="vg">$*PROGRAM-NAME</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>
<span class="nb">say</span> <span class="vg">$*PROGRAM-NAME</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">basename</span><span class="p">;</span>
</code></pre></div><h2 id="program">$*PROGRAM</h2>
<blockquote>
<p>$*PROGRAM Location (in the form of an C<a href="undefined">IO::Path</a>Â object) of the Perl program being executed.</p>
</blockquote>
<p><strong><code>program.raku</code></strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="vg">$*PROGRAM</span><span class="p">;</span>        <span class="c1"># &#34;/Users/kujira/program.raku&#34;.IO</span>
<span class="nb">say</span> <span class="vg">$*PROGRAM</span><span class="o">.</span><span class="nb">Str</span><span class="p">;</span>    <span class="c1"># program.raku</span>
<span class="nb">say</span> <span class="vg">$*PROGRAM</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>   <span class="c1"># &#34;program.raku&#34;.IO(:SPEC(IO::Spec::Unix),:CWD(&#34;/Users/kujira&#34;))</span>
<span class="nb">say</span> <span class="vg">$*PROGRAM</span><span class="o">.</span><span class="nb">SPEC</span><span class="p">;</span>   <span class="c1"># (Unix)</span>
<span class="nb">say</span> <span class="vg">$*PROGRAM</span><span class="o">.</span><span class="nf">CWD</span><span class="p">;</span>    <span class="c1"># /Users/kujira</span>
<span class="nb">say</span> <span class="vg">$*PROGRAM</span><span class="o">.</span><span class="nb">WHAT</span><span class="p">;</span>   <span class="c1"># (Path)</span>
</code></pre></div><h2 id="executable">$*EXECUTABLE</h2>
<blockquote>
<p>$*EXECUTABLE Absolute path of the perl executable that is currently running.</p>
</blockquote>
<p><strong><code>executable.raku</code></strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="vg">$*EXECUTABLE</span><span class="p">;</span>           <span class="c1"># &#34;/usr/local/bin/raku&#34;.IO</span>
<span class="nb">say</span> <span class="vg">$*EXECUTABLE</span><span class="o">.</span><span class="nb">Str</span><span class="p">;</span>       <span class="c1"># /usr/local/bin/raku</span>
<span class="nb">say</span> <span class="vg">$*EXECUTABLE</span><span class="o">.</span><span class="nb">basename</span><span class="p">;</span>  <span class="c1"># raku</span>
<span class="nb">say</span> <span class="vg">$*EXECUTABLE</span><span class="o">.</span><span class="nb">WHAT</span><span class="p">;</span>      <span class="c1"># (Path)</span>
<span class="nb">say</span> <span class="vg">$*EXECUTABLE</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>      <span class="c1"># &#34;/usr/local/bin/raku&#34;.IO(:SPEC(IO::Spec::Unix))</span>
<span class="nb">say</span> <span class="vg">$*EXECUTABLE</span><span class="o">.</span><span class="nb">SPEC</span><span class="p">;</span>      <span class="c1"># (Unix)</span>
</code></pre></div><h2 id="executable-name">$*EXECUTABLE-NAME</h2>
<blockquote>
<p>$*EXECUTABLE-NAME The name of the perl executable that is currently running. (e.g. raku-p, raku-m, Niecza.exe) Favor $*EXECUTABLE because it is not guaranteed that the perl executable is in PATH.</p>
</blockquote>
<p><strong><code>executable-name.raku</code></strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="vg">$*EXECUTABLE-NAME</span><span class="p">;</span>       <span class="c1"># raku</span>
<span class="nb">say</span> <span class="vg">$*EXECUTABLE-NAME</span><span class="o">.</span><span class="nb">WHAT</span><span class="p">;</span>  <span class="c1"># (Str)</span>
</code></pre></div><h2 id="user">$*USER</h2>
<blockquote>
<p>$*USER The user that is running the program. It is an object that evaluates to &ldquo;username (uid)&rdquo;. It will evaluate to the username only if treated as a string and the numeric user id if treated as a number.</p>
</blockquote>
<p><strong><code>user.raku</code></strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="vg">$*USER</span><span class="p">;</span>      <span class="c1"># kujira (801)</span>
<span class="nb">say</span> <span class="o">+</span><span class="vg">$*USER</span><span class="p">;</span>     <span class="c1"># 801</span>
<span class="nb">say</span> <span class="o">~</span><span class="vg">$*USER</span><span class="p">;</span>     <span class="c1"># kujira</span>
<span class="nb">say</span> <span class="vg">$*USER</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span> <span class="c1"># IdName.new</span>
</code></pre></div><h2 id="group">$*GROUP</h2>
<blockquote>
<p>$*GROUP The primary group of the user who is running the program. It is an object that evaluates to &ldquo;groupname (gid)&rdquo;. It will evaluate to the groupname only if treated as a string and the numeric group id if treated as a number.</p>
</blockquote>
<p><strong><code>group.raku</code></strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="vg">$*GROUP</span><span class="p">;</span>       <span class="c1"># whale (0)</span>
<span class="nb">say</span> <span class="o">~</span><span class="vg">$*GROUP</span><span class="p">;</span>      <span class="c1"># whale</span>
<span class="nb">say</span> <span class="o">+</span><span class="vg">$*GROUP</span><span class="p">;</span>      <span class="c1"># 0</span>
<span class="nb">say</span> <span class="vg">$*GROUP</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>  <span class="c1"># IdName.new</span>
</code></pre></div><h2 id="home">$*HOME</h2>
<blockquote>
<p>$*HOME An L<a href="undefined">IO::Path</a>Â object representing the &ldquo;home directory&rdquo; of the user that is running the program. If the &ldquo;home directory&rdquo; cannot be determined it will be L</p>
</blockquote>
<p><strong><code>home.raku</code></strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="vg">$*HOME</span><span class="p">;</span>       <span class="c1"># &#34;/Users/kujira&#34;.IO</span>
<span class="nb">say</span> <span class="vg">$*HOME</span><span class="o">.</span><span class="nf">CWD</span><span class="p">;</span>   <span class="c1"># /Users/kujira</span>
<span class="nb">say</span> <span class="vg">$*HOME</span><span class="o">.</span><span class="nb">SPEC</span><span class="p">;</span>  <span class="c1"># (Unix)</span>
<span class="nb">say</span> <span class="vg">$*HOME</span><span class="o">.</span><span class="nb">WHAT</span><span class="p">;</span>  <span class="c1"># (Path)</span>
<span class="nb">say</span> <span class="vg">$*HOME</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>  <span class="c1"># &#34;/Users/kujira&#34;.IO(:SPEC(IO::Spec::Unix),:CWD(&#34;/Users/kujira&#34;))</span>
</code></pre></div><ul>
<li><a href="http://doc.raku.org/type/IO::Path">class IO::Path - Raku Documentation</a></li>
</ul>
<h2 id="spec">$*SPEC</h2>
<blockquote>
<p>$*SPEC The appropriate IO::SpecÂ sub-class for the platform that the program is running on.</p>
</blockquote>
<p><strong><code>spec.raku</code></strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="vg">$*SPEC</span><span class="p">;</span>          <span class="c1"># (Unix)</span>
<span class="nb">say</span> <span class="vg">$*SPEC</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>     <span class="c1"># IO::Spec::Unix</span>
<span class="nb">say</span> <span class="vg">$*SPEC</span><span class="o">.</span><span class="nb">path</span><span class="p">;</span>     <span class="c1"># (/usr/local/Cellar/rakudo-star/2015.12/share/raku/site/bin /usr/local/sbin /usr/local/bin /usr/bin /bin /usr/sbin /sbin)</span>
<span class="nb">say</span> <span class="vg">$*SPEC</span><span class="o">.</span><span class="nb">tmpdir</span><span class="p">;</span>   <span class="c1"># &#34;/var/folders/9v/wr31l2zj78x1nw58jgljq_9w0000gn/T&#34;.IO</span>
<span class="nb">say</span> <span class="vg">$*SPEC</span><span class="o">.</span><span class="nb">dir-sep</span><span class="p">;</span>  <span class="c1"># /</span>
<span class="nb">say</span> <span class="vg">$*SPEC</span><span class="o">.</span><span class="nb">curdir</span><span class="p">;</span>   <span class="c1"># .</span>
<span class="nb">say</span> <span class="vg">$*SPEC</span><span class="o">.</span><span class="nb">updir</span><span class="p">;</span>    <span class="c1"># ..</span>
<span class="nb">say</span> <span class="vg">$*SPEC</span><span class="o">.</span><span class="nb">curupdir</span><span class="p">;</span> <span class="c1"># none(., ..)</span>
<span class="nb">say</span> <span class="vg">$*SPEC</span><span class="o">.</span><span class="nb">rootdir</span><span class="p">;</span>  <span class="c1"># /</span>
<span class="nb">say</span> <span class="vg">$*SPEC</span><span class="o">.</span><span class="nb">devnull</span><span class="p">;</span>  <span class="c1"># /dev/null</span>
</code></pre></div><ul>
<li><a href="http://doc.raku.org/type/IO::Spec">class IO::Spec - Raku Documentation</a></li>
<li><a href="http://doc.raku.org/type/IO::Spec::QNX">class IO::Spec::QNX - Raku Documentation</a></li>
<li><a href="http://doc.raku.org/type/IO::Spec::Unix">class IO::Spec::Unix - Raku Documentation</a></li>
<li><a href="http://doc.raku.org/type/IO::Spec::Win32">class IO::Spec::Win32 - Raku Documentation</a></li>
<li><a href="http://doc.raku.org/type/IO::Spec::Cygwin">class IO::Spec::Cygwin - Raku Documentation</a></li>
</ul>
<p><a href="http://qiita.com/B73W56H84/items/18053bf37de8bb2bb808#%E5%8F%82%E8%80%83%E3%81%A8%E6%B3%A8%E9%87%88">http://qiita.com/B73W56H84/items/18053bf37de8bb2bb808#%E5%8F%82%E8%80%83%E3%81%A8%E6%B3%A8%E9%87%88</a></p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/dynamic-variable" term="dynamic-variable" label="dynamic variable" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä¸­çš„æœ¯è¯­]]></title>
            <link href="https://ohmyweekly.github.io/notes/2016-03-26-terms-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2015-11-21-terms-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="Raku ä¸­çš„é¡¹" />
            
                <id>https://ohmyweekly.github.io/notes/2016-03-26-terms-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-12T00:00:00+08:00</published>
            <updated>2021-07-12T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Terms in Raku</blockquote><h2 id="åŒ¿å">åŒ¿å</h2>
<p>å­ä¾‹ç¨‹ã€æ–¹æ³•æˆ–å­æ–¹æ³•ï¼Œå½“å®ƒä»¬ä¸èƒ½é€šè¿‡åå­—è°ƒç”¨æ—¶ï¼Œå°±è¢«ç§°ä¸ºåŒ¿åçš„</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># named subroutine</span>
<span class="k">sub</span> <span class="nf">double</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="mi">2</span> <span class="o">*</span> <span class="nv">$x</span> <span class="p">};</span>
<span class="c1"># åŒ¿åå­ä¾‹ç¨‹,å­˜å‚¨åœ¨ä¸€ä¸ªå…·åçš„æ ‡é‡é‡Œ</span>
<span class="k">my</span> <span class="nv">$double</span> <span class="o">=</span> <span class="k">sub</span> <span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="mi">2</span> <span class="o">*</span> <span class="nv">$x</span> <span class="p">};</span>
</code></pre></div><p>æ³¨æ„ï¼ŒåŒ¿åå­ä¾‹ç¨‹ä»ç„¶å¯ä»¥æœ‰åå­—</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># ä½¿ç”¨ anon å…³é”®å­—ä½¿å­ä¾‹ç¨‹åŒ¿å</span>
<span class="k">my</span> <span class="nv">$s</span> <span class="o">=</span> <span class="k">anon</span> <span class="k">sub</span> <span class="nf">triple</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="mi">3</span> <span class="o">*</span> <span class="nv">$x</span> <span class="p">}</span>
<span class="nb">say</span> <span class="nv">$s</span><span class="o">.</span><span class="nb">name</span><span class="p">;</span>        <span class="c1"># triple</span>
</code></pre></div><h2 id="å‰¯è¯">å‰¯è¯</h2>
<p>é€šå¸¸, å‰¯è¯æ˜¯å‡½æ•°çš„å‘½åå‚æ•°.  ä¹Ÿæœ‰ä¸€äº›å…¶å®ƒç‰¹æ®Šè¯­æ³•å½¢å¼å…è®¸å‰¯è¯å‡ºç°åœ¨æŸäº›åˆé€‚çš„åœ°æ–¹:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">q</span><span class="sa">:w</span><span class="p">&#34;</span><span class="s">foo bar</span>   <span class="c1"># &#34;:w&#34; is a Quotelike form modifier adverb</span>
<span class="k">m</span><span class="p">:</span><span class="na">g</span><span class="p">/</span><span class="sr">a</span><span class="o">|</span><span class="sr">b</span><span class="o">|</span><span class="sr">c</span><span class="p">/</span>     <span class="c1"># &#34;:g&#34; is also</span>
<span class="mi">4</span> <span class="o">+&gt;</span> <span class="mi">5</span> <span class="p">:</span><span class="s">rotate</span> <span class="c1"># &#34;:rotate&#34; is an operator adverb</span>
<span class="nv">@h</span><span class="p">{</span><span class="mi">3</span><span class="p">}:</span><span class="s">exists</span>   <span class="c1"># &#34;:exists&#34; is also, but is known as a subscript adverb</span>
</code></pre></div><p>å‰¯è¯é€šå¸¸ä½¿ç”¨å†’å·å¯¹å„¿æ ‡è®°æ¥è¡¨ç¤º, å› ä¸ºè¿™ä¸ªåŸå› , å†’å·å¯¹å„¿æ ‡è®°æ³•ä¹Ÿä»¥å‰¯è¯å¯¹å„¿å½¢å¼è‘—ç§°:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">:</span><span class="s">a</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>          <span class="c1"># Same as &#34;a&#34; =&gt; 4</span>
</code></pre></div><h2 id="autothreading">Autothreading</h2>
<p><code>Autothreading</code> æ˜¯è¿™æ ·çš„: å¦‚æœä½ ä¼ é€’ä¸€ä¸ª <code>junction</code> ç»™å­ä¾‹ç¨‹, è¯¥å­ä¾‹ç¨‹æœŸæœ›çš„å‚æ•°ç±»å‹ä¸º <code>Any</code> æˆ–å®ƒçš„å­ç±»å‹ã€‚é‚£ä¹ˆè¿™ä¸ªå­ä¾‹ç¨‹è°ƒç”¨ä¼šè¢«æ‰§è¡Œå¤šæ¬¡, æ¯æ¬¡ä½¿ç”¨ä¸€ä¸ªä¸åŒçš„ junction çŠ¶æ€. è¿™äº›è°ƒç”¨çš„ç»“æœè¢«ç»„åˆæˆä¸€ä¸ªè·ŸåŸ <code>junction</code> åŒç±»å‹çš„ <code>junction</code>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">f</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="mi">2</span> <span class="o">*</span> <span class="nv">$x</span> <span class="p">};</span>

<span class="k">if</span> <span class="nb">f</span><span class="p">(</span><span class="mi">1</span><span class="o">|</span><span class="mi">2</span><span class="o">|</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">success</span><span class="p">&#39;;</span>
<span class="p">}</span>
</code></pre></div><p>è¿™é‡Œ <code>f()</code> æ˜¯å«æœ‰ä¸€ä¸ªå‚æ•°çš„å­ä¾‹ç¨‹ï¼Œç„¶è€Œå› ä¸ºå®ƒæ²¡æœ‰æ˜¾å¼çš„ç±»å‹å£°æ˜ï¼Œå®ƒå°±è¢«éšå¼çš„å£°æ˜ä¸º <code>Any</code> å‹ã€‚ Junction å‚æ•°ä½¿ <code>f(1|2|3)</code> è°ƒç”¨åœ¨å†…éƒ¨ä½œä¸º <code>f(1)|f(2)|f(3)</code> æ‰§è¡Œ, è€Œç»“æœæ˜¯è·ŸåŸ <code>junction</code> åŒç±»å‹çš„ <code>junction</code>, å³  <code>2|4|6</code>ã€‚è¿™ç§æŠŠä¸€ä¸ª <code>Junction</code> åˆ†æˆå¯¹å¤šæ¬¡å‡½æ•°è°ƒç”¨çš„å¤„ç†å°±å«åš <code>autothreading</code>ã€‚</p>
<h2 id="colon-pair-å’Œ-colon-list">Colon Pair å’Œ Colon List</h2>
<p>å†’å·å¯¹å„¿æ˜¯ç”¨äºåˆ›å»ºæˆ– Pair å¯¹è±¡çš„ä¾¿æ·è¯­æ³•. ä¸¤ç§æœ€å¸¸è§çš„å½¢å¼æ˜¯:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">:</span><span class="s">a</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>          <span class="c1"># Same as &#34;a&#34; =&gt; 4,   same as Pair.new(:key&lt;a&gt;,:value(5))</span>
<span class="p">:</span><span class="s">a</span><span class="p">&lt;</span><span class="s">4</span><span class="p">&gt;</span>          <span class="c1"># Same as &#34;a&#34; =&gt; &#34;4&#34;, same as Pair.new(:key&lt;a&gt;,:value&lt;5&gt;)</span>
</code></pre></div><p>è¿™ä¹Ÿæ˜¯äººä»¬ç†ŸçŸ¥çš„å‰¯è¯å¯¹å„¿å½¢å¼ã€‚æ³¨æ„, å½“å†’å·åé¢æ‹¬å·å‰é¢çš„éƒ¨åˆ†ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„æ ‡è¯†ç¬¦çš„æ—¶å€™, ä¼šåº”ç”¨å…¶å®ƒè¯­ä¹‰, ä¸æ˜¯æ‰€æœ‰çš„å‰¯è¯å¯¹å„¿éƒ½åˆ›å»º <code>Pair</code> å¯¹è±¡ã€‚
å¦å¤–ä¸¤ä¸ªå¸¸è§çš„å½¢å¼æ˜¯:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">:</span><span class="s">a</span>             <span class="c1"># Same as :a(True)</span>
<span class="p">:!</span><span class="s">a</span>            <span class="c1"># Same as :a(False)</span>
</code></pre></div><p>ä¸€ä¸ª colon åˆ—è¡¨æ˜¯ä¸€ä¸ªä»…åŒ…å«å†’å·å¯¹å„¿çš„åˆ—è¡¨, ä¸éœ€è¦é€—å·, ç”šè‡³ä¸éœ€è¦ç©ºæ ¼:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">:</span><span class="s">a</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span><span class="s">c</span><span class="p">:!</span><span class="s">d</span><span class="p">:</span><span class="s">c</span>   <span class="c1"># Same as a =&gt; 4, c =&gt; True, d =&gt; False, c =&gt; True</span>
</code></pre></div><h2 id="constraint">Constraint</h2>
<p>çº¦æŸæ˜¯ç»™å‚æ•°æˆ– subset ç±»å‹æ·»åŠ çš„é™åˆ¶ã€‚é€šè¿‡å•è¯ where å¼•å…¥çº¦æŸ. åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­, çº¦æŸç”¨äºç¡®ä¿, å½“è°ƒç”¨ä¸€ä¸ªåä¸º abbreviate çš„å­ä¾‹ç¨‹, å…¶å‚æ•°ä¸ºä¸€ä¸ªé•¿åº¦å°äº 10 ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²æ—¶,ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">abbreviate</span> <span class="p">(</span><span class="nb">Str</span> <span class="nv">$thing</span> <span class="k">where</span> <span class="p">{</span> <span class="o">.</span><span class="nb">chars</span> <span class="o">&gt;=</span> <span class="mi">10</span> <span class="p">})</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div><p>ä¸Šä¾‹ä¸­çš„ Str ä¹Ÿæ˜¯ä¸€ä¸ªçº¦æŸ, ä½†æ˜¯ç»å¸¸ä½œä¸º&quot;ç±»å‹çº¦æŸ&quot;.</p>
<h2 id="instance">Instance</h2>
<p>ç±»çš„å®ä¾‹åœ¨å…¶å®ƒç¼–ç¨‹è¯­è¨€ä¸­ä¹Ÿå«å¯¹è±¡. å¯¹è±¡å­˜å‚¨å±æ€§, é€šå¸¸æ˜¯ new æ–¹æ³•è°ƒç”¨çš„è¿”å›å€¼, æˆ–è€…æ˜¯å¯¹è±¡å­—é¢é‡.
å¤§éƒ¨åˆ†ç±»å‹çš„å®ä¾‹è¢«å®šä¹‰ä¸º True, ä¾‹å¦‚ <code>defined($instance)</code> ä¸º Trueã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nb">Str</span> <span class="nv">$str</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">hello</span><span class="p">&#34;;</span>  <span class="c1">## è¿™ä½¿ç”¨å†…å»ºç±»å‹,ä¾‹å¦‚ Str</span>

<span class="k">if</span> <span class="nb">defined</span><span class="p">(</span><span class="nv">$str</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Oh, yeah. I&#39;m defined.</span><span class="p">&#34;;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">No. Something off? </span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="c1">## if you wanted objects...</span>
<span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>
    <span class="c1"># nothing here for now.</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$an_instance</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$an_instance</span><span class="o">.</span><span class="nb">defined</span><span class="o">.</span><span class="nb">perl</span><span class="p">;</span><span class="c1"># defined($an_instance) works too.</span>
</code></pre></div><p>ç±»æ‹¥æœ‰æ–¹æ³•å’Œå±æ€§çš„æ‰€æœ‰è“å›¾, è€Œç±»çš„å®ä¾‹æŠŠè“å›¾å¸¦åˆ°çœŸå®ä¸–ç•Œä¸­ã€‚</p>
<h2 id="invocant">Invocant</h2>
<p>åœ¨ Raku ä¸­è°ƒç”¨æ–¹æ³•çš„å¯¹è±¡å«åšè°ƒç”¨è€…. åœ¨æ–¹æ³•ä¸­å®ƒå°±æ˜¯ <code>self</code> å¼•ç”¨çš„ä¸œè¥¿.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#39;</span><span class="s1">str</span><span class="p">&#39;</span><span class="o">.</span><span class="nb">uc</span><span class="p">;</span>   <span class="c1"># &#39;str&#39; æ˜¯ æ–¹æ³• uc çš„è°ƒç”¨è€…</span>
</code></pre></div><h2 id="literal">Literal</h2>
<p>å­—é¢é‡æ˜¯ä¸€å—ç›´æ¥ä»£è¡¨å¯¹è±¡çš„ä»£ç , é€šå¸¸æŒ‡å‘å¯¹è±¡è‡ªèº«.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$x</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>      <span class="c1"># the 2 is a literal</span>
<span class="nb">say</span> <span class="nv">$x</span><span class="p">;</span>         <span class="c1"># $x is not a literal, but a variable</span>
</code></pre></div><h2 id="lvalue">lvalue</h2>
<p>lvalue æˆ–è€…å·¦å€¼æ˜¯èƒ½å‡ºç°åœ¨èµ‹å€¼æ“ä½œç¬¦å·¦ä¾§çš„ä»»ä½•ä¸œè¥¿; å…¸å‹çš„å·¦å€¼æœ‰å˜é‡, ç§æœ‰å±æ€§å’Œ <code>is rw</code> å±æ€§, å˜é‡åˆ—è¡¨å’Œå·¦å€¼å­ä¾‹ç¨‹ã€‚</p>
<p>å·¦å€¼çš„ä¾‹å­:</p>
<table>
<thead>
<tr>
<th style="text-align:left">Declaration</th>
<th style="text-align:left">lvalue</th>
<th style="text-align:left">Comments</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">my $x;</td>
<td style="text-align:left">$x</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">my ($a, $b);</td>
<td style="text-align:left">($a, $b)</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">has $!attribute;</td>
<td style="text-align:left">$!attribute</td>
<td style="text-align:left">Only inside classes</td>
</tr>
<tr>
<td style="text-align:left">has $.attrib is rw;</td>
<td style="text-align:left">$.attrib</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">sub a is rw { $x };</td>
<td style="text-align:left">a()</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<p>ä¸æ˜¯å·¦å€¼çš„ä¾‹å­:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="mi">3</span>                        <span class="c1"># literals</span>
<span class="k">constant</span> <span class="nb">x</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>          <span class="c1"># constants</span>
<span class="k">has</span> <span class="nv">$.attrib</span><span class="p">;</span>            <span class="c1"># attributes; you can only assign to $!attrib</span>
<span class="k">sub</span> <span class="nb">f</span> <span class="p">{</span> <span class="p">};</span> <span class="nb">f</span><span class="p">();</span>          <span class="c1"># &#34;normal&#34; subs are not writable</span>
<span class="k">sub</span> <span class="nb">f</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$x</span> <span class="o">=</span> <span class="mi">3</span> <span class="p">};</span>    <span class="c1"># error - parameters are read-only by default</span>
</code></pre></div><h2 id="mainline">Mainline</h2>
<p><code>mainline</code> æ˜¯ç¨‹åºä¸­ä¸å±äºä»»ä½• block çš„ç¨‹åºæ–‡æœ¬.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">f</span> <span class="p">{</span>
            <span class="c1"># not in mainline, in sub f</span>
<span class="p">}</span>

<span class="nb">f</span><span class="p">();</span>        <span class="c1"># in mainline again</span>
</code></pre></div><h2 id="slurpy">Slurpy</h2>
<p>å­ä¾‹ç¨‹æˆ–æ–¹æ³•ä¸­çš„å½¢å‚å¦‚æœèƒ½æ¥æ”¶ä»»æ„æ•°é‡çš„å‚æ•°, é‚£è¿™ä¸ªå½¢å‚å°±ä¼šè¢«è®¤ä¸ºæ˜¯ <code>slurpy</code> çš„ã€‚å®ƒç”±å‚æ•°åå­—å‰é¢çš„æ˜Ÿå·æ ‡å‡ºã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">sum</span> <span class="p">(</span><span class="o">*</span><span class="nv">@numbers</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">[+]</span> <span class="nv">@numbers</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><h2 id="type-object">Type Object</h2>
<p>ç±»å‹å¯¹è±¡æ˜¯ä¸€ä¸ªä»£è¡¨ç±» <code>/role/package/grammar/enum</code> çš„å¯¹è±¡ã€‚å®ƒé€šå¸¸å’Œç±»å‹åç›¸åŒã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">A</span> <span class="p">{</span> <span class="p">};</span>

<span class="nb">say</span> <span class="n">A</span><span class="p">;</span>              <span class="c1"># A is the type object</span>
<span class="k">my</span> <span class="nv">$x</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="nb">new</span><span class="p">();</span>    <span class="c1"># same here</span>
<span class="k">my</span> <span class="nv">$x</span> <span class="o">=</span> <span class="k">class</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">greet</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">hi</span><span class="p">&#34;;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># $x now holds a type object returned from the</span>
<span class="c1"># anonymous class definition</span>
</code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/term" term="term" label="term" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä¸­çš„ç­¾å]]></title>
            <link href="https://ohmyweekly.github.io/notes/2016-04-12-signature-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2015-08-29-exploring-raku-signatures-part-two/?utm_source=atom_feed" rel="related" type="text/html" title="æ¢ç´¢ Raku ä¸­çš„ç­¾å(ç¬¬äºŒéƒ¨åˆ†)" />
            
                <id>https://ohmyweekly.github.io/notes/2016-04-12-signature-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-12T00:00:00+08:00</published>
            <updated>2021-07-12T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Signature in Raku</blockquote><h2 id="ç­¾åhttpdocrakuorgtypesignatureä¹Ÿæ˜¯å¯¹è±¡"><a href="http://doc.raku.org/type/Signature">ç­¾å</a>ä¹Ÿæ˜¯å¯¹è±¡</h2>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nb">Signature</span> <span class="p">{}</span>
</code></pre></div><p>ç­¾åæ˜¯ä»£ç å¯¹è±¡<a href="https://docs.raku.org/type/Parameter">å‚æ•°</a>åˆ—è¡¨çš„é™æ€æè¿°ã€‚å³, ç­¾åæè¿°äº†ä½ éœ€è¦ä»€ä¹ˆå‚æ•°å’Œå¤šå°‘å‚æ•°ä¼ é€’ç»™ä»£ç æˆ–å‡½æ•°ä»¥è°ƒç”¨å®ƒä»¬ã€‚</p>
<p>ä¼ é€’å‚æ•°ç»™ç­¾åæŠŠåŒ…å«åœ¨ <strong><a href="https://docs.raku.org/type/Capture">Capture</a></strong> ä¸­çš„å‚æ•°ç»‘å®šåˆ°äº†ç­¾åä¸Šã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">&gt; sub a<span class="o">(</span><span class="nv">$a</span>, <span class="nv">$b</span><span class="o">)</span> <span class="o">{}</span><span class="p">;</span>
&gt; <span class="p">&amp;</span>a.signature.perl.say
:<span class="o">(</span><span class="nv">$a</span>, <span class="nv">$b</span><span class="o">)</span>
&gt; my <span class="nv">$b</span> <span class="o">=</span> -&gt; <span class="nv">$a</span>, <span class="nv">$b</span> <span class="o">{}</span><span class="p">;</span>
&gt; <span class="nv">$b</span>.signature.perl.say
:<span class="o">(</span><span class="nv">$a</span>, <span class="nv">$b</span><span class="o">)</span>
</code></pre></div><p>ç­¾åæ˜¯ä¸€ä¸ªå¯¹è±¡, å°±åƒ Raku ä¸­çš„ä»»ä½•å…¶å®ƒä¸œè¥¿ä¸€æ ·ã€‚ ä»»ä½• <strong>Callable</strong> ç±»å‹ä¸­éƒ½æœ‰ç­¾å, å¹¶ä¸”å®ƒèƒ½ä½¿ç”¨ <code>.signature</code> æ–¹æ³•è·å–åˆ°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nb">Signature</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div><h2 id="ç­¾åå­—é¢é‡">ç­¾åå­—é¢é‡</h2>
<p>ç­¾åå‡ºç°åœ¨<a href="https://docs.raku.org/type/Sub">å­ä¾‹ç¨‹</a>å’Œ<a href="https://docs.raku.org/type/Method">æ–¹æ³•</a>ååé¢çš„åœ†æ‹¬å·ä¸­, å¯¹äº blocks ç­¾åå‡ºç°åœ¨ <code>-&gt;</code> æˆ– <code>&lt;-&gt;</code> ç®­å¤´åé¢, æˆ–è€…ä½œä¸º<a href="https://docs.raku.org/language/variables#Variable_Declarators_and_Scope">å˜é‡å£°æ˜ç¬¦</a>(ä¾‹å¦‚ <a href="https://docs.raku.org/syntax/my">my</a> )çš„è¾“å…¥, æˆ–è€…ä»¥å†’å·å¼€å¤´ä½œä¸ºå•ç‹¬çš„é¡¹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">f</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="c1">#    ^^^^ sub f çš„ç­¾å</span>
<span class="k">method</span> <span class="nb">x</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
<span class="c1">#       ^^ æ–¹æ³• x çš„ç­¾å</span>
<span class="k">my</span> <span class="nv">$s</span> <span class="o">=</span> <span class="k">sub</span> <span class="p">(</span><span class="o">*</span><span class="nv">@a</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="c1">#           ^^^^^ åŒ¿åå‡½æ•°çš„ç­¾å</span>

<span class="k">for</span> <span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;</span> <span class="k">-&gt;</span> <span class="nv">$x</span> <span class="p">{</span> <span class="p">}</span>
<span class="c1">#              ^^    Block çš„ç­¾å</span>

<span class="k">my</span> <span class="p">(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">@b</span><span class="p">)</span> <span class="o">=</span> <span class="mi">5</span><span class="o">,</span> <span class="p">(</span><span class="mi">6</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">8</span><span class="p">);</span>
<span class="c1">#  ^^^^^^^^ å˜é‡å£°æ˜ç¬¦çš„ç­¾å</span>

<span class="k">my</span> <span class="nv">$sig</span> <span class="o">=</span> <span class="o">:</span><span class="p">(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="p">);</span>
<span class="c1">#          ^^^^^^^^ ç‹¬ç«‹çš„ç­¾åå¯¹è±¡</span>
</code></pre></div><p>ç­¾åå­—é¢é‡å¯ä»¥ç”¨äºå®šä¹‰å›è°ƒæˆ–é—­åŒ…çš„ç­¾åã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">f</span><span class="p">(</span><span class="nv">&amp;c:</span><span class="p">(</span><span class="nb">Int</span><span class="p">))</span>    <span class="p">{}</span>
<span class="k">sub</span> <span class="nf">will-work</span><span class="p">(</span><span class="nb">Int</span><span class="p">)</span> <span class="p">{}</span>
<span class="k">sub</span> <span class="nf">won&#39;t-work</span><span class="p">(</span><span class="nb">Str</span><span class="p">){}</span>
<span class="nb">f</span><span class="p">(</span><span class="nv">&amp;will-work</span><span class="p">);</span>

<span class="nb">f</span><span class="p">(</span><span class="nv">&amp;won&#39;t-work</span><span class="p">);</span>
<span class="k">CATCH</span> <span class="p">{</span> <span class="k">default</span> <span class="p">{</span> <span class="nb">put</span> <span class="o">.^</span><span class="nb">name</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">: </span><span class="p">&#39;</span><span class="o">,</span> <span class="o">.</span><span class="nb">Str</span> <span class="p">}</span> <span class="p">};</span>
<span class="c1"># OUTPUT: Â«X::TypeCheck::Binding::Parameter: Constraint type check failed in binding to parameter &#39;&amp;c&#39;â¤Â»</span>

<span class="nb">f</span><span class="p">(</span><span class="k">-&gt;</span> <span class="nb">Int</span> <span class="p">{</span> <span class="p">&#39;</span><span class="s1">this works too</span><span class="p">&#39;</span> <span class="p">}</span> <span class="p">);</span>
</code></pre></div><p>æ”¯æŒç­¾åå’Œåˆ—è¡¨(List)é—´çš„æ™ºèƒ½åŒ¹é…ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$sig</span> <span class="o">=</span> <span class="o">:</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$i</span><span class="o">,</span> <span class="nb">Str</span> <span class="nv">$s</span><span class="p">);</span>
<span class="nb">say</span> <span class="p">(</span><span class="mi">10</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">answer</span><span class="p">&#39;)</span> <span class="o">~~</span> <span class="nv">$sig</span><span class="p">;</span> <span class="c1"># OUTPUT: Â«Trueâ¤Â» </span>

<span class="k">my</span> <span class="nv">$sub</span> <span class="o">=</span> <span class="k">sub</span> <span class="p">(</span> <span class="nb">Str</span> <span class="nv">$s</span><span class="o">,</span> <span class="nb">Int</span> <span class="nv">$i</span> <span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$s</span> <span class="ow">xx</span> <span class="nv">$i</span> <span class="p">};</span>
<span class="nb">say</span> <span class="nv">$sub</span><span class="o">.</span><span class="nb">signature</span> <span class="o">~~</span> <span class="o">:</span><span class="p">(</span> <span class="nb">Str</span><span class="o">,</span> <span class="nb">Int</span> <span class="p">);</span> <span class="c1"># OUTPUT: Â«Trueâ¤Â» </span>

<span class="k">given</span> <span class="nv">$sig</span> <span class="p">{</span>
    <span class="k">when</span> <span class="o">:</span><span class="p">(</span><span class="nb">Str</span><span class="o">,</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">mismatch</span><span class="p">&#39;</span> <span class="p">}</span>
    <span class="k">when</span> <span class="o">:</span><span class="p">(</span><span class="nv">$</span><span class="o">,</span> <span class="nv">$</span><span class="p">)</span>     <span class="p">{</span> <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">match</span><span class="p">&#39;</span> <span class="p">}</span>
    <span class="k">default</span>          <span class="p">{</span> <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">no match</span><span class="p">&#39;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="c1"># OUTPUT: Â«matchâ¤Â» </span>
</code></pre></div><p>å®ƒåŒ¹é…ç¬¬äºŒä¸ª <code>when</code> ä»å¥, å› ä¸º <code>:($, $)</code> è¡¨ç¤ºå¸¦æœ‰ä¸¤ä¸ªæ ‡é‡, åŒ¿åå‚æ•°çš„ <code>Signature</code>, å®ƒæ˜¯ <code>$sig</code> çš„æ›´ä¸€ç‰ˆç‰ˆæœ¬ã€‚</p>
<p>å½“å’Œæ•£åˆ—æ™ºèƒ½åŒ¹é…æ—¶, ç­¾åè¢«è®¤ä¸ºç”±æ•£åˆ—çš„é”®ç»„æˆã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%h</span> <span class="o">=</span> <span class="s">left</span> <span class="o">=&gt;</span> <span class="mi">1</span>, <span class="s">right</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">%h</span> <span class="o">~~</span> <span class="o">:</span><span class="p">(</span><span class="o">:</span><span class="nv">$left</span><span class="o">,</span> <span class="o">:</span><span class="nv">$right</span><span class="p">);</span>
<span class="c1"># OUTPUT</span>
<span class="c1"># True</span>
</code></pre></div><h3 id="å‚æ•°åˆ†éš”ç¬¦">å‚æ•°åˆ†éš”ç¬¦</h3>
<p>ç­¾åç”±é€—å·åˆ†å‰²çš„ 0 ä¸ªæˆ–å¤šä¸ª<a href="https://docs.raku.org/type/Parameter">å½¢å¼å‚æ•°</a>ç»„æˆã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$sig</span> <span class="o">=</span> <span class="o">:</span><span class="p">(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">@b</span><span class="o">,</span> <span class="nv">%c</span><span class="p">)</span>
<span class="k">sub</span> <span class="nb">add</span> <span class="p">(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span> <span class="p">}</span>
</code></pre></div><p>ä½œä¸ºä¸€ä¸ªä¾‹å¤–, ç­¾åä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„åé¢å¯ä»¥è·Ÿç€ä¸€ä¸ªå†’å·è€Œéé€—å·æ¥æ ‡è®°æ–¹æ³•çš„è°ƒç”¨è€…ã€‚è°ƒç”¨è€…æ˜¯ç”¨æ¥è°ƒç”¨æ–¹æ³•çš„å¯¹è±¡, å…¶é€šå¸¸ç»‘å®šåˆ° <a href="https://docs.raku.org/routine/self">self</a>ã€‚ é€šè¿‡åœ¨ç­¾åä¸­æŒ‡å®šè°ƒç”¨è€…, ä½ å¯ä»¥æ›´æ”¹å®ƒç»‘å®šåˆ°çš„å˜é‡åç§°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">method</span> <span class="p">(</span><span class="nv">$a:</span> <span class="nv">@b</span><span class="o">,</span> <span class="nv">%c</span><span class="p">){}</span>  <span class="c1"># ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è°ƒç”¨è€…</span>

<span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">whoami</span> <span class="p">(</span><span class="nv">$me:</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">&#34;</span><span class="s2">Well I&#39;m class </span><span class="nv">$me</span><span class="o">.</span><span class="nf">^name</span><span class="p">()</span><span class="s2">, of course!</span><span class="p">&#34;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="n">Foo</span><span class="o">.</span><span class="nf">whoami</span><span class="p">;</span> <span class="c1"># Well I&#39;m class Foo, of course!</span>
</code></pre></div><h3 id="ç±»å‹çº¦æŸ">ç±»å‹çº¦æŸ</h3>
<p>å‚æ•°å¯ä»¥å¯é€‰åœ°æ‹¥æœ‰ä¸€ä¸ªç±»å‹çº¦æŸ(é»˜è®¤ä¸º <a href="https://docs.raku.org/type/Any">Any</a>)ã€‚è¿™äº›èƒ½ç”¨äºé™åˆ¶å‡½æ•°å…è®¸çš„è¾“å…¥ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$sig</span> <span class="o">=</span> <span class="o">:</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$a</span><span class="o">,</span> <span class="nb">Str</span> <span class="nv">$b</span><span class="p">)</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">divisors</span> <span class="p">(</span><span class="nb">Int</span> <span class="nv">$n</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$_</span> <span class="k">if</span> <span class="nv">$n</span> <span class="nv">%%</span> <span class="nv">$_</span> <span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="nv">$n</span> <span class="p">}</span>
<span class="n">divisors</span> <span class="mf">2.5</span><span class="p">;</span> <span class="c1"># !!! Calling &#39;divisors&#39; will never work with argument types (Rat)</span>
<span class="c1"># ===SORRY!=== Error while compiling: </span>
<span class="c1"># Calling divisors(Rat) will never work with declared signature (Int $n) </span>
</code></pre></div><p>åŒ¿åå‚æ•°ä¹Ÿè¡Œ, å¦‚æœå‚æ•°åªéœ€è¦å®ƒçš„ç±»å‹çº¦æŸçš„è¯ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$sig</span> <span class="o">=</span> <span class="o">:</span><span class="p">(</span><span class="nv">$</span><span class="o">,</span> <span class="nv">@</span><span class="o">,</span> <span class="nv">%a</span><span class="p">)</span>         <span class="c1"># ä¸¤ä¸ªåŒ¿åå‚æ•°å’Œä¸€ä¸ª &#34;æ­£å¸¸çš„(æœ‰åå­—çš„)&#34;å‚æ•°</span>
<span class="nv">$sig</span> <span class="o">=</span> <span class="o">:</span><span class="p">(</span><span class="nb">Int</span><span class="o">,</span> <span class="nb">Positional</span><span class="p">)</span>     <span class="c1"># åªæœ‰ç±»å‹ä¹Ÿè¡Œ(ä¸¤ä¸ªå‚æ•°)</span>
<span class="k">sub</span> <span class="nf">baz</span> <span class="p">(</span><span class="nb">Str</span><span class="p">)</span> <span class="p">{&#34;</span><span class="s2">Got passed a Str</span><span class="p">&#34;}</span>
</code></pre></div><p>ç±»å‹çº¦æŸä¹Ÿå¯ä»¥æ˜¯ç±»å‹æ•è·(<a href="http://doc.raku.org/type/Signature#Type_Captures">type captures</a>)ã€‚</p>
<p>é™¤äº†è¿™äº›åä¹‰ä¸Šçš„ç±»å‹ä¹‹å¤–, é¢å¤–çš„çº¦æŸå¯ä»¥ä»¥ä»£ç å—çš„å½¢å¼åŠ åˆ°å‚æ•°ä¸Š, ä»£ç å—å¿…é¡»è¿”å›ä¸€ä¸ªçœŸå€¼ä»¥é€šè¿‡ç±»å‹æ£€æµ‹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">f</span><span class="p">(</span><span class="nb">Real</span> <span class="nv">$x</span> <span class="k">where</span> <span class="p">{</span> <span class="nv">$x</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">}</span><span class="o">,</span> <span class="nb">Real</span> <span class="nv">$y</span> <span class="k">where</span> <span class="p">{</span> <span class="nv">$y</span> <span class="o">&gt;=</span> <span class="nv">$x</span> <span class="p">})</span> <span class="p">{</span> <span class="p">}</span>
</code></pre></div><p><code>where</code> å­å¥ä¸­çš„ä»£ç æœ‰ä¸€äº›é™åˆ¶ï¼šä»»ä½•ä¼šäº§ç”Ÿå‰¯ä½œç”¨çš„ä¸œè¥¿ï¼ˆä¾‹å¦‚, æ‰“å°è¾“å‡º, ä»è¿­ä»£å™¨ä¸­æ‹‰å–æˆ–é€’å¢çŠ¶æ€å˜é‡ï¼‰éƒ½ä¸å—æ”¯æŒ, å¦‚æœä½¿ç”¨äº†, å¯èƒ½ä¼šäº§ç”Ÿä»¤äººæƒŠè®¶çš„ç»“æœã€‚æ­¤å¤–, åœ¨æŸäº›å®ç°ä¸­, <code>where</code> å­å¥çš„ä»£ç å¯èƒ½ä¼šé’ˆå¯¹å•ä¸ªç±»å‹æ£€æŸ¥è¿è¡Œå¤šæ¬¡ã€‚</p>
<p><code>where</code> å­å¥ä¸éœ€è¦æ˜¯ä»£ç å—, <code>where</code> å­å¥å³ä¾§çš„ä»»ä½•å†…å®¹éƒ½å°†ç”¨äºå’Œå‚æ•°<a href="https://docs.raku.org/language/operators#infix_~~">æ™ºèƒ½åŒ¹é…</a>ã€‚æ‰€ä»¥ä½ ä¹Ÿå¯ä»¥å†™ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="nf">factorial</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$</span> <span class="k">where</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="mi">1</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nf">factorial</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$x</span><span class="p">)</span>        <span class="p">{</span> <span class="nv">$x</span> <span class="o">*</span> <span class="nf">factorial</span><span class="p">(</span><span class="nv">$x</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
</code></pre></div><p>ç¬¬ä¸€ä¸ªè¿˜èƒ½ç®€åŒ–ä¸º:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="nf">factorial</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="mi">1</span> <span class="p">}</span>
</code></pre></div><p>ä½ å¯ä»¥ç›´æ¥æŠŠå­—é¢é‡ç”¨ä½œç±»å‹å¹¶æŠŠå€¼çº¦æŸåˆ°åŒ¿åå‚æ•°ä¸Šã€‚</p>
<p><strong>æç¤º</strong>ï¼šæ³¨æ„ä¸è¦åœ¨ä½ æœ‰å‡ ä¸ªæ¡ä»¶æ—¶ä¸å°å¿ƒç¦»å¼€åŒºå—ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">-&gt;</span> <span class="nv">$y</span> <span class="k">where</span>   <span class="o">.</span><span class="nb">so</span> <span class="o">&amp;&amp;</span> <span class="o">.</span><span class="nb">name</span>    <span class="p">{}(</span> <span class="k">sub</span> <span class="nb">one</span>   <span class="p">{}</span> <span class="p">);</span> <span class="c1"># WRONG!! </span>
<span class="k">-&gt;</span> <span class="nv">$y</span> <span class="k">where</span> <span class="p">{</span> <span class="o">.</span><span class="nb">so</span> <span class="o">&amp;&amp;</span> <span class="o">.</span><span class="nb">name</span> <span class="p">}</span>  <span class="p">{}(</span> <span class="k">sub</span> <span class="nf">two</span>   <span class="p">{}</span> <span class="p">);</span> <span class="c1"># OK! </span>
<span class="k">-&gt;</span> <span class="nv">$y</span> <span class="k">where</span>   <span class="o">.</span><span class="nb">so</span> <span class="o">&amp;</span>  <span class="o">.</span><span class="nb">name</span><span class="o">.</span><span class="nb">so</span> <span class="p">{}(</span> <span class="k">sub</span> <span class="nf">three</span> <span class="p">{}</span> <span class="p">);</span> <span class="c1"># Also good </span>
</code></pre></div><p>ç¬¬ä¸€ä¸ªç‰ˆæœ¬æ˜¯é”™è¯¯çš„, ä¼šå‘å‡ºä¸€ä¸ªå…³äº sub å¯¹è±¡å¼ºåˆ¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„è­¦å‘Šã€‚åŸå› æ˜¯è¡¨è¾¾å¼ç›¸å½“äº <code>($y ~~ ($y.so &amp;&amp; $y.name));</code> é‚£å°±æ˜¯â€œè°ƒç”¨ <code>.so</code>, å¦‚æœå®ƒä¸º <code>True</code>, è°ƒç”¨ <code>.name</code>; å¦‚æœè¿™ä¹Ÿæ˜¯ <code>True</code>, åˆ™ä½¿ç”¨å®ƒçš„å€¼è¿›è¡Œsmartmatching &hellip;â€ã€‚è¿™æ˜¯ <code>(.so &amp;&amp; .name)</code> çš„ç»“æœå°†è¢«æ™ºèƒ½åŒ¹é…, ä½†æˆ‘ä»¬è¦æ£€æŸ¥ <code>.so</code> å’Œ <code>.name</code> æ˜¯å¦ä¸ºçœŸå€¼ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ˜ç¡®çš„ Block æˆ–è€… <a href="https://docs.raku.org/type/Junction">Junction</a> æ˜¯æ­£ç¡®çš„ç‰ˆæœ¬ã€‚</p>
<p>åœ¨ç­¾åä¸­ä¸æ˜¯å­ç­¾å(sub-signature)çš„ä¸€éƒ¨åˆ†çš„æ‰€æœ‰å…ˆå‰çš„å‚æ•°éƒ½å¯ä»¥åœ¨å‚æ•°åé¢çš„ <code>where</code> ä»å¥ä¸­è®¿é—®ã€‚ å› æ­¤, æœ€åä¸€ä¸ªå‚æ•°çš„ where ä»å¥å¯ä»¥è®¿é—®ä¸æ˜¯å­ç­¾åä¸€éƒ¨åˆ†çš„ç­¾åçš„æ‰€æœ‰å‚æ•°ã€‚ å¯¹äºå­ç­¾å, æŠŠ where ä»å¥æ”¾åœ¨å­ç­¾åä¸­ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span> <span class="k">where</span> <span class="o">*</span> <span class="o">==</span> <span class="nv">$a</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$b</span><span class="s2"> is a square of </span><span class="nv">$a</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="n">foo</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="p">;</span> <span class="c1"># OUTPUT: Â«4 is a square of 2â¤Â»Â» </span>
<span class="c1"># foo 2, 3; </span>
<span class="c1"># OUTPUT: Â«Constraint type check failed in binding to parameter &#39;$b&#39;â€¦Â» </span>

<span class="k">sub</span> <span class="nf">one-of-them</span><span class="p">(</span><span class="o">:</span><span class="nv">$a</span><span class="o">,</span> <span class="o">:</span><span class="nv">$b</span><span class="o">,</span> <span class="o">:</span><span class="nv">$c</span> <span class="k">where</span> <span class="p">{</span> <span class="nv">$a</span><span class="o">.</span><span class="nb">defined</span> <span class="o">^^</span> <span class="nv">$b</span><span class="o">.</span><span class="nb">defined</span> <span class="o">^^</span> <span class="nv">$c</span><span class="o">.</span><span class="nb">defined</span> <span class="p">})</span> <span class="p">{</span>
    <span class="nv">$a</span> <span class="o">//</span> <span class="nv">$b</span> <span class="o">//</span> <span class="nv">$c</span>
<span class="p">};</span>
<span class="nb">say</span> <span class="nf">one-of-them</span><span class="p">(</span><span class="s">c</span><span class="o">=&gt;</span><span class="mi">42</span><span class="p">);</span>
<span class="c1"># OUTPUTÂ«42â¤Â»</span>
</code></pre></div><h3 id="çº¦æŸå¯é€‰å‚æ•°">çº¦æŸå¯é€‰å‚æ•°</h3>
<p><a href="https://docs.raku.org/type/Signature#Optional_and_Mandatory_Parameters">å¯é€‰å‚æ•°</a>ä¹Ÿå¯ä»¥æ‹¥æœ‰çº¦æŸã€‚ä»»ä½•å‚æ•° <code>where</code> ä»å¥éƒ½å°†è¢«æ‰§è¡Œ, å³ä½¿å®ƒæ˜¯å¯é€‰çš„, è€Œä¸”ä¸æ˜¯ç”±è°ƒç”¨è€…æä¾›ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹, æ‚¨å¯èƒ½å¿…é¡»é˜²æ­¢ where ä»å¥ä¸­çš„æœªå®šä¹‰å€¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">f</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$a</span><span class="o">,</span> <span class="nb">UInt</span> <span class="nv">$i</span><span class="o">?</span> <span class="k">where</span> <span class="p">{</span> <span class="o">!</span><span class="nv">$i</span><span class="o">.</span><span class="nb">defined</span> <span class="ow">or</span> <span class="nv">$i</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="p">}</span> <span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div><h4 id="çº¦æŸåå™¬å‚æ•°">çº¦æŸåå™¬å‚æ•°</h4>
<p><a href="https://docs.raku.org/type/Slurpy_(A$FULL_STOPK$FULL_STOPA$FULL_STOP_Variadic)_Parameters">åå™¬å‚æ•°</a>ä¸èƒ½æ‹¥æœ‰ç±»å‹çº¦æŸã€‚ä¸€ä¸ª where ä»å¥è¿åŒä¸€ä¸ª <a href="https://docs.raku.org/type/Junction">Junction</a>å¯ä»¥è¾¾åˆ°åŒæ ·çš„é‚£ä¸ªæ•ˆæœã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">f</span><span class="p">(</span><span class="o">*</span><span class="nv">@a</span> <span class="k">where</span> <span class="p">{</span> <span class="nv">$_</span><span class="o">.</span><span class="nb">all</span> <span class="o">~~</span> <span class="nb">Int</span> <span class="p">})</span> <span class="p">{</span> <span class="nb">say</span> <span class="nv">@a</span> <span class="p">};</span>
<span class="nb">f</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
<span class="nb">f</span><span class="p">(&lt;</span><span class="s">a</span><span class="p">&gt;);</span>
<span class="c1"># OUTPUTÂ«[42] Constraint type check failed for parameter &#39;@a&#39;  in sub f at ...Â»</span>
</code></pre></div><h4 id="çº¦æŸå®šä¹‰å€¼å’Œæœªå®šä¹‰å€¼">çº¦æŸå®šä¹‰å€¼å’Œæœªå®šä¹‰å€¼</h4>
<p>é€šå¸¸, ç±»å‹çº¦æŸåªæ£€æŸ¥ä¼ é€’çš„å€¼æ˜¯å¦æ˜¯æ­£ç¡®çš„ç±»å‹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">limit-lines</span> <span class="p">(</span><span class="nb">Str</span> <span class="nv">$s</span><span class="o">,</span> <span class="nb">Int</span> <span class="nv">$limit</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">@lines</span> <span class="o">=</span> <span class="nv">$s</span><span class="o">.</span><span class="nb">lines</span><span class="p">;</span>
    <span class="nv">@lines</span><span class="o">[</span><span class="mi">0</span> <span class="o">..^</span> <span class="nb">min</span> <span class="nv">@lines</span><span class="o">.</span><span class="nb">elems</span><span class="o">,</span> <span class="nv">$limit</span><span class="o">].</span><span class="nb">join</span><span class="p">(&#34;</span><span class="s2">\n</span><span class="p">&#34;)</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="p">(</span><span class="n">limit-lines</span> <span class="p">&#34;</span><span class="s2">a \n b \n c \n d \n</span><span class="p">&#34;</span><span class="o">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="nb">perl</span><span class="p">;</span> <span class="c1"># &#34;a \n b \n c &#34;</span>
<span class="nb">say</span> <span class="n">limit-lines</span> <span class="nb">Str</span><span class="o">,</span>      <span class="mi">3</span><span class="p">;</span>  <span class="c1"># Uh-oh. Dies with &#34;Cannot call &#39;lines&#39;;&#34;</span>

<span class="k">CATCH</span> <span class="p">{</span> <span class="k">default</span> <span class="p">{</span> <span class="nb">put</span> <span class="o">.^</span><span class="nb">name</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">: </span><span class="p">&#39;</span><span class="o">,</span> <span class="o">.</span><span class="nb">Str</span> <span class="p">}</span> <span class="p">};</span>
<span class="c1"># OUTPUT: Â«X::Multi::NoMatch: Cannot resolve caller lines(Str: ); none of these signatures match:</span>
<span class="c1">#     (Cool:D $: |c is raw)</span>
<span class="c1">#     (Str:D $: :$count!, *%_)</span>
<span class="c1">#     (Str:D $: $limit, *%_)</span>
<span class="c1">#     (Str:D $: *%_)Â»</span>

<span class="nb">say</span> <span class="n">limit-lines</span> <span class="p">&#34;</span><span class="s2">a \n b</span><span class="p">&#34;</span><span class="o">,</span> <span class="nb">Int</span> <span class="c1"># Always returns the max number of lines</span>
</code></pre></div><p>è¿™æ ·çš„æƒ…å†µ, æˆ‘ä»¬å…¶å®åªæƒ³å¤„ç†å®šä¹‰äº†çš„å­—ç¬¦ä¸²ã€‚è¦è¿™æ ·åš, æˆ‘ä»¬ä½¿ç”¨ <code>:D</code> ç±»å‹çº¦æŸã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">limit-lines</span> <span class="p">(</span><span class="nb">Str:D</span> <span class="nv">$s</span><span class="o">,</span> <span class="nb">Int</span> <span class="nv">$limit</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="n">limit-lines</span> <span class="nb">Str</span><span class="o">,</span> <span class="mi">3</span><span class="p">;</span>

<span class="k">CATCH</span> <span class="p">{</span> <span class="k">default</span> <span class="p">{</span> <span class="nb">put</span> <span class="o">.^</span><span class="nb">name</span><span class="o">,</span> <span class="o">.</span><span class="nb">Str</span> <span class="p">}</span> <span class="p">};</span>
<span class="c1"># OUTPUTÂ«X::AdHocParameter &#39;$s&#39; requires an instance of type Str, but a</span>
<span class="c1"># type object was passed.  Did you forget a .new?Â»</span>
<span class="c1"># Dies with &#34;å‚æ•° &#39;$s&#39; éœ€è¦ä¸€ä¸ªå®ä¾‹, ä½†æ˜¯å‡½æ•° limit-lines ä¸­å´ä¼ é€’äº†ä¸€ä¸ªç±»å‹å¯¹è±¡ã€‚</span>
</code></pre></div><p>å¦‚æœä¼ é€’ä¸€ä¸ªè¯¸å¦‚ <strong>Str</strong> è¿™æ ·çš„ç±»å‹å¯¹è±¡è¿›å», é‚£ä¹ˆå°±ä¼šæŠ¥é”™ã€‚è¿™æ ·çš„å¤±è´¥æ–¹å¼æ¯”ä»¥å‰æ›´å¥½äº†, å› ä¸ºå¤±è´¥çš„åŸå› æ›´æ¸…æ™°äº†ã€‚</p>
<p>ä¹Ÿæœ‰å¯èƒ½æœªå®šä¹‰çš„ç±»å‹æ˜¯å­ä¾‹ç¨‹å”¯ä¸€æœ‰æ„ä¹‰çš„æ¥æ”¶å€¼ã€‚è¿™å¯ä»¥ä½¿ç”¨ <code>:U</code> ç±»å‹çº¦æŸæ¥çº¦æŸå®ƒã€‚ä¾‹å¦‚, æˆ‘ä»¬å¯ä»¥æŠŠ <code>&amp;limit-lines</code> è½¬æ¢æˆ multi å‡½æ•°ä»¥ä½¿ç”¨ <code>:U</code> çº¦æŸã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span>  <span class="nf">limit-lines</span> <span class="p">(</span><span class="nb">Str</span> <span class="nv">$s</span><span class="o">,</span> <span class="nb">Int:D</span> <span class="nv">$limit</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">@lines</span> <span class="o">=</span> <span class="nv">$s</span><span class="o">.</span><span class="nb">lines</span><span class="p">;</span>
    <span class="nv">@lines</span><span class="o">[</span><span class="mi">0</span> <span class="o">..^</span> <span class="nb">min</span> <span class="nv">@lines</span><span class="o">.</span><span class="nb">elems</span><span class="o">,</span> <span class="nv">$limit</span><span class="o">].</span><span class="nb">join</span><span class="p">(&#34;</span><span class="s2">\n</span><span class="p">&#34;);</span>
<span class="p">}</span>

<span class="k">multi</span> <span class="nf">limit-lines</span> <span class="p">(</span><span class="nb">Str</span> <span class="nv">$s</span><span class="o">,</span> <span class="nb">Int:U</span> <span class="nv">$</span><span class="p">)</span> <span class="p">{</span><span class="nv">$s</span><span class="p">}</span> <span class="c1"># å¦‚æœä¼ é€’ç»™æˆ‘ä¸€ä¸ªæœªå®šä¹‰çš„ç±»å‹å¯¹è±¡, å°±è¿”å›æ•´ä¸ªå­—ç¬¦ä¸²</span>

<span class="nb">say</span> <span class="n">limit-lines</span> <span class="p">&#34;</span><span class="s2">a \n b \n c</span><span class="p">&#34;</span><span class="o">,</span> <span class="nb">Int</span><span class="p">;</span>      <span class="c1"># &#34;a \n b \n c&#34;</span>
</code></pre></div><p>ä¸ºäº†æ˜¾å¼åœ°æ ‡ç¤ºå¸¸è§„çš„è¡Œä¸º, å¯ä»¥ä½¿ç”¨ <code>:_</code>, ä½†è¿™ä¸æ˜¯å¿…é¡»çš„ã€‚ <code>:(Num:_ $)</code> å’Œ <code>:(Num $)</code> ç›¸åŒã€‚</p>
<h4 id="çº¦æŸ-callables-çš„ç­¾å">çº¦æŸ Callables çš„ç­¾å</h4>
<p>è¦åŸºäº blockå’Œå­ä¾‹ç¨‹çš„ç­¾åçº¦æŸ block å’Œå­ä¾‹ç¨‹å¼•ç”¨, å‚æ•°åè¦å†™åœ¨ç­¾åçš„åé¢ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">f</span><span class="p">(</span><span class="nv">&amp;c:</span><span class="p">(</span><span class="nb">Int</span><span class="o">,</span> <span class="nb">Str</span><span class="p">))</span>  <span class="p">{</span> <span class="nb">say</span> <span class="nf">c</span><span class="p">(</span><span class="mi">10</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">ten</span><span class="p">&#39;)</span> <span class="p">};</span>
<span class="k">sub</span> <span class="nf">g</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$i</span><span class="o">,</span> <span class="nb">Str</span> <span class="nv">$s</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$s</span> <span class="o">~</span> <span class="nv">$i</span>          <span class="p">};</span>

<span class="nb">f</span><span class="p">(</span><span class="nv">&amp;g</span><span class="p">);</span>

<span class="c1"># OUTPUT: ten10</span>
</code></pre></div><h4 id="çº¦æŸè¿”å›ç±»å‹">çº¦æŸè¿”å›ç±»å‹</h4>
<p><code>--&gt;</code> æ ‡è®°åé¢è·Ÿç€ä¸€ä¸ªç±»å‹ä¼šå¼ºåˆ¶åœ¨å­ä¾‹ç¨‹æ‰§è¡ŒæˆåŠŸæ—¶è¿›è¡Œç±»å‹æ£€æµ‹ã€‚è¿”å›ç±»å‹ç®­å¤´å¿…é¡»æ”¾åœ¨å‚æ•°åˆ—è¡¨çš„åé¢ã€‚è·Ÿåœ¨ç­¾åå£°æ˜åé¢çš„ <code>returns</code> å…³é”®å­—æœ‰åŒæ ·çš„åŠŸèƒ½ã€‚<code>Nil</code> åœ¨ç±»å‹æ£€æµ‹ä¸­è¢«è®¤ä¸ºæ˜¯å®šä¹‰äº†çš„ã€‚è¿™å…è®¸æ²¿ç€è°ƒç”¨é“¾è¿”å›å’Œä¼ é€’ <a href="https://docs.raku.org/type/Failure">Failure</a>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="p">(</span><span class="k">--&gt;</span> <span class="nb">Int</span><span class="p">)</span>   <span class="p">{</span> <span class="k">my</span> <span class="nb">Int</span> <span class="nv">$i</span><span class="p">;</span> <span class="nv">$i</span><span class="p">};</span>
<span class="k">sub</span> <span class="p">(</span><span class="k">--&gt;</span> <span class="nb">Int:D</span><span class="p">)</span>    <span class="p">{</span> <span class="mi">1</span> <span class="p">};</span>
<span class="k">sub</span> <span class="p">()</span> <span class="k">returns</span> <span class="nb">Int</span> <span class="p">{</span> <span class="mi">1</span> <span class="p">};</span>

<span class="k">sub</span> <span class="nf">foo</span><span class="p">(</span><span class="k">--&gt;</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">{</span> <span class="mi">1</span> <span class="p">};</span>
<span class="k">sub</span> <span class="nf">foo</span><span class="p">()</span> <span class="k">returns</span> <span class="nb">Int</span> <span class="p">{</span> <span class="mi">1</span> <span class="p">};</span>        <span class="c1"># åŒä¸Š</span>
<span class="k">sub</span> <span class="nf">does-not-work</span><span class="p">(</span><span class="k">--&gt;</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#34;&#34;</span> <span class="p">};</span> <span class="c1"># throws X::TypeCheck::Return</span>
</code></pre></div><p>å¦‚æœç±»å‹çº¦æŸæ˜¯ä¸€ä¸ªå¸¸é‡è¡¨è¾¾å¼, é‚£ä¹ˆå®ƒè¢«ç”¨äºå­ä¾‹ç¨‹çš„è¿”å›å€¼ã€‚é‚£ä¸ªå­ä¾‹ç¨‹ä¸­çš„ä»»ä½• <strong>return</strong> è¯­å¥å¿…é¡»æ˜¯ä¸å«å‚æ•°çš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">foo</span><span class="p">(</span><span class="k">--&gt;</span> <span class="mi">123</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
</code></pre></div><p><code>Nil</code> å’Œ <code>Failure</code> æ€»æ˜¯è¢«å…è®¸ä½œä¸ºè¿”å›ç±»å‹, ä¸ç®¡ç±»å‹çº¦æŸæ˜¯ä»€ä¹ˆã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">foo</span><span class="p">(</span><span class="k">--&gt;</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">{</span> <span class="nb">Nil</span> <span class="p">};</span>
<span class="nb">say</span> <span class="n">foo</span><span class="o">.</span><span class="nb">perl</span><span class="p">;</span> <span class="c1"># Nil</span>
</code></pre></div><p>ä¸æ”¯æŒç±»å‹æ•è·å’Œå¼ºåˆ¶ç±»å‹ã€‚</p>
<h4 id="å¼ºåˆ¶ç±»å‹">å¼ºåˆ¶ç±»å‹</h4>
<p>è¦æ¥å—ä¸€ä¸ªç±»å‹ä½†æ˜¯å¼ºåˆ¶å®ƒè‡ªåŠ¨åœ°è½¬ä¸ºå¦ä¸€ç§ç±»å‹, ä½¿ç”¨æ¥å—çš„ç±»å‹ä½œä¸ºç›®æ ‡ç±»å‹çš„å‚æ•°ã€‚å¦‚æœæ¥å—çš„ç±»å‹æ˜¯ Any, é‚£ä¹ˆå®ƒå¯ä»¥è¢«çœç•¥ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">f</span><span class="p">(</span><span class="nb">Int</span><span class="p">(</span><span class="nb">Str</span><span class="p">)</span> <span class="nv">$want-int</span><span class="o">,</span> <span class="nb">Str</span><span class="p">()</span> <span class="nv">$want-str</span><span class="p">)</span> <span class="p">{</span> <span class="nb">say</span> <span class="nv">$want-int</span><span class="o">.</span><span class="nb">WHAT</span><span class="o">,</span> <span class="nv">$want-str</span><span class="o">.</span><span class="nb">WHAT</span> <span class="p">}</span>
<span class="nb">f</span> <span class="p">&#39;</span><span class="s1">10</span><span class="p">&#39;</span><span class="o">,</span> <span class="mi">10</span><span class="p">;</span>

<span class="c1"># OUTPUT</span>
<span class="c1"># (Int)(Str)</span>
</code></pre></div><h3 id="åå™¬å‚æ•°æˆ–é•¿åº¦å¯å˜å‚æ•°">åå™¬å‚æ•°(æˆ–é•¿åº¦å¯å˜å‚æ•°)</h3>
<p>æ•°ç»„æˆ–æ•£åˆ—å‚æ•°å¯ä»¥é€šè¿‡å‰ç½®ä¸€ä¸ªæ˜Ÿå·(s)è¢«æ ‡è®°ä¸ºåå™¬å‚æ•°, è¿™æ„å‘³ç€å®ƒå¯ä»¥è¢«ç»‘å®šç»™ä»»æ„æ•°é‡çš„å‚æ•°(0 ä¸ªæˆ– å¤šä¸ª)ã€‚</p>
<p>å®ƒä»¬è¢«å«åšåå™¬å‚æ•°, å› ä¸ºå®ƒä»¬åå®Œå‡½æ•°ä¸­çš„ä»»ä½•å‰©ä½™å‚æ•°, å°±åƒæœ‰äº›äººååƒé¢æ¡é‚£æ ·ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$</span> <span class="o">=</span> <span class="o">:</span><span class="p">(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">@b</span><span class="p">)</span>  <span class="c1"># æ­£å¥½ä¸¤ä¸ªå‚æ•°, è€Œç¬¬äºŒä¸ªå‚æ•°å¿…é¡»æ˜¯ Positional çš„</span>
<span class="nv">$</span> <span class="o">=</span> <span class="o">:</span><span class="p">(</span><span class="nv">$a</span><span class="o">,</span> <span class="o">*</span><span class="nv">@b</span><span class="p">)</span> <span class="c1"># è‡³å°‘ä¸€ä¸ªå‚æ•°, @b åå™¬å®Œä»»ä½•å‰©ä½™çš„å‚æ•°</span>
<span class="nv">$</span> <span class="o">=</span> <span class="o">:</span><span class="p">(</span><span class="o">*</span><span class="nv">%h</span><span class="p">)</span>     <span class="c1"># æ²¡æœ‰ä½ç½®å‚æ•°, é™¤äº†ä»»æ„æ•°é‡çš„å…·åå‚æ•°</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">one-arg</span> <span class="p">(</span><span class="nv">@</span><span class="p">)</span>  <span class="p">{</span> <span class="p">}</span>
<span class="k">sub</span> <span class="nb">slurpy</span>  <span class="p">(</span><span class="o">*</span><span class="nv">@</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="n">one-arg</span> <span class="p">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">7</span><span class="p">);</span>   <span class="c1"># ok, same as one-arg((5, 6, 7))</span>
<span class="nb">slurpy</span>  <span class="p">(</span><span class="mi">5</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">7</span><span class="p">);</span>   <span class="c1"># ok</span>
<span class="nb">slurpy</span>   <span class="mi">5</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">7</span> <span class="p">;</span>   <span class="c1"># ok</span>
<span class="c1"># one-arg(5, 6, 7) ; # X::TypeCheck::Argument</span>
<span class="c1"># one-arg  5, 6, 7 ; # X::TypeCheck::Argument</span>

<span class="k">sub</span> <span class="nf">named-names</span> <span class="p">(</span><span class="o">*</span><span class="nv">%named-args</span><span class="p">)</span> <span class="p">{</span> <span class="nv">%named-args</span><span class="o">.</span><span class="nb">keys</span> <span class="p">};</span>
<span class="nb">say</span> <span class="n">named-names</span> <span class="p">:</span><span class="s">foo</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span> <span class="p">:</span><span class="s">bar</span><span class="p">&lt;</span><span class="s">baz</span><span class="p">&gt;;</span> <span class="c1"># foo bar</span>
</code></pre></div><p>æ³¨æ„ä½ç½®å‚æ•°ä¸å…è®¸å‡ºç°åœ¨åå™¬å‚æ•°çš„åé¢ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">:</span><span class="p">(</span><span class="o">*</span><span class="nv">@args</span><span class="o">,</span> <span class="nv">$last</span><span class="p">);</span>
<span class="k">CATCH</span> <span class="p">{</span> <span class="k">when</span> <span class="ne">X::Parameter::WrongOrder</span> <span class="p">{</span> <span class="nb">put</span> <span class="o">.^</span><span class="nb">name</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">: </span><span class="p">&#39;</span><span class="o">,</span> <span class="o">.</span><span class="nb">Str</span> <span class="p">}</span> <span class="p">}</span>
<span class="c1"># OUTPUTÂ«X::Parameter::WrongOrder: ä¸èƒ½æŠŠå¿…è¦å‚æ•°æ”¾åœ¨å¯å˜é•¿åº¦å‚æ•°çš„åé¢Â»</span>
</code></pre></div><p>å¸¦æœ‰ä¸€ä¸ªæ˜Ÿå·çš„åå™¬å‚æ•°ä¼šé€šè¿‡æ¶ˆèä¸€å±‚æˆ–å¤šå±‚è£¸çš„å¯è¿­ä»£å¯¹è±¡æ¥å±•å¹³å‚æ•°ã€‚å¸¦æœ‰ä¸¤ä¸ªæ˜Ÿå·çš„åå™¬å‚æ•°ä¸ä¼šå±•å¹³å‚æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">a</span><span class="p">(</span><span class="o">*</span><span class="nv">@a</span><span class="p">)</span>  <span class="p">{</span> <span class="nv">@a</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#34;</span><span class="s2">|</span><span class="p">&#34;)</span><span class="o">.</span><span class="nb">say</span> <span class="p">};</span>
<span class="k">sub</span> <span class="nf">b</span><span class="p">(</span><span class="o">**</span><span class="nv">@b</span><span class="p">)</span> <span class="p">{</span> <span class="nv">@b</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#34;</span><span class="s2">|</span><span class="p">&#34;)</span><span class="o">.</span><span class="nb">say</span> <span class="p">};</span>

<span class="nf">a</span><span class="p">(</span><span class="mi">1</span><span class="o">,[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">],</span><span class="p">(</span><span class="o">[</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">],</span><span class="mi">5</span><span class="p">));</span>    <span class="c1">#  1|1|2|3|4|5</span>
<span class="nf">b</span><span class="p">(</span><span class="mi">1</span><span class="o">,[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">],</span><span class="p">(</span><span class="o">[</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">],</span><span class="mi">5</span><span class="p">));</span>    <span class="c1"># 1|1 2|3 4 5</span>

</code></pre></div><p>é€šå¸¸, åå™¬å‚æ•°ä¼šåˆ›å»ºä¸€ä¸ªæ•°ç»„, ä¸ºæ¯ä¸ª argument åˆ›å»ºä¸€ä¸ªæ ‡é‡å®¹å™¨, å¹¶ä¸”æŠŠæ¯ä¸ªå‚æ•°çš„å€¼èµ‹å€¼ç»™é‚£äº›æ ‡é‡ã€‚å¦‚æœåœ¨è¯¥è¿‡ç¨‹ä¸­åŸå‚æ•°ä¹Ÿæœ‰ä¸€ä¸ªä¸­é—´çš„æ ‡é‡åˆ†é‡, é‚£ä¹ˆå®ƒåœ¨è°ƒç”¨å‡½æ•°ä¸­æ˜¯è®¿é—®ä¸åˆ°çš„ã€‚</p>
<p>åå™¬å‚æ•°åœ¨å’ŒæŸäº› <a href="http://doc.raku.org/type/Signature#Parameter_Traits_and_Modifiers">traits and modifiers</a> ç»„åˆä½¿ç”¨æ—¶ä¼šæœ‰ç‰¹æ®Šè¡Œä¸º, åƒä¸‹é¢æè¿°çš„é‚£æ ·ã€‚</p>
<h3 id="single-argument-rule-slurpy">Single Argument Rule Slurpy</h3>
<p>å•ä¸€å‚æ•°è§„åˆ™å…è®¸æ ¹æ®ä¸Šä¸‹æ–‡å¤„ç†å­ç¨‹åºã€for-loop å’Œåˆ—è¡¨æ„é€ å‡½æ•°çš„å‚æ•°ã€‚è®¸å¤šä½ç½®ç±»å‹çš„æ–¹æ³•å¯ä»¥åƒå¤„ç†åˆ—è¡¨æˆ–å‚æ•°ä¸€æ ·å¤„ç†å•ä¸ªå‚æ•°ã€‚åœ¨ Signature ä¸­ä½¿ç”¨ <code>+@</code> ä½œä¸ºæ ‡å¿—, æä¾›äº†è¯­æ³•ç³–, ä½¿è¿™é¡¹å·¥ä½œæ›´å®¹æ˜“ä¸€äº›ã€‚ä»»ä½•éä½ç½®ç±»å‹çš„å•ä¸€å‚æ•°éƒ½ä¼šè¢«æå‡ä¸ºä¸€ä¸ªå…·æœ‰å•ä¸€é¡¹çš„åˆ—è¡¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">f</span><span class="p">(</span><span class="o">+</span><span class="nv">@a</span><span class="p">){</span> <span class="n">dd</span> <span class="nv">@a</span> <span class="p">};</span>
<span class="nb">f</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="c1"># OUTPUTÂ«[1]â¤Â»</span>
<span class="nb">f</span><span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="c1"># OUTPUTÂ«[1, 2, 3]â¤Â»</span>
<span class="k">my</span> <span class="nv">@b</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;;</span>
<span class="nb">f</span> <span class="nv">@b</span><span class="p">;</span>
<span class="c1"># OUTPUTÂ«[&#34;a&#34;, &#34;b&#34;, &#34;c&#34;]â¤Â»</span>
</code></pre></div><h3 id="ç±»å‹æ•è·">ç±»å‹æ•è·</h3>
<p>ç±»å‹æ•è·å…è®¸æŠŠç±»å‹çº¦æŸçš„è¯´æ˜æ¨è¿Ÿåˆ°å‡½æ•°è¢«è°ƒç”¨æ—¶ã€‚å®ƒä»¬å…è®¸ç­¾åå’Œå‡½æ•°ä½“ä¸­çš„ç±»å‹éƒ½å¯ä»¥å¼•ç”¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">f</span><span class="p">(</span><span class="o">:</span><span class="p">:</span><span class="s">T</span> <span class="nv">$p1</span><span class="o">,</span> <span class="nb">T</span> <span class="nv">$p2</span><span class="o">,</span> <span class="o">:</span><span class="p">:</span><span class="s">C</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1"># $p1 å’Œ $p2 çš„ç±»å‹éƒ½ä¸º T, ä½†æ˜¯æˆ‘ä»¬è¿˜ä¸çŸ¥é“å…·ä½“ç±»å‹æ˜¯ä»€ä¹ˆ</span>
    <span class="c1"># C å°†ä¼šä¿å­˜ä¸€ä¸ªæºäºç±»å‹å¯¹è±¡æˆ–å€¼çš„ç±»å‹</span>
    <span class="k">my</span> <span class="n">C</span> <span class="nv">$closure</span> <span class="o">=</span> <span class="nv">$p1</span> <span class="o">/</span> <span class="nv">$p2</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">sub</span> <span class="p">(</span><span class="nb">T</span> <span class="nv">$p1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$closure</span> <span class="o">*</span> <span class="nv">$p1</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ Int ç±»å‹, æ‰€ä»¥ç¬¬äºŒä¸ªå‚æ•°ä¹Ÿæ˜¯</span>
<span class="c1"># æˆ‘ä»¬ä»è°ƒç”¨ç”¨äº &amp;f ä¸­çš„æ“ä½œç¬¦å¯¼å‡ºç¬¬ä¸‰ä¸ªç±»å‹</span>
<span class="k">my</span> <span class="nv">&amp;s</span> <span class="o">=</span> <span class="nb">f</span><span class="p">(</span><span class="mi">10</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span> <span class="nb">Int</span><span class="o">.</span><span class="nb">new</span> <span class="o">/</span> <span class="nb">Int</span><span class="o">.</span><span class="nb">new</span><span class="p">);</span>
<span class="nb">say</span> <span class="k">s</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>  <span class="c1"># 10 / 2 * 2  == 10</span>
</code></pre></div><h3 id="positional-vs-named">Positional vs. Named</h3>
<p>å‚æ•°å¯ä»¥æ˜¯è·Ÿä½ç½®æœ‰å…³çš„æˆ–è€…æ˜¯å…·åçš„ã€‚æ‰€æœ‰çš„å‚æ•°éƒ½æ˜¯ positional çš„, é™¤äº†åå™¬å‹æ•£åˆ—å‚æ•°å’Œæœ‰å‰ç½®å†’å·æ ‡è®°çš„å‚æ•°:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$</span> <span class="o">=</span> <span class="o">:</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span>   <span class="c1"># ä½ç½®å‚æ•°</span>
<span class="nv">$</span> <span class="o">=</span> <span class="o">:</span><span class="p">(</span><span class="o">:</span><span class="nv">$a</span><span class="p">)</span>  <span class="c1"># åå­—ä¸º a çš„å…·åå‚æ•°</span>
<span class="nv">$</span> <span class="o">=</span> <span class="o">:</span><span class="p">(</span><span class="o">*</span><span class="nv">@a</span><span class="p">)</span>  <span class="c1"># åå™¬å‹ä½ç½®å‚æ•°</span>
<span class="nv">$</span> <span class="o">=</span> <span class="o">:</span><span class="p">(</span><span class="o">*</span><span class="nv">%h</span><span class="p">)</span>  <span class="c1"># åå™¬å‹å…·åå‚æ•°</span>
</code></pre></div><p>åœ¨è°ƒç”¨è€…è¿™è¾¹, ä½ç½®å‚æ•°çš„ä¼ é€’é¡ºåºå’Œå®ƒä»¬å£°æ˜é¡ºåºç›¸åŒã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">pos</span><span class="p">(</span><span class="nv">$x</span><span class="o">,</span> <span class="nv">$y</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">x = </span><span class="nv">$x</span><span class="s2"> y = </span><span class="nv">$y</span><span class="p">&#34;</span> <span class="p">};</span>
<span class="nb">pos</span><span class="p">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="p">);</span> <span class="c1">#  x = 4 y = 5</span>
</code></pre></div><p>å¯¹äºå…·åå®å‚å’Œå…·åå½¢å‚, åªç”¨åå­—ç”¨äºå°†å®å‚æ˜ å°„åˆ°å½¢å‚ä¸Šã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">named</span><span class="p">(</span><span class="o">:</span><span class="nv">$x</span><span class="o">,</span> <span class="o">:</span><span class="nv">$y</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">x=</span><span class="nv">$x</span><span class="s2"> y=</span><span class="nv">$y</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="nb">named</span><span class="p">(</span> <span class="s">y</span> <span class="o">=&gt;</span> <span class="mi">5</span>, <span class="s">x</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">);</span>
</code></pre></div><p>å…·åå‚æ•°ä¹Ÿå¯ä»¥å’Œå˜é‡çš„åå­—ä¸åŒ:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">named</span><span class="p">(:</span><span class="s">official</span><span class="p">(</span><span class="nv">$private</span><span class="p">))</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">å…¬åŠ¡</span><span class="p">&#34;</span> <span class="k">if</span> <span class="nv">$private</span> <span class="p">}</span>
<span class="nb">named</span> <span class="p">:</span><span class="s">official</span><span class="p">;</span>
</code></pre></div><p>åˆ«åä¹Ÿæ˜¯é‚£æ ·åšçš„:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="p">(</span> <span class="p">:</span><span class="s">color</span><span class="p">(:</span><span class="s">colour</span><span class="p">(</span><span class="nv">$c</span><span class="p">))</span> <span class="p">)</span> <span class="p">{</span> <span class="p">}</span> <span class="c1"># &#39;color&#39; å’Œ &#39;colour&#39; éƒ½å¯ä»¥</span>
<span class="k">sub</span> <span class="p">(</span> <span class="p">:</span><span class="s">color</span><span class="p">(</span><span class="o">:</span><span class="nv">$colour</span><span class="p">)</span> <span class="p">)</span>    <span class="p">{</span> <span class="p">}</span> <span class="c1"># same API for the caller</span>
</code></pre></div><p>å¸¦æœ‰å…·åå‚æ•°çš„å‡½æ•°å¯ä»¥è¢«åŠ¨æ€åœ°è°ƒç”¨, ä½¿ç”¨ <code>|</code>éå…³è”åŒ–ä¸€ä¸ª Pair æ¥æŠŠå®ƒè½¬æ¢ä¸ºä¸€ä¸ªå…·åå‚æ•°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="nb">f</span><span class="p">(</span><span class="o">:</span><span class="nv">$named</span><span class="p">)</span> <span class="p">{</span> <span class="nb">note</span> <span class="nv">&amp;?ROUTINE</span><span class="o">.</span><span class="nb">signature</span> <span class="p">};</span>
<span class="k">multi</span> <span class="nb">f</span><span class="p">(</span><span class="o">:</span><span class="nv">$also-named</span><span class="p">)</span> <span class="p">{</span> <span class="nb">note</span> <span class="nv">&amp;?ROUTINE</span><span class="o">.</span><span class="nb">signature</span> <span class="p">};</span>

<span class="k">for</span> <span class="p">&#39;</span><span class="s1">named</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">also-named</span><span class="p">&#39;</span> <span class="k">-&gt;</span> <span class="nv">$n</span> <span class="p">{</span>
    <span class="nb">f</span><span class="p">(</span><span class="o">|</span><span class="p">(</span><span class="nv">$n</span> <span class="o">=&gt;</span> <span class="nb">rand</span><span class="p">))</span>      <span class="c1"># Â«(:$named)â¤(:$also-named)â¤Â»</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$pair</span> <span class="o">=</span> <span class="p">:</span><span class="s">named</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">f</span> <span class="o">|</span><span class="nv">$pair</span><span class="p">;</span> <span class="c1"># Â«(:$named)â¤Â»</span>
</code></pre></div><p>åŒæ ·çš„è¯­æ³•ä¹Ÿå¯ä»¥ç”¨äºå°†æ•£åˆ—è½¬æ¢ä¸ºå…·åå‚æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%pairs</span> <span class="o">=</span> <span class="s">also-named</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">;</span>
<span class="k">sub</span> <span class="nb">f</span><span class="p">(</span><span class="o">|</span><span class="n">c</span><span class="p">)</span> <span class="p">{};</span>
<span class="nb">f</span> <span class="o">|</span><span class="nv">%pairs</span><span class="p">;</span>        <span class="c1"># (:$also-named)</span>
</code></pre></div><h3 id="å¯é€‰å‚æ•°å’Œå¼ºåˆ¶å‚æ•°">å¯é€‰å‚æ•°å’Œå¼ºåˆ¶å‚æ•°</h3>
<p>Positional å‚æ•°é»˜è®¤æ˜¯å¼ºåˆ¶çš„, ä¹Ÿå¯ä»¥ç”¨é»˜è®¤å€¼æˆ–ç»“å°¾çš„é—®å·ä½¿å‚æ•°æˆä¸ºå¯é€‰çš„:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$</span> <span class="o">=</span> <span class="o">:</span><span class="p">(</span><span class="nb">Str</span> <span class="nv">$id</span><span class="p">)</span>         <span class="c1"># å¿…è¦å‚æ•° required parameter</span>
<span class="nv">$</span> <span class="o">=</span> <span class="o">:</span><span class="p">(</span><span class="nv">$base</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>      <span class="c1"># å¯é€‰å‚æ•°, é»˜è®¤ä¸º 10</span>
<span class="nv">$</span> <span class="o">=</span> <span class="o">:</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$x</span><span class="o">?</span><span class="p">)</span>         <span class="c1"># å¯é€‰å‚æ•°, é»˜è®¤ä¸º Int ç±»å‹çš„å¯¹è±¡</span>
</code></pre></div><p>å…·åå‚æ•°é»˜è®¤æ˜¯å¯é€‰çš„, å¯ä»¥é€šè¿‡åœ¨å‚æ•°æœ«å°¾åŠ ä¸Šä¸€ä¸ªæ„Ÿå¹å·ä½¿å®ƒå˜æˆå¼ºåˆ¶å‚æ•°:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$</span> <span class="o">=</span> <span class="o">:</span><span class="p">(</span><span class="o">:</span><span class="nv">%config</span><span class="p">)</span>        <span class="c1"># å¯é€‰å‚æ•°</span>
<span class="nv">$</span> <span class="o">=</span> <span class="o">:</span><span class="p">(</span><span class="o">:</span><span class="nv">$debug</span> <span class="o">=</span> <span class="nb">False</span><span class="p">)</span> <span class="c1"># å¯é€‰å‚æ•°, é»˜è®¤ä¸º False</span>
<span class="nv">$</span> <span class="o">=</span> <span class="o">:</span><span class="p">(</span><span class="o">:</span><span class="nv">$name</span><span class="o">!</span><span class="p">)</span>         <span class="c1"># åä¸º name çš„å¼ºåˆ¶å…·åå‚æ•°</span>
</code></pre></div><p>é»˜è®¤å€¼å¯ä»¥ä¾é ä¹‹å‰çš„å‚æ•°, å¹¶ä¸”æ¯æ¬¡è°ƒç”¨éƒ½ä¼šè¢«é‡æ–°è®¡ç®—ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$</span> <span class="o">=</span> <span class="o">:</span><span class="p">(</span><span class="nv">$goal</span><span class="o">,</span> <span class="nv">$accuracy</span> <span class="o">=</span> <span class="nv">$goal</span> <span class="o">/</span> <span class="mi">100</span><span class="p">);</span>
<span class="nv">$</span> <span class="o">=</span> <span class="o">:</span><span class="p">(</span><span class="o">:</span><span class="nv">$excludes</span> <span class="o">=</span> <span class="o">[</span><span class="p">&#39;</span><span class="s1">.</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">..</span><span class="p">&#39;</span><span class="o">]</span><span class="p">);</span> <span class="c1"># a new Array for every call</span>
</code></pre></div><h3 id="è§£æ„å‚æ•°">è§£æ„å‚æ•°</h3>
<p>å‚æ•°åé¢å¯ä»¥è·Ÿç€ä¸€ä¸ªç”±æ‹¬å·æ‹¬èµ·æ¥çš„ <code>sub-signature</code>, å­ç­¾åä¼šè§£æ„ç»™å®šçš„å‚æ•°ã€‚åˆ—è¡¨è§£æ„æˆå®ƒçš„å…ƒç´ :</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">first</span> <span class="p">(</span><span class="nv">@array</span> <span class="p">(</span><span class="nv">$first</span><span class="o">,</span> <span class="o">*</span><span class="nv">@rest</span><span class="p">))</span> <span class="p">{</span> <span class="nv">$first</span> <span class="p">}</span>
</code></pre></div><p>æˆ–:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">first</span> <span class="p">(</span><span class="o">[</span><span class="nv">$first</span><span class="o">,</span> <span class="o">*</span><span class="nv">@</span><span class="o">]</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$first</span> <span class="p">}</span>
</code></pre></div><p>è€Œæ•£åˆ—è§£æ„æˆå®ƒçš„é”®å€¼å¯¹å„¿(pairs):</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">all-dimensions</span> <span class="p">(</span><span class="nv">%</span> <span class="p">(:</span><span class="s">length</span><span class="p">(</span><span class="o">:</span><span class="nv">$x</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">width</span><span class="p">(</span><span class="o">:</span><span class="nv">$y</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">depth</span><span class="p">(</span><span class="o">:</span><span class="nv">$z</span><span class="p">)))</span> <span class="p">{</span>
    <span class="nv">$x</span> <span class="ow">andthen</span> <span class="nv">$y</span> <span class="ow">andthen</span> <span class="nv">$z</span> <span class="ow">andthen</span> <span class="nb">True</span>
<span class="p">}</span>
</code></pre></div><p><code>andthen</code> è¿”å›ç¬¬ä¸€ä¸ªæœªå®šä¹‰çš„å€¼, å¦åˆ™è¿”å›æœ€åä¸€ä¸ªå…ƒç´ ã€‚çŸ­è·¯æ“ä½œç¬¦ã€‚<code>andthen</code> å·¦ä¾§çš„ç»“æœè¢«ç»‘å®šç»™ <code>$_</code> ç”¨äºå³ä¾§, æˆ–è€…ä½œä¸ºå‚æ•°ä¼ é€’, å¦‚æœå³ä¾§æ˜¯ä¸€ä¸ª <code>block</code> æˆ– <code>pointy block</code> çš„è¯ã€‚</p>
<p>ä¸€èˆ¬åœ°, å¯¹è±¡æ ¹æ®å®ƒçš„å±æ€§è§£æ„ã€‚é€šç”¨çš„æƒ¯ç”¨æ³•æ˜¯åœ¨ <em>for</em> å¾ªç¯ä¸­è§£åŒ…ä¸€ä¸ª <a href="https://docs.raku.org/type/Pair">Pair</a> çš„é”®å’Œå€¼:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="p">&lt;</span><span class="s">Peter Paul Merry</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">pairs</span> <span class="k">-&gt;</span> <span class="p">(:</span><span class="s">key</span><span class="p">(</span><span class="nv">$index</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">value</span><span class="p">(</span><span class="nv">$guest</span><span class="p">))</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre></div><p>ä½†æ˜¯, å°†å¯¹è±¡è§£åŒ…ä¸ºå±æ€§åªæ˜¯é»˜è®¤è¡Œä¸ºã€‚è¦ä½¿å¯¹è±¡ä»¥ä¸åŒæ–¹å¼è§£æ„, è¯·æ›´æ”¹å…¶ <a href="https://docs.raku.org/routine/Capture">Capture</a> æ–¹æ³•ã€‚</p>
<h3 id="å­ç­¾å">å­ç­¾å</h3>
<p>è¦åŒ¹é…å¤åˆå‚æ•°, è¯·åœ¨åœ†æ‹¬å·ä¸­çš„å‚æ•°ååé¢ä½¿ç”¨å­ç­¾åã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">foo</span><span class="p">(</span><span class="o">|</span><span class="nf">c</span><span class="p">(</span><span class="nb">Int</span><span class="o">,</span> <span class="nb">Str</span><span class="p">)){</span>
   <span class="nb">put</span> <span class="p">&#34;</span><span class="s2">called with </span><span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="nb">perl</span><span class="p">}&#34;</span>
<span class="p">}</span>

<span class="nf">foo</span><span class="p">(</span><span class="mi">42</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">answer</span><span class="p">&#34;);</span>
<span class="c1"># OUTPUTÂ«called with \(42, &#34;answer&#34;)Â»</span>
</code></pre></div><h3 id="é•¿åå­—">é•¿åå­—</h3>
<p>ä¸ºäº†åœ¨å¤šé‡åˆ†æ´¾ä¸­æ’é™¤ç‰¹å®šå‚æ•°, ä½¿ç”¨ä¸€ä¸ªåŒåˆ†å·æ¥åˆ†å‰²å®ƒä»¬ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">f</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$i</span><span class="o">,</span> <span class="nb">Str</span> <span class="nv">$s</span><span class="p">;;</span> <span class="o">:</span><span class="nv">$b</span><span class="p">)</span> <span class="p">{</span> <span class="n">dd</span> <span class="nv">$i</span><span class="o">,</span> <span class="nv">$s</span><span class="o">,</span> <span class="nv">$b</span> <span class="p">};</span>
<span class="nb">f</span><span class="p">(</span><span class="mi">10</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">answer</span><span class="p">&#39;);</span>
<span class="c1"># OUTPUTÂ«10 &#34;answer&#34;Any $b = AnyÂ»</span>
</code></pre></div><h3 id="æ•è·å‚æ•°">æ•è·å‚æ•°</h3>
<p>åœ¨å‚æ•°å‰å‰ç½®ä¸€ä¸ªå‚ç›´çš„ <code>|</code> ä¼šè®©å‚æ•°å˜ä¸º <a href="https://docs.raku.org/type/Capture">Capture</a>, å¹¶ä½¿ç”¨å®Œæ‰€æœ‰å‰©ä¸‹çš„ä½ç½®å‚æ•°å’Œå…·åå‚æ•°ã€‚</p>
<p>è¿™å¸¸ç”¨åœ¨ <code>proto</code> å®šä¹‰ä¸­( åƒ <code>proto foo (|) {*}</code> ) æ¥æ ‡ç¤ºä¾‹ç¨‹çš„ <a href="https://docs.raku.org/routine/multi">multi å®šä¹‰</a>å¯ä»¥æ‹¥æœ‰ä»»ä½•<a href="https://docs.raku.org/type/Signature#Type_Constraints">ç±»å‹çº¦æŸ</a>ã€‚</p>
<p>å¦‚æœç»‘å®šåˆ°å˜é‡å‚æ•°, åˆ™å¯ä»¥ä½¿ç”¨ slip è¿ç®—ç¬¦ <code>|</code> ä½œä¸ºæ•´ä½“è½¬å‘ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">a</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$i</span><span class="o">,</span> <span class="nb">Str</span> <span class="nv">$s</span><span class="p">)</span> <span class="p">{</span> <span class="nb">say</span> <span class="nv">$i</span><span class="o">.</span><span class="nb">WHAT</span><span class="o">,</span> <span class="nv">$s</span><span class="o">.</span><span class="nb">WHAT</span> <span class="p">}</span>
<span class="k">sub</span> <span class="nf">b</span><span class="p">(</span><span class="o">|</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span> <span class="nb">say</span> <span class="n">c</span><span class="o">.</span><span class="nb">WHAT</span><span class="p">;</span> <span class="nf">a</span><span class="p">(</span><span class="o">|</span><span class="n">c</span><span class="p">)</span> <span class="p">}</span>
<span class="nf">b</span><span class="p">(</span><span class="mi">42</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">answer</span><span class="p">&#34;);</span>
<span class="c1"># OUTPUTÂ«(Capture)â¤(Int)(Str)â¤Â»</span>
</code></pre></div><h3 id="å‚æ•°ç‰¹æ€§å’Œä¿®é¥°ç¬¦">å‚æ•°ç‰¹æ€§å’Œä¿®é¥°ç¬¦</h3>
<p>é»˜è®¤åœ°, å½¢å¼å‚æ•°è¢«ç»‘å®šåˆ°å®ƒä»¬çš„å®å‚ä¸Šå¹¶ä¸”è¢«æ ‡è®°ä¸ºåªè¯»ã€‚ä½ å¯ä»¥ä½¿ç”¨ traits ç‰¹æ€§æ›´æ”¹å‚æ•°çš„åªè¯»ç‰¹æ€§ã€‚</p>
<p><code>is copy</code>ç‰¹æ€§è®©å‚æ•°è¢«å¤åˆ¶, å¹¶å…è®¸åœ¨å­ä¾‹ç¨‹å†…éƒ¨ä¿®æ”¹å‚æ•°çš„å€¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">count-up</span> <span class="p">(</span><span class="nv">$x</span> <span class="k">is</span> <span class="nb">copy</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$x</span> <span class="o">=</span> <span class="no">Inf</span> <span class="k">if</span> <span class="nv">$x</span> <span class="o">~~</span> <span class="nb">Whatever</span><span class="p">;</span>
    <span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="nv">$x</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p><code>is rw</code> ç‰¹æ€§è®©å‚æ•°åªç»‘å®šåˆ°å˜é‡ä¸Š(æˆ–å…¶å®ƒå¯å†™çš„å®¹å™¨)ã€‚ èµ‹å€¼ç»™å‚æ•°ä¼šæ”¹å˜è°ƒç”¨ä¸€ä¾§çš„å˜é‡çš„å€¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">swap</span><span class="p">(</span><span class="nv">$x</span> <span class="k">is</span> <span class="k">rw</span><span class="o">,</span> <span class="nv">$y</span> <span class="k">is</span> <span class="k">rw</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">(</span><span class="nv">$x</span><span class="o">,</span> <span class="nv">$y</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$y</span><span class="o">,</span> <span class="nv">$x</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>å¯¹äºåå™¬å‚æ•°, <code>is rw</code> ç”±è¯­è¨€è®¾è®¡è€…ä¿ç•™åšå°†æ¥ä¹‹ç”¨</p>
<h2 id="æ–¹æ³•">æ–¹æ³•</h2>
<h3 id="params-æ–¹æ³•">params æ–¹æ³•</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">method</span> <span class="nb">params</span><span class="p">(</span><span class="n">Signature:D:</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Positional</span>
</code></pre></div><p>è¿”å› <code>Parameter</code> å¯¹è±¡åˆ—è¡¨ä»¥ç»„æˆç­¾åã€‚</p>
<h3 id="arity-æ–¹æ³•">arity æ–¹æ³•</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">method</span> <span class="nb">arity</span><span class="p">(</span><span class="n">Signature:D:</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Int:D</span>
</code></pre></div><p>è¿”å›æ‰€å¿…é¡»çš„æœ€å°æ•°é‡çš„æ»¡è¶³ç­¾åçš„ä½ç½®å‚æ•°</p>
<h3 id="count-æ–¹æ³•">count æ–¹æ³•</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">method</span> <span class="nb">count</span><span class="p">(</span><span class="n">Signature:D:</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Real:D</span>
</code></pre></div><p>è¿”å›èƒ½è¢«ç»‘å®šç»™ç­¾åçš„æœ€å¤§æ•°é‡çš„ä½ç½®å‚æ•°ã€‚å¦‚æœæœ‰åå™¬ä½ç½®å‚æ•°åˆ™è¿”å› <code>Inf</code>ã€‚</p>
<h3 id="returns-æ–¹æ³•">returns æ–¹æ³•</h3>
<p>ç­¾åè¿”å›çš„ä»»æ„çº¦æŸæ˜¯:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">:</span><span class="p">(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span> <span class="k">--&gt;</span> <span class="nb">Int</span><span class="p">)</span><span class="o">.</span><span class="k">returns</span> <span class="c1"># Int</span>
</code></pre></div><h3 id="accepts-æ–¹æ³•">ACCEPTS æ–¹æ³•</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">method</span> <span class="nb">ACCEPTS</span><span class="p">(</span><span class="n">Signature:D:</span> <span class="nb">Capture</span> <span class="nv">$topic</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">ACCEPTS</span><span class="p">(</span><span class="n">Signature:D:</span> <span class="nv">@topic</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">ACCEPTS</span><span class="p">(</span><span class="n">Signature:D:</span> <span class="nv">%topic</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">ACCEPTS</span><span class="p">(</span><span class="n">Signature:D:</span> <span class="nb">Signature</span> <span class="nv">$topic</span><span class="p">)</span>
</code></pre></div><p>å‰ä¸‰ä¸ªæ–¹æ³•ä¼šçœ‹å‚èƒ½å¦ç»‘å®šç»™ capture, ä¾‹å¦‚, å¦‚æœå¸¦æœ‰é‚£ä¸ª Signature çš„å‡½æ•°èƒ½ä½¿ç”¨ <code>$topic</code> è°ƒç”¨:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span> <span class="p">:</span><span class="s">foo</span><span class="p">)</span> <span class="o">~~</span> <span class="o">:</span><span class="p">(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="o">,</span> <span class="p">:</span><span class="s">foo</span><span class="p">(</span><span class="nv">$bar</span><span class="p">))</span> <span class="c1"># true</span>
<span class="p">&lt;</span><span class="s">a b c d</span><span class="p">&gt;</span> <span class="o">~~</span> <span class="o">:</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$a</span><span class="p">)</span>               <span class="c1"># False</span>
</code></pre></div><p>æœ€åä¸€ä¸ªä¼šä¸ºçœŸå¦‚æœ <code>$topic</code> èƒ½æ¥æ”¶çš„ä»»ä½•ä¸œè¥¿ä¹Ÿèƒ½è¢« <code>Signature</code> æ¥æ”¶ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">:</span><span class="p">(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="o">~~</span> <span class="o">:</span><span class="p">(</span><span class="nv">$foo</span><span class="o">,</span> <span class="nv">$bar</span><span class="o">,</span> <span class="nv">$baz</span><span class="o">?</span><span class="p">)</span>   <span class="c1"># True</span>
<span class="o">:</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$n</span><span class="p">)</span> <span class="o">~~</span> <span class="o">:</span><span class="p">(</span><span class="nb">Str</span><span class="p">)</span>                 <span class="c1"># False</span>
</code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/signature" term="signature" label="signature" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä»£ç ç¤ºä¾‹]]></title>
            <link href="https://ohmyweekly.github.io/notes/2016-02-14-raku-examples/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2016-02-14-raku-examples/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-12T00:00:00+08:00</published>
            <updated>2021-07-12T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Raku Examples</blockquote><h2 id="ç”¨ç±»æ¥æ’åºæ•°ç»„">ç”¨ç±»æ¥æ’åºæ•°ç»„</h2>
<p>æœ‰å¤šåˆ—æ•°æ®, åºå·, å­¦æ ¡, è¯¾ç¨‹â€¦ å¹´ä»½è¿™å‡ åˆ—ã€‚è¦å¦‚æœå­¦æ ¡å’Œè¯¾ç¨‹ç›¸åŒå°±æ ¹æ®å¹´ä»½å€’åºæ’åˆ—ã€‚</p>
<p>å…ˆæŒ‰å­¦æ ¡æ’åº, å†æŒ‰è¯¾ç¨‹æ’åº, ç„¶åæŒ‰å¹´ä»½å€’åºæ’åºã€‚</p>
<p>æˆ‘å®šä¹‰ä¸€ä¸ªç±»æ¥è¿›è¡Œå¤šåˆ—æ•°æ®çš„æ’åº, å¾ˆæ–¹ä¾¿ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Course</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nb">Int</span> <span class="nv">$.numb</span><span class="p">;</span>
    <span class="k">has</span> <span class="nb">Str</span> <span class="nv">$.univ</span><span class="p">;</span>
    <span class="k">has</span> <span class="nb">Str</span> <span class="nv">$.dis</span><span class="p">;</span>
    <span class="k">has</span> <span class="nb">Int</span> <span class="nv">$.paper</span><span class="p">;</span>
    <span class="k">has</span> <span class="nb">Int</span> <span class="nv">$.cited</span><span class="p">;</span>
    <span class="k">has</span> <span class="nb">Int</span> <span class="nv">$.year</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">@headers</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">numb univ dis paper cited year</span><span class="p">&gt;;</span>
<span class="k">my</span> <span class="nv">@courses</span><span class="p">;</span>

<span class="k">for</span> <span class="nv">$=finish</span><span class="o">.</span><span class="nb">lines</span> <span class="k">-&gt;</span> <span class="nv">$line</span> <span class="p">{</span>
    <span class="nb">next</span> <span class="k">if</span> <span class="nv">$line</span> <span class="o">~~</span> <span class="p">/</span><span class="ni">^</span><span class="sr">num</span><span class="p">/;</span>
    <span class="k">my</span> <span class="nv">@words</span>  <span class="o">=</span> <span class="nv">$line</span><span class="o">.</span><span class="nb">words</span><span class="p">;</span>

    <span class="nv">@words</span><span class="o">[</span><span class="mi">0</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">5</span><span class="o">]</span> <span class="o">=</span> <span class="nv">@words</span><span class="o">[</span><span class="mi">0</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">5</span><span class="o">]Â».</span><span class="nb">Int</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">%h</span> <span class="o">=</span> <span class="nv">@headers</span> <span class="ow">Z</span><span class="o">=&gt;</span> <span class="nv">@words</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$course</span> <span class="o">=</span> <span class="n">Course</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="o">|</span><span class="nv">%h</span><span class="p">);</span>
    <span class="nv">@courses</span><span class="o">.</span><span class="nb">push</span><span class="p">(</span><span class="nv">$course</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">@sorted</span>  <span class="o">=</span> <span class="nv">@courses</span><span class="o">.</span><span class="nb">sort</span><span class="p">(</span><span class="o">*.</span><span class="nf">univ</span><span class="p">)</span><span class="o">.</span><span class="nb">sort</span><span class="p">(</span><span class="o">*.</span><span class="nf">dis</span><span class="p">)</span><span class="o">.</span><span class="nb">sort</span><span class="p">(</span><span class="o">-*.</span><span class="nb">year</span><span class="p">);</span>
<span class="k">for</span> <span class="nv">@sorted</span>  <span class="p">{</span>
    <span class="nb">say</span> <span class="nb">join</span> <span class="p">&#34;</span><span class="s2"> </span><span class="p">&#34;</span><span class="o">,</span> <span class="o">.</span><span class="nf">numb</span><span class="o">,</span> <span class="o">.</span><span class="nf">univ</span><span class="o">,</span> <span class="o">.</span><span class="nf">dis</span><span class="o">,</span> <span class="o">.</span><span class="nf">paper</span><span class="o">,</span> <span class="o">.</span><span class="nf">cited</span><span class="o">,</span> <span class="o">.</span><span class="nb">year</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">=finish</span><span class="sd">
</span><span class="sd">num	univ	dis	paper	cited	year
</span><span class="sd">1	Beijing	Physics	193	4555	2005
</span><span class="sd">2	Beijing	Physics	197	2799	2006
</span><span class="sd">3	Beijing	Physics	240	2664	2007
</span><span class="sd">4	Beijing	Physics	200	3191	2008
</span><span class="sd">5	Beijing	Physics	268	2668	2009
</span><span class="sd">6	Beijing	Physics	249	2300	2010
</span><span class="sd">7	Beijing	Physics	262	2080	2011
</span><span class="sd">8	Beijing	Physics	230	2371	2012
</span><span class="sd">9	Beijing	Physics	309	1367	2013
</span><span class="sd">10	Beijing	Physics	284	615	2014
</span><span class="sd">11	Beijing	Chemistry	143	1650	2005
</span><span class="sd">12	Beijing	Chemistry	149	2379	2006
</span><span class="sd">13	Beijing	Chemistry	190	2566	2007
</span><span class="sd">14	Beijing	Chemistry	147	1888	2008
</span><span class="sd">15	Beijing	Chemistry	184	2146	2009
</span><span class="sd">16	Beijing	Chemistry	214	2568	2010
</span><span class="sd">17	Beijing	Chemistry	238	2874	2011
</span><span class="sd">18	Beijing	Chemistry	265	2097	2012
</span><span class="sd">19	Beijing	Chemistry	251	1303	2013
</span><span class="sd">20	Beijing	Chemistry	241	656	2014
</span></code></pre></div><h2 id="æ–æ³¢æ‹‰å¥‘æ•°åˆ—fibonacci-sequence">æ–æ³¢æ‹‰å¥‘æ•°åˆ—ï¼ˆFibonacci Sequenceï¼‰</h2>
<ul>
<li>analytic</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">fibonacci</span> <span class="p">(</span><span class="nb">Int</span> <span class="nv">$n</span> <span class="k">where</span> <span class="mi">0</span><span class="o">..*</span>  <span class="k">--&gt;</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">constant</span> <span class="no">phi</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="nb">sqrt</span> <span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>

    <span class="k">return</span> <span class="nb">round</span><span class="p">(</span> <span class="n">phi</span><span class="o">**</span><span class="p">(</span><span class="nv">$n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">sqrt</span> <span class="mi">5</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">for</span> <span class="mi">0</span><span class="o">..</span><span class="mi">1000</span> <span class="k">-&gt;</span> <span class="nv">$i</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$i</span><span class="o">.</span><span class="nb">fmt</span><span class="p">(&#39;</span><span class="s1">%3d</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">: </span><span class="p">&#39;</span><span class="o">,</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>è¿™ç§æ–¹æ³•è®¡ç®—å‰1000ä¸ªæ–æ³¢æ‹‰å¥‘æ•°å¤§çº¦ä¸º0.746sï¼ˆ2015.7.Rakudo, ä»¥ä¸‹éƒ½æ˜¯ï¼‰ã€‚</p>
<ul>
<li>è¿­ä»£</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">fibonacci</span> <span class="p">(</span><span class="nb">Int</span> <span class="nv">$n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">state</span> <span class="nv">@sequence</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="p">;</span>

    <span class="k">while</span> <span class="nv">@sequence</span><span class="o">.</span><span class="nb">elems</span> <span class="o">&lt;=</span> <span class="nv">$n</span> <span class="p">{</span>
        <span class="nv">@sequence</span><span class="o">.</span><span class="nb">push</span><span class="p">(</span> <span class="nv">@sequence</span><span class="o">[*-</span><span class="mi">2</span><span class="o">]</span> <span class="o">+</span> <span class="nv">@sequence</span><span class="o">[*-</span><span class="mi">1</span><span class="o">]</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">@sequence</span><span class="o">[</span><span class="nv">$n</span><span class="o">]</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">for</span> <span class="mi">0</span><span class="o">..</span><span class="mi">1000</span> <span class="k">-&gt;</span> <span class="nv">$i</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$i</span><span class="o">.</span><span class="nb">fmt</span><span class="p">(&#39;</span><span class="s1">%3d</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">: </span><span class="p">&#39;</span><span class="o">,</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>è¿™ç§éå†æ³•å¤§æ¦‚éœ€è¦ 1 ç§’å¤šã€‚</p>
<ul>
<li>é€’å½’</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">fibonacci</span> <span class="p">(</span><span class="nb">Int</span> <span class="nv">$n</span> <span class="k">where</span> <span class="mi">0</span><span class="o">..*</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nv">$n</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">|</span> <span class="mi">1</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="nv">$n-1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="nv">$n-2</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">for</span> <span class="mi">0</span><span class="o">..</span><span class="mi">1000</span> <span class="k">-&gt;</span> <span class="nv">$i</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$i</span><span class="o">.</span><span class="nb">fmt</span><span class="p">(&#39;</span><span class="s1">%3d</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">: </span><span class="p">&#39;</span><span class="o">,</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>æ¯”è¾ƒæ…¢ã€‚ç¬¬ 20 ä¸ªä¹‹åè¶Šæ¥è¶Šæ…¢ã€‚</p>
<ul>
<li>é€’å½’ - è¶…è¿ç®—ç¬¦</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">fibonacci</span> <span class="p">(</span><span class="nb">Int</span> <span class="nv">$n</span> <span class="k">where</span> <span class="mi">0</span><span class="o">..*</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nv">$n</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">|</span> <span class="mi">1</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">[+]</span> <span class="p">(</span><span class="nv">$n-1</span><span class="o">,</span> <span class="nv">$n-2</span><span class="p">)</span><span class="o">Â».</span><span class="nv">&amp;fibonacci</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">for</span> <span class="mi">0</span><span class="o">..</span><span class="mi">1000</span> <span class="k">-&gt;</span> <span class="nv">$i</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$i</span><span class="o">.</span><span class="nb">fmt</span><span class="p">(&#39;</span><span class="s1">%3d</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">: </span><span class="p">&#39;</span><span class="o">,</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>å’Œä¸Šé¢å·®ä¸å¤šã€‚</p>
<ul>
<li>é€’å½’ - map</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">fibonacci</span> <span class="p">(</span><span class="nb">Int</span> <span class="nv">$n</span> <span class="k">where</span> <span class="mi">0</span><span class="o">..*</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nv">$n</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">|</span> <span class="mi">1</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">[+]</span> <span class="nb">map</span> <span class="nv">&amp;fibonacci</span><span class="o">,</span> <span class="p">(</span><span class="nv">$n-1</span><span class="o">,</span> <span class="nv">$n-2</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">for</span> <span class="mi">0</span><span class="o">..</span><span class="mi">1000</span> <span class="k">-&gt;</span> <span class="nv">$i</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$i</span><span class="o">.</span><span class="nb">fmt</span><span class="p">(&#39;</span><span class="s1">%3d</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">: </span><span class="p">&#39;</span><span class="o">,</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>åŒä¸Šã€‚</p>
<ul>
<li>é€’å½’ - multi</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="nf">fibonacci</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="p">{</span> <span class="mi">1</span> <span class="p">}</span>

<span class="k">multi</span> <span class="nf">fibonacci</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="p">{</span> <span class="mi">1</span> <span class="p">}</span>

<span class="k">multi</span> <span class="nf">fibonacci</span> <span class="p">(</span><span class="nb">Int</span> <span class="nv">$n</span> <span class="k">--&gt;</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="nv">$n-1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="nv">$n-2</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">for</span> <span class="mi">0</span><span class="o">..</span><span class="mi">1000</span> <span class="k">-&gt;</span> <span class="nv">$i</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$i</span><span class="o">.</span><span class="nb">fmt</span><span class="p">(&#39;</span><span class="s1">%3d</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">: </span><span class="p">&#39;</span><span class="o">,</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>æ¯”ä¸Šä¸€ä¸ªç¨å¿«ã€‚</p>
<ul>
<li>é€’å½’ - multi_cached</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="nf">fibonacci</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="p">{</span> <span class="mi">1</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nf">fibonacci</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="p">{</span> <span class="mi">1</span> <span class="p">}</span>

<span class="k">my</span> <span class="nv">%cached</span><span class="p">;</span>

<span class="k">multi</span> <span class="nf">fibonacci</span> <span class="p">(</span><span class="nb">Int</span> <span class="nv">$n</span> <span class="k">--&gt;</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">%cached</span><span class="p">{</span><span class="nv">$n</span><span class="p">}</span> <span class="o">//=</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="nv">$n-1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="nv">$n-2</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">for</span> <span class="mi">0</span><span class="o">..</span><span class="mi">1000</span> <span class="k">-&gt;</span> <span class="nv">$i</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$i</span><span class="o">.</span><span class="nb">fmt</span><span class="p">(&#39;</span><span class="s1">%3d</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">: </span><span class="p">&#39;</span><span class="o">,</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>èŠ±è´¹ 0.849s æ‰§è¡Œå®Œæ¯•ã€‚</p>
<ul>
<li>é€’å½’ - multi_cached_state</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="nf">fibonacci</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="p">{</span> <span class="mi">1</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nf">fibonacci</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="p">{</span> <span class="mi">1</span> <span class="p">}</span>

<span class="k">multi</span> <span class="nf">fibonacci</span> <span class="p">(</span><span class="nb">Int</span> <span class="nv">$n</span> <span class="k">--&gt;</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">state</span> <span class="nv">%cached</span><span class="p">;</span>
    <span class="k">return</span> <span class="nv">%cached</span><span class="p">{</span><span class="nv">$n</span><span class="p">}</span> <span class="o">//=</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="nv">$n-1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="nv">$n-2</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">for</span> <span class="mi">0</span><span class="o">..</span><span class="mi">1000</span> <span class="k">-&gt;</span> <span class="nv">$i</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$i</span><span class="o">.</span><span class="nb">fmt</span><span class="p">(&#39;</span><span class="s1">%3d</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">: </span><span class="p">&#39;</span><span class="o">,</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>èŠ±è´¹äº† 0.885sã€‚</p>
<ul>
<li>é€’å½’ - multi_cached_trait</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="nf">fibonacci</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="p">{</span> <span class="mi">1</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nf">fibonacci</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="p">{</span> <span class="mi">1</span> <span class="p">}</span>

<span class="k">multi</span> <span class="nf">fibonacci</span> <span class="p">(</span><span class="nb">Int</span> <span class="nv">$n</span> <span class="k">--&gt;</span> <span class="nb">Int</span><span class="p">)</span> <span class="k">is</span> <span class="k">cached</span> <span class="p">{</span>
    <span class="nf">fibonacci</span><span class="p">(</span><span class="nv">$n-1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="nv">$n-2</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">for</span> <span class="mi">0</span><span class="o">..</span><span class="mi">1000</span> <span class="k">-&gt;</span> <span class="nv">$i</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$i</span><span class="o">.</span><span class="nb">fmt</span><span class="p">(&#39;</span><span class="s1">%3d</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">: </span><span class="p">&#39;</span><span class="o">,</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>ç›®å‰æŠ¥é”™ã€‚</p>
<ul>
<li>åºåˆ—</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">fibonacci</span> <span class="p">(</span><span class="nb">Int</span> <span class="nv">$n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">constant</span> <span class="nv">@sequence</span> <span class="o">:=</span>  <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="o">*+*</span> <span class="o">...</span> <span class="o">*</span><span class="p">;</span>
    <span class="k">return</span> <span class="nv">@sequence</span><span class="o">[</span><span class="nv">$n</span><span class="o">]</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">for</span> <span class="mi">0</span><span class="o">..</span><span class="mi">1000</span> <span class="k">-&gt;</span> <span class="nv">$i</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$i</span><span class="o">.</span><span class="nb">fmt</span><span class="p">(&#39;</span><span class="s1">%3d</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">: </span><span class="p">&#39;</span><span class="o">,</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>èŠ±è´¹äº† 1.6s å¤šã€‚ å…¶ä¸­ <code>:=</code> æ˜¯æƒ°æ€§èµ‹å€¼ã€‚æŒ‰éœ€æ±‚å€¼ã€‚</p>
<ul>
<li>åºåˆ— - inline</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">fibonacci</span> <span class="p">(</span><span class="nb">Int</span> <span class="nv">$n</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="o">*+*</span> <span class="o">...</span> <span class="o">*</span><span class="p">)</span><span class="o">[</span><span class="nv">$n</span><span class="o">]</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">for</span> <span class="mi">0</span><span class="o">..</span><span class="mi">1000</span> <span class="k">-&gt;</span> <span class="nv">$i</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$i</span><span class="o">.</span><span class="nb">fmt</span><span class="p">(&#39;</span><span class="s1">%3d</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">: </span><span class="p">&#39;</span><span class="o">,</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>èŠ±è´¹äº† 133.808sã€‚</p>
<h2 id="æ’åº">æ’åº</h2>
<ul>
<li>bogosort</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#! /usr/bin/env raku</span>

<span class="k">sub</span> <span class="nf">bogosort</span> <span class="p">(</span> <span class="o">*</span><span class="nv">@list</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">until</span> <span class="o">[!</span><span class="nb">after</span><span class="o">]</span> <span class="nv">@list</span> <span class="p">{</span>
        <span class="nv">@list</span> <span class="o">.=</span> <span class="nb">pick</span><span class="p">(</span><span class="o">*</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nv">@list</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">#my @data = 6, 7, 2, 1, 8, 9, 2;</span>
<span class="k">my</span> <span class="nv">@data</span> <span class="o">=</span>  <span class="p">&lt;</span><span class="s"> p e r l s i x </span><span class="p">&gt;;</span>

<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">input  = </span><span class="p">&#39;</span> <span class="o">~</span>          <span class="nv">@data</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">output = </span><span class="p">&#39;</span> <span class="o">~</span> <span class="n">bogosort</span> <span class="nv">@data</span><span class="p">;</span>
</code></pre></div><p>è¾“å‡ºï¼š</p>
<pre><code>input  = p e r l s i x
output = e i l p r s x
[Finished in 1.326s]
</code></pre><ul>
<li>mergesort</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#! /usr/bin/env raku</span>

<span class="k">sub</span> <span class="nb">merge</span> <span class="p">(</span><span class="nv">@a</span><span class="o">,</span> <span class="nv">@b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">gather</span> <span class="k">while</span> <span class="nv">@a</span> <span class="o">&amp;&amp;</span> <span class="nv">@b</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nv">@a</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="ow">before</span> <span class="nv">@b</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="p">{</span> <span class="nb">take</span> <span class="nv">@a</span><span class="o">.</span><span class="nb">shift</span> <span class="p">}</span>
        <span class="k">else</span>                  <span class="p">{</span> <span class="nb">take</span> <span class="nv">@b</span><span class="o">.</span><span class="nb">shift</span> <span class="p">}</span>
    <span class="p">}</span><span class="o">,</span>
    <span class="nv">@a</span><span class="o">,</span>
    <span class="nv">@b</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">mergesort</span> <span class="p">(</span> <span class="o">*</span><span class="nv">@list</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">@list</span> <span class="k">if</span> <span class="nv">@list</span><span class="o">.</span><span class="nb">elems</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">$middle</span> <span class="o">=</span> <span class="nv">@list</span><span class="o">.</span><span class="nb">elems</span> <span class="ow">div</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">@left</span>   <span class="o">=</span> <span class="n">mergesort</span> <span class="nv">@list</span><span class="o">[</span> <span class="mi">0</span> <span class="o">..^</span> <span class="nv">$middle</span> <span class="o">]</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">@right</span>  <span class="o">=</span> <span class="n">mergesort</span> <span class="nv">@list</span><span class="o">[</span> <span class="nv">$middle</span> <span class="o">..</span> <span class="o">*</span>  <span class="o">]</span><span class="p">;</span>

    <span class="k">return</span> <span class="nb">merge</span><span class="p">(</span><span class="nv">@left</span><span class="o">,</span> <span class="nv">@right</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1"># my @data = 6, 7, 2, 1, 8, 9, 5, 3, 4;</span>
<span class="k">my</span> <span class="nv">@data</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s"> p e r l s i x </span><span class="p">&gt;;</span>

<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">input  = </span><span class="p">{</span>           <span class="nv">@data</span>  <span class="p">}&#34;;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">output = </span><span class="p">{</span> <span class="nf">mergesort</span><span class="p">(</span><span class="nv">@data</span><span class="p">)</span> <span class="p">}&#34;;</span>
</code></pre></div><p>è¾“å‡ºï¼š</p>
<pre><code>input  = p e r l s i x
output = e i l p r s x
[Finished in 0.337s]
</code></pre><ul>
<li>mergesort_functional</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#! /usr/bin/env raku</span>

<span class="k">multi</span> <span class="nb">merge</span> <span class="p">(</span><span class="o">[],</span> <span class="nv">@ys</span><span class="p">)</span> <span class="p">{</span> <span class="nv">@ys</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nb">merge</span> <span class="p">(</span><span class="nv">@xs</span><span class="o">,</span> <span class="o">[]</span><span class="p">)</span> <span class="p">{</span> <span class="nv">@xs</span> <span class="p">}</span>

<span class="k">multi</span> <span class="nb">merge</span> <span class="p">(</span><span class="o">[</span><span class="nv">$x</span><span class="o">,</span> <span class="o">*</span><span class="nv">@xs</span><span class="o">],</span> <span class="o">[</span><span class="nv">$y</span><span class="o">,</span> <span class="o">*</span><span class="nv">@ys</span><span class="o">]</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$x</span> <span class="ow">before</span> <span class="nv">$y</span> <span class="o">??</span> <span class="p">(</span><span class="nv">$x</span><span class="o">,</span> <span class="nb">merge</span> <span class="nv">@xs</span><span class="o">,</span> <span class="o">[</span><span class="nv">$y</span><span class="o">,</span> <span class="nv">@ys</span><span class="o">]</span><span class="p">)</span>
                 <span class="o">!!</span> <span class="p">(</span><span class="nv">$y</span><span class="o">,</span> <span class="nb">merge</span> <span class="o">[</span><span class="nv">$x</span><span class="o">,</span> <span class="nv">@xs</span><span class="o">],</span> <span class="nv">@ys</span><span class="p">)</span>
<span class="p">}</span>


<span class="k">multi</span> <span class="nf">mergesort</span> <span class="p">(</span> <span class="o">[]</span> <span class="p">)</span> <span class="p">{</span>  <span class="o">[]</span>  <span class="p">}</span>
<span class="k">multi</span> <span class="nf">mergesort</span> <span class="p">(</span><span class="o">[</span><span class="nv">$x</span><span class="o">]</span><span class="p">)</span> <span class="p">{</span> <span class="o">[</span><span class="nv">$x</span><span class="o">]</span> <span class="p">}</span>

<span class="k">multi</span> <span class="nf">mergesort</span> <span class="p">(</span><span class="nv">@xs</span><span class="p">)</span>  <span class="p">{</span>
    <span class="nb">merge</span>
        <span class="nf">mergesort</span><span class="p">(</span> <span class="nv">@xs</span><span class="o">[</span><span class="mi">0</span> <span class="o">..^</span> <span class="nv">@xs</span><span class="o">.</span><span class="nb">elems</span> <span class="ow">div</span> <span class="mi">2</span><span class="o">]</span> <span class="p">)</span><span class="o">,</span>
        <span class="nf">mergesort</span><span class="p">(</span> <span class="nv">@xs</span><span class="o">[</span><span class="nv">@xs</span><span class="o">.</span><span class="nb">elems</span> <span class="ow">div</span> <span class="mi">2</span> <span class="o">..</span> <span class="o">*</span> <span class="o">]</span> <span class="p">)</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">@data</span> <span class="o">=</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="p">;</span>
<span class="c1">#my @data = &lt; p e r l s i x &gt;;</span>

<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">input  = </span><span class="p">{</span>           <span class="nv">@data</span>  <span class="p">}&#34;;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">output = </span><span class="p">{</span> <span class="nf">mergesort</span><span class="p">(</span><span class="nv">@data</span><span class="p">)</span> <span class="p">}&#34;;</span>
</code></pre></div><p>è¾“å‡ºï¼š</p>
<pre><code>input  = 6 7 2 1 8 9 5 3 4
output = 1 2 3 4 5 6 7 8 9
[Finished in 0.373s]
</code></pre><ul>
<li>mergesort_functional_given</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#! /usr/bin/env raku</span>

<span class="k">multi</span> <span class="nb">merge</span> <span class="p">(</span><span class="o">[],</span> <span class="nv">@ys</span><span class="p">)</span> <span class="p">{</span> <span class="nv">@ys</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nb">merge</span> <span class="p">(</span><span class="nv">@xs</span><span class="o">,</span> <span class="o">[]</span><span class="p">)</span> <span class="p">{</span> <span class="nv">@xs</span> <span class="p">}</span>

<span class="k">multi</span> <span class="nb">merge</span> <span class="p">(</span><span class="o">[</span><span class="nv">$x</span><span class="o">,</span> <span class="o">*</span><span class="nv">@xs</span><span class="o">],</span> <span class="o">[</span><span class="nv">$y</span><span class="o">,</span> <span class="o">*</span><span class="nv">@ys</span><span class="o">]</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$x</span> <span class="ow">before</span> <span class="nv">$y</span> <span class="o">??</span> <span class="p">(</span><span class="nv">$x</span><span class="o">,</span> <span class="nb">merge</span> <span class="nv">@xs</span><span class="o">,</span> <span class="o">[</span><span class="nv">$y</span><span class="o">,</span> <span class="nv">@ys</span><span class="o">]</span><span class="p">)</span>
                 <span class="o">!!</span> <span class="p">(</span><span class="nv">$y</span><span class="o">,</span> <span class="nb">merge</span> <span class="o">[</span><span class="nv">$x</span><span class="o">,</span> <span class="nv">@xs</span><span class="o">],</span> <span class="nv">@ys</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">multi</span> <span class="nf">mergesort</span> <span class="p">(</span> <span class="o">[]</span> <span class="p">)</span> <span class="p">{</span>  <span class="o">[]</span>  <span class="p">}</span>
<span class="k">multi</span> <span class="nf">mergesort</span> <span class="p">(</span><span class="o">[</span><span class="nv">$x</span><span class="o">]</span><span class="p">)</span> <span class="p">{</span> <span class="o">[</span><span class="nv">$x</span><span class="o">]</span> <span class="p">}</span>

<span class="k">multi</span> <span class="nf">mergesort</span> <span class="p">(</span><span class="nv">@xs</span><span class="p">)</span>  <span class="p">{</span>
    <span class="k">given</span> <span class="nv">@xs</span><span class="o">.</span><span class="nb">elems</span> <span class="ow">div</span> <span class="mi">2</span> <span class="k">-&gt;</span> <span class="nv">$middle</span> <span class="p">{</span>
        <span class="nb">merge</span>
            <span class="nf">mergesort</span><span class="p">(</span> <span class="nv">@xs</span><span class="o">[</span> <span class="mi">0</span> <span class="o">..^</span> <span class="nv">$middle</span> <span class="o">]</span> <span class="p">)</span><span class="o">,</span>
            <span class="nf">mergesort</span><span class="p">(</span> <span class="nv">@xs</span><span class="o">[</span> <span class="nv">$middle</span> <span class="o">..</span> <span class="o">*</span>  <span class="o">]</span> <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="k">my</span> <span class="nv">@data</span> <span class="o">=</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="p">;</span>
<span class="c1">#my @data = &lt; p e r l s i x &gt;;</span>

<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">input  = </span><span class="p">{</span>           <span class="nv">@data</span>  <span class="p">}&#34;;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">output = </span><span class="p">{</span> <span class="nf">mergesort</span><span class="p">(</span><span class="nv">@data</span><span class="p">)</span> <span class="p">}&#34;;</span>
</code></pre></div><p>è¾“å‡ºï¼š</p>
<pre><code>input  = 6 7 2 1 8 9 5 3 4
output = 1 2 3 4 5 6 7 8 9
[Finished in 0.375s]
</code></pre><ul>
<li>mergesort_functional_interleaved</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#! /usr/bin/env raku</span>

<span class="k">multi</span> <span class="nb">merge</span> <span class="p">(</span><span class="o">[],</span> <span class="nv">@ys</span><span class="p">)</span> <span class="p">{</span> <span class="nv">@ys</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nb">merge</span> <span class="p">(</span><span class="nv">@xs</span><span class="o">,</span> <span class="o">[]</span><span class="p">)</span> <span class="p">{</span> <span class="nv">@xs</span> <span class="p">}</span>

<span class="k">multi</span> <span class="nb">merge</span> <span class="p">(</span><span class="o">[</span><span class="nv">$x</span><span class="o">,</span> <span class="o">*</span><span class="nv">@xs</span><span class="o">],</span> <span class="o">[</span><span class="nv">$y</span><span class="o">,</span> <span class="o">*</span><span class="nv">@ys</span><span class="o">]</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$x</span> <span class="ow">before</span> <span class="nv">$y</span> <span class="o">??</span> <span class="p">(</span><span class="nv">$x</span><span class="o">,</span> <span class="nb">merge</span> <span class="nv">@xs</span><span class="o">,</span> <span class="o">[</span><span class="nv">$y</span><span class="o">,</span> <span class="nv">@ys</span><span class="o">]</span><span class="p">)</span>
                 <span class="o">!!</span> <span class="p">(</span><span class="nv">$y</span><span class="o">,</span> <span class="nb">merge</span> <span class="o">[</span><span class="nv">$x</span><span class="o">,</span> <span class="nv">@xs</span><span class="o">],</span> <span class="nv">@ys</span><span class="p">)</span>
<span class="p">}</span>


<span class="k">multi</span> <span class="nf">mergesort</span> <span class="p">(</span> <span class="o">[]</span> <span class="p">)</span> <span class="p">{</span>  <span class="o">[]</span>  <span class="p">}</span>
<span class="k">multi</span> <span class="nf">mergesort</span> <span class="p">(</span><span class="o">[</span><span class="nv">$x</span><span class="o">]</span><span class="p">)</span> <span class="p">{</span> <span class="o">[</span><span class="nv">$x</span><span class="o">]</span> <span class="p">}</span>

<span class="k">multi</span> <span class="nf">mergesort</span> <span class="p">(</span><span class="nv">@xs</span><span class="p">)</span>  <span class="p">{</span>
    <span class="nb">merge</span>
        <span class="nf">mergesort</span><span class="p">(</span> <span class="nv">@xs</span><span class="o">[</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span><span class="o">...*]</span> <span class="p">)</span><span class="o">,</span>
        <span class="nf">mergesort</span><span class="p">(</span> <span class="nv">@xs</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">3</span><span class="o">...*]</span> <span class="p">)</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">@data</span> <span class="o">=</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="p">;</span>
<span class="c1">#my @data = &lt; p e r l s i x &gt;;</span>

<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">input  = </span><span class="p">{</span>           <span class="nv">@data</span>  <span class="p">}&#34;;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">output = </span><span class="p">{</span> <span class="nf">mergesort</span><span class="p">(</span><span class="nv">@data</span><span class="p">)</span> <span class="p">}&#34;;</span>
</code></pre></div><p>è¾“å‡ºï¼š</p>
<pre><code>input  = 6 7 2 1 8 9 5 3 4
output = 1 2 3 4 5 6 7 8 9
[Finished in 0.34s]
</code></pre><ul>
<li>quicksort</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#! /usr/bin/env raku</span>

<span class="k">sub</span> <span class="nf">quicksort</span><span class="p">(</span> <span class="o">*</span><span class="nv">@list</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">@list</span> <span class="k">if</span> <span class="nv">@list</span><span class="o">.</span><span class="nb">elems</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">$pivot</span> <span class="o">=</span> <span class="nv">@list</span><span class="o">.</span><span class="nb">shift</span><span class="p">;</span>
    <span class="c1"># my $pivot = @list.=pick(*).shift;</span>

    <span class="k">my</span> <span class="p">(</span><span class="nv">@before</span><span class="o">,</span> <span class="nv">@after</span><span class="p">);</span>
    <span class="k">for</span> <span class="nv">@list</span> <span class="k">-&gt;</span> <span class="nv">$elem</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nv">$elem</span> <span class="ow">before</span> <span class="nv">$pivot</span> <span class="p">{</span> <span class="nv">@before</span><span class="o">.</span><span class="nb">push</span><span class="p">(</span><span class="nv">$elem</span><span class="p">);</span> <span class="p">}</span>
        <span class="k">else</span>                   <span class="p">{</span> <span class="nv">@after</span><span class="o">.</span><span class="nb">push</span><span class="p">(</span><span class="nv">$elem</span><span class="p">);</span>  <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nf">quicksort</span><span class="p">(</span><span class="nv">@before</span><span class="p">)</span><span class="o">,</span>
        <span class="nv">$pivot</span><span class="o">,</span>
        <span class="nf">quicksort</span><span class="p">(</span><span class="nv">@after</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">#my @data = 6, 7, 2, 1, 8, 9, 5, 3, 4;</span>
<span class="k">my</span> <span class="nv">@data</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s"> p e r l s i x </span><span class="p">&gt;;</span>

<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">input  = </span><span class="p">{</span>           <span class="nv">@data</span>  <span class="p">}&#34;;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">output = </span><span class="p">{</span> <span class="nf">quicksort</span><span class="p">(</span><span class="nv">@data</span><span class="p">)</span> <span class="p">}&#34;;</span>
</code></pre></div><p>è¾“å‡ºï¼š</p>
<pre><code>input  = p e r l s i x
output = e i l p r s x
[Finished in 0.246s]
</code></pre><ul>
<li>quicksort_classify</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#! /usr/bin/env raku</span>

<span class="k">multi</span> <span class="nf">quicksort</span><span class="p">(</span>  <span class="o">[]</span>  <span class="p">)</span> <span class="p">{</span>    <span class="p">};</span>
<span class="k">multi</span> <span class="nf">quicksort</span><span class="p">(</span>  <span class="nb">Mu</span>  <span class="p">)</span> <span class="p">{</span>    <span class="p">};</span>
<span class="k">multi</span> <span class="nf">quicksort</span><span class="p">(</span> <span class="o">[</span><span class="nv">$x</span><span class="o">]</span> <span class="p">)</span> <span class="p">{</span> <span class="nv">$x</span> <span class="p">};</span>

<span class="k">multi</span> <span class="nf">quicksort</span><span class="p">(</span> <span class="o">[</span><span class="nv">$pivot</span><span class="o">,</span> <span class="o">*</span><span class="nv">@xs</span><span class="o">]</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">given</span> <span class="nv">@xs</span><span class="o">.</span><span class="nb">classify</span><span class="o">:</span><span class="p">{</span> <span class="nv">$^elem</span> <span class="ow">before</span> <span class="nv">$pivot</span> <span class="o">??</span> <span class="p">&#39;</span><span class="s1">pre</span><span class="p">&#39;</span> <span class="o">!!</span> <span class="p">&#39;</span><span class="s1">post</span><span class="p">&#39;}</span> <span class="p">{</span>
        <span class="nf">quicksort</span><span class="p">(</span> <span class="o">.</span><span class="p">&lt;</span><span class="s">pre</span><span class="p">&gt;</span>  <span class="p">)</span><span class="o">,</span>
        <span class="nv">$pivot</span><span class="o">,</span>
        <span class="nf">quicksort</span><span class="p">(</span> <span class="o">.</span><span class="p">&lt;</span><span class="s">post</span><span class="p">&gt;</span> <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">#my @data = 6, 7, 2, 1, 8, 9, 5, 3, 4;</span>
<span class="k">my</span> <span class="nv">@data</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s"> p e r l s i x </span><span class="p">&gt;;</span>

<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">input  = </span><span class="p">{</span>           <span class="nv">@data</span>  <span class="p">}&#34;;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">output = </span><span class="p">{</span> <span class="nf">quicksort</span><span class="p">(</span><span class="nv">@data</span><span class="p">)</span> <span class="p">}&#34;;</span>
</code></pre></div><p>è¾“å‡ºï¼š</p>
<pre><code>input  = p e r l s i x
output =  e i  l p  r  s x
[Finished in 0.303s]
</code></pre><ul>
<li>quicksort_functional</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#! /usr/bin/env raku</span>

<span class="k">multi</span> <span class="nf">quicksort</span><span class="p">(</span>  <span class="o">[]</span>  <span class="p">)</span> <span class="p">{</span>    <span class="p">};</span>
<span class="k">multi</span> <span class="nf">quicksort</span><span class="p">(</span> <span class="o">[</span><span class="nv">$x</span><span class="o">]</span> <span class="p">)</span> <span class="p">{</span> <span class="nv">$x</span> <span class="p">};</span>

<span class="k">multi</span> <span class="nf">quicksort</span><span class="p">(</span> <span class="o">[</span><span class="nv">$pivot</span><span class="o">,</span> <span class="o">*</span><span class="nv">@xs</span><span class="o">]</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nf">quicksort</span><span class="p">(</span><span class="nv">@xs</span><span class="o">.</span><span class="nb">grep</span><span class="o">:</span> <span class="o">*</span> <span class="ow">before</span> <span class="nv">$pivot</span><span class="p">)</span><span class="o">,</span>
    <span class="nv">$pivot</span><span class="o">,</span>
    <span class="nf">quicksort</span><span class="p">(</span><span class="nv">@xs</span><span class="o">.</span><span class="nb">grep</span><span class="o">:</span> <span class="o">*</span> <span class="o">!</span><span class="ow">before</span> <span class="nv">$pivot</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">#my @data = 6, 7, 2, 1, 8, 9, 5, 3, 4;</span>
<span class="k">my</span> <span class="nv">@data</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s"> p e r l s i x </span><span class="p">&gt;;</span>

<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">input  = </span><span class="p">{</span>           <span class="nv">@data</span>  <span class="p">}&#34;;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">output = </span><span class="p">{</span> <span class="nf">quicksort</span><span class="p">(</span><span class="nv">@data</span><span class="p">)</span> <span class="p">}&#34;;</span>
</code></pre></div><p>è¾“å‡º:</p>
<pre><code>input  = p e r l s i x
output =  e i l  p  r  s x
[Finished in 0.27s]
</code></pre><h2 id="pm-æ¨¡å—">pm æ¨¡å—</h2>
<p>é¦–å…ˆæŠŠè‡ªå®šä¹‰çš„ Bank.pm æ¨¡å—å¤åˆ¶åˆ° Raku çš„ lib ç›®å½•ä¸‹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="n">cp</span> <span class="n">Bank</span><span class="o">.</span><span class="nf">pm</span> <span class="o">~/.</span><span class="nf">rakudobrew</span><span class="o">/</span><span class="n">moar-nom</span><span class="o">/</span><span class="nb">install</span><span class="o">/</span><span class="nb">share</span><span class="o">/</span><span class="nb">raku</span><span class="o">/</span><span class="n">site</span><span class="o">/</span><span class="nb">lib</span>
</code></pre></div><p>Bank.pm</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#! /usr/bin/raku</span>

<span class="k">class</span> <span class="nc">Ident</span> <span class="p">{</span>
    <span class="k">subset</span> <span class="nc">Pattern</span> <span class="k">of</span> <span class="nb">Str</span> <span class="k">where</span> <span class="o">/</span> \<span class="nb">d</span><span class="o">**</span><span class="mi">3</span> <span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span> \<span class="nb">d</span><span class="o">**</span><span class="mi">3</span> <span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span> \<span class="nb">d</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span><span class="p">;</span>

    <span class="k">has</span> <span class="nb">Str</span> <span class="nv">$.name</span>              <span class="o">=</span> <span class="p">&#39;</span><span class="s1">????</span><span class="p">&#39;;</span>
    <span class="k">has</span> <span class="nb">Str</span> <span class="nv">$.ID</span>  <span class="k">where</span> <span class="n">Pattern</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">000-000-000</span><span class="p">&#39;;</span>
<span class="p">}</span>

<span class="k">role</span> <span class="nc">Taxable</span> <span class="o">[:</span><span class="nv">$THRESHOLD</span> <span class="o">=</span> <span class="mi">100_000</span><span class="o">]</span> <span class="p">{</span>
    <span class="k">constant</span> <span class="no">GENERAL_TAX_RATE</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">;</span>

    <span class="k">has</span> <span class="nv">%.tax_record</span><span class="p">;</span>

    <span class="k">method</span> <span class="nf">tax_credits</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>

    <span class="k">method</span> <span class="nf">calculate_tax</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">$tax_payable</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$.balance</span> <span class="nb">min</span> <span class="nv">$THRESHOLD</span><span class="p">)</span> <span class="o">*</span> <span class="n">GENERAL_TAX_RATE</span>
                          <span class="o">-</span> <span class="nv">$.tax_credits</span><span class="p">;</span>

        <span class="nv">%!tax_record</span><span class="p">{</span><span class="nb">now</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$tax_payable</span><span class="p">;</span>

        <span class="k">return</span> <span class="nv">$tax_payable</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Account</span> <span class="k">does</span> <span class="nc">Taxable</span> <span class="p">{</span>
    <span class="k">subset</span> <span class="nc">ID</span> <span class="k">of</span> <span class="nb">Str</span> <span class="k">where</span> <span class="o">/</span> <span class="p">&lt;</span><span class="s">alpha</span><span class="p">&gt;</span><span class="o">**</span><span class="mi">4</span> <span class="o">&lt;</span><span class="n">digit</span><span class="o">&gt;**</span><span class="mi">5</span> <span class="o">/</span><span class="p">;</span>

    <span class="k">state</span> <span class="n">ID</span> <span class="nv">$next_account_ID</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">AAAA00001</span><span class="p">&#39;;</span>

    <span class="k">has</span> <span class="nb">Str</span>     <span class="nv">$.name</span>        <span class="o">=</span> <span class="nb">die</span> <span class="p">&#39;</span><span class="s1">Must provide account name</span><span class="p">&#39;;</span>
    <span class="k">has</span> <span class="nb">Numeric</span> <span class="nv">$.balance</span>     <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">has</span> <span class="n">ID</span>      <span class="nv">$.ID</span>          <span class="o">=</span> <span class="nv">$next_account_ID</span><span class="o">++</span><span class="p">;</span>

    <span class="k">method</span> <span class="nf">deposit</span><span class="p">(</span><span class="nb">Numeric</span> <span class="nv">$amount</span> <span class="k">where</span> <span class="o">*&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$!balance</span> <span class="o">+=</span> <span class="nv">$amount</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">withdraw</span><span class="p">(</span><span class="nb">Numeric</span> <span class="nv">$amount</span> <span class="k">where</span> <span class="o">*&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">fail</span> <span class="p">&#34;</span><span class="s2">Insufficient funds to withdraw </span><span class="nv">$amount</span><span class="p">&#34;</span>
            <span class="k">if</span> <span class="nv">$.balance</span> <span class="o">&lt;</span> <span class="nv">$amount</span><span class="p">;</span>
        <span class="nv">$!balance</span> <span class="o">-=</span> <span class="nv">$amount</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">description</span> <span class="p">()</span> <span class="p">{</span>
        <span class="p">&#34;</span><span class="nv">$.ID</span><span class="s2"> (</span><span class="nv">$.name</span><span class="s2">): balance=</span><span class="nv">$.balance</span><span class="p">&#34;;</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">tax_credits</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Bank</span> <span class="p">{</span>
    <span class="k">has</span> <span class="n">Ident</span>   <span class="nv">$!ident</span>     <span class="nb">handles</span><span class="p">&lt;</span><span class="s"> name ID </span><span class="p">&gt;;</span>
    <span class="k">has</span> <span class="n">Account</span> <span class="nv">%!accounts</span><span class="p">;</span>

    <span class="k">submethod</span> <span class="nb">BUILD</span> <span class="p">(</span><span class="o">|</span><span class="nb">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$!ident</span> <span class="o">.=</span> <span class="nb">new</span><span class="p">(</span><span class="o">|</span><span class="nb">args</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">add_account</span><span class="p">(</span><span class="n">Account</span> <span class="nv">$account</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">%!accounts</span><span class="p">{</span><span class="nv">$account</span><span class="o">.</span><span class="nf">ID</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$account</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">close_account</span><span class="p">(</span><span class="nb">Str</span> <span class="nv">$ID</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">%!accounts</span><span class="p">{</span><span class="nv">$ID</span><span class="p">}</span> <span class="p">:</span><span class="s">delete</span>
            <span class="p">//</span> <span class="nb">fail</span> <span class="p">&#34;</span><span class="s2">No such account</span><span class="p">&#34;;</span>
    <span class="p">}</span>

    <span class="k">multi</span> <span class="k">method</span> <span class="nf">get_account</span><span class="p">(</span><span class="n">Account::ID</span> <span class="nv">$ID</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">%!accounts</span><span class="p">{</span><span class="nv">$ID</span><span class="p">}</span> <span class="o">//</span> <span class="nb">fail</span> <span class="p">&#34;</span><span class="s2">No such account</span><span class="p">&#34;;</span>
    <span class="p">}</span>

    <span class="k">multi</span> <span class="k">method</span> <span class="nf">get_account</span><span class="p">(</span><span class="nb">Any</span> <span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1"># return %!accounts.values.grep({.name ~~ $name});</span>
        <span class="nb">self</span><span class="o">.</span><span class="nf">for_each_account</span><span class="p">({</span><span class="o">.</span><span class="nb">take</span> <span class="k">if</span> <span class="o">.</span><span class="nb">name</span> <span class="o">~~</span> <span class="nv">$name</span><span class="p">});</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">for_each_account</span> <span class="p">(</span><span class="nv">&amp;action_on</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">gather</span> <span class="k">for</span> <span class="nv">%!accounts</span><span class="o">.</span><span class="nb">values</span> <span class="k">-&gt;</span> <span class="nv">$account</span> <span class="k">is</span> <span class="k">rw</span> <span class="p">{</span>
            <span class="nf">action_on</span><span class="p">(</span><span class="nv">$account</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">collect_taxes</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nb">self</span><span class="o">.</span><span class="nf">for_each_account:</span> <span class="p">{</span>
            <span class="k">my</span> <span class="nv">$tax</span> <span class="o">=</span> <span class="o">.</span><span class="nf">calculate_tax</span><span class="p">();</span>
            <span class="o">.</span><span class="nf">withdraw</span><span class="p">(</span><span class="nv">$tax</span><span class="p">);</span>
            <span class="nb">take</span> <span class="o">.</span><span class="s">ID</span> <span class="o">=&gt;</span> <span class="nv">$tax</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nb">report</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">[ </span><span class="p">{</span><span class="nb">self</span><span class="o">.</span><span class="nf">ID</span><span class="p">}</span><span class="s2"> [</span><span class="p">{</span><span class="nb">self</span><span class="o">.</span><span class="nb">name</span><span class="p">}</span><span class="s2">] ]</span><span class="p">&#34;;</span>         <span class="c1"># Or: say &#34;[ $.ID [$.name] ]&#34;;</span>
        <span class="nb">self</span><span class="o">.</span><span class="nf">for_each_account</span><span class="p">(</span><span class="o">*.</span><span class="nf">description</span><span class="o">.</span><span class="nb">say</span><span class="p">);</span>
        <span class="nb">say</span> <span class="p">&#39;&#39;;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Account::Corporate</span>
    <span class="k">is</span> <span class="nc">Account</span>
    <span class="k">does</span> <span class="nc">Taxable</span><span class="o">[</span><span class="s">THRESHOLD</span> <span class="o">=&gt;</span> <span class="mi">1_000_000</span><span class="o">]</span>
<span class="p">{</span>
    <span class="k">has</span> <span class="nb">Str</span> <span class="nv">$.company_ID</span><span class="p">;</span>

    <span class="k">method</span> <span class="nf">tax_credits</span> <span class="p">{</span> <span class="mi">5_000</span> <span class="p">}</span>

    <span class="k">method</span> <span class="nf">description</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nb">callsame</span><span class="p">()</span> <span class="o">~</span> <span class="p">&#34;</span><span class="s2">  [</span><span class="nv">$.company_ID</span><span class="s2">]</span><span class="p">&#34;;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>è¯¥æ¨¡å—çš„åŠŸèƒ½æ˜¯è®¡ç®—é“¶è¡Œå­˜æ¬¾æ±‡ç‡ç­‰ã€‚ä¸‹é¢ä½¿ç”¨è¿™ä¸ªæ¨¡å—ï¼š</p>
<ul>
<li>demo</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#! /usr/bin/env raku</span>

<span class="k">use</span> <span class="nn">Bank</span><span class="p">;</span>

<span class="k">my</span> <span class="n">Bank</span> <span class="nv">$bank</span> <span class="o">.=</span> <span class="nb">new</span><span class="p">(:</span><span class="s">ID</span><span class="p">(&#39;</span><span class="s1">123-456-789</span><span class="p">&#39;));</span>

<span class="nv">$bank</span><span class="o">.</span><span class="nf">add_account:</span> <span class="n">Account</span><span class="o">.</span><span class="nb">new</span><span class="p">(:</span><span class="s">name</span><span class="p">(&#39;</span><span class="s1">Leslie Grace</span><span class="p">&#39;)</span>                  <span class="p">);</span>
<span class="nv">$bank</span><span class="o">.</span><span class="nf">add_account:</span> <span class="n">Account</span><span class="o">.</span><span class="nb">new</span><span class="p">(:</span><span class="s">name</span><span class="p">(&#39;</span><span class="s1">Dana McKenna</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">:</span><span class="s">balance</span><span class="p">(</span><span class="mi">10_000</span><span class="p">));</span>
<span class="nv">$bank</span><span class="o">.</span><span class="nf">add_account:</span> <span class="n">Account</span><span class="o">.</span><span class="nb">new</span><span class="p">(:</span><span class="s">name</span><span class="p">(&#39;</span><span class="s1">AstroDynamic</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">:</span><span class="s">balance</span><span class="p">(</span>   <span class="mf">2e7</span><span class="p">));</span>
<span class="nv">$bank</span><span class="o">.</span><span class="nf">add_account:</span> <span class="n">Account</span><span class="o">.</span><span class="nb">new</span><span class="p">(:</span><span class="s">name</span><span class="p">(&#39;</span><span class="s1">Jan van Quod</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">:</span><span class="s">balance</span><span class="p">(</span> <span class="mi">9_999</span><span class="p">));</span>
<span class="nv">$bank</span><span class="o">.</span><span class="nf">add_account:</span> <span class="n">Account</span><span class="o">.</span><span class="nb">new</span><span class="p">(:</span><span class="s">name</span><span class="p">(&#39;</span><span class="s1">OmniCorp LLC</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">:</span><span class="s">balance</span><span class="p">(</span>   <span class="mf">1e6</span><span class="p">));</span>
<span class="nv">$bank</span><span class="o">.</span><span class="nb">report</span><span class="p">;</span>

<span class="nv">$bank</span><span class="o">.</span><span class="nf">get_account</span><span class="p">(&#39;</span><span class="s1">AAAA00003</span><span class="p">&#39;)</span><span class="o">.</span><span class="nf">deposit</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="nv">$bank</span><span class="o">.</span><span class="nf">get_account</span><span class="p">(&#39;</span><span class="s1">Jan van Quod</span><span class="p">&#39;)</span><span class="o">Â».</span><span class="nf">deposit</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="nv">$bank</span><span class="o">.</span><span class="nf">get_account</span><span class="p">(/</span><span class="sr">D</span><span class="ni">.</span><span class="sr">na</span><span class="p">/)</span><span class="o">Â».</span><span class="nf">deposit</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="c1">#$bank.get_account(*)Â».deposit(99);</span>
<span class="nv">$bank</span><span class="o">.</span><span class="nb">report</span><span class="p">;</span>

<span class="k">given</span> <span class="nv">$bank</span><span class="o">.</span><span class="nf">close_account</span><span class="p">(&#39;</span><span class="s1">AAAA00005</span><span class="p">&#39;)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Closed </span><span class="nv">$^account</span><span class="o">.</span><span class="nf">perl</span><span class="p">()</span><span class="s2">\n</span><span class="p">&#34;;</span>
    <span class="nv">$bank</span><span class="o">.</span><span class="nb">report</span><span class="p">;</span>
<span class="p">}</span>

<span class="nv">$bank</span><span class="o">.</span><span class="nf">close_account</span><span class="p">(&#39;</span><span class="s1">ZZZZ99999</span><span class="p">&#39;);</span>

<span class="nv">$bank</span><span class="o">.</span><span class="nf">get_account</span><span class="p">(&#39;</span><span class="s1">AAAA00001</span><span class="p">&#39;)</span><span class="o">.</span><span class="nf">withdraw</span><span class="p">(</span><span class="mi">1001</span><span class="p">);</span>
<span class="nv">$bank</span><span class="o">.</span><span class="nb">report</span><span class="p">;</span>
</code></pre></div><p>è¾“å‡ºï¼š</p>
<pre><code>[ 123-456-789 [????] ]
AAAA00004 (Jan van Quod): balance=9999
AAAA00001 (Leslie Grace): balance=0
AAAA00005 (OmniCorp LLC): balance=1000000
AAAA00002 (Dana McKenna): balance=10000
AAAA00003 (AstroDynamic): balance=20000000

[ 123-456-789 [????] ]
AAAA00004 (Jan van Quod): balance=10001
AAAA00001 (Leslie Grace): balance=0
AAAA00005 (OmniCorp LLC): balance=1000000
AAAA00002 (Dana McKenna): balance=10002
AAAA00003 (AstroDynamic): balance=20000102

Closed Account.new(name =&gt; &quot;OmniCorp LLC&quot;, balance =&gt; 1000000e0, ID =&gt; &quot;AAAA00005&quot;, tax_record =&gt; {}&lt;&gt;)

[ 123-456-789 [????] ]
AAAA00004 (Jan van Quod): balance=10001
AAAA00001 (Leslie Grace): balance=0
AAAA00002 (Dana McKenna): balance=10002
AAAA00003 (AstroDynamic): balance=20000102

No such account
  in method close_account at ~/.rakudobrew/moar-nom/install/share/raku/site/lib/Bank.pm:67

Actually thrown at:
  in block &lt;unit&gt; at ~/04.bank_demo.pl:26
[Finished in 0.768s]
</code></pre><ul>
<li>demo_inheritance</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#! /usr/bin/env raku</span>

<span class="k">sub</span> <span class="nf">show</span> <span class="p">(</span><span class="nv">$text</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#39;&#39;;</span>
    <span class="nb">say</span> <span class="p">(&#39;</span><span class="s1">____/ </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$text</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> \_________________________________________________</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">substr</span><span class="p">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">50</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">use</span> <span class="nn">Bank</span><span class="p">;</span>

<span class="k">my</span> <span class="n">Bank</span> <span class="nv">$bank</span> <span class="o">.=</span> <span class="nb">new</span><span class="p">(:</span><span class="s">ID</span><span class="p">(&#39;</span><span class="s1">123-456-789</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">:</span><span class="s">name</span><span class="p">(&#39;</span><span class="s1">Bank of Evil</span><span class="p">&#39;));</span>

<span class="nv">$bank</span><span class="o">.</span><span class="nf">add_account:</span> <span class="n">Account</span><span class="o">.</span><span class="nb">new</span><span class="p">(:</span><span class="s">name</span><span class="p">(&#39;</span><span class="s1">Leslie Grace</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">:</span><span class="s">balance</span><span class="p">(</span> <span class="mi">1_000</span><span class="p">));</span>
<span class="nv">$bank</span><span class="o">.</span><span class="nf">add_account:</span> <span class="n">Account</span><span class="o">.</span><span class="nb">new</span><span class="p">(:</span><span class="s">name</span><span class="p">(&#39;</span><span class="s1">Dana McKenna</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">:</span><span class="s">balance</span><span class="p">(</span><span class="mi">10_000</span><span class="p">));</span>
<span class="nv">$bank</span><span class="o">.</span><span class="nf">add_account:</span> <span class="n">Account</span><span class="o">.</span><span class="nb">new</span><span class="p">(:</span><span class="s">name</span><span class="p">(&#39;</span><span class="s1">Jan van Quod</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">:</span><span class="s">balance</span><span class="p">(</span> <span class="mi">9_999</span><span class="p">));</span>

<span class="nv">$bank</span><span class="o">.</span><span class="nf">add_account:</span> <span class="n">Account::Corporate</span><span class="o">.</span><span class="nb">new</span><span class="p">(:</span><span class="s">name</span><span class="p">(&#39;</span><span class="s1">AstroDynamic</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">:</span><span class="s">balance</span><span class="p">(</span><span class="mf">2e7</span><span class="p">)</span> <span class="p">:</span><span class="s">company_ID</span><span class="p">(&#39;</span><span class="s1">ASDY</span><span class="p">&#39;));</span>
<span class="nv">$bank</span><span class="o">.</span><span class="nf">add_account:</span> <span class="n">Account::Corporate</span><span class="o">.</span><span class="nb">new</span><span class="p">(:</span><span class="s">name</span><span class="p">(&#39;</span><span class="s1">OmniCorp LLC</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">:</span><span class="s">balance</span><span class="p">(</span><span class="mf">1e6</span><span class="p">)</span> <span class="p">:</span><span class="s">company_ID</span><span class="p">(&#39;</span><span class="s1">OMNI</span><span class="p">&#39;));</span>

<span class="n">show</span> <span class="p">&#39;</span><span class="s1">Status</span><span class="p">&#39;;</span>
<span class="nv">$bank</span><span class="o">.</span><span class="nb">report</span><span class="p">;</span>

<span class="n">show</span> <span class="p">&#39;</span><span class="s1">Taxes collected</span><span class="p">&#39;;</span>
<span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="nv">$bank</span><span class="o">.</span><span class="nf">collect_taxes</span><span class="p">();</span>

<span class="n">show</span> <span class="p">&#39;</span><span class="s1">Status</span><span class="p">&#39;;</span>
<span class="nv">$bank</span><span class="o">.</span><span class="nb">report</span><span class="p">;</span>

<span class="nv">$bank</span><span class="o">.</span><span class="nf">collect_taxes</span><span class="p">();</span>

<span class="n">show</span> <span class="p">&#39;</span><span class="s1">Tax records</span><span class="p">&#39;;</span>
<span class="nv">$bank</span><span class="o">.</span><span class="nf">for_each_account</span><span class="p">({</span> <span class="nb">say</span> <span class="o">.</span><span class="nb">name</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">: </span><span class="p">&#39;</span><span class="o">,</span> <span class="o">.</span><span class="nf">tax_record</span> <span class="p">});</span>

<span class="n">show</span> <span class="p">&#39;</span><span class="s1">Culling acounts</span><span class="p">&#39;;</span>
<span class="k">given</span> <span class="nv">$bank</span> <span class="p">{</span>
    <span class="o">.</span><span class="nf">for_each_account:</span> <span class="p">{</span>
        <span class="o">.</span><span class="nf">close_account</span><span class="p">(</span><span class="nv">$^account</span><span class="o">.</span><span class="nf">ID</span><span class="p">)</span><span class="o">.</span><span class="nb">say</span>
            <span class="k">if</span> <span class="nv">$^account</span><span class="o">.</span><span class="nf">balance</span> <span class="o">&lt;</span> <span class="mi">10_000</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">show</span> <span class="p">&#39;</span><span class="s1">Status</span><span class="p">&#39;;</span>
<span class="nv">$bank</span><span class="o">.</span><span class="nb">report</span><span class="p">;</span>
</code></pre></div><p>è¾“å‡ºï¼š</p>
<pre><code>____/ Status \____________________________________
[ 123-456-789 [Bank of Evil] ]
AAAA00004 (AstroDynamic): balance=20000000  [ASDY]
AAAA00001 (Leslie Grace): balance=1000
AAAA00005 (OmniCorp LLC): balance=1000000  [OMNI]
AAAA00002 (Dana McKenna): balance=10000
AAAA00003 (Jan van Quod): balance=9999


____/ Taxes collected \___________________________
AAAA00004 =&gt; 5000
AAAA00001 =&gt; 10
AAAA00005 =&gt; 5000
AAAA00002 =&gt; 100
AAAA00003 =&gt; 99.99

____/ Status \____________________________________
[ 123-456-789 [Bank of Evil] ]
AAAA00004 (AstroDynamic): balance=19995000  [ASDY]
AAAA00001 (Leslie Grace): balance=990
AAAA00005 (OmniCorp LLC): balance=995000  [OMNI]
AAAA00002 (Dana McKenna): balance=9900
AAAA00003 (Jan van Quod): balance=9899.01

____/ Tax records \_______________________________
AstroDynamic: Instant:1440413601.447466 =&gt; 5000, Instant:1440413601.463112 =&gt; 5000
Leslie Grace: Instant:1440413601.450753 =&gt; 10, Instant:1440413601.465823 =&gt; 9.9
OmniCorp LLC: Instant:1440413601.452933 =&gt; 5000, Instant:1440413601.468346 =&gt; 4950
Dana McKenna: Instant:1440413601.454860 =&gt; 100, Instant:1440413601.470238 =&gt; 99
Jan van Quod: Instant:1440413601.457399 =&gt; 99.99, Instant:1440413601.471551 =&gt; 98.9901
____/ Culling acounts \___________________________
Account.new(name =&gt; &quot;Leslie Grace&quot;, balance =&gt; 980.1, ID =&gt; &quot;AAAA00001&quot;, tax_record =&gt; {&quot;Instant:1440413601.450753&quot; =&gt; 10.0, &quot;Instant:1440413601.465823&quot; =&gt; 9.9}&lt;&gt;)
Account.new(name =&gt; &quot;Dana McKenna&quot;, balance =&gt; 9801.0, ID =&gt; &quot;AAAA00002&quot;, tax_record =&gt; {&quot;Instant:1440413601.454860&quot; =&gt; 100.0, &quot;Instant:1440413601.470238&quot; =&gt; 99.0}&lt;&gt;)
Account.new(name =&gt; &quot;Jan van Quod&quot;, balance =&gt; 9800.0199, ID =&gt; &quot;AAAA00003&quot;, tax_record =&gt; {&quot;Instant:1440413601.457399&quot; =&gt; 99.99, &quot;Instant:1440413601.471551&quot; =&gt; 98.9901}&lt;&gt;)

____/ Status \____________________________________
[ 123-456-789 [Bank of Evil] ]
AAAA00004 (AstroDynamic): balance=19990000  [ASDY]
AAAA00005 (OmniCorp LLC): balance=990050  [OMNI]

[Finished in 0.817s]
</code></pre><ul>
<li>demo_unary_dot</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#! /usr/bin/env raku</span>

<span class="k">use</span> <span class="nn">Bank</span><span class="p">;</span>

<span class="k">my</span> <span class="n">Bank</span> <span class="nv">$bank</span> <span class="o">.=</span> <span class="nb">new</span><span class="p">(:</span><span class="s">ID</span><span class="p">(&#39;</span><span class="s1">123-456-789</span><span class="p">&#39;));</span>

<span class="k">given</span> <span class="nv">$bank</span> <span class="p">{</span>
    <span class="o">.</span><span class="nf">add_account:</span> <span class="n">Account</span><span class="o">.</span><span class="nb">new</span><span class="p">(:</span><span class="s">name</span><span class="p">(&#39;</span><span class="s1">Leslie Grace</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">:</span><span class="s">balance</span><span class="p">(</span> <span class="mi">1_000</span><span class="p">));</span>
    <span class="o">.</span><span class="nf">add_account:</span> <span class="n">Account</span><span class="o">.</span><span class="nb">new</span><span class="p">(:</span><span class="s">name</span><span class="p">(&#39;</span><span class="s1">Dana McKenna</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">:</span><span class="s">balance</span><span class="p">(</span><span class="mi">10_000</span><span class="p">));</span>
    <span class="o">.</span><span class="nf">add_account:</span> <span class="n">Account</span><span class="o">.</span><span class="nb">new</span><span class="p">(:</span><span class="s">name</span><span class="p">(&#39;</span><span class="s1">AstroDynamic</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">:</span><span class="s">balance</span><span class="p">(</span>   <span class="mf">2e7</span><span class="p">));</span>
    <span class="o">.</span><span class="nf">add_account:</span> <span class="n">Account</span><span class="o">.</span><span class="nb">new</span><span class="p">(:</span><span class="s">name</span><span class="p">(&#39;</span><span class="s1">Jan van Quod</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">:</span><span class="s">balance</span><span class="p">(</span> <span class="mi">9_999</span><span class="p">));</span>
    <span class="o">.</span><span class="nf">add_account:</span> <span class="n">Account</span><span class="o">.</span><span class="nb">new</span><span class="p">(:</span><span class="s">name</span><span class="p">(&#39;</span><span class="s1">OmniCorp LLC</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">:</span><span class="s">balance</span><span class="p">(</span>   <span class="mf">1e6</span><span class="p">));</span>
    <span class="o">.</span><span class="nb">report</span><span class="p">;</span>

    <span class="o">.</span><span class="nf">get_account</span><span class="p">(&#39;</span><span class="s1">AAAA00003</span><span class="p">&#39;)</span><span class="o">.</span><span class="nf">deposit</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="o">.</span><span class="nb">report</span><span class="p">;</span>

    <span class="nb">say</span> <span class="o">.</span><span class="nf">close_account</span><span class="p">(&#39;</span><span class="s1">AAAA00005</span><span class="p">&#39;);</span>
    <span class="o">.</span><span class="nb">report</span><span class="p">;</span>

    <span class="o">.</span><span class="nf">get_account</span><span class="p">(&#39;</span><span class="s1">AAAA00001</span><span class="p">&#39;)</span><span class="o">.</span><span class="nf">withdraw</span><span class="p">(</span><span class="mi">1001</span><span class="p">);</span>
    <span class="o">.</span><span class="nb">report</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>è¾“å‡ºï¼š</p>
<pre><code>[ 123-456-789 [????] ]
AAAA00004 (Jan van Quod): balance=9999
AAAA00001 (Leslie Grace): balance=1000
AAAA00005 (OmniCorp LLC): balance=1000000
AAAA00002 (Dana McKenna): balance=10000
AAAA00003 (AstroDynamic): balance=20000000

[ 123-456-789 [????] ]
AAAA00004 (Jan van Quod): balance=9999
AAAA00001 (Leslie Grace): balance=1000
AAAA00005 (OmniCorp LLC): balance=1000000
AAAA00002 (Dana McKenna): balance=10000
AAAA00003 (AstroDynamic): balance=20000100

Account.new(name =&gt; &quot;OmniCorp LLC&quot;, balance =&gt; 1000000e0, ID =&gt; &quot;AAAA00005&quot;, tax_record =&gt; {}&lt;&gt;)
[ 123-456-789 [????] ]
AAAA00004 (Jan van Quod): balance=9999
AAAA00001 (Leslie Grace): balance=1000
AAAA00002 (Dana McKenna): balance=10000
AAAA00003 (AstroDynamic): balance=20000100

Insufficient funds to withdraw 1001
  in method withdraw at ~/.rakudobrew/moar-nom/install/share/raku/site/lib/Bank.pm:43
  in block &lt;unit&gt; at ~04.bank_demo_unary_dot.pl:22

[Finished in 0.738s]
</code></pre><h2 id="lzw">LZW</h2>
<p>LZW ç®—æ³•:</p>
<ul>
<li>demo</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#! /usr/bin/env raku</span>

<span class="k">sub</span> <span class="nf">compress</span><span class="p">(</span><span class="nb">Str</span> <span class="nv">$uncompressed</span> <span class="k">--&gt;</span> <span class="nb">List</span><span class="p">)</span>  <span class="p">{</span>
    <span class="c1"># Build a look-up table of encoded representations</span>
    <span class="c1"># (each ASCII char represented by its equivalent codepoint)</span>
    <span class="k">my</span> <span class="nv">%code_for</span> <span class="o">=</span> <span class="nb">map</span> <span class="p">{</span> <span class="nv">$^ASCII</span><span class="o">.</span><span class="s">chr</span> <span class="o">=&gt;</span> <span class="nv">$^ASCII</span> <span class="p">}</span>, <span class="o">^</span><span class="mi">256</span><span class="p">;</span>

    <span class="c1"># Loop and collect each encoding...</span>
    <span class="k">gather</span> <span class="p">{</span>
        <span class="c1"># Track which characters we&#39;ve seen but not yet encoded</span>
        <span class="k">my</span> <span class="nv">$already_seen</span> <span class="o">=</span> <span class="p">&#34;&#34;;</span>

        <span class="c1"># Walk through each single character...</span>
        <span class="k">for</span> <span class="nv">$uncompressed</span><span class="o">.</span><span class="nb">comb</span> <span class="k">-&gt;</span> <span class="nv">$next_char</span> <span class="p">{</span>
            <span class="c1"># Now we&#39;ve seen that next character as well</span>
            <span class="k">my</span> <span class="nv">$now_seen</span> <span class="o">=</span> <span class="nv">$already_seen</span> <span class="o">~</span> <span class="nv">$next_char</span><span class="p">;</span>

            <span class="c1"># If new char sequence is known, keep looking</span>
            <span class="k">if</span> <span class="nv">%code_for</span><span class="p">{</span><span class="nv">$now_seen</span><span class="p">}:</span><span class="s">exists</span> <span class="p">{</span>
                <span class="nv">$already_seen</span> <span class="o">=</span> <span class="nv">$now_seen</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="c1"># Otherwise, we have an unknown sequence of chars</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="c1"># Emit encoding for what we&#39;ve previously seen</span>
                <span class="nb">take</span> <span class="nv">%code_for</span><span class="p">{</span><span class="nv">$already_seen</span><span class="p">};</span>
                <span class="c1"># Add encoding for new unknown sequence to table</span>
                <span class="nv">%code_for</span><span class="p">{</span><span class="nv">$now_seen</span><span class="p">}</span> <span class="o">=</span> <span class="nv">%code_for</span><span class="o">.</span><span class="nb">elems</span><span class="p">;</span>
                <span class="c1"># Restart the current sequence from this char</span>
                <span class="nv">$already_seen</span> <span class="o">=</span> <span class="nv">$next_char</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="c1"># Emit the encoding for the final sequence (if any)</span>
        <span class="nb">take</span> <span class="nv">%code_for</span><span class="p">{</span><span class="nv">$already_seen</span><span class="p">}</span> <span class="k">if</span> <span class="nv">$already_seen</span> <span class="ow">ne</span> <span class="p">&#34;&#34;;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Convert to codepoints...</span>
<span class="k">my</span> <span class="nv">@codes</span> <span class="o">=</span> <span class="nf">compress</span><span class="p">(&#39;</span><span class="s1">To be or not to be. That be the question, matey!</span><span class="p">&#39;);</span>
<span class="nb">say</span> <span class="nv">@codes</span><span class="p">;</span>
<span class="n">separator</span><span class="p">;</span>

<span class="c1"># Emit as characters...</span>
<span class="nb">say</span> <span class="nv">@codes</span><span class="o">Â».</span><span class="nb">chr</span><span class="p">;</span>
<span class="n">separator</span><span class="p">;</span>

<span class="c1"># Convert to a binary sequence...</span>
<span class="k">my</span> <span class="nv">$bits_per_code</span> <span class="o">=</span> <span class="nv">@codes</span><span class="o">.</span><span class="nb">max</span><span class="o">.</span><span class="nb">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="nb">ceiling</span><span class="p">();</span>
<span class="k">my</span> <span class="nv">$format</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">%0</span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$bits_per_code</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">b</span><span class="p">&#39;;</span>
<span class="k">my</span> <span class="nv">$bits</span> <span class="o">=</span> <span class="nv">@codes</span><span class="o">Â».</span><span class="nb">fmt</span><span class="p">(</span><span class="nv">$format</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$bits</span><span class="p">;</span>
<span class="n">separator</span><span class="p">;</span>

<span class="nb">say</span> <span class="nv">$bits</span><span class="o">.</span><span class="nb">comb</span><span class="p">(/</span><span class="ni">.</span><span class="o">**</span><span class="mi">1</span><span class="o">..</span><span class="mi">7</span><span class="p">/)</span><span class="o">.</span><span class="nb">map</span><span class="p">({:</span><span class="mi">2</span><span class="p">(</span><span class="nv">$^bitpattern</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">})</span><span class="o">.</span><span class="nb">join</span><span class="p">;</span>
<span class="n">separator</span><span class="p">;</span>

<span class="k">sub</span> <span class="nf">separator</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">_</span><span class="p">&#39;</span> <span class="nb">x</span> <span class="mi">50</span> <span class="p">}</span>
</code></pre></div><p>è¾“å‡ºï¼š</p>
<pre><code>84 111 32 98 101 32 111 114 32 110 111 116 32 116 257 259 46 32 84 104 97 267 259 268 104 260 113 117 101 115 116 105 111 110 44 32 109 276 101 121 33
__________________________________________________
T o   b e   o r   n o t   t Ä Äƒ .   T h a Ä‹ Äƒ ÄŒ h Ä„ q u e s t i o n ,   m Ä” e y !
__________________________________________________
001010100001101111000100000001100010001100101000100000001101111001110010000100000001101110001101111001110100000100000001110100100000001100000011000101110000100000001010100001101000001100001100001011100000011100001100001101000100000100001110001001110101001100101001110011001110100001101001001101111001101110000101100000100000001101101100010100001100101001111001000100001
__________________________________________________
x@1QoB\7NAt@0\
C aBp4 CDu'h4Ms8,l(2O
__________________________________________________
[Finished in 0.429s]
</code></pre><ul>
<li>LZW_functional</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#! /usr/bin/env raku</span>

<span class="c1"># To compress a string...</span>
<span class="k">sub</span> <span class="nf">compress</span><span class="p">(</span><span class="nb">Str</span> <span class="nv">$uncompressed</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1"># Encode the character list via a dictionary, from the start</span>
    <span class="nb">encode</span><span class="p">(</span> <span class="nv">$uncompressed</span><span class="o">.</span><span class="nb">comb</span><span class="o">,</span> <span class="s">code</span> <span class="o">=&gt;</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">map</span> <span class="p">{</span><span class="nv">$^ASCII</span><span class="o">.</span><span class="s">chr</span> <span class="o">=&gt;</span> <span class="nv">$^ASCII</span><span class="p">}</span>, <span class="o">^</span><span class="mi">256</span><span class="p">)</span><span class="o">,</span> <span class="s">seen</span> <span class="o">=&gt;</span> <span class="p">&#34;&#34;</span> <span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Encode an empty list where nothing already seen as nothing</span>
<span class="k">multi</span> <span class="nb">encode</span><span class="p">(</span><span class="o">[],</span> <span class="o">:</span><span class="nv">%code</span><span class="o">,</span> <span class="o">:</span><span class="nv">$seen</span> <span class="k">where</span> <span class="p">&#34;&#34;)</span> <span class="p">{}</span>

<span class="c1"># Encode an empty list where something already seen by look-up</span>
<span class="k">multi</span> <span class="nb">encode</span><span class="p">(</span><span class="o">[],</span> <span class="o">:</span><span class="nv">%code</span><span class="o">,</span> <span class="o">:</span><span class="nv">$seen</span><span class="p">)</span>          <span class="p">{</span> <span class="nv">%code</span><span class="p">{</span><span class="nv">$seen</span><span class="p">}</span> <span class="p">}</span>

<span class="c1"># Encode an list of one or more uncompressed characters...</span>
<span class="k">multi</span> <span class="nb">encode</span><span class="p">(</span><span class="o">[</span><span class="nv">$next</span><span class="o">,</span> <span class="o">*</span><span class="nv">@uncompressed</span><span class="o">],</span> <span class="o">:</span><span class="nv">%code</span><span class="o">,</span> <span class="o">:</span><span class="nv">$seen</span><span class="p">)</span>  <span class="p">{</span>
    <span class="c1"># If [already-seen plus next char] is a known sequence...</span>
    <span class="nv">%code</span><span class="p">{</span> <span class="nv">$seen</span><span class="o">~</span><span class="nv">$next</span> <span class="p">}:</span><span class="s">exists</span>
         <span class="c1"># Then encode all of that together</span>
        <span class="o">??</span> <span class="nb">encode</span><span class="p">(</span><span class="nv">@uncompressed</span><span class="o">,</span> <span class="o">:</span><span class="nv">%code</span><span class="o">,</span> <span class="s">seen</span> <span class="o">=&gt;</span> <span class="nv">$seen</span><span class="o">~</span><span class="nv">$next</span><span class="p">)</span>

         <span class="c1"># Else emit encoding for the already-seen sequence</span>
        <span class="o">!!</span> <span class="p">(</span> <span class="nv">%code</span><span class="p">{</span><span class="nv">$seen</span><span class="p">}</span><span class="o">,</span>
             <span class="c1"># Plus the encoding for the rest of the string...</span>
             <span class="nb">encode</span><span class="p">(</span> <span class="nv">@uncompressed</span><span class="o">,</span>
                     <span class="c1"># Add encoding for new sequence to table</span>
                     <span class="s">code</span> <span class="o">=&gt;</span> <span class="nv">%</span><span class="p">(</span> <span class="nv">%code</span>, <span class="nv">$seen</span><span class="o">~</span><span class="nv">$next</span> <span class="o">=&gt;</span> <span class="nv">%code</span><span class="o">.</span><span class="nb">elems</span> <span class="p">)</span><span class="o">,</span>
                     <span class="c1"># Continue encoding from next character</span>
                     <span class="s">seen</span> <span class="o">=&gt;</span> <span class="nv">$next</span>
             <span class="p">)</span>
           <span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Convert to codepoints...</span>
<span class="k">my</span> <span class="nv">@codes</span> <span class="o">=</span> <span class="nf">compress</span><span class="p">(&#39;</span><span class="s1">To be or not to be. That be the question, matey!</span><span class="p">&#39;);</span>
<span class="nb">say</span> <span class="nv">@codes</span><span class="p">;</span>
<span class="n">separator</span><span class="p">;</span>

<span class="c1"># Emit as characters...</span>
<span class="nb">say</span> <span class="nv">@codes</span><span class="o">Â».</span><span class="nb">chr</span><span class="p">;</span>
<span class="n">separator</span><span class="p">;</span>

<span class="c1"># Convert to a binary sequence...</span>
<span class="k">my</span> <span class="nv">$bits_per_code</span> <span class="o">=</span> <span class="nv">@codes</span><span class="o">.</span><span class="nb">max</span><span class="o">.</span><span class="nb">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="nb">ceiling</span><span class="p">();</span>
<span class="k">my</span> <span class="nv">$format</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">%0</span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$bits_per_code</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">b</span><span class="p">&#39;;</span>
<span class="k">my</span> <span class="nv">$bits</span> <span class="o">=</span> <span class="nv">@codes</span><span class="o">Â».</span><span class="nb">fmt</span><span class="p">(</span><span class="nv">$format</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$bits</span><span class="p">;</span>
<span class="n">separator</span><span class="p">;</span>

<span class="nb">say</span> <span class="nv">$bits</span><span class="o">.</span><span class="nb">comb</span><span class="p">(/</span><span class="ni">.</span><span class="o">**</span><span class="mi">1</span><span class="o">..</span><span class="mi">7</span><span class="p">/)</span><span class="o">.</span><span class="nb">map</span><span class="p">({:</span><span class="mi">2</span><span class="p">(</span><span class="nv">$^bitpattern</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span><span class="p">})</span><span class="o">.</span><span class="nb">join</span><span class="p">;</span>
<span class="n">separator</span><span class="p">;</span>

<span class="k">sub</span> <span class="nf">separator</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">_</span><span class="p">&#39;</span> <span class="nb">x</span> <span class="mi">50</span> <span class="p">}</span>
</code></pre></div><p>è¾“å‡ºï¼š</p>
<pre><code>84 111 32 98 101 32 111 114 32 110 111 116 32 116 257 259 46 32 84 104 97 267 259 268 104 260 113 117 101 115 116 105 111 110 44 32 109 276 101 121 33
__________________________________________________
T o   b e   o r   n o t   t Ä Äƒ .   T h a Ä‹ Äƒ ÄŒ h Ä„ q u e s t i o n ,   m Ä” e y !
__________________________________________________
001010100001101111000100000001100010001100101000100000001101111001110010000100000001101110001101111001110100000100000001110100100000001100000011000101110000100000001010100001101000001100001100001011100000011100001100001101000100000100001110001001110101001100101001110011001110100001101001001101111001101110000101100000100000001101101100010100001100101001111001000100001
__________________________________________________
x@1QoB\7NAt@0\
C aBp4 CDu'h4Ms8,l(2O
__________________________________________________
[Finished in 0.658s]
</code></pre><ul>
<li>validation_concurrent</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#! /usr/bin/env raku</span>

<span class="k">my</span> <span class="nv">@records</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">{</span> <span class="p">:</span><span class="s">Name</span><span class="p">&lt;</span><span class="s">Damian Conway</span><span class="p">&gt;</span><span class="o">,</span> <span class="p">:</span><span class="s">Age</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">ID</span><span class="p">(&#39;</span><span class="s1">00012345</span><span class="p">&#39;)</span>  <span class="p">}</span><span class="o">,</span>
    <span class="p">{</span> <span class="p">:</span><span class="s">Name</span><span class="p">&lt;</span><span class="s">Leslie Duvall</span><span class="p">&gt;</span><span class="o">,</span> <span class="p">:</span><span class="s">Age</span><span class="p">(</span><span class="mi">29</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">ID</span><span class="p">(&#39;</span><span class="s1">668</span><span class="p">&#39;)</span>       <span class="p">}</span><span class="o">,</span>
    <span class="p">{</span> <span class="p">:</span><span class="s">Name</span><span class="p">&lt;</span><span class="s">Sam Georgious</span><span class="p">&gt;</span><span class="o">,</span> <span class="p">:</span><span class="s">Age</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">ID</span><span class="p">(&#39;</span><span class="s1">00000007</span><span class="p">&#39;)</span>  <span class="p">}</span><span class="o">,</span>
<span class="p">);</span>

<span class="k">sub</span> <span class="nf">normalize_data</span> <span class="p">(</span><span class="nb">Hash</span> <span class="nv">$record</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$record</span><span class="p">&lt;</span><span class="s">Name</span><span class="p">&gt;</span>  <span class="o">.=</span> <span class="nb">subst</span><span class="p">(/&lt;</span><span class="nb">lower</span><span class="p">&gt;/</span><span class="o">,</span><span class="p">{</span><span class="nv">$&lt;lower&gt;</span><span class="o">.</span><span class="nb">uc</span><span class="p">}</span><span class="o">,</span> <span class="p">:</span><span class="s">g</span><span class="p">);</span>
    <span class="nv">$record</span><span class="p">&lt;</span><span class="s">Age</span><span class="p">&gt;</span> <span class="nb">max</span><span class="o">=</span> <span class="mi">18</span><span class="p">;</span>
    <span class="nv">$record</span><span class="p">&lt;</span><span class="s">ID</span><span class="p">&gt;</span>    <span class="o">.=</span> <span class="nb">fmt</span><span class="p">(&#39;</span><span class="s1">%08d</span><span class="p">&#39;);</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nb">report</span> <span class="p">(</span><span class="nv">$outcome</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">\tInvalid record (</span><span class="nv">$outcome</span><span class="s2">)</span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">invalid_name</span> <span class="p">(</span><span class="nv">$rec</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">Bad name: </span><span class="nv">$rec</span><span class="p">&#34;</span> <span class="k">if</span> <span class="nv">$rec</span><span class="p">&lt;</span><span class="s">Name</span><span class="p">&gt;</span> <span class="o">!~~</span> <span class="p">/</span><span class="se">\S</span><span class="p">/;</span>        <span class="p">}</span>
<span class="k">sub</span> <span class="nf">invalid_age</span>  <span class="p">(</span><span class="nv">$rec</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">Bad age:  </span><span class="nv">$rec</span><span class="p">&#34;</span> <span class="k">if</span> <span class="nv">$rec</span><span class="p">&lt;</span><span class="s">Age</span><span class="p">&gt;</span>  <span class="o">&lt;</span> <span class="mi">18</span><span class="p">;</span>            <span class="p">}</span>
<span class="k">sub</span> <span class="nf">invalid_ID</span>   <span class="p">(</span><span class="nv">$rec</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">Bad ID:   </span><span class="nv">$rec</span><span class="p">&#34;</span> <span class="k">if</span> <span class="nv">$rec</span><span class="p">&lt;</span><span class="s">ID</span><span class="p">&gt;</span>   <span class="o">!~~</span> <span class="p">/</span><span class="ni">^</span><span class="se">\d</span><span class="sr"> </span><span class="o">**</span><span class="sr"> </span><span class="mi">8</span><span class="ni">$</span><span class="p">/;</span> <span class="p">}</span>

<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">Validating...</span><span class="p">&#39;;</span>
<span class="k">my</span> <span class="nv">@invalidations</span> <span class="o">=</span> <span class="p">(</span>
    <span class="nv">@records</span><span class="o">Â».</span><span class="nv">&amp;invalid_name</span><span class="o">,</span>
    <span class="nv">@records</span><span class="o">Â».</span><span class="nv">&amp;invalid_age</span><span class="o">,</span>
    <span class="nv">@records</span><span class="o">Â».</span><span class="nv">&amp;invalid_ID</span><span class="o">,</span>
<span class="p">);</span>

<span class="nv">@invalidations</span><span class="o">Â».</span><span class="nv">&amp;report</span><span class="p">;</span>

<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">Normalizing...</span><span class="p">&#39;;</span>
<span class="nv">@records</span><span class="o">Â».</span><span class="nv">&amp;normalize_data</span><span class="p">;</span>

<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">Revalidating...</span><span class="p">&#39;;</span>

<span class="nv">@invalidations</span> <span class="o">=</span> <span class="p">(</span>
    <span class="nv">@records</span><span class="o">Â».</span><span class="nv">&amp;invalid_name</span><span class="o">,</span>
    <span class="nv">@records</span><span class="o">Â».</span><span class="nv">&amp;invalid_age</span><span class="o">,</span>
    <span class="nv">@records</span><span class="o">Â».</span><span class="nv">&amp;invalid_ID</span><span class="o">,</span>
<span class="p">);</span>

<span class="nv">@invalidations</span><span class="o">Â».</span><span class="nv">&amp;report</span><span class="p">;</span>
</code></pre></div><p>è¾“å‡ºï¼š</p>
<pre><code>Validating...
postcircumfix:&lt;{ }&gt; not defined for type Str
</code></pre><ul>
<li>validation_imperative</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#! /usr/bin/env raku</span>

<span class="k">my</span> <span class="nv">@records</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">{</span> <span class="p">:</span><span class="s">Name</span><span class="p">&lt;</span><span class="s">Damian Conway</span><span class="p">&gt;</span><span class="o">,</span> <span class="p">:</span><span class="s">Age</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">ID</span><span class="p">(&#39;</span><span class="s1">00012345</span><span class="p">&#39;)</span>  <span class="p">}</span><span class="o">,</span>
    <span class="p">{</span> <span class="p">:</span><span class="s">Name</span><span class="p">&lt;</span><span class="s">Leslie Duvall</span><span class="p">&gt;</span><span class="o">,</span> <span class="p">:</span><span class="s">Age</span><span class="p">(</span><span class="mi">29</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">ID</span><span class="p">(&#39;</span><span class="s1">668</span><span class="p">&#39;)</span>       <span class="p">}</span><span class="o">,</span>
    <span class="p">{</span> <span class="p">:</span><span class="s">Name</span><span class="p">&lt;</span><span class="s">Sam Georgious</span><span class="p">&gt;</span><span class="o">,</span> <span class="p">:</span><span class="s">Age</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">ID</span><span class="p">(&#39;</span><span class="s1">00000007</span><span class="p">&#39;)</span>  <span class="p">}</span><span class="o">,</span>
<span class="p">);</span>

<span class="k">sub</span> <span class="nf">normalize_data</span> <span class="p">(</span><span class="nb">Hash</span> <span class="nv">$record</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$record</span><span class="p">&lt;</span><span class="s">Name</span><span class="p">&gt;</span>  <span class="o">.=</span> <span class="nb">subst</span><span class="p">(/&lt;</span><span class="nb">lower</span><span class="p">&gt;/</span><span class="o">,</span><span class="p">{</span><span class="nv">$&lt;lower&gt;</span><span class="o">.</span><span class="nb">uc</span><span class="p">}</span><span class="o">,</span> <span class="p">:</span><span class="s">g</span><span class="p">);</span>
    <span class="nv">$record</span><span class="p">&lt;</span><span class="s">Age</span><span class="p">&gt;</span> <span class="nb">max</span><span class="o">=</span> <span class="mi">18</span><span class="p">;</span>
    <span class="nv">$record</span><span class="p">&lt;</span><span class="s">ID</span><span class="p">&gt;</span>    <span class="o">.=</span> <span class="nb">fmt</span><span class="p">(&#39;</span><span class="s1">%08d</span><span class="p">&#39;);</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nb">report</span> <span class="p">(</span><span class="nv">$outcome</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">\tInvalid record (</span><span class="nv">$outcome</span><span class="s2">)</span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">invalid_name</span> <span class="p">(</span><span class="nv">$rec</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">Bad name: </span><span class="nv">$rec</span><span class="p">&#34;</span> <span class="k">if</span> <span class="nv">$rec</span><span class="p">&lt;</span><span class="s">Name</span><span class="p">&gt;</span> <span class="o">!~~</span> <span class="p">/</span><span class="se">\S</span><span class="p">/;</span>        <span class="p">}</span>
<span class="k">sub</span> <span class="nf">invalid_age</span>  <span class="p">(</span><span class="nv">$rec</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">Bad age:  </span><span class="nv">$rec</span><span class="p">&#34;</span> <span class="k">if</span> <span class="nv">$rec</span><span class="p">&lt;</span><span class="s">Age</span><span class="p">&gt;</span>  <span class="o">&lt;</span> <span class="mi">18</span><span class="p">;</span>            <span class="p">}</span>
<span class="k">sub</span> <span class="nf">invalid_ID</span>   <span class="p">(</span><span class="nv">$rec</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">Bad ID:   </span><span class="nv">$rec</span><span class="p">&#34;</span> <span class="k">if</span> <span class="nv">$rec</span><span class="p">&lt;</span><span class="s">ID</span><span class="p">&gt;</span>   <span class="o">!~~</span> <span class="p">/</span><span class="ni">^</span><span class="se">\d</span><span class="sr"> </span><span class="o">**</span><span class="sr"> </span><span class="mi">8</span><span class="ni">$</span><span class="p">/;</span> <span class="p">}</span>

<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">Validating...</span><span class="p">&#39;;</span>
<span class="k">my</span> <span class="nv">@invalidations</span> <span class="o">=</span> <span class="k">gather</span> <span class="k">for</span> <span class="nv">@records</span> <span class="k">-&gt;</span> <span class="nv">$record</span> <span class="p">{</span>
    <span class="nb">take</span> <span class="nf">invalid_name</span><span class="p">(</span><span class="nv">$record</span><span class="p">);</span>
    <span class="nb">take</span> <span class="nf">invalid_age</span><span class="p">(</span><span class="nv">$record</span><span class="p">);</span>
    <span class="nb">take</span> <span class="nf">invalid_ID</span><span class="p">(</span><span class="nv">$record</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">for</span> <span class="nv">@invalidations</span> <span class="k">-&gt;</span> <span class="nv">$errmsg</span> <span class="p">{</span>
    <span class="nb">report</span><span class="p">(</span> <span class="nv">$errmsg</span> <span class="p">);</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">Normalizing...</span><span class="p">&#39;;</span>
<span class="k">for</span> <span class="nv">@records</span> <span class="k">-&gt;</span> <span class="nv">$record</span> <span class="p">{</span>
    <span class="nf">normalize_data</span><span class="p">(</span><span class="nv">$record</span><span class="p">);</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">Revalidating...</span><span class="p">&#39;;</span>

<span class="nv">@invalidations</span> <span class="o">=</span> <span class="k">gather</span> <span class="k">for</span> <span class="nv">@records</span> <span class="k">-&gt;</span> <span class="nv">$record</span> <span class="p">{</span>
    <span class="nb">take</span> <span class="nf">invalid_name</span><span class="p">(</span><span class="nv">$record</span><span class="p">);</span>
    <span class="nb">take</span> <span class="nf">invalid_age</span><span class="p">(</span><span class="nv">$record</span><span class="p">);</span>
    <span class="nb">take</span> <span class="nf">invalid_ID</span><span class="p">(</span><span class="nv">$record</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">for</span> <span class="nv">@invalidations</span> <span class="k">-&gt;</span> <span class="nv">$errmsg</span> <span class="p">{</span>
    <span class="nb">report</span><span class="p">(</span> <span class="nv">$errmsg</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>è¾“å‡ºï¼š</p>
<pre><code>Validating...
	Invalid record (Bad ID:   Name	Leslie Duvall Age	29 ID	668)
	Invalid record (Bad age:  Name	Sam Georgious Age	-2 ID	00000007)
Normalizing...
Revalidating...
</code></pre><ul>
<li>validation_junctions</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#! /usr/bin/env raku</span>

<span class="k">my</span> <span class="nv">@records</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">{</span> <span class="p">:</span><span class="s">Name</span><span class="p">&lt;</span><span class="s">Damian Conway</span><span class="p">&gt;</span><span class="o">,</span> <span class="p">:</span><span class="s">Age</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">ID</span><span class="p">(&#39;</span><span class="s1">00012345</span><span class="p">&#39;)</span>  <span class="p">}</span><span class="o">,</span>
    <span class="p">{</span> <span class="p">:</span><span class="s">Name</span><span class="p">&lt;</span><span class="s">Leslie Duvall</span><span class="p">&gt;</span><span class="o">,</span> <span class="p">:</span><span class="s">Age</span><span class="p">(</span><span class="mi">29</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">ID</span><span class="p">(&#39;</span><span class="s1">668</span><span class="p">&#39;)</span>       <span class="p">}</span><span class="o">,</span>
    <span class="p">{</span> <span class="p">:</span><span class="s">Name</span><span class="p">&lt;</span><span class="s">Sam Georgious</span><span class="p">&gt;</span><span class="o">,</span> <span class="p">:</span><span class="s">Age</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">ID</span><span class="p">(&#39;</span><span class="s1">00000007</span><span class="p">&#39;)</span>  <span class="p">}</span><span class="o">,</span>
<span class="p">);</span>

<span class="k">sub</span> <span class="nf">normalize_data</span> <span class="p">(</span><span class="nb">Hash</span> <span class="nv">$record</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$record</span><span class="p">&lt;</span><span class="s">Name</span><span class="p">&gt;</span>  <span class="o">.=</span> <span class="nb">subst</span><span class="p">(/&lt;</span><span class="nb">lower</span><span class="p">&gt;/</span><span class="o">,</span><span class="p">{</span><span class="nv">$&lt;lower&gt;</span><span class="o">.</span><span class="nb">uc</span><span class="p">}</span><span class="o">,</span> <span class="p">:</span><span class="s">g</span><span class="p">);</span>
    <span class="nv">$record</span><span class="p">&lt;</span><span class="s">Age</span><span class="p">&gt;</span> <span class="nb">max</span><span class="o">=</span> <span class="mi">18</span><span class="p">;</span>
    <span class="nv">$record</span><span class="p">&lt;</span><span class="s">ID</span><span class="p">&gt;</span>    <span class="o">.=</span> <span class="nb">fmt</span><span class="p">(&#39;</span><span class="s1">%08d</span><span class="p">&#39;);</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nb">report</span> <span class="p">(</span><span class="nv">$outcome</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">\tInvalid record (</span><span class="nv">$outcome</span><span class="s2">)</span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">invalid_name</span> <span class="p">(</span><span class="nv">$rec</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">Bad name: </span><span class="nv">$rec</span><span class="p">&#34;</span> <span class="k">if</span> <span class="nv">$rec</span><span class="p">&lt;</span><span class="s">Name</span><span class="p">&gt;</span> <span class="o">!~~</span> <span class="p">/</span><span class="se">\S</span><span class="p">/;</span>        <span class="p">}</span>
<span class="k">sub</span> <span class="nf">invalid_age</span>  <span class="p">(</span><span class="nv">$rec</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">Bad age:  </span><span class="nv">$rec</span><span class="p">&#34;</span> <span class="k">if</span> <span class="nv">$rec</span><span class="p">&lt;</span><span class="s">Age</span><span class="p">&gt;</span>  <span class="o">&lt;</span> <span class="mi">18</span><span class="p">;</span>            <span class="p">}</span>
<span class="k">sub</span> <span class="nf">invalid_ID</span>   <span class="p">(</span><span class="nv">$rec</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">Bad ID:   </span><span class="nv">$rec</span><span class="p">&#34;</span> <span class="k">if</span> <span class="nv">$rec</span><span class="p">&lt;</span><span class="s">ID</span><span class="p">&gt;</span>   <span class="o">!~~</span> <span class="p">/</span><span class="ni">^</span><span class="se">\d</span><span class="sr"> </span><span class="o">**</span><span class="sr"> </span><span class="mi">8</span><span class="ni">$</span><span class="p">/;</span> <span class="p">}</span>

<span class="k">my</span> <span class="nv">$invalid_record</span> <span class="o">=</span> <span class="nv">&amp;invalid_name</span> <span class="o">|</span> <span class="nv">&amp;invalid_age</span> <span class="o">|</span> <span class="nv">&amp;invalid_ID</span><span class="p">;</span>

<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">Validating...</span><span class="p">&#39;;</span>
<span class="nb">report</span><span class="p">(</span> <span class="nv">$invalid_record</span><span class="p">(</span><span class="nb">all</span> <span class="nv">@records</span><span class="p">)</span> <span class="p">);</span>

<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">Normalizing...</span><span class="p">&#39;;</span>
<span class="nf">normalize_data</span><span class="p">(</span><span class="nb">all</span> <span class="nv">@records</span><span class="p">);</span>

<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">Revalidating...</span><span class="p">&#39;;</span>
<span class="nb">report</span><span class="p">(</span> <span class="nv">$invalid_record</span><span class="p">(</span><span class="nb">all</span> <span class="nv">@records</span><span class="p">)</span> <span class="p">);</span>
</code></pre></div><p>è¾“å‡ºï¼š</p>
<pre><code>Validating...
	Invalid record (Bad ID:   Name	Leslie Duvall Age	29 ID	668)
	Invalid record (Bad age:  Name	Sam Georgious Age	-2 ID	00000007)
Normalizing...
Revalidating...
</code></pre><ul>
<li>prime_demo</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#! /usr/bin/env raku</span>

<span class="k">sub</span> <span class="nf">is_prime</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$n</span> <span class="nv">%</span> <span class="nb">all</span><span class="p">(</span><span class="mi">2</span><span class="o">..</span><span class="nv">$n</span><span class="o">.</span><span class="nb">sqrt</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="mi">1001</span> <span class="k">-&gt;</span> <span class="nv">$n</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$n</span><span class="s2"> is prime</span><span class="p">&#34;</span> <span class="k">if</span> <span class="nf">is_prime</span><span class="p">(</span><span class="nv">$n</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>è¾“å‡ºï¼š</p>
<pre><code>1 is prime
3 is prime
5 is prime
7 is prime
11 is prime
...
991 is prime
997 is prime
</code></pre><ul>
<li>ç»Ÿè®¡</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#! /usr/bin/env raku</span>

<span class="k">my</span> <span class="nv">@values</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">12</span><span class="o">,</span> <span class="mi">12</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">99</span><span class="p">);</span>

<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">mean (a) = </span><span class="p">&#39;</span><span class="o">,</span> <span class="nf">mean_a</span><span class="p">(</span><span class="nv">@values</span><span class="p">);</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">mean (g) = </span><span class="p">&#39;</span><span class="o">,</span> <span class="nf">mean_g</span><span class="p">(</span><span class="nv">@values</span><span class="p">);</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">    mode = </span><span class="p">&#39;</span><span class="o">,</span>   <span class="nb">mode</span><span class="p">(</span><span class="nv">@values</span><span class="p">);</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">  median = </span><span class="p">&#39;</span><span class="o">,</span> <span class="nf">median</span><span class="p">(</span><span class="nv">@values</span><span class="p">);</span>

<span class="k">sub</span> <span class="nf">mean_a</span> <span class="p">(</span><span class="o">*</span><span class="nv">@list</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">(</span><span class="o">[+]</span> <span class="nv">@list</span><span class="p">)</span> <span class="o">/</span> <span class="nv">@list</span><span class="o">.</span><span class="nb">elems</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">mean_g</span> <span class="p">(</span><span class="o">*</span><span class="nv">@list</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">(</span><span class="o">[*]</span> <span class="nv">@list</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="nv">@list</span><span class="o">.</span><span class="nb">elems</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nb">mode</span> <span class="p">(</span><span class="o">*</span><span class="nv">@list</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">given</span> <span class="nv">@list</span><span class="o">.</span><span class="nb">Bag</span> <span class="p">{</span>
        <span class="o">.</span><span class="nb">pairs</span><span class="o">.</span><span class="nb">grep</span><span class="p">({</span><span class="nv">$^elem</span><span class="o">.</span><span class="nb">value</span> <span class="o">==</span> <span class="o">.</span><span class="nb">values</span><span class="o">.</span><span class="nb">max</span><span class="p">})</span><span class="o">Â».</span><span class="nb">key</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">median</span> <span class="p">(</span><span class="o">*</span><span class="nv">@list</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">given</span> <span class="nv">@list</span><span class="o">.</span><span class="nb">sort</span> <span class="p">{</span>
        <span class="o">.</span><span class="nb">elems</span> <span class="nv">%%</span> <span class="mi">2</span>
            <span class="o">??</span> <span class="nf">mean_a</span><span class="p">(</span> <span class="o">.[*/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="o">*/</span><span class="mi">2</span><span class="o">]</span> <span class="p">)</span>
            <span class="o">!!</span>         <span class="o">.[*/</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>è¾“å‡ºï¼š</p>
<pre><code>mean (a) = 10.444444
mean (g) = 4.95872541158849
    mode = 7 4
  median = 5
</code></pre><ul>
<li>stats_hybird</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#! /usr/bin/env raku</span>

<span class="k">my</span> <span class="nv">@values</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">12</span><span class="o">,</span> <span class="mi">12</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">99</span><span class="p">);</span>

<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">mean (a) = </span><span class="p">&#39;</span><span class="o">,</span> <span class="nf">mean_a</span><span class="p">(</span><span class="nv">@values</span><span class="p">);</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">mean (g) = </span><span class="p">&#39;</span><span class="o">,</span> <span class="nf">mean_g</span><span class="p">(</span><span class="nv">@values</span><span class="p">);</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">    mode = </span><span class="p">&#39;</span><span class="o">,</span>   <span class="nb">mode</span><span class="p">(</span><span class="nv">@values</span><span class="p">);</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">  median = </span><span class="p">&#39;</span><span class="o">,</span> <span class="nf">median</span><span class="p">(</span><span class="nv">@values</span><span class="p">);</span>

<span class="k">sub</span> <span class="nf">mean_a</span> <span class="p">(</span><span class="o">*</span><span class="nv">@list</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$sum</span> <span class="o">=</span> <span class="o">[+]</span> <span class="nv">@list</span><span class="p">;</span>
    <span class="k">return</span> <span class="nv">$sum</span> <span class="o">/</span> <span class="nv">@list</span><span class="o">.</span><span class="nb">elems</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">mean_g</span> <span class="p">(</span><span class="o">*</span><span class="nv">@list</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$product</span> <span class="o">=</span> <span class="o">[*]</span> <span class="nv">@list</span><span class="p">;</span>
    <span class="k">return</span> <span class="nv">$product</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="nv">@list</span><span class="o">.</span><span class="nb">elems</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nb">mode</span> <span class="p">(</span><span class="o">*</span><span class="nv">@list</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$frequencies</span> <span class="o">=</span> <span class="nv">@list</span><span class="o">.</span><span class="nb">Bag</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$list_elems</span>  <span class="o">=</span> <span class="nv">$frequencies</span><span class="o">.</span><span class="nb">pairs</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$max_freq</span>    <span class="o">=</span> <span class="nv">$frequencies</span><span class="o">.</span><span class="nb">values</span><span class="o">.</span><span class="nb">max</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">@max_vals</span>    <span class="o">=</span> <span class="nv">$list_elems</span><span class="o">.</span><span class="nb">grep</span><span class="p">({</span><span class="o">.</span><span class="nb">value</span> <span class="o">==</span> <span class="nv">$max_freq</span><span class="p">});</span>

    <span class="k">return</span> <span class="nv">@max_vals</span><span class="o">Â».</span><span class="nb">key</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">median</span> <span class="p">(</span><span class="o">*</span><span class="nv">@list</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">@sorted</span> <span class="o">=</span> <span class="nv">@list</span><span class="o">.</span><span class="nb">sort</span><span class="p">;</span>
    <span class="k">return</span> <span class="nv">@sorted</span><span class="o">.</span><span class="nb">elems</span> <span class="nv">%%</span> <span class="mi">2</span> <span class="o">??</span> <span class="nf">mean_a</span><span class="p">(</span><span class="nv">@sorted</span><span class="o">.[*/</span><span class="mi">2</span><span class="o">,</span> <span class="o">*/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span>
                              <span class="o">!!</span>        <span class="nv">@sorted</span><span class="o">.[*/</span><span class="mi">2</span><span class="o">]</span>
<span class="p">}</span>
</code></pre></div><p>è¾“å‡ºï¼š</p>
<pre><code>mean (a) = 10.444444
mean (g) = 4.95872541158849
    mode = 7 4
  median = 5
</code></pre><ul>
<li>stats_imperative</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#! /usr/bin/env raku</span>

<span class="k">my</span> <span class="nv">@values</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">12</span><span class="o">,</span> <span class="mi">12</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">99</span><span class="p">);</span>

<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">mean (a) = </span><span class="p">&#39;</span><span class="o">,</span> <span class="nf">mean_a</span><span class="p">(</span><span class="nv">@values</span><span class="p">);</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">mean (g) = </span><span class="p">&#39;</span><span class="o">,</span> <span class="nf">mean_g</span><span class="p">(</span><span class="nv">@values</span><span class="p">);</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">    mode = </span><span class="p">&#39;</span><span class="o">,</span>   <span class="nb">mode</span><span class="p">(</span><span class="nv">@values</span><span class="p">);</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">  median = </span><span class="p">&#39;</span><span class="o">,</span> <span class="nf">median</span><span class="p">(</span><span class="nv">@values</span><span class="p">);</span>

<span class="k">sub</span> <span class="nf">mean_a</span> <span class="p">(</span><span class="o">*</span><span class="nv">@list</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$sum</span><span class="p">;</span>
    <span class="k">for</span> <span class="nv">@list</span> <span class="k">-&gt;</span> <span class="nv">$elem</span> <span class="p">{</span>
        <span class="nv">$sum</span> <span class="o">+=</span> <span class="nv">$elem</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$sum</span> <span class="o">/</span> <span class="nv">@list</span><span class="o">.</span><span class="nb">elems</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">mean_g</span> <span class="p">(</span><span class="o">*</span><span class="nv">@list</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$product</span><span class="p">;</span>
    <span class="k">for</span> <span class="nv">@list</span> <span class="k">-&gt;</span> <span class="nv">$elem</span> <span class="p">{</span>
        <span class="nv">$product</span> <span class="o">*=</span> <span class="nv">$elem</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$product</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="nv">@list</span><span class="o">.</span><span class="nb">elems</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nb">mode</span> <span class="p">(</span><span class="o">*</span><span class="nv">@list</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">%counts</span><span class="p">;</span>
    <span class="nv">%counts</span><span class="p">{</span><span class="nv">$_</span><span class="p">}</span><span class="o">++</span> <span class="k">for</span> <span class="nv">@list</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$max</span> <span class="o">=</span> <span class="nv">%counts</span><span class="o">.</span><span class="nb">values</span><span class="o">.</span><span class="nb">max</span><span class="p">;</span>
    <span class="k">return</span> <span class="nv">%counts</span><span class="o">.</span><span class="nb">grep</span><span class="p">({</span> <span class="o">.</span><span class="nb">value</span> <span class="o">==</span> <span class="nv">$max</span> <span class="p">})</span><span class="o">Â».</span><span class="nb">key</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">median</span> <span class="p">(</span><span class="o">*</span><span class="nv">@list</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">@list</span><span class="o">.=</span><span class="nb">sort</span><span class="p">();</span>

    <span class="k">return</span> <span class="nv">@list</span><span class="o">.</span><span class="nb">elems</span> <span class="nv">%%</span> <span class="mi">2</span>
            <span class="o">??</span> <span class="nf">mean_a</span><span class="p">(</span> <span class="nv">@list</span><span class="o">[*/</span><span class="mi">2</span><span class="o">,</span> <span class="o">*/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span> <span class="p">)</span>
            <span class="o">!!</span>         <span class="nv">@list</span><span class="o">[*/</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>è¾“å‡ºï¼š</p>
<pre><code>mean (a) = 10.444444
mean (g) = 4.95872541158849
    mode = 4 7
  median = 5
</code></pre><ul>
<li>stats_mode_func</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#! /usr/bin/env raku</span>

<span class="k">my</span> <span class="nv">@values</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">12</span><span class="o">,</span> <span class="mi">12</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">99</span><span class="p">);</span>

<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">mean (a) = </span><span class="p">&#39;</span><span class="o">,</span> <span class="nf">mean_a</span><span class="p">(</span><span class="nv">@values</span><span class="p">);</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">mean (g) = </span><span class="p">&#39;</span><span class="o">,</span> <span class="nf">mean_g</span><span class="p">(</span><span class="nv">@values</span><span class="p">);</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">    mode = </span><span class="p">&#39;</span><span class="o">,</span>   <span class="nb">mode</span><span class="p">(</span><span class="nv">@values</span><span class="p">);</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">  median = </span><span class="p">&#39;</span><span class="o">,</span> <span class="nf">median</span><span class="p">(</span><span class="nv">@values</span><span class="p">);</span>

<span class="k">sub</span> <span class="nf">mean_a</span> <span class="p">(</span><span class="o">*</span><span class="nv">@list</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">sub</span> <span class="nb">sum</span> <span class="p">{</span> <span class="o">[+]</span> <span class="nv">@list</span> <span class="p">}</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nv">@list</span><span class="o">.</span><span class="nb">elems</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">mean_g</span> <span class="p">(</span><span class="o">*</span><span class="nv">@list</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">sub</span> <span class="nf">product</span> <span class="p">{</span> <span class="o">[*]</span> <span class="nv">@list</span> <span class="p">}</span>
    <span class="k">return</span> <span class="nf">product</span><span class="p">()</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="nv">@list</span><span class="o">.</span><span class="nb">elems</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nb">mode</span> <span class="p">(</span><span class="o">*</span><span class="nv">@list</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">sub</span> <span class="nf">frequencies</span> <span class="p">{</span> <span class="nv">@list</span><span class="o">.</span><span class="nb">Bag</span>                             <span class="p">}</span>
    <span class="k">sub</span> <span class="nf">list_elems</span>  <span class="p">{</span> <span class="n">frequencies</span><span class="o">.</span><span class="nb">pairs</span>                     <span class="p">}</span>
    <span class="k">sub</span> <span class="nf">max_freq</span>    <span class="p">{</span> <span class="n">frequencies</span><span class="o">.</span><span class="nb">values</span><span class="o">.</span><span class="nb">max</span>                <span class="p">}</span>
    <span class="k">sub</span> <span class="nf">max_vals</span>    <span class="p">{</span> <span class="n">list_elems</span><span class="o">.</span><span class="nb">grep</span><span class="o">:</span> <span class="p">{</span><span class="o">.</span><span class="nb">value</span> <span class="o">==</span> <span class="n">max_freq</span><span class="p">}</span> <span class="p">}</span>

    <span class="k">return</span> <span class="n">max_vals</span><span class="o">Â».</span><span class="nb">keys</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">median</span> <span class="p">(</span><span class="o">*</span><span class="nv">@list</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">sub</span> <span class="nf">sorted</span> <span class="p">{</span> <span class="nv">@list</span><span class="o">.</span><span class="nb">sort</span> <span class="p">}</span>
    <span class="k">return</span> <span class="n">sorted</span><span class="o">.</span><span class="nb">elems</span> <span class="nv">%%</span> <span class="mi">2</span>
                <span class="o">??</span> <span class="nf">mean_a</span><span class="p">(</span><span class="n">sorted</span><span class="o">.[*/</span><span class="mi">2</span><span class="o">,</span> <span class="o">*/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span>
                <span class="o">!!</span>        <span class="n">sorted</span><span class="o">.[*/</span><span class="mi">2</span><span class="o">]</span>
<span class="p">}</span>
</code></pre></div><p>è¾“å‡ºï¼š</p>
<pre><code>mean (a) = 10.444444
mean (g) = 4.95872541158849
    mode = 7 4
  median = 5
</code></pre><ul>
<li>stats_OO</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#! /usr/bin/env raku</span>

<span class="k">class</span> <span class="nc">StatList</span> <span class="k">is</span> <span class="nb">List</span> <span class="p">{</span>

    <span class="k">method</span> <span class="nf">mean_a</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">sub</span> <span class="nb">sum</span> <span class="p">{</span> <span class="o">[+]</span> <span class="nb">self</span> <span class="p">}</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">self</span><span class="o">.</span><span class="nb">elems</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">mean_g</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">sub</span> <span class="nf">product</span> <span class="p">{</span> <span class="o">[*]</span> <span class="nb">self</span> <span class="p">}</span>
        <span class="k">return</span> <span class="nf">product</span><span class="p">()</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="nb">self</span><span class="o">.</span><span class="nb">elems</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">median</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">sub</span> <span class="nf">sorted</span> <span class="p">{</span> <span class="nb">self</span><span class="o">.</span><span class="nb">sort</span> <span class="p">}</span>
        <span class="k">return</span> <span class="n">sorted</span><span class="o">.</span><span class="nb">elems</span> <span class="nv">%%</span> <span class="mi">2</span>
                    <span class="o">??</span> <span class="n">StatList</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="n">sorted</span><span class="o">.[*/</span><span class="mi">2</span><span class="o">,</span> <span class="o">*/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="nf">mean_a</span><span class="p">()</span>
                    <span class="o">!!</span>              <span class="n">sorted</span><span class="o">.[*/</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nb">mode</span> <span class="p">()</span> <span class="p">{</span>
        <span class="k">sub</span> <span class="nf">frequencies</span> <span class="p">{</span> <span class="nb">self</span><span class="o">.</span><span class="nb">Bag</span>                              <span class="p">}</span>
        <span class="k">sub</span> <span class="nf">list_elems</span>  <span class="p">{</span> <span class="n">frequencies</span><span class="o">.</span><span class="nb">pairs</span>                     <span class="p">}</span>
        <span class="k">sub</span> <span class="nf">max_freq</span>    <span class="p">{</span> <span class="n">frequencies</span><span class="o">.</span><span class="nb">values</span><span class="o">.</span><span class="nb">max</span>                <span class="p">}</span>
        <span class="k">sub</span> <span class="nf">max_vals</span>    <span class="p">{</span> <span class="n">list_elems</span><span class="o">.</span><span class="nb">grep</span><span class="o">:</span> <span class="p">{</span><span class="o">.</span><span class="nb">value</span> <span class="o">==</span> <span class="n">max_freq</span><span class="p">}</span> <span class="p">}</span>

        <span class="k">return</span>  <span class="n">max_vals</span><span class="o">Â».</span><span class="nb">keys</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$list</span> <span class="o">=</span> <span class="n">StatList</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="mi">11</span><span class="p">);</span>

<span class="nb">say</span> <span class="nv">$list</span><span class="o">.</span><span class="nf">mean_a</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$list</span><span class="o">.</span><span class="nf">mean_g</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$list</span><span class="o">.</span><span class="nf">median</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$list</span><span class="o">.</span><span class="nb">mode</span><span class="p">;</span>
</code></pre></div><p>è¾“å‡ºï¼š</p>
<pre><code>6
4.68393277169202
13
8
</code></pre><blockquote>
<p>ä»¥ä¸Šæ‰€æœ‰æ–‡ä»¶éƒ½å¯ä»¥åœ¨<a href="http://www.bit.do/P6TP">è¿™å„¿</a> ä¸‹è½½åˆ° - a Raku introductory tutorial by Damian Conway</p>
</blockquote>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/example" term="example" label="example" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[token å’Œ rule çš„åŒºåˆ«]]></title>
            <link href="https://ohmyweekly.github.io/notes/2016-03-11-difference-between-rules-and-tokens/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2016-03-11-difference-between-rules-and-tokens/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-12T00:00:00+08:00</published>
            <updated>2021-07-12T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Difference Between Rules and Tokens</blockquote><p>åœ¨ grammar ä¸­, æœ‰ä¸¤ä¸ª <strong>regex</strong> çš„å˜ä½“, <strong>rule</strong> å’Œ <strong>token</strong>ã€‚<strong>rule</strong> é»˜è®¤ä¸ä¼šå›æº¯ã€‚<strong>rule</strong> ä¸ <strong>token</strong> çš„ä¸€ä¸ªé‡è¦åŒºåˆ«å°±æ˜¯, <code>rule</code> è¿™æ ·çš„æ­£åˆ™é‡‡å–äº† <code>:sigspace</code> ä¿®é¥°ç¬¦ã€‚ <code>rule</code> å®é™…ä¸Šæ˜¯</p>
<pre><code>regex :ratchet :sigspace { ... }
</code></pre><p>çš„ç®€å†™ã€‚ratchet è¿™ä¸ªå•è¯çš„æ„æ€æ˜¯: (é˜²å€’è½¬çš„)æ£˜é½¿, æ„æ€å®ƒæ˜¯ä¸èƒ½å›æº¯çš„! è€Œ <code>:sigspace</code> è¡¨æ˜æ­£åˆ™ä¸­çš„ç©ºç™½æ˜¯æœ‰æ„ä¹‰çš„, è€Œ <strong>token</strong> å®é™…ä¸Šæ˜¯</p>
<pre><code>regex :ratchet { ... }
</code></pre><p>çš„ç®€å†™ã€‚æ‰€ä»¥åœ¨ <strong>token</strong> ä¸­, è‹¥ä¸æ˜¯æ˜¾å¼åœ°å†™ä¸Š <code>\s</code>ã€<code>\h</code>ã€<code>\n</code> ç­‰ç©ºç™½ç¬¦å·, å…¶å®ƒæƒ…å†µä¸‹å°±å¥½åƒç©ºç™½éšèº«äº†ä¸€æ ·, è™½ç„¶ä½ å†™äº†, ä½†æ˜¯ç¼–è¯‘å™¨å´è§†è€Œä¸è§ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">grammar</span> <span class="nc">Token::Rule::Difference</span> <span class="p">{</span>
    <span class="c1"># ä¸‹é¢ä¸‰è€…ç­‰ä»·</span>
    <span class="c1"># rule TOP { [\w+]+ % &#39; &#39; | [\d+]+ % &#39; &#39;   }  ç­‰ä»·äº</span>
    <span class="c1"># rule TOP { | [\w+]+ % &#39; &#39; | [\d+]+ % &#39; &#39; }  ç­‰ä»·äº</span>
    <span class="k">rule</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">[</span><span class="se">\w</span><span class="o">+</span><span class="p">]</span><span class="o">+</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1"> </span><span class="p">&#39;</span><span class="sr">
</span><span class="sr">               </span><span class="o">|</span><span class="sr"> </span><span class="p">[</span><span class="se">\d</span><span class="o">+</span><span class="p">]</span><span class="o">+</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1"> </span><span class="p">&#39;</span><span class="sr">
</span><span class="sr">             </span><span class="p">}</span>
<span class="p">}</span>

<span class="c1"># $=finish.lines ä¸­çš„æ¯ä¸€è¡Œæœ«å°¾éƒ½æ²¡æœ‰æ¢è¡Œç¬¦</span>
<span class="k">for</span> <span class="nv">$=finish</span><span class="o">.</span><span class="nb">lines</span> <span class="k">-&gt;</span> <span class="nv">$line</span> <span class="p">{</span>
    <span class="nb">print</span><span class="p">(</span><span class="nv">$line</span><span class="p">);</span>
    <span class="nb">say</span> <span class="n">Token::Rule::Difference</span><span class="o">.</span><span class="nb">parse</span><span class="p">(</span><span class="nv">$line</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">=finish</span><span class="sd">
</span><span class="sd">token takes whitespace invisible unless with sigspace
</span><span class="sd">rule is a token without sigspace
</span><span class="sd">2015 12 25
</span><span class="sd">2016 01 07
</span></code></pre></div><p>è¯´æ˜åœ¨ <strong>rule</strong> ä¸­, <code>|</code> å·¦å³ä¸¤è¾¹çš„ç©ºæ ¼ä¼šè¢«å¿½ç•¥, è¿™é€šå¸¸æ˜¯ä¸ºäº†ä½¿æ ¼å¼å¯¹é½, çœ‹èµ·æ¥ä¸ä¹±ã€‚å¦å¤– <strong>rule</strong> ä¸­, å¼€å¤´å’Œæœ«å°¾çš„ç©ºç™½ä¹Ÿä¼šè¢«å¿½ç•¥ã€‚</p>
<p>å¦‚æœæ¯ä¸€è¡Œéƒ½å¸¦æœ‰æ¢è¡Œç¬¦å‘¢ï¼Ÿ</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">use</span> <span class="nn">Grammar::Debugger</span><span class="p">;</span>
<span class="k">grammar</span> <span class="nc">Token::Rule::Difference</span> <span class="p">{</span>

    <span class="c1"># token TOP { ^ [&lt;line&gt;\n]+ $ }</span>
    <span class="c1"># token line {</span>
    <span class="c1">#     | [\w+]+ % &#39; &#39;</span>
    <span class="c1">#     | [\d+]+ % &#39; &#39;</span>
    <span class="c1"># }</span>

    <span class="c1"># ç­‰ä»·äº</span>

    <span class="k">rule</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr"> </span><span class="ni">^</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">wrap</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="ni">$</span><span class="p">}</span>
    <span class="k">token</span> <span class="nf">wrap</span> <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">line</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">}</span>
    <span class="k">rule</span> <span class="nf">line</span> <span class="p">{</span><span class="sr">
</span><span class="sr">         </span><span class="p">[</span><span class="se">\w</span><span class="o">+</span><span class="p">]</span><span class="o">+</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1"> </span><span class="p">&#39;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">[</span><span class="se">\d</span><span class="o">+</span><span class="p">]</span><span class="o">+</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> </span><span class="p">&lt;[</span><span class="sr">-</span><span class="se">\s</span><span class="sr">:</span><span class="p">]&gt;</span><span class="sr">
</span><span class="sr">    }
</span><span class="sr">}
</span><span class="sr">
</span><span class="sr">my </span><span class="nv">$str</span><span class="sr"> </span><span class="o">=</span><span class="sr"> q</span><span class="p">:</span><span class="na">to</span><span class="p">/</span><span class="nb">EOF</span><span class="o">/</span><span class="p">;</span>
<span class="k">token</span> <span class="nf">takes</span> whitespace invisible unless with sigspace
rule is a token without sigspace
2015-12-25 12:23
2016-01-07 13:45
EOF

my $parse = Token::Rule::Difference.parse<span class="p">(</span><span class="nv">$str</span><span class="p">)</span>;
say $parse;
</code></pre></div><h2 id="token-vs-rule">token vs. rule</h2>
<blockquote>
<p>When we use rule in place of token, any whitespace after anatom is turned into a non-capturing call to ws</p>
</blockquote>
<p>è¿™å¥è¯æ˜¯è¯´, åœ¨ <strong>rule</strong> ä¸­, ä»»ä½•è·Ÿåœ¨åŸå­(atom)åé¢çš„ç©ºç™½ä¼šå˜æˆéæ•è·çš„ <code>ws</code> è°ƒç”¨, å³ <code>&lt;.ws&gt;</code>,</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">rule</span> <span class="nf">entry</span> <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">key</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">value</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">}</span>
</code></pre></div><p>ç­‰ä»·äº:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">token</span> <span class="nf">entry</span> <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">key</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">.</span><span class="ow">ws</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">.</span><span class="ow">ws</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">value</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">.</span><span class="ow">ws</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">}</span> <span class="c1"># . æŠ‘åˆ¶äº†æ•è·</span>
</code></pre></div><p>åœ¨ grammar ä¸­, æˆ‘ä»¬ç»§æ‰¿äº†é»˜è®¤çš„ <code>ws</code>, ä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥æä¾›è‡ªå·±çš„ <strong>ws</strong>:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">token</span> <span class="nf">ws</span> <span class="p">{</span><span class="sr"> </span><span class="se">\h</span><span class="o">*</span><span class="sr"> </span><span class="p">}</span> <span class="c1"># åŒ¹é…æ°´å¹³ç©ºç™½, ä¸åŒ…æ‹¬æ¢è¡Œ</span>
</code></pre></div><p>rule ä¸­ç©ºç™½çš„ä½¿ç”¨:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$str</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">Swift          is hard    to  learn</span><span class="p">&#34;;</span>
<span class="k">my</span> <span class="k">token</span> <span class="nf">word</span> <span class="p">{</span><span class="sr"> </span><span class="se">\w</span><span class="o">+</span><span class="sr"> </span><span class="p">}</span>
<span class="k">my</span> <span class="k">rule</span>  <span class="nf">line</span> <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">word</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> </span><span class="p">[&#39;</span><span class="s1">,</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">]</span><span class="sr"> </span><span class="p">}</span>
<span class="nv">$str</span> <span class="o">~~</span> <span class="k">m</span><span class="p">:</span><span class="na">g</span><span class="p">/</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">line</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">/;</span>
</code></pre></div><p>é€—å·é™„è¿‘çš„æ–¹æ‹¬å·ä¿è¯äº† <code>&lt;.ws&gt;</code> è°ƒç”¨äº§ç”Ÿçš„ç©ºç™½ä½œä¸ºåˆ†å‰²ç¬¦çš„ä¸€éƒ¨åˆ†ã€‚è¿™åˆ©ç”¨äº† <code>&lt;.ws&gt;</code> çš„ä¸€ä¸ªç‰¹ç‚¹ï¼š</p>
<p>åœ¨ä¸¤ä¸ª <code>\w</code> ä¹‹é—´è§£é‡Šä¸º <code>\s+</code>, å…¶å®ƒåœ°æ–¹è§£é‡Šä¸º <code>\s*</code>ã€‚</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/token" term="token" label="token" />
                             
                                <category scheme="https://ohmyweekly.github.io/tags/rule" term="rule" label="rule" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[æ­£ç¡®åœ°ä½¿ç”¨ proto]]></title>
            <link href="https://ohmyweekly.github.io/notes/2016-02-11-multi-thoughts/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2015-10-06-proto-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="Raku ä¸­çš„ proto" />
            
                <id>https://ohmyweekly.github.io/notes/2016-02-11-multi-thoughts/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-12T00:00:00+08:00</published>
            <updated>2021-07-12T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Apropos proto: Perl6.c multi thoughts</blockquote><p>Multi ç¨‹åºç›¸å½“æ•´æ´, ä½†å¯¹äºæˆ‘æ¥è¯´ä¼¼ä¹å¹¶ä¸å®Œæ•´ã€‚ä¸€äº›èƒŒæ™¯ â€” äººä»¬å¯ä»¥è¿™æ ·è®¡ç®—é˜¶ä¹˜:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="nf">fac</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="mi">1</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nf">fac</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$n</span> <span class="k">where</span> <span class="mi">1</span><span class="o">..</span><span class="no">Inf</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$n</span> <span class="o">*</span> <span class="nf">fac</span><span class="p">(</span> <span class="nv">$n-1</span> <span class="p">)</span> <span class="p">}</span>
<span class="nb">say</span> <span class="nf">fac</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="c1"># 24</span>
</code></pre></div><p>ç°åœ¨å‡è®¾æˆ‘ä»¬è¦æŠŠæˆ‘ä»¬çš„é€’å½’ multi-sub ä½œä¸ºä¸€ä¸ªå›è°ƒä¼ é€’ä¼šæ€æ ·å‘¢ï¼Ÿ</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">given</span> <span class="nv">&amp;fac</span> <span class="k">-&gt;</span> <span class="nv">$some_fun</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="nf">some_fun</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="s2">=</span><span class="p">&#34;</span><span class="o">,</span> <span class="nv">$some_fun</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="p">}</span>
</code></pre></div><p>ç°åœ¨&hellip; å®šä¹‰ä¸€ä¸ªåŒ¿åçš„ multi-sub æ€ä¹ˆæ ·ï¼Ÿ</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$anon_fac</span> <span class="o">=</span> <span class="nb">do</span> <span class="p">{</span>
    <span class="k">multi</span> <span class="nf">hidden_fac</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="mi">1</span> <span class="p">}</span>
    <span class="k">multi</span> <span class="nf">hidden_fac</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$n</span> <span class="k">where</span> <span class="mi">1</span><span class="o">..</span><span class="no">Inf</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$n</span> <span class="o">*</span> <span class="nf">fac</span><span class="p">(</span> <span class="nv">$n</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">}</span>
    <span class="nv">&amp;hidden_fac</span> <span class="p">};</span>

<span class="nb">say</span> <span class="nv">$anon_fac</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="c1"># 24</span>
</code></pre></div><p>è¿™ä¹Ÿä¼šæœ‰ä½œç”¨, ä½†æ˜¯æœ‰ç‚¹ hack çš„å‘³é“, å¹¶ä¸”æˆ‘ä»¬çš„ multi-sub å¹¶ä¸æ˜¯çœŸæ­£çš„åŒ¿åã€‚å®ƒä»…ä»…æ˜¯è¢«éšè—äº†ã€‚çœŸæ­£åŒ¿åçš„å¯¹è±¡ä¸ä¼šåœ¨ä»»ä½•ä½œç”¨åŸŸä¸­å®‰è£…, è€Œåœ¨è¿™ä¸ªä¾‹å­ä¸­, &ldquo;hidden_fac&rdquo; è¢«å®‰è£…åœ¨ &ldquo;do&rdquo; block ä¸­çš„æœ¬åœ°ä½œç”¨åŸŸä¸­ã€‚</p>
<p>Rakuè¯´æ˜ä¹¦æ²¡æœ‰æ’é™¤åŒ¿åçš„ multi ç¨‹åº, è€Œä¸”äº‹å®ä¸Š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$anon_fac</span> <span class="o">=</span> <span class="k">anon</span> <span class="k">multi</span> <span class="k">sub</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="mi">1</span> <span class="p">}</span>
</code></pre></div><p>ä¼šæŠ¥ä¸€ä¸ªé”™è¯¯:</p>
<blockquote>
<p>Cannot use &lsquo;anon&rsquo; with individual multi candidates. Please declare an anon-scoped proto instead</p>
</blockquote>
<p>ä¸èƒ½å¯¹å•ç‹¬çš„ multi å€™é€‰è€…ä½¿ç”¨ <code>anon</code>ã€‚è¯·å£°æ˜ä¸€ä¸ª anon-scoped çš„ <strong>proto</strong> ä»£æ›¿ã€‚</p>
<p>è®©æˆ‘ä»¬å›åˆ°åŸå…ˆé‚£ä¸ªä»¥ &ldquo;multi fac(0) { 1 }&rdquo; å¼€å§‹çš„ä¾‹å­ã€‚å½“ç¼–è¯‘å™¨çœ‹åˆ°å®ƒ, å°±ä¼šåœ¨åŒä¸€ä¸ªä½œç”¨åŸŸä¸­ä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª&quot;proto fac&quot; ä½œä¸º <em>multi</em> å®šä¹‰ã€‚<em>proto</em> çš„ä½œç”¨å°±åƒä¸€ä¸ªåˆ†å‘å™¨(dispatcher) â€” ä»æ¦‚å¿µä¸Šè®², å½“æˆ‘ä»¬è°ƒç”¨ fac(4) çš„æ—¶å€™, æˆ‘ä»¬è®© <em>proto fac</em> ä¸ºæˆ‘ä»¬ä» <em>multi facs</em> ä¸­æŒ‘é€‰ä¸€ä¸ªå‡ºæ¥ä»¥è°ƒç”¨ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æå‰æ˜¾å¼åœ°å®šä¹‰ä¸€ä¸ª <em>proto</em>, è€Œä¸”æˆ‘ä»¬ç”šè‡³èƒ½é€šè¿‡æŒ‡å®šå®ƒçš„æ‰€æœ‰ç¨‹åºéƒ½éœ€è¦ <strong>Int</strong> ç±»å‹çš„å‚æ•°æ¥å¯¹é»˜è®¤çš„ &ldquo;proto&rdquo; åŠ ä»¥æ”¹è‰¯ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">proto</span> <span class="nf">fac_with_proto</span><span class="p">(</span><span class="nb">Int</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nf">fac_with_proto</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>   <span class="p">{</span> <span class="mi">1</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nf">fac_with_proto</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$n</span> <span class="k">where</span> <span class="mi">1</span><span class="o">..</span><span class="no">Inf</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$n</span> <span class="o">*</span> <span class="nf">fac</span><span class="p">(</span> <span class="nv">$n</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">}</span>
<span class="nb">say</span> <span class="nf">fac_with_proto</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="c1"># 24</span>
</code></pre></div><p>å› æ­¤, <em>anon muiti sub</em> æŠ›å‡ºçš„é”™è¯¯ â€” <em>Please declare an anon-scoped proto instead</em> â€” æ­£æ˜¯å‘Šè¯‰æˆ‘ä»¬ &ldquo;æ²¡æœ‰è¦å®‰è£…åˆ°çš„ä½œç”¨åŸŸ, æˆ‘ä¸èƒ½ä¸ºä½ è·å–ä¸€ä¸ª protoã€‚ ä½¿ç”¨ä½ è‡ªå·±çš„ <em>anon proto</em>, å¹¶æŠŠè¿™ä¸ªç¨‹åºé™„åŠ ç»™å®ƒ&rdquo;ã€‚</p>
<p>å¥½çš„, èŠ±è´è¶, æ„Ÿè°¢ä½ çš„æé†’! æˆ‘è¯•è¯•&hellip;</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$fac_proto</span> <span class="o">=</span> <span class="k">anon</span> <span class="k">proto</span> <span class="nf">uninstalled-fac</span><span class="p">(</span><span class="nb">Int</span><span class="p">)</span> <span class="p">{</span> <span class="o">*</span> <span class="p">};</span>
<span class="nb">say</span> <span class="nv">$fac_proto</span><span class="o">.</span><span class="nb">name</span><span class="p">;</span> <span class="c1"># uninstalled-fac</span>
</code></pre></div><p>å¥½æäº†! ç°åœ¨æ‰€æœ‰æˆ‘ä»¬è¦åšçš„å°±æ˜¯ç»™é‚£ä¸ª <em>proto</em> æ·»åŠ  <em>multi</em>sã€‚</p>
<p><strong>$fac_proto</strong> æ˜¯ä¸€ä¸ª <strong>Sub</strong> å¯¹è±¡, å®ƒæœ‰æ–¹æ³•æ¥å‘Šè¯‰ä½ å€™é€‰è€…, ä½†æ˜¯æ²¡æœ‰åŠæ³•è®¾ç½®(<strong>set</strong>) å€™é€‰è€…ã€‚å¹¶ä¸”æˆ‘æ‰¾ä¸åˆ°ä»»ä½•æ–¹å¼åœ¨åˆ›å»ºæ—¶ä¼ é€’ä¸€ä¸ªå€™é€‰è€…åˆ—è¡¨ã€‚</p>
<h2 id="é€‚å½“çš„ä¿®è¡¥">é€‚å½“çš„ä¿®è¡¥</h2>
<hr>
<p>ä»€ä¹ˆä¼šè®© <em>proto/multi</em> å¹²å‡€å¹¶ä¸”æ­£äº¤æ˜¯ä¸€ç§æ–¹å¼å»</p>
<ul>
<li>åœ¨ç¼–è¯‘æ—¶æŒ‡å®šå€™é€‰è€…</li>
<li>åœ¨è¿è¡Œæ—¶æ·»åŠ å€™é€‰è€…</li>
</ul>
<p>è¿™æœ‰ç‚¹åƒ</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$future_fac</span> <span class="o">=</span> <span class="nf">Proto</span><span class="p">(</span> <span class="p">:</span><span class="s">dispatch</span><span class="p">(</span> <span class="k">sub</span> <span class="p">(</span><span class="nb">Int</span><span class="p">)</span> <span class="p">{</span><span class="o">*</span><span class="p">}</span> <span class="p">)</span><span class="o">,</span>
                        <span class="p">:</span><span class="s">candidates</span><span class="p">(</span> <span class="o">[</span><span class="k">sub</span> <span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span><span class="mi">1</span><span class="p">}</span><span class="o">]</span> <span class="p">)</span><span class="o">,</span>
                        <span class="p">:</span><span class="s">mutable</span> <span class="p">);</span>

<span class="nv">$future_fac</span><span class="o">.</span><span class="nb">candidates</span><span class="o">.</span><span class="nb">push</span><span class="p">(</span>
    <span class="k">sub</span> <span class="p">(</span><span class="nb">Int</span> <span class="nv">$n</span> <span class="k">where</span> <span class="mi">1</span><span class="o">..</span><span class="no">Inf</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$n</span> <span class="o">*</span> <span class="nf">fac</span><span class="p">(</span> <span class="nv">$n-1</span> <span class="p">)</span> <span class="p">}</span>
<span class="p">);</span>

<span class="nv">$future_fac</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span> <span class="c1"># 24</span>
</code></pre></div><p>æˆ‘å‡å®šäº†ä¸€ä¸ª <strong>Sub</strong> çš„å­ç±» <strong>Proto</strong> ä»¥æ­éœ² multi ç¨‹åºçš„å†…éƒ¨å·¥ä½œåŸç†ã€‚è¿™ä¸ªæ„é€ å‡½æ•°ä¼šå…è®¸å®šä¹‰ä»»ä½• <em>proto</em> å£°æ˜ç¬¦æ‰€åšçš„: ç­¾å <code>&amp;</code> é»˜è®¤ç¨‹åºå’Œåå­—ã€‚ è¿˜æœ‰, å®ƒä¼šå…è®¸åœ¨åˆå§‹çš„å€™é€‰è€…åˆ—è¡¨ä¸­ä¼ é€’ä¸€ä¸ªå±æ€§ã€‚</p>
<p>æœ€å, é‚£ä¸ªå¯¹è±¡è‡ªèº«ä¼šè®©å€™é€‰è€…æ–¹æ³•è¿”å›ä¸€ä¸ªæ•°ç»„, è€Œä¸æ˜¯ä¸€ä¸ªä¸å¯å˜åˆ—è¡¨, å¦‚æœ <em>Proto</em> æ˜¯ä½¿ç”¨ <em>mutable</em> å±æ€§åˆ›å»ºçš„è¯ã€‚ä¸æŒ‡å®š <em>mutable</em> å°†æ„å‘³ç€æ‰€æœ‰çš„ <em>multi</em>s éœ€è¦åœ¨ç¼–è¯‘æ—¶æ·»åŠ , è€Œä¸å…è®¸åœ¨è¿è¡Œæ—¶æ·»åŠ ã€‚</p>
<p><a href="http://blogs.perl.org/users/yary/2016/02/apropos-proto-perl6c-multi-thoughts.html">http://blogs.perl.org/users/yary/2016/02/apropos-proto-perl6c-multi-thoughts.html</a></p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/proto" term="proto" label="proto" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[A Mutable Grammar for Raku]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-11-16-a-mutable-grammar-for-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2016-02-05-raku-grammars/?utm_source=atom_feed" rel="related" type="text/html" title="Raku Grammars" />
                <link href="https://ohmyweekly.github.io/notes/2016-01-01-raku-core-hacking-grammatical-babble/?utm_source=atom_feed" rel="related" type="text/html" title="Raku æ ¸å¿ƒé­”æ”¹: Grammar çš„èƒ¡è¨€ä¹±è¯­" />
                <link href="https://ohmyweekly.github.io/notes/2015-04-27-from-regex-to-grammar-part-one/?utm_source=atom_feed" rel="related" type="text/html" title="ä»æ­£åˆ™è¡¨è¾¾å¼åˆ° Grammar(ç¬¬ä¸€éƒ¨åˆ†)" />
                <link href="https://ohmyweekly.github.io/notes/2015-10-29-from-regex-to-grammar/?utm_source=atom_feed" rel="related" type="text/html" title="ä»æ­£åˆ™è¡¨è¾¾å¼åˆ° Grammar(ç¬¬äºŒéƒ¨åˆ†)" />
                <link href="https://ohmyweekly.github.io/notes/2015-07-11-an-example-of-parsing-text-in-grammar/?utm_source=atom_feed" rel="related" type="text/html" title="ä½¿ç”¨ Grammar è§£ææ–‡æœ¬: ä¸€ä¸ªä¾‹å­" />
            
                <id>https://ohmyweekly.github.io/notes/2015-11-16-a-mutable-grammar-for-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>A Mutable Grammar for Raku</blockquote><p>##Â A Mutable Grammar For Raku</p>
<h3 id="rules">Rules</h3>
<p><code>Rules</code> å°±åƒ perl5çš„ <code>regexes</code>, å¹¶ä¸”æ›´å¥½ã€‚å®ƒä»¬åƒå­ä¾‹ç¨‹å’Œæ–¹æ³•é‚£æ ·ç”³æ˜, å¹¶ä¸”è¿˜èƒ½è°ƒç”¨å…¶å®ƒ rules</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªè§£æ Raku åŸºæœ¬å˜é‡åçš„ä¾‹å­ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">grammar</span> <span class="nb">Raku</span> <span class="p">{</span> Â 
 Â  Â <span class="c1"># token alpha æ˜¯ä¸€ä¸ªé¢„å®šä¹‰å¥½çš„ rule</span>
 Â  Â <span class="nf">token</span> identifier <span class="p">{</span><span class="sr"> Â  Â  Â  Â Â  Â 
</span><span class="sr"> Â  Â  Â  </span><span class="p">&lt;</span><span class="nb">alpha</span><span class="p">&gt;</span><span class="sr"> </span><span class="se">\w</span><span class="o">+</span><span class="sr"> Â  Â Â 
</span><span class="sr"> Â  Â </span><span class="p">}</span> Â  Â 
 Â  Â 
 Â  <span class="c1"># åŒ¹é…ä¸€ä¸ªå…¨é™å®šåæ ‡è¯†ç¬¦</span>
 Â  Â <span class="c1"># [ ... ] Â æ˜¯éæ•è·ç»„</span>
 Â  Â <span class="k">token</span> <span class="nf">name</span> <span class="p">{</span><span class="sr"> Â  Â  Â  Â 
</span><span class="sr"> Â  Â  Â  Â </span><span class="p">&lt;</span><span class="nf">identifier</span><span class="p">&gt;</span><span class="sr">  Â  Â  Â  Â 
</span><span class="sr"> Â  Â  Â  Â </span><span class="p">[</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">::</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">identifier</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">]</span><span class="sr"> </span><span class="o">*</span><span class="sr">  Â  Â 
</span><span class="sr"> Â  Â </span><span class="p">}</span>
 Â  Â  <span class="c1"># .. | .. æ˜¯åˆ†æ”¯. æœ€é•¿åŒ¹é…èƒœå‡º.</span>
 Â  Â <span class="k">token</span> <span class="nf">sigil</span> <span class="p">{</span><span class="sr"> Â  Â  Â  Â 
</span><span class="sr"> Â  Â  Â  </span><span class="p">&#39;</span><span class="s1">$</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">@</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">&amp;</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">%</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">::</span><span class="p">&#39;</span><span class="sr"> Â  Â 
</span><span class="sr"> Â  Â </span><span class="p">}</span> Â  Â 
 Â  Â <span class="c1"># &lt;rule&gt; è°ƒç”¨å‘½å rule, éšå¼åœ°é”šå®šåœ¨å½“å‰ä½ç½®</span>
 Â  Â <span class="k">token</span> <span class="nf">variable</span> <span class="p">{</span><span class="sr"> Â  Â  Â 
</span><span class="sr"> Â  Â  Â  Â </span><span class="p">&lt;</span><span class="nf">sigil</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">name</span><span class="p">&gt;</span><span class="sr"> Â 
</span><span class="sr"> Â  Â </span><span class="p">}</span>

<span class="p">}</span>Â 
</code></pre></div><h3 id="grammars">Grammars</h3>
<p><code>Grammar</code> è·Ÿç±»å¾ˆåƒ, å«æœ‰ <code>rules</code> è€Œä¸æ˜¯ methodsã€‚Grammars æ˜¯ <code>rules</code> çš„é›†åˆå¹¶æ”¯æŒ<code>ç»§æ‰¿</code>ã€‚</p>
<p>å¦‚æœè¦æ±‚ Raku ä¸­å˜é‡çš„åå­—å¿…é¡»å¤§å†™ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># æˆ‘ä»¬ç»§æ‰¿åŸæ¥é‚£ä¸ª grammar</span>
<span class="k">grammar</span> <span class="nc">PERL6</span> <span class="k">is</span> <span class="nb">Raku</span> <span class="p">{</span> Â  Â 
 Â  Â <span class="c1"># ... é‡å†™æˆ‘ä»¬æƒ³æ”¹å˜çš„è§£æè§„åˆ™</span>
 Â  Â <span class="k">token</span> <span class="nf">identifier</span> <span class="p">{</span><span class="sr"> Â  Â  Â  Â 
</span><span class="sr"> Â  </span><span class="c1"># Raku ä¸­çš„å­—ç¬¦ç±»ç°åœ¨å†™ä½œ &lt;[ ... ]&gt;  Â  Â  Â  Â 
</span><span class="c1"></span><span class="sr"> Â  Â  Â  </span><span class="p">&lt;[</span><span class="sr">A</span><span class="o">..</span><span class="sr">Z</span><span class="p">]&gt;</span><span class="sr"> </span><span class="p">&lt;[</span><span class="sr">A</span><span class="o">..</span><span class="sr">Z</span><span class="mi">0</span><span class="o">..</span><span class="mi">9</span><span class="sr">_</span><span class="p">]&gt;</span><span class="o">*</span><span class="sr"> Â  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>ç°åœ¨æˆ‘ä»¬åªéœ€å‘Šè¯‰ç¼–è¯‘å™¨ä½¿ç”¨ <code>PERL6</code> è¿™ä¸ª grammar è€Œéé»˜è®¤ grammar ã€‚è¿˜è®°å¾—ç±»ä¸­çš„æ–¹æ³•è°ƒç”¨é¡ºåºå—ï¼Ÿ å…ˆä»æœ¬ç±»å¼€å§‹, æ²¿ç€ç»§æ‰¿æ ‘ä»ä¸‹è€Œä¸Šåˆ°çˆ¶ç±»ã€‚Grammar ä¸ä¹‹ç±»ä¼¼ã€‚</p>
<p>ç„¶è€Œæœ‰ä¸€ä¸ªç¼ºé™·ã€‚å‡è®¾ä½ æƒ³æ›´æ”¹ä¸€ä¸ªç¬¦å·, ä¾‹å¦‚æŠŠ <code>$</code>Â æ›´æ”¹ ä¸º <code>Â¢</code>ï¼ˆå› ä¸ºä½ æ²¡æœ‰è¶³å¤Ÿçš„ <code>$$$</code> æ¥ä¹°ä¸‹æ‰€æœ‰çš„å˜é‡, ä¸æ˜¯å—ï¼Ÿï¼‰çœ‹èµ·æ¥å¾ˆç®€å•ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">grammar</span> <span class="nc">LowBudgetRaku</span> <span class="k">is</span> <span class="nb">Raku</span> <span class="p">{</span>
    <span class="c1"># token å°±åƒç±»ä¸­çš„æ–¹æ³•ä¸€æ ·, ç»§æ‰¿åå¯ä»¥ä¿®æ”¹</span>
 Â  Â <span class="k">token</span> <span class="nf">sigil</span> <span class="p">{</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">Â¢</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">@</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">&amp;</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">%</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">::</span><span class="p">&#39;</span><span class="sr">Â </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>æ–°çš„ grammar è§£æå·¥ä½œçš„å¾ˆå¥½,  ä½†æ˜¯é‚£ä¹‹åçš„æ‰€æœ‰ä¸œè¥¿è‚¯å®šä¼šå¤±è´¥ã€‚å½“ç¼–è¯‘å™¨åœ¨è§£ææ ‘é‡Œçœ‹è§ <code>sigil</code> åŒ¹é…æ—¶, å®ƒå¾—æ‰¾å‡ºåˆ°åº•æ˜¯å“ªä¸€ä¸ª - è¿™æ„å‘³ç€å®ƒå¿…é¡»è¦æ£€æŸ¥åŒ¹é…æ–‡æœ¬çš„å­—é¢å€¼,  è€Œå®ƒå¹¶ä¸çŸ¥é“æ€ä¹ˆå¤„ç† <code>Â¢</code>ã€‚</p>
<p>æ‰€ä»¥, æˆ‘ä»¬éœ€è¦æ›´å¤šçš„æŠ€èƒ½&hellip;</p>
<h2 id="proto-regexes">Proto Regexes</h2>
<p>Â <code>proto regex</code> æ˜¯ä¸€å¥—æœ‰ç€ç›¸åŒåå­—çš„ regexes/rules, å½“å‰çš„Â <a href="http://svn.pugscode.org/pugs/src/raku/STD.pm">Raku grammar</a>Â ä½¿ç”¨è¿™ä¸ªç»“æ„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">proto</span> <span class="k">token</span> <span class="nf">sigil</span> <span class="p">{</span><span class="o">*</span><span class="p">}</span>
<span class="c1"># ...</span>
<span class="k">token</span> <span class="nf">sigil:sym</span>&lt;$&gt;  <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">sym</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">}</span>
<span class="k">token</span> <span class="nf">sigil:sym</span>&lt;@&gt;  <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">sym</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">}</span>
<span class="k">token</span> <span class="nf">sigil:sym</span>&lt;%&gt;  <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">sym</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">}</span>
<span class="k">token</span> <span class="nf">sigil:sym</span>&lt;&amp;&gt;  <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">sym</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">}</span>
<span class="k">token</span> <span class="nf">sigil:sym</span>&lt;::&gt; <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">sym</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">}</span>
</code></pre></div><p>è¿™åˆ›å»ºäº†ä¸€ä¸ªå«åš <code>sigil</code>Â çš„ç»„(<code>proto</code>), ç»„é‡Œé¢æœ‰ä½¿ç”¨ <code>sym</code>Â æ ‡è¯†ç¬¦å‚æ•°åŒ–çš„ 5 ä¸ªè§„åˆ™(rules)ï¼ˆå®ƒä»¬å±äºè¿™ä¸ªç»„å› ä¸ºå®ƒä»¬è·Ÿç»„çš„åå­—ç›¸åŒï¼‰ã€‚ ç¬¬ä¸€ä¸ªæŠŠ <code>sym</code>Â è®¾ç½®ä¸ºÂ <code>$</code>Â ç„¶ååŒ¹é…è¿™ä¸ªç¬¦å·(ä½¿ç”¨<code>&lt;sym&gt;</code>). ç¬¬äºŒä¸ªåŒ¹é… <code>@</code> ç­‰ç­‰ã€‚ç°åœ¨å¦‚æœè°ƒç”¨è§„åˆ™ <code>&lt;sigil&gt;</code>, ä½ ä¼šå¾—åˆ°ä¸€ä¸ªå«æœ‰ä¸Šè¿°æ‰€æœ‰ 5 ä¸ªè§„åˆ™çš„åˆ—è¡¨, åˆ—è¡¨å…ƒç´ ä¹‹é—´æ˜¯æˆ–çš„å…³ç³»ã€‚æ‰€ä»¥å®ƒä¾ç„¶è·Ÿæ­£åˆ™ <code>'$' | '@' | '%' | '&amp;' | '::'</code>Â åŒ¹é…ç›¸åŒçš„ä¸œè¥¿, ä½†æ˜¯æ›´å®¹æ˜“æ‰©å±•ã€‚</p>
<p>å¦‚æœä½ æƒ³æ·»åŠ ä¸€ä¸ªæ–°çš„ç¬¦å·, Grammar ä¸­å”¯ä¸€è¦ä¿®æ”¹çš„å°±æ˜¯æ·»åŠ å¦å¤–ä¸€ä¸ª <code>sigil</code> è§„åˆ™ï¼šÂ </p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">grammar</span> <span class="nc">SigilRichP6</span> <span class="k">is</span> <span class="nb">Raku</span> <span class="p">{</span>
 Â  Â <span class="k">token</span> <span class="nf">sigil:sym</span>&lt;Ä§&gt; <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">sym</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">}</span> <span class="c1"># ç‰©ç†å­¦å®¶ä¼šå¾ˆçˆ±ä½ </span>
<span class="p">}</span>
</code></pre></div><p>å›åˆ°åŸæ¥é‚£ä¸ªä¾‹å­,  ä½ å¯ä»¥é‡å†™å·²å­˜åœ¨çš„è§„åˆ™ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">grammar</span> <span class="nc">LowBudgetRaku</span> <span class="k">is</span> <span class="nb">Raku</span> <span class="p">{</span>
 Â  Â <span class="k">token</span> <span class="nf">sigil:sym</span>&lt;$&gt; <span class="p">{</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">Â¢</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>ç°åœ¨è¿™ä¸ª grammar ä¸ºæ ‡é‡ä½¿ç”¨äº†ä¸€ä¸ªä¸åŒçš„ç¬¦å·,  ä½†æ˜¯å®ƒå’ŒåŸæ¥çš„ grammar æœ‰ç€ç›¸åŒçš„è§„åˆ™å’Œç›¸åŒçš„å‚æ•°(<code>sigil:sym&lt;$&gt;</code>), ç¼–è¯‘å™¨ä»ç„¶çŸ¥é“æ€ä¹ˆå¤„ç†å®ƒã€‚</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/grammar" term="grammar" label="grammar" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[comb - æ“ä½œå­—ç¬¦ä¸²çš„åˆ©å™¨]]></title>
            <link href="https://ohmyweekly.github.io/notes/2016-02-03-comb-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2016-02-03-comb-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Comb in Raku</blockquote><p>comb - æ“ä½œå­—ç¬¦ä¸²çš„åˆ©å™¨</p>
<h2 id="comb-å­ä¾‹ç¨‹">comb å­ä¾‹ç¨‹</h2>
<p>comb å­ä¾‹ç¨‹çš„å®šä¹‰ä¸ºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span>    <span class="nb">comb</span><span class="p">(</span><span class="nb">Regex</span> <span class="nv">$matcher</span><span class="o">,</span> <span class="nb">Str</span><span class="p">(</span><span class="nb">Cool</span><span class="p">)</span> <span class="nv">$input</span><span class="o">,</span> <span class="nv">$limit</span> <span class="o">=</span> <span class="o">*</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">comb</span><span class="p">(</span><span class="nb">Regex</span> <span class="nv">$matcher</span><span class="o">,</span>                   <span class="nv">$limit</span> <span class="o">=</span> <span class="o">*</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
</code></pre></div><p>ç”¨æ³•ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">comb</span> <span class="o">/</span><span class="n">PATTERN</span><span class="o">/,</span> <span class="n">STRING</span><span class="o">,</span> <span class="n">LIMIT</span><span class="o">?</span>  <span class="c1"># å­ä¾‹ç¨‹å½¢å¼</span>
<span class="n">STRING</span><span class="o">.</span><span class="nb">comb</span><span class="p">(/</span><span class="sr">PATTERN</span><span class="p">/</span><span class="o">,</span> <span class="n">LIMIT</span><span class="o">?</span><span class="p">)</span>  <span class="c1"># æ–¹æ³•å½¢å¼</span>
</code></pre></div><p>è¿”å›è°ƒç”¨è€…ï¼ˆæ–¹æ³•å½¢å¼ï¼‰çš„æ‰€æœ‰ï¼ˆæˆ–è€…è‡³å¤š $limit ä¸ªï¼Œå¦‚æœæä¾›äº†çš„è¯ï¼‰åŒ¹é…ï¼Œæˆ–è€…è¿”å›ç¬¬äºŒä¸ªå‚æ•°ï¼ˆsub å½¢å¼ï¼‰ä¸ Regex ç›¸åŒ¹é…çš„å­—ç¬¦ä¸²åˆ—è¡¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">6 or 12</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">comb</span><span class="p">(/</span><span class="se">\d</span><span class="o">+</span><span class="p">/)</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#34;</span><span class="s2">, </span><span class="p">&#34;);</span> <span class="c1"># 6, 12</span>
</code></pre></div><h2 id="str-ç±»ä¸­çš„-comb">Str ç±»ä¸­çš„ comb</h2>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span>    <span class="nb">comb</span><span class="p">(</span><span class="nb">Str:D</span>   <span class="nv">$matcher</span><span class="o">,</span> <span class="nb">Str:D</span> <span class="nv">$input</span><span class="o">,</span> <span class="nv">$limit</span> <span class="o">=</span> <span class="no">Inf</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span>    <span class="nb">comb</span><span class="p">(</span><span class="nb">Regex:D</span> <span class="nv">$matcher</span><span class="o">,</span> <span class="nb">Str:D</span> <span class="nv">$input</span><span class="o">,</span> <span class="nv">$limit</span> <span class="o">=</span> <span class="no">Inf</span><span class="o">,</span> <span class="nb">Bool</span> <span class="o">:</span><span class="nv">$match</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span>    <span class="nb">comb</span><span class="p">(</span><span class="nb">Int:D</span> <span class="nv">$size</span><span class="o">,</span> <span class="nb">Str:D</span> <span class="nv">$input</span><span class="o">,</span> <span class="nv">$limit</span> <span class="o">=</span> <span class="no">Inf</span><span class="p">)</span>

<span class="k">multi</span> <span class="k">method</span> <span class="nb">comb</span><span class="p">(</span><span class="nb">Str:D</span> <span class="nv">$input:</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">comb</span><span class="p">(</span><span class="nb">Str:D</span> <span class="nv">$input:</span> <span class="nb">Str:D</span>   <span class="nv">$matcher</span><span class="o">,</span> <span class="nv">$limit</span> <span class="o">=</span> <span class="no">Inf</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">comb</span><span class="p">(</span><span class="nb">Str:D</span> <span class="nv">$input:</span> <span class="nb">Regex:D</span> <span class="nv">$matcher</span><span class="o">,</span> <span class="nv">$limit</span> <span class="o">=</span> <span class="no">Inf</span><span class="o">,</span> <span class="nb">Bool</span> <span class="o">:</span><span class="nv">$match</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">comb</span><span class="p">(</span><span class="nb">Str:D</span> <span class="nv">$input:</span> <span class="nb">Int:D</span> <span class="nv">$size</span><span class="o">,</span> <span class="nv">$limit</span> <span class="o">=</span> <span class="no">Inf</span><span class="p">)</span>
</code></pre></div><p>åœ¨ <code>$input</code> ä¸­æœç´¢ <code>$matcher</code> å¹¶è¿”å›æ‰€æœ‰åŒ¹é…ï¼ˆé»˜è®¤æ˜¯ Strï¼Œæˆ–è€…æ˜¯ Match å¯¹è±¡ï¼Œå¦‚æœ <code>$match</code> ä¸ºçœŸçš„è¯ï¼‰çš„ä¸€ä¸ªåˆ—è¡¨ã€‚<code>$limit</code> è¡¨ç¤ºè‡³å¤šè¿”å› <code>$limit</code> ä¸ªåŒ¹é…ã€‚</p>
<p>å¦‚æœæ²¡æœ‰æä¾› <code>$matcher</code>(åŒ¹é…å™¨)ï¼Œ é‚£ä¹ˆä¼šè¿”å›å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰å­—ç¬¦çš„åˆ—è¡¨ã€‚ç­‰ä»·äºä½¿ç”¨äº† <code>$matcher = rx/./</code>ã€‚</p>
<p>ä¾‹å­ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">comb</span><span class="p">(/</span><span class="se">\w</span><span class="p">/</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">a;b;c</span><span class="p">&#34;)</span><span class="o">.</span><span class="nb">perl</span><span class="p">;</span>        <span class="c1"># (&#34;a&#34;, &#34;b&#34;, &#34;c&#34;).list</span>
<span class="nb">comb</span><span class="p">(/</span><span class="se">\N</span><span class="p">/</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">a;b;c</span><span class="p">&#34;)</span><span class="o">.</span><span class="nb">perl</span><span class="p">;</span>        <span class="c1"># (&#34;a&#34;, &#34;;&#34;, &#34;b&#34;, &#34;;&#34;, &#34;c&#34;).list</span>
<span class="nb">comb</span><span class="p">(/</span><span class="se">\w</span><span class="p">/</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">a;b;c</span><span class="p">&#34;</span><span class="o">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="nb">perl</span><span class="p">;</span>     <span class="c1"># (&#34;a&#34;, &#34;b&#34;).list</span>
<span class="nb">comb</span><span class="p">(/</span><span class="se">\w</span><span class="sr">\;</span><span class="se">\w</span><span class="p">/</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">a;b;c</span><span class="p">&#34;</span><span class="o">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="nb">perl</span><span class="p">;</span> <span class="c1"># (&#34;a;b&#34;,).list</span>

<span class="p">&#34;</span><span class="s2">123abc456def</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">comb</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>           <span class="c1"># (123 abc 456 def)</span>
<span class="p">&#34;</span><span class="s2">123abc456def</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">comb</span><span class="p">(</span><span class="mi">3</span><span class="o">,</span><span class="mi">2</span><span class="p">);</span>        <span class="c1"># (123 abc)</span>
</code></pre></div><p>å¦‚æœåŒ¹é…å™¨ï¼ˆmatcherï¼‰æ˜¯ä¸€ä¸ªæ•´æ•°å€¼ï¼Œé‚£ä¹ˆå®ƒè¢«è®¤ä¸ºå’Œ <code>/. ** matcher/</code> ç±»ä¼¼ï¼Œä½†æ˜¯è¿™ä¸ªå¿«äº† 30 å€ã€‚</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/comb" term="comb" label="comb" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Guess Who]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-11-20-guess-who/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2015-06-10-list-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="List in Raku" />
                <link href="https://ohmyweekly.github.io/notes/2016-01-28-the-s-operator-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="Raku ä¸­çš„ S/// æ“ä½œç¬¦" />
                <link href="https://ohmyweekly.github.io/notes/2015-12-11-twigils-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="Raku ä¸­çš„ twigil" />
                <link href="https://ohmyweekly.github.io/notes/2016-01-04-an-example-of-raku-subset-and-multi/?utm_source=atom_feed" rel="related" type="text/html" title="ä½¿ç”¨ Raku çš„ subsets å’Œ multi è¾¨åˆ«å¹´é¾„" />
                <link href="https://ohmyweekly.github.io/notes/2015-11-11-add-a-method-to-an-existing-class-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="åœ¨ Raku ä¸­æ€ä¹ˆä¸ºå·²å­˜åœ¨çš„ç±»æ·»åŠ æ–¹æ³•" />
            
                <id>https://ohmyweekly.github.io/notes/2015-11-20-guess-who/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Guess Who</blockquote><p>ä½ æ˜¯ä¸€ä¸ªåˆšæˆç«‹çš„å°å…¬å¸é‡Œçš„ä¸€åè½¯ä»¶å·¥ç¨‹å¸ˆ, æœ‰å¤©æ™šä¸Šä½ æ”¶åˆ°äº†ä¸€å°æ¥è‡ª CEO çš„ç”µå­é‚®ä»¶:</p>
<blockquote>
<p>äº²çˆ±çš„å·¥ç¨‹å¸ˆ,</p>
<p>â€‹    å¥½æ–°é—»ï¼çœ‹èµ·æ¥æˆ‘ä»¬çš„ç½‘ç«™è¶Šæ¥è¶Šå—æ¬¢è¿ã€‚æˆ‘ä»¬è¦å˜çš„æœ‰é’±äº†! æ¯ç§’é’Ÿæœ‰æˆåƒä¸Šä¸‡çš„äººåœ¨åŒæ—¶è®¿é—®æˆ‘ä»¬çš„ç½‘ç«™, è€Œä¸”è¿˜åœ¨å¿«é€Ÿå¢é•¿ã€‚</p>
<p>æˆ‘ä»¬å¿…é¡»ç«‹å³è¯†åˆ«å‡ºè°çš„é€šä¿¡é‡æœ€å¤§ã€‚å¹¸è¿çš„æ˜¯æˆ‘çš„æœ‹å‹ç»™æˆ‘å‘é€äº†ä¸€ä»½å·¨å¤§çš„ IP åœ°å€å’Œåå­—çš„åˆ—è¡¨ã€‚å¾ˆé…·ä¸æ˜¯å—ï¼Ÿä½ èƒ½å†™ä¸€æ®µç¨‹åºæ¥æ”¶æˆ‘ä»¬å¤§é‡çš„è®¿é—®è€…, æŠŠå®ƒå’Œåœ°å€/åå­—åˆ—è¡¨ç›¸æ¯”, å¹¶åˆ›å»ºä¸€äº›ç»Ÿè®¡å—ï¼Ÿæˆ‘çš„æ„æ€æ˜¯, ç”Ÿæˆä¸€ä¸ªå›½å®¶çš„åå­—åˆ—è¡¨ã€‚</p>
<p>åšå¥½äº†çš„è¯æˆ‘ç»™ä½ ä»¬å¼€ä¸ªæŠ«è¨èšä¼šã€‚</p>
</blockquote>
<blockquote>
<p>é‚®ä»¶çš„é™„ä»¶æ–‡ä»¶åŒ…å«äº†ä¸€ä¸ª IP åœ°å€å’Œåå­—çš„åˆ—è¡¨ã€‚å†™ä¸€ä¸ªç¨‹åºæ¥ç»Ÿè®¡ä¸‹æœ‰å¤šå°‘ IP è®¿é—®äº†ä½ çš„ç½‘ç«™ã€‚</p>
</blockquote>
<h2 id="è¾“å…¥æè¿°">è¾“å…¥æè¿°</h2>
<p>è¾“å…¥æ¥è‡ªä¸¤éƒ¨åˆ†ã€‚ç¬¬ä¸€ä¸ªæ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶, åŒ…å« IP åœ°å€èŒƒå›´ã€‚æ¯è¡Œä¸€é¡¹,ä½¿ç”¨ä¸¤ä¸ªç©ºæ ¼åˆ†å‰² IP å’Œåå­—ã€‚</p>
<p>ç¬¬äºŒä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ª IP åœ°å€çš„åˆ—è¡¨, æ¯è¡Œä¸€ä¸ª, å®ƒä»¬æ˜¯å¿…é¡»è¢«æŸ¥è¯¢çš„IPã€‚</p>
<h2 id="ip-è¾“å…¥æ ·æœ¬">IP è¾“å…¥æ ·æœ¬</h2>
<p>è¾“å…¥æ˜¯æœ‰åŒ…å«ä¸¤ä¸ª IP åœ°å€å’Œä¸€ä¸ªè·Ÿ IP èŒƒå›´å…³è”çš„åå­—çš„å¤§é‡è¡Œç»„æˆã€‚</p>
<pre><code>123.45.17.8 123.45.123.45 University of Vestige
123.50.1.1 123.50.10.1 National Center for Pointlessness
188.0.0.3 200.0.0.250 Mayo Tarkington
200.0.0.251 200.0.0.255 Daubs Haywire Committee
200.0.1.1 200.255.255.255 Geopolitical Encyclopedia
222.222.222.222 233.233.233.233 SAP Rostov
250.1.2.3 250.4.5.6 Shavian Refillable Committee
123.45.100.0 123.60.32.1 United Adverbs
190.0.0.1 201.1.1.1 Shavian Refillable Committee
238.0.0.1 254.1.2.3 National Center for Pointlessness
</code></pre><p>æ³¨æ„: è¿™äº› IP èŒƒå›´ä¸èƒ½ä¿è¯æ˜¯ IPv4 &ldquo;å­ç½‘&rdquo;ã€‚è¿™æ„å‘³ç€å®ƒä»¬å¯èƒ½ä¸èƒ½ç²¾ç¡®åœ°ç”±åŸºäºå‰ç¼€çš„ CIDR å—æ¥è¡¨ç¤ºã€‚</p>
<p>èŒƒå›´å¯ä»¥é‡å ã€‚å¯èƒ½å¤šä½™2å±‚æ·±ã€‚</p>
<p>å¯å¯æœ‰å¤šä¸ªèŒƒå›´å…³è”åŒä¸€ä¸ªåå­—ã€‚</p>
<h2 id="æŸ¥è¯¢è¾“å…¥æ ·æœ¬">æŸ¥è¯¢è¾“å…¥æ ·æœ¬</h2>
<pre><code>250.1.3.4
123.50.1.20
189.133.73.57
123.50.1.21
250.1.2.4
123.50.1.21
250.1.3.100
250.1.3.5
188.0.0.5
123.50.1.100
123.50.2.34
123.50.1.100
123.51.100.52
127.0.0.1
123.50.1.22
123.50.1.21
188.0.0.5
123.45.101.100
123.45.31.52
230.230.230.230
</code></pre><h2 id="è¾“å‡ºæ ¼å¼åŒ–">è¾“å‡ºæ ¼å¼åŒ–</h2>
<p>å€’åºè¾“å‡ºè®¿é—®æ¬¡æ•°ã€‚</p>
<pre><code>8 - National Center for Pointlessness
4 - Shavian Refillable Committee
3 - Mayo Tarkington
2 - University of Vestige
1 - SAP Rostov
1 - United Adverbs
1 - &lt;unknown&gt;
</code></pre><h2 id="è§£é‡Š">è§£é‡Š</h2>
<p>è¿™å„¿æ˜¯ä¸€ä¸ªè¾“å…¥ IP å’Œå®ƒçš„åå­—çš„æ˜ å°„:</p>
<pre><code>National Center for Pointlessness
123.50.1.20
123.50.1.21
123.50.1.22
123.50.1.21
123.50.1.21
123.50.1.100
123.50.1.100
123.50.2.34

Shavian Refillable Committee
250.1.2.4
250.1.3.4
250.1.3.5
250.1.3.100

Mayo Tarkington
188.0.0.5
188.0.0.5
189.133.73.57

University of Vestige
123.45.101.100
123.45.31.52

SAP Rostov
230.230.230.230

United Adverbs
123.51.100.52

&lt;unknown&gt;
127.0.0.1
</code></pre><p>smls çš„è§£å†³æ–¹æ³•:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">ip-to-number</span> <span class="p">(</span><span class="nv">$ip</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">do</span> <span class="k">given</span> <span class="nv">$ip</span><span class="o">.</span><span class="nb">split</span><span class="p">(&#39;</span><span class="s1">.</span><span class="p">&#39;)</span> <span class="p">{</span>
        <span class="o">.[</span><span class="mi">0</span><span class="o">]</span> <span class="o">+&lt;</span> <span class="mi">24</span> <span class="o">+</span>
        <span class="o">.[</span><span class="mi">1</span><span class="o">]</span> <span class="o">+&lt;</span> <span class="mi">16</span> <span class="o">+</span>
        <span class="o">.[</span><span class="mi">2</span><span class="o">]</span> <span class="o">+&lt;</span>  <span class="mi">8</span> <span class="o">+</span>
        <span class="o">.[</span><span class="mi">3</span><span class="o">]</span> <span class="o">+&lt;</span>  <span class="mi">0</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">IntervalTree</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.min</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.max</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$!center</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$!min</span> <span class="o">+</span> <span class="nv">$!max</span><span class="p">)</span> <span class="ow">div</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">@!intervals</span><span class="p">;</span>
    <span class="k">has</span> <span class="n">IntervalTree</span> <span class="nv">$!left</span><span class="p">;</span>
    <span class="k">has</span> <span class="n">IntervalTree</span> <span class="nv">$!right</span><span class="p">;</span>

    <span class="k">method</span> <span class="nb">new</span> <span class="p">(</span><span class="nv">$min</span><span class="o">,</span> <span class="nv">$max</span><span class="p">)</span> <span class="p">{</span> <span class="nb">self</span><span class="o">.</span><span class="nb">bless</span><span class="p">(</span><span class="o">:</span><span class="nv">$min</span><span class="o">,</span> <span class="o">:</span><span class="nv">$max</span><span class="p">)</span> <span class="p">}</span>

    <span class="k">method</span> <span class="nf">insert</span> <span class="p">(</span><span class="o">|</span><span class="n">c</span> <span class="p">(</span><span class="nv">$start</span><span class="o">,</span> <span class="nv">$end</span><span class="o">,</span> <span class="nv">$name</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nv">$end</span> <span class="o">&lt;</span> <span class="nv">$!center</span> <span class="ow">and</span> <span class="nv">$!min</span> <span class="o">&lt;</span> <span class="nv">$!center</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">{</span>
            <span class="p">(</span><span class="nv">$!left</span> <span class="o">//=</span> <span class="nb">self</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="nv">$!min</span><span class="o">,</span> <span class="nv">$!center</span><span class="p">))</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="o">|</span><span class="n">c</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">elsif</span> <span class="nv">$start</span> <span class="o">&gt;</span> <span class="nv">$!center</span> <span class="ow">and</span> <span class="nv">$!max</span> <span class="o">&gt;</span> <span class="nv">$!center</span> <span class="p">{</span>
            <span class="p">(</span><span class="nv">$!right</span> <span class="o">//=</span> <span class="nb">self</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="nv">$!center</span><span class="o">,</span> <span class="nv">$!max</span><span class="p">))</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="o">|</span><span class="n">c</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nv">@!intervals</span><span class="o">.</span><span class="nb">push</span><span class="o">:</span> <span class="o">[</span><span class="nv">$start</span><span class="o">,</span> <span class="nv">$end</span><span class="o">,</span> <span class="nv">$name</span><span class="o">,</span> <span class="nv">$end-$start</span><span class="o">]</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">prepare</span> <span class="p">{</span>
        <span class="nv">@!intervals</span><span class="o">.=</span><span class="nb">sort</span><span class="p">(</span><span class="o">*[</span><span class="mi">3</span><span class="o">]</span><span class="p">);</span>
        <span class="nv">$!left</span> <span class="o">.</span><span class="nf">prepare</span> <span class="k">if</span> <span class="nv">$!left</span><span class="p">;</span>
        <span class="nv">$!right</span><span class="o">.</span><span class="nf">prepare</span> <span class="k">if</span> <span class="nv">$!right</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nb">lookup</span> <span class="p">(</span><span class="nv">$n</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">$best</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$n</span> <span class="o">&lt;</span> <span class="nv">$!center</span> <span class="o">??</span> <span class="p">(</span><span class="nv">$!left</span> <span class="o">.</span><span class="nb">lookup</span><span class="p">(</span><span class="nv">$n</span><span class="p">)</span> <span class="k">if</span> <span class="nv">$!left</span><span class="p">)</span>
                                  <span class="o">!!</span> <span class="p">(</span><span class="nv">$!right</span><span class="o">.</span><span class="nb">lookup</span><span class="p">(</span><span class="nv">$n</span><span class="p">)</span> <span class="k">if</span> <span class="nv">$!right</span><span class="p">));</span>
        <span class="nv">$best</span> <span class="o">??</span> <span class="nv">@!intervals</span><span class="o">.</span><span class="nb">first</span><span class="p">({</span> <span class="k">return</span> <span class="nv">$best</span> <span class="k">if</span> <span class="o">.[</span><span class="mi">3</span><span class="o">]</span> <span class="o">&gt;</span> <span class="nv">$best</span><span class="o">[</span><span class="mi">3</span><span class="o">]</span><span class="p">;</span>
                                     <span class="o">.[</span><span class="mi">0</span><span class="o">]</span> <span class="o">&lt;=</span> <span class="nv">$n</span> <span class="o">&lt;=</span> <span class="o">.[</span><span class="mi">1</span><span class="o">]</span> <span class="p">})</span> <span class="o">//</span> <span class="nv">$best</span>
              <span class="o">!!</span> <span class="nv">@!intervals</span><span class="o">.</span><span class="nb">first</span><span class="p">({</span> <span class="o">.[</span><span class="mi">0</span><span class="o">]</span> <span class="o">&lt;=</span> <span class="nv">$n</span> <span class="o">&lt;=</span> <span class="o">.[</span><span class="mi">1</span><span class="o">]</span> <span class="p">})</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nb">MAIN</span> <span class="p">(</span><span class="nv">$ip-file</span><span class="o">,</span> <span class="nv">$query-file</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$index</span> <span class="o">=</span> <span class="n">IntervalTree</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">ip-to-number</span> <span class="p">&#39;</span><span class="s1">255.255.255.255</span><span class="p">&#39;);</span>

    <span class="k">for</span> <span class="nv">$ip-file</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">lines</span> <span class="p">{</span>
        <span class="k">my</span> <span class="p">(</span><span class="nv">$start</span><span class="o">,</span> <span class="nv">$end</span><span class="o">,</span> <span class="nv">$name</span><span class="p">)</span> <span class="o">=</span> <span class="o">.</span><span class="nb">split</span><span class="p">(&#39;</span><span class="s1"> </span><span class="p">&#39;</span><span class="o">,</span> <span class="mi">3</span><span class="p">);</span>
        <span class="nv">$index</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="nf">ip-to-number</span><span class="p">(</span><span class="nv">$start</span><span class="p">)</span><span class="o">,</span> <span class="nf">ip-to-number</span><span class="p">(</span><span class="nv">$end</span><span class="p">)</span><span class="o">,</span> <span class="nv">$name</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">$index</span><span class="o">.</span><span class="nf">prepare</span><span class="p">;</span>
    
    <span class="k">for</span> <span class="nv">$query-file</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">lines</span> <span class="k">-&gt;</span> <span class="nv">$ip</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$index</span><span class="o">.</span><span class="nb">lookup</span><span class="p">(</span><span class="n">ip-to-number</span> <span class="nv">$ip</span><span class="p">)</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$ip</span><span class="s2"> </span><span class="p">{</span><span class="nv">$name</span> <span class="o">//</span> <span class="p">&#39;</span><span class="s1">&lt;unknown&gt;</span><span class="p">&#39;}&#34;;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[List in Raku]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-06-10-list-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2015-11-20-guess-who/?utm_source=atom_feed" rel="related" type="text/html" title="Guess Who" />
                <link href="https://ohmyweekly.github.io/notes/2016-01-28-the-s-operator-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="Raku ä¸­çš„ S/// æ“ä½œç¬¦" />
                <link href="https://ohmyweekly.github.io/notes/2015-12-11-twigils-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="Raku ä¸­çš„ twigil" />
                <link href="https://ohmyweekly.github.io/notes/2016-01-04-an-example-of-raku-subset-and-multi/?utm_source=atom_feed" rel="related" type="text/html" title="ä½¿ç”¨ Raku çš„ subsets å’Œ multi è¾¨åˆ«å¹´é¾„" />
                <link href="https://ohmyweekly.github.io/notes/2015-11-11-add-a-method-to-an-existing-class-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="åœ¨ Raku ä¸­æ€ä¹ˆä¸ºå·²å­˜åœ¨çš„ç±»æ·»åŠ æ–¹æ³•" />
            
                <id>https://ohmyweekly.github.io/notes/2015-06-10-list-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>List in Raku</blockquote><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="k">class</span> <span class="nb">List</span> <span class="k">is</span> <span class="nb">Iterable</span> <span class="k">does</span> <span class="nb">Positional</span> <span class="p">{</span> <span class="o">..</span> <span class="p">}</span>
</code></pre></div><p><strong>List</strong> ä»¥åºåˆ—åŒ–çš„æ–¹å¼å­˜å‚¨ itemså¹¶ä¸”æ½œåœ¨æ˜¯æƒ°æ€§çš„ã€‚</p>
<p>é»˜è®¤åˆ—è¡¨å’Œæ•°ç»„çš„ç´¢å¼•ä» 0 å¼€å§‹ã€‚</p>
<p>ä½ å¯ä»¥ç»™åˆ—è¡¨ä¸­çš„å…ƒç´ èµ‹å€¼å¦‚æœå®ƒä»¬æ˜¯å®¹å™¨çš„è¯ã€‚ä½¿ç”¨æ•°ç»„ä»¥ä½¿åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ å­˜å‚¨åœ¨å®¹å™¨ä¸­ã€‚</p>
<h2 id="itemsflattening-å’Œ-sigils">Itemsã€Flattening å’Œ Sigils</h2>
<p>åœ¨ Raku ä¸­, æŠŠ <strong>List</strong> èµ‹å€¼ç»™ä¸€ä¸ªæ ‡é‡å˜é‡ä¸ä¼šä¸¢å¤±ä¿¡æ¯ã€‚ä¸åŒä¹‹å¤„åœ¨äºè¿­ä»£é€šå¸¸ä¼šæŠŠæ ‡é‡ä¸­çš„åˆ—è¡¨å½“ä½œå•ä¸ªå…ƒç´ ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@a</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="p">;</span>
<span class="k">for</span> <span class="nv">@a</span> <span class="p">{</span> <span class="p">}</span>      <span class="c1"># ä¸‰æ¬¡è¿­ä»£</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$s</span> <span class="o">=</span> <span class="nv">@a</span><span class="p">;</span>
<span class="k">for</span> <span class="nv">$s</span> <span class="p">{</span> <span class="p">}</span>      <span class="c1"># ä¸€æ¬¡è¿­ä»£</span>
<span class="k">for</span> <span class="nv">@a</span><span class="o">.</span><span class="nb">item</span> <span class="p">{</span> <span class="p">}</span> <span class="c1"># ä¸€æ¬¡è¿­ä»£</span>
<span class="k">for</span> <span class="nv">$s</span><span class="o">.</span><span class="nb">list</span> <span class="p">{</span> <span class="p">}</span> <span class="c1"># ä¸‰æ¬¡è¿­ä»£</span>
</code></pre></div><p><strong>Lists</strong> é€šå¸¸ä¼šæ’å€¼(å±•å¼€)é™¤éå®ƒä»¬é€šè¿‡ä¸€ä¸ª item(scalar)å®¹å™¨è®¿é—®:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@a</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">@flat</span>   <span class="o">=</span> <span class="nv">@a</span><span class="o">,</span> <span class="nv">@a</span><span class="p">;</span>           <span class="c1"># two elements</span>
<span class="k">my</span> <span class="nv">@nested</span> <span class="o">=</span> <span class="nv">@a</span><span class="o">.</span><span class="nb">item</span><span class="o">,</span> <span class="nv">@a</span><span class="o">.</span><span class="nb">item</span><span class="p">;</span> <span class="c1"># two elements</span>
</code></pre></div><p><code>.item</code> é€šå¸¸èƒ½è¢«å†™ä¸º <code>$( ... )</code>, è€Œåœ¨æ•°ç»„å˜é‡ä¸Šç”šè‡³å†™ä¸º <code>$@a</code>ã€‚</p>
<h2 id="methods">Methods</h2>
<h3 id="elems">elems</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span>    <span class="nb">elems</span><span class="p">(</span><span class="nv">$list</span><span class="p">)</span>  <span class="k">returns</span> <span class="nb">Int:D</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">elems</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Int:D</span>
</code></pre></div><p>è¿”å›åˆ—è¡¨ä¸­å…ƒç´ çš„ä¸ªæ•°ã€‚</p>
<h3 id="end">end</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span>    <span class="nb">end</span><span class="p">(</span><span class="nv">$list</span><span class="p">)</span>  <span class="k">returns</span> <span class="nb">Int:D</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">end</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Int:D</span>
</code></pre></div><p>è¿”å›åˆ—è¡¨ä¸­æœ€åä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•</p>
<h3 id="keys">keys</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span>    <span class="nb">keys</span><span class="p">(</span><span class="nv">$list</span><span class="p">)</span>  <span class="k">returns</span> <span class="nb">List:D</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">keys</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
</code></pre></div><p>è¿”å›ä¸€ä¸ªç´¢å¼•åˆ—è¡¨( ä¾‹å¦‚ <code>0..(@list.elems-1)</code> )</p>
<h3 id="values">values</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span>    <span class="nb">values</span><span class="p">(</span><span class="nv">$list</span><span class="p">)</span>  <span class="k">returns</span> <span class="nb">List:D</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">values</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
</code></pre></div><p>è¿”å›åˆ—è¡¨çš„ä¸€ä»½æ‹·è´ã€‚</p>
<h3 id="kv">kv</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span>    <span class="nb">kv</span><span class="p">(</span><span class="nv">$list</span><span class="p">)</span>  <span class="k">returns</span> <span class="nb">List:D</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">kv</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
</code></pre></div><p>è¿”å›ç´¢å¼•å’Œå€¼çš„äº¤æ›¿çš„åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">kv</span>
</code></pre></div><p>è¿”å›:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="mi">0</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">b</span><span class="p">&#39;</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">c</span><span class="p">&#39;</span>
</code></pre></div><h3 id="pairs">pairs</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span>    <span class="nb">pairs</span><span class="p">(</span><span class="nv">$list</span><span class="p">)</span>   <span class="k">returns</span> <span class="nb">List:D</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">pairs</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
</code></pre></div><p>è¿”å›ä¸€ä¸ª pairs çš„åˆ—è¡¨, ä½¿ç”¨ç´¢å¼•ä½œä¸ºé”®, åˆ—è¡¨å€¼ä½œä¸ºé”®å€¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">pairs</span>   <span class="c1"># 0 =&gt; &#39;a&#39;, 1 =&gt; &#39;b&#39;, 2 =&gt; &#39;c&#39;</span>
</code></pre></div><h3 id="join">join</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span>    <span class="nb">join</span><span class="p">(</span><span class="nv">$separator</span><span class="o">,</span> <span class="o">*</span><span class="nv">@list</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Str:D</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">join</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span> <span class="nv">$separator</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Str:D</span>
</code></pre></div><p>æŠŠåˆ—è¡¨ä¸­å…ƒç´ å½“ä½œå­—ç¬¦ä¸², åœ¨å…ƒç´ ä¹‹é—´æ’å…¥ <code>$separator</code> å¹¶æŠŠæ‰€æœ‰ä¸œè¥¿è¿æ¥æˆå•ä¸ªå­—ç¬¦ä¸²ã€‚</p>
<p>ä¾‹å¦‚:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">join</span> <span class="p">&#39;</span><span class="s1">, </span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;;</span>     <span class="c1"># &#39;a, b, c&#39;</span>
</code></pre></div><h3 id="map">map</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span>    <span class="nb">map</span><span class="p">(</span><span class="nv">&amp;code</span><span class="o">,</span> <span class="o">*</span><span class="nv">@elems</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">map</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span> <span class="nv">&amp;code</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
</code></pre></div><p>å¯¹æ¯ä¸ªå…ƒç´ è°ƒç”¨ <code>&amp;code</code> å¹¶ä¸”æŠŠå€¼æ”¶é›†åˆ°å¦å¤–ä¸€ä¸ªåˆ—è¡¨ä¸­å¹¶è¿”å›å®ƒã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯æƒ°æ€§çš„ã€‚<code>&amp;code</code>åªåœ¨è¿”å›å€¼è¢«è®¿é—®çš„æ—¶å€™è°ƒç”¨ã€‚</p>
<p>ä¾‹å­:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">(&#39;</span><span class="s1">hello</span><span class="p">&#39;</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">22</span><span class="o">/</span><span class="mi">7</span><span class="o">,</span> <span class="mi">42</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">world</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">map</span><span class="o">:</span> <span class="p">{</span> <span class="o">.</span><span class="nb">WHAT</span><span class="o">.</span><span class="nb">raku</span> <span class="p">};</span> <span class="c1"># Str Int Rat Int Str</span>
<span class="nb">map</span> <span class="o">*.</span><span class="nb">Str</span><span class="o">.</span><span class="nb">chars</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">hello</span><span class="p">&#39;</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">22</span><span class="o">/</span><span class="mi">7</span><span class="o">,</span> <span class="mi">42</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">world</span><span class="p">&#39;;</span>      <span class="c1"># 5 1 8 2 5</span>
</code></pre></div><h3 id="grep">grep</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span>    <span class="nb">grep</span><span class="p">(</span><span class="nb">Mu</span> <span class="nv">$matcher</span><span class="o">,</span> <span class="o">*</span><span class="nv">@elems</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">grep</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span>  <span class="nb">Mu</span> <span class="nv">$matcher</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
</code></pre></div><p>è¿”å›ä¸€ä¸ªä½¿ç”¨ <code>$matcher</code> æ™ºèƒ½åŒ¹é…çš„æƒ°æ€§åˆ—è¡¨ã€‚å…ƒç´ æ˜¯ä»¥å‡ºç°åœ¨åŸåˆ—è¡¨ä¸­çš„é¡ºåºè¿”å›çš„ã€‚</p>
<p>ä¾‹å­:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">(&#39;</span><span class="s1">hello</span><span class="p">&#39;</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">22</span><span class="o">/</span><span class="mi">7</span><span class="o">,</span> <span class="mi">42</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">world</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">grep</span><span class="o">:</span> <span class="nb">Int</span><span class="p">;</span>              <span class="c1"># 1 42</span>
<span class="nb">grep</span> <span class="p">{</span> <span class="o">.</span><span class="nb">Str</span><span class="o">.</span><span class="nb">chars</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="p">}</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">hello</span><span class="p">&#39;</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">22</span><span class="o">/</span><span class="mi">7</span><span class="o">,</span> <span class="mi">42</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">world</span><span class="p">&#39;;</span> <span class="c1"># hello 3.142857 world</span>
</code></pre></div><h3 id="first">first</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span>    <span class="nb">first</span><span class="p">(</span><span class="nb">Mu</span> <span class="nv">$matcher</span><span class="o">,</span> <span class="o">*</span><span class="nv">@elems</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">first</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span>  <span class="nb">Mu</span> <span class="nv">$matcher</span><span class="p">)</span>
</code></pre></div><p>è¿”å›åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªåŒ¹é… <code>$matcher</code> çš„å…ƒç´ , å½“æ²¡æœ‰åŒ¹é…å€¼æ—¶, å¤±è´¥ã€‚</p>
<p>ä¾‹å­:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">22</span><span class="o">/</span><span class="mi">7</span><span class="o">,</span> <span class="mi">42</span><span class="p">)</span><span class="o">.</span><span class="nb">first</span><span class="o">:</span> <span class="o">*</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">;</span> <span class="c1"># 42</span>
<span class="nb">say</span> <span class="nv">$f</span> <span class="o">=</span> <span class="p">(&#39;</span><span class="s1">hello</span><span class="p">&#39;</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">22</span><span class="o">/</span><span class="mi">7</span><span class="o">,</span> <span class="mi">42</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">world</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">first</span><span class="o">:</span> <span class="nb">Complex</span><span class="p">;</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">(&#39;</span><span class="s1">hello</span><span class="p">&#39;</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">22</span><span class="o">/</span><span class="mi">7</span><span class="o">,</span> <span class="mi">42</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">world</span><span class="p">&#39;</span><span class="o">,</span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="no">i</span><span class="p">)</span><span class="o">.</span><span class="nb">first</span><span class="o">:</span> <span class="nb">Complex</span><span class="p">;</span> <span class="c1"># 1+2i</span>
<span class="nb">say</span> <span class="nv">$f</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span> 
<span class="c1"># Failure.new(exception =&gt; X::AdHoc.new(payload =&gt; &#34;No values matched&#34;))</span>
</code></pre></div><h3 id="classify">classify</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span>    <span class="nb">classify</span><span class="p">(</span><span class="nv">&amp;mapper</span><span class="o">,</span> <span class="o">*</span><span class="nv">@values</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Hash:D</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">classify</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span> <span class="nv">&amp;mapper</span><span class="p">)</span>   <span class="k">returns</span> <span class="nb">Hash:D</span>
</code></pre></div><p>æ ¹æ®æ˜ å°„å™¨æŠŠä¸€åˆ—å€¼è½¬æ¢æˆä»£è¡¨é‚£äº›å€¼çš„ç±»åˆ«çš„æ•£åˆ—; æ•£åˆ—çš„æ¯ä¸ªé”®ä»£è¡¨ç€å°†è¦å½’å…¥åˆ—è¡¨çš„ä¸€ä¸ªæˆ–å¤šä¸ªå€¼çš„ç±»åˆ«ã€‚æ¯”å¦‚å­—ç¬¦ä¸ªæ•°,  å…ƒç´ å¤šå°‘, é”®å€¼å°±æ˜¯æ ¹æ® mapper å¾—åˆ°çš„è¿™ä¸ªç±»åˆ«ä¸‹çš„å…ƒç´ ,  å®ƒæ¥è‡ªäºåŸå§‹åˆ—è¡¨ï¼š</p>
<p>ä¾‹å­ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nb">classify</span> <span class="p">{</span> <span class="nv">$_</span> <span class="nv">%%</span> <span class="mi">2</span> <span class="o">??</span> <span class="p">&#39;</span><span class="s1">even</span><span class="p">&#39;</span> <span class="o">!!</span> <span class="p">&#39;</span><span class="s1">odd</span><span class="p">&#39;</span> <span class="p">}</span><span class="o">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="c1"># (&#34;odd&#34; =&gt; [1, 7, 3], &#34;even&#34; =&gt; [6, 2]).hash;</span>

<span class="nb">say</span> <span class="p">(&#39;</span><span class="s1">hello</span><span class="p">&#39;</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">22</span><span class="o">/</span><span class="mi">7</span><span class="o">,</span> <span class="mi">42</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">world</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">classify</span><span class="o">:</span> <span class="p">{</span> <span class="o">.</span><span class="nb">Str</span><span class="o">.</span><span class="nb">chars</span> <span class="p">};</span>
<span class="c1"># (&#34;5&#34; =&gt; [&#34;hello&#34;, &#34;world&#34;], &#34;1&#34; =&gt; [1], &#34;8&#34; =&gt; [22/7], &#34;2&#34; =&gt; [42]).hash</span>
</code></pre></div><h3 id="bool">Bool</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">method</span> <span class="nb">Bool</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool:D</span>
</code></pre></div><p>å¦‚æœåˆ—è¡¨è‡³å°‘å«æœ‰ä¸€ä¸ªå…ƒç´ åˆ™è¿”å› True, å¦‚æœåˆ—è¡¨ä¸ºç©ºåˆ™è¿”å› Falseã€‚</p>
<h3 id="str">Str</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">method</span> <span class="nb">Str</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Str:D</span>
</code></pre></div><p>å­—ç¬¦ä¸²åŒ–åˆ—è¡¨ä¸­çš„å…ƒç´ å¹¶ä½¿ç”¨ç©ºæ ¼æŠŠè¿™äº›å…ƒç´ è¿æ¥èµ·æ¥ã€‚( å’Œ <code>.join(' ')</code> ä¸€æ ·)ã€‚</p>
<h3 id="int">Int</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">method</span> <span class="nb">Int</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span><span class="p">)</span> <span class="k">return</span> <span class="nb">Int:D</span>
</code></pre></div><p>è¿”å›åˆ—è¡¨ä¸­å…ƒç´ çš„æ•°é‡(å’Œ <code>.elems</code> ä¸€æ ·)</p>
<h3 id="pick">pick</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span>    <span class="nb">pick</span><span class="p">(</span><span class="nv">$count</span><span class="o">,</span> <span class="o">*</span><span class="nv">@list</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">pick</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span> <span class="nv">$count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div><p>ä»è°ƒç”¨è€…èº«ä¸Šéšæœºè¿”å› <code>$count</code> ä¸ªä¸é‡å¤çš„å…ƒç´ ã€‚ å¦‚æœ <code>*</code> ä½œä¸º <code>$count</code> ä¼ é€’è¿›æ¥æˆ– <code>$count</code> å¤§äºæˆ–ç­‰äºåˆ—è¡¨çš„å¤§å°, é‚£ä¹ˆå°±ä»¥éšæœºåºåˆ—çš„æ–¹å¼è¿”å›åˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚</p>
<p>ä¾‹å­:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&lt;</span><span class="s">a b c d e</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">pick</span><span class="p">;</span>     <span class="c1"># b</span>
<span class="nb">say</span> <span class="p">&lt;</span><span class="s">a b c d e</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">pick</span><span class="o">:</span> <span class="mi">3</span><span class="p">;</span>  <span class="c1"># c a e</span>
<span class="nb">say</span>  <span class="p">&lt;</span><span class="s">a b c d e</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">pick</span><span class="o">:</span> <span class="o">*</span><span class="p">;</span> <span class="c1"># e d a b c</span>
</code></pre></div><h3 id="roll">roll</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span>    <span class="nb">roll</span><span class="p">(</span><span class="nv">$count</span><span class="o">,</span> <span class="o">*</span><span class="nv">@list</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">roll</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span> <span class="nv">$count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div><p>è¿”å›ä¸€ä¸ª <code>$count</code> ä¸ªå…ƒç´ çš„æƒ°æ€§åˆ—è¡¨, æ¯ä¸ªå…ƒç´ éƒ½ä»åˆ—è¡¨ä¸­éšæœºé€‰æ‹©ã€‚æ¯ä¸ªéšæœºé€‰æ‹©éƒ½æ˜¯ç‹¬ç«‹çš„.</p>
<p>å¦‚æœç»™ <code>$count</code> ä¼ é€’äº† <code>*</code> å·, åˆ™è¿”å›ä¸€ä¸ªæƒ°æ€§çš„, ä»åŸåˆ—è¡¨ä¸­éšæœºé€‰å–å…ƒç´ çš„æ— é™åˆ—è¡¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&lt;</span><span class="s">a b c d e</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">roll</span><span class="p">;</span>       <span class="c1"># b</span>
<span class="nb">say</span> <span class="p">&lt;</span><span class="s">a b c d e</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">roll</span><span class="o">:</span> <span class="mi">3</span><span class="p">;</span>    <span class="c1"># c c e</span>
<span class="nb">say</span> <span class="nb">roll</span> <span class="mi">8</span><span class="o">,</span> <span class="p">&lt;</span><span class="s">a b c d e</span><span class="p">&gt;;</span>    <span class="c1"># b a e d a e b c</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$random_digits</span> <span class="o">:=</span> <span class="p">(</span><span class="o">^</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="nb">roll</span><span class="p">(</span><span class="o">*</span><span class="p">);</span><span class="mi">1</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$random_digits</span><span class="o">[^</span><span class="mi">15</span><span class="o">]</span><span class="p">;</span>    <span class="c1"># 3 8 7 6 0 1 3 2 0 8 8 5 8 0 5</span>
</code></pre></div><h3 id="eager">eager</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">method</span> <span class="nb">eager</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
</code></pre></div><p>æ€¥åˆ‡åœ°è®¡ç®—åˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ , å¹¶è¿”å›è°ƒç”¨è€…ã€‚å¦‚æœåˆ—è¡¨æ ‡ç¤ºå®ƒæ˜¯ &ldquo;konw inifinite&rdquo; çš„, æ€¥åˆ‡æ±‚å€¼å¯ä»¥åœæ­¢åœ¨æ¢æµ‹åˆ°çš„æ— é™çš„ç‚¹ä¸Šã€‚</p>
<h3 id="reverse">reverse</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span>    <span class="nb">reverse</span><span class="p">(</span><span class="o">*</span><span class="nv">@list</span> <span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">reverse</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
</code></pre></div><p>ä»¥ç›¸åçš„é¡ºåºè¿”å›ä¸€ä¸ªå«æœ‰ç›¸åŒå…ƒç´ çš„åˆ—è¡¨ã€‚
æ³¨æ„ <code>reverse</code> æ€»æ˜¯æŒ‡åè½¬åˆ—è¡¨ä¸­çš„å…ƒç´ , å¦‚æœä½ æƒ³åè½¬å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦, é‚£ä¹ˆä½¿ç”¨ flipã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&lt;</span><span class="s">hello world!</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">reverse</span>      <span class="c1">#  world! hello</span>
<span class="nb">say</span> <span class="nb">reverse</span> <span class="o">^</span><span class="mi">10</span>                 <span class="c1"># 9 8 7 6 5 4 3 2 1 0</span>
</code></pre></div><h3 id="rotate">rotate</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span>    <span class="nb">rotate</span><span class="p">(</span><span class="nv">@list</span><span class="o">,</span>  <span class="nb">Int:D</span> <span class="nv">$n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">rotate</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span> <span class="nb">Int:D</span> <span class="nv">$n</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
</code></pre></div><p>ä»¥ <code>$n</code> ä¸ªå…ƒç´ æ—‹è½¬åˆ—è¡¨, è¿™æŠŠåŸåˆ—è¡¨åˆ†æˆä¸¤éƒ¨åˆ†, æ—‹è½¬ä¸­å¿ƒå°±æ˜¯åœ¨è¿™ä¸¤éƒ¨åˆ†ä¹‹é—´:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">&lt;</span><span class="s">a b c d e</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">rotate</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>   <span class="c1"># &lt;c d e a b&gt;</span>
<span class="p">&lt;</span><span class="s">a b c d e</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">rotate</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>  <span class="c1"># &lt;e a b c d&gt;</span>
</code></pre></div><h3 id="sort">sort</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span>    <span class="nb">sort</span><span class="p">(</span><span class="o">*</span><span class="nv">@elems</span><span class="p">)</span>      <span class="k">returns</span> <span class="nb">List:D</span>
<span class="k">multi</span> <span class="k">sub</span>    <span class="nb">sort</span><span class="p">(</span><span class="nv">&amp;by</span><span class="o">,</span> <span class="o">*</span><span class="nv">@elems</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">sort</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span><span class="p">)</span>      <span class="k">returns</span> <span class="nb">List:D</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">sort</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:,</span> <span class="nv">&amp;by</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
</code></pre></div><p>åˆ—è¡¨æ’åº, æœ€å°çš„å…ƒç´ é¦–å…ˆã€‚é»˜è®¤ä½¿ç”¨ <code>infix:&lt;cmp&gt;</code> æ’åºåˆ—è¡¨ä¸­çš„å…ƒç´ ã€‚</p>
<p>å¦‚æœæä¾›äº† <code>&amp;by</code>, é‚£ä¹ˆå®ƒæ¥æ”¶ä¸¤ä¸ªå‚æ•°, å®ƒç”±åˆ—è¡¨å…ƒç´ å¯¹å„¿è°ƒç”¨, å¹¶ä¸”åº”è¯¥è¿”å› <code>Order::Increase</code>, <code>Order::Same</code> æˆ– <code>Order::Decrease</code>ã€‚</p>
<p>å¦‚æœ <code>&amp;by</code> åªæ¥å—ä¸€ä¸ªå‚æ•°, é‚£ä¹ˆåˆ—è¡¨å…ƒç´ æ˜¯é€šè¿‡ <code>by($a) cmp by($b)</code> æ¥æ’åºçš„ã€‚<code>&amp;by</code> çš„è¿”å›å€¼è¢«ç¼“å­˜èµ·æ¥, ä»¥ä½¿æ¯ä¸ªåˆ—è¡¨å…ƒç´ åªè°ƒç”¨ä¸€æ¬¡ <code>&amp;by</code>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">(</span><span class="mi">3</span><span class="o">,</span> <span class="o">-</span><span class="mi">4</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="nb">sort</span><span class="p">;</span>                  <span class="c1"># -4 -1 0 2 3 7</span>
<span class="nb">say</span> <span class="p">(</span><span class="mi">3</span><span class="o">,</span> <span class="o">-</span><span class="mi">4</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="nb">sort</span><span class="o">:</span> <span class="o">*.</span><span class="nb">abs</span><span class="p">;</span>           <span class="c1"># 0 -1 2 3 -4 7</span>
<span class="nb">say</span> <span class="p">(</span><span class="mi">3</span><span class="o">,</span> <span class="o">-</span><span class="mi">4</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="nb">sort</span><span class="o">:</span> <span class="p">{</span> <span class="nv">$^b</span> <span class="ow">leg</span> <span class="nv">$^a</span> <span class="p">};</span> <span class="c1"># 7 3 2 0 -4 -1</span>
</code></pre></div><h3 id="reduce">reduce</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span>    <span class="nb">reduce</span><span class="p">(</span><span class="nv">&amp;with</span><span class="o">,</span> <span class="o">*</span><span class="nv">@elems</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">reduce</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span> <span class="nv">&amp;with</span><span class="p">)</span>
</code></pre></div><p>æŠŠ <code>&amp;with</code> åº”ç”¨åˆ°åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå€¼ä¸Š, ç„¶åæŠŠ <code>&amp;with</code> åº”ç”¨åˆ°é‚£ä¸ªè®¡ç®—çš„ç»“æœå€¼å’Œç¬¬ä¸‰ä¸ªå€¼ä¸Š, ä»¥æ­¤ç±»æ¨ã€‚æŒ‰ç…§é‚£ç§æ–¹å¼ç”Ÿæˆå•ä¸ªé¡¹ã€‚</p>
<p>æ³¨æ„ <code>reduce</code> æ˜¯ä¸€ä¸ªéšå¼çš„å¾ªç¯ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="nb">reduce</span><span class="o">:</span> <span class="o">*</span> <span class="o">-</span> <span class="o">*</span><span class="p">;</span> <span class="c1"># -4</span>
</code></pre></div><h3 id="splice">splice</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span>    <span class="nb">splice</span><span class="p">(</span><span class="nv">@list</span><span class="o">,</span>  <span class="nv">$start</span><span class="o">,</span> <span class="nv">$elems</span><span class="o">?,</span> <span class="o">*</span><span class="nv">@replacement</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">splice</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span> <span class="nv">$start</span><span class="o">,</span> <span class="nv">$elems</span><span class="o">?,</span> <span class="o">*</span><span class="nv">@replacement</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
</code></pre></div><p>ä»åˆ—è¡¨ä¸­åˆ é™¤ä» <code>$start</code> ç´¢å¼•å¼€å§‹çš„ <code>$elems</code> ä¸ªå…ƒç´ , è¿”å›åˆ é™¤çš„å…ƒç´ å¹¶ç”¨ <code>@replacement</code> æ¥ä»£æ›¿å®ƒã€‚å¦‚æœçœç•¥äº† <code>$elems</code>, æ‰€æœ‰ä» <code>$index</code> å¼€å§‹çš„å…ƒç´ éƒ½è¢«åˆ é™¤ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@foo</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">a b c d e f g</span><span class="p">&gt;;</span>
<span class="nb">say</span> <span class="nv">@foo</span><span class="o">.</span><span class="nb">splice</span><span class="p">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="p">&lt;</span><span class="s">M N O P</span><span class="p">&gt;);</span> <span class="c1"># c d e</span>
<span class="nb">say</span> <span class="nv">@foo</span><span class="p">;</span>                         <span class="c1"># a b M N O P f g</span>
</code></pre></div><h3 id="pop">pop</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span>    <span class="nb">pop</span><span class="p">(</span><span class="nb">List:D</span> <span class="p">)</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">pop</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span><span class="p">)</span>
</code></pre></div><p>ä»åˆ—è¡¨ä¸­ç§»é™¤å¹¶è¿”å›æœ€åä¸€é¡¹ã€‚å¦‚æœåˆ—è¡¨ä¸ºç©ºåˆ™å¤±è´¥ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">&gt;</span> <span class="k">my</span> <span class="nv">@foo</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">a b</span><span class="p">&gt;;</span>
<span class="o">&gt;</span> <span class="nv">@foo</span><span class="o">.</span><span class="nb">pop</span><span class="p">;</span>  <span class="c1"># b</span>
<span class="o">&gt;</span> <span class="nb">pop</span> <span class="nv">@foo</span>   <span class="c1"># a</span>
<span class="o">&gt;</span> <span class="nb">pop</span> <span class="nv">@foo</span>   <span class="c1"># Element popped from empty list</span>
</code></pre></div><h3 id="push">push</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span>    <span class="nb">push</span><span class="p">(</span><span class="nb">List:D</span><span class="o">,</span> <span class="o">*</span><span class="nv">@values</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">push</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span> <span class="o">*</span><span class="nv">@values</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
</code></pre></div><p>æŠŠ <code>@values</code> æ·»åŠ åˆ°åˆ—è¡¨çš„æœ«å°¾, å¹¶è¿”å›ä¿®æ”¹åçš„åˆ—è¡¨ã€‚ å¦‚æœåˆ—è¡¨æ˜¯æ— é™åˆ—è¡¨åˆ™å¤±è´¥ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@foo</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;;</span>
<span class="nv">@foo</span><span class="o">.</span><span class="nb">push</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">3</span> <span class="o">...</span> <span class="mi">11</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">@foo</span><span class="p">;</span>                   <span class="c1"># a b c 1 3 5 7 9 11</span>
</code></pre></div><h3 id="shift">shift</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span>    <span class="nb">shift</span><span class="p">(</span><span class="nb">List:D</span> <span class="p">)</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">shift</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span><span class="p">)</span>
</code></pre></div><p>ä»åˆ—è¡¨ä¸­ç§»é™¤å¹¶è¿”å›ç¬¬ä¸€é¡¹å…ƒç´ ã€‚å¦‚æœåˆ—è¡¨ä¸ºç©ºåˆ™å¤±è´¥ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@foo</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">a b</span><span class="p">&gt;;</span>
<span class="nb">say</span> <span class="nv">@foo</span><span class="o">.</span><span class="nb">shift</span><span class="p">;</span>     <span class="c1"># a</span>
<span class="nb">say</span> <span class="nv">@foo</span><span class="o">.</span><span class="nb">shift</span><span class="p">;</span>     <span class="c1"># b</span>
<span class="nb">say</span> <span class="nv">@foo</span><span class="o">.</span><span class="nb">shift</span><span class="p">;</span>     <span class="c1"># Element shifted from empty list</span>
</code></pre></div><h3 id="unshift">unshift</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span>    <span class="nb">unshift</span><span class="p">(</span><span class="nb">List:D</span><span class="o">,</span> <span class="o">*</span><span class="nv">@values</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">unshift</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span> <span class="o">*</span><span class="nv">@values</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
</code></pre></div><p>æ·»åŠ  <code>@values</code> åˆ°åˆ—è¡¨çš„å¼€å¤´, å¹¶è¿”å›ä¿®æ”¹åçš„åˆ—è¡¨ã€‚å¦‚æœåˆ—è¡¨æ˜¯æ— é™åˆ—è¡¨åˆ™å¤±è´¥ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@foo</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;;</span>
<span class="nv">@foo</span><span class="o">.</span><span class="nb">unshift</span><span class="o">:</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">3</span> <span class="o">...</span> <span class="mi">11</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">@foo</span><span class="p">;</span> <span class="c1"># 1 3 5 7 9 11 a b c</span>
</code></pre></div><h5 id="combinations">combinations</h5>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">method</span> <span class="nb">combinations</span> <span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span> <span class="nb">Int:D</span> <span class="nv">$of</span><span class="p">)</span>          <span class="k">returns</span> <span class="nb">List:D</span>
<span class="k">multi</span> <span class="k">method</span> <span class="nb">combinations</span> <span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span> <span class="nb">Range:D</span> <span class="nv">$of</span> <span class="o">=</span> <span class="mi">0</span><span class="o">..*</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
<span class="k">multi</span> <span class="k">sub</span>    <span class="nb">combinations</span> <span class="p">(</span><span class="nv">$n</span><span class="o">,</span> <span class="nv">$k</span><span class="p">)</span>                     <span class="k">returns</span> <span class="nb">List:D</span>
</code></pre></div><p>Int å˜ä½“è¿”å›è°ƒç”¨è€…åˆ—è¡¨æ‰€æœ‰çš„ <code>$of-combinations</code> ç»„åˆã€‚ä¾‹å¦‚:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="o">.</span><span class="nb">join</span><span class="p">(&#39;</span><span class="s1">|</span><span class="p">&#39;)</span> <span class="k">for</span> <span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">combinations</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</code></pre></div><p>æ‰“å°</p>
<pre><code>a|b
a|c
b|c
</code></pre><p>å› ä¸º  &lsquo;a&rsquo;, &lsquo;b&rsquo;, &lsquo;c&rsquo; çš„æ‰€æœ‰ 2-combinations æ˜¯  [&lsquo;a&rsquo;, &lsquo;b&rsquo;], [&lsquo;a&rsquo;, &lsquo;c&rsquo;], [&lsquo;b&rsquo;, &lsquo;c&rsquo;].</p>
<p>Range å˜ä½“æŠŠæ‰€æœ‰å•ç‹¬çš„ç»„åˆç»„åˆåˆ°å•ä¸ªåˆ—è¡¨ä¸­, æ‰€ä»¥:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="o">.</span><span class="nb">join</span><span class="p">(&#39;</span><span class="s1">|</span><span class="p">&#39;)</span> <span class="k">for</span> <span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">combinations</span><span class="p">(</span><span class="mi">2</span><span class="o">..</span><span class="mi">3</span><span class="p">);</span>
</code></pre></div><p>æ‰“å°ï¼š</p>
<pre><code>a|b
a|c
b|c
a|b|c
</code></pre><p>å› ä¸ºé‚£æ˜¯ä¸€ä¸ªæ‰€æœ‰ 2-å’Œ3-combinations ç»„åˆçš„åˆ—è¡¨ã€‚</p>
<p>å­ä¾‹ç¨‹ <code>combinations($n, $k)</code> ç­‰ä»·äº <code>(^$n).combinations($k)</code>, æ‰€ä»¥ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="nb">combinations</span><span class="p">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div><p>æ‰“å°ï¼š</p>
<pre><code>0 1
0 2
0 3
1 2
1 3
2 3
</code></pre><h3 id="permutations">permutations</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">method</span> <span class="nb">permutations</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
<span class="k">multi</span> <span class="k">sub</span>    <span class="nb">permutations</span><span class="p">(</span><span class="nv">$n</span><span class="p">)</span>      <span class="k">returns</span> <span class="nb">List:D</span>
</code></pre></div><p>è¿”å›åˆ—è¡¨æ‰€æœ‰å¯èƒ½çš„ç»„åˆä½œä¸ºæ•°ç»„çš„åˆ—è¡¨ã€‚æ‰€ä»¥:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="o">.</span><span class="nb">join</span><span class="p">(&#39;</span><span class="s1">|</span><span class="p">&#39;)</span> <span class="k">for</span> <span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">permutations</span>
</code></pre></div><p>æ‰“å°ï¼š</p>
<pre><code>a|b|c
a|c|b
b|a|c
b|c|a
c|a|b
c|b|a
</code></pre><p><code>permutations</code> æŠŠæ‰€æœ‰åˆ—è¡¨å…ƒç´ å½“ä½œå¯åŒºåˆ«çš„, æ‰€ä»¥ <code>(1, 1, 2).permutations</code> ä»æ—§è¿”å› 6 ä¸ªå…ƒç´ çš„åˆ—è¡¨, å³ä½¿åªæœ‰ 3 ä¸ªä¸åŒçš„æ’åˆ—ã€‚</p>
<p><code>permutations($n)</code> ç­‰ä»·äº <code>(^$n).permutations</code>, æ‰€ä»¥:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="nb">permutations</span> <span class="mi">3</span><span class="p">;</span>
</code></pre></div><p>æ‰“å°ï¼š</p>
<pre><code>1 2 3
1 3 2
2 1 3
2 3 1
3 1 2
3 2 1
</code></pre>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku Blogs]]></title>
            <link href="https://ohmyweekly.github.io/notes/2016-01-01-raku-blogs/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2016-01-01-raku-blogs/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Raku Blogs</blockquote><p>æ”¶é›† Raku æ–¹é¢çš„åšæ–‡å¦‚ä¸‹:</p>
<ul>
<li><a href="https://my.oschina.net/u/563463/blog/293900">Raku çš„ Grammar å­¦ä¹ æ€»ç»“</a></li>
<li><a href="https://my.oschina.net/u/563463/blog/293590">Raku çš„æ­£åˆ™è¡¨è¾¾å¼</a></li>
<li><a href="https://my.oschina.net/u/563463/blog/371597">Raku çš„æ­£åˆ™è¡¨è¾¾å¼</a></li>
<li><a href="https://my.oschina.net/u/563463/blog/392467">Perl  6 çš„åˆ—è¡¨</a></li>
<li><a href="https://my.oschina.net/u/563463/blog/391975">Raku çš„å­—ç¬¦ä¸²</a></li>
<li><a href="https://www.oschina.net/code/snippet_2531803_53480">Raku URB è§£æ</a></li>
<li><a href="https://www.oschina.net/code/snippet_2531803_53641">Raku æ ¼å¼åŒ–å¸®åŠ©ä¿¡æ¯</a></li>
<li><a href="https://www.oschina.net/code/snippet_2531803_53146">Raku è§£å†³ 24 Game</a></li>
<li><a href="https://www.oschina.net/code/snippet_2531803_53623">Raku ç¥çš„90äº¿åå­—æ•´æ•°ç‰ˆ</a></li>
<li><a href="https://www.oschina.net/code/snippet_2531803_52457">Raku è®¡ç®—çŸ©é˜µå æ¯”</a></li>
<li><a href="https://www.oschina.net/code/snippet_2531803_52932">Raku 24æ¸¸æˆ</a></li>
<li><a href="https://www.oschina.net/code/snippet_2531803_53446">Raku temporary</a></li>
<li><a href="https://www.oschina.net/code/snippet_2531803_52338">Raku æ‹¬å·åŒ¹é…</a></li>
<li><a href="https://www.oschina.net/code/snippet_2531803_52655">Raku ä¸Šä¼ æ–‡ä»¶</a></li>
<li><a href="https://segmentfault.com/a/1190000004679283">è¯‘ Raku Object Orientation</a></li>
<li><a href="https://segmentfault.com/a/1190000004864391">è¯‘ Native Calling Interface</a></li>
<li><a href="https://segmentfault.com/a/1190000004957515">è¯‘ Raku 5to6-nutshell</a></li>
<li><a href="https://segmentfault.com/n/1330000004436212">Raku æ‹¬å·çš„åŒ¹é…</a></li>
<li><a href="https://segmentfault.com/n/1330000004493136">ç¥çš„90äº¿åå­—æ•´æ•°ç‰ˆ</a></li>
<li><a href="https://segmentfault.com/n/1330000004541894">Raku æ­£åˆ™æ›¿æ¢</a></li>
<li><a href="https://segmentfault.com/n/1330000004616224">Raku ç´¯åŠ å™¨å·¥å‚</a></li>
<li><a href="https://segmentfault.com/n/1330000004897576">Raku IEEE754</a></li>
<li><a href="https://segmentfault.com/n/1330000004929301">Raku usbip è‡ªåŠ¨ bind</a></li>
<li><a href="https://segmentfault.com/n/1330000004957503">Raku 5to6-perlfunc</a></li>
<li><a href="https://segmentfault.com/n/1330000004975097">Raku GetOption</a></li>
<li><a href="https://segmentfault.com/n/1330000005053516">Raku Search Binary-Tree node</a></li>
<li><a href="https://segmentfault.com/n/1330000005053546">Raku Getopt::Kinoko</a></li>
</ul>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/blog" term="blog" label="blog" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku Grammars]]></title>
            <link href="https://ohmyweekly.github.io/notes/2016-02-05-raku-grammars/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2015-11-16-a-mutable-grammar-for-raku/?utm_source=atom_feed" rel="related" type="text/html" title="A Mutable Grammar for Raku" />
                <link href="https://ohmyweekly.github.io/notes/2016-01-01-raku-core-hacking-grammatical-babble/?utm_source=atom_feed" rel="related" type="text/html" title="Raku æ ¸å¿ƒé­”æ”¹: Grammar çš„èƒ¡è¨€ä¹±è¯­" />
                <link href="https://ohmyweekly.github.io/notes/2015-04-27-from-regex-to-grammar-part-one/?utm_source=atom_feed" rel="related" type="text/html" title="ä»æ­£åˆ™è¡¨è¾¾å¼åˆ° Grammar(ç¬¬ä¸€éƒ¨åˆ†)" />
                <link href="https://ohmyweekly.github.io/notes/2015-10-29-from-regex-to-grammar/?utm_source=atom_feed" rel="related" type="text/html" title="ä»æ­£åˆ™è¡¨è¾¾å¼åˆ° Grammar(ç¬¬äºŒéƒ¨åˆ†)" />
                <link href="https://ohmyweekly.github.io/notes/2015-07-11-an-example-of-parsing-text-in-grammar/?utm_source=atom_feed" rel="related" type="text/html" title="ä½¿ç”¨ Grammar è§£ææ–‡æœ¬: ä¸€ä¸ªä¾‹å­" />
            
                <id>https://ohmyweekly.github.io/notes/2016-02-05-raku-grammars/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Raku Grammars</blockquote><h1 id="grammarshttpdocrakuorglanguagegrammars"><a href="http://doc.raku.org/language/grammars">Grammars</a></h1>
<p>Grammars - ä¸€ç»„å…·å regexes ç»„æˆæ­£å¼çš„ grammar</p>
<p>Grammars æ˜¯ä¸€ä¸ªå¾ˆå¼ºå¤§çš„å·¥å…·ç”¨äºææ„æ–‡æœ¬å¹¶é€šå¸¸è¿”å›æ•°æ®ç»“æ„ã€‚</p>
<p>ä¾‹å¦‚, Raku æ˜¯ä½¿ç”¨ Raku é£æ ¼ grammar è§£æå¹¶æ‰§è¡Œçš„ã€‚</p>
<p>å¯¹æ™®é€š Raku ä½¿ç”¨è€…æ›´å®ç”¨çš„ä¸€ä¸ªä¾‹å­æ˜¯ <a href="https://github.com/moritz/json">JSON::Tiny</a>æ¨¡å—, å®ƒèƒ½ååºåˆ—åŒ–ä»»ä½•åˆæ³•çš„ JSON æ–‡ä»¶, è€Œååºåˆ—ä»£ç åªæœ‰ä¸åˆ° 100 è¡Œ, è¿˜èƒ½æ‰©å±•ã€‚</p>
<p>Grammars å…è®¸ä½ æŠŠ regexes ç»„ç»‡åˆ°ä¸€å—å„¿, å°±åƒç±»(class) ä¸­ç»„ç»‡æ–¹æ³•é‚£æ ·ã€‚</p>
<h2 id="å…·åæ­£åˆ™-named-regexes">å…·åæ­£åˆ™ (Named Regexes)</h2>
<p>ã€€
grammars çš„ä¸»è¦ç»„æˆéƒ¨åˆ†æ˜¯ <a href="http://doc.raku.org/language/regexes">regexes</a>ã€‚ è€Œ Raku çš„ <a href="http://doc.raku.org/language/regexes">regexes</a>è¯­æ³•ä¸åœ¨è¯¥æ–‡æ¡£çš„è®¨è®ºèŒƒå›´, å…·åæ­£åˆ™(named regexes) æœ‰å®ƒè‡ªå·±çš„ç‰¹æ®Šè¯­æ³•, è¿™è·Ÿå­ä¾‹ç¨‹(subroutine) çš„å®šä¹‰å¾ˆåƒ:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="k">regex</span> <span class="nf">number</span> <span class="p">{</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="sr"> </span><span class="p">[</span><span class="sr"> \</span><span class="ni">.</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="sr"> </span><span class="p">]</span><span class="o">?</span><span class="sr">   </span><span class="p">}</span>   <span class="c1"># æ™®é€š regex ä¸­ç©ºæ ¼è¢«å¿½ç•¥, [] æ˜¯éæ•è·ç»„</span>
</code></pre></div><p>ä¸Šé¢çš„ä»£ç ä½¿ç”¨ <code>my</code> å…³é”®å­—æŒ‡å®šäº†æœ¬åœ°ä½œç”¨åŸŸçš„ regex, å› ä¸ºå…·åæ­£åˆ™(named regexes) é€šå¸¸ç”¨åœ¨ grammars é‡Œé¢ã€‚</p>
<p>æ­£åˆ™æœ‰åå­—äº†å°±æ–¹ä¾¿æˆ‘ä»¬åœ¨ä»»ä½•åœ°æ–¹é‡ç”¨é‚£ä¸ªæ­£åˆ™äº†:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">32.51</span><span class="p">&#34;</span> <span class="o">~~</span> <span class="nv">&amp;number</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">15 + 4.5</span><span class="p">&#34;</span> <span class="o">~~</span> <span class="p">/</span><span class="sr">  </span><span class="se">\s</span><span class="o">*</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\s</span><span class="o">*</span><span class="sr">  </span><span class="p">/</span>
<span class="nv">&amp;number</span>           <span class="c1"># my regex number { \d+ [ \. \d+ ]?   }  </span>
</code></pre></div><p>ä¸ºä»€ä¹ˆç”¨ <code>&amp;number</code>, å¯¹æ¯”å…·åå­ä¾‹ç¨‹ä½ å°±çŸ¥é“äº†:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">&gt;</span> <span class="k">sub</span> <span class="nf">number</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">i am a subroutine</span><span class="p">&#34;</span> <span class="p">}</span>  <span class="c1"># å…·åå­ä¾‹ç¨‹</span>
<span class="o">&gt;</span> <span class="nv">&amp;number</span>                                 <span class="c1"># sub number () { #`(Sub|140651249646256) ... }</span>
</code></pre></div><p><code>&amp;number</code> å°±æ˜¯ç›´æ¥å¼•ç”¨äº†å…·åçš„ regex æˆ– å­ä¾‹ç¨‹ã€‚è€Œåœ¨ <code>/ /</code> æˆ– grammars é‡Œé¢, å¼•ç”¨ä¸€ä¸ªå…·åæ­£åˆ™çš„è¯­æ³•ä¹Ÿå¾ˆç‰¹æ®Š, å°±æ˜¯ç»™åå­—åŒ…è£¹ä¸Š <code>&lt; &gt;</code>ã€‚<code>&lt;&gt;</code> å°±åƒå¼•å·é‚£æ ·, å½“ç”¨å®ƒå¼•èµ·æŸä¸ªå…·åæ­£åˆ™å, å¼•ç”¨è¿™ä¸ª <code>&lt;&gt;</code> å°±ä¼šæŠŠè¯¥å…·åæ­£åˆ™æ’å…¥(å¸¦å…¥)åˆ°æ•´ä¸ªæ­£åˆ™ä¹‹ä¸­, å°±åƒå­—ç¬¦ä¸²æ’å€¼é‚£æ ·ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># å…·åæ­£åˆ™çš„å£°æ˜</span>
<span class="k">my</span> <span class="k">regex</span> <span class="nf">number</span> <span class="p">{</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="sr"> </span><span class="p">[</span><span class="sr"> \</span><span class="ni">.</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="p">]</span><span class="o">?</span><span class="sr"> </span><span class="p">}</span>  
<span class="k">my</span> <span class="k">token</span> <span class="nf">ident</span>  <span class="p">{</span><span class="sr"> </span><span class="se">\w</span><span class="o">+</span><span class="sr">            </span><span class="p">}</span>
<span class="k">my</span> <span class="k">rule</span>  <span class="nf">alpha</span>  <span class="p">{</span><span class="sr"> </span><span class="p">&lt;[</span><span class="sr">A</span><span class="o">..</span><span class="sr">Za</span><span class="o">..</span><span class="sr">z</span><span class="p">]&gt;</span><span class="sr">   </span><span class="p">}</span>

<span class="c1"># 1.0 é€šè¿‡ &amp; æ¥å¼•ç”¨</span>
<span class="nb">say</span> <span class="nb">so</span> <span class="p">&#34;</span><span class="s2">12.34</span><span class="p">&#34;</span> <span class="o">~~</span> <span class="nv">&amp;number</span><span class="p">;</span> <span class="c1"># true</span>

<span class="c1"># 2.0 åœ¨æ­£åˆ™æ„é€  // é‡Œä½¿ç”¨</span>
<span class="nb">say</span> <span class="nb">so</span> <span class="p">&#34;</span><span class="s2">12.88 + 0.12</span><span class="p">&#34;</span> <span class="o">~~</span> <span class="p">/</span><span class="sr">  </span><span class="se">\s</span><span class="o">*</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\s</span><span class="o">*</span><span class="sr">  </span><span class="p">/;</span> <span class="c1"># true</span>
<span class="c1"># say so &#34;12.88 + 0.12&#34; ~~ /  \s* &#39;+&#39; \s*  /;</span>
<span class="c1"># wrong, method &#39;number&#39; not found for invocant of class &#39;Cursor&#39;</span>

<span class="c1"># 3.0 åœ¨ grammar é‡Œé¢ä½¿ç”¨</span>
<span class="k">grammar</span> <span class="nc">EquationParse</span> <span class="p">{</span>
    <span class="c1"># è¿™é‡Œä¹Ÿä¸èƒ½ç»™ number èµ·åˆ«å, é™¤é number æ˜¯åœ¨ grammar å†…éƒ¨å£°æ˜çš„</span>
    <span class="k">token</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr">  </span><span class="se">\s</span><span class="o">*</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\s</span><span class="o">*</span><span class="sr">  </span><span class="se">\s</span><span class="o">*</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\s</span><span class="o">*</span><span class="sr">  }
</span><span class="sr">}
</span><span class="sr">
</span><span class="sr"></span><span class="c1"># ç­‰å¼è§£æ
</span><span class="c1"></span><span class="sr">my </span><span class="nv">$expr</span><span class="sr"> </span><span class="o">=</span><span class="sr"> EquationParse</span><span class="ni">.</span><span class="sr">parse</span><span class="p">(&#34;</span><span class="s2">12.88 + 0.12 = 13.00</span><span class="p">&#34;)</span><span class="sr">;
</span><span class="sr">say </span><span class="nv">$expr</span><span class="sr">;
</span></code></pre></div><p>å£°æ˜å…·åæ­£åˆ™ä¸æ˜¯åªæœ‰ä¸€ä¸ª <code>regex</code> å£°æ˜ç¬¦, å®é™…ä¸Š , regex å£°æ˜ç¬¦ç”¨çš„æœ€å°‘, å¤§å¤šæ•°æ—¶å€™, éƒ½æ˜¯ä½¿ç”¨ <code>token</code> æˆ– <code>rule</code> å£°æ˜ç¬¦ã€‚token å’Œ rule è¿™ä¸¤ä¸ªéƒ½æ˜¯ <code>ratcheing</code> (æ£˜è½®)çš„, è¿™æ„å‘³ç€å¦‚æœåŒ¹é…å¤±è´¥, é‚£ä¹ˆåŒ¹é…å¼•æ“å°±ä¸ä¼šå›å¹¶å°è¯•åŒ¹é…äº†ã€‚è¿™é€šå¸¸ä¼šæ˜¯ä½ æƒ³è¦çš„, ä½†ä¸é€‚ç”¨äºæ‰€æœ‰æƒ…å†µ:</p>
<blockquote>
<p>æ£˜è½®ç”¨äºå•å‘é©±åŠ¨, é˜²æ­¢é€†è½¬ã€‚</p>
</blockquote>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="k">regex</span> <span class="nf">works-but-slow</span> <span class="p">{</span><span class="sr"> </span><span class="ni">.</span><span class="o">+</span><span class="sr"> q </span><span class="p">}</span> <span class="c1"># å¯èƒ½ä¼šå›æº¯</span>
<span class="k">my</span> <span class="k">token</span> <span class="nf">fails-but-fast</span> <span class="p">{</span><span class="sr"> </span><span class="ni">.</span><span class="o">+</span><span class="sr"> q </span><span class="p">}</span> <span class="c1"># ä¸å›æº¯</span>
<span class="k">my</span> <span class="nv">$s</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">Tokens and rules won\&#39;t backtrack, which makes them fail quicker!</span><span class="p">&#39;;</span>

<span class="nb">say</span> <span class="nb">so</span> <span class="nv">$s</span> <span class="o">~~</span> <span class="nv">&amp;works-but-slow</span><span class="p">;</span> <span class="c1"># True</span>
<span class="nb">say</span> <span class="nb">so</span> <span class="nv">$s</span> <span class="o">~~</span> <span class="nv">&amp;fails-but-fast</span><span class="p">;</span> <span class="c1"># False, .+ å¾—åˆ°äº†æ•´ä¸ªå­—ç¬¦ä¸²ä½†ä¸å›æº¯</span>
</code></pre></div><p><code>token</code> å’Œ <code>rule</code> çš„å”¯ä¸€åŒºåˆ«å°±æ˜¯ <code>rule</code> å£°æ˜ç¬¦ä¼šè®©æ­£åˆ™ä¸­çš„ <code>:sigspace</code> ä¿®é¥°ç¬¦èµ·æ•ˆ:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="k">token</span> <span class="nf">non-space-y</span> <span class="p">{</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">once</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">upon</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">time</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">}</span>
<span class="k">my</span> <span class="k">rule</span> <span class="nf">space-y</span> <span class="p">{</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">once</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">upon</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">time</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">}</span>

<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">onceuponatime</span><span class="p">&#39;</span>    <span class="o">~~</span> <span class="nv">&amp;non-space-y</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">once upon a time</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="nv">&amp;space-y</span><span class="p">;</span>
</code></pre></div><h2 id="åˆ›å»º-grammar">åˆ›å»º Grammar</h2>
<p>ã€€
å½“ä½¿ç”¨ grammar å…³é”®å­—è€Œé class å…³é”®å­—å£°æ˜æ¥å£°æ˜ä¸€ä¸ªç±»æ—¶, ä¼šè‡ªåŠ¨å¾—åˆ°ä»¥ <a href="https://docs.raku.org/type/Grammar">Grammar</a> çš„çˆ¶ç±»ã€‚Grammars åº”è¯¥åªç”¨äºè§£ææ–‡æœ¬; å¦‚æœä½ æƒ³æå–å¤æ‚çš„æ•°æ®, æ¨è <a href="http://doc.raku.org/language/grammars#Action_Objects">action object</a>å’Œ grammar ä¸€å—ä½¿ç”¨ã€‚</p>
<h3 id="proto-regexes">Proto regexes</h3>
<p><a href="https://docs.raku.org/type/Grammar">Grammars</a> ç”± rulesï¼Œtoken å’Œ regexes ç»„æˆ; ä»–ä»¬å®é™…ä¸Šæ˜¯æ–¹æ³•ï¼Œå› ä¸º grammars æ˜¯ç±»ã€‚è¿™äº›æ–¹æ³•å¯ä»¥å…±äº«ä¸€ä¸ªå…±åŒçš„åç§°å’ŒåŠŸèƒ½ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ <a href="https://docs.raku.org/syntax/proto">proto</a>ã€‚</p>
<p>å¦‚æœä½ æœ‰å¾ˆå¤šå¤‡é€‰åˆ†æ”¯(alternations), é‚£ä¹ˆç”Ÿæˆå¯è¯»æ€§å¥½çš„ä»£ç æˆ–å­ç±»åŒ–(subclass)ä½ çš„ grammar å¯èƒ½ä¼šå˜å¾—å¾ˆå›°éš¾ã€‚åœ¨ä¸‹é¢çš„ <code>Actions</code> ç±»ä¸­, <code>TOP</code> æ–¹æ³•ä¸­çš„ä¸‰å…ƒæ“ä½œç¬¦å¹¶ä¸ç†æƒ³, å¹¶ä¸”å½“æˆ‘ä»¬æ·»åŠ çš„æ“ä½œè¶Šå¤š, å®ƒå°±å˜å¾—è¶Šç³Ÿç³•:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">grammar</span> <span class="nc">Calculator</span> <span class="p">{</span>
    <span class="k">token</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr"> </span><span class="p">[</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">add</span><span class="p">&gt;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">sub</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">]</span><span class="sr"> </span><span class="p">}</span>
    <span class="k">rule</span>  <span class="nf">add</span> <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">num</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">num</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">}</span>
    <span class="k">rule</span>  <span class="nf">sub</span> <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">num</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">num</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">}</span>
    <span class="k">token</span> <span class="nf">num</span> <span class="p">{</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="sr"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Calculations</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">TOP</span> <span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> <span class="k">make</span> <span class="nv">$&lt;add&gt;</span> <span class="o">??</span> <span class="nv">$&lt;add&gt;</span><span class="o">.</span><span class="k">made</span> <span class="o">!!</span> <span class="nv">$&lt;sub&gt;</span><span class="o">.</span><span class="k">made</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">method</span> <span class="nb">add</span> <span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> <span class="k">make</span> <span class="o">[+]</span> <span class="nv">$&lt;num&gt;</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">method</span> <span class="k">sub</span> <span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> <span class="k">make</span> <span class="o">[-]</span> <span class="nv">$&lt;num&gt;</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="n">Calculator</span><span class="o">.</span><span class="nb">parse</span><span class="p">(&#39;</span><span class="s1">2 + 3</span><span class="p">&#39;</span><span class="o">,</span> <span class="s">actions</span> <span class="o">=&gt;</span> <span class="n">Calculations</span><span class="p">)</span><span class="o">.</span><span class="k">made</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># 5</span>
</code></pre></div><p>ä¸ºäº†è®©äº‹æƒ…å˜å¾—æ›´å¥½, æˆ‘ä»¬å¯ä»¥åœ¨ tokens èº«ä¸Šä½¿ç”¨çœ‹èµ·æ¥åƒ <code>:sym&lt;...&gt;</code> é‚£æ ·çš„å‰¯è¯æ¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŸå‹(protoregexes):</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">grammar</span> <span class="nc">Calculator</span> <span class="p">{</span>
    <span class="k">token</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">calc-op</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">}</span>

    <span class="k">proto</span> <span class="k">rule</span> <span class="nf">calc-op</span>          <span class="p">{</span><span class="o">*</span><span class="p">}</span>
          <span class="k">rule</span> <span class="nf">calc-op:sym</span>&lt;add&gt; <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">num</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">num</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">}</span>
          <span class="k">rule</span> <span class="nf">calc-op:sym</span>&lt;sub&gt; <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">num</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">num</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">}</span>

    <span class="k">token</span> <span class="nf">num</span> <span class="p">{</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="sr"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Calculations</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">TOP</span>              <span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> <span class="k">make</span> <span class="nv">$&lt;calc-op&gt;</span><span class="o">.</span><span class="k">made</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">method</span> <span class="nf">calc-op:sym</span><span class="p">&lt;</span><span class="s">add</span><span class="p">&gt;</span> <span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> <span class="k">make</span> <span class="o">[+]</span> <span class="nv">$&lt;num&gt;</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">method</span> <span class="nf">calc-op:sym</span><span class="p">&lt;</span><span class="s">sub</span><span class="p">&gt;</span> <span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> <span class="k">make</span> <span class="o">[-]</span> <span class="nv">$&lt;num&gt;</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="n">Calculator</span><span class="o">.</span><span class="nb">parse</span><span class="p">(&#39;</span><span class="s1">2 + 3</span><span class="p">&#39;</span><span class="o">,</span> <span class="s">actions</span> <span class="o">=&gt;</span> <span class="n">Calculations</span><span class="p">)</span><span class="o">.</span><span class="k">made</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># 5</span>
</code></pre></div><p>åœ¨è¿™ä¸ª grammar ä¸­, å¤‡é€‰åˆ†æ”¯(alternation)å·²ç»è¢« <code>&lt;calc-op&gt;</code> æ›¿æ¢æ‰äº†, å®ƒå®è´¨ä¸Šæ˜¯æˆ‘ä»¬å°†è¦åˆ›å»ºçš„ä¸€ç»„å€¼çš„åå­—ã€‚æˆ‘ä»¬é€šè¿‡ä½¿ç”¨ <code>proto rule calc-op</code> å®šä¹‰äº†ä¸€ä¸ª rule åŸå‹ç±»å‹(prototype) æ¥è¾¾æˆã€‚æˆ‘ä»¬ä¹‹å‰çš„æ¯ä¸€ä¸ªå¤‡é€‰åˆ†æ”¯å·²ç»è¢«æ–°çš„ rule <code>calc-op</code> æ›¿æ¢æ‰äº†å¹¶ä¸”å¤‡é€‰åˆ†æ”¯çš„åå­—è¢«é™„åŠ ä¸Šäº† <code>:sym&lt;&gt;</code> å‰¯è¯ã€‚</p>
<p>åœ¨ actions ç±»ä¸­, æˆ‘ä»¬ç°åœ¨æ‘†è„±äº†ä¸‰ç›®æ“ä½œç¬¦, ä»…ä»…åªåœ¨ <code>$&lt;calc-op&gt;</code> åŒ¹é…å¯¹è±¡ä¸Šæ¥æ”¶ <code>.made</code> å€¼ã€‚å¹¶ä¸”å•ç‹¬å¤‡é€‰åˆ†æ”¯çš„ actions ç°åœ¨å’Œ grammar éµå®ˆç›¸åŒçš„å‘½åæ¨¡å¼:  <code>method calc-op:sym&lt;add&gt;</code> å’Œ <code>method calc-op:sym&lt;sub&gt;</code>ã€‚</p>
<p>å½“ä½ å­ç±»åŒ–(subclass)é‚£ä¸ª grammar å’Œ actions ç±»çš„æ—¶å€™æ‰èƒ½çœ‹åˆ°è¿™ä¸ªæ–¹æ³•çš„çœŸæ­£é­…åŠ›ã€‚å‡è®¾æˆ‘ä»¬æƒ³ä¸º calculator å¢åŠ ä¸€ä¸ªä¹˜æ³•åŠŸèƒ½:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">grammar</span> <span class="nc">BetterCalculator</span> <span class="k">is</span> <span class="nc">Calculator</span> <span class="p">{</span>
    <span class="k">rule</span> <span class="nf">calc-op:sym</span>&lt;mult&gt; <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">num</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">*</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">num</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">BetterCalculations</span> <span class="k">is</span> <span class="nc">Calculations</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">calc-op:sym</span><span class="p">&lt;</span><span class="s">mult</span><span class="p">&gt;</span> <span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> <span class="k">make</span> <span class="o">[*]</span> <span class="nv">$&lt;num&gt;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="n">BetterCalculator</span><span class="o">.</span><span class="nb">parse</span><span class="p">(&#39;</span><span class="s1">2 * 3</span><span class="p">&#39;</span><span class="o">,</span> <span class="s">actions</span> <span class="o">=&gt;</span> <span class="n">BetterCalculations</span><span class="p">)</span><span class="o">.</span><span class="k">made</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># 6</span>
</code></pre></div><p>æ‰€æœ‰æˆ‘ä»¬éœ€è¦æ·»åŠ çš„å°±æ˜¯ä¸º <code>calc-op</code> ç»„æ·»åŠ é¢å¤–çš„ rule å’Œ action, æ„Ÿè°¢æ­£åˆ™è¡¨è¾¾å¼åŸå‹(protoregexes), æ‰€æœ‰çš„ä¸œè¥¿éƒ½èƒ½æ­£å¸¸å·¥ä½œã€‚</p>
<h2 id="ç‰¹æ®Šçš„-tokens">ç‰¹æ®Šçš„ Tokens</h2>
<h3 id="top">TOP</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">grammar</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="k">token</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="sr"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p><code>TOP</code> token æ˜¯é»˜è®¤çš„ç¬¬ä¸€ä¸ªå°è¯•å»åŒ¹é…çš„ token , å½“è§£æä¸€ä¸ª grammar çš„æ—¶å€™ - é‚£é¢—æ ‘çš„æ ¹ã€‚æ³¨æ„å¦‚æœä½ æ­£ä½¿ç”¨ <code>.parse</code> æ–¹æ³•è¿›è¡Œè§£æ, é‚£ä¹ˆ token TOP è¢«è‡ªåŠ¨åœ°é”šå®šåˆ°å­—ç¬¦ä¸²çš„å¼€å¤´å’Œç»“å°¾(å†çœ‹çœ‹ <code>.subparse</code>)ã€‚</p>
<p>ä½¿ç”¨ <code>rule TOP</code> æˆ– <code>regex TOP</code> ä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ã€‚</p>
<p>åœ¨ <code>.parse</code>ã€<code>.subparse</code> æˆ– <code>.parsefile</code> Grammar æ–¹æ³•ä¸­ä½¿ç”¨ <code>:rule</code> å‘½åå‚æ•°å¯ä»¥é€‰æ‹©ä¸€ä¸ªä¸åŒçš„ token æ¥è¿›è¡Œé¦–æ¬¡åŒ¹é…ã€‚</p>
<h3 id="ws">ws</h3>
<p>å½“ä½¿ç”¨ <code>rule</code> è€Œé <code>token</code> æ—¶, åŸå­(atom)åé¢çš„ä»»ä½•ç©ºç™½(whitespace)è¢«è½¬æ¢ä¸ºä¸€ä¸ªå¯¹ <code>ws</code> çš„éæ•è·è°ƒç”¨ã€‚å³:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">rule</span> <span class="nf">entry</span> <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">key</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">value</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">}</span>
</code></pre></div><p>ç­‰ä»·äº:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">token</span> <span class="nf">entry</span> <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">key</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">.</span><span class="ow">ws</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">.</span><span class="ow">ws</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">value</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">.</span><span class="ow">ws</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">}</span> <span class="c1"># . = non-capturing</span>
</code></pre></div><p>é»˜è®¤çš„ <code>ws</code> åŒ¹é…&quot;ç©ºç™½&quot;(whitespace), ä¾‹å¦‚ç©ºæ ¼åºåˆ—(ä¸ç®¡ä»€ä¹ˆç±»å‹)ã€æ¢è¡Œç¬¦ã€unspacesã€æˆ– heredocsã€‚</p>
<p>æä¾›ä½ è‡ªå·±çš„ <code>ws</code> token æ˜¯æå¥½çš„:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">grammar</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="k">rule</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr"> </span><span class="se">\d</span><span class="sr"> </span><span class="se">\d</span><span class="sr"> </span><span class="p">}</span>
<span class="p">}</span><span class="o">.</span><span class="nb">parse</span><span class="o">:</span> <span class="p">&#34;</span><span class="s2">4   \n\n 5</span><span class="p">&#34;;</span> <span class="c1"># Succeeds</span>

<span class="k">grammar</span> <span class="nc">Bar</span> <span class="p">{</span>
    <span class="k">rule</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr"> </span><span class="se">\d</span><span class="sr"> </span><span class="se">\d</span><span class="sr"> </span><span class="p">}</span>
    <span class="k">token</span> <span class="nf">ws</span> <span class="p">{</span><span class="sr"> </span><span class="se">\h</span><span class="o">*</span><span class="sr">   </span><span class="p">}</span>
<span class="p">}</span><span class="o">.</span><span class="nb">parse</span><span class="o">:</span> <span class="p">&#34;</span><span class="s2">4   \n\n 5</span><span class="p">&#34;;</span> <span class="c1"># Fails</span>
</code></pre></div><p>ä¸Šé¢çš„ä¾‹å­ä¸­, åœ¨ Bar Gramamr ä¸­é‡å†™äº†è‡ªå·±çš„ <code>ws</code>, åªåŒ¹é…æ°´å¹³ç©ºç™½ç¬¦, æ‰€ä»¥ <code>\n\n</code> åŒ¹é…å¤±è´¥ã€‚</p>
<h3 id="sym">sym</h3>
<p><code>&lt;sym&gt;</code> token å¯ä»¥åœ¨åŸå‹æ­£åˆ™è¡¨è¾¾å¼(proto regex) ä¸­ä½¿ç”¨ï¼Œä»¥åŒ¹é…é‚£ä¸ªç‰¹å®šæ­£åˆ™è¡¨è¾¾å¼çš„ <code>:sym</code> å‰¯è¯çš„å­—ç¬¦ä¸²å€¼ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">grammar</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="k">token</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">letter</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> }
</span><span class="sr">    proto token letter </span><span class="p">{</span><span class="o">*</span><span class="p">}</span><span class="sr">
</span><span class="sr">    token letter</span><span class="p">:</span><span class="na">sym</span><span class="p">&lt;</span><span class="sr">P</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">{</span> <span class="p">&lt;</span><span class="s">sym</span><span class="p">&gt;</span> <span class="p">}</span><span class="sr">
</span><span class="sr">    token letter</span><span class="p">:</span><span class="na">sym</span><span class="p">&lt;</span><span class="sr">e</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">{</span> <span class="p">&lt;</span><span class="s">sym</span><span class="p">&gt;</span> <span class="p">}</span><span class="sr">
</span><span class="sr">    token letter</span><span class="p">:</span><span class="na">sym</span><span class="p">&lt;</span><span class="sr">r</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">{</span> <span class="p">&lt;</span><span class="s">sym</span><span class="p">&gt;</span> <span class="p">}</span><span class="sr">
</span><span class="sr">    token letter</span><span class="p">:</span><span class="na">sym</span><span class="p">&lt;</span><span class="sr">l</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">{</span> <span class="p">&lt;</span><span class="s">sym</span><span class="p">&gt;</span> <span class="p">}</span><span class="sr">
</span><span class="sr">    token letter</span><span class="p">:</span><span class="na">sym</span><span class="p">&lt;</span><span class="sr">*</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">{</span>   <span class="o">.</span>   <span class="p">}</span><span class="sr">
</span><span class="sr">}</span><span class="ni">.</span><span class="sr">parse</span><span class="p">(&#34;</span><span class="s2">I â™¥ Perl</span><span class="p">&#34;</span><span class="sr">, actions </span><span class="o">=</span><span class="p">&gt;</span><span class="sr"> class </span><span class="p">{</span>
    <span class="k">method</span> <span class="nf">TOP</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> <span class="k">make</span> <span class="nv">$&lt;letter&gt;</span><span class="o">.</span><span class="nb">grep</span><span class="p">(</span><span class="o">*.</span><span class="p">&lt;</span><span class="s">sym</span><span class="p">&gt;)</span><span class="o">.</span><span class="nb">join</span> <span class="p">}</span><span class="sr">
</span><span class="sr">}</span><span class="p">)</span><span class="o">.</span><span class="k">made</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span> <span class="c1"># OUTPUT: Â«Perlâ¤Â»</span>
</code></pre></div><p>å½“ä½ å·²ç»å°†åŸå‹æ­£åˆ™è¡¨è¾¾å¼ä¸è¦åŒ¹é…çš„å­—ç¬¦ä¸²åŒºåˆ†å¼€æ¥æ—¶ï¼Œè¿™å¾ˆæ–¹ä¾¿ï¼Œå› ä¸ºä½¿ç”¨ <code>&lt;sym&gt;</code> token å¯é˜²æ­¢é‡å¤è¿™äº›å­—ç¬¦ä¸²ã€‚</p>
<h3 id="æ€»æ˜¯æˆåŠŸæ–­è¨€">æ€»æ˜¯æˆåŠŸæ–­è¨€</h3>
<p><code>&lt;?&gt;</code> is the always succeed assertion(æ€»æ˜¯åŒ¹é…æˆåŠŸ). å½“å®ƒç”¨ä½œ grammar ä¸­çš„ token æ—¶, å®ƒå¯ä»¥è¢«ç”¨äºè§¦å‘ä¸€ä¸ª Action ç±»æ–¹æ³•ã€‚åœ¨ä¸‹é¢çš„ grammar ä¸­, æˆ‘ä»¬æŸ¥æ‰¾é˜¿æ‹‰ä¼¯æ•°å­—å¹¶ä¸”ä½¿ç”¨ <code>always succeed assertion</code> å®šä¹‰ä¸€ä¸ª succ tokenã€‚</p>
<p>åœ¨ action ç±»ä¸­, æˆ‘ä»¬ä½¿ç”¨å¯¹ succ æ–¹æ³•çš„è°ƒç”¨æ¥è®¾ç½®(åœ¨è¿™ä¸ªä¾‹å­ä¸­, æˆ‘ä»¬åœ¨ @!numbers ä¸­å‡†å¤‡äº†ä¸€ä¸ªæ–°å…ƒç´ )ã€‚åœ¨ <code>digit</code> æ–¹æ³•ä¸­, æˆ‘ä»¬æŠŠé˜¿æ‹‰ä¼¯æ•°å­—è½¬æ¢ä¸ºæ¢µæ–‡æ•°å­—å¹¶ä¸”æŠŠå®ƒæ·»åŠ åˆ° @!numbers æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ ä¸­ã€‚å¤šäºäº† <code>succ</code>, æœ€åä¸€ä¸ªå…ƒç´ æ€»æ˜¯å½“å‰æ­£è¢«è§£æçš„ <code>digit</code> æ•°å­—çš„æ•°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">grammar</span> <span class="nc">Digifier</span> <span class="p">{</span>
    <span class="k">rule</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="p">[</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">.</span><span class="nf">succ</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nb">digit</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="p">]</span><span class="o">+</span><span class="sr">
</span><span class="sr">    }
</span><span class="sr">
</span><span class="sr">    token succ   </span><span class="p">{</span> <span class="p">&lt;</span><span class="s">?</span><span class="p">&gt;</span> <span class="p">}</span><span class="sr">
</span><span class="sr">    token digit </span><span class="p">{</span> <span class="p">&lt;</span><span class="s">[0..9]</span><span class="p">&gt;</span> <span class="p">}</span><span class="sr">
</span><span class="sr">}
</span><span class="sr">
</span><span class="sr">class Devanagari </span><span class="p">{</span>
    <span class="k">has</span> <span class="nv">@!numbers</span><span class="p">;</span>

    <span class="k">method</span> <span class="nf">digit</span> <span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> <span class="nv">@!numbers</span><span class="o">[*-</span><span class="mi">1</span><span class="o">]</span> <span class="o">~=</span> <span class="nv">$/</span><span class="o">.</span><span class="nb">ord</span><span class="o">.&amp;[+]</span><span class="p">(</span><span class="mi">2358</span><span class="p">)</span><span class="o">.</span><span class="nb">chr</span> <span class="p">}</span><span class="sr">
</span><span class="sr">    method succ  </span><span class="p">(</span><span class="ni">$</span><span class="p">)</span><span class="sr">  </span><span class="p">{</span> <span class="nv">@!numbers</span><span class="o">.</span><span class="nb">push</span><span class="o">:</span> <span class="p">&#39;&#39;</span>     <span class="p">}</span><span class="sr">
</span><span class="sr">    method TOP   </span><span class="p">(</span><span class="ni">$</span><span class="sr">/</span><span class="p">)</span><span class="sr"> </span><span class="p">{</span> <span class="k">make</span> <span class="nv">@!numbers</span><span class="o">[^</span><span class="p">(</span><span class="o">*-</span><span class="mi">1</span><span class="p">)</span><span class="o">]</span> <span class="p">}</span><span class="sr">
</span><span class="sr">}
</span><span class="sr">
</span><span class="sr">say Digifier</span><span class="ni">.</span><span class="sr">parse</span><span class="p">(&#39;</span><span class="s1">255 435 777</span><span class="p">&#39;</span><span class="sr">, actions </span><span class="o">=</span><span class="p">&gt;</span><span class="sr"> Devanagari</span><span class="ni">.</span><span class="sr">new</span><span class="p">)</span><span class="o">.</span><span class="k">made</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># (à¥¨à¥«à¥« à¥ªà¥©à¥« à¥­à¥­à¥­)</span>
</code></pre></div><h2 id="grammar-ä¸­çš„æ–¹æ³•">Grammar ä¸­çš„æ–¹æ³•</h2>
<p>åœ¨ grammar ä¸­ä½¿ç”¨ <code>method</code> ä»£æ›¿ <code>rule</code> æˆ– <code>token</code> ä¹Ÿæ˜¯å¯ä»¥çš„, åªè¦å®ƒä»¬è¿”å›ä¸€ä¸ª <a href="https://docs.raku.org/type/Cursor">Cursor</a> ç±»å‹:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">grammar</span> <span class="nc">DigitMatcher</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">TOP</span> <span class="p">(</span><span class="o">:</span><span class="nv">$full-unicode</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$full-unicode</span> <span class="o">??</span> <span class="nb">self</span><span class="o">.</span><span class="nf">num-full</span> <span class="o">!!</span> <span class="nb">self</span><span class="o">.</span><span class="nf">num-basic</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">token</span> <span class="nf">num-full</span>  <span class="p">{</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="sr"> </span><span class="p">}</span>
    <span class="k">token</span> <span class="nf">num-basic</span> <span class="p">{</span><span class="sr"> </span><span class="p">&lt;[</span><span class="mi">0</span><span class="o">..</span><span class="mi">9</span><span class="p">]&gt;</span><span class="o">+</span><span class="sr"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>ä¸Šé¢çš„ grammar ä¼šæ ¹æ® parse æ–¹æ³•æä¾›çš„å‚æ•°å°è¯•ä¸åŒçš„åŒ¹é…:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="o">+</span><span class="n">DigitMatcher</span><span class="o">.</span><span class="nb">subparse</span><span class="o">:</span> <span class="p">&#39;</span><span class="s1">12à¥­à¥§à¥­à¥¯à¥¦à¥¯</span><span class="p">&#39;</span><span class="o">,</span> <span class="s">args</span> <span class="o">=&gt;</span> \<span class="p">(:</span><span class="s">full-unicode</span><span class="p">);</span>
<span class="c1"># OUTPUT:</span>
<span class="c1"># 12717909</span>

<span class="nb">say</span> <span class="o">+</span><span class="n">DigitMatcher</span><span class="o">.</span><span class="nb">subparse</span><span class="o">:</span> <span class="p">&#39;</span><span class="s1">12à¥­à¥§à¥­à¥¯à¥¦à¥¯</span><span class="p">&#39;</span><span class="o">,</span> <span class="s">args</span> <span class="o">=&gt;</span> \<span class="p">(:!</span><span class="s">full-unicode</span><span class="p">);</span>
<span class="c1"># OUTPUT:</span>
<span class="c1"># 12</span>
</code></pre></div><h2 id="action-object">Action Object</h2>
<p>ã€€
ä¸€ä¸ªæˆåŠŸçš„ grammar åŒ¹é…ä¼šç»™ä½ ä¸€æ£µåŒ¹é…å¯¹è±¡(Match objects)çš„è§£ææ ‘, åŒ¹é…æ ‘(match tree)åˆ°è¾¾çš„è¶Šæ·±, åˆ™ grammar ä¸­çš„åˆ†æ”¯è¶Šå¤š, é‚£ä¹ˆåœ¨åŒ¹é…æ ‘ä¸­èˆªè¡Œä»¥è·å–ä½ çœŸæ­£æ„Ÿå…´è¶£çš„ä¸œè¥¿å°±å˜çš„è¶Šæ¥è¶Šå›°éš¾ã€‚</p>
<p>ä¸ºäº†é¿å…ä½ åœ¨åŒ¹é…æ ‘(match tree)ä¸­è¿·å¤±, ä½ å¯ä»¥æä¾›ä¸€ä¸ª action objectã€‚grammar ä¸­æ¯æ¬¡è§£ææˆåŠŸä¸€ä¸ªå…·åè§„åˆ™(named rule)ä¹‹å, å®ƒå°±ä¼šå°è¯•è°ƒç”¨ä¸€ä¸ªå’Œè¯¥ grammar rule åŒåçš„æ–¹æ³•, å¹¶ä¼ é€’ç»™è¿™ä¸ªæ–¹æ³•ä¸€ä¸ª<code>Match</code> å¯¹è±¡ä½œä¸ºä½ç½®å‚æ•°ã€‚å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„åŒåæ–¹æ³•, å°±è·³è¿‡ã€‚</p>
<p>è¿™å„¿æœ‰ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ grammar å’Œ actionï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">grammar</span> <span class="nc">TestGrammar</span> <span class="p">{</span>
    <span class="k">token</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr"> </span><span class="ni">^</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="sr"> </span><span class="ni">$</span><span class="sr"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">TestActions</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">TOP</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$/</span><span class="o">.</span><span class="k">make</span><span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="nv">$/</span><span class="p">);</span>  <span class="c1"># ç­‰ä»·äº $/.make: 2 + $/</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$actions</span> <span class="o">=</span> <span class="n">TestActions</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span> <span class="c1"># åˆ›å»º Action å®ä¾‹</span>
<span class="k">my</span> <span class="nv">$match</span>   <span class="o">=</span> <span class="n">TestGrammar</span><span class="o">.</span><span class="nb">parse</span><span class="p">(&#39;</span><span class="s1">40</span><span class="p">&#39;</span><span class="o">,</span> <span class="o">:</span><span class="nv">$actions</span><span class="p">);</span>
<span class="nb">say</span> <span class="nv">$match</span><span class="p">;</span>       <span class="c1"># ï½¢40ï½£</span>
<span class="nb">say</span> <span class="nv">$match</span><span class="o">.</span><span class="k">made</span><span class="p">;</span>  <span class="c1"># 42</span>
</code></pre></div><p><code>TestActions</code> çš„ä¸€ä¸ªå®ä¾‹å˜é‡ä½œä¸ºå…·åå‚æ•° <code>actions</code> è¢«ä¼ é€’ç»™ <code>parse</code> è°ƒç”¨, ç„¶åå½“ token <code>TOP</code> åŒ¹é…æˆåŠŸä¹‹å, å°±ä¼šè‡ªåŠ¨è°ƒç”¨æ–¹æ³• <code>TOP</code>, å¹¶ä¼ é€’åŒ¹é…å¯¹è±¡(match object) ä½œä¸ºæ–¹æ³•çš„å‚æ•°ã€‚</p>
<p>ä¸ºäº†è®©å‚æ•°æ˜¯åŒ¹é…å¯¹è±¡æ›´æ¸…æ¥š, ä¸Šé¢çš„ä¾‹å­ä½¿ç”¨ <code>$/</code> ä½œä¸º action æ–¹æ³•çš„å‚æ•°å, å°½ç®¡é‚£ä»…ä»…æ˜¯ä¸€ä¸ªæ–¹ä¾¿çš„çº¦å®š, è·Ÿå†…åœ¨æ— å…³ã€‚<code>$match</code> ä¹Ÿå¯ä»¥ã€‚(å°½ç®¡ä½¿ç”¨ <code>$/</code> å¯ä»¥æä¾›æŠŠ <code>$</code> ä½œä¸º <code>$/</code> çš„ç¼©å†™çš„ä¼˜åŠ¿ã€‚)</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ›´æœ‰è¯´æœåŠ›çš„ä¾‹å­:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">grammar</span> <span class="nc">KeyValuePairs</span> <span class="p">{</span>
    <span class="k">token</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="p">[&lt;</span><span class="nf">pair</span><span class="p">&gt;</span><span class="sr"> </span><span class="se">\n</span><span class="o">+</span><span class="p">]</span><span class="o">*</span><span class="sr">
</span><span class="sr">    </span><span class="p">}</span>

    <span class="k">token</span> <span class="nf">ws</span> <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="se">\h</span><span class="o">*</span><span class="sr">
</span><span class="sr">    }
</span><span class="sr">
</span><span class="sr">    rule pair </span><span class="p">{</span>
        <span class="p">&lt;</span><span class="s">key=.identifier</span><span class="p">&gt;</span> <span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span> <span class="p">&lt;</span><span class="s">value=.identifier</span><span class="p">&gt;</span>
    <span class="p">}</span><span class="sr">
</span><span class="sr">
</span><span class="sr">    token identifier </span><span class="p">{</span>
        \<span class="nb">w</span><span class="o">+</span>
    <span class="p">}</span><span class="sr">
</span><span class="sr">}
</span><span class="sr">
</span><span class="sr">class KeyValuePairsActions </span><span class="p">{</span>
    <span class="k">method</span> <span class="nb">pair</span>      <span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$/</span><span class="o">.</span><span class="nb">make</span><span class="o">:</span> <span class="nv">$&lt;key&gt;</span><span class="o">.</span><span class="s">made</span> <span class="o">=&gt;</span> <span class="nv">$&lt;value&gt;</span><span class="o">.</span><span class="k">made</span>
    <span class="p">}</span><span class="sr">
</span><span class="sr">
</span><span class="sr">    method identifier</span><span class="p">(</span><span class="ni">$</span><span class="p">/)</span> <span class="p">{</span>
        <span class="c1"># å­ä¾‹ç¨‹ `make` å’Œåœ¨ $/ ä¸Šè°ƒç”¨ .make ç›¸åŒ</span>
        <span class="k">make</span> <span class="o">~</span><span class="nv">$/</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">TOP</span> <span class="p">(</span><span class="nv">$match</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1"># TOP æ–¹æ³•çš„å‚æ•°å¯ä»¥ä½¿ç”¨ä»»æ„å˜é‡å, è€Œä¸ä»…ä»…æ˜¯ $/</span>
        <span class="nv">$match</span><span class="o">.</span><span class="nb">make</span><span class="o">:</span> <span class="nv">$match</span><span class="p">&lt;</span><span class="s">pair</span><span class="p">&gt;</span><span class="o">Â».</span><span class="k">made</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$res</span> <span class="o">=</span> <span class="n">KeyValuePairs</span><span class="o">.</span><span class="nb">parse</span><span class="p">(</span><span class="k">q</span><span class="sa">:to</span><span class="p">/EOI/,</span><span class="s"> :actions(KeyValuePairsActions)).made;
</span><span class="s">    second=b
</span><span class="s">    hits=42
</span><span class="s">    perl=6
</span><span class="s">    </span><span class="p">EOI</span>

<span class="k">for</span> <span class="nv">@$res</span> <span class="k">-&gt;</span> <span class="nv">$p</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Key: </span><span class="nv">$p</span><span class="o">.</span><span class="nf">key</span><span class="p">()</span><span class="s2">\tValue: </span><span class="nv">$p</span><span class="o">.</span><span class="nf">value</span><span class="p">()&#34;;</span>
<span class="p">}</span>
</code></pre></div><p>è¿™ä¼šè¾“å‡º:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="n">Key:</span> <span class="nb">second</span>     <span class="n">Value:</span> <span class="nf">b</span>
<span class="n">Key:</span> <span class="nf">hits</span>       <span class="n">Value:</span> <span class="mi">42</span>
<span class="n">Key:</span> <span class="nb">perl</span>       <span class="n">Value:</span> <span class="mi">6</span>
</code></pre></div><p><code>pair</code> è¿™ä¸ª rule, è§£æä¸€å¯¹ç”±ç­‰å·åˆ†å‰²çš„ pair, å¹¶ä¸”ç»™ <code>identifier</code> è¿™ä¸ª token å„è‡ªèµ·äº†åˆ«åã€‚å¯¹åº”çš„ action æ–¹æ³•æ„å»ºäº†ä¸€ä¸ª <code>Pair</code> å¯¹è±¡, å¹¶ä½¿ç”¨å­åŒ¹é…å¯¹è±¡(sub match objects)çš„ <code>.made</code> å±æ€§ã€‚è¿™ä¹Ÿæš´éœ²äº†ä¸€ä¸ªäº‹å®: submatches çš„ action æ–¹æ³•åœ¨é‚£äº›è°ƒç”¨æ­£åˆ™/å¤–éƒ¨æ­£åˆ™ä¹‹å‰å°±è¢«è°ƒç”¨ã€‚æ‰€ä»¥ action æ–¹æ³•æ˜¯æŒ‰åç»­è°ƒç”¨çš„ã€‚</p>
<p>åä¸º <code>TOP</code> çš„ action æ–¹æ³•ä»…ä»…æŠŠç”± <code>pair</code> è¿™ä¸ª rule çš„å¤šé‡åŒ¹é…ç»„æˆçš„æ‰€æœ‰å¯¹è±¡æ”¶é›†åˆ°ä¸€å—, ç„¶åä»¥ä¸€ä¸ªåˆ—è¡¨çš„æ–¹å¼è¿”å›ã€‚</p>
<p>æ³¨æ„ <code>KeyValuePairsActions</code> æ˜¯ä½œä¸ºä¸€ä¸ªç±»å‹å¯¹è±¡(type object)ä¼ é€’ç»™æ–¹æ³• <code>parse</code>çš„, è¿™æ˜¯å› ä¸º action æ–¹æ³•ä¸­æ²¡æœ‰ä¸€ä¸ªä½¿ç”¨å±æ€§(å±æ€§åªèƒ½é€šè¿‡å®ä¾‹æ¥è®¿é—®)ã€‚</p>
<p>å…¶å®ƒæƒ…å†µä¸‹, action æ–¹æ³•å¯èƒ½ä¼šåœ¨å±æ€§ä¸­ä¿å­˜çŠ¶æ€ã€‚ é‚£ä¹ˆè¿™å½“ç„¶éœ€è¦ä½ ä¼ é€’ä¸€ä¸ªå®ä¾‹ç»™ <code>parse</code> æ–¹æ³•ã€‚</p>
<p>æ³¨æ„, <code>token ws</code> æœ‰ç‚¹ç‰¹æ®Š: å½“ <code>:sigspace</code> å¼€å¯çš„æ—¶å€™(å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨ <code>rule</code>çš„æ—¶å€™), æˆ‘ä»¬è¦†å†™çš„ <code>ws</code> ä¼šæ›¿æ¢æŸäº›ç©ºç™½åºåˆ—ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ <code>rule pair</code> ä¸­ç­‰å·ä¸¤è¾¹çš„ç©ºæ ¼è§£ææ²¡æœ‰é—®é¢˜å¹¶ä¸”é—­åˆ <code>}</code> ä¹‹å‰çš„ç©ºç™½ä¸ä¼šç‹¼åè™å’½åœ°åƒä¸‹æ¢è¡Œç¬¦, å› ä¸ºæ¢è¡Œç¬¦åœ¨ <code>TOP</code> token å·²ç»å ä½ç½®äº†, å¹¶ä¸” token ä¸ä¼šå›æº¯ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># ws çš„å†…ç½®å®šä¹‰</span>
<span class="p">/</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">.</span><span class="ow">ws</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">/</span>                <span class="c1"># match &#34;whitespace&#34;:</span>
                         <span class="c1">#   \s+ if it&#39;s between two \w characters,</span>
                         <span class="c1">#   \s* otherwise</span>

<span class="k">my</span> <span class="k">token</span> <span class="nf">ws</span> <span class="p">{</span><span class="sr"> </span><span class="se">\h</span><span class="o">*</span><span class="sr"> </span><span class="p">}</span>      <span class="c1"># é‡å†™ ws è¿™ä¸ªå†…ç½®çš„ token</span>
<span class="o">&gt;</span><span class="nb">say</span> <span class="nb">so</span> <span class="p">&#34;</span><span class="s2">\n</span><span class="p">&#34;</span> <span class="o">~~</span> <span class="nv">&amp;ws</span>      <span class="c1"># True</span>
</code></pre></div><p>æ‰€ä»¥ <code>&lt;.ws&gt;</code> å†…ç½®çš„å®šä¹‰æ˜¯ï¼šå¦‚æœç©ºç™½åœ¨ä¸¤ä¸ª <code>\w</code> å•è¯å­—ç¬¦ä¹‹é—´, åˆ™æ„æ€ä¸º <code>\s+</code>, å¦åˆ™ä¸º <code>\s*</code>ã€‚ æˆ‘ä»¬å¯ä»¥é‡å†™ <code>ws</code> å…³äºç©ºç™½çš„å®šä¹‰, é‡æ–°å®šä¹‰æˆ‘ä»¬éœ€è¦çš„ç©ºç™½ã€‚æ¯”å¦‚æŠŠ <code>ws</code> å®šä¹‰ä¸º <code>{ \h* }</code> å°±æ˜¯æ‰€æœ‰æ°´å¹³ç©ºç™½ç¬¦, ç”šè‡³å¯ä»¥å°†<code>ws</code> å®šä¹‰ä¸ºéç©ºç™½å­—ç¬¦ã€‚ä¾‹å¦‚: <code>token ws { 'x' }</code></p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/grammar" term="grammar" label="grammar" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku Weekly Notes]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-08-22-raku-weekly-notes/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-08-22-raku-weekly-notes/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Raku Weekly Notes</blockquote><h2 id="my-foo-çš„ä½œç”¨åŸŸå’Œç”¨é€”"><code>:my $foo</code> çš„ä½œç”¨åŸŸå’Œç”¨é€”</h2>
<p>åœ¨ <em>regex</em>ã€<em>token</em> æˆ– <em>rule</em> ä¸­, å®šä¹‰åƒä¸‹é¢è¿™æ ·çš„å˜é‡æ˜¯å¯èƒ½çš„:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">token</span> <span class="nf">directive</span> <span class="p">{</span><span class="sr">
</span><span class="sr">    </span><span class="o">:</span><span class="kd">my</span> <span class="nv">$foo</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">in command</span><span class="p">&#34;;</span><span class="sr">
</span><span class="sr">    </span><span class="p">&lt;</span><span class="nf">command</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">subject</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">value</span><span class="p">&gt;</span><span class="o">?</span><span class="sr">
</span><span class="sr">}
</span></code></pre></div><p>åœ¨ä¸­æåˆ°äº†ä¸€ç‚¹æœ‰å…³è¯¥å˜é‡çš„ä¸œè¥¿, æˆ‘å¼•ç”¨è¿‡æ¥:</p>
<blockquote>
<p>ä»»ä½• grammar regex å®é™…ä¸Šæ˜¯ä¸€ç§<code>æ–¹æ³•</code>, å¹¶ä¸”ä½ å¯ä»¥åœ¨è¿™æ ·ä¸€ä¸ªå­ä¾‹ç¨‹ä¸­ä½¿ç”¨ä¸€ä¸ªå†’å·è·Ÿç€ä»»ä½•ä½œç”¨åŸŸå£°æ˜ç¬¦æ¥å£°æ˜ä¸€ä¸ªå˜é‡, è¿™äº›å£°æ˜ç¬¦åŒ…æ‹¬ <code>my</code>, <code>our</code>, <code>state</code> å’Œ <code>constant</code> (ä½œä¸ºç±»ä¼¼çš„å£°æ˜ç¬¦, temp å’Œ let ä¹Ÿèƒ½è¢«è¯†åˆ«). å•ä¸ªè¯­å¥(ç›´åˆ°ç»“å°¾çš„åˆ†å·æˆ–è¡Œæœ«å°¾çš„é—­æ‹¬å·ä¸ºæ­¢) è¢«è§£æä¸ºæ™®é€šçš„ Raku ä»£ç :</p>
</blockquote>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">token</span> <span class="nf">prove-nondeterministic-parsing</span> <span class="p">{</span><span class="sr">
</span><span class="sr">    </span><span class="o">:</span><span class="kd">my</span> <span class="nv">$threshold</span> <span class="o">=</span> <span class="nb">rand</span><span class="p">;</span><span class="sr">
</span><span class="sr">    </span><span class="p">&#39;</span><span class="s1">maybe</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\s</span><span class="o">+</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">it</span><span class="p">(</span><span class="nv">$threshold</span><span class="p">)&gt;</span><span class="sr">
</span><span class="sr"></span><span class="p">}</span>
</code></pre></div><p>æœ‰è°èƒ½è§£é‡Šä¸‹è¿™æ®µä»£ç çš„åº”ç”¨åœºæ™¯å—ï¼Ÿ</p>
<h3 id="what-scope-does-my-foo-have">what scope does <code>:my $foo;</code> have?</h3>
<p><code>:my $foo</code> åœ¨å®ƒæ‰€å‡ºç°çš„ rule/token/regex ä¸­æ‹¥æœ‰è¯æ³•ä½œç”¨åŸŸ(lexical scope)ã€‚ä½ æ‰€å¾—åˆ°çš„ä½œç”¨åŸŸè¦ä¹ˆå¾ˆå¤§è¦ä¹ˆå¾ˆå°:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">grammar</span> <span class="nc">g</span> <span class="p">{</span>
    <span class="k">regex</span> <span class="nf">r1</span> <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="p">{</span> <span class="k">my</span> <span class="nv">$foo</span><span class="p">;</span> <span class="o">...</span><span class="p">}</span><span class="sr"> </span><span class="c1"># `$foo` åœ¨è¯¥ block çš„ç»“å°¾è¶…å‡ºä½œç”¨åŸŸã€‚
</span><span class="c1"></span><span class="sr">        </span><span class="o">..</span><span class="ni">.</span><span class="sr">
</span><span class="sr">        </span><span class="p">{</span> <span class="nb">say</span> <span class="nv">$foo</span><span class="p">;</span>   <span class="p">}</span><span class="sr"> </span><span class="c1"># `$foo` ä¸åœ¨ä½œç”¨åŸŸä¸­ã€‚
</span><span class="c1"></span><span class="sr">    </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">grammar</span> <span class="nc">i</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$foo</span><span class="p">;</span>
    <span class="k">regex</span> <span class="nf">r1</span>   <span class="p">{</span><span class="sr"> </span><span class="o">..</span><span class="ni">.</span><span class="sr"> </span><span class="p">}</span> <span class="c1"># åœ¨ `r1` å†…éƒ¨, `$foo` è¢«è¯†åˆ«å‡ºã€‚</span>
    <span class="o">...</span>
    <span class="k">regex</span> <span class="nf">r999</span> <span class="p">{</span><span class="sr"> </span><span class="o">..</span><span class="ni">.</span><span class="sr"> </span><span class="p">}</span> <span class="c1"># ä½†æ˜¯åœ¨ r999 ä¸­ä¹Ÿæ˜¯ã€‚</span>
<span class="p">}</span>
</code></pre></div><h3 id="å®ƒçš„ç”¨é€”">å®ƒçš„ç”¨é€”?</h3>
<p>ä½¿ç”¨ <code>:my $foo;</code> å½¢å¼çš„å˜é‡å£°æ˜ä»¥åœ¨ rule/token/regex ä¸­å£°æ˜æœ¬åœ°ä½œç”¨åŸŸçš„å˜é‡, å¦‚æœæ²¡æœ‰è¿›ä¸€æ­¥çš„å£°æ˜, é‚£ä¹ˆè¿™äº›å˜é‡èƒ½åœ¨ rule/token/regex ä¸­çš„ä»»ä½•åœ°æ–¹é€šè¿‡æ‰€å£°æ˜çš„åå­—æ¥å¼•ç”¨ã€‚ä¸¾ä¸ªä¾‹å­, ä½ å¯ä»¥çœ‹çœ‹ Rakudo çš„ Grammar.nqp æºä»£ç ä¸­çš„ <a href="http://github.com/rakudo/rakudo/blob/nom/src/Raku/Grammar.nqp#L108"><code>token babble</code></a> ä¸­å£°æ˜çš„ <code>@extra_tweaks</code> å˜é‡çš„ç”¨æ³•ã€‚</p>
<p>ä½¿ç”¨ <code>:my $*foo;</code> å½¢å¼çš„å˜é‡å£°æ˜æ¥å£°æ˜åŠ¨æ€çš„è¯æ³•å˜é‡ã€‚åŠ¨æ€å˜é‡èƒ½å¤Ÿ, åœ¨æ²¡æœ‰è¿›ä¸€æ­¥å£°æ˜çš„æƒ…å†µä¸‹, åœ¨é—­åˆè¯æ³•ä½œç”¨åŸŸå’Œé—­åˆåŠ¨æ€ä½œç”¨åŸŸä¸­é€šè¿‡å®ƒä»¬å£°æ˜çš„åå­—æ¥å¼•ç”¨ã€‚ä½œä¸ºè¯´æ˜, è¯·æŸ¥çœ‹ <a href="http://github.com/rakudo/rakudo/blob/nom/src/Raku/Grammar.nqp#L4861">the declaration of <code>@*nibbles</code> in Rakudo&rsquo;s Grammar module</a> å’Œ <a href="http://github.com/rakudo/rakudo/blob/nom/src/Raku/Actions.nqp#L8943">its use in Rakudo&rsquo;s Actions module</a> ã€‚</p>
<h3 id="ä¸€èˆ¬çš„ä½¿ç”¨åœºæ™¯">ä¸€èˆ¬çš„ä½¿ç”¨åœºæ™¯</h3>
<p>åœ¨ <a href="https://en.wikipedia.org/wiki/Regular_expression">regular expressions</a> ä¸­ä¸€èˆ¬ä¸ä½¿ç”¨ <code>:â€¦</code> é£æ ¼çš„å£°æ˜ã€‚<code>:...;</code> ç»“æ„é€šå¸¸ç”¨åœ¨ç‰¹åˆ«å¤æ‚å’Œåºå¤§çš„ grammars ä¸­ã€‚å¯¹äºè¿™äº›ä½¿ç”¨åœºæ™¯, ä¾é  Raku çš„æ­£åˆ™è¡¨è¾¾å¼å’Œé—­åŒ…çš„ä¸€è‡´æ€§æ˜¯åˆé€‚çš„ã€‚æ­£æ˜¯è¿™ä½¿å¾— rule/token/regex çº§åˆ«çš„ <code>:...;</code> å˜é‡å£°æ˜å˜å¾—æ­£å½“ã€‚</p>
<h3 id="regexes-å’Œ-closures-çš„ä¸€è‡´æ€§">Regexes å’Œ closures çš„ä¸€è‡´æ€§</h3>
<p>å¾ˆå¤š grammars éƒ½æ˜¯<a href="http://trevorjim.com/python-is-not-context-free/">ä¸Šä¸‹æ–‡æœ‰å…³çš„</a>.</p>
<p>Raku ä½¿ regexes å’Œ closures ç»Ÿä¸€äº†:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nb">Regex</span><span class="o">.^</span><span class="nb">mro</span><span class="p">;</span> <span class="p">(</span><span class="nb">Regex</span><span class="p">)</span> <span class="p">(</span><span class="nb">Method</span><span class="p">)</span> <span class="p">(</span><span class="nb">Routine</span><span class="p">)</span> <span class="p">(</span><span class="nb">Block</span><span class="p">)</span> <span class="p">(</span><span class="nb">Code</span><span class="p">)</span> <span class="o">...</span>
</code></pre></div><p>mro æ˜¯æ–¹æ³•è§£æé¡ºåº, è¿™è¶³ä»¥è¯´æ˜ regex å®é™…ä¸Šæ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„æ–¹æ³•(å°±åƒæ–¹æ³•æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„å­ä¾‹ç¨‹ä¸€æ ·)ã€‚</p>
<h2 id="raku-is-there-a-phaser-that-runs-only-when-you-fall-out-of-a-loophttpstackoverflowcomquestions36117329raku-is-there-a-phaser-that-runs-only-when-you-fall-out-of-a-loop"><a href="http://stackoverflow.com/questions/36117329/raku-is-there-a-phaser-that-runs-only-when-you-fall-out-of-a-loop">Raku: is there a phaser that runs only when you fall out of a loop?</a></h2>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#!/usr/bin/env raku</span>

<span class="nl">ROLL</span><span class="o">:</span>
<span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span> <span class="k">-&gt;</span> <span class="nv">$r</span> <span class="p">{</span>
    <span class="k">given</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="nb">roll</span> <span class="p">{</span>
        <span class="k">when</span> <span class="mi">6</span> <span class="p">{</span>
            <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Roll </span><span class="nv">$r:</span><span class="s2"> you win!</span><span class="p">&#34;;</span>
            <span class="nb">last</span> <span class="n">ROLL</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">default</span> <span class="p">{</span>
            <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Roll </span><span class="nv">$r:</span><span class="s2"> sorry...</span><span class="p">&#34;;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">LAST</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">You either won or lost - this runs either way</span><span class="p">&#34;;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>æ›´ä¼˜é›…çš„å†™æ³•:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">constant</span> <span class="no">N</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="k">for</span> <span class="nb">flat</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="nb">roll</span> <span class="ow">xx</span> <span class="o">*</span> <span class="ow">Z</span> <span class="mi">1</span><span class="o">..</span><span class="n">N</span> <span class="k">-&gt;</span> <span class="nv">$_</span><span class="o">,</span> <span class="nv">$n</span> <span class="p">{</span>
    <span class="nb">print</span> <span class="p">&#34;</span><span class="s2">roll </span><span class="nv">$n:</span><span class="s2"> </span><span class="nv">$_</span><span class="s2"> </span><span class="p">&#34;;</span>

    <span class="k">when</span> <span class="mi">6</span> <span class="p">{</span>
        <span class="nb">put</span> <span class="p">&#34;</span><span class="s2">(won)</span><span class="p">&#34;;</span>
        <span class="nb">last</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">default</span> <span class="p">{</span>
        <span class="nb">put</span> <span class="p">&#34;</span><span class="s2">(lost)</span><span class="p">&#34;;</span>
    <span class="p">}</span>

    <span class="k">LAST</span> <span class="p">{</span>
        <span class="nb">print</span> <span class="p">&#34;</span><span class="s2">result: </span><span class="p">&#34;;</span>
        <span class="k">when</span> <span class="mi">6</span> <span class="p">{</span> <span class="nb">put</span> <span class="p">&#34;</span><span class="s2">winner :)</span><span class="p">&#34;</span> <span class="p">}</span>
        <span class="k">default</span> <span class="p">{</span> <span class="nb">put</span> <span class="p">&#34;</span><span class="s2">loser :(</span><span class="p">&#34;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h2 id="æ€ä¹ˆä»å‘½ä»¤è¡Œä¼ é€’ä¸€ä¸ªå¤æ•°ç»™-sub-mainhttpstackoverflowcomquestions35872082how-do-i-pass-a-complex-number-from-the-command-line-to-sub-main"><a href="http://stackoverflow.com/questions/35872082/how-do-i-pass-a-complex-number-from-the-command-line-to-sub-main">æ€ä¹ˆä»å‘½ä»¤è¡Œä¼ é€’ä¸€ä¸ªå¤æ•°ç»™ sub MAIN?</a></h2>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#!/usr/bin/env raku</span>


<span class="k">sub</span> <span class="nb">MAIN</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$x</span><span class="s2"> squared is </span><span class="p">{</span> <span class="nv">$x</span><span class="o">*</span><span class="nv">$x</span> <span class="p">}&#34;;</span>
<span class="p">}</span>
</code></pre></div><p>æˆ‘è¦åœ¨å‘½ä»¤è¡Œä¸­ä¼ é€’ä¸€ä¸ªå¤æ•°ç»™ MAIN:</p>
<blockquote>
<pre><code>% ./square i
</code></pre></blockquote>
<pre><code>Cannot convert string to number: base-10 number must begin with valid digits or '.' in 'âi' (indicated by â)
  in sub MAIN at ./square line 7
  in block &lt;unit&gt; at ./square line 5

Actually thrown at:
  in sub MAIN at ./square line 7
  in block &lt;unit&gt; at ./square line 5
</code></pre><p>å½“æˆ‘æŠŠè„šæœ¬å˜ä¸º:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#!/usr/bin/env raku</span>

<span class="k">sub</span> <span class="nb">MAIN</span><span class="p">(</span><span class="nb">Complex</span> <span class="nv">$x</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$x</span><span class="s2"> squared is </span><span class="p">{</span> <span class="nv">$x</span><span class="o">*</span><span class="nv">$x</span> <span class="p">}&#34;;</span>
<span class="p">}</span>
</code></pre></div><p>å®ƒç«Ÿç„¶å½»åº•ç½¢å·¥äº†:</p>
<pre><code>% ./square i
Usage:
  square &lt;x&gt;

% ./square 1
Usage:
  square &lt;x&gt;
</code></pre><p>ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ <a href="http://design.raku.org/S02.html#Coercive_type_declarations">Coercive type declaration</a> (å¼ºåˆ¶ç±»å‹å£°æ˜), ä» Str åˆ° Complex:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">MAIN</span><span class="p">(</span><span class="nb">Complex</span><span class="p">(</span><span class="nb">Str</span><span class="p">)</span> <span class="nv">$x</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$x</span><span class="s2"> çš„å¹³æ–¹ä¸º </span><span class="p">{</span> <span class="nv">$x</span> <span class="o">*</span> <span class="nv">$x</span> <span class="p">}&#34;;</span>
<span class="p">}</span>
</code></pre></div><p>é‚£ä¹ˆ:</p>
<pre><code>% ./squared.pl 1
1+0i çš„å¹³æ–¹ä¸º 1+0i
% ./squared.pl 1+2i
1+2i çš„å¹³æ–¹ä¸º -3+4i
</code></pre><p>ä½†æ˜¯:</p>
<pre><code>$ ./test.pl6 2
Usage:
  ./test.p6 &lt;x&gt;
</code></pre><p>æ‰€ä»¥ä½ çœŸæ­£éœ€è¦çš„æ˜¯æŠŠå…¶å®ƒ Numeric ç±»å‹å¼ºè½¬ä¸º Complex ç±»å‹:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#!/usr/bin/env raku</span>

<span class="k">sub</span> <span class="nb">MAIN</span> <span class="p">(</span> <span class="nb">Complex</span><span class="p">(</span><span class="nb">Real</span><span class="p">)</span> <span class="nv">$x</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$x</span><span class="s2"> squared is </span><span class="p">{</span> <span class="nv">$x</span><span class="o">*</span><span class="nv">$x</span> <span class="p">}&#34;;</span>
<span class="p">}</span>
</code></pre></div><p>æˆ‘ä½¿ç”¨ Real è€Œé Numeric, å› ä¸º Complex å·²ç»æ¶µç›–äº†å…¶å®ƒçš„äº†ã€‚</p>
<h2 id="blessing-a-hash-into-an-objecthttpswwwredditcomrrakucomments4aoi82blessing_a_hash_into_an_object"><a href="https://www.reddit.com/r/raku/comments/4aoi82/blessing_a_hash_into_an_object/">Blessing a Hash into an object</a></h2>
<p>ä¸ºä»€ä¹ˆæˆ‘å†™çš„è¿™æ®µä»£ç ä¸å¯¹å‘¢ï¼Ÿ</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">WordCount</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">%!words</span><span class="p">;</span> <span class="c1"># Tried with both . and !</span>

    <span class="k">method</span> <span class="nb">new</span><span class="p">(</span><span class="nv">$string</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">%words</span><span class="p">;</span>
        <span class="k">my</span> <span class="nv">@sentence</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(/</span><span class="se">\s</span><span class="o">+</span><span class="p">/</span><span class="o">,</span> <span class="nv">$string</span><span class="p">);</span>
    
        <span class="k">for</span> <span class="nv">@sentence</span> <span class="k">-&gt;</span> <span class="nv">$word</span> <span class="p">{</span>
            <span class="nv">%words</span><span class="p">{</span><span class="nv">$word</span><span class="p">}</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="k">return</span> <span class="nb">self</span><span class="o">.</span><span class="nb">bless</span><span class="p">(</span><span class="o">:</span><span class="nv">%words</span><span class="p">);</span>
  <span class="p">}</span>

    <span class="k">method</span> <span class="nf">sayCounts</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">@keys</span> <span class="o">=</span> <span class="nb">keys</span><span class="p">(</span><span class="nv">%!words</span><span class="p">);</span>
        <span class="k">for</span> <span class="nv">@keys</span> <span class="k">-&gt;</span> <span class="nv">$key</span> <span class="p">{</span>
            <span class="nb">say</span> <span class="nv">$key</span> <span class="o">~</span> <span class="p">&#34;</span><span class="s2"> </span><span class="p">&#34;</span> <span class="o">~</span> <span class="nv">%!words</span><span class="p">{</span><span class="nv">$key</span><span class="p">};</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nb">MAIN</span> <span class="p">{</span>
  <span class="k">my</span> <span class="nv">$sentence</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">the boy jumped over the dog</span><span class="p">&#34;;</span>
  <span class="k">my</span> <span class="nv">$wordCount</span> <span class="o">=</span> <span class="n">WordCount</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="nv">$sentence</span><span class="p">);</span>
  <span class="nv">$wordCount</span><span class="o">.</span><span class="nf">sayCounts</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div><p>Raku-ify:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">WordCount</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nb">Int</span> <span class="nv">%.words</span> <span class="k">is</span> <span class="k">default</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="k">method</span> <span class="nb">new</span><span class="p">(</span><span class="nv">$string</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nb">Int</span> <span class="nv">%words</span><span class="p">;</span>

        <span class="k">for</span> <span class="nv">$string</span><span class="o">.</span><span class="nb">split</span><span class="p">(/</span><span class="se">\s</span><span class="o">+</span><span class="p">/)</span> <span class="k">-&gt;</span> <span class="nv">$word</span> <span class="p">{</span>
            <span class="nv">%words</span><span class="p">{</span><span class="nv">$word</span><span class="p">}</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nb">self</span><span class="o">.</span><span class="nb">bless</span><span class="p">(</span><span class="o">:</span><span class="nv">%words</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nb">gist</span> <span class="p">{</span>
        <span class="nv">%.words</span><span class="o">.</span><span class="nb">map</span><span class="p">({</span><span class="o">.</span><span class="nb">value</span> <span class="o">~</span> <span class="p">&#34;</span><span class="s2"> </span><span class="p">&#34;</span> <span class="o">~</span> <span class="o">.</span><span class="nb">key</span><span class="p">})</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#34;</span><span class="s2">\n</span><span class="p">&#34;)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$word-count</span> <span class="o">=</span> <span class="n">WordCount</span><span class="o">.</span><span class="nb">new</span><span class="p">(&#39;</span><span class="s1">the boy jumped over the dog</span><span class="p">&#39;);</span>
<span class="nb">say</span> <span class="nv">$word-count</span><span class="p">;</span>
</code></pre></div><p>æ•£åˆ—ä¸­çš„æ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ª <strong>Pair</strong>:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%w</span> <span class="o">=</span> <span class="s">a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">;</span>
<span class="nv">%w</span><span class="o">.</span><span class="nb">map</span><span class="p">({</span> <span class="nb">say</span> <span class="nv">$_</span><span class="o">.^</span><span class="nb">name</span> <span class="p">})</span> <span class="c1"># OUTPUTÂ«Pairâ¤Â»</span>
</code></pre></div><p>æ‰€ä»¥:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">%.words</span><span class="o">.</span><span class="nb">map</span><span class="p">({</span><span class="o">.</span><span class="nb">value</span> <span class="o">~</span> <span class="p">&#34;</span><span class="s2"> </span><span class="p">&#34;</span> <span class="o">~</span> <span class="o">.</span><span class="nb">key</span><span class="p">})</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#34;</span><span class="s2">\n</span><span class="p">&#34;)</span>
</code></pre></div><p>ç­‰ä»·äº:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">%.words</span><span class="o">.</span><span class="nb">kv</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span> <span class="k">-&gt;</span> <span class="nv">$word</span><span class="o">,</span> <span class="nv">$count</span> <span class="p">{</span> <span class="p">&#34;</span><span class="nv">$word</span><span class="s2"> </span><span class="nv">$count</span><span class="p">&#34;</span> <span class="p">}</span> <span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#34;</span><span class="s2">\n</span><span class="p">&#34;)</span>
</code></pre></div><p>ä½ è¿˜å¯ä»¥ä½¿ç”¨ sub-signature(å­ç­¾å)æ¥è§£æ„ <code>.map</code> æä¾›çš„ <code>Pair</code>ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">%.words</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span> <span class="k">-&gt;</span> <span class="p">(:</span><span class="s">key</span><span class="p">(</span><span class="nv">$word</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">value</span><span class="p">(</span><span class="nv">$count</span><span class="p">))</span> <span class="p">{</span> <span class="p">&#34;</span><span class="nv">$word</span><span class="s2"> </span><span class="nv">$count</span><span class="p">&#34;</span> <span class="p">}</span> <span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#34;</span><span class="s2">\n</span><span class="p">&#34;)</span>
</code></pre></div><h3 id="å­—ç¬¦ä¸²å¤„ç†">å­—ç¬¦ä¸²å¤„ç†</h3>
<blockquote>
<p>å°†æ¯è¡Œä»ç¬¬äºŒåˆ—åˆ°æœ€åä¸€åˆ—æ•°å€¼ä¸º0çš„ä¸”æ•°ç›®å¤šäº6ä¸ªçš„è¡Œåˆ é™¤</p>
</blockquote>
<p>æ•°æ®ï¼š</p>
<pre><code>OG004240:    1       3     1       1       9     0       4       5       1     1       6    1     2
OG004241:    1       2     1       4       7     2       1       3       1     2       9    1     1
OG004242:    1       2     1       2       4     1       3       9       2     2       4    2     2
OG004243:    0       4     1       2       9     2       4       5       1     2       3    1     1
OG004244:    0       2     1       3       8     3       3       2       2     3       4    2     2
OG004245:    0       3     1       2       7     3       3       0       3     2       7    2     2
OG004246:    0       0     2       0       1     15      0       15      0     0       1    0     1
</code></pre><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@lines</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">a.txt</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">lines</span><span class="p">;</span>
<span class="k">for</span> <span class="nv">@lines</span> <span class="k">-&gt;</span> <span class="nv">$line</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">@words</span> <span class="o">=</span> <span class="nv">$line</span><span class="o">.</span><span class="nb">split</span><span class="p">(/</span><span class="se">\s</span><span class="o">+</span><span class="p">/);</span>
    <span class="nb">say</span> <span class="nv">$line</span> <span class="k">unless</span> <span class="nv">@words</span><span class="o">[</span><span class="mi">1</span><span class="o">..*].</span><span class="nb">grep</span><span class="p">(</span><span class="o">*</span> <span class="ow">eq</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="nb">elems</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>ä½¿ç”¨ <code>rakudoc -f Str.split</code> æŸ¥çœ‹ split çš„å¸®åŠ©æ–‡æ¡£ã€‚</p>
<p>åˆå¹¶ç›¸åŒè¡Œï¼š</p>
<p>æ–‡ä»¶ä¸€ï¼š</p>
<pre><code>1###ENSMMUP00000017866###-###27582-27683
1###ENSMMUP00000017866###-###27508-27576
1###ENSMMUP00000017866###-###27290-27503
1###ENSMMUP00000040736###-###199515-200498
1###ENSMMUP00000040736###-###198582-198818
1###ENSMMUP00000030409###+###395728-395934
1###ENSMMUP00000030409###+###403004-403148
</code></pre><p>æƒ³åˆå¹¶ç›¸åŒçš„ï¼Œç”Ÿæˆæ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code>1###ENSMMUP00000017866###-###27582-27683  27508-27576  27290-27503  
1###ENSMMUP00000040736###-###199515-200498  198582-198818
1###ENSMMUP00000030409###+###395728-395934  403004-403148
</code></pre><p>ä¸€ç§æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@lines</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">a.txt</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">lines</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">%hash</span><span class="p">;</span>

<span class="k">for</span> <span class="nv">@lines</span> <span class="k">-&gt;</span> <span class="nv">$line</span> <span class="p">{</span>
    <span class="nv">$line</span><span class="o">.</span><span class="nb">match</span><span class="p">(/</span><span class="ni">^</span><span class="p">(</span><span class="ni">.</span><span class="o">*?</span><span class="p">)(</span><span class="se">\d</span><span class="o">+</span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="se">\d</span><span class="o">+</span><span class="p">)/);</span>
    <span class="nv">%hash</span><span class="p">{</span><span class="nv">$0</span><span class="p">}</span> <span class="o">~=</span> <span class="nv">$1</span> <span class="o">~</span> <span class="p">&#34;</span><span class="s2"> </span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="k">for</span> <span class="nv">%hash</span><span class="o">.</span><span class="nb">kv</span> <span class="k">-&gt;</span> <span class="nv">$key</span><span class="o">,</span> <span class="nv">$value</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$key</span><span class="o">,</span> <span class="nv">$value</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>å¦‚ä¸‹æ•°æ®ï¼Œæƒ³å»æ‰ç¬¬3åˆ—é‡å¤çš„è¡Œä¸”ä¿ç•™çš„è¡Œè¦ä½¿ç¬¬å››åˆ—æœ€å°, åŸå§‹æ•°æ®ï¼š</p>
<pre><code>326        0.00        0.00        ( 0 )
63        0.00        2.43        ( 0.0082 )
64        0.00        2.43        ( 0.0082 )
120        0.00        2.43        ( 0 )
340        0.00        4.03        ( 0 )
99        0.00        9.14        ( 0.0229 )
441        0.00        9.14        ( 0.0232 )
142        0.00        10.77        ( 0.0569 )
292        0.00        10.77        ( 0.0393 )
266        0.00        10.77        ( 0.0233 )
</code></pre><p>æƒ³è¦çš„ç»“æœï¼š</p>
<pre><code>326        0.00        0.00        ( 0 )
120        0.00        2.43        ( 0 )
340        0.00        4.03        ( 0 )
99        0.00        9.14        ( 0.0229 )
266        0.00        10.77        ( 0.0233 )
</code></pre><p>ä¸€ç§æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@lines</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">a.txt</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">lines</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">%hash</span><span class="p">;</span>

<span class="k">for</span> <span class="nv">@lines</span> <span class="k">-&gt;</span> <span class="nv">$line</span> <span class="p">{</span>
    <span class="nv">$line</span><span class="o">.</span><span class="nb">match</span><span class="p">(/(</span><span class="se">\d</span><span class="o">+</span><span class="sr">\</span><span class="ni">.</span><span class="se">\d</span><span class="o">+</span><span class="p">)</span><span class="se">\s</span><span class="o">+</span><span class="sr">\(</span><span class="se">\s</span><span class="o">+</span><span class="p">(</span><span class="se">\S</span><span class="o">+</span><span class="p">)/);</span>
    <span class="nv">%hash</span><span class="p">{</span><span class="nv">$0</span><span class="p">}</span> <span class="o">~=</span> <span class="nv">$1</span> <span class="o">~</span> <span class="p">&#34;</span><span class="s2"> </span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="k">for</span> <span class="nv">@lines</span> <span class="k">-&gt;</span> <span class="nv">$line</span> <span class="p">{</span>
    <span class="nv">$line</span><span class="o">.</span><span class="nb">match</span><span class="p">(/(</span><span class="se">\d</span><span class="o">+</span><span class="sr">\</span><span class="ni">.</span><span class="se">\d</span><span class="o">+</span><span class="p">)</span><span class="se">\s</span><span class="o">+</span><span class="sr">\(</span><span class="se">\s</span><span class="o">+</span><span class="p">(</span><span class="se">\S</span><span class="o">+</span><span class="p">)/);</span>

    <span class="k">for</span> <span class="nv">%hash</span><span class="o">.</span><span class="nb">kv</span> <span class="k">-&gt;</span> <span class="nv">$key</span><span class="o">,</span> <span class="nv">$value</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="nv">$line</span> <span class="k">if</span> <span class="nv">$0</span> <span class="o">~~</span> <span class="nv">$key</span> <span class="o">&amp;&amp;</span> <span class="nv">$1</span> <span class="o">~~</span> <span class="nv">$value</span><span class="o">.</span><span class="nb">words</span><span class="o">.</span><span class="nb">min</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>æœ‰ gene.txt å’Œ in.txt ä¸¤ä¸ªæ–‡ä»¶, æ–‡ä»¶å†…å®¹å¦‚ä¸‹:</p>
<p>gene.txt:ï¼ˆ2000å¤šè¡Œ)</p>
<pre><code>chr1        ABCA4        94458582        94586799
chr1        ACADM        76190031        76229363
chr16        BBS2        56518258        56554008
chr17        G6PC        41052813        41066450
chr17        GAA        78078244        78093271
</code></pre><p>in.txt:(5ä¸‡å¤šè¡Œ)</p>
<pre><code>1        94505603        rs368951547        C        T        NA        NA
1        94505604        rs61750126         A        C        0.02066    NA
1        94505611        rs137853898        G        A        NA        not-provided
1        94505620        rs370967816        T        A        NA        NA
1        94505621        rs149503495        T        C        NA        NA
1        94505627        rs374610040        A        G        NA        NA
22        18901263        rs377148163       C        A        NA        NA
22        18901290        rs381848          G        A        0.07989   NA
22        18901322        rs62232347        C        A        NA        NA
22        18901326        rs201353896       TCC      T        0.05005   NA
22        18901327        rs10537001        CCT      C        0.0528    NA
16        18901326        rs201353896       TCC      T        0.05005   NA
17        18901327        rs10537001        CCT      C        0.0528    NA
</code></pre><p>gene.txt å’Œ in.txt çš„ç¬¬ä¸€åˆ—çš„æ•°å­—éƒ¨åˆ†ç›¸åŒï¼Œå¹¶ä¸” In çš„ç¬¬äºŒåˆ—åœ¨gene çš„ä¸‰å››åˆ—èŒƒå›´ä¹‹é—´ï¼Œå°±è¾“å‡º in.txt ä¸­çš„é‚£ä¸€è¡Œã€‚</p>
<p>è§£å†³æ–¹æ³•ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@lines</span>   <span class="o">=</span> <span class="p">&#34;</span><span class="s2">a.txt</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">lines</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">@inlines</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">in.txt</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">lines</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">%hash</span><span class="p">;</span>

<span class="k">for</span> <span class="nv">@lines</span> <span class="k">-&gt;</span> <span class="nv">$line</span> <span class="p">{</span>
    <span class="nv">$line</span><span class="o">.</span><span class="nb">match</span><span class="p">(/</span><span class="ni">^</span><span class="sr">chr</span><span class="p">(</span><span class="se">\d</span><span class="o">+</span><span class="p">)</span><span class="se">\s</span><span class="o">+</span><span class="p">(</span><span class="se">\w</span><span class="o">+</span><span class="p">)</span><span class="se">\s</span><span class="o">+</span><span class="p">(</span><span class="se">\d</span><span class="o">+</span><span class="p">)</span><span class="se">\s</span><span class="o">+</span><span class="p">(</span><span class="se">\d</span><span class="o">+</span><span class="p">)/);</span>
    <span class="nv">%hash</span><span class="p">{</span><span class="nv">$0</span><span class="o">~</span><span class="nv">$1</span><span class="o">~</span><span class="nv">$2</span><span class="o">~</span><span class="nv">$3</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$0</span> <span class="o">~</span> <span class="p">&#34;</span><span class="s2"> </span><span class="p">&#34;</span> <span class="o">~</span> <span class="nv">$2</span> <span class="o">~</span> <span class="p">&#34;</span><span class="s2"> </span><span class="p">&#34;</span> <span class="o">~</span> <span class="nv">$3</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">for</span> <span class="nv">@inlines</span> <span class="k">-&gt;</span> <span class="nv">$line</span> <span class="p">{</span>
    <span class="nv">$line</span><span class="o">.</span><span class="nb">match</span><span class="p">(/</span><span class="ni">^</span><span class="p">(</span><span class="se">\d</span><span class="o">+</span><span class="p">)</span><span class="se">\s</span><span class="o">+</span><span class="p">(</span><span class="se">\d</span><span class="o">+</span><span class="p">)/);</span>

    <span class="k">for</span> <span class="nv">%hash</span><span class="o">.</span><span class="nb">values</span> <span class="k">-&gt;</span> <span class="nv">$value</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="nv">$line</span>
        <span class="k">if</span> <span class="nv">$0</span> <span class="o">~~</span> <span class="nv">$value</span><span class="o">.</span><span class="nb">words</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
        <span class="o">&amp;&amp;</span> <span class="nv">$1</span> <span class="o">&lt;=</span> <span class="nv">$value</span><span class="o">.</span><span class="nb">words</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="nb">Num</span>
        <span class="o">&amp;&amp;</span> <span class="nv">$1</span> <span class="o">&lt;=</span> <span class="nv">$value</span><span class="o">.</span><span class="nb">words</span><span class="o">[</span><span class="mi">2</span><span class="o">].</span><span class="nb">Num</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>ä¾‹å¦‚æˆ‘ç°åœ¨æ•°ç»„ä¸­çš„å€¼æ˜¯ <code>@project = ('NX11','NX12','NX13â€™)</code>ã€‚</p>
<p>å¦å¤–ä¸€ä¸ªæ•°ç»„æ˜¯ <code>@get = ('ss','ssfd','NX12','sed','NX11â€™)</code>ã€‚</p>
<p>ç°åœ¨æŠŠç¬¬ä¸€ä¸ªæ•°ç»„ä¸­å‡ºç°è¿‡çš„å€¼ï¼Œå¦‚æœç¬¬äºŒä¸ªæ•°ç»„ä¸­ä¹Ÿæœ‰çš„è¯åˆ é™¤æ‰ï¼Œç„¶åä¿ç•™ç¬¬äºŒä¸ªæ•°ç»„å‰©ä¸‹çš„å€¼ã€‚</p>
<p>ä½¿ç”¨å·®é›†ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@get</span> <span class="ow">(-)</span> <span class="nv">@project</span>
</code></pre></div><p>æœ‰å¦‚ä¸‹æ•°æ®ï¼š</p>
<pre><code>PL -0.00 5.50
PL -0.25 3.50
PL -0.50 0.00
PL -0.75 4.50
-0.25 -0.00 1.00
-0.25 -0.25 4.50
-0.25 -0.50 1.00
-0.75 -0.75 1.00
-0.75 -1.00 0.00
-1.00 -0.25 3.50
-1.00 -0.50 0.00
-1.00 -1.25 3.40
-1.00 -1.75 4.00
</code></pre><p>å°†ç¬¬ä¸€åˆ—å€¼ç›¸åŒçš„è¡Œåˆå¹¶ï¼Œ åˆ†ä½¿åˆå¹¶ç¬¬äºŒåˆ—å’Œç¬¬ä¸‰åˆ—ï¼š</p>
<p>ç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>PL -0.00 -0.25 -0.50 -0.75
PL 5.50 3.50 0.00 4.50
...
</code></pre><h3 id="é¢å‘å¯¹è±¡">é¢å‘å¯¹è±¡</h3>
<p>Fluent interface (æµæ¥å£)</p>
<p>åœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œä¸€ä¸ªæµæ¥å£ï¼ˆfluent Interfaceï¼‰æ˜¯æŒ‡å®ç°ä¸€ç§å®ç°é¢å‘å¯¹è±¡çš„èƒ½æé«˜ä»£ç å¯è¯»æ€§çš„APIçš„æ–¹æ³•ã€‚
åœ¨ Raku ä¸­æœ‰å¾ˆå¤šç§æ–¹æ³•, ä½†æ˜¯æœ€ç®€å•çš„ä¸€ç§æ˜¯å£°æ˜å±æ€§ä¸ºå¯è¯»å†™å¹¶ä½¿ç”¨ <code>given</code> å…³é”®å­—ã€‚ç±»å‹æ³¨é‡Šæ˜¯å¯é€‰çš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Employee</span> <span class="p">{</span>
    <span class="k">subset</span> <span class="nc">Salary</span>         <span class="k">of</span> <span class="nb">Real</span> <span class="k">where</span> <span class="o">*</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">subset</span> <span class="nc">NonEmptyString</span> <span class="k">of</span> <span class="nb">Str</span>  <span class="k">where</span> <span class="o">*</span> <span class="o">~~</span> <span class="p">/</span><span class="se">\S</span><span class="p">/;</span> <span class="c1"># è‡³å°‘ä¸€ä¸ªéç©ºç™½ç¬¦å·</span>

    <span class="k">has</span> <span class="n">NonEmptyString</span> <span class="nv">$.name</span>    <span class="k">is</span> <span class="k">rw</span><span class="p">;</span>
    <span class="k">has</span> <span class="n">NonEmptyString</span> <span class="nv">$.surname</span> <span class="k">is</span> <span class="k">rw</span><span class="p">;</span>
    <span class="k">has</span> <span class="n">Salary</span>         <span class="nv">$.salary</span>  <span class="k">is</span> <span class="k">rw</span><span class="p">;</span>

    <span class="k">method</span> <span class="nb">gist</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">qq</span><span class="sa">:to</span><span class="p">[END];</span><span class="s2">
</span><span class="s2">        Name:    </span><span class="nv">$.name</span><span class="s2">
</span><span class="s2">        Surname: </span><span class="nv">$.surname</span><span class="s2">
</span><span class="s2">        Salary:  </span><span class="nv">$.salary</span><span class="s2">
</span><span class="s2">        </span><span class="p">END</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">my</span> <span class="nv">$employee</span> <span class="o">=</span> <span class="n">Employee</span><span class="o">.</span><span class="nb">new</span><span class="p">();</span>

<span class="k">given</span> <span class="nv">$employee</span> <span class="p">{</span>
    <span class="o">.</span><span class="nb">name</span>    <span class="o">=</span> <span class="p">&#39;</span><span class="s1">Sally</span><span class="p">&#39;;</span>
    <span class="o">.</span><span class="nf">surname</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">Ride</span><span class="p">&#39;;</span>
    <span class="o">.</span><span class="nf">salary</span>  <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="nv">$employee</span><span class="p">;</span>

<span class="c1"># Output:</span>
<span class="c1"># Name:    Sally</span>
<span class="c1"># Surname: Ride</span>
<span class="c1"># Salary:  200</span>
</code></pre></div><ol>
<li><a href="http://stackoverflow.com/questions/30264548/how-do-i-check-file-timestamp-attributes-in-perl-6">åœ¨ Raku ä¸­æ€æ ·æ£€æŸ¥æ–‡ä»¶çš„æ—¶é—´æˆ³å±æ€§</a></li>
</ol>
<p>åœ¨ Raku ä¸­æ€æ ·æ£€æŸ¥æ–‡ä»¶çš„æ—¶é—´æˆ³å±æ€§ï¼Ÿ åœ¨ Perl 5 ä¸­æ˜¯ä½¿ç”¨æ–‡ä»¶æµ‹è¯•æ“ä½œç¬¦ Â <a href="http://perldoc.raku.org/functions/-X.html">file test operators </a>, åœ¨ Raku ä¸­æ˜¯ä½¿ç”¨æ¥è‡ªäº <a href="http://doc.raku.org/type/IO::FileTestable"><code>IO::FileTestable</code>Â role</a> çš„æ–¹æ³• (e.g.Â <code>.modified</code>,Â <code>.accessed</code>Â andÂ <code>.changed</code>) ã€‚</p>
<p>ä¾‹å¦‚:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$filename</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">sample.txt</span><span class="p">&#34;;</span>
<span class="k">my</span> <span class="nv">$seconds_since_epoch</span> <span class="o">=</span> <span class="nv">$filename</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">accessed</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$readable_timestamp</span>  <span class="o">=</span> <span class="nb">DateTime</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="nv">$filename</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">accessed</span><span class="p">);</span>

<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">File &#39;</span><span class="nv">$filename&#39;</span><span class="s2"> was last accessed at &#39;</span><span class="nv">$readable_timestamp&#39;</span><span class="s2">, which is </span><span class="p">{</span><span class="nv">$seconds_since_epoch</span><span class="o">.</span><span class="nb">Num</span><span class="p">}</span><span class="s2"> seconds since the epoch</span><span class="p">&#34;;</span>
</code></pre></div><p>2ã€æˆ‘æ­£å°è¯•ç”ŸæˆåŒ…å« 10 ä¸ªéšæœºéšæœºåºåˆ—çš„ <a href="https://en.wikipedia.org/wiki/FASTQ_format">FASTQ æ–‡ä»¶</a>ï¼Œåºåˆ—ç”±éšæœºå“è´¨åˆ†æ•°æ„æˆã€‚æˆ‘åŸæ¥æ˜¯ä½¿ç”¨ä¸‹é¢çš„ä»£ç ï¼Œå®ƒå·¥ä½œè‰¯å¥½:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@seq</span>  <span class="o">=</span> <span class="p">(</span><span class="nf">rand_fa_seq</span><span class="p">()</span> <span class="k">for</span> <span class="o">^</span><span class="mi">10</span><span class="p">);</span>
<span class="k">my</span> <span class="nv">@qual</span> <span class="o">=</span> <span class="p">(</span><span class="nf">rand_qual</span><span class="p">()</span>   <span class="k">for</span> <span class="o">^</span><span class="mi">10</span><span class="p">);</span>

<span class="nv">@seq</span><span class="o">.</span><span class="nb">raku</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>
<span class="nv">@qual</span><span class="o">.</span><span class="nb">raku</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>

<span class="k">sub</span> <span class="nf">rand_fa_seq</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nb">join</span><span class="p">(&#34;&#34;</span><span class="o">,</span> <span class="nb">roll</span><span class="p">(</span><span class="mi">20</span><span class="o">,</span><span class="p">&#34;</span><span class="s2">ACGT</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">comb</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">rand_qual</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nb">join</span><span class="p">(&#34;&#34;</span><span class="o">,</span> <span class="nb">roll</span><span class="p">(</span><span class="mi">20</span><span class="o">,</span><span class="p">&#34;</span><span class="s2">EFGHIJ</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">comb</span><span class="p">))</span>
<span class="p">}</span>
</code></pre></div><p>ç­‰ä»·äºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">rand-fa-seq</span><span class="p">(</span><span class="nv">$n</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span> <span class="p">{</span> <span class="p">&lt;</span><span class="s">A C G T</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">roll</span><span class="p">(</span><span class="nv">$n</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span> <span class="p">}</span>
<span class="k">sub</span> <span class="nf">rand-qual</span><span class="p">(</span><span class="nv">$n</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>   <span class="p">{</span> <span class="p">&lt;</span><span class="s">E F G H I J</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">roll</span><span class="p">(</span><span class="nv">$n</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span> <span class="p">}</span>

<span class="k">my</span> <span class="nv">@seq</span>  <span class="o">=</span> <span class="nf">rand-fa-seq</span><span class="p">()</span> <span class="ow">xx</span> <span class="mi">10</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">@qual</span> <span class="o">=</span> <span class="nf">rand-qual</span><span class="p">()</span> <span class="ow">xx</span> <span class="mi">10</span><span class="p">;</span>
</code></pre></div><p>3ã€<a href="http://stackoverflow.com/questions/30414206/list-of-non-squares-using-list-comprehension-in-perl-6">åœ¨ Raku ä¸­ä½¿ç”¨ &ldquo;åˆ—è¡¨è§£æ&rdquo; ç”Ÿæˆéå¹³æ–¹æ•°åˆ—è¡¨</a></p>
<p>åœ¨ Raku ä¸­æˆ‘æ€æ ·ä½¿ç”¨ &ldquo;åˆ—è¡¨è§£æ&rdquo; åˆ›å»ºä¸€ç»„éå¹³æ–¹æ•°? æˆ‘åœ¨ Â <a href="http://rosettacode.org/wiki/Sequence_of_Non-squares#Perl_6">Rosetta Code</a>Â  é‚£å„¿çœ‹åˆ°äº†å¦‚ä½•æ‰“å°ä¸€ç»„éå¹³æ–¹æ•°çš„ä»£ç ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">nth_term</span> <span class="p">(</span><span class="nb">Int</span> <span class="nv">$n</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$n</span> <span class="o">+</span> <span class="nb">round</span> <span class="nb">sqrt</span> <span class="nv">$n</span> <span class="p">}</span>

<span class="nb">say</span> <span class="n">nth_term</span> <span class="nv">$_</span> <span class="k">for</span> <span class="mi">1</span> <span class="o">..</span> <span class="mi">22</span><span class="p">;</span>
</code></pre></div><p>ç›®å‰ä¸ºæ­¢æˆ‘çœ‹åˆ°çš„æœ€æ¥è¿‘çš„ä¸œè¥¿æ˜¯ä½¿ç”¨  <code>for</code> å…³é”®å­—ã€‚ ä½†æ˜¯å› ä¸ºè¿™å®é™…ä¸Šä»…ä»…æ˜¯ä¸€ä¸ªå†…è”ï¼ˆinlineï¼‰å¾ªç¯ï¼Œæˆ‘è®¤ä¸ºè¿™ä»æŠ€æœ¯ä¸Šæ¥è®²å¹¶ä¸æ˜¯åˆ—è¡¨è§£æï¼Œå°½ç®¡å®ƒçœ‹èµ·æ¥ç›¸ä¼¼ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@y</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$_</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="mi">1</span> <span class="o">..</span> <span class="mi">10</span><span class="p">);</span>
</code></pre></div><p>ä½†æ˜¯ï¼Œæˆ‘çœŸæ­£æƒ³çŸ¥é“æ˜¯å¦æœ‰ä¸€ç§ â€œåˆ—è¡¨è§£æ â€œ çš„æ–¹æ³•æ¥åˆ›å»ºå¯åœ¨æ•°å­¦ä¸Šæè¿°çš„è¯¸å¦‚éå¹³æ–¹æ•°çš„åˆ—è¡¨ã€‚è¿™å„¿æœ‰ä¸€ä¸ªæˆ‘ç”¨æ¥åˆ›å»ºä¸€ç»„éå¹³æ–¹æ•°çš„æ–¹æ³•ï¼ˆç›´åˆ° 30ï¼‰ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@non_squares</span> <span class="o">=</span> <span class="nb">grep</span> <span class="p">{</span><span class="nb">sqrt</span><span class="p">(</span><span class="nv">$_</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">floor</span><span class="p">(</span><span class="nb">sqrt</span><span class="p">(</span><span class="nv">$_</span><span class="p">))}</span><span class="o">,</span> <span class="mi">1</span> <span class="o">..</span> <span class="mi">30</span><span class="p">;</span>
</code></pre></div><p>æˆ‘æ€æ ·ç”¨åˆ—è¡¨è§£ææ¥å®ç°å®ƒå‘¢ï¼Ÿ</p>
<p>å®é™…ä¸Šï¼Œ ä½ çš„ä¾‹å­  <code>my @y = ($_**2 + 1 for 1 .. 10);</code>Â  æ˜¯ Raku æ–¹å¼å†™æˆçš„åˆ—è¡¨è§£æã€‚ä½ è¿˜å¯ä»¥æ·»åŠ ä¸€ä¸ªæ¡ä»¶æµ‹è¯•ï¼Œ å°±åƒÂ <a href="http://design.raku.org/S04.html#Loop_statements">Raku design document S04</a> ä¸­å»ºè®®çš„é‚£æ ·ï¼š</p>
<blockquote>
<p>ä¸ºäº†è½»æ¾åœ°ä¹¦å†™åˆ—è¡¨è§£æï¼Œ å¾ªç¯è¯­å¥ä¿®é¥°ç¬¦å…è®¸åŒ…å«å•ä¸ªæ¡ä»¶è¯­å¥ä¿®é¥°ç¬¦ï¼š</p>
</blockquote>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">odd</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$n</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="nv">$n</span> <span class="nv">%</span> <span class="mi">2</span><span class="p">}</span>
<span class="nv">@evens</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$_</span> <span class="o">*</span> <span class="mi">2</span> <span class="k">if</span> <span class="o">.&amp;</span><span class="nf">odd</span> <span class="k">for</span> <span class="mi">0</span><span class="o">..</span><span class="mi">100</span><span class="p">);</span>
</code></pre></div><p>è¿™ä¸ªå°±æ˜¯æ€æ ·å†™ä¸€ä¸ª Raku åˆ—è¡¨è§£æçš„éå¹³æ–¹æ•°ï¼ˆç›´åˆ° 30ï¼‰ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@non_squares</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$_</span> <span class="k">if</span> <span class="o">.</span><span class="nb">sqrt</span> <span class="o">!=</span> <span class="o">.</span><span class="nb">sqrt</span><span class="o">.</span><span class="nb">Int</span> <span class="k">for</span> <span class="mi">1</span> <span class="o">..</span> <span class="mi">30</span><span class="p">);</span>
</code></pre></div><p>ä¸€ä¸¢ä¸¢è§£é‡Šï¼šåœ¨æ¯æ¬¡ for å¾ªç¯è¿­ä»£ä¸­ï¼Œ ä» 1 åˆ° 30 è¿™ä¸ªèŒƒå›´ä¸­çš„å½“å‰æ•°å­—ä¼šè¢«èµ‹å€¼ç»™é»˜è®¤å˜é‡ <code>$_</code>ï¼ˆç­‰ä»·äº itï¼‰ã€‚æ²¡æœ‰è°ƒç”¨è€…çš„æ–¹æ³•è°ƒç”¨ä¼šé»˜è®¤åœ¨ â€œit&quot; èº«ä¸Šè°ƒç”¨ï¼ˆä¾‹å¦‚ <code>.sqrt</code> ç­‰ä»·äº <code>$_.sqrt</code>ï¼‰ã€‚ æ‰€ä»¥ï¼Œå¯¹äº 1åˆ°30ä¸­çš„æ¯ä¸€ä¸ªæ•°å­—ï¼Œå®ƒçš„å¹³æ–¹æ ¹è¢«æ£€æŸ¥ä»¥æŸ¥çœ‹å®ƒæ˜¯å¦æœ‰éæ•´æ•°å¹³æ–¹æ ¹ã€‚ å¦‚æœæ˜¯çœŸï¼Œ é‚£å®ƒå°±è¢«åŒ…å«åœ¨åˆ—è¡¨ä¸­ã€‚</p>
<p>4ã€<a href="http://stackoverflow.com/questions/30982697/print-and-colon-in-perl-6">Raku ä¸­çš„ Print å‡½æ•°å’Œå†’å·</a></p>
<p>æˆ‘æƒ³çŸ¥é“åœ¨ Raku ä¸­å†’å·ä¸æ–¹æ³•å’Œå‡½æ•°è°ƒç”¨æœ‰ä»€ä¹ˆå…³ç³»ã€‚</p>
<p>æˆ‘åœ¨Â <a href="https://github.com/raku/roast/blob/master/S32-io/copy.t">Raku spec test (S32-io)</a>Â ä¸­çœ‹åˆ°äº†è¿™ä¸ª(æˆ‘æ·»åŠ äº†æ³¨é‡Š):</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$fh</span><span class="o">.</span><span class="nb">print</span><span class="o">:</span> <span class="p">&#34;</span><span class="s2">0123456789A</span><span class="p">&#34;;</span>   <span class="c1"># prints &#39;0123456789A&#39; to the file</span>
</code></pre></div><p>æ®æˆ‘æ‰€çŸ¥ï¼Œè¿™ç­‰ä»·äºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$fh</span><span class="o">.</span><span class="nb">print</span><span class="p">(&#34;</span><span class="s2">0123456789A</span><span class="p">&#34;);</span>   <span class="c1"># prints &#39;0123456789A&#39; to the file</span>
</code></pre></div><p>è¿™ä¸¤ç§æ–¹å¼çœ‹èµ·æ¥éƒ½æ¥æ”¶å¤šä¸ªå‚æ•°è€Œä¸”å±•å¹³åˆ—è¡¨ä¹Ÿæ²¡é—®é¢˜ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$fh</span><span class="o">.</span><span class="nb">print</span><span class="o">:</span> <span class="p">&#34;</span><span class="s2">012</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">345</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">6789A</span><span class="p">&#34;;</span>   <span class="c1"># prints &#39;0123456789A&#39; to the file</span>
<span class="nv">$fh</span><span class="o">.</span><span class="nb">print</span><span class="p">(&#34;</span><span class="s2">012</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">345</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">6789A</span><span class="p">&#34;);</span>   <span class="c1"># prints &#39;0123456789A&#39; to the file</span>

<span class="k">my</span> <span class="nv">@a</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">012 345 6789A</span><span class="p">&gt;;</span>

<span class="nv">$fh</span><span class="o">.</span><span class="nb">print</span><span class="p">(</span><span class="nv">@a</span><span class="p">);</span>   <span class="c1"># prints &#39;0123456789A&#39; to the file</span>
<span class="nv">$fh</span><span class="o">.</span><span class="nb">print</span><span class="o">:</span> <span class="nv">@a</span><span class="p">;</span>   <span class="c1"># prints &#39;0123456789A&#39; to the file</span>
</code></pre></div><p>å­˜åœ¨è¿™ä¸¤ç§è¯­æ³•ä¸€å®šæœ‰æŸç§åŸå› ã€‚ ä½¿ç”¨è¿™ç§æˆ–å¦ä¸€ç§è¯­æ³•æœ‰æŸç§ç†ç”±å—ï¼Ÿ</p>
<p>æˆ‘è¿˜æ³¨æ„åˆ°ï¼Œå½“ä½œä¸ºæ–¹æ³•ä½¿ç”¨æ—¶ï¼Œ æˆ‘ä»¬ä¸å¾—ä¸ä½¿ç”¨å¸¦æœ‰ <code>:</code> æˆ– <code>()</code>çš„ printï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$fh</span><span class="o">.</span><span class="nb">print</span><span class="p">(</span><span class="nv">@a</span><span class="p">);</span>   <span class="c1"># Works</span>
<span class="nv">$fh</span><span class="o">.</span><span class="nb">print</span><span class="o">:</span> <span class="nv">@a</span><span class="p">;</span>   <span class="c1"># Works!</span>
<span class="nv">$fh</span><span class="o">.</span><span class="nb">print</span> <span class="nv">@a</span><span class="p">;</span>    <span class="c1"># ERROR!</span>
</code></pre></div><p>å½“ä½¿ç”¨å¸¦å†’å·çš„ print å‡½æ•°æ—¶ï¼Œè¿˜æœ‰ä¸€äº›æœ‰æ„æ€çš„è¡Œä¸ºã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹, ï¼š å’Œ () ä¸ç­‰ä»·ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">print</span> <span class="nv">@a</span><span class="p">;</span>  <span class="c1"># Prints &#39;0123456789A&#39; (no newline, just like Perl 5)</span>
<span class="nb">print</span><span class="p">(</span><span class="nv">@a</span><span class="p">);</span> <span class="c1"># Ditto</span>
<span class="nb">print</span><span class="o">:</span> <span class="nv">@a</span><span class="p">;</span> <span class="c1"># Prints &#39;012 345 6789A&#39; followed by a newline (at least in REPL)</span>

<span class="nb">print</span>  <span class="nv">@a</span><span class="o">,</span> <span class="nv">@a</span><span class="p">;</span> <span class="c1"># Error (Two terms in a row)</span>
<span class="nb">print</span><span class="o">:</span> <span class="nv">@a</span><span class="o">,</span> <span class="nv">@a</span><span class="p">;</span> <span class="c1"># Prints &#39;012 345 6789A 012 345 6789A&#39; followed by a newline (in REPL)</span>
</code></pre></div><p>ç„¶åæˆ‘å°è¯•åœ¨è„šæœ¬æ–‡ä»¶ä¸­ä½¿ç”¨printã€‚è¿™å¯¹äºæ‰“å°åˆ°æ ‡å‡†è¾“å‡ºæœ‰æ•ˆï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">print</span> <span class="nv">@a</span><span class="p">;</span>
</code></pre></div><p>ç„¶è€Œï¼Œ è¿™ä¸ä¼šæ‰“å°åˆ°æ ‡å‡†è¾“å‡ºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">print</span><span class="o">:</span> <span class="nv">@a</span><span class="o">,</span> <span class="nv">@a</span><span class="p">;</span>
</code></pre></div><p>ä½†æ˜¯æ–¹æ³•ç‰ˆæœ¬çš„å·¥ä½œè‰¯å¥½ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$fh</span><span class="o">.</span><span class="nb">print</span><span class="o">:</span> <span class="nv">@a</span><span class="o">,</span> <span class="nv">@a</span><span class="p">;</span> <span class="c1"># Prints &#39;0123456789A0123456789A&#39; to the file</span>
</code></pre></div><p>æˆ‘æ„Ÿè§‰æˆ‘å·²ç»ç†è§£äº†è¿™ä¸ªï¼Œ ä½†æ˜¯ä¸èƒ½ç”¨è¯­è¨€è¡¨è¾¾å‡ºæ¥ã€‚æœ‰äººå¯ä»¥è§£é‡Šä¸‹ä½¿ç”¨ print çš„è¿™äº›å˜åŒ–å—ã€‚ è¿˜æœ‰ï¼Œ è¿™äº›è¡Œä¸ºä¼šå› ä¸º  Great List Refactor è€Œæ”¹å˜å—ï¼Ÿ</p>
<p>Answerï¼š</p>
<p>ä½¿ç”¨å†’å·ä»£æ›¿åœ†æ‹¬å·çš„ä¸€ä¸ªä¸»è¦åŸå› æ˜¯é€šè¿‡ç§»é™¤ä¸€ç»„åœ†æ‹¬å·ï¼Œå®ƒèƒ½ä½¿ä»£ç æ›´æ¸…æ™°ã€‚åœ¨å…¶å®ƒæ–¹é¢å®ƒä»¬çœŸçš„ä¸€æ ·ã€‚</p>
<p>å½“ä½ ä½¿ç”¨ <code>print: @a</code> ï¼Œ é‚£ä½ çœŸæ­£åœ¨åšçš„å°±æ˜¯åœ¨è¡Œä¸Šæ”¾ç½®ä¸€ä¸ªæ ‡ç­¾ï¼Œ å¹¶è®© @a è½è¿›å»ï¼ˆfall-throughï¼‰ã€‚è¿™åœ¨ REPL ä¸­ä¼šè°ƒç”¨å¸¦æœ‰å€¼çš„ say æ–¹æ³•ã€‚</p>
<p>å¦‚æœä½ æ²¡æœ‰åœ¨æ–¹æ³•è°ƒç”¨ä¸­ä½¿ç”¨æ‹¬å·æˆ–å†’å·ï¼Œï¼Œ é‚£ä¹ˆæ–¹æ³•ä¼šä»¥æ— å‚æ•°æ–¹å¼è°ƒç”¨ã€‚</p>
<p>ä½ å¯ä»¥äº¤æ¢æ–¹æ³•çš„é¡ºåºï¼Œè¿˜æœ‰è°ƒç”¨è€…ï¼Œå¦‚æœä½ ä½¿ç”¨å†’å·çš„è¯ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="vg">$*ERR:</span> <span class="p">&#39;</span><span class="s1">hello world</span><span class="p">&#39;;</span> <span class="c1"># $*ERR.say(&#39;hello world&#39;)</span>
</code></pre></div><table>
<thead>
<tr>
<th>æˆ‘åˆšåˆšç¡®è®¤äº†ï¼Œ å°±åƒä½ è¯´çš„ï¼ŒÂ <code>print: @a</code> å°±æ˜¯ <code>label: @a</code>,  Â <code>label</code>Â å¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿.Â â€“Â <a href="http://stackoverflow.com/users/215487/christopher-bottoms">Christopher Bottoms</a>Â <a href="http://stackoverflow.com/questions/30982697/print-and-colon-in-perl-6#comment50169331_30988281">Jun 26 at 14:12</a></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>æ¢å¥è¯è¯´ï¼Œå†’å·èƒ½ä»£æ›¿æ–¹æ³•è°ƒç”¨çš„åœ†æ‹¬å·ï¼Œä½†ä¸èƒ½ä»£æ›¿å­ä¾‹ç¨‹è°ƒç”¨ã€‚Â â€“Â <a href="http://stackoverflow.com/users/215487/christopher-bottoms">Christopher Bottoms</a>Â <a href="http://stackoverflow.com/questions/30982697/print-and-colon-in-perl-6#comment50169347_30988281">Jun 26 at 14:12</a></td>
</tr>
</tbody>
</table>
<p>5ã€<a href="http://stackoverflow.com/questions/31745631/sorting-hash-kv-pairs">æ’åºæ•£åˆ—é”®å€¼å¯¹å„¿</a></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%hash</span> <span class="o">=</span>
    <span class="s">two</span>   <span class="o">=&gt;</span> <span class="mi">2</span>,
    <span class="s">three</span> <span class="o">=&gt;</span> <span class="mi">3</span>,
    <span class="s">one</span>   <span class="o">=&gt;</span> <span class="mi">1</span>,
<span class="p">;</span>

<span class="k">for</span> <span class="nv">%hash</span><span class="o">.</span><span class="nb">sort</span><span class="p">(</span><span class="o">*.</span><span class="nb">key</span><span class="p">)</span><span class="o">Â».</span><span class="nb">kv</span> <span class="k">-&gt;</span> <span class="p">(</span><span class="nv">$key</span><span class="o">,</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">&#39;</span><span class="nv">$key&#39;</span><span class="s2"> =&gt; &#39;</span><span class="nv">$value&#39;</span><span class="p">&#34;;</span>
<span class="p">}</span>
</code></pre></div><p>Â <code>%hash.sort({.key})Â».kv</code>Â å’Œä¸Šé¢çš„  <code>sort</code> ç­‰ä»·å—?</p>
<p>ä¸ºä»€ä¹ˆè¿™ä¸ª sort æ²¡æœ‰ hyperÂ <code>Â»</code>Â  æç¤ºå°±ä¸ä¼šå·¥ä½œ?</p>
<p>è¿™ä¸ª <a href="http://doc.raku.org/routine/sort"><code>sort</code></a>æ–¹æ³•è¿”å›ä¸€ä¸ª <a href="http://doc.raku.org/type/Pair">Pairs</a> çš„åˆ—è¡¨ã€‚</p>
<p>å› ä¸ºåœ¨åˆ—è¡¨èº«ä¸Šè°ƒç”¨ Â <a href="http://doc.raku.org/routine/kv"><code>.kv</code></a> ä¼šè¿”å›ä¸€ä¸ªç´¢å¼•, Pair åˆ—è¡¨, è¿™ä¸æ˜¯ä½ æƒ³è¦çš„; ä½ ä¸èƒ½å•å•åœ¨åˆ—è¡¨èº«ä¸Šè°ƒç”¨  Â <a href="http://doc.raku.org/routine/kv"><code>.kv</code></a> ã€‚æ‰€ä»¥ä½ å¿…é¡»é€šè¿‡åœ¨æ¯ä¸ª Pair èº«ä¸Šè°ƒç”¨ .kv æ–¹æ³•åˆ†åˆ«ä»åˆ—è¡¨ä¸­çš„ Â Â <a href="http://doc.raku.org/type/Pair">Pair</a> ä¸­å–å‡ºé”®å’Œå€¼, è¿™æ­£æ˜¯ Â».kv æ‰€åšçš„ã€‚</p>
<p>ä½ è¿˜å¯ä»¥ä½¿ç”¨ <a href="http://doc.raku.org/routine/map"><code>.map(*.kv)</code></a> ä»£æ›¿ã€‚</p>
<p><code>Â».kv</code> è¯­æ³•å…è®¸æŠŠå·¥ä½œå±•å¼€åˆ°å¤šä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œ, å¦‚æœé‚£æ ·åšæœ‰æ„ä¹‰çš„è¯ã€‚</p>
<p>(å½“å‰çš„ Rakudoä»…ä»¥åŠéšæœºçš„é¡ºåºå·¥ï¼Œ ä»¥é˜²æ­¢äººä»¬é”™è¯¯åœ°ä½¿ç”¨è¯¥ç‰¹æ€§ )</p>
<p>é€šè¿‡åœ¨ç­¾åä¸­ä½¿ç”¨å‰¯è¯ä»¥æå–å±æ€§ï¼Œ è¿™æ˜¯å¦ä¸€ç§ loop å†™æ³•ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="nv">%hash</span><span class="o">.</span><span class="nb">sort</span> <span class="k">-&gt;</span> <span class="p">(</span><span class="o">:</span><span class="nv">$key</span><span class="o">,</span> <span class="o">:</span><span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">&#39;</span><span class="nv">$key&#39;</span><span class="s2"> =&gt; &#39;</span><span class="nv">$value&#39;</span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="k">for</span> <span class="nv">%hash</span><span class="o">.</span><span class="nb">sort</span> <span class="k">-&gt;</span> <span class="nv">$pair</span> <span class="p">(</span><span class="o">:</span><span class="nv">$key</span><span class="o">,</span> <span class="o">:</span><span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$pair</span><span class="p">;</span>
    <span class="nb">say</span> <span class="nv">$key</span> <span class="o">===</span> <span class="nv">$pair</span><span class="o">.</span><span class="nb">key</span> <span class="ow">and</span> <span class="nv">$value</span> <span class="o">===</span> <span class="nv">$pair</span><span class="o">.</span><span class="nb">value</span><span class="p">;</span> <span class="c1"># Trueâ¤</span>
<span class="p">}</span>

<span class="c1"># :$key is short for :key($key)</span>
<span class="k">for</span> <span class="nv">%hash</span><span class="o">.</span><span class="nb">sort</span> <span class="k">-&gt;</span> <span class="p">(:</span><span class="s">key</span><span class="p">(</span><span class="nv">$k</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">value</span><span class="p">(</span><span class="nv">$v</span><span class="p">))</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">&#39;</span><span class="nv">$k&#39;</span><span class="s2"> =&gt; &#39;</span><span class="nv">$v&#39;</span><span class="p">&#34;;</span>
<span class="p">}</span>
</code></pre></div><p>è¿™å¯¹å…¶å®ƒæ²¡æœ‰æ–¹æ³•åˆ›å»ºä¸€ç»„å®ƒä»¬å…¬ç”¨å±æ€§çš„å¯¹è±¡æœ‰ç”¨ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">C</span> <span class="p">{</span> <span class="k">has</span> <span class="nv">$.a</span><span class="p">;</span> <span class="k">has</span> <span class="nv">$.b</span><span class="p">;</span> <span class="k">has</span> <span class="nv">$.c</span><span class="p">;</span> <span class="k">has</span> <span class="nv">$!private-value</span> <span class="p">}</span>
<span class="k">my</span> <span class="nv">$c</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$obj</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="nb">new</span><span class="p">(:</span><span class="s">a</span><span class="p">&lt;</span><span class="s">A</span><span class="p">&gt;</span><span class="o">,</span><span class="p">:</span><span class="s">b</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">,:</span><span class="nv">$c</span><span class="p">);</span>

<span class="k">given</span> <span class="nv">$obj</span> <span class="k">-&gt;</span> <span class="p">(</span> <span class="o">:</span><span class="nv">$a</span><span class="o">,</span> <span class="p">:</span><span class="s">b</span><span class="p">(</span><span class="nv">$b</span><span class="p">)</span><span class="o">,</span> <span class="o">:</span><span class="nv">$c</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$a</span><span class="s2"> </span><span class="nv">$b</span><span class="s2"> </span><span class="nv">$c</span><span class="p">&#34;;</span>   <span class="c1"># A 1 5</span>
<span class="p">}</span>

<span class="c1"># ignore $.a by using an unnamed scalar</span>
<span class="k">given</span> <span class="nv">$obj</span> <span class="k">-&gt;</span> <span class="p">(</span> <span class="p">:</span><span class="s">a</span><span class="p">(</span><span class="nv">$</span><span class="p">)</span><span class="o">,</span> <span class="o">:</span><span class="nv">$b</span><span class="o">,</span> <span class="o">:</span><span class="nv">$c</span> <span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>

<span class="c1"># places any unspecified public attributes in %others</span>
<span class="k">given</span> <span class="nv">$obj</span> <span class="k">-&gt;</span> <span class="p">(</span> <span class="o">:</span><span class="nv">$a</span><span class="o">,</span> <span class="o">:</span><span class="nv">$b</span><span class="o">,</span> <span class="o">*</span><span class="nv">%others</span> <span class="p">)</span> <span class="p">{</span>
    <span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="nb">keys</span> <span class="nv">%others</span><span class="p">;</span> <span class="c1"># câ¤</span>
<span class="p">}</span>

<span class="c1"># å¿½ç•¥ä»»ä½•æœªæŒ‡å®šçš„å±æ€§</span>
<span class="c1"># useful to allow subclasses to add more attributes</span>
<span class="c1"># æˆ–ä»…ä»…ä¸¢å¼ƒæ‰ä»»ä½•ä½ ä¸å…³å¿ƒçš„å€¼</span>
<span class="k">given</span> <span class="nv">$obj</span> <span class="k">-&gt;</span> <span class="p">(</span> <span class="o">:</span><span class="nv">$a</span><span class="o">,</span> <span class="o">:</span><span class="nv">$b</span><span class="o">,</span> <span class="o">*</span><span class="nv">%</span> <span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>

<span class="c1"># å¤±è´¥ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å¤„ç†å…¬ç”¨çš„ c å±æ€§</span>
<span class="c1"># in the sub-signature</span>
<span class="k">given</span> <span class="nv">$obj</span> <span class="k">-&gt;</span> <span class="p">(</span> <span class="o">:</span><span class="nv">$a</span><span class="o">,</span> <span class="o">:</span><span class="nv">$b</span> <span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div><p>å…³äºç­¾åèƒ½åšä»€ä¹ˆï¼Œé‚£åªæ˜¯å¼€å§‹ã€‚</p>
<p>æ‰€æœ‰ä¸‹é¢çš„ï¼Œåœ¨å­ä¾‹ç¨‹å’Œæ–¹æ³•ç­¾åä¸­éƒ½æ˜¯è¢«å…è®¸çš„ï¼Œéå¼ºåˆ¶æ€§çš„ï¼Œ å¯¹äºè¿™ä¸ªä¾‹å­æ€ä¼¤åŠ›è¿‡å¤§ã€‚è¿™åœ¨ multi subs å’Œ multi methods ä¸­å¯¹äºé™åˆ¶å¯èƒ½çš„å€™é€‰è€…çœŸçš„å¾ˆæœ‰ç”¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="p">&#39;</span><span class="s1">one</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span>
<span class="k">-&gt;</span>
  <span class="c1"># Type is an alias to the object type</span>
  <span class="o">:</span><span class="p">:</span><span class="s">Type</span> <span class="nb">Any</span> <span class="nv">$_</span> <span class="c1"># Any is the default type requirement</span>

  <span class="c1"># the public attributes of the object</span>
  <span class="p">(</span>
    <span class="o">:</span><span class="p">:</span><span class="s">A-Type</span> <span class="nb">Any</span> <span class="p">:</span><span class="s">key</span><span class="p">(</span>   <span class="p">:</span><span class="s">numerator</span><span class="p">(</span>   <span class="nv">$a</span> <span class="p">)</span> <span class="p">)</span><span class="o">,</span>
    <span class="o">:</span><span class="p">:</span><span class="s">B-Type</span> <span class="nb">Any</span> <span class="p">:</span><span class="s">value</span><span class="p">(</span> <span class="p">:</span><span class="s">denominator</span><span class="p">(</span> <span class="nv">$b</span> <span class="p">)</span> <span class="p">)</span> <span class="k">where</span> <span class="nv">$b</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="o">,</span>
  <span class="p">)</span>
<span class="p">{</span>
  <span class="k">my</span> <span class="n">Type</span> <span class="nv">$obj</span> <span class="o">=</span> <span class="nv">$_</span><span class="p">;</span> <span class="c1"># new variable declared as having the same type</span>
  <span class="k">my</span> <span class="n">A-Type</span> <span class="nv">$new-a</span> <span class="o">=</span> <span class="nv">$a</span><span class="p">;</span>
  <span class="k">my</span> <span class="n">B-Type</span> <span class="nv">$new-b</span> <span class="o">=</span> <span class="nv">$b</span><span class="p">;</span>

  <span class="c1"># could have used $_.^name or .^name instead of Type.^name</span>
  <span class="c1"># so you don&#39;t actually have to add the alias to the signature</span>
  <span class="c1"># to get the name of the arguments type</span>
  <span class="nb">say</span> <span class="n">Type</span><span class="o">.^</span><span class="nb">name</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1"> </span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$_</span><span class="p">;</span>
  <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">  </span><span class="p">&#39;</span><span class="o">,</span> <span class="n">A-Type</span><span class="o">.^</span><span class="nb">name</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1"> </span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$a</span><span class="p">;</span>
  <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">  </span><span class="p">&#39;</span><span class="o">,</span> <span class="n">B-Type</span><span class="o">.^</span><span class="nb">name</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1"> </span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$b</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">Pair</span> <span class="s">one</span> <span class="o">=&gt;</span> <span class="mi">1</span>
  <span class="nb">Str</span> <span class="nb">one</span>
  <span class="nb">Int</span> <span class="mi">1</span>
<span class="nb">Rat</span> <span class="mf">0.333333</span>
  <span class="nb">Int</span> <span class="mi">1</span>
  <span class="nb">Int</span> <span class="mi">3</span>
</code></pre></div><p>è‡³äºä½¿ç”¨Â <a href="http://doc.raku.org/routine/sort"><code>.sort({.key})</code></a>, æ©, é‚£ä»æ ¹æœ¬ä¸Šæ¥è¯´æ˜¯åŒä¸€ä¸ªä¸œè¥¿, å› ä¸º <a href="http://doc.raku.org/routine/sort"><code>sort</code></a>Â  åœ¨é‚£å„¿æ¥å—ä»»ä½• <a href="http://doc.raku.org/type/Callable">Callable</a>Â </p>
<p>æˆ‘è¦æŒ‡å‡º, ä½ ç”šè‡³ä¸éœ€è¦ä¸º <a href="http://doc.raku.org/routine/sort"><code>sort</code></a>Â æä¾›å‚æ•°, å› ä¸ºå®ƒé»˜è®¤æ¯”ä½ ç»™å®ƒçš„ä¸œè¥¿æ™ºèƒ½ã€‚</p>
<p>Raku æœ‰å¾ˆå¤šåˆ›å»ºå’Œè®¿é—® <a href="http://doc.raku.org/type/Callable">Callable</a>Â ä¸œè¥¿çš„æ–¹å¼ã€‚æ‰€ä»¥ä»»ä½•ä¸‹é¢ä¸€ç§éƒ½å¯ä»¥å·¥ä½œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">*.</span><span class="nb">key</span>
<span class="p">{</span> <span class="o">.</span><span class="nb">key</span> <span class="p">}</span> <span class="c1"># { $_.key }</span>
<span class="k">-&gt;</span> <span class="nv">$_</span> <span class="p">{</span> <span class="o">.</span><span class="nb">key</span> <span class="p">}</span> <span class="c1"># basically what the previous line turns into</span>
<span class="p">{</span> <span class="nv">$^placeholder-var</span><span class="o">.</span><span class="nb">key</span> <span class="p">}</span>
<span class="k">sub</span> <span class="p">(</span><span class="nv">$_</span><span class="p">)</span> <span class="p">{</span> <span class="o">.</span><span class="nb">key</span> <span class="p">}</span>
<span class="nv">&amp;a-subroutine-reference</span> <span class="c1"># you would have to create the subroutine though</span>
</code></pre></div><p>è¿˜æœ‰ï¼Œ å› ä¸ºæ‰€æœ‰æ™®é€šçš„æ“ä½œç¬¦å®é™…ä¸Šéƒ½æ˜¯å­ä¾‹ç¨‹ï¼Œä½ å¯ä»¥åœ¨éœ€è¦ Â <a href="http://doc.raku.org/type/Callable">Callable</a> çš„å…¶å®ƒåœ°æ–¹ä½¿ç”¨å®ƒä»¬ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">&amp;infix:</span><span class="p">&lt;</span><span class="s">+</span><span class="p">&gt;</span> <span class="c1"># the subroutines responsible for the numeric addition operator</span>
<span class="o">&amp;[+]</span> <span class="c1"># ditto</span>

<span class="nv">&amp;prefix:</span><span class="p">&lt;</span><span class="s">++</span><span class="p">&gt;</span>
<span class="nv">&amp;postfix:</span><span class="p">&lt;</span><span class="s">++</span><span class="p">&gt;</span>

<span class="c1"># etc</span>
</code></pre></div><ul>
<li><input disabled="" type="checkbox"> å’Œ ( ) çš„åŒºåˆ«</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># æ— æ³•æ­£å¸¸æ’åº</span>
<span class="k">my</span>  <span class="nv">@s</span> <span class="o">=</span> <span class="o">[</span><span class="mi">2443</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">33</span><span class="o">,</span> <span class="mi">90</span><span class="o">,</span> <span class="o">-</span><span class="mi">9</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">764</span><span class="o">]</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">@s</span><span class="o">.</span><span class="nb">sort</span><span class="p">;</span>     <span class="c1"># 2443 5 33 90 -9 2 764</span>
<span class="nb">say</span> <span class="nv">@s</span><span class="o">.</span><span class="nb">WHAT</span><span class="p">;</span>     <span class="c1"># (Array)</span>
<span class="nb">say</span> <span class="nv">@s</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>     <span class="c1"># [[2443, 5, 33, 90, -9, 2, 764]]&lt;&gt;</span>

<span class="c1"># æ­£å¸¸æ’åº</span>
<span class="k">my</span>  <span class="nv">$array</span> <span class="o">=</span> <span class="o">[</span><span class="mi">2443</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">33</span><span class="o">,</span> <span class="mi">90</span><span class="o">,</span> <span class="o">-</span><span class="mi">9</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">764</span><span class="o">]</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$array</span><span class="o">.</span><span class="nb">sort</span><span class="p">;</span> <span class="c1">#  -9 2 5 33 90 764 2443</span>
<span class="nb">say</span> <span class="nv">$array</span><span class="o">.</span><span class="nb">WHAT</span><span class="p">;</span> <span class="c1"># (Array)</span>
<span class="nb">say</span> <span class="nv">$array</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span> <span class="c1"># [2443, 5, 33, 90, -9, 2, 764]</span>

<span class="k">my</span>  <span class="nv">@s</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2443</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">33</span><span class="o">,</span><span class="mi">90</span><span class="o">,-</span><span class="mi">9</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">764</span><span class="p">);</span>
<span class="nb">say</span> <span class="nv">@s</span><span class="o">.</span><span class="nb">sort</span><span class="p">;</span>     <span class="c1"># -9 2 5 33 90 764 2443</span>
<span class="nb">say</span> <span class="nv">$array</span><span class="o">.</span><span class="nb">WHAT</span><span class="p">;</span> <span class="c1"># (Array)</span>
<span class="nb">say</span> <span class="nv">@s</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>     <span class="c1"># [2443, 5, 33, 90, -9, 2, 764]&lt;&gt;</span>
</code></pre></div><p>å¯è§, ä½¿ç”¨ <code>[ ]</code> å’Œ <code>( )</code> åˆ›å»ºæ•°ç»„æ˜¯ä¸ä¸€æ ·çš„.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@s</span> <span class="o">=</span> <span class="o">[</span><span class="mi">2443</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">33</span><span class="o">,</span> <span class="mi">90</span><span class="o">,</span> <span class="o">-</span><span class="mi">9</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">764</span><span class="o">]</span><span class="p">;</span>
</code></pre></div><p>è¿™åˆ›å»ºäº†ä¸€ä¸ªæ•°ç»„, å¹¶æŠŠè¯¥æ•°ç»„èµ‹å€¼ç»™ <code>@s[0]</code>, æ‰€ä»¥ <code>@s</code> åªæœ‰ä¸€ä¸ªå…ƒç´ , æ‰€ä»¥å¯¹ <code>@s</code> è¿›è¡Œæ’åºæ˜¯æ²¡æœ‰æ„ä¹‰çš„. ç„¶è€Œä½ å¯ä»¥ä½¿ç”¨:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@s</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="nb">sort</span><span class="o">.</span><span class="nb">say</span>
</code></pre></div><p>æ¥å®ç°ä½ è¦æ±‚çš„æ’åºã€‚</p>
<ul>
<li><a href="http://stackoverflow.com/questions/37979519/how-do-i-chain-to-an-inline-block-in-perl-6">How do I chain to an inline block in Raku?</a></li>
</ul>
<p>æˆ‘æƒ³ä¿®æ”¹ä¸€ä¸ªæ•°ç»„(æˆ‘åœ¨è¿™ä¸ªä¾‹å­ä¸­ä½¿ç”¨äº† <code>splice</code>, ä½†æ˜¯å®ƒä¹Ÿå¯èƒ½æ˜¯ä¿®æ”¹æ•°ç»„çš„ä»»ä½•æ“ä½œ)å¹¶è¿”å›ä¿®æ”¹åçš„æ•°ç»„ - å’Œ <code>slice</code> ä¸ä¸€æ ·, slice è¿”å›çš„æ˜¯ä»æ•°ç»„ä¸­æŠ å‡ºçš„é¡¹ã€‚æˆ‘å¯ä»¥å¾ˆå®¹æ˜“åœ°é€šè¿‡åœ¨æ•°ç»„ä¸­å­˜å‚¨ä¸€ä¸ª block æ¥åšåˆ°, å°±åƒä¸‹é¢è¿™æ ·:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$1</span> <span class="o">=</span> <span class="k">-&gt;</span> <span class="nv">$a</span> <span class="p">{</span> <span class="nb">splice</span><span class="p">(</span><span class="nv">$a</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">3</span><span class="o">,[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">]</span><span class="p">);</span> <span class="nv">$a</span> <span class="p">};</span>
<span class="nb">say</span> <span class="p">(</span><span class="o">^</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span> <span class="p">{</span> <span class="nv">$_</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="o">??</span> <span class="mi">0</span> <span class="o">!!</span> <span class="nv">$_</span> <span class="p">}</span> <span class="p">)</span><span class="o">.</span><span class="nb">Array</span><span class="p">;</span>
<span class="c1"># [0 0 0 0 4 5]</span>
<span class="nb">say</span> <span class="p">(</span><span class="o">^</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span> <span class="p">{</span> <span class="nv">$_</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="o">??</span> <span class="mi">0</span> <span class="o">!!</span> <span class="nv">$_</span> <span class="p">}</span> <span class="p">)</span><span class="o">.</span><span class="nb">Array</span><span class="o">.</span><span class="nv">$1</span><span class="p">;</span>
<span class="c1"># [0 1 2 3 4 5]</span>
</code></pre></div><p>æˆ‘æ€ä¹ˆæŠŠç”± <code>$1</code> ä»£è¡¨çš„ block å†…è”åˆ°å•ä¸ªè¡¨è¾¾å¼ä¸­å‘¢ï¼Ÿ ä¸‹é¢çš„è§£å†³æ–¹æ³•ä¸æ­£ç¡®:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">(</span><span class="o">^</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span> <span class="p">{</span> <span class="nv">$_</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="o">??</span> <span class="mi">0</span> <span class="o">!!</span> <span class="nv">$_</span> <span class="p">}</span> <span class="p">)</span><span class="o">.</span><span class="nb">Array</span><span class="o">.</span><span class="p">(</span><span class="k">-&gt;</span> <span class="nv">$a</span> <span class="p">{</span> <span class="nb">splice</span><span class="p">(</span><span class="nv">$a</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">3</span><span class="o">,[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">]</span><span class="p">);</span> <span class="nv">$a</span> <span class="p">})</span>
<span class="n">Invocant</span> <span class="n">requires</span> <span class="n">a</span> <span class="nb">type</span> <span class="n">object</span> <span class="k">of</span> <span class="nb">type</span> <span class="nb">Array</span><span class="o">,</span> <span class="k">but</span> <span class="nc">an</span> <span class="n">object</span> <span class="n">instance</span> <span class="n">was</span> <span class="n">passed</span><span class="o">.</span>  <span class="n">Did</span> <span class="n">you</span> <span class="n">forget</span> <span class="n">a</span> <span class="p">&#39;</span><span class="s1">multi</span><span class="p">&#39;</span><span class="o">?</span>
</code></pre></div><p>è§£å†³æ–¹æ³•æ˜¯æ·»åŠ ä¸€ä¸ª <code>&amp;</code> ç¬¦å·:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">(</span><span class="o">^</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span> <span class="p">{</span> <span class="nv">$_</span> <span class="o">&lt;</span> <span class="mi">4</span> <span class="o">??</span> <span class="mi">0</span> <span class="o">!!</span> <span class="nv">$_</span> <span class="p">}</span> <span class="p">)</span><span class="o">.</span><span class="nb">Array</span><span class="o">.&amp;</span><span class="p">(</span><span class="k">-&gt;</span> <span class="nv">$a</span> <span class="p">{</span> <span class="nb">splice</span><span class="p">(</span><span class="nv">$a</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">3</span><span class="o">,[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">]</span><span class="p">);</span> <span class="nv">$a</span> <span class="p">})</span>
<span class="c1"># è¾“å‡º [0 1 2 3 4 5]</span>
</code></pre></div><ul>
<li><a href="http://stackoverflow.com/questions/38535690/getting-a-positional-slice-using-a-range-variable-as-a-subscript">Getting a positional slice using a Range variable as a subscript</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@numbers</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">4 8 16 16 23 42</span><span class="p">&gt;;</span>
<span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="nv">@numbers</span><span class="o">[</span><span class="mi">0</span><span class="o">..</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span> <span class="c1"># this works</span>
<span class="c1"># 4</span>
<span class="c1"># 8</span>
<span class="c1"># 15</span>

<span class="c1"># but this doesn&#39;t</span>
<span class="k">my</span> <span class="nv">$range</span> <span class="o">=</span> <span class="mi">0</span><span class="o">..</span><span class="mi">2</span><span class="p">;</span>
<span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="nv">@numbers</span><span class="o">[</span><span class="nv">$range</span><span class="o">]</span><span class="p">;</span>
<span class="c1"># 16</span>
</code></pre></div><p>æœ€åçš„é‚£ä¸ªä¸‹æ ‡çœ‹èµ·æ¥å¥½åƒæŠŠ <code>$range</code> è§£é‡Šä¸º range ä¸­å…ƒç´ çš„ä¸ªæ•°(3)ã€‚æ€ä¹ˆå›äº‹?</p>
<p><strong>è§£å†³æ–¹æ³•</strong></p>
<p>ä½¿ç”¨ <code>@numbers[|$range]</code> æŠŠ range å¯¹è±¡å±•å¹³åˆ°åˆ—è¡¨ä¸­ã€‚æˆ–è€…åœ¨ <strong>Range</strong> å¯¹è±¡ä¸Šä½¿ç”¨ç»‘å®šæ¥ä¼ é€’å®ƒä»¬ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># On Fri Jul 2016, gfldex wrote:</span>
<span class="k">my</span> <span class="nv">@numbers</span> <span class="o">=</span>  <span class="p">&lt;</span><span class="s">4 8 15 16 23 42</span><span class="p">&gt;;</span> <span class="k">my</span> <span class="nv">$range</span> <span class="o">=</span> <span class="mi">0</span><span class="o">..</span><span class="mi">2</span><span class="p">;</span> <span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="nv">@numbers</span><span class="o">[</span><span class="nv">$range</span><span class="o">]</span><span class="p">;</span>

<span class="c1"># OUTPUTÂ«16Â»</span>
<span class="c1"># expected:</span>
<span class="c1"># OUTPUTÂ«4\n 8\n 15Â»</span>


<span class="c1"># è¿™æ˜¯å¯¹çš„, å¹¶ä¸”è¿˜è·Ÿ &#34;Scalar container implies item&#34; è§„åˆ™æœ‰å…³.</span>
<span class="c1"># Changing it would break things like the second evaluation here:</span>

<span class="k">my</span> <span class="nv">@x</span> <span class="o">=</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">;</span> <span class="k">my</span> <span class="nv">@y</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">..</span><span class="mi">3</span><span class="p">;</span> <span class="nv">@x</span><span class="o">[</span><span class="nv">@y</span><span class="o">]</span>
<span class="c1"># (2 3 4)</span>

<span class="nv">@x</span><span class="o">[</span><span class="nb">item</span> <span class="nv">@y</span><span class="o">]</span>
<span class="c1"># 4</span>

<span class="c1"># æ³¨æ„åœ¨ç­¾åä¸­ range å¯ä»¥è¢«ç»‘å®šç»™ @y, è€Œç‰¹æ®Šçš„ Range å¯ä»¥ç”Ÿæˆä¸€ä¸ªåƒ @x[$(@arr-param)] çš„è¡¨è¾¾å¼</span>
<span class="c1"># è¿™åœ¨å®ƒçš„è¯­ä¹‰ä¸­æ˜¯ä¸å¯é¢„æœŸçš„ã€‚</span>

<span class="c1"># åŒæ ·, ç»‘å®šç»™ $range ä¹Ÿèƒ½æä¾›é¢„æœŸçš„ç»“æœ</span>
<span class="k">my</span> <span class="nv">@numbers</span> <span class="o">=</span>  <span class="p">&lt;</span><span class="s">4 8 15 16 23 42</span><span class="p">&gt;;</span> <span class="k">my</span> <span class="nv">$range</span> <span class="o">:=</span> <span class="mi">0</span><span class="o">..</span><span class="mi">2</span><span class="p">;</span> <span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="nv">@numbers</span><span class="o">[</span><span class="nv">$range</span><span class="o">]</span><span class="p">;</span>
<span class="c1"># OUTPUTÂ«4â¤8â¤15â¤Â»</span>

<span class="c1"># è¿™ä¹Ÿæ˜¯é¢„æœŸçš„ç»“æœ, å› ä¸ºä½¿ç”¨ç»‘å®šå°±æ²¡æœ‰æ ‡é‡å®¹å™¨æ¥å¼ºåˆ¶è¢«å½“æˆä¸€ä¸ª item äº†ã€‚</span>
<span class="c1"># So, all here is working as designed.</span>
</code></pre></div><p>æˆ–è€…ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="nv">@numbers</span><span class="o">[</span><span class="nv">@</span><span class="p">(</span><span class="nv">$range</span><span class="p">)</span><span class="o">]</span>
<span class="c1"># 4</span>
<span class="c1"># 8</span>
<span class="c1"># 15</span>
</code></pre></div><p>ç»‘å®šåˆ°æ ‡é‡å®¹å™¨çš„ç¬¦å·è¾“å‡ºä¸€ä¸ªä¸œè¥¿, å¯ä»¥è¾¾åˆ°ä½ æƒ³è¦çš„é€‰æ‹©åŒ…å«ï¼š</p>
<p>å‰ç½®ä¸€ä¸ª <code>@</code> ç¬¦å·æ¥å¾—åˆ°å•ä¸ªä¸œè¥¿çš„å¤æ•°å½¢å¼ï¼š<code>numbers[@$range];</code> æˆ–è€…ä»¥ä¸åŒçš„å½¢å¼æ¥å£°æ˜ ragne å˜é‡, ä»¥ä½¿å®ƒç›´æ¥å·¥ä½œã€‚
å¯¹äºåè€…, è€ƒè™‘ä¸‹é¢çš„å½¢å¼:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># Bind the symbol `numbers` to the value 1..10:</span>
<span class="k">my</span> <span class="nv">\numbers</span> <span class="o">=</span> <span class="o">[</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">6</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="mi">9</span><span class="o">,</span><span class="mi">10</span><span class="o">]</span><span class="p">;</span>

<span class="c1"># Bind the symbol `rangeA` to the value 1..10:</span>
<span class="k">my</span> <span class="nv">\rangeA</span>  <span class="o">:=</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">;</span>
<span class="c1"># Bind the symbol `rangeB` to the value 1..10:</span>
<span class="k">my</span> <span class="nv">\rangeB</span>   <span class="o">=</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">;</span>

<span class="c1"># Bind the symbol `$rangeC` to the value 1..10:</span>
<span class="k">my</span> <span class="nv">$rangeC</span>  <span class="o">:=</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">;</span>

<span class="c1"># Bind the symbol `$rangeD` to a Scalar container</span>
<span class="c1"># and then store the value 1..10 in it:`</span>
<span class="k">my</span> <span class="nv">$rangeD</span>   <span class="o">=</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">;</span>

<span class="c1"># Bind the symbol `@rangeE` to the value 1..10:</span>
<span class="k">my</span> <span class="nv">@rangeE</span>  <span class="o">:=</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">;</span>

<span class="c1"># Bind the symbol `@rangeF` to an Array container and then</span>
<span class="c1"># store 1 thru 10 in the Scalar containers 1 thru 10 inside the Array</span>
<span class="k">my</span> <span class="nv">@rangeF</span>   <span class="o">=</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">;</span>

<span class="nb">say</span> <span class="n">numbers</span><span class="o">[</span><span class="n">rangeA</span><span class="o">]</span><span class="p">;</span>  <span class="c1"># (1 2 3 4 5 6 7 8 9 10)</span>
<span class="nb">say</span> <span class="n">numbers</span><span class="o">[</span><span class="n">rangeB</span><span class="o">]</span><span class="p">;</span>  <span class="c1"># (1 2 3 4 5 6 7 8 9 10)</span>
<span class="nb">say</span> <span class="n">numbers</span><span class="o">[</span><span class="nv">$rangeC</span><span class="o">]</span><span class="p">;</span> <span class="c1"># (1 2 3 4 5 6 7 8 9 10)</span>
<span class="nb">say</span> <span class="n">numbers</span><span class="o">[</span><span class="nv">$rangeD</span><span class="o">]</span><span class="p">;</span> <span class="c1"># 10</span>
<span class="nb">say</span> <span class="n">numbers</span><span class="o">[</span><span class="nv">@rangeE</span><span class="o">]</span><span class="p">;</span> <span class="c1"># (1 2 3 4 5 6 7 8 9 10)</span>
<span class="nb">say</span> <span class="n">numbers</span><span class="o">[</span><span class="nv">@rangeF</span><span class="o">]</span><span class="p">;</span> <span class="c1"># (1 2 3 4 5 6 7 8 9 10)</span>
</code></pre></div><p>ç»‘å®šåˆ°æ ‡é‡å®¹å™¨(<code>$rangeD</code>)ä¸Šçš„ç¬¦å·æ€»æ˜¯äº§ç”Ÿå•ä¸ªå€¼ã€‚åœ¨ <code>[...]</code> ä¸‹æ ‡ä¸­å•ä¸ªå€¼å¿…é¡»æ˜¯æ•°å­—ã€‚
å¯¹äº range, è¢«å½“ä½œå•ä¸ªæ•°å­—æ—¶, äº§ç”Ÿçš„æ˜¯ range çš„é•¿åº¦ã€‚</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/notes" term="notes" label="notes" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä¸­çš„ given/when æ¨¡å¼åŒ¹é…]]></title>
            <link href="https://ohmyweekly.github.io/notes/2016-02-06-given-when-pattern-match-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2015-03-15-when-and-where/?utm_source=atom_feed" rel="related" type="text/html" title="When and Where" />
            
                <id>https://ohmyweekly.github.io/notes/2016-02-06-given-when-pattern-match-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Given When Pattern Match in Raku</blockquote><h3 id="æ¨¡å¼åŒ¹é…">æ¨¡å¼åŒ¹é…</h3>
<p>åŒ¹é…å•ä¸ªå­—ç¬¦ä¸²:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$name</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">twostraws</span><span class="p">&#34;;</span>

<span class="k">given</span> <span class="nv">$name</span> <span class="p">{</span>
    <span class="k">when</span> <span class="p">&#34;</span><span class="s2">bilbo</span><span class="p">&#34;</span>      <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hello, Bilbo Baggins!</span><span class="p">&#34;}</span>
    <span class="k">when</span> <span class="p">&#34;</span><span class="s2">twostraws</span><span class="p">&#34;</span>  <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hello, Paul Hudson!</span><span class="p">&#34;</span>  <span class="p">}</span>
    <span class="k">default</span>           <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">èº«ä»½éªŒè¯å¤±è´¥</span><span class="p">&#34;</span>           <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>åŒ¹é…å…ƒç»„:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$bool1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$bool2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="k">given</span> <span class="p">(</span><span class="nv">$bool1</span><span class="o">,</span> <span class="nv">$bool2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">when</span> <span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">0, 0</span><span class="p">&#34;}</span>
    <span class="k">when</span> <span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">0, 1</span><span class="p">&#34;}</span>
    <span class="k">when</span> <span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">1, 0</span><span class="p">&#34;}</span>
    <span class="k">when</span> <span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">1, 1</span><span class="p">&#34;}</span>
<span class="p">}</span>

<span class="k">given</span> <span class="p">(&#34;</span><span class="s2">15</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">example</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">3.14</span><span class="p">&#34;)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$_</span><span class="o">.</span><span class="nb">WHAT</span><span class="p">;</span>
    <span class="k">when</span> <span class="p">(</span><span class="nv">$</span><span class="o">,</span> <span class="nv">$</span><span class="o">,</span> <span class="nb">Str</span><span class="p">)</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">I got a String of </span><span class="nv">$_</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">given</span> <span class="p">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">when</span> <span class="p">(</span> <span class="nv">$</span><span class="o">,</span>  <span class="nv">$</span><span class="p">)</span> <span class="p">{</span><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Ok</span><span class="p">&#34;}</span>
<span class="p">}</span>

<span class="k">given</span> <span class="p">(&#34;</span><span class="s2">fly.mp3</span><span class="p">&#34;</span><span class="o">,</span> <span class="mi">34</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">It&#39;s funny</span><span class="p">&#34;)</span> <span class="p">{</span>
    <span class="k">when</span> <span class="p">(/</span><span class="ni">.</span><span class="sr">mp</span><span class="mi">3</span><span class="ni">$</span><span class="p">/</span><span class="o">,</span> <span class="p">/</span><span class="mi">4</span><span class="ni">$</span><span class="p">/</span><span class="o">,</span> <span class="o">*.</span><span class="nb">chars</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Perfact</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">given</span> <span class="mi">5</span> <span class="p">{</span>
    <span class="k">when</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">1..10 contains 5</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="åŒæ—¶æ£€æŸ¥åå­—å’Œå¯†ç ">åŒæ—¶æ£€æŸ¥åå­—å’Œå¯†ç </h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$name</span>     <span class="o">=</span> <span class="p">&#34;</span><span class="s2">twostraws</span><span class="p">&#34;;</span>
<span class="k">my</span> <span class="nv">$password</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;;</span>

<span class="k">given</span> <span class="p">(</span><span class="nv">$name</span><span class="o">,</span> <span class="nv">$password</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">when</span> <span class="p">(&#34;</span><span class="s2">bilbo</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">bagg1n5</span><span class="p">&#34;)</span>      <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hello, Bilbo Baggins!</span><span class="p">&#34;</span> <span class="p">}</span>
    <span class="k">when</span> <span class="p">(&#34;</span><span class="s2">twostraws</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;)</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hello, Paul Hudson!</span><span class="p">&#34;</span>   <span class="p">}</span>
    <span class="k">default</span>                        <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">ä½ æ˜¯è°?</span><span class="p">&#34;</span>                <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="ä½¿ç”¨å•ä¸ªå…ƒç»„">ä½¿ç”¨å•ä¸ªå…ƒç»„</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$authentication</span> <span class="o">=</span> <span class="p">(&#34;</span><span class="s2">twostraws</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;);</span>

<span class="k">given</span> <span class="nv">$authentication</span> <span class="p">{</span>
    <span class="k">when</span> <span class="p">(&#34;</span><span class="s2">bilbo</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">bagg1n5</span><span class="p">&#34;)</span>      <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hello, Bilbo Baggins!</span><span class="p">&#34;</span> <span class="p">}</span>
    <span class="k">when</span> <span class="p">(&#34;</span><span class="s2">twostraws</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;)</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hello, Paul Hudson!</span><span class="p">&#34;</span>   <span class="p">}</span>
    <span class="k">default</span>                        <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">ä½ æ˜¯è°?</span><span class="p">&#34;</span>                <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="éƒ¨åˆ†åŒ¹é…">éƒ¨åˆ†åŒ¹é…</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># ä½ åªå…³å¿ƒæŸäº›æ„Ÿå…´è¶£çš„å€¼ï¼Œä¸å…³å¿ƒå…¶å®ƒå€¼ï¼Œä½¿ç”¨ `*` å·æˆ– `$` æ¥ä»£è¡¨ &#34;any value is fine&#34;</span>
<span class="k">my</span> <span class="nv">$authentication</span> <span class="o">=</span> <span class="p">(&#34;</span><span class="s2">twostraws</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">127.0.0.1</span><span class="p">&#34;);</span>

<span class="k">given</span> <span class="nv">$authentication</span> <span class="p">{</span>
    <span class="k">when</span> <span class="p">(&#34;</span><span class="s2">bilbo</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">bagg1n5</span><span class="p">&#34;</span><span class="o">,</span> <span class="o">*</span><span class="p">)</span>      <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hello, Bilbo Baggins!</span><span class="p">&#34;}</span>
    <span class="k">when</span> <span class="p">(&#34;</span><span class="s2">twostraws</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;</span><span class="o">,</span> <span class="nv">$</span><span class="p">)</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hello, Paul Hudson!</span><span class="p">&#34;</span>  <span class="p">}</span>
    <span class="k">default</span>                           <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Who are you?</span><span class="p">&#34;</span>         <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="åªåŒ¹é…å…ƒç»„çš„ä¸€éƒ¨åˆ†">åªåŒ¹é…å…ƒç»„çš„ä¸€éƒ¨åˆ†</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># ä½†ä»ç„¶æƒ³çŸ¥é“å…¶å®ƒéƒ¨åˆ†æ˜¯ä»€ä¹ˆ</span>
<span class="k">my</span> <span class="nv">$authentication</span> <span class="o">=</span> <span class="p">(&#34;</span><span class="s2">twostraws</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;);</span>

<span class="k">given</span> <span class="nv">$authentication</span> <span class="p">{</span>
    <span class="k">when</span> <span class="p">(&#34;</span><span class="s2">bilbo</span><span class="p">&#34;</span><span class="o">,</span> <span class="o">*</span><span class="p">)</span>     <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hello, Bilbo Baggins!</span><span class="p">&#34;</span> <span class="p">}</span>
    <span class="k">when</span> <span class="p">(&#34;</span><span class="s2">twostraws</span><span class="p">&#34;</span><span class="o">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hello, Paul Hudson: your password was </span><span class="nv">$_</span><span class="s2">!</span><span class="p">&#34;</span> <span class="p">}</span>
    <span class="k">default</span>               <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Who are you?</span><span class="p">&#34;</span>         <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="åŒ¹é…è®¡ç®—å‹å…ƒç»„">åŒ¹é…è®¡ç®—å‹å…ƒç»„</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">fizzbuzz</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$number</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Str</span> <span class="p">{</span>
    <span class="k">given</span> <span class="p">(</span><span class="nv">$number</span> <span class="nv">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="o">,</span> <span class="nv">$number</span> <span class="nv">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">when</span> <span class="p">(</span><span class="nb">True</span><span class="o">,</span> <span class="nb">False</span><span class="p">)</span>  <span class="p">{</span> <span class="k">return</span> <span class="p">&#34;</span><span class="s2">Fizz</span><span class="p">&#34;</span>     <span class="p">}</span>
        <span class="k">when</span> <span class="p">(</span><span class="nb">False</span><span class="o">,</span> <span class="nb">True</span><span class="p">)</span>  <span class="p">{</span> <span class="k">return</span> <span class="p">&#34;</span><span class="s2">Buzz</span><span class="p">&#34;</span>     <span class="p">}</span>
        <span class="k">when</span> <span class="p">(</span><span class="nb">True</span><span class="o">,</span> <span class="nb">True</span><span class="p">)</span>   <span class="p">{</span> <span class="k">return</span> <span class="p">&#34;</span><span class="s2">FizzBuzz</span><span class="p">&#34;</span> <span class="p">}</span>
        <span class="k">when</span> <span class="p">(</span><span class="nb">False</span><span class="o">,</span> <span class="nb">False</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$number</span><span class="o">.</span><span class="nb">Str</span><span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="nf">fizzbuzz</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</code></pre></div><h3 id="éå†å…ƒç»„">éå†å…ƒç»„</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$twostraws</span> <span class="o">=</span> <span class="p">(&#34;</span><span class="s2">twostraws</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;);</span>
<span class="k">my</span> <span class="nv">$bilbo</span> <span class="o">=</span> <span class="p">(&#34;</span><span class="s2">bilbo</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">bagg1n5</span><span class="p">&#34;);</span>
<span class="k">my</span> <span class="nv">$taylor</span> <span class="o">=</span> <span class="p">(&#34;</span><span class="s2">taylor</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;);</span>
<span class="k">my</span> <span class="nv">@users</span> <span class="o">=</span> <span class="nv">$twostraws</span><span class="o">,</span> <span class="nv">$bilbo</span><span class="o">,</span> <span class="nv">$taylor</span><span class="p">;</span>

<span class="k">for</span> <span class="nv">@users</span> <span class="k">-&gt;</span> <span class="nv">$user</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$user</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><h3 id="ä½¿ç”¨-when-åŒ¹é…å…ƒç»„ä¸­çš„æŒ‡å®šå€¼">ä½¿ç”¨ when åŒ¹é…å…ƒç»„ä¸­çš„æŒ‡å®šå€¼</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$twostraws</span> <span class="o">=</span> <span class="p">(&#34;</span><span class="s2">twostraws</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;);</span>
<span class="k">my</span> <span class="nv">$bilbo</span> <span class="o">=</span> <span class="p">(&#34;</span><span class="s2">bilbo</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">bagg1n5</span><span class="p">&#34;);</span>
<span class="k">my</span> <span class="nv">$taylor</span> <span class="o">=</span> <span class="p">(&#34;</span><span class="s2">taylor</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;);</span>
<span class="k">my</span> <span class="nv">@users</span> <span class="o">=</span> <span class="nv">$twostraws</span><span class="o">,</span> <span class="nv">$bilbo</span><span class="o">,</span> <span class="nv">$taylor</span><span class="p">;</span>

<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">User twostraws has the password fr0st1es</span><span class="p">&#34;</span> <span class="k">when</span> <span class="p">(&#34;</span><span class="s2">twostraws</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;)</span> <span class="k">for</span> <span class="nv">@users</span><span class="p">;</span>

<span class="c1"># æ‰“å°ç§˜å¯†ä¸ºæŒ‡å®šå€¼çš„ç”¨æˆ·</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">User </span><span class="nv">$_</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="s2"> has password \&#34;fr0st1es\&#34;</span><span class="p">&#34;</span> <span class="k">when</span> <span class="p">(</span><span class="o">*,</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;)</span> <span class="k">for</span> <span class="nv">@users</span><span class="p">;</span>
</code></pre></div><h3 id="åŒ¹é…èŒƒå›´">åŒ¹é…èŒƒå›´</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$age</span> <span class="o">=</span> <span class="mi">36</span><span class="p">;</span>

<span class="k">given</span> <span class="nv">$age</span> <span class="p">{</span>
    <span class="k">when</span> <span class="mi">0</span> <span class="o">..^</span> <span class="mi">18</span>   <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">ä½ æœ‰æ´»åŠ›æœ‰æ—¶é—´ï¼Œä½†æ˜¯æ²¡é’±</span><span class="p">&#34;</span>  <span class="p">}</span>
    <span class="k">when</span> <span class="mi">18</span> <span class="o">..^</span> <span class="mi">70</span>  <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">ä½ æœ‰æ´»åŠ›æœ‰é’±ï¼Œä½†æ˜¯æ²¡æ—¶é—´</span><span class="p">&#34;</span>  <span class="p">}</span>
    <span class="k">default</span>         <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">ä½ æœ‰æ—¶é—´å’Œé‡‘é’±ï¼Œä½†æ˜¯æ²¡æ´»åŠ›</span><span class="p">&#34;}</span>
<span class="p">}</span>
</code></pre></div><h3 id="when-å¯ä»¥é…åˆæ™ºèƒ½åŒ¹é…æ“ä½œç¬¦--å•ç‹¬ä½¿ç”¨">when å¯ä»¥é…åˆæ™ºèƒ½åŒ¹é…æ“ä½œç¬¦ ~~ å•ç‹¬ä½¿ç”¨</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$age</span> <span class="o">=</span> <span class="mi">36</span><span class="p">;</span>
<span class="k">when</span> <span class="nv">$age</span> <span class="o">~~</span> <span class="mi">0</span> <span class="o">..^</span> <span class="mi">18</span>  <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">ä½ æœ‰æ´»åŠ›æœ‰æ—¶é—´ï¼Œä½†æ˜¯æ²¡é’±</span><span class="p">&#34;</span>  <span class="p">}</span>
<span class="k">when</span> <span class="nv">$age</span> <span class="o">~~</span> <span class="mi">18</span> <span class="o">..^</span> <span class="mi">70</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">ä½ æœ‰æ´»åŠ›æœ‰é’±ï¼Œä½†æ˜¯æ²¡æ—¶é—´</span><span class="p">&#34;</span>  <span class="p">}</span>
<span class="k">default</span>                <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">ä½ æœ‰æ—¶é—´å’Œé‡‘é’±ï¼Œä½†æ˜¯æ²¡æ´»åŠ›</span><span class="p">&#34;}</span>
</code></pre></div><h3 id="ä½¿ç”¨-contains-æ–¹æ³•">ä½¿ç”¨ contains æ–¹æ³•</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$age</span> <span class="o">=</span> <span class="mi">36</span><span class="p">;</span>
<span class="k">when</span> <span class="p">(</span><span class="mi">0</span> <span class="o">..^</span> <span class="mi">18</span><span class="p">)</span><span class="o">.</span><span class="nb">contains</span><span class="p">(</span><span class="nv">$age</span><span class="p">)</span>  <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">ä½ æœ‰æ´»åŠ›æœ‰æ—¶é—´ï¼Œä½†æ˜¯æ²¡é’±</span><span class="p">&#34;</span>  <span class="p">}</span>
<span class="k">when</span> <span class="p">(</span><span class="mi">18</span> <span class="o">..^</span> <span class="mi">70</span><span class="p">)</span><span class="o">.</span><span class="nb">contains</span><span class="p">(</span><span class="nv">$age</span><span class="p">)</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">ä½ æœ‰æ´»åŠ›æœ‰é’±ï¼Œä½†æ˜¯æ²¡æ—¶é—´</span><span class="p">&#34;</span>  <span class="p">}</span>
<span class="k">default</span>                         <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">ä½ æœ‰æ—¶é—´å’Œé‡‘é’±ï¼Œä½†æ˜¯æ²¡æ´»åŠ›</span><span class="p">&#34;}</span>
</code></pre></div><h3 id="åŒ¹é…å…ƒç»„ä¸­çš„èŒƒå›´">åŒ¹é…å…ƒç»„ä¸­çš„èŒƒå›´</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$user</span> <span class="o">=</span> <span class="p">(&#34;</span><span class="s2">twostraws</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;</span><span class="o">,</span> <span class="mi">36</span><span class="p">);</span>

<span class="k">given</span> <span class="nv">$user</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
    <span class="k">when</span> <span class="p">(</span><span class="nv">$name</span><span class="o">,</span> <span class="o">*,</span> <span class="mi">0</span> <span class="o">..^</span> <span class="mi">18</span><span class="p">)</span>  <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$name</span><span class="s2"> æœ‰æ´»åŠ›æœ‰æ—¶é—´ï¼Œä½†æ˜¯æ²¡é’±</span><span class="p">&#34;</span>  <span class="p">}</span>
    <span class="k">when</span> <span class="p">(</span><span class="nv">$name</span><span class="o">,</span> <span class="o">*,</span> <span class="mi">18</span> <span class="o">..^</span> <span class="mi">70</span><span class="p">)</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$name</span><span class="s2"> æœ‰æ´»åŠ›æœ‰é’±ï¼Œä½†æ˜¯æ²¡æ—¶é—´</span><span class="p">&#34;</span>  <span class="p">}</span>
    <span class="k">when</span> <span class="p">(</span><span class="nv">$name</span><span class="o">,</span> <span class="o">*,</span> <span class="o">*</span><span class="p">)</span>         <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$name</span><span class="s2"> æœ‰æ—¶é—´å’Œé‡‘é’±,ä½†æ˜¯æ²¡æ´»åŠ›</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="æšä¸¾">æšä¸¾</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">enum</span> <span class="n">WeatherType</span> <span class="p">&lt;</span><span class="s">Cloudy Sunny Windy</span><span class="p">&gt;;</span>
<span class="k">my</span> <span class="nv">$today</span> <span class="o">=</span> <span class="n">WeatherType::Cloudy</span><span class="p">;</span>

<span class="k">given</span> <span class="nv">$today</span> <span class="p">{</span>
    <span class="k">when</span> <span class="n">WeatherType::Cloudy</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">å¤šäº‘</span><span class="p">&#34;</span> <span class="p">}</span>
    <span class="k">when</span> <span class="n">WeatherType::Sunny</span>  <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">æ™´å¤©</span><span class="p">&#34;</span> <span class="p">}</span>
    <span class="k">when</span> <span class="n">WeatherType::Windy</span>  <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">æœ‰é£</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># ä½¿ç”¨ if è¯­å¥</span>
<span class="k">if</span> <span class="nv">$today</span> <span class="o">~~</span> <span class="n">WeatherType::Cloudy</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">å¤šäº‘</span><span class="p">&#34;</span> <span class="p">}</span>
</code></pre></div><h3 id="å…³è”å€¼">å…³è”å€¼</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">enum</span> <span class="n">WeatherType</span>  <span class="p">(</span>
    <span class="s">Cloudy</span> <span class="o">=&gt;</span> <span class="mi">100</span>,
    <span class="s">Sunny</span>  <span class="o">=&gt;</span> <span class="mi">50</span>,
    <span class="s">Windy</span>  <span class="o">=&gt;</span> <span class="mi">30</span>
<span class="p">);</span>

<span class="k">my</span> <span class="nv">$today</span> <span class="o">=</span> <span class="n">WeatherType::Windy</span><span class="p">;</span>
<span class="k">given</span> <span class="nv">$today</span> <span class="p">{</span>
    <span class="k">when</span> <span class="n">WeatherType::Cloudy</span> <span class="p">{</span> <span class="nb">say</span> <span class="mi">20</span><span class="o">*</span><span class="n">Cloudy</span> <span class="p">}</span>
    <span class="k">when</span> <span class="n">WeatherType::Sunny</span>  <span class="p">{</span> <span class="nb">say</span> <span class="mi">10</span><span class="o">*</span><span class="n">Sunny</span>  <span class="p">}</span>
    <span class="k">when</span> <span class="n">WeatherType::Windy</span>  <span class="p">{</span> <span class="nb">say</span> <span class="mi">12</span><span class="o">*</span><span class="n">Windy</span>  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="when-ä»å¥">when ä»å¥</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@numbers</span> <span class="o">=</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">;</span>
<span class="o">.</span><span class="nb">say</span> <span class="k">when</span> <span class="nv">$_</span> <span class="nv">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">for</span> <span class="nv">@numbers</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">@celebrities</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">Michael Jackson</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">Taylor Swift</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">MichaelCaine</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">Adele Adkins</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">Michael Jordan</span><span class="p">&#34;;</span>
<span class="o">.</span><span class="nb">say</span> <span class="k">when</span> <span class="o">/^</span><span class="n">Michael</span><span class="o">/</span> <span class="k">for</span> <span class="nv">@celebrities</span><span class="p">;</span>     <span class="c1"># ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼</span>
<span class="o">.</span><span class="nb">say</span> <span class="k">when</span> <span class="nv">$_</span><span class="o">.</span><span class="nb">chars</span> <span class="o">&gt;</span> <span class="mi">12</span> <span class="k">for</span> <span class="nv">@celebrities</span><span class="p">;</span>  <span class="c1"># è°ƒç”¨æ–¹æ³•</span>
<span class="o">.</span><span class="nb">say</span> <span class="k">when</span> <span class="o">/^</span><span class="n">Michael</span><span class="o">/</span> <span class="ow">and</span> <span class="nv">$_</span><span class="o">.</span><span class="nb">chars</span> <span class="o">&gt;</span><span class="mi">12</span> <span class="k">for</span> <span class="nv">@celebrities</span><span class="p">;</span> <span class="c1"># å¤åˆæ¡ä»¶</span>
</code></pre></div><h3 id="proceed">proceed</h3>
<p>given-when æœ‰ä¸¤ä¸ªå°çš„æ”¹å˜, å¹¶ä¸”è¿™ä¿©æ”¹å˜éƒ½æ˜¯å¼€å¯æ–°è¡Œä¸ºçš„, è€Œä¸æ˜¯é™åˆ¶å·²å­˜åœ¨çš„è¡Œä¸ºã€‚</p>
<p>ç¬¬ä¸€ä¸ªå°çš„æ”¹å˜: when çš„å¼€å…³è¡Œä¸ºä¸ä»…ä»…æ˜¯ç”¨äº given å—å„¿ä¸­çš„, è€Œæ˜¯å¯ä»¥ç”¨åœ¨ä»»ä½•&quot;ä¸»é¢˜åŒ–&quot;çš„å—å„¿ä¸­çš„, ä¾‹å¦‚ for å¾ªç¯ä¸­æˆ–æ¥æ”¶ <code>$_</code> ä½œä¸ºå‚æ•°çš„å­ä¾‹ç¨‹ä¸­ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">given</span> <span class="nv">$answer</span> <span class="p">{</span>
    <span class="k">when</span> <span class="p">&#34;</span><span class="s2">Atlantis</span><span class="p">&#34;</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">é‚£æ˜¯å¯¹çš„</span><span class="p">&#34;</span> <span class="p">}</span>
    <span class="k">default</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">BZZZZZZZZZZZZZ!</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="mi">100</span> <span class="p">{</span>
    <span class="k">when</span> <span class="o">*</span> <span class="nv">%%</span> <span class="mi">15</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Fizzbuzz</span><span class="p">&#34;</span> <span class="p">}</span>
    <span class="k">when</span> <span class="o">*</span> <span class="nv">%%</span> <span class="mi">3</span>  <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Fizz</span><span class="p">&#34;</span>     <span class="p">}</span>
    <span class="k">when</span> <span class="o">*</span> <span class="nv">%%</span> <span class="mi">5</span>  <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Buzz</span><span class="p">&#34;</span>     <span class="p">}</span>
    <span class="k">default</span>      <span class="p">{</span> <span class="nb">say</span> <span class="nv">$_</span>         <span class="p">}</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">expand</span><span class="p">(</span><span class="nv">$_</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">when</span> <span class="p">&#34;</span><span class="s2">R</span><span class="p">&#34;</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">çº¢è­¦</span><span class="p">&#34;</span> <span class="p">}</span>
    <span class="k">when</span> <span class="p">&#34;</span><span class="s2">G</span><span class="p">&#34;</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">ç»¿è­¦</span><span class="p">&#34;</span> <span class="p">}</span>
    <span class="k">when</span> <span class="p">&#34;</span><span class="s2">B</span><span class="p">&#34;</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">è“è­¦</span><span class="p">&#34;</span> <span class="p">}</span>
    <span class="k">default</span>  <span class="p">{</span> <span class="nb">say</span> <span class="nv">$_</span>     <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>ä½†æ˜¯ç”šè‡³ä¸æ¥å— <code>$_</code> ä½œä¸ºå‚æ•°çš„å­ä¾‹ç¨‹ä¹Ÿå¾—åˆ°äº†å®ƒä»¬è‡ªå·±çš„è¯æ³•å˜é‡ <code>$_</code> ä¾›ä¿®æ”¹ã€‚æ‰€ä»¥è§„åˆ™å°±æ˜¯&quot;ç°åœ¨, åœ¨ <code>$_</code> ä¸­æœ‰æŸäº›æˆ‘èƒ½å¯åŠ¨çš„å¥½ä¸œè¥¿å—&quot;ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦, æˆ‘ä»¬ç”šè‡³èƒ½è‡ªå·±è®¾ç½® <code>$_</code>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">seek-the-answer</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$_</span> <span class="o">=</span> <span class="p">(</span><span class="o">^</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="nb">pick</span><span class="p">;</span>
    <span class="k">when</span> <span class="mi">42</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">The answer</span><span class="p">&#34;</span> <span class="p">}</span>
    <span class="k">default</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">A number</span><span class="p">&#34;</span>   <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>æ¢å¥è¯è¯´, æˆ‘ä»¬å·²ç»çŸ¥é“äº† <strong>when</strong> å’Œ <strong>given</strong> æ˜¯å•ç‹¬çš„ã€‚Switch è¯­å¥é€»è¾‘éƒ½åœ¨ when è¯­å¥ä¸­ã€‚</p>
<p>ç¬¬äºŒä¸ªå°æ”¹å˜: ä½ å¯ä»¥åµŒå¥— <em>when</em> è¯­å¥!</p>
<p>æˆ‘å¾ˆç¡®ä¿¡ä½ æ²¡æœ‰åœ¨é‡å¤–è§è¿‡è¿™ç§ç”¨æ³•ã€‚ä½†å®ƒæœ‰æ—¶å€™ç‰¹åˆ«æœ‰ç”¨:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">when</span> <span class="o">*</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="p">{</span>
    <span class="k">when</span> <span class="mi">4</span>  <span class="p">{</span> <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">Four!</span><span class="p">&#39;</span> <span class="p">}</span>
    <span class="k">default</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">huge</span><span class="p">&#39;</span>  <span class="p">}</span>
<span class="p">}</span>

<span class="k">default</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">little</span><span class="p">&#39;</span>
<span class="p">}</span>
</code></pre></div><p>ä½ å¯èƒ½è®°å¾—, åœ¨ when å—å„¿ä¸­æœ‰ä¸€ä¸ªéšå¼çš„ <em>succeed</em> è¯­å¥åœ¨æœ«å°¾, è¿™è®©å‘¨å›´çš„ä¸»é¢˜åŒ–å—é€€å‡ºã€‚(æ„æ€æ˜¯ä½ ä¸å¿…è®°ç€æ‰‹åŠ¨é€€å‡º switch è¯­å¥)ã€‚å¦‚æœä½ æƒ³é‡å†™ succeed è¯­å¥å¹¶ç»§ç»­é€šè¿‡ when block, é‚£ä¹ˆä½ åœ¨ <em>when</em> block çš„æœ«å°¾å†™ä¸Šä¸€ä¸ªæ˜¾å¼çš„ <em>proceed</em> å³å¯ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">given</span> <span class="nv">$verse-number</span> <span class="p">{</span>
    <span class="k">when</span> <span class="o">*</span> <span class="o">&gt;=</span> <span class="mi">12</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Twelve drummers drumming</span><span class="p">&#34;;</span> <span class="k">proceed</span> <span class="p">}</span>
    <span class="k">when</span> <span class="o">*</span> <span class="o">&gt;=</span> <span class="mi">11</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Eleven pipers piping</span><span class="p">&#34;;</span> <span class="k">proceed</span>     <span class="p">}</span>
    <span class="c1"># ...</span>
    <span class="k">when</span> <span class="o">*</span> <span class="o">&gt;=</span> <span class="mi">5</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">FIIIIIIVE GOLDEN RINGS!</span><span class="p">&#34;;</span> <span class="k">proceed</span> <span class="p">}</span>
    <span class="k">when</span> <span class="o">*</span> <span class="o">&gt;=</span> <span class="mi">4</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Four calling birds</span><span class="p">&#34;;</span> <span class="k">proceed</span>      <span class="p">}</span>
    <span class="k">when</span> <span class="o">*</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Three French hens</span><span class="p">&#34;;</span> <span class="k">proceed</span>       <span class="p">}</span>
    <span class="k">when</span> <span class="o">*</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Two turtle doves</span><span class="p">&#34;;</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">and a partridge in a pear tree</span><span class="p">&#34;;</span>
    <span class="p">}</span>

    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">a partridge in a pear tree</span><span class="p">&#34;;</span>
<span class="p">}</span>
</code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/given" term="given" label="given" />
                             
                                <category scheme="https://ohmyweekly.github.io/tags/when" term="when" label="when" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä¸­çš„ IO æ“ä½œ]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-10-11-io-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-10-11-io-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Io in Raku</blockquote><p>æ–‡ä»¶å­˜åœ¨ã€æ–‡ä»¶çš„æ—¶é—´æˆ³ã€æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ç­‰ç­‰</p>
<h3 id="æ‰¹é‡æ’å…¥æ–‡æœ¬">æ‰¹é‡æ’å…¥æ–‡æœ¬</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@filenames</span> <span class="o">=</span> <span class="nb">dir</span> <span class="p">&#39;</span><span class="s1">.</span><span class="p">&#39;</span><span class="o">,</span>  <span class="s">test</span> <span class="o">=&gt;</span> <span class="nb">any</span><span class="p">(/</span><span class="sr">\</span><span class="ni">.</span><span class="sr">md</span><span class="ni">$</span><span class="p">/</span>, <span class="p">/</span><span class="sr">\</span><span class="ni">.</span><span class="sr">markdown</span><span class="p">/);</span>

<span class="k">for</span> <span class="nv">@filenames</span> <span class="k">-&gt;</span> <span class="nv">$filePath</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$path</span> <span class="o">=</span> <span class="nv">$filePath</span><span class="o">.</span><span class="nb">path</span><span class="p">();</span>
    <span class="nv">$path</span> <span class="o">~~</span> <span class="k">s</span><span class="p">/</span><span class="ni">.</span><span class="sr">md</span><span class="p">//;</span>
    <span class="nv">$path</span> <span class="o">~~</span> <span class="k">s</span><span class="p">/</span><span class="ni">.</span><span class="sr">markdown</span><span class="p">//;</span>

    <span class="k">my</span> <span class="nv">$date</span> <span class="o">=</span> <span class="nb">DateTime</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="nb">now</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$head</span> <span class="o">=</span>
<span class="k">qq</span><span class="sa">:heredoc</span> <span class="p">&#39;EOT&#39;;</span><span class="s2">
</span><span class="s2">title:  </span><span class="nv">$path</span><span class="o">.</span><span class="nf">IO.basename</span><span class="p">()</span><span class="s2">
</span><span class="s2">date: </span><span class="nv">$date</span><span class="s2">
</span><span class="s2">tags: Raku
</span><span class="s2">categories: Raku
</span><span class="s2">
</span><span class="s2">---
</span><span class="s2">
</span><span class="s2">&lt;blockquote class=&#34;blockquote-center&#34;&gt;è¿™åŸå¸‚æœ‰å¤ªå¤šé£æ™¯éƒ½åœ¨æé†’é‚£è¿‡å»ï¼&lt;/blockquote&gt;
</span><span class="s2">
</span><span class="s2">[TOC]
</span><span class="s2">
</span><span class="s2"></span><span class="p">EOT</span>

   <span class="k">my</span> <span class="nv">@content</span>   <span class="o">=</span> <span class="nb">slurp</span> <span class="nv">$filePath</span><span class="p">;</span>
   <span class="nb">spurt</span><span class="p">(</span><span class="nv">$filePath</span><span class="o">.</span><span class="nb">path</span><span class="o">,</span> <span class="p">&#34;</span><span class="nv">$head</span><span class="s2">\n</span><span class="nv">@content</span><span class="o">[]</span><span class="p">&#34;);</span>
<span class="p">}</span>

</code></pre></div><p>åœ¨å½“å‰ç›®å½•ä¸­æŸ¥æ‰¾æ‰€æœ‰ä»¥ <code>.md</code> (.markdown)ç»“å°¾çš„æ–‡ä»¶ï¼ˆå³markdownæ–‡ä»¶ï¼‰, å¹¶åœ¨æ–‡ä»¶æœ€å‰é¢æ’å…¥ä¸€æ®µæ–‡æœ¬ï¼Œ å½¢å¦‚ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="n">title:</span>  <span class="nb">Raku</span>
<span class="n">date:</span> <span class="mi">2015</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">20</span><span class="nf">T23:19:13Z</span>
<span class="n">tags:</span> <span class="nb">Raku</span>
<span class="n">categories:</span> <span class="nb">Raku</span>

<span class="o">---</span>

<span class="p">&lt;</span><span class="s">blockquote class=&#34;blockquote-center&#34;</span><span class="p">&gt;</span><span class="n">æˆ‘ç«™åœ¨å¤©æ¡¥ä¸Šå¿µä½ </span><span class="o">,</span> <span class="n">æœ‰ç‚¹ç‹¼ç‹ˆ</span><span class="p">&lt;</span><span class="s">/blockquote</span><span class="p">&gt;</span>

</code></pre></div><p>ç±» <code>IO::Path</code> æä¾›äº† <code>basename</code>, <code>path</code>, <code>parts</code>, ç­‰æ–¹æ³•ä¾›ä½¿ç”¨, å…·ä½“ç”¨æ³•è¯·çœ‹æ–‡æ¡£:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">rakudoc IO::Path
</code></pre></div><p>ä¸€äº›ä¾‹å­ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nb">IO::Path</span><span class="o">.</span><span class="nb">new</span><span class="p">(&#34;</span><span class="s2">/etc/passwd</span><span class="p">&#34;)</span><span class="o">.</span><span class="nb">basename</span><span class="p">;</span>   <span class="c1"># passwd</span>
<span class="nb">say</span> <span class="nb">IO::Path</span><span class="o">.</span><span class="nb">new</span><span class="p">(&#34;</span><span class="s2">docs/README.pod</span><span class="p">&#34;)</span><span class="o">.</span><span class="nb">extension</span><span class="p">;</span>   <span class="c1"># pod</span>
<span class="nb">say</span> <span class="nb">IO::Path</span><span class="o">.</span><span class="nb">new</span><span class="p">(&#34;</span><span class="s2">/etc/passwd</span><span class="p">&#34;)</span><span class="o">.</span><span class="nb">dirname</span><span class="p">;</span>    <span class="c1"># /etc</span>
<span class="nb">say</span> <span class="nb">IO::Path::Win32</span><span class="o">.</span><span class="nb">new</span><span class="p">(&#34;</span><span class="s2">C:\\Windows\\registry.ini</span><span class="p">&#34;)</span><span class="o">.</span><span class="nb">volume</span><span class="p">;</span>    <span class="c1"># C:</span>
<span class="nb">say</span> <span class="nb">IO::Path</span><span class="o">.</span><span class="nb">new</span><span class="p">(&#34;</span><span class="s2">/etc/passwd</span><span class="p">&#34;)</span><span class="o">.</span><span class="nb">parts</span><span class="o">.</span><span class="nb">perl</span> <span class="c1"># (&#34;dirname&#34; =&gt; &#34;/etc&#34;, &#34;volume&#34;  =&gt; &#34;&#34;, &#34;basename&#34; =&gt; &#34;passwd&#34;).hash</span>
</code></pre></div><p>ä¾‹å­:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># To iterate over the contents of the current directory: for dir() -&gt; $file</span>
<span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$file</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># As before, but include even &#39;.&#39; and &#39;..&#39; which are filtered out by # the</span>
<span class="k">default</span> <span class="p">:</span><span class="s">test</span> <span class="n">matcher:</span> <span class="k">for</span> <span class="nb">dir</span><span class="p">(</span><span class="s">test</span> <span class="o">=&gt;</span> <span class="o">*</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nv">$file</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$file</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># To get the names of all .jpg and .jpeg files in ~/Downloads: my @jpegs =</span>
<span class="p">&#34;</span><span class="nv">%*ENV</span><span class="p">&lt;</span><span class="s">HOME</span><span class="p">&gt;</span><span class="s2">/Downloads</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">dir</span><span class="p">(</span><span class="s">test</span> <span class="o">=&gt;</span> <span class="p">/:</span><span class="na">i</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">.</span><span class="p">&#39;</span><span class="sr"> jpe</span><span class="o">?</span><span class="sr">g </span><span class="ni">$</span><span class="p">/)</span><span class="o">Â».</span><span class="nb">Str</span><span class="p">;</span>

<span class="c1"># An example program that lists all files and directories recursively:</span>

<span class="k">sub</span> <span class="nb">MAIN</span><span class="p">(</span><span class="nv">$dir</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">.</span><span class="p">&#39;)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">@todo</span> <span class="o">=</span> <span class="nv">$dir</span><span class="o">.</span><span class="nb">IO</span><span class="p">;</span> <span class="k">while</span> <span class="nv">@todo</span> <span class="p">{</span>
        <span class="k">for</span> <span class="nv">@todo</span><span class="o">.</span><span class="nb">pop</span><span class="o">.</span><span class="nb">dir</span> <span class="k">-&gt;</span> <span class="nv">$path</span> <span class="p">{</span>
            <span class="nb">say</span> <span class="nv">$path</span><span class="o">.</span><span class="nb">Str</span><span class="p">;</span> <span class="nv">@todo</span><span class="o">.</span><span class="nb">push</span><span class="o">:</span> <span class="nv">$path</span> <span class="k">if</span> <span class="nv">$path</span><span class="o">.</span><span class="nb">d</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="æ–‡ä»¶æµ‹è¯•æ“ä½œç¬¦">æ–‡ä»¶æµ‹è¯•æ“ä½œç¬¦</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># If you have a string - a path to something in the filesystem:</span>

<span class="k">if</span> <span class="p">&#34;</span><span class="s2">path/to/file</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">IO</span> <span class="o">~~</span> <span class="p">:</span><span class="s">e</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">file exists</span><span class="p">&#39;;</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$file</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">path/to/file</span><span class="p">&#34;;</span> <span class="k">if</span> <span class="nv">$file</span><span class="o">.</span><span class="nb">IO</span> <span class="o">~~</span> <span class="p">:</span><span class="s">e</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">file exists</span><span class="p">&#39;;</span>
<span class="p">}</span>

<span class="c1"># Instead of the colonpair syntax, you can use method calls too:</span>

<span class="k">if</span> <span class="p">&#39;</span><span class="s1">path/to/file</span><span class="p">&#39;</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">e</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">file exists</span><span class="p">&#39;;</span>
<span class="p">}</span>

<span class="c1"># If you already have an IO object in $file, either by creating one yourself, or</span>
<span class="c1"># by getting it from another subroutine, such as dir, you can write this:</span>

<span class="k">my</span> <span class="nv">$file</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">path/to/file</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">IO</span><span class="p">;</span> <span class="k">if</span> <span class="nv">$file</span> <span class="o">~~</span> <span class="p">:</span><span class="s">e</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">file exists</span><span class="p">&#39;;</span>
<span class="p">}</span>
</code></pre></div><h3 id="æ–‡ä»¶æ—¶é—´æˆ³">æ–‡ä»¶æ—¶é—´æˆ³</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">path/to/file</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">modified</span><span class="p">;</span>                <span class="c1"># e.g. Instant:1424089165</span>
<span class="nb">say</span> <span class="nb">DateTime</span><span class="o">.</span><span class="nb">new</span><span class="p">(&#34;</span><span class="s2">path/to/file</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">modified</span><span class="p">);</span>  <span class="c1"># e.g. 2015-02-16T12:18:50Z</span>

<span class="k">my</span> <span class="nv">$modification_instant</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">path/to/file</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">modified</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$modification_time</span>    <span class="o">=</span> <span class="nb">DateTime</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="nv">$modification_instant</span><span class="p">);</span>
<span class="nb">say</span> <span class="nv">$modification_time</span><span class="p">;</span>  <span class="c1"># e.g. 2015-02-16T12:18:50Z</span>

<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">path/to/file</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">accessed</span><span class="p">;</span>                <span class="c1"># e.g. Instant:1424353577</span>
<span class="nb">say</span> <span class="nb">DateTime</span><span class="o">.</span><span class="nb">new</span><span class="p">(&#34;</span><span class="s2">path/to/file</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">accessed</span><span class="p">);</span>  <span class="c1"># e.g. 2015-02-19T13:45:42Z</span>

<span class="k">my</span> <span class="nv">$access_instant</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">path/to/file</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">accessed</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$access_time</span>    <span class="o">=</span>  <span class="nb">DateTime</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="nv">$access_instant</span><span class="p">);</span>
<span class="nb">say</span> <span class="nv">$access_time</span><span class="p">;</span>  <span class="c1"># e.g. 2015-02-19T13:45:42Z</span>

<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">path/to/file</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">changed</span><span class="p">;</span>                <span class="c1"># e.g. Instant:1424089165</span>
<span class="nb">say</span> <span class="nb">DateTime</span><span class="o">.</span><span class="nb">new</span><span class="p">(&#34;</span><span class="s2">path/to/file</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">changed</span><span class="p">);</span>  <span class="c1"># e.g. 2015-02-16T12:18:50Z</span>

<span class="k">my</span> <span class="nv">$change_instant</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">path/to/file</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">changed</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$change_time</span>    <span class="o">=</span>  <span class="nb">DateTime</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="nv">$chnge_instant</span><span class="p">);</span>
<span class="nb">say</span> <span class="nv">$change_time</span><span class="p">;</span>  <span class="c1"># e.g. 2015-02-16T12:18:50Z</span>
</code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/io" term="io" label="io" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä¸­çš„ polymod æ–¹æ³•]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-09-17-polymod-method-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-09-17-polymod-method-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Polymod Method in Raku</blockquote><blockquote>
<p>Raku ä¸­çš„ .polymod æ–¹æ³• - æŠŠæ•°å­—åˆ†è§£æˆåˆ†æ¯</p>
</blockquote>
<h2 id="å‘½å">å‘½å</h2>
<p><code>.polymod</code> æ–¹æ³•æ¥å—å‡ ä¸ªé™¤æ•°å¹¶æŠŠå®ƒçš„è°ƒç”¨è€…åˆ†è§£æˆä¸€ä»½ä¸€ä»½çš„:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$seconds</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span> <span class="c1"># days</span>
            <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">60</span><span class="o">*</span><span class="mi">60</span>    <span class="c1"># hours</span>
            <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">60</span>       <span class="c1"># minutes</span>
            <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>           <span class="c1"># seconds</span>

<span class="nb">say</span> <span class="nv">$seconds</span><span class="o">.</span><span class="nb">polymod</span><span class="o">:</span> <span class="mi">60</span><span class="o">,</span> <span class="mi">60</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$seconds</span><span class="o">.</span><span class="nb">polymod</span><span class="o">:</span> <span class="mi">60</span><span class="o">,</span> <span class="mi">60</span><span class="o">,</span> <span class="mi">24</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># (5 4 27)</span>
<span class="c1"># (5 4 3 1)</span>
</code></pre></div><p>è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬ä½œä¸ºå‚æ•°ä¼ é€’çš„é™¤æ•°æ˜¯å’Œæ—¶é—´ç›¸å…³çš„: 60(æ¯åˆ†é’Ÿæœ‰å¤šå°‘ç§’)ï¼Œ 60(æ¯å°æ—¶æœ‰å¤šå°‘åˆ†é’Ÿ)ï¼Œå’Œ24(æ¯å¤©æœ‰å¤šå°‘å°æ—¶)ã€‚ä»æœ€å°çš„å•ä½å¼€å§‹ï¼Œ æˆ‘ä»¬ä¸€ç›´å‰è¿›åˆ°æœ€å¤§çš„å•ä½ã€‚</p>
<p>è¾“å‡ºå’Œè¾“å…¥çš„é™¤æ•°æ˜¯ç›¸åŒ¹é…çš„ - ä»æœ€å°çš„å•ä½åˆ°æœ€å¤§çš„å•ä½ï¼š 5 ç§’ï¼Œ4 åˆ†é’Ÿï¼Œ3 å°æ—¶å’Œ 1 å¤©ã€‚</p>
<h2 id="æ‰‹å·¥åˆ¶ä½œ">æ‰‹å·¥åˆ¶ä½œ</h2>
<p>ä¸ä½¿ç”¨ <code>.polymod</code> è€Œä½¿ç”¨ä¸€ä¸ªå¾ªç¯æ¥å±•ç¤ºæ€ä¹ˆä¹‹å‰çš„è®¡ç®—:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$seconds</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span> <span class="c1"># days</span>
            <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">60</span><span class="o">*</span><span class="mi">60</span>    <span class="c1"># hours</span>
            <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">60</span>       <span class="c1"># minutes</span>
            <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>           <span class="c1"># seconds</span>

<span class="k">my</span> <span class="nv">@pieces</span><span class="p">;</span>

<span class="k">for</span> <span class="mi">60</span><span class="o">,</span> <span class="mi">60</span><span class="o">,</span> <span class="mi">24</span> <span class="k">-&gt;</span> <span class="nv">$divisor</span> <span class="p">{</span>
    <span class="nv">@pieces</span><span class="o">.</span><span class="nb">push</span><span class="o">:</span> <span class="nv">$seconds</span> <span class="ow">mod</span> <span class="nv">$divisor</span><span class="p">;</span>
    <span class="nv">$seconds</span> <span class="ow">div</span><span class="o">=</span> <span class="nv">$divisor</span>
<span class="p">}</span>

<span class="nv">@pieces</span><span class="o">.</span><span class="nb">push</span><span class="o">:</span> <span class="nv">$seconds</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">@pieces</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># [5 4 3 2]</span>
</code></pre></div><h2 id="è¶…è¶Šæ— é™">è¶…è¶Šæ— é™</h2>
<p>å½“é™¤æ•°æ˜¯ä»¥æƒ°æ€§åˆ—è¡¨çš„å½¢å¼ä¼ é€’ç»™ <code>.polymod</code> æ–¹æ³•æ—¶ï¼Œå®ƒä¼šä¸€ç›´è¿è¡Œç›´åˆ°ä½™æ•°ä¸ºé›¶å¹¶ä¸ä¼šéå†æ•´ä¸ªåˆ—è¡¨:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="mi">120</span><span class="o">.</span><span class="nb">polymod</span><span class="o">:</span>      <span class="mi">10</span>Â¹<span class="o">,</span> <span class="mi">10</span>Â²<span class="o">,</span> <span class="mi">10</span>Â³<span class="o">,</span> <span class="mi">10</span>â´<span class="o">,</span> <span class="mi">10</span>âµ<span class="p">;</span>
<span class="nb">say</span> <span class="mi">120</span><span class="o">.</span><span class="nb">polymod</span><span class="o">:</span> <span class="nb">lazy</span> <span class="mi">10</span>Â¹<span class="o">,</span> <span class="mi">10</span>Â²<span class="o">,</span> <span class="mi">10</span>Â³<span class="o">,</span> <span class="mi">10</span>â´<span class="o">,</span> <span class="mi">10</span>âµ<span class="p">;</span>
<span class="nb">say</span> <span class="mi">120</span><span class="o">.</span><span class="nb">polymod</span><span class="o">:</span>      <span class="mi">10</span>Â¹<span class="o">,</span> <span class="mi">10</span>Â²<span class="o">,</span> <span class="mi">10</span>Â³ <span class="o">â€¦</span> <span class="no">âˆ</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># (0 12 0 0 0 0)</span>
<span class="c1"># (0 12)</span>
<span class="c1"># (0 12)</span>
</code></pre></div><p>åœ¨ç¬¬ä¸€ä¸ªè°ƒç”¨ä¸­ï¼Œ æˆ‘ä»¬è®©ä¸€ç³»åˆ—æ•°å­—æŒ‰ 10 çš„å¹‚å¢é•¿ã€‚è¯¥è°ƒç”¨çš„è¾“å‡ºåŒ…å«äº† 4 ä¸ªå°¾éƒ¨çš„é›¶ï¼Œå› ä¸º <code>.polymod</code> æ–¹æ³•è®¡ç®—äº†æ¯ä¸ªé™¤æ•°ã€‚åœ¨ç¬¬äºŒä¸ªè°ƒç”¨ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>lazy</code> å…³é”®å­—æ˜¾å¼åœ°åˆ›å»ºäº†ä¸€ä¸ªæƒ°æ€§åˆ—è¡¨ï¼Œ è€Œç°åœ¨æˆ‘ä»¬åœ¨è¿”å›çš„åˆ—è¡¨ä¸­åªæœ‰ 2 ä¸ªæ¡ç›®ã€‚</p>
<p>ç¬¬ä¸€ä¸ªé™¤æ•°(10)ç»“æœä½™æ•°ä¸º 0ï¼Œè¿™æ˜¯è¿”å›åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªæ¡ç›®ï¼Œå¯¹äºä¸‹ä¸€ä¸ªé™¤æ•°ï¼Œæ•´é™¤æŠŠæˆ‘ä»¬çš„ 120 å˜æˆäº† 12ã€‚12 é™¤ä»¥ 100 çš„ä½™æ•°ä¸º 12ï¼Œ å®ƒæ˜¯è¿”å›åˆ—è¡¨ä¸­çš„ç¬¬äºŒä¸ªæ¡ç›®ã€‚ ç°åœ¨ï¼Œ 12 æ•´é™¤ 100 ä¸º 0ï¼Œ å®ƒç»ˆæ­¢äº† <code>.polymod</code> çš„æ‰§è¡Œå¹¶ç»™äº†æˆ‘ä»¬ä¸¤ä¸ª æ¡ç›®çš„ç»“æœã€‚</p>
<p>åœ¨æœ€åä¸€ä¸ªè°ƒç”¨ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†çœç•¥å·ï¼Œå®ƒæ˜¯ä¸€ä¸ªåºåˆ—æ“ä½œç¬¦ï¼Œç”¨æ¥åˆ›å»ºä¸€ç³»åˆ—æŒ‰ 10 çš„å¹‚å¢é•¿çš„æ•°å­—ï¼Œä½†æ˜¯è¿™ä¸€æ¬¡åºåˆ—æ˜¯æ— é™çš„ã€‚å› ä¸ºå®ƒæ˜¯æƒ°æ€§çš„ï¼Œç»“æœå†ä¸€æ¬¡åªæœ‰ 2 ä¸ªå…ƒç´ ã€‚</p>
<h2 id="zip-it-lock-it-put-it-in-the-pocket">Zip It, Lock It, Put It In The Pocket</h2>
<p>å•ç‹¬çš„æ•°å­—å¾ˆå¥½ä½†æ˜¯å¯¹äºå®ƒä»¬æ‰€ä»£è¡¨çš„å•ä½ä¸å¤Ÿå…·æœ‰æè¿°æ€§ã€‚æˆ‘ä»¬æ¥ä½¿ç”¨ Zip å…ƒæ“ä½œç¬¦:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@units</span>  <span class="o">=</span> <span class="p">&lt;</span><span class="s">ng Î¼g mg g kg</span><span class="p">&gt;;</span>
<span class="k">my</span> <span class="nv">@pieces</span> <span class="o">=</span> <span class="mi">42_666_555_444_333</span><span class="o">.</span><span class="nb">polymod</span><span class="o">:</span> <span class="mi">10</span>Â³ <span class="ow">xx</span> <span class="no">âˆ</span><span class="p">;</span>

<span class="nb">say</span> <span class="nv">@pieces</span> <span class="ow">Z</span><span class="o">~</span> <span class="nv">@units</span><span class="p">;</span>
<span class="c1"># OUTPUT:</span>
<span class="c1"># (333ng 444Î¼g 555mg 666g 42kg)</span>
</code></pre></div><h2 id="å¿«é€Ÿå‘½å">å¿«é€Ÿå‘½å</h2>
<p>å¯¹äºè¢«è°ƒç”¨è€…å’Œé™¤æ•°ï¼Œä½ ä¸ä»…ä»…é™äºä½¿ç”¨ Intsï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶å®ƒç±»å‹çš„æ•°å­—ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> â…”<span class="o">.</span><span class="nb">polymod</span><span class="o">:</span> â…“<span class="p">;</span>

<span class="nb">say</span> <span class="mi">5</span><span class="o">.</span><span class="nb">Rat</span><span class="o">.</span><span class="nb">polymod</span><span class="o">:</span> <span class="mf">.3</span><span class="o">,</span> <span class="mf">.2</span><span class="p">;</span>
<span class="nb">say</span> <span class="mi">3</span><span class="o">.</span><span class="nb">Rat</span><span class="o">.</span><span class="nb">polymod</span><span class="o">:</span> â…”<span class="o">,</span> â…“<span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># (0 2)</span>
<span class="c1"># (0.2 0 80)</span>
<span class="c1"># (0.333333 0 12)</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="mi">5</span><span class="o">.</span><span class="nb">Num</span><span class="o">.</span><span class="nb">polymod</span><span class="o">:</span> <span class="mf">.3</span><span class="o">,</span> <span class="mf">.2</span><span class="p">;</span>
<span class="nb">say</span> <span class="mi">3</span><span class="o">.</span><span class="nb">Num</span><span class="o">.</span><span class="nb">polymod</span><span class="o">:</span> â…”<span class="o">,</span> â…“<span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># (0.2 0.199999999999999 79)</span>
<span class="c1"># (0.333333333333333 2.22044604925031e-16 12)</span>
</code></pre></div><h2 id="ä½¿ç”¨-numberdenominatehttpmodulesrakuorgreponumberdenominate-æ¨¡å—">ä½¿ç”¨ <a href="http://modules.raku.org/repo/Number::Denominate">Number::Denominate</a> æ¨¡å—</h2>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">use</span> <span class="nn">Number::Denominate</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$seconds</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span> <span class="c1"># days</span>
            <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="mi">60</span><span class="o">*</span><span class="mi">60</span>    <span class="c1"># hours</span>
            <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="mi">60</span>       <span class="c1"># minutes</span>
            <span class="o">+</span> <span class="mi">5</span><span class="p">;</span>           <span class="c1"># seconds</span>

<span class="nb">say</span> <span class="n">denominate</span> <span class="nv">$seconds</span><span class="p">;</span>
<span class="nb">say</span> <span class="n">denominate</span> <span class="nv">$seconds</span><span class="o">,</span> <span class="p">:</span><span class="s">set</span><span class="p">&lt;</span><span class="s">weight</span><span class="p">&gt;;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># 1 day, 3 hours, 4 minutes, and 5 seconds</span>
<span class="c1"># 97 kilograms and 445 grams</span>
</code></pre></div><p>ä½ è¿˜å¯ä»¥å®šä¹‰è‡ªå·±çš„å•ä½:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="n">denominate</span> <span class="mi">449</span><span class="o">,</span> <span class="p">:</span><span class="s">units</span><span class="p">(</span> <span class="s">foo</span> <span class="o">=&gt;</span> <span class="mi">3</span>, <span class="p">&lt;</span><span class="s">bar boors</span><span class="p">&gt;</span> <span class="o">=&gt;</span> <span class="mi">32</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">ber</span><span class="p">&#39;</span> <span class="p">);</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># 4 foos, 2 boors, and 1 ber</span>
</code></pre></div><p><a href="http://raku.party/post/Raku-.polymod-break-up-a-number-into-denominations">http://raku.party/post/Raku-.polymod-break-up-a-number-into-denominations</a></p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/polymod" term="polymod" label="polymod" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä¸­çš„ proto]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-10-06-proto-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-10-06-proto-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Proto in Raku</blockquote><h2 id="proto">proto</h2>
<p>proto æ„æ€ä¸ºåŸå‹ã€‚proto ä»å½¢å¼ä¸Šå£°æ˜äº† <code>multi</code> å€™é€‰è€…ä¹‹é—´çš„<code>å…±æ€§</code>ã€‚ proto å……å½“ä½œèƒ½æ£€æŸ¥ä½†ä¸ä¼šä¿®æ”¹å‚æ•°çš„åŒ…è£¹ã€‚çœ‹çœ‹è¿™ä¸ªåŸºæœ¬çš„ä¾‹å­:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">proto</span> <span class="nf">congratulate</span><span class="p">(</span><span class="nb">Str</span> <span class="nv">$reason</span><span class="o">,</span> <span class="nb">Str</span> <span class="nv">$name</span><span class="o">,</span> <span class="o">|</span><span class="p">)</span> <span class="p">{</span><span class="o">*</span><span class="p">}</span>

<span class="k">multi</span> <span class="nf">congratulate</span><span class="p">(</span><span class="nv">$reason</span><span class="o">,</span> <span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hooray for your </span><span class="nv">$reason</span><span class="s2">, </span><span class="nv">$name</span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="k">multi</span> <span class="nf">congratulate</span><span class="p">(</span><span class="nv">$reason</span><span class="o">,</span> <span class="nv">$name</span><span class="o">,</span> <span class="nb">Int</span> <span class="nv">$rank</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hooray for your </span><span class="nv">$reason</span><span class="s2">, </span><span class="nv">$name</span><span class="s2"> -- you got rank </span><span class="nv">$rank</span><span class="s2">!</span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="nf">congratulate</span><span class="p">(&#39;</span><span class="s1">being a cool number</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Fred</span><span class="p">&#39;);</span>     <span class="c1"># OK</span>
<span class="nf">congratulate</span><span class="p">(&#39;</span><span class="s1">being a cool number</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Fred</span><span class="p">&#39;</span><span class="o">,</span> <span class="mi">42</span><span class="p">);</span> <span class="c1"># OK</span>
<span class="nf">congratulate</span><span class="p">(&#39;</span><span class="s1">being a cool number</span><span class="p">&#39;</span><span class="o">,</span> <span class="mi">42</span><span class="p">);</span>         <span class="c1"># Proto match error</span>
</code></pre></div><p>æ‰€æœ‰çš„ <code>multi congratulate</code> ä¼šéµå®ˆåŸºæœ¬çš„ç­¾å, è¿™ä¸ªç­¾åä¸­æœ‰ä¸¤ä¸ªå­—ç¬¦ä¸²å‚æ•°, åé¢è·Ÿç€å¯é€‰çš„æ›´å¤šçš„å‚æ•°ã€‚ <code>|</code> æ˜¯ä¸€ä¸ªæœªå‘½åçš„ <code>Capture</code> å½¢å‚, è¿™å…è®¸ <code>multi</code> æ¥æ”¶é¢å¤–çš„å‚æ•°ã€‚ç¬¬ä¸‰ä¸ª congratulate è°ƒç”¨åœ¨ç¼–è¯‘æ—¶å¤±è´¥, å› ä¸ºç¬¬ä¸€è¡Œçš„ proto çš„ç­¾åå˜æˆäº†æ‰€æœ‰ä¸‰ä¸ª multi congratulate çš„å…±åŒç­¾å, è€Œ 42 ä¸åŒ¹é… <code>Str</code>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nv">&amp;congratulate</span><span class="o">.</span><span class="nb">signature</span> <span class="c1">#-&gt; (Str $reason, Str $name, | is raw)</span>
</code></pre></div><p>ä½ å¯ä»¥ç»™ <code>proto</code> ä¸€ä¸ªå‡½æ•°ä½“, å¹¶ä¸”åœ¨ä½ æƒ³æ‰§è¡Œ dispatch çš„åœ°æ–¹æ”¾ä¸Šä¸€ä¸ª <code>{*}</code>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># attempts to notify someone -- returns False if unsuccessful</span>
<span class="k">proto</span> <span class="nf">notify</span><span class="p">(</span><span class="nb">Str</span> <span class="nv">$user</span><span class="o">,</span><span class="nb">Str</span> <span class="nv">$msg</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">\hour</span> <span class="o">=</span> <span class="nb">DateTime</span><span class="o">.</span><span class="nb">now</span><span class="o">.</span><span class="nb">hour</span><span class="p">;</span>
    <span class="k">if</span> <span class="nb">hour</span> <span class="o">&gt;</span> <span class="mi">8</span> <span class="ow">or</span> <span class="nb">hour</span> <span class="o">&lt;</span> <span class="mi">22</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">{</span><span class="o">*</span><span class="p">};</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="c1"># we can&#39;t notify someone when they might be sleeping</span>
        <span class="k">return</span> <span class="nb">False</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p><code>{*}</code> æ€»æ˜¯åˆ†æ´¾ç»™å¸¦æœ‰å‚æ•°çš„å€™é€‰è€…ã€‚é»˜è®¤å‚æ•°å’Œç±»å‹å¼ºåˆ¶è½¬æ¢ä¼šèµ·ä½œç”¨å•ä¸ä¼šä¼ é€’ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">proto</span> <span class="nf">mistake-proto</span><span class="p">(</span><span class="nb">Str</span><span class="p">()</span> <span class="nv">$str</span><span class="o">,</span> <span class="nb">Int</span> <span class="nv">$number</span> <span class="o">=</span> <span class="mi">42</span><span class="p">)</span> <span class="p">{</span><span class="o">*</span><span class="p">}</span>
<span class="k">multi</span> <span class="nf">mistake-proto</span><span class="p">(</span><span class="nv">$str</span><span class="o">,</span><span class="nv">$number</span><span class="p">)</span> <span class="p">{</span> <span class="nb">say</span> <span class="nv">$str</span><span class="o">.</span><span class="nb">WHAT</span> <span class="p">}</span>
<span class="nf">mistake-proto</span><span class="p">(</span><span class="mi">7</span><span class="o">,</span><span class="mi">42</span><span class="p">);</span>   <span class="c1">#-&gt; (Int) -- coercions not passed on</span>
<span class="nf">mistake-proto</span><span class="p">(&#39;</span><span class="s1">test</span><span class="p">&#39;);</span> <span class="c1">#!&gt; fails -- defaults not passed on</span>
</code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/proto" term="proto" label="proto" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä¸­çš„ Role]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-07-15-roles-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-07-15-roles-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Roles in Raku</blockquote><ul>
<li>Composition and mix-ins</li>
<li>Sigils</li>
<li>Typed data structures</li>
<li>Traits</li>
</ul>
<p>æ‰€ä»¥åˆ°åº•ä»€ä¹ˆæ˜¯ <code>role</code> å‘¢ï¼Ÿ role æ˜¯é›¶ä¸ªæˆ–å¤šä¸ªæ–¹æ³•å’Œå±æ€§çš„é›†åˆã€‚</p>
<p>role ä¸åƒ classï¼Œå®ƒä¸èƒ½è¢«å®ä¾‹åŒ–ï¼ˆå¦‚æœä½ å°è¯•äº†ï¼Œä¼šç”Ÿæˆä¸€ä¸ª classï¼‰ã€‚Raku ä¸­ Classes æ˜¯å¯å˜çš„ï¼Œè€Œ roles æ˜¯ä¸å¯å˜çš„ã€‚</p>
<h2 id="ç”³æ˜-roles-å°±åƒç”³æ˜-class-ä¸€æ ·">ç”³æ˜ Roles å°±åƒç”³æ˜ Class ä¸€æ ·</h2>
<p>ä½¿ç”¨å…³é”®å­— <code>role</code> æ¥å¼•å…¥ role, åœ¨ role ä¸­å£°æ˜å±æ€§å’Œæ–¹æ³•å°±åƒåœ¨ Raku çš„ç±»ä¸­å£°æ˜å±æ€§å’Œæ–¹æ³•é‚£æ ·ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">DebugLog</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">@.log_lines</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.log_size</span> <span class="k">is</span> <span class="k">rw</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>

    <span class="k">method</span> <span class="nf">log_message</span><span class="p">(</span><span class="nv">$message</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">@!log_lines</span><span class="o">.</span><span class="nb">shift</span> <span class="k">if</span>
        <span class="nv">@!log_lines</span><span class="o">.</span><span class="nb">elems</span> <span class="o">&gt;=</span> <span class="nv">$!log_size</span><span class="p">;</span>
        <span class="nv">@!log_lines</span><span class="o">.</span><span class="nb">push</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h2 id="role-composition">Role Composition</h2>
<ul>
<li>ä½¿ç”¨ <code>does</code> trait å°† role ç»„åˆåˆ° Class ä¸­ï¼š</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">WebCrawler</span> <span class="k">does</span> <span class="nc">DebugLog</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre></div><ul>
<li>è¿™ä¼šæŠŠæ–¹æ³•å’Œå±æ€§æ·»åŠ åˆ° class WebCrawler é‡Œé¢å»ã€‚</li>
<li>ç»“æœå°±åƒå®ƒä»¬èµ·åˆè¢«å†™åˆ° class ä¸­ä¸€æ ·ã€‚</li>
</ul>
<h2 id="mix-ins">Mix-ins</h2>
<ul>
<li>å…è®¸ role çš„åŠŸèƒ½è¢«æ·»åŠ åˆ°æ¯ä¸ªå¯¹è±¡çš„æ ¹ä¸Š</li>
<li>ä¸å½±å“å…¶å®ƒçš„ç±»å®ä¾‹</li>
<li>role ä¸­çš„æ–¹æ³•æ€»æ˜¯è¦†ç›–å¯¹è±¡ä¸­å·²ç»å­˜åœ¨çš„æ–¹æ³•</li>
</ul>
<h2 id="mix-ins-example">Mix-ins Example</h2>
<ul>
<li>å‡è®¾æˆ‘ä»¬æƒ³è·Ÿè¸ªæŸä¸ªå¯¹è±¡å‘ç”Ÿäº†ä»€ä¹ˆ</li>
<li>Mix in the DebugLog role</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$acount</span> <span class="k">does</span> <span class="nc">DebugLog</span><span class="p">;</span>
</code></pre></div><ul>
<li>ç„¶å, æˆ‘ä»¬å¯ä»¥è¾“å‡ºè¢«ç™»è®°çš„è¡Œ</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$account</span><span class="o">.</span><span class="nf">log_lines</span><span class="o">Â».</span><span class="nb">say</span><span class="p">;</span>
</code></pre></div><ul>
<li>ç°åœ¨æˆ‘ä»¬åªéœ€ç»™ <code>log_message</code> æ–¹æ³•æ·»åŠ è°ƒç”¨</li>
<li>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>.?</code> æ“ä½œç¬¦, è¿™ä¼šè°ƒç”¨æŸä¸ªæ–¹æ³•, å¦‚æœæ–¹æ³•å­˜åœ¨çš„è¯</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Account</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">change_password</span><span class="p">(</span><span class="nv">$new</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">self</span><span class="o">.?</span><span class="nf">log_message</span><span class="p">(</span>
            <span class="p">&#34;</span><span class="s2">changing password to </span><span class="nv">$new</span><span class="p">&#34;;</span>
        <span class="p">)</span>
        <span class="o">...</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h2 id="sigil--æ¥å£åå®š">Sigil = æ¥å£åå®š</h2>
<ul>
<li>åœ¨ Raku ä¸­, ç¬¦å·è¡¨æ˜æ¥å£åå®š</li>
<li>è¿™ä¸ªæ¥å£åå®šç”± role å®šä¹‰</li>
<li>ä½ å¯ä»¥åªæŠŠä¸œè¥¿æ”¾åœ¨å¸¦æœ‰ç¬¦å·çš„å˜é‡ä¸­, å¦‚æœè¯¥å˜é‡éµå®ˆ(<code>does</code>)äº†è¦æ±‚çš„ role çš„è¯</li>
<li>ä¾‹å¤–: å¸¦æœ‰ <code>$</code> çš„å˜é‡å¯ä»¥å­˜å‚¨ä»»ä½•ä¸œè¥¿(å¦‚æœæ²¡æœ‰ä½¿ç”¨ç±»å‹çº¦æŸçš„è¯)</li>
</ul>
<h2 id="--positional">@ = Positional</h2>
<ul>
<li><code>@</code> ç¬¦å·è¡¨æ˜å®ƒæ˜¯ä¸€ä¸ª <code>Positional</code> role</li>
<li>ä¿è¯ä¼šæœ‰ä¸€ä¸ªæ–¹æ³•åç¯ç¼€è®©ä½ èƒ½è°ƒç”¨</li>
<li>This is that gets called when you do an index positionally into something</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nv">@fact</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">@fact</span><span class="o">.</span><span class="nf">postcircumfix:</span><span class="p">&lt;</span><span class="s">[ ]</span><span class="p">&gt;(</span><span class="mi">1</span><span class="p">);</span>
</code></pre></div><ul>
<li>æ³¨æ„: ä¼˜åŒ–å™¨(å¦‚æœæœ‰çš„è¯)å¯èƒ½å‘å‡ºæ›´è½»é‡çº§çš„ä¸œè¥¿</li>
</ul>
<h2 id="--associative">% = Associative</h2>
<ul>
<li><code>%</code> è¡¨æ˜å®ƒæ˜¯ä¸€ä¸ªå…³è”å‹(Associative)çš„ role</li>
<li>è¦æœ‰ä¸€ä¸ªæ–¹æ³•åç¯ç¼€ <code>postcircumfix:&lt;{}&gt;</code> è®©ä½ è°ƒç”¨</li>
<li>This is that gets called when you do an index associatively into something</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nv">%price</span><span class="p">&lt;</span><span class="s">Cheese</span><span class="p">&gt;;</span>
<span class="nb">say</span> <span class="nv">%price</span><span class="o">.</span><span class="nf">postcircumfix:</span><span class="p">&lt;</span><span class="s">{ }</span><span class="p">&gt;(&#39;</span><span class="s1">Cheese</span><span class="p">&#39;);</span>
</code></pre></div><h2 id="--callable">&amp; = Callable</h2>
<ul>
<li><code>&amp;</code> è¡¨æ˜å®ƒæ˜¯ä¸€ä¸ª Callable çš„ role</li>
<li>ä¸œè¥¿è¦èƒ½è¢«è°ƒç”¨</li>
<li>è¿™ä¸ª role è¢«è¯¸å¦‚ <code>Block</code>ã€<code>Sub</code>ã€<code>Method</code>ä¹‹ç±»çš„ä¸œè¥¿éµå®ˆ</li>
<li>è¦æ±‚å®ç°åç¯ç¼€ <code>postcircumfix:&lt;()&gt;</code></li>
</ul>
<p>ä½¿ç”¨å¸¦æœ‰ block çš„ class å…³é”®å­—å¼•å…¥ä¸€ä¸ªç±»ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Puppy</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre></div><p>æˆ–ä½¿ç”¨</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Puppy</span><span class="p">;</span>
<span class="o">...</span>

<span class="mi">1</span><span class="p">;</span>
</code></pre></div><p>æŠŠç±»ç›¸å…³çš„ä¸œè¥¿å•ç‹¬å†™è¿›ä¸€ä¸ªæ–‡ä»¶</p>
<h2 id="role-ä¹Ÿå¯ä»¥è¢«åˆå§‹åŒ–">Role ä¹Ÿå¯ä»¥è¢«åˆå§‹åŒ–</h2>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">BarChart</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nb">Int</span> <span class="nv">@.bar-values</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.b</span> <span class="k">is</span> <span class="k">rw</span><span class="p">;</span>

    <span class="k">method</span> <span class="nf">plot</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="nv">@.bar-values</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$chart</span> <span class="o">=</span> <span class="n">BarChart</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">bar-values</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">1</span>,<span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">],</span> <span class="s">b</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">Camelia</span><span class="p">&#34;);</span>

<span class="nb">say</span> <span class="nv">$chart</span><span class="o">.</span><span class="nf">b</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$chart</span><span class="o">.</span><span class="nf">bar-values</span><span class="p">;</span>
<span class="nv">$chart</span><span class="o">.</span><span class="nf">b</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">Rakudo</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="nv">$chart</span><span class="o">.</span><span class="nf">b</span><span class="p">;</span>
<span class="nb">say</span> <span class="n">BarChart</span><span class="o">.^</span><span class="nb">methods</span><span class="p">;</span>
</code></pre></div><p>å¦‚æœä½ åˆå§‹åŒ–äº† role, é‚£ä¹ˆå®ƒå°±å˜ä¸ºç±»äº†ã€‚</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/role" term="role" label="role" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä¸­çš„ S/// æ“ä½œç¬¦]]></title>
            <link href="https://ohmyweekly.github.io/notes/2016-01-28-the-s-operator-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2015-11-20-guess-who/?utm_source=atom_feed" rel="related" type="text/html" title="Guess Who" />
                <link href="https://ohmyweekly.github.io/notes/2015-06-10-list-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="List in Raku" />
                <link href="https://ohmyweekly.github.io/notes/2015-12-11-twigils-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="Raku ä¸­çš„ twigil" />
                <link href="https://ohmyweekly.github.io/notes/2016-01-04-an-example-of-raku-subset-and-multi/?utm_source=atom_feed" rel="related" type="text/html" title="ä½¿ç”¨ Raku çš„ subsets å’Œ multi è¾¨åˆ«å¹´é¾„" />
                <link href="https://ohmyweekly.github.io/notes/2015-11-11-add-a-method-to-an-existing-class-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="åœ¨ Raku ä¸­æ€ä¹ˆä¸ºå·²å­˜åœ¨çš„ç±»æ·»åŠ æ–¹æ³•" />
            
                <id>https://ohmyweekly.github.io/notes/2016-01-28-the-s-operator-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>The S Operator in Raku</blockquote><h1 id="raku-s-æ“ä½œç¬¦httpblogsperlorguserszoffix_znet201604perl-6-the-s-operatorhtml"><a href="http://blogs.perl.org/users/zoffix_znet/2016/04/perl-6-the-s-operator.html">Raku: S/// æ“ä½œç¬¦</a></h1>
<p>By <a href="http://blogs.perl.org/users/zoffix_znet/">Zoffix Znet</a></p>
<p>æ¥è‡ª Perl 5 èƒŒæ™¯çš„æˆ‘, ç¬¬ä¸€æ¬¡ä½¿ç”¨ Raku çš„éç ´åæ€§æ›¿æ¢æ“ä½œç¬¦ <code>S///</code> çš„ç»å†å°±åƒä¸‹é¢è¿™æ ·:</p>
<p><img src="http://upload-images.jianshu.io/upload_images/326727-3a07abee4665adaf.gif?imageMogr2/auto-orient/strip" alt="img"></p>
<p>è¿›å±•ä¼šæ›´å¥½çš„ã€‚æˆ‘ä¸ä½†ä¼šæ”¹å–„é”™è¯¯ä¿¡æ¯, è€Œä¸”ä¼šè§£é‡Šå½“å‰çš„æ‰€æœ‰äº‹æƒ…ã€‚</p>
<h2 id="æ™ºèƒ½åŒ¹é…">æ™ºèƒ½åŒ¹é…</h2>
<p>æˆ‘æœ‰é—®é¢˜çš„åŸå› æ˜¯å› ä¸º, çœ‹åˆ°å¤–å½¢ç›¸ä¼¼çš„æ“ä½œç¬¦, æˆ‘å°±ç®€å•åœ°æŠŠ Perl 5 ä¸­çš„ç»‘å®šæ“ä½œç¬¦(<code>=~</code>)è½¬æ¢ä¸º Raku ä¸­çš„æ™ºèƒ½åŒ¹é…æ“ä½œç¬¦(<code>~~</code>) è¿˜æœŸæœ›å®ƒèƒ½æ­£å¸¸å·¥ä½œã€‚äº‹å®ä¸Šæˆ‘æ˜¯å¼‚æƒ³å¤©å¼€ã€‚<code>S///</code> æ“ä½œç¬¦æ²¡æœ‰æ–‡æ¡£, å¹¶ä¸”ç»“åˆä»¤äººå›°æƒ‘çš„(é‚£ä¸ªæ—¶å€™)è­¦å‘Šä¿¡æ¯, è¿™å°±æ˜¯æˆ‘ç—›è‹¦çš„æ ¹æºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$orig</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">meowmix</span><span class="p">&#39;;</span>
<span class="k">my</span> <span class="nv">$new</span>  <span class="o">=</span> <span class="nv">$orig</span> <span class="o">~~</span> <span class="k">S</span><span class="p">/</span><span class="sr">me</span><span class="p">/</span><span class="s2">c</span><span class="p">/;</span>
<span class="nb">say</span> <span class="nv">$new</span><span class="p">;</span>

<span class="c1"># OUTPUT warning:</span>
<span class="c1"># Smartmatch with S/// can never succeed</span>
</code></pre></div><p>è¿™ä¸ªä¸‘é™‹çš„è­¦å‘Šè¯´è¿™å„¿çš„ <code>~~</code> æ“ä½œç¬¦æ˜¯ä¸ªé”™è¯¯çš„é€‰æ‹©å¹¶ä¸”ç¡®å®å¦‚æ­¤ã€‚<code>~~</code> æ“ä½œç¬¦ä¸æ˜¯ Perl 5 çš„ <code>=~</code> æ“ä½œç¬¦çš„ç­‰ä»·ç‰©ã€‚<code>~~</code> æ™ºèƒ½æ“ä½œç¬¦æŠŠå®ƒå·¦è¾¹çš„ä¸œè¥¿èµ·äº†ä¸ªå«åš <code>$_</code> çš„åˆ«å, ç„¶å <code>~~</code> è®¡ç®—å®ƒå³ä¾§çš„ä¸œè¥¿, ç„¶ååœ¨å³ä¾§è¿™ä¸ªä¸œè¥¿èº«ä¸Šè°ƒç”¨ <code>.ACCEPTS($_)</code> æ–¹æ³•ã€‚è¿™å°±æ˜¯æ‰€æœ‰çš„é­”æ³•ã€‚</p>
<p>æ‰€ä»¥ä¸Šé¢çš„ä¾‹å­å®é™…ä¸Šå‘ç”Ÿäº†:</p>
<ul>
<li>æˆ‘ä»¬åˆ°è¾¾ <code>S///</code> çš„æ—¶å€™, <code>$orig</code> è¢«èµ·äº†ä¸ªå«åš <code>$_</code> çš„åˆ«åã€‚</li>
<li><code>S///</code> éç ´åæ€§åœ°åœ¨ <code>$_</code> èº«ä¸Šæ‰§è¡Œäº†æ›¿æ¢å¹¶è¿”å›é‚£ä¸ªç»“æœå­—ç¬¦ä¸²ã€‚è¿™æ˜¯æ™ºèƒ½åŒ¹é…å°†è¦æ“ä½œçš„ä¸œè¥¿ã€‚</li>
<li>æ™ºèƒ½åŒ¹é…, æŒ‰ç…§ Str ä¸ Str ç›¸åŒ¹é…çš„è§„åˆ™, ä¼šæ ¹æ®æ›¿æ¢æ˜¯å¦å‘ç”Ÿæ¥ç»™å‡º True æˆ– Falseï¼ˆä»¤äººå›°æƒ‘çš„æ˜¯, True æ„å‘³ç€æ²¡å‘ç”Ÿï¼‰</li>
</ul>
<p>ç»“æœä¸€è·¯ä¸‹æ¥, æˆ‘ä»¬å¹¶æ²¡æœ‰å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ï¼šæ›¿æ¢è¿‡çš„å­—ç¬¦ä¸²ã€‚</p>
<h2 id="ä½¿ç”¨-given">ä½¿ç”¨ Given</h2>
<p>æ—¢ç„¶æˆ‘ä»¬çŸ¥é“äº† <code>S///</code> æ€»æ˜¯ä½œç”¨åœ¨ <code>$_</code> ä¸Šå¹¶ä¸”è¿”å›æ›¿æ¢åçš„ç»“æœ, å¾ˆå®¹æ˜“å°±æƒ³åˆ°å‡ ç§æ–¹æ³•æŠŠ <code>$_</code> è®¾ç½®ä¸ºæˆ‘ä»¬åŸæ¥çš„å­—ç¬¦ä¸²å¹¶æŠŠ <code>S///</code> çš„è¿”å›å€¼æ”¶é›†å›æ¥, æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªä¾‹å­ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$orig</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">meowmix</span><span class="p">&#39;;</span>
<span class="k">my</span> <span class="nv">$new</span>  <span class="o">=</span> <span class="k">S</span><span class="p">/</span><span class="sr">me</span><span class="p">/</span><span class="s2">c</span><span class="p">/</span> <span class="k">given</span> <span class="nv">$orig</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$orig</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$new</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">@orig</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">meow cow sow vow</span><span class="p">&gt;;</span>
<span class="k">my</span> <span class="nv">@new</span>  <span class="o">=</span> <span class="nb">do</span> <span class="k">for</span> <span class="nv">@orig</span> <span class="p">{</span> <span class="k">S</span><span class="p">/</span><span class="se">\w</span><span class="o">+</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">?</span><span class="ow">before</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">ow</span><span class="p">&#39;&gt;/</span><span class="s2">w</span><span class="p">/</span> <span class="p">};</span>
<span class="nb">say</span> <span class="nv">@orig</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">@new</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># meowmix</span>
<span class="c1"># cowmix</span>
<span class="c1"># [meow cow sow vow]</span>
<span class="c1"># [wow wow wow wow]</span>
</code></pre></div><p>ç¬¬ä¸€ä¸ªä½œç”¨åœ¨å•ä¸ªå€¼ä¸Šã€‚æˆ‘ä»¬ä½¿ç”¨åç½®å½¢å¼çš„ <em>given</em> å—å„¿, è¿™è®©æˆ‘ä»¬é¿å…äº†èŠ±æ‹¬å·ï¼ˆä½ å¯ä»¥ä½¿ç”¨ <em>with</em> ä»£æ›¿ <em>given</em> å¾—åˆ°åŒæ ·çš„ç»“æœï¼‰ã€‚<code>given $orig</code> ä¼šç»™ <code>$orig</code> èµ·ä¸ªå«åš <code>$_</code> çš„åˆ«åã€‚ä»è¾“å‡ºæ¥çœ‹, åŸå­—ç¬¦ä¸²æ²¡æœ‰è¢«æ›´æ”¹ã€‚</p>
<p>ç¬¬äºŒä¸ªä¾‹å­ä½œç”¨åœ¨æ•°ç»„ä¸­çš„ä¸€å †å­—ç¬¦ä¸²èº«ä¸Šå¹¶ä¸”æˆ‘ä»¬ä½¿ç”¨ <em>do</em> å…³é”®å­—æ¥æ‰§è¡Œå¸¸è§„çš„ <em>for</em> å¾ªç¯(é‚£ç§æƒ…å†µä¸‹, å®ƒæŠŠå¾ªç¯å˜é‡åˆ«åç»™ <code>$_</code> äº†)å¹¶æŠŠç»“æœèµ‹å€¼ç»™ <code>@new</code> æ•°ç»„ã€‚å†æ¬¡, è¾“å‡ºæ˜¾ç¤ºåŸæ¥çš„æ•°ç»„å¹¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜ã€‚</p>
<h2 id="å‰¯è¯">å‰¯è¯</h2>
<p><code>S///</code> æ“ä½œç¬¦ - å°±åƒ <code>s///</code> æ“ä½œç¬¦å’ŒæŸäº›æ–¹æ³•ä¸€æ · - å…è®¸ä½ ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å‰¯è¯ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">given</span> <span class="p">&#39;</span><span class="s1">LÃ¶rem Ipsum Dolor Sit Amet</span><span class="p">&#39;</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="k">S</span><span class="p">:</span><span class="na">g</span>      <span class="p">/</span><span class="sr">m</span><span class="p">/</span><span class="s2">g</span><span class="p">/;</span>  <span class="c1"># LÃ¶reg Ipsug Dolor Sit Aget</span>
    <span class="nb">say</span> <span class="k">S</span><span class="p">:</span><span class="na">i</span>      <span class="p">/</span><span class="sr">l</span><span class="p">/</span><span class="s2">b</span><span class="p">/;</span>  <span class="c1"># bÃ¶rem Ipsum Dolor Sit Amet</span>
    <span class="nb">say</span> <span class="k">S</span><span class="p">:</span><span class="na">ii</span>     <span class="p">/</span><span class="sr">l</span><span class="p">/</span><span class="s2">b</span><span class="p">/;</span>  <span class="c1"># BÃ¶rem Ipsum Dolor Sit Amet</span>
    <span class="nb">say</span> <span class="k">S</span><span class="p">:</span><span class="na">mm</span>     <span class="p">/</span><span class="sr">o</span><span class="p">/</span><span class="s2">u</span><span class="p">/;</span>  <span class="c1"># LÃ¼rem Ipsum Dolor Sit Amet</span>
    <span class="nb">say</span> <span class="k">S</span><span class="p">:</span><span class="na">nth</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">/</span><span class="sr">m </span><span class="p">/</span><span class="s2">g</span><span class="p">/;</span> <span class="c1"># LÃ¶rem Ipsug Dolor Sit Amet</span>
    <span class="nb">say</span> <span class="k">S</span><span class="p">:</span><span class="na">x</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>   <span class="p">/</span><span class="sr">m </span><span class="p">/</span><span class="s2">g</span><span class="p">/;</span> <span class="c1"># LÃ¶reg Ipsug Dolor Sit Amet</span>
    <span class="nb">say</span> <span class="k">S</span><span class="p">:</span><span class="na">ss</span><span class="p">/</span><span class="sr">Ipsum Dolor</span><span class="p">/</span><span class="s2">Gipsum\nColor</span><span class="p">/;</span> <span class="c1"># LÃ¶rem Gipsum Color Sit Amet</span>
    <span class="nb">say</span> <span class="k">S</span><span class="p">:</span><span class="na">g</span><span class="p">:</span><span class="na">ii</span><span class="p">:</span><span class="na">nth</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="p">/</span><span class="sr">m</span><span class="p">/</span><span class="s2">g</span><span class="p">/;</span>             <span class="c1"># LÃ¶rem Ipsug Dolor Sit Amet</span>
<span class="p">}</span>
</code></pre></div><p>å¦‚ä½ æ‰€è§, å®ƒä»¬ä»¥ <em>:foo</em> çš„å½¢å¼æ·»åŠ åœ¨æ“ä½œç¬¦ <strong>S</strong> è¿™ä¸ªéƒ¨ä»¶çš„åé¢ã€‚ä½ å¯ä»¥å¤§å¤§æ–¹æ–¹åœ°ä½¿ç”¨ç©ºç™½ç¬¦å·å¹¶ä¸”å‡ ä¸ªå‰¯è¯å¯ä»¥åŒæ—¶ä½¿ç”¨ã€‚ä¸‹é¢æ˜¯å®ƒä»¬çš„æ„ä¹‰ï¼š</p>
<ul>
<li>:g â€”(é•¿å½¢å¼ï¼š<code>:global</code>)å…¨å±€åŒ¹é…ï¼šæ›¿æ¢æ‰æ‰€æœ‰çš„å‡ºç°</li>
<li>:i â€”ä¸åŒºåˆ†å¤§å°å†™çš„åŒ¹é…</li>
<li>:ii â€”(é•¿å½¢å¼ï¼š <code>:samecase</code>) ä¿ç•™å¤§å°å†™ï¼šä¸ç®¡ç”¨ä½œæ›¿æ¢å­—æ¯çš„å¤§å°å†™, ä½¿ç”¨åŸæ¥è¢«æ›¿æ¢çš„å­—æ¯çš„å¤§å°å†™</li>
<li>:mm â€”(é•¿å½¢å¼ï¼š<code>:samemark</code>) ä¿ç•™é‡éŸ³ç¬¦å·ï¼šåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, å­—æ¯ o ä¸Šçš„åˆ†éŸ³ç¬¦å·è¢«ä¿ç•™å¹¶è¢«åº”ç”¨åˆ°æ›¿æ¢å­—æ¯ u ä¸Š</li>
<li>:nth(n) â€”åªæ›¿æ¢ç¬¬ n æ¬¡å‡ºç°çš„</li>
<li>:x(n) â€”è‡³å¤šæ›¿æ¢ n æ¬¡ï¼ˆåŠ©è®°ç¬¦: &lsquo;x&rsquo; ä½œä¸ºåŠæ—¶ï¼‰</li>
<li>:ss â€”(é•¿å½¢å¼ï¼š<code>samespace</code>)ä¿ç•™ç©ºç™½ç±»å‹ï¼šç©ºç™½å­—ç¬¦çš„ç±»å‹è¢«ä¿ç•™, è€Œä¸ç®¡æ›¿æ¢å­—ç¬¦ä¸²ä¸­ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆç©ºç™½å­—ç¬¦ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, æˆ‘ä»¬ä½¿ç”¨æ¢è¡Œä½œä¸ºæ›¿æ¢, ä½†æ˜¯åŸæ¥çš„ç©ºç™½è¢«ä¿ç•™äº†ã€‚</li>
</ul>
<h2 id="æ–¹æ³•å½¢å¼">æ–¹æ³•å½¢å¼</h2>
<p><code>S///</code> æ“ä½œç¬¦å¾ˆå¥½, ä½†æ˜¯æœ‰æ—¶å€™æœ‰ç‚¹ç¬¨æ‹™ã€‚ä¸è¦å®³æ€•, Raku æä¾›äº† <code>.subst</code> æ–¹æ³•èƒ½æ»¡è¶³ä½ æ‰€æœ‰çš„æ›¿æ¢éœ€æ±‚å¹¶ä¸”æ¶ˆé™¤ä½ å¯¹ <code>.subst/.substr</code> çš„å›°æƒ‘ã€‚ä¸‹é¢æ¥çœ‹ä¾‹å­ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#39;</span><span class="s1">meowmix</span><span class="p">&#39;</span><span class="o">.</span><span class="nb">subst</span><span class="o">:</span> <span class="p">&#39;</span><span class="s1">me</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">c</span><span class="p">&#39;;</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">meowmix</span><span class="p">&#39;</span><span class="o">.</span><span class="nb">subst</span><span class="o">:</span> <span class="p">/</span><span class="sr">m</span><span class="ni">.</span><span class="p">/</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">c</span><span class="p">&#39;;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># cowmix</span>
<span class="c1"># cowmix</span>
</code></pre></div><p>è¿™ä¸ªæ–¹æ³•è¦ä¹ˆæ¥æ”¶ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼è¦ä¹ˆæ¥æ”¶ä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ä¸²ä½œä¸ºå®ƒçš„ç¬¬ä¸€ä¸ªä½ç½®å‚æ•°, å®ƒæ˜¯è¦åœ¨è°ƒç”¨è€…é‡Œé¢(&ldquo;meowmix&rdquo;)æŸ¥æ‰¾çš„ä¸œè¥¿ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ›¿æ¢å­—ç¬¦ä¸²ã€‚</p>
<p>é€šè¿‡ç®€å•åœ°æŠŠå®ƒä»¬åˆ—ä¸ºå…·å Bool å‚æ•°, ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å‰¯è¯ã€‚åœ¨ <code>S///</code> å½¢å¼ä¸­, å‰¯è¯ <code>:ss</code> å’Œ <code>:ii</code> åˆ†åˆ«è¡¨æ˜ <code>:s</code>(ä½¿ç©ºç™½æœ‰æ„ä¹‰) çš„å‡ºç°å’Œ  <code>:i</code>(ä¸åŒºåˆ†å¤§å°å†™çš„åŒ¹é…) çš„å‡ºç°ã€‚åœ¨æ–¹æ³•å½¢å¼ä¸­, ä½ å¿…é¡»æŠŠè¿™äº›å‰¯è¯åº”ç”¨åˆ°æ­£åˆ™è¡¨è¾¾å¼è‡ªèº«èº«ä¸Šï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">given</span> <span class="p">&#39;</span><span class="s1">Lorem Ipsum Dolor Sit Amet</span><span class="p">&#39;</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="o">.</span><span class="nb">subst</span><span class="o">:</span> <span class="p">/:</span><span class="na">i</span><span class="sr"> l</span><span class="p">/</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">b</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">:</span><span class="s">ii</span><span class="p">;</span>
    <span class="nb">say</span> <span class="o">.</span><span class="nb">subst</span><span class="o">:</span> <span class="p">/:</span><span class="na">s</span><span class="sr"> Ipsum Dolor</span><span class="p">/</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">Gipsum\nColor</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">:</span><span class="s">ss</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># Borem Ipsum Dolor Sit Amet</span>
<span class="c1"># Lorem Gipsum Color Sit Amet</span>
</code></pre></div><h2 id="æ–¹æ³•å½¢å¼çš„æ•è·">æ–¹æ³•å½¢å¼çš„æ•è·</h2>
<p>æ•è·å¯¹äºæ›¿æ¢æ“ä½œæ¥è¯´ä¸é™Œç”Ÿ, æ‰€ä»¥æˆ‘ä»¬æ¥å°è¯•æ•è·ä¸‹æ–¹æ³•è°ƒç”¨å½¢å¼çš„æ›¿æ¢ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#39;</span><span class="s1">meowmix</span><span class="p">&#39;</span><span class="o">.</span><span class="nb">subst</span><span class="o">:</span> <span class="p">/</span><span class="sr">me </span><span class="p">(</span><span class="ni">.</span><span class="o">+</span><span class="p">)/</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">c</span><span class="nv">$0</span><span class="p">&#34;;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># Use of Nil in string context  in block &lt;unit&gt; at test.p6 line 1</span>
<span class="c1"># c</span>
</code></pre></div><p>ä¸æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ã€‚æˆ‘ä»¬çš„æ›¿æ¢å­—ç¬¦ä¸²æ„å»ºåœ¨è¾¾åˆ° <code>.subst</code> æ–¹æ³•ä¹‹å‰, å¹¶ä¸”é‡Œé¢çš„ <code>$0</code> å˜é‡å®é™…ä¸ŠæŒ‡å‘ä»»ä½•è¿™ä¸ªæ–¹æ³•è°ƒç”¨ä¹‹å‰çš„ä¸œè¥¿, è€Œä¸æ˜¯ <code>.subst</code> æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„æ•è·ã€‚æ‰€ä»¥æˆ‘ä»¬æ€ä¹ˆæ¥ä¿®æ­£å®ƒå‘¢ï¼Ÿ</p>
<p><code>.subst</code> æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ä¹Ÿå¯ä»¥æ¥å—ä¸€ä¸ª <a href="http://docs.raku.org/type/Callable">Callable</a>ã€‚åœ¨å®ƒé‡Œé¢, ä½ å¯ä»¥ä½¿ç”¨ <code>$0, $1, ... $n</code> å˜é‡, ç›´åˆ°ä½ æƒ³è¦çš„ç¼–å·, å¹¶ä»æ•è·ä¸­å¾—åˆ°æ­£ç¡®çš„å€¼ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#39;</span><span class="s1">meowmix</span><span class="p">&#39;</span><span class="o">.</span><span class="nb">subst</span><span class="o">:</span> <span class="p">/</span><span class="sr">me </span><span class="p">(</span><span class="ni">.</span><span class="o">+</span><span class="p">)/</span><span class="o">,</span> <span class="k">-&gt;</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">c</span><span class="nv">$0</span><span class="p">&#34;</span> <span class="p">};</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># cowmix</span>
</code></pre></div><p>è¿™é‡Œ, æˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„ <strong>Callable</strong> ä½¿ç”¨äº†å°–å·å—å„¿, ä½†æ˜¯ <strong>WhateverCode</strong> å’Œå­ä¾‹ç¨‹ä¹Ÿæœ‰æ•ˆã€‚æ¯æ¬¡æ›¿æ¢éƒ½ä¼šè°ƒç”¨è¿™ä¸ª Callable, å¹¶ä¸”æŠŠ <a href="http://docs.raku.org/type/Match">Match</a> å¯¹è±¡ä½œä¸ºç¬¬ä¸€ä¸ªä½ç½®å‚æ•°ä¼ é€’ç»™ Callable, å¦‚æœä½ éœ€è¦è®¿é—®å®ƒçš„è¯ã€‚</p>
<h2 id="ç»“è®º">ç»“è®º</h2>
<p><code>S///</code> æ“ä½œç¬¦åœ¨ Raku ä¸­æ˜¯ <code>s///</code> æ“ä½œç¬¦çš„æˆ˜å‹, å®ƒä¸æ˜¯ä¿®æ”¹åŸæ¥çš„å­—ç¬¦ä¸², è€Œæ˜¯æ‹·è´åŸæ¥çš„å­—ç¬¦ä¸², ä¿®æ”¹, ç„¶åè¿”å›ä¿®æ”¹è¿‡çš„ç‰ˆæœ¬ã€‚è¿™ä¸ªæ“ä½œç¬¦çš„ä½¿ç”¨æ–¹å¼è·Ÿ Perl 5 ä¸­çš„éç ´åæ€§æ›¿æ¢æ“ä½œç¬¦çš„ä½¿ç”¨æ–¹å¼ä¸åŒã€‚ä½œä¸ºå¤‡é€‰, æ–¹æ³•ç‰ˆæœ¬çš„ <code>.subst</code> ä¹Ÿèƒ½ä½¿ç”¨ã€‚ æ–¹æ³•å½¢å¼å’Œæ“ä½œç¬¦å½¢å¼çš„æ›¿æ¢éƒ½èƒ½æ¥æ”¶ä¸€ç»„å‰¯è¯ä»¥ä¿®æ”¹å®ƒä»¬çš„è¡Œä¸º, æ¥æ»¡è¶³ä½ çš„éœ€æ±‚ã€‚</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä¸­çš„ Slip]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-05-19-an-example-of-slip/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-05-19-an-example-of-slip/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>An Example of Slip</blockquote><h2 id="æè¿°">æè¿°</h2>
<p>æœ‰ 7 å—æ¿å­æ”¾åœ¨ä¸€ä¸ª&quot;è¢‹å­&quot;ä¸­, éšæœºä»è¢‹å­ä¸­ç§»é™¤ä¸€ä¸ªæ¿å­å±•ç¤ºåˆ°ç©å®¶é¢å‰ç›´åˆ°è¢‹å­å˜ç©ºã€‚å½“è¢‹å­å˜ç©ºæ—¶, å®ƒä¼šè¢«é‡æ–°è£…å¡«, å¦‚æœéœ€è¦é¢å¤–çš„æ¿å­, åˆ™é‡å¤å‰é¢é‚£ä¸ªè¿‡ç¨‹ã€‚</p>
<h2 id="è¾“å‡º">è¾“å‡º</h2>
<p>ä½¿ç”¨éšæœº bag ç³»ç»Ÿéšæœºè¾“å‡º 50 å—æ¿å­ã€‚</p>
<p>æ¿å­å¦‚ä¸‹:</p>
<ul>
<li>O</li>
<li>I</li>
<li>S</li>
<li>Z</li>
<li>L</li>
<li>J</li>
<li>T</li>
</ul>
<h2 id="è¾“å‡ºæ ·æœ¬">è¾“å‡ºæ ·æœ¬</h2>
<ul>
<li><code>LJOZISTTLOSZIJOSTJZILLTZISJOOJSIZLTZISOJTLIOJLTSZO</code></li>
<li><code>OTJZSILILTZJOSOSIZTJLITZOJLSLZISTOJZTSIOJLZOSILJTS</code></li>
<li><code>ITJLZOSILJZSOTTJLOSIZIOLTZSJOLSJZITOZTLJISTLSZOIJO</code></li>
</ul>
<p>åœ¨ Raku ä¸­æˆ‘ä¼šè¿™æ ·å†™ (smls):</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">(</span><span class="o">|</span><span class="p">&lt;</span><span class="s">O I S Z L J T</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">pick</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="ow">xx</span> <span class="o">*</span><span class="p">)</span><span class="o">.[^</span><span class="mi">50</span><span class="o">].</span><span class="nb">join</span><span class="p">;</span>
</code></pre></div><p>æ³¨æ„:</p>
<ul>
<li><code>|</code> æ“ä½œç¬¦æŠŠæ¯æ¬¡è¿­ä»£çš„é¡¹å±•å¼€è¿›å¤–éƒ¨çš„åˆ—è¡¨ä¸­, ä»¥ä½¿ä½ ä¸å¿…åœ¨ç»“æœä¸Šæ˜¾å¼åœ°è°ƒç”¨ <code>.flat</code> æ–¹æ³•</li>
<li>ä½¿ç”¨ <code>&lt; &gt;</code> å­—ç¬¦ä¸²åˆ—è¡¨å­—é¢é‡çœ‹èµ·æ¥æ¯”åœ¨å­—ç¬¦ä¸²å­—é¢é‡ä¸Šä½¿ç”¨ <code>.comb</code> æ–¹æ³•æ›´åˆé€‚</li>
<li><code>xx</code> æ“ä½œç¬¦æ¯æ¬¡éƒ½ä¼šé‡æ–°è®¡ç®—å®ƒå·¦ä¾§çš„è¡¨è¾¾å¼</li>
</ul>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/slip" term="slip" label="slip" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä¸­çš„ Smile ç±»å‹]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-11-05-smile-type-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-11-05-smile-type-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Smile Type in Raku</blockquote><p>ä¸€ä¸ªè£¸çš„ <strong>:D</strong>ã€<strong>:U</strong>ã€<strong>:T</strong> æˆ– <strong>:_</strong> æ˜¯é™åˆ¶é»˜è®¤ç±»å‹ä¸ºå®šä¹‰ã€æœªå®šä¹‰ã€ç±»å‹å¯¹è±¡æˆ–ä»»ä½•å¯¹è±¡çš„ç±»å‹çº¦æŸã€‚æ‰€ä»¥:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Con</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">man</span><span class="p">(:</span><span class="s">U</span><span class="o">:</span> <span class="p">:</span><span class="s">D</span> <span class="nv">$x</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><p>å…¶ç­¾åç­‰ä»·äº <code>(Con:U: Any:D $x)</code>ã€‚</p>
<p><code>Con:U</code> æ˜¯è°ƒç”¨è€…, åœ¨è°ƒç”¨è€…åé¢åŠ ä¸Šä¸€ä¸ªå†’å·ã€‚è¦æ ‡è®°ä¸€ä¸ªæ˜¾å¼çš„è°ƒç”¨è€…, åœ¨å®ƒåé¢æ”¾ä¸Šä¸€ä¸ªå†’å·å°±å¥½äº†:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">method</span> <span class="nf">doit</span> <span class="p">(</span><span class="nv">$x:</span> <span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="o">,</span> <span class="nv">$c</span><span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div><h3 id="abstract-vs-concrete-types">Abstract vs Concrete types</h3>
<p>ã€€
å¯¹äºä»»ä½•æœ‰åå­—çš„ç±»å‹, æŸäº›å…¶å®ƒå­é›†ç±»å‹å¯ä»¥è‡ªåŠ¨åœ°é€šè¿‡åœ¨ç±»å‹çš„åå­—åé¢è¿½åŠ ä¸€ä¸ªåˆé€‚çš„çŠ¶è¯­æ¥æ´¾ç”Ÿå‡ºæ¥ï¼š</p>
<pre><code>Int:_       å…è®¸å®šä¹‰æˆ–æœªå®šçš„ Int å€¼
Int:D       åªå…è®¸æœ‰å®šä¹‰çš„(å¼ºåˆ¶çš„)Int å€¼
Int:U       åªå…è®¸æœªå®šä¹‰å€¼(æŠ½è±¡æˆ–å¤±è´¥)Int å€¼
Int:T       å…è®¸Intåªä½œä¸ºç±»å‹å¯¹è±¡
</code></pre><p>å³, å®ƒä»¬çš„æ„æ€æœ‰ç‚¹åƒ:</p>
<pre><code>Int:D       Int:_ where DEFINITE($_)
Int:U       Int:_ where not(DEFINITE($_))
Int:T       Int:U where none(Failure)
</code></pre><p><code>where DEFINITE</code> æ˜¯ä¸€ä¸ªå¸ƒå°”å®, å®ƒè¯´æ­£å¤„ç†çš„å¯¹è±¡æ˜¯å¦æœ‰ä¸€ä¸ªåˆæ³•çš„å¼ºåˆ¶è¡¨ç¤ºã€‚(æŸ¥çœ‹ä¸‹é¢çš„è‡ªçœ) .</p>
<p>åœ¨ Raku ä¸­, <strong>Int</strong> é€šå¸¸å‡å®šæ„ä¸º <code>Int:_</code>, é™¤äº†è°ƒç”¨è€…, å…¶ä¸­é»˜è®¤ä¸º <code>Int:D</code>ã€‚ï¼ˆé»˜è®¤çš„ new æ–¹æ³•æœ‰ä¸€ä¸ªåŸå‹, å®ƒçš„è°ƒç”¨è€…æ˜¯ <code>:T</code>, æ‰€ä»¥æ‰€æœ‰çš„ new æ–¹æ³•éƒ½é»˜è®¤å…è®¸ç±»å‹å¯¹è±¡ã€‚ï¼‰</p>
<p>è¿™äº›é»˜è®¤å¯ä»¥é€šè¿‡å„ç§ç¼–è¯‘æŒ‡ä»¤åœ¨è¯æ³•ä½œç”¨åŸŸä¸­æ›´æ”¹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">use</span> <span class="nn">parameters</span> <span class="p">:</span><span class="s">D</span><span class="p">;</span>
</code></pre></div><p>ä¼šè®©éè°ƒç”¨è€…çš„å‚æ•°é»˜è®¤ä¸º <code>:D</code>ã€‚</p>
<p>ä½œä¸ºå¯¹æ¯”,</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">use</span> <span class="nb">variables</span> <span class="p">:</span><span class="s">D</span><span class="p">;</span>
</code></pre></div><p>ä¼šå¯¹ç”¨äºå˜é‡å£°æ˜ä¸­çš„ç±»å‹åšåŒæ ·çš„äº‹æƒ…ã€‚
åœ¨è¿™æ ·çš„è¯æ³•ä½œç”¨åŸŸä¸­, ä½ å¯ä»¥ä½¿ç”¨ <code>:_</code> å½¢å¼å›åˆ°æ ‡å‡†çš„è¡Œä¸ºã€‚ç‰¹åˆ«åœ°, å› ä¸ºè°ƒç”¨è€…é»˜è®¤ä¸ºå®šä¹‰çš„:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">use</span> <span class="nb">invocant</span> <span class="p">:</span><span class="s">_</span><span class="p">;</span>
</code></pre></div><p>ä¼šè®©è°ƒç”¨è€…å…è®¸ä»»ä½•ç±»å‹çš„æœ‰å®šä¹‰çš„å’Œæœªå®šä¹‰çš„è°ƒç”¨è€…ã€‚</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/smile" term="smile" label="smile" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä¸­çš„ twigil]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-12-11-twigils-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2015-11-20-guess-who/?utm_source=atom_feed" rel="related" type="text/html" title="Guess Who" />
                <link href="https://ohmyweekly.github.io/notes/2015-06-10-list-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="List in Raku" />
                <link href="https://ohmyweekly.github.io/notes/2016-01-28-the-s-operator-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="Raku ä¸­çš„ S/// æ“ä½œç¬¦" />
                <link href="https://ohmyweekly.github.io/notes/2016-01-04-an-example-of-raku-subset-and-multi/?utm_source=atom_feed" rel="related" type="text/html" title="ä½¿ç”¨ Raku çš„ subsets å’Œ multi è¾¨åˆ«å¹´é¾„" />
                <link href="https://ohmyweekly.github.io/notes/2015-11-11-add-a-method-to-an-existing-class-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="åœ¨ Raku ä¸­æ€ä¹ˆä¸ºå·²å­˜åœ¨çš„ç±»æ·»åŠ æ–¹æ³•" />
            
                <id>https://ohmyweekly.github.io/notes/2015-12-11-twigils-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Twigils in Raku</blockquote><h2 id="raku-ä¸­çš„--å’Œ--twigil-æ˜¯ä»€ä¹ˆ">Raku ä¸­çš„ <code>.</code> å’Œ <code>!</code> <strong>twigil</strong> æ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p><code>.</code> <strong>twigil</strong> çš„æ„æ€æ˜¯&quot;è¿™æ˜¯ç±»å…¬ç”¨çš„&quot;, <code>!</code> <strong>twigil</strong> çš„æ„æ€æ˜¯â€œè¿™æ˜¯ç±»ç§æœ‰çš„â€, åªèƒ½ç”¨åœ¨ç±»çš„å†…éƒ¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">ScoreKeeper</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">@.options</span><span class="p">;</span>
Â  Â  <span class="k">has</span> <span class="nv">%!player-points</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>æ™®é€šçš„ç¬¦å·è¡¨æ˜äº†è¯æ³•ä½œç”¨åŸŸæˆ–åŒ…ä½œç”¨åŸŸ, ä½†æ˜¯ <strong>twigils</strong> å°±åƒæ˜¯ <strong>sigils</strong> çš„å…„å¼Ÿ, è¡¨æ˜äº†ä¸åŒçš„ä½œç”¨åŸŸ, å®ƒå½±å“äº†å˜é‡çš„ä½œç”¨åŸŸã€‚<code>.</code> å’Œ <code>!</code> æ˜¯äºŒçº§ <strong>sigils</strong>ã€‚</p>
<p>å±æ€§å­˜åœ¨äºæ¯ä¸ªç±»çš„å®ä¾‹ä¸­, åœ¨ç±»çš„å†…éƒ¨, å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>!</code> è®¿é—®åˆ°å®ä¾‹çš„å±æ€§:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Point</span> <span class="p">{</span>
Â  Â  <span class="k">has</span> <span class="nv">$.x</span><span class="p">;</span>
Â  Â  <span class="k">has</span> <span class="nv">$.y</span><span class="p">;</span>

Â  Â  <span class="k">method</span> <span class="nb">Str</span><span class="p">()</span> <span class="p">{</span>
Â  Â  Â  Â  <span class="p">&#34;</span><span class="s2">(</span><span class="nv">$!x</span><span class="s2">, </span><span class="nv">$!y</span><span class="s2">)</span><span class="p">&#34;</span>
Â  Â  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>é‚£ä¹ˆ <code>.</code> <strong>twigil</strong> å’Œ <code>!</code> <strong>twigil</strong> ä¹‹é—´æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Point</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.x</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.y</span><span class="p">;</span>

    <span class="k">method</span> <span class="nb">Str</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1"># æ³¨æ„è¿™æ¬¡æˆ‘ä»¬ä½¿ç”¨ . è€Œé !</span>
        <span class="p">&#34;</span><span class="s2">\$.x ç­‰ä»·äº self.x()</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">say</span>  <span class="k">if</span> <span class="nv">$.x</span> <span class="o">==</span> <span class="nb">self</span><span class="o">.</span><span class="nb">x</span><span class="p">();</span>
        <span class="p">&#34;</span><span class="s2">\$.y ç­‰ä»·äº self.y()</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">say</span>  <span class="k">if</span> <span class="nv">$.y</span> <span class="o">==</span> <span class="nb">self</span><span class="o">.</span><span class="nf">y</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nb">print</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="nb">self</span><span class="o">.</span><span class="nb">x</span><span class="p">();</span> <span class="c1"># è°ƒç”¨å®ä¾‹çš„åä¸º x çš„æ–¹æ³•</span>
        <span class="nb">say</span> <span class="nb">self</span><span class="o">.</span><span class="nf">y</span><span class="p">();</span> <span class="c1"># è°ƒç”¨å®ä¾‹çš„åä¸º y çš„æ–¹æ³•</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$point</span> <span class="o">=</span> <span class="n">Point</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">x</span> <span class="o">=&gt;</span> <span class="mi">10</span>, <span class="s">y</span> <span class="o">=&gt;</span> <span class="mi">20</span><span class="p">);</span>
<span class="nv">$point</span><span class="o">.</span><span class="nb">Str</span><span class="p">;</span>   
<span class="nv">$point</span><span class="o">.</span><span class="nb">print</span><span class="p">;</span>
</code></pre></div><p>ä¼šè¾“å‡º:</p>
<pre><code>$.x ç­‰ä»·äº self.x()
$.y ç­‰ä»·äº self.y()
10
20
</code></pre><p>æ³¨æ„åˆ°, å±æ€§è¢«å£°æ˜ä¸º <code>$.x</code> å’Œ <code>$.y</code>, ä½†æ˜¯åœ¨ç±»çš„å†…éƒ¨ä»æ—§èƒ½é€šè¿‡ <code>$!x</code> å’Œ <code>$!y</code> æ¥è®¿é—®å±æ€§ã€‚è¿™æ˜¯å› ä¸ºåœ¨ Raku ä¸­æ‰€æœ‰çš„å±æ€§éƒ½æ˜¯ç§æœ‰çš„å¹¶ä¸”åœ¨ç±»ä¸­å¯ä»¥é€šè¿‡ <code>$!attribute-name</code> ç›´æ¥è®¿é—®è¿™äº›å±æ€§ã€‚Raku å¯ä»¥ä¸ºä½ è‡ªåŠ¨ç”Ÿæˆå­˜å–æ–¹æ³•ã€‚</p>
<p>å…¬å…±å±æ€§æ‹¥æœ‰ <code>.</code> twigil, ç§æœ‰å±æ€§æ‹¥æœ‰ <code>!</code> twigilã€‚</p>
<p><code>has $.x</code> å°±æ˜¯ç§æœ‰å±æ€§ <code>has $!x</code> åŠ ä¸Šä¸€ä¸ª<code>getter</code>æ–¹æ³•, å³ <code>method x() { ... }</code>ã€‚</p>
<p><code>has $.x is rw</code> å°±æ˜¯ç§æœ‰å±æ€§ <code>has $!x</code> åŠ ä¸Šä¸€ä¸ª<code>getter/setter</code>æ–¹æ³•ã€‚</p>
<h2 id="-twigil-å°±æ˜¯è°ƒç”¨äº†ä¸å±æ€§åŒåçš„æ–¹æ³•">. <strong>twigil</strong> å°±æ˜¯è°ƒç”¨äº†ä¸å±æ€§åŒåçš„æ–¹æ³•</h2>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">SaySomething</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">a</span><span class="p">()</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">a</span><span class="p">&#34;;</span>  <span class="p">}</span>
    <span class="k">method</span> <span class="nf">b</span><span class="p">()</span> <span class="p">{</span> <span class="nv">$.a</span><span class="p">;</span>      <span class="p">}</span>
    <span class="k">method</span> <span class="nf">c</span><span class="p">()</span> <span class="p">{</span> <span class="nb">self</span><span class="o">.</span><span class="nf">a</span><span class="p">();</span> <span class="p">}</span> <span class="c1"># è¿™è¯æ˜äº† $.a çš„ . twigil åšäº†ä¸€æ¬¡éšå¼çš„å®ä¾‹æ–¹æ³•è°ƒç”¨ã€‚</span>
<span class="p">}</span>

<span class="n">SaySomething</span><span class="o">.</span><span class="nf">b</span><span class="p">;</span> <span class="c1"># æ‰“å° &#34;a&#34;</span>
<span class="n">SaySomething</span><span class="o">.</span><span class="nf">c</span><span class="p">;</span> <span class="c1"># æ‰“å° &#34;a&#34;</span>
</code></pre></div><h2 id="-twigil-ä¸­è‡ªåŠ¨ç”Ÿæˆçš„æ–¹æ³•å¯ä»¥è¢«å­ç±»é‡å†™">. <strong>twigil</strong> ä¸­è‡ªåŠ¨ç”Ÿæˆçš„æ–¹æ³•å¯ä»¥è¢«å­ç±»é‡å†™</h2>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Point</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.x</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.y</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Circle</span> <span class="k">is</span> <span class="nc">Point</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$!radius</span><span class="p">;</span>

    <span class="c1"># é‡å†™çˆ¶ç±»ä¸­çš„ x() æ–¹æ³•å’Œ y() æ–¹æ³•</span>
    <span class="k">method</span> <span class="nb">x</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">&#34;</span><span class="s2">I am x point in a Circle</span><span class="p">&#34;;</span>
    <span class="p">}</span>
    <span class="k">method</span> <span class="nf">y</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">&#34;</span><span class="s2">I am y point in a Circle</span><span class="p">&#34;;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$circle</span> <span class="o">=</span> <span class="n">Circle</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">radius</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">);</span>
<span class="nv">$circle</span><span class="o">.</span><span class="nb">x</span><span class="p">()</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span> <span class="c1"># I am x point in a Circle</span>
<span class="nv">$circle</span><span class="o">.</span><span class="nf">y</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>   <span class="c1"># I am y point in a Circle</span>
</code></pre></div><p>å¦‚æœä¸æƒ³å­ç±»é‡å†™çˆ¶ç±»ä¸­çš„æ–¹æ³•, é‚£ä¹ˆåœ¨çˆ¶ç±»ä¸­å£°æ˜å±æ€§çš„æ—¶å€™, ä½¿ç”¨ <code>!</code> <strong>twigil</strong> æ›¿ä»£ <code>.</code> <strong>twigil</strong>ã€‚</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä¸­çš„ unspace]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-09-18-unspace-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-09-18-unspace-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Unspace in Raku</blockquote><h2 id="ç©ºæ ¼æœ€å°‘åŒ–">ç©ºæ ¼æœ€å°‘åŒ–</h2>
<p>åœ¨æ•°ç»„æˆ–æ•£åˆ—çš„å¼€æ‹¬å·(å³ä¸‹æ ‡å·¦è¾¹çš„é‚£ä¸ªæ‹¬å·)ä¹‹å‰ä¸å…è®¸æœ‰ç©ºæ ¼, å‚æ•°åˆ—è¡¨çš„åœ†å¼€æ‹¬å·å‰é¢ä¹Ÿæ˜¯ä¸èƒ½æœ‰ç©ºæ ¼çš„ã€‚å³:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@deadbeef</span><span class="o">[</span><span class="nv">$x</span><span class="o">]</span>         <span class="c1"># okay</span>
<span class="nv">%monsters</span><span class="p">{&#39;</span><span class="s1">cookie</span><span class="p">&#39;}</span>   <span class="c1"># okay</span>
<span class="nf">saymewant</span><span class="p">(&#39;</span><span class="s1">cookie</span><span class="p">&#39;)</span>   <span class="c1"># okay</span>

<span class="nv">@a</span>       <span class="o">[</span><span class="nv">$b</span><span class="o">]</span>         <span class="c1"># WRONG</span>
<span class="nv">%people</span>  <span class="p">{&#39;</span><span class="s1">john</span><span class="p">&#39;}</span>     <span class="c1"># WRONG</span>
<span class="n">mewant</span>   <span class="p">(&#39;</span><span class="s1">cookie</span><span class="p">&#39;)</span>   <span class="c1"># WRONG</span>
</code></pre></div><p>è¿™ç§é™åˆ¶çš„çš„å‡ ä¸ªå‰¯ä½œç”¨ä¹‹ä¸€å°±æ˜¯æ¡ä»¶æ§åˆ¶ç»“æ„çš„å‘¨å›´ä¸å†éœ€è¦åœ†æ‹¬å·äº†:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="nv">$value</span> <span class="ow">eq</span> <span class="nv">$target</span> <span class="p">{</span>
    <span class="nb">print</span> <span class="p">&#34;</span><span class="s2">Bullseye!</span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="k">while</span> <span class="nv">$i</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="p">{</span> <span class="nv">$i</span><span class="o">++</span> <span class="p">}</span>
</code></pre></div><p>ç„¶è€Œ, æ˜¾å¼çš„ä½¿ç”¨ <code>unspace</code> è¯­æ³•ä»ç„¶èƒ½å¤Ÿè®©ä½ å¯¹é½ä¸‹æ ‡å’Œåç¼€æ“ä½œç¬¦:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">%squirrels</span><span class="p">{&#39;</span><span class="s1">fluffy</span><span class="p">&#39;}</span> <span class="o">=</span> <span class="n">Squirrel</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>
<span class="nv">%monsters</span><span class="o">.</span><span class="p">{&#39;</span><span class="s1">cookie</span><span class="p">&#39;}</span> <span class="o">=</span> <span class="n">Monster</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>
<span class="nv">%beatles</span>\<span class="o">.</span><span class="p">{&#39;</span><span class="s1">ringo</span><span class="p">&#39;}</span>  <span class="o">=</span> <span class="n">Beatle</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>
<span class="nv">%people</span>\ <span class="o">.</span><span class="p">{&#39;</span><span class="s1">john</span><span class="p">&#39;}</span>   <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>
</code></pre></div><h2 id="unspace">unspace</h2>
<p>æœ‰äº›è¯­è¨€ä¾‹å¦‚ <code>C</code> å…è®¸ä½ è½¬ä¹‰ä¸€ä¸ªæ¢è¡Œç¬¦ä½¿è¡Œè”åˆèµ·æ¥. å…¶å®ƒè¯­è¨€(ä¾‹å¦‚æ­£åˆ™è¡¨è¾¾å¼)å› ä¸ºå„ç§å„æ ·çš„åŸå› , å…è®¸ä½ ä½¿ç”¨åæ–œçº¿è½¬ä¹‰ä¸€ä¸ªç©ºç™½ç¬¦ã€‚Raku æŠŠè¿™ç§è®°æ³•æ¨å¹¿åˆ°ä»»ä½•ç§ç±»çš„ç©ºç™½ä¸Šã€‚é€šè¿‡åœ¨ç©ºç™½å¤„å‰ç½®ä¸€ä¸ª <code>\</code>, ä»»ä½•ç›¸é‚»çš„ç©ºç™½(åŒ…æ‹¬æ³¨é‡Š)éƒ½ä¼šåœ¨è§£æå™¨é¢å‰éšèº«ã€‚è¿™å°±æ˜¯é¼é¼å¤§åçš„ç©ºç™½éšèº«(â€œunspaceâ€)ã€‚</p>
<p>åœ¨ Raku ä¸­, <a href="https://design.raku.org/S02.html">unspace</a> èƒ½å¤ŸæŠ‘åˆ¶ä»»æ„çš„å‡ ç§ç©ºç™½é™„å±ç‰©ã€‚ä¾‹å¦‚, å› ä¸º Raku è¦æ±‚åè¯å’Œåç¼€æ“ä½œç¬¦ä¹‹é—´ä¸èƒ½å‡ºç°ç©ºç™½, æ‰€ä»¥ä½¿ç”¨ unspace è®©ä½ å¯ä»¥æŠŠåç¼€æ“ä½œç¬¦è´´çº¿å¯¹é½:</p>
<pre><code>%hash\  {$key}
@array\ [$ix]
$subref\($arg)
</code></pre><p>ä¸Šé¢çš„æœ€åä¸€ç§å½¢å¼ä½œä¸ºä¸€ç§é€€åŒ–äº†çš„ unspace, å³åæ–œçº¿åé¢ç›´æ¥è·Ÿç€åç¼€ã€‚æ³¨æ„, åæ–œçº¿å‰é¢ä¸å…è®¸æœ‰ç©ºç™½, æ‰€ä»¥:</p>
<pre><code>$subref \($arg)
</code></pre><p>æ˜¯è¯­æ³•é”™è¯¯(two terms in a row)ã€‚è€Œ:</p>
<pre><code>foo \($arg)
</code></pre><p>ä¼šè¢«è§£æä¸ºå¸¦æœ‰ <code>Capture</code> å‚æ•°çš„åˆ—è¡¨æ“ä½œ:</p>
<pre><code>foo(\($arg))
</code></pre><p>ç„¶è€Œ, å…¶å®ƒå½¢å¼çš„ unspace å¯èƒ½è¢«æœ‰æ•ˆåœ°æ”¾åœ¨ç©ºç™½ä¹‹å‰.</p>
<p>å…¶å®ƒåç¼€æ“ä½œç¬¦ä¹Ÿå¯èƒ½ä½¿ç”¨ unspace:</p>
<pre><code>$number\  ++;
$number\  --;
1+3\      i;
$object\  .say();
$object\#`{ your ad here }.say
</code></pre><p>å¦å¤–ä¸€ç§&quot;ä½ çœ‹ä¸è§è¿™ç©ºç™½&quot;çš„æ­£å¸¸ç”¨æ³•æ˜¯, åœ¨ä¸‹ä¸€è¡Œæ”¾ä¸Šä¸€ä¸ªç‚¹è¯­æ³•å½¢å¼çš„åç¼€:</p>
<pre><code>    $object\ # comment
    .say
     $object\#`[ comment
    ].say
     $object\
    .say
</code></pre><p>ä½†æ˜¯ unspace ä¸»è¦æ˜¯å…³äºè¯­è¨€æ‰©å±•çš„: å®ƒè®©ä½ åœ¨æ¢è¡Œå¯èƒ½ä¼šä½¿è§£æå™¨å›°æƒ‘çš„åœ°æ–¹, è®©è¡Œåœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½èƒ½ç»§ç»­, ä¸ç®¡ä½ å½“å‰å®‰è£…çš„æ˜¯ä»€ä¹ˆè§£æå™¨ã€‚(é™¤é, å½“ç„¶, ä½ è‡ªå·±è¦†å†™äº† unspace è§„åˆ™&hellip;)</p>
<p>å°½ç®¡æˆ‘ä»¬è¯´, unspace è®©ç©ºç™½åœ¨è§£æå™¨é¢å‰éšèº«äº†, ä½†æ˜¯å®ƒå¹¶ä¸èƒ½ä½¿ç©ºç™½åœ¨è¯æ³•åˆ†æç¨‹åºé¢å‰éšèº«ã€‚ç»“æœå°±æ˜¯, åœ¨ token ä¸­ç¦æ­¢äº† unspaceã€‚æ­¤å¤–, å¦‚æœ unspace åŒ…å«ä¸€è¡Œæˆ–å¤šè¡Œ, å®ƒä»¬çš„è¡Œæ•°ä»ç„¶ä¼šè¢«è®¡ç®—åœ¨å†…ã€‚</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/unspace" term="unspace" label="unspace" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä¸­çš„å…ƒå¯¹è±¡]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-07-16-metaobject-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-07-16-metaobject-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Metaobject in Raku</blockquote><h1 id="è‡ªçœå’Œ-raku-çš„å¯¹è±¡ç³»ç»Ÿ">è‡ªçœå’Œ Raku çš„å¯¹è±¡ç³»ç»Ÿ</h1>
<p>Raku æ˜¯æ„å»ºåœ¨å…ƒå¯¹è±¡å±‚ä¸Šé¢çš„ã€‚é‚£æ„å‘³ç€æœ‰äº›å¯¹è±¡(å…ƒå¯¹è±¡)æ§åˆ¶ç€å„ç§é¢å‘å¯¹è±¡ç»“æ„(ä¾‹å¦‚ç±»ã€rolesã€æ–¹æ³•ã€å±æ€§ã€æšä¸¾â€¦)æ€æ ·å»è¡¨ç°ã€‚</p>
<p>è¦æ„Ÿå—ç±»çš„å…ƒå¯¹è±¡, è¿™å„¿æœ‰ä¸€ä¸ªåŒæ ·çš„ä¾‹å­å‡ºç°2æ¬¡: ä¸€æ¬¡ä¸€ç§ Rakuä¸­çš„æ™®é€šå£°æ˜, ä¸€æ¬¡é€šè¿‡å…ƒæ¨¡å‹æ¥è¡¨è¾¾:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nb">x</span><span class="p">()</span> <span class="p">{</span> <span class="nb">say</span> <span class="mi">42</span> <span class="p">}</span>
<span class="p">}</span>

<span class="n">A</span><span class="o">.</span><span class="nb">x</span><span class="p">();</span> <span class="c1"># 42</span>
</code></pre></div><p>å¯¹åº”äº:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">constant</span> <span class="no">A</span> <span class="o">:=</span> <span class="nb">Metamodel::ClassHOW</span><span class="o">.</span><span class="nb">new_type</span><span class="p">(</span> <span class="s">name</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">A</span><span class="p">&#39;</span> <span class="p">);</span>  <span class="c1"># class A {</span>
<span class="n">A</span><span class="o">.^</span><span class="nb">add_method</span><span class="p">(&#39;</span><span class="s1">x</span><span class="p">&#39;</span><span class="o">,</span> <span class="k">my</span> <span class="k">method</span> <span class="nb">x</span><span class="p">(</span><span class="n">A:</span><span class="p">)</span> <span class="p">{</span> <span class="nb">say</span> <span class="mi">42</span> <span class="p">});</span>             <span class="c1"># method x() .. .</span>
<span class="n">A</span><span class="o">.^</span><span class="nb">compose</span><span class="p">;</span>                                                 <span class="c1"># }</span>

<span class="n">A</span><span class="o">.</span><span class="nb">x</span><span class="p">();</span> <span class="c1"># 42</span>
</code></pre></div><p>(é™¤äº†å£°æ˜å½¢å¼çš„è¿è¡Œåœ¨ç¼–è¯‘æ—¶, åé¢è¿™ç§å½¢å¼ä¸æ˜¯)</p>
<p>å¯¹è±¡åé¢çš„å…ƒå¯¹è±¡èƒ½ä½¿ç”¨ <code>$obj.HOW</code> è·å–, è¿™å„¿çš„ HOW ä»£è¡¨ç€ <strong>Higher Order Workings</strong>(æˆ–è€… HOW the <code>*%@$</code> does this work?)ã€‚</p>
<p>è¿™å„¿, å¸¦æœ‰ <code>.^</code> çš„è°ƒç”¨æ˜¯å…ƒå¯¹è±¡çš„è°ƒç”¨, æ‰€ä»¥ <code>A.^compose</code> æ˜¯ <code>A.HOW.compose(A)</code> çš„ç®€å†™ã€‚è°ƒç”¨è€…ä¹Ÿè¢«ä¼ é€’åˆ°å‚æ•°åˆ—è¡¨ä¸­, ä»¥ä½¿å®ƒèƒ½å¤Ÿæ”¯æŒåŸå‹ç±»å‹é£æ ¼çš„ç±»å‹ç³»ç»Ÿ, é‚£å„¿åªæœ‰ä¸€ä¸ªå…ƒå¯¹è±¡ã€‚</p>
<p>å°±åƒä¸Šé¢çš„ä¾‹å­å±•ç¤ºçš„é‚£æ ·, æ‰€æœ‰çš„é¢å‘å¯¹è±¡ç‰¹æ€§å¯¹ä½¿ç”¨è€…éƒ½æ˜¯å¯è·å¾—çš„, è€Œä¸ä»…ä»…æ˜¯ç¼–è¯‘å™¨ã€‚å®é™…ä¸Šç¼–è¯‘å™¨å°±æ˜¯ä½¿ç”¨å…ƒå¯¹è±¡çš„è¿™æ ·çš„è°ƒç”¨çš„ã€‚</p>
<h2 id="å…ƒå¯¹è±¡metaobjects">å…ƒå¯¹è±¡(MetaObjects)</h2>
<p>è¿™äº›æ˜¯å†…çœçš„å®, ç±»ä¼¼äºæ–¹æ³•è°ƒç”¨ã€‚</p>
<p>å…ƒå¯¹è±¡é€šå¸¸ä»¥ ALLCAPS(å…¨å¤§å†™)å‘½å, å¹¶ä¸”é¿å…ä½¿ç”¨ä½ è‡ªå·±çš„å¸¦æœ‰å…¨å¤§å†™åå­—çš„æ–¹æ³•è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå¥½çš„é£æ ¼ã€‚è¿™ä¼šé¿å…å’Œå¯èƒ½å‡ºç°åœ¨æœªæ¥ç‰ˆæœ¬ä¸­çš„ä»»ä½•å…ƒå¯¹è±¡å‘ç”Ÿå†²çªã€‚æ³¨æ„, å¦‚æœä½ å¿…é¡»ä½¿ç”¨å¸¦æœ‰å…¨å¤§å†™åå­—çš„æ–¹æ³•çš„è¯, æŠŠä½ çš„è¿™ä¸ªæ–¹æ³•åå­—ç”¨å¼•å·å¼•èµ·æ¥æ¥é—´æ¥å®‰å…¨åœ°è°ƒç”¨:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">#| </span><span class="sd">THIS IS A CLASS FOR SHOUTING THINGS
</span><span class="sd"></span><span class="k">class</span> <span class="nc">MY-CLASSES-ARE-ALL-CAPS</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nb">WHY</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">I DON&#39;T KNOW</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$c</span> <span class="o">=</span> <span class="n">MY-CLASSES-ARE-ALL-CAPS</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$c</span><span class="o">.</span><span class="nb">WHY</span>      <span class="c1"># &#34;THIS IS A CLASS FOR SHOUTING THINGS&#34;? æ˜¾ç¤ºè¿™ï¼Ÿä½ åœ¨é€—æˆ‘!</span>
<span class="nb">say</span> <span class="nv">$c</span><span class="o">.</span><span class="p">&#34;</span><span class="s2">WHY</span><span class="p">&#34;()</span>  <span class="c1"># &#34;I DON&#39;T KNOW&#34;</span>
</code></pre></div><h2 id="what">WHAT</h2>
<p>ç±»å‹çš„ç±»å‹å¯¹è±¡ã€‚ä¾‹å¦‚ <code>42.WHAT</code> è¿”å› <code>Int</code> ç±»å‹å¯¹è±¡ã€‚</p>
<h2 id="which">WHICH</h2>
<p>å¯¹è±¡çš„åŒä¸€å€¼ã€‚è¿™èƒ½ç”¨äºå“ˆå¸Œå’ŒåŒä¸€æ¯”è¾ƒ, å¹¶ä¸”è¿™æ˜¯ <code>===</code> ä¸­ç¼€æ“ä½œç¬¦çš„å®ç°æ–¹å¼ã€‚</p>
<pre><code>&gt; &quot;a&quot;.WHICH
Str|a
</code></pre><h2 id="who">WHO</h2>
<p>æ”¯æŒå¯¹è±¡çš„åŒ…</p>
<pre><code>&gt; &quot;a&quot;.WHO
Str
</code></pre><h2 id="where">WHERE</h2>
<p>å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚æ³¨æ„è¿™åœ¨ç§»åŠ¨çš„/ç´§å‡‘çš„åƒåœ¾å›æ”¶å®ç°ä¸­æ˜¯ä¸ç¨³å®šçš„ã€‚ åœ¨ç¨³å®šçš„åŒä¸€æŒ‡ç¤ºå™¨ä¸­ä½¿ç”¨ <code>WHERE</code>ã€‚</p>
<h2 id="how">HOW</h2>
<p>å…ƒç±»å¯¹è±¡(the metaclass object)ï¼šâ€œHigher Order Workingsâ€ã€‚</p>
<h2 id="why">WHY</h2>
<p>é™„åŠ çš„ Pod å€¼ã€‚</p>
<h2 id="definite">DEFINITE</h2>
<p>å¯¹è±¡æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„å¼ºåˆ¶è¡¨ç°ã€‚</p>
<p>å¯¹äºå®ä¾‹è¿”å› <code>True</code>, å¯¹äºç±»å‹å¯¹è±¡è¿”å› <code>False</code>ã€‚</p>
<pre><code>&gt; 42.DEFINITE
True
&gt; Int.DEFINITE
False
</code></pre><h2 id="var">VAR</h2>
<p>è¿”å›åº•å±‚çš„ Scalar å¯¹è±¡, å¦‚æœæœ‰çš„è¯ã€‚</p>
<h2 id="å…ƒå¯¹è±¡ç³»ç»Ÿçš„ç»“æ„">å…ƒå¯¹è±¡ç³»ç»Ÿçš„ç»“æ„</h2>
<p>å¯¹äºæ¯ä¸ªç±»å‹å£°æ˜ç¬¦å…³é”®å­—, ä¾‹å¦‚ <code>class</code>ã€<code>role</code> ã€<code>enum</code>ã€<code>module</code>ã€<code>package</code>ã€<code>grammar</code> æˆ– <code>subset</code>, å°±æœ‰ä¸€ä¸ªç‹¬ç«‹çš„å…ƒç±»åœ¨ <code>Matamodel::</code> å‘½åç©ºé—´ä¸­ã€‚(Rakudo åœ¨ <code>Raku::Metamodel::</code> å‘½åç©ºé—´ä¸­å®ç°äº†å®ƒä»¬, ç„¶åæŠŠ <code>Raku::Metamodel</code> æ˜ å°„åˆ° <code>Metamodel</code>)ã€‚</p>
<p>è¿™äº›å…ƒç±»(meta classes)ä¸­çš„å¾ˆå¤šéƒ½å…±äº«å…¬å…±çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ rolesã€grammars å’Œ classes(ç±»)éƒ½èƒ½åŒ…æ‹¬æ–¹æ³•å’Œå±æ€§, è¿˜èƒ½éµå®ˆ rolesã€‚è¿™ä¸ªå…±äº«çš„åŠŸèƒ½æ˜¯åœ¨ roles ä¸­å®ç°çš„, å®ƒè¢«ç»„åˆè¿›åˆé€‚çš„å…ƒç±»ä¸­ã€‚ä¾‹å¦‚ <a href="http://doc.raku.org/type/Metamodel::RoleContainer">role Metamodel::RoleContainer</a>å®ç°äº†ç±»å‹èƒ½å¤„ç† roles å’Œ <code>Metamodel::ClassHOW</code> çš„åŠŸèƒ½, å®ƒæ˜¯åœ¨ <code>class</code> å…³é”®å­—åé¢çš„å…ƒç±», éµå®ˆäº†è¿™ä¸ª roleã€‚</p>
<h2 id="bootstrapping-concernshttpdocrakuorglanguagemop___top"><a href="http://doc.raku.org/language/mop#___top">Bootstrapping concerns</a></h2>
<p>ä½ å¯èƒ½æƒ³çŸ¥é“ä¸ºä»€ä¹ˆ <code>Metamodel::ClassHOW</code> å¯ä»¥æ˜¯ä¸€ä¸ªç±», å½“æŒ‰ç…§ <code>Metamodel::ClassHOW</code> ä½œä¸ºä¸€ä¸ªç±»è¢«å®šä¹‰æ—¶, æˆ–è€… roles è´Ÿè´£ role å¤„ç†çš„æ€ä¹ˆèƒ½æ˜¯ rolesã€‚ç­”æ¡ˆæ˜¯é€šè¿‡é­”æ³•ã€‚</p>
<p>å¼€ç©ç¬‘å•¦ã€‚è‡ªä¸¾æ˜¯ç‰¹åˆ«å®ç°çš„ã€‚Rakudo ä½¿ç”¨è¯­è¨€çš„å¯¹è±¡ç³»ç»Ÿæ¥å®ç°è‡ªä¸¾, å®ƒæ°å¥½(å‡ ä¹)å°±æ˜¯ Raku çš„ä¸€ä¸ªå­é›†: NQP, Not Quite Perlã€‚ NQP æœ‰åŸå§‹çš„, class-like å«åš <code>konwhow</code> çš„æ€§è´¨, å®ƒç”¨äºè‡ªä¸¾å®ƒè‡ªå·±çš„ç±»å’Œ roles å®ç°ã€‚<code>konwhow</code> å»ºç«‹åœ¨NQP æä¾›çš„è™šæ‹Ÿæœºçš„åŸå§‹åŸºç¡€ä¸Šã€‚</p>
<p>å› ä¸ºå…ƒå¯¹è±¡æ˜¯æ ¹æ®ä½çº§(low-level)ç±»å‹å¼•å¯¼çš„, è‡ªçœæœ‰æ—¶èƒ½è¿”å›ä½çº§(low-level)ç±»å‹è€Œéä½ æœŸæœ›çš„é‚£ä¸ªç±»å‹, ä¾‹å¦‚è¿”å›ä¸€ä¸ª NQP-level çš„å­ä¾‹ç¨‹è€Œéæ™®é€šçš„ <code>Routine</code> å¯¹è±¡, æˆ–è¿”å›ä¸€ä¸ªå¼•å¯¼çš„å±æ€§è€Œé<a href="http://doc.raku.org/type/Attribute">Attribute</a>ã€‚</p>
<h2 id="ç»„åˆå’Œé™æ€æ¨ç†">ç»„åˆå’Œé™æ€æ¨ç†</h2>
<p>åœ¨ Rakuä¸­, ç±»å‹æ˜¯åœ¨è§£ææ—¶è¢«æ„é€ çš„, æ‰€ä»¥åœ¨å¼€å§‹, å®ƒå¿…é¡»æ˜¯å¯å˜çš„ã€‚ç„¶è€Œ, å¦‚æœæ‰€æœ‰ç±»å‹ä¸€ç›´æ˜¯å¯å˜çš„, é‚£ä¹ˆå…³äºç±»å‹çš„æ‰€æœ‰æ¨æ–­ä¼šåœ¨ä»»ä½•ç±»å‹çš„ä¿®æ”¹æ—¶å˜å¾—æ— æ•ˆã€‚ä¾‹å¦‚çˆ¶ç±»çš„åˆ—è¡¨å› æ­¤ç±»å‹æ£€æµ‹çš„ç»“æœèƒ½åœ¨é‚£ä¸ªæ—¶å€™æ”¹å˜ã€‚</p>
<p>æ‰€ä»¥ä¸ºäº†è·å¾—è¿™ä¸¤ä¸ªä¸–ç•Œä¸­æœ€å¥½çš„ä¸œè¥¿, å½“ç±»å‹ä»å¯å˜è½¬ä¸ºä¸å¯å˜æ—¶æ˜¯å¥½æ—¶æœºã€‚è¿™å°±å«åšç»„åˆ, å¹¶ä¸”å¯¹äºä»å¥æ³•æ„æˆä¸Šå£°æ˜çš„ç±»å‹, å®ƒå‘ç”Ÿåœ¨ç±»å‹å£°æ˜è¢«å®Œå…¨è§£ææ—¶(æ‰€ä»¥æ€»æ˜¯åœ¨é—­åˆèŠ±æ‹¬å·è¢«è§£ææ—¶)ã€‚</p>
<p>å¦‚æœä½ é€šè¿‡å…ƒå¯¹è±¡ç³»ç»Ÿç›´æ¥åˆ›å»ºç±»å‹, ä½ å¿…é¡»è¦åœ¨å®ƒä»¬èº«ä¸Šè°ƒç”¨ <code>.^compose</code>, åœ¨å®ƒä»¬å˜å¾—å®Œå…¨èµ·ä½œç”¨ä¹‹å‰ã€‚</p>
<p>å¾ˆå¤šå…ƒç±»ä¹Ÿä½¿ç”¨ç»„åˆæ—¶æ¥è®¡ç®—ä¸€äº›è¯¸å¦‚æ–¹æ³•è§£æé¡ºåºè¿™æ ·çš„å±æ€§, å‘å¸ƒä¸€ä¸ªæ–¹æ³•ç¼“å­˜, å’Œå…¶å®ƒæ¸…æ‰«ä»»åŠ¡ã€‚åœ¨å®ƒä»¬è¢«ç»„åˆä¹‹åå¹²é¢„ç±»å‹æœ‰æ—¶æ˜¯å¯èƒ½çš„, ä½†é€šå¸¸æ˜¯é€ æˆç¾éš¾çš„å› ç´ ã€‚ ä¸è¦é‚£æ ·åšã€‚</p>
<h2 id="èƒ½åŠ›å’Œè´£ä»»">èƒ½åŠ›å’Œè´£ä»»</h2>
<p>å…ƒå¯¹è±¡åè®®æä¾›äº†å¾ˆå¤šå¸¸è§„ Raku ä»£ç æ•…æ„é™åˆ¶äº†çš„èƒ½åŠ›, ä¾‹å¦‚è°ƒç”¨ç±»ä¸­ä¸ä¿¡ä»»ä½ çš„ç§æœ‰æ–¹æ³•, çª¥æ¢ç§æœ‰å±æ€§, å’Œå…¶å®ƒé€šå¸¸ä¸èƒ½å®Œæˆçš„ä¸œè¥¿ã€‚</p>
<p>å¸¸è§„çš„ Raku ä»£ç æœ‰å¾ˆå¤šå°±åœ°çš„å®‰å…¨æ£€æµ‹; å…ƒæ¨¡å‹ä¸­ä¸æ˜¯è¿™æ ·ï¼Œå®ƒé è¿‘åº•å±‚çš„è™šæ‹Ÿæœº, è¿åå’Œè™šæ‹Ÿæœºçš„çº¦å®šå¯ä»¥å¯¼è‡´æ‰€æœ‰å¥‡æ€ªçš„è¡Œä¸º, è€Œåœ¨æ­£å¸¸ä»£ç ä¸­, æ˜¾è€Œæ˜“è§çš„ä¼šæ˜¯ bugsã€‚</p>
<p>æ‰€ä»¥, åœ¨å†™å…ƒç±»å‹çš„æ—¶å€™è¦æ ¼å¤–å°å¿ƒå’Œæ€è€ƒã€‚</p>
<h2 id="èƒ½åŠ›ä¾¿åˆ©å’Œé™·é˜±">èƒ½åŠ›ã€ä¾¿åˆ©å’Œé™·é˜±</h2>
<p>å…ƒå¯¹è±¡åè®®è¢«è®¾è®¡çš„å¼ºå¤§åˆ°å®ç° Raku çš„å¯¹è±¡ç³»ç»Ÿã€‚è¿™ç§èƒ½åŠ›é—´æˆ–èŠ±è´¹äº†ä¾¿åˆ©çš„ä»£ä»·ã€‚</p>
<p>ä¾‹å¦‚, å½“ä½ å†™äº† <code>my $x = 42</code> å¹¶åœ¨ <code>$x</code>ä¸Šè°ƒç”¨æ–¹æ³•æ—¶, å¤§éƒ¨åˆ†æ–¹æ³•ä¼šåœ¨æ•´æ•° 42 ä¸Šèµ·ä½œç”¨, è€Œä¸æ˜¯åœ¨å­˜å‚¨ 42 çš„æ ‡é‡å®¹å™¨ä¸Šã€‚è¿™æ˜¯ Rakuä¸­è®¾ç«‹çš„ä¸€å—ä¾¿åˆ©ã€‚å…ƒå¯¹è±¡åè®®ä¸­çš„å¤§éƒ¨åˆ†ä¸èƒ½æä¾›è‡ªåŠ¨å¿½ç•¥æ ‡é‡å®¹å™¨çš„ä¾¿åˆ©æ€§, å› ä¸ºå®ƒä»¬ä¹Ÿç”¨äºå®ç°é‚£äº›æ ‡é‡å®¹å™¨ã€‚ æ‰€ä»¥, å¦‚æœä½ å†™äº† <code>my $t = MyType; ... $t.^compose</code>, é‚£ä¹ˆä½ æ­£ç»„åˆé‚£ä¸ª <code>$</code> å˜é‡è¡¨æ˜çš„æ ‡é‡, è€Œä¸æ˜¯ <code>MyType</code>ã€‚</p>
<p>ç»“æœå°±æ˜¯ä½ éœ€è¦å¾ˆè¯¦å°½çš„ç†è§£ Raku çš„åº•å±‚ä»¥é¿å…é™·é˜±, å½“ä½¿ç”¨ MOP æ—¶, å¹¶ä¸”ä¸èƒ½æœŸæœ›å¾—åˆ°å’Œæ™®é€š Raku ä»£ç æä¾›çš„ &ldquo;do what I mean&rdquo; çš„ä¾¿åˆ©ã€‚</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/meta-object" term="meta-object" label="meta object" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä¸­çš„å•è¡Œç¨‹åº]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-08-25-one-liners-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-08-25-one-liners-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>One Liners in Raku</blockquote><h1 id="raku-å•è¡Œç¨‹åºhttpsgithubcomdnmfarrellraku-one-liners"><a href="https://github.com/dnmfarrell/Raku-One-Liners">Raku å•è¡Œç¨‹åº</a></h1>
<p>è¿™æœ¬ä¹¦åœ¨è¿›è¡Œä¹‹ä¸­ã€‚æˆ‘å¸Œæœ›ä½ èƒ½è§‰å¾—å®ƒæœ‰è¶£ï¼Œç”šè‡³å¯èƒ½æœ‰ç”¨ï¼å¦‚æœä½ æƒ³è´¡çŒ®åé¦ˆçš„è¯ï¼Œé‚£ä¹ˆå¾ˆæ¬¢è¿æé—®é¢˜è¿˜æœ‰æ–°çš„æˆ–æœ‰æå‡çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚</p>
<h2 id="ä½œè€…">ä½œè€…</h2>
<p>æˆ´ç»´æ³•ç‘å°” <a href="PerlTricks.com">PerlTricks.com</a></p>
<h2 id="ç‰ˆæœ¬">ç‰ˆæœ¬</h2>
<p>ç‰ˆæœ¬ 0.01</p>
<h2 id="è®¸å¯">è®¸å¯</h2>
<p>FreeBSD</p>
<h2 id="è´¡çŒ®è€…">è´¡çŒ®è€…</h2>
<ul>
<li>Alexander Moquin</li>
<li>Bruce Gray</li>
<li>Carl MÃ¤sak</li>
<li>David H. Adler</li>
<li>FROGGS</li>
<li>Helmut Wollmersdorfer</li>
<li>japhb</li>
<li>Larry Wall</li>
<li>Matt Oates</li>
<li>Moritz Lenz</li>
<li>Mouq</li>
<li>Salve J Nilsen</li>
<li>Sam S</li>
<li>Skids</li>
<li>timotimo</li>
</ul>
<h2 id="è‡´è°¢">è‡´è°¢</h2>
<p>å¯å‘äº Peteris Krumins çš„ Perl 5 example <a href="http://www.catonmat.net/download/perl1line.txt">æ–‡ä»¶</a>ã€‚ä»–é€å­—é€å¥åœ°å†™äº†ä¸€æœ¬å…³äº Perl 5 å•è¡Œ çš„<a href="http://www.nostarch.com/perloneliners">ä¹¦</a>ã€‚</p>
<p><a href="http://webchat.freenode.net/?channels=raku&amp;nick=">irc</a>ä¸Šæœ‰å¾ˆå¥½åœ° folksã€‚</p>
<h2 id="å†…å®¹">å†…å®¹</h2>
<ol>
<li>ä»‹ç»</li>
<li>æ•™ç¨‹</li>
<li>æ–‡ä»¶é—´è·</li>
<li>è¡Œå·</li>
<li>è®¡ç®—</li>
<li>åˆ›å»ºå­—ç¬¦ä¸²å’Œåˆ›å»ºæ•°ç»„</li>
<li>æ–‡æœ¬è½¬æ¢å’Œæ›¿æ¢</li>
<li>æ–‡æœ¬åˆ†æ</li>
<li>é€‰æ‹©æ€§çš„è¡Œæ‰“å°</li>
<li>ä½¿ç”¨ç®¡é“è½¬æ¢æ•°æ®(è¿›è¡Œä¸­)</li>
<li>WWW(è¿›è¡Œä¸­)</li>
<li>è½¬æ¢åˆ° Windows</li>
</ol>
<h3 id="ä»‹ç»">ä»‹ç»</h3>
<p>æŠŠ Perl å’Œå…¶å®ƒè¯­è¨€åŒºåˆ«å¼€çš„ä¸€ä»¶äº‹æƒ…æ˜¯åœ¨å•è¡Œä»£ç ä¸­å†™å°ç¨‹åºçš„èƒ½åŠ›ï¼Œå³äººä»¬æ‰€ç†ŸçŸ¥çš„&quot;å•è¡Œ&quot;ã€‚åœ¨ç»ˆç«¯é‡Œç›´æ¥é”®å…¥ä¸€ä¸ªç¨‹åºæ¯”å†™ä¸€ä¸ªåºŸå¼ƒçš„è„šæœ¬å¾€å¾€æ›´å¿«ã€‚å¹¶ä¸”å•è¡Œç¨‹åºä¹Ÿå¾ˆå¼ºå¤§ï¼›å®ƒä»¬æ˜¯ç¾½ç¿¼ä¸°æ»¡çš„ç¨‹åºï¼Œèƒ½å¤ŸåŠ è½½å¤–éƒ¨åº“ï¼Œä½†æ˜¯ä¹Ÿèƒ½é›†æˆåˆ°ç»ˆç«¯ä¸­ã€‚ä½ å¯ä»¥åœ¨å•è¡Œç¨‹åºä¸­è¾“å…¥æˆ–è¾“å‡ºæ•°æ®ã€‚</p>
<p>åƒ Perl 5 ä¸€æ ·ï¼Œ Rakuæ”¯æŒå•è¡Œç¨‹åºã€‚è¿˜æœ‰å°±åƒ Raku åˆ°å¤„æ¸…ç†ç€ Perl 5 çš„æ¯’ç˜¤ä¸€æ ·ï¼ŒRaku çš„å•è¡Œè¯­æ³•ä¹Ÿæ›´å¥½äº†ã€‚å®ƒæ‹¥æœ‰æ›´å°‘çš„ç‰¹æ®Šå˜é‡å’Œé€‰é¡¹å› æ­¤æ›´å®¹æ˜“è®°å¿†ã€‚è¿™æœ¬ä¹¦æä¾›äº†å¾ˆå¤šæœ‰ç”¨çš„ Raku å•è¡Œä¾‹å­ï¼Œä»æ‰¾å‡ºæ–‡ä»¶ä¸­å¾—é‡å¤è¡Œåˆ°è¿è¡Œä¸€ä¸ª web æœåŠ¡å™¨ï¼Œå®ƒå‡ ä¹èƒ½åšæ‰€æœ‰äº‹æƒ…ã€‚å°½ç®¡ Raku æ‹¥æœ‰æ›´å°‘çš„ç‰¹æ®Šå˜é‡ï¼Œä½†æ˜¯ç”±äºå®ƒé«˜çº§çš„é¢å‘å¯¹è±¡çš„è¯­æ³•ï¼ŒRaku ä¸­çš„å¤§éƒ¨åˆ†å•è¡Œç¨‹åºæ¯”ç­‰ä»·çš„ Perl 5 å•è¡Œç¨‹åºæ›´çŸ­ã€‚</p>
<p>è¿™æœ¬ä¹¦å¯ä»¥ä»¥å¤šç§æ–¹å¼é˜…è¯»ã€‚å¦‚æœä½ æ˜¯å•è¡Œç¨‹åºçš„æ–°æ‰‹ï¼Œä»æ•™ç¨‹å¼€å§‹ã€‚å®ƒå¸¦é¢†ä½ æŒæ¡å•è¡Œç¨‹åºçš„æ ¸å¿ƒæ¦‚å¿µï¼›ä¸è¦æ‹…å¿ƒï¼Œä¸€æ—¦ä½ ç†è§£äº†å®ƒä¼šå¾ˆå®¹æ˜“ã€‚å¦‚æœä½ ç²¾é€š Perlï¼ŒBashï¼Œæˆ– Sed/Awkï¼Œä½ å¯ä»¥ç«‹é©¬å¼€å§‹å·¥ä½œã€‚éšæ„è·³è¿‡å’Œæµè§ˆä½ æ‰€æ„Ÿå…´è¶£çš„ä¸œè¥¿ã€‚å¦‚æœæœ‰äº›ä»£ç ä½ ä¸ç†è§£ï¼Œé‚£ä¹ˆåœ¨ç»ˆç«¯ä¸­è¯•è¯•ï¼è¿™ä¸ªä»“åº“ä¸­åŒ…å«çš„æ— å¤„ä¸åœ¨çš„æ–‡ä»¶æ˜¯ example.txtï¼Œå®ƒä¼šåœ¨å¾ˆå¤šå•è¡Œç¨‹åºä¸­ç”¨åˆ°ã€‚</p>
<p>ä½¿ç”¨å•è¡Œç¼–ç¨‹ä»…ä»…æ˜¯ Raku æ“…é•¿çš„ä¸€ä¸ªèŒƒä¾‹ã€‚è¿™æ ·çš„ä»£ç å°è€Œç¾ï¼Œä½†æ˜¯åŒæ—¶ä½ æ­£å­¦ä¹ çš„æ˜¯ä¸€ç§ç”Ÿäº§åŠ›æŠ€èƒ½ï¼Œè®°ä½ä½ æ­£åœ¨å­¦çš„æ˜¯ä¸€ç§æ–°çš„ç¼–ç¨‹è¯­è¨€ã€‚æ£€æŸ¥ <a href="raku.org">raku.org</a> ç½‘ç«™è·å–å®˜æ–¹æ–‡æ¡£ã€‚</p>
<h3 id="æ•™ç¨‹">æ•™ç¨‹</h3>
<p>è¦å¼€å§‹å•è¡Œç¨‹åºï¼Œæ‰€æœ‰ä½ è¦æŒæ¡çš„æ˜¯ <strong>-e</strong> é€‰é¡¹ã€‚è¿™å‘Šè¯‰ Perl æŠŠå®ƒåé¢æ‰€è·Ÿçš„ä¸œè¥¿ä½œä¸ºä¸€ä¸ªç¨‹åºå»æ‰§è¡Œã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">raku</span> <span class="o">-</span><span class="no">e</span> <span class="p">&#39;</span><span class="s1">say &#34;Hello, World!&#34;</span><span class="p">&#39;</span>
</code></pre></div><p>æˆ‘ä»¬æ¥ä¸€æ­¥æ­¥å‰–æè¿™æ®µä»£ç ã€‚ <code>raku</code> å¼•ç”¨äº† Raku ç¨‹åºï¼Œ <code>-e</code> å‘Šè¯‰ Raku å»æ‰§è¡Œï¼Œè€Œ <code>'say &quot;Hello, World!&quot;'</code>æ˜¯è¦æ‰§è¡Œçš„ç¨‹åºã€‚æ¯ä¸ªç¨‹åºéƒ½å¿…é¡»è¢«åŒ…å›´åœ¨å•å¼•å·ä¸­ï¼ˆé™¤äº†åœ¨ Windows ä¸Šï¼ŒæŸ¥çœ‹ <a href="https://github.com/dnmfarrell/Raku-One-Liners#converting-for-windows">è½¬æ¢åˆ° Windows</a>ï¼‰ã€‚è¦è¿è¡Œå•è¡Œç¨‹åºï¼Œå°±æŠŠå®ƒé”®å…¥åˆ°ç»ˆç«¯ä¸­å¥½äº†ï¼š</p>
<pre><code class="language-ba" data-lang="ba">&gt; raku -e 'say &quot;Hello, World!&quot;'
Hello, World!
</code></pre><p>å¦‚æœä½ æƒ³åŠ è½½ä¸€ä¸ªæ–‡ä»¶ï¼Œå°±æŠŠæ–‡ä»¶è·¯å¾„æ·»åŠ åˆ°ç¨‹åºä»£ç çš„åé¢ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;for (lines) {say $_}&#39;</span> /path/to/file.txt
</code></pre></div><p>è¿™ä¸ªç¨‹åºæ‰“å°å‡ºäº† <code>path/to/file.txt</code> çš„æ¯ä¸€è¡Œã€‚ä½ å¯èƒ½çŸ¥é“ <code>$_</code> æ˜¯é»˜è®¤å˜é‡ï¼Œå®ƒåœ¨è¿™å„¿æ˜¯æŒ‡æ­£è¢«å¾ªç¯çš„å½“å‰è¡Œã€‚<code>lines</code> æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå½“ä½ ä¼ é€’ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ç»™å•è¡Œç¨‹åºçš„æ—¶å€™ä¼šè‡ªåŠ¨ä¸ºä½ åˆ›å»ºè¿™ä¸ªåˆ—è¡¨ã€‚ç°åœ¨æˆ‘ä»¬æ¥é‡å†™é‚£ä¸ªå•è¡Œç¨‹åºï¼Œä¸€æ­¥ä¸€æ­¥ã€‚å®ƒä»¬éƒ½æ˜¯ç­‰ä»·çš„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;for (lines) { say $_ }&#39;</span> /path/to/file.txt
raku -e <span class="s1">&#39;for (lines) { $_.say }&#39;</span> /path/to/file.txt
raku -e <span class="s1">&#39;for (lines) { .say }&#39;</span> /path/to/file.txt
raku -e <span class="s1">&#39;.say for (lines)&#39;</span> /path/to/file.txt
raku -e <span class="s1">&#39;.say for lines&#39;</span> /path/to/file.txt
</code></pre></div><p>å°±åƒ <code>$_</code> æ˜¯é»˜è®¤å˜é‡ä¸€æ ·ï¼Œåœ¨é»˜è®¤å˜é‡èº«ä¸Šè°ƒç”¨çš„æ–¹æ³•å¯ä»¥çœç•¥æ‰å˜é‡å¼•ç”¨ã€‚å®ƒä»¬å˜æˆäº†é»˜è®¤æ–¹æ³•ã€‚æ‰€ä»¥ <code>$_.say</code> å˜æˆ <code>.say</code>ã€‚å›æŠ¥ç»™å†™å•è¡Œç¨‹åºçš„äººçš„ä¸œè¥¿æ˜¯ - æ›´å°‘çš„é”®å…¥ï¼</p>
<p><code>-n</code> é€‰é¡¹æ”¹å˜äº†ç¨‹åºçš„è¡Œä¸ºï¼šå®ƒä¸ºæ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œæ‰§è¡Œä¸€æ¬¡ä»£ç ã€‚æ‰€ä»¥ï¼Œå¤§å†™å¹¶æ‰“å° <code>path/to/file.txt</code> çš„æ¯ä¸€è¡Œä½ ä¼šé”®å…¥ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;.uc.say&#39;</span> /path/to/file.txt
</code></pre></div><p><code>-p</code> é€‰é¡¹å°±åƒ <code>-n</code>, é™¤äº†å®ƒä¼šè‡ªåŠ¨æ‰“å° <code>$_</code> ä¹‹å¤–ã€‚æ‰€ä»¥å¤§å†™æ–‡ä»¶ä¸­çš„æ‰€æœ‰è¡Œçš„å¦å¤–ä¸€ç§æ–¹æ³•æ˜¯ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -pe <span class="s1">&#39;$_ = .uc&#39;</span> /path/to/file.txt
</code></pre></div><p>æˆ–è€…ä¸¤ä¸ªåšåŒæ ·äº‹æƒ…çš„æ›´çŸ­çš„ç‰ˆæœ¬ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -pe <span class="s1">&#39;.=uc&#39;</span> /path/to/file.txt
raku -pe .<span class="o">=</span>uc   /path/to/file.txt
</code></pre></div><p>åœ¨ç¬¬äºŒä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å®Œå…¨ç§»é™¤å‘¨å›´çš„å•å¼•å·ã€‚è¿™ç§åœºæ™¯å¾ˆå°‘é‡åˆ°ï¼Œä½†æ˜¯å¦‚æœä½ çš„å•è¡Œç¨‹åºä¸­æ²¡æœ‰ç©ºæ ¼å¹¶ä¸”æ²¡æœ‰ç¬¦å·æˆ–å¼•å·ï¼Œé‚£ä¹ˆä½ é€šå¸¸å¯ä»¥ç§»é™¤å¤–éƒ¨çš„å¼•å·ã€‚</p>
<p><code>-n</code> å’Œ <code>-p</code> é€‰é¡¹çœŸçš„å¾ˆæœ‰ç”¨ã€‚æœ¬ä¹¦ä¸­ä¹Ÿæœ‰å¾ˆå¤šä½¿ç”¨å®ƒä»¬çš„å•è¡Œä¾‹å­ã€‚</p>
<p>æœ€åä¸€ä»¶ä½ è¦çŸ¥é“çš„äº‹æƒ…æ˜¯æ€ä¹ˆåŠ è½½æ¨¡å—ã€‚ <code>-M</code> å¼€å…³ä»£è¡¨ç€åŠ è½½æ¨¡å—ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -M URI::Encode -e <span class="s1">&#39;say encode_uri(&#34;example.com/10 ways to crush it with Raku&#34;)&#39;</span>
</code></pre></div><p><code>-M URI::Encode</code> åŠ è½½äº† <code>URI::Encode</code> æ¨¡å—ï¼Œå®ƒå¯¼å…¥äº† <em>encode_uri</em> å­ä¾‹ç¨‹ã€‚ ä½ å¯ä»¥å¤šæ¬¡ä½¿ç”¨ <code>-M</code> æ¥åŠ è½½å¤šä¸ªæ¨¡å—ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -M URI::Encode -M URI -e <span class="s1">&#39;&lt;your code here&gt;&#39;</span>
</code></pre></div><p>å¦‚æœä½ æœ‰ä¸€ä¸ªè¿˜æ²¡æœ‰å®‰è£…çš„æœ¬åœ°æ¨¡å—å‘¢ï¼Ÿ ç®€å•ï¼Œ ä»…ä»…ä¼ é€’ä¸€ä¸ª <code>-I</code> å¼€å…³æ¥åŒ…å«é‚£ä¸ªç›®å½•å¥½äº†ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -I lib -M URI::Encode -e <span class="s1">&#39;&lt;your code here&gt;&#39;</span>
</code></pre></div><p>ç°åœ¨ Raku ä¼šåœ¨ <code>lib</code> ç›®å½•ä¸­æœç´¢ <code>URI::Encode</code> æ¨¡å—ï¼Œå’Œæ ‡å‡†çš„å®‰è£…ä½ç½®ä¸€æ ·ã€‚</p>
<p>è¦æŸ¥çœ‹ Raku å‘½ä»¤è¡Œå¼€å…³æœ‰å“ªäº›ï¼Œ ä½¿ç”¨ <code>-h</code> é€‰é¡¹æŸ¥çœ‹å¸®åŠ©ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -h
</code></pre></div><p>è¿™æ‰“å°å¯è·å¾—çš„ä¸é”™çš„ç»Ÿè®¡ã€‚</p>
<h3 id="æ–‡ä»¶é—´è·">æ–‡ä»¶é—´è·</h3>
<p>Double space a file</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -pe <span class="s1">&#39;$_ ~= &#34;\n&#34;&#39;</span> example.txt
</code></pre></div><p>N-space a file (ä¾‹å¦‚. 4å€ç©ºç™½)</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -pe <span class="s1">&#39;$_ ~= &#34;\n&#34; x 4&#39;</span> example.txt
</code></pre></div><p>åœ¨æ¯ä¸€è¡Œå‰é¢æ·»åŠ ä¸€ä¸ªç©ºè¡Œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -pe <span class="s1">&#39;say &#34;&#34;&#39;</span> example.txt
</code></pre></div><p>ç§»é™¤æ‰€æœ‰ç©ºè¡Œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">raku</span> <span class="o">-</span><span class="ow">ne</span> <span class="p">&#39;</span><span class="s1">.say if /\S/</span><span class="p">&#39;</span>   <span class="n">example</span><span class="o">.</span><span class="nf">txt</span>
<span class="nb">raku</span> <span class="o">-</span><span class="ow">ne</span> <span class="p">&#39;</span><span class="s1">.say if .chars</span><span class="p">&#39;</span> <span class="n">example</span><span class="o">.</span><span class="nf">txt</span>
</code></pre></div><p>ç§»é™¤æ‰€æœ‰çš„è¿ç»­ç©ºç™½è¡Œï¼Œåªä¿ç•™ä¸€è¡Œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;$*ARGFILES.slurp.subst(/\n+/, &#34;\n\n&#34;, :g).say&#39;</span> example.txt
</code></pre></div><h3 id="è¡Œå·">è¡Œå·</h3>
<p>ç»™æ–‡ä»¶ä¸­çš„æ‰€æœ‰è¡Œç¼–å·ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;say &#34;{++$} $_&#34;&#39;</span> example.txt
raku -ne <span class="s1">&#39;say $*ARGFILES.ins ~ &#34; $_ &#34;&#39;</span> example.txt
</code></pre></div><p>åªç»™æ–‡ä»¶ä¸­å¾—éç©ºè¡Œç¼–å·ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -pe <span class="s1">&#39;$_ = &#34;{++$} $_&#34; if /\S/&#39;</span> example.txt
</code></pre></div><p>ç»™æ‰€æœ‰è¡Œç¼–å·ä½†æ˜¯åªæ‰“å°éç©ºè¡Œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -pe <span class="s1">&#39;$_ = $*ARGFILES.ins ~ &#34; $_ &#34; if /\S/&#39;</span> example.txt
</code></pre></div><p>æ‰“å°æ–‡ä»¶ä¸­è¡Œæ•°çš„æ€»æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say lines.elems&#39;</span> example.txt
raku -e <span class="s1">&#39;say lines.Int&#39;</span>   example.txt
raku -e <span class="s1">&#39;lines.Int.say&#39;</span>   example.txt
</code></pre></div><p>æ‰“å°å‡ºæ–‡ä»¶ä¸­éç©ºè¡Œçš„æ€»æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;lines.grep(/\S/.elems.say)&#39;</span> example.txt
</code></pre></div><p>æ‰“å°æ–‡ä»¶ä¸­ç©ºè¡Œçš„æ•°é‡ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;lines.grep(/^\s*$/).elems.say&#39;</span> example.txt
</code></pre></div><h3 id="è®¡ç®—">è®¡ç®—</h3>
<p>æ£€æŸ¥ä¸€ä¸ªæ•°æ˜¯å¦æ˜¯è´¨æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say &#34;7 is prime&#34; if 7.is-prime&#39;</span>
</code></pre></div><p>æ‰“å°ä¸€è¡Œä¸­æ‰€æœ‰å­—æ®µçš„å’Œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;say [+] .split(&#34;\t&#34;)&#39;</span>
</code></pre></div><p>æ‰“å°æ‰€æœ‰è¡Œçš„æ‰€æœ‰å­—æ®µçš„å’Œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say [+] lines.split(&#34;\t&#34;)&#39;</span>
</code></pre></div><p>æ‰“ä¹±è¡Œä¸­çš„æ‰€æœ‰å­—æ®µï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;.split(&#34;\t&#34;).pick(*).join(&#34;\t&#34;).say&#39;</span>
</code></pre></div><p>æ‰¾å‡ºä¸€è¡Œä¸­æœ€å°çš„å…ƒç´ ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;.split(&#34;\t&#34;).min.say&#39;</span>
</code></pre></div><p>æ‰¾å‡ºæ‰€æœ‰è¡Œçš„æœ€å°çš„å…ƒç´ ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;lines.split(&#34;\t&#34;).min.say&#39;</span>
</code></pre></div><p>æ‰¾å‡ºä¸€è¡Œä¸­æœ€å¤§çš„å…ƒç´ ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;.split(&#34;\t&#34;).max.say&#39;</span>
</code></pre></div><p>æ‰¾å‡ºæ‰€æœ‰è¡Œçš„æœ€å¤§çš„å…ƒç´ ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;lines.split(&#34;\t&#34;).max.say&#39;</span>
</code></pre></div><p>æ‰¾å‡ºä¸€è¡Œä¸­å¾—æ•°å€¼åŒ–æœ€å°å…ƒç´ ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;.split(&#34;\t&#34;)Â».Numeric.min.say&#39;</span>
</code></pre></div><p>æ‰¾å‡ºä¸€è¡Œä¸­å¾—æ•°å€¼åŒ–æœ€å¤§å…ƒç´ ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;.split(&#34;\t&#34;)Â».Numeric.max.say&#39;</span>
</code></pre></div><p>ä½¿ç”¨å­—æ®µçš„ç»å¯¹å€¼æ›¿æ¢æ¯ä¸ªå­—æ®µï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;.split(&#34;\t&#34;).map(*.abs).join(&#34;\t&#34;)&#39;</span>
</code></pre></div><p>æ‰¾å‡ºæ¯è¡Œä¸­å­—ç¬¦çš„æ€»æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;.chars.say&#39;</span> example.txt
</code></pre></div><p>æ‰¾å‡ºæ¯è¡Œä¸­å•è¯çš„æ€»æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;.words.elems.say&#39;</span> example.txt
</code></pre></div><p>æ‰¾å‡ºæ¯è¡Œä¸­ç”±é€—å·åˆ†éš”çš„å…ƒç´ çš„æ€»æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;.split(&#34;,&#34;).elems.say&#39;</span> example.txt
</code></pre></div><p>æ‰¾å‡ºæ‰€æœ‰è¡Œçš„å­—æ®µï¼ˆå•è¯ï¼‰çš„æ€»æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say lines.split(&#34;\t&#34;).elems&#39;</span> example.txt  <span class="c1"># fields</span>
raku -e <span class="s1">&#39;say lines.words.elems&#39;</span> example.txt        <span class="c1"># words</span>
</code></pre></div><p>æ‰“å°åŒ¹é…æŸä¸ªæ¨¡å¼çš„å­—æ®µçš„æ€»æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say lines.split(&#34;\t&#34;).comb(/pattern/).elems&#39;</span> example.txt <span class="c1"># fields</span>
raku -e <span class="s1">&#39;say lines.words.comb(/pattern/).elems&#39;</span> example.txt       <span class="c1"># words</span>
</code></pre></div><p>æ‰“å°åŒ¹é…æŸä¸ªæ¨¡å¼çš„è¡Œçš„æ€»æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say lines.grep(/in/.elems)&#39;</span> example.txt
</code></pre></div><p>æ‰“å°æ•°å­— PI åˆ° n ä½å°æ•°ç‚¹(ä¾‹å¦‚. 10ä½)ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say pi.fmt(&#34;%.10f&#34;);&#39;</span>
</code></pre></div><p>æ‰“å°æ•°å­— PI åˆ° 15 ä½å°æ•°ç‚¹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say Ï€&#39;</span>
</code></pre></div><p>æ‰“å°æ•°å­— E åˆ° n ä½å°æ•°ç‚¹(ä¾‹å¦‚. 10ä½)ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say e.fmt(&#34;%.10f&#34;);&#39;</span>
</code></pre></div><p>æ‰“å°æ•°å­— E åˆ° 15 ä½å°æ•°ç‚¹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say e&#39;</span>
</code></pre></div><p>æ‰“å° UNIX æ—¶é—´ (seconds since Jan 1, 1970, 00:00:00 UTC)</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say time&#39;</span>
</code></pre></div><p>æ‰“å° GMT (æ ¼æ—å¨æ²»æ ‡å‡†æ—¶é—´)å’Œåœ°æ–¹è®¡ç®—æœºæ—¶é—´ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -MDateTime::TimeZone -e <span class="s1">&#39;say to-timezone(&#34;GMT&#34;,DateTime.now)&#39;</span>
raku -e <span class="s1">&#39;say DateTime.now&#39;</span>
</code></pre></div><p>ä»¥ H:M:S æ ¼å¼æ‰“å°å½“åœ°è®¡ç®—æœºæ—¶é—´ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say DateTime.now.map({$_.hour, $_.minute, $_.second.round}).join(&#34;:&#34;)&#39;</span>
</code></pre></div><p>æ‰“å°æ˜¨å¤©çš„æ—¥æœŸï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say DateTime.now.earlier(:1day)&#39;</span>
</code></pre></div><p>æ‰“å°æ—¥æœŸï¼š 14 ä¸ªæœˆ, 9 å¤©ï¼Œå’Œ 7 ç§’ä¹‹å‰</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say DateTime.now.earlier(:14months).earlier(:9days).earlier(:7seconds)&#39;</span>
</code></pre></div><p>åœ¨æ ‡å‡†è¾“å‡ºå‰åŠ ä¸Šæ—¶é—´æˆ³ï¼ˆGMTï¼Œåœ°æ–¹æ—¶é—´ï¼‰ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">tail -f logfile <span class="p">|</span> raku -MDateTime::TimeZone -ne <span class="s1">&#39;say to-timezone(&#34;GMT&#34;,DateTime.now) ~ &#34;\t$_&#34;&#39;</span>
tail -f logfile <span class="p">|</span> raku -ne <span class="s1">&#39;say DateTime.now ~ &#34;\t$_&#34;&#39;</span>
</code></pre></div><p>è®¡ç®— 5 çš„é˜¶ä¹˜ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say [*] 1..5&#39;</span>
</code></pre></div><p>è®¡ç®—æœ€å¤§å…¬çº¦æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say [gcd] @list_of_numbers&#39;</span>
</code></pre></div><p>ä½¿ç”¨æ¬§å‡ é‡Œå¾—ç®—æ³•è®¡ç®—æ•°å­— 20 å’Œ 35 çš„æœ€å¤§å…¬çº¦æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say (20, 35, *%* ... 0)[*-2]&#39;</span>
</code></pre></div><p>è®¡ç®— 20 å’Œ 35 çš„æœ€å°å…¬å€æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say 20 lcm 35&#39;</span>
</code></pre></div><p>ä½¿ç”¨æ¬§å‡ é‡Œå¾—ç®—æ³•: n*m/gcd(n,m) è®¡ç®—æ•°å­— 20 å’Œ 35 çš„æœ€å°å…¬å€æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say 20 * 35 / (20 gcd 35)&#39;</span>
</code></pre></div><p>ç”Ÿæˆ 10 ä¸ª 5 åˆ° 15ï¼ˆä¸åŒ…æ‹¬ 15ï¼‰ä¹‹é—´çš„éšæœºæ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;.say for (5..^15).roll(10)&#39;</span>
</code></pre></div><p>æ‰¾å‡ºå¹¶æ‰“å°åˆ—è¡¨çš„å…¨æ’åˆ—ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say .join for [1..5].permutations&#39;</span>
</code></pre></div><p>ç”Ÿæˆå¹‚é›†</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;.say for &lt;1 2 3&gt;.combinations&#39;</span>
</code></pre></div><p>æŠŠ IP åœ°å€è½¬æ¢ä¸ºæ— ç¬¦å·æ•´æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say :256[&#34;127.0.0.1&#34;.comb(/\d+/)]&#39;</span>
raku -e <span class="s1">&#39;say +&#34;:256[{q/127.0.0.1/.subst(:g,/\./,q/,/)}]&#34;&#39;</span>
raku -e <span class="s1">&#39;say Buf.new(+Â«&#34;127.0.0.1&#34;.split(&#34;.&#34;)).unpack(&#34;N&#34;)&#39;</span>
</code></pre></div><p>æŠŠæ— ç¬¦å·æ•´æ•°è½¬æ¢ä¸º IP åœ°å€ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say join &#34;.&#34;, @(pack &#34;N&#34;, 2130706433)&#39;</span>
raku -e <span class="s1">&#39;say join &#34;.&#34;, map { ((2130706433+&gt;(8*$_))+&amp;0xFF) }, (3...0)&#39;</span>
</code></pre></div><h3 id="åˆ›å»ºå­—ç¬¦ä¸²å’Œåˆ›å»ºæ•°ç»„">åˆ›å»ºå­—ç¬¦ä¸²å’Œåˆ›å»ºæ•°ç»„</h3>
<p>ç”Ÿæˆå¹¶æ‰“å°å­—æ¯è¡¨ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;.say for &#34;a&#34;..&#34;z&#34;&#39;</span>
</code></pre></div><p>ç”Ÿæˆå¹¶æ‰“å°æ‰€æœ‰ä» &ldquo;a&rdquo; åˆ° &ldquo;zz&rdquo; çš„å­—ç¬¦ä¸²ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;.say for &#34;a&#34;..&#34;zz&#34;&#39;</span>
</code></pre></div><p>æŠŠæ•´æ•°è½¬æ¢ä¸ºåå…­è¿›åˆ¶ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say 255.base(16)&#39;</span>
raku -e <span class="s1">&#39;say sprintf(&#34;%x&#34;, 255)&#39;</span>
</code></pre></div><p>æŠŠæ•´æ•°æ‰“å°ä¸ºåå…­è¿›åˆ¶è½¬æ¢è¡¨ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say sprintf(&#34;%3i =&gt; %2x&#34;, $_, $_) for 0..255&#39;</span>
</code></pre></div><p>æŠŠæ•´æ•°ç¼–ç ä¸ºç™¾åˆ†æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say sprintf(&#34;%%%x&#34;, 255)&#39;</span>
</code></pre></div><p>ç”Ÿæˆä¸€ä¸ªéšæœºçš„ 10 ä¸ª a-z å­—ç¬¦é•¿åº¦çš„å­—ç¬¦ä¸²ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;print roll 10, &#34;a&#34;..&#34;z&#34;&#39;</span>
raku -e <span class="s1">&#39;print roll &#34;a&#34;..&#34;z&#34;: 10&#39;</span>
</code></pre></div><p>ç”Ÿæˆä¸€ä¸ªéšæœºçš„ 15 ä¸ª ASCII å­—ç¬¦é•¿åº¦çš„å¯†ç ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;print roll 15, &#34;0&#34;..&#34;z&#34;&#39;</span>
raku -e <span class="s1">&#39;print roll &#34;0&#34;..&#34;z&#34;: 15&#39;</span>
</code></pre></div><p>åˆ›å»ºä¸€ä¸ªæŒ‡å®šé•¿åº¦çš„å­—ç¬¦ä¸²ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;print &#34;a&#34; x 50&#39;</span>
</code></pre></div><p>ç”Ÿæˆå¹¶æ‰“å°ä» 1 åˆ° 100 æ•°å­—ä¸ºå¶æ•°çš„æ•°ç»„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;(1..100).grep(* %% 2).say&#39;</span>
</code></pre></div><p>æ‰¾å‡ºå­—ç¬¦ä¸²çš„é•¿åº¦ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;&#34;storm in a teacup&#34;.chars.say&#39;</span>
</code></pre></div><p>æ‰¾å‡ºæ•°ç»„çš„å…ƒç´ ä¸ªæ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;my @letters = &#34;a&#34;..&#34;z&#34;; @letters.Int.say&#39;</span>
</code></pre></div><h3 id="æ–‡æœ¬è½¬æ¢å’Œæ›¿æ¢">æ–‡æœ¬è½¬æ¢å’Œæ›¿æ¢</h3>
<p>å¯¹æ–‡ä»¶è¿›è¡Œ ROT 13 åŠ å¯†ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -pe <span class="s1">&#39;tr/A..Za..z/N..ZA..Mn..za..m/&#39;</span> example.txt
</code></pre></div><p>å¯¹å­—ç¬¦ä¸²è¿›è¡Œ Base64 ç¼–ç ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -MMIME::Base64 -ne <span class="s1">&#39;print MIME::Base64.encode-str($_)&#39;</span> example.txt
</code></pre></div><p>å¯¹å­—ç¬¦ä¸²è¿›è¡Œ Base64 è§£ç ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -MMIME::Base64 -ne <span class="s1">&#39;print MIME::Base64.decode-str($_)&#39;</span> base64.txt
</code></pre></div><p>å¯¹å­—ç¬¦ä¸²è¿›è¡Œ URL è½¬ä¹‰ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -MURI::Encode -le <span class="s1">&#39;say uri_encode($string)&#39;</span>
</code></pre></div><p>URL-unescape a string</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -MURI::Encode -le <span class="s1">&#39;say uri_decode($string)&#39;</span>
</code></pre></div><p>HTML-encode a string</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -MHTML::Entity -e <span class="s1">&#39;print encode-entities($string)&#39;</span>
</code></pre></div><p>HTML-decode a string</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -MHTML::Entity -e <span class="s1">&#39;print decode-entities($string)&#39;</span>
</code></pre></div><p>æŠŠæ‰€æœ‰æ–‡æœ¬è½¬æ¢ä¸ºå¤§å†™ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -pe <span class="s1">&#39;.=uc&#39;</span>    example.txt
raku -ne <span class="s1">&#39;say .uc&#39;</span> example.txt
</code></pre></div><p>æŠŠæ‰€æœ‰æ–‡æœ¬è½¬æ¢ä¸ºå°å†™ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -pe <span class="s1">&#39;.=lc&#39;</span>    example.txt
raku -ne <span class="s1">&#39;say .lc&#39;</span> example.txt
</code></pre></div><p>åªæŠŠæ¯è¡Œçš„ç¬¬ä¸€ä¸ªå•è¯è½¬æ¢ä¸ºå¤§å†™ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;say s/(\w+){}/{$0.uc}/&#39;</span> example.txt
</code></pre></div><p>é¢ å€’å­—æ¯çš„å¤§å°å†™ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -pe <span class="s1">&#39;tr/a..zA..Z/A..Za..z/&#39;</span>           example.txt
raku -ne <span class="s1">&#39;say tr/a..zA..Z/A..Za..z/.after&#39;</span> example.txt
</code></pre></div><p>å¯¹æ¯è¡Œè¿›è¡Œé©¼å³°å¼å¤§å°å†™ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;say .wordcase&#39;</span> example.txt
</code></pre></div><p>åœ¨æ¯è¡Œçš„å¼€å¤´å»æ‰å‰ç½®ç©ºç™½ï¼ˆç©ºæ ¼ã€tabsï¼‰ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;say .trim-leading&#39;</span> example.txt
</code></pre></div><p>ä»æ¯è¡Œçš„æœ«å°¾å»æ‰ç»“å°¾çš„ç©ºç™½ï¼ˆç©ºæ ¼ã€tabsï¼‰ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;say .trim-trailing&#39;</span> example.txt
</code></pre></div><p>ä»æ¯è¡Œä¸­å»é™¤è¡Œé¦–å’Œè¡Œå°¾çš„ç©ºç™½ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;say .trim&#39;</span> example.txt
</code></pre></div><p>æŠŠ UNIX æ¢è¡Œç¬¦è½¬æ¢ä¸º DOS/Windows æ¢è¡Œç¬¦ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;print .subst(/\n/, &#34;\r\n&#34;)&#39;</span> example.txt
</code></pre></div><p>æŠŠ DOS/Windows  æ¢è¡Œç¬¦è½¬æ¢ä¸º UNIX æ¢è¡Œç¬¦ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;print .subst(/\r\n/, &#34;\n&#34;)&#39;</span> example.txt
</code></pre></div><p>æŠŠæ¯è¡Œä¸­æ‰€æœ‰çš„ &ldquo;ut&rdquo; å®ä½“ç”¨ &ldquo;foo&rdquo; æ›¿æ¢æ‰ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -pe <span class="s1">&#39;s:g/ut/foo/&#39;</span> example.txt
</code></pre></div><p>æŠŠåŒ…å« &ldquo;lorem&rdquo; çš„æ¯è¡Œä¸­æ‰€æœ‰çš„ &ldquo;ut&rdquo; å®ä½“ç”¨ &ldquo;foo&rdquo; æ›¿æ¢æ‰ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -pe <span class="s1">&#39;s:g/ut/foo/ if /Lorem/&#39;</span> example.txt
</code></pre></div><p>æŠŠæ–‡ä»¶è½¬æ¢ä¸º JSON æ ¼å¼ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -M JSON::Tiny -e <span class="s1">&#39;say to-json(lines)&#39;</span> example.txt
</code></pre></div><p>ä»æ–‡ä»¶çš„æ¯ä¸€è¡Œä¸­éšæœºæŒ‘é€‰ 5 ä¸ªå•è¯ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;say .words.pick(5)&#39;</span> example.txt
</code></pre></div><h3 id="æ–‡æœ¬åˆ†æ">æ–‡æœ¬åˆ†æ</h3>
<p>Print n-grams of a string</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;my $n=2; say &#34;banana&#34;.comb.rotor($n,$n-1).map({[~] @$_})&#39;</span>

æ‰“å°å”¯ä¸€çš„ n-grams

<span class="sb">```</span>bash
raku -e <span class="s1">&#39;my $n=2; say &#34;banana&#34;.comb.rotor($n,$n-1).map({[~] @$_}).Set.sort&#39;</span>
</code></pre></div><p>æ‰“å° n-grams çš„å‡ºç°æ¬¡æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;my $n=2; say &#34;banana&#34;.comb.rotor($n,$n-1).map({[~] @$_}).Bag.sort.join(&#34;\n&#34;)&#39;</span>
</code></pre></div><p>æ‰“å°å•è¯çš„å‡ºç°æ¬¡æ•°(1-grams)ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say lines[0].words.map({[~] @$_}).Bag.sort.join(&#34;\n&#34;)&#39;</span> example.txt
</code></pre></div><p>åŸºäºä¸€ç»„ 1-grams æ‰“å° Dice ç›¸ä¼¼ç³»æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;my $a=&#34;banana&#34;.comb;my $b=&#34;anna&#34;.comb;say ($a (&amp;) $b)/($a.Set + $b.Set)&#39;</span>
</code></pre></div><p>åŸºäº 1-grams æ‰“å°å¡å¾—æ°ç›¸ä¼¼ç³»æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;my $a=&#34;banana&#34;.comb;my $b=&#34;anna&#34;.comb;say ($a (&amp;) $b) / ($a (|) $b)&#39;</span>
</code></pre></div><p>åŸºäº 1-grams æ‰“å°é‡å ç³»æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;my $a=&#34;banana&#34;.comb;my $b=&#34;anna&#34;.comb;say ($a (&amp;) $b)/($a.Set.elems,$b.Set.elems).min&#39;</span>
</code></pre></div><p>åŸºäº 1-grams æ‰“å°ç±»ä¼¼çš„ä½™å¼¦ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;my $a=&#34;banana&#34;.comb;my $b=&#34;anna&#34;.comb;say ($a (&amp;) $b)/($a.Set.elems.sqrt*$b.Set.elems.sqrt)&#39;</span>

<span class="c1"># ä¸Šé¢çš„å‘½ä»¤æç¤º Seq å·²ç»è¢«æ¶ˆè´¹</span>
raku -e <span class="s1">&#39;my $a=&#34;banana&#34;.comb;my $b=&#34;anna&#34;.comb;say ($a.cache (&amp;) $b.cache)/($a.cache.Set.elems.sqrt*$b.cache.Set.elems.sqrt)&#39;</span>
</code></pre></div><p>åˆ›å»ºå­—ç¬¦ä¸²ä¸­å­—ç¬¦çš„ç´¢å¼•å¹¶æ‰“å°å‡ºæ¥ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say {}.push: %(&#34;banana&#34;.comb.pairs).invert&#39;</span>
</code></pre></div><p>åˆ›å»ºä¸€è¡Œä¸­å•è¯çš„æ‰€ä»¥å¹¶æ‰“å°å‡ºæ¥ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;({}.push: %(lines[0].words.pairs).invert).sort.join(&#34;\n&#34;).say&#39;</span> example.txt
</code></pre></div><h3 id="é€‰æ‹©æ€§çš„è¡Œæ‰“å°">é€‰æ‹©æ€§çš„è¡Œæ‰“å°</h3>
<p>æ‰“å°æ–‡ä»¶çš„ç¬¬ä¸€è¡Œï¼ˆæ¨¡ä»¿ head -1ï¼‰ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;.say;exit&#39;</span>      example.txt
raku -e <span class="s1">&#39;lines[0].say&#39;</span>    example.txt
raku -e <span class="s1">&#39;lines.shift.say&#39;</span> example.txt
</code></pre></div><p>æ‰“å°æ–‡ä»¶çš„å‰ 10 è¡Œï¼ˆæ¨¡ä»¿ head -10ï¼‰</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -pe <span class="s1">&#39;exit if ++$ &gt; 10&#39;</span> example.txt
raku -ne <span class="s1">&#39;.say if ++$ &lt; 11&#39;</span> example.txt
</code></pre></div><p>æ‰“å°æ–‡ä»¶çš„æœ€åä¸€è¡Œï¼ˆæ¨¡ä»¿ tail -1ï¼‰ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;lines.pop.say&#39;</span> example.txt
</code></pre></div><p>æ‰“å°æ–‡ä»¶çš„æœ€å 5 è¡Œï¼ˆæ¨¡ä»¿ tail -5ï¼‰ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;.say for lines[*-5..*]&#39;</span> example.txt
</code></pre></div><p>åªæ‰“å°åŒ…å«å…ƒéŸ³çš„è¡Œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;/&lt;[aeiou]&gt;/ &amp;&amp; .print&#39;</span> example.txt
</code></pre></div><p>æ‰“å°åŒ…å«æ‰€æœ‰å…ƒéŸ³çš„è¡Œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;.say if .comb (&gt;=) &lt;a e i o u&gt;&#39;</span> example.txt
raku -ne <span class="s1">&#39;.say if .comb âŠ‡ &lt;a e i o u&gt;&#39;</span>    example.txt
</code></pre></div><p>æ‰“å°å­—ç¬¦æ•°å¤§äºæˆ–ç­‰äº 80 çš„è¡Œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;.print if .chars &gt;= 80&#39;</span> example.txt
raku -ne <span class="s1">&#39;.chars &gt;= 80 &amp;&amp; .print&#39;</span> example.txt
</code></pre></div><p>åªæ‰“å°ç¬¬äºŒè¡Œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;.print if ++$ == 2&#39;</span> example.txt
</code></pre></div><p>æ‰“å°é™¤äº†ç¬¬äºŒè¡Œçš„æ‰€æœ‰è¡Œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -pe <span class="s1">&#39;next if ++$ == 2&#39;</span> example.txt
</code></pre></div><p>æ‰“å°ç¬¬ä¸€è¡Œåˆ°ç¬¬ä¸‰è¡Œä¹‹é—´çš„æ‰€æœ‰è¡Œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;.print if (1..3).any == ++$&#39;</span> example.txt
</code></pre></div><p>æ‰“å°ä¸¤ä¸ªæ­£åˆ™è¡¨è¾¾å¼ä¹‹é—´ï¼ˆåŒ…å«åŒ¹é…é‚£ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„è¡Œï¼‰çš„æ‰€æœ‰è¡Œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;.print if /^Lorem/../laborum\.$/&#39;</span> example.txt
</code></pre></div><p>æ‰“å°æœ€é•¿çš„è¡Œçš„é•¿åº¦ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say lines.max.chars&#39;</span> example.txt
raku -ne <span class="s1">&#39;state $l=0; $l = .chars if .chars &gt; $l;END { $l.say }&#39;</span> example.txt
</code></pre></div><p>æ‰“å°é•¿åº¦æœ€é•¿çš„è¡Œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say lines.max&#39;</span> example.txt
raku -e <span class="s1">&#39;my $l=&#34;&#34;; for (lines) {$l = $_ if .chars &gt; $l.chars};END { $l.say }&#39;</span> example.txt
</code></pre></div><p>æ‰“å°åŒ…å«æ•°å­—çš„æ‰€æœ‰è¡Œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;.say if /\d/&#39;</span>             example.txt
raku -e <span class="s1">&#39;.say for lines.grep(/\d/)&#39;</span> example.txt
raku -ne <span class="s1">&#39;/\d/ &amp;&amp; .say&#39;</span>             example.txt
raku -pe <span class="s1">&#39;next if ! $_.match(/\d/)&#39;</span> example.txt
</code></pre></div><p>æ‰“å°åªåŒ…å«æ•°å­—çš„æ‰€æœ‰è¡Œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;.say if /^\d+$/&#39;</span>             example.txt
raku -e <span class="s1">&#39;.say for lines.grep(/^\d+$/)&#39;</span> example.txt
raku -ne <span class="s1">&#39;/^\d+$/ &amp;&amp; .say&#39;</span>             example.txt
raku -pe <span class="s1">&#39;next if ! $_.match(/^\d+$/)&#39;</span> example.txt
</code></pre></div><p>æ‰“å°æ¯ä¸ªå¥‡æ•°è¡Œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;.say if ++$ % 2&#39;</span> example.txt
</code></pre></div><p>æ‰“å°æ¯ä¸ªå¶æ•°è¡Œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;.say if ! (++$ % 2)&#39;</span> example.txt
</code></pre></div><p>æ‰“å°æ‰€æœ‰é‡å¤çš„è¡Œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;state %l;.say if ++%l{$_}==2&#39;</span> example.txt
</code></pre></div><p>æ‰“å°å”¯ä¸€çš„è¡Œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;state %l;.say if ++%l{$_}==1&#39;</span> example.txt
</code></pre></div><p>æ‰“å°æ¯ä¸€è¡Œä¸­çš„ç¬¬ä¸€ä¸ªå­—æ®µï¼ˆå•è¯ï¼‰ï¼ˆæ¨¡ä»¿ cut -f 1 -d ' &lsquo;ï¼‰</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;.words[0].say&#39;</span> example.txt
</code></pre></div><h3 id="ä½¿ç”¨ç®¡é“è½¬æ¢æ•°æ®">ä½¿ç”¨ç®¡é“è½¬æ¢æ•°æ®</h3>
<p>Rakuç¨‹åºç›´æ¥é›†æˆåˆ°äº†å‘½ä»¤è¡Œä¸­ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>|</code> ç®¡é“ç¬¦å·ä»å•è¡Œç¨‹åºä¸­è¾“å‡ºæ•°æ®å’Œè¾“å…¥æ•°æ®åˆ°å•è¡Œç¨‹åºä¸­ã€‚ä¸ºäº† ä»ç®¡é“ä¸­è¾“å…¥æ•°æ®ï¼Œ Raku è‡ªåŠ¨åœ°æŠŠ STDIN è®¾ç½®ä¸º <code>$*IN</code>ã€‚å°±åƒå¯¹æ–‡ä»¶é‚£æ ·ï¼Œä»ç®¡é“è¾“å…¥çš„æ•°æ®åœ¨å•è¡Œä¸­ä¹Ÿèƒ½ä½¿ç”¨ <code>-n</code> æ¥è¿›è¡Œå¾ªç¯è¿­ä»£ã€‚ä»å•è¡Œç¨‹åºä¸­è¾“å‡ºæ•°æ®å°±ä½¿ç”¨ print æˆ– say å¥½äº†ã€‚</p>
<p>åœ¨å½“å‰ç›®å½•ä¸­å¯¹æ‰€æœ‰æ–‡ä»¶è¿›è¡Œ JSON ç¼–ç ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">ls <span class="p">|</span> raku -M JSON::Tiny -e <span class="s1">&#39;say to-json(lines)&#39;</span>
</code></pre></div><p>æ‰“å°æ–‡ä»¶ä¸­çš„å¤§çº¦ 5% çš„éšæœºæ ·æœ¬è¡Œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -ne <span class="s1">&#39;.say if 1.rand &lt;= 0.05&#39;</span> /usr/share/dict/words
</code></pre></div><p>é¢œè‰²è½¬æ¢ï¼Œ ä» HTML åˆ° RGB</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">echo</span> <span class="s2">&#34;#ffff00&#34;</span> <span class="p">|</span> raku -ne <span class="s1">&#39;.comb(/\w\w/).map({:16($_)}).say&#39;</span>
</code></pre></div><p>é¢œè‰²è½¬æ¢ï¼Œ ä» RGB åˆ° HTML</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nb">echo</span> <span class="s2">&#34;#ffff00&#34;</span> <span class="p">|</span> raku -ne <span class="s1">&#39;.comb(/\w\w/).map({:16($_)}).say&#39;</span>
</code></pre></div><h3 id="www">WWW</h3>
<p>ä¸‹è½½ä¸€ä¸ªé¡µé¢ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -M HTTP::UserAgent -e <span class="s1">&#39;say HTTP::UserAgent.new.get(&#34;google.com&#34;).content&#39;</span>
</code></pre></div><p>ä¸‹è½½ä¸€ä¸ªé¡µé¢å¹¶å‰¥ç¦» HTMLï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">wget -O - <span class="s2">&#34;http://raku.org&#34;</span> <span class="p">|</span> raku -ne <span class="s1">&#39;s:g/\&lt;.+?\&gt;//.say&#39;</span>
</code></pre></div><p>ä¸‹è½½ä¸€ä¸ªé¡µé¢å¹¶å‰¥ç¦»å¹¶è§£ç  HTMLï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">wget -O - <span class="s2">&#34;http://raku.org&#34;</span> <span class="p">|</span> raku -MHTML::Strip -ne <span class="s1">&#39;strip_html($_).say&#39;</span>
</code></pre></div><p>å¼€å¯ä¸€ä¸ªç®€å•åœ° web æœåŠ¡å™¨ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -M HTTP::Server::Simple -e <span class="s1">&#39;HTTP::Server::Simple.new.run&#39;</span>
</code></pre></div><h3 id="è½¬æ¢åˆ°-windows">è½¬æ¢åˆ° Windows</h3>
<p>ä¸€æ—¦ä½ çŸ¥é“äº†é‡Œé¢çš„é—¨é“ä¹‹åé‚£ä¹ˆåœ¨ Windows ä¸Šè¿è¡Œå•è¡Œç¨‹åºå°±æ˜¯å°è‰ä¸€ç¢Ÿã€‚å•è¡Œç¨‹åºæ—¢å¯ä»¥åœ¨ cmd.exe ä¸­è¿è¡Œï¼Œåˆå¯ä»¥åœ¨ Powershell ä¸­è¿è¡Œã€‚ä¸»è¦çš„è§„åˆ™æ˜¯ï¼šç”¨åŒå¼•å·æ›¿æ¢æ‰å¤–éƒ¨çš„å•å¼•å·ï¼Œåœ¨å•è¡Œç¨‹åºçš„å†…éƒ¨ä½¿ç”¨æ’å€¼å¼•ç”¨æ“ä½œç¬¦ <code>qq//</code> æ¥æŠŠå­—ç¬¦ä¸²æ‹¬èµ·æ¥ã€‚å¯¹äºéæ’å€¼çš„å¼•èµ·ï¼Œä½ å¯ä»¥ä½¿ç”¨å•å¼•å·ã€‚æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªä¾‹å­ã€‚</p>
<p>è¿™å„¿æœ‰ä¸€ä¸ªæ‰“å°æ—¶é—´çš„å•è¡Œç¨‹åºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say DateTime.now&#39;</span>
</code></pre></div><p>è¦åœ¨ Windows ä¸Šè¿è¡Œï¼Œæˆ‘ä»¬ä»…ä»…ç”¨åŒå¼•å·æ›¿æ¢æ‰å•å¼•å·å¥½äº†ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s2">&#34;say DateTime.now&#34;</span>
</code></pre></div><p>è¿™ä¸ªå•è¡Œç¨‹åºç»™æ–‡ä»¶ä¸­æ¯ä¸€è¡Œæ·»åŠ äº†ä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œä½¿ç”¨äº†æ’å€¼å­—ç¬¦ä¸²ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -pe <span class="s1">&#39;$_ ~= &#34;\n&#34;&#39;</span> example.txt
</code></pre></div><p>åœ¨ Windows ä¸Šè¿™åº”è¯¥å†™ä¸ºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -pe <span class="s2">&#34;</span><span class="nv">$_</span><span class="s2"> ~= qq/\n/&#34;</span> example.txt
</code></pre></div><p>è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æƒ³å¯¹æ¢è¡Œç¬¦è¿›è¡Œæ’å€¼ï¼Œå¹¶ä¸”ä¸ä¸ºè¯¥è¡Œå­—é¢åœ°æ·»åŠ åæ–œçº¿å’Œå­—ç¬¦&quot;n&quot;ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»ä½¿ç”¨ qqã€‚ä½†æ˜¯ä½ é€šå¸¸ä¹Ÿå¯ä»¥åƒè¿™æ ·åœ¨å•è¡Œç¨‹åºä¸­ä½¿ç”¨å•å¼•å·ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s1">&#39;say &#34;Hello, World!&#34;&#39;</span>
</code></pre></div><p>åœ¨ Windows ä¸Šè¿™åº”è¯¥å†™ä¸ºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s2">&#34;say &#39;hello, World!&#39;&#34;</span>
</code></pre></div><p>ç®€å•åœ°è¾“å‡ºé‡å®šå‘å·¥ä½œèµ·æ¥åƒåŸºäº Unix ç³»ç»Ÿé‚£æ ·ã€‚ è¿™ä¸ªå•è¡Œç¨‹åºä½¿ç”¨ <code>&gt;</code> æŠŠ ASCII å­—ç¬¦ç´¢å¼•è¡¨æ‰“å°åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">raku -e <span class="s2">&#34;say .chr ~ &#39; &#39; ~ </span><span class="nv">$_</span><span class="s2"> for 0..255&#34;</span> &gt; ascii_codes.txt
</code></pre></div><p>åœ¨ä½¿ç”¨ <code>&gt;</code> çš„æ—¶å€™ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨å°±ä¼šåˆ›å»ºä¸€ä¸ªã€‚å¦‚æœæ–‡ä»¶ç¡®å®å­˜åœ¨ï¼Œå®ƒä¼šè¢«é‡å†™ã€‚ä½ å¯èƒ½æ›´æƒ³è¿½åŠ åˆ°æ–‡ä»¶ï¼Œä½¿ç”¨ <code>&gt;&gt;</code> ä»£æ›¿ã€‚</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/oneliner" term="oneliner" label="oneliner" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä¸­çš„å˜é‡]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-08-25-variables-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-08-25-variables-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Variables in Raku</blockquote><p>å˜é‡åä»¥ä¸€ä¸ªå«åšé­”ç¬¦ sigil çš„ç‰¹æ®Šå­—ç¬¦å¼€å¤´, åé¢è·Ÿç€ä¸€ä¸ªå¯é€‰çš„ç¬¬äºŒä¸ªå«åš <code>twigil</code> çš„ç‰¹æ®Šå­—ç¬¦, ç„¶åæ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦.</p>
<h2 id="sigils">Sigils</h2>
<table>
<thead>
<tr>
<th style="text-align:center">ç¬¦å·</th>
<th style="text-align:left">ç±»å‹çº¦æŸ</th>
<th style="text-align:center">é»˜è®¤ç±»å‹</th>
<th style="text-align:center">Flattens</th>
<th style="text-align:center">Assignment</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$</td>
<td style="text-align:left">Mu (no type constraint)</td>
<td style="text-align:center">Any</td>
<td style="text-align:center">No</td>
<td style="text-align:center">item</td>
</tr>
<tr>
<td style="text-align:center">&amp;</td>
<td style="text-align:left">Callable</td>
<td style="text-align:center">Callable</td>
<td style="text-align:center">No</td>
<td style="text-align:center">item</td>
</tr>
<tr>
<td style="text-align:center">@</td>
<td style="text-align:left">Positional</td>
<td style="text-align:center">Array</td>
<td style="text-align:center">Yes</td>
<td style="text-align:center">list</td>
</tr>
<tr>
<td style="text-align:center">%</td>
<td style="text-align:left">Associative</td>
<td style="text-align:center">Hash</td>
<td style="text-align:center">Yes</td>
<td style="text-align:center">list</td>
</tr>
</tbody>
</table>
<p>ä¾‹å­:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$square</span> <span class="o">=</span> <span class="mi">9</span> <span class="o">**</span> <span class="mi">2</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">@array</span>  <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="p">;</span>   <span class="c1"># Array variable with three elements</span>
<span class="k">my</span> <span class="nv">%hash</span>   <span class="o">=</span> <span class="s">London</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">UK</span><span class="p">&#39;</span>, <span class="s">Berlin</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">Germany</span><span class="p">&#39;;</span>
</code></pre></div><p>é»˜è®¤ç±»å‹å¯ä»¥ä½¿ç”¨ <code>is</code> å…³é”®å­—è®¾ç½®ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">FailHash</span> <span class="k">is</span> <span class="nb">Hash</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nb">Bool</span> <span class="nv">$!final</span> <span class="o">=</span> <span class="nb">False</span><span class="p">;</span>

    <span class="k">multi</span> <span class="k">method</span> <span class="nb">AT-KEY</span> <span class="p">(</span> <span class="vg">::?CLASS:D</span><span class="o">:</span> <span class="nb">Str:D</span> \<span class="nb">key</span> <span class="p">){</span>
        <span class="nb">fail</span> <span class="ne">X::OutOfRange</span><span class="o">.</span><span class="nb">new</span><span class="p">(:</span><span class="s">what</span><span class="p">(&#34;</span><span class="s2">Hash key</span><span class="p">&#34;)</span><span class="o">,</span> <span class="p">:</span><span class="s">got</span><span class="p">(</span><span class="nb">key</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">range</span><span class="p">(</span><span class="nb">self</span><span class="o">.</span><span class="nb">keys</span><span class="p">))</span> <span class="k">if</span> <span class="nv">$!final</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">self</span><span class="o">.</span><span class="nb">EXISTS-KEY</span><span class="p">(</span><span class="nb">key</span><span class="p">);</span>
        <span class="nb">callsame</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">finalize</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$!final</span> <span class="o">=</span> <span class="nb">True</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">%h</span> <span class="k">is</span> <span class="nc">FailHash</span> <span class="o">=</span> <span class="s">oranges</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">round</span><span class="p">&#34;</span>, <span class="s">bananas</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">bendy</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="nv">%h</span><span class="p">&lt;</span><span class="s">oranges</span><span class="p">&gt;;</span>
<span class="c1"># OUTPUT Â«roundâ¤Â»</span>
<span class="nv">%h</span><span class="o">.</span><span class="nf">finalize</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">%h</span><span class="p">&lt;</span><span class="s">cherry</span><span class="p">&gt;;</span>
<span class="k">CATCH</span> <span class="p">{</span> <span class="k">default</span> <span class="p">{</span> <span class="nb">put</span> <span class="o">.^</span><span class="nb">name</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">: </span><span class="p">&#39;</span><span class="o">,</span> <span class="o">.</span><span class="nb">Str</span> <span class="p">}</span> <span class="p">}</span>
<span class="c1"># OUTPUT Â«X::OutOfRange: Hash key out of range. Is: cherry, should be in (oranges bananas)Â»</span>
</code></pre></div><p>ä¸å¸¦ç¬¦å·çš„å˜é‡ä¹Ÿæ˜¯å¯è¡Œçš„, æŸ¥çœ‹ <a href="http://doc.raku.org/language/variables#Sigilless_variables">æ— ç¬¦å·å˜é‡</a>.</p>
<h2 id="é¡¹å’Œåˆ—è¡¨èµ‹å€¼">é¡¹å’Œåˆ—è¡¨èµ‹å€¼</h2>
<p>æœ‰ä¸¤ç§ç±»å‹çš„èµ‹å€¼, item èµ‹å€¼å’Œ list èµ‹å€¼ã€‚ä¸¤è€…éƒ½ä½¿ç”¨ = å·æ“ä½œç¬¦ã€‚æ ¹æ® = å·å·¦è¾¹çš„è¯­æ³•æ¥åŒºåˆ« = æ˜¯ item èµ‹å€¼è¿˜æ˜¯ list èµ‹å€¼ã€‚</p>
<p>Item èµ‹å€¼æŠŠç­‰å·å³ä¾§çš„å€¼æ”¾åˆ°å·¦ä¾§çš„å˜é‡(å®¹å™¨)ä¸­ã€‚</p>
<p>ä¾‹å¦‚, <a href="https://docs.raku.org/type/Array">æ•°ç»„</a>å˜é‡(@ç¬¦å·)åœ¨åˆ—è¡¨èµ‹å€¼æ—¶æ¸…ç©ºæ•°ç»„è‡ªèº«, ç„¶åæŠŠç­‰å·å³ä¾§çš„å€¼éƒ½æ”¾è¿›æ•°ç»„è‡ªèº«ä¸­. è·Ÿ Item èµ‹å€¼ç›¸æ¯”, è¿™æ„å‘³ç€ç­‰å·å·¦ä¾§çš„å˜é‡ç±»å‹å§‹ç»ˆæ˜¯ Array, ä¸ç®¡å³ä¾§æ˜¯ä»€ä¹ˆç±»å‹ã€‚</p>
<p>èµ‹å€¼ç±»å‹(item æˆ– list)å–å†³äºå½“å‰è¡¨è¾¾å¼æˆ–å£°æ˜ç¬¦çœ‹åˆ°çš„ç¬¬ä¸€ä¸ªä¸Šä¸‹æ–‡:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$foo</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>            <span class="c1"># item assignment</span>
<span class="nb">say</span> <span class="nv">$foo</span><span class="o">.</span><span class="nb">perl</span><span class="p">;</span>          <span class="c1"># 5</span>

<span class="k">my</span> <span class="nv">@bar</span> <span class="o">=</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">9</span><span class="p">;</span>         <span class="c1"># list assignment</span>
<span class="nb">say</span> <span class="nv">@bar</span><span class="o">.</span><span class="nb">WHAT</span><span class="p">;</span>          <span class="c1"># Array</span>
<span class="nb">say</span> <span class="nv">@bar</span><span class="o">.</span><span class="nb">perl</span><span class="p">;</span>          <span class="c1"># [7, 9]</span>

<span class="p">(</span><span class="k">my</span> <span class="nv">$baz</span><span class="p">)</span> <span class="o">=</span> <span class="mi">11</span><span class="o">,</span> <span class="mi">13</span><span class="p">;</span>     <span class="c1"># list assignment</span>
<span class="nb">say</span> <span class="nv">$baz</span><span class="o">.</span><span class="nb">WHAT</span><span class="p">;</span>          <span class="c1"># Parcel</span>
<span class="nb">say</span> <span class="nv">$baz</span><span class="o">.</span><span class="nb">perl</span><span class="p">;</span>          <span class="c1"># (11, 13)</span>
</code></pre></div><p>å› æ­¤, åŒ…å«åœ¨åˆ—è¡¨èµ‹å€¼ä¸­çš„èµ‹å€¼è¡Œä¸ºä¾èµ–äºè¡¨è¾¾å¼æˆ–åŒ…å«è¡¨è¾¾å¼çš„å£°æ˜ç¬¦ã€‚
ä¾‹å¦‚, å¦‚æœå†…éƒ¨èµ‹å€¼æ˜¯ä¸€ä¸ªå£°æ˜ç¬¦(ä¾‹å¦‚ <code>my</code>), å°±ä½¿ç”¨ item èµ‹å€¼, å®ƒæ¯”é€—å·å’Œåˆ—è¡¨èµ‹å€¼çš„ä¼˜å…ˆçº§æ›´é«˜:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@array</span><span class="p">;</span>
<span class="nv">@array</span> <span class="o">=</span> <span class="k">my</span> <span class="nv">$num</span> <span class="o">=</span> <span class="mi">42</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">str</span><span class="p">&#34;;</span>   <span class="c1"># item assignment: uses declarator</span>
<span class="nb">say</span> <span class="nv">@array</span><span class="o">.</span><span class="nb">perl</span><span class="p">;</span>                <span class="c1"># [42, &#34;str&#34;] (an Array)</span>
<span class="nb">say</span> <span class="nv">$num</span><span class="o">.</span><span class="nb">perl</span><span class="p">;</span>                  <span class="c1"># 42 (a Num)</span>
</code></pre></div><p>ç±»ä¼¼åœ°, å¦‚æœå†…éƒ¨èµ‹å€¼æ˜¯ä¸€ä¸ªç”¨äºå£°æ˜ç¬¦åˆå§‹åŒ–çš„è¡¨è¾¾å¼, åˆ™å†…éƒ¨è¡¨è¾¾å¼çš„ä¸Šä¸‹æ–‡å†³å®šèµ‹å€¼çš„ç±»å‹:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$num</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">@array</span> <span class="o">=</span> <span class="nv">$num</span> <span class="o">=</span> <span class="mi">42</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">str</span><span class="p">&#34;;</span>    <span class="c1"># item assignment: uses expression</span>
<span class="nb">say</span> <span class="nv">@array</span><span class="o">.</span><span class="nb">perl</span><span class="p">;</span>                 <span class="c1"># [42, &#34;str&#34;] (an Array)</span>
<span class="nb">say</span> <span class="nv">$num</span><span class="o">.</span><span class="nb">perl</span><span class="p">;</span>                   <span class="c1"># 42 (a Num)</span>

<span class="k">my</span> <span class="p">(</span> <span class="nv">@foo</span><span class="o">,</span> <span class="nv">$bar</span> <span class="p">);</span>
<span class="nv">@foo</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$bar</span><span class="p">)</span> <span class="o">=</span> <span class="mi">42</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">str</span><span class="p">&#34;;</span>       <span class="c1"># list assignment: uses parens</span>
<span class="nb">say</span> <span class="nv">@foo</span><span class="o">.</span><span class="nb">perl</span><span class="p">;</span>                   <span class="c1"># [42, &#34;str&#34;] (an Array)</span>
<span class="nb">say</span> <span class="nv">$bar</span><span class="o">.</span><span class="nb">perl</span><span class="p">;</span>                   <span class="c1"># $(42, &#34;str&#34;)  (a Parcel)</span>
</code></pre></div><p>ç„¶è€Œ, å¦‚æœå†…éƒ¨èµ‹å€¼æ—¢ä¸æ˜¯å£°æ˜ç¬¦åˆä¸æ˜¯è¡¨è¾¾å¼, è€Œæ˜¯æ›´å¤§çš„è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†, æ›´å¤§çš„è¡¨è¾¾å¼çš„ä¸Šä¸‹æ–‡å†³å®šèµ‹å€¼çš„ç±»å‹:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="p">(</span> <span class="nv">@array</span><span class="o">,</span> <span class="nv">$num</span> <span class="p">);</span>
<span class="nv">@array</span> <span class="o">=</span> <span class="nv">$num</span> <span class="o">=</span> <span class="mi">42</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">str</span><span class="p">&#34;;</span>    <span class="c1"># list assignment</span>
<span class="nb">say</span> <span class="nv">@array</span><span class="o">.</span><span class="nb">perl</span><span class="p">;</span>              <span class="c1"># [42, &#34;str&#34;] (an Array)</span>
<span class="nb">say</span> <span class="nv">$num</span><span class="o">.</span><span class="nb">perl</span><span class="p">;</span>                <span class="c1"># [42, &#34;str&#34;] (an Array)</span>
</code></pre></div><p>è¿™æ˜¯å› ä¸ºæ•´ä¸ªè¡¨è¾¾å¼æ˜¯ <code>@array = $num = 42, &quot;str&quot;</code>, è€Œ <code>$num = 42</code> ä¸æ˜¯å•ç‹¬çš„è¡¨è¾¾å¼ã€‚</p>
<p>æŸ¥çœ‹<a href="https://docs.raku.org/language/operators">æ“ä½œç¬¦</a>è·å–å…³äºä¼˜å…ˆçº§çš„æ›´å¤šè¯¦æƒ…ã€‚</p>
<h2 id="æ— ç¬¦å·å˜é‡">æ— ç¬¦å·å˜é‡</h2>
<p>åœ¨ Raku ä¸­åˆ›å»ºä¸å¸¦ç¬¦å·çš„å˜é‡ä¹Ÿæ˜¯å¯èƒ½çš„:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">\degrees</span> <span class="o">=</span> <span class="no">pi</span> <span class="o">/</span> <span class="mi">180</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">\Î¸</span>       <span class="o">=</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">degrees</span><span class="p">;</span>
</code></pre></div><p>ç„¶è€Œ, è¿™äº›æ— ç¬¦å·å˜é‡å¹¶ä¸åˆ›å»º<a href="https://docs.raku.org/language/containers">å®¹å™¨</a>. é‚£æ„å‘³ç€ä¸Šé¢çš„ <code>degrees</code> å’Œ <code>Î¸</code> å®é™…ä¸Šç›´æ¥ä»£è¡¨ <code>Nums</code>ã€‚ ä¸ºäº†è¯´æ˜, æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ— ç¬¦å·å˜é‡åå†èµ‹å€¼:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="n">Î¸</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c1"># Dies with the error &#34;Cannot modify an immutable Num&#34;</span>
</code></pre></div><p>æ— ç¬¦å·å˜é‡ä¸å¼ºåˆ¶ä¸Šä¸‹æ–‡, æ‰€ä»¥å®ƒä»¬å¯è¢«ç”¨äºåŸæ ·åœ°ä¼ é€’æŸäº›ä¸œè¥¿:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">logged</span><span class="p">(</span><span class="nv">&amp;f</span><span class="o">,</span> <span class="o">|</span><span class="nb">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span><span class="p">(&#39;</span><span class="s1">Calling </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">&amp;f</span><span class="o">.</span><span class="nb">name</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> with arguments </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nb">args</span><span class="o">.</span><span class="nb">perl</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">\result</span> <span class="o">=</span> <span class="nb">f</span><span class="p">(</span><span class="o">|</span><span class="nb">args</span><span class="p">);</span>
    <span class="c1">#  ^^^^^^^ not enforcing any context here</span>
    <span class="nb">say</span><span class="p">(</span><span class="nv">&amp;f</span><span class="o">.</span><span class="nb">name</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> returned </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nb">result</span><span class="o">.</span><span class="nb">perl</span><span class="p">);</span>
    <span class="k">return</span> <span class="o">|</span><span class="nb">result</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><h2 id="twigils">Twigils</h2>
<p><code>Twigils</code> å½±å“å˜é‡çš„ä½œç”¨åŸŸã€‚è¯·è®°ä½ twigils å¯¹åŸºæœ¬çš„é­”ç¬¦æ’å€¼æ²¡æœ‰å½±å“ï¼Œé‚£å°±æ˜¯ï¼Œå¦‚æœ <code>$a</code> å†…æ’ï¼Œ<code>$^a</code>, <code>$*a</code>, <code>$=a</code>, <code>$?a</code>, <code>$.a</code>, ç­‰ç­‰ä¹Ÿä¼šå†…æ’. å®ƒä»…ä»…å–å†³äº <code>$</code>ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:center">Twigil</th>
<th style="text-align:left">Scope</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">*</td>
<td style="text-align:left">åŠ¨æ€çš„</td>
</tr>
<tr>
<td style="text-align:center">!</td>
<td style="text-align:left">å±æ€§(ç±»æˆå‘˜)</td>
</tr>
<tr>
<td style="text-align:center">?</td>
<td style="text-align:left">ç¼–è¯‘æ—¶å˜é‡</td>
</tr>
<tr>
<td style="text-align:center">.</td>
<td style="text-align:left">æ–¹æ³•(å¹¶éçœŸæ­£çš„å˜é‡)</td>
</tr>
<tr>
<td style="text-align:center">&lt;</td>
<td style="text-align:left">åŒ¹é…å¯¹è±¡ç´¢å¼•(å¹¶éçœŸæ­£çš„å˜é‡)</td>
</tr>
<tr>
<td style="text-align:center">^</td>
<td style="text-align:left">è‡ªæˆ‘å£°æ˜çš„å½¢å¼ä½ç½®å‚æ•°</td>
</tr>
<tr>
<td style="text-align:center">:</td>
<td style="text-align:left">è‡ªæˆ‘å£°æ˜çš„å½¢å¼å‘½åå‚æ•°</td>
</tr>
<tr>
<td style="text-align:center">=</td>
<td style="text-align:left">Pod å˜é‡</td>
</tr>
<tr>
<td style="text-align:center">~</td>
<td style="text-align:left">å­è¯­è¨€</td>
</tr>
</tbody>
</table>
<h2 id="-twigil">* Twigil</h2>
<p>åŠ¨æ€å˜é‡é€šè¿‡ caller æŸ¥æ‰¾, ä¸æ˜¯é€šè¿‡å¤–éƒ¨ä½œç”¨åŸŸã€‚ä¾‹å¦‚:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$lexical</span>   <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">my</span> <span class="vg">$*dynamic1</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="k">my</span> <span class="vg">$*dynamic2</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>

<span class="k">sub</span> <span class="nf">say-all</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$lexical</span><span class="s2">, </span><span class="nv">$*dynamic1</span><span class="s2">, </span><span class="nv">$*dynamic2</span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="c1"># prints 1, 10, 100</span>
<span class="nf">say-all</span><span class="p">();</span>

<span class="p">{</span>
    <span class="k">my</span> <span class="nv">$lexical</span>   <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">my</span> <span class="vg">$*dynamic1</span> <span class="o">=</span> <span class="mi">11</span><span class="p">;</span>
    <span class="vg">$*dynamic2</span>    <span class="o">=</span> <span class="mi">101</span><span class="p">;</span> <span class="c1"># æ³¨æ„,è¿™å„¿æ²¡æœ‰ä½¿ç”¨ my æ¥å£°æ˜</span>

    <span class="c1"># prints 1, 11, 101</span>
    <span class="nf">say-all</span><span class="p">();</span>
<span class="p">}</span>

<span class="c1"># prints 1, 10, 101</span>
<span class="nf">say-all</span><span class="p">();</span>
</code></pre></div><p>ç¬¬ä¸€æ¬¡è°ƒç”¨ <code>&amp;say-all</code> æ—¶, å°±åƒä½ æœŸæœ›çš„ä¸€æ ·, å®ƒæ‰“å° &ldquo;1, 10, 100&rdquo;ã€‚å¯æ˜¯ç¬¬äºŒæ¬¡å®ƒæ‰“å° &ldquo;1, 11, 101&rdquo;ã€‚ è¿™æ˜¯å› ä¸º <code>$lexical</code> ä¸æ˜¯åœ¨è°ƒç”¨è€…çš„ä½œç”¨åŸŸå†…è¢«æŸ¥æ‰¾, è€Œæ˜¯åœ¨ <code>&amp;say-all</code> è¢«å®šä¹‰çš„ä½œç”¨åŸŸé‡Œè¢«æŸ¥æ‰¾çš„ã€‚è¿™ä¸¤ä¸ªåŠ¨æ€ä½œç”¨åŸŸå˜é‡åœ¨è°ƒç”¨è€…çš„ä½œç”¨åŸŸå†…è¢«æŸ¥æ‰¾, æ‰€ä»¥å€¼ä¸º <code>11</code> å’Œ <code>101</code>ã€‚ç¬¬ä¸‰æ¬¡è°ƒç”¨ <code>&amp;say-all</code> å,  <code>$*dynamic1</code> ä¸å†æ˜¯ 11 äº†ã€‚ä½†æ˜¯ <code>$*dynamic2</code> ä»ç„¶æ˜¯ 101ã€‚è¿™æºäºæˆ‘ä»¬åœ¨å—ä¸­å£°æ˜äº†ä¸€ä¸ªæ–°çš„åŠ¨æ€å˜é‡ <code>$*dynamic1</code> çš„äº‹å®å¹¶ä¸”æ²¡æœ‰åƒæˆ‘ä»¬å¯¹å¾… <code>$*dynamic2</code> é‚£æ ·æŠŠå€¼èµ‹å€¼ç»™æ—§çš„å˜é‡ã€‚</p>
<p>åŠ¨æ€å˜é‡ä¸å…¶ä»–å˜é‡ç±»å‹åœ¨å¼•ç”¨ä¸€ä¸ªæœªå£°æ˜çš„åŠ¨æ€å˜é‡ä¸Šä¸åŒçš„æ˜¯å‰è€…ä¸æ˜¯ä¸€ä¸ªç¼–è¯‘æ—¶é”™è¯¯ï¼Œè€Œæ˜¯è¿è¡Œæ—¶ <a href="https://docs.raku.org/type/Failure">failure</a>ï¼Œè¿™æ ·ä¸€ä¸ªåŠ¨æ€å˜é‡å¯ä»¥åœ¨æœªå®šä¹‰æ—¶ä½¿ç”¨åªè¦åœ¨æŠŠå®ƒç”¨ä½œä»»ä½•å…¶å®ƒä¸œè¥¿çš„æ—¶å€™æ£€æŸ¥å®ƒæ˜¯å¦å®šä¹‰è¿‡:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="vg">$*FOO</span> <span class="o">//</span> <span class="p">&#39;</span><span class="s1">foo</span><span class="p">&#39;;</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="n">foo</span><span class="p">;</span> <span class="c1"># -&gt; &#39;foo&#39;</span>

<span class="k">my</span> <span class="vg">$*FOO</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">bar</span><span class="p">&#39;;</span>

<span class="nb">say</span> <span class="n">foo</span><span class="p">;</span> <span class="c1"># -&gt; &#39;bar&#39;</span>
</code></pre></div><h2 id="-twigil-1">! Twigil</h2>
<p>å±æ€§æ˜¯å˜é‡, å­˜åœ¨äºæ¯ä¸ªç±»çš„å®ä¾‹ä¸­. é€šè¿‡ <code>!</code> ç¬¦å·å®ƒä»¬å¯ä»¥ä»ç±»çš„é‡Œé¢ç›´æ¥è¢«è®¿é—®åˆ°:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Point</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.x</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.y</span><span class="p">;</span>

    <span class="k">method</span> <span class="nb">Str</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">&#34;</span><span class="s2">(</span><span class="nv">$!x</span><span class="s2">, </span><span class="nv">$!y</span><span class="s2">)</span><span class="p">&#34;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>æ³¨æ„å±æ€§æ˜¯æ€æ ·è¢«å£°æ˜ä¸º <code>$.x</code> å’Œ <code>$.y</code> çš„, ä½†æ˜¯ä»ç„¶èƒ½å¤Ÿé€šè¿‡ <code>$!x</code> å’Œ <code>$!y</code> è®¿é—®åˆ°å±æ€§. è¿™æ˜¯å› ä¸º åœ¨ Raku ä¸­, æ‰€æœ‰çš„å±æ€§éƒ½æ˜¯<code>ç§æœ‰çš„</code>, å¹¶ä¸”åœ¨ç±»ä¸­èƒ½ä½¿ç”¨ <code>$!attribute-name</code> ç›´æ¥è®¿é—®è¿™äº›å±æ€§. Raku èƒ½è‡ªåŠ¨ä¸ºä½ ç”Ÿæˆè®¿é—®æ–¹æ³•. å…³äºå¯¹è±¡ã€ç±»å’Œå®ƒä»¬çš„å±æ€§å’Œæ–¹æ³•çš„è¯¦æƒ…, è¯·æŸ¥çœ‹<a href="https://docs.raku.org/language/objects">é¢å‘å¯¹è±¡</a>.</p>
<h2 id="-twigil-2">? Twigil</h2>
<p>ç¼–è¯‘æ—¶&quot;å¸¸é‡&quot;, å¯é€šè¿‡ <code>?</code> twigil è®¿é—®. ç¼–è¯‘å™¨å¯¹å®ƒä»¬å¾ˆç†Ÿæ‚‰, å¹¶ä¸”ç¼–è¯‘åä¸èƒ½è¢«ä¿®æ”¹. å¸¸ç”¨çš„ä¸€ä¸ªä¾‹å­å¦‚ä¸‹:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$?FILE:</span><span class="s2"> </span><span class="nv">$?LINE</span><span class="p">&#34;;</span> <span class="c1"># prints &#34;hello.pl: 23&#34; if this is the 23 line of a</span>
                      <span class="c1"># file named &#34;hello.pl&#34;.</span>
</code></pre></div><p>å…³äºè¿™äº›ç‰¹æ®Šå˜é‡çš„åˆ—è¡¨è¯·æŸ¥çœ‹<a href="https://docs.raku.org/language/variables#Compile-time_variables">ç¼–è¯‘æ—¶å˜é‡</a>ã€‚</p>
<p>å°½ç®¡ä¸èƒ½åœ¨è¿è¡Œæ—¶æ”¹å˜å®ƒä»¬, ç”¨æˆ·å¯ä»¥(é‡æ–°)å®šä¹‰è¿™ç§å¸¸é‡.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">constant</span> <span class="nv">$?TABSTOP</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span> <span class="c1"># this causes leading tabs in a heredoc or in a POD</span>
                        <span class="c1"># block&#39;s virtual margin to be counted as 4 spaces.</span>
</code></pre></div><h2 id="-twigil-3">. Twigil</h2>
<p><code>.</code> twigil çœŸçš„ä¸æ˜¯ç”¨äºå˜é‡çš„. å®é™…ä¸Š, çœ‹ä¸‹é¢çš„ä»£ç :</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Point</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.x</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.y</span><span class="p">;</span>

    <span class="k">method</span> <span class="nb">Str</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">&#34;</span><span class="s2">(</span><span class="nv">$.x</span><span class="s2">, </span><span class="nv">$.y</span><span class="s2">)</span><span class="p">&#34;</span> <span class="c1"># æ³¨æ„æˆ‘ä»¬è¿™æ¬¡ä½¿ç”¨ . è€Œä¸æ˜¯ !</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>å¯¹ <code>self</code>(è‡ªèº«)è°ƒç”¨äº†æ–¹æ³• <code>x</code> å’Œæ–¹æ³• <code>y</code>, è¿™æ˜¯è‡ªåŠ¨ä¸ºä½ ç”Ÿæˆçš„, å› ä¸ºåœ¨ä½ å£°æ˜ä½ çš„å±æ€§çš„æ—¶å€™, ä½ ä½¿ç”¨çš„æ˜¯ <code>.</code> twigil ã€‚ æ³¨æ„,  å­ç±»å¯èƒ½ä¼šè¦†ç›–é‚£äº›æ–¹æ³•. å¦‚æœä½ ä¸æƒ³è¿™ä¸ªå‘ç”Ÿ, è¯·ä½¿ç”¨ <code>$!x</code> å’Œ <code>$!y</code> ä»£æ›¿ã€‚</p>
<p><code>.</code> twigil åªæ˜¯è°ƒç”¨äº†ä¸€ä¸ªæ–¹æ³•ä¹Ÿè¡¨æ˜ä¸‹é¢æ˜¯å¯èƒ½çš„</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">SaySomething</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">a</span><span class="p">()</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">a</span><span class="p">&#34;;</span> <span class="p">}</span>
    <span class="k">method</span> <span class="nf">b</span><span class="p">()</span> <span class="p">{</span> <span class="nv">$.a</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="n">SaySomething</span><span class="o">.</span><span class="nf">b</span><span class="p">;</span> <span class="c1"># prints &#34;a&#34;</span>
</code></pre></div><p>å…³äºå¯¹è±¡ã€ç±»å’Œå®ƒä»¬çš„å±æ€§å’Œæ–¹æ³•çš„è¯¦æƒ…, è¯·æŸ¥çœ‹<a href="https://docs.raku.org/language/objects">é¢å‘å¯¹è±¡</a>.</p>
<h2 id="-twigil-4">&lt; Twigil</h2>
<p><code>&lt;</code> twigil æ˜¯ <code>$/&lt;...&gt;</code> çš„åˆ«å, å…¶ä¸­,  <code>$/</code> æ˜¯åŒ¹é…å˜é‡ã€‚å…³äºåŒ¹é…å˜é‡çš„æ›´å¤šè¯¦æƒ…è¯·æŸ¥çœ‹ <a href="https://docs.raku.org/language/variables#The_%24%2F_Variable">$/å˜é‡</a>å’Œ<a href="https://docs.raku.org/type/Match">ç±»å‹åŒ¹é…</a></p>
<h2 id="-twigil-5">^ Twigil</h2>
<p><code>^</code> twigil ä¸º block å— æˆ– å­ä¾‹ç¨‹ å£°æ˜äº†ä¸€ä¸ªå½¢å¼ä½ç½®å‚æ•°.  å½¢å¦‚ <code>$^variable</code> çš„å˜é‡æ˜¯ä¸€ç§å ä½å˜é‡. å®ƒä»¬å¯ç”¨åœ¨è£¸ä»£ç å—ä¸­æ¥å£°æ˜ä»£ç å—çš„å½¢å¼å‚æ•°ã€‚çœ‹ä¸‹é¢ä»£ç ä¸­çš„å—:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="o">^</span><span class="mi">4</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$^seconds</span><span class="s2"> follows </span><span class="nv">$^first</span><span class="p">&#34;;</span>
<span class="p">}</span>
</code></pre></div><p>å®ƒæ‰“å°å‡º:</p>
<pre><code>1 follows 0
3 follows 2
</code></pre><p>æœ‰ä¸¤ä¸ªå½¢å¼å‚æ•°ï¼Œå°±æ˜¯ <code>$first</code> å’Œ <code>$second</code>.  æ³¨æ„, å°½ç®¡ <code>$^second</code> åœ¨ä»£ç ä¸­å‡ºç°çš„æ¯” <code>$^first</code> æ—©,  <code>$^first</code> ä¾ç„¶æ˜¯ä»£ç å—ä¸­çš„ç¬¬ä¸€ä¸ªå½¢å¼å‚æ•°. è¿™æ˜¯å› ä¸ºå ä½ç¬¦å˜é‡æ˜¯ä»¥ Unicode é¡ºåºæ’åºçš„ã€‚</p>
<p>å­ä¾‹ç¨‹ä¹Ÿèƒ½ä½¿ç”¨å ä½ç¬¦å˜é‡, ä½†æ˜¯åªæœ‰åœ¨å­ä¾‹ç¨‹æ²¡æœ‰æ˜¾å¼çš„å‚æ•°åˆ—è¡¨æ—¶æ‰è¡Œ. è¿™å¯¹æ™®é€šçš„å—ä¹Ÿé€‚ç”¨</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">say-it</span>    <span class="p">{</span> <span class="nb">say</span> <span class="nv">$^a</span><span class="p">;</span> <span class="p">}</span> <span class="c1"># valid</span>
<span class="k">sub</span> <span class="nf">say-it</span><span class="p">()</span>  <span class="p">{</span> <span class="nb">say</span> <span class="nv">$^a</span><span class="p">;</span> <span class="p">}</span> <span class="c1"># invalid</span>
              <span class="p">{</span> <span class="nb">say</span> <span class="nv">$^a</span><span class="p">;</span> <span class="p">}</span> <span class="c1"># valid</span>
<span class="k">-&gt;</span> <span class="nv">$x</span><span class="o">,</span> <span class="nv">$y</span><span class="o">,</span> <span class="nv">$x</span> <span class="p">{</span> <span class="nb">say</span> <span class="nv">$^a</span><span class="p">;</span> <span class="p">}</span> <span class="c1"># éæ³•, å·²ç»æœ‰å‚æ•°åˆ—è¡¨ $x,$y,$x äº†</span>
</code></pre></div><p>å ä½ç¬¦å˜é‡è¯­æ³•ä¸Šä¸èƒ½æœ‰ç±»å‹é™åˆ¶. ä¹Ÿæ³¨æ„, ä¹Ÿä¸èƒ½ä½¿ç”¨å•ä¸ªå¤§å†™å­—æ¯çš„å ä½ç¬¦å˜é‡, å¦‚ <code>$^A</code></p>
<h2 id="-twigil-6">: Twigil</h2>
<p><code>:</code> twigil ä¸ºå—æˆ–å­ä¾‹ç¨‹å£°æ˜äº†ä¸€ä¸ªå½¢å¼<strong>å‘½åå‚æ•°</strong>ã€‚ä½¿ç”¨è¿™ç§å½¢å¼å£°æ˜çš„å˜é‡ä¹Ÿæ˜¯å ä½ç¬¦å˜é‡çš„ä¸€ç§ç±»å‹ã€‚å› æ­¤é€‚ç”¨äºä½¿ç”¨ <code>^</code> twigil å£°æ˜çš„å˜é‡çš„ä¸œè¥¿åœ¨è¿™å„¿ä¹Ÿé€‚ç”¨(é™¤äº†å®ƒä»¬ä¸æ˜¯ä½ç½®çš„ä»¥å¤–, å› æ­¤æ²¡æœ‰ä½¿ç”¨ Unicode é¡ºåºæ’åº)ã€‚æ‰€ä»¥è¿™ä¸ª:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">{</span> <span class="nv">$:add</span> <span class="o">??</span> <span class="nv">$^a</span> <span class="o">+</span> <span class="nv">$^b</span> <span class="o">!!</span> <span class="nv">$^a</span> <span class="o">-</span> <span class="nv">$^b</span> <span class="p">}(</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span> <span class="p">)</span> <span class="p">:!</span><span class="s">add</span>
<span class="c1"># OUTPUT:</span>
<span class="c1"># -1</span>
</code></pre></div><p>æŸ¥çœ‹ <a href="https://docs.raku.org/routine/%5E">^</a>è·å–å…³äºå ä½ç¬¦å˜é‡çš„æ›´å¤šç»†èŠ‚ã€‚</p>
<h2 id="-twigil-7">= Twigil</h2>
<p><code>=</code> twigil ç”¨äºè®¿é—® Pod å˜é‡ã€‚å½“å‰æ–‡ä»¶ä¸­çš„æ¯ä¸ª Pod å—éƒ½èƒ½é€šè¿‡ä¸€ä¸ª Pod å¯¹è±¡è®¿é—®åˆ°, ä¾‹å¦‚ <code>$=data</code>, <code>$=SYNOPSIS</code> æˆ– <code>=UserBlock</code>, å³ï¼šä¸€ä¸ªå’Œæƒ³è¦çš„å—åŒåçš„å˜é‡åŠ ä¸Šä¸€ä¸ª <code>=</code> twigilã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">=begin</span><span class="sd"> </span><span class="k">Foo</span><span class="sd">
</span><span class="sd">...
</span><span class="sd"></span><span class="k">=end Foo</span>

<span class="c1">#after that, $=Foo gives you all Foo-Pod-blocks</span>
</code></pre></div><p>æ‚¨å¯ä»¥é€šè¿‡ <code>$=pod</code>è®¿é—® Pod æ ‘ï¼Œå®ƒåŒ…å«æ‰€æœ‰ä½œä¸ºåˆ†çº§æ•°æ®ç»“æ„çš„Podç»“æ„ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œæ‰€æœ‰è¿™äº› <code>$=someBlockName</code> éƒ½æ”¯æŒä½ç½®å’Œå…³è”è§’è‰²ã€‚</p>
<h2 id="-twigil-8">~ Twigil</h2>
<p>æ³¨æ„: Slangsï¼ˆä¿šè¯­ï¼‰åœ¨ Rakudo ä¸­è¿˜æ²¡æœ‰è¢«å®ç°ã€‚ NYI = Not Yet Implementedã€‚</p>
<p><code>~</code> twigil æ˜¯æŒ‡å­è¯­è¨€ï¼ˆç§°ä¸ºä¿šè¯­ï¼‰ã€‚ä¸‹é¢æ˜¯æœ‰ç”¨çš„ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">å˜é‡å</th>
<th style="text-align:left">è¯´ æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$~MAIN</td>
<td style="text-align:left">the current main language (e.g. Perl statements)</td>
</tr>
<tr>
<td style="text-align:center">$~Quote</td>
<td style="text-align:left">the current root of quoting language</td>
</tr>
<tr>
<td style="text-align:center">$~Quasi</td>
<td style="text-align:left">the current root of quasiquoting language</td>
</tr>
<tr>
<td style="text-align:center">$~Regex</td>
<td style="text-align:left">the current root of regex language</td>
</tr>
<tr>
<td style="text-align:center">$~Trans</td>
<td style="text-align:left">the current root of transliteration language</td>
</tr>
<tr>
<td style="text-align:center">$~P5Regex</td>
<td style="text-align:left">the current root of the Perl 5 regex language</td>
</tr>
</tbody>
</table>
<p>ä½ åœ¨ä½ å½“å‰çš„è¯æ³•ä½œç”¨åŸŸä¸­æ‰©å……è¿™äº›è¯­è¨€ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">use</span> <span class="nb">MONKEY-TYPING</span><span class="p">;</span>

<span class="k">augment</span> <span class="n">slang</span> <span class="nb">Regex</span> <span class="p">{</span>  <span class="c1"># derive from $~Regex and then modify $~Regex</span>
    <span class="k">token</span> <span class="nf">backslash:std</span>&lt;\Y&gt; <span class="p">{</span><span class="sr"> YY </span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div><h2 id="å˜é‡å£°æ˜ç¬¦å’Œä½œç”¨åŸŸ">å˜é‡å£°æ˜ç¬¦å’Œä½œç”¨åŸŸ</h2>
<p>é€šå¸¸, ä½¿ç”¨ <code>my</code> å…³é”®å­—åˆ›å»ºä¸€ä¸ªæ–°çš„å˜é‡å°±è¶³å¤Ÿäº†:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$amazing-variable</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">World</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hello </span><span class="nv">$amazing-variable</span><span class="s2">!</span><span class="p">&#34;;</span> <span class="c1"># Hello World!</span>
</code></pre></div><p>ç„¶è€Œ, æœ‰å¾ˆå¤šå£°æ˜ç¬¦èƒ½åœ¨ <a href="https://docs.raku.org/language/variables#Twigils">Twigils</a> çš„èƒ½åŠ›ä¹‹å¤–æ”¹å˜ä½œç”¨åŸŸçš„ç»†èŠ‚ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:center">å£°æ˜ç¬¦</th>
<th style="text-align:left">ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">my</td>
<td style="text-align:left">ä½œä¸ºè¯æ³•ä½œç”¨åŸŸåå­—çš„å¼€å¤´</td>
</tr>
<tr>
<td style="text-align:center">our</td>
<td style="text-align:left">ä½œä¸ºåŒ…ä½œç”¨åŸŸåå­—çš„å¼€å¤´</td>
</tr>
<tr>
<td style="text-align:center">has</td>
<td style="text-align:left">ä½œä¸ºå±æ€§åçš„å¼€å¤´</td>
</tr>
<tr>
<td style="text-align:center">anon</td>
<td style="text-align:left">ä½œä¸ºç§æœ‰åå­—çš„å¼€å¤´</td>
</tr>
<tr>
<td style="text-align:center">state</td>
<td style="text-align:left">ä½œä¸ºè¯æ³•ä½œç”¨åŸŸä½†æ˜¯æŒä¹…åå­—çš„å¼€å¤´</td>
</tr>
<tr>
<td style="text-align:center">augment</td>
<td style="text-align:left">ç»™å·²å­˜åœ¨çš„åå­—æ·»åŠ å®šä¹‰</td>
</tr>
<tr>
<td style="text-align:center">supersede</td>
<td style="text-align:left">æ›¿æ¢å·²å­˜åœ¨åå­—çš„å®šä¹‰</td>
</tr>
</tbody>
</table>
<p>è¿˜æœ‰ä¸¤ä¸ªç±»ä¼¼äºå£°æ˜ç¬¦çš„å‰ç¼€, ä½†æ˜¯ä½œç”¨äºé¢„å®šä¹‰å˜é‡:</p>
<table>
<thead>
<tr>
<th style="text-align:center">å‰ç¼€</th>
<th style="text-align:left">ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">temp</td>
<td style="text-align:left">åœ¨ä½œç”¨åŸŸçš„æœ€åæ¢å¤å˜é‡çš„å€¼</td>
</tr>
<tr>
<td style="text-align:center">let</td>
<td style="text-align:left">å¦‚æœ block æˆåŠŸé€€å‡ºå°±æ¢å¤å˜é‡çš„å€¼</td>
</tr>
</tbody>
</table>
<h3 id="my-å£°æ˜ç¬¦">my å£°æ˜ç¬¦</h3>
<p>ä½¿ç”¨ <code>my</code> å£°æ˜ä¸€ä¸ªå˜é‡ç»™å˜é‡ä¸€ä¸ªè¯æ³•ä½œç”¨åŸŸ. è¿™æ„å‘³ç€å˜é‡åªåœ¨å½“å‰å—ä¸­å­˜åœ¨.ä¾‹å¦‚:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">{</span>
    <span class="k">my</span> <span class="nv">$foo</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">bar</span><span class="p">&#34;;</span>
    <span class="nb">say</span> <span class="nv">$foo</span><span class="p">;</span> <span class="c1"># -&gt; &#34;bar&#34;</span>
<span class="p">}</span>
<span class="nb">say</span> <span class="nv">$foo</span><span class="p">;</span> <span class="c1"># !!! &#34;Variable &#39;$foo&#39; is not declared&#34;</span>
</code></pre></div><p>å®ƒæŠ›å‡ºå¼‚å¸¸,å› ä¸ºåªè¦æˆ‘ä»¬åœ¨åŒä¸€ä¸ªä½œç”¨åŸŸå†… <code>$foo</code> æ‰è¢«å®šä¹‰. æ­¤å¤–, è¯æ³•ä½œç”¨åŸŸæ„å‘³ç€å˜é‡èƒ½åœ¨æ–°çš„ä½œç”¨åŸŸå†…è¢«ä¸´æ—¶åœ°é‡æ–°å®šä¹‰:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$location</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">outside</span><span class="p">&#34;;</span>

<span class="k">sub</span> <span class="nf">outer-location</span> <span class="p">{</span>
    <span class="c1"># Not redefined:</span>
    <span class="nb">say</span> <span class="nv">$location</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">outer-location</span><span class="p">;</span> <span class="c1"># -&gt; &#34;outside&#34;</span>

<span class="k">sub</span> <span class="nf">in-building</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$location</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">inside</span><span class="p">&#34;;</span>
    <span class="nb">say</span> <span class="nv">$location</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">in-building</span><span class="p">;</span>    <span class="c1"># -&gt; &#34;inside&#34;</span>
<span class="n">outer-location</span><span class="p">;</span> <span class="c1"># -&gt; &#34;outside&#34;</span>
</code></pre></div><p>å¦‚æœå˜é‡è¢«é‡æ–°å®šä¹‰äº†, ä»»ä½•å¼•ç”¨å¤–éƒ¨å˜é‡çš„ä»£ç ä¼šç»§ç»­å¼•ç”¨å¤–éƒ¨å˜é‡.
æ‰€ä»¥, åœ¨è¿™å„¿, <code>&amp;outer-location</code> ä»ç„¶æ‰“å°å¤–éƒ¨çš„ <code>$location</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">new-location</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$location</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">nowhere</span><span class="p">&#34;</span>
    <span class="n">outer-location</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">new-location</span><span class="p">;</span> <span class="c1"># -&gt; &#34;outside&#34;</span>
</code></pre></div><p>ä¸ºäº†è®© <code>new-location()</code> èƒ½æ‰“å° <code>nowwhere</code>, éœ€è¦ä½¿ç”¨ <code>*</code> <a href="https://docs.raku.org/language/variables#The_%2A_Twigil">twigil</a> è®© <code>$location</code> å˜ä¸ºåŠ¨æ€å˜é‡.
å¯¹äºå­ä¾‹ç¨‹æ¥è¯´, <code>my</code> æ˜¯é»˜è®¤ä½œç”¨åŸŸ, æ‰€ä»¥ <code>my sub x( ) { }</code> å’Œ <code>sub x( ) { }</code> æ˜¯ä¸€æ ·çš„.</p>
<h3 id="our-å£°æ˜ç¬¦">our å£°æ˜ç¬¦</h3>
<p>our è·Ÿ <code>my</code> çš„ä½œç”¨ç±»ä¼¼, é™¤äº†æŠŠåˆ«åå¼•å…¥åˆ°ç¬¦å·è¡¨ä¹‹å¤–:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">module</span> <span class="nn">M</span> <span class="p">{</span>
    <span class="k">our</span> <span class="nv">$Var</span><span class="p">;</span>
    <span class="c1"># $Var available here</span>
<span class="p">}</span>

<span class="c1"># Available as $M::Var here.</span>
</code></pre></div><h3 id="å£°æ˜ä¸€ç»„å˜é‡">å£°æ˜ä¸€ç»„å˜é‡</h3>
<p>å£°æ˜ç¬¦ <code>my</code> å’Œ <code>our</code> æ¥æ”¶ä¸€ç»„æ‰©åœ¨åœ†æ‹¬å·ä¸­çš„å˜é‡ä½œä¸ºå‚æ•°æ¥ä¸€æ¬¡æ€§å£°æ˜å¤šä¸ªå˜é‡ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="p">(</span><span class="nv">@a</span><span class="o">,</span> <span class="nv">$s</span><span class="o">,</span> <span class="nv">%h</span><span class="p">);</span>
</code></pre></div><p>è¿™å¯ä»¥å’Œè§£æ„èµ‹å€¼ç»“åˆä½¿ç”¨ã€‚ä»»ä½•å¯¹è¿™æ ·ä¸€ä¸ªåˆ—è¡¨çš„èµ‹å€¼ä¼šå–å¾—å·¦ä¾§åˆ—è¡¨ä¸­æä¾›çš„å…ƒç´ æ•°é‡å¹¶ä¸”ä»å³ä¾§åˆ—è¡¨ä¸­æŠŠå¯¹åº”çš„å€¼èµ‹å€¼ç»™å®ƒä»¬ã€‚æ²¡æœ‰å¾—åˆ°èµ‹å€¼çš„å…ƒç´ ä¼šæ ¹æ®å˜é‡çš„ç±»å‹å¾—åˆ°ä¸€ä¸ªæœªå®šä¹‰å€¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="p">(</span><span class="nb">Str</span> <span class="nv">$a</span><span class="o">,</span> <span class="nb">Str</span> <span class="nv">$b</span><span class="o">,</span> <span class="nb">Int</span> <span class="nv">$c</span><span class="p">)</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">a b</span><span class="p">&gt;;</span>
<span class="nb">say</span> <span class="o">[</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="o">,</span> <span class="nv">$c</span><span class="o">].</span><span class="nb">perl</span><span class="p">;</span>
<span class="c1"># OUTPUTÂ«[&#34;a&#34;, &#34;b&#34;, Int]â¤Â»</span>
</code></pre></div><p>è¦æŠŠåˆ—è¡¨è§£æ„åˆ°ä¸€ä¸ªå•ä¸ªçš„å€¼ä¸­, é€šè¿‡ä½¿ç”¨ <code>($var,)</code> åˆ›å»ºä¸€ä¸ªå¸¦æœ‰ä¸€ä¸ªå€¼çš„åˆ—è¡¨å­—é¢å€¼ã€‚å½“ä½¿ç”¨äº†ä¸€ä¸ªå˜é‡å£°æ˜ç¬¦æ—¶åªåœ¨å•ä¸ªå˜é‡å‘¨å›´æä¾›ä¸€ä¸ªåœ†æ‹¬å·å°±è¶³å¤Ÿäº†ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">f</span> <span class="p">{</span> <span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span> <span class="p">};</span>
<span class="k">my</span> <span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="o">=</span> <span class="nb">f</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$a</span><span class="o">.</span><span class="nb">perl</span><span class="p">;</span>
<span class="c1"># OUTPUTÂ«1â¤Â»</span>
</code></pre></div><p>è¦è·³è¿‡åˆ—è¡¨ä¸­çš„å…ƒç´ , ä½¿ç”¨åŒ¿åçŠ¶æ€å˜é‡ <code>$</code>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="p">(</span><span class="nv">$</span><span class="o">,</span><span class="nv">$a</span><span class="o">,</span><span class="nv">$</span><span class="o">,</span><span class="nv">%h</span><span class="p">)</span> <span class="o">=</span> <span class="p">(&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">b</span><span class="p">&#39;</span><span class="o">,</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">],</span> <span class="p">{:</span><span class="s">1th</span><span class="p">});</span>
<span class="nb">say</span> <span class="o">[</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">%h</span><span class="o">].</span><span class="nb">perl</span><span class="p">;</span>
<span class="c1"># OUTPUTÂ«[&#34;b&#34;, {:th(1)}]â¤Â»</span>
</code></pre></div><h3 id="has-å£°æ˜ç¬¦">has å£°æ˜ç¬¦</h3>
<p><code>has</code> ä½œç”¨åœ¨ç±»çš„å®ä¾‹æˆ– role çš„å±æ€§ä¸Š, è¿˜æœ‰ç±»æˆ– roles çš„æ–¹æ³•ä¸Šã€‚has éšå¼ä½œç”¨äºæ–¹æ³•ä¸Š, æ‰€ä»¥ <code>has method x() {}</code> å’Œ <code>method x() {}</code> åšå¾—æ˜¯ç›¸åŒçš„äº‹æƒ…ã€‚</p>
<p>æŸ¥çœ‹<a href="https://docs.raku.org/language/objects">é¢å‘å¯¹è±¡</a>è·å–æ›´å¤šæ–‡æ¡£å’Œä¾‹å­ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">has</span> <span class="k">method</span> <span class="nb">x</span><span class="p">(</span> <span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
</code></pre></div><p>ç­‰ä»·äº:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">method</span> <span class="nb">x</span><span class="p">(</span> <span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
</code></pre></div><h3 id="anon-å£°æ˜ç¬¦">anon å£°æ˜ç¬¦</h3>
<p><code>anon</code> å£°æ˜ç¬¦é˜»æ­¢ç¬¦å·æœ¬å®‰è£…åœ¨è¯æ³•ä½œç”¨åŸŸå†…, è¿˜æœ‰æ–¹æ³•è¡¨ä¸­, å’Œå…¶å®ƒä»»ä½•åœ°æ–¹.
ä¾‹å¦‚, ä½ å¯ä»¥ä½¿ç”¨ <code>anon</code> å£°æ˜ä¸€ä¸ªçŸ¥é“è‡ªå·±åå­—çš„å­ä¾‹ç¨‹, ä½†æ˜¯ä»ç„¶ä¸ä¼šè¢«å®‰è£…åˆ°ä½œç”¨åŸŸå†…:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%operations</span> <span class="o">=</span>
    <span class="s">half</span>   <span class="o">=&gt;</span> <span class="k">anon</span> <span class="k">sub</span> <span class="nf">half</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span>   <span class="p">{</span> <span class="nv">$x</span> <span class="o">/</span> <span class="mi">2</span>  <span class="p">}</span>,
    <span class="s">square</span> <span class="o">=&gt;</span> <span class="k">anon</span> <span class="k">sub</span> <span class="nf">square</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$x</span> <span class="o">*</span> <span class="nv">$x</span> <span class="p">}</span>,
    <span class="p">;</span>
<span class="nb">say</span> <span class="nv">%operations</span><span class="p">&lt;</span><span class="s">square</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">name</span><span class="p">;</span>       <span class="c1"># square</span>
<span class="nb">say</span> <span class="nv">%operations</span><span class="p">&lt;</span><span class="s">square</span><span class="p">&gt;(</span><span class="mi">8</span><span class="p">);</span>         <span class="c1"># 64</span>
</code></pre></div><h3 id="state-å£°æ˜ç¬¦">state å£°æ˜ç¬¦</h3>
<p><code>state</code> å£°æ˜è¯æ³•ä½œç”¨åŸŸå˜é‡, å°±åƒ my é‚£æ ·ã€‚ç„¶è€Œ, <strong>åˆå§‹åŒ–åªå‘ç”Ÿä¸€æ¬¡</strong>, å°±åœ¨æ­£å¸¸æ‰§è¡Œæµä¸­ç¬¬ä¸€æ¬¡é‡è§åˆå§‹åŒ–çš„æ—¶å€™ã€‚å› æ­¤, state å˜é‡ä¼šåœ¨é—­åˆå—æˆ– ç¨‹åºçš„å¤šæ¬¡æ‰§è¡Œ<strong>ä¹‹é—´</strong>ä¿ç•™å®ƒä»¬çš„å€¼ã€‚</p>
<p>å› æ­¤, ä¸‹é¢è¿™ä¸ªå­ä¾‹ç¨‹:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">a</span> <span class="p">{</span>
    <span class="k">state</span> <span class="nv">@x</span><span class="p">;</span>
    <span class="k">state</span> <span class="nv">$l</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">A</span><span class="p">&#39;;</span>
    <span class="nv">@x</span><span class="o">.</span><span class="nb">push</span><span class="p">(</span><span class="nv">$l</span><span class="o">++</span><span class="p">);</span>
<span class="p">};</span>

<span class="nb">say</span> <span class="n">a</span> <span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="mi">6</span><span class="p">;</span>
</code></pre></div><p>ä¼šæŒç»­å¢åŠ  <code>$l</code> å¹¶åœ¨æ¯æ¬¡è¢«è°ƒç”¨æ—¶æŠŠå®ƒè¿½åŠ åˆ° <code>@x</code> ä¸­, æ‰€ä»¥å®ƒä¼šæ‰“å°å‡º:</p>
<pre><code>[A]
[A B]
[A B C]
[A B C D]
[A B C D E]
[A B C D E F]
</code></pre><p>This works per &ldquo;clone&rdquo; of the containing code object, as in this example:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">({</span> <span class="k">state</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nv">$i</span><span class="o">++.</span><span class="nb">say</span><span class="p">;</span> <span class="p">}</span> <span class="ow">xx</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="nb">map</span><span class="o">:</span> <span class="p">{</span><span class="nv">$_</span><span class="p">()</span><span class="o">,</span> <span class="nv">$_</span><span class="p">()};</span> <span class="c1"># says 1 then 2 thrice</span>
</code></pre></div><p>æ³¨æ„ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„è§£æ„, å½“åŒä¸€ä¸ª block çš„åŒä¸€ä¸ªå…‹éš†è¿è¡Œåœ¨å¤šä¸ªçº¿ç¨‹ä¸­æ—¶ã€‚è¦çŸ¥é“æ–¹æ³•åªæœ‰æ¯ä¸ªç±»ä¸€ä¸ªå…‹éš†ï¼Œè€Œä¸æ˜¯æ¯ä¸ªå¯¹è±¡ã€‚</p>
<p>è‡³äº <code>my</code>ï¼Œå£°æ˜å¤šä¸ªçŠ¶æ€å˜é‡å¿…é¡»æ”¾ç½®åœ¨åœ†æ‹¬å·ä¸­, è€Œå£°æ˜ä¸€ä¸ªå•ä¸€å˜é‡ï¼Œåœ†æ‹¬å·å¯ä»¥çœç•¥ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œè®¸å¤šæ“ä½œç¬¦éƒ½ä¼´éšç€éšå¼ç»‘å®šï¼Œä»€ä¹ˆä¼šå¯¼è‡´è¶…è·ä½œç”¨ã€‚ä½¿ç”¨ <code>.clone</code> æˆ–å¼ºè¿«åˆ›å»ºä¸€ä¸ªå¯ä»¥ç»‘å®šçš„æ–°å®¹å™¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@a</span><span class="p">;</span>
<span class="k">sub</span> <span class="nb">f</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">state</span> <span class="nv">$i</span><span class="p">;</span>
    <span class="nv">$i</span><span class="o">++</span><span class="p">;</span>
    <span class="nv">@a</span><span class="o">.</span><span class="nb">push</span><span class="o">:</span> <span class="p">&#34;</span><span class="s2">k</span><span class="nv">$i</span><span class="p">&#34;</span> <span class="o">=&gt;</span> <span class="nv">$i</span> <span class="c1"># &lt;-- .clone goes here</span>
<span class="p">};</span>
<span class="nb">f</span> <span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="mi">3</span><span class="p">;</span>
<span class="n">dd</span> <span class="nv">@a</span><span class="p">;</span> <span class="c1"># Â«Array $var = $[:k1(3), :k2(3), :k3(3)]Â»</span>
</code></pre></div><p>æ‰€æœ‰çš„çŠ¶æ€å˜é‡éƒ½æ˜¯çº¿ç¨‹é—´å…±äº«çš„ã€‚è¿™ä¸ªç»“æœå¯èƒ½æ˜¯ä½ ä¸å¸Œæœ›å¾—åˆ°çš„æˆ–å±é™©çš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">code</span><span class="p">(){</span> <span class="k">state</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nb">say</span> <span class="o">++</span><span class="nv">$i</span><span class="p">;</span> <span class="nv">$i</span> <span class="p">};</span>
<span class="nb">await</span>
    <span class="k">start</span> <span class="p">{</span> <span class="k">loop</span> <span class="p">{</span> <span class="nb">last</span> <span class="k">if</span> <span class="nb">code</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">5</span> <span class="p">}</span> <span class="p">}</span><span class="o">,</span>
    <span class="k">start</span> <span class="p">{</span> <span class="k">loop</span> <span class="p">{</span> <span class="nb">last</span> <span class="k">if</span> <span class="nb">code</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">5</span> <span class="p">}</span> <span class="p">};</span>

<span class="c1"># OUTPUTÂ«1â¤2â¤3â¤4â¤4â¤3â¤5â¤Â»</span>
<span class="c1"># OUTPUTÂ«2â¤1â¤3â¤4â¤5â¤Â»</span>
<span class="c1"># many other more or less odd variations can be produced</span>
</code></pre></div><h3 id="-å˜é‡">$ å˜é‡</h3>
<p>å’Œæ˜¾å¼åœ°å£°æ˜å‘½åçŠ¶æ€å˜é‡ä¸€æ ·, <code>$</code> èƒ½å¤Ÿç”¨ä½œä¸å¸¦æ˜¾å¼çŠ¶æ€å£°æ˜çš„åŒ¿åçŠ¶æ€å˜é‡ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">1-a 2-b 3-c</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">subst</span><span class="p">(:</span><span class="s">g</span><span class="o">,</span> <span class="p">/</span><span class="se">\d</span><span class="p">/</span><span class="o">,</span> <span class="p">{&lt;</span><span class="s">one two three</span><span class="p">&gt;</span><span class="o">[</span><span class="nv">$</span><span class="o">++]</span><span class="p">});</span>
<span class="c1"># OUTPUTÂ«one-a two-b three-câ¤Â»</span>
</code></pre></div><p>æ›´è¿›ä¸€æ­¥, çŠ¶æ€å˜é‡ä¸éœ€è¦å­˜åœ¨äºå­ä¾‹ç¨‹ä¸­ã€‚ä½ å¯ä»¥, ä¸¾ä¸ªä¾‹å­, åœ¨å•è¡Œç¨‹åºä¸­ä½¿ç”¨ <code>$</code> åœ¨æ–‡ä»¶ä¸­ç¼–å·è¡Œå·ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">raku</span> <span class="o">-</span><span class="ow">ne</span> <span class="p">&#39;</span><span class="s1">say ++$ ~ &#34; $_&#34;</span><span class="p">&#39;</span> <span class="n">example</span><span class="o">.</span><span class="nf">txt</span>
</code></pre></div><p>å®é™…ä¸Šè¯æ³•èŒƒå›´å†…æ¯ä¸ªå¯¹ <code>$</code> çš„å¼•ç”¨éƒ½æ˜¯æ˜¯ä¸€ä¸ª<strong>å•ç‹¬çš„</strong>å˜é‡ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">raku</span> <span class="o">-</span><span class="no">e</span> <span class="p">&#39;</span><span class="s1">{ say ++$; say $++  } for ^5</span><span class="p">&#39;</span>
<span class="c1"># OUTPUTÂ«1â¤0â¤2â¤1â¤3â¤2â¤4â¤3â¤5â¤4â¤Â»</span>
</code></pre></div><p>å¦‚æœåœ¨ä½œç”¨åŸŸå†…ä½ éœ€è¦å¤šæ¬¡å¼•ç”¨ <code>$</code> çš„å€¼, é‚£ä¹ˆå®ƒåº”è¯¥è¢«æ‹·è´åˆ°ä¸€ä¸ªæ–°çš„å˜é‡ä¸­ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">given</span> <span class="o">++</span><span class="nv">$</span> <span class="p">{</span>
        <span class="k">when</span> <span class="mi">1</span> <span class="p">{</span>
            <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">one</span><span class="p">&#34;;</span>
        <span class="p">}</span>
        <span class="k">when</span> <span class="mi">2</span> <span class="p">{</span>
            <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">two</span><span class="p">&#34;;</span>
        <span class="p">}</span>
        <span class="k">when</span> <span class="mi">3</span> <span class="p">{</span>
            <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">three</span><span class="p">&#34;;</span>
        <span class="p">}</span>
        <span class="k">default</span> <span class="p">{</span>
            <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">many</span><span class="p">&#34;;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nf">foo</span><span class="p">()</span> <span class="k">for</span> <span class="o">^</span><span class="mi">3</span><span class="p">;</span>
<span class="c1"># OUTPUTÂ«oneâ¤twoâ¤threeâ¤Â»</span>
</code></pre></div><h3 id="-å˜é‡-1">@ å˜é‡</h3>
<p>å’Œ <code>$</code> å˜é‡ç±»ä¼¼, ä¹Ÿæœ‰ä¸€ä¸ªä½ç½®åŒ¿åçŠ¶æ€å˜é‡ <code>@</code>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">(</span><span class="nv">@</span><span class="p">)</span><span class="o">.</span><span class="nb">push</span><span class="p">(</span><span class="nv">$x</span><span class="p">);</span>
<span class="p">}</span>

<span class="nf">foo</span><span class="p">(</span><span class="nv">$_</span><span class="p">)</span> <span class="k">for</span> <span class="o">^</span><span class="mi">3</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># [0]</span>
<span class="c1"># [0 1]</span>
<span class="c1"># [0 1 2]</span>
</code></pre></div><p>è¿™é‡Œçš„ <code>@</code> æ˜¯ç”¨åœ†æ‹¬å·æ‹¬èµ·æ¥äº†ä»¥å’Œåä¸º <code>@.push</code> çš„ç±»æˆå‘˜å˜é‡æ¶ˆé™¤æ­§ä¹‰ã€‚ç´¢å¼•è®¿é—®å¹¶ä¸éœ€è¦è¿™ç§æ­§ä¹‰ï¼Œä½†ä½ éœ€è¦æ‹·è´è¿™ä¸ªå€¼ï¼Œä»¥ä¾¿ç”¨å®ƒåšä»»ä½•æœ‰ç”¨çš„äº‹æƒ…ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$v</span> <span class="o">=</span> <span class="nv">@</span><span class="p">;</span>
    <span class="nv">$v</span><span class="o">[</span><span class="nv">$x</span><span class="o">]</span> <span class="o">=</span> <span class="nv">$x</span><span class="p">;</span>
    <span class="nb">say</span> <span class="nv">$v</span><span class="p">;</span>
<span class="p">}</span>

<span class="nf">foo</span><span class="p">(</span><span class="nv">$_</span><span class="p">)</span> <span class="k">for</span> <span class="o">^</span><span class="mi">3</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># [0]</span>
<span class="c1"># [0 1]</span>
<span class="c1"># [0 1 2]</span>
</code></pre></div><p>å°±å’Œ <code>$</code> ä¸€æ ·, ä½œç”¨åŸŸä¸­çš„æ¯æ¬¡æåŠ <code>@</code> å°±å¼•å…¥äº†ä¸€ä¸ªæ–°çš„åŒ¿åæ•°ç»„ã€‚</p>
<h3 id="-å˜é‡-2">% å˜é‡</h3>
<p>æœ€å, è¿˜æœ‰ä¸€ä¸ªå…³è”åŒ¿åçŠ¶æ€å˜é‡ <code>%</code>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">(</span><span class="nv">%</span><span class="p">)</span><span class="o">.</span><span class="nb">push</span><span class="p">(</span><span class="nv">$x</span> <span class="o">=&gt;</span> <span class="nv">$x</span><span class="p">);</span>
<span class="p">}</span>

<span class="nf">foo</span><span class="p">(</span><span class="nv">$_</span><span class="p">)</span> <span class="k">for</span> <span class="o">^</span><span class="mi">3</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># 0 =&gt; 0</span>
<span class="c1"># 0 =&gt; 0, 1 =&gt; 1</span>
<span class="c1"># 0 =&gt; 0, 1 =&gt; 1, 2 =&gt; 2</span>
</code></pre></div><p>å…³äºæ­§ä¹‰çš„åŒæ ·è­¦å‘Šé€‚ç”¨ã€‚æ­£å¦‚ä½ å¯èƒ½æœŸæœ›ï¼Œç´¢å¼•è®¿é—®ä¹Ÿæœ‰å¯èƒ½ï¼ˆä½¿ç”¨å¤åˆ¶ä»¥ä½¿ä¹‹æœ‰ç”¨ï¼‰ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$v</span> <span class="o">=</span> <span class="nv">%</span><span class="p">;</span>
    <span class="nv">$v</span><span class="p">{</span><span class="nv">$x</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$x</span><span class="p">;</span>
    <span class="nb">say</span> <span class="nv">$v</span><span class="p">;</span>
<span class="p">}</span>

<span class="nf">foo</span><span class="p">(</span><span class="nv">$_</span><span class="p">)</span> <span class="k">for</span> <span class="o">^</span><span class="mi">3</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># 0 =&gt; 0</span>
<span class="c1"># 0 =&gt; 0, 1 =&gt; 1</span>
<span class="c1"># 0 =&gt; 0, 1 =&gt; 1, 2 =&gt; 2</span>
</code></pre></div><p>å°±åƒå…¶å®ƒçš„åŒ¿åçŠ¶æ€å˜é‡ä¸€æ ·, åœ¨ç»™å®šä½œç”¨åŸŸä¸­æ¯æ¬¡æåŠ <code>%</code> æœ€ç»ˆéƒ½ä¼šå¼•å…¥ä¸€ä¸ªå•ç‹¬çš„å˜é‡ã€‚</p>
<h3 id="augment-å£°æ˜ç¬¦">augment å£°æ˜ç¬¦</h3>
<p>ä½¿ç”¨ <code>augment</code>, ä½ å¯ä»¥ç»™å·²ç»å­˜åœ¨çš„ç±»æˆ– grammars å¢åŠ å±æ€§å’Œæ–¹æ³•.</p>
<p>å› ä¸ºç±»é€šå¸¸ä½¿ç”¨ our ä½œç”¨åŸŸ, å› æ­¤æ˜¯å…¨å±€çš„, è¿™æ„å‘³ç€ä¿®æ”¹å…¨å±€çŠ¶æ€, è¿™æ˜¯å¼ºçƒˆä¸é¼“åŠ±çš„, å¯¹äºå¤§éƒ¨åˆ†æƒ…å†µ, æœ‰æ›´å¥½çš„æ–¹æ³•.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># don&#39;t do this</span>
<span class="k">use</span> <span class="nb">MONKEY-TYPING</span><span class="p">;</span>

<span class="k">augment</span> <span class="k">class</span> <span class="nb">Int</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">is-answer</span> <span class="p">{</span> <span class="nb">self</span> <span class="o">==</span> <span class="mi">42</span> <span class="p">}</span>
<span class="p">}</span>
<span class="nb">say</span> <span class="mi">42</span><span class="o">.</span><span class="nf">is-answer</span><span class="p">;</span>       <span class="c1"># True</span>
</code></pre></div><h3 id="temp-å‰ç¼€">temp å‰ç¼€</h3>
<p>åƒ my ä¸€æ ·, temp åœ¨ä½œç”¨åŸŸçš„æœ«å°¾æ¢å¤æ—§çš„å˜é‡å€¼. ç„¶è€Œ, temp ä¸åˆ›å»ºæ–°çš„å˜é‡.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$in</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1"># temp will &#34;entangle&#34; the global variable with the call stack</span>
            <span class="c1"># that keeps the calls at the bottom in order.</span>

<span class="k">sub</span> <span class="nb">f</span><span class="p">(</span><span class="o">*</span><span class="nv">@c</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">(</span><span class="k">temp</span> <span class="nv">$in</span><span class="p">)</span><span class="o">++</span><span class="p">;</span>
     <span class="p">&#34;</span><span class="s2">&lt;f&gt;\n</span><span class="p">&#34;</span>
     <span class="o">~</span> <span class="nv">@c</span><span class="o">&gt;&gt;.</span><span class="nb">indent</span><span class="p">(</span><span class="nv">$in</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#34;</span><span class="s2">\n</span><span class="p">&#34;)</span>
     <span class="o">~</span> <span class="p">(</span><span class="o">+</span><span class="nv">@c</span> <span class="o">??</span> <span class="p">&#34;</span><span class="s2">\n</span><span class="p">&#34;</span> <span class="o">!!</span> <span class="p">&#34;&#34;)</span>
     <span class="o">~</span> <span class="p">&#39;</span><span class="s1">&lt;/f&gt;</span><span class="p">&#39;</span>
<span class="p">};</span>

<span class="k">sub</span> <span class="nf">g</span><span class="p">(</span><span class="o">*</span><span class="nv">@c</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">(</span><span class="k">temp</span> <span class="nv">$in</span><span class="p">)</span><span class="o">++</span><span class="p">;</span>
    <span class="p">&#34;</span><span class="s2">&lt;g&gt;\n</span><span class="p">&#34;</span>
    <span class="o">~</span> <span class="nv">@c</span><span class="o">&gt;&gt;.</span><span class="nb">indent</span><span class="p">(</span><span class="nv">$in</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#34;</span><span class="s2">\n</span><span class="p">&#34;)</span>
    <span class="o">~</span> <span class="p">(</span><span class="o">+</span><span class="nv">@c</span> <span class="o">??</span> <span class="p">&#34;</span><span class="s2">\n</span><span class="p">&#34;</span> <span class="o">!!</span> <span class="p">&#34;&#34;)</span>
    <span class="o">~</span> <span class="p">&#34;</span><span class="s2">&lt;/g&gt;</span><span class="p">&#34;</span>
<span class="p">};</span>

<span class="nb">print</span> <span class="nf">g</span><span class="p">(</span><span class="nf">g</span><span class="p">(</span><span class="nb">f</span><span class="p">(</span><span class="nf">g</span><span class="p">())</span><span class="o">,</span> <span class="nf">g</span><span class="p">()</span><span class="o">,</span> <span class="nb">f</span><span class="p">()));</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># &lt;g&gt;</span>
<span class="c1">#  &lt;g&gt;</span>
<span class="c1">#   &lt;f&gt;</span>
<span class="c1">#    &lt;g&gt;</span>
<span class="c1">#    &lt;/g&gt;</span>
<span class="c1">#   &lt;/f&gt;</span>
<span class="c1">#   &lt;g&gt;</span>
<span class="c1">#   &lt;/g&gt;</span>
<span class="c1">#   &lt;f&gt;</span>
<span class="c1">#   &lt;/f&gt;</span>
<span class="c1">#  &lt;/g&gt;</span>
<span class="c1"># &lt;/g&gt;</span>
</code></pre></div><h3 id="let-å‰ç¼€">let å‰ç¼€</h3>
<p>è·Ÿ temp ç±»ä¼¼, å¦‚æœ block æ²¡æœ‰æˆåŠŸé€€å‡ºåˆ™æ¢å¤ä¹‹å‰çš„å€¼ã€‚æˆåŠŸçš„é€€å‡ºæ„å‘³ç€è¯¥ block è¿”å›äº†ä¸€ä¸ªå®šä¹‰è¿‡çš„å€¼æˆ–ä¸€ä¸ªåˆ—è¡¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$answer</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>

<span class="p">{</span>
    <span class="k">let</span> <span class="nv">$answer</span> <span class="o">=</span> <span class="mi">84</span><span class="p">;</span>
    <span class="nb">die</span> <span class="k">if</span> <span class="nb">not</span> <span class="nb">Bool</span><span class="o">.</span><span class="nb">pick</span><span class="p">;</span>
    <span class="k">CATCH</span> <span class="p">{</span>
        <span class="k">default</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">it&#39;s been reset :(</span><span class="p">&#34;</span> <span class="p">}</span>
    <span class="p">}</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">we made it 84 sticks!</span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="nv">$answer</span><span class="p">;</span>
</code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, å¦‚æœ <code>Bool.pick</code> è¿”å› true, é‚£ä¹ˆç­”æ¡ˆä¼šä¿æŒä¸º 84, å› ä¸ºé‚£ä¸ª block è¿”å›äº†ä¸€ä¸ªå®šä¹‰äº†çš„å€¼(say è¿”å› true)ã€‚
å¦åˆ™é‚£ä¸ª <code>die</code> è¯­å¥ä¼šè®©é‚£ä¸ª block ä¸æˆåŠŸåœ°é€€å‡º, æŠŠç­”æ¡ˆé‡æ–°è®¾ç½®ä¸º 42ã€‚</p>
<h2 id="ç±»å‹çº¦æŸå’Œåˆå§‹åŒ–">ç±»å‹çº¦æŸå’Œåˆå§‹åŒ–</h2>
<p>å˜é‡å¯ä»¥æœ‰ç±»å‹çº¦æŸ, çº¦æŸåœ¨å£°æ˜ç¬¦å’Œå˜é‡åä¹‹é—´:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nb">Int</span> <span class="nv">$x</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
<span class="nv">$x</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">a string</span><span class="p">&#39;;</span> <span class="c1"># throws an X::TypeCheck::Assignment error</span>
<span class="k">CATCH</span> <span class="p">{</span> <span class="k">default</span> <span class="p">{</span> <span class="nb">put</span> <span class="o">.^</span><span class="nb">name</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">: </span><span class="p">&#39;</span><span class="o">,</span> <span class="o">.</span><span class="nb">Str</span> <span class="p">}</span> <span class="p">}</span>
<span class="c1"># OUTPUT: X::TypeCheck::Assignment: Type check failed in assignment to $x; expected Int but got Str (&#34;a string&#34;)</span>
</code></pre></div><p>å¦‚æœä¸€ä¸ªæ ‡é‡æœ‰ç±»å‹çº¦æŸä½†æ˜¯æ²¡æœ‰åˆå§‹å€¼, å®ƒä¼šä½¿ç”¨ç±»å‹çº¦æŸçš„ç±»å‹å¯¹è±¡æ¥åˆå§‹åŒ–.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nb">Int</span> <span class="nv">$x</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$x</span><span class="o">.^</span><span class="nb">name</span><span class="p">;</span>    <span class="c1"># Int</span>
<span class="nb">say</span> <span class="nv">$x</span><span class="o">.</span><span class="nb">defined</span><span class="p">;</span>  <span class="c1"># False</span>
</code></pre></div><p>æ²¡æœ‰æ˜¾å¼ç±»å‹çº¦æŸçš„æ ‡é‡çš„ç±»å‹ä¸º Mu, ä½†æ˜¯é»˜è®¤ä¼šæ˜¯ Any ç±»å‹çš„å¯¹è±¡.</p>
<p>å¸¦æœ‰ @ ç¬¦å·çš„å˜é‡ä¼šè¢«åˆå§‹åŒ–ä¸ºç©ºçš„æ•°ç»„; å¸¦æœ‰ % ç¬¦å·çš„å˜é‡ä¼šè¢«åˆå§‹åŒ–ä¸ºç©ºçš„æ•£åˆ—.</p>
<p>å˜é‡çš„é»˜è®¤å€¼å¯ä»¥ä½¿ç”¨ <code>is default</code> ç‰¹æ€§è®¾ç½®, é€šè¿‡æŠŠ Nil èµ‹å€¼ç»™å˜é‡æ¥é‡æ–°åº”ç”¨é»˜è®¤å€¼:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nb">Real</span> <span class="nv">$product</span> <span class="k">is</span> <span class="k">default</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">say</span> <span class="nv">$product</span><span class="p">;</span>                       <span class="c1"># 1</span>
<span class="nv">$produce</span> <span class="o">*=</span> <span class="mi">5</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$product</span><span class="p">;</span>                       <span class="c1"># 5</span>
<span class="nv">$product</span> <span class="o">=</span> <span class="nb">Nil</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$product</span><span class="p">;</span>                       <span class="c1"># 1</span>
</code></pre></div><h2 id="é»˜è®¤çš„æœ‰å®šä¹‰çš„å˜é‡æŒ‡ä»¤">é»˜è®¤çš„æœ‰å®šä¹‰çš„å˜é‡æŒ‡ä»¤</h2>
<p>ä¸ºäº†å¼ºåˆ¶æ‰€æœ‰çš„å˜é‡æ‹¥æœ‰ä¸€ä¸ªæœ‰å®šä¹‰çš„çº¦æŸ, ä½¿ç”¨ <code>use variables :D</code> æŒ‡ä»¤ã€‚è¿™ä¸ªæŒ‡ä»¤æ˜¯è¯æ³•ä½œç”¨åŸŸçš„å¹¶ä¸”å¯ä»¥ä½¿ç”¨ <code>use variables :_</code> æŒ‡ä»¤è¿›è¡Œåˆ‡æ¢ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">use</span> <span class="nb">variables</span> <span class="p">:</span><span class="s">D</span><span class="p">;</span>
<span class="k">my</span> <span class="nb">Int</span> <span class="nv">$i</span><span class="p">;</span>
<span class="c1"># OUTPUTÂ«===SORRY!=== Error while compiling &lt;tmp&gt;â¤Variable definition of type Int:D (implicit :D by pragma) requires an initializer ...</span>
<span class="k">my</span> <span class="nb">Int</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1"># that works</span>
<span class="p">{</span> <span class="k">use</span> <span class="nb">variables</span> <span class="p">:</span><span class="s">_</span><span class="p">;</span> <span class="k">my</span> <span class="nb">Int</span> <span class="nv">$i</span><span class="p">;</span> <span class="p">}</span> <span class="c1"># åœ¨è¿™ä¸ª block ä¸­å…³æ‰å®ƒ</span>
</code></pre></div><p>è¯·æ³¨æ„, èµ‹å€¼ Nil ä¼šæŠŠè¿™ä¸ªå˜é‡æ¢å¤ä¸ºå®ƒçš„é»˜è®¤å€¼ã€‚ä¸€ä¸ªæœ‰å®šä¹‰çš„çº¦æŸç±»å‹çš„é»˜è®¤å€¼æ˜¯ç±»å‹ååŠ ä¸Š <code>:D</code>(ä¾‹å¦‚ <code>Int:D</code>)ã€‚That means a definedness contraint is no guarantee of definedness. è¿™åªé€‚ç”¨äºå˜é‡åˆå§‹åŒ–, ä¸é€‚ç”¨äºç­¾åã€‚</p>
<h2 id="ç‰¹æ®Šå˜é‡">ç‰¹æ®Šå˜é‡</h2>
<p><strong>Pre-defined lexical variables</strong></p>
<p>æ¯ä¸ªä»£ç å—ä¸­éƒ½æœ‰3ä¸ªç‰¹åˆ«çš„å˜é‡:</p>
<table>
<thead>
<tr>
<th style="text-align:center">å˜é‡</th>
<th style="text-align:left">æ„ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$_</td>
<td style="text-align:left">ç‰¹æ®Šå˜é‡</td>
</tr>
<tr>
<td style="text-align:center">$/</td>
<td style="text-align:left">æ­£åˆ™åŒ¹é…</td>
</tr>
<tr>
<td style="text-align:center">$!</td>
<td style="text-align:left">å¼‚å¸¸</td>
</tr>
</tbody>
</table>
<h3 id="_">$_</h3>
<p><code>$_</code> æ˜¯ç‰¹æ®Šå˜é‡ï¼Œåœ¨æ²¡æœ‰æ˜¾å¼æ ‡è¯†çš„ä»£ç å—ä¸­ï¼Œå®ƒæ˜¯é»˜è®¤å‚æ•°ã€‚æ‰€ä»¥è¯¸å¦‚ <code>for @array { ... }</code> å’Œ <code>given $var { ... }</code> ä¹‹ç±»çš„ç»“æ„ä¼šå°†å˜é‡ç»‘å®šç»™ <code>$_</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;</span> <span class="p">{</span> <span class="nb">say</span> <span class="nv">$_</span> <span class="p">}</span>  <span class="c1"># sets $_ to &#39;a&#39;, &#39;b&#39; and &#39;c&#39; in turn</span>
<span class="nb">say</span> <span class="nv">$_</span> <span class="k">for</span> <span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;;</span>     <span class="c1"># same, even though it&#39;s not a block</span>
<span class="k">given</span> <span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;</span>   <span class="p">{</span> <span class="nb">say</span> <span class="nv">$_</span> <span class="p">}</span>  <span class="c1"># sets $_ to &#39;a&#39;</span>
<span class="nb">say</span> <span class="nv">$_</span> <span class="k">given</span> <span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;;</span>       <span class="c1"># same, å°½ç®¡è¿™ä¸æ˜¯ä¸€ä¸ªå—</span>
</code></pre></div><p>CATCH å—å°† <code>$_</code> è®¾ç½®ä¸ºæ•è·åˆ°çš„å¼‚å¸¸ã€‚ <code>~~</code> æ™ºèƒ½åŒ¹é…æ“ä½œç¬¦ã€‚
å¯¹ <code>$_</code> è°ƒç”¨ä¸€ä¸ªæ–¹æ³•å¯ä»¥çœç•¥ç‰¹æ®Šå˜é‡ <code>$_</code> çš„åå­—ï¼Œä»è€Œå†™çš„æ›´çŸ­ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">.</span><span class="nb">say</span><span class="p">;</span>                   <span class="c1"># ä¸ $_.say ç›¸åŒ</span>
</code></pre></div><p><code>m/regex/</code> å’Œ <code>/regex/</code> æ­£åˆ™åŒ¹é… å’Œ <code>s/regex/subst/</code> æ›¿æ¢æ˜¯ä½œç”¨äº <code>$_</code> ä¸Šçš„.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Looking for strings with non-alphabetic characters...</span><span class="p">&#34;;</span>

<span class="k">for</span> <span class="p">&lt;</span><span class="s">ab:c d$e fgh ij*</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="o">.</span><span class="nb">say</span> <span class="k">if</span> <span class="k">m</span><span class="p">/&lt;</span><span class="o">!</span><span class="nb">alpha</span><span class="p">&gt;/;</span>
<span class="p">}</span>
</code></pre></div><p>è¾“å‡º:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="n">Looking</span> <span class="k">for</span> <span class="n">strings</span> <span class="k">with</span> <span class="n">non-alphabetic</span> <span class="n">characters</span><span class="o">...</span>
<span class="n">ab:c</span>
<span class="nb">d</span><span class="nv">$e</span>
<span class="n">ij</span><span class="o">*</span>
</code></pre></div><h3 id="heading">$/</h3>
<p><code>$/</code> æ˜¯åŒ¹é…å˜é‡ã€‚å®ƒå­˜å‚¨ç€æœ€è¿‘ä¸€æ¬¡<a href="https://docs.raku.org/language/regexes">æ­£åˆ™</a>åŒ¹é…çš„ç»“æœï¼Œé€šå¸¸åŒ…å« <a href="https://docs.raku.org/type/Match">Match</a> ç±»å‹çš„å¯¹è±¡ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">&#39;</span><span class="s1">abc 12</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="p">/</span><span class="se">\w</span><span class="o">+</span><span class="p">/;</span>  <span class="c1"># è®¾ç½® $/ ä¸ºä¸€ä¸ªMatch å¯¹è±¡</span>
<span class="nb">say</span> <span class="nv">$/</span><span class="o">.</span><span class="nb">Str</span><span class="p">;</span>         <span class="c1"># abc</span>
</code></pre></div><p><code>Grammar.parse</code> æ–¹æ³•ä¼šæŠŠè°ƒç”¨è€…çš„ <code>$/</code> è®¾ç½®ä¸º <code>Match object</code> çš„ç»“æœã€‚çœ‹ä¸‹é¢çš„ä»£ç :</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">use</span> <span class="nn">XML::Grammar</span><span class="p">;</span> <span class="c1"># panda install XML</span>
<span class="n">XML</span><span class="o">.</span><span class="nb">Grammar</span><span class="o">.</span><span class="nb">parse</span><span class="p">(&#34;</span><span class="s2">&lt;p&gt;some text&lt;/p&gt;</span><span class="p">&#34;);</span>
<span class="nb">say</span> <span class="nv">$/</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># ï½¢&lt;p&gt;some text&lt;/p&gt;ï½£</span>
<span class="c1">#  root =&gt; ï½¢&lt;p&gt;some text&lt;/p&gt;ï½£</span>
<span class="c1">#   name =&gt; ï½¢pï½£</span>
<span class="c1">#   child =&gt; ï½¢some textï½£</span>
<span class="c1">#    text =&gt; ï½¢some textï½£</span>
<span class="c1">#    textnode =&gt; ï½¢some textï½£</span>
<span class="c1">#  element =&gt; ï½¢&lt;p&gt;some text&lt;/p&gt;ï½£</span>
<span class="c1">#   name =&gt; ï½¢pï½£</span>
<span class="c1">#   child =&gt; ï½¢some textï½£</span>
<span class="c1">#    text =&gt; ï½¢some textï½£</span>
<span class="c1">#    textnode =&gt; ï½¢some textï½£</span>
</code></pre></div><p>å…¶ä»–åŒ¹é…å˜é‡æ˜¯ <code>$/</code> å…ƒç´ çš„åˆ«åï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$0</span>          <span class="c1"># same as $/[0]</span>
<span class="nv">$1</span>          <span class="c1"># same as $/[1]</span>
<span class="nv">$&lt;named&gt;</span>    <span class="c1"># same as $/&lt;named&gt;</span>
</code></pre></div><h3 id="ä½ç½®å±æ€§">ä½ç½®å±æ€§</h3>
<p>å¦‚æœæ­£åˆ™ä¸­æœ‰æ•è·åˆ†ç»„, <code>$/</code> ä¸­ä¼šæœ‰ä½ç½®å±æ€§. å®ƒä»¬ç”±åœ†æ‹¬å·ç»„æˆ.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">&#39;</span><span class="s1">abbbbbcdddddeffg</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="p">/</span><span class="sr"> a </span><span class="p">(</span><span class="sr">b</span><span class="o">+</span><span class="p">)</span><span class="sr"> c </span><span class="p">(</span><span class="sr">d</span><span class="o">+</span><span class="sr">ef</span><span class="o">+</span><span class="p">)</span><span class="sr"> g </span><span class="p">/;</span>
<span class="nb">say</span> <span class="nv">$/</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span> <span class="c1"># ï½¢bbbbbï½£</span>
<span class="nb">say</span> <span class="nv">$/</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span> <span class="c1"># ï½¢dddddeffï½£</span>
</code></pre></div><p>è¿™äº›æ•è·åˆ†ç»„ä¹Ÿèƒ½ä½¿ç”¨ <code>$0</code>,<code>$1</code>,<code>$2</code> ç­‰ä¾¿æ·å½¢å¼å–å¾—:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nv">$0</span><span class="p">;</span> <span class="c1"># ï½¢bbbbbï½£</span>
<span class="nb">say</span> <span class="nv">$1</span><span class="p">;</span> <span class="c1"># ï½¢dddddeffï½£</span>
</code></pre></div><p>è¦è·å–æ‰€æœ‰çš„ä½ç½®å±æ€§, ä½¿ç”¨ <code>$/.list</code>, <code>@$/</code>,<code>@( )</code> ä¸­çš„ä»»æ„ä¸€ä¸ªéƒ½å¯ä»¥:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nv">@</span><span class="p">()</span><span class="o">.</span><span class="nb">join</span><span class="p">;</span> <span class="c1"># bbbbbdddddeff</span>
</code></pre></div><h3 id="å‘½åå±æ€§">å‘½åå±æ€§</h3>
<p>å¦‚æœæ­£åˆ™ä¸­æœ‰å‘½åæ•è·åˆ†ç»„, <code>$/</code> å¯ä»¥æœ‰å‘½åå±æ€§, æˆ–è€…æ­£åˆ™è°ƒç”¨äº†å¦ä¸€ä¸ªæ­£åˆ™:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">&#39;</span><span class="s1">I.... see?</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="p">/</span><span class="sr"> </span><span class="se">\w</span><span class="o">+</span><span class="sr"> </span><span class="nv">$&lt;punctuation&gt;</span><span class="o">=</span><span class="p">[</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">-</span><span class="p">[</span><span class="se">\w\s</span><span class="p">]&gt;</span><span class="o">+</span><span class="sr"> </span><span class="p">]</span><span class="sr"> </span><span class="se">\s</span><span class="o">*</span><span class="sr"> </span><span class="nv">$&lt;final-word&gt;</span><span class="sr"> </span><span class="o">=</span><span class="sr"> </span><span class="p">[</span><span class="sr"> </span><span class="se">\w</span><span class="o">+</span><span class="sr"> </span><span class="ni">.</span><span class="sr"> </span><span class="p">]</span><span class="sr"> </span><span class="p">/;</span>
<span class="nb">say</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">punctuation</span><span class="p">&gt;;</span> <span class="c1"># ï½¢....ï½£</span>
<span class="nb">say</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">final-word</span><span class="p">&gt;;</span>  <span class="c1"># ï½¢see?ï½£</span>
</code></pre></div><p>è¿™äº›å‘½åæ•è·åˆ†ç»„ä¹Ÿèƒ½ä½¿ç”¨ä¾¿æ·å½¢å¼çš„ <code>$&lt;named&gt;</code> è·å–:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nv">$&lt;punctuation&gt;</span><span class="p">;</span> <span class="c1"># ï½¢....ï½£</span>
<span class="nb">say</span> <span class="nv">$&lt;final-word&gt;</span><span class="p">;</span>  <span class="c1"># ï½¢see?ï½£</span>
</code></pre></div><p>è¦è·å–æ‰€æœ‰çš„å‘½åå±æ€§, ä½¿ç”¨ <code>$/.hash</code>,  <code>%$/</code>, <code>%()</code>ä¸­çš„ä»»ä½•ä¸€ä¸ª:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nv">%</span><span class="p">()</span><span class="o">.</span><span class="nb">join</span><span class="p">;</span>  <span class="c1"># &#34;punctuation     ....final-word  see?&#34;</span>
</code></pre></div><h3 id="-å˜é‡-3">$! å˜é‡</h3>
<p><code>$!</code> æ˜¯é”™è¯¯å˜é‡. å¦‚æœ <code>try</code> block æˆ–è¯­å¥å‰ç¼€æ•è·åˆ°å¼‚å¸¸, é‚£ä¸ªå¼‚å¸¸å°±ä¼šè¢«å­˜å‚¨åœ¨ <code>$!</code> ä¸­ã€‚å¦‚æœæ²¡æœ‰æ•è·åˆ°å¼‚å¸¸, é‚£ä¹ˆ <code>$!</code> ä¼šè¢«è®¾ç½®ä¸º Any ç±»å‹å¯¹è±¡ã€‚
æ³¨æ„, <code>CATCH</code> å—ä¸è®¾ç½® <code>$!</code>ã€‚CATCH åœ¨ block ä¸­æŠŠ <code>$_</code> è®¾ç½®ä¸ºæ•è·åˆ°çš„å¼‚å¸¸ã€‚</p>
<h2 id="ç¼–è¯‘æ—¶å˜é‡">ç¼–è¯‘æ—¶å˜é‡</h2>
<table>
<thead>
<tr>
<th style="text-align:center">Compile-time Variables</th>
<th style="text-align:left">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$?FILE</td>
<td style="text-align:left">æ‰€åœ¨æ–‡ä»¶</td>
</tr>
<tr>
<td style="text-align:center">$?LINE</td>
<td style="text-align:left">æ‰€åœ¨è¡Œ</td>
</tr>
<tr>
<td style="text-align:center">::?CLASS</td>
<td style="text-align:left">æ‰€åœ¨ç±»</td>
</tr>
<tr>
<td style="text-align:center">&amp;?ROUTINE</td>
<td style="text-align:left">æ‰€åœ¨å­ä¾‹ç¨‹</td>
</tr>
<tr>
<td style="text-align:center">&amp;?BLOCK</td>
<td style="text-align:left">æ‰€åœ¨å—</td>
</tr>
<tr>
<td style="text-align:center">%?LANG</td>
<td style="text-align:left">What is the current set of interwoven languages?</td>
</tr>
<tr>
<td style="text-align:center">%?RESOURCES</td>
<td style="text-align:left">The files associated with the &ldquo;Distribution&rdquo; of the current compilation unit.</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="p">&#39;</span><span class="s1">.</span><span class="p">&#39;</span> <span class="p">{</span>
    <span class="o">.</span><span class="nb">Str</span><span class="o">.</span><span class="nb">say</span> <span class="k">when</span> <span class="o">!.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">d</span><span class="p">;</span>
    <span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">dir</span><span class="p">()</span><span class="o">&gt;&gt;.</span><span class="nv">&amp;?BLOCK</span> <span class="k">when</span> <span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">d</span> <span class="c1"># lets recurse a little!</span>
<span class="p">}</span>
</code></pre></div><p>å…¶å®ƒç¼–è¯‘æ—¶å˜é‡ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:center">Compile-time Variables</th>
<th style="text-align:left">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$?PACKAGE</td>
<td style="text-align:left">æ‰€åœ¨åŒ…</td>
</tr>
<tr>
<td style="text-align:center">$?MODULE</td>
<td style="text-align:left">æ‰€åœ¨æ¨¡å—</td>
</tr>
<tr>
<td style="text-align:center">$?CLASS</td>
<td style="text-align:left">æ‰€åœ¨ç±»(as variable)</td>
</tr>
<tr>
<td style="text-align:center">$?ROLE</td>
<td style="text-align:left">æ‰€åœ¨è§’è‰²(as variable)</td>
</tr>
<tr>
<td style="text-align:center">$?GRAMMAR</td>
<td style="text-align:left">æ‰€åœ¨ grammar</td>
</tr>
<tr>
<td style="text-align:center">$?TABSTOP</td>
<td style="text-align:left">åœ¨ heredoc æˆ– è™šæ‹Ÿè¾¹è·ä¸­ tab æœ‰å¤šå°‘ç©ºæ ¼</td>
</tr>
<tr>
<td style="text-align:center">$?USAGE</td>
<td style="text-align:left">ä» MAIN ç¨‹åºçš„ç­¾åä¸­ç”Ÿæˆçš„ä½¿ç”¨ä¿¡æ¯</td>
</tr>
<tr>
<td style="text-align:center">$?ENC</td>
<td style="text-align:left">Str.encode/Buf.decode/various IO æ–¹æ³•çš„é»˜è®¤ç¼–ç .</td>
</tr>
</tbody>
</table>
<h2 id="åŠ¨æ€å˜é‡">åŠ¨æ€å˜é‡</h2>
<table>
<thead>
<tr>
<th style="text-align:center">Dynamic Variable</th>
<th style="text-align:left">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$*ARGFILES</td>
<td style="text-align:left">ç¥å¥‡çš„å‘½ä»¤è¡Œè¾“å…¥å¥æŸ„</td>
</tr>
<tr>
<td style="text-align:center">@*ARGS</td>
<td style="text-align:left">æ¥è‡ªå‘½ä»¤è¡Œçš„å‚æ•°</td>
</tr>
<tr>
<td style="text-align:center">$*IN</td>
<td style="text-align:left">æ ‡å‡†è¾“å…¥æ–‡ä»¶å¥æŸ„, AKA stdin</td>
</tr>
<tr>
<td style="text-align:center">$*OUT</td>
<td style="text-align:left">æ ‡å‡†è¾“å‡ºæ–‡ä»¶å¥æŸ„, AKA stdout</td>
</tr>
<tr>
<td style="text-align:center">$*ERR</td>
<td style="text-align:left">æ ‡å‡†é”™è¯¯æ–‡ä»¶å¥æŸ„, AKA stderr</td>
</tr>
<tr>
<td style="text-align:center">%*ENV</td>
<td style="text-align:left">ç¯å¢ƒå˜é‡</td>
</tr>
<tr>
<td style="text-align:center">$*REPO</td>
<td style="text-align:left">å­˜å‚¨å®‰è£…è¿‡çš„/åŠ è½½äº†çš„æ¨¡å—ä¿¡æ¯çš„å˜é‡</td>
</tr>
<tr>
<td style="text-align:center">$*TZ</td>
<td style="text-align:left">ç³»ç»Ÿçš„æœ¬åœ°æ—¶åŒº.</td>
</tr>
<tr>
<td style="text-align:center">$*CWD</td>
<td style="text-align:left">å½“å‰å·¥ä½œç›®å½•.</td>
</tr>
<tr>
<td style="text-align:center">$*KERNEL</td>
<td style="text-align:left">åœ¨å“ªä¸ªå†…æ ¸ä¸‹è¿è¡Œ</td>
</tr>
<tr>
<td style="text-align:center">$*DISTRO</td>
<td style="text-align:left">åœ¨å“ªä¸ªæ“ä½œç³»ç»Ÿåˆ†å‘ä¸‹è¿è¡Œ</td>
</tr>
<tr>
<td style="text-align:center">$*VM</td>
<td style="text-align:left">åœ¨å“ªä¸ªè™šæ‹Ÿæœºä¸‹è¿è¡Œ</td>
</tr>
<tr>
<td style="text-align:center">$*PERL</td>
<td style="text-align:left">åœ¨å“ªä¸ª Perl ä¸‹è¿è¡Œ</td>
</tr>
<tr>
<td style="text-align:center">$*PID</td>
<td style="text-align:left">å½“å‰è¿›ç¨‹çš„è¿›ç¨‹ ID</td>
</tr>
<tr>
<td style="text-align:center">$*PROGRAM-NAME</td>
<td style="text-align:left">å½“å‰å¯æ‰§è¡Œç¨‹åºçš„è·¯å¾„å°±åƒå®ƒé€šè¿‡å‘½ä»¤è¡Œé”®å…¥ä¸€æ ·, æˆ– -e å¦‚æœ perl å¼•ç”¨äº† -e æ ‡è®°</td>
</tr>
<tr>
<td style="text-align:center">$*PROGRAM</td>
<td style="text-align:left">æ­£è¢«æ‰§è¡Œçš„ Perl ç¨‹åºçš„ä½ç½®( ä»¥ IO::Path å¯¹è±¡çš„å½¢å¼)</td>
</tr>
<tr>
<td style="text-align:center">$*EXECUTABLE</td>
<td style="text-align:left">å½“å‰è¿è¡Œçš„å¯æ‰§è¡Œ perl çš„ç»å¯¹è·¯å¾„</td>
</tr>
<tr>
<td style="text-align:center">$*EXECUTABLE-NAME</td>
<td style="text-align:left">å½“å‰è¿è¡Œçš„å¯æ‰§è¡Œ perl ç¨‹åºçš„åå­—ã€‚(e.g. raku-p, raku-m, Niecza.exe)</td>
</tr>
<tr>
<td style="text-align:center">$*USER</td>
<td style="text-align:left">æ­£åœ¨è¿è¡Œè¯¥ç¨‹åºçš„ç”¨æˆ·. å®ƒæ˜¯ä¸€ä¸ªè¢«æ±‚å€¼ä¸º &ldquo;username (uid)&rdquo; çš„å¯¹è±¡. å®ƒåªæœ‰åœ¨è¢«å½“ä½œå­—ç¬¦ä¸²æ—¶æ‰è¢«æ±‚å€¼ä¸ºç”¨æˆ·å, å¦‚æœè¢«å½“ä½œæ•°å­—åˆ™è¢«æ±‚å€¼ä¸ºæ•°å€¼åŒ–çš„ç”¨æˆ· idã€‚</td>
</tr>
<tr>
<td style="text-align:center">$*GROUP</td>
<td style="text-align:left">è¿è¡Œç¨‹åºçš„ç”¨æˆ·çš„ä¸»è¦ç»„. å®ƒæ˜¯è¢«è®¡ç®—ä¸º  &ldquo;groupname (gid)&rdquo; çš„å¯¹è±¡.å®ƒåªæœ‰åœ¨è¢«å½“ä½œå­—ç¬¦ä¸²æ—¶æ‰è¢«æ±‚å€¼ä¸ºç»„å, å¦‚æœè¢«å½“ä½œæ•°å­—åˆ™è¢«æ±‚å€¼ä¸ºæ•°å€¼åŒ–çš„ç»„ idã€‚</td>
</tr>
<tr>
<td style="text-align:center">$*HOME</td>
<td style="text-align:left">ä»£è¡¨å½“å‰è¿è¡Œç¨‹åºçš„ç”¨æˆ·å®¶ç›®å½•çš„ IO::Path å¯¹è±¡ã€‚å¦‚æœå®¶ç›®å½•ä¸ç¡®å®šåˆ™ä¸º Nilã€‚</td>
</tr>
<tr>
<td style="text-align:center">$*SPEC</td>
<td style="text-align:left">ç¨‹åºè¿è¡Œçš„å¹³å°çš„åˆé€‚çš„ IO::Spec å­ç±», å¯¹äºç‰¹å®šæ“ä½œç³»ç»Ÿä»£ç ,ä½¿ç”¨æ™ºèƒ½åŒ¹é…: say &ldquo;We are on Windows!&rdquo; if $*SPEC ~~ IO::Spec::Win32</td>
</tr>
<tr>
<td style="text-align:center">$*TMPDIR</td>
<td style="text-align:left">ä»£è¡¨ç€ &ldquo;ç³»ç»Ÿä¸´æ—¶ç›®å½•&rdquo; çš„ IO::Path å¯¹è±¡</td>
</tr>
<tr>
<td style="text-align:center">$*TOLERANCE</td>
<td style="text-align:left">ç”± &lt;=~=&gt; æ“ä½œç¬¦ä½¿ç”¨å¹¶ä¸”ä»»ä½•ä¾èµ–å®ƒçš„æ“ä½œ, æ¥å†³å®šä¸¤ä¸ªå€¼æ˜¯å¦è¿‘ä¼¼åœ°ç›¸ç­‰, é»˜è®¤ä¸º 1e-15ã€‚</td>
</tr>
<tr>
<td style="text-align:center">$*THREAD</td>
<td style="text-align:left">ä»£è¡¨å½“å‰æ‰§è¡Œçº¿ç¨‹çš„ Thread å¯¹è±¡ã€‚</td>
</tr>
<tr>
<td style="text-align:center">$*SCHEDULER</td>
<td style="text-align:left">ä»£è¡¨å½“å‰é»˜è®¤è°ƒåº¦ç¨‹åºçš„ ThreadPoolScheduler å¯¹è±¡ã€‚</td>
</tr>
</tbody>
</table>
<p>æ³¨æ„ <code>$*SCHEDULER</code> çš„ç”¨æ³•:</p>
<p>å¯¹äºå½“å‰çš„ Rakudo, è¿™ä¸ªé»˜è®¤åœ¨æ–¹æ³• <code>.hyper</code> å’Œ <code>.race</code> ä¸Šé‡‡ç”¨æœ€å¤§ 16 ä¸ªçº¿ç¨‹ã€‚è¦æ›´æ”¹çº¿ç¨‹çš„æœ€å¤§æ•°é‡, è¦ä¹ˆåœ¨è¿è¡Œ perl ä¹‹å‰è®¾ç½®ç¯å¢ƒå˜é‡  RAKUDO_MAX_THREADS çš„å€¼, è¦ä¹ˆåœ¨ä½¿ç”¨ .hyper æˆ– .race ä¹‹å‰åˆ›å»ºä¸€ä¸ªé»˜è®¤æ”¹å˜äº†çš„ä½œç”¨åŸŸçš„æ‹·è´:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="vg">$*SCHEDULER</span> <span class="o">=</span> <span class="nb">ThreadPoolScheduler</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span> <span class="s">max_threads</span> <span class="o">=&gt;</span> <span class="mi">64</span> <span class="p">);</span>
</code></pre></div><p>è¿™ç§è¡Œä¸ºåœ¨ spec æµ‹è¯•ä¸­æ²¡æœ‰è¢«æµ‹è¯•å¹¶ä¸”è¿˜ä¼šå˜åŒ–ã€‚</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/variable" term="variable" label="variable" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä¸­çš„å¼•å·]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-08-24-quote-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-08-24-quote-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Quote in Raku</blockquote><p>é™¤äº† q å’Œ qq ä¹‹å¤–ï¼Œç°åœ¨è¿˜æœ‰ä¸€ç§åŸºæœ¬å½¢å¼çš„ Qï¼Œå®ƒä¸ä¼šè¿›è¡Œæ’å€¼ï¼Œé™¤éæ˜¾å¼åœ°ä¿®æ”¹å®ƒé‚£æ ·åšã€‚æ‰€ä»¥ï¼Œq å®é™…ä¸Šæ˜¯ Q:q çš„ç®€ç§°ï¼Œqq å®é™…ä¸Šæ˜¯ <code>Q:qq</code> çš„ç®€ç§°ã€‚å®é™…ä¸Šæ‰€æœ‰çš„ quote-like å½¢å¼éƒ½æ´¾ç”Ÿè‡ªå¸¦æœ‰å‰¯è¯çš„ Q å½¢å¼ï¼š</p>
<p><a href="https://github.com/raku/roast/blob/master/S02-literals/quoting.t#L95-L116">S02-literals/quoting.t lines 95â€“116</a>
<a href="https://github.com/raku/roast/blob/master/S02-literals/quoting.t#L132-L139">S02-literals/quoting.t lines 132â€“139</a></p>
<pre><code>q//         Q :q //
qq//        Q :qq //
rx//        Q :regex //
s///        Q :subst ///
tr///       Q :trans ///
</code></pre><p>è¯¸å¦‚ <code>:regex</code> çš„å‰¯è¯é€šè¿‡è½¬æ¢åˆ°ä¸åŒçš„è§£æå™¨æ”¹å˜äº†è¯­è¨€çš„è§£æã€‚è¿™èƒ½å®Œå…¨æ”¹å˜ä»»ä½•ä¹‹åçš„å‰¯è¯è¿˜æœ‰æ‰€å¼•èµ·çš„ä¸œè¥¿è‡ªèº«çš„è§£é‡Šã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">q</span><span class="sa">:s</span><span class="p">//</span><span class="s">       Q :q :scalar </span>
<span class="k">rx</span><span class="p">:</span><span class="na">s</span><span class="p">//</span><span class="sr">      Q </span><span class="p">:</span><span class="na">regex</span><span class="sr"> </span><span class="p">:</span><span class="na">scalar</span><span class="sr"> //
</span></code></pre></div><p>å°±åƒ <code>q[...]</code> æ‹¥æœ‰ç®€å†™å½¢å¼çš„ &lsquo;&hellip;&rsquo;, å¹¶ä¸” <code>qq[...]</code> æ‹¥æœ‰ç®€å†™å½¢å¼çš„ &ldquo;&hellip;&rdquo; ä¸€æ ·ï¼Œå®Œæ•´çš„ <code>Q[...]</code> å¼•ç”¨ä¹Ÿæœ‰ä¸€ç§ä½¿ç”¨åŠè§’æ‹¬å· ï½¢&hellip;ï½£ çš„çŸ­å½¢å¼ã€‚</p>
<h1 id="å¼•å·ä¸Šçš„å‰¯è¯">å¼•å·ä¸Šçš„å‰¯è¯</h1>
<p>å¹¿ä¹‰ä¸Šçš„å¼•å·ç°åœ¨å¯ä»¥æ¥æ”¶å‰¯è¯äº†ï¼š</p>
<ul>
<li><a href="https://github.com/raku/roast/blob/master/S02-literals/quoting.t#L210-L223">S02-literals/quoting.t lines 210â€“223</a></li>
<li><a href="https://github.com/raku/roast/blob/master/S02-literals/quoting.t#L55-L69">S02-literals/quoting.t lines 55â€“69</a></li>
<li><a href="https://github.com/raku/roast/blob/master/S02-literals/quoting.t#L427-L501">S02-literals/quoting.t lines 427â€“501</a></li>
</ul>
<pre><code>Short       Long            Meaning
=====       ====            =======
:x          :exec           ä½œä¸ºå‘½ä»¤æ‰§è¡Œå¹¶è¿”å›ç»“æœ
:w          :words          æŒ‰å•è¯åˆ†å‰²ç»“æœ(æ²¡æœ‰å¼•å·ä¿æŠ¤)


:ww         :quotewords     æŒ‰å•è¯åˆ†å‰²ç»“æœ (å¸¦æœ‰å¼•å·ä¿æŠ¤)
:v          :val            Evaluate word or words for value literals
:q          :single         æ’å€¼ \\, \q å’Œ \' (or whatever)


:qq         :double         ä½¿ç”¨ :s, :a, :h, :f, :c, :b è¿›è¡Œæ’å€¼
:s          :scalar         æ’å€¼ $ vars
:a          :array          æ’å€¼ @ vars
:h          :hash           æ’å€¼ % vars


:f          :function       æ’å€¼ &amp; è°ƒç”¨
:c          :closure        æ’å€¼ {...} è¡¨è¾¾å¼
:b          :backslash      æ’å€¼ \n, \t, ç­‰. (è‡³å°‘æš—ç¤ºäº† :q )
:to         :heredoc        æŠŠç»“æœè§£æä¸º heredoc ç»ˆæ­¢ç¬¦
            :regex          è§£æä¸ºæ­£åˆ™è¡¨è¾¾å¼
            :subst          è§£æä¸ºç½®æ¢ (substitution)
            :trans          è§£æä¸ºè½¬æ¢ (transliteration)
            :code           Quasiquoting
:p          :path           è¿”å›ä¸€ä¸ª Path å¯¹è±¡ (æŸ¥çœ‹ S16 è·å–æ›´å¤šé€‰é¡¹)
</code></pre><p>é€šè¿‡åœ¨å¼€å¤´åŠ å…¥ä¸€ä¸ªå¸¦æœ‰çŸ­å½¢å¼çš„å•ä¸ªå‰¯è¯çš„ Qï¼Œqï¼Œæˆ– qqï¼Œä½ å¯ä»¥çœç•¥æ‰ç¬¬ä¸€ä¸ªå†’å·ï¼Œè¿™äº§ç”Ÿäº†å¦‚ä¸‹å½¢å¼ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">q</span><span class="sa">w</span> <span class="p">/</span><span class="s">a b c</span><span class="p">;</span>                         <span class="c1"># P5-esque qw// meaning q:w</span>
<span class="k">Q</span><span class="sa">c</span> <span class="p">&#39;</span><span class="s">...</span><span class="p">{</span><span class="nv">$x</span><span class="p">}</span><span class="s">...</span><span class="p">;</span>                    <span class="c1"># Q:c//, interpolate only closures</span>
<span class="k">qq</span><span class="sa">x</span><span class="p">/</span><span class="nv">$cmd</span><span class="s2"> </span><span class="nv">@args</span><span class="o">[]</span>                   <span class="c1"># equivalent to P5&#39;s qx//</span>
</code></pre></div><p>(æ³¨æ„ <code>qx//</code> ä¸æ’å€¼)</p>
<p>å¦‚æœä½ æƒ³è¿›ä¸€æ­¥ç¼©å†™ï¼Œé‚£ä¹ˆå®šä¹‰ä¸€ä¸ªå®ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="n">macro</span> <span class="k">q</span><span class="sa">x</span> <span class="p">{</span><span class="s"> &#39;qq:x &#39; </span><span class="p">}</span>          <span class="c1"># equivalent to P5&#39;s qx//</span>
<span class="n">macro</span> <span class="n">qTO</span> <span class="p">{</span> <span class="p">&#39;</span><span class="s1">qqâŒw:to </span><span class="p">&#39;</span> <span class="p">}</span>    <span class="c1"># qqâŒw:to//</span>
<span class="nf">macro</span> <span class="n">quote:</span><span class="p">&lt;</span><span class="s">â° â±</span><span class="p">&gt;</span> <span class="p">(</span><span class="nv">$text</span><span class="p">)</span> <span class="p">{</span> <span class="n">quasi</span> <span class="p">{</span> <span class="p">{{{</span><span class="nv">$text</span><span class="p">}}}</span><span class="o">.</span><span class="nf">quoteharder</span> <span class="p">}</span> <span class="p">}</span>
</code></pre></div><p>æ‰€æœ‰å¤§å†™çš„å‰¯è¯è¢«ä¿ç•™ç”¨ä½œç”¨æˆ·å®šä¹‰çš„å¼•å·ã€‚æ‰€æœ‰åœ¨ Latin-1 ä¸Šé¢çš„ Unicode åˆ†éš”ç¬¦è¢«ä¿ç•™ç”¨ä½œç”¨æˆ·å®šä¹‰çš„å¼•å·ã€‚
<a href="https://github.com/raku/roast/blob/master/S02-literals/quoting.t#L352-L426">S02-literals/quoting.t lines 352â€“426</a></p>
<p>å…³äºä¸Šé¢æˆ‘ä»¬ç°åœ¨æœ‰äº†ä¸€ä¸ªæ¨è®ºï¼Œæˆ‘ä»¬ç°åœ¨èƒ½è¯´ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">%hash</span> <span class="o">=</span> <span class="k">q</span><span class="sa">w:c</span><span class="p">/</span><span class="s">a b c d </span><span class="p">{</span><span class="nv">@array</span><span class="p">}</span><span class="s"> </span><span class="p">{</span><span class="nv">%hash</span><span class="p">};</span>
</code></pre></div><p>æˆ–ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">%hash</span> <span class="o">=</span> <span class="k">qq</span><span class="sa">:w</span><span class="p">/</span><span class="s2">a b c d </span><span class="p">{</span><span class="nv">@array</span><span class="p">}</span><span class="s2"> </span><span class="p">{</span><span class="nv">%hash</span><span class="p">};</span>
</code></pre></div><p>æŠŠä¸œè¥¿(items)æ’å€¼åˆ° qw ä¸­ã€‚é»˜è®¤åœ°ï¼Œæ•°ç»„å’Œæ•£åˆ—åœ¨æ’å€¼æ—¶åªå¸¦æœ‰ç©ºæ ¼åˆ†éš”ç¬¦ï¼Œæ‰€ä»¥ä¹‹åçš„æŒ‰ç©ºæ ¼åˆ†å‰²ä»æ—§èƒ½å·¥ä½œã€‚ï¼ˆä½†æ˜¯å†…ç½®çš„  Â«&hellip;Â»  å¼•å·è‡ªåŠ¨è¿›è¡Œäº†ç­‰ä»·äº <code>qq:ww:v/.../</code> çš„æ’å€¼ï¼‰ã€‚ å†…ç½®çš„ <code>&lt;...&gt;</code> ç­‰ä»·äº <code>q:w:v/.../</code>ã€‚</p>
<h2 id="the-q-lang">The Q Lang</h2>
<p>åœ¨ Raku ä¸­, å­—ç¬¦ä¸²é€šå¸¸ä½¿ç”¨ä¸€äº›å¼•å·ç»“æ„æ¥è¡¨ç¤ºã€‚è¿™äº›å¼•å·ç»“æ„ä¸­,æœ€ç®€å•çš„å°±æ˜¯ <code>Q</code>, é€šè¿‡ä¾¿æ·æ–¹å¼ <code>ï½¢â€¦ï½£</code> æˆ– <code>Q</code> åè·Ÿç€ç”±ä»»æ„ä¸€å¯¹å„¿åˆ†éš”ç¬¦åŒ…å›´ç€çš„æ–‡æœ¬ã€‚å¤§å¤šæ•°æ—¶å€™, ä½ éœ€è¦çš„åªæ˜¯ <code>'â€¦'</code> æˆ– <code>&quot;â€¦&quot;</code>.</p>
<h3 id="literal-strings-q">Literal strings: Q</h3>
<pre><code>Q[A literal string]
ï½¢More plainly.ï½£
Q ^Almost any non-word character can be a delimiter!^
Q ï½¢ï½¢Delimiters can be repeated/nested if they are adjacent.ï½£ï½£
</code></pre><p>åˆ†éš”ç¬¦èƒ½å¤ŸåµŒå¥—, ä½†æ˜¯åœ¨æ™®é€šçš„ Q å½¢å¼ä¸­, åæ–œçº¿è½¬ä¹‰æ˜¯ä¸å…è®¸çš„ã€‚æ¢ç§è¯´æ³•å°±æ˜¯, Q å­—ç¬¦ä¸²å°½å¯èƒ½è¢«ä½œä¸ºå­—é¢é‡ã€‚</p>
<p>åœ¨ <code>Q</code>ã€<code>q</code> æˆ– <code>qq</code> ä¹‹åä¸å…è®¸ç«‹å³ä½¿ç”¨ä¸€äº›åˆ†éš”ç¬¦ã€‚<a href="https://docs.raku.org/language/syntax#Identifiers">æ ‡è¯†ç¬¦</a>ä¸­å…è®¸çš„ä»»ä½•å­—ç¬¦éƒ½ä¸å…è®¸ä½¿ç”¨ï¼Œå› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¼•å·ç»“æ„å’Œè¿™äº›å­—ç¬¦ä¸€èµ·è¢«è§£é‡Šä¸ºæ ‡è¯†ç¬¦ã€‚æ­¤å¤–ï¼Œ<code>( )</code> æ˜¯ä¸å…è®¸çš„ï¼Œå› ä¸ºå®ƒè¢«è§£é‡Šä¸ºå‡½æ•°è°ƒç”¨ã€‚å¦‚æœä½ ä»ç„¶å¸Œæœ›ä½¿ç”¨è¿™äº›å­—ç¬¦ä½œä¸ºåˆ†éš”ç¬¦ï¼Œè¯·ç”¨ç©ºæ ¼å°†å®ƒä»¬ä¸ <code>Q</code>ã€<code>q</code> æˆ– <code>qq</code> åˆ†éš”å¼€ã€‚è¯·æ³¨æ„ï¼Œä¸€äº›è‡ªç„¶è¯­è¨€åœ¨å­—ç¬¦ä¸²çš„å³ä¾§ä½¿ç”¨å·¦åˆ†éš”å¼•å·ã€‚<code>Q</code> ä¸æ”¯æŒè¿™äº›ï¼Œå› ä¸ºå®ƒä¾èµ– unicode å±æ€§æ¥åŒºåˆ†å·¦åˆ†éš”ç¬¦å’Œå³åˆ†éš”ç¬¦ã€‚</p>
<pre><code>Q'this will not work!'
Q(this won't work either!)
</code></pre><p>ä¸Šé¢å¯¹ä¾‹å­ä¼šäº§ç”Ÿé”™è¯¯ã€‚ç„¶è€Œï¼Œä¸‹é¢è¿™ä¸ªèƒ½èµ·ä½œç”¨ï¼š</p>
<pre><code>Q (this is fine, because of space after Q)
Q 'and so is this'
Q&lt;Make sure you &lt;match&gt; opening and closing delimiters&gt;
Q{This is still a closing curly brace â†’ \}
</code></pre><p>è¿™äº›ä¾‹å­äº§ç”Ÿï¼š</p>
<pre><code>this is fine, because of space after Q
and so is this
Make sure you &lt;match&gt; opening and closing delimiters
This is still a closing curly brace â†’ \
</code></pre><p>å¼•å·ç»“æ„çš„è¡Œä¸ºå¯ä»¥ç”¨å‰¯è¯ä¿®æ”¹ï¼Œåé¢çš„ç« èŠ‚ä¼šè¯¦ç»†è§£é‡Šã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">Short</th>
<th style="text-align:left">Long</th>
<th style="text-align:left">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">:x</td>
<td style="text-align:left">:exec</td>
<td style="text-align:left">Execute as command and return results</td>
</tr>
<tr>
<td style="text-align:left">:w</td>
<td style="text-align:left">:words</td>
<td style="text-align:left">Split result on words (no quote protection)</td>
</tr>
<tr>
<td style="text-align:left">:ww</td>
<td style="text-align:left">:quotewords</td>
<td style="text-align:left">Split result on words (with quote protection)</td>
</tr>
<tr>
<td style="text-align:left">:q</td>
<td style="text-align:left">:single</td>
<td style="text-align:left">Interpolate \, \qq[&hellip;] and escaping the delimiter with \</td>
</tr>
<tr>
<td style="text-align:left">:qq</td>
<td style="text-align:left">:double</td>
<td style="text-align:left">Interpolate with :s, :a, :h, :f, :c, :b</td>
</tr>
<tr>
<td style="text-align:left">:s</td>
<td style="text-align:left">:scalar</td>
<td style="text-align:left">Interpolate $ vars</td>
</tr>
<tr>
<td style="text-align:left">:a</td>
<td style="text-align:left">:array</td>
<td style="text-align:left">Interpolate @ vars</td>
</tr>
<tr>
<td style="text-align:left">:h</td>
<td style="text-align:left">:hash</td>
<td style="text-align:left">Interpolate % vars</td>
</tr>
<tr>
<td style="text-align:left">:f</td>
<td style="text-align:left">:function</td>
<td style="text-align:left">Interpolate &amp; calls</td>
</tr>
<tr>
<td style="text-align:left">:c</td>
<td style="text-align:left">:closure</td>
<td style="text-align:left">Interpolate {&hellip;} expressions</td>
</tr>
<tr>
<td style="text-align:left">:b</td>
<td style="text-align:left">:backslash</td>
<td style="text-align:left">Enable backslash escapes (\n, \qq, $foo, etc)</td>
</tr>
<tr>
<td style="text-align:left">:to</td>
<td style="text-align:left">:heredoc</td>
<td style="text-align:left">Parse result as heredoc terminator</td>
</tr>
<tr>
<td style="text-align:left">:v</td>
<td style="text-align:left">:val</td>
<td style="text-align:left">Convert to allomorph if possible</td>
</tr>
</tbody>
</table>
<h3 id="escaping-q">Escaping: q</h3>
<pre><code>'Very plain';
q[This back\slash stays];
q[This back\\slash stays]; # Identical output
q{This is not a closing curly brace â†’ \}, but this is â†’ };
Q :q $There are no backslashes here, only lots of \$\$\$&gt;!$;
'(Just kidding. There\'s no money in that string)';
'No $interpolation {here}!';
Q:q!Just a literal &quot;\n&quot; here!;
</code></pre><p><code>q</code> å½¢å¼çš„å¼•å·ç»“æ„å…è®¸ä½¿ç”¨åæ–œçº¿è½¬ä¹‰å¯èƒ½ä¼šç»“æŸå­—ç¬¦ä¸²çš„å­—ç¬¦. åæ–œçº¿è‡ªèº«ä¹Ÿèƒ½è¢«è½¬ä¹‰, å°±åƒä¸Šé¢çš„ç¬¬ä¸‰ä¸ªä¾‹å­é‚£æ ·. é€šå¸¸çš„å½¢å¼æ˜¯ <code>'...'</code> æˆ– <code>q</code> åè·Ÿç€åˆ†éš”ç¬¦, ä½†æ˜¯å®ƒä¹Ÿèƒ½ä½œä¸º Q ä¸Šçš„å‰¯è¯ä½¿ç”¨, å°±åƒä¸Šé¢çš„ç¬¬äº”ä¸ªå’Œæœ€åä¸€ä¸ªä¾‹å­é‚£æ ·.</p>
<p>è¿™äº›ä¾‹å­äº§ç”Ÿ:</p>
<pre><code>Very plain
This back\slash stays
This back\slash stays
This is not a closing brace â†’ } but this is â†’
There are no backslashes here, only lots of $$$!
(Just kidding. There's no money in that string)
No $interpolation {here}!
Just a literal &quot;\n&quot; here
</code></pre><p><code>\qq[...]</code> è½¬ä¹‰åºåˆ—å…è®¸ <a href="https://docs.raku.org/language/quoting#Interpolation%3A_qq">qq æ’å€¼</a> çš„ä¸€éƒ¨åˆ†å­—ç¬¦ä¸²ã€‚å½“å­—ç¬¦ä¸²ä¸­æœ‰ HTML æ ‡è®°æ—¶ï¼Œä½¿ç”¨è¿™ä¸ªè½¬ä¹‰åºåˆ—éå¸¸æ–¹ä¾¿ï¼Œå¯ä»¥é¿å…å°†å°–æ‹¬å·è§£é‡Šä¸ºæ•£åˆ—é”®:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$var</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">foo</span><span class="p">&#39;;</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">&lt;code&gt;$var&lt;/code&gt; is &lt;var&gt;</span><span class="se">\qq</span><span class="p">[</span><span class="nv">$var</span><span class="o">.</span><span class="nf">uc</span><span class="p">()]</span><span class="s1">&lt;/var&gt;</span><span class="p">&#39;;</span>
<span class="c1"># OUTPUT: Â«&lt;code&gt;$var&lt;/code&gt; is &lt;var&gt;FOO&lt;/var&gt;â¤Â»</span>
</code></pre></div><h3 id="interpolation-qq">Interpolation: qq</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$color</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">blue</span><span class="p">&#39;;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">My favorite color is </span><span class="nv">$color</span><span class="s2">!</span><span class="p">&#34;;</span> <span class="c1"># My favorite color is blue!</span>
</code></pre></div><p><code>qq</code> å½¢å¼ - é€šå¸¸ä½¿ç”¨åŒå¼•å·å†™æˆ - å…è®¸å˜é‡çš„æ’å€¼, ä¾‹å¦‚å­—ç¬¦ä¸²ä¸­èƒ½å†™å…¥å˜é‡, ä»¥ä½¿å˜é‡çš„å†…å®¹èƒ½æ’å…¥åˆ°å­—ç¬¦ä¸²ä¸­. åœ¨ <code>qq</code> å¼•èµ·å­—ç¬¦ä¸²ä¸­, ä¹Ÿèƒ½è½¬ä¹‰å˜é‡.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">The \$color variable contains the value &#39;</span><span class="nv">$color&#39;</span><span class="p">&#34;;</span>
<span class="c1"># The $color variable contatins the value &#39;blue&#39;</span>
</code></pre></div><p><code>qq</code> çš„å¦å¤–ä¸€ç§åŠŸèƒ½æ˜¯ä½¿ç”¨èŠ±æ‹¬å·åœ¨å­—ç¬¦ä¸²ä¸­æ’å€¼ Raku ä»£ç :</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="p">(</span><span class="nv">$x</span><span class="o">,</span> <span class="nv">$y</span><span class="o">,</span> <span class="nv">$z</span><span class="p">)</span> <span class="o">=</span> <span class="mi">4</span><span class="o">,</span> <span class="mf">3.5</span><span class="o">,</span> <span class="mi">3</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">This room is </span><span class="nv">$x</span><span class="s2"> m by </span><span class="nv">$y</span><span class="s2"> m by </span><span class="nv">$z</span><span class="s2"> m.</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Therefore its volume should be </span><span class="p">{</span> <span class="nv">$x</span> <span class="o">*</span> <span class="nv">$y</span> <span class="o">*</span> <span class="nv">$z</span> <span class="p">}</span><span class="s2"> mÂ³!</span><span class="p">&#34;;</span>
</code></pre></div><p>è¾“å‡º:</p>
<pre><code>This room is 4 m by 3.5 m by 3 m.
Therefore its volume should be 42 mÂ³!
</code></pre><p>é»˜è®¤æƒ…å†µä¸‹, åªæœ‰å¸¦æœ‰ <code>$</code> ç¬¦å·çš„å˜é‡æ‰èƒ½æ­£å¸¸æ’å€¼. è¿™æ—¶, <code>&quot;documentation@raku.org&quot;</code> ä¸ä¼šæ’å€¼  <code>@raku</code> å˜é‡ã€‚å¦‚æœä½ ç¡®å®æƒ³é‚£ä¹ˆåš, åœ¨å˜é‡ååé¢æ·»åŠ ä¸€ä¸ª <code>[]</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@neighbors</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">Felix</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">Danielle</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">Lucinda</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="nv">@neighbors</span><span class="o">[]</span><span class="s2"> and I try our best to coexist peacefully.</span><span class="p">&#34;;</span>
</code></pre></div><p>è¾“å‡º:</p>
<pre><code>Felix Danielle Lucinda and I try our best to coexist peacefully.
</code></pre><p>é€šå¸¸ä½¿ç”¨ä¸€ä¸ªæ–¹æ³•è°ƒç”¨ä¼šæ›´åˆé€‚. åªæœ‰åœ¨ <code>qq</code> å¼•å·ä¸­, æ–¹æ³•è°ƒç”¨åé¢æœ‰åœ†æ‹¬å·, å°±èƒ½è¿›è¡Œæ’å€¼:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#34;</span><span class="nv">@neighbors</span><span class="o">.</span><span class="nf">join</span><span class="p">(&#39;</span><span class="s1">, </span><span class="p">&#39;)</span><span class="s2"> and I try our best to coexist peacefully.</span><span class="p">&#34;;</span>
</code></pre></div><p>è¾“å‡º:</p>
<pre><code>Felix, Danielle, Lucinda and I try our best to coexist peacefully.
</code></pre><p>è€Œ <code>&quot;@example.com&quot;</code> äº§ç”Ÿ <code>@example.com</code>.</p>
<p>è¦è°ƒç”¨å­ä¾‹ç¨‹è¯·ä½¿ç”¨ <code>&amp;</code> ç¬¦å·ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">abc</span><span class="nv">&amp;uc</span><span class="s2">(</span><span class="p">&#34;</span><span class="n">def</span><span class="p">&#34;</span><span class="s2">)ghi</span><span class="p">&#34;;</span>
<span class="c1"># OUTPUT: Â«abcDEFghiâ¤Â»</span>
</code></pre></div><p>åç¯ç¼€æ“ä½œç¬¦å’Œ <a href="https://docs.raku.org/language/subscripts">subscripts</a> ä¹Ÿä¼šè¢«æ’å€¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%h</span> <span class="o">=</span> <span class="p">:</span><span class="s">1st</span><span class="p">;</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">abc</span><span class="nv">%h</span><span class="p">&lt;</span><span class="s">st</span><span class="p">&gt;</span><span class="s2">ghi</span><span class="p">&#34;;</span>
<span class="c1"># OUTPUT: Â«abc1ghiâ¤Â»</span>
</code></pre></div><p>è¦è¾“å…¥ unicode åºåˆ—ï¼Œè¯·ä½¿ç”¨ <code>\x</code> æˆ– <code>\x[]</code> åŠ ä¸Šå­—ç¬¦çš„åå…­è¿›åˆ¶ç¼–ç æˆ–å­—ç¬¦åˆ—è¡¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$s</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">I </span><span class="se">\x</span><span class="mh">2665</span><span class="s2"> Raku!</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="nv">$s</span><span class="p">;</span>
<span class="c1"># OUTPUT: Â«I â™¥ Raku!â¤Â»</span>

<span class="nv">$s</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">I really \x[2661,2665,2764,1f495] Raku!</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="nv">$s</span><span class="p">;</span>
<span class="c1"># OUTPUT: Â«I really â™¡â™¥â¤ğŸ’• Raku!â¤Â»</span>
</code></pre></div><p>æ‚¨è¿˜å¯ä»¥åœ¨ <a href="https://docs.raku.org/language/unicode#Entering_unicode_codepoints_and_codepoint_sequences">\c[]</a> ä¸­ä½¿ç”¨ <a href="https://docs.raku.org/language/unicode#Entering_unicode_codepoints_and_codepoint_sequences">unicode åç§°</a>ã€<a href="https://docs.raku.org/language/unicode#Named_sequences">å‘½ååºåˆ—</a>å’Œ<a href="https://docs.raku.org/language/unicode#Name_aliases">åç§°åˆ«å</a>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$s</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">Camelia </span><span class="se">\c</span><span class="p">[</span><span class="s">BROKEN HEART</span><span class="p">]</span><span class="s2"> my </span><span class="se">\c</span><span class="p">[</span><span class="s">HEAVY BLACK HEART</span><span class="p">]</span><span class="s2">!</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="nv">$s</span><span class="p">;</span>
<span class="c1"># OUTPUT: Â«Camelia ğŸ’” my â¤!â¤Â»</span>
</code></pre></div><p>å¯¹æœªå®šä¹‰å€¼è¿›è¡Œæ’å€¼å°†å¼•å‘æ§ä»¶å¼‚å¸¸ï¼Œè¯¥å¼‚å¸¸å¯ä»¥åœ¨å½“å‰æ§ä»¶å—ä¸­ä½¿ç”¨ <a href="https://docs.raku.org/language/phasers#CONTROL">CONTROL</a> æ•è·ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">niler</span> <span class="p">{</span><span class="nb">Nil</span><span class="p">};</span>
<span class="k">my</span> <span class="nb">Str</span> <span class="nv">$a</span> <span class="o">=</span> <span class="n">niler</span><span class="p">;</span>
<span class="nb">say</span><span class="p">(&#34;</span><span class="nv">$a</span><span class="s2">.html</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">sometext</span><span class="p">&#34;);</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">alive</span><span class="p">&#34;;</span> <span class="c1"># this line is dead code</span>

<span class="k">CONTROL</span> <span class="p">{</span> <span class="o">.</span><span class="nb">die</span> <span class="p">};</span>
</code></pre></div><h3 id="word-quoting-qw">Word quoting: qw</h3>
<pre><code>qw|! @ # $ % ^ &amp; * \| &lt; &gt; | eqv '! @ # $ % ^ &amp; * | &lt; &gt;'.words.list
q:w { [ ] \{ \} } eqv ('[', ']', '{', '}')
Q:w | [ ] { } | eqv ('[', ']', '{', '}')
</code></pre><p><code>:w</code> é€šå¸¸å†™ä½œ <code>qw</code>, æŠŠå­—ç¬¦ä¸²åˆ†å‰²ä¸º &ldquo;words&rdquo; (å•è¯). åœ¨è¿™ç§æƒ…æ™¯ä¸‹, å•è¯è¢«å®šä¹‰ä¸ºç”±ç©ºæ ¼åˆ†å‰²çš„ä¸€ä¸²éç©ºç™½å­—ç¬¦. <code>q:w</code> å’Œ <code>qw</code> ç»§æ‰¿äº† <code>q</code> çš„æ’å€¼å’Œè½¬ä¹‰è¯­æ³•, è¿˜æœ‰å•å¼•å·å­—ç¬¦ä¸²åˆ†å‰²ç¬¦, è€Œ <code>Qw</code> å’Œ <code>Q:w</code> ç»§æ‰¿äº† <code>Q</code> çš„éè½¬ä¹‰è¯­æ³•.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@directions</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">left</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">right,</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">up</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">down</span><span class="p">&#39;;</span>
</code></pre></div><p>è¿™æ ·è¯»å’Œå†™éƒ½æ›´å®¹æ˜“:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@directions</span> <span class="o">=</span> <span class="k">q</span><span class="sa">w</span><span class="p">|</span><span class="s">left right up down</span><span class="p">;</span>
</code></pre></div><h3 id="word-quoting-">Word quoting: &lt;&gt;</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;</span> <span class="ow">eqv</span> <span class="p">(&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">b</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">c</span><span class="p">&#39;);</span>   <span class="c1"># OUTPUT: Â«Trueâ¤Â»</span>
<span class="nb">say</span> <span class="p">&lt;</span><span class="s">a b 42</span><span class="p">&gt;</span> <span class="ow">eqv</span> <span class="p">(&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">b</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">42</span><span class="p">&#39;);</span> <span class="c1"># OUTPUT: Â«Falseâ¤Â», the 42 became an IntStr allomorph</span>
<span class="nb">say</span> <span class="p">&lt;</span><span class="s"> 42 </span><span class="p">&gt;</span> <span class="o">~~</span> <span class="nb">Int</span><span class="p">;</span> <span class="c1"># OUTPUT: Â«Trueâ¤Â»</span>
<span class="nb">say</span> <span class="p">&lt;</span><span class="s"> 42 </span><span class="p">&gt;</span> <span class="o">~~</span> <span class="nb">Str</span><span class="p">;</span> <span class="c1"># OUTPUT: Â«Trueâ¤Â»</span>
</code></pre></div><p>å°–æ‹¬å·çš„å¼•å·ç±»ä¼¼äº <code>qw</code>ï¼Œä½†æœ‰ä¸€ä¸ªé¢å¤–çš„ç‰¹æ€§ï¼Œå¯ä»¥è®©ä½ æ„é€ ç‰¹å®šæ•°å­—çš„<a href="https://docs.raku.org/language/glossary#index-entry-Allomorph">åŒè´¨å¼‚å½¢ä½“</a>æˆ–å­—é¢é‡:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&lt;</span><span class="s">42 4/2 1e6 1+1i abc</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>
<span class="c1"># OUTPUT: Â«(IntStr.new(42, &#34;42&#34;), RatStr.new(2.0, &#34;4/2&#34;), NumStr.new(1000000e0, &#34;1e6&#34;), ComplexStr.new(&lt;1+1i&gt;, &#34;1+1i&#34;), &#34;abc&#34;)â¤Â»</span>
</code></pre></div><p>è¦æ„é€  <a href="https://docs.raku.org/type/Rat">Rat</a> æˆ– <a href="https://docs.raku.org/type/Complex">Complex</a> å­—é¢é‡ï¼Œè¯·åœ¨æ•°å­—å‘¨å›´ä½¿ç”¨å°–æ‹¬å·ï¼Œä¸å¸¦ä»»ä½•é¢å¤–çš„ç©ºæ ¼:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&lt;</span><span class="s">42/10</span><span class="p">&gt;</span><span class="o">.^</span><span class="nb">name</span><span class="p">;</span>   <span class="c1"># OUTPUT: Â«Ratâ¤Â»</span>
<span class="nb">say</span> <span class="p">&lt;</span><span class="s">1+42i</span><span class="p">&gt;</span><span class="o">.^</span><span class="nb">name</span><span class="p">;</span>   <span class="c1"># OUTPUT: Â«Complexâ¤Â»</span>
<span class="nb">say</span> <span class="p">&lt;</span><span class="s"> 42/10 </span><span class="p">&gt;</span><span class="o">.^</span><span class="nb">name</span><span class="p">;</span> <span class="c1"># OUTPUT: Â«RatStrâ¤Â»</span>
<span class="nb">say</span> <span class="p">&lt;</span><span class="s"> 1+42i </span><span class="p">&gt;</span><span class="o">.^</span><span class="nb">name</span><span class="p">;</span> <span class="c1"># OUTPUT: Â«ComplexStrâ¤Â»</span>
</code></pre></div><p>ä¸ <code>42/10</code> å’Œ <code>1+42i</code> ç›¸æ¯”ï¼Œä¸æ¶‰åŠé™¤æ³•(æˆ–åŠ æ³•)è¿ç®—ã€‚è¿™å¯¹äºä¾‹ç¨‹ç­¾åä¸­çš„å­—é¢é‡å¾ˆæœ‰ç”¨ï¼Œä¾‹å¦‚:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">close-enough-Ï€</span> <span class="p">(&lt;</span><span class="s">355/113</span><span class="p">&gt;)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Your Ï€ is close enough!</span><span class="p">&#34;</span>
<span class="p">}</span>

<span class="n">close-enough-Ï€</span> <span class="mi">710</span><span class="o">/</span><span class="mi">226</span><span class="p">;</span> <span class="c1"># OUTPUT: Â«Your Ï€ is close enough!â¤Â»</span>

<span class="c1"># WRONG: can&#39;t do this, since it&#39;s a division operation</span>

<span class="k">sub</span> <span class="nf">compilation-failure</span> <span class="p">(</span><span class="mi">355</span><span class="o">/</span><span class="mi">113</span><span class="p">)</span> <span class="p">{}</span>
</code></pre></div><h3 id="word-quoting-with-quote-protection-qww">Word quoting with quote protection: qww</h3>
<p>å•è¯å¼•ç”¨çš„ <code>qw</code> æ ¼å¼å°†æŒ‰å­—é¢æ„æ€å¤„ç†å¼•ç”¨å­—ç¬¦ï¼Œå°†å®ƒä»¬ä¿ç•™åœ¨ç»“æœå•è¯ä¸­:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="k">q</span><span class="sa">w</span><span class="p">{</span><span class="s">&#34;a b&#34; c</span><span class="p">}</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span> <span class="c1"># OUTPUT: Â«(&#34;\&#34;a&#34;, &#34;b\&#34;&#34;, &#34;c&#34;)â¤Â»</span>
</code></pre></div><p>å› æ­¤ï¼Œå¦‚æœæ‚¨å¸Œæœ›åœ¨ç»“æœå•è¯ä¸­ä¿ç•™å¼•ç”¨çš„å­å­—ç¬¦ä¸²ä½œä¸ºå•ä¸ªé¡¹ï¼Œåˆ™éœ€è¦ä½¿ç”¨ <code>qww</code> å˜ä½“:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="k">q</span><span class="sa">ww</span><span class="p">{</span><span class="s2">&#34;a b&#34; c</span><span class="p">}</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span> <span class="c1"># OUTPUT: Â«(&#34;a b&#34;, &#34;c&#34;)â¤Â»</span>
</code></pre></div><h3 id="word-quoting-with-interpolation-qqw">Word quoting with interpolation: qqw</h3>
<p><code>qw</code> å½¢å¼çš„ word quoting ä¸ä¼šè¿›è¡Œå˜é‡æ’å€¼:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span> <span class="nb">say</span> <span class="k">q</span><span class="sa">w</span><span class="p">{</span><span class="s">$a b c</span><span class="p">};</span>  <span class="c1"># $a b c</span>
</code></pre></div><p>å› æ­¤, å¦‚æœä½ æƒ³åœ¨å¼•å·å­—ç¬¦ä¸²ä¸­è¿›è¡Œå˜é‡æ’å€¼, ä½ éœ€è¦ä½¿ç”¨ <code>qqw</code> å˜ä½“:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">@list</span> <span class="o">=</span> <span class="k">qq</span><span class="sa">w</span><span class="p">{</span><span class="nv">$a</span><span class="s2"> b c</span><span class="p">};</span>
<span class="nb">say</span> <span class="nv">@list</span><span class="p">;</span>                <span class="c1"># 42 b c</span>
</code></pre></div><p>æ³¨æ„ï¼Œå˜é‡æ’å€¼å‘ç”Ÿåœ¨å•è¯åˆ†å‰²ä¹‹å‰:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">a b</span><span class="p">&#34;;</span>
<span class="k">my</span> <span class="nv">@list</span> <span class="o">=</span> <span class="k">qq</span><span class="sa">w</span><span class="p">{</span><span class="nv">$a</span><span class="s2"> c</span><span class="p">};</span>
<span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="nv">@list</span><span class="p">;</span> <span class="c1"># OUTPUT: Â«aâ¤bâ¤câ¤Â»</span>
</code></pre></div><h3 id="word-quoting-with-interpolation-and-quote-protection-qqww">Word quoting with interpolation and quote protection: qqww</h3>
<p><code>qqw</code> å½¢å¼çš„å•è¯å¼•ç”¨ä¼šæŠŠå¼•èµ·çš„å­—ç¬¦å½“ä½œå­—é¢é‡ï¼Œå°†å¼•èµ·çš„å­—ç¬¦ç•™åœ¨ç»“æœå•è¯ä¸­:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span> <span class="nb">say</span> <span class="k">qq</span><span class="sa">w</span><span class="p">{</span><span class="s2">&#34;</span><span class="nv">$a</span><span class="s2"> b&#34; c</span><span class="p">}</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>  <span class="c1"># OUTPUT: Â«(&#34;\&#34;42&#34;, &#34;b\&#34;&#34;, &#34;c&#34;)â¤Â»</span>
</code></pre></div><p>å› æ­¤ï¼Œå¦‚æœå¸Œæœ›åœ¨ç»“æœå•è¯ä¸­ä¿ç•™å¼•èµ·çš„å­å­—ç¬¦ä¸²ä¸ºå•ä¸ªé¡¹ï¼Œåˆ™éœ€è¦ä½¿ç”¨ <code>qqww</code> å˜ä½“:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span> <span class="nb">say</span> <span class="k">qq</span><span class="sa">ww</span><span class="p">{</span><span class="s2">&#34;</span><span class="nv">$a</span><span class="s2"> b&#34; c</span><span class="p">}</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span> <span class="c1"># OUTPUT: Â«(&#34;42 b&#34;, &#34;c&#34;)â¤Â»</span>
</code></pre></div><p>å¼•å·ä¿æŠ¤å‘ç”Ÿåœ¨æ’å€¼ä¹‹å‰ï¼Œæ’å€¼å‘ç”Ÿåœ¨åˆ†è¯ä¹‹å‰ï¼Œæ‰€ä»¥æ¥è‡ªæ’å€¼å˜é‡å†…éƒ¨çš„å¼•å·åªæ˜¯å­—é¢å¼•å·å­—ç¬¦:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">1 2</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="k">qq</span><span class="sa">ww</span><span class="p">{</span><span class="s2">&#34;</span><span class="nv">$a</span><span class="s2">&#34; </span><span class="nv">$a</span><span class="p">}</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span> <span class="c1"># OUTPUT: Â«(&#34;1 2&#34;, &#34;1&#34;, &#34;2&#34;)â¤Â»</span>

<span class="k">my</span> <span class="nv">$b</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">1 \&#34;2 3\&#34;</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="k">qq</span><span class="sa">ww</span><span class="p">{</span><span class="s2">&#34;</span><span class="nv">$b</span><span class="s2">&#34; </span><span class="nv">$b</span><span class="p">}</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span> <span class="c1"># OUTPUT: Â«(&#34;1 \&#34;2 3\&#34;&#34;, &#34;1&#34;, &#34;\&#34;2&#34;, &#34;3\&#34;&#34;)â¤Â»</span>
</code></pre></div><h3 id="word-quoting-with-interpolation-and-quote-protection--">Word quoting with interpolation and quote protection: Â« Â»</h3>
<p>è¿™ç§å¼•ç”¨æ–¹å¼ç±»ä¼¼äº <code>qqww</code>ï¼Œä½†å®ƒå…·æœ‰æ„é€  <a href="https://docs.raku.org/language/glossary#index-entry-Allomorph">allomorphs</a> çš„é¢å¤–å¥½å¤„(ä½¿å…¶åŠŸèƒ½ç›¸å½“äº <a href="https://docs.raku.org/language/quoting#index-entry-%3Aval_%28quoting_adverb%29">qq:ww:v</a>)ã€‚ä¸ <code>Â«Â»</code> ç­‰ä»·çš„ ASCII æ˜¯åŒå°–æ‹¬å· <code>&lt;&lt; &gt;&gt;</code>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># Allomorph Construction</span>
<span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span> <span class="nb">say</span> <span class="p">Â«</span><span class="s2">  </span><span class="nv">$a</span><span class="s2"> b c    </span><span class="p">Â»</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>  <span class="c1"># OUTPUT: Â«(IntStr.new(42, &#34;42&#34;), &#34;b&#34;, &#34;c&#34;)â¤Â»</span>
<span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span> <span class="nb">say</span> <span class="p">&lt;&lt;</span><span class="s2"> </span><span class="nv">$a</span><span class="s2"> b c   </span><span class="p">&gt;&gt;</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>  <span class="c1"># OUTPUT: Â«(IntStr.new(42, &#34;42&#34;), &#34;b&#34;, &#34;c&#34;)â¤Â»</span>

<span class="c1"># Quote Protection</span>
<span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span> <span class="nb">say</span> <span class="p">Â«</span><span class="s2">  &#34;</span><span class="nv">$a</span><span class="s2"> b&#34; c  </span><span class="p">Â»</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>  <span class="c1"># OUTPUT: Â«(&#34;42 b&#34;, &#34;c&#34;)â¤Â»</span>
<span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span> <span class="nb">say</span> <span class="p">&lt;&lt;</span><span class="s2"> &#34;</span><span class="nv">$a</span><span class="s2"> b&#34; c </span><span class="p">&gt;&gt;</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>  <span class="c1"># OUTPUT: Â«(&#34;42 b&#34;, &#34;c&#34;)â¤Â»</span>
</code></pre></div><h3 id="shell-quoting-qx">Shell quoting: qx</h3>
<p>è¦å°†å­—ç¬¦ä¸²ä½œä¸ºå¤–éƒ¨ç¨‹åºè¿è¡Œï¼Œä¸ä»…å¯ä»¥å°†å­—ç¬¦ä¸²ä¼ é€’ç»™ <code>shell</code> æˆ– <code>run</code> å‡½æ•°ï¼Œè¿˜å¯ä»¥æ‰§è¡Œ shell å¼•ç”¨ã€‚ç„¶è€Œï¼Œæœ‰ä¸€äº›å¾®å¦™ä¹‹å¤„éœ€è¦è€ƒè™‘ã€‚<code>qx</code> å¼•å·ä¸æ’å…¥å˜é‡ã€‚å› æ­¤</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$world</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">there</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="k">q</span><span class="sa">x</span><span class="p">{</span><span class="s">echo &#34;hello $world&#34;</span><span class="p">}</span>
</code></pre></div><p>ä»…ä»…æ‰“å° <code>hello</code>. ç„¶è€Œ, å¦‚æœä½ åœ¨è°ƒç”¨ <code>raku</code> ä¹‹å‰å£°æ˜äº†ä¸€ä¸ªç¯å¢ƒå˜é‡, è¿™åœ¨ <code>qx</code> é‡Œæ˜¯å¯ç”¨çš„, ä¾‹å¦‚:</p>
<pre><code>WORLD=&quot;there&quot; raku
&gt; say qx{echo &quot;hello $WORLD&quot;}
</code></pre><p>ç°åœ¨ä¼šæ‰“å° <code>hello there</code>.</p>
<p>è°ƒç”¨ <code>qx</code> ä¼šè¿”å›ç»“æœ, æ‰€ä»¥è¿™ä¸ªç»“æœèƒ½è¢«èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ä»¥ä¾¿åæ¥ä½¿ç”¨:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$output</span> <span class="o">=</span> <span class="k">q</span><span class="sa">x</span><span class="p">{</span><span class="s">echo &#34;hello!&#34;</span><span class="p">};</span>
<span class="nb">say</span> <span class="nv">$output</span><span class="p">;</span>    <span class="c1"># hello!</span>
</code></pre></div><h3 id="shell-quoting-with-interpolation-qqx">Shell quoting with interpolation: qqx</h3>
<p>å¦‚æœå¸Œæœ›åœ¨å¤–éƒ¨å‘½ä»¤ä¸­ä½¿ç”¨ Raku å˜é‡çš„å†…å®¹ï¼Œé‚£ä¹ˆåº”è¯¥ä½¿ç”¨ <code>qqx</code> shell å¼•ç”¨ç»“æ„:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$world</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">there</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="k">qq</span><span class="sa">x</span><span class="p">{</span><span class="s2">echo &#34;hello </span><span class="nv">$world</span><span class="s2">&#34;</span><span class="p">};</span>  <span class="c1"># hello there</span>
</code></pre></div><p>å†ä¸€æ¬¡, å¤–éƒ¨å‘½ä»¤çš„è¾“å‡ºç»“æœå¯ä»¥ä¿å­˜åœ¨ä¸€ä¸ªå˜é‡ä¸­:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$word</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">cool</span><span class="p">&#34;;</span>
<span class="k">my</span> <span class="nv">$option</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">-i</span><span class="p">&#34;;</span>
<span class="k">my</span> <span class="nv">$file</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">/usr/share/dict/words</span><span class="p">&#34;;</span>
<span class="k">my</span> <span class="nv">$output</span> <span class="o">=</span> <span class="k">qq</span><span class="sa">x</span><span class="p">{</span><span class="s2">grep </span><span class="nv">$option</span><span class="s2"> </span><span class="nv">$word</span><span class="s2"> </span><span class="nv">$file</span><span class="p">};</span>

<span class="c1"># runs the command: grep -i cool /usr/share/dict/words</span>
<span class="nb">say</span> <span class="nv">$output</span><span class="p">;</span>      <span class="c1"># Cooleyâ¤Cooley&#39;sâ¤Coolidgeâ¤Coolidge&#39;sâ¤coolâ¤ ...</span>
</code></pre></div><p>æœ‰å…³æ‰§è¡Œå¤–éƒ¨å‘½ä»¤çš„æ›´å¥½æ–¹æ³•ï¼Œè¯·å‚è§ <a href="https://docs.raku.org/routine/run">run</a> å’Œ <a href="https://docs.raku.org/type/Proc::Async">Proc::Async</a>ã€‚</p>
<h3 id="heredocs-to">Heredocs: :to</h3>
<p>ä¸€ç§æ–¹ä¾¿çš„å†™å¤šè¡Œå­—ç¬¦ä¸²å­—é¢é‡çš„æ–¹å¼æ˜¯ <em>heredocs</em>ï¼Œå®ƒè®©ä½ é€‰æ‹©è‡ªå·±çš„åˆ†éš”ç¬¦:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="k">q</span><span class="sa">:to</span><span class="p">/END/;</span><span class="s">
</span><span class="s">Here is
</span><span class="s">some multi-line
</span><span class="s">string
</span><span class="s"></span><span class="p">END</span>
</code></pre></div><p>heredoc çš„å†…å®¹æ€»æ˜¯ä»ä¸‹ä¸€è¡Œå¼€å§‹ï¼Œæ‰€ä»¥ä½ å¯ä»¥(ä¹Ÿåº”è¯¥)å®Œæˆè¿™ä¸€è¡Œã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$escaped</span> <span class="o">=</span> <span class="nf">my-escaping-function</span><span class="p">(</span><span class="k">q</span><span class="sa">:to</span><span class="p">/TERMINATOR/,</span><span class="s"> language =&gt; &#39;html&#39;);
</span><span class="s">Here are the contents of the heredoc.
</span><span class="s">Potentially multiple lines.
</span><span class="s"></span><span class="p">TERMINATOR</span>
</code></pre></div><p>å¦‚æœç»ˆæ­¢åˆ†éš”ç¬¦ç¼©è¿›äº†, åŒç­‰æ•°é‡çš„ç¼©è¿›ä¼šä»å­—ç¬¦ä¸²å­—é¢é‡ä¸Šç§»é™¤. å› æ­¤ä¸‹é¢è¿™ä¸ª heredoc</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="k">q</span><span class="sa">:to</span><span class="p">/END/;</span><span class="s">
</span><span class="s">    Here is
</span><span class="s">    some multi line
</span><span class="s">        string
</span><span class="s">    </span><span class="p">END</span>
</code></pre></div><p>è¾“å‡º:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="n">Here</span> <span class="k">is</span>
<span class="nc">some</span> <span class="k">multi</span> <span class="nb">line</span>
    <span class="n">string</span>
</code></pre></div><p>heredoc åŒ…å«äº†ç»ˆæ­¢ç¬¦ä¹‹å‰çš„æ¢è¡Œç¬¦ã€‚</p>
<p>è¦å…è®¸å¯¹å˜é‡è¿›è¡Œæ’å€¼ï¼Œå¯ä»¥ä½¿ç”¨ <code>qq</code> å½¢å¼ï¼Œä½†å¦‚æœä¸æ˜¯å·²å®šä¹‰å˜é‡çš„æ ‡è¯†ç¬¦ï¼Œåˆ™å¿…é¡»è½¬ä¹‰å…ƒå­—ç¬¦ <code>{\</code> å’Œ <code>$</code>ã€‚ä¾‹å¦‚:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$f</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">db.7.3.8</span><span class="p">&#39;;</span>
<span class="k">my</span> <span class="nv">$s</span> <span class="o">=</span> <span class="k">qq</span><span class="sa">:to</span><span class="p">/END/;</span><span class="s2">
</span><span class="s2">option \{
</span><span class="s2">    file &#34;</span><span class="nv">$f</span><span class="s2">&#34;;
</span><span class="s2">};
</span><span class="s2"></span><span class="p">END</span>

<span class="nb">say</span> <span class="nv">$s</span><span class="p">;</span>
</code></pre></div><p>ä¼šäº§ç”Ÿï¼š</p>
<pre><code>option {
    file &quot;db.7.3.8&quot;;
};
</code></pre><p>æ‚¨å¯ä»¥åœ¨åŒä¸€è¡Œå¼€å§‹å¤šä¸ª heredocã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="p">(</span><span class="nv">$first</span><span class="o">,</span> <span class="nv">$second</span><span class="p">)</span> <span class="o">=</span> <span class="k">qq</span><span class="sa">:to</span><span class="p">/END1/,</span><span class="s2"> qq:to/END2/;
</span><span class="s2">  FIRST
</span><span class="s2">  MULTILINE
</span><span class="s2">  STRING
</span><span class="s2">  </span><span class="p">END1</span>
   <span class="n">SECOND</span>
   <span class="n">MULTILINE</span>
   <span class="n">STRING</span>
   <span class="n">END2</span>
</code></pre></div><h3 id="unquoting">Unquoting</h3>
<p>å­—é¢é‡å­—ç¬¦ä¸²å…è®¸ä½¿ç”¨è½¬ä¹‰åºåˆ—æ’å…¥å†…åµŒçš„å¼•ç”¨ç»“æ„ï¼Œä¾‹å¦‚:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$animal</span><span class="o">=</span><span class="p">&#34;</span><span class="s2">quaggas</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">These animals look like </span><span class="se">\qq</span><span class="p">[</span><span class="nv">$animal</span><span class="p">]&#39;;</span> <span class="c1"># OUTPUT: Â«These animals look like quaggasâ¤Â»</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">These animals are \qqw[$animal or zebras]</span><span class="p">&#39;;</span> <span class="c1"># OUTPUT: Â«These animals are quaggas or zebrasâ¤Â»</span>
</code></pre></div><p>åœ¨æœ¬ä¾‹ä¸­ï¼Œ<code>\qq</code> å°†åšåŒå¼•å·å†…æ’ï¼Œ<code>\qqw</code> æ–‡å­—å†…æ’ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œè½¬ä¹‰ä»»ä½•å…¶ä»–å¼•ç”¨ç»“æ„éƒ½å°†ä»¥ç›¸åŒçš„æ–¹å¼è¿›è¡Œï¼Œä»è€Œå…è®¸åœ¨å­—é¢é‡å­—ç¬¦ä¸²ä¸­è¿›è¡Œæ’å€¼ã€‚</p>
<h3 id="regexes">Regexes</h3>
<p>æœ‰å…³åœ¨ regexes ä¸­åº”ç”¨çš„å¼•ç”¨çš„ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href="https://docs.raku.org/language/regexes">æ­£åˆ™è¡¨è¾¾å¼æ–‡æ¡£</a>ã€‚</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/quote" term="quote" label="quote" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä¸­çš„è‡ªçœ]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-07-25-introspection-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-07-25-introspection-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Introspection in Raku</blockquote><p>Raku æ”¯æŒ&quot;æ³›å‹, roles å’Œ å¤šé‡åˆ†å‘&quot;, å®ƒä»¬éƒ½æ˜¯å¾ˆå¥½çš„ç‰¹ç‚¹, å¹¶ä¸”å·²ç»åœ¨å…¶å®ƒ advent calendar ä¸­å‘å¸ƒè¿‡äº†ã€‚</p>
<p>ä½†æ˜¯ä»Šå¤©æˆ‘ä»¬è¦çœ‹çš„æ˜¯ <strong>MOP</strong>ã€‚ &ldquo;MOP&rdquo; ä»£è¡¨ç€å…ƒå¯¹è±¡åè®®(&ldquo;Meta-Object Protocol&rdquo;)ã€‚é‚£æ„å‘³ç€, å®ƒä»¬å®é™…ä¸Šæ˜¯ä½ èƒ½ä»ç”¨æˆ·é‚£è¾¹æ”¹å˜çš„ä¸€éƒ¨åˆ†, è€Œä¸æ˜¯å¯¹è±¡ã€ç±»ç­‰å®šä¹‰è¯­è¨€çš„ä¸œè¥¿ã€‚</p>
<p>å®é™…ä¸Š, åœ¨ Rakuä¸­, ä½ å¯ä»¥ä¸ºç±»å‹æ·»åŠ æ–¹æ³•, ç§»é™¤æŸä¸ªæ–¹æ³•, åŒ…è£¹æ–¹æ³•, ä½¿ç”¨æ›´å¤šèƒ½åŠ›å¢å¼ºç±»(<a href="https://github.com/jnthn/oo-actors">OO::Actors</a> å’Œ <a href="https://github.com/jnthn/oo-monitors">OO::Monitors</a> å°±æ˜¯ä¸¤ä¸ªè¿™æ ·çš„ä¾‹å­), æˆ–è€…ä½ å¯ä»¥å®Œå…¨é‡å®šä¹‰å®ƒ(å¹¶ä¸”, ä¾‹å¦‚, ä½¿ç”¨ Ruby-like çš„å¯¹è±¡ç³»ç»Ÿã€‚<a href="https://github.com/edumentab/rakudo-and-nqp-internals-course">è¿™å„¿æœ‰ä¸ªä¾‹å­</a>)ã€‚</p>
<p>ä½†æ˜¯ä»Šå¤©, æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹ç¬¬ä¸€éƒ¨åˆ†: è‡ªçœã€‚åœ¨ç±»å‹åˆ›å»ºå®Œä¹‹åæŸ¥çœ‹å®ƒçš„ç±»å‹, äº†è§£å®ƒ, å¹¶ä½¿ç”¨è¿™äº›ä¿¡æ¯ã€‚</p>
<p>æˆ‘ä»¬å°†è¦åˆ›å»ºçš„æ¨¡å—æ˜¯åŸºäº <a href="https://github.com/vendethiel/sixcheck">Sixcheck</a> æ¨¡å—(ä¸€ä¸ª <a href="https://en.wikipedia.org/wiki/QuickCheck">QuickCheck-like</a> æ¨¡å—)çš„éœ€æ±‚: ä¸ºæŸä¸ªç±»å‹ç”Ÿæˆä¸€äº›éšæœºæ•°æ®, ç„¶åæŠŠæ•°æ®å–‚ç»™æˆ‘ä»¬æ­£æµ‹è¯•çš„å‡½æ•°, å¹¶æ£€æŸ¥æŸäº›åç½®æ¡ä»¶(post-condition)ã€‚</p>
<p>æ‰€ä»¥, æˆ‘ä»¬å…ˆå†™å‡ºç¬¬ä¸€ä¸ªç‰ˆæœ¬:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%special-cases</span><span class="p">{</span><span class="nb">Mu</span><span class="p">}</span> <span class="o">=</span>
  <span class="p">(</span><span class="nb">Int</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">-&gt;</span> <span class="p">{</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="nb">pick</span> <span class="p">}</span>,
  <span class="p">(</span><span class="nb">Str</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="k">-&gt;</span> <span class="p">{</span> <span class="p">(&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">z</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">pick</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;&#39;)</span> <span class="p">}</span>,
<span class="p">;</span>

<span class="k">sub</span> <span class="nf">generate-data</span><span class="p">(</span><span class="nb">Mu:U</span> \<span class="nb">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">%special-cases</span><span class="p">{</span><span class="nb">t</span><span class="p">}</span> <span class="o">??</span> <span class="nv">%special-cases</span><span class="p">{</span><span class="nb">t</span><span class="p">}()</span> <span class="o">!!</span> <span class="nb">t</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>
<span class="p">}</span>

<span class="nf">generate-data</span><span class="p">(</span><span class="nb">Int</span><span class="p">);</span>
</code></pre></div><p>æ³¨æ„ä»¥ä¸‹å‡ ç‚¹:</p>
<ul>
<li>æˆ‘ä»¬ç»™ <code>%special-cases</code> æŒ‡å®šäº†é”®çš„ç±»å‹ã€‚é‚£æ˜¯å› ä¸ºé»˜è®¤åœ°, é”®çš„ç±»å‹ä¸º <strong>Str</strong>ã€‚æ˜¾ç„¶åœ°, æˆ‘ä»¬ä¸æƒ³è®©æˆ‘ä»¬çš„ç±»å‹å­—ç¬¦ä¸²åŒ–ã€‚æˆ‘ä»¬å®é™…ä¸Šåšçš„æ˜¯æŒ‡å®šå®ƒä»¬ä¸º&quot;Mu&quot;çš„å­ç±»(è¿™åœ¨ç±»å‹&quot;é£Ÿç‰©é“¾&quot;çš„é¡¶ç«¯)ã€‚</li>
<li>æˆ‘ä»¬åœ¨ <strong>Int</strong> å’Œ <strong>Str</strong> å‘¨å›´æ”¾ä¸Šåœ†æ‹¬å·, ä»¥é¿å…å­—ç¬¦ä¸²åŒ–ã€‚</li>
<li>æˆ‘ä»¬åœ¨å‡½æ•°å‚æ•°ç±»å‹ä¸­ä½¿ç”¨äº† <code>:U</code>ã€‚é‚£æ„å‘³ç€é‚£ä¸ªå€¼å¿…é¡»æ˜¯æœªå®šä¹‰çš„(undefined)ã€‚ç±»å‹å¯¹è±¡(å°±åƒ Intã€Str ç­‰ç­‰)æ˜¯æœªå®šä¹‰çš„, æ‰€ä»¥å®ƒèƒ½æ»¡è¶³æˆ‘ä»¬(ä½ å¯èƒ½è§è¿‡ä¸€ä¸ªå« Nil çš„ä¸åŒçš„æœªçŸ¥å€¼)ã€‚</li>
<li>ç±»å‹å¯¹è±¡å®é™…ä¸Šæ˜¯å¯¹è±¡, å°±åƒå…¶å®ƒä»»ä½•å¯¹è±¡ä¸€æ ·ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨ç±»å‹å¯¹è±¡ä¸Šè°ƒç”¨ <code>.new</code> æ–¹æ³•, ä¾‹å¦‚, å®ƒå’Œç›´æ¥è°ƒç”¨ <code>Int.new</code> ç›¸åŒ(é‚£å¯¹ä¸€è‡´æ€§å’Œ <a href="https://design.raku.org/S09.html#Autovivification">autovivification</a> å¾ˆæœ‰ç”¨)ã€‚</li>
<li>æˆ‘ä»¬ä¸º <em>Int</em> å’Œ <em>Str</em> æä¾›äº† fallback, å› ä¸ºè°ƒç”¨ <em>Int.new</em> å’Œ <em>Str.new</em> ( 0 å’Œ &quot;&quot; )ä¸ä¼šåœ¨æˆ‘ä»¬åˆ›å»ºçš„æ•°æ®ä¸­ç»™æˆ‘ä»¬ä»»ä½•éšæœºåŒ–ã€‚</li>
<li>Raku åœ¨å‡½æ•°ä¸­è‡ªåŠ¨è¿”å›æœ€åä¸€ä¸ªè¡¨è¾¾å¼ã€‚æ‰€ä»¥ä¸éœ€è¦åœ¨é‚£å„¿æ”¾ä¸Šä¸€ä¸ª <em>return</em>ã€‚</li>
</ul>
<p>æˆ‘ä»¬ç”¨ä»£ç ç”Ÿæˆæ•°æ®, å…¬å¹³ä¸”å…¬æ­£ã€‚ä½†æ˜¯æˆ‘ä»¬éœ€è¦ç”Ÿæˆæ›´å¤šé‚£æ ·ç®€å•çš„æ•°æ®ã€‚</p>
<p>æˆ‘ä»¬è‡³å°‘éœ€è¦æ”¯æŒå¸¦æœ‰å±æ€§çš„ç±»: æˆ‘ä»¬æƒ³æŸ¥çœ‹å±æ€§åˆ—è¡¨, ä¸ºå®ƒä»¬çš„ç±»å‹ç”Ÿæˆæ•°æ®, å¹¶æŠŠå®ƒä»¬å–‚ç»™æ„é€ å™¨ã€‚</p>
<p>æˆ‘ä»¬è¦èƒ½å¤Ÿçœ‹åˆ°ç±»çš„å†…éƒ¨ã€‚ç”¨ Raku çš„æœ¯è¯­æ¥è¯´, æˆ‘ä»¬å°†è¦åˆ°è¾¾çš„æ˜¯å…ƒå¯¹è±¡åè®®(<a href="https://rakuadvent.wordpress.com/2010/12/22/day-22-the-meta-object-protocol/">Meta-Object Protocol</a>)ã€‚é¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç±»:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Article</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nb">Str</span> <span class="nv">$.title</span><span class="p">;</span>
    <span class="k">has</span> <span class="nb">Str</span> <span class="nv">$.content</span><span class="p">;</span>
    <span class="k">has</span> <span class="nb">Int</span> <span class="nv">$.view-count</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># æˆ‘ä»¬å¯ä»¥è¿™æ ·æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªå®ä¾‹</span>
<span class="n">Article</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">title</span>      <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">Raku Advent</span>, <span class="n">ç¬¬</span> <span class="mi">19</span> <span class="n">å¤©</span><span class="p">&#34;</span><span class="s2">,
</span><span class="s2">            content    =&gt; </span><span class="p">&#34;</span><span class="n">Magic</span><span class="o">!</span><span class="p">&#34;</span><span class="s2">,
</span><span class="s2">            view-count =&gt; 0
</span><span class="s2">            );
</span></code></pre></div><p>ä½†æ˜¯æˆ‘ä»¬ä¸æƒ³äº²æ‰‹åˆ›å»ºé‚£ä¸ªæ–‡ç«  (article)ã€‚æˆ‘ä»¬æƒ³æŠŠé‚£ä¸ª <strong>class</strong> Article ä¼ é€’ç»™æˆ‘ä»¬çš„ <em>generate-data</em> å‡½æ•°, å¹¶è¿”å›ä¸€ä¸ª Article(é‡Œé¢å¸¦æœ‰éšæœºæ•°æ®)ã€‚è®©æˆ‘ä»¬å›åˆ°æˆ‘ä»¬çš„ <em>REPL</em>&hellip;</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="n">Article</span><span class="o">.^</span><span class="nb">attributes</span><span class="p">;</span>         <span class="c1"># (Str $!title Str $!content Int $!view-count)</span>
<span class="nb">say</span> <span class="n">Article</span><span class="o">.^</span><span class="nb">attributes</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="nb">WHAT</span><span class="p">;</span> <span class="c1"># (Attribute)</span>
</code></pre></div><p>å¦‚æœä½ ç‚¹å‡»äº† MOP é“¾æ¥, ä½ ä¸ä¼šå¯¹æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªå«æœ‰ 3 ä¸ªå…ƒç´ çš„æ•°ç»„æ„Ÿåˆ°æƒŠè®¶ã€‚å¦‚æœä½ ä»æ—§å¯¹è¯¥è¯­æ³•æ„Ÿåˆ°æƒŠè®¶, é‚£ä¹ˆ <code>.^</code> æ˜¯å…ƒæ–¹æ³•è°ƒç”¨ã€‚æ„æ€æ˜¯ <code>a.^b</code> ä¼šè¢«è½¬æ¢ä¸º <code>a.HOW.b(a)</code>ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æƒ³çŸ¥é“æˆ‘ä»¬å¯ä»¥è®¿é—®åˆ°ä»€ä¹ˆ, æˆ‘ä»¬é—®å®ƒå°±æ˜¯äº†(ç§»é™¤äº†åŒ¿åçš„é‚£äº›):</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">Attribute</span><span class="o">.^</span><span class="nb">methods</span><span class="o">.</span><span class="nb">grep</span><span class="p">(</span><span class="o">*.</span><span class="nb">name</span> <span class="ow">ne</span> <span class="p">&#39;</span><span class="s1">&lt;anon&gt;</span><span class="p">&#39;);</span>
<span class="c1"># (compose apply_handles get_value set_value</span>
<span class="c1">#      container readonly package inlined WHY set_why Str gist)</span>

<span class="nb">Attribute</span><span class="o">.^</span><span class="nb">attributes</span> <span class="c1"># Method &#39;gist&#39; not found for invocant of class &#39;BOOTSTRAPATTR&#39;</span>
</code></pre></div><p>å“å†â€¦ çœ‹èµ·æ¥è¿™æœ‰ç‚¹å¤ª meta äº†ã€‚å¹¸å¥½, æˆ‘ä»¬èƒ½ä½¿ç”¨ Rakudo çš„ä¸€ä¸ªéå¸¸å¥½çš„å±æ€§: å®ƒçš„å¤§éƒ¨åˆ†éƒ½æ˜¯ç”¨ Raku å†™çš„! è¦æŸ¥çœ‹æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»€ä¹ˆ, æˆ‘ä»¬æŸ¥çœ‹<a href="https://github.com/rakudo/rakudo/blob/nom/src/core/Attribute.pm">æºä»£ç </a>å°±å¥½äº†:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># has Str $!name;</span>
<span class="o">...</span>
<span class="c1"># has Mu $!type;</span>
</code></pre></div><p>æˆ‘ä»¬å¾—åˆ°äº†é”®çš„åå­—, è¿˜æœ‰å»ç”Ÿæˆå€¼çš„ç±»å‹ã€‚è®©æˆ‘ä»¬çœ‹çœ‹&hellip;</p>
<pre><code>&gt; say Article.^attributes.map(*.name)
($!title $!content $!view-count)
&gt; say Article.^attributes.map(*.type)
((Str) (Str) (Int))
</code></pre><p>å¤©æ‰! çœ‹èµ·æ¥æ˜¯æ­£ç¡®çš„ã€‚(å¦‚æœä½ æƒ³çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘ä»¬å¾—åˆ° <code>$!</code>ï¼ˆç§æœ‰çš„ï¼‰ twigils, é‚£æ˜¯å› ä¸º <code>$.</code> åªæ„å‘³ç€å°†ä¼šç”Ÿæˆçš„ä¸€ä¸ª getter æ–¹æ³•)ã€‚å±æ€§æœ¬èº«ä»ç„¶æ˜¯ç§æœ‰çš„, å¹¶ä¸”åœ¨ç±»ä¸­æ˜¯å¯è®¿é—®çš„ã€‚</p>
<p>ç°åœ¨, æˆ‘ä»¬å”¯ä¸€è¦åšçš„äº‹æƒ…å°±æ˜¯åˆ›å»ºä¸€ä¸ªå¾ªç¯&hellip;</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%args</span><span class="p">;</span>

<span class="k">for</span> <span class="n">Article</span><span class="o">.^</span><span class="nb">attributes</span> <span class="k">-&gt;</span> <span class="nv">$attr</span> <span class="p">{</span>
    <span class="nv">%args</span><span class="p">{</span><span class="nv">$attr</span><span class="o">.</span><span class="nb">name</span><span class="o">.</span><span class="nb">substr</span><span class="p">(</span><span class="mi">2</span><span class="p">)}</span> <span class="o">=</span> <span class="nf">generate-data</span><span class="p">(</span><span class="nv">$attr</span><span class="o">.</span><span class="nb">type</span><span class="p">);</span>
<span class="p">}</span>
<span class="nb">say</span> <span class="nv">%args</span><span class="o">.</span><span class="nb">perl</span><span class="p">;</span>
</code></pre></div><p>è¿™æ˜¯ä¸€ä¸ªå°†ä¼šæ‰“å°ä»€ä¹ˆçš„ä¾‹å­:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">{:</span><span class="s">content</span><span class="p">(&#34;</span><span class="s2">muenglhaxrvykfdjzopqbtwisc</span><span class="p">&#34;)</span><span class="o">,</span> <span class="p">:</span><span class="s">title</span><span class="p">(&#34;</span><span class="s2">rfpjndgohmasuwkyzebixqtvcl</span><span class="p">&#34;)</span><span class="o">,</span> <span class="p">:</span><span class="s">view-count</span><span class="p">(</span><span class="mi">45</span><span class="p">)}</span>
</code></pre></div><p>æ¯æ¬¡ä½ è¿è¡Œä½ çš„ä»£ç ä½ éƒ½ä¼šå¾—åˆ°ä¸åŒçš„ç»“æœ(ç„¶è€Œæˆ‘ä¸è®¤ä¸ºå®ƒä¼šåˆ›å»ºä¸€ç¯‡å€¼å¾—é˜…è¯»çš„æ–‡ç« â€¦)ã€‚å‰©ä¸‹å”¯ä¸€è¦åšçš„å°±æ˜¯æŠŠå®ƒä»¬ä¼ é€’ç»™ Article çš„æ„é€ å‡½æ•°:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="n">Article</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="o">|</span><span class="nv">%args</span><span class="p">);</span>
</code></pre></div><p>(å‰ç¼€ <code>|</code> å…è®¸æˆ‘ä»¬æŠŠ <em>%args</em> ä½œä¸ºå…·åå‚æ•°ä¼ é€’, è€Œä¸æ˜¯å•ä¸ªä½ç½®å‚æ•°)ã€‚å†æ¬¡, ä½ åº”è¯¥ä¼šæ‰“å°è¿™äº›ä¸œè¥¿:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="n">Article</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">title</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">kyvphxqmejtuicrbsnfoldgzaw</span><span class="p">&#34;</span>, <span class="s">content</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">jqbtcyovxlngpwikdszfmeuahr</span><span class="p">&#34;</span>, <span class="s">view-count</span> <span class="o">=&gt;</span> <span class="mi">26</span><span class="p">)</span>
</code></pre></div><p>å‘€! æˆ‘ä»¬è®¾æ³•åœ¨ä¸äº†è§£ Article çš„æƒ…å†µä¸‹èƒ¡ä¹±åœ°(blindly)åˆ›å»ºäº†ä¸€ä¸ª Article å®ä¾‹ã€‚ æˆ‘ä»¬çš„ä»£ç èƒ½å¤Ÿç”¨äºä¸ºä»»ä½•æœŸæœ›ä¼ é€’å®ƒçš„ç±»å±æ€§çš„æ„é€ å‡½æ•°ç”Ÿæˆæ•°æ®ã€‚å¥½äº†!</p>
<p>PS: ç•™ä¸ªä½œä¸š! ç§»åŠ¨åˆ° generate-data å‡½æ•°, ä»¥è‡³äºæˆ‘ä»¬èƒ½ç»™ Article æ·»åŠ ä¸€ä¸ª User <code>$.author</code> å±æ€§, å¹¶ä¸”æ„å»ºå¥½è¿™ä¸ªå‡½æ•°ã€‚ç¥ä½ å¥½è¿!</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/introspection" term="introspection" label="introspection" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä¸­çš„è§’è‰²å†²çª]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-11-16-roles-conflict-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2016-01-21-protocol-in-swift-and-roles-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="Swift ä¸­çš„ protocol å’Œ Raku ä¸­çš„ roles ä¸€ä¾‹" />
            
                <id>https://ohmyweekly.github.io/notes/2015-11-16-roles-conflict-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Roles Conflict in Raku</blockquote><p>å­¦ä¼šäº†æ€ä¹ˆåˆ›å»ºç±», æˆ‘ä»¬ç»§ç»­ç”¨å®ƒæ¥æ„å»ºæˆ‘ä»¬çš„ä¸­å¿ƒå†…å®¹:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Hammer</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">hammer</span><span class="p">(</span><span class="nv">$stuff</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">You hammer on </span><span class="nv">$stuff</span><span class="s2">. BAM BAM BAM!</span><span class="p">&#34;;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Gavel</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">hammer</span><span class="p">(</span><span class="nv">$stuff</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">You hammer on </span><span class="nv">$stuff</span><span class="s2">. BAM BAM BAM!</span><span class="p">&#34;;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Mallet</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">hammer</span><span class="p">(</span><span class="nv">$stuff</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">You hammer on </span><span class="nv">$stuff</span><span class="s2">. BAM BAM BAM!</span><span class="p">&#34;;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>ä½†æ˜¯æ³¨æ„åˆ°äº†å—ï¼Ÿè¿™ä¸‰ä¸ªæ–¹æ³•åŒ…å«äº†åŒæ ·çš„æ–¹æ³•, åœ¨ç±»ä¸­é‡å¤äº†ã€‚æˆ‘ä»¬å¿…é¡»é‚£æ ·åšå¦‚æœæˆ‘ä»¬æƒ³è®©æ¯ä¸ª <strong>Hammar</strong>ã€<strong>Gavel</strong> å’Œ <strong>Mallet</strong> æœ‰èƒ½åŠ›å‡»æ‰“çš„è¯ã€‚ï¼ˆå¹¶ä¸”é‚£æ˜¯åˆç†çš„ï¼‰ã€‚ä½†æ˜¯é—æ†¾çš„æ˜¯æˆ‘ä»¬ä¸å¾—ä¸æŠŠé‚£ä¸ªæ–¹æ³•ä¸€å¼ä¸‰ä»½ã€‚</p>
<p>ä¸ºä»€ä¹ˆé—æ†¾ï¼Ÿ å› ä¸ºä¸€æ–¹é¢åœ¨çœŸå®ä¸–ç•Œä¸­, æ–¹æ³•å¹¶ä¸æ˜¯å¾ˆå½¼æ­¤ç›¸ä¼¼, æœ‰ä¸€å¤©ä½ å†³å®šåœ¨ <strong>hammer</strong> æ–¹æ³•ä¸­æ›´æ”¹æŸäº›ä¸œè¥¿, å¹¶æ²¡æœ‰æ„è¯†åˆ°è¿™ä¸ªæ–¹æ³•åœ¨ä¸‰ä¸ªä¸åŒçš„åœ°æ–¹&hellip; è¿™å¯¼è‡´äº†ä¸€å †ç—›è‹¦å’Œéš¾å—ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬çš„æ–°ç©å…·, ç±», å±•ç°å‡ºäº†ä¸€ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬æƒ³åœ¨æ¯ä¸ªç±»ä¸­é‡ç”¨ hammer æ–¹æ³•ã€‚ä¸€ä¸ªæ–°çš„æ¦‚å¿µ, <strong>role</strong> æ¥æ‹¯æ•‘æˆ‘ä»¬æ¥äº†:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">Hammering</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">hammer</span><span class="p">(</span><span class="nv">$stuff</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">You hammer on </span><span class="nv">$stuff</span><span class="s2">. BAM BAM BAM!</span><span class="p">&#34;;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>è™½ç„¶ç±»ç»å¸¸ä»¥ä¸€ä¸ªåˆé€‚çš„åè¯å‘½å, ä½†æ˜¯ roles ç»å¸¸ä»¥ä¸€ä¸ªåˆ†è¯å‘½å, ä¾‹å¦‚ <strong>Hammering</strong>ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªå¿…é¡»éµå®ˆçš„è§„åˆ™, ä½†æ˜¯å®ƒæ˜¯ä¸€ä¸ªå¥½çš„ç»éªŒæ³•åˆ™ã€‚ç°åœ¨ç±»çš„å®šä¹‰å˜çš„ç®€å•äº†:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Hammer</span> <span class="k">does</span> <span class="nc">Hammering</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">class</span> <span class="nc">Gavel</span>  <span class="k">does</span> <span class="nc">Hammering</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">class</span> <span class="nc">Mallet</span> <span class="k">does</span> <span class="nc">Hammering</span> <span class="p">{</span> <span class="p">}</span>
</code></pre></div><p>æ˜¯çš„, æˆ‘ä»¬å–œæ¬¢é‚£æ ·ã€‚</p>
<p>è¿™å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ æˆ‘ä»¬åœ¨ç±»ä¸Šä½¿ç”¨ <strong>does</strong> æ˜¯å¹²ä»€ä¹ˆç”¨çš„ï¼Ÿ role å®šä¹‰ä¸­çš„æ‰€æœ‰æ–¹æ³•éƒ½è¢«æ‹·è´åˆ°ç±»å®šä¹‰ä¸­ã€‚å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªæ‹·è´æ“ä½œ, æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å°½å¯èƒ½å¤šçš„ç±»ã€‚</p>
<p>æ‰€ä»¥, æˆ‘ä»¬åšçš„æ˜¯: å½“æˆ‘ä»¬æƒ³é‡ç”¨æ–¹æ³•çš„æ—¶å€™æŠŠæ–¹æ³•æ”¾è¿› roles é‡Œé¢ã€‚</p>
<p>ä½†æ˜¯å¥½å¤„ä¸æ­¢è¿™ä¸€ç‚¹å„¿ã€‚è‡³å°‘æœ‰ä¸¤ä¸ªå¥½å¤„:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$hammer</span> <span class="o">=</span> <span class="n">Hammer</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>    <span class="c1"># create a new hammer object</span>
<span class="nb">say</span> <span class="nv">$hammer</span> <span class="o">~~</span> <span class="n">Hammer</span><span class="p">;</span>      <span class="c1"># &#34;Bool::True&#34; -- yes, this we know</span>
<span class="nb">say</span> <span class="nv">$hammer</span> <span class="o">~~</span> <span class="n">Hammering</span><span class="p">;</span>   <span class="c1"># &#34;Bool::True&#34; -- ooh!</span>
</code></pre></div><p>æ‰€ä»¥ <code>$hammer</code> çŸ¥é“å®ƒéµå®ˆäº†(does) <strong>Hammering</strong>, æˆ‘ä»¬ç°åœ¨ä¸ä»…çŸ¥é“äº†å¯¹è±¡å±äºå“ªä¸ªç±», è¿˜çŸ¥é“äº†å¯¹è±¡å¹¶å…¥äº†ä»€ä¹ˆ roleã€‚è¿™å¾ˆæœ‰ç”¨å¦‚æœæˆ‘ä»¬ä¸ç¡®å®šæˆ‘ä»¬å¤„ç†çš„æ˜¯ä»€ä¹ˆç±»å‹çš„å¯¹è±¡:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="nv">$unkown_object</span> <span class="o">~~</span> <span class="n">Hammering</span> <span class="p">{</span>
    <span class="nv">$unknown_object</span><span class="o">.</span><span class="nf">hammer</span><span class="p">(&#34;</span><span class="s2">ç ¸åœ¨é’‰å­ä¸Š</span><span class="p">&#34;);</span>     <span class="c1"># will always work</span>
<span class="p">}</span>
</code></pre></div><p>ä¸€ä¸ªç±»èƒ½ä¸€æ¬¡æ¥æ”¶å‡ ä¸ª roles å—ï¼Ÿ æ˜¯çš„, å®ƒå¯ä»¥:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">Flying</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">fly</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Whooosh!</span><span class="p">&#34;;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">FlyingHammer</span> <span class="k">does</span> <span class="nc">Hammering</span> <span class="k">does</span> <span class="nc">Flying</span> <span class="p">{</span> <span class="p">}</span>
</code></pre></div><p>è®©ä¸€ä¸ªç±»åƒé‚£æ ·éµå®ˆå‡ ä¸ª roles å¼•å…¥äº†ä¸€ä¸ªæœ‰æ„æ€çš„å¯èƒ½: å†²çª, å½“æ¥è‡ªä¸¤ä¸ªä¸åŒ roles çš„ä¸¤ä¸ªåŒåæ–¹æ³•å°è¯•å é¢†åŒä¸€ä¸ªç±»æ—¶ã€‚è¿™æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ å¥½å§, è‡³å°‘æœ‰ 3 ç§å¯èƒ½:</p>
<ul>
<li>
<ol>
<li>ç¬¬ä¸€ä¸ª role èµ¢äº†ã€‚ å®ƒçš„æ–¹æ³•ä½è¿›äº†ç±»ä¸­</li>
</ol>
</li>
<li>
<ol>
<li>æœ€åä¸€ä¸ª role èµ¢äº†ã€‚ å®ƒè¦†ç›–äº†ä¹‹å‰çš„æ–¹æ³•</li>
</ol>
</li>
<li>
<ol>
<li>ç¼–è¯‘å¤±è´¥ã€‚å†²çªå¿…é¡»è¢«è§£å†³ã€‚</li>
</ol>
</li>
</ul>
<p>è¿™ç§æƒ…å†µä¸‹é€‰é¡¹ 3  åº”è¯¥æ˜¯æ­£ç¡®ç­”æ¡ˆã€‚åŸå› å’Œä¹‹å‰ç›¸åŒ: å› ä¸ºç±»å’Œå·¥ç¨‹è¶Šæ¥è¶Šåºå¤§, ç¨‹åºå‘˜å¯èƒ½æ„è¯†ä¸åˆ°ä¸¤ä¸ª role ä¹‹é—´åœ¨å“ªå„¿å‘ç”Ÿå†²çªã€‚æ‰€ä»¥æˆ‘ä»¬æ ‡è®°äº†å®ƒã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">Sleeping</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">lie</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">æ°´å¹³èººä¸‹</span><span class="p">&#34;;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">role</span> <span class="nc">Lying</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">lie</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">è¯´è°...</span><span class="p">&#34;;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">SleepingLiar</span> <span class="k">does</span> <span class="nc">Sleeping</span> <span class="k">does</span> <span class="nc">Lying</span> <span class="p">{</span> <span class="p">}</span>    <span class="c1"># å†²çª!</span>

</code></pre></div><p>ä¸‹ä¸€ä¸ªé—®é¢˜, é‚£ä¹ˆ: å½“åœ¨ç±»ä¸­æœ‰  role å†²çªæ—¶, æˆ‘ä»¬æ€ä¹ˆä¿®å¤å®ƒï¼Ÿ ç®€å•: åœ¨ç±»ä¸­è‡ªå·±å®šä¹‰ä¸€ä¸ªåŒåçš„æ–¹æ³•:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku">
<span class="k">class</span> <span class="nc">SleepingLiar</span> <span class="k">does</span> <span class="nc">Sleeping</span> <span class="k">does</span> <span class="nc">Lying</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">lie</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Lying in my sleep....</span><span class="p">&#34;;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>å¦‚æœä½ æƒ³ä»ä¸€ä¸ªè´´åˆ«çš„ role ä¸­è°ƒç”¨ä¸€ä¸ªæ–¹æ³•, è¯­æ³•æ˜¯è¿™æ ·çš„:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">SleepingLiar</span> <span class="k">does</span> <span class="nc">Sleeping</span> <span class="k">does</span> <span class="nc">Lying</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">lie</span> <span class="p">{</span>
        <span class="nb">self</span><span class="o">.</span><span class="nf">Sleeping::lie</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>è¿™å°±æ˜¯ rolesã€‚å®ƒä»¬æŠŠå¯é‡ç”¨çš„è¡Œä¸ºæ··åˆè¿›ç±»ä¸­ã€‚</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/roles" term="roles" label="roles" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä¸­çš„é¢å‘å¯¹è±¡]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-06-15-object-orientation-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-06-15-object-orientation-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Object Orientation in Raku</blockquote><p>Raku ä¸º<a href="https://en.wikipedia.org/wiki/Object-oriented_programming">é¢å‘å¯¹è±¡ç¼–ç¨‹(OOP)</a>æä¾›å¼ºå¤§æ”¯æŒã€‚å°½ç®¡ Raku å…è®¸ç¨‹åºå‘˜ä»¥å¤šç§èŒƒå¼è¿›è¡Œç¼–ç¨‹, ä½†é¢å‘å¯¹è±¡ç¼–ç¨‹æ˜¯è¯¥è¯­è¨€çš„æ ¸å¿ƒã€‚</p>
<p>Raku å¸¦æœ‰ä¸°å¯Œçš„é¢„å®šä¹‰ç±»å‹, å¯åˆ†ä¸ºä¸¤ç±»ï¼šå¸¸è§„ç±»å‹å’Œ<a href="https://docs.raku.org/language/nativetypes">åŸç”Ÿç±»å‹</a>ã€‚æ‰€æœ‰ä½ èƒ½å­˜å‚¨åˆ°å˜é‡ä¸­çš„ä¸œè¥¿è¦ä¹ˆæ˜¯ä¸€ä¸ªåŸç”Ÿçš„ value, è¦ä¹ˆæ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚è¿™åŒ…æ‹¬å­—é¢å€¼ã€ç±»å‹ï¼ˆç±»å‹å¯¹è±¡ï¼‰ã€code å’Œå®¹å™¨ã€‚</p>
<p>åŸç”Ÿç±»å‹ç”¨äº<code>åº•å±‚ç±»å‹</code>ï¼ˆä¾‹å¦‚ <code>uint64</code>ï¼‰ã€‚å°½ç®¡åŸç”Ÿç±»å‹æ²¡æœ‰å’Œå¯¹è±¡åŒæ ·çš„åŠŸèƒ½, å¦‚æœåœ¨å…¶ä¸Šè°ƒç”¨æ–¹æ³•, å®ƒä»¬ä¹Ÿä¼šè‡ªåŠ¨è£…å…¥æ™®é€šå¯¹è±¡ã€‚</p>
<p>ä¸€åˆ‡ä¸æ˜¯åŸç”Ÿå€¼çš„ä¸œè¥¿éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚å¯¹è±¡ç¡®å®å…è®¸<a href="https://en.wikipedia.org/wiki/Object-oriented_programming#Inheritance_and_behavioral_subtyping">ç»§æ‰¿</a>å’Œ<a href="https://en.wikipedia.org/wiki/Object-oriented_programming#Encapsulation">å°è£…</a>ã€‚</p>
<h2 id="ä½¿ç”¨å¯¹è±¡">ä½¿ç”¨å¯¹è±¡</h2>
<p>è¦åœ¨å¯¹è±¡ä¸Šè°ƒç”¨æ–¹æ³•, è¯·åœ¨å¯¹è±¡åä¸Šæ·»åŠ ä¸€ä¸ªç‚¹, ç„¶åæ·»åŠ æ–¹æ³•åç§°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">abc</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">uc</span><span class="p">;</span>
<span class="c1"># OUTPUT: Â«ABCâ¤Â» </span>
</code></pre></div><p>è¿™å°†åœ¨ &ldquo;abc&rdquo; ä¸Šè°ƒç”¨ <code>uc</code> æ–¹æ³•, è¿™æ˜¯ä¸€ä¸ª <code>Str</code> ç±»å‹çš„å¯¹è±¡ã€‚è¦ä¸ºæ–¹æ³•æä¾›å‚æ•°, è¯·åœ¨æ–¹æ³•åé¢çš„æ‹¬å·å†…æ·»åŠ å‚æ•°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$formatted-text</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">Fourscore and seven years ago...</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">indent</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
<span class="nb">say</span> <span class="nv">$formatted-text</span><span class="p">;</span>
<span class="c1"># OUTPUT: Â«        Fourscore and seven years ago...Â» </span>
</code></pre></div><p><code>$formatted-text</code> ç°åœ¨åŒ…å«ä¸Šé¢çš„æ–‡æœ¬, ä½†ç¼©è¿›äº†8ä¸ªç©ºæ ¼ã€‚</p>
<p>å¤šä¸ªå‚æ•°ç”±é€—å·åˆ†éš”ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@words</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">Abe</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">Lincoln</span><span class="p">&#34;;</span>
<span class="nv">@words</span><span class="o">.</span><span class="nb">push</span><span class="p">(&#34;</span><span class="s2">said</span><span class="p">&#34;</span><span class="o">,</span> <span class="nv">$formatted-text</span><span class="o">.</span><span class="nb">comb</span><span class="p">(/</span><span class="se">\w</span><span class="o">+</span><span class="p">/));</span>
<span class="nb">say</span> <span class="nv">@words</span><span class="p">;</span>
<span class="c1"># OUTPUT: Â«[Abe Lincoln said (Fourscore and seven years ago)]â¤Â» </span>
</code></pre></div><p>ç±»ä¼¼åœ°, å¯ä»¥é€šè¿‡åœ¨æ–¹æ³•åæ”¾ç½®å†’å·å¹¶ä½¿ç”¨é€—å·åˆ†éš”å‚æ•°åˆ—è¡¨æ¥æŒ‡å®šå¤šä¸ªå‚æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nv">@words</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;</span><span class="s1">--</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">subst</span><span class="o">:</span> <span class="p">&#39;</span><span class="s1">years</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">DAYS</span><span class="p">&#39;;</span>
<span class="c1"># OUTPUT: Â«Abe--Lincoln--said--Fourscore and seven DAYS agoâ¤Â» </span>
</code></pre></div><p>å¦‚æœè¦åœ¨æ²¡æœ‰æ‹¬å·çš„æƒ…å†µä¸‹ä¼ é€’å‚æ•°, åˆ™å¿…é¡»åœ¨æ–¹æ³•ä¹‹åæ·»åŠ ä¸€ä¸ª <code>:</code>, å› æ­¤æ²¡æœ‰å†’å·æˆ–æ‹¬å·çš„æ–¹æ³•è°ƒç”¨æ˜ç¡®åœ°æ˜¯æ²¡æœ‰å‚æ•°åˆ—è¡¨çš„æ–¹æ³•è°ƒç”¨ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="mi">4</span><span class="o">.</span><span class="nb">log</span><span class="o">:</span>   <span class="p">;</span> <span class="c1"># OUTPUT: Â«1.38629436111989â¤Â» ( natural logarithm of 4 ) </span>
<span class="nb">say</span> <span class="mi">4</span><span class="o">.</span><span class="nb">log</span><span class="o">:</span> <span class="o">+</span><span class="mi">2</span><span class="p">;</span> <span class="c1"># OUTPUT: Â«2â¤Â» ( base-2 logarithm of 4 ) </span>
<span class="nb">say</span> <span class="mi">4</span><span class="o">.</span><span class="nb">log</span>  <span class="o">+</span><span class="mi">2</span><span class="p">;</span> <span class="c1"># OUTPUT: Â«3.38629436111989â¤Â» ( natural logarithm of 4, plus 2 )</span>
</code></pre></div><p>è®¸å¤šçœ‹èµ·æ¥ä¸åƒæ–¹æ³•è°ƒç”¨çš„æ“ä½œï¼ˆä¾‹å¦‚, æ™ºèƒ½åŒ¹é…æˆ–å°†å¯¹è±¡æ’å€¼åˆ°å­—ç¬¦ä¸²ä¸­ï¼‰å¯èƒ½ä¼šå¯¼è‡´æ–¹æ³•è°ƒç”¨ã€‚</p>
<p>æ–¹æ³•å¯ä»¥è¿”å›å¯å˜å®¹å™¨, åœ¨è¿™ç§æƒ…å†µä¸‹, æ‚¨å¯ä»¥åˆ†é…æ–¹æ³•è°ƒç”¨çš„è¿”å›å€¼ã€‚è¿™æ˜¯ä½¿ç”¨å¯¹è±¡çš„å¯è¯»å†™å±æ€§çš„æ–¹å¼ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="vg">$*IN</span><span class="o">.</span><span class="nb">nl-in</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">\r\n</span><span class="p">&#34;;</span>
</code></pre></div><p>åœ¨è¿™é‡Œ, æˆ‘ä»¬åœ¨ <code>$*IN</code> å¯¹è±¡ä¸Šè°ƒç”¨ <code>nl-in</code> æ–¹æ³•, ä¸å¸¦å‚æ•°, å¹¶ä½¿ç”¨ <code>=</code> è¿ç®—ç¬¦å°†å…¶èµ‹å€¼ç»™å®ƒè¿”å›çš„å®¹å™¨ã€‚</p>
<p>æ‰€æœ‰å¯¹è±¡éƒ½æ”¯æŒç±»<a href="https://docs.raku.org/type/Mu">Mu</a>çš„æ–¹æ³•, å®ƒæ˜¯å±‚æ¬¡ç»“æ„çš„æ ¹ã€‚æ‰€æœ‰å¯¹è±¡éƒ½æ¥è‡ª <code>Mu</code>ã€‚</p>
<h2 id="ç±»å‹å¯¹è±¡">ç±»å‹å¯¹è±¡</h2>
<p>ç±»å‹æœ¬èº«æ˜¯å¯¹è±¡, ä½ å¯ä»¥ä½¿ç”¨ç±»å‹çš„åå­—è·å–ç±»å‹å¯¹è±¡:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$int-type-obj</span> <span class="o">=</span> <span class="nb">Int</span><span class="p">;</span>
</code></pre></div><p>ä½ å¯ä»¥é€šè¿‡è°ƒç”¨ <code>WHAT</code> æ–¹æ³•æŸ¥çœ‹ä»»ä½•å¯¹è±¡çš„ type object(å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªæ–¹æ³•å½¢å¼çš„å®):</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$int-type-obj</span> <span class="o">=</span> <span class="mi">1</span><span class="o">.</span><span class="nb">WHAT</span><span class="p">;</span>
</code></pre></div><p>ä½¿ç”¨ <a href="https://docs.raku.org/routine/===">===</a> æ’ç­‰è¿ç®—ç¬¦å¯ä»¥æ¯”è¾ƒç±»å‹å¯¹è±¡(<a href="https://docs.raku.org/type/Mu">Mu</a>é™¤å¤–)çš„ç›¸ç­‰æ€§ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">f</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nv">$x</span><span class="o">.</span><span class="nb">WHAT</span> <span class="o">===</span> <span class="nb">Int</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">you passed an Int</span><span class="p">&#39;;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">you passed a subtype of Int</span><span class="p">&#39;;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>è™½ç„¶, åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹, <a href="https://docs.raku.org/routine/isa"><code>.isa</code></a>æ–¹æ³•å°±è¶³å¤Ÿäº†ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">f</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nv">$x</span><span class="o">.</span><span class="nb">isa</span><span class="p">(</span><span class="nb">Int</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">...</span>
    <span class="p">}</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre></div><p>å­ç±»å‹å¯ä»¥ä½¿ç”¨ <a href="https://docs.raku.org/language/operators#infix_~~">smartmatching</a> æ¥æ£€æŸ¥ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="nv">$type</span> <span class="o">~~</span> <span class="nb">Real</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">$type contains Real or a subtype thereof</span><span class="p">&#39;;</span>
<span class="p">}</span>
</code></pre></div><h2 id="ç±»">ç±»</h2>
<p>ä½¿ç”¨ <code>class</code> å…³é”®å­—è¿›è¡Œç±»çš„å£°æ˜, é€šå¸¸åè·Ÿç±»åï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Journey</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre></div><p>æ­¤å£°æ˜ä¼šåˆ›å»ºç±»å‹å¯¹è±¡å¹¶å°†å…¶å®‰è£…åœ¨åå­— <code>Journey</code> ä¸‹çš„å½“å‰åŒ…å’Œå½“å‰è¯æ³•ä½œç”¨åŸŸä¸­ã€‚æ‚¨è¿˜å¯ä»¥é€šè¿‡è¯æ³•å£°æ˜ç±»</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="k">class</span> <span class="nc">Journey</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre></div><p>è¿™é™åˆ¶äº†å®ƒä»¬å¯¹å½“å‰è¯æ³•èŒƒå›´çš„å¯è§æ€§, å¦‚æœè¯¥ç±»æ˜¯åµŒå¥—åœ¨æ¨¡å—æˆ–å¦ä¸€ä¸ªç±»ä¸­çš„å®ç°ç»†èŠ‚, è¿™å¯èƒ½å¾ˆæœ‰ç”¨ã€‚</p>
<h2 id="å±æ€§">å±æ€§</h2>
<p>å±æ€§å­˜åœ¨äºæ¯ä¸ªç±»çš„å®ä¾‹ä¸­ã€‚å±æ€§ä¸­å­˜å‚¨ç€å¯¹è±¡çš„çŠ¶æ€ã€‚åœ¨ Raku ä¸­, ä¸€åˆ‡å±æ€§éƒ½æ˜¯<code>ç§æœ‰çš„</code>.  å®ƒä»¬ä¸€èˆ¬ä½¿ç”¨ <code>has</code> å…³é”®å­—å’Œ <code>!</code> twigil è¿›è¡Œå£°æ˜ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Journey</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$!origin</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$!destination</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">@!travellers</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$!notes</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>è™½ç„¶æ²¡æœ‰å…¬å…±(ç”šè‡³ä¿æŠ¤å±æ€§)å±æ€§, ä¸è¿‡æœ‰ä¸€ç§æ–¹å¼å¯ä»¥è‡ªåŠ¨ç”Ÿæˆè®¿é—®å™¨æ–¹æ³•: ä½¿ç”¨ <code>.</code> twigil ä»£æ›¿ <code>!</code> twigil ã€‚(é‚£ä¸ª <code>.</code> åº”è¯¥è®©ä½ æƒ³èµ·äº†æ–¹æ³•è°ƒç”¨)ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Journey</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.origin</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.destination</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">@!travellers</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.notes</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>è¿™é»˜è®¤æä¾›åªè¯»è®¿é—®å™¨, ä¸ºäº†å…è®¸æ›´æ”¹å±æ€§, è¦æ·»åŠ  <code>is rw</code> ç‰¹æ€§:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Journey</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.origin</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.destination</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">@!travellers</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.notes</span> <span class="k">is</span> <span class="k">rw</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>ç°åœ¨, <code>Journey</code>å¯¹è±¡åˆ›å»ºä¹‹å, å®ƒçš„ <code>.origin</code>, <code>.destination</code> å’Œ <code>.notes</code> éƒ½èƒ½ä»ç±»çš„å¤–éƒ¨è®¿é—®, ä½†åªæœ‰ <code>.notes</code> å¯ä»¥è¢«ä¿®æ”¹ã€‚</p>
<p>å¦‚æœåœ¨æ²¡æœ‰æŸäº›å±æ€§ï¼ˆä¾‹å¦‚ <code>origin</code> æˆ– <code>destination</code>ï¼‰çš„æƒ…å†µä¸‹å®ä¾‹åŒ–å¯¹è±¡, æˆ‘ä»¬å¯èƒ½æ— æ³•è·å¾—æƒ³è¦çš„ç»“æœã€‚è¦é˜²æ­¢è¿™ç§æƒ…å†µ, è¯·æä¾›é»˜è®¤å€¼æˆ–é€šè¿‡ä½¿ç”¨<a href="https://docs.raku.org/routine/is%20required">is required</a> trait æ¥æ ‡è®°å±æ€§ä»¥ç¡®ä¿åœ¨å¯¹è±¡åˆ›å»ºæ—¶è®¾ç½®å±æ€§ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Journey</span> <span class="p">{</span>
    <span class="c1"># error if origin is not provided </span>
    <span class="k">has</span> <span class="nv">$.origin</span> <span class="k">is</span> <span class="k">required</span><span class="p">;</span>
    <span class="c1"># set the destination to Orlando as default (unless that is the origin!) </span>
    <span class="k">has</span> <span class="nv">$.destination</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="nf">origin</span> <span class="ow">eq</span> <span class="p">&#39;</span><span class="s1">Orlando</span><span class="p">&#39;</span> <span class="o">??</span> <span class="p">&#39;</span><span class="s1">Kampala</span><span class="p">&#39;</span> <span class="o">!!</span> <span class="p">&#39;</span><span class="s1">Orlando</span><span class="p">&#39;;</span>
    <span class="k">has</span> <span class="nv">@!travelers</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.notes</span> <span class="k">is</span> <span class="k">rw</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>å› ä¸ºç±»ä» <code>Mu</code> ç»§æ‰¿äº†ä¸€ä¸ªé»˜è®¤çš„æ„é€ å™¨, å¹¶ä¸”æˆ‘ä»¬ä¹Ÿè¦æ±‚ç±»ä¸ºæˆ‘ä»¬ç”Ÿæˆä¸€äº›<strong>è®¿é—®å™¨æ–¹æ³•</strong>.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»çš„å®ä¾‹.</span>
<span class="k">my</span> <span class="nv">$vacation</span> <span class="o">=</span> <span class="n">Journey</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span>
    <span class="s">origin</span>      <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">Sweden</span><span class="p">&#39;</span>,
    <span class="s">destination</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">Switzerland</span><span class="p">&#39;</span>,
    <span class="s">notes</span>       <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">Pack hiking gear!</span><span class="p">&#39;</span>
<span class="p">);</span>

<span class="c1"># ä½¿ç”¨è®¿é—®å™¨; è¿™æ‰“å°å‡º Sweden.</span>
<span class="nb">say</span> <span class="nv">$vacation</span><span class="o">.</span><span class="nf">origin</span><span class="p">;</span>
<span class="c1"># ä½¿ç”¨ rw å­˜å–å™¨æ¥æ›´æ”¹å±æ€§çš„å€¼.</span>
<span class="nv">$vacation</span><span class="o">.</span><span class="nf">notes</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">Pack hiking gear and sunglasses!</span><span class="p">&#39;;</span>
</code></pre></div><p>è¯·æ³¨æ„, è™½ç„¶é»˜è®¤æ„é€ å‡½æ•°å¯ä»¥åˆå§‹åŒ–åªè¯»å±æ€§, ä½†å®ƒåªä¼šè®¾ç½®å…·æœ‰è®¿é—®å™¨æ–¹æ³•çš„å±æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´, å³ä½¿æ‚¨ä¼ é€’ <code>travelers =&gt; [&quot;Alex&quot;, &quot;Betty&quot;]</code> ç»™é»˜è®¤æ„é€ å‡½æ•°, <code>@!travelers</code> ä¹Ÿä¸ä¼šåˆå§‹åŒ–è¯¥å±æ€§ã€‚</p>
<h2 id="æ–¹æ³•">æ–¹æ³•</h2>
<p>ä½¿ç”¨ <code>method</code> å…³é”®å­—åœ¨ç±»çš„ body ä¸­å£°æ˜æ–¹æ³•ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Journey</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.origin</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.destination</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">@!travellers</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.notes</span> <span class="k">is</span> <span class="k">rw</span><span class="p">;</span>

    <span class="k">method</span> <span class="nf">add_traveller</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nv">$name</span> <span class="ow">ne</span> <span class="nb">any</span><span class="p">(</span><span class="nv">@!travellers</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">push</span> <span class="nv">@!travellers</span><span class="o">,</span> <span class="nv">$name</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nb">warn</span> <span class="p">&#34;</span><span class="nv">$name</span><span class="s2"> is already going on the journey!</span><span class="p">&#34;;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">describe</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">&#34;</span><span class="s2">From </span><span class="nv">$!origin</span><span class="s2"> to </span><span class="nv">$!destination</span><span class="p">&#34;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>æ–¹æ³•å¯ä»¥æœ‰ç­¾å, å°±åƒå­ä¾‹ç¨‹ä¸€æ ·ã€‚ å±æ€§å¯ä»¥åœ¨æ–¹æ³•ä¸­ä½¿ç”¨, å¹¶ä¸”å¯ä»¥å§‹ç»ˆä¸ <code>!</code> twigil ä¸€èµ·ä½¿ç”¨, å³ä½¿å±æ€§æ˜¯ç”¨ <code>.</code> twigil å£°æ˜çš„ã€‚ è¿™æ˜¯å› ä¸º <code>.</code> twigil å£°æ˜äº† <code>!</code> twigil å¹¶ç”Ÿæˆä¸€ä¸ªè®¿é—®æ–¹æ³•ã€‚</p>
<p>çœ‹çœ‹ä¸Šé¢çš„ä»£ç , åœ¨æ–¹æ³• <code>describe</code> ä¸­ä½¿ç”¨ <code>$!origin</code> å’Œ <code>$.origin</code> æœ‰ä¸€ä¸ªå¾®å¦™ä½†é‡è¦çš„åŒºåˆ«ã€‚<code>$!origin</code> æ˜¯ä¸€ç§å»‰ä»·ä¸”æ˜æ˜¾çš„å±æ€§æŸ¥æ‰¾ã€‚<code>$.origin</code> æ˜¯ä¸€ä¸ªæ–¹æ³•è°ƒç”¨, å› æ­¤å¯ä»¥åœ¨å­ç±»ä¸­é‡å†™ã€‚åªåœ¨ä½ æƒ³è¦å…è®¸è¦†ç›–æ—¶ä½¿ç”¨ <code>$.origin</code>ã€‚</p>
<p>ä¸å­ä¾‹ç¨‹ä¸åŒ, å…¶ä»–å‘½åå‚æ•°ä¸ä¼šäº§ç”Ÿç¼–è¯‘æ—¶æˆ–è¿è¡Œæ—¶é”™è¯¯ã€‚è¿™å…è®¸é€šè¿‡<a href="https://docs.raku.org/language/functions#Re-dispatching">é‡æ–°åˆ†æ´¾</a>æ¥é“¾æ¥æ–¹æ³•ã€‚</p>
<p>ä½ å¯ä»¥ç¼–å†™è‡ªå·±çš„è®¿é—®å™¨æ¥è¦†ç›–ä»»ä½•æˆ–æ‰€æœ‰è‡ªåŠ¨ç”Ÿæˆçš„è®¿é—®å™¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$â²§</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2"> </span><span class="p">&#34;</span> <span class="ow">xx</span> <span class="mi">4</span><span class="p">;</span> <span class="c1"># A tab-like thing </span>
<span class="k">class</span> <span class="nc">Journey</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.origin</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.destination</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">@.travelers</span><span class="p">;</span>
    <span class="k">has</span> <span class="nb">Str</span> <span class="nv">$.notes</span> <span class="k">is</span> <span class="k">rw</span><span class="p">;</span>
 
    <span class="k">multi</span> <span class="k">method</span> <span class="nf">notes</span><span class="p">()</span> <span class="p">{</span> <span class="p">&#34;</span><span class="nv">$!notes</span><span class="s2">\n</span><span class="p">&#34;</span> <span class="p">};</span>
    <span class="k">multi</span> <span class="k">method</span> <span class="nf">notes</span><span class="p">(</span> <span class="nb">Str</span> <span class="nv">$note</span> <span class="p">)</span> <span class="p">{</span> <span class="nv">$!notes</span> <span class="o">~=</span> <span class="p">&#34;</span><span class="nv">$note</span><span class="s2">\n</span><span class="nv">$â²§</span><span class="p">&#34;</span> <span class="p">};</span>
 
    <span class="k">method</span> <span class="nb">Str</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">â¤· </span><span class="nv">$!origin</span><span class="s2">\n</span><span class="nv">$â²§</span><span class="p">&#34;</span> <span class="o">~</span> <span class="nb">self</span><span class="o">.</span><span class="nf">notes</span><span class="p">()</span> <span class="o">~</span> <span class="p">&#34;</span><span class="nv">$!destination</span><span class="s2"> â¤¶\n</span><span class="p">&#34;</span> <span class="p">};</span>
<span class="p">}</span>
 
<span class="k">my</span> <span class="nv">$trip</span> <span class="o">=</span> <span class="n">Journey</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span> <span class="p">:</span><span class="s">origin</span><span class="p">&lt;</span><span class="s">Here</span><span class="p">&gt;</span><span class="o">,</span> <span class="p">:</span><span class="s">destination</span><span class="p">&lt;</span><span class="s">There</span><span class="p">&gt;</span><span class="o">,</span>
                        <span class="s">travelers</span> <span class="o">=&gt;</span> <span class="p">&lt;</span><span class="s">Ã¾or Freya</span><span class="p">&gt;</span> <span class="p">);</span>
 
<span class="nv">$trip</span><span class="o">.</span><span class="nf">notes</span><span class="p">(&#34;</span><span class="s2">First steps</span><span class="p">&#34;);</span>
<span class="nf">notes</span> <span class="nv">$trip:</span> <span class="p">&#34;</span><span class="s2">Almost there</span><span class="p">&#34;;</span>
<span class="nb">print</span> <span class="nv">$trip</span><span class="p">;</span>
 
<span class="c1"># OUTPUT: </span>
<span class="c1">#â¤· Here </span>
<span class="c1">#       First steps </span>
<span class="c1">#       Almost there </span>
<span class="c1"># </span>
<span class="c1">#There â¤¶ </span>
</code></pre></div><p>å£°æ˜çš„ multi æ–¹æ³• <code>notes</code> ä½¿ç”¨ä¸åŒçš„ç­¾åè¿›è¡Œè¯»å†™, <code>notes</code> è¦†ç›–äº† <code>$.notes</code> å£°æ˜ä¸­éšå«çš„è‡ªåŠ¨ç”Ÿæˆçš„æ–¹æ³•ã€‚</p>
<p>è¯·æ³¨æ„, åœ¨ <code>notes $trip: &quot;Almost there&quot;</code> ä¸­æˆ‘ä»¬ä½¿ç”¨äº†é—´æ¥è°ƒç”¨è¯­æ³•, å®ƒé¦–å…ˆæ”¾ç½®æ–¹æ³•åç§°, ç„¶åæ”¾ç½®å¯¹è±¡, ç„¶åç”¨å†’å·åˆ†éš”å‚æ•°ï¼š<code>method invocant: arguments</code>ã€‚åªè¦æ„Ÿè§‰æ¯”ç»å…¸çš„å¥ç‚¹å’Œæ‹¬å·æ›´è‡ªç„¶, æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¿™ç§è¯­æ³•ã€‚å®ƒçš„å·¥ä½œåŸç†å®Œå…¨ç›¸åŒã€‚</p>
<p>å¯ä»¥åœ¨è¿è¡Œæ—¶ä½¿ç”¨ <code>.&quot;&quot;</code> è¿ç®—ç¬¦è§£ææ–¹æ³•åç§°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">A</span> <span class="p">{</span> <span class="k">has</span> <span class="nv">$.b</span> <span class="p">};</span>
<span class="k">my</span> <span class="nv">$name</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">b</span><span class="p">&#39;;</span>
<span class="n">A</span><span class="o">.</span><span class="nb">new</span><span class="o">.</span><span class="p">&#34;</span><span class="nv">$name</span><span class="p">&#34;()</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>
<span class="c1"># OUTPUT: Â«(Any)â¤Â» </span>
</code></pre></div><p>ç›¸å¯¹äºå…ˆå‰çš„<a href="https://docs.raku.org/language/objects#Attributes">å±æ€§</a>éƒ¨åˆ†, è¿‡å»ç”¨äºæ›´æ–° <code>$.notes</code> çš„è¯­æ³•åœ¨æœ¬èŠ‚å·²æ”¹å˜ã€‚ä»£æ›¿èµ‹å€¼ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$vacation</span><span class="o">.</span><span class="nf">notes</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">Pack hiking gear and sunglasses!</span><span class="p">&#39;;</span>
</code></pre></div><p>æˆ‘ä»¬ç°åœ¨åšä¸€ä¸ªæ–¹æ³•è°ƒç”¨:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$trip</span><span class="o">.</span><span class="nf">notes</span><span class="p">(&#34;</span><span class="s2">First steps</span><span class="p">&#34;);</span>
</code></pre></div><p>è¦†ç›–é»˜è®¤çš„è‡ªåŠ¨ç”Ÿæˆçš„è®¿é—®å™¨æ„å‘³ç€å®ƒåœ¨è¿”å›èµ‹å€¼æ—¶æä¾›å¯å˜å®¹å™¨ä¸å†å¯ç”¨ã€‚æ–¹æ³•è°ƒç”¨æ˜¯å°†å±æ€§çš„æ›´æ–°æ·»åŠ åˆ°è®¡ç®—å’Œé€»è¾‘çš„é¦–é€‰æ–¹æ³•ã€‚è®¸å¤šç°ä»£è¯­è¨€å¯ä»¥é€šè¿‡ä½¿ç”¨ â€œsetterâ€ æ–¹æ³•é‡è½½èµ‹å€¼æ¥æ›´æ–°å±æ€§ã€‚è™½ç„¶ Raku å¯ä»¥ä¸ºæ­¤ç›®çš„ä½¿ç”¨ <a href="https://github.com/raku/roast/blob/master/S12-attributes/mutators.t"><code>Proxy</code></a> å¯¹è±¡é‡è½½èµ‹å€¼è¿ç®—ç¬¦, ä½†æ˜¯ç›®å‰ä¸é¼“åŠ±ä½¿ç”¨å¤æ‚é€»è¾‘é‡è½½èµ‹å€¼è¿ç®—ç¬¦æ¥è®¾ç½®å±æ€§ä½œä¸º<a href="https://6guts.wordpress.com/2016/11/25/perl-6-is-biased-towards-mutators-being-really-simple-thats-a-good-thing/">å¼±é¢å‘å¯¹è±¡è®¾è®¡</a>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">has</span> <span class="nv">$!attribute</span>
<span class="k">method</span> <span class="nf">attribute</span><span class="p">()</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>    
    <span class="k">has</span> <span class="nv">$.attr</span> <span class="k">is</span> <span class="k">rw</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>ç­‰ä»·äº:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>    
    <span class="k">has</span> <span class="nv">$!attr</span><span class="p">;</span>    
    <span class="k">method</span> <span class="nf">attr</span><span class="p">()</span> <span class="k">is</span> <span class="k">rw</span> <span class="p">{</span>
        <span class="nv">$!attr</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h2 id="ç±»å’Œå®ä¾‹æ–¹æ³•">ç±»å’Œå®ä¾‹æ–¹æ³•</h2>
<p>æ–¹æ³•çš„ç­¾åå¯ä»¥æœ‰ä¸€ä¸ªè°ƒç”¨è€…(invocant)ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°, åè·Ÿä¸€ä¸ªå†’å·, è¿™å…è®¸è¯¥æ–¹æ³•å¼•ç”¨å®ƒè¢«è°ƒç”¨çš„å¯¹è±¡ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">greet</span><span class="p">(</span><span class="nv">$me:</span> <span class="nv">$person</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hi, I am </span><span class="nv">$me</span><span class="o">.</span><span class="nf">^name</span><span class="p">()</span><span class="s2">, nice to meet you, </span><span class="nv">$person</span><span class="p">&#34;;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">Foo</span><span class="o">.</span><span class="nb">new</span><span class="o">.</span><span class="nf">greet</span><span class="p">(&#34;</span><span class="s2">Bob</span><span class="p">&#34;);</span> <span class="c1"># OUTPUT: Â«Hi, I am Foo, nice to meet you, Bobâ¤Â» </span>
</code></pre></div><p>åœ¨æ–¹æ³•ç­¾åä¸­æä¾›è°ƒç”¨è€…è¿˜å…è®¸é€šè¿‡ä½¿ç”¨<a href="https://docs.raku.org/type/Signature#Type_constraints">ç±»å‹çº¦æŸ</a>å°†æ–¹æ³•å®šä¹‰ä¸ºç±»æ–¹æ³•æˆ–å¯¹è±¡æ–¹æ³•ã€‚<code>::?CLASS</code> å˜é‡å¯ç”¨äºåœ¨ç¼–è¯‘æ—¶æä¾›ç±»å, ä¸ <code>:U</code>ï¼ˆå¯¹äºç±»æ–¹æ³•ï¼‰æˆ– <code>:D</code>ï¼ˆå¯¹äºå®ä¾‹æ–¹æ³•ï¼‰ç»“åˆä½¿ç”¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Pizza</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$!radius</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">@.ingredients</span><span class="p">;</span>
 
    <span class="c1"># ç±»æ–¹æ³•: construct from a list of ingredients </span>
    <span class="k">method</span> <span class="nf">from-ingredients</span><span class="p">(</span><span class="vg">::?CLASS:U</span> <span class="nv">$pizza:</span> <span class="nv">@ingredients</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$pizza</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span> <span class="s">ingredients</span> <span class="o">=&gt;</span> <span class="nv">@ingredients</span> <span class="p">);</span>
    <span class="p">}</span>
 
    <span class="c1"># å®ä¾‹æ–¹æ³• </span>
    <span class="k">method</span> <span class="nf">get-radius</span><span class="p">(</span><span class="vg">::?CLASS:D</span><span class="o">:</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$!radius</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$p</span> <span class="o">=</span> <span class="n">Pizza</span><span class="o">.</span><span class="nf">from-ingredients:</span> <span class="p">&lt;</span><span class="s">cheese pepperoni vegetables</span><span class="p">&gt;;</span>

<span class="nb">say</span> <span class="nv">$p</span><span class="o">.</span><span class="nf">ingredients</span><span class="p">;</span>     <span class="c1"># OUTPUT: Â«[cheese pepperoni vegetables]â¤Â» </span>
<span class="nb">say</span> <span class="nv">$p</span><span class="o">.</span><span class="nf">get-radius</span><span class="p">;</span>      <span class="c1"># OUTPUT: Â«42â¤Â» </span>
<span class="nb">say</span> <span class="n">Pizza</span><span class="o">.</span><span class="nf">get-radius</span><span class="p">;</span>   <span class="c1"># This will fail. </span>

<span class="k">CATCH</span> <span class="p">{</span> <span class="k">default</span> <span class="p">{</span> <span class="nb">put</span> <span class="o">.^</span><span class="nb">name</span> <span class="o">~</span> <span class="p">&#34;</span><span class="s2">:\n</span><span class="p">&#34;</span> <span class="o">~</span> <span class="o">.</span><span class="nb">Str</span> <span class="p">}</span> <span class="p">};</span>
<span class="c1"># OUTPUT: Â«X::Parameter::InvalidConcreteness:â¤ </span>
<span class="c1">#          Invocant of method &#39;get-radius&#39; must be </span>
<span class="c1">#          an object instance of type &#39;Pizza&#39;, </span>
<span class="c1">#          not a type object of type &#39;Pizza&#39;. </span>
<span class="c1">#          Did you forget a &#39;.new&#39;?Â» </span>
</code></pre></div><p>é€šè¿‡ä½¿ç”¨<a href="https://docs.raku.org/syntax/multi">multi</a>å£°æ˜ç¬¦, æ–¹æ³•æ—¢å¯ä»¥æ˜¯ç±»æ–¹æ³•ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡æ–¹æ³•ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">C</span> <span class="p">{</span>
    <span class="k">multi</span> <span class="k">method</span> <span class="nb">f</span><span class="p">(</span><span class="vg">::?CLASS:U</span><span class="o">:</span><span class="p">)</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">class method</span><span class="p">&#34;</span>  <span class="p">}</span>
    <span class="k">multi</span> <span class="k">method</span> <span class="nb">f</span><span class="p">(</span><span class="vg">::?CLASS:D</span><span class="o">:</span><span class="p">)</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">object method</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="p">}</span>
<span class="n">C</span><span class="o">.</span><span class="nb">f</span><span class="p">;</span>       <span class="c1"># OUTPUT: Â«class methodâ¤Â» </span>
<span class="n">C</span><span class="o">.</span><span class="nb">new</span><span class="o">.</span><span class="nb">f</span><span class="p">;</span>   <span class="c1"># OUTPUT: Â«object methodâ¤Â» </span>
</code></pre></div><h2 id="self">self</h2>
<p>åœ¨æ–¹æ³•å†…éƒ¨, æœ¯è¯­ <code>self</code> å¯ç”¨å¹¶ç»‘å®šåˆ°è°ƒç”¨å¯¹è±¡ã€‚<code>self</code> å¯ä»¥ç”¨æ¥è°ƒç”¨è°ƒç”¨è€…çš„å…¶ä»–æ–¹æ³•, åŒ…æ‹¬æ„é€ å‡½æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Box</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.data</span><span class="p">;</span>
 
    <span class="k">method</span> <span class="nf">make-new-box-from</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">self</span><span class="o">.</span><span class="nb">new</span><span class="o">:</span> <span class="s">data</span> <span class="o">=&gt;</span> <span class="nv">$!data</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p><code>self</code> ä¹Ÿå¯ä»¥ç”¨åœ¨ç±»æ–¹æ³•æˆ–å®ä¾‹æ–¹æ³•ä¸­, ä½†è¦æ³¨æ„å°è¯•ä»å¦ä¸€ä¸ªæ–¹æ³•è°ƒç”¨ä¸€ç§ç±»å‹çš„æ–¹æ³•ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">C</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">g</span><span class="p">()</span>            <span class="p">{</span> <span class="mi">42</span>     <span class="p">}</span>
    <span class="k">method</span> <span class="nb">f</span><span class="p">(</span><span class="vg">::?CLASS:U</span><span class="o">:</span><span class="p">)</span> <span class="p">{</span> <span class="nb">self</span><span class="o">.</span><span class="nf">g</span> <span class="p">}</span>
    <span class="k">method</span> <span class="nb">d</span><span class="p">(</span><span class="vg">::?CLASS:D</span><span class="o">:</span><span class="p">)</span> <span class="p">{</span> <span class="nb">self</span><span class="o">.</span><span class="nb">f</span> <span class="p">}</span>
<span class="p">}</span>

<span class="n">C</span><span class="o">.</span><span class="nb">f</span><span class="p">;</span>        <span class="c1"># OUTPUT: Â«42â¤Â» </span>
<span class="n">C</span><span class="o">.</span><span class="nb">new</span><span class="o">.</span><span class="nb">d</span><span class="p">;</span>    <span class="c1"># This will fail. </span>

<span class="k">CATCH</span> <span class="p">{</span> <span class="k">default</span> <span class="p">{</span> <span class="nb">put</span> <span class="o">.^</span><span class="nb">name</span> <span class="o">~</span> <span class="p">&#34;</span><span class="s2">:\n</span><span class="p">&#34;</span> <span class="o">~</span> <span class="o">.</span><span class="nb">Str</span> <span class="p">}</span> <span class="p">};</span>
<span class="c1"># OUTPUT: Â«X::Parameter::InvalidConcreteness:â¤ </span>
<span class="c1">#          Invocant of method &#39;f&#39; must be a type object of type &#39;C&#39;, </span>
<span class="c1">#          not an object instance of type &#39;C&#39;.  Did you forget a &#39;multi&#39;?Â» </span>
</code></pre></div><p><code>self</code> ä¹Ÿå¯ä»¥ä¸å±æ€§ä¸€èµ·ä½¿ç”¨, åªè¦å®ƒä»¬å…·æœ‰è®¿é—®å™¨ã€‚<code>self.a</code> å°†ä¸ºå£°æ˜ä¸º <code>has $.a</code> çš„å±æ€§è°ƒç”¨è®¿é—®å™¨ã€‚ç„¶è€Œ, <code>self.a</code> å’Œ <code>$.a</code> ä¹‹é—´å­˜åœ¨å·®å¼‚, å› ä¸ºåè€…å°†é¡¹åŒ–; <code>$.a</code> å°†ç­‰åŒäº <code>self.a.item</code> æˆ– <code>$(self.a)</code>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.x</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="p">);</span>
    <span class="k">method</span> <span class="nf">b</span><span class="p">()</span> <span class="p">{</span> <span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="nb">self</span><span class="o">.</span><span class="nb">x</span><span class="p">;</span> <span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="nv">$.x</span> <span class="p">}</span>
<span class="p">};</span>

<span class="n">A</span><span class="o">.</span><span class="nb">new</span><span class="o">.</span><span class="nf">b</span><span class="p">;</span> <span class="c1"># OUTPUT: Â«1â¤2â¤3â¤(1 2 3)â¤Â» </span>
</code></pre></div><p>æ–¹æ³•è°ƒç”¨çš„å†’å·è¯­æ³•ä»…æ”¯æŒä½¿ç”¨æ–¹æ³•è°ƒç”¨ <code>self</code>, è€Œä¸æ”¯æŒå¿«æ·æ–¹å¼ã€‚</p>
<p>è¯·æ³¨æ„, å¦‚æœ <a href="https://docs.raku.org/type/Mu">Mu</a> ä¸­çš„ç›¸å…³æ–¹æ³• <code>bless</code>, <code>CREATE</code> æ²¡æœ‰é‡è½½, <code>self</code> å°†æŒ‡å‘è¿™äº›æ–¹æ³•çš„ç±»å‹å¯¹è±¡ã€‚</p>
<p>åœ¨å¦ä¸€æ–¹é¢, åœ¨åˆå§‹åŒ–çš„ä¸åŒé˜¶æ®µ, åœ¨å®ä¾‹ä¸Šè°ƒç”¨å­æ–¹æ³• <code>BUILD</code> å’Œ <code>TWEAK</code>ã€‚å­ç±»ä¸­åŒåçš„å­æ–¹æ³•å°šæœªè¿è¡Œ, å› æ­¤ä½ ä¸åº”è¯¥ä¾èµ–è¿™äº›æ–¹æ³•ä¸­çš„æ½œåœ¨è™šæ–¹æ³•è°ƒç”¨ã€‚</p>
<h3 id="ç§æœ‰æ–¹æ³•">ç§æœ‰æ–¹æ³•</h3>
<p>æ–¹æ³•åå‰å¸¦æœ‰æ„Ÿå¹å·çš„æ–¹æ³•ä¸èƒ½ä»å®šä¹‰ç±»ä¹‹å¤–çš„ä»»ä½•åœ°æ–¹è°ƒç”¨; è¿™äº›æ–¹æ³•æ˜¯ç§æœ‰çš„, å› ä¸ºå®ƒä»¬åœ¨å£°æ˜å®ƒä»¬çš„ç±»ä¹‹å¤–æ˜¯ä¸å¯è§çš„ã€‚ä½¿ç”¨æ„Ÿå¹å·è€Œä¸æ˜¯ç‚¹å·è°ƒç”¨ç§æœ‰æ–¹æ³•ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">FunMath</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.value</span> <span class="k">is</span> <span class="k">required</span><span class="p">;</span>

    <span class="k">method</span> <span class="nf">!do-subtraction</span><span class="p">(</span> <span class="nv">$num</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nv">$num</span> <span class="o">~~</span> <span class="nb">Str</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$!value</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="nv">$num</span><span class="o">.</span><span class="nb">chars</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$!value</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="nv">$num</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">minus</span><span class="p">(</span> <span class="nv">$minuend:</span> <span class="nv">$subtrahend</span> <span class="p">)</span> <span class="p">{</span>
        <span class="c1"># invoking the private method on the explicit invocant </span>
        <span class="nv">$minuend</span><span class="o">!</span><span class="nf">do-subtraction</span><span class="p">(</span><span class="nv">$subtrahend</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$five</span> <span class="o">=</span> <span class="n">FunMath</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">value</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">);</span>
<span class="nb">say</span> <span class="nv">$five</span><span class="o">.</span><span class="nf">minus</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>         <span class="c1"># OUTPUT: Â«-1â¤Â» </span>
<span class="nb">say</span> <span class="nv">$five</span><span class="o">.</span><span class="nf">do-subtraction</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>

<span class="k">CATCH</span> <span class="p">{</span> <span class="k">default</span> <span class="p">{</span> <span class="nb">put</span> <span class="o">.^</span><span class="nb">name</span> <span class="o">~</span> <span class="p">&#34;</span><span class="s2">:\n</span><span class="p">&#34;</span> <span class="o">~</span> <span class="o">.</span><span class="nb">Str</span> <span class="p">}</span> <span class="p">}</span>
<span class="c1"># OUTPUT: Â«X::Method::NotFound: </span>
<span class="c1"># No such method &#39;do-subtraction&#39; for invocant of type </span>
<span class="c1"># &#39;FunMath&#39;. Did you mean &#39;!do-subtraction&#39;?â¤Â» </span>
</code></pre></div><p>ç§æœ‰æ–¹æ³•ä¸èƒ½è¢«å­ç±»ç»§æ‰¿ã€‚</p>
<h3 id="å­æ–¹æ³•">å­æ–¹æ³•</h3>
<p>å­æ–¹æ³•æ˜¯å­ç±»ä¸ç»§æ‰¿çš„å…¬å…±æ–¹æ³•ã€‚è¯¥åç§°æºäºå®ƒä»¬åœ¨è¯­ä¹‰ä¸Šä¸å­ä¾‹ç¨‹ç±»ä¼¼çš„äº‹å®ã€‚</p>
<p>å­æ–¹æ³•å¯¹äºå¯¹è±¡æ„é€ å’Œé”€æ¯ä»»åŠ¡ä»¥åŠç‰¹å®šäºç‰¹å®šç±»å‹çš„ä»»åŠ¡éå¸¸æœ‰ç”¨, å› æ­¤å­ç±»å‹å¿…é¡»é‡å†™å®ƒä»¬ã€‚</p>
<p>ä¾‹å¦‚, <a href="https://docs.raku.org/type/Mu#method_new">é»˜è®¤æ–¹æ³• new</a> åœ¨<a href="https://docs.raku.org/language/objects#Inheritance">ç»§æ‰¿</a>é“¾ä¸­çš„æ¯ä¸ªç±»ä¸Šè°ƒç”¨ submethod <code>BUILD</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Point2D</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.x</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.y</span><span class="p">;</span>
 
    <span class="k">submethod</span> <span class="nb">BUILD</span><span class="p">(</span><span class="o">:</span><span class="nv">$!x</span><span class="o">,</span> <span class="o">:</span><span class="nv">$!y</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Initializing Point2D</span><span class="p">&#34;;</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="k">class</span> <span class="nc">InvertiblePoint2D</span> <span class="k">is</span> <span class="nc">Point2D</span> <span class="p">{</span>
    <span class="k">submethod</span> <span class="nb">BUILD</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Initializing InvertiblePoint2D</span><span class="p">&#34;;</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nb">invert</span> <span class="p">{</span>
        <span class="nb">self</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">x</span> <span class="o">=&gt;</span> <span class="o">-</span> <span class="nv">$.x</span>, <span class="s">y</span> <span class="o">=&gt;</span> <span class="o">-</span> <span class="nv">$.y</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="nb">say</span> <span class="n">InvertiblePoint2D</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">x</span> <span class="o">=&gt;</span> <span class="mi">1</span>, <span class="s">y</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">);</span>

<span class="c1"># OUTPUT: Â«Initializing Point2Dâ¤Â» </span>
<span class="c1"># OUTPUT: Â«Initializing InvertiblePoint2Dâ¤Â» </span>
<span class="c1"># OUTPUT: Â«InvertiblePoint2D.new(x =&gt; 1, y =&gt; 2)â¤Â» </span>
</code></pre></div><p>å¦è¯·å‚è§ï¼š<a href="https://docs.raku.org/language/objects#Object_construction">Object_construction</a>ã€‚</p>
<h2 id="ç»§æ‰¿">ç»§æ‰¿</h2>
<p>ç±»å¯ä»¥æœ‰çˆ¶ç±»:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Child</span> <span class="k">is</span> <span class="nc">Parent1</span> <span class="k">is</span> <span class="nc">Parent2</span> <span class="p">{</span> <span class="p">}</span>
</code></pre></div><p>å¦‚æœåœ¨å­ç±»ä¸Šè°ƒç”¨ä¸€ä¸ªæ–¹æ³•, ä½†æ˜¯å­ç±»æ²¡æœ‰æä¾›è¯¥æ–¹æ³•, åˆ™è°ƒç”¨å…¶ä¸­ä¸€ä¸ªçˆ¶ç±»ä¸­åŒåæ–¹æ³•(å¦‚æœå­˜åœ¨)ã€‚çˆ¶ç±»è¢«æŸ¥è¯¢çš„é¡ºåºå°±å«åšæ–¹æ³•è§£æé¡ºåº(MRO)ã€‚Raku ä½¿ç”¨ <a href="https://en.wikipedia.org/wiki/C3_linearization">C3 æ–¹æ³•è§£æé¡ºåº</a>ã€‚ä½ å¯ä»¥é€šè¿‡è°ƒç”¨ç±»å‹çš„å…ƒç±»å‹æ–¹æ³•å¾—çŸ¥è¿™ä¸ªç±»å‹çš„ MRO.</p>
<p>å¦‚æœä¸€ä¸ªç±»æ²¡æœ‰æŒ‡å®šå®ƒçš„çˆ¶ç±», å°±é»˜è®¤ä½¿ç”¨ <a href="https://docs.raku.org/type/Any">Any</a>. æ‰€æœ‰çš„ç±»éƒ½ç›´æ¥æˆ–é—´æ¥çš„æ´¾ç”Ÿäº <a href="https://docs.raku.org/type/Mu">Mu</a> - ç±»å‹å±‚çº§ç»“æ„çš„æ ¹ã€‚</p>
<p>æ‰€æœ‰å¯¹å…¬å…±æ–¹æ³•çš„è°ƒç”¨éƒ½æ˜¯ <code>C++</code> æ„ä¹‰ä¸Šçš„â€œè™šæ‹Ÿâ€, è¿™æ„å‘³ç€å¯¹è±¡çš„å®é™…ç±»å‹å†³å®šäº†è¦è°ƒç”¨çš„æ–¹æ³•, è€Œä¸æ˜¯å£°æ˜çš„ç±»å‹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Parent</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">frob</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">the parent class frobs</span><span class="p">&#34;</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="k">class</span> <span class="nc">Child</span> <span class="k">is</span> <span class="nc">Parent</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">frob</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">the child&#39;s somewhat more fancy frob is called</span><span class="p">&#34;</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="k">my</span> <span class="n">Parent</span> <span class="nv">$test</span><span class="p">;</span>
<span class="nv">$test</span> <span class="o">=</span> <span class="n">Child</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>
<span class="nv">$test</span><span class="o">.</span><span class="nf">frob</span><span class="p">;</span> <span class="c1"># calls the frob method of Child rather than Parent </span>
<span class="c1"># OUTPUT: Â«the child&#39;s somewhat more fancy frob is calledâ¤Â» </span>
</code></pre></div><h2 id="å¯¹è±¡æ„é€ ">å¯¹è±¡æ„é€ </h2>
<p>å¯¹è±¡é€šå¸¸é€šè¿‡æ–¹æ³•è°ƒç”¨åˆ›å»º, æˆ–è€…é€šè¿‡ç±»å‹å¯¹è±¡æˆ–è€…é€šè¿‡åŒç±»å‹çš„å…¶å®ƒå¯¹è±¡åˆ›å»ºã€‚</p>
<p>ç±» <a href="https://docs.raku.org/type/Mu">Mu</a> æä¾›äº†ä¸€ä¸ªåä¸º <a href="https://docs.raku.org/routine/new">new</a> çš„æ„é€ å‡½æ•°æ–¹æ³•, å®ƒæ¥å—å‘½å<a href="https://docs.raku.org/language/functions#Arguments">å‚æ•°</a>å¹¶ä½¿ç”¨å®ƒä»¬æ¥åˆå§‹åŒ–å…¬å…±å±æ€§ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Point</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.x</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.y</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">my</span> <span class="nv">$p</span> <span class="o">=</span> <span class="n">Point</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span> <span class="s">x</span> <span class="o">=&gt;</span> <span class="mi">5</span>, <span class="s">y</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">);</span>
<span class="c1">#             ^^^ inherited from class Mu</span>

<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">x: </span><span class="p">&#34;</span><span class="o">,</span> <span class="nv">$p</span><span class="o">.</span><span class="nb">x</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">y: </span><span class="p">&#34;</span><span class="o">,</span> <span class="nv">$p</span><span class="o">.</span><span class="nf">y</span><span class="p">;</span>
<span class="c1"># OUTPUT: Â«x: 5â¤Â» </span>
<span class="c1"># OUTPUT: Â«y: 2â¤Â» </span>
</code></pre></div><p><code>Mu.new</code> åœ¨è°ƒç”¨è€…èº«ä¸Šè°ƒç”¨ <code>bless</code> æ–¹æ³•, ä¼ é€’æ‰€æœ‰çš„å‘½å<a href="https://docs.raku.org/language/functions#Arguments">å‚æ•°</a>ã€‚ <code>bless</code> åˆ›å»ºæ–°çš„å¯¹è±¡, ç„¶åä»¥åå‘æ–¹æ³•è§£æé¡ºåº(å³ä»<a href="https://docs.raku.org/type/Mu">Mu</a>åˆ°å¤§å¤šæ•°æ´¾ç”Ÿç±»)éå†æ‰€æœ‰å­ç±», å¹¶ä¸”åœ¨æ¯ä¸ªç±»ä¸­æ£€æŸ¥æ˜¯å¦å­˜åœ¨åä¸º <code>BUILD</code> çš„æ–¹æ³•ã€‚ å¦‚æœè¯¥æ–¹æ³•å­˜åœ¨, åˆ™ä½¿ç”¨è¯¥æ–¹æ³•ä¸­çš„æ‰€æœ‰å‘½åå‚æ•°è°ƒç”¨è¯¥ <code>new</code> æ–¹æ³•ã€‚å¦‚æœä¸å­˜åœ¨åä¸º <code>BUILD</code> çš„æ–¹æ³•, è¿™ä¸ªç±»çš„å…¬å¼€å±æ€§å°±ä¼šç”¨åŒåçš„å‘½åå‚æ•°è¿›è¡Œåˆå§‹åŒ–ã€‚  åœ¨ä»»ä½•ä¸€ç§æƒ…å†µä¸‹, å¦‚æœ <strong>BULID</strong> æ–¹æ³•å’Œ <strong>é»˜è®¤æ„é€ å‡½æ•°</strong> éƒ½æ²¡æœ‰å¯¹å±æ€§è¿›è¡Œåˆå§‹åŒ–, åˆ™åº”ç”¨é»˜è®¤å€¼ã€‚è¿™æ„å‘³ç€ <code>BUILD</code> å¯ä»¥æ›´æ”¹å±æ€§, ä½†å®ƒæ— æƒè®¿é—®å£°æ˜ä¸ºå…¶é»˜è®¤å€¼çš„å±æ€§çš„å†…å®¹; è¿™äº›åªåœ¨ <code>TWEAK</code>ï¼ˆè§ä¸‹æ–‡ï¼‰ä¸­å¯ç”¨, å®ƒå¯ä»¥â€œçœ‹åˆ°â€åœ¨ç±»çš„å£°æ˜ä¸­åˆå§‹åŒ–çš„å±æ€§çš„å†…å®¹ã€‚</p>
<p>åœ¨ <code>BUILD</code> è¢«è°ƒç”¨ä¹‹å, åä¸º <code>TWEAK</code> çš„æ–¹æ³•ä¼šè¢«è°ƒç”¨, å¦‚æœå®ƒä»¬å­˜åœ¨, ä¼ é€’ç»™ <code>new</code> çš„æ‰€æœ‰å‘½åå‚æ•°ä¹Ÿä¼šä¼ é€’ç»™ <code>TWEAK</code>ã€‚è¯·å‚é˜…ä¸‹é¢çš„ä½¿ç”¨ç¤ºä¾‹ã€‚</p>
<p>ç”±äº <code>BUILD</code> å’Œ <code>TWEAK</code> å­æ–¹æ³•çš„é»˜è®¤è¡Œä¸º, æ´¾ç”Ÿäº <code>Mu</code> çš„ <code>new</code> æ„é€ å‡½æ•°çš„å‘½åå‚æ•°å¯ç›´æ¥å¯¹åº”çš„ä»»ä½•æ–¹æ³•è§£æé¡ºåºç±»çš„å…¬å…±å±æ€§, æˆ–å¯¹åº”äºä»»ä½• <code>BUILD</code> æˆ– <code>TWEAK</code> å­æ–¹æ³•çš„ä»»ä½•å‘½åå‚æ•°ã€‚</p>
<p>æ­¤å¯¹è±¡æ„é€ æ–¹æ¡ˆå¯¹è‡ªå®šä¹‰æ„é€ å‡½æ•°æœ‰å‡ ä¸ªå«ä¹‰ã€‚é¦–å…ˆ, è‡ªå®šä¹‰ <code>BUILD</code> æ–¹æ³•åº”å§‹ç»ˆæ˜¯å­æ–¹æ³•, å¦åˆ™å®ƒä»¬ä¼šç ´åå­ç±»ä¸­çš„å±æ€§åˆå§‹åŒ–ã€‚å…¶æ¬¡, <code>BUILD</code> å­æ–¹æ³•å¯ç”¨äºåœ¨å¯¹è±¡æ„é€ æ—¶è¿è¡Œè‡ªå®šä¹‰ä»£ç ã€‚å®ƒä»¬è¿˜å¯ç”¨äºä¸ºå±æ€§åˆå§‹åŒ–åˆ›å»ºåˆ«åï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">EncodedBuffer</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.enc</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.data</span><span class="p">;</span>
 
    <span class="k">submethod</span> <span class="nb">BUILD</span><span class="p">(:</span><span class="s">encoding</span><span class="p">(</span><span class="o">:</span><span class="nv">$enc</span><span class="p">)</span><span class="o">,</span> <span class="o">:</span><span class="nv">$data</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$!enc</span>  <span class="o">:=</span>  <span class="nv">$enc</span><span class="p">;</span>
        <span class="nv">$!data</span> <span class="o">:=</span> <span class="nv">$data</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$b1</span> <span class="o">=</span> <span class="n">EncodedBuffer</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span> <span class="s">encoding</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">UTF-8</span><span class="p">&#39;</span>, <span class="s">data</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">64</span>, <span class="mi">65</span><span class="o">]</span> <span class="p">);</span>
<span class="k">my</span> <span class="nv">$b2</span> <span class="o">=</span> <span class="n">EncodedBuffer</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span> <span class="s">enc</span>      <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">UTF-8</span><span class="p">&#39;</span>, <span class="s">data</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">64</span>, <span class="mi">65</span><span class="o">]</span> <span class="p">);</span>
<span class="c1">#  both enc and encoding are allowed now </span>
</code></pre></div><p>å› ä¸ºä¼ é€’å®å‚ç»™å­ä¾‹ç¨‹æŠŠå®å‚ç»‘å®šç»™äº†å½¢å‚, å¦‚æœæŠŠå±æ€§ç”¨ä½œå½¢å‚, åˆ™ä¸éœ€è¦å•ç‹¬çš„ç»‘å®šæ­¥éª¤ã€‚ æ‰€ä»¥ä¸Šé¢çš„ä¾‹å­å¯ä»¥å†™ä¸º:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">submethod</span> <span class="nb">BUILD</span><span class="p">(:</span><span class="s">encoding</span><span class="p">(</span><span class="o">:</span><span class="nv">$!enc</span><span class="p">)</span><span class="o">,</span> <span class="o">:</span><span class="nv">$!data</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1"># nothing to do here anymore, the signature binding</span>
    <span class="c1"># does all the work for us.</span>
<span class="p">}</span>
</code></pre></div><p>ä½†æ˜¯, å½“å±æ€§å¯èƒ½å…·æœ‰ç‰¹æ®Šç±»å‹è¦æ±‚ï¼ˆä¾‹å¦‚ <code>:$!id</code> å¿…é¡»ä¸ºæ­£æ•´æ•°ï¼‰æ—¶, è¯·è°¨æ…ä½¿ç”¨æ­¤å±æ€§çš„è‡ªåŠ¨ç»‘å®šã€‚è¯·è®°ä½, é™¤éæ‚¨ä¸“é—¨å¤„ç†æ­¤å±æ€§, å¦åˆ™å°†åˆ†é…é»˜è®¤å€¼, å¹¶ä¸”è¯¥é»˜è®¤å€¼å°†ä¸º <code>Any</code>, è¿™ä¼šå¯¼è‡´ç±»å‹é”™è¯¯ã€‚</p>
<p>ç¬¬ä¸‰ä¸ªå«ä¹‰æ˜¯, å¦‚æœä½ æƒ³è¦ä¸€ä¸ªæ¥å—ä½ç½®å‚æ•°çš„æ„é€ å‡½æ•°, ä½ å¿…é¡»ç¼–å†™è‡ªå·±çš„ <code>new</code> æ–¹æ³•ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Point</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.x</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.y</span><span class="p">;</span>
    <span class="k">method</span> <span class="nb">new</span><span class="p">(</span><span class="nv">$x</span><span class="o">,</span> <span class="nv">$y</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">self</span><span class="o">.</span><span class="nb">bless</span><span class="p">(</span><span class="o">:</span><span class="nv">$x</span><span class="o">,</span> <span class="o">:</span><span class="nv">$y</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>ç„¶è€Œ, è¿™ä¸æ˜¯æœ€ä½³å®è·µ, å› ä¸ºå®ƒä½¿å¾—ä»å­ç±»æ­£ç¡®åœ°åˆå§‹åŒ–å¯¹è±¡å˜å¾—æ›´éš¾äº†ã€‚</p>
<p>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯, åå­— <code>new</code> åœ¨ Raku ä¸­å¹¶ä¸ç‰¹åˆ«ã€‚å®ƒåªæ˜¯ä¸€ä¸ªå¸¸è§çš„çº¦å®š, åœ¨<a href="https://docs.raku.org/routine/new">å¤§å¤šæ•°Rakuç±»ä¸­</a>éƒ½éå¸¸å½»åº•ã€‚ä½ å¯ä»¥ä»åœ¨è°ƒç”¨çš„ä»»ä½•æ–¹æ³•è°ƒç”¨ <code>bless</code>, æˆ–è€…ä½¿ç”¨ <code>CREATE</code> æ¥æ‘†å¼„ä½çº§åˆ«çš„å·¥ä½œã€‚</p>
<p><code>TWEAK</code> å­æ–¹æ³•å…è®¸ä½ åœ¨å¯¹è±¡æ„é€ åæ£€æŸ¥æˆ–ä¿®æ”¹å±æ€§ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">RectangleWithCachedArea</span> <span class="p">{</span>
    <span class="k">has</span> <span class="p">(</span><span class="nv">$.x1</span><span class="o">,</span> <span class="nv">$.x2</span><span class="o">,</span> <span class="nv">$.y1</span><span class="o">,</span> <span class="nv">$.y2</span><span class="p">);</span>
    <span class="k">has</span> <span class="nv">$.area</span><span class="p">;</span>

    <span class="k">submethod</span> <span class="nb">TWEAK</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$!area</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span> <span class="p">(</span><span class="nv">$!x2</span> <span class="o">-</span> <span class="nv">$!x1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="nv">$!y2</span> <span class="o">-</span> <span class="nv">$!y1</span><span class="p">)</span> <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="nb">say</span> <span class="n">RectangleWithCachedArea</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span> <span class="s">x2</span> <span class="o">=&gt;</span> <span class="mi">5</span>, <span class="s">x1</span> <span class="o">=&gt;</span> <span class="mi">1</span>, <span class="s">y2</span> <span class="o">=&gt;</span> <span class="mi">1</span>, <span class="s">y1</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="nf">area</span><span class="p">;</span>
<span class="c1"># OUTPUT: Â«4â¤Â» </span>
</code></pre></div><h2 id="å¯¹è±¡å…‹éš†">å¯¹è±¡å…‹éš†</h2>
<p>å…‹éš†æ˜¯ä½¿ç”¨æ‰€æœ‰å¯¹è±¡ä¸Šå¯ç”¨çš„<a href="https://docs.raku.org/routine/clone">clone</a>æ–¹æ³•å®Œæˆçš„, è¿™äº›å…‹éš†æ–¹æ³•å¯ä»¥æµ…å…‹éš†å…¬å…±å’Œç§æœ‰å±æ€§ã€‚å…¬å…±å±æ€§çš„æ–°å€¼å¯ä»¥ä½œä¸ºå‘½åå‚æ•°æä¾›ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.foo</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.bar</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="k">my</span> <span class="nv">$o1</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$o2</span> <span class="o">=</span> <span class="nv">$o1</span><span class="o">.</span><span class="nb">clone</span><span class="o">:</span> <span class="p">:</span><span class="s">bar</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>

<span class="nb">say</span> <span class="nv">$o1</span><span class="p">;</span> <span class="c1"># Foo.new(foo =&gt; 42, bar =&gt; 100) </span>
<span class="nb">say</span> <span class="nv">$o2</span><span class="p">;</span> <span class="c1"># Foo.new(foo =&gt; 42, bar =&gt; 5000) </span>
</code></pre></div><p>æœ‰å…³å¦‚ä½•<a href="https://docs.raku.org/routine/clone">å…‹éš†</a>éæ ‡é‡å±æ€§çš„è¯¦ç»†ä¿¡æ¯, è¯·å‚é˜…æ–‡æ¡£ä»¥è·å–å…‹éš†, ä»¥åŠå®ç°è‡ªå·±çš„è‡ªå®šä¹‰å…‹éš†æ–¹æ³•çš„ç¤ºä¾‹ã€‚</p>
<h2 id="è§’è‰²">è§’è‰²</h2>
<p>è§’è‰²æ˜¯å±æ€§å’Œæ–¹æ³•çš„é›†åˆ; ä½†æ˜¯, ä¸ç±»ä¸åŒ, è§’è‰²ä»…ç”¨äºæè¿°å¯¹è±¡è¡Œä¸ºçš„ä¸€éƒ¨åˆ†; è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸€èˆ¬æ¥è¯´, è§’è‰²åº”è¯¥åœ¨ç±»å’Œå¯¹è±¡ä¸­æ··åˆä½¿ç”¨ã€‚é€šå¸¸, ç±»ç”¨äºç®¡ç†å¯¹è±¡, è€Œè§’è‰²ç”¨äºç®¡ç†å¯¹è±¡å†…çš„è¡Œä¸ºå’Œä»£ç é‡ç”¨ã€‚</p>
<p>è§’è‰²ä½¿ç”¨å…³é”®å­— <code>role</code> æ”¾åœ¨æ‰€å£°æ˜çš„è§’è‰²åç§°å‰é¢ã€‚è§’è‰²ä½¿ç”¨ <code>does</code> å…³é”®å­— mixed in, does å…³é”®å­—æ”¾åœ¨è§’è‰²åä¹‹å‰ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">constant</span> <span class="no">â²§</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2"> </span><span class="p">&#34;</span> <span class="ow">xx</span> <span class="mi">4</span><span class="p">;</span> <span class="c1"># Just a â²§ab </span>

<span class="k">role</span> <span class="nc">Notable</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nb">Str</span> <span class="nv">$.notes</span> <span class="k">is</span> <span class="k">rw</span><span class="p">;</span>
 
    <span class="k">multi</span> <span class="k">method</span> <span class="nf">notes</span><span class="p">()</span> <span class="p">{</span> <span class="p">&#34;</span><span class="nv">$!notes</span><span class="s2">\n</span><span class="p">&#34;</span> <span class="p">};</span>
    <span class="k">multi</span> <span class="k">method</span> <span class="nf">notes</span><span class="p">(</span> <span class="nb">Str</span> <span class="nv">$note</span> <span class="p">)</span> <span class="p">{</span> <span class="nv">$!notes</span> <span class="o">~=</span> <span class="p">&#34;</span><span class="nv">$note</span><span class="s2">\n</span><span class="p">&#34;</span> <span class="o">~</span> <span class="n">â²§</span> <span class="p">};</span>
<span class="p">}</span>
 
<span class="k">class</span> <span class="nc">Journey</span> <span class="k">does</span> <span class="nc">Notable</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.origin</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.destination</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">@.travelers</span><span class="p">;</span>
 
    <span class="k">method</span> <span class="nb">Str</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">â¤· </span><span class="nv">$!origin</span><span class="s2">\n</span><span class="p">&#34;</span> <span class="o">~</span> <span class="n">â²§</span> <span class="o">~</span> <span class="nb">self</span><span class="o">.</span><span class="nf">notes</span><span class="p">()</span> <span class="o">~</span> <span class="p">&#34;</span><span class="nv">$!destination</span><span class="s2"> â¤¶\n</span><span class="p">&#34;</span> <span class="p">};</span>
<span class="p">}</span>
 
<span class="k">my</span> <span class="nv">$trip</span> <span class="o">=</span> <span class="n">Journey</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span> <span class="p">:</span><span class="s">origin</span><span class="p">&lt;</span><span class="s">Here</span><span class="p">&gt;</span><span class="o">,</span> <span class="p">:</span><span class="s">destination</span><span class="p">&lt;</span><span class="s">There</span><span class="p">&gt;</span><span class="o">,</span>
                        <span class="s">travelers</span> <span class="o">=&gt;</span> <span class="p">&lt;</span><span class="s">Ã¾or Freya</span><span class="p">&gt;</span> <span class="p">);</span>
 
<span class="nv">$trip</span><span class="o">.</span><span class="nf">notes</span><span class="p">(&#34;</span><span class="s2">First steps</span><span class="p">&#34;);</span>
<span class="nf">notes</span> <span class="nv">$trip:</span> <span class="p">&#34;</span><span class="s2">Almost there</span><span class="p">&#34;;</span>
<span class="nb">print</span> <span class="nv">$trip</span><span class="p">;</span>

<span class="c1"># OUTPUT: </span>
<span class="c1">#â¤· Here </span>
<span class="c1">#       First steps </span>
<span class="c1">#       Almost there </span>
<span class="c1"># </span>
<span class="c1">#There â¤¶ </span>
</code></pre></div><p>ä¸€æ—¦ç¼–è¯‘å™¨è§£æè§’è‰²å£°æ˜çš„ç»“æŸå¤§æ‹¬å·, è§’è‰²å°±æ˜¯ä¸å¯å˜çš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">Serializable</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">serialize</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">self</span><span class="o">.</span><span class="nb">perl</span><span class="p">;</span> <span class="c1"># å¾ˆç²—è¶…çš„åºåˆ—åŒ–</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">deserialization-code</span><span class="p">(</span><span class="nv">$buf</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">EVAL</span> <span class="nv">$buf</span><span class="p">;</span> <span class="c1">#  åè½¬ .perl æ“ä½œ</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Point</span> <span class="k">does</span> <span class="nc">Serializable</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.x</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.y</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$p</span> <span class="o">=</span> <span class="n">Point</span><span class="o">.</span><span class="nb">new</span><span class="p">(:</span><span class="s">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">y</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
<span class="k">my</span> <span class="nv">$serialized</span> <span class="o">=</span> <span class="nv">$p</span><span class="o">.</span><span class="nf">serialize</span><span class="p">;</span>  <span class="c1"># ç”± role æä¾›çš„æ–¹æ³•</span>
<span class="k">my</span> <span class="nv">$clone-of-p</span> <span class="o">=</span> <span class="n">Point</span><span class="o">.</span><span class="nf">deserialization-code</span><span class="p">(</span><span class="nv">$serialized</span><span class="p">);</span>

<span class="nb">say</span> <span class="nv">$clone-of-p</span><span class="o">.</span><span class="nb">x</span><span class="p">;</span>      <span class="c1"># 1</span>
</code></pre></div><p>ç¼–è¯‘å™¨ä¸€è§£æåˆ° role å£°æ˜çš„é—­åˆèŠ±æ‹¬å·, roles å°±ä¸å¯å˜äº†ã€‚</p>
<h2 id="åº”ç”¨è§’è‰²">åº”ç”¨è§’è‰²</h2>
<p>è§’è‰²åº”ç”¨ç¨‹åºä¸ç±»ç»§æ‰¿æœ‰å¾ˆå¤§ä¸åŒã€‚å°†è§’è‰²åº”ç”¨äºç±»æ—¶, è¯¥è§’è‰²çš„æ–¹æ³•å°†å¤åˆ¶åˆ°ç±»ä¸­ã€‚å¦‚æœå°†å¤šä¸ªè§’è‰²åº”ç”¨äºåŒä¸€ä¸ªç±», åˆ™å†²çªï¼ˆä¾‹å¦‚, åŒåçš„å±æ€§æˆ– non-multi æ–¹æ³•ï¼‰ä¼šå¯¼è‡´ç¼–è¯‘æ—¶é”™è¯¯, è¿™å¯ä»¥é€šè¿‡åœ¨ç±»ä¸­æä¾›åŒåçš„æ–¹æ³•æ¥è§£å†³ã€‚</p>
<p>è¿™æ¯”å¤šé‡ç»§æ‰¿å®‰å…¨å¾—å¤š, å…¶ä¸­ç¼–è¯‘å™¨ä»ä¸æ£€æµ‹å†²çª, è€Œæ˜¯è§£æä¸ºæ–¹æ³•è§£æé¡ºåºä¸­è¾ƒæ—©å‡ºç°çš„è¶…ç±», è¿™å¯èƒ½ä¸æ˜¯ç¨‹åºå‘˜æƒ³è¦çš„ã€‚</p>
<p>ä¾‹å¦‚, å¦‚æœä½ å·²ç»å‘ç°äº†ä¸€ç§æœ‰æ•ˆçš„æ–¹æ³•æ¥éª‘ç‰›, å¹¶è¯•å›¾æŠŠå®ƒä½œä¸ºä¸€ç§æ–°çš„æµè¡Œäº¤é€šå½¢å¼æ¨é”€, ä½ å¯èƒ½ä¼šæœ‰ä¸€ä¸ª <code>Bull</code> ç±», å¯¹äºä½ åœ¨æˆ¿å­å‘¨å›´çš„æ‰€æœ‰å…¬ç‰›, ä»¥åŠä¸€ä¸ª <code>Automobile</code> ç±», ä½ å¯ä»¥é©¾é©¶çš„ä¸œè¥¿ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Bull</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nb">Bool</span> <span class="nv">$.castrated</span> <span class="o">=</span> <span class="nb">False</span><span class="p">;</span>

    <span class="k">method</span> <span class="nf">steer</span> <span class="p">{</span>
        <span class="c1"># Turn your bull into a steer </span>
        <span class="nv">$!castrated</span> <span class="o">=</span> <span class="nb">True</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">self</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Automobile</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.direction</span><span class="p">;</span>
    <span class="k">method</span> <span class="nf">steer</span><span class="p">(</span><span class="nv">$!direction</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Taurus</span> <span class="k">is</span> <span class="nc">Bull</span> <span class="k">is</span> <span class="nc">Automobile</span> <span class="p">{</span> <span class="p">}</span>
 
<span class="k">my</span> <span class="nv">$t</span> <span class="o">=</span> <span class="n">Taurus</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$t</span><span class="o">.</span><span class="nf">steer</span><span class="p">;</span>
<span class="c1"># OUTPUT: Â«Taurus.new(castrated =&gt; Bool::True, direction =&gt; Any)â¤Â» </span>
</code></pre></div><p>é€šè¿‡è¿™ç§è®¾ç½®, æ‚¨çš„è´«å›°å®¢æˆ·å°†å‘ç°è‡ªå·±æ— æ³•è½¬åŠ¨ä»–ä»¬çš„é‡‘ç‰›åº§, æ‚¨å°†æ— æ³•ç”Ÿäº§æ›´å¤šçš„äº§å“ï¼åœ¨è¿™ç§æƒ…å†µä¸‹, ä½¿ç”¨è§’è‰²å¯èƒ½æ›´å¥½ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">Bull-Like</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nb">Bool</span> <span class="nv">$.castrated</span> <span class="o">=</span> <span class="nb">False</span><span class="p">;</span>

    <span class="k">method</span> <span class="nf">steer</span> <span class="p">{</span>
        <span class="c1"># Turn your bull into a steer </span>
        <span class="nv">$!castrated</span> <span class="o">=</span> <span class="nb">True</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">self</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">role</span> <span class="nc">Steerable</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nb">Real</span> <span class="nv">$.direction</span><span class="p">;</span>
    <span class="k">method</span> <span class="nf">steer</span><span class="p">(</span><span class="nb">Real</span> <span class="nv">$d</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$!direction</span> <span class="o">+=</span> <span class="nv">$d</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">class</span> <span class="nc">Taurus</span> <span class="k">does</span> <span class="nc">Bull-Like</span> <span class="k">does</span> <span class="nc">Steerable</span> <span class="p">{</span> <span class="p">}</span>
</code></pre></div><p>è¿™æ®µä»£ç ä¼šæ­»äºï¼š</p>
<pre><code>===SORRY!===
Method 'steer' must be resolved by class Taurus because it exists in
multiple roles (Steerable, Bull-Like)
</code></pre><p>è¿™é¡¹æ£€æŸ¥å¯ä»¥ä¸ºä½ çœå»å¾ˆå¤šéº»çƒ¦ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Taurus</span> <span class="k">does</span> <span class="nc">Bull-Like</span> <span class="k">does</span> <span class="nc">Steerable</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">steer</span><span class="p">(</span><span class="nv">$direction</span><span class="o">?</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">self</span><span class="o">.</span><span class="nf">Steerable::steer</span><span class="p">(</span><span class="nv">$direction</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>å°†è§’è‰²åº”ç”¨äºç¬¬äºŒä¸ªè§’è‰²æ—¶, å®é™…åº”ç”¨ç¨‹åºå°†å»¶è¿Ÿ, ç›´åˆ°ç¬¬äºŒä¸ªè§’è‰²åº”ç”¨äºç±», æ­¤æ—¶ä¸¤ä¸ªè§’è‰²éƒ½å°†åº”ç”¨äºè¯¥ç±»ã€‚ä»è€Œ</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">R1</span> <span class="p">{</span>
    <span class="c1"># methods here </span>
<span class="p">}</span>

<span class="k">role</span> <span class="nc">R2</span> <span class="k">does</span> <span class="nc">R1</span> <span class="p">{</span>
    <span class="c1"># methods here </span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">C</span> <span class="k">does</span> <span class="nc">R2</span> <span class="p">{</span> <span class="p">}</span>
</code></pre></div><p>äº§ç”Ÿç›¸åŒç±» <code>C</code> ä¸º</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">R1</span> <span class="p">{</span>
    <span class="c1"># methods here </span>
<span class="p">}</span>

<span class="k">role</span> <span class="nc">R2</span> <span class="p">{</span>
    <span class="c1"># methods here </span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">C</span> <span class="k">does</span> <span class="nc">R1</span> <span class="k">does</span> <span class="nc">R2</span> <span class="p">{</span> <span class="p">}</span>
</code></pre></div><h2 id="stubs">Stubs</h2>
<p>å½“è§’è‰²åŒ…å« <a href="https://docs.raku.org/routine/....html">stubbed</a> æ–¹æ³•æ—¶, å¿…é¡»åœ¨å°†è§’è‰²åº”ç”¨äºç±»æ—¶æä¾›åŒåæ–¹æ³•çš„ non-stubbed  ç‰ˆæœ¬ã€‚è¿™å…è®¸æ‚¨åˆ›å»ºå……å½“æŠ½è±¡æ¥å£çš„è§’è‰²ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">AbstractSerializable</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">serialize</span><span class="p">()</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>        <span class="c1"># literal ... here marks the </span>
                                      <span class="c1"># method as a stub </span>
<span class="p">}</span>
 
<span class="c1"># the following is a compile time error, for example </span>
<span class="c1">#        Method &#39;serialize&#39; must be implemented by Point because </span>
<span class="c1">#        it&#39;s required by a role </span>
 
<span class="k">class</span> <span class="nc">APoint</span> <span class="k">does</span> <span class="nc">AbstractSerializable</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.x</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.y</span><span class="p">;</span>
<span class="p">}</span>
 
<span class="c1"># this works: </span>
<span class="k">class</span> <span class="nc">SPoint</span> <span class="k">does</span> <span class="nc">AbstractSerializable</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.x</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.y</span><span class="p">;</span>
    <span class="k">method</span> <span class="nf">serialize</span><span class="p">()</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">p(</span><span class="nv">$.x</span><span class="s2">, </span><span class="nv">$.y</span><span class="s2">)</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>stubbed æ–¹æ³•çš„å®ç°ä¹Ÿå¯ä»¥ç”±å¦ä¸€ä¸ªè§’è‰²æä¾›ã€‚</p>
<h2 id="ç»§æ‰¿-1">ç»§æ‰¿</h2>
<p>è§’è‰²ä¸èƒ½ä»ç±»ç»§æ‰¿, ä½†å®ƒä»¬å¯ä»¥æºå¸¦ç±», å¯¼è‡´ä»»ä½•å…·æœ‰è¯¥è§’è‰²çš„ç±»ä»æ‰¿è½½çš„ç±»ç»§æ‰¿ã€‚æ‰€ä»¥, å¦‚æœä½ å†™ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">A</span> <span class="k">is</span> <span class="nb">Exception</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">class</span> <span class="ne">X::Ouch</span> <span class="k">does</span> <span class="nc">A</span> <span class="p">{</span> <span class="p">}</span>
<span class="ne">X::Ouch</span><span class="o">.^</span><span class="nb">parents</span><span class="o">.</span><span class="nb">say</span> <span class="c1"># OUTPUT: Â«((Exception))â¤Â»</span>
</code></pre></div><p>ç„¶å <code>X::Ouch</code> å°†ç›´æ¥ä» Exception ç»§æ‰¿, æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ—å‡ºå…¶çˆ¶é¡¹æ¥çœ‹åˆ°ã€‚</p>
<p>ç”±äºå®ƒä»¬ä¸ä½¿ç”¨å¯èƒ½ç§°ä¸ºç»§æ‰¿çš„ä¸œè¥¿, å› æ­¤è§’è‰²ä¸æ˜¯ç±»å±‚æ¬¡ç»“æ„çš„ä¸€éƒ¨åˆ†ã€‚ä½¿ç”¨ <code>.^roles</code> å…ƒæ–¹æ³•åˆ—å‡ºè§’è‰², å®ƒä½¿ç”¨ <code>transitive</code> æ ‡è®°æ¥åŒ…å«æ‰€æœ‰çº§åˆ«æˆ–ä»…åŒ…å«ç¬¬ä¸€ä¸ªçº§åˆ«ã€‚å°½ç®¡å¦‚æ­¤, ä»ç„¶å¯ä»¥ä½¿ç”¨æ™ºèƒ½åŒ¹é…æˆ–ç±»å‹çº¦æŸæ¥æµ‹è¯•ç±»æˆ–å®ä¾‹, ä»¥æŸ¥çœ‹å®ƒæ˜¯å¦èµ·ä½œç”¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">F</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">class</span> <span class="nc">G</span> <span class="k">does</span> <span class="nc">F</span> <span class="p">{</span> <span class="p">}</span>
<span class="n">G</span><span class="o">.^</span><span class="nf">roles</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>                    <span class="c1"># OUTPUT: Â«((F))â¤Â» </span>
<span class="k">role</span> <span class="nc">Ur</span> <span class="p">{}</span>
<span class="k">role</span> <span class="nc">Ar</span> <span class="k">does</span> <span class="nc">Ur</span> <span class="p">{}</span>
<span class="k">class</span> <span class="nc">Whim</span> <span class="k">does</span> <span class="nc">Ar</span> <span class="p">{};</span> <span class="n">Whim</span><span class="o">.^</span><span class="nf">roles</span><span class="p">(:!</span><span class="s">transitive</span><span class="p">)</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>   <span class="c1"># OUTPUT: Â«((Ar))â¤Â» </span>
<span class="nb">say</span> <span class="n">G</span> <span class="o">~~</span> <span class="n">F</span><span class="p">;</span>                      <span class="c1"># OUTPUT: Â«Trueâ¤Â» </span>
<span class="k">multi</span> <span class="nf">a</span> <span class="p">(</span><span class="n">F</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">F</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">say</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nf">a</span> <span class="p">(</span><span class="nv">$a</span><span class="p">)</span>   <span class="p">{</span> <span class="p">&#34;</span><span class="s2">not F</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">say</span> <span class="p">}</span>
<span class="nf">a</span><span class="p">(</span><span class="n">G</span><span class="p">);</span>                            <span class="c1"># OUTPUT: Â«Fâ¤Â» </span>
</code></pre></div><h2 id="ä¸»ä»ç§©åº">ä¸»ä»ç§©åº</h2>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">M</span> <span class="p">{</span>
  <span class="k">method</span> <span class="nb">f</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">I am in role M</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="p">}</span>
 
<span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>
  <span class="k">method</span> <span class="nb">f</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">I am in class A</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="p">}</span>
 
<span class="k">class</span> <span class="nc">B</span> <span class="k">is</span> <span class="nc">A</span> <span class="k">does</span> <span class="nc">M</span> <span class="p">{</span>
  <span class="k">method</span> <span class="nb">f</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">I am in class B</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="p">}</span>
 
<span class="k">class</span> <span class="nc">C</span> <span class="k">is</span> <span class="nc">A</span> <span class="k">does</span> <span class="nc">M</span> <span class="p">{</span> <span class="p">}</span>
 
<span class="n">B</span><span class="o">.</span><span class="nb">new</span><span class="o">.</span><span class="nb">f</span><span class="p">;</span> <span class="c1"># OUTPUT Â«I am in class Bâ¤Â» </span>
<span class="n">C</span><span class="o">.</span><span class="nb">new</span><span class="o">.</span><span class="nb">f</span><span class="p">;</span> <span class="c1"># OUTPUT Â«I am in role Mâ¤Â» </span>
</code></pre></div><p>è¯·æ³¨æ„, multi-method çš„æ¯ä¸ªå€™é€‰é¡¹éƒ½æ˜¯å®ƒè‡ªå·±çš„æ–¹æ³•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹, ä»¥ä¸Šä»…é€‚ç”¨äºä¸¤ä¸ªè¿™æ ·çš„å€™é€‰é¡¹å…·æœ‰ç›¸åŒç­¾åçš„æƒ…å†µã€‚å¦åˆ™, æ²¡æœ‰å†²çª, å€™é€‰è€…åªæ˜¯æ·»åŠ åˆ° multi-method ä¸­ã€‚</p>
<h2 id="è‡ªåŠ¨è§’è‰²åŒå…³">è‡ªåŠ¨è§’è‰²åŒå…³</h2>
<p>ä»»ä½•ç›´æ¥å®ä¾‹åŒ–è§’è‰²æˆ–å°†å…¶ç”¨ä½œç±»å‹å¯¹è±¡çš„å°è¯•éƒ½å°†è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªä¸è§’è‰²åŒåçš„ç±», ä»è€Œå¯ä»¥é€æ˜åœ°ä½¿ç”¨è§’è‰², å°±å¥½åƒå®ƒæ˜¯ä¸€ä¸ªç±»ä¸€æ ·ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">Point</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.x</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.y</span><span class="p">;</span>

    <span class="k">method</span> <span class="nb">abs</span> <span class="p">{</span> <span class="nb">sqrt</span><span class="p">(</span><span class="nv">$.x</span> <span class="o">*</span> <span class="nv">$.x</span> <span class="o">+</span> <span class="nv">$.y</span> <span class="o">*</span> <span class="nv">$.y</span><span class="p">)</span> <span class="p">}</span>
    <span class="k">method</span> <span class="nf">dimensions</span> <span class="p">{</span> <span class="mi">2</span> <span class="p">}</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="n">Point</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">x</span> <span class="o">=&gt;</span> <span class="mi">6</span>, <span class="s">y</span> <span class="o">=&gt;</span> <span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="nb">abs</span><span class="p">;</span> <span class="c1"># OUTPUT Â«10â¤Â» </span>
<span class="nb">say</span> <span class="n">Point</span><span class="o">.</span><span class="nf">dimensions</span><span class="p">;</span>              <span class="c1"># OUTPUT Â«2â¤Â» </span>
</code></pre></div><p>æˆ‘ä»¬æŠŠè¿™ç§è‡ªåŠ¨åˆ›å»ºçš„ç±»å«åŒå…³, å¹¶ä¸”å°†ç”Ÿæˆçš„ç±»å«åŒå…³è¯­ã€‚</p>
<p>ä½†æ˜¯, Punning ä¸æ˜¯ç”±å¤§å¤šæ•°<a href="https://docs.raku.org/language/mop">å…ƒç¼–ç¨‹</a>æ„é€ å¼•èµ·çš„, å› ä¸ºå®ƒä»¬æœ‰æ—¶ç”¨äºç›´æ¥ä½¿ç”¨è§’è‰²ã€‚</p>
<h2 id="å‚æ•°åŒ–è§’è‰²">å‚æ•°åŒ–è§’è‰²</h2>
<p>è§’è‰²å¯ä»¥é€šè¿‡åœ¨æ–¹æ‹¬å·ä¸­ç»™å®ƒä»¬ç­¾åæ¥å‚æ•°åŒ–ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">BinaryTree</span><span class="o">[:</span><span class="p">:</span><span class="s">Type</span><span class="o">]</span> <span class="p">{</span>
    <span class="k">has</span> <span class="n">BinaryTree</span><span class="o">[</span><span class="n">Type</span><span class="o">]</span> <span class="nv">$.left</span><span class="p">;</span>
    <span class="k">has</span> <span class="n">BinaryTree</span><span class="o">[</span><span class="n">Type</span><span class="o">]</span> <span class="nv">$.right</span><span class="p">;</span>
    <span class="k">has</span> <span class="n">Type</span> <span class="nv">$.node</span><span class="p">;</span>
 
    <span class="k">method</span> <span class="nf">visit-preorder</span><span class="p">(</span><span class="nv">&amp;cb</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">cb</span> <span class="nv">$.node</span><span class="p">;</span>
        <span class="k">for</span> <span class="nv">$.left</span><span class="o">,</span> <span class="nv">$.right</span> <span class="k">-&gt;</span> <span class="nv">$branch</span> <span class="p">{</span>
            <span class="nv">$branch</span><span class="o">.</span><span class="nf">visit-preorder</span><span class="p">(</span><span class="nv">&amp;cb</span><span class="p">)</span> <span class="k">if</span> <span class="nb">defined</span> <span class="nv">$branch</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">visit-postorder</span><span class="p">(</span><span class="nv">&amp;cb</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="nv">$.left</span><span class="o">,</span> <span class="nv">$.right</span> <span class="k">-&gt;</span> <span class="nv">$branch</span> <span class="p">{</span>
            <span class="nv">$branch</span><span class="o">.</span><span class="nf">visit-postorder</span><span class="p">(</span><span class="nv">&amp;cb</span><span class="p">)</span> <span class="k">if</span> <span class="nb">defined</span> <span class="nv">$branch</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">cb</span> <span class="nv">$.node</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">new-from-list</span><span class="p">(</span><span class="vg">::?CLASS:U</span><span class="o">:</span> <span class="o">*</span><span class="nv">@el</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">$middle-index</span> <span class="o">=</span> <span class="nv">@el</span><span class="o">.</span><span class="nb">elems</span> <span class="ow">div</span> <span class="mi">2</span><span class="p">;</span>
        <span class="k">my</span> <span class="nv">@left</span>         <span class="o">=</span> <span class="nv">@el</span><span class="o">[</span><span class="mi">0</span> <span class="o">..</span> <span class="nv">$middle-index</span> <span class="o">-</span> <span class="mi">1</span><span class="o">]</span><span class="p">;</span>
        <span class="k">my</span> <span class="nv">$middle</span>       <span class="o">=</span> <span class="nv">@el</span><span class="o">[</span><span class="nv">$middle-index</span><span class="o">]</span><span class="p">;</span>
        <span class="k">my</span> <span class="nv">@right</span>        <span class="o">=</span> <span class="nv">@el</span><span class="o">[</span><span class="nv">$middle-index</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">..</span> <span class="o">*]</span><span class="p">;</span>

        <span class="nb">self</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span>
            <span class="s">node</span>    <span class="o">=&gt;</span> <span class="nv">$middle</span>,
            <span class="s">left</span>    <span class="o">=&gt;</span> <span class="nv">@left</span>  <span class="o">??</span> <span class="nb">self</span><span class="o">.</span><span class="nf">new-from-list</span><span class="p">(</span><span class="nv">@left</span><span class="p">)</span>  <span class="o">!!</span> <span class="nb">self</span>,
            <span class="s">right</span>   <span class="o">=&gt;</span> <span class="nv">@right</span> <span class="o">??</span> <span class="nb">self</span><span class="o">.</span><span class="nf">new-from-list</span><span class="p">(</span><span class="nv">@right</span><span class="p">)</span> <span class="o">!!</span> <span class="nb">self</span>,
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="k">my</span> <span class="nv">$t</span> <span class="o">=</span> <span class="n">BinaryTree</span><span class="o">[</span><span class="nb">Int</span><span class="o">].</span><span class="nf">new-from-list</span><span class="p">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">6</span><span class="p">);</span>
<span class="nv">$t</span><span class="o">.</span><span class="nf">visit-preorder</span><span class="p">(</span><span class="nv">&amp;say</span><span class="p">);</span>    <span class="c1"># OUTPUT: Â«5â¤4â¤6â¤Â» </span>
<span class="nv">$t</span><span class="o">.</span><span class="nf">visit-postorder</span><span class="p">(</span><span class="nv">&amp;say</span><span class="p">);</span>   <span class="c1"># OUTPUT: Â«4â¤6â¤5â¤Â» </span>
</code></pre></div><p>è¿™é‡Œ, ç­¾ååªåŒ…å«ç±»å‹æ•è·, ä½†ä»»ä½•ç­¾åéƒ½å¯ä»¥ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">enum</span> <span class="n">Severity</span> <span class="p">&lt;</span><span class="s">debug info warn error critical</span><span class="p">&gt;;</span>
 
<span class="k">role</span> <span class="nc">Logging</span><span class="o">[</span><span class="nv">$filehandle</span> <span class="o">=</span> <span class="vg">$*ERR</span><span class="o">]</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nb">log</span><span class="p">(</span><span class="n">Severity</span> <span class="nv">$sev</span><span class="o">,</span> <span class="nv">$message</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$filehandle</span><span class="o">.</span><span class="nb">print</span><span class="p">(&#34;</span><span class="s2">[</span><span class="p">{</span><span class="nb">uc</span> <span class="nv">$sev</span><span class="p">}</span><span class="s2">] </span><span class="nv">$message</span><span class="s2">\n</span><span class="p">&#34;);</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="n">Logging</span><span class="o">[</span><span class="vg">$*OUT</span><span class="o">].</span><span class="nb">log</span><span class="p">(</span><span class="n">debug</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">here we go</span><span class="p">&#39;);</span> <span class="c1"># OUTPUT: Â«[DEBUG] here we goâ¤Â» </span>
</code></pre></div><p>æ‚¨å¯ä»¥æ‹¥æœ‰å¤šä¸ªåŒåè§’è‰², ä½†ç­¾åä¸åŒ; å¤šé‡åˆ†æ´¾çš„æ­£å¸¸è§„åˆ™é€‚ç”¨äºé€‰æ‹©å¤šä¸ªå€™é€‰è€…ã€‚</p>
<h2 id="æ··åˆè§’è‰²">æ··åˆè§’è‰²</h2>
<p>è§’è‰²å¯ä»¥æ··åˆåˆ°å¯¹è±¡ä¸­ã€‚è§’è‰²çš„ç»™å®šå±æ€§å’Œæ–¹æ³•å°†æ·»åŠ åˆ°å¯¹è±¡å·²æœ‰çš„æ–¹æ³•å’Œå±æ€§ä¸­ã€‚æ”¯æŒå¤šä¸ªmixinå’ŒåŒ¿åè§’è‰²ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">R</span> <span class="p">{</span> <span class="k">method</span> <span class="nb">Str</span><span class="p">()</span> <span class="p">{&#39;</span><span class="s1">hidden!</span><span class="p">&#39;}</span> <span class="p">};</span>
<span class="k">my</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">but</span> <span class="ow">R</span><span class="err">;</span>
<span class="k">sub</span> <span class="nb">f</span><span class="p">(</span>\<span class="n">bound</span><span class="p">){</span> <span class="nb">put</span> <span class="n">bound</span> <span class="p">};</span>
<span class="nb">f</span><span class="p">(</span><span class="nv">$i</span><span class="p">);</span> <span class="c1"># OUTPUT: Â«hidden!â¤Â» </span>
<span class="k">my</span> <span class="nv">@positional</span> <span class="o">:=</span> <span class="p">&lt;</span><span class="s">a b</span><span class="p">&gt;</span> <span class="k">but</span> <span class="ow">R</span><span class="err">;</span>
<span class="nb">say</span> <span class="nv">@positional</span><span class="o">.^</span><span class="nb">name</span><span class="p">;</span> <span class="c1"># OUTPUT: Â«List+{R}â¤Â» </span>
</code></pre></div><p>è¯·æ³¨æ„, å¯¹è±¡æ··åˆäº†è§’è‰², è€Œä¸æ˜¯å¯¹è±¡çš„ç±»æˆ–å®¹å™¨ã€‚å› æ­¤, <code>@</code>-sigiled å®¹å™¨å°†éœ€è¦ç»‘å®šä»¥ä½¿è§’è‰²åšæŒ, å¦‚ç¤ºä¾‹ä¸­çš„ <code>@positional</code> æ‰€ç¤ºã€‚æŸäº›è¿ç®—ç¬¦å°†è¿”å›ä¸€ä¸ªæ–°å€¼, ä»è€Œæœ‰æ•ˆåœ°ä»ç»“æœä¸­åˆ é™¤ mixinã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½¿ç”¨ <code>does</code> åœ¨å˜é‡å£°æ˜ä¸­æ··åˆè§’è‰²å¯èƒ½æ›´ä¸ºæ¸…æ™°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">R</span> <span class="p">{};</span>
<span class="k">my</span> <span class="nv">@positional</span> <span class="k">does</span> <span class="nc">R</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">a b</span><span class="p">&gt;;</span>
<span class="nb">say</span> <span class="nv">@positional</span><span class="o">.^</span><span class="nb">name</span><span class="p">;</span> <span class="c1"># OUTPUT: Â«Array+{R}â¤Â» </span>
</code></pre></div><p>è¿ç®—ç¬¦ <code>infix:&lt;but&gt;</code> æ¯”åˆ—è¡¨æ„é€ å‡½æ•°çª„ã€‚æä¾›è¦æ··åˆçš„è§’è‰²åˆ—è¡¨æ—¶, è¯·å§‹ç»ˆä½¿ç”¨æ‹¬å·ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">R1</span> <span class="p">{</span> <span class="k">method</span> <span class="nf">m</span> <span class="p">{}</span> <span class="p">}</span>
<span class="k">role</span> <span class="nc">R2</span> <span class="p">{</span> <span class="k">method</span> <span class="nf">n</span> <span class="p">{}</span> <span class="p">}</span>
<span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">but</span> <span class="nc">R1</span><span class="o">,</span><span class="n">R2</span><span class="p">;</span> <span class="c1"># R2 is in sink context, issues a WARNING </span>
<span class="nb">say</span> <span class="nv">$a</span><span class="o">.^</span><span class="nb">name</span><span class="p">;</span>
<span class="c1"># OUTPUT: Â«Int+{R1}â¤Â» </span>
<span class="k">my</span> <span class="nv">$all-roles</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">but</span> <span class="p">(</span><span class="n">R1</span><span class="o">,</span><span class="n">R2</span><span class="p">);</span>
<span class="nb">say</span> <span class="nv">$all-roles</span><span class="o">.^</span><span class="nb">name</span><span class="p">;</span> <span class="c1"># OUTPUT: Â«Int+{R1,R2}â¤Â» </span>
</code></pre></div><p>Mixins å¯ç”¨äºå¯¹è±¡ç”Ÿå‘½ä¸­çš„ä»»ä½•ä¸€ç‚¹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># A counter for Table of Contents </span>
<span class="k">role</span> <span class="nc">TOC-Counter</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nb">Int</span> <span class="nv">@!counters</span> <span class="k">is</span> <span class="k">default</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="k">method</span> <span class="nb">Str</span><span class="p">()</span> <span class="p">{</span> <span class="nv">@!counters</span><span class="o">.</span><span class="nb">join</span><span class="o">:</span> <span class="p">&#39;</span><span class="s1">.</span><span class="p">&#39;</span> <span class="p">}</span>
    <span class="k">method</span> <span class="nf">inc</span><span class="p">(</span><span class="nv">$level</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">@!counters</span><span class="o">[</span><span class="nv">$level</span> <span class="o">-</span> <span class="mi">1</span><span class="o">]++</span><span class="p">;</span>
        <span class="nv">@!counters</span><span class="o">.</span><span class="nb">splice</span><span class="p">(</span><span class="nv">$level</span><span class="p">);</span>
        <span class="nb">self</span>
    <span class="p">}</span>
<span class="p">}</span>
 
<span class="k">my</span> <span class="nb">Num</span> <span class="nv">$toc-counter</span> <span class="o">=</span> <span class="n">NaN</span><span class="p">;</span>     <span class="c1"># don&#39;t do math with Not A Number </span>
<span class="nb">say</span> <span class="nv">$toc-counter</span><span class="p">;</span>              <span class="c1"># OUTPUT: Â«NaNâ¤Â» </span>

<span class="nv">$toc-counter</span> <span class="k">does</span> <span class="nc">TOC-Counter</span><span class="p">;</span> <span class="c1"># now we mix the role in </span>
<span class="nv">$toc-counter</span><span class="o">.</span><span class="nf">inc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="nf">inc</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="nf">inc</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="nf">inc</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="nf">inc</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="nf">inc</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="nf">inc</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="nf">inc</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="nb">put</span> <span class="nv">$toc-counter</span> <span class="o">/</span> <span class="mi">1</span><span class="p">;</span>          <span class="c1"># OUTPUT: Â«NaNâ¤Â» (because that&#39;s numerical context) </span>
<span class="nb">put</span> <span class="nv">$toc-counter</span><span class="p">;</span>              <span class="c1"># OUTPUT: Â«2.2.2â¤Â» (put will call TOC-Counter::Str) </span>
</code></pre></div><p>è§’è‰²å¯ä»¥æ˜¯åŒ¿åçš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%seen</span> <span class="k">of</span> <span class="nb">Int</span> <span class="k">is</span> <span class="k">default</span><span class="p">(</span><span class="mi">0</span> <span class="k">but</span> <span class="k">role</span> <span class="nc">::</span> <span class="p">{</span> <span class="k">method</span> <span class="nb">Str</span><span class="p">()</span> <span class="p">{&#39;</span><span class="s1">NULL</span><span class="p">&#39;}</span> <span class="p">});</span>
<span class="nb">say</span> <span class="nv">%seen</span><span class="p">&lt;</span><span class="s">not-there</span><span class="p">&gt;;</span>          <span class="c1"># OUTPUT: Â«NULLâ¤Â» </span>
<span class="nb">say</span> <span class="nv">%seen</span><span class="p">&lt;</span><span class="s">not-there</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">defined</span><span class="p">;</span>  <span class="c1"># OUTPUT: Â«Trueâ¤Â» (0 may be False but is well defined) </span>
<span class="nb">say</span> <span class="nb">Int</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="nv">%seen</span><span class="p">&lt;</span><span class="s">not-there</span><span class="p">&gt;);</span> <span class="c1"># OUTPUT: Â«0â¤Â» </span>
</code></pre></div><h2 id="å…ƒå¯¹è±¡ç¼–ç¨‹å’Œè‡ªçœ">å…ƒå¯¹è±¡ç¼–ç¨‹å’Œè‡ªçœ</h2>
<p>Raku æœ‰ä¸€ä¸ªå…ƒå¯¹è±¡ç³»ç»Ÿ, è¿™æ„å‘³ç€å¯¹è±¡ã€ç±»ã€è§’è‰²ã€Grammarsã€enums ç­‰è¡Œä¸ºæœ¬èº«ç”±å…¶å®ƒå¯¹è±¡æ§åˆ¶; è¿™äº›å¯¹è±¡å«åšå…ƒå¯¹è±¡(æƒ³æƒ³å…ƒæ“ä½œç¬¦, å®ƒæ“ä½œçš„å¯¹è±¡æ˜¯æ™®é€šæ“ä½œç¬¦). åƒæ™®é€šå¯¹è±¡ä¸€æ ·, å…ƒå¯¹è±¡æ˜¯ç±»çš„å®ä¾‹, è¿™æ—¶æˆ‘ä»¬ç§°å®ƒä»¬ä¸ºå…ƒç±»ã€‚</p>
<p>å¯¹æ¯ä¸ªå¯¹è±¡æˆ–ç±», ä½ èƒ½é€šè¿‡è°ƒç”¨ <code>.HOW</code> æ–¹æ³•è·å–å…ƒå¯¹è±¡. æ³¨æ„, å°½ç®¡è¿™çœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªæ–¹æ³•è°ƒç”¨, ä½†å®ƒæ›´åƒå®ã€‚</p>
<p>æ‰€ä»¥, ä½ èƒ½ç”¨å…ƒå¯¹è±¡å¹²äº›ä»€ä¹ˆå‘¢? ä½ å¯ä»¥é€šè¿‡æ¯”è¾ƒå…ƒç±»çš„ç›¸ç­‰æ€§æ¥æ£€æŸ¥ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦å…·æœ‰åŒæ ·çš„å…ƒç±»:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="mi">1</span><span class="o">.</span><span class="nb">HOW</span> <span class="o">===</span>   <span class="mi">2</span><span class="o">.</span><span class="nb">HOW</span><span class="p">;</span>      <span class="c1"># True</span>
<span class="nb">say</span> <span class="mi">1</span><span class="o">.</span><span class="nb">HOW</span> <span class="o">===</span> <span class="nb">Int</span><span class="o">.</span><span class="nb">HOW</span><span class="p">;</span>      <span class="c1"># True</span>
<span class="nb">say</span> <span class="mi">1</span><span class="o">.</span><span class="nb">HOW</span> <span class="o">===</span> <span class="nb">Num</span><span class="o">.</span><span class="nb">HOW</span><span class="p">;</span>      <span class="c1"># False</span>
</code></pre></div><p>Raku ä½¿ç”¨å•è¯ <code>HOW</code>, Higher Order Workings, æ¥å¼•ç”¨å…ƒå¯¹è±¡ç³»ç»Ÿã€‚å› æ­¤, åœ¨ Rakudo ä¸­ä¸å¿…å¯¹æ­¤åƒæƒŠ, æ§åˆ¶ç±»è¡Œä¸ºçš„å…ƒç±»çš„ç±»åå«åš <code>Raku::Metamodel::ClassHow</code>ã€‚æ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ª <code>Raku::Metamodel::ClassHOW</code>çš„å®ä¾‹ã€‚</p>
<p>ä½†æ˜¯,ç†æ‰€å½“ç„¶çš„, å…ƒæ¨¡å‹ä¸ºä½ åšäº†å¾ˆå¤šã€‚ä¾‹å¦‚å®ƒå…è®¸ä½ å†…çœå¯¹è±¡å’Œç±»ã€‚å…ƒå¯¹è±¡æ–¹æ³•è°ƒç”¨çš„çº¦å®šæ˜¯, åœ¨å…ƒå¯¹è±¡ä¸Šè°ƒç”¨æ–¹æ³•, å¹¶ä¸”ä¼ é€’æ„Ÿå…´è¶£çš„å¯¹è±¡ä½œä¸ºå¯¹è±¡çš„ç¬¬ä¸€å‚æ•°ã€‚æ‰€ä»¥, è¦è·å–å¯¹è±¡çš„ç±»å, ä½ å¯ä»¥è¿™æ ·å†™:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$object</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$metaobject</span> <span class="o">=</span> <span class="mi">1</span><span class="o">.</span><span class="nb">HOW</span><span class="p">;</span>

<span class="nb">say</span> <span class="nv">$metaobject</span><span class="o">.</span><span class="nb">name</span><span class="p">(</span><span class="nv">$object</span><span class="p">);</span>      <span class="c1"># Int</span>
<span class="c1"># or shorter:</span>
<span class="nb">say</span> <span class="mi">1</span><span class="o">.</span><span class="nb">HOW</span><span class="o">.</span><span class="nb">name</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>                  <span class="c1"># Int</span>
</code></pre></div><p>ä¸ºäº†é¿å…ä½¿ç”¨åŒä¸€ä¸ªå¯¹è±¡ä¸¤æ¬¡, æœ‰ä¸€ä¸ªä¾¿æ·å†™æ³•:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="mi">1</span><span class="o">.^</span><span class="nb">name</span><span class="p">;</span>                        <span class="c1"># Int</span>
<span class="c1"># same as</span>
<span class="nb">say</span> <span class="mi">1</span><span class="o">.</span><span class="nb">HOW</span><span class="o">.</span><span class="nb">name</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>                  <span class="c1"># Int</span>
</code></pre></div><h2 id="å†…çœ">å†…çœ</h2>
<p>å†…çœå°±æ˜¯åœ¨è¿è¡Œæ—¶è·å–å¯¹è±¡æˆ–ç±»çš„ä¿¡æ¯çš„è¿‡ç¨‹ã€‚åœ¨ Raku ä¸­, æ‰€æœ‰çš„å†…çœéƒ½ä¼šæœæŸ¥åŸå¯¹è±¡ã€‚æ ‡å‡†çš„åŸºäºç±»å¯¹è±¡çš„ ClassHow æä¾›äº†è¿™äº›å·¥å…·:</p>
<h3 id="can">can</h3>
<p>ç»™å®šä¸€ä¸ªæ–¹æ³•å, can è¿”å›å¯ç”¨çš„æ–¹æ³•å</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">A</span>      <span class="p">{</span> <span class="k">method</span> <span class="nb">x</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{}</span> <span class="p">};</span>
<span class="k">class</span> <span class="nc">B</span> <span class="k">is</span> <span class="nc">A</span> <span class="p">{</span> <span class="k">method</span> <span class="nb">x</span><span class="p">()</span>   <span class="p">{}</span> <span class="p">};</span>

<span class="nb">say</span> <span class="n">B</span><span class="o">.^</span><span class="nb">can</span><span class="p">(&#39;</span><span class="s1">x</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">elems</span><span class="p">;</span>              <span class="c1"># 2</span>
<span class="k">for</span> <span class="n">B</span><span class="o">.^</span><span class="nb">can</span><span class="p">(&#39;</span><span class="s1">x</span><span class="p">&#39;)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="o">.</span><span class="nb">arity</span><span class="p">;</span>                     <span class="c1"># 1, 2</span>
<span class="p">}</span>
</code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­, ç±» B ä¸­æœ‰ä¸¤ä¸ªåä¸º x çš„æ–¹æ³•å¯èƒ½å¯ç”¨(å°½ç®¡ä¸€ä¸ªæ­£å¸¸çš„æ–¹æ³•è°ƒç”¨ä»…ä»…ä¼šç›´æ¥è°ƒç”¨å®‰ç½®åœ¨ B ä¸­é‚£ä¸ªæ–¹æ³•). B ä¸­çš„é‚£ä¸ªæ–¹æ³•æœ‰ä¸€ä¸ªå‚æ•°(ä¾‹å¦‚, å®ƒæœŸæœ›ä¸€ä¸ªå‚æ•°, ä¸€ä¸ªè°ƒç”¨è€…(self)), è€Œ A ä¸­çš„ x æ–¹æ³•æœŸæœ› 2 ä¸ªå‚æ•°( self å’Œ $a).</p>
<h3 id="methods">methods</h3>
<p>è¿”å›ç±»ä¸­å¯ç”¨å…¬å…±æ–¹æ³•çš„åˆ—è¡¨( è¿™åŒ…æ‹¬çˆ¶ç±»å’Œ roles ä¸­çš„æ–¹æ³•). é»˜è®¤å®ƒä¼šåœåœ¨ç±» Cool, Any æˆ– Mu é‚£å„¿; è‹¥çœŸè¦è·å–æ‰€æœ‰çš„æ–¹æ³•, ä½¿ç”¨å‰¯è¯ <code>:all</code>.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nb">x</span><span class="p">()</span> <span class="p">{</span> <span class="p">};</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="n">A</span><span class="o">.^</span><span class="nb">methods</span><span class="p">();</span>                   <span class="c1"># x</span>
<span class="nb">say</span> <span class="n">A</span><span class="o">.^</span><span class="nb">methods</span><span class="p">(:</span><span class="s">all</span><span class="p">);</span>               <span class="c1"># x infinite defined ...</span>
</code></pre></div><h3 id="mro">mro</h3>
<p>æŒ‰æ–¹æ³•è§£æé¡ºåºè¿”å›ç±»è‡ªèº«çš„åˆ—è¡¨å’Œå®ƒä»¬çš„çˆ¶ç±».  å½“æ–¹æ³•è¢«è°ƒç”¨æ—¶, ç±»å’Œå®ƒçš„çˆ¶ç±»æŒ‰é‚£ä¸ªé¡ºåºè¢«è®¿é—®.(ä»…ä»…æ˜¯æ¦‚å¿µä¸Š; å®é™…ä¸Šæ–¹æ³•åˆ—è¡¨åœ¨ç±»æ„å»ºæ˜¯å°±åˆ›å»ºäº†).</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="mi">1</span><span class="o">.^</span><span class="nb">mro</span><span class="p">;</span>                         <span class="c1"># (Int) (Cool) (Any) (Mu)</span>
</code></pre></div><h3 id="name">name</h3>
<p>è¿”å›ç±»çš„åå­—:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#39;</span><span class="s1">a string</span><span class="p">&#39;</span><span class="o">.^</span><span class="nb">name</span><span class="p">;</span>               <span class="c1"># Str</span>
</code></pre></div><h3 id="parents">parents</h3>
<p>è¿”å›ä¸€ä¸ªçˆ¶ç±»çš„åˆ—è¡¨. é»˜è®¤å®ƒä¼šåœåœ¨ Cool, Any æˆ–è€… Mu é‚£å„¿, ä½†ä½ å¯ä»¥æä¾›ä¸€ä¸ªå‰¯è¯ <code>:all</code>æ¥å‹åˆ¶å®ƒ. ä½¿ç”¨å‰¯è¯ <code>:tree</code> ä¼šè¿”å›ä¸€ä¸ªåµŒå¥—åˆ—è¡¨.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">D</span>             <span class="p">{</span> <span class="p">};</span>
<span class="k">class</span> <span class="nc">C1</span> <span class="k">is</span> <span class="nc">D</span>       <span class="p">{</span> <span class="p">};</span>
<span class="k">class</span> <span class="nc">C2</span> <span class="k">is</span> <span class="nc">D</span>       <span class="p">{</span> <span class="p">};</span>
<span class="k">class</span> <span class="nc">B</span> <span class="k">is</span> <span class="nc">C1</span> <span class="k">is</span> <span class="nc">C2</span> <span class="p">{</span> <span class="p">};</span>
<span class="k">class</span> <span class="nc">A</span> <span class="k">is</span> <span class="nc">B</span>        <span class="p">{</span> <span class="p">};</span>

<span class="nb">say</span> <span class="n">A</span><span class="o">.^</span><span class="nb">parents</span><span class="p">(:</span><span class="s">all</span><span class="p">)</span><span class="o">.</span><span class="nb">perl</span><span class="p">;</span>          <span class="c1"># (B, C1, C2, D, Any, Mu)</span>
<span class="nb">say</span> <span class="n">A</span><span class="o">.^</span><span class="nb">parents</span><span class="p">(:</span><span class="s">all</span><span class="o">,</span> <span class="p">:</span><span class="s">tree</span><span class="p">)</span><span class="o">.</span><span class="nb">perl</span><span class="p">;</span>
    <span class="c1"># ([B, [C1, [D, [Any, [Mu]]]], [C2, [D, [Any, [Mu]]]]],)</span>
</code></pre></div><p><a href="https://docs.raku.org/language/objects">https://docs.raku.org/language/objects</a></p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/object" term="object" label="object" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä¸­çš„é¡¹]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-11-21-terms-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-11-21-terms-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Terms in Raku</blockquote><p>Raku ä¸­çš„å¤§éƒ¨åˆ†å¥æ³•ç»“æ„èƒ½å½’ç±»ä¸ºé¡¹å’Œæ“ä½œç¬¦. è¿™å„¿ä½ èƒ½æ‰¾åˆ°å„ç§ä¸åŒç±»å‹çš„é¡¹çš„æ¦‚è§ˆ.</p>
<h2 id="literals">Literals</h2>
<h3 id="int">Int</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="mi">42</span>
<span class="mi">12_300_00</span>
<span class="p">:</span><span class="mi">16</span><span class="p">&lt;</span><span class="s">DEAD_BEEF</span><span class="p">&gt;</span>    <span class="c1">#åå…­è¿›åˆ¶</span>
</code></pre></div><p>Int å­—é¢é‡ç”±æ•°å­—ç»„æˆ, å¹¶ä¸”èƒ½åœ¨æ•°å­—ä¹‹é—´åŒ…å«ä¸‹åˆ’çº¿. ä½¿ç”¨ <code>:radix&lt;number&gt;</code> å†’å·å¯¹å„¿å½¢å¼èƒ½æŒ‡å®š 10 è¿›åˆ¶å¤–çš„å…¶å®ƒè¿›åˆ¶.</p>
<h3 id="rat-æœ‰ç†æ•°">Rat æœ‰ç†æ•°</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="mf">12.34</span>
<span class="mf">1_200.345_678</span>
</code></pre></div><p>Rat(æœ‰ç†æ•°)å­—é¢é‡ç”±ä¸€ä¸ªç‚¹å·åˆ†å‰²çš„ä¸¤éƒ¨åˆ†æ•´æ•°ç»„æˆ. æ³¨æ„å°¾éƒ¨çš„ç‚¹å·æ˜¯ä¸å…è®¸çš„, æ‰€ä»¥ä½ å¿…é¡»å†™æˆ <code>1.0</code> è€Œé <code>1.</code> ( è¿™ä¸ªè§„åˆ™å¾ˆé‡è¦, å› ä¸ºæœ‰ä¸€ä¸ªä»¥ç‚¹å·å¼€å¤´çš„ä¸­ç¼€æ“ä½œç¬¦, ä¾‹å¦‚ <code>..</code> èŒƒå›´æ“ä½œç¬¦ ).</p>
<h3 id="num-æµ®ç‚¹æ•°">Num æµ®ç‚¹æ•°</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="mf">12.3e-32</span>
<span class="mf">3e8</span>
</code></pre></div><p>Num(æµ®ç‚¹æ•°)å­—é¢é‡ç”± Rat æˆ– Int å­—é¢é‡åé¢å†è·Ÿç€ä¸€ä¸ªå­—æ¯ e å’Œ ä¸€ä¸ªæŒ‡æ•°(å¯èƒ½ä¸ºè´Ÿ)ç»„æˆ. <code>3e8</code> ä½¿ç”¨ å€¼ <code>3* 10**8</code> æ„å»ºäº†ä¸€ä¸ª Num.</p>
<h3 id="str">Str</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">&#39;</span><span class="s1">a string</span><span class="p">&#39;&#39;</span><span class="s1">I\&#39;m escaped!</span><span class="p">&#39;</span>
<span class="p">&#34;</span><span class="s2">I don&#39;t need to be</span><span class="p">&#34;</span>
<span class="p">&#34;</span><span class="s2">\&#34;But I still can be,\&#34; he said.</span><span class="p">&#34;</span>
<span class="k">q</span><span class="p">|</span><span class="s">Other delimiters can be used too!</span>
</code></pre></div><p>å­—ç¬¦ä¸²å­—é¢é‡å¸¸å¸¸ä½¿ç”¨ <code>'</code> æˆ– <code>&quot;</code> åˆ›å»º, ç„¶å„¿, å­—ç¬¦ä¸²åœ¨ Raku ä¸­å…¶å®æ˜¯ä¸€ç§å¼ºå¤§çš„å­è¯­è¨€.</p>
<h3 id="regex">Regex</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">/</span><span class="sr"> match some text </span><span class="p">/</span>
<span class="k">rx</span><span class="p">/</span><span class="sr">slurp </span><span class="se">\s</span><span class="sr"> rest </span><span class="p">(</span><span class="ni">.</span><span class="o">*</span><span class="p">)</span><span class="sr"> </span><span class="ni">$</span><span class="p">/</span>
</code></pre></div><p>è¿™ä¸¤ç§ä¼šäº§ç”Ÿå­—é¢æ­£åˆ™ã€‚</p>
<h3 id="pair">Pair</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="s">a</span> <span class="o">=&gt;</span> <span class="mi">1</span>
<span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">b</span><span class="p">&#39;</span>
<span class="p">:</span><span class="s">identifier</span>
<span class="p">:!</span><span class="s">identifier</span>
<span class="p">:</span><span class="s">identifier</span><span class="p">&lt;</span><span class="s">value</span><span class="p">&gt;</span>
<span class="p">:</span><span class="s">identifier</span><span class="p">&lt;</span><span class="s">value1 value2</span><span class="p">&gt;</span>
<span class="p">:</span><span class="s">identifier</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span>
<span class="p">:</span><span class="s">identifier</span><span class="p">[&#39;</span><span class="s1">val1</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">val2</span><span class="p">&#39;]</span>
<span class="p">:</span><span class="s">identifier</span><span class="p">{</span><span class="s">key1</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">val1</span><span class="p">&#39;</span>, <span class="s">key2</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">value2</span><span class="p">&#39;}</span>
<span class="o">:</span><span class="nv">$item</span>
<span class="o">:</span><span class="nv">@array</span>
<span class="o">:</span><span class="nv">%hash</span>
<span class="o">:</span><span class="nv">&amp;callable</span>
</code></pre></div><p>Pair å¯¹è±¡çš„åˆ›å»ºè¦ä¹ˆä½¿ç”¨ <code>infix:Â«=&gt;Â»</code> (å®ƒä¼šè‡ªåŠ¨æ‹¬èµ·å·¦è¾¹, å¦‚æœå·¦è¾¹æ˜¯æ ‡è¯†ç¬¦çš„è¯), è¦ä¹ˆä½¿ç”¨å„ç§å†’å·å¯¹å„¿å½¢å¼.  é‚£äº›æ€»æ˜¯ä»¥ä¸€ä¸ªå†’å·å¼€å¤´çš„åˆ›å»ºå½¢å¼, å†’å·åé¢è¦ä¹ˆè·Ÿç€ä¸€ä¸ªæ ‡è¯†ç¬¦, è¦ä¹ˆè·Ÿç€ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å˜é‡(ä¸å¸¦ç¬¦å·çš„å˜é‡åä½œä¸º pair çš„é”®, å˜é‡çš„å€¼ä½œä¸º pair çš„é”®å€¼).</p>
<p>åœ¨æ ‡è¯†ç¬¦å½¢å¼çš„å†’å·å¯¹å„¿ä¸­, å¯é€‰çš„å€¼å¯ä»¥æ˜¯ä»»æ„ç¯ç¼€. å¦‚æœæ²¡æœ‰ç¯ç¼€, é‚£å®ƒçš„å€¼å°±æ˜¯ <code>Bool::True</code>. <code>!:identifier</code> å½¢å¼çš„å€¼æ˜¯ <code>Bool::False</code>.</p>
<p>å¦‚æœå†’å·å¯¹å„¿åœ¨å‚æ•°åˆ—è¡¨ä¸­, æ‰€æœ‰çš„å†’å·å¯¹å„¿éƒ½ä¼šä½œä¸ºå‘½åå‚æ•°, ä½†æ˜¯ <code>'quoted string' =&gt; $value</code> é™¤å¤–.</p>
<h3 id="term-">term *</h3>
<p><code>*</code> ä¼šåˆ›å»ºä¸€ä¸ªç±»å‹ä¸º Whatever çš„å¯¹è±¡. è¯¦æƒ…æŸ¥çœ‹ <a href="http://doc.raku.org/type/Whatever">Whatever</a>.</p>
<h2 id="identifier-terms">Identifier terms</h2>
<p>Rakuä¸­æœ‰å†…å»ºçš„æ ‡è¯†ç¬¦é¡¹, åˆ—å‡ºå¦‚ä¸‹. æ­¤å¤–, ä½¿ç”¨è¯¥è¯­æ³•èƒ½æ·»åŠ æ–°çš„æ ‡è¯†ç¬¦é¡¹.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">term</span><span class="o">:</span><span class="p">&lt;</span><span class="s">fourty-two</span><span class="p">&gt;</span> <span class="p">{</span> <span class="mi">42</span> <span class="p">};</span>
<span class="nb">say</span> <span class="n">fourty-two</span>
</code></pre></div><p>æˆ–è€…ä½œä¸ºå¸¸é‡:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">constant</span> <span class="no">forty-two</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
<span class="nb">say</span> <span class="n">fourty-two</span>
</code></pre></div><h3 id="self">self</h3>
<p>åœ¨æ–¹æ³•ä¸­, self æŒ‡å‘æ–¹æ³•çš„è°ƒç”¨è€…( ä¾‹å¦‚, æ–¹æ³•è¢«è°ƒç”¨çš„å¯¹è±¡). å¦‚æœæŠŠå®ƒç”¨åœ¨æ²¡æœ‰æ„ä¹‰çš„ä¸Šä¸‹æ–‡ä¸­, ä¼šæŠ›å‡ºä¸€ä¸ª <code> X::Syntax::NoSelf</code> ç±»å‹çš„ç¼–è¯‘æ—¶é”™è¯¯.</p>
<h3 id="now">now</h3>
<p>è¿”å›ä¸€ä¸ªä»£è¡¨å½“å‰æ—¶é—´çš„å®ä¾‹å¯¹è±¡.</p>
<h3 id="rand">rand</h3>
<p>è¿”å›ä¸€ä¸ªèŒƒå›´ä¸º <code>0..^1</code> çš„ä¼ªéšæœºæµ®ç‚¹æ•°.</p>
<h3 id="pi">pi</h3>
<p>è¿”å›æ•°å€¼ pi, ä¾‹å¦‚, åœ†çš„å‘¨é•¿å’ŒåŠå¾„ä¹‹é—´çš„æ¯”ç‡.</p>
<h3 id="e">e</h3>
<p>è¿”å›æ¬§æ‹‰æ•°å€¼.</p>
<h3 id="i">i</h3>
<p>è¿”å›å¤æ•°çš„è™šéƒ¨.</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/term" term="term" label="term" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku å…¥é—¨]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-12-21-raku-intro/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-12-21-raku-intro/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Raku Intro</blockquote><h2 id="ç¬¬å…«ç« -å‡½æ•°å¼ç¼–ç¨‹">ç¬¬å…«ç«  å‡½æ•°å¼ç¼–ç¨‹</h2>
<p>åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹çœ‹ä¸€äº›æœ‰åˆ©äºå‡½æ•°å¼ç¼–ç¨‹çš„åŠŸèƒ½ã€‚</p>
<h3 id="å‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘">å‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘</h3>
<p>å‡½æ•°/å­ä¾‹ç¨‹æ˜¯ä¸€ç­‰å…¬æ°‘:</p>
<ul>
<li>å®ƒä»¬èƒ½ä½œä¸ºå‚æ•°ä¼ é€’</li>
<li>å®ƒä»¬èƒ½ä»å¦å¤–ä¸€ä¸ªå‡½æ•°ä¸­è¿”å›</li>
<li>å®ƒä»¬èƒ½è¢«èµ‹å€¼ç»™å˜é‡</li>
</ul>
<p><code>map</code> å‡½æ•°æ˜¯ç”¨æ¥è¯´æ˜è¿™ä¸ªæ¦‚å¿µçš„æå¥½ä¾‹å­ã€‚<code>map</code> æ˜¯é«˜é˜¶å‡½æ•°, å®ƒæ¥æ”¶å¦å¤–ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ã€‚</p>
<p><strong>è„šæœ¬</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@array</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">1 2 3 4 5</span><span class="p">&gt;;</span>

<span class="k">sub</span> <span class="nf">squared</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$x</span> <span class="o">**</span> <span class="mi">2</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="nb">map</span><span class="p">(</span><span class="nv">&amp;squared</span><span class="o">,</span> <span class="nv">@array</span><span class="p">);</span>
</code></pre></div><p><strong>è¾“å‡º</strong></p>
<pre><code>(1 4 9 16 25)
</code></pre><p><strong>è§£é‡Š</strong></p>
<p>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå«åš <code>squared</code> çš„å­ä¾‹ç¨‹, å®ƒæ¥æ”¶ä¸€ä¸ªæ•°å­—å¹¶è¿”å›è¯¥æ•°å­—çš„äºŒæ¬¡å¹‚ã€‚ä¸‹ä¸€æ­¥, æˆ‘ä»¬ä½¿ç”¨ <code>map</code> è¿™ä¸ªé«˜é˜¶å‡½æ•°å¹¶ä¼ é€’ç»™å®ƒä¸¤ä¸ªå‚æ•°, ä¸€ä¸ªå­ä¾‹ç¨‹å’Œä¸€ä¸ªæ•°ç»„ã€‚ç»“æœæ˜¯æ‰€æœ‰æ•°ç»„å…ƒç´ çš„å¹³æ–¹ç»„æˆçš„åˆ—è¡¨ã€‚</p>
<p>æ³¨æ„å½“ä¼ é€’å­ä¾‹ç¨‹ä½œä¸ºå‚æ•°æ—¶, æˆ‘ä»¬éœ€è¦åœ¨å­ä¾‹ç¨‹çš„åå­—å‰æ·»åŠ ä¸€ä¸ª <code>&amp;</code> ç¬¦å·ã€‚</p>
<h3 id="é—­åŒ…">é—­åŒ…</h3>
<p>ã€€
åœ¨ Raku ä¸­æ‰€æœ‰çš„ä»£ç å¯¹è±¡éƒ½æ˜¯é—­åŒ…, è¿™æ„å‘³ç€å®ƒä»¬èƒ½ä»å¤–éƒ¨ä½œç”¨åŸŸ(outer scope)å¼•ç”¨è¯æ³•å˜é‡(lexical variables)ã€‚</p>
<h3 id="åŒ¿åå‡½æ•°">åŒ¿åå‡½æ•°</h3>
<p>ã€€
<strong>åŒ¿åå‡½æ•°</strong>ä¹Ÿå«åš <strong>lambda</strong>ã€‚</p>
<p>åŒ¿åå‡½æ•°æ²¡æœ‰ç»‘å®šåˆ°æ ‡è¯†ç¬¦(åŒ¿åå‡½æ•°æ²¡æœ‰åå­—)ã€‚</p>
<p>è®©æˆ‘ä»¬ä½¿ç”¨åŒ¿åå‡½æ•°é‡å†™ <code>map</code> é‚£ä¸ªä¾‹å­ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@array</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">1 2 3 4 5</span><span class="p">&gt;;</span>
<span class="nb">say</span> <span class="nb">map</span><span class="p">(</span><span class="k">-&gt;</span> <span class="nv">$x</span> <span class="p">{</span><span class="nv">$x</span> <span class="o">**</span> <span class="mi">2</span><span class="p">}</span><span class="o">,</span> <span class="nv">@array</span><span class="p">);</span>
</code></pre></div><p>æˆ‘ä»¬æ²¡æœ‰å£°æ˜å­ä¾‹ç¨‹å¹¶æŠŠå®ƒä½œä¸ºå‚æ•°ä¼ é€’ç»™ <code>map</code>, è€Œæ˜¯åœ¨é‡Œé¢ç›´æ¥å®šä¹‰äº†åŒ¿åå‡½æ•°ã€‚</p>
<p>åŒ¿åå‡½æ•° <code>-&gt; $x {$x ** 2}</code> æ²¡æœ‰å¥æŸ„å¹¶ä¸”ä¸èƒ½è¢«è°ƒç”¨ã€‚</p>
<p>æŒ‰ç…§ Raku çš„è¯´æ³•æˆ‘ä»¬æŠŠè¿™ä¸ªæ ‡è®°å«åš <strong>pointy block</strong>ã€‚</p>
<p>pointy block ä¹Ÿèƒ½ç”¨äºæŠŠå‡½æ•°èµ‹å€¼ç»™å˜é‡:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$squared</span> <span class="o">=</span> <span class="k">-&gt;</span> <span class="nv">$x</span> <span class="p">{</span>
    <span class="nv">$x</span> <span class="o">**</span> <span class="mi">2</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="nv">$squared</span><span class="p">(</span><span class="mi">9</span><span class="p">);</span>
</code></pre></div><h3 id="é“¾å¼è°ƒç”¨">é“¾å¼è°ƒç”¨</h3>
<p>ã€€
åœ¨ Raku ä¸­, æ–¹æ³•å¯ä»¥é“¾æ¥èµ·æ¥, ä½ ä¸å†éœ€è¦æŠŠä¸€ä¸ªæ–¹æ³•çš„ç»“æœä½œä¸ºå‚æ•°ä¼ é€’ç»™å¦å¤–ä¸€ä¸ªæ–¹æ³•äº†ã€‚</p>
<p>æˆ‘ä»¬å‡è®¾ä½ æœ‰ä¸€ä¸ªæ•°ç»„ã€‚ä½ è¢«è¦æ±‚è¿”å›è¯¥æ•°ç»„çš„å”¯ä¸€å€¼, å¹¶ä¸”æŒ‰ä»å¤§åˆ°å°çš„é¡ºåºæ’åºã€‚</p>
<p>ä½ å¯èƒ½ä¼šé€šè¿‡å†™å‡ºè¿‘ä¼¼äºè¿™æ ·çš„ä»£ç æ¥è§£å†³é‚£ä¸ªé—®é¢˜:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@array</span>       <span class="o">=</span> <span class="p">&lt;</span><span class="s">7 8 9 0 1 2 4 3 5 6 7 8 9 </span><span class="p">&gt;;</span>
<span class="k">my</span> <span class="nv">@final-array</span> <span class="o">=</span> <span class="nb">reverse</span><span class="p">(</span><span class="nb">sort</span><span class="p">(</span><span class="nb">unique</span><span class="p">(</span><span class="nv">@array</span><span class="p">)));</span>
<span class="nb">say</span> <span class="nv">@final-array</span><span class="p">;</span>
</code></pre></div><p>é¦–å…ˆæˆ‘ä»¬åœ¨ <code>@array</code> èº«ä¸Šè°ƒç”¨ <code>unique</code> å‡½æ•°, ç„¶åæˆ‘ä»¬æŠŠå®ƒçš„ç»“æœä½œä¸ºå‚æ•°ä¼ é€’ç»™ <code>sort</code> å‡½æ•°, å†ç„¶åæˆ‘ä»¬æŠŠç»“æœä¼ é€’ç»™ <code>reverse</code> å‡½æ•°ã€‚</p>
<p>å’Œä¸Šé¢çš„ä¾‹å­ç›¸æ¯”, Raku å…è®¸é“¾å¼æ–¹æ³•ã€‚</p>
<p>ä¸Šé¢çš„ä¾‹å­å¯ä»¥åƒä¸‹é¢è¿™æ ·å†™, åˆ©ç”¨<strong>æ–¹æ³•é“¾</strong>çš„ä¼˜ç‚¹:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@array</span>       <span class="o">=</span> <span class="p">&lt;</span><span class="s">7 8 9 0 1 2 4 3 5 6 7 8 9 </span><span class="p">&gt;;</span>
<span class="k">my</span> <span class="nv">@final-array</span> <span class="o">=</span> <span class="nv">@array</span><span class="o">.</span><span class="nb">unique</span><span class="o">.</span><span class="nb">sort</span><span class="o">.</span><span class="nb">reverse</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">@final-array</span><span class="p">;</span>
</code></pre></div><p>ä½ å·²ç»çœ‹åˆ°é“¾å¼æ–¹æ³•çœ‹èµ·æ¥æœ‰å¤šæ¸…çˆ½å•¦ã€‚</p>
<h3 id="feed-æ“ä½œç¬¦">Feed æ“ä½œç¬¦</h3>
<p>ã€€
<strong>feed æ“ä½œç¬¦</strong>, åœ¨æœ‰äº›å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ä¸­ä¹Ÿå«<strong>ç®¡é“</strong>, ç„¶è€Œå®ƒæ˜¯é“¾å¼æ–¹æ³•çš„ä¸€ä¸ªæ›´å¥½çš„å¯è§†åŒ–äº§å‡ºã€‚</p>
<p><strong>å‘å‰æµ</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@array</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">7 8 9 0 1 2 4 3 5 6</span><span class="p">&gt;;</span>
<span class="nv">@array</span> <span class="o">==&gt;</span> <span class="nb">unique</span><span class="p">()</span>
       <span class="o">==&gt;</span> <span class="nb">sort</span><span class="p">()</span>
       <span class="o">==&gt;</span> <span class="nb">reverse</span><span class="p">()</span>
       <span class="o">==&gt;</span> <span class="k">my</span> <span class="nv">@final-array</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">@final-array</span><span class="p">;</span>
</code></pre></div><p><strong>è§£é‡Š</strong></p>
<pre><code>ä» @array å¼€å§‹, ç„¶åè¿”å›ä¸€ä¸ªå”¯ä¸€å…ƒç´ çš„åˆ—è¡¨
                 ç„¶å æ’åºå®ƒ
                 ç„¶å åè½¬å®ƒ
                 ç„¶å æŠŠç»“æœä¿å­˜åˆ° @final-array ä¸­
</code></pre><p>å°±åƒä½ çœ‹åˆ°çš„é‚£æ ·, æ–¹æ³•çš„æµå‘æ˜¯è‡ªä¸Šè€Œä¸‹çš„ã€‚</p>
<p><strong>å‘åæµ</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@array</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">7 8 9 0 1 2 4 3 5 6</span><span class="p">&gt;;</span>
<span class="k">my</span> <span class="nv">@final-array-v2</span> <span class="o">&lt;==</span> <span class="nb">reverse</span><span class="p">()</span>
                   <span class="o">&lt;==</span> <span class="nb">sort</span><span class="p">()</span>
                   <span class="o">&lt;==</span> <span class="nb">unique</span><span class="p">()</span>
                   <span class="o">&lt;==</span> <span class="nv">@array</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">@final-array-v2</span><span class="p">;</span>
</code></pre></div><p><strong>è§£é‡Š</strong></p>
<p>å‘åæµå°±åƒå‘å‰æµä¸€æ ·, ä½†æ˜¯æ˜¯ä»¥åè½¬çš„é¡ºåºå†™çš„ã€‚</p>
<p>æ–¹æ³•çš„æµåŠ¨æ–¹å‘æ˜¯è‡ªä¸‹è€Œä¸Šã€‚</p>
<h3 id="hyper-æ“ä½œç¬¦">Hyper æ“ä½œç¬¦</h3>
<p>ã€€
<strong>hyper æ“ä½œç¬¦</strong> <code>Â».</code> ä¼šåœ¨åˆ—è¡¨çš„æ‰€æœ‰å…ƒç´ èº«ä¸Šè°ƒç”¨ä¸€ä¸ªæ–¹æ³•å¹¶è¿”å›æ‰€æœ‰ç»“æœçš„ä¸€ä¸ªåˆ—è¡¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@array</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">0 1 2 3 4 5 6 7 8 9 10</span><span class="p">&gt;;</span>
<span class="k">sub</span> <span class="nf">is-even</span><span class="p">(</span><span class="nv">$var</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$var</span> <span class="nv">%%</span> <span class="mi">2</span> <span class="p">};</span>

<span class="nb">say</span> <span class="nv">@array</span><span class="o">Â».</span><span class="nb">is-prime</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">@array</span><span class="o">Â».</span><span class="nv">&amp;is-even</span><span class="p">;</span>
</code></pre></div><p>ä½¿ç”¨ hyper æ“ä½œç¬¦æˆ‘ä»¬èƒ½è°ƒç”¨ Raku ä¸­å·²ç»å®šä¹‰è¿‡çš„æ–¹æ³•, ä¾‹å¦‚ <code>is-prime</code> å‘Šè¯‰æˆ‘ä»¬ä¸€ä¸ªæ•°å­—æ˜¯å¦æ˜¯è´¨æ•°ã€‚</p>
<p>æ­¤å¤–æˆ‘ä»¬èƒ½å®šä¹‰æ–°çš„å­ä¾‹ç¨‹å¹¶ä½¿ç”¨ hyper æ“ä½œç¬¦è°ƒç”¨å®ƒä»¬ã€‚ä½†æ˜¯è¿™æ—¶æˆ‘ä»¬å¿…é¡»åœ¨æ–¹æ³•çš„åå­—å‰é¢åŠ ä¸Š <code>&amp;</code> ç¬¦å·ã€‚ä¾‹å¦‚ <code>&amp;is-even</code>ã€‚</p>
<p>è¿™å¾ˆå®ç”¨å› ä¸ºå®ƒä½¿æˆ‘ä»¬ä¸å¿…å†™ <code>for</code> å¾ªç¯å°±å¯ä»¥è¿­ä»£æ¯ä¸ªå€¼ã€‚</p>
<h3 id="junctions">Junctions</h3>
<p>ã€€
<strong>junction</strong> æ˜¯å€¼çš„é€»è¾‘å åŠ ã€‚</p>
<p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ <code>1|2|3</code> æ˜¯ä¸€ä¸ª junctionã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$var</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="k">if</span> <span class="nv">$var</span> <span class="o">==</span> <span class="mi">1</span><span class="o">|</span><span class="mi">2</span><span class="o">|</span><span class="mi">3</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">The variable is 1 or 2 or 3</span><span class="p">&#34;</span>
<span class="p">}</span>
</code></pre></div><p>junctions çš„ä½¿ç”¨å¸¸å¸¸è§¦å‘<strong>è‡ªåŠ¨çº¿ç¨‹åŒ–</strong>; æ¯ä¸ª junction å…ƒç´ éƒ½æ‰§è¡Œè¯¥æ“ä½œ, å¹¶ä¸”æ‰€æœ‰çš„ç»“æœè¢«ç»„åˆåˆ°ä¸€ä¸ªæ–°çš„ junction ä¸­å¹¶è¿”å›ã€‚</p>
<h3 id="lazy-lists">Lazy Lists</h3>
<p>ã€€
<strong>æƒ°æ€§åˆ—è¡¨</strong>æ˜¯è¢«æƒ°æ€§æ±‚å€¼çš„åˆ—è¡¨ã€‚</p>
<p>æƒ°æ€§æ±‚å€¼å»¶è¿Ÿè¡¨è¾¾å¼çš„è®¡ç®—ç›´åˆ°éœ€è¦æ—¶, å¹¶æŠŠç»“æœå­˜å‚¨åˆ°æŸ¥è¯¢è¡¨ä¸­ä»¥é¿å…é‡å¤è®¡ç®—ã€‚</p>
<p>æƒ°æ€§åˆ—è¡¨çš„ä¼˜ç‚¹åŒ…æ‹¬:</p>
<ul>
<li>é€šè¿‡é¿å…ä¸å¿…è¦çš„è®¡ç®—å¸¦æ¥çš„æ€§èƒ½æå‡</li>
<li>æ„å»ºæ½œåœ¨çš„æ— é™æ•°æ®ç»“æ„çš„èƒ½åŠ›</li>
<li>å®šä¹‰æ§åˆ¶æµçš„èƒ½åŠ›</li>
</ul>
<p>æˆ‘ä»¬ä½¿ç”¨ä¸­ç¼€æ“ä½œç¬¦ <code>...</code> æ¥åˆ›å»ºæƒ°æ€§åˆ—è¡¨ã€‚</p>
<p>æƒ°æ€§åˆ—è¡¨æ‹¥æœ‰ä¸€ä¸ª<strong>åˆå§‹å…ƒç´ </strong>, ä¸€ä¸ª<strong>å‘ç”Ÿå™¨</strong>å’Œä¸€ä¸ª<strong>ç»“æŸç‚¹</strong>ã€‚</p>
<p><strong>ç®€å•çš„æƒ°æ€§åˆ—è¡¨</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$lazylist</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">...</span> <span class="mi">10</span><span class="p">);</span>
<span class="nb">say</span> <span class="nv">$lazylist</span><span class="p">;</span>
</code></pre></div><p>åˆå§‹å…ƒç´ ä¸º 1 è€Œç»“æŸç‚¹ä¸º 10ã€‚å› ä¸ºæ²¡æœ‰å®šä¹‰å‘ç”Ÿå™¨æ‰€ä»¥é»˜è®¤çš„å‘ç”Ÿå™¨ä¸º successor(+1)ã€‚æ¢å¥è¯è¯´, è¿™ä¸ªæƒ°æ€§åˆ—è¡¨å¯èƒ½è¿”å›(å¦‚æœéœ€è¦çš„è¯)ä¸‹é¢çš„å…ƒç´  (1, 2, 3, 4, 5, 6, 7, 8, 9, 10)ã€‚</p>
<p><strong>æ— é™æƒ°æ€§åˆ—è¡¨</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$lazylist</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">...</span> <span class="no">Inf</span><span class="p">);</span>
<span class="nb">say</span> <span class="nv">$lazylist</span><span class="p">;</span>
</code></pre></div><p>è¯¥åˆ—è¡¨å¯èƒ½è¿”å›(å¦‚æœéœ€è¦çš„è¯) 1 åˆ°æ— ç©·å¤§ä¹‹é—´çš„ä»»ä½•æ•´æ•°, æ¢å¥è¯è¯´, å¯ä»¥è¿”å›ä»»ä½•æ•´æ•°ã€‚</p>
<p><strong>ä½¿ç”¨æ¨æ–­å‘ç”Ÿå™¨åˆ›å»ºæƒ°æ€§åˆ—è¡¨</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$lazylist</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">2</span> <span class="o">...</span> <span class="mi">10</span><span class="p">);</span>
<span class="nb">say</span> <span class="nv">$lazylist</span><span class="p">;</span>
</code></pre></div><p>åˆå§‹çš„å…ƒç´ æ˜¯ 0 å’Œ 2 è€Œç»“æŸç‚¹æ˜¯ 10ã€‚è™½ç„¶æ²¡æœ‰å®šä¹‰å‘ç”Ÿå™¨, ä½†æ˜¯ä½¿ç”¨äº†åˆå§‹å…ƒç´ , Raku ä¼šæŠŠç”Ÿæˆå™¨æ¨æ–­ä¸º (+2)ã€‚</p>
<p>è¿™ä¸ªæƒ°æ€§åˆ—è¡¨å¯èƒ½è¿”å›(å¦‚æœéœ€è¦çš„è¯)ä¸‹é¢çš„å…ƒç´  (0, 2, 4, 6, 8, 10)ã€‚</p>
<p><strong>ä½¿ç”¨å®šä¹‰çš„å‘ç”Ÿå™¨åˆ›å»ºæƒ°æ€§åˆ—è¡¨</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$lazylist</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="p">{</span> <span class="nv">$_</span> <span class="o">+</span> <span class="mi">3</span> <span class="p">}</span> <span class="o">...</span> <span class="mi">12</span><span class="p">);</span>
<span class="nb">say</span> <span class="nv">$lazylist</span><span class="p">;</span>
</code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­, æˆ‘ä»¬åœ¨é—­åˆ <code>{ }</code> ä¸­æ˜¾å¼åœ°å®šä¹‰äº†ä¸€ä¸ªå‘ç”Ÿå™¨ã€‚</p>
<p>è¿™ä¸ªæƒ°æ€§åˆ—è¡¨å¯èƒ½è¿”å›(å¦‚æœéœ€è¦çš„è¯)ä¸‹é¢çš„å…ƒç´  (0, 3, 6, 9, 12)ã€‚</p>
<blockquote>
<p>å½“ä½¿ç”¨æ˜¾å¼çš„å‘ç”Ÿå™¨æ—¶, ç»“æŸç‚¹å¿…é¡»æ˜¯å‘ç”Ÿå™¨èƒ½è¿”å›çš„ä¸€ä¸ªå€¼ã€‚</p>
<p>å¦‚æœåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­æˆ‘ä»¬ä½¿ç”¨çš„ç»“æŸç‚¹æ˜¯ 10 è€Œé 12, é‚£ä¹ˆå‘ç”Ÿå™¨å°±ä¸ä¼šåœæ­¢ã€‚å‘ç”Ÿå™¨ä¼šè·³è¿‡é‚£ä¸ªç»“æŸç‚¹ã€‚</p>
<p>äºŒé€‰ä¸€, ä½ å¯ä»¥ä½¿ç”¨ <code>0 ...^ * &gt; 10</code> ä»£æ›¿ <code>0 ... 10</code>ã€‚ä½ å¯ä»¥æŠŠå®ƒè¯»ä½œ: ä» 0 ç›´åˆ°ç¬¬ä¸€ä¸ªå¤§äº 10(ä¸åŒ…æ‹¬å®ƒ)çš„å€¼</p>
<p><strong>è¿™ä¸ä¼šä½¿å‘ç”Ÿå™¨åœæ­¢</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span>  <span class="nv">$lazylist</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="p">{</span> <span class="nv">$_</span> <span class="o">+</span> <span class="mi">3</span> <span class="p">}</span> <span class="o">...</span> <span class="mi">10</span><span class="p">);</span>
<span class="nb">say</span> <span class="nv">$lazylist</span><span class="p">;</span>
</code></pre></div><p><strong>è¿™ä¼šä½¿å‘ç”Ÿå™¨åœæ­¢</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span>  <span class="nv">$lazylist</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="p">{</span> <span class="nv">$_</span> <span class="o">+</span> <span class="mi">3</span> <span class="p">}</span> <span class="o">...^</span> <span class="o">*</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">);</span>
<span class="nb">say</span> <span class="nv">$lazylist</span><span class="p">;</span>
</code></pre></div></blockquote>
<h2 id="ç¬¬ä¹ç« -ç±»å’Œå¯¹è±¡">ç¬¬ä¹ç«  ç±»å’Œå¯¹è±¡</h2>
<p>åœ¨ä¸Šä¸€ç« ä¸­æˆ‘ä»¬å­¦ä¹ äº† Raku ä¸­å‡½æ•°å¼ç¼–ç¨‹çš„ä¾¿åˆ©æ€§ã€‚åœ¨è¿™ä¸€ç« ä¸­æˆ‘ä»¬å°†çœ‹çœ‹ Raku ä¸­çš„é¢å‘å¯¹è±¡ç¼–ç¨‹ã€‚</p>
<h3 id="ä»‹ç»">ä»‹ç»</h3>
<p>ã€€
é¢å‘å¯¹è±¡ç¼–ç¨‹æ˜¯å½“ä»Šå¹¿æ³›ä½¿ç”¨çš„èŒƒå¼ä¹‹ä¸€ã€‚<strong>å¯¹è±¡</strong>æ˜¯ä¸€ç»„ç»‘å®šåœ¨ä¸€èµ·çš„å˜é‡å’Œå­ä¾‹ç¨‹ã€‚</p>
<p>å…¶ä¸­çš„å˜é‡å«åš<strong>å±æ€§</strong>, è€Œå­ä¾‹ç¨‹è¢«å«åš<strong>æ–¹æ³•</strong>ã€‚å±æ€§å®šä¹‰å¯¹è±¡çš„<strong>çŠ¶æ€</strong>, è€Œæ–¹æ³•å®šä¹‰å¯¹è±¡çš„<strong>è¡Œä¸º</strong>ã€‚</p>
<p><strong>ç±»</strong>å®šä¹‰ä¸€ç»„<strong>å¯¹è±¡</strong>ç»“æ„ã€‚</p>
<p>ä¸ºäº†ç†è§£å®ƒä»¬ä¹‹é—´çš„å…³ç³», è€ƒè™‘ä¸‹é¢çš„ä¾‹å­:</p>
<table>
<thead>
<tr>
<th style="text-align:left">æˆ¿é—´é‡Œæœ‰ 4 ä¸ª people</th>
<th style="text-align:left"><strong>objects</strong> =&gt; 4 people</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">è¿™ 4 ä¸ªäººæ˜¯ humans</td>
<td style="text-align:left"><strong>class</strong> =&gt; Human</td>
</tr>
<tr>
<td style="text-align:left">å®ƒä»¬æœ‰ä¸åŒçš„åå­—,å¹´çºª,æ€§åˆ«å’Œå›½ç±</td>
<td style="text-align:left"><strong>attribute</strong> =&gt; name,age,sex,nationality</td>
</tr>
</tbody>
</table>
<p>æŒ‰é¢å‘å¯¹è±¡çš„è¯´æ³•, å¯¹è±¡æ˜¯ç±»çš„<strong>å®ä¾‹</strong>ã€‚</p>
<p>è€ƒè™‘ä¸‹é¢çš„è„šæœ¬:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Human</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$age</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$sex</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$nationality</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$john</span> <span class="o">=</span> <span class="n">Human</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">name</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">John</span><span class="p">&#39;</span>,
                     <span class="s">age</span>  <span class="o">=&gt;</span> <span class="mi">23</span>,
                     <span class="s">sex</span>  <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">M</span><span class="p">&#39;</span>
                     <span class="s">nationality</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">American</span><span class="p">&#39;)</span>
<span class="nb">say</span> <span class="nv">$john</span><span class="p">;</span>
</code></pre></div><ul>
<li><code>class</code> å…³é”®å­—ç”¨äºå®šä¹‰ç±»ã€‚</li>
<li><code>has</code> å…³é”®å­—ç”¨äºå®šä¹‰ç±»çš„å±æ€§ã€‚</li>
<li><code>.new</code> æ–¹æ³•è¢«ç§°ä¹‹ä¸º<strong>æ„é€ å‡½æ•°</strong>ã€‚å®ƒåˆ›å»ºäº†å¯¹è±¡ä½œä¸ºç±»çš„å®ä¾‹ã€‚</li>
</ul>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, æ–°çš„å˜é‡ <code>$john</code> ä¿å­˜äº†ç”± <code>Human.new()</code> æ‰€å®šä¹‰çš„æ–° &ldquo;Human&rdquo; å®ä¾‹ã€‚
ä¼ é€’ç»™ <code>.new()</code> æ–¹æ³•çš„å‚æ•°ç”¨äºè®¾ç½®åº•å±‚å¯¹è±¡çš„å±æ€§ã€‚
ç±»å¯ä»¥ä½¿ç”¨ <code>my</code> æ¥å£°æ˜ä¸€ä¸ªæœ¬åœ°ä½œç”¨åŸŸ:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="k">class</span> <span class="nc">Human</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre></div><h3 id="å°è£…">å°è£…</h3>
<p>ã€€
å°è£…æ˜¯ä¸€ä¸ªé¢å‘å¯¹è±¡çš„æ¦‚å¿µ, å®ƒæŠŠä¸€ç»„æ•°æ®å’Œæ–¹æ³•æ†ç»‘åœ¨ä¸€å—ã€‚
å¯¹è±¡ä¸­çš„æ•°æ®(å±æ€§)åº”è¯¥æ˜¯<strong>ç§æœ‰çš„</strong>, æ¢å¥è¯è¯´, åªèƒ½ä»å¯¹è±¡å†…éƒ¨è®¿é—®å®ƒã€‚
ä¸ºäº†ä»å¯¹è±¡å¤–éƒ¨è®¿é—®å¯¹è±¡çš„å±æ€§, æˆ‘ä»¬ä½¿ç”¨å«åš<strong>å­˜å–å™¨</strong>çš„æ–¹æ³•ã€‚
ä¸‹é¢ä¸¤ä¸ªè„šæœ¬æ‹¥æœ‰åŒæ ·çš„ç»“æœã€‚</p>
<p><strong>ç›´æ¥è®¿é—®å˜é‡</strong>:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span>  <span class="nv">$var</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$var</span><span class="p">;</span>
</code></pre></div><p><strong>å°è£…</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$var</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
<span class="k">sub</span> <span class="nf">sayvar</span> <span class="p">{</span>
    <span class="nv">$var</span><span class="p">;</span>
<span class="p">}</span>
<span class="nb">say</span> <span class="n">sayvar</span><span class="p">;</span>
</code></pre></div><p><code>sayvar</code> æ˜¯ä¸€ä¸ªå­˜å–å™¨ã€‚å®ƒè®©æˆ‘ä»¬é€šè¿‡ä¸ç›´æ¥è®¿é—®è¿™ä¸ªå˜é‡æ¥è®¿é—®è¿™ä¸ªå˜é‡ã€‚
åœ¨ Raku ä¸­ä½¿ç”¨  <strong>twigils</strong> ä½¿å¾—å°è£…å¾ˆä¾¿åˆ©ã€‚
Twigils æ˜¯ç¬¬äºŒ <em><strong>ç¬¦å·</strong></em>ã€‚å®ƒä»¬å­˜åœ¨äºç¬¦å·å’Œå±æ€§åä¹‹é—´ã€‚
æœ‰ä¸¤ä¸ª twigils ç”¨åœ¨ç±»ä¸­:</p>
<ul>
<li><code>!</code> ç”¨äºæ˜¾å¼åœ°å£°æ˜å±æ€§æ˜¯ç§æœ‰çš„</li>
<li><code>.</code> ç”¨äºä¸ºå±æ€§è‡ªåŠ¨ç”Ÿæˆå­˜å–å™¨</li>
</ul>
<p>é»˜è®¤åœ°, æ‰€æœ‰çš„å±æ€§éƒ½æ˜¯ç§æœ‰çš„, ä½†æ˜¯æ€»æ˜¯ç”¨ <code>!</code> twigil æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ã€‚
ä¸ºäº†å’Œæˆ‘è¯´çš„ç›¸ä¸€è‡´, æˆ‘ä»¬åº”è¯¥æŠŠä¸Šé¢çš„ç±»é‡å†™æˆä¸‹é¢è¿™æ ·:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Human</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$!name</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$!age</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$!sex</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$!nationality</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$john</span> <span class="o">=</span> <span class="n">Human</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">name</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">John</span><span class="p">&#39;</span>, <span class="s">age</span> <span class="o">=&gt;</span> <span class="mi">23</span>, <span class="s">sex</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">M</span><span class="p">&#39;</span>, <span class="s">nationality</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">American</span><span class="p">&#39;);</span>
<span class="nb">say</span> <span class="nv">$john</span><span class="p">;</span>
</code></pre></div><p>ç»™è„šæœ¬è¿½åŠ è¿™æ ·çš„çš„è¯­å¥: <code>say $john.age</code>;
å®ƒä¼šè¿”å›è¿™æ ·çš„é”™è¯¯: <code>Method 'age' not found for invocant of class 'Human'</code>ã€‚
åŸå› æ˜¯ <code>$!age</code> æ˜¯ç§æœ‰çš„å¹¶ä¸”åªèƒ½ç”¨äºå¯¹è±¡å†…éƒ¨ã€‚ å°è¯•åœ¨å¯¹è±¡å¤–éƒ¨è®¿é—®å®ƒä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚
ç°åœ¨ç”¨ <code>has $.age</code> ä»£æ›¿ <code>$!age</code> å¹¶çœ‹çœ‹ <code>say $john.age;</code> çš„ç»“æœæ˜¯ä»€ä¹ˆã€‚</p>
<h3 id="å…·åå‚æ•°-vs-ä½ç½®å‚æ•°">å…·åå‚æ•° vs. ä½ç½®å‚æ•°</h3>
<p>ã€€
åœ¨ Raku ä¸­, æ‰€æœ‰çš„ç±»ç»§æ‰¿äº†ä¸€ä¸ªé»˜è®¤çš„ <code>.new</code> æ„é€ å‡½æ•°ã€‚
é€šè¿‡ä¸ºä»–æä¾›å‚æ•°, å®ƒèƒ½ç”¨äºåˆ›å»ºå¯¹è±¡ã€‚
åªèƒ½æä¾›<strong>å…·åå‚æ•°</strong>ç»™é»˜è®¤çš„æ„é€ å‡½æ•°ã€‚</p>
<p>å¦‚æœä½ è€ƒè™‘åˆ°ä¸Šé¢çš„ä¾‹å­, ä½ ä¼šçœ‹åˆ°æ‰€æœ‰æä¾›ç»™ <code>.new</code> æ–¹æ³•çš„å‚æ•°éƒ½æ˜¯æŒ‰åå­—å®šä¹‰çš„:</p>
<ul>
<li>name =&gt; &lsquo;John&rsquo;</li>
<li>age     =&gt; 23</li>
</ul>
<p>å‡å¦‚æˆ‘ä¸æƒ³åœ¨æ¯æ¬¡åˆ›å»ºæ–°å¯¹è±¡çš„æ—¶å€™ä¸ºæ¯ä¸ªå±æ€§æä¾›ä¸€ä¸ªåå­—å‘¢?
é‚£ä¹ˆæˆ‘éœ€è¦åˆ›å»ºå¦å¤–ä¸€ä¸ªæ¥æ”¶<strong>ä½ç½®å‚æ•°</strong>çš„æ„é€ å‡½æ•°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Human</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.name</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.age</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.sex</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.nationality</span><span class="p">;</span>

    <span class="c1"># é‡å†™é»˜è®¤æ„é€ å‡½æ•°çš„æ–°æ„é€ å‡½æ•°</span>
    <span class="k">method</span> <span class="nb">new</span> <span class="p">(</span><span class="nv">$name</span><span class="o">,</span> <span class="nv">$age</span><span class="o">,</span> <span class="nv">$sex</span><span class="o">,</span> <span class="nv">$nationality</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">self</span><span class="o">.</span><span class="nb">bless</span><span class="p">(</span><span class="o">:</span><span class="nv">$name</span><span class="o">,</span> <span class="o">:</span><span class="nv">$age</span><span class="o">,</span> <span class="o">:</span><span class="nv">$sex</span><span class="o">,</span> <span class="o">:</span><span class="nv">$nationality</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$john</span> <span class="o">=</span> <span class="n">Human</span><span class="o">.</span><span class="nb">new</span><span class="p">(&#39;</span><span class="s1">John</span><span class="p">&#39;</span><span class="o">,</span> <span class="mi">23</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">M</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">American</span><span class="p">&#39;);</span>
<span class="nb">say</span> <span class="nv">$john</span><span class="p">;</span>
</code></pre></div><p>èƒ½æ¥æ”¶ä½ç½®å‚æ•°çš„æ„é€ å‡½æ•°éœ€è¦æŒ‰ä¸Šé¢é‚£æ ·å®šä¹‰ã€‚</p>
<h3 id="æ–¹æ³•">æ–¹æ³•</h3>
<p>ã€€</p>
<h4 id="ä»‹ç»-1">ä»‹ç»</h4>
<p>ã€€
æ–¹æ³•æ˜¯å¯¹è±¡çš„å­ä¾‹ç¨‹ã€‚
åƒå­ä¾‹ç¨‹ä¸€æ ·, æ–¹æ³•æ˜¯ä¸€ç§æ‰“åŒ…ä¸€ç»„åŠŸèƒ½çš„æ‰‹æ®µ, å®ƒä»¬æ¥æ”¶<strong>å‚æ•°</strong>, æ‹¥æœ‰<strong>ç­¾å</strong>å¹¶å¯ä»¥è¢«å®šä¹‰ä¸º <strong>multi</strong>ã€‚
æ–¹æ³•æ˜¯ä½¿ç”¨å…³é”®å­— <code>method</code> æ¥å®šä¹‰çš„ã€‚</p>
<p>æ­£å¸¸æƒ…å†µä¸‹, æ–¹æ³•è¢«è¦æ±‚åœ¨å¯¹è±¡çš„å±æ€§èº«ä¸Šæ‰§è¡Œä¸€äº›åŠ¨ä½œã€‚è¿™å¼ºåˆ¶äº†å°è£…çš„æ¦‚å¿µã€‚å¯¹è±¡çš„å±æ€§åªèƒ½åœ¨å¯¹è±¡é‡Œé¢ä½¿ç”¨æ–¹æ³•æ¥æ“ä½œã€‚åœ¨å¯¹è±¡å¤–é¢, åªèƒ½å’Œå¯¹è±¡çš„æ–¹æ³•äº¤äº’, å¹¶ä¸”ä¸èƒ½è®¿é—®å®ƒçš„å±æ€§ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Human</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.name</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.age</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.sex</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.nationality</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.eligible</span><span class="p">;</span>

    <span class="k">method</span> <span class="nf">assess-eligibility</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nb">self</span><span class="o">.</span><span class="nf">age</span> <span class="o">&lt;</span> <span class="mi">21</span> <span class="p">{</span>
            <span class="nv">$!eligible</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">No</span><span class="p">&#39;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$!eligible</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">Yes</span><span class="p">&#39;</span>
        <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$john</span> <span class="o">=</span> <span class="n">Human</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">name</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">John</span><span class="p">&#39;</span>, <span class="s">age</span> <span class="o">=&gt;</span> <span class="mi">23</span>, <span class="s">sex</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">M</span><span class="p">&#39;</span>, <span class="s">nationality</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">American</span><span class="p">&#39;);</span>
<span class="nv">$john</span><span class="o">.</span><span class="nf">assess-eligibility</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$john</span><span class="o">.</span><span class="nf">eligible</span><span class="p">;</span>
</code></pre></div><p>ä¸€æ—¦æ–¹æ³•å®šä¹‰åœ¨ç±»ä¸­, å®ƒä»¬å°±èƒ½åœ¨å¯¹è±¡èº«ä¸Šä½¿ç”¨<strong>ç‚¹è®°å·</strong>æ¥è°ƒç”¨:
<code>object.method</code> æˆ–åƒä¸Šé¢çš„ä¾‹å­é‚£æ ·: <code>$john.assess-eligibility</code>ã€‚
åœ¨æ–¹æ³•çš„å®šä¹‰ä¸­, å¦‚æœæˆ‘ä»¬éœ€è¦å¼•ç”¨å¯¹è±¡æœ¬èº«ä»¥è°ƒç”¨å¦ä¸€ä¸ªæ–¹æ³•, åˆ™ä½¿ç”¨ <code>self</code> å…³é”®å­—ã€‚
åœ¨æ–¹æ³•çš„å®šä¹‰ä¸­, å¦‚æœæˆ‘ä»¬éœ€è¦å¼•ç”¨å±æ€§, åˆ™ä½¿ç”¨ <code>!</code>, å³ä½¿å±æ€§æ˜¯ä½¿ç”¨ <code>.</code> å®šä¹‰çš„ã€‚
ç†ç”±æ˜¯ <code>.</code> twigil åšçš„å°±æ˜¯ä½¿ç”¨ <code>!</code> å£°æ˜ä¸€ä¸ªå±æ€§å¹¶è‡ªåŠ¨åˆ›å»ºå­˜å–å™¨ã€‚</p>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, <code>if self.age &lt; 21</code> å’Œ  <code>if $!age &lt; 21</code> ä¼šæœ‰åŒæ ·çš„æ•ˆæœ, å°½ç®¡å®ƒä»¬ä»æŠ€æœ¯ä¸Šæ¥è®²æ˜¯ä¸åŒçš„:</p>
<ul>
<li><code>self.age</code> è°ƒç”¨äº† <code>.age</code> æ–¹æ³•(å­˜å–å™¨)</li>
</ul>
<p>äºŒé€‰ä¸€, è¿˜èƒ½å†™æˆ <code>$.age</code></p>
<ul>
<li><code>$!age</code> æ˜¯ç›´æ¥è°ƒç”¨é‚£ä¸ªå˜é‡</li>
</ul>
<h4 id="ç§æœ‰æ–¹æ³•">ç§æœ‰æ–¹æ³•</h4>
<p>ã€€
æ­£å¸¸çš„æ–¹æ³•èƒ½ä»ç±»çš„å¤–é¢åœ¨å¯¹è±¡èº«ä¸Šè°ƒç”¨ã€‚
<strong>ç§æœ‰æ–¹æ³•</strong>æ˜¯åªèƒ½ä»ç±»çš„å†…éƒ¨è°ƒç”¨çš„æ–¹æ³•ã€‚</p>
<p>ä¸€ä¸ªå¯èƒ½çš„ä½¿ç”¨æƒ…å†µæ˜¯ä¸€ä¸ªæ–¹æ³•è°ƒç”¨å¦å¤–ä¸€ä¸ªæ‰§è¡Œç‰¹å®šåŠ¨ä½œçš„æ–¹æ³•ã€‚è¿æ¥å¤–éƒ¨ä¸–ç•Œçš„æ–¹æ³•æ˜¯å…¬å…±çš„è€Œè¢«å¼•ç”¨çš„é‚£ä¸ªæ–¹æ³•åº”è¯¥ä¿æŒç§æœ‰ã€‚æˆ‘ä»¬ä¸æƒ³è®©ç”¨æˆ·ç›´æ¥è°ƒç”¨å®ƒ, æ‰€ä»¥æˆ‘ä»¬æŠŠå®ƒå£°æ˜ä¸ºç§æœ‰çš„ã€‚</p>
<p>ç§æœ‰æ–¹æ³•çš„å£°æ˜éœ€è¦åœ¨æ–¹æ³•çš„åå­—å‰ä½¿ç”¨ <code>!</code> twigilã€‚
ç§æœ‰æ–¹æ³•æ˜¯ä½¿ç”¨ <code>!</code> è€Œé <code>.</code> è°ƒç”¨çš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">method</span> <span class="nf">!iamprivate</span> <span class="p">{</span>
    <span class="c1"># code goes in here</span>
<span class="p">}</span>

<span class="k">method</span> <span class="nf">iampublic</span> <span class="p">{</span>
    <span class="nb">self</span><span class="o">!</span><span class="nf">iamprivate</span><span class="p">;</span>
    <span class="c1"># do additional things</span>
<span class="p">}</span>
</code></pre></div><h3 id="ç±»å±æ€§">ç±»å±æ€§</h3>
<p>ã€€
<strong>ç±»å±æ€§</strong>æ˜¯å±äºç±»è‡ªèº«è€Œéç±»çš„å¯¹è±¡çš„å±æ€§ã€‚
å®ƒä»¬èƒ½åœ¨å®šä¹‰æœŸé—´åˆå§‹åŒ–ã€‚
ç±»å±æ€§æ˜¯ä½¿ç”¨ <code>my</code> å…³é”®å­—è€Œé <code>has</code> å…³é”®å­—å£°æ˜çš„ã€‚
å®ƒä»¬æ˜¯åœ¨ç±»è‡ªå·±èº«ä¸Šè€Œéå®ƒçš„å¯¹è±¡èº«ä¸Šè°ƒç”¨çš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Human</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.name</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$.counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="k">method</span> <span class="nb">new</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Human</span><span class="o">.</span><span class="nf">counter</span><span class="o">++</span><span class="p">;</span>
        <span class="nb">self</span><span class="o">.</span><span class="nb">bless</span><span class="p">(</span><span class="o">:</span><span class="nv">$name</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="n">Human</span><span class="o">.</span><span class="nb">new</span><span class="p">(&#39;</span><span class="s1">a</span><span class="p">&#39;);</span>
<span class="k">my</span> <span class="nv">$b</span> <span class="o">=</span> <span class="n">Human</span><span class="o">.</span><span class="nb">new</span><span class="p">(&#39;</span><span class="s1">b</span><span class="p">&#39;);</span>

<span class="nb">say</span> <span class="n">Human</span><span class="o">.</span><span class="nf">counter</span><span class="p">;</span>
</code></pre></div><h3 id="è®¿é—®ç±»å‹">è®¿é—®ç±»å‹</h3>
<p>ã€€
åˆ°ç°åœ¨ä¸ºæ­¢æˆ‘ä»¬çœ‹åˆ°çš„æ‰€ä»¥ä¾‹å­éƒ½ä½¿ç”¨å­˜å–å™¨æ¥ä»å¯¹è±¡å±æ€§ä¸­è·å–ä¿¡æ¯ã€‚
å‡å¦‚æˆ‘ä»¬éœ€è¦ä¿®æ”¹å±æ€§çš„å€¼å‘¢?
æˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸‹é¢çš„ <code>is rw</code> å…³é”®å­—æŠŠå®ƒæ ‡è®°ä¸º <code>read/write</code>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Human</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.name</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.age</span> <span class="k">is</span> <span class="k">rw</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$john</span> <span class="o">=</span> <span class="n">Human</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">name</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">John</span><span class="p">&#39;</span>, <span class="s">age</span> <span class="o">=&gt;</span> <span class="mi">21</span><span class="p">);</span>
<span class="nb">say</span> <span class="nv">$john</span><span class="o">.</span><span class="nf">age</span><span class="p">;</span>

<span class="nv">$john</span><span class="o">.</span><span class="nf">age</span> <span class="o">=</span> <span class="mi">23</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$john</span><span class="o">.</span><span class="nf">age</span><span class="p">;</span>
</code></pre></div><p>é»˜è®¤åœ°, æ‰€æœ‰å±æ€§éƒ½å£°æ˜ä¸ºåªè¯», ä½†æ˜¯ä½ å¯ä»¥æ˜¾å¼åœ°ä½¿ç”¨ <code>is readonly</code> æ¥å£°æ˜ã€‚</p>
<h3 id="ç»§æ‰¿">ç»§æ‰¿</h3>
<p>ã€€</p>
<h4 id="ä»‹ç»-2">ä»‹ç»</h4>
<p>ã€€
<strong>ç»§æ‰¿</strong>æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„å¦ä¸€ä¸ªæ¦‚å¿µã€‚
å½“å®šä¹‰ç±»çš„æ—¶å€™, å¾ˆå¿«æˆ‘ä»¬ä¼šæ„æ€åˆ°å¾ˆå¤šå±æ€§/æ–¹æ³•åœ¨å¾ˆå¤šç±»ä¸­æ˜¯å…±æœ‰çš„ã€‚
æˆ‘ä»¬åº”è¯¥é‡å¤ä»£ç å—?</p>
<p>ä¸! æˆ‘ä»¬åº”è¯¥ä½¿ç”¨<strong>ç»§æ‰¿</strong>ã€‚
å‡è®¾æˆ‘ä»¬æƒ³å®šä¹‰ä¸¤ä¸ªç±», ä¸€ä¸ªç±»æ˜¯ Human, ä¸€ä¸ªç±»æ˜¯ Employeesã€‚
Human æ‹¥æœ‰ä¸¤ä¸ªå±æ€§: name å’Œ ageã€‚</p>
<p>Employees æ‹¥æœ‰ 4  ä¸ªå±æ€§: name, age, company å’Œ salaryã€‚
å°è¯•æŒ‰ä¸‹é¢å®šä¹‰ç±»:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Human</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.name</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.age</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Employee</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.name</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.age</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.company</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.salary</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>è™½ç„¶ä¸Šé¢çš„ä»£ç æŠ€æœ¯ä¸Šæ˜¯æ­£ç¡®çš„, ä½†æ˜¯æ¦‚å¿µä¸Šå·®ã€‚
æ›´å¥½çš„å†™æ³•æ˜¯ä¸‹é¢è¿™æ ·:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Human</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.name</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.age</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Employee</span> <span class="k">is</span> <span class="nc">Human</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.company</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.salary</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p><code>is</code> å…³é”®å­—å®šä¹‰äº†ç»§æ‰¿ã€‚
æŒ‰é¢å‘å¯¹è±¡çš„è¯´æ³•, Employee æ˜¯ Human çš„<strong>å­©å­</strong>, è€Œ Human æ˜¯ Employee çš„<strong>çˆ¶äº²</strong>ã€‚</p>
<p>æ‰€æœ‰çš„å­ç±»ç»§æ‰¿äº†çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•, æ‰€ä»¥æ²¡æœ‰å¿…è¦é‡æ–°å®ƒä»¬ã€‚</p>
<h4 id="é‡å†™">é‡å†™</h4>
<p>ã€€
ç±»ä»å®ƒä»¬çš„çˆ¶ç±»ä¸­ç»§æ‰¿æ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•ã€‚
æœ‰äº›æƒ…å†µä¸‹, æˆ‘ä»¬éœ€è¦è®©å­ç±»ä¸­çš„æ–¹æ³•è¡¨ç°å¾—å’Œç»§æ‰¿çš„æ–¹æ³•ä¸ä¸€æ ·ã€‚
ä¸ºäº†åšåˆ°è¿™, æˆ‘ä»¬åœ¨å­ç±»ä¸­é‡æ–°å®šä¹‰æ–¹æ³•ã€‚</p>
<p>è¿™ä¸ªæ¦‚å¿µå°±å«åš<strong>é‡å†™</strong>ã€‚</p>
<p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­, <code>introduce-yourself</code> æ–¹æ³•è¢« Employee ç±»ç»§æ‰¿ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Human</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.name</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.age</span><span class="p">;</span>

    <span class="k">method</span> <span class="nf">introduce-yourself</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">Hi æˆ‘æ˜¯äººç±», æˆ‘çš„åå­—æ˜¯ </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nb">self</span><span class="o">.</span><span class="nb">name</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Employee</span> <span class="k">is</span> <span class="nc">Human</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.company</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.salary</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$john</span> <span class="o">=</span> <span class="n">Human</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">name</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">John</span><span class="p">&#39;</span>, <span class="s">age</span> <span class="o">=&gt;</span> <span class="mi">23</span>,<span class="p">);</span>
<span class="k">my</span> <span class="nv">$jane</span> <span class="o">=</span> <span class="n">Employee</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">name</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">Jane</span><span class="p">&#39;</span>, <span class="s">age</span> <span class="o">=&gt;</span> <span class="mi">25</span>, <span class="s">company</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">Acme</span><span class="p">&#39;</span>, <span class="s">salary</span> <span class="o">=&gt;</span> <span class="mi">4000</span><span class="p">);</span>

<span class="nv">$john</span><span class="o">.</span><span class="nf">introduce-yourself</span><span class="p">;</span>
<span class="nv">$jane</span><span class="o">.</span><span class="nf">introduce-yourself</span><span class="p">;</span>
</code></pre></div><p>é‡å†™å·¥ä½œå¦‚ä¸‹:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Human</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.name</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.age</span><span class="p">;</span>

    <span class="k">method</span> <span class="nf">introduce-yourself</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">Hi æˆ‘æ˜¯äººç±», æˆ‘çš„åå­—æ˜¯ </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nb">self</span><span class="o">.</span><span class="nb">name</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Employee</span> <span class="k">is</span> <span class="nc">Human</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.company</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.salary</span><span class="p">;</span>

    <span class="k">method</span> <span class="nf">introduce-yourself</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">Hi æˆ‘æ˜¯ä¸€åå‘˜å·¥, æˆ‘çš„åå­—æ˜¯ </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nb">self</span><span class="o">.</span><span class="nb">name</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> æˆ‘å·¥ä½œåœ¨: </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nb">self</span><span class="o">.</span><span class="nf">comapny</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$john</span> <span class="o">=</span> <span class="n">Human</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">name</span> <span class="o">=&gt;</span><span class="p">&#39;</span><span class="s1">John</span><span class="p">&#39;</span>,<span class="s">age</span> <span class="o">=&gt;</span> <span class="mi">23</span>,<span class="p">);</span>
<span class="k">my</span> <span class="nv">$jane</span> <span class="o">=</span> <span class="n">Employee</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">name</span> <span class="o">=&gt;</span><span class="p">&#39;</span><span class="s1">Jane</span><span class="p">&#39;</span>,<span class="s">age</span> <span class="o">=&gt;</span> <span class="mi">25</span>,<span class="s">company</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">Acme</span><span class="p">&#39;</span>,<span class="s">salary</span> <span class="o">=&gt;</span> <span class="mi">4000</span><span class="p">);</span>

<span class="nv">$john</span><span class="o">.</span><span class="nf">introduce-yourself</span><span class="p">;</span>
<span class="nv">$jane</span><span class="o">.</span><span class="nf">introduce-yourself</span><span class="p">;</span>
</code></pre></div><p>æ ¹æ®å¯¹è±¡æ‰€å±çš„ç±», ä¼šè°ƒç”¨æ­£ç¡®çš„æ–¹æ³•ã€‚</p>
<h4 id="submethods">Submethods</h4>
<p>ã€€
<strong>Submethods</strong> æ˜¯ä¸€ç§å­ç±»ç»§æ‰¿ä¸åˆ°çš„æ–¹æ³•ã€‚</p>
<p>å®ƒä»¬åªèƒ½ä»æ‰€å£°æ˜çš„ç±»ä¸­è®¿é—®ã€‚
å®ƒä»¬ä½¿ç”¨ <code>submethod</code> å…³é”®å­—å®šä¹‰ã€‚</p>
<h3 id="å¤šé‡ç»§æ‰¿">å¤šé‡ç»§æ‰¿</h3>
<p>ã€€
åœ¨ Raku ä¸­å…è®¸å¤šé‡ç»§æ‰¿ã€‚ä¸€ä¸ªç±»å¯ä»¥ç»§æ‰¿è‡ªå¤šä¸ªå…¶å®ƒçš„ç±»ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">bar-chart</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nb">Int</span> <span class="nv">@.bar-values</span><span class="p">;</span>

    <span class="k">method</span> <span class="nf">plot</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="nv">@.bar-values</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">line-chart</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nb">Int</span> <span class="nv">@.line-values</span><span class="p">;</span>

    <span class="k">method</span> <span class="nf">plot</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="nv">@.line-values</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">combo-chart</span> <span class="k">is</span> <span class="nc">bar-chart</span> <span class="k">is</span> <span class="nc">line-chart</span> <span class="p">{</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$actual-sales</span> <span class="o">=</span> <span class="n">bar-chart</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">bar-values</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">10</span>,<span class="mi">9</span><span class="o">,</span><span class="mi">11</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">10</span><span class="o">]</span><span class="p">);</span>
<span class="k">my</span> <span class="nv">$forecast-sales</span> <span class="o">=</span> <span class="n">line-chart</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">line-values</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">9</span>,<span class="mi">8</span><span class="o">,</span><span class="mi">10</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">6</span><span class="o">,</span><span class="mi">9</span><span class="o">]</span><span class="p">);</span>

<span class="k">my</span> <span class="nv">$actual-vs-forecast</span> <span class="o">=</span> <span class="n">combo-chart</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">bar-values</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">10</span>,<span class="mi">9</span><span class="o">,</span><span class="mi">11</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">10</span><span class="o">],</span>
                                         <span class="s">line-values</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">9</span>,<span class="mi">8</span><span class="o">,</span><span class="mi">10</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">6</span><span class="o">,</span><span class="mi">9</span><span class="o">]</span><span class="p">);</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">å®é™…çš„é”€å”®: </span><span class="p">&#34;;</span>
<span class="nv">$actual-sales</span><span class="o">.</span><span class="nf">plot</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">é¢„æµ‹çš„é”€å”®: </span><span class="p">&#34;;</span>
<span class="nv">$forecast-sales</span><span class="o">.</span><span class="nf">plot</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">å®é™… vs é¢„æµ‹:</span><span class="p">&#34;;</span>
<span class="nv">$actual-vs-forecast</span><span class="o">.</span><span class="nf">plot</span><span class="p">;</span>
</code></pre></div><p>è¾“å‡º:</p>
<pre><code>å®é™…çš„é”€å”®:
[10 9 11 8 7 10]
é¢„æµ‹çš„é”€å”®:
[9 8 10 7 6 9]
å®é™… vs é¢„æµ‹:
[10 9 11 8 7 10]
</code></pre><p><strong>è§£é‡Š</strong></p>
<p><code>combo-chart</code> ç±»åº”è¯¥èƒ½æŒæœ‰ä¸¤ä¸ªåºåˆ—, ä¸€ä¸ªæ˜¯ç»˜åˆ¶æ¡å½¢å›¾çš„å®é™…å€¼, å¦ä¸€ä¸ªæ˜¯ç»˜åˆ¶æŠ˜çº¿å›¾çš„é¢„æµ‹å€¼ã€‚</p>
<p>è¿™å°±æ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆæŠŠå®ƒå®šä¹‰ä¸º <code>line-chart</code> å’Œ <code>bar-chart</code> çš„å­©å­çš„åŸå› ã€‚</p>
<p>ä½ åº”è¯¥æ³¨æ„åˆ°äº†, åœ¨ <code>combo-chart</code> èº«ä¸Šè°ƒç”¨ <code>plot</code> æ–¹æ³•å¹¶æ²¡æœ‰äº§ç”Ÿæ‰€è¦æ±‚çš„ç»“æœã€‚å®ƒåªç»˜åˆ¶äº†ä¸€ä¸ªåºåˆ—ã€‚</p>
<p>å‘ç”Ÿäº†ä»€ä¹ˆäº‹?</p>
<p><code>combo-chart</code> ç»§æ‰¿è‡ª <code>line-chart</code> å’Œ <code>bar-chart</code>, å®ƒä»¬éƒ½æœ‰ä¸€ä¸ªå«åš <code>plot</code> çš„æ–¹æ³•ã€‚å½“æˆ‘ä»¬åœ¨ <code>combo-chart</code> èº«ä¸Šè°ƒç”¨é‚£ä¸ªæ–¹æ³•æ—¶, Raku å†…éƒ¨ä¼šå°è¯•é€šè¿‡è°ƒç”¨å…¶æ‰€ç»§æ‰¿çš„æ–¹æ³•ä¹‹ä¸€æ¥è§£å†³å†²çªã€‚</p>
<p><strong>çº æ­£</strong></p>
<p>ä¸ºäº†è¡¨ç°å¾—æ­£ç¡®, æˆ‘ä»¬åº”è¯¥åœ¨ <code>combo-chart</code> ä¸­é‡å†™ <code>plot</code> æ–¹æ³•ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">bar-chart</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nb">Int</span> <span class="nv">@.bar-values</span><span class="p">;</span>

    <span class="k">method</span> <span class="nf">plot</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="nv">@.bar-values</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">line-chart</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nb">Int</span> <span class="nv">@.line-values</span><span class="p">;</span>
    
    <span class="k">method</span> <span class="nf">plot</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="nv">@.line-values</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">combo-chart</span> <span class="k">is</span> <span class="nc">bar-chart</span> <span class="k">is</span> <span class="nc">line-chart</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">plot</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="nv">@.bar-values</span><span class="p">;</span>
        <span class="nb">say</span> <span class="nv">@.line-values</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$actual-sales</span> <span class="o">=</span> <span class="n">bar-chart</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">bar-values</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">10</span>,<span class="mi">9</span><span class="o">,</span><span class="mi">11</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">10</span><span class="o">]</span><span class="p">);</span>
<span class="k">my</span> <span class="nv">$forecast-sales</span> <span class="o">=</span> <span class="n">line-chart</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">line-values</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">9</span>,<span class="mi">8</span><span class="o">,</span><span class="mi">10</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">6</span><span class="o">,</span><span class="mi">9</span><span class="o">]</span><span class="p">);</span>

<span class="k">my</span> <span class="nv">$actual-vs-forecast</span> <span class="o">=</span> <span class="n">combo-chart</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">bar-values</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">10</span>,<span class="mi">9</span><span class="o">,</span><span class="mi">11</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">10</span><span class="o">],</span>
                                         <span class="s">line-values</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">9</span>,<span class="mi">8</span><span class="o">,</span><span class="mi">10</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">6</span><span class="o">,</span><span class="mi">9</span><span class="o">]</span><span class="p">);</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">å®é™…çš„é”€å”®: </span><span class="p">&#34;;</span>
<span class="nv">$actual-sales</span><span class="o">.</span><span class="nf">plot</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">é¢„æµ‹çš„é”€å”®: </span><span class="p">&#34;;</span>
<span class="nv">$forecast-sales</span><span class="o">.</span><span class="nf">plot</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">å®é™… vs é¢„æµ‹:</span><span class="p">&#34;;</span>
<span class="nv">$actual-vs-forecast</span><span class="o">.</span><span class="nf">plot</span><span class="p">;</span>
</code></pre></div><p>è¾“å‡º:</p>
<pre><code>å®é™…çš„é”€å”®:
[10 9 11 8 7 10]
é¢„æµ‹çš„é”€å”®:
[9 8 10 7 6 9]
å®é™… vs é¢„æµ‹:
[10 9 11 8 7 10]
[9 8 10 7 6 9]
</code></pre><h3 id="roles">Roles</h3>
<p>ã€€
<strong>Roles</strong> åœ¨å®ƒä»¬æ˜¯å±æ€§å’Œæ–¹æ³•çš„é›†åˆè¿™ä¸ªæ„ä¹‰ä¸Šå’Œç±»æœ‰ç‚¹ç±»ä¼¼ã€‚
Roles ä½¿ç”¨å…³é”®å­— <code>role</code> å£°æ˜, è€Œæƒ³å®ç°è¯¥ role çš„ç±»å¯ä»¥ä½¿ç”¨ <code>does</code> å…³é”®å­—ã€‚</p>
<p><strong>ä½¿ç”¨ roles é‡å†™å¤šé‡ç»§æ‰¿çš„ä¾‹å­</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">bar-chart</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nb">Int</span> <span class="nv">@.bar-values</span><span class="p">;</span>
    
    <span class="k">method</span> <span class="nf">plot</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="nv">@.bar-values</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">role</span> <span class="nc">line-chart</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nb">Int</span> <span class="nv">@.line-values</span><span class="p">;</span>
    
    <span class="k">method</span> <span class="nf">plot</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="nv">@.line-values</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">combo-chart</span> <span class="k">does</span> <span class="nc">bar-chart</span> <span class="k">does</span> <span class="nc">line-chart</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">plot</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="nv">@.bar-values</span><span class="p">;</span>
        <span class="nb">say</span> <span class="nv">@.line-values</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$actual-sales</span> <span class="o">=</span> <span class="n">bar-chart</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">bar-values</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">10</span>,<span class="mi">9</span><span class="o">,</span><span class="mi">11</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">10</span><span class="o">]</span><span class="p">);</span>
<span class="k">my</span> <span class="nv">$forecast-sales</span> <span class="o">=</span> <span class="n">line-chart</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">line-values</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">9</span>,<span class="mi">8</span><span class="o">,</span><span class="mi">10</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">6</span><span class="o">,</span><span class="mi">9</span><span class="o">]</span><span class="p">);</span>

<span class="k">my</span> <span class="nv">$actual-vs-forecast</span> <span class="o">=</span> <span class="n">combo-chart</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">bar-values</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">10</span>,<span class="mi">9</span><span class="o">,</span><span class="mi">11</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">10</span><span class="o">],</span>
                                         <span class="s">line-values</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">9</span>,<span class="mi">8</span><span class="o">,</span><span class="mi">10</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">6</span><span class="o">,</span><span class="mi">9</span><span class="o">]</span><span class="p">);</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">å®é™…çš„é”€å”®: </span><span class="p">&#34;;</span>
<span class="nv">$actual-sales</span><span class="o">.</span><span class="nf">plot</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">é¢„æµ‹çš„é”€å”®: </span><span class="p">&#34;;</span>
<span class="nv">$forecast-sales</span><span class="o">.</span><span class="nf">plot</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">å®é™… vs é¢„æµ‹:</span><span class="p">&#34;;</span>
<span class="nv">$actual-vs-forecast</span><span class="o">.</span><span class="nf">plot</span><span class="p">;</span>
</code></pre></div><p>è¿è¡Œä¸Šé¢çš„è„šæœ¬ä½ ä¼šçœ‹åˆ°ç»“æœæ˜¯ä¸€æ ·çš„ã€‚</p>
<p>ç°åœ¨ä½ é—®é—®è‡ªå·±, å¦‚æœ roles è¡¨ç°å¾—åƒç±»çš„è¯é‚£ä¹ˆå®ƒä»¬çš„ç”¨é€”æ˜¯ä»€ä¹ˆå‘¢?</p>
<p>è¦å›ç­”ä½ çš„é—®é¢˜, ä¿®æ”¹ç¬¬ä¸€ä¸ªç”¨äºå±•ç¤ºå¤šé‡ç»§æ‰¿çš„è„šæœ¬,  è¿™ä¸ªè„šæœ¬ä¸­æˆ‘ä»¬å¿˜è®°é‡å†™ <code>plot</code> æ–¹æ³•äº†ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">bar-chart</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nb">Int</span> <span class="nv">@.bar-values</span><span class="p">;</span>
    <span class="k">method</span> <span class="nf">plot</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="nv">@.bar-values</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">role</span> <span class="nc">line-chart</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nb">Int</span> <span class="nv">@.line-values</span><span class="p">;</span>
    
    <span class="k">method</span> <span class="nf">plot</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="nv">@.line-values</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">combo-chart</span> <span class="k">does</span> <span class="nc">bar-chart</span> <span class="k">does</span> <span class="nc">line-chart</span> <span class="p">{</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$actual-sales</span> <span class="o">=</span> <span class="n">bar-chart</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">bar-values</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">10</span>,<span class="mi">9</span><span class="o">,</span><span class="mi">11</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">10</span><span class="o">]</span><span class="p">);</span>
<span class="k">my</span> <span class="nv">$forecast-sales</span> <span class="o">=</span> <span class="n">line-chart</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">line-values</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">9</span>,<span class="mi">8</span><span class="o">,</span><span class="mi">10</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">6</span><span class="o">,</span><span class="mi">9</span><span class="o">]</span><span class="p">);</span>

<span class="k">my</span> <span class="nv">$actual-vs-forecast</span> <span class="o">=</span> <span class="n">combo-chart</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">bar-values</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">10</span>,<span class="mi">9</span><span class="o">,</span><span class="mi">11</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">10</span><span class="o">],</span>
                                         <span class="s">line-values</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="mi">9</span>,<span class="mi">8</span><span class="o">,</span><span class="mi">10</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">6</span><span class="o">,</span><span class="mi">9</span><span class="o">]</span><span class="p">);</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Actual sales:</span><span class="p">&#34;;</span>
<span class="nv">$actual-sales</span><span class="o">.</span><span class="nf">plot</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Forecast sales:</span><span class="p">&#34;;</span>
<span class="nv">$forecast-sales</span><span class="o">.</span><span class="nf">plot</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Actual vs Forecast:</span><span class="p">&#34;;</span>
<span class="nv">$actual-vs-forecast</span><span class="o">.</span><span class="nf">plot</span><span class="p">;</span>
</code></pre></div><p>è¾“å‡º:</p>
<pre><code>===SORRY!===
Method 'plot' must be resolved by class combo-chart because it exists in multiple roles (line-chart, bar-chart)
</code></pre><p><strong>è§£é‡Š</strong></p>
<p>å¦‚æœå¤šä¸ª roles è¢«åº”ç”¨åˆ°åŒä¸€ä¸ªç±»ä¸­, ä¼šå‡ºç°å†²çªå¹¶æŠ›å‡ºä¸€ä¸ªç¼–è¯‘æ—¶é”™è¯¯ã€‚
è¿™æ˜¯æ¯”å¤šé‡ç»§æ‰¿æ›´å®‰å…¨çš„æ–¹æ³•, å…¶ä¸­å†²çªä¸è¢«è®¤ä¸ºæ˜¯é”™è¯¯å¹¶ä¸”ç®€å•åœ°åœ¨è¿è¡Œæ—¶è§£å†³ã€‚
Roles ä¼šæé†’ä½ æœ‰å†²çªã€‚</p>
<h3 id="å†…çœ">å†…çœ</h3>
<p>ã€€
<strong>å†…çœ</strong>æ˜¯è·å–è¯¸å¦‚å¯¹è±¡çš„ç±»å‹ã€å±æ€§æˆ–æ–¹æ³•ç­‰å¯¹è±¡å±æ€§çš„ä¿¡æ¯çš„è¿‡ç¨‹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Human</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nb">Str</span> <span class="nv">$.name</span><span class="p">;</span>
    <span class="k">has</span> <span class="nb">Int</span> <span class="nv">$.age</span><span class="p">;</span>

    <span class="k">method</span> <span class="nf">introduce-yourself</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">Hi i am a human being, my name is </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nb">self</span><span class="o">.</span><span class="nb">name</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Employee</span> <span class="k">is</span> <span class="nc">Human</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nb">Str</span> <span class="nv">$.company</span><span class="p">;</span>
    <span class="k">has</span> <span class="nb">Int</span> <span class="nv">$.salary</span><span class="p">;</span>

    <span class="k">method</span> <span class="nf">introduce-yourself</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">Hi i am a employee, my name is </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nb">self</span><span class="o">.</span><span class="nb">name</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> and I work at: </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nb">self</span><span class="o">.</span><span class="nf">company</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$john</span> <span class="o">=</span> <span class="n">Human</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">name</span> <span class="o">=&gt;</span><span class="p">&#39;</span><span class="s1">John</span><span class="p">&#39;</span>,<span class="s">age</span> <span class="o">=&gt;</span> <span class="mi">23</span>,<span class="p">);</span>
<span class="k">my</span> <span class="nv">$jane</span> <span class="o">=</span> <span class="n">Employee</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">name</span> <span class="o">=&gt;</span><span class="p">&#39;</span><span class="s1">Jane</span><span class="p">&#39;</span>,<span class="s">age</span> <span class="o">=&gt;</span> <span class="mi">25</span>,<span class="s">company</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">Acme</span><span class="p">&#39;</span>,<span class="s">salary</span> <span class="o">=&gt;</span> <span class="mi">4000</span><span class="p">);</span>

<span class="nb">say</span> <span class="nv">$john</span><span class="o">.</span><span class="nb">WHAT</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$jane</span><span class="o">.</span><span class="nb">WHAT</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$john</span><span class="o">.^</span><span class="nb">attributes</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$jane</span><span class="o">.^</span><span class="nb">attributes</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$john</span><span class="o">.^</span><span class="nb">methods</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$jane</span><span class="o">.^</span><span class="nb">methods</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$jane</span><span class="o">.^</span><span class="nb">parents</span><span class="p">;</span>
<span class="k">if</span> <span class="nv">$jane</span> <span class="o">~~</span> <span class="n">Human</span> <span class="p">{</span><span class="nb">say</span> <span class="p">&#39;</span><span class="s1">Jane is a Human</span><span class="p">&#39;};</span>
</code></pre></div><p>å†…çœä½¿ç”¨äº†:</p>
<ul>
<li><code>.WHAT</code>  è¿”å›å·²ç»åˆ›å»ºçš„å¯¹è±¡æ‰€å±çš„ç±»ã€‚</li>
<li><code>.^attributes</code> è¿”å›ä¸€ä¸ªåŒ…å«è¯¥å¯¹è±¡æ‰€æœ‰å±æ€§çš„åˆ—è¡¨ã€‚</li>
<li><code>.^mtethods</code> è¿”å›èƒ½åœ¨è¯¥å¯¹è±¡èº«ä¸Šè°ƒç”¨çš„æ‰€æœ‰æ–¹æ³•ã€‚</li>
<li><code>.^parents</code> è¿”å›è¯¥å¯¹è±¡æ‰€å±ç±»çš„æ‰€æœ‰çˆ¶ç±»ã€‚</li>
<li><code>~~</code> å«åšæ™ºèƒ½åŒ¹é…æ“ä½œç¬¦ã€‚å¦‚æœå¯¹è±¡æ˜¯ä»å®ƒæ‰€è¿›è¡Œæ¯”è¾ƒçš„ç±»æˆ–ä»»ä½•å®ƒç»§æ‰¿çš„ç±»åˆ›å»ºçš„, åˆ™è®¡ç®—ä¸º Trueã€‚</li>
</ul>
<h2 id="ç¬¬åç« -å¼‚å¸¸å¤„ç†">ç¬¬åç«  å¼‚å¸¸å¤„ç†</h2>
<h3 id="æ•è·å¼‚å¸¸">æ•è·å¼‚å¸¸</h3>
<p>ã€€ã€€
<strong>å¼‚å¸¸</strong>æ˜¯å½“æŸäº›ä¸œè¥¿å‡ºé”™æ—¶å‘ç”Ÿåœ¨è¿è¡Œæ—¶çš„ç‰¹æ®Šè¡Œä¸ºã€‚</p>
<p>æˆ‘ä»¬è¯´å¼‚å¸¸è¢«æŠ›å‡ºã€‚è€ƒè™‘ä¸‹é¢è¿™ä¸ªè¿è¡Œæ­£ç¡®çš„è„šæœ¬:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nb">Str</span> <span class="nv">$name</span><span class="p">;</span>
<span class="nv">$name</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">Joanna</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hello </span><span class="p">&#34;</span> <span class="o">~</span> <span class="nv">$name</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">How are you doing today?</span><span class="p">&#34;</span>
</code></pre></div><p>è¾“å‡º:</p>
<pre><code>Hello Joanna
How are you doing today?
</code></pre><p>ç°åœ¨è®©è¿™ä¸ªè„šæœ¬æŠ›å‡ºå¼‚å¸¸:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nb">Str</span> <span class="nv">$name</span><span class="p">;</span>
<span class="nv">$name</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hello </span><span class="p">&#34;</span> <span class="o">~</span> <span class="nv">$name</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">How are you doing today?</span><span class="p">&#34;</span>
</code></pre></div><p>è¾“å‡º:</p>
<pre><code>Type check failed in assignment to $name; expected Str but got Int
   in block &lt;unit&gt; at exceptions.pl6:2
</code></pre><p>ä½ åº”è¯¥çœ‹åˆ°å½“é”™è¯¯å‡ºç°æ—¶(åœ¨è¿™ä¸ªä¾‹å­ä¸­æŠŠæ•°ç»„èµ‹å€¼ç»™å­—ç¬¦ä¸²å˜é‡)ç¨‹åºä¼šåœæ­¢å¹¶ä¸”å…¶å®ƒè¡Œçš„ä»£ç ä¸ä¼šè¢«æ‰§è¡Œ, å³ä½¿å®ƒä»¬æ˜¯æ­£ç¡®çš„ã€‚</p>
<p><strong>å¼‚å¸¸å¤„ç†</strong>æ˜¯æ•è·å·²ç»æŠ›å‡ºçš„å¼‚å¸¸çš„è¿‡ç¨‹ä»¥ä½¿è„šæœ¬èƒ½ç»§ç»­å·¥ä½œã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nb">Str</span> <span class="nv">$name</span><span class="p">;</span>
<span class="k">try</span> <span class="p">{</span>
    <span class="nv">$name</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hello </span><span class="p">&#34;</span> <span class="o">~</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="k">CATCH</span> <span class="p">{</span>
        <span class="k">default</span> <span class="p">{</span>
            <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Can you tell us your name again, we couldn&#39;t find it in the register.</span><span class="p">&#34;;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">How are you doing today?</span><span class="p">&#34;;</span>
</code></pre></div><p>è¾“å‡º:</p>
<pre><code>Can you tell us your name again, we couldn't find it in the register.
How are you doing today?
</code></pre><p>å¼‚å¸¸å¤„ç†æ˜¯ä½¿ç”¨ <code>try-catch</code> block å®Œæˆçš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">try</span> <span class="p">{</span>
    <span class="c1"># code goes in here</span>
    <span class="c1"># å¦‚æœæœ‰ä¸œè¥¿å‡ºé”™, è„šæœ¬ä¼šè¿›å…¥åˆ°ä¸‹é¢çš„ CATCH block ä¸­</span>
    <span class="c1"># å¦‚æœä»€ä¹ˆé”™è¯¯ä¹Ÿæ²¡æœ‰, é‚£ä¹ˆ CATCH block ä¼šè¢«å¿½ç•¥</span>
    <span class="k">CATCH</span> <span class="p">{</span>
        <span class="k">default</span> <span class="p">{</span>
            <span class="c1"># åªæœ‰æŠ›å‡ºå¼‚å¸¸æ—¶, è¿™å„¿çš„ä»£ç æ‰ä¼šè¢«æ±‚å€¼</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p><code>CATCH</code> block èƒ½åƒå®šä¹‰ <code>given</code> block é‚£æ ·å®šä¹‰ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬èƒ½æ•è·å¹¶å¤„ç†å„ç§ä¸åŒç±»å‹çš„å¼‚å¸¸ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">try</span> <span class="p">{</span>
    <span class="c1">#code goes in here</span>
    <span class="c1">#if anything goes wrong, the script will enter the below CATCH block</span>
    <span class="c1">#if nothing goes wrong the CATCH block will be ignored</span>
    <span class="k">CATCH</span> <span class="p">{</span>
        <span class="k">when</span> <span class="ne">X::AdHoc</span> <span class="p">{</span> <span class="c1">#do something if an exception of type X::AdHoc is thrown }</span>
        <span class="k">when</span> <span class="ne">X::IO</span> <span class="p">{</span> <span class="c1">#do something if an exception of type X::IO is thrown }</span>
        <span class="k">when</span> <span class="ne">X::OS</span> <span class="p">{</span> <span class="c1">#do something if an exception of type X::OS is thrown }</span>
        <span class="k">default</span> <span class="p">{</span> <span class="c1">#do something if an exception is thrown and doesn&#39;t belong to the above types }</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="æŠ›å‡ºå¼‚å¸¸">æŠ›å‡ºå¼‚å¸¸</h3>
<p>ã€€
å’Œæ•è·å¼‚å¸¸ç›¸æ¯”, Raku ä¹Ÿå…è®¸ä½ æ˜¾å¼åœ°æŠ›å‡ºå¼‚å¸¸ã€‚
æœ‰ä¸¤ç§ç±»å‹çš„å¼‚å¸¸å¯ä»¥æŠ›å‡º:</p>
<ul>
<li>ad-hoc å¼‚å¸¸</li>
<li>ç±»å‹å¼‚å¸¸</li>
</ul>
<p><strong>ad-hoc</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nb">Int</span> <span class="nv">$age</span> <span class="o">=</span> <span class="mi">21</span><span class="p">;</span>
<span class="nb">die</span> <span class="p">&#34;</span><span class="s2">Error !</span><span class="p">&#34;;</span>
</code></pre></div><p><strong>typed</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nb">Int</span> <span class="nv">$age</span> <span class="o">=</span> <span class="mi">21</span><span class="p">;</span>
<span class="ne">X::AdHoc</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">payload</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">Error !</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">throw</span><span class="p">;</span>
</code></pre></div><p>ä½¿ç”¨ <code>die</code> å­ä¾‹ç¨‹åé¢è·Ÿç€å¼‚å¸¸æ¶ˆæ¯æ¥æŠ›å‡º Ad-hoc å¼‚å¸¸ã€‚</p>
<p>Typed å¼‚å¸¸æ˜¯å¯¹è±¡, å› æ­¤ä¸Šé¢çš„ä¾‹å­ä¸­ä½¿ç”¨äº† <code>.new()</code> æ„é€ å‡½æ•°ã€‚</p>
<p>æ‰€æœ‰ç±»å‹åŒ–çš„å¼‚å¸¸éƒ½æ˜¯ä»ç±» <code>X</code> å¼€å§‹, ä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­:</p>
<ul>
<li><code>X::AdHoc</code> æ˜¯æœ€ç®€å•çš„å¼‚å¸¸ç±»å‹</li>
<li><code>X::IO</code> è·Ÿ IO é”™è¯¯æœ‰å…³ã€‚</li>
<li><code>X::OS</code> è·Ÿ OS é”™è¯¯æœ‰å…³ã€‚</li>
<li><code>X::Str::Numeric</code> è·ŸæŠŠå­—ç¬¦ä¸²å¼ºåˆ¶è½¬æ¢ä¸ºæ•°å­—æœ‰å…³ã€‚</li>
</ul>
<blockquote>
<p>æŸ¥çœ‹å¼‚å¸¸ç±»å‹å’Œç›¸å…³æ–¹æ³•çš„å®Œæ•´åˆ—è¡¨è¯·åˆ°  <a href="http://doc.raku.org/type.html">http://doc.raku.org/type.html</a> å¹¶å¯¼èˆªåˆ°ä»¥ X å¼€å¤´çš„ç±»å‹ã€‚</p>
</blockquote>
<h2 id="ç¬¬åä¸€ç« -æ­£åˆ™è¡¨è¾¾å¼">ç¬¬åä¸€ç«  æ­£åˆ™è¡¨è¾¾å¼</h2>
<p>æ­£åˆ™è¡¨è¾¾å¼, æˆ– <strong>regex</strong> æ˜¯ä¸€ä¸ªç”¨äºæ¨¡å¼åŒ¹é…çš„å­—ç¬¦åºåˆ—ã€‚</p>
<p>ç†è§£å®ƒæœ€ç®€å•çš„ä¸€ç§æ–¹å¼æ˜¯æŠŠå®ƒçœ‹ä½œæ¨¡å¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="p">&#39;</span><span class="s1">enlightenment</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="k">m</span><span class="p">/</span><span class="sr"> light </span><span class="p">/</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">enlightenment contains the word light</span><span class="p">&#34;;</span>
<span class="p">}</span>
</code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­, æ™ºèƒ½åŒ¹é…æ“ä½œç¬¦ <code>~~</code> ç”¨äºæ£€æŸ¥ä¸€ä¸ªå­—ç¬¦ä¸²(enlightenment)æ˜¯å¦åŒ…å«ä¸€ä¸ªå•è¯(light)ã€‚</p>
<p>&ldquo;Enlightenment&rdquo;  ä¸æ­£åˆ™è¡¨è¾¾å¼ <code>m/ light /</code> åŒ¹é…ã€‚</p>
<h3 id="regex-å®šä¹‰">Regex å®šä¹‰</h3>
<p>ã€€
æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼å®šä¹‰:</p>
<ul>
<li>/light/</li>
<li>m/light/</li>
<li>rx/light/</li>
</ul>
<p>é™¤éæ˜¾å¼åœ°æŒ‡å®š, å¦åˆ™ç©ºç™½æ˜¯æ— å…³ç´§è¦çš„, <code>m/light/</code> å’Œ <code>m/ light /</code> æ˜¯ç›¸åŒçš„ã€‚</p>
<h3 id="åŒ¹é…å­—ç¬¦">åŒ¹é…å­—ç¬¦</h3>
<p>ã€€
å­—æ¯æ•°å­—å­—ç¬¦å’Œä¸‹åˆ’çº¿ <code>_</code> åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­æ˜¯æŒ‰åŸæ ·å†™å‡ºçš„ã€‚</p>
<p>æ‰€æœ‰å…¶å®ƒå­—ç¬¦å¿…é¡»ä½¿ç”¨åæ–œçº¿æˆ–ç”¨å¼•å·å›´èµ·æ¥ä»¥è½¬ä¹‰ã€‚</p>
<p><strong>åæ–œçº¿</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="p">&#39;</span><span class="s1">Temperature: 13</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="k">m</span><span class="p">/</span><span class="sr"> \</span><span class="o">:</span><span class="sr"> </span><span class="p">/</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">The string provided contains a colon :</span><span class="p">&#34;;</span>
<span class="p">}</span>
</code></pre></div><p><strong>å•å¼•å·</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="p">&#39;</span><span class="s1">Age = 13</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="k">m</span><span class="p">/</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">/</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">The string provided contains an equal character = </span><span class="p">&#34;;</span>
<span class="p">}</span>
</code></pre></div><p><strong>åŒå¼•å·</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="p">&#39;</span><span class="s1">name@company.com</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="k">m</span><span class="p">/</span><span class="sr"> </span><span class="p">&#34;</span><span class="s2">@</span><span class="p">&#34;</span><span class="sr"> </span><span class="p">/</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">This is a valid email address because it contains an @ character</span><span class="p">&#34;;</span>
<span class="p">}</span>
</code></pre></div><h3 id="åŒ¹é…å­—ç¬¦ç±»">åŒ¹é…å­—ç¬¦ç±»</h3>
<p>ã€€
å°±åƒä¹‹å‰ç« èŠ‚çœ‹åˆ°çš„, åŒ¹é…å­—ç¬¦ç±»å¾ˆæ–¹ä¾¿ã€‚</p>
<p>è¯è™½è¿™ä¹ˆè¯´ï¼Œæ›´ç³»ç»Ÿçš„æ–¹æ³•æ˜¯ä½¿ç”¨ Unicode å±æ€§ã€‚</p>
<p>Unicode å±æ€§é—­åˆåœ¨ <code>&lt;: &gt;</code> ä¸­ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="p">&#34;</span><span class="s2">John123</span><span class="p">&#34;</span> <span class="o">~~</span> <span class="p">/</span><span class="sr"> </span><span class="p">&lt;:</span><span class="na">N</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">/</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Contains a number</span><span class="p">&#34;;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Doesn&#39;t contain a number</span><span class="p">&#34;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">&#34;</span><span class="s2">John-Doe</span><span class="p">&#34;</span> <span class="o">~~</span> <span class="p">/</span><span class="sr"> </span><span class="p">&lt;:</span><span class="na">Lu</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">/</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Contains an uppercase letter</span><span class="p">&#34;;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Doesn&#39;t contain an upper case letter</span><span class="p">&#34;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">&#34;</span><span class="s2">John-Doe</span><span class="p">&#34;</span> <span class="o">~~</span> <span class="p">/</span><span class="sr"> </span><span class="p">&lt;:</span><span class="na">Pd</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">/</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Contains a dash</span><span class="p">&#34;;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Doesn&#39;t contain a dash</span><span class="p">&#34;</span>
<span class="p">}</span>
</code></pre></div><h3 id="é€šé…ç¬¦">é€šé…ç¬¦</h3>
<p>é€šé…ç¬¦ä¹Ÿå¯ä»¥ç”¨åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ã€‚</p>
<p>ç‚¹ <code>.</code> æ„å‘³ç€ä»»ä½•å•ä¸ªå­—ç¬¦ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="p">&#39;</span><span class="s1">abc</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="k">m</span><span class="p">/</span><span class="sr"> a</span><span class="ni">.</span><span class="sr">c </span><span class="p">/</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Match</span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">&#39;</span><span class="s1">a2c</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="k">m</span><span class="p">/</span><span class="sr"> a</span><span class="ni">.</span><span class="sr">c </span><span class="p">/</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Match</span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">&#39;</span><span class="s1">ac</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="k">m</span><span class="p">/</span><span class="sr"> a</span><span class="ni">.</span><span class="sr">c </span><span class="p">/</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Match</span><span class="p">&#34;;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">No Match</span><span class="p">&#34;;</span>
<span class="p">}</span>
</code></pre></div><h3 id="é‡è¯">é‡è¯</h3>
<p>ã€€
é‡è¯åœ¨å­—ç¬¦åé¢ç”¨äºæŒ‡å®šæˆ‘ä»¬æœŸæœ›åŒ¹é…å®ƒå‰é¢çš„ä¸œè¥¿çš„æ¬¡æ•°ã€‚</p>
<p>é—®å· <code>?</code> æ„æ€æ˜¯ 0 æˆ– 1 æ¬¡ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="p">&#39;</span><span class="s1">ac</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="k">m</span><span class="p">/</span><span class="sr"> a</span><span class="o">?</span><span class="sr">c </span><span class="p">/</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Match</span><span class="p">&#34;;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">No Match</span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">&#39;</span><span class="s1">c</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="k">m</span><span class="p">/</span><span class="sr"> a</span><span class="o">?</span><span class="sr">c </span><span class="p">/</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Match</span><span class="p">&#34;;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">No Match</span><span class="p">&#34;;</span>
<span class="p">}</span>
</code></pre></div><p>æ˜Ÿå· <code>*</code> æ„æ€æ˜¯ 0 æˆ–å¤šæ¬¡ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="p">&#39;</span><span class="s1">az</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="k">m</span><span class="p">/</span><span class="sr"> a</span><span class="o">*</span><span class="sr">z </span><span class="p">/</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Match</span><span class="p">&#34;;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">No Match</span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">&#39;</span><span class="s1">aaz</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="k">m</span><span class="p">/</span><span class="sr"> a</span><span class="o">*</span><span class="sr">z </span><span class="p">/</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Match</span><span class="p">&#34;;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">No Match</span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">&#39;</span><span class="s1">aaaaaaaaaaz</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="k">m</span><span class="p">/</span><span class="sr"> a</span><span class="o">*</span><span class="sr">z </span><span class="p">/</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Match</span><span class="p">&#34;;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">No Match</span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">&#39;</span><span class="s1">z</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="k">m</span><span class="p">/</span><span class="sr"> a</span><span class="o">*</span><span class="sr">z </span><span class="p">/</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Match</span><span class="p">&#34;;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">No Match</span><span class="p">&#34;;</span>
<span class="p">}</span>
</code></pre></div><p><code>+</code> æ„æ€æ˜¯è‡³å°‘åŒ¹é… 1 æ¬¡ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="p">&#39;</span><span class="s1">az</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="k">m</span><span class="p">/</span><span class="sr"> a</span><span class="o">+</span><span class="sr">z </span><span class="p">/</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Match</span><span class="p">&#34;;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">No Match</span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">&#39;</span><span class="s1">aaz</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="k">m</span><span class="p">/</span><span class="sr"> a</span><span class="o">+</span><span class="sr">z </span><span class="p">/</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Match</span><span class="p">&#34;;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">No Match</span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">&#39;</span><span class="s1">aaaaaaaaaaz</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="k">m</span><span class="p">/</span><span class="sr"> a</span><span class="o">+</span><span class="sr">z </span><span class="p">/</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Match</span><span class="p">&#34;;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">No Match</span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">&#39;</span><span class="s1">z</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="k">m</span><span class="p">/</span><span class="sr"> a</span><span class="o">+</span><span class="sr">z </span><span class="p">/</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Match</span><span class="p">&#34;;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">No Match</span><span class="p">&#34;;</span>
<span class="p">}</span>
</code></pre></div><h3 id="åŒ¹é…ç»“æœ">åŒ¹é…ç»“æœ</h3>
<p>ã€€
å½“åŒ¹é…å­—ç¬¦ä¸²çš„æ­£åˆ™è¡¨è¾¾å¼æˆåŠŸæ—¶, åŒ¹é…ç»“æœè¢«å­˜å‚¨åœ¨ä¸€ä¸ªç‰¹æ®Šçš„å˜é‡ <code>$/</code> ä¸­ã€‚</p>
<p><strong>è„šæœ¬</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="p">&#39;</span><span class="s1">Rakudo is a Raku compiler</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="k">m</span><span class="p">/:</span><span class="na">s</span><span class="sr"> Raku</span><span class="p">/</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">The match is: </span><span class="p">&#34;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">;</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">The string before the match is: </span><span class="p">&#34;</span> <span class="o">~</span> <span class="nv">$/</span><span class="o">.</span><span class="nb">prematch</span><span class="p">;</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">The string after the match is: </span><span class="p">&#34;</span> <span class="o">~</span> <span class="nv">$/</span><span class="o">.</span><span class="nb">postmatch</span><span class="p">;</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">The matching string starts at position: </span><span class="p">&#34;</span> <span class="o">~</span> <span class="nv">$/</span><span class="o">.</span><span class="nb">from</span><span class="p">;</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">The matching string ends at position: </span><span class="p">&#34;</span> <span class="o">~</span> <span class="nv">$/</span><span class="o">.</span><span class="nb">to</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p><strong>è¾“å‡º</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="n">The</span> <span class="nb">match</span> <span class="n">is:</span> <span class="nb">Raku</span>
<span class="n">The</span> <span class="n">string</span> <span class="ow">before</span> <span class="n">the</span> <span class="nb">match</span> <span class="n">is:</span> <span class="n">Rakudo</span> <span class="k">is</span> <span class="nc">a</span>
<span class="n">The</span> <span class="n">string</span> <span class="nb">after</span> <span class="n">the</span> <span class="nb">match</span> <span class="n">is:</span>  <span class="nb">compiler</span>
<span class="n">The</span> <span class="n">matching</span> <span class="n">string</span> <span class="n">starts</span> <span class="nb">at</span> <span class="n">position:</span> <span class="mi">12</span>
<span class="n">The</span> <span class="n">matching</span> <span class="n">string</span> <span class="n">ends</span> <span class="nb">at</span> <span class="n">position:</span> <span class="mi">18</span>
</code></pre></div><p><strong>è§£é‡Š</strong></p>
<p><code>$/</code> è¿”å›ä¸€ä¸ª <strong>Match Object</strong>(åŒ¹é… regex çš„å­—ç¬¦ä¸²)ã€‚</p>
<p>ä¸‹é¢çš„æ–¹æ³•å¯ä»¥åœ¨ <strong>Match Object</strong> èº«ä¸Šè°ƒç”¨:</p>
<ul>
<li><code>.prematch</code> è¿”å›åŒ¹é…å‰é¢çš„å­—ç¬¦ä¸²</li>
<li><code>.postmatch</code> è¿”å›åŒ¹é…åé¢çš„å­—ç¬¦ä¸²</li>
<li><code>.from</code> è¿”å›åŒ¹é…çš„å¼€å§‹ä½ç½®</li>
<li><code>.to</code> è¿”å›åŒ¹é…çš„ç»“æŸä½ç½®</li>
</ul>
<blockquote>
<p>é»˜è®¤åœ°ç©ºç™½åœ¨ regex ä¸­æ˜¯æ— å…³ç´§è¦çš„ã€‚
å¦‚æœæˆ‘ä»¬æƒ³åœ¨ regex ä¸­åŒ…å«ç©ºç™½, æˆ‘ä»¬å¿…é¡»æ˜¾å¼åœ°è¿™æ ·åšã€‚
regex <code>m/:s Raku/</code> ä¸­çš„ <code>:s</code> å¼ºåˆ¶è€ƒè™‘ç©ºç™½å¹¶ä¸”ä¸ä¼šè¢«åˆ é™¤ã€‚
äºŒé€‰ä¸€, æˆ‘ä»¬èƒ½æŠŠ regex å†™ä¸º <code>m/Perl\s6/</code> å¹¶ä½¿ç”¨ <code>\s</code> å ä½ç¬¦ã€‚
å¦‚æœ regex ä¸­åŒ…å«çš„ç©ºç™½ä¸æ­¢ä¸€ä¸ª, ä½¿ç”¨ <code>:s</code> æ¯”ä½¿ç”¨ <code>\s</code> æ›´é«˜æ•ˆã€‚</p>
</blockquote>
<h3 id="ä¾‹å­">ä¾‹å­</h3>
<p>ã€€
è®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸ªé‚®ä»¶æ˜¯å¦åˆæ³•ã€‚</p>
<p>æˆ‘ä»¬å‡è®¾ä¸€ä¸ªåˆæ³•çš„ç”µå­é‚®ä»¶åœ°å€çš„å½¢å¼å¦‚ä¸‹:</p>
<p>first name [dot] last name [at] company [dot] (com/org/net)</p>
<blockquote>
<p>è¿™ä¸ªä¾‹å­ä¸­ç”¨äºç”µå­é‚®ä»¶æ£€æµ‹çš„ regex ä¸æ˜¯å¾ˆå‡†ç¡®ã€‚å®ƒçš„æ ¸å¿ƒæ„å›¾æ˜¯ç”¨æ¥è§£é‡Š Raku ä¸­çš„ regex çš„åŠŸèƒ½çš„ã€‚ ä¸è¦åœ¨ç”Ÿäº§ä¸­åŸæ ·ä½¿ç”¨å®ƒã€‚</p>
</blockquote>
<p><strong>è„šæœ¬</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$email</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">john.doe@raku.org</span><span class="p">&#39;;</span>
<span class="k">my</span> <span class="nv">$regex</span> <span class="o">=</span> <span class="p">/</span><span class="sr"> </span><span class="p">&lt;:</span><span class="na">L</span><span class="p">&gt;</span><span class="o">+</span><span class="sr">\</span><span class="ni">.</span><span class="p">&lt;:</span><span class="na">L</span><span class="p">&gt;</span><span class="o">+</span><span class="sr">\</span><span class="nv">@&lt;:L+:N&gt;</span><span class="o">+</span><span class="sr">\</span><span class="ni">.</span><span class="p">&lt;:</span><span class="na">L</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="p">/;</span>

<span class="k">if</span> <span class="nv">$email</span> <span class="o">~~</span> <span class="nv">$regex</span> <span class="p">{</span>
  <span class="nb">say</span> <span class="nv">$/</span> <span class="o">~</span> <span class="p">&#34;</span><span class="s2"> is a valid email</span><span class="p">&#34;;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">This is not a valid email</span><span class="p">&#34;;</span>
<span class="p">}</span>
</code></pre></div><p><strong>è¾“å‡º</strong></p>
<pre><code>john.doe@raku.org is a valid email
</code></pre><p><strong>è§£é‡Š</strong></p>
<ul>
<li><code>&lt;:L&gt;</code> åŒ¹é…å•ä¸ªå­—ç¬¦</li>
<li><code>&lt;:L&gt;+</code> åŒ¹é…å•ä¸ªå­—ç¬¦æˆ–æ›´å¤šå­—ç¬¦</li>
<li><code>\.</code> åŒ¹é…å•ä¸ªç‚¹å·å­—ç¬¦</li>
<li><code>\@</code> åŒ¹é…å•ä¸ª  [at] ç¬¦å·</li>
<li><code>&lt;:L+:N&gt;</code> åŒ¹é…ä¸€ä¸ªå­—æ¯å’Œæ•°å­—</li>
<li><code>&lt;:L+:N&gt;+</code> åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ¯å’Œæ•°å­—</li>
</ul>
<p>å…¶ä¸­çš„ regex å¯ä»¥åˆ†è§£æˆå¦‚ä¸‹:</p>
<ul>
<li><strong>first name</strong> <code>&lt;:L&gt;+</code></li>
<li><strong>[dot]</strong> <code>\.</code></li>
<li><strong>last name</strong> <code>&lt;:L&gt;+</code></li>
<li><strong>[at]</strong> <code>\@</code></li>
<li><strong>company name</strong> <code>&lt;:L+:N&gt;+</code></li>
<li><strong>[dot]</strong> <code>\.</code></li>
<li><strong>com/org/net</strong> <code>&lt;:L&gt;+</code></li>
</ul>
<p>å¯é€‰åœ°, ä¸€ä¸ª regex å¯ä»¥è¢«åˆ†è§£æˆå¤šä¸ªå…·å regexesã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$email</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">john.doe@raku.org</span><span class="p">&#39;;</span>
<span class="k">my</span> <span class="k">regex</span> <span class="nf">many-letters</span> <span class="p">{</span><span class="sr"> </span><span class="p">&lt;:</span><span class="na">L</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="p">};</span>
<span class="k">my</span> <span class="k">regex</span> <span class="nf">dot</span> <span class="p">{</span><span class="sr"> \</span><span class="ni">.</span><span class="sr"> </span><span class="p">};</span>
<span class="k">my</span> <span class="k">regex</span> <span class="nf">at</span> <span class="p">{</span><span class="sr"> \</span><span class="nv">@</span><span class="sr"> </span><span class="p">};</span>
<span class="k">my</span> <span class="k">regex</span> <span class="nf">many-letters-numbers</span> <span class="p">{</span><span class="sr"> </span><span class="p">&lt;:</span><span class="na">L</span><span class="o">+</span><span class="p">:</span><span class="na">N</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="p">};</span>

<span class="k">if</span> <span class="nv">$email</span> <span class="o">~~</span> <span class="p">/</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">many-letters</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">dot</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">many-letters</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">at</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">many-letters-numbers</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">dot</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">many-letters</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">/</span> <span class="p">{</span>
  <span class="nb">say</span> <span class="nv">$/</span> <span class="o">~</span> <span class="p">&#34;</span><span class="s2"> is a valid email</span><span class="p">&#34;;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">This is not a valid email</span><span class="p">&#34;;</span>
<span class="p">}</span>
</code></pre></div><p>å…·å regex æ˜¯ä½¿ç”¨ <code>my regex regex-name { regex definition }</code> å®šä¹‰çš„ã€‚</p>
<p>å…·å regex å¯ä»¥ä½¿ç”¨ <code>&lt;regex-name&gt;</code> æ¥è°ƒç”¨ã€‚</p>
<blockquote>
<p>æ›´å¤šå…³äº regexes çš„ä¸œè¥¿, æŸ¥çœ‹ <a href="http://doc.raku.org/language/regexes">http://doc.raku.org/language/regexes</a></p>
</blockquote>
<h2 id="ç¬¬åäºŒç« -raku-æ¨¡å—">ç¬¬åäºŒç«  Raku æ¨¡å—</h2>
<p>Rakudo è‡ªå¸¦äº† Panda è¿™ä¸ªæ¨¡å—å®‰è£…å·¥å…·ã€‚</p>
<p>è¦å®‰è£…æŒ‡å®šçš„æ¨¡å—, åœ¨ç»ˆç«¯ä¸­é”®å…¥å¦‚ä¸‹å‘½ä»¤:</p>
<pre><code>zef install &quot;module name&quot;
</code></pre><blockquote>
<p>Raku çš„æ¨¡å—ç›®å½•å¯ä»¥åœ¨  <a href="http://modules.raku.org/">http://modules.raku.org/</a> ä¸­æ‰¾åˆ°ã€‚</p>
</blockquote>
<h3 id="ä½¿ç”¨æ¨¡å—">ä½¿ç”¨æ¨¡å—</h3>
<p>ã€€
MD5 æ˜¯ä¸€ä¸ªå…³äºå¯†ç çš„æ•£åˆ—å‡½æ•°ï¼Œå®ƒäº§ç”Ÿä¸€ä¸ª128ä½çš„æ•£åˆ—å€¼ã€‚
MD5 æœ‰å¤šç§åŠ å¯†å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„å£ä»¤çš„åº”ç”¨ç¨‹åºã€‚å½“æ–°ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œå…¶è¯ä¹¦å¹¶ä¸å­˜å‚¨ä¸ºçº¯æ–‡æœ¬ï¼Œè€Œæ˜¯æ•£åˆ—ã€‚è¿™æ ·åšçš„ç†ç”±æ˜¯ï¼Œå¦‚æœè¯¥æ•°æ®åº“è¢«ç ´è§£ï¼Œæ”»å‡»è€…å°†ä¸èƒ½å¤ŸçŸ¥é“å£ä»¤æ˜¯ä»€ä¹ˆã€‚</p>
<p>æ¯”æ–¹è¯´ï¼Œä½ éœ€è¦ä¸€ä¸ªç”Ÿæˆå¯†ç çš„MD5å“ˆå¸Œä»¥å­˜å‚¨åœ¨æ•°æ®åº“ä¸­å¤‡ç”¨çš„è„šæœ¬ã€‚</p>
<p>å¹¸è¿çš„æ˜¯ï¼ŒRaku å·²ç»æœ‰ä¸€ä¸ªèƒ½å®ç°MD5ç®—æ³•çš„æ¨¡å—ã€‚æˆ‘ä»¬å®‰è£…ä¸‹:</p>
<p><code>zef install Digest::MD5</code></p>
<p>ç°åœ¨è¿è¡Œä¸‹é¢çš„è„šæœ¬:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">use</span> <span class="nn">Digest::MD5</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$password</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">password123</span><span class="p">&#34;;</span>
<span class="k">my</span> <span class="nv">$hashed-password</span> <span class="o">=</span> <span class="n">Digest::MD5</span><span class="o">.</span><span class="nb">new</span><span class="o">.</span><span class="nf">md5_hex</span><span class="p">(</span><span class="nv">$password</span><span class="p">);</span>

<span class="nb">say</span> <span class="nv">$hashed-password</span><span class="p">;</span>
</code></pre></div><p>ä¸ºäº†è¿è¡Œåˆ›å»ºå“ˆå¸Œçš„ <code>md5_hex()</code> å‡½æ•°, æˆ‘ä»¬éœ€è¦åŠ è½½éœ€è¦çš„æ¨¡å—ã€‚<code>use</code> å…³é”®å­—ç”¨äºåŠ è½½æ¨¡å—ã€‚</p>
<h2 id="ç¬¬åä¸‰ç« -unicode">ç¬¬åä¸‰ç«  Unicode</h2>
<p>Unicode æ˜¯ç¼–ç å¹¶è¡¨ç°æ–‡æœ¬çš„æ ‡å‡†, å®ƒæ»¡è¶³äº†ä¸–ç•Œä¸Šçš„å¤§éƒ¨åˆ†ç³»ç»Ÿã€‚</p>
<p>UTF-8 æ˜¯èƒ½å¤Ÿä»¥Unicodeç¼–ç æ‰€æœ‰å¯èƒ½çš„å­—ç¬¦æˆ–ä»£ç ç‚¹çš„å­—ç¬¦ç¼–ç ã€‚</p>
<p>å­—ç¬¦çš„å®šä¹‰æ˜¯é€šè¿‡:</p>
<p><strong>å­—ç´ </strong>: å¯è§çš„è¡¨ç¤º</p>
<p><strong>ä»£ç ç‚¹</strong>: èµ‹å€¼ç»™å­—ç¬¦çš„æ•°å­—</p>
<h3 id="ä½¿ç”¨-unicode">ä½¿ç”¨ Unicode</h3>
<p>ã€€
<strong>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä½¿ç”¨ Unicode èƒ½è¾“å‡ºä»€ä¹ˆ</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">a</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="se">\x</span><span class="mh">0061</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="se">\c</span><span class="p">[</span><span class="s">LATIN SMALL LETTER A</span><span class="p">]&#34;;</span>
</code></pre></div><p>ä¸Šé¢ 3 è¡Œå±•ç¤ºäº†æ„å»ºå­—ç¬¦çš„ä¸åŒæ–¹æ³•:</p>
<ol>
<li>ç›´æ¥å†™å‡ºå­—ç¬¦(å­—ç´ )</li>
<li>ä½¿ç”¨ <code>\x</code> å’Œä»£ç ç‚¹</li>
<li>ä½¿ç”¨ <code>\c</code> å’Œä»£ç ç‚¹åå­—</li>
</ol>
<p><strong>ç°åœ¨æˆ‘ä»¬æ¥è¾“å‡ºç¬‘è„¸</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">â˜º</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="se">\x</span><span class="mh">263a</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="se">\c</span><span class="p">[</span><span class="s">WHITE SMILING FACE</span><span class="p">]&#34;;</span>
</code></pre></div><p><strong>ç»„åˆä¸¤ä¸ªä»£ç ç‚¹çš„å¦å¤–ä¸€ä¸ªä¾‹å­</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Ã¡</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="se">\x</span><span class="mh">00e1</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="se">\x</span><span class="mh">0061</span><span class="se">\x</span><span class="mh">0301</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="se">\c</span><span class="p">[</span><span class="s">LATIN SMALL LETTER A WITH ACUTE</span><span class="p">]&#34;;</span>
</code></pre></div><p>å­—æ¯ <code>Ã¡</code> å¯ä»¥è¢«å†™ä¸º:</p>
<ul>
<li>ä½¿ç”¨å®ƒçš„å”¯ä¸€ä»£ç ç‚¹ <code>\x00e1</code></li>
<li>æˆ–ä½œä¸º <code>a</code> å’Œ é‡éŸ³ç¬¦å· <code>\x0061\x0301</code> ä»£ç ç‚¹çš„ç»„åˆ</li>
</ul>
<p><strong>æœ‰äº›æ–¹æ³•å¯ä»¥ä½¿ç”¨</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Ã¡</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">NFC</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Ã¡</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">NFD</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Ã¡</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">uniname</span><span class="p">;</span>
</code></pre></div><p><strong>è¾“å‡º</strong></p>
<pre><code>NFC:0x&lt;00e1&gt;
NFD:0x&lt;0061 0301&gt;
LATIN SMALL LETTER A WITH ACUTE
</code></pre><p><code>NFC</code> è¿”å›å”¯ä¸€çš„ä»£ç ç‚¹ã€‚</p>
<p><code>NFD</code> åˆ†è§£(decompose)é‚£ä¸ªå­—ç¬¦å¹¶è¿”å›æ¯éƒ¨åˆ†çš„ä»£ç ç‚¹ã€‚</p>
<p><code>uniname</code> è¿”å›ä»£ç ç‚¹çš„åå­—ã€‚</p>
<p><strong>Unicode å­—ç¬¦å¯ä»¥ç”¨ä½œæ ‡è¯†ç¬¦</strong>:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$Î”</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nv">$Î”</span><span class="o">++</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$Î”</span><span class="p">;</span>
</code></pre></div><h2 id="ç¬¬åå››ç« -å¹¶è¡Œå¹¶å‘å’Œå¼‚æ­¥">ç¬¬åå››ç«  å¹¶è¡Œã€å¹¶å‘å’Œå¼‚æ­¥</h2>
<p>åœ¨æ­£å¸¸æƒ…å†µä¸‹, ç¨‹åºä¸­çš„æ‰€æœ‰ä»»åŠ¡éƒ½æ˜¯ç›¸ç»§åœ°è¿è¡Œçš„ã€‚</p>
<p>è¿™å¯èƒ½ä¸æ˜¯ä¸ªäº‹å„¿é™¤éä½ æ­£å°è¯•å»åšçš„ä¸œè¥¿éœ€è¦è€—è´¹å¾ˆå¤šæ—¶é—´ã€‚</p>
<p>å¾ˆè‡ªç„¶åœ°è¯´, Raku æ‹¥æœ‰èƒ½è®©ä½ å¹¶è¡Œåœ°è¿è¡Œä¸œè¥¿çš„åŠŸèƒ½ã€‚</p>
<p>åœ¨è¿™ä¸ªé˜¶æ®µ, æ³¨æ„å¹¶è¡Œå¯ä»¥æ˜¯ä¸‹é¢ä¸¤ä¸ªä¸œè¥¿ä¹‹ä¸€æ˜¯å¾ˆé‡è¦çš„:</p>
<ul>
<li><strong>ä»»åŠ¡å¹¶è¡ŒåŒ–</strong>: ä¸¤ä¸ª(æˆ–æ›´å¤š)ç‹¬ç«‹çš„è¡¨è¾¾å¼å¹¶è¡Œåœ°è¿è¡Œã€‚</li>
<li><strong>æ•°æ®å¹¶è¡ŒåŒ–</strong>: å•ä¸ªè¡¨è¾¾å¼å¹¶è¡Œåœ°è¿­ä»£åˆ—è¡¨ä¸­çš„å…ƒç´ ã€‚</li>
</ul>
<p>è®©æˆ‘ä»¬ä»åè€…å¼€å§‹ã€‚</p>
<h3 id="æ•°æ®å¹¶è¡ŒåŒ–">æ•°æ®å¹¶è¡ŒåŒ–ã€€</h3>
<p>ã€€</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@array</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">50000</span><span class="p">);</span>                     <span class="c1">#Array population</span>
<span class="k">my</span> <span class="nv">@result</span> <span class="o">=</span> <span class="nv">@array</span><span class="o">.</span><span class="nb">map</span><span class="p">({</span> <span class="nb">is-prime</span> <span class="nv">$_</span> <span class="p">});</span>   <span class="c1">#call is-prime for each array element</span>
<span class="nb">say</span> <span class="nb">now</span> <span class="o">-</span> <span class="k">INIT</span> <span class="nb">now</span><span class="p">;</span>                         <span class="c1">#Output the time it took for the script to complete</span>
</code></pre></div><p><strong>è€ƒè™‘ä¸Šé¢çš„ä¾‹å­</strong>
ã€€
æˆ‘ä»¬åªåšä¸€ä¸ªæ“ä½œ <code>@array.map({is-prime $_})</code>ã€‚<code>is-prime</code> å­ä¾‹ç¨‹ç›¸ç»§è¢«æ¯ä¸ªæ•°ç»„å…ƒç´ æ‰€è°ƒç”¨:</p>
<p><code>is-prime @array[0] </code> ç„¶åæ˜¯ <code>is-prime @array[1]</code> ç„¶åæ˜¯ <code>is-prime @array[2]</code> ç­‰ç­‰ã€‚</p>
<p><strong>å¹¸è¿çš„æ˜¯, æˆ‘ä»¬èƒ½åŒæ—¶åœ¨å¤šä¸ªæ•°ç»„å…ƒç´ èº«ä¸Šè°ƒç”¨ <code>is-prime</code> å‡½æ•°:</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@array</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">50000</span><span class="p">);</span>                         <span class="c1">#Array population</span>
<span class="k">my</span> <span class="nv">@result</span> <span class="o">=</span> <span class="nv">@array</span><span class="o">.</span><span class="nb">race</span><span class="o">.</span><span class="nb">map</span><span class="p">({</span> <span class="nb">is-prime</span> <span class="nv">$_</span> <span class="p">});</span>  <span class="c1">#call is-prime for each array element</span>
<span class="nb">say</span> <span class="nb">now</span> <span class="o">-</span> <span class="k">INIT</span> <span class="nb">now</span><span class="p">;</span>                             <span class="c1">#Output the time it took to complete</span>
</code></pre></div><p>æ³¨æ„è¡¨è¾¾å¼ä¸­ä½¿ç”¨çš„ <code>race</code>ã€‚è¿™ä¸ªæ–¹æ³•ä¼šä½¿æ•°ç»„å…ƒç´ èƒ½å¤Ÿå¹¶è¡Œåœ°è¿­ä»£ã€‚</p>
<p>è¿è¡Œä¸¤ä¸ªä¾‹å­(ä½¿ç”¨å’Œä¸ä½¿ç”¨ <code>race</code>)è¿è¡Œä¹‹å, æ¯”è¾ƒä¸¤ä¸ªè„šæœ¬è¿è¡Œç»“æŸæ‰€èŠ±è´¹çš„æ—¶é—´ã€‚</p>
<blockquote>
<p><code>race</code> ä¸ä¼šä¿å­˜å…ƒç´ çš„é¡ºåºã€‚å¦‚æœä½ æƒ³é‚£æ ·åš, ä½¿ç”¨ <code>hyper</code> ä»£æ›¿ã€‚</p>
<p><strong>race</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@array</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">1000</span><span class="p">);</span>
<span class="k">my</span> <span class="nv">@result</span> <span class="o">=</span> <span class="nv">@array</span><span class="o">.</span><span class="nb">race</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span> <span class="p">{</span><span class="nv">$_</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span> <span class="p">);</span>
<span class="nv">@result</span><span class="o">Â».</span><span class="nb">say</span><span class="p">;</span>
</code></pre></div><p><strong>hyper</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@array</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">1000</span><span class="p">);</span>
<span class="k">my</span> <span class="nv">@result</span> <span class="o">=</span> <span class="nv">@array</span><span class="o">.</span><span class="nb">hyper</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span> <span class="p">{</span><span class="nv">$_</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span> <span class="p">);</span>
<span class="nv">@result</span><span class="o">Â».</span><span class="nb">say</span><span class="p">;</span>
</code></pre></div><p>å¦‚æœä½ ä¿©ä¸ªè„šæœ¬éƒ½è¿è¡Œäº†, ä½ åº”è¯¥æ³¨æ„åˆ°ä¸€ä¸ªæ’åºäº†ä¸€ä¸ªæ²¡æœ‰æ’åºã€‚</p>
</blockquote>
<h3 id="ä»»åŠ¡å¹¶è¡ŒåŒ–">ä»»åŠ¡å¹¶è¡ŒåŒ–</h3>
<p>ã€€</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@array1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">49999</span><span class="p">);</span>
<span class="k">my</span> <span class="nv">@array2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">..</span><span class="mi">50001</span><span class="p">);</span>

<span class="k">my</span> <span class="nv">@result1</span> <span class="o">=</span> <span class="nv">@array1</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span> <span class="p">{</span><span class="nb">is-prime</span><span class="p">(</span><span class="nv">$_</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)}</span> <span class="p">);</span>
<span class="k">my</span> <span class="nv">@result2</span> <span class="o">=</span> <span class="nv">@array2</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span> <span class="p">{</span><span class="nb">is-prime</span><span class="p">(</span><span class="nv">$_</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)}</span> <span class="p">);</span>

<span class="nb">say</span> <span class="nv">@result1</span> <span class="o">==</span> <span class="nv">@result2</span><span class="p">;</span>

<span class="nb">say</span> <span class="nb">now</span> <span class="o">-</span> <span class="k">INIT</span> <span class="nb">now</span><span class="p">;</span>
</code></pre></div><p><strong>è€ƒè™‘ä¸Šé¢çš„ä¾‹å­</strong>:</p>
<ol>
<li>æˆ‘ä»¬å®šä¹‰äº† 2 ä¸ªæ•°ç»„</li>
<li>å¯¹æ¯ä¸ªæ•°ç»„åº”ç”¨ä¸åŒçš„æ“ä½œå¹¶ä¿å­˜ç»“æœ</li>
<li>å¹¶æ£€æŸ¥ä¸¤ä¸ªç»“æœæ˜¯å¦ç›¸åŒ</li>
</ol>
<p>è¯¥è„šæœ¬ç­‰åˆ° <code>@array1.map( {is-prime($_ +1)} )</code> å®Œæˆç„¶åè®¡ç®— <code>@array1.map( {is-prime($_ +1)} )</code>ã€‚</p>
<p>åº”ç”¨åˆ°æ¯ä¸ªæ•°ç»„çš„ä¿©ä¸ªæ“ä½œå½¼æ­¤é—´æ²¡æœ‰ä¾èµ–ã€‚</p>
<p><strong>ä¸ºä»€ä¹ˆä¸å¹¶è¡Œåœ°æ‰§è¡Œå‘¢?</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@array1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">49999</span><span class="p">);</span>
<span class="k">my</span> <span class="nv">@array2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">..</span><span class="mi">50001</span><span class="p">);</span>

<span class="k">my</span> <span class="nv">$promise1</span> <span class="o">=</span> <span class="k">start</span> <span class="nv">@array1</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span> <span class="p">{</span><span class="nv">$_</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span> <span class="p">);</span>
<span class="k">my</span> <span class="nv">$promise2</span> <span class="o">=</span> <span class="k">start</span> <span class="nv">@array2</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span> <span class="p">{</span><span class="nv">$_</span> <span class="o">-</span> <span class="mi">1</span><span class="p">}</span> <span class="p">);</span>

<span class="k">my</span> <span class="nv">@result1</span> <span class="o">=</span> <span class="nb">await</span> <span class="nv">$promise1</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">@result2</span> <span class="o">=</span> <span class="nb">await</span> <span class="nv">$promise2</span><span class="p">;</span>

<span class="nb">say</span> <span class="nv">@result1</span> <span class="o">==</span> <span class="nv">@result2</span><span class="p">;</span>

<span class="nb">say</span> <span class="nb">now</span> <span class="o">-</span> <span class="k">INIT</span> <span class="nb">now</span><span class="p">;</span>
</code></pre></div><p><strong>è§£é‡Š</strong></p>
<p><code>start</code> æ–¹æ³•è®¡ç®—å®ƒåé¢çš„ä»£ç å¹¶è¿”å›<strong>promise ç±»å‹çš„å¯¹è±¡</strong>æˆ–<strong>promise</strong>ã€‚</p>
<p>å¦‚æœä»£ç è¢«æ­£ç¡®åœ°æ±‚å€¼, é‚£ä¹ˆ promise ä¼šè¢«<strong>ä¿ç•™</strong>(kept)ã€‚</p>
<p>å¦‚æœä»£ç æŠ›å‡ºå¼‚å¸¸, é‚£ä¹ˆ promise ä¼šè¢«<strong>ç ´å</strong>(broken)ã€‚</p>
<p><code>await</code> æ–¹æ³•ç­‰å¾…ä¸€ä¸ª <strong>promise</strong>ã€‚</p>
<p>å¦‚æœé‚£ä¸ª promise æ˜¯è¢«<strong>ä¿ç•™</strong>çš„, await ä¼šè·å–åˆ°è¿”å›å€¼ã€‚</p>
<p>å¦‚æœé‚£ä¸ª promise æ˜¯è¢«<strong>ç ´å</strong>çš„, await ä¼šè·å–åˆ°æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<p>æ£€æŸ¥æ¯ä¸ªè„šæœ¬å®Œæˆæ‰€èŠ±è´¹çš„æ—¶é—´ã€‚</p>
<blockquote>
<p>å¹¶è¡Œæ€»æ˜¯æ·»åŠ çº¿ç¨‹å¼€é”€ã€‚å¦‚æœå¼€é”€æŠµæ¶ˆä¸äº†è¿ç®—é€Ÿåº¦çš„å¢é•¿ï¼Œé‚£ä¹ˆè¯¥è„šæœ¬ä¼šæ˜¾å¾—è¾ƒæ…¢ã€‚
è¿™å°±æ˜¯ä¸ºä»€ä¹ˆï¼Œåœ¨å¾ˆç®€å•çš„è„šæœ¬ä¸­ä½¿ç”¨ <strong>race</strong>ï¼Œ<strong>hyper</strong>ï¼Œ<strong>start</strong> å’Œ <strong>await</strong> å®é™…ä¸Šå¯ä»¥ä½¿å®ƒä»¬æ…¢ä¸‹æ¥ã€‚</p>
</blockquote>
<h3 id="å¹¶å‘å’Œå¼‚æ­¥">å¹¶å‘å’Œå¼‚æ­¥</h3>
<p>ã€€</p>
<blockquote>
<p>å…³äºå¹¶å‘å’Œå¼‚æ­¥ç¼–ç¨‹çš„æ›´å¤šä¿¡æ¯, è¯·æŸ¥çœ‹  <a href="http://doc.raku.org/language/concurrency">http://doc.raku.org/language/concurrency</a></p>
</blockquote>
<h2 id="ç¬¬åäº”ç« -ç¤¾åŒº">ç¬¬åäº”ç«  ç¤¾åŒº</h2>
<p>å¾ˆå¤šè®¨è®ºå‘ç”Ÿåœ¨ <a href="irc://irc.freenode.net/#raku">#raku</a> IRC é¢‘é“ä¸­ã€‚ä½ å¯ä»¥åˆ° <a href="http://raku.org/community/irc">http://raku.org/community/irc</a> è¿›è¡Œä»»ä½•è¯¢é—®ã€‚</p>
<p><a href="http://pl6anet.org/">http://pl6anet.org/</a> æ˜¯ä¸€ä¸ª Raku åšå®¢èšåˆå™¨ã€‚</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/intro" term="intro" label="intro" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku åœ£è¯æœˆå†(2010)]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-10-05-raku-calendar-2010/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2015-04-15-raku-calendar-2012/?utm_source=atom_feed" rel="related" type="text/html" title="Raku åœ£è¯æœˆå† 2012" />
                <link href="https://ohmyweekly.github.io/notes/2014-12-19-raku-calendar/?utm_source=atom_feed" rel="related" type="text/html" title="Raku åœ£è¯æœˆå† - 2014" />
            
                <id>https://ohmyweekly.github.io/notes/2015-10-05-raku-calendar-2010/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Raku Calendar(2010)</blockquote><h2 id="ç¬¬äºŒå¤©-ç”¨-main-å‡½æ•°æ§åˆ¶å‘½ä»¤è¡Œäº¤äº’">ç¬¬äºŒå¤©: ç”¨ MAIN å‡½æ•°æ§åˆ¶å‘½ä»¤è¡Œäº¤äº’</h2>
<p>åœ¨ UNIX ç¯å¢ƒä¸‹ï¼Œå¾ˆå¤šè„šæœ¬éƒ½æ˜¯è¦ä»å‘½ä»¤è¡Œé‡Œè·å–è¿è¡Œå‚æ•°çš„ã€‚åœ¨ Raku ä¸­å®ç°è¿™ä¸ªç›¸å½“ç®€å•ã€‚æ¯”å¦‚ä¸‹é¢è¿™æ ·ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ cat add.pl
sub MAIN <span class="o">(</span><span class="nv">$x</span>, <span class="nv">$y</span><span class="o">)</span> <span class="o">{</span>
    say <span class="nv">$x</span> + <span class="nv">$y</span>
<span class="o">}</span>
$ raku add.pl <span class="m">3</span> <span class="m">4</span>
<span class="m">7</span>
$ raku add.pl too many arguments
Usage:
add.pl x y
</code></pre></div><p>åªè¦å®šä¹‰ä¸€ä¸ªå¸¦å‘½åå˜é‡çš„ MAIN å‡½æ•°ï¼Œä½ å°±å¯ä»¥è·å¾—ä¸€ä¸ªå‘½ä»¤è¡Œåˆ†æå™¨ã€‚ç„¶åå‘½ä»¤è¡Œå‚æ•°å°±è¢«è‡ªåŠ¨ç»‘å®šåˆ° <code>$x</code> å’Œ <code>$y</code> ä¸Šäº†ã€‚å¦‚æœä¸åŒ¹é…ï¼Œè¿˜æœ‰æ¸©é¦¨çš„ Usage æç¤ºã€‚</p>
<p>å½“ç„¶ï¼Œä½ å¯èƒ½æ›´å–œæ¬¢è‡ªå·±å®šåˆ¶ Usage ä¿¡æ¯ã€‚é‚£ä¹ˆè‡ªå·±åŠ¨æ‰‹ï¼Œç¼–å†™ USAGE å‡½æ•°å¥½äº†ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ cat add2.pl
sub MAIN<span class="o">(</span><span class="nv">$x</span>, <span class="nv">$y</span><span class="o">)</span> <span class="o">{</span>
    say <span class="nv">$x</span> + <span class="nv">$y</span>
<span class="o">}</span>
sub USAGE <span class="o">()</span> <span class="o">{</span>
    say <span class="s2">&#34;Usage: add.pl &lt;num1&gt; &lt;num2&gt;&#34;</span><span class="p">;</span>
<span class="o">}</span>
$ raku add2.pl too many arguments
Usage: add.pl &lt;num1&gt; &lt;num2&gt;
</code></pre></div><p>æ›´è¿›ä¸€æ­¥çš„ï¼Œä½ å¯ä»¥ç”¨ <code>multi</code> æŒ‡ä»¤å£°æ˜å¤šä¸ª MAIN å‡½æ•°ä»¥å®Œæˆä¸€ç§å¯æ›¿ä»£çš„è¯­æ³•ï¼Œæˆ–è€…æ ¹æ®æŸäº›å¸¸é‡åšå‡ºä¸åŒååº”ï¼Œæ¯”å¦‚ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ cat calc
<span class="c1">#!/usr/bin/env raku</span>

multi MAIN<span class="o">(</span><span class="s1">&#39;add&#39;</span>, <span class="nv">$x</span>, <span class="nv">$y</span><span class="o">)</span>  <span class="o">{</span> say <span class="nv">$x</span> + <span class="nv">$y</span> <span class="o">}</span>
multi MAIN<span class="o">(</span><span class="s1">&#39;div&#39;</span>, <span class="nv">$x</span>, <span class="nv">$y</span><span class="o">)</span>  <span class="o">{</span> say <span class="nv">$x</span> / <span class="nv">$y</span> <span class="o">}</span>
multi MAIN<span class="o">(</span><span class="s1">&#39;mult&#39;</span>, <span class="nv">$x</span>, <span class="nv">$y</span><span class="o">)</span> <span class="o">{</span> say <span class="nv">$x</span> * <span class="nv">$y</span> <span class="o">}</span>
$ ./calc add <span class="m">3</span> <span class="m">5</span>
<span class="m">8</span>
$ ./calc mult <span class="m">3</span> <span class="m">5</span>
<span class="m">15</span>
$ ./calc
Usage:
./calc add x y
or
./calc div x y
or
./calc mult x y
</code></pre></div><p>è¿˜æœ‰å‘½åå‚æ•°å¯¹åº”ä¸åŒçš„é€‰é¡¹çš„æƒ…å†µï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ cat copy.pl
sub MAIN<span class="o">(</span><span class="nv">$source</span>, <span class="nv">$target</span>, Bool :<span class="nv">$verbose</span><span class="o">)</span> <span class="o">{</span>
    say <span class="s2">&#34;Copying &#39;</span><span class="nv">$source</span><span class="s2">&#39; to &#39;</span><span class="nv">$target</span><span class="s2">&#39;&#34;</span> <span class="k">if</span> <span class="nv">$verbose</span><span class="p">;</span>
    run <span class="s2">&#34;cp </span><span class="nv">$source</span><span class="s2"> </span><span class="nv">$target</span><span class="s2">&#34;</span><span class="p">;</span>
<span class="o">}</span>
$ raku copy.pl calc calc2
$ raku copy.pl  --verbose calc calc2
Copying <span class="s1">&#39;calc&#39;</span> to <span class="s1">&#39;calc2&#39;</span>
</code></pre></div><p>è¿™é‡Œç”³æ˜å˜é‡ <code>$verbose</code> ç±»å‹ä¸º Boolï¼Œä¹Ÿå°±æ˜¯ä¸æ¥å—èµ‹å€¼ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªç±»å‹çº¦æŸçš„è¯ï¼Œå®ƒæ˜¯éœ€è¦èµ‹å€¼çš„ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ cat <span class="k">do</span>-nothing.pl
sub MAIN<span class="o">(</span>:<span class="nv">$how</span> <span class="o">=</span> <span class="s1">&#39;fast&#39;</span><span class="o">)</span> <span class="o">{</span>
    say <span class="s2">&#34;Do nothing, but do it </span><span class="nv">$how</span><span class="s2">&#34;</span><span class="p">;</span>
<span class="o">}</span>
$ raku <span class="k">do</span>-nothing.pl
Do nothing, but <span class="k">do</span> it fast

$ raku <span class="k">do</span>-nothing.pl --how<span class="o">=</span>well
Do nothing, but <span class="k">do</span> it well

$ raku <span class="k">do</span>-nothing.pl what?
Usage:
<span class="k">do</span>-nothing.pl <span class="o">[</span>--how<span class="o">=</span>value-of-how<span class="o">]</span>
</code></pre></div><p>æ€»ä¹‹ï¼ŒRaku æä¾›äº†å†…ç½®çš„å‘½ä»¤è¡Œè§£æåŠŸèƒ½å’Œä½¿ç”¨å¸®åŠ©è¯´æ˜ï¼Œä½ åªè¦å£°æ˜å¥½å‡½æ•°å°±è¡Œäº†ã€‚</p>
<h2 id="æ–‡ä»¶æ“ä½œ">æ–‡ä»¶æ“ä½œ</h2>
<ul>
<li>ç›®å½•</li>
</ul>
<p>ä¸å†ç”¨ <code>opendir</code> å’Œå…¶ä»–ç¥é©¬æ»´ï¼ŒRaku ä¸­æœ‰ä¸“é—¨çš„ <code>dir</code> å‡½æ•°ï¼Œç”¨æ¥åˆ—å‡ºæŒ‡å®šç›®å½•ï¼ˆé»˜è®¤æ˜¯å½“å‰æ‰€åœ¨ç›®å½•ï¼‰ä¸‹æ‰€æœ‰çš„æ–‡ä»¶ã€‚å¥½äº†ï¼Œç›´æ¥è´´ä»£ç ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">dir</span>
<span class="nb">dir</span> <span class="p">&#39;</span><span class="s1">t</span><span class="p">&#39;</span> <span class="c1"># t ç›®å½•ä¸‹çš„æ–‡ä»¶</span>
</code></pre></div><p><code>dir</code> è¿˜æœ‰ä¸€ä¸ªå¯é€‰çš„å‘½åå‚æ•° <code>test</code>ï¼Œç”¨æ¥ <code>grep</code> ç»“æœï¼Œè¿™æ ·ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">dir</span> <span class="p">&#39;</span><span class="s1">src/core</span><span class="p">&#39;</span><span class="o">,</span> <span class="s">test</span> <span class="o">=&gt;</span> <span class="nb">any</span><span class="p">(/</span><span class="ni">^</span><span class="sr">C</span><span class="p">/</span>, <span class="p">/</span><span class="ni">^</span><span class="sr">P</span><span class="p">/)</span>
</code></pre></div><p>åˆ›å»ºç›®å½•ï¼Œè¿˜æ˜¯ <code>mkdir</code> å‡½æ•°æ²¡é”™å•¦ã€‚</p>
<ul>
<li>æ–‡ä»¶</li>
</ul>
<p>æœ€ç®€å•çš„è¯»å–æ–‡ä»¶çš„åŠæ³•ï¼Œæ˜¯ç›´æ¥ä½¿ç”¨ <code>slurp</code> å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä»¥æ ‡é‡å½¢å¼è¿”å›æ–‡ä»¶çš„å†…å®¹ï¼Œè¿™æ ·ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">slurp</span> <span class="p">&#39;</span><span class="s1">VERSION</span><span class="p">&#39;</span>
</code></pre></div><p>å½“ç„¶åŸå§‹çš„æ–‡ä»¶å¥æŸ„æ–¹å¼è¿˜æ˜¯æœ‰æ•ˆçš„ï¼Œè¿™æ ·ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$fh</span> <span class="o">=</span> <span class="nb">open</span> <span class="p">&#39;</span><span class="s1">CREDITS</span><span class="p">&#39;</span>
<span class="nv">$fh</span><span class="o">.</span><span class="nb">getc</span> <span class="c1">#è¯»å–ä¸€ä¸ªå­—ç¬¦</span>
<span class="nv">$fh</span><span class="o">.</span><span class="nb">get</span>  <span class="c1">#è¯»å–ä¸€è¡Œï¼ˆè¯‘è€…æ³¨ï¼šè¿™ä¸¤çœ‹èµ·æ¥å¥½æœ‰ C è¯­è¨€çš„èµ¶è„šå•Šï¼‰</span>
<span class="nv">$fh</span><span class="o">.</span><span class="nb">close</span><span class="p">;</span>

<span class="nv">$fh</span> <span class="o">=</span> <span class="nb">open</span> <span class="p">&#39;</span><span class="s1">new</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">:</span><span class="s">w</span>  <span class="c1"># ä»¥å¯å†™æ–¹å¼æ‰“å¼€</span>
<span class="nv">$fh</span><span class="o">.</span><span class="nb">print</span><span class="p">(&#39;</span><span class="s1">foo</span><span class="p">&#39;)</span>
<span class="nv">$fh</span><span class="o">.</span><span class="nb">say</span><span class="p">(&#39;</span><span class="s1">bar</span><span class="p">&#39;)</span>
<span class="nv">$fh</span><span class="o">.</span><span class="nb">close</span><span class="p">;</span>
<span class="nb">say</span> <span class="nb">slurp</span><span class="p">(&#39;</span><span class="s1">new</span><span class="p">&#39;)</span>
</code></pre></div><ul>
<li>æ–‡ä»¶æµ‹è¯•</li>
</ul>
<p>å¦‚æœè¦æµ‹è¯•æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä»¥åŠæ–‡ä»¶çš„å…·ä½“ç±»å‹ï¼Œç›´æ¥ä½¿ç”¨ <code>~~</code> æ“ä½œç¬¦å°±æå®šäº†ï¼Œè¿˜æ˜¯ç”¨ä»£ç è¯´è¯ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">&#39;</span><span class="s1">LICENSE</span><span class="p">&#39;</span><span class="o">.</span><span class="nb">IO</span> <span class="o">~~</span> <span class="p">:</span><span class="s">e</span>     <span class="c1"># æ–‡ä»¶(å¹¿ä¹‰çš„)æ˜¯å¦å­˜åœ¨</span>
<span class="p">&#39;</span><span class="s1">LICENSE</span><span class="p">&#39;</span><span class="o">.</span><span class="nb">IO</span> <span class="o">~~</span> <span class="p">:</span><span class="s">d</span>     <span class="c1"># é‚£ä¹ˆä»–æ˜¯ç›®å½•ä¹ˆï¼Ÿ</span>
<span class="p">&#39;</span><span class="s1">LICENSE</span><span class="p">&#39;</span><span class="o">.</span><span class="nb">IO</span> <span class="o">~~</span> <span class="p">:</span><span class="s">f</span>     <span class="c1"># é‚£ä¹ˆæ˜¯æ–‡ä»¶ä¹ˆ(ç‹­ä¹‰çš„)ï¼Ÿ</span>
</code></pre></div><ul>
<li>File::Find</li>
</ul>
<p>å¦‚æœè¿™äº›ä¸ªæ ‡å‡†ç‰¹æ€§è¿˜ä¸å¤Ÿï¼Œé‚£æ¨¡å—å°±æ´¾ä¸Šç”¨åœºäº†ã€‚<code>File::Tools</code> åŒ…é‡Œçš„ <code>File::Find</code> æ¨¡å—å¯ä»¥é€’å½’ä½ æŒ‡å®šçš„ç›®å½•æ‰¾ä½ è¦çš„ä¸œè¥¿ç„¶ååˆ—å‡ºæ¥ã€‚è¿™ä¸ªæ¨¡å—åº”è¯¥æ˜¯è·Ÿç€ Rakudo Star ä¸€èµ·æ‰“åŒ…äº†ï¼Œå¦‚æœä½ åªè£¸è£…äº† Rakudoï¼Œé‚£ä¹ˆç”¨ neutro å‘½ä»¤å®‰è£…ä¹Ÿæ˜¯æŒºæ–¹ä¾¿çš„ã€‚</p>
<p>é¢ï¼Œè¿˜æ˜¯è¦ä¾‹å­ï¼Ÿå¥½å§~å¾ˆç®€å•çš„ä¸€è¡Œ <code>find(:dir, :type, :name(/foo/))</code>ï¼Œè¿™å°±ä¼šåœ¨ <code>t/dir1</code> ç›®å½•ä¸‹ï¼Œå¯»æ‰¾åå­—åŒ¹é… foo çš„æ–‡ä»¶ï¼Œç„¶åä»¥æ ‘çš„å½¢å¼åˆ—å‡ºæ¥~ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼šè¿™å‘½ä»¤çš„è¿”å›å¯ä¸æ˜¯æ–‡æœ¬æ ‡é‡ï¼Œè€Œæ˜¯ä¸€ä¸ªä¸ªåŒ…æ‹¬ä»–ä»¬çš„å®Œæ•´è·¯å¾„åœ¨å†…çš„å¯¹è±¡ï¼Œè€Œä¸”è¿˜æä¾›æ–‡ä»¶æœ¬èº«ä»¥åŠæ–‡ä»¶æ‰€åœ¨ç›®å½•çš„è®¿é—®å™¨ï¼æ›´å¤šä¿¡æ¯ï¼Œç›´æ¥çœ‹æ–‡æ¡£å§ã€‚</p>
<p>1ã€åˆ›å»ºæ–°æ–‡ä»¶</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">open</span><span class="p">(&#39;</span><span class="s1">new</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">:</span><span class="s">w</span><span class="p">)</span><span class="o">.</span><span class="nb">close</span>
</code></pre></div><p>2ã€åŒ¿åæ–‡ä»¶å¥æŸ„</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">given</span> <span class="nb">open</span><span class="p">(&#39;</span><span class="s1">foo</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">:</span><span class="s">w</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">.</span><span class="nb">say</span><span class="p">(&#39;</span><span class="s1">Hello, world!</span><span class="p">&#39;);</span>
    <span class="o">.</span><span class="nb">close</span>
<span class="p">}</span>
</code></pre></div><h2 id="ç¬¬å››å¤©--åºåˆ—æ“ä½œç¬¦">ç¬¬å››å¤© â€“ åºåˆ—æ“ä½œç¬¦</h2>
<p>å»å¹´ï¼Œæœ‰ä¸€ä¸ªåºåˆ—æ“ä½œç¬¦çš„ç®€è¦æ¢³ç†ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@even-numbers</span>  <span class="o">:=</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">2</span> <span class="o">...</span> <span class="o">*</span><span class="p">;</span>    <span class="c1"># ç®—æœ¯åºåˆ—</span>
<span class="k">my</span> <span class="nv">@odd-numbers</span>   <span class="o">:=</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">3</span> <span class="o">...</span> <span class="o">*</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">@powers-of-two</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">4</span> <span class="o">...</span> <span class="o">*</span><span class="p">;</span> <span class="c1"># å‡ ä½•åºåˆ—</span>
</code></pre></div><p>è¿™äº›ç°åœ¨åœ¨ Rakudo é‡Œé¢å®ç°äº†ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@powers-of-two</span> <span class="o">:=</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">4</span> <span class="o">...</span> <span class="o">*</span><span class="p">;</span>
<span class="nv">@powers-of-two</span><span class="o">[^</span><span class="mi">10</span><span class="o">]</span><span class="p">;</span>
<span class="c1"># 1 2 4 8 16 32 64 128 256 512</span>
</code></pre></div><p>æˆ‘ä»¬éœ€è¦å‰Šå‡è¿™ä¸ªæ— é™åˆ—è¡¨è®© Rakudo ä¸ä¼šèŠ±è´¹æ— é™é•¿çš„æ—¶é—´æ¥è®¡ç®—å®ƒã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä½¿ç”¨ <code>[^10]</code>, è¿™å…¶å®æ˜¯è¯´ &ldquo;ç»™æˆ‘å‰ 10 ä¸ªå…ƒç´ &rdquo;ã€‚æ³¨æ„ï¼Œå½“ä½ æŠŠä¸€ä¸ªæƒ°æ€§åˆ—è¡¨ç»‘å®šåˆ°ä¸€ä¸ªæ•°ç»„å˜é‡ä¸Šæ—¶ï¼Œè¢«è®¡ç®—è¿‡çš„å€¼æ˜¯ä¼šè¢«è®°å¿†çš„ï¼Œè¿™æ˜¯ä¸€ç§å¿«æ·çš„ç¼“å­˜ã€‚</p>
<p>åºåˆ—æ“ä½œç¬¦ <code>...</code> æ˜¯ä¸€ä¸ªç”Ÿæˆæƒ°æ€§åˆ—è¡¨çš„å¼ºå¤§å·¥å…·ã€‚ä¸Šé¢çš„ä¾‹å­ä»…ä»…æš—ç¤ºäº†å®ƒèƒ½åšä»€ä¹ˆã€‚ç»™å®šä¸€ä¸ªæ•°å­—ï¼Œå®ƒå°±ä»è¿™ä¸ªæ•°å­—å¼€å§‹å¾€ä¸‹è®¡æ•°ï¼ˆé™¤éåºåˆ—çš„ç»ˆç‚¹æ˜¯ä¸€ä¸ªæ›´å°çš„æ•°å­—ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä¼šå€’æ•°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="mi">1</span> <span class="o">...</span> <span class="mi">10</span><span class="p">;</span> <span class="c1"># 1 2 3 4 5 6 7 8 9 10</span>
<span class="mi">5</span> <span class="o">...</span> <span class="mi">1</span><span class="p">;</span>  <span class="c1"># 5 4 3 2 1</span>
</code></pre></div><p>ç»™å®šä¸¤ä¸ªæ•°å­—æ¥å¼€å§‹ä¸€ä¸ªåºåˆ—ï¼Œå®ƒä¼šæŠŠè¿™å½“ä½œä¸€ä¸ªç®—æœ¯åºåˆ—ï¼ŒæŠŠå‰ä¸¤ä¸ªå…ƒç´ çš„å·®å¼‚æ·»åŠ åˆ°æœ€åä¸€ä¸ªç”Ÿæˆçš„å…ƒç´ ä¸Šæ¥äº§ç”Ÿä¸‹ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœç»™å®šä¸‰ä¸ªå…ƒç´ ï¼Œå®ƒä¼šæ£€æŸ¥å®ƒä»¬æ˜¯å¦ä»£è¡¨ä¸€ä¸ªç®—æœ¯åºåˆ—çš„å¼€å§‹æˆ–è€…å®ƒæ˜¯å¦æ˜¯ä¸€ä¸ªå‡ ä½•åºåˆ—ï¼Œç„¶åç»§ç»­è¿™ä¸ªåºåˆ—ã€‚</p>
<p>å½“ç„¶ï¼Œå¾ˆå¤šæœ‰è¶£çš„åºåˆ—æ—¢éç®—æœ¯åºåˆ—ä¹Ÿéå‡ ä½•åºåˆ—ï¼Œè¿™æ—¶ï¼Œä½ éœ€è¦æ˜¾å¼åœ°æä¾›ä¸€ä¸ª sub æ¥ç”Ÿæˆåºåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªæ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@Fibonacci</span> <span class="o">:=</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="k">-&gt;</span> <span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span> <span class="p">{</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span> <span class="p">}</span> <span class="o">...</span> <span class="o">*</span><span class="p">;</span>
<span class="nv">@Fibonacci</span><span class="o">[^</span><span class="mi">10</span><span class="o">]</span><span class="p">;</span> <span class="c1"># 0 1 1 2 3 5 8 13 21 34</span>
</code></pre></div><p>ä¸Šé¢çš„ <code>-&gt; $a, $b { $a + $b }</code> æ˜¯ä¸€ä¸ª pointy block (æˆ–è€…æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°)ï¼Œå®ƒå¸¦æœ‰ 2 ä¸ªå‚æ•°å¹¶è¿”å›å®ƒä»¬çš„å’Œã€‚è¿™ä¸ªåºåˆ—æ“ä½œç¬¦è®¡ç®—å‡ºè¯¥ block æœ‰å¤šå°‘ä¸ªå‚æ•°ï¼Œç„¶åä»å½“å‰åºåˆ—çš„æœ«å°¾ä¼ é€’æ‰€éœ€çš„å‚æ•°æ¥ç”Ÿæˆåºåˆ—çš„ä¸‹ä¸€ä¸ªæ•°å­—ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå¾ªç¯ä¸‹å»ã€‚</p>
<p>æˆ–è€…ä¹Ÿå¯ä»¥ä¸­æ–­å¾ªç¯ï¼Œç›®å‰ä¸ºæ­¢ï¼Œæ‰€æœ‰çš„ä¾‹å­éƒ½æœ‰ä¸€ä¸ªæ˜Ÿå· <code>*</code> æ”¾åœ¨å³è¾¹ï¼Œå®ƒæ„å‘³ç€â€œæ²¡æœ‰ç»ˆæ­¢æ¡ä»¶â€ã€‚å¦‚æœä½ åè€Œåœ¨é‚£é‡Œæ”¾ä¸Šä¸€ä¸ªæ•°å­—ï¼Œè¿™ä¸ªåˆ—è¡¨å°±ä¼šç»ˆæ­¢åœ¨é‚£ä¸ªæ•°å­—ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="mi">1</span><span class="o">,</span> <span class="mf">1.1</span> <span class="o">...</span> <span class="mi">2</span><span class="p">;</span>          <span class="c1"># 1 1.1 1.2 1.3 1.4 1.5 1.6 1.7 1.8 1.9 2</span>
<span class="mi">1</span><span class="o">,</span> <span class="mf">1.1</span> <span class="o">...</span> <span class="mf">2.01</span><span class="p">;</span>       <span class="c1"># 1 1.1 1.2 1.3 1.4 1.5 1.6 1.7 1.8 1.9 2</span>
<span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mf">1.1</span> <span class="o">...</span> <span class="mf">2.01</span><span class="p">)</span><span class="o">[^</span><span class="mi">14</span><span class="o">]</span> <span class="c1"># (1 1.1 1.2 1.3 1.4 1.5 1.6 1.7 1.8 1.9 2 Nil Nil Nil)</span>
</code></pre></div><p>ç¬¬ä¸€ä¸ªåˆ—è¡¨å¾ˆè‡ªç„¶åœ°ç»ˆæ­¢äº†ï¼Œä½†æ˜¯ç¬¬äºŒä¸ªåˆ—è¡¨æ¼æ‰äº†ç»ˆæ­¢æ•°ï¼Œå®ƒä¼šå¾ªç¯ä¸‹å»ã€‚ç»“æœå°±æ˜¯ä¸€ä¸ªæ— é™åˆ—è¡¨ï¼Œæ‰€ä»¥æˆ‘æŠŠå®ƒé™åˆ¶åˆ°å‰ 14 ä¸ªå…ƒç´ ï¼Œä»¥è‡³äºæˆ‘ä»¬èƒ½æ˜ç™½å®ƒæ­£åœ¨åšä»€ä¹ˆã€‚</p>
<p>é‚£äº›æœ‰åšæµ®ç‚¹æ•°å­¦èƒŒæ™¯çš„äººå¯èƒ½ä¼šæ°”æ€¥è´¥ååœ°è¯´åå¤å¢åŠ  0.1 ç›´åˆ°ç²¾ç¡®åˆ° 2 ä¸ºæ­¢å¾ˆå±é™©ã€‚</p>
<p>åœ¨ Raku ä¸­ï¼Œæ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºå®ƒä¼šåœ¨å¯èƒ½çš„åœ°æ–¹ä½¿ç”¨æœ‰ç†æ•°ï¼ˆä¾‹å¦‚.åˆ†æ•°)ã€‚å¦‚æœæˆ‘æƒ³æ‰¾å‡ºæ‰€æœ‰ 10000 ä»¥ä¸‹çš„æ–æ³¢çº³å¥‘æ•°ï¼Œè¦æ‰¾åˆ°åˆ°ä½•å¤„åœæ­¢çš„é‚£ä¸ªç²¾ç¡®çš„æ•°å­—æ˜¯å¾ˆå¤§çš„é—®é¢˜ã€‚å¹¸è¿çš„æ˜¯ï¼Œå°±åƒä½ èƒ½ä½¿ç”¨å—æ¥æŒ‡å®šæ€æ ·ç”Ÿæˆåºåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ä¸€æ ·ï¼Œä½ å¯ä»¥ä½¿ç”¨å—æ¥æµ‹è¯•åºåˆ—æ˜¯å¦ç»“æŸï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="k">-&gt;</span> <span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span> <span class="p">{</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span> <span class="p">}</span> <span class="o">...</span> <span class="k">-&gt;</span> <span class="nv">$a</span> <span class="p">{</span> <span class="nv">$a</span> <span class="o">&gt;</span> <span class="mi">10000</span> <span class="p">};</span>
<span class="c1"># 0 1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 1597 2584 4181 6765 10946</span>
</code></pre></div><p>å°–å¤´å— <code>-&gt; $a { $a &gt; 10000 }</code> åˆ›å»ºäº†ä¸€ä¸ªå«æœ‰ä¸€ä¸ªå‚æ•°çš„å—ï¼Œå¹¶ä¸”å½“å‚æ•°å¤§äº 10000 æ—¶è¿”å›çœŸï¼›è¿™å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„æµ‹è¯•ã€‚</p>
<p>é™¤äº†æˆ‘ä»¬æ‰€æœŸå¾…çš„æ‰€æœ‰æ–æ³¢é‚£å¥‘æ•°å°äº 10000ã€‚ æˆ‘ä»¬ç”Ÿæˆçš„è£´æ³¢çº³å¥‘æ•°æœ‰ä¸€ä¸ªå¤§äº 10000 çš„ï¼Œå½“ä¼ é€’ä¸€ä¸ªå—ä½œä¸ºç»ˆæ­¢æµ‹è¯•æ—¶ï¼Œè¯¥åºåˆ—æ“ä½œç¬¦æ‰€æœ‰çš„å…ƒç´ ç›´åˆ°é‚£ä¸ªå—è¿”å›çœŸä¸ºæ­¢ï¼Œç„¶åå®ƒè¿”å›æœ€åä¸€ä¸ªå…ƒç´ ï¼Œç„¶ååœæ­¢ã€‚ä½†æ˜¯æœ‰ä¸€ç§æ›¿ä»£å½¢å¼çš„æ“ä½œç¬¦èƒ½åšåŒæ ·çš„äº‹æƒ…ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="k">-&gt;</span> <span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span> <span class="p">{</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span> <span class="p">}</span> <span class="o">...^</span> <span class="k">-&gt;</span> <span class="nv">$a</span> <span class="p">{</span> <span class="nv">$a</span> <span class="o">&gt;</span> <span class="mi">10000</span> <span class="p">};</span>
<span class="c1"># 0 1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 1597 2584 4181 6765</span>
</code></pre></div><p>ä» <code>...</code> è½¬æ¢ä¸º <code>...^</code> æ„å‘³ç€ç»“æœåˆ—è¡¨ä¸åŒ…å«è®©ç»ˆæ­¢æµ‹è¯•è¿”å›çœŸæ—¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚</p>
<p>åœ¨ Raku ä¸­è¿™çœŸæ˜¯ä¸€ç§å†—é•¿çš„æŒ‡å®šåºåˆ—çš„æ–¹æ³•ã€‚åœ¨è¿™é‡Œæˆ‘æ²¡æœ‰åœ°æ–¹è§£é‡Šæ‰€è°“çš„é—­åŒ…ï¼Œä½†æ˜¯å»å¹´çš„æ–‡ç« å·²ç»è¯´è¿‡å®ƒä»¬ã€‚ä½¿ç”¨é—­åŒ…ï¼Œä½ å¯ä»¥å°†ä¸Šä¸€ä¸ªåºåˆ—å†™ä¸ºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="o">*</span> <span class="o">+</span> <span class="o">*</span> <span class="o">...^</span> <span class="o">*</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">;</span>
<span class="c1"># 0 1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 1597 2584 4181 6765</span>
</code></pre></div><p>è¿™æ ·å†™æ˜¯å¦æ¸…æ™°å®Œå…¨å–å†³äºä½ ï¼Œæ¡æ¡å¤§è·¯é€šç½—é©¬ã€‚å¹¶ä¸”ï¼Œåºåˆ—æ“ä½œç¬¦çš„å·¦ä¾§å¯ä»¥æ˜¯ä»»ä½•åˆ—è¡¨ï¼Œç”šè‡³æ˜¯æƒ°æ€§çš„ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥å¾ˆå®¹æ˜“çš„ä½¿ç”¨ä¸€ä¸ªç»ˆæ­¢å—æ¥å¾—åˆ°å·²å­˜åœ¨çš„æƒ°æ€§åˆ—è¡¨çš„æœ‰é™çš„ä¸€éƒ¨åˆ†ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@Fibonacci</span> <span class="o">:=</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="o">*</span> <span class="o">+</span> <span class="o">*</span> <span class="o">...</span> <span class="o">*</span><span class="p">;</span>
<span class="nv">@Fibonacci</span> <span class="o">...^</span> <span class="o">*</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">;</span>
<span class="c1"># 0 1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 1597 2584 4181 6765</span>
<span class="nb">say</span> <span class="nv">@Fibonacci</span><span class="o">[</span><span class="mi">30</span><span class="o">]</span><span class="p">;</span> <span class="c1"># 832040</span>
</code></pre></div><p>(æˆ‘åšæŒæœ€åçš„æ£€æŸ¥åªæ˜¯ä¸ºäº†è¯´æ˜ <code>@Fibonacci</code> åœ¨è¶…è¿‡ 10000 ä¹‹åä¾ç„¶ä¼šç»§ç»­ã€‚</p>
<p>è¿™æ‰è§¦åŠåˆ°åºåˆ—èƒ½åšä»€ä¹ˆçš„çš®æ¯›ï¼Œæ›´å¤šçš„ä¿¡æ¯ï¼ŒæŸ¥çœ‹ç»†åˆ™ä¸­çš„ â€œList infix precedenceâ€ï¼Œç„¶åä¸‹æ‹‰åˆ°åºåˆ—æ“ä½œç¬¦ï¼ˆå°½ç®¡å¦‚æ­¤ï¼Œæ³¨æ„è¿™è¿˜æ²¡æœ‰å…¨éƒ¨å®ç°ï¼å®ƒæ˜¯ä¸€ä¸ªæå…¶å¤æ‚çš„æ“ä½œç¬¦ã€‚ï¼‰</p>
<p>æˆ‘è¿˜è¦å‘Šè¯‰ä½ çš„æ˜¯ï¼Œåºåˆ—æ“ä½œç¬¦ä¸å±€é™äºå·¥ä½œäºæ•°å­—ï¼Œå¦‚æœä½ æ˜¾å¼åœ°æŒ‡å®šäº†ä½ è‡ªå·±çš„ç”Ÿæˆå™¨ï¼Œä½ å¯ä»¥ç”Ÿæˆä»»ä½•ç±»å‹çš„åºåˆ—ã€‚ä½†æ˜¯æˆ‘å–œæ¬¢å°†è¿™ä¿ç•™åˆ°æœªæ¥çš„åœ£è¯èŠ‚ç¤¼ç‰©ã€‚</p>
<h2 id="ç¬¬äº”å¤©--ä¸ºä»€ä¹ˆ-raku-è¯­æ³•æ˜¯ä½ æƒ³è¦çš„">ç¬¬äº”å¤© â€“ ä¸ºä»€ä¹ˆ Raku è¯­æ³•æ˜¯ä½ æƒ³è¦çš„</h2>
<p>åœ£ä¸´æœˆç¬¬äº”å¤©ï¼Œæ‚¨æˆ–è®¸æœ‰äº›å¤±æœ›æ²¡èƒ½çœ‹åˆ° Raku é…·å‘†äº†çš„æ–°ç©æ³•ã€‚è¿™æ¬¡ä¼šæ˜¯ç›´è§‚çš„è§£é‡Šä¸€äº›ç¼–ç¨‹è¯­è¨€çš„è¿è¡ŒåŸç†ã€‚
ä½œä¸ºæ ·ä¾‹ï¼Œå…ˆè¯´ä¸‹é¢è¿™ä¸¤è¡Œå§ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">3</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">Price: 15 Euro</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="p">/</span><span class="se">\d</span><span class="o">+</span><span class="p">/;</span>
</code></pre></div><p>å—¯ï¼Œä¸¤è¡Œä»£ç çš„è¿è¡Œç»“æœåˆ†åˆ«æ˜¯ 2 å’Œ 15ã€‚ç›¸ä¿¡è¿™å¯¹ Raku ç¨‹åºå‘˜æ¥è¯´æ²¡ä»€ä¹ˆå¯å¥‡æ€ªçš„ã€‚ä½†ä½ å†ç»†çœ‹çœ‹ï¼Œä¸¤è¡Œéƒ½æœ‰æ–œæ  <code>/</code>ï¼Œå´ä¸ºäº†å®Œå…¨ä¸ä¸€æ ·çš„ç›®çš„ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ•°å€¼è¿ç®—ï¼Œç¬¬äºŒ ä¸ªæ˜¯æ­£åˆ™åŒ¹é…ã€‚</p>
<p>Raku æ€ä¹ˆçŸ¥é“ä¸€ä¸ª <code>/</code> å·æ„å‘³ç€ä»€ä¹ˆï¼Ÿè¿™å½“ç„¶ä¸æ˜¯ç®€å•çš„çœ‹ <code>/</code> å·åé¢çš„æ–‡æœ¬æ¥å†³å®šï¼Œå› ä¸ºæ­£åˆ™è¡¨è¾¾å¼å¯ä»¥çœ‹èµ·æ¥è·Ÿæ™®é€šä»£ç ä¸€æ ·ã€‚
ç­”æ¡ˆæ˜¯ï¼šRaku ä¼šæŒç»­è·Ÿè¸ªä»–çš„é¢„æœŸã€‚Raku é¢„æœŸä¸­æœ€é‡è¦çš„ä¸¤æ ·ä¸œè¥¿å°±æ˜¯ï¼šè¯å’Œæ“ä½œç¬¦ã€‚</p>
<p>ä¸€ä¸ªè¯å¯ä»¥æ˜¯åƒ 23 æˆ–è€… str è¿™æ ·çš„æ–‡å­—ã€‚å½“è§£é‡Šå™¨å‘ç°è¿™æ ·ä¸€ä¸ªæ–‡å­—ï¼Œç„¶ååé¢å°±ä¼šæ˜¯ä¸€ä¸ªè¯­å¥çš„ç»“æŸï¼ˆå³åˆ†å·;ï¼‰ï¼Œæˆ–è€…ä¸€ä¸ªæ“ä½œç¬¦åƒ <code>+/*</code> ç­‰ç­‰ã€‚è¿‡äº†è¿™ä¸ªæ“ä½œç¬¦ï¼Œè§£ é‡Šå™¨åˆå¼€å§‹é¢„æœŸä¸‹ä¸€ä¸ªè¯ã€‚</p>
<p>å…¶å®è¿™å°±æ˜¯é—®é¢˜çš„ç­”æ¡ˆäº†ï¼šå½“è§£é‡Šå™¨é¢„æœŸä¸ºè¯çš„æ—¶å€™ï¼Œæ–œçº¿ / å°±ä»£è¡¨æ­£åˆ™è¡¨è¾¾å¼çš„å¼€å§‹ï¼›å½“é¢„æœŸä¸ºæ“ä½œç¬¦çš„æ—¶å€™ï¼Œæ–œçº¿ / å°±ä»£è¡¨æ•°å­—çš„é™¤æ³•è¿ç®—ã€‚</p>
<p>è¿™ç§åšæ³•é€ æˆäº†æ·±è¿œçš„åæœã€‚å­å‡½æ•°è¿è¡Œå¯ä»¥ä¸åŠ æ‹¬å·ï¼Œè€Œåœ¨å‡½æ•°ååé¢ï¼Œperl é¢„æœŸä¸€ä¸ªè¯å¼€ç«¯çš„å‚æ•°åˆ—è¡¨ã€‚å¦ä¸€æ–¹é¢ï¼Œç±»å‹åå¿…é¡»è·Ÿåœ¨æ“ä½œç¬¦åé¢ï¼Œæ‰€ä»¥ï¼Œæ‰€æœ‰çš„ç±»å‹åå¿… é¡»åœ¨è§£ææ—¶å°±æ˜¯å·²çŸ¥çš„ã€‚</p>
<p>è¿™æ ·ï¼Œå¾ˆå¤šå­—ç¬¦éƒ½å¯ä»¥é‡å¤ä½¿ç”¨åœ¨ä¸åŒçš„è¯­æ³•ç¯å¢ƒä¸‹äº†ã€‚</p>
<h2 id="ç¬¬å…­å¤©--x-å’Œ-z-å…ƒæ“ä½œç¬¦">ç¬¬å…­å¤© â€“ X å’Œ Z å…ƒæ“ä½œç¬¦</h2>
<p>Raku ä¸­ä¸€ä¸ªæ–°çš„åˆ›æ„å°±æ˜¯å…ƒæ“ä½œç¬¦ï¼Œè¿™ç§å…ƒæ“ä½œç¬¦å’Œæ™®é€šçš„æ“ä½œç¬¦ç»“åˆæ”¹å˜äº†æ™®é€šæ“ä½œç¬¦çš„è¡Œä¸ºã€‚è¿™ç§å…ƒæ“ä½œç¬¦æœ‰å¾ˆå¤šï¼Œä½†è¿™é‡Œæˆ‘ä»¬åªå…³æ³¨å®ƒä»¬ä¸­çš„ä¸¤ä¸ª: <code>X</code> å’Œ <code>Z</code>ã€‚</p>
<p><code>X</code> æ“ä½œç¬¦ä½ å¯èƒ½å·²ç»è§è¿‡å®ƒä½œä¸ºä¸­ç¼€äº¤å‰æ“ä½œç¬¦çš„æ™®é€šè§’è‰²ã€‚å®ƒå°†åˆ—è¡¨è”åˆåœ¨ä¸€èµ·ï¼Œæ¯ä¸ªåˆ—è¡¨ä¸­å„å–ä¸€ä¸ªå…ƒç´ ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">X</span> <span class="p">(&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">b</span><span class="p">&#39;))</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>
<span class="c1">#  ((1, &#34;a&#34;), (1, &#34;b&#34;), (2, &#34;a&#34;), (2, &#34;b&#34;))</span>
</code></pre></div><p>ç„¶è€Œ, è¿™ä¸ªä¸­ç¼€æ“ä½œç¬¦ <code>infix:&lt;X&gt;</code> å…¶å®æ˜¯å°† <code>X</code> æ“ä½œç¬¦åº”ç”¨åˆ°åˆ—è¡¨è¿æ¥æ“ä½œç¬¦ <code>infix:&lt;,&gt;</code> ä¸Šçš„ç®€ä¾¿å½¢å¼ã€‚äº‹å®ä¸Šï¼Œä½ å¯ä»¥è¿™æ ·å†™ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">X</span><span class="o">,</span> <span class="p">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">11</span><span class="p">))</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>
<span class="c1"># ((1, 10), (1, 11), (2, 10), (2, 11))</span>
</code></pre></div><p>å¦‚æœä½ å°† <code>X</code> åº”ç”¨åˆ°ä¸åŒçš„ä¸­ç¼€æ“ä½œç¬¦ä¸Šé¢ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿåº”ç”¨åˆ° <code>infix:&lt;+&gt;</code> ä¸Šå‘¢ï¼Ÿ</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">X</span><span class="o">+</span> <span class="p">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">11</span><span class="p">))</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>
<span class="c1"># (11, 12, 12, 13).list</span>
</code></pre></div><p>å®ƒåšäº†ä»€ä¹ˆï¼Ÿå®ƒä¸æ˜¯ä»æ¯ä¸ªç»„åˆä¸­æŒ‘å‡ºæ‰€æœ‰çš„å…ƒç´ åˆ—è¡¨ï¼Œè¿™ä¸ªæ“ä½œç¬¦å°†ä¸­ç¼€æ“ä½œç¬¦ <code>+</code> åº”ç”¨åˆ°å…ƒç´ é—´ï¼Œå¹¶ä¸”ç»“æœä¸æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œè€Œæ˜¯ä¸€ä¸ªæ•°å­—ï¼Œæ˜¯é‚£ä¸ªç»„åˆä¸­æ‰€æœ‰å…ƒç´ çš„å’Œã€‚</p>
<p>è¿™å¯¹ä»»ä½•ä¸­ç¼€æ“ä½œç¬¦éƒ½æœ‰æ•ˆã€‚çœ‹çœ‹å­—ç¬¦ä¸²è¿æ¥ <code>infix:&lt; ~ &gt;</code>ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">X</span><span class="o">~</span> <span class="p">(</span><span class="mi">10</span><span class="o">,</span> <span class="mi">11</span><span class="p">))</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>
<span class="c1"># (&#34;110&#34;, &#34;111&#34;, &#34;210&#34;, &#34;211&#34;)</span>
</code></pre></div><p>æˆ–è€…ä¹Ÿè®¸æ•°å€¼ç›¸ç­‰æ“ä½œç¬¦ <code>infix:&lt;==&gt;</code></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">X</span><span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="nb">raku</span>
<span class="c1"># (Bool::True, Bool::True, Bool::False, Bool::False)</span>
</code></pre></div><p>ä½†æ˜¯è¿™ç¯‡æ–‡ç« ä¹Ÿæ˜¯å…³äº <code>Z</code> å…ƒæ“ä½œç¬¦çš„ã€‚æˆ‘ä»¬æœŸæœ›ä½ å·²ç»çŸ¥é“ä»–æ˜¯ä»€ä¹ˆäº†ã€‚å¦‚æœä½ é‡è§è¿‡ä¸­ç¼€æ“ä½œç¬¦ <code>Z</code>ï¼Œå®ƒå½“ç„¶æ˜¯ <code>Z,</code> çš„ä¾¿æ·å½¢å¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">Z</span><span class="o">,</span> <span class="p">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>
<span class="c1"># ((1, 3), (2, 4))</span>
<span class="nb">say</span> <span class="p">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">Z</span><span class="o">+</span> <span class="p">(</span><span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>
<span class="c1"># (4, 6).list</span>
<span class="nb">say</span> <span class="p">((</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">Z</span><span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>
<span class="c1"># (Bool::True, Bool::False)</span>
</code></pre></div><p><code>Z,</code> ç„¶å, ä¾æ¬¡æ“ä½œæ¯ä¸ªåˆ—è¡¨çš„æ¯ä¸ªå…ƒç´ ï¼ŒåŒæ—¶æ“ä½œæ¯ä¸ªåˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œç„¶ååŒæ—¶æ“ä½œç¬¬äºŒå¯¹å„¿ï¼Œç„¶åç¬¬ä¸‰å¯¹å„¿ï¼Œä¸ç®¡æœ‰å¤šå°‘ã€‚å½“åˆ°è¾¾åˆ—è¡¨çš„ç»“å°¾æ—¶åœæ­¢ã€‚</p>
<p><code>Z</code> ä¹Ÿæ˜¯æƒ°æ€§çš„,æ‰€ä»¥ä½ å¯ä»¥å°†å®ƒç”¨åœ¨ä¸¤ä¸ªæ— é™åˆ—è¡¨ä¸Šï¼Œå®ƒä¼šå°½å¯èƒ½å¤šåœ°ç”Ÿæˆä½ éœ€è¦çš„ç»“æœã€‚<code>X</code> åªèƒ½å¤„ç†å·¦è¾¹æ˜¯æ— é™åˆ—è¡¨çš„åˆ—è¡¨ï¼Œå¦åˆ™å®ƒä¸ä¼šè®¾æ³•å¾—åˆ°ä»»ä½•ä¸œè¥¿ã€‚</p>
<p>æœ‰ä¸€ä¸ªé”®å’Œå€¼å¾—åˆ—è¡¨ï¼Œä½ æƒ³å¾—åˆ°ä¸€ä¸ªæ•£åˆ—ï¼Ÿ å®¹æ˜“ï¼</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%hash</span> <span class="o">=</span> <span class="nv">@keys</span> <span class="ow">Z</span><span class="o">=&gt;</span> <span class="nv">@values</span><span class="p">;</span>
</code></pre></div><p>æˆ–è€…ï¼Œä¹Ÿè®¸ä½ æƒ³å¹¶è¡Œéå†ä¸¤ä¸ªåˆ—è¡¨ï¼Ÿ</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="nv">@a</span> <span class="ow">Z</span> <span class="nv">@b</span> <span class="k">-&gt;</span> <span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div><p>æˆ–è€…ä¸‰ä¸ª?</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="nv">@a</span> <span class="ow">Z</span> <span class="nv">@b</span> <span class="ow">Z</span> <span class="nv">@c</span> <span class="k">-&gt;</span> <span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="o">,</span> <span class="nv">$c</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div><p>æˆ–è€…ä½ èƒ½ä»æ‰”3æ¬¡æœ‰10ä¸ªé¢çš„éª°å­çš„æ‰€æœ‰æ•°å­—ç»„åˆä¸­ï¼Œå¾—åˆ°æ‰€æœ‰å¯èƒ½çš„æ€»æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@d10</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">...</span> <span class="mi">10</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">@scores</span> <span class="o">=</span> <span class="p">(</span><span class="nv">@d10</span> <span class="ow">X</span><span class="o">+</span> <span class="nv">@d10</span><span class="p">)</span> <span class="ow">X</span><span class="o">+</span> <span class="nv">@d10</span><span class="p">;</span>
</code></pre></div><p>å¦‚æœä½ æƒ³çœ‹åˆ°ä¸€äº›åœ¨çœŸå®ä¸–ç•Œè¿™äº›åŸæ“ä½œç¬¦çš„ç”¨é€”ï¼Œçœ‹çœ‹ Moritz Lenzâ€™s å†™çš„ Sudoku.pm æ•°ç‹¬è§£ç®—å™¨ã€‚</p>
<h2 id="ç¬¬ä¸ƒå¤©-è¯æ³•å˜é‡">ç¬¬ä¸ƒå¤© è¯æ³•å˜é‡</h2>
<p>ç¼–ç¨‹æ€»æ˜¯ä»¶å¾ˆéš¾æŒç»­åšä¸‹å»çš„äº‹æƒ…ã€‚ä¸²å‡ è¡Œä»£ç å¾ˆå®¹æ˜“ï¼Œæ ¹æ®æƒ³æ³•åšä¸€ä¸ªåŸå‹ä¹Ÿæ˜¯è½»æ¾æ„‰å¿«çš„ã€‚ä½†éšç€ç¨‹åºæ…¢æ…¢å˜å¤§ï¼Œç»´æŠ¤æ—¶é—´æ…¢æ…¢å˜é•¿ï¼Œäº‹æƒ…æ…¢æ…¢å°±æ£˜æ‰‹èµ·æ¥äº†â€¦â€¦æœ€åï¼Œå¦‚æœä¸å¹¸çš„è¯ï¼Œæˆ‘ä»¬å°±å¾—è¢«è¿«é‡æ„â€”â€”ä¸æ˜¯å› ä¸ºæ—©å…ˆçš„é—®é¢˜å¤æ‚ï¼Œè€Œæ˜¯å› ä¸ºç¨‹åºæœ¬èº«å¤æ‚äº†â€¦â€¦åœ¨ä¸æ–­çš„è°ƒè¯•ä¸­æ€¥ç™½äº†å¤´çš„ç¨‹åºå‘˜ä»¬ï¼Œæ—©å°±ä¸è®°å¾—åˆ°åº•è¦æ€ä¹ˆæ‰©å±•ç¨‹åºä»¥å®Œæˆç›®çš„äº†â€¦â€¦</p>
<p>æ‰€ä»¥æˆ‘ä»¬å›æº¯ä¸€ä¸‹ç¼–ç¨‹å²ï¼Œæ‰¾æ‰¾å¯¹ç€å¤æ‚æ€§çš„åŠæ³•ã€‚è€Œç­”æ¡ˆå°±åœ¨é‚£é‡Œï¼Œä¸æ¥ä¸å»â€”â€”<code>é™åˆ¶é•¿åº¦</code>ã€‚å½“ä½ æ¶æ„ä¸€ä¸ªæˆç™¾ä¸Šåƒæ¨¡å—ç»„æˆçš„å¤§å‹ç¨‹åºçš„æ—¶å€™ï¼Œä½ å¿…é¡»èƒ½å¤Ÿè®©è¿™äº›ç»„ä»¶é€šè¿‡è¡¨é¢ä¸Šå¾ˆå°çš„è®¾ç½®è¿›è¡Œäº¤äº’â€”â€”å¦åˆ™ä½ å°±ç­‰ç€è¢«ä¹±ä¸ƒå…«ç³Ÿçš„ç»„åˆå¹²æ­»å§ã€‚</p>
<p>åœ¨å„å±‚æ¬¡çš„ç¼–ç¨‹ä¸Šï¼Œæˆ‘ä»¬éƒ½å¯ä»¥çœ‹åˆ°è¿™ä¹ˆä¸€ä¸ªåŸåˆ™ã€‚å› ä¸ºä»–å°±åªå…³å¿ƒè¿™ä¸€ä»¶äº‹æƒ…ï¼šåˆ†æ•£æ³¨æ„ï¼Œä¸“ä¸€çš„åšä¸€ä»¶äº‹æƒ…ï¼BCNF èŒƒå¼ã€monads (è¯‘è€…æ³¨ï¼šä¸çŸ¥é“è¿™ä¸œä¸œå’‹ç¿»è¯‘)ã€å•å­ï¼Œä¾‹ç¨‹ï¼Œç±»ï¼Œè§’è‰²ï¼Œæ¨¡å—ï¼ŒåŒ…ç­‰ã€‚è¿™äº›éƒ½æ˜¯åœ¨ç£ä¿ƒå’ŒæŒ‡å¯¼æˆ‘ä»¬é™åˆ¶ç¼–ç¨‹çš„é•¿åº¦ã€‚è¿™æ ·æˆ‘ä»¬æ‰ä¸ä¼šè¾“åœ¨ç»„
åˆå­¦ä¸Šã€‚è€Œè¿™æ–¹é¢æœ€ç®€å•çš„ä¾‹å­ï¼Œå°±æ˜¯è¯æ³•å˜é‡ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">{</span>
    <span class="k">my</span> <span class="nv">$var</span><span class="p">;</span>
    <span class="c1"># $varå¯è§</span>
<span class="p">}</span>
<span class="c1"># $varä¸å¯è§</span>
</code></pre></div><p>å“ˆå“ˆï¼Œè¿™å°±æ˜¯ä»Šå¤©è¦ä»‹ç»çš„ä¸€ä¸ªéå¸¸é…·çš„åŠŸèƒ½äº†ï¼éå¸¸æœ‰è¶£çš„è¯´ã€‚</p>
<p>Perl ä»ç¬¬ä¸€ç‰ˆå¼€å§‹ï¼Œåœ¨è¿™æ–¹é¢ä¸€ç›´ä¸å¤ªå¯¹ã€‚æ¯”å¦‚ Perl5 çš„é»˜è®¤å˜é‡ä½œç”¨åŸŸæ˜¯åŒ…ã€‚è€Œè¿™å°±æ˜¯å…¨å±€å˜é‡çš„ä¸€ç§ã€‚æˆ‘åœ¨æŸä¸ªä»£ç å—é‡Œå®šä¹‰äº†ä¸€ä¸ªå˜é‡ï¼Œå…¶ä»–åœ°æ–¹å±…ç„¶ä¹Ÿèƒ½çœ‹åˆ°â€¦â€¦</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ perl -v
This is perl 5, version 12, subversion <span class="m">1</span> <span class="o">(</span>v5.12.1<span class="o">)</span>
$ perl -E <span class="s1">&#39;{ $var = 42 }; say $var&#39;</span>
<span class="m">42</span>
$ perl -wE <span class="s1">&#39;{ my $var= 42 }; say $var&#39;</span>
Name <span class="s2">&#34;main::var&#34;</span> used only once: possible typo at -e line 1.
Use of uninitialized value <span class="nv">$var</span> in say at -e line 1.
</code></pre></div><p>åœ¨ Raku é‡Œï¼Œè¯æ³•å˜é‡å˜æˆäº†é»˜è®¤è®¾ç½®ã€‚åœ¨ Rakudo ä¸Šè¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œæ ¹æœ¬æ— æ³•é€šè¿‡ç¼–è¯‘ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ raku -e <span class="s1">&#39;{ $var = 42 }; say $var&#39;</span>
<span class="o">===</span>SORRY!<span class="o">===</span>
Symbol <span class="s1">&#39;$var&#39;</span> not predeclared in &lt;anonymous&gt;
$ raku -e <span class="s1">&#39;{ my $var = 42 }; say $var&#39;</span>
<span class="o">===</span>SORRY!<span class="o">===</span>
Symbol <span class="s1">&#39;$var&#39;</span> not predeclared in &lt;anonymous&gt;
</code></pre></div><p>å¥½äº†ï¼Œä½ å¯èƒ½è¯´ï¼šâ€œå—¯ï¼Œå¯ä»¥å‡å°‘ç‚¹æ‰“é”™å­—çš„å¯èƒ½äº†â€ã€‚è¿™å½“ç„¶æ²¡é”™ï¼Œä½†æ˜¯æ›´é‡è¦çš„æ˜¯ï¼šè¿™è®©ä½ è®¤çœŸå¦è¯šçš„å¯¹å¾…<code>å˜é‡ä½œç”¨åŸŸ</code>ã€‚è¿™å¯¹ä½ æ§åˆ¶ä»£ç å¤æ‚æ€§å¾ˆæœ‰åˆ©ï¼</p>
<p>æˆ‘ä»¬å¯ä»¥è¯´å‡ºå¾ˆå¤šå¾ˆå¤šè§£é‡Šæ¥è¯´æ˜ä¸ºå•¥ Perl5 è¿™ä¹ˆåšã€‚æ¯”å¦‚ Perl5 å·²ç»å»ºè®®å¤§å®¶ <code>use warnings;</code> <code>use strict;</code> ï¼Œæ¯”å¦‚ Perl5 æ‰¿è¯ºçš„å‘åå…¼å®¹ï¼Œå—¯ï¼Œå¾ˆä¼Ÿå¤§çš„åšæ³•ï¼Œè€Œ Perl1 å‹æ ¹æ²¡æ‰“ç®—ç”¨æ¥å†™å¤§å‹ç¨‹åºå’Œç®¡ç†å¸¦æ¥çš„å¤æ‚æ€§ï¼›æ¯”å¦‚å…¨å±€å˜é‡åœ¨å•è¡Œæ¨¡å¼ä¸‹çš„å„ç§æ–¹ä¾¿â€¦â€¦</p>
<p>Raku å†…ç½®çš„å¼ºåˆ¶ä½ ä»å°å¤„ç€æ‰‹ï¼Œå¸®ä½ åœ¨ç³»ç»Ÿæ‰©å®¹çš„æ—¶å€™ï¼Œæ›´è‹›è´£çš„å…³æ³¨æ¶æ„åŸºç¡€ã€‚åœ¨å˜é‡æ–¹é¢ï¼Œä¹Ÿå°±æ˜¯åœ¨è„šæœ¬å’Œæ¨¡å—ä¸­ï¼Œå°†è¯æ³•å˜é‡ä½œä¸ºé»˜è®¤è®¾ç½®ã€‚ä¸è¿‡åœ¨ perl -e æ‰§è¡Œçš„å•è¡Œå‘½ä»¤ä¸­ï¼Œé»˜è®¤ä¾ç„¶æ˜¯å…¨å±€å˜é‡ã€‚ï¼ˆ Rakudo è¿˜æ²¡æœ‰å®ç°è¿™ä¸ªï¼Œç›®å‰å•è¡Œä¾ç„¶æ˜¯è¯æ³•å˜é‡ï¼ŒæœŸå¾…å®ç°çš„é‚£å¤©~ï¼‰</p>
<p>ç»§ç»­ã€‚å¥½åƒåˆ°è¿™é‡Œä½ æ„Ÿè§‰è¯æ³•å˜é‡çš„ä»·å€¼å·²ç»è¯´å®Œäº†ï¼Ÿæ²¡æœ‰ï¼æ­£ç¡®è®¾è®¡çš„ç»“æœå¯æ˜¯ä»¤äººæƒŠè®¶å’Œå¥–é‡‘æºæºä¸æ–­å•Š~è€ƒè™‘ä¸€ä¸‹è¿™ä¸ªå­ç¨‹åºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">counter</span><span class="p">(</span><span class="nv">$start_value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$count</span> <span class="o">=</span> <span class="nv">$start_value</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">{</span> <span class="nv">$count</span><span class="o">++</span> <span class="p">};</span>
<span class="p">}</span>
</code></pre></div><p>è¿™é‡Œè¿”å›çš„æ˜¯ä¸€ä¸ªä»£ç å—ã€‚æ‰€ä»¥æ¯æ¬¡æˆ‘ä»¬è°ƒç”¨ <code>counter()</code> çš„æ—¶å€™ï¼Œå¾—åˆ°çš„éƒ½æ˜¯ä¸€å°ç‰‡æ–­å¼€çš„ä»£ç ã€‚ç„¶åçœ‹çœ‹å½“æˆ‘åˆ›å»ºä¸¤ç‰‡è¿™æ ·çš„ä»£ç åçš„ç»“æœï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$c1</span> <span class="o">=</span> <span class="nf">counter</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="nb">say</span> <span class="nv">$c1</span><span class="p">();</span>           <span class="c1"># 5</span>
<span class="nb">say</span> <span class="nv">$c1</span><span class="p">();</span>           <span class="c1"># 6</span>
<span class="nv">&amp;nbsp_place_holder</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$c2</span> <span class="o">=</span> <span class="nf">counter</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
<span class="nb">say</span> <span class="nv">$c2</span><span class="p">();</span>           <span class="c1"># 42</span>
<span class="nb">say</span> <span class="nv">$c1</span><span class="p">();</span>           <span class="c1"># 7</span>
<span class="nb">say</span> <span class="nv">$c2</span><span class="p">();</span>           <span class="c1"># 43</span>
</code></pre></div><p>çœ‹åˆ°äº†å§ï¼Œ <code>$c1</code> å’Œ <code>$c2</code> æ˜¯å®Œå…¨åˆ†å¼€çš„ï¼Œä»–ä»¬ç›¸äº’ç‹¬ç«‹äº’ä¸å½±å“ã€‚å°½ç®¡ä»–ä»¬éƒ½å†™æˆ $count çš„æ ·å­ï¼Œçœ‹èµ·æ¥çœŸæ˜¯å·®ä¸å¤šï¼Œä½†ä»–ä»¬éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„å­˜å‚¨å•å…ƒâ€”â€”å› ä¸ºæ¯æ¬¡æˆ‘ä»¬è¿è¡Œè¿›å…¥é‚£ä¸ªä»£ç å—çš„æ—¶å€™ï¼Œå°±æ˜¯ä¸€æ¬¡é‡æ–°å¼€å§‹ã€‚è¿™ä¸ªå°ä»£ç å—ä»è¿è¡Œä¸­çš„è®¡æ•°å™¨é‡Œè¿”å›ï¼Œè¿™äº›è®¡æ•°å™¨é‡Œä¿ç•™äº†å­˜å‚¨å•å…ƒçš„å¯¹åº”å…³ç³»ã€‚ï¼ˆä»–â€œå…³é—­â€è¿™ä¸ªå­˜å‚¨å•å…ƒï¼Œä¿æŠ¤å®ƒä¸è¢« GC å›æ”¶æ‰ã€‚è¿™ç±»ä»£ç å—å«é—­åŒ…ï¼‰</p>
<p>è¿™ä¸ªé—­åŒ…çœ‹èµ·æ¥åƒæ˜¯ä¸ªè½»é‡çº§çš„å¯¹è±¡ï¼Ÿgxgxï¼Œä»–ä»¬ç¡®å®å°±æ˜¯ã€‚é—­åŒ…èƒŒåçš„åŸåˆ™ï¼Œå³è§„èŒƒå¯¹é—­åŒ…å€¼çš„è®¿é—®æ–¹å¼ï¼Œä¸é¢å‘å¯¹è±¡èƒŒåçš„å°è£…å’Œä¿¡æ¯çš„åŸåˆ™æ˜¯ä¸€æ ·çš„ã€‚ä»–ä»¬éƒ½æ˜¯å°½åŠ›é™åˆ¶äº‹æƒ…çš„ç¨‹åº¦ï¼Œåœ¨äº‹æƒ…å˜å¾—ç³Ÿç³•çš„æ—¶å€™ï¼Œå¸®å¿™å‡å°‘å…¶å½±å“å’ŒæŸå¤±ã€‚</p>
<p>ä½ å¯ä»¥ç”¨è¯æ³•å˜é‡åšäº›å¾ˆæœ‰è¶£çš„äº‹æƒ…ï¼Œæ¯”å¦‚é—­åŒ…ï¼›è€ŒåŒ…å˜é‡ä¸è¡Œã€‚è¯æ³•å˜é‡æœ€é…·å•¦ï¼å¼å¼~~</p>
<h2 id="ç¬¬å…«å¤©---ä¸åŒä¸œè¥¿ç”¨ä¸åŒåå­—">ç¬¬å…«å¤© - ä¸åŒä¸œè¥¿ç”¨ä¸åŒåå­—</h2>
<p>Perl5 çš„æ–°æ‰‹ä»¬ï¼Œæ€»ä¼šå¾ˆå¥‡æ€ªçš„è¯´ä¸ºå•¥è‡ªå·±æ²¡æ³•å€’è£…å‘¢ï¼ŸPerl é‡Œæœ‰å†…ç½®çš„ reverse å‘½ä»¤ï¼Œä½†å¥½åƒå‹æ ¹ä¸èµ·ä½œç”¨å•Šï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ perl -E <span class="s2">&#34;say reverse &#39;hello&#39;&#34;</span>
hello
</code></pre></div><p>å½“ä»–ä»¬å»é—®ä¸€äº›æœ‰ç»éªŒçš„ perler çš„æ—¶å€™ï¼Œè§£å†³åŠæ³•å¾ˆå¿«å°±æœ‰äº†ã€‚å› ä¸º reverse æœ‰ä¸¤ç§æ“ä½œæ¨¡å¼ï¼Œåˆ†åˆ«å·¥ä½œåœ¨æ ‡é‡å’Œåˆ—è¡¨ç¯å¢ƒä¸‹ï¼Œç”¨æ¥å€’è£…å­—ç¬¦ä¸²å’Œåˆ—è¡¨å…ƒç´ ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ perl -E <span class="s2">&#34;say scalar reverse &#39;hello&#39;&#34;</span>
olleh
</code></pre></div><p>æ¯”è¾ƒæ‚²å‰§çš„æ˜¯è¿™ä¸ªæƒ…å†µå’Œå¤§å¤šæ•°çš„ perl è¯­å¢ƒæ˜¯ä¸ä¸€è‡´çš„ã€‚æ¯”æ–¹è¯´ï¼Œç»å¤§å¤šæ•°çš„æ“ä½œç¬¦å’Œå‡½æ•°ç”±è‡ªå·±å†³å®šè¯­å¢ƒï¼Œå¹¶åœ¨è¿™ä¸ªè¯­å¢ƒä¸‹åˆ†ææ•°æ®ã€‚å¥½æ¯” + å’Œ * ä½œç”¨äºæ•°å­—ï¼Œ. ä½œç”¨äºå­—ç¬¦ä¸²ã€‚æ‰€ä»¥è¯´ä»–ä»¬ä»£è¡¨ä¸€ä¸ªæ“ä½œå¹¶ä¸”æä¾›è¯­å¢ƒï¼Œè€Œ <code>reverse</code> å´ä¸æ˜¯ã€‚</p>
<p>åœ¨ Raku é‡Œï¼Œæˆ‘ä»¬ä»è¿‡å»çš„é”™è¯¯é‡Œå¸å–æ•™è®­ä»¥æ‘†è„±å†å²çš„çª˜å¢ƒã€‚æ‰€ä»¥æˆ‘ä»¬æŠŠåˆ—è¡¨å€’å™ï¼Œå­—ç¬¦ä¸²ç¿»è½¬ï¼Œå“ˆå¸Œåæ¼”åˆ†å¼€æˆäº†ä¸‰ä¸ªæ“ä½œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># å­—ç¬¦ä¸²ç¿»è½¬ï¼Œæ”¹åå«flip</span>
<span class="nv">$</span> <span class="nb">raku</span> <span class="o">-</span><span class="no">e</span> <span class="p">&#39;</span><span class="s1">say flip &#34;hello&#34;</span><span class="p">&#39;</span>
<span class="n">olleh</span>
<span class="c1"># åˆ—è¡¨å€’å™</span>
<span class="nv">$</span> <span class="nb">raku</span> <span class="o">-</span><span class="no">e</span> <span class="p">&#39;</span><span class="s1">say join &#34;, &#34;, reverse &lt;ab cd ef&gt;</span><span class="p">&#39;</span>
<span class="n">ef</span><span class="o">,</span> <span class="n">cd</span><span class="o">,</span> <span class="n">ab</span>
<span class="c1"># å“ˆå¸Œåè½¬ï¼Œå« invert</span>

<span class="k">my</span> <span class="nv">%capitals</span> <span class="o">=</span> <span class="s">France</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">Paris</span><span class="p">&#34;</span>, <span class="s">UK</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">London</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="nv">%capitals</span><span class="o">.</span><span class="nb">invert</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>
<span class="p">(&#34;</span><span class="s2">Paris</span><span class="p">&#34;</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">France</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">London</span><span class="p">&#34;</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">UK</span><span class="p">&#34;)</span>
</code></pre></div><p>æ³¨æ„å“ˆå¸Œçš„åæ¼”å’Œå…¶ä»–ä¸¤ä¸ªä¸åŒã€‚å› ä¸ºå“ˆå¸Œçš„å€¼ä¸è¦æ±‚æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥åæ¼”åï¼Œå“ˆå¸Œç»“æ„å¯èƒ½ä¼šè¢«æ”¹å˜ï¼Œæˆ–è€…æŸäº›å€¼è¢«è¦†ç›–â€¦â€¦
å¦‚æœå¿…è¦çš„è¯ï¼Œä½¿ç”¨è€…å¯ä»¥è‡ªå·±å†³å®šè¿”å›å“ˆå¸Œç»“æ„æ—¶çš„æ“ä½œæ–¹å¼ã€‚æ¯”å¦‚ä¸‹é¢å°±æ˜¯ä¸€ç§æ— æŸçš„æ–¹å¼ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%inverse</span><span class="p">;</span>
<span class="nv">%inverse</span><span class="o">.</span><span class="nb">push</span><span class="p">(</span> <span class="nv">%original</span><span class="o">.</span><span class="nb">invert</span> <span class="p">);</span>
</code></pre></div><p>è¿™ä¸ªæ–¹æ³•ä¼šåœ¨é”®å€¼å¯¹å­˜åœ¨çš„æƒ…å†µä¸‹ï¼ŒæŠŠæ–°å€¼ push åœ¨åŸæœ‰å€¼çš„é˜Ÿå°¾å˜æˆä¸€ä¸ªæ•°ç»„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%h</span><span class="p">;</span>
<span class="nv">%h</span><span class="o">.</span><span class="nb">push</span><span class="p">(&#39;</span><span class="s1">foo</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">);</span>    <span class="c1"># foo =&gt; 1</span>
<span class="nv">%h</span><span class="o">.</span><span class="nb">push</span><span class="p">(&#39;</span><span class="s1">foo</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">);</span>    <span class="c1"># foo =&gt; [1, 2]</span>
<span class="nv">%h</span><span class="o">.</span><span class="nb">push</span><span class="p">(&#39;</span><span class="s1">foo</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">);</span>    <span class="c1"># foo =&gt; [1, 2, 3]</span>
</code></pre></div><p>è¿™ä¸‰ä¸ªå‡½æ•°ï¼Œéƒ½ä¼šå¼ºåˆ¶è½¬æ¢ä»–ä»¬çš„å‚æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ ä¼ é€’ä¸€ä¸ªåˆ—è¡¨ç»™ flipï¼Œè¿™ä¸ªåˆ—è¡¨ä¼šè¢«å¼ºåˆ¶æˆå­—ç¬¦ä¸²åå†ç¿»è½¬è¿”å›ã€‚</p>
<h2 id="ç¬¬åå¤©--feed-operators">ç¬¬åå¤© â€“ Feed operators</h2>
<p>ä½¿ç”¨Perl 5 ç¼–ç¨‹ä¸€æ®µæ—¶é—´çš„äººå¯èƒ½é‡åˆ°æˆ–å†™è¿‡ä¸‹é¢è¿™æ ·ç›¸ä¼¼çš„ä»£ç ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-perl" data-lang="perl"><span class="k">my</span> <span class="nv">@new</span> <span class="o">=</span> <span class="nb">sort</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span> <span class="nb">map</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span> <span class="nb">grep</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span> <span class="nv">@original</span><span class="p">;</span>
</code></pre></div><p>åœ¨è¿™ä¸ªæ„é€ ä¸­ï¼Œæ•°æ®ä» <code>@original</code> æ•°ç»„æµè¿› <code>grep</code>ï¼Œç„¶åæŒ‰é¡ºåºï¼Œæµè¿› <code>map</code> ï¼Œç„¶åæµè¿› <code>sort</code>ï¼Œæœ€åå°†ç»“æœèµ‹å€¼ç»™ <code>@new</code> æ•°ç»„ã€‚å› ä¸ºå®ƒä»¬æ¯ä¸ªéƒ½å°†åˆ—è¡¨ä½œä¸ºå®ƒä»¬æœ€ç»ˆçš„å‚æ•°ï¼Œä»…ä»…é€šè¿‡ä½ç½®ï¼Œæ•°æ®ä»ä¸€ä¸ªæ“ä½œç¬¦å‘å·¦æµè¿›ä¸‹ä¸€ä¸ªæ“ä½œç¬¦ã€‚</p>
<p>Raku, ä»å¦ä¸€æ–¹é¢ï¼Œé€šè¿‡å¼•å…¥æµå‘æ“ä½œç¬¦è®©æ•°æ®ä»ä¸€ä¸ªæ“ä½œç¬¦æµè¿›å¦ä¸€ä¸ªæ“ä½œç¬¦ï¼Œè®©è¿™ç§æ€æƒ³æ›´æ˜ç¡®ã€‚ä¸Šé¢çš„ Perl 5 ä»£ç èƒ½ä½¿ç”¨ Raku é‡å†™ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@new</span> <span class="o">&lt;==</span> <span class="nb">sort</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span> <span class="o">&lt;==</span> <span class="nb">map</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span> <span class="o">&lt;==</span> <span class="nb">grep</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span> <span class="o">&lt;==</span> <span class="nv">@original</span><span class="p">;</span>
</code></pre></div><p>æ³¨æ„æ¡æ¡å¤§è·¯é€šç½—é©¬ï¼Œè¿™ä¸ªåœ¨ Raku ä¸­æ›´èƒ½ä½“ç°ã€‚ä½ ä¹Ÿå¯ä»¥è·Ÿ Perl 5 çš„å†™æ³•ç›¸åŒï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@new</span> <span class="o">=</span> <span class="nb">sort</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span><span class="o">,</span> <span class="nb">map</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span><span class="o">,</span> <span class="nb">grep</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span><span class="o">,</span> <span class="nv">@original</span><span class="p">;</span>
</code></pre></div><p>å”¯ä¸€ä¸åŒçš„æ˜¯é¢å¤–çš„é€—å·ã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬ä»è¿™äº›æµå‘æ“ä½œç¬¦å¾—åˆ°äº†ä»€ä¹ˆï¼Ÿé€šå¸¸ï¼Œå½“æˆ‘ä»¬é˜…è¯»ä»£ç çš„æ—¶å€™ï¼Œä½ æ˜¯ä»å·¦å‘å³è¯»çš„ï¼Œåœ¨åŸæ¥çš„ Perl 5 ä»£ç ä¸­ï¼Œä½ å¯èƒ½ä»å·¦åˆ°å³é˜…è¯»ä½ çš„ä»£ç ç›´åˆ°ä½ å‘ç°æ­£åœ¨å¤„ç†çš„ç»“æ„ï¼Œå…¶æµå‘æ˜¯ä»å³å‘å·¦çš„ï¼Œç„¶åä½ è·³åˆ°æœ«å°¾ï¼ŒæŒ‰ç…§ä»å³å¾€å·¦çš„æ–¹å¼å†è¯»ä¸€éã€‚</p>
<p>åœ¨ Raku ä¸­ï¼Œç°åœ¨æœ‰ä¸€ä¸ªçªå‡ºçš„å¥æ³•æ ‡è®°ï¼Œå‘Šè¯‰ä½ æ•°æ®å‘å·¦æµåŠ¨çš„æ€§è´¨ã€‚</p>
<p>è¿™æ ·å†™ä¹Ÿå¯ä»¥ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@original</span> <span class="o">==&gt;</span> <span class="nb">grep</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span> <span class="o">==&gt;</span> <span class="nb">map</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span> <span class="o">==&gt;</span> <span class="nb">sort</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>  <span class="o">==&gt;</span> <span class="k">my</span> <span class="nv">@new</span><span class="p">;</span>
</code></pre></div><p>ä¸‹é¢æ˜¯ä¸€äº›ä½¿ç”¨æµå‘æ“ä½œç¬¦çš„ä¾‹å­ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@random-nums</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="nb">pick</span><span class="p">(</span><span class="o">*</span><span class="p">);</span>  <span class="c1"># 100ä¸ªéšæœºæ•°</span>
<span class="k">my</span> <span class="nv">@odds-squared</span> <span class="o">&lt;==</span> <span class="nb">sort</span> <span class="o">&lt;==</span> <span class="nb">map</span> <span class="p">{</span> <span class="nv">$_</span> <span class="o">**</span> <span class="mi">2</span> <span class="p">}</span> <span class="o">&lt;==</span> <span class="nb">grep</span> <span class="p">{</span> <span class="nv">$_</span> <span class="nv">%</span> <span class="mi">2</span> <span class="p">}</span> <span class="o">&lt;==</span> <span class="nv">@random-nums</span><span class="p">;</span>
<span class="nb">say</span> <span class="o">~</span><span class="nv">@odds-squared</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">@a</span><span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="nb">pick</span><span class="p">(</span><span class="o">*</span><span class="p">);</span>

<span class="nv">@a</span> <span class="o">==&gt;</span> <span class="nb">grep</span> <span class="p">{</span><span class="nv">$_</span> <span class="nv">%</span> <span class="mi">2</span><span class="p">}</span> <span class="o">==&gt;</span> <span class="nb">map</span> <span class="p">{</span> <span class="nv">$_</span> <span class="o">**</span> <span class="mi">2</span><span class="p">}</span> <span class="o">==&gt;</span> <span class="nb">sort</span> <span class="p">{</span><span class="nv">$^a</span> <span class="p">&lt;</span><span class="s">=</span><span class="p">&gt;</span> <span class="nv">$^b</span><span class="p">}</span> <span class="o">==&gt;</span> <span class="k">my</span> <span class="nv">@c</span><span class="p">;</span>
<span class="c1"># 1 9 25 49 81 121 169 225 289 361 441 529 625 729 841 961 1089 1225 1369 1521 1681 1849 2025 2209 2401 2601 2809 3025 3249 3481 3721 3969 4225 4489 4761 5041 5329 5625 5929 6241 6561 6889 7225 7569 7921 8281 8649 9025 9409 9801</span>

<span class="k">my</span> <span class="nv">@odds-squared</span> <span class="o">&lt;==</span> <span class="nb">sort</span> <span class="p">{</span><span class="nv">$^b</span> <span class="p">&lt;</span><span class="s">=</span><span class="p">&gt;</span> <span class="nv">$^a</span><span class="p">}</span> <span class="o">&lt;==</span> <span class="nb">map</span> <span class="p">{</span> <span class="nv">$_</span> <span class="o">**</span> <span class="mi">2</span> <span class="p">}</span> <span class="o">&lt;==</span> <span class="nb">grep</span> <span class="p">{</span> <span class="nv">$_</span> <span class="nv">%</span> <span class="mi">2</span> <span class="p">}</span> <span class="o">&lt;==</span> <span class="nv">@random-nums</span>   <span class="c1"># é™åºæ’åˆ—</span>
<span class="c1"># 9801 9409 9025 8649 8281 7921 7569 7225 6889 6561 6241 5929 5625 5329 5041 4761 4489 4225 3969 3721 3481 3249 3025 2809 2601 2401 2209 2025 1849 1681</span>
<span class="mi">1521</span> <span class="mi">1369</span> <span class="mi">1225</span> <span class="mi">1089</span> <span class="mi">961</span> <span class="mi">841</span> <span class="mi">729</span> <span class="mi">625</span> <span class="mi">529</span> <span class="mi">441</span> <span class="mi">361</span> <span class="mi">289</span> <span class="mi">225</span> <span class="mi">169</span> <span class="mi">121</span> <span class="mi">81</span> <span class="mi">49</span> <span class="mi">25</span> <span class="mi">9</span> <span class="mi">1</span>

<span class="k">my</span> <span class="nv">@rakudo-people</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">scott patrick carl moritz jonathan jerry stephen</span><span class="p">&gt;;</span>
<span class="nv">@rakudo-people</span> <span class="o">==&gt;</span> <span class="nb">grep</span> <span class="p">{</span> <span class="o">/</span><span class="nb">at</span><span class="o">/</span> <span class="p">}</span> <span class="o">==&gt;</span> <span class="nb">map</span> <span class="p">{</span> <span class="o">.</span><span class="nf">ucfirst</span> <span class="p">}</span> <span class="o">==&gt;</span> <span class="k">my</span> <span class="nv">@who-it&#39;s-at</span><span class="p">;</span>
<span class="nb">say</span> <span class="o">~</span><span class="nv">@who-it&#39;s-at</span><span class="p">;</span>    <span class="c1"># Patrick Jonathan</span>

<span class="o">[+]</span><span class="p">(</span><span class="k">my</span> <span class="nv">@a</span><span class="p">)</span> <span class="o">&lt;==</span> <span class="nb">map</span> <span class="p">{</span><span class="nv">$_</span> <span class="o">**</span><span class="mi">2</span><span class="p">}</span> <span class="o">&lt;==</span>  <span class="mi">1</span><span class="o">..</span><span class="mi">10</span>   <span class="c1"># 385ï¼Œ 1 åˆ° 10 çš„å¹³æ–¹å’Œ</span>
<span class="o">[+]</span><span class="p">()</span> <span class="o">&lt;==</span> <span class="nb">map</span> <span class="p">{</span><span class="nv">$_</span> <span class="o">**</span><span class="mi">2</span><span class="p">}</span> <span class="o">&lt;==</span>  <span class="mi">1</span><span class="o">..</span><span class="mi">10</span>        <span class="c1"># 385</span>
</code></pre></div><h2 id="ç¬¬åäºŒå¤©--æ™ºèƒ½åŒ¹é…">ç¬¬åäºŒå¤© â€“ æ™ºèƒ½åŒ¹é…</h2>
<p>è¿˜è®°å¾—<a href="http://rakuadvent.wordpress.com/2010/12/04/the-sequence-operator/">Raku Advent</a> åºåˆ—æ“ä½œç¬¦å—?å› ä¸ºæœ€åä¸€ä¸ªå‚æ•°å®ƒæ¥å—çš„æ˜¯ä¸€ä¸ªä¸Šé™ï¼Œè¿™è®©åºåˆ—çš„ç”Ÿæˆåœæ­¢äº†ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">4</span> <span class="o">...</span> <span class="mi">32</span><span class="p">;</span>         <span class="c1"># 1 2 4 8 16 32</span>
<span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">4</span> <span class="o">...</span> <span class="o">*</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">;</span>     <span class="c1"># 1 2 4 8 16</span>
<span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">4</span> <span class="o">...</span> <span class="o">*</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">;</span>      <span class="c1"># 1 2 4 8 16 32 64 128</span>
<span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">4</span> <span class="o">...^</span> <span class="o">*</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">;</span>     <span class="c1"># 1 2 4 8 16 32 64</span>
</code></pre></div><p>ä½ èƒ½çœ‹åˆ°ï¼Œåœ¨ç¬¬ä¸€ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨äº†æ•°å€¼ç›¸ç­‰ã€‚ç¬¬äºŒä¸ªæ›´æœ‰æ„æ€ï¼š<code>*&gt;10</code> åœ¨å†…éƒ¨è¢«é‡å†™ä¸ºä¸€ä¸ªé—­åŒ…ï¼Œåƒè¿™æ · <code>-&gt; $x { $x &gt; 10 }</code> (through currying).</p>
<p>åºåˆ—æ“ä½œç¬¦åšäº†ä¸€äº›ä¸å¯æ€è®®çš„æ¯”è¾ƒï¼Œæ ¹æ®åŒ¹é…è€…çš„ç±»å‹ã€‚è¿™ç§æ¯”è¾ƒå°±å«åšæ™ºèƒ½åŒ¹é…ï¼Œå¹¶ä¸”æ˜¯åœ¨ Raku ä¸­é‡å¤å‡ºç°çš„ä¸€ä¸ªæ¦‚å¿µï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># after the &#39;when&#39; keyword:</span>
<span class="k">given</span> <span class="nv">$age</span> <span class="p">{</span>
    <span class="k">when</span> <span class="mi">100</span>    <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">congratulations!</span><span class="p">&#34;</span>      <span class="p">}</span>
    <span class="k">when</span> <span class="o">*</span> <span class="o">&lt;</span> <span class="mi">18</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">You&#39;re not of age yet</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># after &#39;where&#39;:</span>
<span class="k">subset</span> <span class="nc">Even</span> <span class="k">of</span> <span class="nb">Int</span> <span class="k">where</span> <span class="o">*</span> <span class="nv">%%</span> <span class="mi">2</span><span class="p">;</span>

<span class="c1"># æ˜¾å¼åœ°ä½¿ç”¨æ™ºèƒ½åŒ¹é…æ“ä½œç¬¦:</span>
<span class="k">if</span> <span class="nv">$input</span> <span class="o">~~</span> <span class="k">m</span><span class="p">/</span><span class="ni">^</span><span class="se">\d</span><span class="o">+</span><span class="ni">$</span><span class="p">/</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$input</span><span class="s2"> is an integer</span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="c1"># arguments to grep(), first() etc.:</span>
<span class="k">my</span> <span class="nv">@even</span> <span class="o">=</span> <span class="nv">@numbers</span><span class="o">.</span><span class="nb">grep</span><span class="o">:</span> <span class="n">Even</span><span class="p">;</span>
</code></pre></div><p>åœ¨æ™ºèƒ½æ“ä½œç¬¦ <code>~~</code> çš„å³ä¾§ï¼Œå¹¶ä¸”åœ¨ <code>when</code> å’Œ <code>where</code> çš„åé¢ï¼Œè¦åŒ¹é…çš„å€¼è¢«è®¾ç½®ä¸º ä¸»é¢˜å˜é‡ <code>$_</code>ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€äº›æ™ºèƒ½æ“ä½œç¬¦çš„ç”¨æ³•ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$foo</span> <span class="o">~~</span> <span class="nb">Str</span>             <span class="c1">#å®ƒçš„ç±»å‹æ˜¯ Strå—?</span>
<span class="nv">$foo</span> <span class="o">~~</span> <span class="mi">6</span>               <span class="c1">#å®ƒç­‰äº 6 å—?</span>
<span class="nv">$foo</span> <span class="o">~~</span> <span class="p">&#34;</span><span class="s2">bar</span><span class="p">&#34;</span>           <span class="c1">#æˆ–è€…å®ƒæ˜¯ &#34;bar&#34; å—?</span>
<span class="nv">$foo</span> <span class="o">~~</span> <span class="p">/</span><span class="sr"> </span><span class="se">\w</span><span class="o">+</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="sr"> </span><span class="p">/</span> <span class="c1"># å®ƒåŒ¹é…æŸä¸ªæ¨¡å¼å—?</span>
<span class="nv">$foo</span> <span class="o">~~</span> <span class="p">(</span><span class="mi">15</span><span class="o">..</span><span class="mi">25</span><span class="p">)</span>        <span class="c1"># å®ƒçš„å€¼åœ¨ 15 å’Œ 25 ä¹‹é—´å—?</span>
<span class="nv">$foo</span> <span class="o">~~</span> <span class="k">-&gt;</span> <span class="nv">$x</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">ok</span><span class="p">&#39;</span> <span class="k">if</span> <span class="mi">5</span> <span class="o">&lt;</span> <span class="nv">$x</span> <span class="o">&lt;</span> <span class="mi">25</span> <span class="p">}</span> <span class="c1"># è°ƒç”¨é—­åŒ…</span>
<span class="nv">$foo</span> <span class="o">~~</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="o">*,</span> <span class="mi">1</span><span class="o">,</span> <span class="o">*,</span> <span class="mi">1</span><span class="o">,</span> <span class="o">*]</span> <span class="c1"># å«æœ‰6ä¸ªå…ƒç´ çš„æ•°ç»„ï¼Œæ˜¯å¦å…¶æ‰€æœ‰çš„å¥‡æ•°å…ƒç´ çš„å€¼éƒ½ä¸º 1?</span>
</code></pre></div><p><a href="http://perlcabal.org/syn/S03.html#Smart_matching">æ™ºèƒ½åŒ¹é…çš„å…¨éƒ¨è¡¨ç°å¯ä»¥åœ¨è¿™æ‰¾åˆ°ï¼š</a>.</p>
<p>æ™ºèƒ½åŒ¹é…æ²¡æœ‰ç‰¹æ®Šçš„æ“ä½œç¬¦ï¼Œè€Œå¤§éƒ¨åˆ†æ™ºèƒ½åŒ¹é…çš„æƒ…å†µä¼šè¿”å› Bool å€¼ï¼Œå¯¹æ­£åˆ™è¿›è¡ŒåŒ¹é…ä¼šè¿”å›ä¸€ä¸ª Match å¯¹è±¡</p>
<p>ä½ å¯èƒ½å¼€å§‹æ€€ç–‘ï¼šä¸€ä¸ªæ­£ç¡®çš„ï¼Œå†…ç½®çš„ç±»å‹ï¼Œæˆ‘æ€ä¹ˆå°†å®ƒç”¨åœ¨æˆ‘è‡ªå·±çš„ç±»ä¸­ï¼Ÿä½ éœ€è¦ä¸ºå®ƒå†™ä¸€ä¸ªç‰¹åˆ«çš„ ACCEPTS æ–¹æ³•ã€‚å‡å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªå«Point çš„ç±»ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Point</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.x</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.y</span><span class="p">;</span>

    <span class="k">method</span> <span class="nb">ACCEPTS</span><span class="p">(</span><span class="nb">Positional</span> <span class="nv">$p2</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$.x</span> <span class="o">==</span> <span class="nv">$p2</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="ow">and</span> <span class="nv">$.y</span> <span class="o">==</span> <span class="nv">$p2</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>ä¸€åˆ‡éƒ½æ¸…æ¥šäº†å—?è®©æˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="n">Point</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">x</span> <span class="o">=&gt;</span> <span class="mi">7</span>, <span class="s">y</span> <span class="o">=&gt;</span> <span class="mi">9</span><span class="p">);</span>
<span class="nb">say</span> <span class="o">[</span><span class="mi">3</span><span class="o">,</span> <span class="mi">5</span><span class="o">]</span> <span class="o">~~</span> <span class="nv">$a</span><span class="p">;</span> <span class="c1"># Bool::False</span>
<span class="nb">say</span> <span class="p">(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">~~</span> <span class="nv">$a</span><span class="p">;</span> <span class="c1"># Bool::True</span>
</code></pre></div><p>ç°åœ¨èƒ½æ°å½“åœ°åšåˆ°ä½ æƒ³è¦çš„ï¼Œç”šè‡³ä½¿ç”¨ä½ è‡ªå·±çš„ç±»ã€‚</p>
<h2 id="ç¬¬-16-å¤©---raku-é‡Œçš„æ—¶é—´">ç¬¬ 16 å¤© - Raku é‡Œçš„æ—¶é—´</h2>
<p>ä»Šå¤©æ˜¯åœ£è¯æœˆå†çš„ç¬¬ 0x10 å¤©ï¼Œæ˜¯æ—¶å€™å­¦ä¹ ä¸€ä¸‹ raku é‡Œçš„æ—¶é—´äº†ã€‚S32::Temporal ç®€ä»‹åœ¨è¿‡å»ä¸€å¹´ä¸­æœ‰äº†å¤§é‡çš„ä¿®æ”¹ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥ä»‹ç»ä¸€ä¸‹åœ¨ raku å®ç°ä¸­å…³äºæ—¶é—´çš„ä¸€äº›åŸºç¡€çŸ¥è¯†ã€‚</p>
<p><code>time</code> å’Œ <code>now</code> æ˜¯ä¸¤ä¸ªå¯ä»¥è¿”å›å½“å‰æ—¶é—´ï¼ˆè‡³å°‘æ˜¯ä½ çš„ç³»ç»Ÿè®¤ä¸ºçš„å½“å‰æ—¶é—´ï¼‰çš„è¯ã€‚ç®€å•çš„å±•ç¤ºä¸€ä¸‹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nb">time</span><span class="p">;</span>
<span class="nb">say</span> <span class="nb">now</span><span class="p">;</span>
</code></pre></div><pre><code>1292460064
Instant:2010-12-16T00:41:4.873248Z
</code></pre><p>ç¬¬ä¸€ä¸ªæ˜æ˜¾çš„åŒºåˆ«ï¼Œå‰è€…è¿”å›çš„æ˜¯ POSIX æ ¼å¼çš„æ•°å€¼å‹çš„ç»“æœï¼›è€Œåè€…è¿”å›çš„æ˜¯ä¸€ä¸ªç¬é—´çš„å¯¹è±¡ã€‚å¦‚æœä½ æƒ³è·å–ç§’çº§ä»¥ä¸‹å°æ•°ç‚¹ä½æˆ–è€…è¯´é—°ç§’ï¼Œè¯·ç”¨ now ï¼›å¦‚æœä¸ç”¨ï¼Œé‚£ç”¨ time è·å– POSIX æ ¼å¼å°±å¤Ÿäº†ã€‚éšä½ çš„ä¾¿ã€‚</p>
<ul>
<li>DateTime å’Œä»–çš„ä¼™ä¼´</li>
</ul>
<p>å¤§å¤šæ•°æ—¶å€™ï¼Œä½ è¦çš„ä¸æ˜¯å½“å‰æ—¶é—´ã€‚è¿™ç§æ—¶å€™ï¼Œä½ éœ€è¦çš„æ˜¯ <code>DateTime</code> ã€‚æ¯”å¦‚è¿˜æ˜¯è·å–å½“å‰æ—¶é—´ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$moment</span> <span class="o">=</span> <span class="nb">DateTime</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="nb">now</span><span class="p">);</span> <span class="c1"># æˆ–è€… DateTime.new(time)</span>
</code></pre></div><p>ä½ æœ‰ä¸¤ç§æ–¹å¼æ¥åˆ›å»º DateTime å¯¹è±¡ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$dw</span> <span class="o">=</span> <span class="nb">DateTime</span><span class="o">.</span><span class="nb">new</span><span class="p">(:</span><span class="s">year</span><span class="p">(</span><span class="mi">1963</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">month</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">day</span><span class="p">(</span><span class="mi">23</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">hour</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">minute</span><span class="p">(</span><span class="mi">15</span><span class="p">));</span>
</code></pre></div><p>è¿™æ˜¯ UTC æ—¶åŒºï¼Œå¦‚æœä½ è¦æ›´æ”¹æ—¶åŒºçš„è¯ï¼Œå†åŠ ä¸Š <code>:timezone</code> å°±å¥½äº†ã€‚è¿™ä¸ªæ ¼å¼é‡Œï¼Œåªæœ‰ <code>:year</code> æ˜¯å¿…é¡»çš„ï¼Œå…¶ä»–çš„é»˜è®¤å°±æ˜¯1æœˆ1å·åŠå¤œ0ç‚¹0åˆ†ã€‚</p>
<p>ä¸Šé¢è¿™ç§å†™æ³•ç¡®å®ä¹å‘³ï¼Œä½ å¯ä»¥é‡‡ç”¨ ISO8601 æ ¼å¼çš„è¾“å…¥ï¼Œæ¥åˆ›å»ºä¸€ä¸ª DateTime å¯¹è±¡ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$dw</span> <span class="o">=</span> <span class="nb">DateTime</span><span class="o">.</span><span class="nb">new</span><span class="p">(&#34;</span><span class="s2">1963-11-23T17:15:00Z</span><span class="p">&#34;);</span>
</code></pre></div><p>å…¶ä¸­ Z è¡¨ç¤º UTC ï¼Œæƒ³æ”¹å˜çš„è¯ï¼ŒæŠŠ Z æ›¿æ¢æˆ <code>+hhmm</code> æˆ–è€… <code>-hhmm</code> å°±å¥½äº†ã€‚hh è¡¨ç¤ºå°æ—¶ï¼Œmm è¡¨ç¤ºåˆ†é’Ÿã€‚
æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæ›´ç®€ç•¥çš„ Date å¯¹è±¡ã€‚åªåŒ…æ‹¬å¹´æœˆæ—¥çš„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$jfk</span> <span class="o">=</span> <span class="nb">Date</span><span class="o">.</span><span class="nb">new</span><span class="p">(&#34;</span><span class="s2">1963-11-22</span><span class="p">&#34;);</span> <span class="c1"># ä½ ä¹Ÿå¯ä»¥ç”¨:year ç­‰çš„å†™æ³•</span>
</code></pre></div><p>å¼•å…¥ Date å¯¹è±¡ï¼Œæ˜¯å¸å–äº† CPAN ä¸Š DateTime æ¨¡å—çš„æ•™è®­ï¼šæœ‰æ—¶å€™ä½ å‹æ ¹ä¸å…³å¿ƒä»€ä¹ˆæ—¶åŒºå•Šé—°ç§’å•Šçš„ã€‚Date å¯¹è±¡éå¸¸å®¹æ˜“å¤„ç†ï¼Œæ¯”å¦‚å®ƒæœ‰å†…ç½®çš„ <code>.succ</code> å’Œ <code>.pred</code> æ–¹æ³•ï¼Œç”¨æ¥ç®€å•çš„é€’å¢å’Œé€’å‡ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$jfk</span><span class="o">++</span><span class="p">;</span> <span class="c1"># è‚¯å°¼è¿ªé‡åˆºåçš„ç¬¬äºŒå¤©</span>
</code></pre></div><p>æœ€åâ€¦</p>
<p>ä»¥ä¸Šå°±æ˜¯å…³äº Raku é‡Œçš„æ—¶é—´çš„å†…å®¹äº†ï¼Œæƒ³äº†è§£æ›´å¤šç»†èŠ‚ï¼Œå»çœ‹çœ‹è§„èŒƒå§ï¼›æˆ–è€…å»ç¤¾åŒºé‡Œæé—®</p>
<h2 id="ç¬¬åä¹å¤©---å‡ä½œçœŸæ—¶çœŸäº¦å‡">ç¬¬åä¹å¤© - å‡ä½œçœŸæ—¶çœŸäº¦å‡</h2>
<p>ä»Šå¤©çš„åœ£ä¸´ç¤¼ç‰©æ˜¯æ•™å¤§å®¶æ€ä¹ˆç”¨æ··æ·†å®Œæˆä¸€ä¸ªå°é‚ªæ¶æ»´ç›®çš„ï¼Œå¼å¼~çœ‹èµ·æ¥è¿™ä¸ªåŠŸèƒ½æŒºç–¯ç‹‚çš„ï¼Œå…¶å®æœ‰æ—¶å€™è›®æœ‰ç”¨çš„ã€‚å…ˆçœ‹ä¸‹é¢è¿™ä¸ªç”¨ but çš„ä¾‹å­ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$value</span> <span class="o">=</span> <span class="mi">42</span> <span class="k">but</span> <span class="k">role</span> <span class="p">{</span> <span class="k">method</span> <span class="nb">Bool</span>  <span class="p">{</span> <span class="nb">False</span> <span class="p">}</span> <span class="p">};</span>
<span class="nb">say</span> <span class="nv">$value</span><span class="p">;</span>    <span class="c1"># 42</span>
<span class="nb">say</span> <span class="o">?</span><span class="nv">$value</span><span class="p">;</span>   <span class="c1"># False</span>
</code></pre></div><p>ä½ çœ‹ï¼Œæˆ‘ä»¬æ”¹å˜äº† <code>$value</code> çš„ <code>.Bool</code> æ–¹æ³•ã€‚ä»–ä¸å½±å“ç¨‹åºé‡Œå…¶ä»–æ‰€æœ‰çš„æ•´æ•°ï¼Œå“ªæ€•åˆ«çš„å˜é‡ä¹Ÿæ˜¯ 42ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯¹äº Int å‹ï¼Œ<code>.Bool</code> æ–¹æ³•ï¼ˆé€šè¿‡?æ“ä½œç¬¦ï¼‰è¿”å›å€¼ä¾æ®æ˜¯æ˜¯å¦ç­‰äº 0ã€‚ä½†è¿™æ¬¡å®ƒæ°¸è¿œéƒ½è¿”å› false äº†ã€‚
äº‹å®ä¸Šï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å†™çš„æ›´ç®€å•ï¼Œå› ä¸º False æ˜¯ä¸€ä¸ªæšä¸¾å€¼ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$value</span> <span class="o">=</span> <span class="mi">42</span> <span class="k">but</span> <span class="nb">False</span><span class="p">;</span>
</code></pre></div><p>å› ä¸º False æ˜¯ Bool å€¼ï¼Œæ‰€æœ‰å®ƒä¼šè‡ªåŠ¨é‡è½½ <code>.Bool</code> æ–¹æ³•ã€‚è¿™æ˜¯ Raku çš„ä¸€ç§è½¬æ¢æ–¹æ³•ã€‚å…¶ä»–çš„å€¼ï¼Œä¹Ÿä¼šå¯¹åº”çš„é‡è½½ã€‚</p>
<p>è¿™æ ·åœ¨æœ‰çš„æ—¶å€™ï¼Œè¿™ä¸ªä¸œè¥¿å°±æ¯”è¾ƒæœ‰ç”¨äº†ï¼šåœ¨ Perl5 é‡Œï¼Œä½ ç”¨ system è°ƒç”¨ shell çš„æ—¶å€™ï¼Œå¾—ç‰¢ç‰¢è®°ä½åœ¨ shell é‡Œï¼Œè¿”å› 0 æ‰æ˜¯æ­£å¸¸çš„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="p">(</span> <span class="nf">system</span><span class="p">(</span><span class="nv">$cmd</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>  <span class="c1"># æˆ–è€…!system($cmd)</span>
    <span class="c1"># ...</span>
<span class="p">}</span>
</code></pre></div><p>è€Œåœ¨ Raku ä¸­ï¼Œå¯¹åº”çš„ run å‘½ä»¤è¿”å›çš„æ˜¯ä¸Šé¢è¯´çš„è¿™ç§é‡è½½è¿‡çš„ Intï¼Œå½“ä¸”ä»…å½“è¿”å›å€¼æ˜¯ 0 çš„æ—¶å€™ï¼Œå®ƒçš„ bool å˜æˆäº† Trueï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„é¢ï¼</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="nb">run</span><span class="p">(</span><span class="nv">$cmd</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">#ä¸éœ€è¦å¦å®šäº†</span>
    <span class="c1"># ...</span>
<span class="p">}</span>
</code></pre></div><p>å¥½äº†ï¼Œç°åœ¨è¿›å…¥æœ€ç–¯ç‹‚çš„éƒ¨åˆ† â€”â€” æˆ‘ä»¬å¯ä»¥é‡è½½å¸ƒå°”å€¼çš„å¸ƒå°”æ–¹æ³•ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$value</span> <span class="o">=</span> <span class="nb">True</span> <span class="k">but</span> <span class="nb">False</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$value</span><span class="p">;</span>    <span class="c1"># True</span>
<span class="nb">say</span> <span class="o">?</span><span class="nv">$value</span><span class="p">;</span>   <span class="c1"># False</span>
</code></pre></div><p>æ²¡é”™ï¼ŒRaku å…è®¸ä½ è¿™æ ·è‡ªå·±è¸¢è‡ªå·±å±è‚¡~~è™½ç„¶æˆ‘ä¹Ÿä¸çŸ¥é“é™¤äº†æ£ä¹±å¤–æ€ä¹ˆä¼šæœ‰äººæ„¿æ„è¿™ä¹ˆåšï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯å¾ˆé«˜å…´çœ‹åˆ° Raku ä¿æŒè¿™ç§å¾®å¦™çš„è·Ÿè¸ªå’Œé‡è½½ç±»å‹çš„å¿ƒæ€ã€‚æˆ‘å¯æ²¡æœ‰â€¦â€¦</p>
<h2 id="day-21--transliteration-and-beyond">Day 21 â€“ transliteration and beyond</h2>
<p>è½¬æ¢å¬èµ·æ¥åƒæ‹‰ä¸è¯æ ¹,æ„å‘³ç€å­—æ¯çš„å˜åŒ–ã€‚è¿™å°±æ˜¯ Str.trans æ–¹æ³•æ‰€åšçš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">GATTACA</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">trans</span><span class="p">(</span> <span class="p">&#34;</span><span class="s2">TCAG</span><span class="p">&#34;</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">0123</span><span class="p">&#34;</span> <span class="p">);</span>  <span class="c1"># prints &#34;3200212\n&#34;</span>
</code></pre></div><p>ä½¿ç”¨è¿‡Perl5 çš„äººé©¬ä¸Šæ„è¯†åˆ°è¿™å°±æ˜¯ <code>tr/tcag/0123/</code> .</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œä½¿ç”¨ ROT-13ç®—æ³•åŠ å¯†æ–‡æœ¬ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">rot13</span><span class="p">(</span><span class="nv">$text</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$text</span><span class="o">.</span><span class="nb">trans</span><span class="p">(</span> <span class="p">&#34;</span><span class="s2">A..Za..z</span><span class="p">&#34;</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">N..ZA..Mn..za..m</span><span class="p">&#34;</span> <span class="p">)</span> <span class="p">}</span>
</code></pre></div><p>å½“ <code>.trans</code> æ–¹æ³•çœ‹åˆ°é‚£äº› <code>..</code> åŒºé—´æ—¶ï¼Œå®ƒä¼šåœ¨å†…éƒ¨å°†é‚£äº›å­—æ¯å±•å¼€ (æ‰€ä»¥ &ldquo;n..z&rdquo; æ„æ€æ˜¯ &ldquo;nopqrstuvwxyz&rdquo;). å› æ­¤,rot13å­ä¾‹ç¨‹çš„æœ€ç»ˆæ•ˆæœæ˜¯å°†ASCIIå­—æ¯è¡¨çš„ç‰¹å®šéƒ¨åˆ†æ˜ å°„åˆ°å…¶ä»–éƒ¨åˆ†ã€‚</p>
<p>åœ¨ Perl5 ä¸­ï¼Œä¸¤ä¸ªç‚¹è·Ÿä¸€ä¸ªç ´æŠ˜å·ç›¸åŒï¼Œä½†æ˜¯åœ¨Raku ä¸­æˆ‘ä»¬è®©é‚£ä¸¤ä¸ªç‚¹ .. ä»£è¡¨ èŒƒå›´çš„æ¦‚å¿µï¼Œåœ¨ä¸»ç¨‹åºä¸­ï¼Œåœ¨æ­£åˆ™ä¸­ï¼Œè¿˜æœ‰åœ¨è¿™é‡Œï¼Œè½¬æ¢ã€‚</p>
<p>è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>.trans</code> æ–¹æ³•æ˜¯ä¸ä¼šæ”¹å˜åŸæ¥çš„å­—ç¬¦ä¸²ï¼› å®ƒä¸ä¼šå™¶è¾¹ $text, è€Œæ˜¯è¿”å›ä¸€ä¸ªæ–°çš„å€¼ã€‚è¿™åœ¨ Raku ä¸­ä¹Ÿæ˜¯ä¸€ä¸ªé€šç”¨çš„æ—‹å¾‹ã€‚è¦æ”¹å˜åŸå€¼ï¼Œè¯·ä½¿ç”¨  <code>.=trans</code></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$kabbala</span><span class="o">.=</span><span class="nb">trans</span><span class="p">(&#34;</span><span class="s2">A..Ia..i</span><span class="p">&#34;</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">1..91..9</span><span class="p">&#34;);</span>
</code></pre></div><p>(å¹¶ä¸”ï¼Œå®ƒä¸ä»…ä»…é€‚ç”¨äº <code>.trans</code> æ–¹æ³•ï¼Œå®ƒå¯¹æ‰€æœ‰æ–¹æ³•éƒ½é€‚ç”¨ã€‚)</p>
<p><code>.trans</code> æ–¹æ³•åŒ…å«äº†ä¸€ä¸ªç§˜å¯†æ­¦å™¨ï¼šå‡å¦‚æˆ‘ä»¬æƒ³è½¬ä¹‰ä¸€äº›HTMLï¼Œå³ï¼Œæ ¹æ®ä¸‹é¢è¿™ä¸ªè¡¨æ¥æ›¿æ¢ä¸œè¥¿ï¼š</p>
<pre><code>&amp; =&gt; &amp;amp;
&lt; =&gt; &amp;lt;
&gt; =&gt; &amp;gt;
</code></pre><p>ä½†æ˜¯æˆ‘ä»¬ä¸æƒ³å…³å¿ƒæ›¿æ¢è¿˜è¦æŒ‰é¡ºåºè¿›è¡Œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="s">foo</span>         <span class="o">=&gt;</span> <span class="n">bar</span>
<span class="s">foolishness</span> <span class="o">=&gt;</span> <span class="n">folly</span>
</code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœå‰é¢çš„æ›¿æ¢å…ˆå‘ç”Ÿï¼Œå°±ä¸å›æœ‰åé¢çš„æ›¿æ¢å‡ºç°äº† - è¿™å¯èƒ½ä¸æ˜¯ä½ æƒ³è¦çš„ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬æƒ³åœ¨çŸ­çš„å­ä¸²ä¹‹å‰ï¼Œå°è¯•å¹¶åŒ¹é…æœ€é•¿çš„å­ä¸²ã€‚</p>
<p>æ‰€ä»¥ï¼Œè¿™çœ‹èµ·æ¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæœ€é•¿è®°å·çš„æ›¿æ¢åŒ¹é…ï¼Œä»¥é¿å…å› ä¸ºå¶ç„¶çš„é‡å¤æ›¿æ¢è€Œäº§ç”Ÿçš„æ— é™å¾ªç¯ã€‚
é‚£å°±æ˜¯ Raku çš„ <code>.trans</code> æ–¹æ³•æ‰€æä¾›çš„ã€‚è¿™å°±æ˜¯å®ƒçš„ç§˜å¯†æ­¦å™¨ï¼šåµŒå…¥ä¸¤ä¸ªæ•°ç»„è€Œéå­—ç¬¦ä¸²ã€‚å¯¹äº HTML è½¬ä¹‰ï¼Œæˆ‘ä»¬æ‰€éœ€è¦çš„å°±æ˜¯ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$escaped</span> <span class="o">=</span> <span class="nv">$html</span><span class="o">.</span><span class="nb">trans</span><span class="p">(</span>
    <span class="o">[</span> <span class="p">&#39;</span><span class="s1">&amp;</span><span class="p">&#39;</span><span class="o">,</span>     <span class="p">&#39;</span><span class="s1">&lt;</span><span class="p">&#39;</span><span class="o">,</span>    <span class="p">&#39;</span><span class="s1">&gt;</span><span class="p">&#39;</span>    <span class="o">]</span> <span class="o">=&gt;</span>
    <span class="o">[</span> <span class="p">&#39;</span><span class="s1">&amp;amp;</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">&amp;lt;</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">&amp;gt;</span><span class="p">&#39;</span> <span class="o">]</span>
<span class="p">);</span>
</code></pre></div><p>æ›¿æ¢çš„é¡ºåºé—®é¢˜å’Œé¿å…å¾ªç¯å°±ä¸ç”¨æˆ‘ä»¬å…³å¿ƒäº†ã€‚</p>
<h2 id="ç¬¬äºŒåäºŒå¤©---meta-object-protocol">ç¬¬äºŒåäºŒå¤© - Meta-Object Protocol</h2>
<p>ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ç”¨ä½ æœ€çˆ±çš„ç¼–ç¨‹è¯­è¨€å†™ä¸€ä¸ªç±»â€”â€”ä½†æ˜¯ä¸æ˜¯æŒ‰éƒ¨å°±ç­çš„å†™ç±»å®šä¹‰ï¼Œè€Œæ˜¯é€šè¿‡å‡ è¡Œä»£ç ï¼Ÿæœ‰äº›è¯­è¨€æä¾›äº† API æ¥å®Œæˆè¿™ä¸ªåŠŸèƒ½ã€‚è¿™äº› API çš„åé¢ï¼Œå°±æ˜¯å…ƒå¯¹è±¡åè®®( Meta-Object Protocol )ï¼Œç®€ç§° MOPã€‚</p>
<p>Raku å°±æœ‰ MOPï¼Œä½ å¯ä»¥è‡ªå·±åˆ›å»ºç±»ã€è§’è‰²ã€è¯­æ³•ï¼Œæ·»åŠ æ–¹æ³•å’Œå±æ€§ï¼Œå¹¶ä¸”å†…çœç±»ã€‚æ¯”å¦‚æˆ‘ä»¬å¯ä»¥è°ƒç”¨ MOP æŸ¥çœ‹ Rakudo æ˜¯å¦‚ä½•å®ç° Rat ç±»å‹ï¼ˆæœ‰ç†æ•°ï¼‰çš„ã€‚è°ƒç”¨ MOP ï¼Œåªè¦æŠŠä¸€èˆ¬çš„ <code>.</code> æ¢æˆ <code>.^</code> å°±å¯ä»¥äº†ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ raku
&gt; say join <span class="s1">&#39;, &#39;</span>, Rat.^attributes
<span class="nv">$!</span>numerator, <span class="nv">$!</span>denominator
&gt; <span class="c1"># åˆ—å‡ºå…¨éƒ¨æ–¹æ³•æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥éšæœºé€‰å‡ ä¸ª</span>
&gt; say join <span class="s1">&#39;, &#39;</span>, Rat.^methods<span class="o">(</span>:local<span class="o">)</span>.pick<span class="o">(</span>5<span class="o">)</span>
unpolar, ceiling, reals, Str, round
&gt; say Rat.^methods<span class="o">(</span>:local<span class="o">)</span>.grep<span class="o">(</span><span class="s1">&#39;log&#39;</span><span class="o">)</span>.<span class="o">[</span>0<span class="o">]</span>.signature.raku
:<span class="o">(</span>Numeric <span class="nv">$x</span>: Numeric <span class="nv">$base</span> <span class="o">=</span> <span class="o">{</span> ... <span class="o">}</span><span class="p">;;</span> *%_<span class="o">)</span>
</code></pre></div><p>æ˜¾ç¤ºå‡ºæ¥çš„è¿™å‡ è¡Œä¿¡æ¯ç›¸ä¿¡éƒ½æ˜¯ä¸è¨€è‡ªæ˜äº†ã€‚Rat æœ‰ä¸¤ä¸ªå±æ€§ï¼Œ<code>$!numerator</code> å’Œ <code>$!denominator</code>ï¼›æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œå…¶ä¸­ log æ–¹æ³•å¯æ¥å—çš„ç¬¬ä¸€ä¸ªå˜é‡æ˜¯æ•°å€¼å‹ invocant(è¯‘è€…æ³¨ï¼šä¸çŸ¥é“æ€ä¹ˆç¿»è¯‘ï¼Œåæ­£å°±æ˜¯å¯¹è±¡æœ¬èº«çš„å¼•ç”¨ <code>$_[0]</code> )ï¼Œç”¨å†’å·æ ‡è®°è¿‡ï¼›ç¬¬äºŒä¸ªå˜é‡å‚æ•°æ˜¯å¯é€‰çš„ï¼Œåå­—æ˜¯ <code>$base</code>ï¼Œå®ƒè®¾æœ‰ä¸€ä¸ªé»˜è®¤å€¼ï¼Œä¸è¿‡ Rakudo ä¸æ‰“ç®—å‘Šè¯‰ä½ â€¦â€¦</p>
<p>Raku çš„æ•°æ®åº“æ¥å£ä»£ç é‡Œæœ‰ä¸€ä¸ªå¾ˆä¸é”™çš„ä½¿ç”¨å®ä¾‹ã€‚å®ƒæœ‰ä¸€ä¸ªé€‰é¡¹ç”¨æ¥è®°å½•å¯¹è±¡çš„è°ƒç”¨ï¼Œä½†æ˜¯åªæ˜¯è®°å½•ä¸€éƒ¨åˆ†ç‰¹å®šè§’è‰²ï¼ˆæ¯”å¦‚å’Œè¿æ¥ç®¡ç†æˆ–è€…æ•°æ®æ£€ç´¢æœ‰å…³çš„ï¼‰ã€‚ä¸‹é¢æ˜¯ dbi é‡Œçš„ä»£ç ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">log-calls</span><span class="p">(</span><span class="nv">$obj</span><span class="o">,</span> <span class="n">Role</span> <span class="nv">$r</span><span class="p">)</span> <span class="p">{</span>
     <span class="k">my</span> <span class="nv">$wrapper</span> <span class="o">=</span> <span class="n">RoleHOW</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>

     <span class="k">for</span> <span class="nv">$r</span><span class="o">.^</span><span class="nb">methods</span> <span class="k">-&gt;</span> <span class="nv">$m</span> <span class="p">{</span>
         <span class="nv">$wrapper</span><span class="o">.^</span><span class="nb">add_method</span><span class="p">(</span><span class="nv">$m</span><span class="o">.</span><span class="nb">name</span><span class="o">,</span> <span class="k">method</span> <span class="p">(</span><span class="o">|</span><span class="nv">$c</span><span class="p">)</span> <span class="p">{</span>
             <span class="c1"># æ‰“å°æ—¥å¿—ä¿¡æ¯ï¼Œnote() å‡½æ•°è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯</span>
             <span class="nb">note</span> <span class="p">&#34;</span><span class="s2">&gt;&gt; </span><span class="nv">$m</span><span class="p">&#34;;</span>
             <span class="nb">nextsame</span><span class="p">;</span>
         <span class="p">});</span>
     <span class="p">}</span>

     <span class="nv">$wrapper</span><span class="o">.^</span><span class="nb">compose</span><span class="p">();</span>
     <span class="c1"># does æ“ä½œç¬¦å’Œ but ç±»ä¼¼ï¼Œä¸è¿‡åªä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„æ‹·è´</span>
     <span class="nv">$obj</span> <span class="k">does</span> <span class="nv">$wrapper</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">role</span> <span class="nc">Greet</span> <span class="p">{</span>
     <span class="k">method</span> <span class="nf">greet</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span>
         <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">hello, </span><span class="nv">$x</span><span class="p">&#34;;</span>
     <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">SomeGreeter</span> <span class="k">does</span> <span class="nc">Greet</span> <span class="p">{</span>
     <span class="k">method</span> <span class="nf">LOLGREET</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span>
         <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">OH HAI </span><span class="p">&#34;</span><span class="o">~</span> <span class="nb">uc</span> <span class="nv">$x</span><span class="p">;</span>
     <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$o</span> <span class="o">=</span> <span class="nf">log-calls</span><span class="p">(</span><span class="n">SomeGreeter</span><span class="o">.</span><span class="nb">new</span><span class="o">,</span> <span class="n">Greet</span><span class="p">);</span>
<span class="c1"># è®°å½•æ—¥å¿—å•¦ï¼Œå› ä¸ºç”± Greet è§’è‰²æä¾›äº†</span>
<span class="nv">$o</span><span class="o">.</span><span class="nf">greet</span><span class="p">(&#39;</span><span class="s1">you</span><span class="p">&#39;);</span>
<span class="c1"># æ²¡è®°å½•ï¼Œå› ä¸ºæ²¡è§’è‰²æä¾›è¿™ä¸ª</span>
<span class="nv">$o</span><span class="o">.</span><span class="nf">LOLGREET</span><span class="p">(&#39;</span><span class="s1">u</span><span class="p">&#39;);</span>
</code></pre></div><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>&gt;&gt; greet
hello, you
OH HAI U
</code></pre><p>æ‰€ä»¥è¯´ï¼Œæœ‰äº† MOP ï¼Œé™¤äº†æŒ‡å®šçš„è¯­æ³•ï¼Œä½ è¿˜å¯ä»¥åƒæ™®é€šæ¥å£ä¸€æ ·è®¿é—®ç±»ã€è§’è‰²ã€è¯­æ³•å’Œå±æ€§ã€‚è¿™ç»™äº†é¢å‘å¯¹è±¡æ›´å¤§çš„çµæ´»æ€§ï¼Œå¯ä»¥è½»æ¾çš„å†…çœå’Œä¿®æ”¹å¯¹è±¡äº†ã€‚</p>
<h2 id="ç¬¬23å¤©----ä¸€äº›ç²¾å½©çš„æ’åºç¤ºä¾‹">ç¬¬23å¤© -  ä¸€äº›ç²¾å½©çš„æ’åºç¤ºä¾‹</h2>
<p>ç»§ç»­æˆ‘ä»¬çš„åœ£ä¸´ç¤¼ç‰©ã€‚</p>
<p>æ’åºæ˜¯ä¸€ä¸ªéå¸¸éå¸¸å¸¸è§çš„ç¼–ç¨‹ä»»åŠ¡ã€‚Raku åŠ å¼ºäº†å®ƒçš„ <code>.sort</code> åŠŸèƒ½æ¥å¸®åŠ©å¤§å®¶æ›´å¥½çš„æ’åºã€‚
æœ€æœ€æ­£å¸¸çš„é»˜è®¤å†™æ³•æ˜¯è¿™æ ·çš„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@sorted</span> <span class="o">=</span> <span class="nv">@unsorted</span><span class="o">.</span><span class="nb">sort</span><span class="p">;</span> <span class="c1"># æˆ–è€…è¿™æ ·</span>
<span class="nb">sort</span> <span class="nv">@unsorted</span><span class="p">;</span>
</code></pre></div><p>å’Œ Perl 5 ä¸€æ ·ï¼Œä¹Ÿæ˜¯å¯ä»¥è‡ªå®šä¹‰å‡½æ•°çš„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># æ•°å€¼æ¯”è¾ƒ</span>
<span class="k">my</span> <span class="nv">@sorted</span> <span class="o">=</span> <span class="nv">@unsorted</span><span class="o">.</span><span class="nb">sort</span><span class="o">:</span> <span class="p">{</span> <span class="nv">$^a</span> <span class="p">&lt;</span><span class="s">=</span><span class="p">&gt;</span> <span class="nv">$^b</span> <span class="p">};</span>
<span class="c1"># æˆ–è€…ç”¨å‡½æ•°è°ƒç”¨çš„å½¢å¼</span>
<span class="k">my</span> <span class="nv">@sorted</span> <span class="o">=</span> <span class="nb">sort</span> <span class="p">{</span> <span class="nv">$^a</span> <span class="p">&lt;</span><span class="s">=</span><span class="p">&gt;</span> <span class="nv">$^b</span> <span class="p">}</span><span class="o">,</span> <span class="nv">@unsorted</span><span class="p">;</span>
<span class="c1"># å­—ç¬¦ä¸²æ¯”å¯¹ ( è·ŸPerl5çš„cmpä¸€æ · )</span>
<span class="k">my</span> <span class="nv">@sorted</span> <span class="o">=</span> <span class="nv">@unsorted</span><span class="o">.</span><span class="nb">sort</span><span class="o">:</span> <span class="p">{</span> <span class="nv">$^a</span> <span class="ow">leg</span> <span class="nv">$^b</span> <span class="p">};</span>
<span class="c1"># ç±»å‹ä¾èµ–æ¯”å¯¹</span>
<span class="k">my</span> <span class="nv">@sorted</span> <span class="o">=</span> <span class="nv">@unsorted</span><span class="o">.</span><span class="nb">sort</span><span class="o">:</span> <span class="p">{</span> <span class="nv">$^a</span> <span class="ow">cmp</span> <span class="nv">$^b</span> <span class="p">};</span>
</code></pre></div><p>ä½ ä¹Ÿå¯ä»¥æŠŠ <code>:</code> æ¢æˆ <code>()</code> ï¼Œç„¶åå†è·Ÿä¸Šä¸€äº›æ–¹æ³•è¿›è¡Œåç»­å¤„ç†ï¼Œæ¯”å¦‚ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@topten</span> <span class="o">=</span> <span class="nv">@scores</span><span class="o">.</span><span class="nb">sort</span><span class="p">(</span> <span class="p">{</span> <span class="nv">$^b</span> <span class="p">&lt;</span><span class="s">=</span><span class="p">&gt;</span> <span class="nv">$^a</span> <span class="p">}</span> <span class="p">)</span><span class="o">.</span><span class="nb">list</span><span class="o">.</span><span class="nf">munch</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</code></pre></div><p>å°æç¤ºï¼š <code>$a</code> å’Œ <code>$b</code> ä¸å†åƒåœ¨ Perl5 ä¸­é‚£æ ·æœ‰ç‰¹æ®Šå«ä¹‰äº†ï¼Œåœ¨ sort ä»£ç å—é‡Œç”¨åˆ«çš„å‘½åå˜é‡ <code>$var</code>ã€ä½ç½®å˜é‡ <code>$^var</code> æˆ–è€…å…¶ä»–ä»»ä½•çš„éƒ½è·Ÿåœ¨å…¶ä»–ä»£ç æ®µé‡Œä¸€æ ·ã€‚</p>
<p>ä½ å¯ä»¥ç›´æ¥åœ¨æ’åºçš„æ—¶å€™ç›´æ¥å°±åšå¥½å˜æ¢å‡½æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@sorted</span> <span class="o">=</span> <span class="nv">@unsorted</span><span class="o">.</span><span class="nb">sort</span><span class="o">:</span> <span class="p">{</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$^a</span><span class="p">)</span> <span class="ow">cmp</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$^b</span><span class="p">)</span> <span class="p">};</span>
</code></pre></div><p>ä¸è¿‡ <code>foo()</code> ä¼šåœ¨é‡å¤æ‰§è¡Œï¼Œå¦‚æœåˆ—è¡¨ä¸å¤§ä¹Ÿå°±ç½¢äº†ï¼Œå¦‚æœæ¯”è¾ƒå¤§çš„è¯â€¦â€¦å¦‚æœ <code>foo()</code> è¿˜æ˜¯ä¸ªè®¡ç®—å¯†é›†å‹çš„â€¦â€¦ä½ æ‡‚çš„ï¼</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒPerl 5 é‡Œæœ‰ä¸ªä¹ æƒ¯å°±æ˜¯ä½¿ç”¨æ–½ç“¦èŒ¨( Schwartzian )å˜æ¢ã€‚æ–½ç“¦èŒ¨å˜æ¢çš„åšæ³•å°±æ˜¯ decorate-sort-undecorateï¼Œ<code>foo()</code> å‡½æ•°åªç”¨æ‰§è¡Œä¸€æ¬¡ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@sorted</span> <span class="o">=</span>
    <span class="nb">map</span>  <span class="p">{</span> <span class="nv">$_-</span><span class="o">&gt;[</span><span class="mi">0</span><span class="o">]</span> <span class="p">}</span>
    <span class="nb">sort</span> <span class="p">{</span> <span class="nv">$a-</span><span class="o">&gt;[</span><span class="mi">1</span><span class="o">]</span> <span class="ow">cmp</span> <span class="nv">$b-</span><span class="o">&gt;[</span><span class="mi">1</span><span class="o">]</span> <span class="p">}</span>
    <span class="nb">map</span>  <span class="p">{</span> <span class="o">[</span><span class="nv">$_</span><span class="o">,</span> <span class="nf">foo</span><span class="p">(</span><span class="nv">$_</span><span class="p">)</span><span class="o">]</span> <span class="p">}</span>
    <span class="nv">@unsorted</span><span class="p">;</span>
</code></pre></div><p>Raku é‡Œï¼Œä½ ä¸€æ ·å¯ä»¥ä½¿ç”¨æ–½ç“¦èŒ¨å˜æ¢ï¼Œä¸è¿‡ Raku å†…ç½®äº†ä¸€äº›æ™ºèƒ½æ–¹æ³•ã€‚å¦‚æœä½ æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥å—çš„å‚æ•°ä¸ªæ•°æ˜¯ 0 æˆ– 1ï¼ŒRaku ä¼šè‡ªåŠ¨çš„æ›¿ä½ å¯ç”¨æ–½ç“¦èŒ¨å˜æ¢ã€‚</p>
<p>ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹ä¸€äº›ä¾‹å­å§ã€‚</p>
<ul>
<li>ä¸åŒºåˆ†å¤§å°å†™çš„æ’åº</li>
</ul>
<p>æŠŠæ¯ä¸ªå…ƒç´ éƒ½æ”¹æˆå°å†™ï¼Œç„¶åæŠŠæ•°ç»„æŒ‰ç…§å°å†™çš„æ¬¡åºæ’å¥½è¿”å›ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@sorted</span> <span class="o">=</span> <span class="nv">@unsorted</span><span class="o">.</span><span class="nb">sort</span><span class="o">:</span> <span class="p">{</span> <span class="o">.</span><span class="nb">lc</span> <span class="p">};</span>
</code></pre></div><ul>
<li>å•è¯é•¿åº¦æ’åº</li>
</ul>
<p>æŠŠæ¯ä¸ªå…ƒç´ çš„å•è¯æŒ‰ç…§ä»çŸ­åˆ°é•¿æ’åºã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@sorted</span> <span class="o">=</span> <span class="nv">@unsorted</span><span class="o">.</span><span class="nb">sort</span><span class="o">:</span> <span class="p">{</span> <span class="o">.</span><span class="nb">chars</span> <span class="p">};</span>
</code></pre></div><p>æˆ–è€…ä»é•¿åˆ°çŸ­:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@sorted</span> <span class="o">=</span> <span class="nv">@unsorted</span><span class="o">.</span><span class="nb">sort</span><span class="o">:</span> <span class="p">{</span> <span class="o">-.</span><span class="nb">chars</span> <span class="p">};</span>
</code></pre></div><ul>
<li>å¤šæ¬¡æ’åºæ¯”è¾ƒ</li>
</ul>
<p>ä½ å¯ä»¥åœ¨ <code>sort</code> ä»£ç å—é‡Œæ”¾å¤šä¸ªæ¯”è¾ƒå‡½æ•°ï¼Œ<code>sort</code> ä¼šæ³¨æ„æ‰§è¡Œç›´åˆ°é€€å‡ºã€‚æ¯”å¦‚åœ¨å•è¯é•¿åº¦çš„åŸºç¡€ä¸Šï¼Œå†æŒ‰ç…§ ASCII ç çš„é¡ºåºæ’åºã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="nv">@a</span><span class="o">.</span><span class="nb">sort</span><span class="o">:</span> <span class="p">{</span> <span class="nv">$^a</span><span class="o">.</span><span class="nb">chars</span><span class="o">,</span> <span class="nv">$^a</span> <span class="p">}</span> <span class="p">;</span>
</code></pre></div><p>ä¸è¿‡ï¼Œåœ¨ Rakudo é‡Œå¥½åƒè¿è¡Œæœ‰ç‚¹é—®é¢˜â€¦â€¦å®ƒåªä¼šæ¯”è¾ƒé•¿åº¦ä¸ä¼šæ¯”è¾ƒæ•°å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ10 æ’åœ¨ 2 çš„å‰é¢ã€‚ï¼ˆæ²¡å…³ç³»ï¼ŒTMTONTDIï¼‰</p>
<p>Raku é‡Œçš„ <code>sort</code> æœ¬èº«æ˜¯ç¨³å®šå·¥ä½œçš„ï¼Œä½ å¯ä»¥é‡å¤ä½¿ç”¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="nv">@a</span><span class="o">.</span><span class="nb">sort</span><span class="o">.</span><span class="nb">sort</span><span class="o">:</span> <span class="p">{</span> <span class="nv">$^a</span><span class="o">.</span><span class="nb">chars</span> <span class="p">};</span>
</code></pre></div><p>ä¸è¿‡è¿™æ · <code>sort</code> æœ‰ä¸¤æ¬¡è°ƒç”¨ï¼Œno fashionï¼æ‰€ä»¥ä½ è¿˜å¯ä»¥è¿™ä¹ˆå†™ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="nv">@a</span><span class="o">.</span><span class="nb">sort</span><span class="o">:</span> <span class="p">{</span> <span class="nv">$^a</span><span class="o">.</span><span class="nb">chars</span> <span class="p">&lt;</span><span class="s">=</span><span class="p">&gt;</span> <span class="nv">$^b</span><span class="o">.</span><span class="nb">chars</span> <span class="o">||</span> <span class="nv">$^a</span> <span class="ow">leg</span> <span class="nv">$^b</span> <span class="p">};</span>
</code></pre></div><p>ä¸è¿‡è¿™ä¸‹ä½ æœ‰ä¸¤ä¸ªå‚æ•°äº†ï¼ŒRaku æ²¡æ³•è‡ªåŠ¨ç»™ä½ å¯åŠ¨æ–½ç“¦èŒ¨å˜æ¢äº†ã€‚</p>
<p>åˆæˆ–è€…ï¼Œä½ å¯ä»¥åŠ ä¸Šä¸€ä¸ªç»™è‡ªç„¶æ•°æ’åºçš„å‡½æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="nv">@a</span><span class="o">.</span><span class="nb">sort</span><span class="o">:</span> <span class="p">{</span> <span class="nv">$^a</span><span class="o">.</span><span class="nb">chars</span><span class="o">.&amp;</span><span class="nf">naturally</span><span class="o">,</span> <span class="nv">$^a</span> <span class="p">};</span>
</code></pre></div><p>â€œç»™è‡ªç„¶æ•°æ’åºï¼Ÿâ€æˆ‘å¥½åƒå¬åˆ°ä½ ä»¬çš„å“­å£°äº†ï¼Œâ€œå“ªé‡Œæœ‰ï¼Ÿâ€ å¾ˆé«˜å…´ä½ ä»¬è¿™ä¹ˆé—®ï¼Œç°åœ¨ç»§ç»­è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<ul>
<li>è‡ªç„¶æ•°æ’åº</li>
</ul>
<p>æ ‡å‡†çš„è¯æ³•æ’åºæ˜¯æŒ‰ç…§ ASCII æ¬¡åºçš„ã€‚å…ˆæ˜¯è‡ªç„¶æ•°ï¼Œç„¶åæ˜¯å¤§å†™å­—æ¯ï¼Œæœ€åæ˜¯å°å†™å­—æ¯ã€‚æ‰€ä»¥äººä»¬åœ¨æ’åºçš„æ—¶å€™ç»å¸¸å¾—åˆ°è¿™æ ·çš„ç»“æœï¼š</p>
<pre><code>0
1
100
11
144th
2
21
210
3rd
33rd
AND
ARE
An
Bit
Can
and
by
car
d1
d10
d2
</code></pre><p>å®Œå…¨æ­£ç¡®ï¼Œä½†æ˜¯æ²¡ç”¨â€¦â€¦å°¤å…¶æ˜¯å¯¹éç¨‹åºå‘˜æ¥è¯´ï¼Œæ›´éƒé—·äº†å°±â€¦â€¦çœŸæ­£çš„è‡ªç„¶æ’åºï¼Œåº”è¯¥æ˜¯å…ˆæŒ‰æ•°å­¦é‡çº§æ’è‡ªç„¶æ•°ï¼Œç„¶åæ‰æ˜¯å¤§å°å†™å­—æ¯ã€‚æ¯”å¦‚ä¸Šé¢é‚£ä¸ªä¾‹å­ï¼Œåº”è¯¥æ’æˆè¿™æ ·ï¼š</p>
<pre><code>0
1
2
3rd
11
21
33rd
100
144th
210
An
AND
and
ARE
Bit
by
Can
car
d1
d2
d10
</code></pre><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¿…é¡»çš„åœ¨æ’åºçš„æ—¶å€™åŠ ä¸Šä¸€ç‚¹è½¬æ¢äº†ã€‚æˆ‘ä½¿ç”¨ <code>.subst</code> æ–¹æ³•ï¼Œè¿™æ˜¯æˆ‘ä»¬æ‰€ç†Ÿæ‚‰çš„ <code>s///</code> æ“ä½œç¬¦çš„é¢å‘å¯¹è±¡å½¢å¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">.</span><span class="nb">subst</span><span class="p">(/(</span><span class="se">\d</span><span class="o">+</span><span class="p">)/</span><span class="o">,</span> <span class="k">-&gt;</span> <span class="nv">$/</span> <span class="p">{</span> <span class="mi">0</span> <span class="o">~</span> <span class="nv">$0</span><span class="o">.</span><span class="nb">chars</span><span class="o">.</span><span class="nb">chr</span> <span class="o">~</span> <span class="nv">$0</span> <span class="p">}</span><span class="o">,</span> <span class="p">:</span><span class="s">g</span><span class="p">)</span>
</code></pre></div><p>ç¬¬ä¸€éƒ¨åˆ†ï¼Œæ•è·ä¸€ä¸ªè¿ç»­çš„æ•°å­—ï¼Œç„¶åç”± <code>-&gt; $/ {}</code> æ„æˆä¸€ä¸ªå°–å·å—ï¼Œæ„æ€æ˜¯ï¼šâ€œä¼ é€’åŒ¹é…åˆ° <code>$/</code> çš„æ•°ç»„åˆ° <code>{}</code> ä»£ç é‡Œâ€ã€‚ç„¶åä»£ç é‡Œæ›¿æ¢æˆç”¨ 0 æŒ‰ç…§æ•°é‡çº§æ’åºçš„é¡ºåºè”ç»“çš„å­—ç¬¦ä¸²ã€‚è¿™ä¸ª 0 æ˜¯ä»¥ ASCII å­—ç¬¦ä¸²å‡ºç°ï¼Œè”ç»“åœ¨åŸå§‹å­—ç¬¦ä¸²ä¸Šçš„ã€‚æœ€å <code>/g</code> è¡¨ç¤ºå…¨å±€æ›¿æ¢ã€‚</p>
<p>å¦‚æœä¹Ÿä¸åŒºåˆ†å¤§å°å†™ï¼Œé‚£ä¹ˆï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">.</span><span class="nb">lc</span><span class="o">.</span><span class="nb">subst</span><span class="p">(/(</span><span class="se">\d</span><span class="o">+</span><span class="p">)/</span><span class="o">,</span> <span class="k">-&gt;</span> <span class="nv">$/</span> <span class="p">{</span> <span class="mi">0</span> <span class="o">~</span> <span class="nv">$0</span><span class="o">.</span><span class="nb">chars</span><span class="o">.</span><span class="nb">chr</span> <span class="o">~</span> <span class="nv">$0</span> <span class="p">}</span><span class="o">,</span> <span class="p">:</span><span class="s">g</span><span class="p">)</span>
</code></pre></div><p>æ”¹æˆå­ä¾‹ç¨‹çš„æ–¹å¼ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">naturally</span> <span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$a</span><span class="o">.</span><span class="nb">lc</span><span class="o">.</span><span class="nb">subst</span><span class="p">(/(</span><span class="se">\d</span><span class="o">+</span><span class="p">)/</span><span class="o">,</span> <span class="k">-&gt;</span> <span class="nv">$/</span> <span class="p">{</span> <span class="mi">0</span> <span class="o">~</span> <span class="nv">$0</span><span class="o">.</span><span class="nb">chars</span><span class="o">.</span><span class="nb">chr</span> <span class="o">~</span> <span class="nv">$0</span> <span class="p">}</span><span class="o">,</span> <span class="p">:</span><span class="s">g</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div><p>çœ‹èµ·æ¥å¾ˆä¸é”™äº†ï¼Œä¸è¿‡è¿˜æœ‰ç‚¹å°é—®é¢˜ï¼Œæ¯”å¦‚ THE ã€ The å’Œ the ä¼šæŒ‰ç…§ä»–ä»¬åœ¨åˆ—è¡¨é‡Œçš„é¡ºåºè¿”å›ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬é¢„è®¡çš„é¡ºåºã€‚æœ‰ä¸ªç®€å•çš„è§£å†³åŠæ³•ï¼Œå°±æ˜¯åœ¨è½¬æ¢è¿‡çš„å…ƒç´ çš„ç»“å°¾ï¼ŒåŠ ä¸Šä¸€ä¸ªä¸­æ–­ã€‚æ‰€ä»¥æœ€ç»ˆç»“æœæ˜¯ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">naturally</span> <span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$a</span><span class="o">.</span><span class="nb">lc</span><span class="o">.</span><span class="nb">subst</span><span class="p">(/(</span><span class="se">\d</span><span class="o">+</span><span class="p">)/</span><span class="o">,</span> <span class="k">-&gt;</span> <span class="nv">$/</span> <span class="p">{</span> <span class="mi">0</span> <span class="o">~</span> <span class="nv">$0</span><span class="o">.</span><span class="nb">chars</span><span class="o">.</span><span class="nb">chr</span> <span class="o">~</span> <span class="nv">$0</span> <span class="p">}</span><span class="o">,</span> <span class="p">:</span><span class="s">g</span><span class="p">)</span> <span class="o">~</span> <span class="p">&#34;</span><span class="se">\x</span><span class="mh">0</span><span class="p">&#34;</span> <span class="o">~</span> <span class="nv">$a</span>
<span class="p">}</span>
</code></pre></div><p>ç„¶åä½ çœ‹ï¼Œè¿™ä¸ªå­ä¾‹ç¨‹åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¯ä»¥ç”¨ä¸Šæ–½ç“¦èŒ¨å˜æ¢äº†ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="p">&lt;</span><span class="s">0 1 100 11 144th 2 21 210 3rd 33rd AND ARE An Bit Can and by car d1 d10 d2</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">sort</span><span class="o">:</span> <span class="p">{</span> <span class="o">.&amp;</span><span class="nf">naturally</span> <span class="p">};</span>
</code></pre></div><p>æˆ–è€…ç”¨æ¥ç»™ ip æ’åºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@ips</span> <span class="o">=</span> <span class="p">((</span><span class="mi">0</span><span class="o">..</span><span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="nb">roll</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;</span><span class="s1">.</span><span class="p">&#39;)</span><span class="k">for</span> <span class="mi">0</span><span class="o">..</span><span class="mi">99</span><span class="p">);</span>
<span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="nv">@ips</span><span class="o">.</span><span class="nb">sort</span><span class="o">:</span> <span class="p">{</span> <span class="o">.&amp;</span><span class="nf">naturally</span> <span class="p">};</span>
</code></pre></div><p>è¾“å‡º:</p>
<pre><code>4.108.172.65
5.149.121.70
10.24.201.53
11.10.90.219
12.83.84.206
12.124.106.41
12.162.149.98
14.203.88.93
16.18.0.178
17.68.226.104
21.201.181.225
23.61.166.202
</code></pre><p>ä»¥åŠç›®å½•æ’åºå•Šç­‰ç­‰å„ç§æ•°å­—ä¸å­—æ¯çš„æ··åˆä½“ã€‚</p>
<p>æœ€åï¼Œåœ£è¯å¿«ä¹ï¼Œæ’åºå¿«ä¹ï¼Œæ„¿æ–½ç“¦èŒ¨ä¸ä½ åŒåœ¨ï¼</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/calendar" term="calendar" label="calendar" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku æ ¸å¿ƒé­”æ”¹: Grammar çš„èƒ¡è¨€ä¹±è¯­]]></title>
            <link href="https://ohmyweekly.github.io/notes/2016-01-01-raku-core-hacking-grammatical-babble/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2015-11-16-a-mutable-grammar-for-raku/?utm_source=atom_feed" rel="related" type="text/html" title="A Mutable Grammar for Raku" />
                <link href="https://ohmyweekly.github.io/notes/2016-02-05-raku-grammars/?utm_source=atom_feed" rel="related" type="text/html" title="Raku Grammars" />
                <link href="https://ohmyweekly.github.io/notes/2015-04-27-from-regex-to-grammar-part-one/?utm_source=atom_feed" rel="related" type="text/html" title="ä»æ­£åˆ™è¡¨è¾¾å¼åˆ° Grammar(ç¬¬ä¸€éƒ¨åˆ†)" />
                <link href="https://ohmyweekly.github.io/notes/2015-10-29-from-regex-to-grammar/?utm_source=atom_feed" rel="related" type="text/html" title="ä»æ­£åˆ™è¡¨è¾¾å¼åˆ° Grammar(ç¬¬äºŒéƒ¨åˆ†)" />
                <link href="https://ohmyweekly.github.io/notes/2015-07-11-an-example-of-parsing-text-in-grammar/?utm_source=atom_feed" rel="related" type="text/html" title="ä½¿ç”¨ Grammar è§£ææ–‡æœ¬: ä¸€ä¸ªä¾‹å­" />
            
                <id>https://ohmyweekly.github.io/notes/2016-01-01-raku-core-hacking-grammatical-babble/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Raku Core Hacking Grammatical Babble</blockquote><p>å–œæ¬¢ä¿®å¤ Raku ç¼–è¯‘å™¨ä¸­çš„ bug? è¿™å„¿æœ‰ä¸€ä¸ª<a href="https://rt.perl.org/Ticket/Display.html?id=128304">great grammar bugglet</a>: å½“ <code>â€â€</code> å¼•å·ç”¨åœ¨å¼•èµ·çš„ç”¨ç©ºç™½åˆ†å‰²çš„å•è¯åˆ—è¡¨æ„é€ å™¨ä¸­æ—¶çœ‹èµ·æ¥å¥½åƒä¸èƒ½å·¥ä½œ:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> â€<span class="n">hello</span> <span class="n">world</span>â€<span class="p">;</span>
<span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="k">q</span><span class="sa">ww</span><span class="p">&lt;</span><span class="s2">â€hello worldâ€</span><span class="p">&gt;;</span>
<span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="k">q</span><span class="sa">ww</span><span class="p">&lt;</span><span class="s2">&#34;hello world&#34;</span><span class="p">&gt;;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># hello world</span>
<span class="c1"># â€hello</span>
<span class="c1"># worldâ€</span>
<span class="c1"># hello world</span>
</code></pre></div><p><code>â€</code> å¼•å·ä¸åº”è¯¥å‡ºç°åœ¨è¾“å‡ºä¸­å¹¶ä¸”åœ¨è¾“å‡ºä¸­æˆ‘ä»¬åº”è¯¥åªæœ‰ 3 è¡Œè¾“å‡º; è¿™ 3 è¡Œè¾“å‡ºéƒ½æ˜¯ <code>hello world</code>ã€‚çœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªå¾…ä¿®å¤çš„æœ‰è¶£çš„ bug! æˆ‘ä»¬è¿›å»çœ‹çœ‹ã€‚</p>
<h2 id="ä½ æ€æ ·æ‹¼å†™å®ƒ">ä½ æ€æ ·æ‹¼å†™å®ƒ?</h2>
<p>äº‹å®ä¸Šè¿™æ®µä»£ç æ²¡èƒ½æ­£ç¡®è§£æè¡¨æ˜è¿™æ˜¯ä¸€ä¸ª grammar bugã€‚å¤§éƒ¨åˆ†çš„ grammar ä½åœ¨ <a href="https://github.com/rakudo/rakudo/blob/83b8b1a/src/Raku/Grammar.nqp">src/Raku/Grammar.nqp</a>ä¸­, ä½†æ˜¯åœ¨æˆ‘ä»¬çš„æ‰‹å˜è„ä¹‹å‰, è®©æˆ‘ä»¬æ¥è§£å†³æˆ‘ä»¬åº”è¯¥æŸ¥çœ‹ä»€ä¹ˆã€‚</p>
<p>äºŒè¿›åˆ¶ <code>raku</code> æœ‰ä¸€ä¸ª <code>--target</code> å‘½ä»¤è¡Œå‚æ•°æ¥æ¥æ”¶å…¶ä¸­ä¹‹ä¸€çš„ç¼–è¯‘æ­¥éª¤å¹¶ä¸”ä¼šå¯¼è‡´é‚£ä¸ªæ­¥éª¤çš„è¾“å‡ºè¢«äº§ç”Ÿå‡ºæ¥ã€‚é‚£å„¿æœ‰å“ªäº›æ­¥éª¤? æ ¹æ®ä½ æ­£ä½¿ç”¨çš„åç«¯å®ƒä»¬ä¹Ÿä¼šæœ‰æ‰€ä¸åŒ, ä½†æ˜¯ä½ å¯ä»¥ä»…ä»…è¿è¡Œ <code>raku --stagestats -e ''</code> æŠŠå®ƒä»¬éƒ½æ‰“å°å‡ºæ¥:</p>
<pre><code>zoffix@leliana:~$ raku --stagestats -e ''
Stage start      :   0.000
Stage parse      :   0.077
Stage syntaxcheck:   0.000
Stage ast        :   0.000
Stage optimize   :   0.001
Stage mast       :   0.004
Stage mbc        :   0.000
Stage moar       :   0.000
</code></pre><p>Grammars æ˜¯å…³äºè§£æçš„, æ‰€ä»¥æˆ‘ä»¬ä¼šæŸ¥è¯¢ <code>parse</code> ç›®æ ‡(target)ã€‚è‡³äºè¦æ‰§è¡Œçš„ä»£ç , æˆ‘ä»¬ä¼šä»…ä»…ç»™å®ƒæœ‰é—®é¢˜çš„é‚£å—; å³ <code>qww&lt;&gt;</code>:</p>
<pre><code>zoffix@leliana:~$ raku --target=parse -e 'qww&lt;â€hello worldâ€&gt;'
- statementlist: qww&lt;â€hello worldâ€&gt;
  - statement: 1 matches
    - EXPR: qww&lt;â€hello worldâ€&gt;
      - value: qww&lt;â€hello worldâ€&gt;
        - quote: qww&lt;â€hello worldâ€&gt;
          - quibble: &lt;â€hello worldâ€&gt;
            - babble:
              - B:
            - nibble: â€hello worldâ€
          - quote_mod: ww
            - sym: ww
</code></pre><p>é‚£å¾ˆæ£’! æ¯ä¸€è¡Œå‰é¢éƒ½æœ‰èƒ½åœ¨ grammar ä¸­æ‰¾åˆ°çš„ token çš„åå­—, æ‰€ä»¥ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†åœ¨å“ªé‡ŒæŸ¥æ‰¾é—®é¢˜ã€‚</p>
<p>æˆ‘ä»¬è¿˜çŸ¥é“åŸºæœ¬çš„å¼•å·èƒ½æ­£ç¡®åœ°å·¥ä½œ, æ‰€ä»¥æˆ‘ä»¬ä¹Ÿå€¾å€’å‡ºå®ƒä»¬çš„è§£ææ­¥éª¤, æ¥çœ‹çœ‹è¿™ä¸¤ä¸ªè¾“å‡ºä¹‹é—´æ˜¯å¦æœ‰ä»€ä¹ˆä¸åŒ:</p>
<pre><code>zoffix@leliana:~$ raku --target=parse -e 'qww&lt;&quot;hello world&quot;&gt;'
- statementlist: qww&lt;&quot;hello world&quot;&gt;
  - statement: 1 matches
    - EXPR: qww&lt;&quot;hello world&quot;&gt;
      - value: qww&lt;&quot;hello world&quot;&gt;
        - quote: qww&lt;&quot;hello world&quot;&gt;
          - quibble: &lt;&quot;hello world&quot;&gt;
            - babble:
              - B:
            - nibble: &quot;hello world&quot;
          - quote_mod: ww
            - sym: ww
</code></pre><p>é‚£ä¹ˆ&hellip; å¥½å§, é™¤äº†å¼•å·ä¸åŒ, è§£ææ•°å®Œå…¨ä¸€æ ·ã€‚æ‰€ä»¥å®ƒçœ‹èµ·æ¥å¥½åƒæ‰€æœ‰æ¶‰åŠçš„ tokens éƒ½æ˜¯ç›¸åŒçš„, ä½†æ˜¯é‚£äº› tokens æ‰€åšçš„äº‹æƒ…ä¸åŒã€‚</p>
<p>æˆ‘ä»¬ä¸å¿…æ£€æŸ¥è¾“å‡ºä¸­æˆ‘ä»¬çœ‹åˆ°çš„æ¯ä¸ª tokensã€‚<code>statementlist</code> å’Œ <code>statement</code> æ˜¯åŒ¹é…æ™®é€šè¯­å¥çš„ tokens, <code>EXPR</code> æ˜¯å ä½ç¬¦è§£æå™¨, <code>value</code> æ˜¯å®ƒæ­£æ“ä½œçš„å€¼ä¸­çš„ä¸€ä¸ªã€‚æˆ‘ä»¬ä¼šå¿½ç•¥ä¸Šé¢é‚£äº›, ç•™ç»™æˆ‘ä»¬çš„æ˜¯ä¸‹é¢è¿™æ ·ä¸€ä¸ªå¯ç–‘çš„åˆ—è¡¨:</p>
<pre><code>- quote: qww&lt;â€hello worldâ€&gt;
  - quibble: &lt;â€hello worldâ€&gt;
    - babble:
      - B:
    - nibble: â€hello worldâ€
  - quote_mod: ww
    - sym: ww
</code></pre><p>è®©æˆ‘ä»¬å¼€å§‹è´¨é—®å®ƒä»¬ã€‚</p>
<h2 id="åˆ°å…”å­æ´é‡Œå»">åˆ°å…”å­æ´é‡Œå»&hellip;</h2>
<p>ä½ è‡ªå·±æä¸€ä»½æœ¬åœ°çš„ <a href="https://github.com/rakudo/rakudo/">Rakudo ä»“åº“</a>, å¦‚æœä½ å·²ç»æœ‰äº†ä¸€ä»½,é‚£ä¹ˆæ‰“å¼€ <a href="https://github.com/rakudo/rakudo/blob/83b8b1a/src/Raku/Grammar.nqp">src/Raku/Grammar.nqp</a>, ç„¶åæ”¾æ¾ç‚¹ã€‚</p>
<p>æˆ‘ä»¬ä¼šä»æ ‘çš„é¡¶éƒ¨åˆ°åº•éƒ¨è·Ÿéšæˆ‘ä»¬çš„ tokens, æ‰€ä»¥æˆ‘ä»¬é¦–å…ˆéœ€è¦æ‰¾åˆ°çš„æ˜¯ <code>token quote</code>, <code>rule quote</code>, <code>regex quote</code> æˆ– <code>method quote</code>; ä»¥é‚£ä¸ªé¡ºåºæœç´¢, å› ä¸ºç¬¬ä¸€é¡¹å¾ˆå¯èƒ½å°±æ˜¯æ­£ç¡®çš„ä¸œè¥¿ã€‚</p>
<p>è¿™ç§æƒ…å†µä¸‹, å®ƒæ˜¯ä¸€ä¸ª <a href="https://github.com/rakudo/rakudo/blob/83b8b1a/src/Raku/Grammar.nqp#L3555">token quote</a>, å®ƒæ˜¯ä¸€ä¸ª <a href="https://docs.raku.org/language/grammars#Protoregexes">proto regex</a>ã€‚æˆ‘ä»¬çš„ä»£ç ä½¿ç”¨äº†å®ƒçš„ <code>q</code> ç‰ˆæœ¬å¹¶ä¸”ä½ è¿˜å¯ä»¥è®¤å‡ºé è¿‘å®ƒçš„ <code>qq</code> å’Œ <code>Q</code> ç‰ˆæœ¬:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">token</span> <span class="nf">quote:sym</span>&lt;q&gt; <span class="p">{</span><span class="sr">
</span><span class="sr">    </span><span class="o">:</span><span class="kd">my</span> <span class="nv">$qm</span><span class="p">;</span><span class="sr">
</span><span class="sr">    </span><span class="p">&#39;</span><span class="s1">q</span><span class="p">&#39;</span><span class="sr">
</span><span class="sr">    </span><span class="p">[</span><span class="sr">
</span><span class="sr">    </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">quote_mod</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">{}</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">.</span><span class="nf">qok</span><span class="p">(</span><span class="nv">$/</span><span class="p">)&gt;</span><span class="sr"> </span><span class="p">{</span> <span class="nv">$qm</span> <span class="o">:=</span> <span class="nv">$&lt;quote_mod&gt;</span><span class="o">.</span><span class="nb">Str</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="p">&lt;</span><span class="nf">quibble</span><span class="p">(</span><span class="vg">%*LANG</span><span class="p">&lt;</span><span class="s">Quote</span><span class="p">&gt;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">q</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$qm</span><span class="p">)&gt;</span><span class="sr">
</span><span class="sr">    </span><span class="o">|</span><span class="sr"> </span><span class="p">{}</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">.</span><span class="nf">qok</span><span class="p">(</span><span class="nv">$/</span><span class="p">)&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">quibble</span><span class="p">(</span><span class="vg">%*LANG</span><span class="p">&lt;</span><span class="s">Quote</span><span class="p">&gt;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">q</span><span class="p">&#39;)&gt;</span><span class="sr">
</span><span class="sr">    </span><span class="p">]</span><span class="sr">
</span><span class="sr">}
</span><span class="sr">
</span><span class="sr">token quote</span><span class="p">:</span><span class="na">sym</span><span class="p">&lt;</span><span class="nf">qq</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">{</span>
    <span class="p">:</span><span class="s">my</span> <span class="nv">$qm</span><span class="p">;</span>
    <span class="p">&#39;</span><span class="s1">qq</span><span class="p">&#39;</span>
    <span class="o">[</span>
    <span class="o">|</span> <span class="p">&lt;</span><span class="s">quote_mod</span><span class="p">&gt;</span> <span class="p">{</span> <span class="nv">$qm</span> <span class="o">:=</span> <span class="nv">$&lt;quote_mod&gt;</span><span class="o">.</span><span class="nb">Str</span> <span class="p">}</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">.</span><span class="nf">qok</span><span class="p">(</span><span class="nv">$/</span><span class="p">)&gt;</span><span class="sr">
</span><span class="sr">        </span><span class="p">&lt;</span><span class="nf">quibble</span><span class="p">(</span><span class="vg">%*LANG</span><span class="p">&lt;</span><span class="s">Quote</span><span class="p">&gt;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">qq</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$qm</span><span class="p">)&gt;</span><span class="sr">
</span><span class="sr">    </span><span class="o">|</span><span class="sr"> </span><span class="p">{}</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">.</span><span class="nf">qok</span><span class="p">(</span><span class="nv">$/</span><span class="p">)&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">quibble</span><span class="p">(</span><span class="vg">%*LANG</span><span class="p">&lt;</span><span class="s">Quote</span><span class="p">&gt;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">qq</span><span class="p">&#39;)&gt;</span><span class="sr">
</span><span class="sr">    </span><span class="p">]</span>
<span class="p">}</span>

<span class="k">token</span> <span class="nf">quote:sym</span>&lt;Q&gt; <span class="p">{</span><span class="sr">
</span><span class="sr">    </span><span class="o">:</span><span class="kd">my</span> <span class="nv">$qm</span><span class="p">;</span><span class="sr">
</span><span class="sr">    </span><span class="p">&#39;</span><span class="s1">Q</span><span class="p">&#39;</span><span class="sr">
</span><span class="sr">    </span><span class="p">[</span><span class="sr">
</span><span class="sr">    </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">quote_mod</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">{</span> <span class="nv">$qm</span> <span class="o">:=</span> <span class="nv">$&lt;quote_mod&gt;</span><span class="o">.</span><span class="nb">Str</span> <span class="p">}</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">.</span><span class="nf">qok</span><span class="p">(</span><span class="nv">$/</span><span class="p">)&gt;</span><span class="sr">
</span><span class="sr">        </span><span class="p">&lt;</span><span class="nf">quibble</span><span class="p">(</span><span class="vg">%*LANG</span><span class="p">&lt;</span><span class="s">Quote</span><span class="p">&gt;</span><span class="o">,</span> <span class="nv">$qm</span><span class="p">)&gt;</span><span class="sr">
</span><span class="sr">    </span><span class="o">|</span><span class="sr"> </span><span class="p">{}</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">.</span><span class="nf">qok</span><span class="p">(</span><span class="nv">$/</span><span class="p">)&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">quibble</span><span class="p">(</span><span class="vg">%*LANG</span><span class="p">&lt;</span><span class="s">Quote</span><span class="p">&gt;)&gt;</span><span class="sr">
</span><span class="sr">    </span><span class="p">]</span><span class="sr">
</span><span class="sr"></span><span class="p">}</span>
</code></pre></div><p>å¯ä»¥çœ‹åˆ° <code>qq</code> å’Œ <code>Q</code> çš„ä¸»ä½“çœ‹èµ·æ¥åƒ <code>q</code>, æˆ‘ä»¬ä¹Ÿæ¥çœ‹çœ‹å®ƒä»¬æ˜¯å¦æœ‰æˆ‘ä»¬è¦æ‰¾çš„é‚£ä¸ª bug:</p>
<pre><code>zoffix@leliana:~$ raku -e '.say for qqww&lt;â€hello worldâ€&gt;'
â€hello
worldâ€
zoffix@leliana:~$ raku -e '.say for Qww&lt;â€hello worldâ€&gt;'
â€hello
world
</code></pre><p>æ˜¯çš„, å®ƒä»¬ä¹Ÿå­˜åœ¨, æ‰€ä»¥ <code>token quote</code> ä¸å¯èƒ½æ˜¯é‚£ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬æ¥åˆ†è§£ä¸‹ <code>token quote:sym&lt;q&gt;</code> æ˜¯åšä»€ä¹ˆçš„, æ¥ç®—å‡ºæ€ä¹ˆè¿›è¡Œåˆ°ä¸‹ä¸€æ­¥; å®ƒçš„å¤‡é€‰ä¹‹ä¸€æ²¡æœ‰è¢«ç”¨åœ¨æˆ‘ä»¬å½“å‰çš„ä»£ç ä¸­, æ‰€ä»¥æˆ‘ä¼šçœç•¥å®ƒ:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">token</span> <span class="nf">quote:sym</span>&lt;q&gt; <span class="p">{</span><span class="sr">
</span><span class="sr">    </span><span class="o">:</span><span class="kd">my</span> <span class="nv">$qm</span><span class="p">;</span><span class="sr">
</span><span class="sr">    </span><span class="p">&#39;</span><span class="s1">q</span><span class="p">&#39;</span><span class="sr">
</span><span class="sr">    </span><span class="p">[</span><span class="sr">
</span><span class="sr">    </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">quote_mod</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">{}</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">.</span><span class="nf">qok</span><span class="p">(</span><span class="nv">$/</span><span class="p">)&gt;</span><span class="sr"> </span><span class="p">{</span> <span class="nv">$qm</span> <span class="o">:=</span> <span class="nv">$&lt;quote_mod&gt;</span><span class="o">.</span><span class="nb">Str</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="p">&lt;</span><span class="nf">quibble</span><span class="p">(</span><span class="vg">%*LANG</span><span class="p">&lt;</span><span class="s">Quote</span><span class="p">&gt;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">q</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$qm</span><span class="p">)&gt;</span><span class="sr">
</span><span class="sr">    </span><span class="o">|</span><span class="sr"> </span><span class="c1"># (this branch omited)
</span><span class="c1"></span><span class="sr">    </span><span class="p">]</span><span class="sr">
</span><span class="sr"></span><span class="p">}</span>
</code></pre></div><p>åœ¨ç¬¬äºŒè¡Œä¸­, æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå˜é‡, ç„¶ååŒ¹é…å­—é¢å€¼ <code>q</code> ç„¶åæ˜¯ <code>quote_mod</code> tokenã€‚é‚£ä¸ªæ˜¯æˆ‘ä»¬çš„ <code>--target=parse</code> è¾“å‡ºä¸­çš„ä¸€éƒ¨åˆ†å¹¶ä¸”å¦‚æœä½ åƒæˆ‘ä»¬æ‰¾å‡º <code>quote</code> token é‚£æ ·æ‰¾å‡ºå®ƒ, ä½ ä¼šæ³¨æ„åˆ°å®ƒæ˜¯ä¸€ä¸ª proto regex, å³, åœ¨é‚£ç§æƒ…å†µä¸‹, åŒ¹é…æˆ‘ä»¬ä»£ç çš„ <code>ww</code> å—ã€‚åé¢è·Ÿç€çš„ç©º <code>{}</code> å—æˆ‘ä»¬å¯ä»¥å¿½ç•¥(é‚£æ˜¯ä¸€ä¸ª bug çš„æ›¿ä»£æ–¹æ³•å¯èƒ½åœ¨ä½ è¯»åˆ°è¿™å„¿æ—¶å·²ç»è¢«ä¿®å¤äº†)ã€‚ç›®å‰ä¸ºæ­¢, æˆ‘ä»¬å·²ç»åŒ¹é…äº†æˆ‘ä»¬ä»£ç çš„ <code>qww</code> å—ã€‚</p>
<p>å†å¾€å‰èµ°, æˆ‘ä»¬é‡è§äº†å¯¹ <code>qok</code> token çš„è°ƒç”¨, å½“å‰çš„ <a href="https://docs.raku.org/type/Match">Match</a> å¯¹è±¡ä½œä¸ºå…¶å‚æ•°ã€‚<code>&lt;.qok&gt;</code> ä¸­çš„ç‚¹å·è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªéæ•è· token åŒ¹é…, è¿™å°±æ˜¯å®ƒä¸ºä»€ä¹ˆå®ƒæ²¡æœ‰åœ¨æˆ‘ä»¬çš„ <code>--target=parse</code> è¾“å‡ºä¸­å‡ºç°çš„åŸå› ã€‚æˆ‘ä»¬å®šä½åˆ°é‚£ä¸ª token å¹¶çœ‹çœ‹å®ƒæ˜¯å…³äºä»€ä¹ˆçš„:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">token</span> <span class="nf">qok</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span><span class="sr">
</span><span class="sr">    </span><span class="o">Â»</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">!</span><span class="p">[</span><span class="sr">(</span><span class="p">]&gt;</span><span class="sr">
</span><span class="sr">    </span><span class="p">[</span><span class="sr">
</span><span class="sr">        </span><span class="p">&lt;</span><span class="o">?</span><span class="p">[</span><span class="sr">:</span><span class="p">]&gt;</span><span class="sr"> </span><span class="o">||</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">!</span><span class="p">{</span>
            <span class="k">my</span> <span class="nv">$n</span> <span class="o">:=</span> <span class="o">~</span><span class="nv">$x</span><span class="p">;</span> <span class="vg">$*W</span><span class="o">.</span><span class="nf">is_name</span><span class="p">(</span><span class="o">[</span><span class="nv">$n</span><span class="o">]</span><span class="p">)</span> <span class="o">||</span> <span class="vg">$*W</span><span class="o">.</span><span class="nf">is_name</span><span class="p">(</span><span class="o">[</span><span class="p">&#39;</span><span class="s1">&amp;</span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$n</span><span class="o">]</span><span class="p">)</span>
        <span class="p">}&gt;</span><span class="sr">
</span><span class="sr">    </span><span class="p">]</span><span class="sr">
</span><span class="sr">    </span><span class="p">[</span><span class="sr"> </span><span class="se">\s</span><span class="o">*</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">#</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">.</span><span class="nf">panic</span><span class="p">:</span> <span class="p">&#34;</span><span class="s2"># not allowed as delimiter</span><span class="p">&#34;&gt;</span><span class="sr"> </span><span class="p">]</span><span class="o">?</span><span class="sr">
</span><span class="sr">    </span><span class="p">&lt;</span><span class="o">.</span><span class="ow">ws</span><span class="p">&gt;</span><span class="sr">
</span><span class="sr"></span><span class="p">}</span>
</code></pre></div><p>æˆ‘çš„å¤©å‘! è¿™ä¹ˆå¤šç¬¦å·, ä½†æ˜¯è¿™ä¸ªå®¶ä¼™å¾ˆå®¹æ˜“äº†: <code>Â»</code> æ˜¯ä¸€ä¸ª<a href="https://docs.raku.org/language/regexes#%3C%3C_and_%3E%3E_,_left_and_right_word_boundary">å³å•è¯è¾¹ç•Œ</a>åé¢ä¸èƒ½è·Ÿç€ä¸€ä¸ªå¼€åœ†æ‹¬å·(<code>&lt;![(]&gt;</code>), å†è·Ÿç€ä¸€ä¸ªå¤‡é€‰åˆ†æ”¯(<code>[]</code>), å†è·Ÿç€ä¸€ä¸ªæ£€æŸ¥, å³æˆ‘ä»¬ä¸æƒ³å°è¯•ä½¿ç”¨ <code>#</code> å·ä½œä¸ºåˆ†å‰²ç¬¦(<code>[...]?</code>), æœ€åè·Ÿç€ä¸€ä¸ª <a href="https://docs.raku.org/language/grammars#ws">&lt;.ws&gt;</a> token åå™¬å„ç§å„æ ·çš„ç©ºç™½ã€‚</p>
<p>åœ¨å¤‡é€‰åˆ†æ”¯ä¸­, æˆ‘ä»¬ä½¿ç”¨äº†é¦–ä¸ªtokenåŒ¹é…çš„ <code>||</code> å¤‡é€‰åˆ†æ”¯(å’Œæœ€é•¿tokenåŒ¹é… <code>|</code> ç›¸å), å¹¶ä¸”é¦–ä¸ª token å‘å‰æŸ¥çœ‹ä¸€ä¸ªå†’å· <code>&lt;?[:]&gt;</code>ã€‚ å¦‚æœå¤±è´¥äº†, æˆ‘ä»¬å°±å­—ç¬¦ä¸²åŒ–é‚£ä¸ªç»™å®šçš„å‚æ•°(<code>~$x</code>)å¹¶ä¸”ä¹‹ååœ¨ <a href="https://github.com/rakudo/rakudo/blob/83b8b1a/src/Raku/World.nqp">Worldå¯¹è±¡</a> èº«ä¸Šè°ƒç”¨ <code>is_name</code> æ–¹æ³•, åŸæ ·åœ°ä¼ é€’å¸¦æœ‰å‰ç½® <code>&amp;</code> ç¬¦å·çš„å­—ç¬¦ä¸²åŒ–çš„å‚æ•°ã€‚ä¼ é€’çš„ <code>~$x</code> æ˜¯ç›®å‰ä¸ºæ­¢æˆ‘ä»¬çš„ <code>token quote:sym&lt;q&gt;</code> token æ‰€åŒ¹é…åˆ°çš„ä¸œè¥¿(å¹¶ä¸”é‚£æ˜¯å­—ç¬¦ä¸² <code>qww</code>)ã€‚<code>is_name</code> æ–¹æ³•ä»…ä»…æ£€æŸ¥é‚£ä¸ªç»™å®šçš„ç¬¦å·æ˜¯å¦è¢«å®šä¹‰è¿˜æœ‰æ ¹æ®é‚£ä¸ªè¿”å›å€¼æ£€æŸ¥æˆ‘ä»¬çš„ token åŒ¹é…ä¼šé€šè¿‡è¿˜æ˜¯ä¼šå¤±è´¥ã€‚å¦‚æœé‚£ä¸ªæ±‚å€¼ä»£ç è¿”å›ä¸€ä¸ªçœŸå€¼é‚£ä¹ˆæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„  <code>&lt;!{ ... }&gt;</code> ç»“æ„å°±ä¼šå¤±è´¥ã€‚</p>
<p>æ€»è€Œè¨€ä¹‹, è¿™ä¸ª token æ‰€åšçš„æ‰€æœ‰äº‹æƒ…å°±æ˜¯æ£€æŸ¥æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ <code>#</code> ä½œä¸ºåˆ†éš”ç¬¦å¹¶ä¸”æ²¡æœ‰å°è¯•å»è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æˆ–subã€‚æˆ¿é—´çš„è¿™ä¸ªè§’è½æ²¡æœ‰ bug è¿¹è±¡ã€‚ è®©æˆ‘ä»¬å›åˆ°æˆ‘ä»¬çš„ <code>token quote:sym&lt;q&gt;</code> æ¥æŸ¥çœ‹ä¸‹ä¸€æ­¥åšä»€ä¹ˆ:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">token</span> <span class="nf">quote:sym</span>&lt;q&gt; <span class="p">{</span><span class="sr">
</span><span class="sr">    </span><span class="o">:</span><span class="kd">my</span> <span class="nv">$qm</span><span class="p">;</span><span class="sr">
</span><span class="sr">    </span><span class="p">&#39;</span><span class="s1">q</span><span class="p">&#39;</span><span class="sr">
</span><span class="sr">    </span><span class="p">[</span><span class="sr">
</span><span class="sr">    </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">quote_mod</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">{}</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">.</span><span class="nf">qok</span><span class="p">(</span><span class="nv">$/</span><span class="p">)&gt;</span><span class="sr"> </span><span class="p">{</span> <span class="nv">$qm</span> <span class="o">:=</span> <span class="nv">$&lt;quote_mod&gt;</span><span class="o">.</span><span class="nb">Str</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="p">&lt;</span><span class="nf">quibble</span><span class="p">(</span><span class="vg">%*LANG</span><span class="p">&lt;</span><span class="s">Quote</span><span class="p">&gt;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">q</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$qm</span><span class="p">)&gt;</span><span class="sr">
</span><span class="sr">    </span><span class="o">|</span><span class="sr"> </span><span class="c1"># (this branch omited)
</span><span class="c1"></span><span class="sr">    </span><span class="p">]</span><span class="sr">
</span><span class="sr"></span><span class="p">}</span>
</code></pre></div><p>æˆ‘ä»¬å·²ç»å®Œæˆäº† <code>&lt;.qok&gt;</code> çš„æ£€æŸ¥, æ‰€ä»¥ä¸‹ä¸€æ­¥æ˜¯ <code>{ $qm := $&lt;quote_mod&gt;.Str }</code>, é‚£ä»…ä»…æŠŠåŒ¹é…åˆ° <code>quote_mod</code> token çš„å­—ç¬¦ä¸²å€¼å­˜åˆ° <code>$qm</code> å˜é‡ä¸­ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­, é‚£ä¸ªå€¼å°±æ˜¯å­—ç¬¦ä¸² <code>ww</code>ã€‚</p>
<p>ä¸‹é¢è·Ÿç€çš„æ˜¯å¦å¤–ä¸€ä¸ª token, å®ƒåœ¨æˆ‘ä»¬çš„ <code>--target=parse</code> sè¾“å‡ºä¸­å‡ºç°è¿‡:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">&lt;</span><span class="nf">quibble</span><span class="p">(</span><span class="vg">%*LANG</span><span class="p">&lt;</span><span class="s">Quote</span><span class="p">&gt;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">q</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$qm</span><span class="p">)</span><span class="o">&gt;</span>
</code></pre></div><p>è¿™é‡Œ, æˆ‘ä»¬ä½¿ç”¨ä¸‰ä¸ªä½ç½®å‚æ•°å¼•ç”¨äº†é‚£ä¸ª token: <a href="https://github.com/rakudo/rakudo/blob/04af57c3b3d32353e36614de53396d2b4a08b7be/src/Raku/Grammar.nqp#L424">Quote language braid</a>, å­—ç¬¦ä¸² <code>q</code> å’Œ æˆ‘ä»¬ä¿å­˜åœ¨å˜é‡ <code>$qm</code> ä¸­çš„å­—ç¬¦ä¸² <code>ww</code>ã€‚æˆ‘æƒ³çŸ¥é“å®ƒæ˜¯åšä»€ä¹ˆçš„ã€‚é‚£æ˜¯æˆ‘ä»¬çš„ä¸‹ä¸€ç«™ã€‚å…¨åŠ›ä»¥èµ´!</p>
<h2 id="nibble-quibble-babbling-nibbler">Nibble Quibble Babbling Nibbler</h2>
<p>è¿™é‡Œæ˜¯å®Œæ•´çš„ <code>token quibble</code> å¹¶ä¸”ä½ é©¬ä¸Šå¯ä»¥å‘ç°æˆ‘ä»¬ä¸å¾—ä¸ä»å¼€å§‹å¾€æ›´æ·±å¤„æŒ–æ˜, å› ä¸ºç¬¬ 5 è¡Œæ˜¯å¦å¤–ä¸€ä¸ª token åŒ¹é…:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">token</span> <span class="nf">quibble</span><span class="p">(</span><span class="nv">$l</span><span class="o">,</span> <span class="o">*</span><span class="nv">@base_tweaks</span><span class="p">)</span> <span class="p">{</span><span class="sr">
</span><span class="sr">    </span><span class="o">:</span><span class="kd">my</span> <span class="nv">$lang</span><span class="p">;</span><span class="sr">
</span><span class="sr">    </span><span class="o">:</span><span class="kd">my</span> <span class="nv">$start</span><span class="p">;</span><span class="sr">
</span><span class="sr">    </span><span class="o">:</span><span class="kd">my</span> <span class="nv">$stop</span><span class="p">;</span><span class="sr">
</span><span class="sr">    </span><span class="p">&lt;</span><span class="nf">babble</span><span class="p">(</span><span class="nv">$l</span><span class="o">,</span> <span class="nv">@base_tweaks</span><span class="p">)&gt;</span><span class="sr">
</span><span class="sr">    </span><span class="p">{</span>
        <span class="k">my</span> <span class="nv">$B</span>  <span class="o">:=</span> <span class="nv">$&lt;babble&gt;&lt;B&gt;</span><span class="o">.</span><span class="nb">ast</span><span class="p">;</span>
        <span class="nv">$lang</span>  <span class="o">:=</span> <span class="nv">$B</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
        <span class="nv">$start</span> <span class="o">:=</span> <span class="nv">$B</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>
        <span class="nv">$stop</span>  <span class="o">:=</span> <span class="nv">$B</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span>
    <span class="p">}</span><span class="sr">
</span><span class="sr">
</span><span class="sr">    </span><span class="nv">$start</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">nibble</span><span class="p">(</span><span class="nv">$lang</span><span class="p">)&gt;</span><span class="sr">
</span><span class="sr">    </span><span class="p">[</span><span class="sr">
</span><span class="sr">        </span><span class="nv">$stop</span><span class="sr">
</span><span class="sr">        </span><span class="o">||</span><span class="sr"> </span><span class="p">{</span>
            <span class="nv">$/</span><span class="o">.</span><span class="nf">CURSOR</span><span class="o">.</span><span class="nf">typed_panic</span><span class="p">(</span>
                <span class="p">&#39;</span><span class="s1">X::Comp::AdHoc</span><span class="p">&#39;</span><span class="o">,</span>
                <span class="s">payload</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">Couldn&#39;t find terminator </span><span class="nv">$stop</span><span class="s2"> (corresponding </span><span class="nv">$start</span><span class="s2"> was at line {</span>
                    <span class="n">HLL::Compiler</span><span class="o">.</span><span class="nf">lineof</span><span class="p">(</span>
                        <span class="nv">$&lt;babble&gt;&lt;B&gt;</span><span class="o">.</span><span class="nb">orig</span><span class="p">()</span><span class="o">,</span> <span class="nv">$&lt;babble&gt;&lt;B&gt;</span><span class="o">.</span><span class="nb">from</span><span class="p">()</span>
                    <span class="p">)</span>
                <span class="p">})&#34;</span><span class="s2">,
</span><span class="s2">                expected =&gt; [</span><span class="nv">$stop</span><span class="s2">],
</span><span class="s2">            )
</span><span class="s2">        }
</span><span class="s2">    ]
</span><span class="s2">
</span><span class="s2">    </span><span class="p">{</span>
        <span class="nf">nqp::can</span><span class="p">(</span><span class="nv">$lang</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">herelang</span><span class="p">&#39;)</span>
        <span class="o">&amp;&amp;</span> <span class="nb">self</span><span class="o">.</span><span class="nf">queue_heredoc</span><span class="p">(</span>
            <span class="vg">$*W</span><span class="o">.</span><span class="nf">nibble_to_str</span><span class="p">(</span>
                <span class="nv">$/</span><span class="o">,</span>
                <span class="nv">$&lt;nibble&gt;</span><span class="o">.</span><span class="nb">ast</span><span class="o">[</span><span class="mi">1</span><span class="o">],</span> <span class="k">-&gt;</span> <span class="p">{</span>
                    <span class="p">&#34;</span><span class="s2">Stopper &#39;</span><span class="p">&#34;</span> <span class="o">~</span> <span class="nv">$&lt;nibble&gt;</span> <span class="o">~</span> <span class="p">&#34;</span><span class="s2">&#39; too complex for heredoc</span><span class="p">&#34;</span>
                <span class="p">}</span><span class="s2">
</span><span class="s2">            ),
</span><span class="s2">            </span><span class="nv">$lang</span><span class="s2">.herelang,
</span><span class="s2">        )
</span><span class="s2">    }
</span><span class="s2">}
</span></code></pre></div><p>æˆ‘ä»¬å®šä¹‰äº† 3 ä¸ªå˜é‡ç„¶åå¼•ç”¨äº† <code>babble</code> token, è¿™ä¸ª babble å¼•ç”¨äº†å’Œ <code>quibble</code> token æ‰€å¼•ç”¨çš„åŒæ ·çš„å‚æ•°ã€‚æˆ‘ä»¬æ¥ä»¥å’ŒæŸ¥æ‰¾æ‰€æœ‰ä¹‹å‰çš„ tokens åŒæ ·çš„æ–¹å¼æŸ¥æ‰¾å®ƒå¹¶çª¥æ¢å®ƒçš„å†…æ ¸ã€‚ä¸ºäº†ç®€æ´, æˆ‘ç§»é™¤äº†å¤§çº¦ä¸€åŠ<a href="https://github.com/rakudo/rakudo/blob/bc35922/src/Raku/Grammar.nqp#L111-L125">ä»£ç </a>:é‚£éƒ¨åˆ†æ˜¯å¤„ç†å‰¯è¯çš„, ç›®å‰æˆ‘ä»¬ä¸èƒ½åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­ä½¿ç”¨å®ƒã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">token</span> <span class="nf">babble</span><span class="p">(</span><span class="nv">$l</span><span class="o">,</span> <span class="nv">@base_tweaks</span><span class="o">?</span><span class="p">)</span> <span class="p">{</span><span class="sr">
</span><span class="sr">    </span><span class="o">:</span><span class="kd">my</span> <span class="nv">@extra_tweaks</span><span class="p">;</span><span class="sr">
</span><span class="sr">
</span><span class="sr">    </span><span class="c1"># &lt;irrelevant portion redacted&gt;
</span><span class="c1"></span><span class="sr">
</span><span class="sr">    </span><span class="nv">$&lt;B&gt;</span><span class="o">=</span><span class="p">[&lt;</span><span class="o">?</span><span class="ow">before</span><span class="sr"> </span><span class="ni">.</span><span class="p">&gt;]</span><span class="sr">
</span><span class="sr">    </span><span class="p">{</span>
        <span class="c1"># Work out the delimeters.</span>
        <span class="k">my</span> <span class="nv">$c</span> <span class="o">:=</span> <span class="nv">$/</span><span class="o">.</span><span class="nf">CURSOR</span><span class="p">;</span>
        <span class="k">my</span> <span class="nv">@delims</span> <span class="o">:=</span> <span class="nv">$c</span><span class="o">.</span><span class="nf">peek_delimiters</span><span class="p">(</span><span class="nv">$c</span><span class="o">.</span><span class="nb">target</span><span class="o">,</span> <span class="nv">$c</span><span class="o">.</span><span class="nb">pos</span><span class="p">);</span>
        <span class="k">my</span> <span class="nv">$start</span> <span class="o">:=</span> <span class="nv">@delims</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
        <span class="k">my</span> <span class="nv">$stop</span>  <span class="o">:=</span> <span class="nv">@delims</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>

        <span class="c1"># Get the language.</span>
        <span class="k">my</span> <span class="nv">$lang</span> <span class="o">:=</span> <span class="nb">self</span><span class="o">.</span><span class="nf">quote_lang</span><span class="p">(</span><span class="nv">$l</span><span class="o">,</span> <span class="nv">$start</span><span class="o">,</span> <span class="nv">$stop</span><span class="o">,</span> <span class="nv">@base_tweaks</span><span class="o">,</span> <span class="nv">@extra_tweaks</span><span class="p">);</span>
        <span class="nv">$&lt;B&gt;</span><span class="o">.</span><span class="p">&#39;</span><span class="s1">!make</span><span class="p">&#39;(</span><span class="o">[</span><span class="nv">$lang</span><span class="o">,</span> <span class="nv">$start</span><span class="o">,</span> <span class="nv">$stop</span><span class="o">]</span><span class="p">);</span>
    <span class="p">}</span><span class="sr">
</span><span class="sr"></span><span class="p">}</span>
</code></pre></div><p>æˆ‘ä»¬é€šè¿‡æŠŠå‘å‰æŸ¥çœ‹æ•è·åˆ° <code>$&lt;B&gt;</code> æ•è·ä¸­å¼€å§‹, å®ƒç”¨ä½œæ›´æ–°å½“å‰çš„ Cursor ä½ç½®, ç„¶åè¿›å…¥ä»¥æ‰§è¡Œé‚£ä¸ªä»£ç å—ã€‚æˆ‘ä»¬æŠŠå½“å‰çš„ Cursor å­˜å‚¨åœ¨ <code>$c</code> ä¸­, ç„¶ååœ¨å®ƒèº«ä¸Šè°ƒç”¨ <code>.peek_delimiters</code> æ–¹æ³•ã€‚å¦‚æœæˆ‘ä»¬ä¸ºäº†å®ƒåœ¨å†…ç½®çš„ rakudo ç›®å½•ä¸­è¿›è¡Œ <code>grep</code>, æˆ‘ä»¬ä¼šçœ‹åˆ°å®ƒè¢«å®šä¹‰åœ¨ <a href="https://github.com/raku/nqp/blob/4fd4b48afb45c8b25ccf7cfc5e39cb4bd658901d/src/HLL/Grammar.nqp#L200">NQP</a>ä¸­, åœ¨ <a href="https://github.com/raku/nqp/blob/4fd4b48afb45c8b25ccf7cfc5e39cb4bd658901d/src/HLL/Grammar.nqp#L200">nqp/src/HLL/Grammar.nqp</a>ä¸­, ä½†æ˜¯åœ¨æˆ‘ä»¬å†²å‡ºå»é˜…è¯»å®ƒçš„ä»£ç ä¹‹å‰, æ³¨æ„å®ƒæ˜¯æ€æ ·è¿”å›ä¸¤ä¸ªåˆ†éš”ç¬¦çš„ã€‚æˆ‘ä»¬ä»…ä»…æŠŠå®ƒä»¬æ‰“å°å‡ºæ¥å¥½äº†?</p>
<p><code>src/Raku/Grammar.nqp</code> çš„ <code>.nqp</code> åç¼€åè¡¨æ˜æˆ‘ä»¬æ­£å¤„åœ¨ NQP çš„åœ°ç›˜å„¿, æ‰€ä»¥æˆ‘ä»¬ä¸è¦ä½¿ç”¨ <a href="https://github.com/raku/nqp/blob/master/docs/ops.markdown">NQP ops</a>ä»…ä»…å¹¶ä¸”ä¸æ˜¯å®Œå…¨çš„ Raku ä»£ç ã€‚é€šè¿‡æŠŠä¸‹é¢è¿™ä¸€è¡Œä»£ç æ·»åŠ åˆ° <code>@delim</code> è¢«èµ‹å€¼ç»™ <code>$start</code> å’Œ <code>$stop</code> çš„åœ°æ–¹, æˆ‘ä»¬èƒ½æ‰¾å‡º <code>.peek_delimiters</code> ç»™æˆ‘ä»¬çš„ä¸œè¥¿:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nf">nqp::say</span><span class="p">(&#34;</span><span class="nv">$sart</span><span class="s2"> </span><span class="nv">$stop</span><span class="p">&#34;);</span>
</code></pre></div><p>ç¼–è¯‘!</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ perl Configure.pl --gen-moar --gen-nqp --backends<span class="o">=</span>moar <span class="o">&amp;&amp;</span>
  make <span class="o">&amp;&amp;</span>
  make <span class="nb">test</span> <span class="o">&amp;&amp;</span>
  make install
</code></pre></div><p>å³ä½¿åœ¨ç¼–è¯‘æœŸé—´, é€šè¿‡åå‡ºé¢å¤–çš„ä¸œè¥¿, æˆ‘ä»¬çš„è°ƒè¯•è¡Œå·²ç»ç»™äº†æˆ‘ä»¬æ‰€æœ‰é‚£äº›åˆ†éš”ç¬¦æ˜¯å…³äºä»€ä¹ˆçš„å¯å‘ã€‚å†æ¬¡è¿è¡Œæˆ‘ä»¬çš„æœ‰é—®é¢˜çš„ä»£ç :</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ./raku -e <span class="s1">&#39;.say for qww&lt;â€hello worldâ€&gt;;&#39;</span>
&lt; &gt;
hello world
</code></pre></div><p>æ‰“å°å‡ºçš„åˆ†éš”ç¬¦æ˜¯ <code>qww</code> é‡Œçš„å°–æ‹¬å·åˆ†éš”ç¬¦ã€‚æˆ‘ä»¬å¯¹é‚£äº›ä¸æ„Ÿå…´è¶£, æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¿½ç•¥ <code>.peek_delimiters</code> å¹¶ç»§ç»­ã€‚å†å¾€ä¸Šæ˜¯ <code>.quote_lang</code> æ–¹æ³•ã€‚ å®ƒçš„åå­—é‡Œæœ‰ä¸€ä¸ª&quot;å¼•å·&quot;è€Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå…³äºå¼•å·çš„é—®é¢˜.. å¬èµ·æ¥æˆ‘ä»¬ç¦»çœŸç›¸è¶Šæ¥è¶Šè¿‘äº†ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘ä»¬æ­£ä¼ é€’ç»™å®ƒçš„æ˜¯ä»€ä¹ˆå‚æ•°:</p>
<ul>
<li><code>$1</code> â€” <a href="https://github.com/rakudo/rakudo/blob/04af57c3b3d32353e36614de53396d2b4a08b7be/src/Raku/Grammar.nqp#L4752">Quote language braid</a></li>
<li><code>$start</code> / <code>$stop</code> â€” å°–æ‹¬å·åˆ†éš”ç¬¦</li>
<li><code>@base_tweaks</code> â€” åŒ…å«ä¸€ä¸ªå…ƒç´ : å­—ç¬¦ä¸² <code>ww</code></li>
<li><code>@extra_tweaks</code> â€” é¢å¤–çš„å‰¯è¯, è¿™é‡Œæˆ‘ä»¬æ²¡æœ‰, æ‰€ä»¥è¿™ä¸ªæ•°ç»„æ˜¯ç©ºçš„</li>
</ul>
<p>å®šä½åˆ° <code>method quote_lang</code>; å®ƒä»ç„¶åœ¨ <a href="https://github.com/rakudo/rakudo/blob/04af57c3b3d32353e36614de53396d2b4a08b7be/src/Raku/Grammar.nqp#L65">src/Raku/Grammar.nqp</a>æ–‡ä»¶ä¸­:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">method</span> <span class="nf">quote_lang</span><span class="p">(</span><span class="nv">$l</span><span class="o">,</span> <span class="nv">$start</span><span class="o">,</span> <span class="nv">$stop</span><span class="o">,</span> <span class="nv">@base_tweaks</span><span class="o">?,</span> <span class="nv">@extra_tweaks</span><span class="o">?</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">sub</span> <span class="nf">lang_key</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1"># &lt;body redacted&gt;</span>
    <span class="p">}</span>
    <span class="k">sub</span> <span class="nf">con_lang</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1"># &lt;body redacted&gt;</span>
    <span class="p">}</span>

    <span class="c1"># Get language from cache or derive it.</span>
    <span class="k">my</span> <span class="nv">$key</span> <span class="o">:=</span> <span class="nf">lang_key</span><span class="p">();</span>
    <span class="nf">nqp::existskey</span><span class="p">(</span><span class="nv">%quote_lang_cache</span><span class="o">,</span> <span class="nv">$key</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$key</span> <span class="ow">ne</span> <span class="p">&#39;</span><span class="s1">NOCACHE</span><span class="p">&#39;</span>
        <span class="o">??</span> <span class="nv">%quote_lang_cache</span><span class="p">{</span><span class="nv">$key</span><span class="p">}</span>
        <span class="o">!!</span> <span class="p">(</span><span class="nv">%quote_lang_cache</span><span class="p">{</span><span class="nv">$key</span><span class="p">}</span> <span class="o">:=</span> <span class="nf">con_lang</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div><p>æˆ‘ä»¬æœ‰ä¸¤ä¸ªè¯æ³•å­ä¾‹ç¨‹ <code>lang_key</code> å’Œ <code>con_lang</code>, åœ¨å®ƒä»¬ä¸‹é¢æˆ‘ä»¬æŠŠ <code>lang_key</code> çš„è¾“å‡ºå­˜å‚¨åˆ° <code>$key</code> ä¸­, åœ¨ <code>%quote_lang_cache</code> ä¸­è¿™ä¸ª <code>$key</code> è¢«ç”¨åœ¨æ•´ä¸ªç¼“å­˜ dance ä¸­, æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¿½ç•¥æ‰ <code>lang_key</code> sub å¹¶ç›´æ¥è¿›å…¥ <code>con_lang</code>, å®ƒè¢«è°ƒç”¨ä»¥ç”Ÿæˆæˆ‘ä»¬çš„ <code>quote_lang</code> æ–¹æ³•çš„è¿”å›å€¼:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">con_lang</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$lang</span> <span class="o">:=</span> <span class="nv">$l</span><span class="o">.</span><span class="p">&#39;</span><span class="s1">!cursor_init</span><span class="p">&#39;(</span><span class="nb">self</span><span class="o">.</span><span class="nb">orig</span><span class="p">()</span><span class="o">,</span> <span class="p">:</span><span class="s">p</span><span class="p">(</span><span class="nb">self</span><span class="o">.</span><span class="nb">pos</span><span class="p">())</span><span class="o">,</span> <span class="p">:</span><span class="s">shared</span><span class="p">(</span><span class="nb">self</span><span class="o">.</span><span class="p">&#39;</span><span class="s1">!shared</span><span class="p">&#39;()));</span>
    <span class="k">for</span> <span class="nv">@base_tweaks</span> <span class="p">{</span>
        <span class="nv">$lang</span> <span class="o">:=</span> <span class="nv">$lang</span><span class="o">.</span><span class="p">&#34;</span><span class="s2">tweak_</span><span class="nv">$_</span><span class="p">&#34;(</span><span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="nv">@extra_tweaks</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">$t</span> <span class="o">:=</span> <span class="nv">$_</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
        <span class="k">if</span> <span class="nf">nqp::can</span><span class="p">(</span><span class="nv">$lang</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">tweak_</span><span class="nv">$t</span><span class="p">&#34;)</span> <span class="p">{</span>
            <span class="nv">$lang</span> <span class="o">:=</span> <span class="nv">$lang</span><span class="o">.</span><span class="p">&#34;</span><span class="s2">tweak_</span><span class="nv">$t</span><span class="p">&#34;(</span><span class="nv">$_</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nb">self</span><span class="o">.</span><span class="nf">sorry</span><span class="p">(&#34;</span><span class="s2">Unrecognized adverb: :</span><span class="nv">$t</span><span class="p">&#34;);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nf">nqp::istype</span><span class="p">(</span><span class="nv">$stop</span><span class="o">,</span><span class="n">VMArray</span><span class="p">)</span> <span class="o">||</span>
    <span class="nv">$start</span> <span class="ow">ne</span> <span class="nv">$stop</span> <span class="o">??</span> <span class="nv">$lang</span><span class="o">.</span><span class="nf">balanced</span><span class="p">(</span><span class="nv">$start</span><span class="o">,</span> <span class="nv">$stop</span><span class="p">)</span>
                    <span class="o">!!</span> <span class="nv">$lang</span><span class="o">.</span><span class="nf">unbalanced</span><span class="p">(</span><span class="nv">$stop</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>åœ¨åˆå§‹åŒ– Cursor ä½ç½®ä¹‹å, <code>$lang</code> ç»§ç»­åŒ…å«æˆ‘ä»¬çš„ Quote è¯­è¨€ç¼–ç»‡ç„¶åæˆ‘ä»¬è½è¿›ä¸€ä¸ª <code>for</code> å¾ªç¯æ¥è¿­ä»£ <code>@base_tweaks</code>, å¯¹äºé‡Œé¢çš„æ¯ä¸€ä¸ªå…ƒç´ , æˆ‘ä»¬éƒ½è°ƒç”¨æ–¹æ³• <code>tweak_$_</code>, ç»™å®ƒä¼ é€’ä¸€ä¸ªçœŸå€¼ <code>1</code>ã€‚å› ä¸ºæˆ‘ä»¬ä»…ä»…åªæœ‰ä¸€ä¸ª base tweak, è¿™æ„å‘³ç€æˆ‘ä»¬æ­£åœ¨Quote braidä¸Šè°ƒç”¨æ–¹æ³• <code>tweak_ww</code>ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹é‚£ä¸ªæ–¹æ³•æ˜¯å…³äºä»€ä¹ˆçš„ã€‚</p>
<p>å› ä¸º Quote braid è¢«å®šä¹‰åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­, ä»…ä»…æœç´¢ <code>method tweak_ww</code> å¥½äº†:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">method</span> <span class="nf">tweak_ww</span><span class="p">(</span><span class="nv">$v</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$v</span> <span class="o">??</span> <span class="nb">self</span><span class="o">.</span><span class="nf">add-postproc</span><span class="p">(&#34;</span><span class="s2">quotewords</span><span class="p">&#34;)</span><span class="o">.</span><span class="nf">apply_tweak</span><span class="p">(</span><span class="n">ww</span><span class="p">)</span>
       <span class="o">!!</span> <span class="nb">self</span>
<span class="p">}</span>
</code></pre></div><p>å¾ˆå¥½ã€‚æˆ‘ä»¬ç»™å®ƒçš„ <code>$v</code> ä¸ºçœŸ, æ‰€ä»¥æˆ‘ä»¬è°ƒç”¨äº† <code>.add-postproc</code> ç„¶åè°ƒç”¨ <code>.apply_tweak(ww)</code>ã€‚çœ‹ä¸€ä¸‹é‚£ä¸ªæ–¹æ³•çš„ä¸Šé¢å’Œä¸‹é¢, æˆ‘ä»¬çœ‹åˆ° <code>.add-postproc</code> ä¹Ÿç”¨åœ¨å…¶å®ƒä¸å« bug çš„å¼•å·ä¸­, æ‰€ä»¥æˆ‘ä»¬å¿½ç•¥å®ƒå¹¶ç›´æ¥è·³åˆ° <code>.apply_tweak</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">method</span> <span class="nf">apply_tweak</span><span class="p">(</span><span class="nv">$role</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$target</span> <span class="o">:=</span> <span class="nf">nqp::can</span><span class="p">(</span><span class="nb">self</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">herelang</span><span class="p">&#39;)</span> <span class="o">??</span> <span class="nb">self</span><span class="o">.</span><span class="nf">herelang</span> <span class="o">!!</span> <span class="nb">self</span><span class="p">;</span>
    <span class="nv">$target</span><span class="o">.</span><span class="nb">HOW</span><span class="o">.</span><span class="nb">mixin</span><span class="p">(</span><span class="nv">$target</span><span class="o">,</span> <span class="nv">$role</span><span class="p">);</span>
    <span class="nb">self</span>
<span class="p">}</span>
</code></pre></div><p>å•Šå“ˆ! å®ƒçš„å‚æ•°æ˜¯ä¸€ä¸ª role å¹¶ä¸”å®ƒæŠŠè¯¥ role æ··è¿›æ¥æˆ‘ä»¬çš„ Quote braid ä¸­ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹é‚£ä¸ª role æ˜¯å…³äºä»€ä¹ˆçš„(å†ä¸€æ¬¡, ä»…ä»…åœ¨æ–‡ä»¶ä¸­æœç´¢ <a href="https://github.com/rakudo/rakudo/blob/94b09ab9280d39438f84cb467d4b3d3042b8f672/src/Raku/Grammar.nqp#L4846">role ww</a>, æˆ–è€…ä»…ä»…å‘ä¸Šæ»šåŠ¨ä¸€ç‚¹):</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">ww</span> <span class="p">{</span>
    <span class="k">token</span> <span class="nf">escape:sym</span>&lt;&#39; &#39;&gt; <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="p">&lt;</span><span class="o">?</span><span class="p">[</span><span class="sr">&#39;</span><span class="p">]&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nv">quote</span><span class="o">=.</span><span class="nf">LANG</span><span class="p">(&#39;</span><span class="s1">MAIN</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">quote</span><span class="p">&#39;)&gt;</span><span class="sr">
</span><span class="sr">    </span><span class="p">}</span>

    <span class="k">token</span> <span class="nf">escape:sym</span>&lt;â€˜ â€™&gt; <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="p">&lt;</span><span class="o">?</span><span class="p">[</span><span class="sr">â€˜</span><span class="p">]&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nv">quote</span><span class="o">=.</span><span class="nf">LANG</span><span class="p">(&#39;</span><span class="s1">MAIN</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">quote</span><span class="p">&#39;)&gt;</span><span class="sr">
</span><span class="sr">    </span><span class="p">}</span>

    <span class="k">token</span> <span class="nf">escape:sym</span>&lt;&#34; &#34;&gt; <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="p">&lt;</span><span class="o">?</span><span class="p">[</span><span class="sr">&#34;</span><span class="p">]&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nv">quote</span><span class="o">=.</span><span class="nf">LANG</span><span class="p">(&#39;</span><span class="s1">MAIN</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">quote</span><span class="p">&#39;)&gt;</span><span class="sr">
</span><span class="sr">    </span><span class="p">}</span>

    <span class="k">token</span> <span class="nf">escape:sym</span>&lt;â€œ â€&gt; <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="p">&lt;</span><span class="o">?</span><span class="p">[</span><span class="sr">â€œ</span><span class="p">]&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nv">quote</span><span class="o">=.</span><span class="nf">LANG</span><span class="p">(&#39;</span><span class="s1">MAIN</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">quote</span><span class="p">&#39;)&gt;</span><span class="sr">
</span><span class="sr">    </span><span class="p">}</span>

    <span class="k">token</span> <span class="nf">escape:sym</span>&lt;colonpair&gt; <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="p">&lt;</span><span class="o">?</span><span class="p">[</span><span class="sr">:</span><span class="p">]&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">!</span><span class="nf">RESTRICTED</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nv">colonpair</span><span class="o">=.</span><span class="nf">LANG</span><span class="p">(&#39;</span><span class="s1">MAIN</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">colonpair</span><span class="p">&#39;)&gt;</span><span class="sr">
</span><span class="sr">    </span><span class="p">}</span>

    <span class="k">token</span> <span class="nf">escape:sym</span>&lt;#&gt; <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="p">&lt;</span><span class="o">?</span><span class="p">[</span><span class="sr">#</span><span class="p">]&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">.</span><span class="nf">LANG</span><span class="p">(&#39;</span><span class="s1">MAIN</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">comment</span><span class="p">&#39;)&gt;</span><span class="sr">
</span><span class="sr">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>å¥¥, æˆ‘çš„å¤©å‘!å¼•å·! å¦‚æœè¿™ä¸ªåœ°æ–¹ä¸æ˜¯æˆ‘ä»¬ä¿®å¤ bug çš„åœ°æ–¹, é‚£ä¹ˆæˆ‘å°±æ˜¯ä¸€ä¸ªèŠ­è•¾èˆå¥³æ¼”å‘˜ã€‚ æˆ‘ä»¬æ‰¾åˆ°å®ƒäº†!</p>
<p>æˆ‘ä»¬å®šä½åˆ°çš„ role æŠŠè¿›äº†æŸäº› tokens æ··åˆè¿›äº†æˆ‘ä»¬æ­£ä½¿ç”¨çš„ Quote braid ä¸­æ¥è§£æ <code>qww</code> çš„å†…å®¹ã€‚æˆ‘ä»¬å¸¦æœ‰ bug çš„ <code>â€â€</code> å¼•å·ç»„åˆæ˜æ˜¾ä¸åœ¨é‚£ä¸ªåˆ—è¡¨ä¸­ã€‚æˆ‘ä»¬æ¥æŠŠå®ƒæ·»åŠ è¿›å»!</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">token</span> <span class="nf">escape:sym</span>&lt;â€ â€&gt; <span class="p">{</span><span class="sr">
</span><span class="sr">    </span><span class="p">&lt;</span><span class="o">?</span><span class="p">[</span><span class="sr">â€</span><span class="p">]&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nv">quote</span><span class="o">=.</span><span class="nf">LANG</span><span class="p">(&#39;</span><span class="s1">MAIN</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">quote</span><span class="p">&#39;)&gt;</span><span class="sr">
</span><span class="sr"></span><span class="p">}</span>
</code></pre></div><p>ç¼–è¯‘! è¿è¡Œæˆ‘ä»¬å¸¦æœ‰ bug çš„ä»£ç :</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ./raku -e <span class="s1">&#39;.say for qww&lt;foo â€hello worldâ€ bar&gt;&#39;</span>
foo
bar
</code></pre></div><p>æ‚²å‚¬! å¥½å§, æˆ‘ä»¬ç¡®å®ä¸ºå¼•å·å¤„ç†æ‰¾åˆ°äº†æ­£ç¡®çš„åœ°æ–¹, ä½†æ˜¯æˆ‘ä»¬è®©é—®é¢˜å˜å¾—æ›´åŠ ç³Ÿç³•äº†ã€‚å‘ç”Ÿäº†ä»€ä¹ˆ?</p>
<h2 id="quotastic-inaction">Quotastic Inaction</h2>
<p>æˆ‘ä»¬æ–°çš„ token è‚¯å®šè§£æäº†é‚£ä¸ªå¼•å·, ä½†æ˜¯æˆ‘ä»¬ç»å¯¹æ²¡æœ‰ç»™å®ƒæ·»åŠ  Actions åŠ¨ä½œ&hellip; å¥½å§, å¯¹å®ƒèµ·ä½œç”¨ã€‚Action ç±»å’Œ Grammars ç›¸é‚», åœ¨ <code>src/Raku/Actions.nqp</code> ä¸­ã€‚æ‰“å¼€å®ƒå¹¶å®šä½åˆ°åŒ¹é…çš„æ–¹æ³•é‚£é‡Œ; æ¯”å¦‚ <a href="https://github.com/rakudo/rakudo/blob/94b09ab9280d39438f84cb467d4b3d3042b8f672/src/Raku/Actions.nqp#L9243">method escape:sym&lt;â€œ â€&gt;</a>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">method</span> <span class="nf">escape</span><span class="p">:</span><span class="na">sym</span><span class="p">&lt;</span><span class="s">&#39; &#39;</span><span class="p">&gt;(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> <span class="k">make</span> <span class="nf">mark_ww_atom</span><span class="p">(</span><span class="nv">$&lt;quote&gt;</span><span class="o">.</span><span class="nb">ast</span><span class="p">);</span> <span class="p">}</span>
<span class="k">method</span> <span class="nf">escape</span><span class="p">:</span><span class="na">sym</span><span class="p">&lt;</span><span class="s">&#34; &#34;</span><span class="p">&gt;(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> <span class="k">make</span> <span class="nf">mark_ww_atom</span><span class="p">(</span><span class="nv">$&lt;quote&gt;</span><span class="o">.</span><span class="nb">ast</span><span class="p">);</span> <span class="p">}</span>
<span class="k">method</span> <span class="nf">escape</span><span class="p">:</span><span class="na">sym</span><span class="p">&lt;</span><span class="s">â€˜ â€™</span><span class="p">&gt;(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> <span class="k">make</span> <span class="nf">mark_ww_atom</span><span class="p">(</span><span class="nv">$&lt;quote&gt;</span><span class="o">.</span><span class="nb">ast</span><span class="p">);</span> <span class="p">}</span>
<span class="k">method</span> <span class="nf">escape</span><span class="p">:</span><span class="na">sym</span><span class="p">&lt;</span><span class="s">â€œ â€</span><span class="p">&gt;(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> <span class="k">make</span> <span class="nf">mark_ww_atom</span><span class="p">(</span><span class="nv">$&lt;quote&gt;</span><span class="o">.</span><span class="nb">ast</span><span class="p">);</span> <span class="p">}</span>
</code></pre></div><p>å¹¶åœ¨åˆ—è¡¨ä¸­æ·»åŠ æˆ‘ä»¬è‡ªå·±çš„ç‰ˆæœ¬:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">method</span> <span class="nf">escape</span><span class="p">:</span><span class="na">sym</span><span class="p">&lt;</span><span class="s">â€ â€</span><span class="p">&gt;(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> <span class="k">make</span> <span class="nf">mark_ww_atom</span><span class="p">(</span><span class="nv">$&lt;quote&gt;</span><span class="o">.</span><span class="nb">ast</span><span class="p">);</span> <span class="p">}</span>
</code></pre></div><p>ç¼–è¯‘! è¿è¡Œæˆ‘ä»¬å¸¦æœ‰ bug çš„ä»£ç :</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ./raku -e <span class="s1">&#39;.say for qww&lt;foo â€hello worldâ€ bar&gt;&#39;</span>
foo
hello world
bar
</code></pre></div><p>å‘¼! æˆåŠŸäº†! ä¸å†æœ‰ bug äº†ã€‚æˆ‘ä»¬ä¿®å¤äº†é‚£ä¸ª bug!</p>
<p>ä½†æ˜¯, ç­‰ä¸€ä¸‹&hellip;</p>
<h2 id="é—æ¼äº†-ä½†æ˜¯æ²¡æœ‰å¿˜è®°">é—æ¼äº†, ä½†æ˜¯æ²¡æœ‰å¿˜è®°</h2>
<p>çœ‹ä¸€ä¸‹<a href="https://docs.raku.org/language/unicode_texas#Other_acceptable_single_codepoints">æ‰€æœ‰å¯èƒ½çš„å¥¢åçš„å¼•å·çš„åˆ—è¡¨</a>ã€‚å°½ç®¡æˆ‘ä»¬çš„ bug æŠ¥å‘Šä¸­ä»…ä»…æåˆ°äº† <code>â€â€</code> å¼•å·å¯¹å„¿, ä½†æ˜¯ <code>â€šâ€˜</code> å’Œ <code>ã€Œã€</code> éƒ½ä¸åœ¨æˆ‘ä»¬çš„ <code>role ww</code> tokens ä¸­ã€‚è¿œè¿œä¸æ­¢çš„æ˜¯, æŸäº›å·¦/å³å¼•å·, å½“å®ƒä»¬äº¤æ¢ä½ç½®å, åœ¨å¼•èµ·å­—ç¬¦ä¸²çš„æ—¶å€™ä¹Ÿåˆšå¥½èƒ½å·¥ä½œ, æ‰€ä»¥å®ƒä»¬ä¹Ÿåº”è¯¥åœ¨ <code>qww</code> ä¸­èµ·æ•ˆã€‚ç„¶è€Œ, æ·»åŠ ä¸€æ•´ä¸²é¢å¤–çš„ tokens å’Œä¸€æ•´ä¸²å…¶å®ƒçš„ actions æ–¹æ³•æ˜¯ç›¸å½“ä¸ç²¾å½©çš„ã€‚æœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•?</p>
<p>æˆ‘ä»¬ä»”ç»†çœ‹çœ‹æˆ‘ä»¬çš„ tokens:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">token</span> <span class="nf">escape:sym</span>&lt;â€œ â€&gt; <span class="p">{</span><span class="sr">
</span><span class="sr">    </span><span class="p">&lt;</span><span class="o">?</span><span class="p">[</span><span class="sr">â€œ</span><span class="p">]&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nv">quote</span><span class="o">=.</span><span class="nf">LANG</span><span class="p">(&#39;</span><span class="s1">MAIN</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">quote</span><span class="p">&#39;)&gt;</span><span class="sr">
</span><span class="sr"></span><span class="p">}</span>
</code></pre></div><p><code>sym&lt;â€œ â€&gt;</code> æˆ‘ä»¬å¯ä»¥æŠŠå®ƒçœç•¥äº† â€” è¿™é‡Œå®ƒçš„åŠŸèƒ½ä»…ä»…æ˜¯ä½œä¸ºä¸€ä¸ªåå­—ã€‚æˆ‘ä»¬ç•™ä¸‹çš„æ˜¯ä¸€ä¸ªå‘å‰æŸ¥çœ‹çš„ <code>â€œ</code> å¼•å·è¿˜æœ‰ <code>&lt;quote=.LANG('MAIN','quote')&gt;</code>ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å‘å‰æŸ¥çœ‹æ‰€æœ‰çš„æˆ‘ä»¬å…³å¿ƒçš„å¼€å£å¼•å·å¹¶è®© MAIN braid æ¥ç®¡æ‰€æœ‰çš„ç»†èŠ‚ã€‚</p>
<p>æ‰€ä»¥, è®©æˆ‘ä»¬ç”¨è¿™ä¸ªå•ä¸ª token æ›¿æ¢æ‰æ‰€æœ‰çš„å¼•å·å¤„ç† tokens:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">token</span> <span class="nf">escape:sym</span>&lt;&#39;&gt; <span class="p">{</span><span class="sr">
</span><span class="sr">    </span><span class="p">&lt;</span><span class="o">?</span><span class="p">[</span><span class="sr"> &#39; &#34; â€˜ â€š â€™ â€œ â€ â€ ã€Œ </span><span class="p">]&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nv">quote</span><span class="o">=.</span><span class="nf">LANG</span><span class="p">(&#39;</span><span class="s1">MAIN</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">quote</span><span class="p">&#39;)&gt;</span><span class="sr">
</span><span class="sr"></span><span class="p">}</span>
</code></pre></div><p>å¹¶ä¸”ä½¿ç”¨ä¸‹é¢è¿™ä¸ªå•ä¸ª action æ›¿æ¢æ‰æ‰€æœ‰çš„åŒ¹é… actions æ–¹æ³•:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">method</span> <span class="nf">escape</span><span class="p">:</span><span class="na">sym</span><span class="p">&lt;</span><span class="s">&#39;</span><span class="p">&gt;(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> <span class="k">make</span> <span class="nf">mark_ww_atom</span><span class="p">(</span><span class="nv">$&lt;quote&gt;</span><span class="o">.</span><span class="nb">ast</span><span class="p">);</span> <span class="p">}</span>
</code></pre></div><p>ç¼–è¯‘! è¿è¡Œæˆ‘ä»¬çš„å¸¦æœ‰æŸäº›å¼•å·å˜ä½“çš„ä»£ç :</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ./raku -e <span class="s1">&#39;.say for qww&lt;â€looks likeâ€ â€šwe fixedâ€˜ ï½¢this thingï½£&gt;&#39;</span>
looks like
we fixed
this thing
</code></pre></div><p>ç²¾å½©! æˆ‘ä»¬ä¸ä»…è®©æ‰€æœ‰çš„å¼•å·éƒ½èƒ½æ­£å¸¸å·¥ä½œ, è¿˜è®¾æ³•æ¸…ç†çš„å­˜åœ¨çš„ tokens å’Œ actions æ–¹æ³•ã€‚ç°åœ¨æ‰€æœ‰æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å¯¹æˆ‘ä»¬çš„ä¿®å¤åšæµ‹è¯•å¹¶ä¸”æˆ‘ä»¬å·²ç»å‡†å¤‡æäº¤äº†ã€‚</p>
<h2 id="äº«ç”¨-bug-çƒ¤è‚‰">äº«ç”¨ bug çƒ¤è‚‰</h2>
<p><a href="https://github.com/raku/roast">Raku å®˜æ–¹æµ‹è¯•å¥—ä»¶ Roast</a> æ˜¯åœ¨ Rakudo å†…å»ºç›®å½•ä¸­çš„ <code>t/spec</code> ä¸­ï¼Œå¦‚æœå®ƒä¸å­˜åœ¨, ä»…ä»…è¿è¡Œ <code>make spectest</code> å°±å¥½äº†å¹¶ä¸”åœ¨å®ƒæŠŠ roast ä»“åº“å…‹éš†åˆ° <code>t/spec</code> ä¸­åå°±ä¸­æ­¢å®ƒã€‚æˆ‘ä»¬éœ€è¦æ‰¾åˆ°åœ¨å“ªé‡Œæ’å…¥æˆ‘ä»¬çš„æµ‹è¯•è€Œ <code>grep</code> æ˜¯å¹²é‚£ä»¶äº‹çš„å¥½æœ‹å‹:</p>
<pre><code>zoffix@VirtualBox:~/CPANPRC/rakudo/t/spec$ grep -R 'qww' .
Binary file ./.git/objects/pack/pack-5bdee39f28283fef4b500859f5b288ea4eec20d7.pack matches
./S02-literals/allomorphic.t:    my @wordlist = qqww[1 2/3 4.5 6e7 8+9i] Z (IntStr, RatStr, RatStr, NumStr, ComplexStr);
./S02-literals/allomorphic.t:        isa-ok $val, Str, &quot;'$val' from qqww[] is a Str&quot;;
./S02-literals/allomorphic.t:        nok $val.isa($wrong-type), &quot;'$val' from qqww[] is not a $wrong-type.perl()&quot;;
./S02-literals/allomorphic.t:    my @wordlist  = qqww:v[1 2/3 4.5 6e7 8+9i];
./S02-literals/allomorphic.t:    my @written = qqww:v[1 2/3 $num 6e7 8+9i ten];
./S02-literals/allomorphic.t:    is-deeply @angled, @written, &quot;Â«...Â» is equivalent to qqww:v[...]&quot;;
./S02-literals/quoting.t:    is(qqww[$alpha $beta], &lt;foo bar&gt;, 'qqww');
./S02-literals/quoting.t:    for (&lt;&lt;$a b c&gt;&gt;, qqww{$a b c}, qqw{$a b c}).kv -&gt; $i, $_ {
./S02-literals/quoting.t:    is-deeply qww&lt;a a â€˜b bâ€™ â€šb bâ€™ â€™b bâ€˜ â€™b bâ€˜ â€™b bâ€™ â€šb bâ€˜ â€šb bâ€™ â€œb bâ€ â€b bâ€
./S02-literals/quoting.t:    'fancy quotes in qww work just like regular quotes';
./integration/advent2014-day16.t:    for flat qww/ foo bar 'first second' / Z @a -&gt; $string, $result {
</code></pre><p>çœ‹èµ·æ¥ <code>S02-literals/quoting.t</code> æ˜¯å®ƒçš„ä¸€ä¸ªå¥½åœ°æ–¹ã€‚æ‰“å¼€é‚£ä¸ªæ–‡ä»¶, åœ¨å®ƒçš„é¡¶éƒ¨, é€šè¿‡æˆ‘ä»¬æ·»åŠ çš„æµ‹è¯•çš„æ•°é‡æ¥å¢åŠ  <code>plan</code> çš„æ•°é‡ â€” åœ¨è¿™ä¸ªä¾‹å­ä¸­ä»…ä»…å¢åŠ ä¸€æ¡å°±å¥½äº†ã€‚ç„¶åæ»šåŠ¨åˆ°åº•éƒ¨å¹¶åˆ›å»ºä¸€ä¸ª block å—, å‰é¢æ·»åŠ ä¸€ä¸ªæ³¨é‡Š, å¹¶ä¸ºæˆ‘ä»¬æ­£ä¿®å¤çš„ <a href="https://rt.perl.org/Ticket/Display.html?id=128304">bug æŠ¥å‘Š</a>å¼•ç”¨é‚£ä¸ª RT æ ‡ç­¾æ•°å­—ã€‚</p>
<p>åœ¨æ–‡ä»¶é‡Œé¢, æˆ‘ä»¬ä½¿ç”¨ <a href="https://docs.raku.org/language/testing#index-entry-is-deeply-is-deeply%28%24value%2C_%24expected%2C_%24description%3F%29">is-deeply</a> æµ‹è¯•å‡½æ•°, å®ƒä½¿ç”¨ <a href="https://docs.raku.org/routine/eqv">eqv æ“ä½œç¬¦</a>è¯­ä¹‰æ¥åšæµ‹è¯•ã€‚æˆ‘ä»¬ä¼šç»™å®ƒä¸€ä¸ªå¸¦æœ‰å®Œæ•´å¼•å·ä¸²çš„ <code>qww&lt;&gt;</code> è¡Œå¹¶å‘Šè¯‰å®ƒæˆ‘ä»¬æ‰€æœŸæœ›è¿”å›çš„é¡¹ç›®åˆ—è¡¨ã€‚è¿˜è¦å†™ä¸‹æµ‹è¯•æè¿°:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># RT #128304</span>
<span class="p">{</span>
    <span class="nb">is-deeply</span> <span class="k">q</span><span class="sa">ww</span><span class="p">&lt;</span><span class="s2">a a â€˜b bâ€™ â€šb bâ€™ â€™b bâ€˜ â€™b bâ€˜ â€™b bâ€™ â€šb bâ€˜ â€šb bâ€™ â€œb bâ€ â€b bâ€
</span><span class="s2">            â€b bâ€œ â€b bâ€œ â€b bâ€ â€b bâ€œ â€b bâ€ ï½¢b bï½£ ï½¢b bï½£</span><span class="p">&gt;</span><span class="o">,</span>
        <span class="p">(&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">,</span> <span class="o">|</span><span class="p">(&#39;</span><span class="s1">b b</span><span class="p">&#39;</span> <span class="ow">xx</span> <span class="mi">16</span><span class="p">))</span><span class="o">,</span>
    <span class="p">&#39;</span><span class="s1">fancy quotes in qww work just like regular quotes</span><span class="p">&#39;;</span>
<span class="p">}</span>
</code></pre></div><p>è¿”å›åˆ° Rakudo checkout, è¿è¡Œä¿®æ”¹åçš„æµ‹è¯•å¹¶ä¿è¯å®ƒé€šè¿‡:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ make t/spec/S02-literals/quoting.t
<span class="c1"># &lt;lots of output&gt;</span>
All tests successful.
<span class="nv">Files</span><span class="o">=</span>1, <span class="nv">Tests</span><span class="o">=</span>185,  <span class="m">3</span> wallclock secs <span class="o">(</span> 0.03 usr  0.01 sys +  2.76 cusr  0.11 <span class="nv">csys</span> <span class="o">=</span>  2.91 CPU<span class="o">)</span>
Result: PASS
</code></pre></div><p>æ¼‚äº®ã€‚æäº¤æµ‹è¯• bug ä¿®å¤å¥½äº†å¹¶ä¸”æŠŠå®ƒä»¬é€èµ°! æˆ‘ä»¬åšåˆ°äº†!</p>
<h2 id="ç»“è®º">ç»“è®º</h2>
<p>å½“æˆ‘ä»¬åœ¨ä¿®å¤ Raku ä¸­çš„è§£æ bugs çš„æ—¶å€™, æŠŠç¨‹åºå‡å°‘åˆ°èƒ½é‡æ–°äº§ç”Ÿé‚£ä¸ª bug çš„æœ€å°éƒ¨åˆ†ç„¶åä½¿ç”¨ <code>--target=parse</code> å‘½ä»¤è¡Œå‚æ•°, å¾—åˆ°è§£ææ ‘çš„è¾“å‡º, æ‰¾åˆ°æ‰€åŒ¹é…çš„é‚£ä¸ª tokensã€‚<code>statementlist</code></p>
<p>ç„¶å, åœ¨ <a href="https://github.com/rakudo/rakudo/blob/04af57c3b3d32353e36614de53396d2b4a08b7be/src/Raku/Grammar.nqp">src/Raku/Grammar.nqp</a> ä¸­è·Ÿéšè¿™äº› tokens, å®ƒä¹Ÿç»§æ‰¿è‡ª <a href="https://github.com/raku/nqp/blob/4fd4b48afb45c8b25ccf7cfc5e39cb4bd658901d/src/HLL/Grammar.nqp">NQP çš„ src/HLL/Grammar.nqp</a> ã€‚ ä¸ä½äº <a href="https://github.com/rakudo/rakudo/blob/04af57c3b3d32353e36614de53396d2b4a08b7be/src/Raku/Actions.nqp">src/Raku/Actions.nqp</a> ä¸­çš„ actions ç±»åä½œ, è·Ÿéšç€ä»£ç æ‰¾å‡ºæ­£åœ¨åšä»€ä¹ˆå¹¶æœŸæœ›æ‰¾å‡ºé—®é¢˜å‡ºç°åœ¨ä»€ä¹ˆä½ç½®ã€‚</p>
<p>ä¿®å¤å®ƒã€‚æµ‹è¯•å®ƒã€‚å‘å¸ƒå®ƒã€‚</p>
<p>å……æ»¡äº†ä¹è¶£ã€‚</p>
<p><a href="http://raku.party/post/Perl-6-Core-Hacking-Grammatical-Babble">http://raku.party/post/Perl-6-Core-Hacking-Grammatical-Babble</a></p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/grammar" term="grammar" label="grammar" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[rotor: åˆ—è¡¨æ“ä½œä¹‹ç‹]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-07-14-the-king-of-list-manipulation/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2015-12-14-add-separator/?utm_source=atom_feed" rel="related" type="text/html" title="ç»™æ•°å­—æ·»åŠ åƒåˆ†ä½ç¬¦" />
            
                <id>https://ohmyweekly.github.io/notes/2015-07-14-the-king-of-list-manipulation/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>The King of List Manipulation</blockquote><p>å¯¹äº Raku ç¨‹åºå‘˜, <code>.rotor</code> æ˜¯ä¸€ä¸ªå¼ºå¤§çš„åˆ—è¡¨æ“ä½œå·¥å…·ã€‚</p>
<h2 id="åˆ†æ®µ">åˆ†æ®µ</h2>
<p>æœ€ç®€å•çš„, <code>.rotor</code> æ¥æ”¶ä¸€ä¸ªæ•´æ•° <strong>$number</strong> å¹¶æŠŠåˆ—è¡¨åˆ†æˆå¤šä¸ªå­åˆ—è¡¨, æ¯ä¸ªå­åˆ—è¡¨å«æœ‰ <strong>$number</strong> ä¸ªå…ƒç´ :</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&lt;</span><span class="s">a b c d e f  g h</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">rotor</span><span class="o">:</span> <span class="mi">3</span>
<span class="c1"># ((a b c) (d e f))</span>
</code></pre></div><p>æˆ‘ä»¬æœ‰ä¸€ä¸ªå«æœ‰ 8 ä¸ªå…ƒç´ çš„åˆ—è¡¨, æˆ‘ä»¬åœ¨è¯¥åˆ—è¡¨ä¸Šè°ƒç”¨æ¥æ”¶å‚æ•° 3 çš„ <code>.rotor</code> æ–¹æ³•, å®ƒè¿”å› 2 ä¸ªåˆ—è¡¨, æ¯ä¸ªåˆ—è¡¨ä¸­å«æœ‰ 3 ä¸ªå…ƒç´ ã€‚ä¸åŒ…æ‹¬åŸåˆ—è¡¨ä¸­çš„æœ€å 2 ä¸ªå…ƒç´ , å› ä¸ºå®ƒä»¬æ²¡æœ‰ç»„æˆä¸€ä¸ªå®Œæ•´çš„3ä¸ªå…ƒç´ çš„åˆ—è¡¨ã€‚ç„¶è€Œå®ƒä»¬å¯ä»¥è¢«åŒ…å«è¿›æ¥, ä½¿ç”¨ <code>:partial</code> å…·åå‚æ•°è®¾ç½®ä¸º <strong>True</strong>:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&lt;</span><span class="s">a b c  d e f  g h</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">rotor</span><span class="o">:</span> <span class="mi">3</span><span class="o">,</span> <span class="p">:</span><span class="s">partial</span>
<span class="c1"># ((a b c) (d e f) (g h))</span>

<span class="nb">say</span> <span class="p">&lt;</span><span class="s">a b c  d e f  g h</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">rotor</span><span class="o">:</span> <span class="mi">3</span><span class="o">,</span> <span class="p">:</span><span class="s">partial</span><span class="p">(</span><span class="nb">True</span><span class="p">)</span>
<span class="c1"># ((a b c) (d e f) (g h))</span>

<span class="nb">say</span> <span class="p">&lt;</span><span class="s">a b c  d e f  g h</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">rotor</span><span class="o">:</span> <span class="mi">3</span><span class="o">,</span> <span class="p">:</span><span class="s">partial</span><span class="p">(</span><span class="nb">False</span><span class="p">)</span>
<span class="c1"># ((a b c) (d e f))</span>
</code></pre></div><p>ä¸‹é¢åº”ç”¨ä¸€ä¸‹æˆ‘ä»¬åˆšåˆšå­¦åˆ°çš„ã€‚æŠŠå­—ç¬¦ä¸²åˆ†æˆåˆ—å®½ç›¸ç­‰çš„å‡ æ®µ:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">&#34;</span><span class="s2">foobarberboorboozebazmeow</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">comb</span><span class="o">.</span><span class="nb">rotor</span><span class="p">(</span><span class="mi">10</span><span class="o">,</span> <span class="p">:</span><span class="s">partial</span><span class="p">)</span><span class="o">Â».</span><span class="nb">join</span><span class="o">Â».</span><span class="nb">say</span><span class="p">;</span>

<span class="c1"># foobarberb</span>
<span class="c1"># oorboozeba</span>
<span class="c1"># zmeow</span>
</code></pre></div><p>åˆ†è¡Œç„¶åæ¯è¡Œå‰é¢æ·»åŠ  4 ä¸ªç©ºæ ¼:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">&#34;</span><span class="s2">foobarberboorboozebazmeow</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">comb</span><span class="o">.</span><span class="nb">rotor</span><span class="p">(</span><span class="mi">10</span><span class="o">,</span> <span class="p">:</span><span class="s">partial</span><span class="p">)</span><span class="o">Â».</span><span class="nb">join</span><span class="o">Â».</span><span class="nb">indent</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">Â».</span><span class="nb">say</span><span class="p">;</span>

<span class="c1">#    foobarberb</span>
<span class="c1">#    oorboozeba</span>
<span class="c1">#    zmeow</span>
</code></pre></div><p>ä½†æ˜¯è¿™æœ€å¥½è¢«å†™ä¸º:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">&#34;</span><span class="s2">foobarberboorboozebazmeow</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">comb</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">Â».</span><span class="nb">say</span>
</code></pre></div><h2 id="æ³¨æ„ç¼éš™">æ³¨æ„ç¼éš™</h2>
<p>å‡è®¾ä½ æ­£åœ¨æ¥å—è¾“å…¥: ä½ å¾—åˆ°ä¸€ä¸ªå•è¯, å®ƒçš„æ³•è¯­ç¿»è¯‘å’Œå®ƒçš„è¥¿ç­ç‰™è¯­ç¿»è¯‘, ç­‰ä¸€å †å•è¯ã€‚ä½ åªæƒ³è¾“å‡ºç‰¹å®šè¯­è¨€, æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨æˆ‘ä»¬çš„åˆ—è¡¨ä¸­è·³è¿‡æŸäº›é¡¹ã€‚ <code>.rotor</code> æ¥æ‹¯æ•‘æ¥äº†!</p>
<p>æŒ‡å®šä¸€å¯¹å„¿(Pair)æ•´æ•°ä½œä¸º rotor çš„å‚æ•°ä¼šè®©æ¯ä¸ªåˆ—è¡¨ä¸­å«æœ‰ <strong>$key</strong> ä¸ªå…ƒç´ , æ¯ä¸ªåˆ—è¡¨ä¹‹é—´æœ‰ <strong>$value</strong> ä¸ªç©ºéš™ã€‚çœ‹ä¾‹å­æ›´ç®€å•ä¸€äº›:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="o">^</span><span class="mi">10</span> <span class="o">.</span><span class="nb">rotor</span><span class="o">:</span> <span class="mi">3</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="o">,</span> <span class="p">:</span><span class="s">partial</span><span class="p">;</span>
<span class="c1"># OUTPUT: ((0 1 2) (4 5 6) (8 9))</span>

<span class="nb">say</span> <span class="o">^</span><span class="mi">10</span> <span class="o">.</span><span class="nb">rotor</span><span class="o">:</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="o">,</span> <span class="p">:</span><span class="s">partial</span><span class="p">;</span>
<span class="c1"># OUTPUT: ((0 1) (4 5) (8 9))</span>
</code></pre></div><p>ç¬¬ä¸€ä¸ªä¾‹å­æˆ‘ä»¬æŠŠç¼éš™è®¾ç½®ä¸º 1, ç¬¬äºŒä¸ªä¾‹å­æˆ‘ä»¬æŠŠç¼éš™å¢åŠ ä¸º 2ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">enum</span> <span class="p">&lt;</span><span class="s">English French Spanish</span><span class="p">&gt;;</span>
<span class="nb">say</span> <span class="nb">join</span> <span class="p">&#34;</span><span class="s2"> </span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&lt;</span><span class="s">Good Bon Buenos morning matin dÃ­as</span><span class="p">&gt;</span><span class="o">[</span><span class="n">French</span><span class="o">..*].</span><span class="nb">rotor</span><span class="o">:</span> <span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">;</span>
<span class="c1"># OUTPUT: Bon matin</span>
</code></pre></div><p>å…¶ä¸­ <code>[French..*]</code> æ„æ€ä¸º <code>[1..*]</code>, ä¾‹å­ä¸­ French è¢«æšä¸¾åŒ–ä¸ºæ•´æ•° 1ã€‚</p>
<h2 id="é‡å ">é‡å </h2>
<p>å½“æˆ‘ä»¬è®©ç¼éš™å˜ä¸ºè´Ÿæ•°çš„æ—¶å€™, åˆ†æ®µçš„åˆ—è¡¨ä¸­å°±ä¼šæœ‰å…ƒç´ é‡å :</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&lt;</span><span class="s">a a b c c c d</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">rotor</span><span class="o">:</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="o">-</span><span class="mi">1</span>
<span class="c1"># OUTPUT: ((a a) (a b) (b c) (c c) (c c) (c d))</span>

<span class="nb">say</span> <span class="p">&lt;</span><span class="s">a a b c c c d</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">rotor</span><span class="p">(</span><span class="mi">2</span> <span class="o">=&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="nb">map</span><span class="o">:</span> <span class="p">{</span><span class="nv">$_</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="ow">eq</span> <span class="nv">$_</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">??</span> <span class="p">&#34;</span><span class="s2">same</span><span class="p">&#34;</span> <span class="o">!!</span> <span class="p">&#34;</span><span class="s2">different</span><span class="p">&#34;}</span>
<span class="c1"># OUTPUT: (same different different same same different)</span>
</code></pre></div><h2 id="å…¨åŠ›ä»¥èµ´">å…¨åŠ›ä»¥èµ´</h2>
<p><code>.rotor</code> ä¸å•å•åªèƒ½æ¥å—å•ä¸ª <strong>Int</strong> å€¼æˆ– <strong>Pair</strong>, ä½ å¯ä»¥æŒ‡å®šé¢å¤–çš„ <strong>Int</strong> æˆ– <strong>Pairs</strong> ä½ç½®å‚æ•°æ¥æŠŠåˆ—è¡¨åˆ†æˆä¸åŒå°ºå¯¸å¤§å°çš„å­åˆ—è¡¨, åˆ—è¡¨ä¹‹é—´çš„ç¼éš™ä¹Ÿä¸åŒã€‚ä¸‹é¢ä»¥ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ä¸ºä¾‹:</p>
<pre><code>IP: 198.0.1.22
Login: suser
Time: 1454017107
Resource: /report/accounting/x23gs
Input: x=42,y=32
Output: success
===================================================
IP: 198.0.1.23
Login: nanom
Time: 1454027106
Resource: /report/systems/boot
Input: mode=standard
Output: success
</code></pre><p>æ¯æ®µä¹‹é—´æœ‰ä¸€è¡ŒåŒåˆ’çº¿ã€‚</p>
<p>æˆ‘ä»¬æƒ³è¿™æ ·è¾“å‡º: <strong>Header</strong> é‡ŒåŒ…å« IP, Login, Time, Resource; <strong>Operation</strong> é‡ŒåŒ…å« Resource, Input, Outputã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="p">&#39;</span><span class="s1">report.txt</span><span class="p">&#39;</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">lines</span><span class="o">Â».</span><span class="nb">indent</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="nb">rotor</span><span class="p">(</span> <span class="mi">4</span> <span class="o">=&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="mi">3</span> <span class="o">=&gt;</span> <span class="mi">1</span> <span class="p">)</span> <span class="k">-&gt;</span> <span class="nv">$head</span><span class="o">,</span> <span class="nv">$op</span> <span class="p">{</span>
    <span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="p">&#34;</span><span class="s2">Header:</span><span class="p">&#34;</span><span class="o">,</span>    <span class="o">|</span><span class="nv">$head</span><span class="o">,</span>
             <span class="p">&#34;</span><span class="s2">Operation:</span><span class="p">&#34;</span><span class="o">,</span> <span class="o">|</span><span class="nv">$op</span><span class="o">,</span> <span class="p">&#39;&#39;;</span>
<span class="p">}</span>
</code></pre></div><p>è¾“å‡º:</p>
<pre><code>Header:
    IP: 198.0.1.22
    Login: suser
    Time: 1454017107
    Resource: /report/accounting/x23gs
Operation:
    Resource: /report/accounting/x23gs
    Input: x=42,y=32
    Output: success

Header:
    IP: 198.0.1.23
    Login: nanom
    Time: 1454027106
    Resource: /report/systems/boot
Operation:
    Resource: /report/systems/boot
    Input: mode=standard
    Output: success
</code></pre><p>å…ˆæ˜¯ 4 ä¸ªå…ƒç´ ä¸€å—, ç¼éš™ä¸º -1(æœ‰é‡å ), ç„¶åæ˜¯ 3 ä¸ªå…ƒç´ ä¸€å—, ç¼éš™ä¸º 1ã€‚è¿™å°±åœ¨æ¯ä¸ªåˆ†æ®µçš„åˆ—è¡¨ä¸­åŒ…å«äº† Resource å­—æ®µã€‚å› ä¸º <code>$op</code> å’Œ <code>$head</code> æ˜¯åˆ—è¡¨, æˆ‘ä»¬ä½¿ç”¨ç®¡é“ç¬¦å· <code>|</code> æ¥å±•å¹³åˆ—è¡¨ã€‚</p>
<p>è®°ä½, ä½ æä¾›ç»™ <code>.rotor</code> æ–¹æ³•çš„æ¨¡å¼å¯ä»¥åŠ¨æ€åœ°ç”Ÿæˆ! è¿™å„¿æˆ‘ä»¬ä½¿ç”¨ <code>sin</code> å‡½æ•°æ¥ç”Ÿæˆ:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="o">^</span><span class="mi">92</span> <span class="o">.</span><span class="nb">rotor</span><span class="p">(</span>
    <span class="p">(</span><span class="mf">0.2</span><span class="o">,</span> <span class="mf">0.4</span> <span class="o">...</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="nb">map</span><span class="o">:</span> <span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="o">*.</span><span class="nb">sin</span><span class="p">)</span><span class="o">.</span><span class="nb">Int</span> <span class="c1"># pattern we supply to .rotor</span>
<span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="o">:</span> <span class="p">&#34;</span><span class="s2">\n</span><span class="p">&#34;&#39;</span><span class="s1">
</span></code></pre></div><p>è¾“å‡º:</p>
<pre><code>0
1 2 3
4 5 6 7 8
9 10 11 12 13 14 15
16 17 18 19 20 21 22 23
24 25 26 27 28 29 30 31 32
33 34 35 36 37 38 39 40 41
42 43 44 45 46 47 48 49 50
51 52 53 54 55 56 57 58 59
60 61 62 63 64 65 66 67 68
69 70 71 72 73 74 75 76
77 78 79 80 81 82
83 84 85 86 87
88 89 90
91
</code></pre><p>å†ä¸¾ä¸ªä¾‹å­:</p>
<p>æˆ‘ç°åœ¨æƒ³è¦å°†åŒç±»çš„åºåˆ—ï¼ˆå­—ç¬¦ä¸²ï¼‰è¿›è¡Œåˆå¹¶ï¼Œæ¯”å¦‚æœ‰è¿™æ ·ä¸€ä¸ªæ–‡ä»¶ï¼š</p>
<pre><code>&gt;seq-1A
GACACAGTCACCCGAGCCT
&gt;seq-1B
TCAATCAATACTGAAGCGA
&gt;seq-1C
AAAACTAGTCGAGAAGAGAG
&gt;seq-1D
CGTGGAAAACTCCAG
&gt;seq-2A
TAAAAGGCGTTCATTGGATATTTC
&gt;seq-2B
ACTGGCAGTGCATCC
</code></pre><p>æˆ‘æƒ³è¦è¿›è¡Œåˆå¹¶ å¾—åˆ°è¿™æ ·çš„ç»“æœï¼š</p>
<pre><code>&gt;seq-1
GACACAGTCACCCGAGCCTTCAATCAATACTGAAGCGAAAAACTAGTCGAGAAGAGAGCGTGGAAAACTCCAG
&gt;seq-2
TAAAAGGCGTTCATTGGATATTTCACTGGCAGTGCATCC
</code></pre><p>ä½¿ç”¨ <code>rotor</code> æ¥å®ç°:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%re</span><span class="p">;</span>
<span class="k">for</span> <span class="p">&#39;</span><span class="s1">input.txt</span><span class="p">&#39;</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">lines</span><span class="o">Â».</span><span class="nb">rotor</span><span class="p">(</span><span class="mi">2</span><span class="o">,</span> <span class="p">:</span><span class="s">partial</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nv">$header</span><span class="o">,</span> <span class="nv">$data</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$key</span> <span class="o">=</span> <span class="nv">$header</span><span class="p">;</span>
    <span class="nv">$key</span> <span class="o">~~</span> <span class="k">s</span><span class="p">/&lt;</span><span class="nb">upper</span><span class="p">&gt;</span><span class="ni">$</span><span class="p">//;</span>
    <span class="nv">%re</span><span class="p">{</span><span class="nv">$key</span><span class="p">}</span> <span class="o">~=</span> <span class="nv">$data</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">for</span> <span class="nv">%re</span><span class="o">.</span><span class="nb">kv</span> <span class="k">-&gt;</span> <span class="nv">$key</span><span class="o">,</span> <span class="nv">$value</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$key</span><span class="s2">\n</span><span class="nv">$value</span><span class="p">&#34;;</span>
<span class="p">}</span>
</code></pre></div><h2 id="å®˜ç½‘çš„ä¾‹å­">å®˜ç½‘çš„ä¾‹å­</h2>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">method</span> <span class="nb">rotor</span><span class="p">(</span><span class="o">*</span><span class="nv">@cycle</span><span class="o">,</span> <span class="nb">Bool</span><span class="p">()</span> <span class="o">:</span><span class="nv">$partial</span><span class="p">)</span>
</code></pre></div><p>rotor è¿”å›ä¸€ä¸ª list, è¿™ä¸ª list çš„å…ƒç´ ä¹Ÿæ˜¯ list, Â å…¶ä¸­æ¯ä¸ªå­åˆ—è¡¨ç”±è°ƒç”¨è€…ä¸­çš„å…ƒç´ ç»„æˆ. Â åœ¨æœ€ç®€å•çš„æƒ…å†µä¸‹, <code>@cycle</code> åªåŒ…å«ä¸€ä¸ªæ•´æ•°, è¿™æ—¶è°ƒç”¨è€…åˆ—è¡¨è¢«åˆ†å‰²ä¸ºå¤šä¸ªå­åˆ—è¡¨, æ¯ä¸ªå­åˆ—è¡¨ä¸­çš„å…ƒç´ å°½å¯èƒ½å¤šçš„ä¸ºé‚£ä¸ªæ•´æ•°æŒ‡å®šçš„ä¸ªæ•°. å¦‚æœ <code>:$partial</code> ä¸º True, ä¸å¤Ÿåˆ†çš„æœ€åé‚£éƒ¨åˆ†ä¹Ÿä¼šè¢«åŒ…æ‹¬è¿›å», å³ä½¿å®ƒä¸æ»¡è¶³é•¿åº¦çš„è¦æ±‚:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">(&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">h</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">rotor</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;</span><span class="s1">|</span><span class="p">&#39;);</span>           <span class="c1"># a b c|d e f</span>
<span class="nb">say</span> <span class="p">(&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">h</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">rotor</span><span class="p">(</span><span class="mi">3</span><span class="o">,</span> <span class="p">:</span><span class="s">partial</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;</span><span class="s1">|</span><span class="p">&#39;);</span> <span class="c1"># a b c|d e f|g h</span>
</code></pre></div><p>å¦‚æœ <code>@cycle</code> çš„å…ƒç´ æ˜¯ä¸€ä¸ªÂ Â <a href="">/type/Pair</a>, åˆ™ Pair çš„é”®æŒ‡å®šäº†æ‰€è¿”å›å­åˆ—è¡¨çš„é•¿åº¦(å³æ¯ä¸ªå­åˆ—è¡¨ä¸­å«æœ‰çš„å…ƒç´ æ•°), Pair çš„é”®å€¼æŒ‡å®šä¸¤ä¸ªåˆ—è¡¨ä¹‹é—´çš„é—´éš™; è´Ÿçš„é—´éš™ä¼šäº§ç”Ÿé‡å :</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">(&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">h</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">rotor</span><span class="p">(</span><span class="mi">2</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;</span><span class="s1">|</span><span class="p">&#39;);</span>  <span class="c1"># a b|d e|g h</span>
<span class="nb">say</span> <span class="p">(&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">h</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">rotor</span><span class="p">(</span><span class="mi">3</span> <span class="o">=&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;</span><span class="s1">|</span><span class="p">&#39;);</span> <span class="c1"># a b c|c d e|e f g</span>

<span class="k">my</span> <span class="nv">$pair</span> Â <span class="o">=</span> <span class="mi">2</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$key</span> Â  <span class="o">=</span> <span class="nv">$pair</span><span class="o">.</span><span class="nb">key</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$value</span> <span class="o">=</span> <span class="nv">$pair</span><span class="o">.</span><span class="nb">value</span><span class="p">;</span>

<span class="nb">say</span> <span class="p">(&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">h</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">rotor</span><span class="p">(</span><span class="nv">$key</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;</span><span class="s1">|</span><span class="p">&#39;)</span> <span class="c1"># a b|d e|g h</span>
</code></pre></div><p>å¦‚æœ <code>@cycle</code> çš„å…ƒç´ ä¸ªæ•°å¤§äº 1 æ—¶, Â rotor ä¼šæŒ‰ <code>@cycle</code> ä¸­çš„å…ƒç´ ä¾æ¬¡å¾ªç¯è°ƒç”¨è€…åˆ—è¡¨, å¾—åˆ°æ¯ä¸ªå­åˆ—è¡¨:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">(&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">h</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">rotor</span><span class="p">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;</span><span class="s1">|</span><span class="p">&#39;);</span>      <span class="c1"># a b|c d e|f g</span>
<span class="nb">say</span> <span class="p">(&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">h</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">rotor</span><span class="p">(</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;</span><span class="s1">|</span><span class="p">&#39;);</span> <span class="c1"># a|c d e|f</span>
</code></pre></div><p>ç»„åˆå¤šä¸ªå¾ªç¯å‘¨æœŸå’Œ <code>:partial</code> ä¹Ÿæœ‰æ•ˆ:</p>
<div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="nf">say </span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="n">..</span><span class="s">&#39;h&#39;</span><span class="p">)</span><span class="nf">.rotor</span><span class="p">(</span><span class="m">1</span> <span class="o">=&gt;</span> <span class="m">1</span><span class="p">,</span> <span class="m">3</span> <span class="o">=&gt;</span> <span class="m">-1</span><span class="p">,</span> <span class="o">:</span><span class="n">partial</span><span class="p">)</span><span class="nf">.join</span><span class="p">(</span><span class="s">&#39;|&#39;</span><span class="p">);</span> <span class="c1"># a|c d e|e|g h</span>
</code></pre></div><p>æ³¨æ„, ä» <code>rotor</code> å‡½æ•°è¿”å›çš„ä¸€åˆ—åˆ—è¡¨ä»¬èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡æ—¶ä¼šå±•å¼€ä¸ºä¸€ä¸ªæ•°ç»„:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@maybe_lol</span> <span class="o">=</span> <span class="p">(&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">h</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">rotor</span><span class="p">(</span><span class="mi">2</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">);</span>
<span class="nv">@maybe_lol</span><span class="o">.</span><span class="nb">raku</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span> <span class="c1"># Â [&#34;a&#34;, &#34;b&#34;, &#34;d&#34;, &#34;e&#34;, &#34;g&#34;, &#34;h&#34;]&lt;&gt;</span>
</code></pre></div><p>è¿™å¯èƒ½ä¸æ˜¯ä½ æƒ³è¦çš„, å› ä¸º rotor ä¹‹åçš„è¾“å‡ºçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">(&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">h</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">rotor</span><span class="p">(</span><span class="mi">2</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span> <span class="c1"># ((&#34;a&#34;, &#34;b&#34;), (&#34;d&#34;, &#34;e&#34;), (&#34;g&#34;, &#34;h&#34;))</span>
</code></pre></div><p>è¦å¼ºåˆ¶è¿”å›åˆ—è¡¨çš„åˆ—è¡¨, ä½¿ç”¨ç»‘å®šè€Œéèµ‹å€¼:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@really_lol</span> <span class="o">:=</span> <span class="p">(&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">h</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">rotor</span><span class="p">(</span><span class="mi">2</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">);</span>
<span class="nv">@really_lol</span><span class="o">.</span><span class="nb">raku</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span> <span class="c1"># ((&#34;a&#34;, &#34;b&#34;), (&#34;d&#34;, &#34;e&#34;), (&#34;g&#34;, &#34;h&#34;))</span>
</code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/rotor" term="rotor" label="rotor" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Sneaky Methods]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-05-01-sneaky-methods/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-05-01-sneaky-methods/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Sneaky Methods</blockquote><p>å°±åƒä½ æƒ³çš„é‚£æ ·, åœ¨ç±»çš„å®šä¹‰ä¸­å¯ä»¥å£°æ˜å’Œå®šä¹‰æ–¹æ³•ã€‚ä½ æœŸæœ›ä¸é«˜çš„ç”šè‡³æ–‡æ¡£ä¸­éƒ½å¾ˆå°‘æåŠæ˜¯ç”¨ <code>my</code> å…³é”®å­—å£°æ˜çš„å…è´¹æµ®ç‚¹æ–¹æ³•ã€‚ç°åœ¨ä¸ºä»€ä¹ˆä½ æƒ³è¦:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="k">method</span> <span class="nf">foo</span><span class="p">(</span><span class="n">SomeClass:D:</span><span class="p">)</span> <span class="p">{</span> <span class="nb">self</span> <span class="p">}</span>
</code></pre></div><p>æ˜æ˜¾çš„ç­”æ¡ˆæ˜¯<a href="https://docs.raku.org/language/mop">å…ƒå¯¹è±¡åè®®</a>ä¸­çš„ <a href="https://docs.raku.org/type/Metamodel$COLON$COLONMethodContainer#method_add_method">add_method</a> æ–¹æ³•, åœ¨ Rakudo é‡Œä½ èƒ½æ‰¾åˆ°å®ƒï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="n">src</span><span class="o">/</span><span class="n">core</span><span class="o">/</span><span class="nb">Bool</span><span class="o">.</span><span class="nf">pm</span>
<span class="mi">32</span><span class="o">:</span>    <span class="nb">Bool</span><span class="o">.^</span><span class="nb">add_method</span><span class="p">(&#39;</span><span class="s1">pred</span><span class="p">&#39;</span><span class="o">,</span>  <span class="k">my</span> <span class="k">method</span> <span class="nb">pred</span><span class="p">()</span> <span class="p">{</span> <span class="nb">Bool</span><span class="o">:</span><span class="p">:</span><span class="s">False</span> <span class="p">});</span>
<span class="mi">33</span><span class="o">:</span>    <span class="nb">Bool</span><span class="o">.^</span><span class="nb">add_method</span><span class="p">(&#39;</span><span class="s1">succ</span><span class="p">&#39;</span><span class="o">,</span>  <span class="k">my</span> <span class="k">method</span> <span class="nb">succ</span><span class="p">()</span> <span class="p">{</span> <span class="nb">Bool</span><span class="o">:</span><span class="p">:</span><span class="s">True</span> <span class="p">});</span>
<span class="mi">35</span><span class="o">:</span>    <span class="nb">Bool</span><span class="o">.^</span><span class="nb">add_method</span><span class="p">(&#39;</span><span class="s1">enums</span><span class="p">&#39;</span><span class="o">,</span> <span class="k">my</span> <span class="k">method</span> <span class="nb">enums</span><span class="p">()</span> <span class="p">{</span> <span class="nb">self</span><span class="o">.^</span><span class="nb">enum_values</span> <span class="p">});</span>
</code></pre></div><p>è¿™ç§æ–¹æ³•è¿˜æœ‰å¦å¤–ä¸€ç§æ›´è¯¡å¼‚çš„ç”¨æ³•ã€‚ä½ å¯èƒ½å¾ˆæƒ³çŸ¥é“åœ¨é“¾å¼æ–¹æ³•è°ƒç”¨ä¸­ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆã€‚æˆ‘ä»¬å¯ä»¥æ‰¯å¼€æœ€ä¸Šé¢çš„é‚£ä¸ªè¡¨è¾¾å¼å¹¶æ’å…¥ä¸€ä¸ªçŸ­çš„å˜é‡, è¾“å‡ºæˆ‘ä»¬çš„è°ƒè¯•, å¹¶ä¸”ç»§ç»­é“¾å¼è°ƒç”¨ã€‚å¥½çš„åå­—å¾ˆé‡è¦å¹¶ä¸”æŠŠå®ƒä»¬æµªè´¹åœ¨ä¸€ä¸ªçŸ­å˜é‡ä¸Šæ²¡æœ‰å¿…è¦ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;</span><span class="o">.&amp;</span><span class="p">(</span><span class="k">my</span> <span class="k">method</span> <span class="nf">::</span><span class="p">(</span><span class="nb">List:D</span><span class="p">)</span> <span class="p">{</span> <span class="n">dd</span> <span class="nb">self</span><span class="p">;</span> <span class="nb">self</span> <span class="p">}</span> <span class="p">)</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>

<span class="c1"># output</span>
<span class="c1"># (&#34;a&#34;, &#34;b&#34;, &#34;c&#34;)</span>
<span class="c1"># (a b c)</span>
</code></pre></div><p>æ²¡æœ‰æ˜¾å¼è°ƒç”¨æˆ‘ä»¬å°±ä¸èƒ½æ²¡æœ‰åå­—, å› ä¸º Raku ä¸å…è®¸æˆ‘ä»¬è¿™æ ·åš, æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨äº†ç©ºçš„ä½œç”¨åŸŸ <code>::</code> ä»¥ä½¿è§£æå™¨é«˜å…´ã€‚ä½¿ç”¨ä¸€ä¸ªåˆé€‚çš„è°ƒç”¨, æˆ‘ä»¬å°±ä¸éœ€è¦å®ƒäº†ã€‚è¿˜æœ‰, é‚£ä¸ªåŒ¿åæ–¹æ³•ä¸æ˜¯ List ä¸­çš„ä¸€å‘˜ã€‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨åç¼€ <code>.&amp;</code> æ¥è°ƒç”¨å®ƒã€‚å¦‚æœæˆ‘ä»¬éœ€è¦å¤šæ¬¡ä½¿ç”¨é‚£ä¸ªæ–¹æ³•æˆ‘ä»¬å¯ä»¥æŠŠå®ƒæ‹‰å‡ºæ¥å¹¶ç»™å®ƒä¸€ä¸ªåå­—ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="k">multi</span> <span class="k">method</span> <span class="nf">debug</span><span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span><span class="p">)</span> <span class="p">{</span> <span class="n">dd</span> <span class="nb">self</span><span class="p">;</span> <span class="nb">self</span> <span class="p">};</span>
<span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;</span><span class="o">.&amp;</span><span class="nf">debug</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>

<span class="c1"># output</span>
<span class="p">(&#34;</span><span class="s2">a</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">b</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">c</span><span class="p">&#34;)</span>
<span class="p">(</span><span class="n">a</span> <span class="n">b</span> <span class="n">c</span><span class="p">)</span>
</code></pre></div><p>æˆ–è€…, å¦‚æœæˆ‘ä»¬æƒ³å…è®¸å›è°ƒçš„è¯, æˆ‘ä»¬å¯ä»¥æŠŠå®ƒä½œä¸ºé»˜è®¤å‚æ•°èµ‹å€¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">f</span><span class="p">(</span><span class="nv">@l</span><span class="o">,</span> <span class="o">:</span><span class="nv">&amp;debug</span> <span class="o">=</span> <span class="k">my</span> <span class="k">method</span> <span class="p">(</span><span class="nb">List</span><span class="p">:</span><span class="s">D</span><span class="o">:</span><span class="p">){</span><span class="nb">self</span><span class="p">})</span> <span class="p">{</span> <span class="nv">@l</span><span class="o">.&amp;</span><span class="nf">debug</span><span class="o">.</span><span class="nb">say</span> <span class="p">};</span>
<span class="nb">f</span> <span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;</span><span class="o">,</span> <span class="s">debug</span> <span class="o">=&gt;</span> <span class="k">my</span> <span class="k">method</span> <span class="nf">::</span><span class="p">(</span><span class="nb">List:D</span><span class="p">){</span><span class="n">dd</span> <span class="nb">self</span><span class="p">;</span> <span class="nb">self</span><span class="p">};</span>

<span class="c1"># output</span>
<span class="c1">#(&#34;a&#34;, &#34;b&#34;, &#34;c&#34;)</span>
<span class="c1"># (a b c)</span>
</code></pre></div><p>åœ¨ Raku ä¸­åŸºæœ¬ä¸Šæ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯ç±», åŒ…æ‹¬<a href="https://docs.raku.org/type/Method">æ–¹æ³•</a>ã€‚ å¦‚æœå®ƒæ˜¯ç±»å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡å¹¶ä¸”æˆ‘ä»¬èƒ½åœ¨æˆ‘ä»¬å–œæ¬¢çš„ä»»ä½•åœ°æ–¹æºœè¿›å»ã€‚</p>
<p><a href="https://gfldex.wordpress.com/2016/07/20/sneaky-methods/">https://gfldex.wordpress.com/2016/07/20/sneaky-methods/</a></p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/method" term="method" label="method" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Swift ä¸­çš„ protocol å’Œ Raku ä¸­çš„ roles ä¸€ä¾‹]]></title>
            <link href="https://ohmyweekly.github.io/notes/2016-01-21-protocol-in-swift-and-roles-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2015-11-16-roles-conflict-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="Raku ä¸­çš„è§’è‰²å†²çª" />
            
                <id>https://ohmyweekly.github.io/notes/2016-01-21-protocol-in-swift-and-roles-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Protocol in Swift and Roles in Raku</blockquote><p>Protocol åœ¨ Swift ä¸­æ˜¯ä¸€ç»„æ–¹æ³•å’Œå±æ€§çš„é›†åˆ, å¯ç”¨äºä»£ç å¤ç”¨ã€‚ Raku ä¸­æœ‰ä¸ä¹‹ç±»ä¼¼çš„ç»“æ„, å«åš <code>Role</code>, ä¸‹é¢è½¬æ¢ä¸€ä¸ª Swift çš„ Protocol ä¸º Raku çš„ Role, æŠŠéƒ¨é—¨äººå‘˜çš„ç›¸å…³ä¿¡æ¯æ‰“å°ä¸ºä¸€ä¸ªè¡¨æ ¼:</p>
<h2 id="protocol-in-swift">Protocol in Swift</h2>
<p>ã€€</p>
<div class="highlight"><pre class="chroma"><code class="language-perl" data-lang="perl"><span class="nb">import</span> <span class="n">UIKit</span>

<span class="n">func</span> <span class="n">padding</span><span class="p">(</span><span class="n">amount:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">String</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">paddingString</span> <span class="o">=</span> <span class="s">&#34;&#34;</span>
    <span class="k">for</span> <span class="n">_</span> <span class="n">in</span> <span class="mi">0</span><span class="o">..&lt;</span><span class="n">amount</span> <span class="p">{</span>
        <span class="n">paddingString</span> <span class="o">+=</span> <span class="s">&#34; &#34;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">paddingString</span>
<span class="p">}</span>

<span class="sr">//</span> <span class="n">åè®®</span>

<span class="n">protocol</span> <span class="n">TabularDataSource</span> <span class="p">{</span>
    <span class="n">var</span> <span class="n">numberOfRows:</span> <span class="n">Int</span>    <span class="p">{</span> <span class="n">get</span> <span class="p">}</span>
    <span class="n">var</span> <span class="n">numberOfColumns:</span> <span class="n">Int</span> <span class="p">{</span> <span class="n">get</span> <span class="p">}</span>

    <span class="n">func</span> <span class="n">labelForRow</span><span class="p">(</span><span class="n">row:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">String</span>        <span class="sr">//</span> <span class="n">è¡Œæ ‡ç­¾</span>
    <span class="n">func</span> <span class="n">labelForColumn</span><span class="p">(</span><span class="n">column:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">String</span>  <span class="sr">//</span> <span class="n">åˆ—æ ‡ç­¾</span>

    <span class="n">func</span> <span class="n">itemForRow</span><span class="p">(</span><span class="n">row:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">column:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Int</span> <span class="sr">//</span> <span class="n">è¡¨æ ¼ä¸­çš„å•å…ƒæ ¼</span>
<span class="p">}</span>



<span class="n">struct</span> <span class="n">Person</span> <span class="p">{</span>
    <span class="n">let</span> <span class="n">name:</span> <span class="n">String</span>
    <span class="n">let</span> <span class="n">age:</span> <span class="n">Int</span>
    <span class="n">let</span> <span class="n">yearsOfExperience:</span> <span class="n">Int</span>
<span class="p">}</span>

<span class="sr">//</span> <span class="n">è®©</span> <span class="o">**</span><span class="n">Department</span><span class="o">**</span> <span class="n">éµå®ˆ</span> <span class="o">**</span><span class="n">TabularDataSource</span><span class="o">**</span><span class="n">åè®®</span>
<span class="n">struct</span> <span class="n">Department:</span> <span class="n">TabularDataSource</span> <span class="p">{</span>
    <span class="n">let</span> <span class="n">name:</span> <span class="n">String</span>
    <span class="n">var</span> <span class="n">people</span> <span class="o">=</span> <span class="p">[</span><span class="n">Person</span><span class="p">]()</span>

    <span class="n">init</span><span class="p">(</span><span class="n">name:</span> <span class="n">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="p">}</span>

    <span class="n">mutating</span> <span class="n">func</span> <span class="n">addPerson</span><span class="p">(</span><span class="n">person:</span> <span class="n">Person</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">people</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="sr">//</span> <span class="n">å®ç°åè®®ä¸­å£°æ˜çš„å±æ€§å’Œæ–¹æ³•</span>
    <span class="n">var</span> <span class="n">numberOfRows:</span> <span class="n">Int</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">people</span><span class="o">.</span><span class="n">count</span>
    <span class="p">}</span>

    <span class="n">var</span> <span class="n">numberOfColumns:</span> <span class="n">Int</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">2</span>
    <span class="p">}</span>

    <span class="n">func</span> <span class="n">labelForRow</span><span class="p">(</span><span class="n">row:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">String</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">people</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
    <span class="p">}</span>

    <span class="n">func</span> <span class="n">labelForColumn</span><span class="p">(</span><span class="n">column:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">String</span> <span class="p">{</span>
        <span class="n">switch</span> <span class="n">column</span> <span class="p">{</span>
            <span class="k">case</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="s">&#34;Age&#34;</span>
            <span class="k">case</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="s">&#34;Years of Experence&#34;</span>
            <span class="n">default:</span> <span class="n">fatalError</span><span class="p">(</span><span class="s">&#34;Invalid column!&#34;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">func</span> <span class="n">itemForRow</span><span class="p">(</span><span class="n">row:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">column:</span> <span class="n">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Int</span> <span class="p">{</span>
         <span class="n">let</span> <span class="n">person</span> <span class="o">=</span> <span class="n">people</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="sr">//</span> <span class="n">æŒ‡å®šçš„è¡Œ</span>
         <span class="n">switch</span> <span class="n">column</span> <span class="p">{</span>
             <span class="k">case</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="n">person</span><span class="o">.</span><span class="n">age</span>
             <span class="k">case</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="n">person</span><span class="o">.</span><span class="n">yearsOfExperience</span>
             <span class="n">default:fatalError</span><span class="p">(</span><span class="s">&#34;Invalid column!&#34;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">var</span> <span class="n">deparment</span> <span class="o">=</span> <span class="n">Department</span><span class="p">(</span><span class="n">name:</span> <span class="s">&#34;Engineering&#34;</span><span class="p">)</span>
<span class="n">deparment</span><span class="o">.</span><span class="n">addPerson</span><span class="p">(</span><span class="n">Person</span><span class="p">(</span><span class="n">name:</span> <span class="s">&#34;Joe&#34;</span><span class="p">,</span> <span class="n">age:</span> <span class="mi">30</span><span class="p">,</span> <span class="n">yearsOfExperience:</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">deparment</span><span class="o">.</span><span class="n">addPerson</span><span class="p">(</span><span class="n">Person</span><span class="p">(</span><span class="n">name:</span> <span class="s">&#34;Karen&#34;</span><span class="p">,</span> <span class="n">age:</span> <span class="mi">40</span><span class="p">,</span> <span class="n">yearsOfExperience:</span> <span class="mi">18</span><span class="p">))</span>
<span class="n">deparment</span><span class="o">.</span><span class="n">addPerson</span><span class="p">(</span><span class="n">Person</span><span class="p">(</span><span class="n">name:</span> <span class="s">&#34;Fred&#34;</span><span class="p">,</span> <span class="n">age:</span> <span class="mi">50</span><span class="p">,</span> <span class="n">yearsOfExperience:</span> <span class="mi">20</span><span class="p">))</span>

<span class="sr">//</span> <span class="n">ä¼ å…¥ä¸€ä¸ªæ•°æ®æº</span>
<span class="n">func</span> <span class="n">printTable</span><span class="p">(</span><span class="n">dataSource:</span> <span class="n">TabularDataSource</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">let</span> <span class="n">rowLabels</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">..&lt;</span> <span class="n">dataSource</span><span class="o">.</span><span class="n">numberOfRows</span><span class="p">)</span><span class="o">.</span><span class="nb">map</span> <span class="p">{</span> <span class="n">dataSource</span><span class="o">.</span><span class="n">labelForRow</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">let</span> <span class="n">columnLabels</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">..&lt;</span> <span class="n">dataSource</span><span class="o">.</span><span class="n">numberOfColumns</span><span class="p">)</span><span class="o">.</span><span class="nb">map</span> <span class="p">{</span> <span class="n">dataSource</span><span class="o">.</span><span class="n">labelForColumn</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">}</span>

    <span class="sr">//</span> <span class="n">åˆ›å»ºä¸€ä¸ªæ•°ç»„å­˜å‚¨æ¯ä¸ªè¡Œæ ‡ç­¾çš„å®½åº¦</span>
    <span class="n">let</span> <span class="n">rowLabelWidths</span> <span class="o">=</span> <span class="n">rowLabels</span><span class="o">.</span><span class="nb">map</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">characters</span><span class="o">.</span><span class="n">count</span> <span class="p">}</span>

    <span class="sr">//</span> <span class="n">é™å®šè¡Œæ ‡ç­¾çš„æœ€å¤§é•¿åº¦</span>
    <span class="n">guard</span> <span class="n">let</span> <span class="n">maxRowLabelWidth</span> <span class="o">=</span> <span class="n">rowLabelWidths</span><span class="o">.</span><span class="n">maxElement</span><span class="p">()</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span>
    <span class="p">}</span>

    <span class="sr">//</span> <span class="n">åˆ›å»ºç¬¬ä¸€è¡Œ</span><span class="p">,</span> <span class="n">åŒ…å«åˆ—æ ‡é¢˜</span>
    <span class="n">var</span> <span class="n">firstRow</span> <span class="o">=</span> <span class="n">padding</span><span class="p">(</span><span class="n">maxRowLabelWidth</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#34; |&#34;</span>

    <span class="sr">//</span> <span class="n">è·Ÿè¸ªæ¯åˆ—çš„å®½åº¦</span>
    <span class="n">var</span> <span class="n">columnWidths</span> <span class="o">=</span> <span class="p">[</span><span class="n">Int</span><span class="p">]()</span>

    <span class="k">for</span> <span class="n">columnLabel</span> <span class="n">in</span> <span class="n">columnLabels</span> <span class="p">{</span>
        <span class="n">let</span> <span class="n">columnHeader</span> <span class="o">=</span> <span class="s">&#34; \(columnLabel) |&#34;</span>
        <span class="n">firstRow</span> <span class="o">+=</span> <span class="n">columnHeader</span>
        <span class="n">columnWidths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">columnHeader</span><span class="o">.</span><span class="n">characters</span><span class="o">.</span><span class="n">count</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">print</span><span class="p">(</span><span class="n">firstRow</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="n">in</span> <span class="mi">0</span> <span class="o">..&lt;</span> <span class="n">dataSource</span><span class="o">.</span><span class="n">numberOfRows</span> <span class="p">{</span>
        <span class="n">let</span> <span class="n">paddingAmount</span> <span class="o">=</span> <span class="n">maxRowLabelWidth</span> <span class="o">-</span> <span class="n">rowLabelWidths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">var</span> <span class="n">out</span> <span class="o">=</span> <span class="n">rowLabels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">padding</span><span class="p">(</span><span class="n">paddingAmount</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#34; |&#34;</span>

        <span class="k">for</span> <span class="n">j</span> <span class="n">in</span> <span class="mi">0</span> <span class="o">..&lt;</span> <span class="n">dataSource</span><span class="o">.</span><span class="n">numberOfColumns</span> <span class="p">{</span>
            <span class="n">let</span> <span class="n">item</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">.</span><span class="n">itemForRow</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">column:</span> <span class="n">j</span><span class="p">)</span>
            <span class="n">let</span> <span class="n">itemString</span> <span class="o">=</span> <span class="s">&#34; \(item) |&#34;</span>
            <span class="n">let</span> <span class="n">paddingAmount</span> <span class="o">=</span> <span class="n">columnWidths</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">itemString</span><span class="o">.</span><span class="n">characters</span><span class="o">.</span><span class="n">count</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">padding</span><span class="p">(</span><span class="n">paddingAmount</span><span class="p">)</span> <span class="o">+</span> <span class="n">itemString</span>
        <span class="p">}</span>
        <span class="k">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">printTable</span><span class="p">(</span><span class="n">deparment</span><span class="p">)</span>
</code></pre></div><p>å…¶ä¸­çš„è®¡ç®—å±æ€§åœ¨ Raku ä¸­å¯ä»¥ä½¿ç”¨é‡å†™å±æ€§çš„æ–¹æ³•æ¥å®Œæˆã€‚</p>
<h3 id="role-in-raku">Role in Raku</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">padding</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$amount</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$paddingString</span> <span class="o">=</span> <span class="p">&#34;&#34;;</span>
    <span class="nv">$paddingString</span> <span class="o">~=</span> <span class="p">&#34;</span><span class="s2"> </span><span class="p">&#34;</span> <span class="k">for</span>  <span class="mi">0</span> <span class="o">..^</span> <span class="nv">$amount</span><span class="p">;</span>
    <span class="k">return</span> <span class="nv">$paddingString</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># å£°æ˜ä¸€ä¸ªæ¥å£, åªå®šä¹‰äº†æ–¹æ³•å’Œå±æ€§, æ²¡æœ‰åšå®ç°</span>
<span class="k">role</span> <span class="nc">TabularDataSource</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.numberOfRows</span> <span class="k">is</span> <span class="k">rw</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.numberOfColumns</span> <span class="k">is</span> <span class="k">rw</span><span class="p">;</span>

    <span class="k">method</span> <span class="nf">labelForRow</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$row</span><span class="p">)</span>             <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
    <span class="k">method</span> <span class="nf">labelForColumn</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$column</span><span class="p">)</span>       <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
    <span class="k">method</span> <span class="nf">itemForRow</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$row</span><span class="o">,</span> <span class="nb">Int</span> <span class="nv">$column</span><span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Person</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nb">Str</span> <span class="nv">$.name</span><span class="p">;</span>
    <span class="k">has</span> <span class="nb">Int</span> <span class="nv">$.age</span><span class="p">;</span>
    <span class="k">has</span> <span class="nb">Int</span> <span class="nv">$.yearsOfExperience</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Department</span> <span class="k">does</span> <span class="nc">TabularDataSource</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.name</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">@.people</span><span class="p">;</span>

    <span class="k">method</span> <span class="nb">new</span><span class="p">(</span><span class="nb">Str</span> <span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">self</span><span class="o">.</span><span class="nb">bless</span><span class="p">(</span><span class="s">name</span> <span class="o">=&gt;</span> <span class="nv">$name</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1"># å®ç°æ¥å£ä¸­çš„æ–¹æ³•</span>

    <span class="c1"># é‡å†™æ–¹æ³• has $.numberOfRows å…¶å®æ˜¯ has $!numberOfRows åŠ ä¸Š method numberOfRows() { ... } æ–¹æ³•ã€‚</span>
    <span class="k">method</span> <span class="nf">numberOfRows</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">@!people</span><span class="o">.</span><span class="nb">elems</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">numberOfColumns</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">addPerson</span><span class="p">(</span><span class="n">Person</span> <span class="nv">$person</span><span class="p">)</span> <span class="k">is</span> <span class="k">rw</span> <span class="p">{</span>
        <span class="nv">@!people</span><span class="o">.</span><span class="nb">append</span><span class="p">(</span><span class="nv">$person</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1"># å¦‚æœç±»éµå®ˆäº†æŸä¸ª role ä½†æ˜¯æœªå®ç°å…¶ä¸­çš„æ–¹æ³•, åˆ™ä¼šæŠ¥é”™å¦‚ä¸‹:</span>
    <span class="c1"># Method &#39;labelForRow&#39; must be implemented by Department because it is required by a role</span>
    <span class="k">method</span> <span class="nf">labelForRow</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">@!people</span><span class="o">[</span><span class="nv">$row</span><span class="o">].</span><span class="nb">name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">labelForColumn</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$column</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">given</span> <span class="nv">$column</span> <span class="p">{</span>
            <span class="k">when</span> <span class="mi">0</span>  <span class="p">{</span> <span class="k">return</span> <span class="p">&#34;</span><span class="s2">Age</span><span class="p">&#34;</span> <span class="p">}</span>
            <span class="k">when</span> <span class="mi">1</span>  <span class="p">{</span> <span class="k">return</span> <span class="p">&#34;</span><span class="s2">Years of Experence</span><span class="p">&#34;</span> <span class="p">}</span>
            <span class="k">default</span> <span class="p">{</span> <span class="nb">die</span><span class="p">(&#34;</span><span class="s2">Invalid column!</span><span class="p">&#34;)}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">itemForRow</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$row</span><span class="o">,</span> <span class="nb">Int</span> <span class="nv">$column</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">$person</span> <span class="o">=</span> <span class="nv">@!people</span><span class="o">[</span><span class="nv">$row</span><span class="o">]</span><span class="p">;</span>

        <span class="k">given</span> <span class="nv">$column</span> <span class="p">{</span>
            <span class="k">when</span> <span class="mi">0</span>  <span class="p">{</span> <span class="k">return</span> <span class="nv">$person</span><span class="o">.</span><span class="nf">age</span>               <span class="p">}</span>
            <span class="k">when</span> <span class="mi">1</span>  <span class="p">{</span> <span class="k">return</span> <span class="nv">$person</span><span class="o">.</span><span class="nf">yearsOfExperience</span> <span class="p">}</span>
            <span class="k">default</span> <span class="p">{</span> <span class="nb">die</span><span class="p">(&#34;</span><span class="s2">Invalid column</span><span class="p">&#34;)</span>            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$department</span> <span class="o">=</span> <span class="n">Department</span><span class="o">.</span><span class="nb">new</span><span class="p">(&#34;</span><span class="s2">Engineering</span><span class="p">&#34;);</span>
<span class="nv">$department</span><span class="o">.</span><span class="nf">addPerson</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">name</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">Joe</span><span class="p">&#34;</span>,   <span class="s">age</span> <span class="o">=&gt;</span> <span class="mi">30</span>, <span class="s">yearsOfExperience</span> <span class="o">=&gt;</span> <span class="mi">6</span><span class="p">));</span>
<span class="nv">$department</span><span class="o">.</span><span class="nf">addPerson</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">name</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">Karen</span><span class="p">&#34;</span>, <span class="s">age</span> <span class="o">=&gt;</span> <span class="mi">40</span>, <span class="s">yearsOfExperience</span> <span class="o">=&gt;</span> <span class="mi">18</span><span class="p">));</span>
<span class="nv">$department</span><span class="o">.</span><span class="nf">addPerson</span><span class="p">(</span><span class="n">Person</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">name</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">Fred</span><span class="p">&#34;</span>,  <span class="s">age</span> <span class="o">=&gt;</span> <span class="mi">50</span>, <span class="s">yearsOfExperience</span> <span class="o">=&gt;</span> <span class="mi">20</span><span class="p">));</span>

<span class="k">sub</span> <span class="nf">printTable</span><span class="p">(</span><span class="n">TabularDataSource</span> <span class="nv">$dataSource</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">@rowLabels</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">..^</span> <span class="nv">$dataSource</span><span class="o">.</span><span class="nf">numberOfRows</span> <span class="p">)</span><span class="o">.</span><span class="nb">map</span><span class="o">:</span> <span class="p">{</span> <span class="nv">$dataSource</span><span class="o">.</span><span class="nf">labelForRow</span><span class="p">(</span><span class="nv">$_</span><span class="p">)};</span>
    <span class="k">my</span> <span class="nv">@columnLabels</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">..^</span> <span class="nv">$dataSource</span><span class="o">.</span><span class="nf">numberOfColumns</span><span class="p">)</span><span class="o">.</span><span class="nb">map</span><span class="o">:</span> <span class="p">{</span><span class="nv">$dataSource</span><span class="o">.</span><span class="nf">labelForColumn</span><span class="p">(</span><span class="nv">$_</span><span class="p">)};</span>
 
    <span class="k">my</span> <span class="nv">@rowLabelWidths</span> <span class="o">=</span> <span class="nv">@rowLabels</span><span class="o">.</span><span class="nb">map</span><span class="o">:</span> <span class="p">{</span><span class="nv">$_</span><span class="o">.</span><span class="nb">chars</span><span class="p">};</span>
    <span class="k">my</span> <span class="nv">$maxRowLabelWidth</span> <span class="o">=</span> <span class="nv">@rowLabelWidths</span><span class="o">.</span><span class="nb">max</span> <span class="o">//</span> <span class="k">return</span><span class="p">;</span>
 
    <span class="k">my</span> <span class="nv">$firstRow</span> <span class="o">=</span> <span class="nf">padding</span><span class="p">(</span><span class="nv">$maxRowLabelWidth</span><span class="p">)</span> <span class="o">~</span> <span class="p">&#34;</span><span class="s2"> |</span><span class="p">&#34;;</span>
    <span class="k">my</span> <span class="nv">@columnWidths</span><span class="p">;</span>
 
    <span class="k">for</span> <span class="nv">@columnLabels</span> <span class="k">-&gt;</span> <span class="nv">$columnLabel</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">$columnHeader</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2"> </span><span class="nv">$columnLabel</span><span class="s2"> |</span><span class="p">&#34;;</span>
        <span class="nv">$firstRow</span> <span class="o">~=</span> <span class="nv">$columnHeader</span><span class="p">;</span>
        <span class="nv">@columnWidths</span><span class="o">.</span><span class="nb">append</span><span class="p">(</span><span class="nv">$columnHeader</span><span class="o">.</span><span class="nb">chars</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="nb">say</span><span class="p">(</span><span class="nv">$firstRow</span><span class="p">);</span>
 
    <span class="k">for</span> <span class="mi">0</span> <span class="o">..^</span> <span class="nv">$dataSource</span><span class="o">.</span><span class="nf">numberOfRows</span> <span class="k">-&gt;</span> <span class="nv">$i</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">$paddingAmount</span> <span class="o">=</span> <span class="nv">$maxRowLabelWidth</span> <span class="o">-</span> <span class="nv">@rowLabelWidths</span><span class="o">[</span><span class="nv">$i</span><span class="o">]</span><span class="p">;</span>
        <span class="k">my</span> <span class="nv">$out</span> <span class="o">=</span> <span class="nv">@rowLabels</span><span class="o">[</span><span class="nv">$i</span><span class="o">]</span> <span class="o">~</span> <span class="nf">padding</span><span class="p">(</span><span class="nv">$paddingAmount</span><span class="p">)</span> <span class="o">~</span> <span class="p">&#34;</span><span class="s2"> |</span><span class="p">&#34;;</span>
 
        <span class="k">for</span> <span class="mi">0</span> <span class="o">..^</span> <span class="nv">$dataSource</span><span class="o">.</span><span class="nf">numberOfColumns</span> <span class="k">-&gt;</span> <span class="nv">$j</span> <span class="p">{</span>
            <span class="k">my</span> <span class="nv">$item</span> <span class="o">=</span> <span class="nv">$dataSource</span><span class="o">.</span><span class="nf">itemForRow</span><span class="p">(</span><span class="nv">$i</span><span class="o">,</span> <span class="nv">$j</span><span class="p">);</span>
            <span class="k">my</span> <span class="nv">$itemString</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2"> </span><span class="nv">$item</span><span class="s2"> |</span><span class="p">&#34;;</span>
            <span class="k">my</span> <span class="nv">$paddingAmount</span> <span class="o">=</span> <span class="nv">@columnWidths</span><span class="o">[</span><span class="nv">$j</span><span class="o">]</span> <span class="o">-</span> <span class="nv">$itemString</span><span class="o">.</span><span class="nb">chars</span><span class="p">;</span>
            <span class="nv">$out</span> <span class="o">~=</span> <span class="nf">padding</span><span class="p">(</span><span class="nv">$paddingAmount</span><span class="p">)</span> <span class="o">~</span> <span class="nv">$itemString</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nb">say</span><span class="p">(</span><span class="nv">$out</span><span class="p">);</span>
   <span class="p">}</span>

<span class="p">}</span>

<span class="nf">printTable</span><span class="p">(</span><span class="nv">$department</span><span class="p">);</span>
</code></pre></div><p>role ä¸­çš„ <code>{ ... }</code> æ˜¯ yadayada æ“ä½œç¬¦, èµ·å ä½ä½œç”¨, è¡¨ç¤ºæ–¹æ³•ä¼šåœ¨åˆ«å¤„å®ç°ã€‚ç±»ä¸­çš„æ–¹æ³•åŒæ ·ä¹Ÿå¯ä»¥è¿™æ ·å£°æ˜ã€‚</p>
<p>æœ€åè¾“å‡º:</p>
<pre><code>      | Age | Years of Experence |
Joe   |  30 |                  6 |
Karen |  40 |                 18 |
Fred  |  50 |                 20 |
</code></pre>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/roles" term="roles" label="roles" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[ä¸‹æ ‡å‰¯è¯]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-05-18-subscripts-adverbs/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2015-08-18-add-subscripts-for-custom-class-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="åœ¨ Raku ä¸­ä¸ºè‡ªå®šä¹‰çš„ç±»æ·»åŠ ä¸‹æ ‡" />
            
                <id>https://ohmyweekly.github.io/notes/2015-05-18-subscripts-adverbs/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Subscripts Adverbs</blockquote><h1 id="ä¸‹æ ‡å‰¯è¯httpsdesginrakuorgs02htmlsubscript_adverbs"><a href="https://desgin.raku.org/S02.html#Subscript_adverbs">ä¸‹æ ‡å‰¯è¯</a></h1>
<p>ä¸ºäº†ä½¿åˆ‡ç‰‡ä¸‹æ ‡è¿”å›é™¤äº†å€¼ä»¥å¤–çš„å…¶å®ƒä¸œè¥¿ï¼Œé‚£ä¹ˆç»™ä¸‹æ ‡(subscript)æ·»åŠ åˆé€‚çš„å‰¯è¯ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@array</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">A B</span><span class="p">&gt;;</span>
<span class="nv">@array</span><span class="o">[</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span>      <span class="c1"># returns &#39;A&#39;, &#39;B&#39;, (Any)</span>
<span class="nv">@array</span><span class="o">[</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">]</span> <span class="p">:</span><span class="s">p</span><span class="p">;</span>   <span class="c1"># returns 0 =&gt; &#39;A&#39;, 1 =&gt; &#39;B&#39;</span>
<span class="nv">@array</span><span class="o">[</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">]</span> <span class="p">:</span><span class="s">kv</span><span class="p">;</span>  <span class="c1"># returns 0, &#39;A&#39;, 1, &#39;B&#39;</span>
<span class="nv">@array</span><span class="o">[</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">]</span> <span class="p">:</span><span class="s">k</span><span class="p">;</span>   <span class="c1"># returns 0, 1</span>
<span class="nv">@array</span><span class="o">[</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">]</span> <span class="p">:</span><span class="s">v</span><span class="p">;</span>   <span class="c1"># returns &#39;A&#39;, &#39;B&#39;</span>

<span class="nv">%hash</span> <span class="o">=</span> <span class="p">(:</span><span class="s">a</span><span class="p">&lt;</span><span class="s">A</span><span class="p">&gt;</span><span class="o">,</span> <span class="p">:</span><span class="s">b</span><span class="p">&lt;</span><span class="s">B</span><span class="p">&gt;);</span>
<span class="nv">%hash</span><span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;;</span>       <span class="c1"># returns &#39;A&#39;, &#39;B&#39;, (Any)</span>
<span class="nv">%hash</span><span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;</span> <span class="p">:</span><span class="s">p</span><span class="p">;</span>    <span class="c1"># returns a =&gt; &#39;A&#39;, b =&gt; &#39;B&#39;</span>
<span class="nv">%hash</span><span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;</span> <span class="p">:</span><span class="s">kv</span><span class="p">;</span>   <span class="c1"># returns &#39;a&#39;, &#39;A&#39;, &#39;b&#39;, &#39;B&#39;</span>
<span class="nv">%hash</span><span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;</span> <span class="p">:</span><span class="s">k</span><span class="p">;</span>    <span class="c1"># returns &#39;a&#39;, &#39;b&#39;</span>
<span class="nv">%hash</span><span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;</span> <span class="p">:</span><span class="s">v</span><span class="p">;</span>    <span class="c1"># returns &#39;A&#39;, &#39;B&#39;</span>
</code></pre></div><p>å¦‚æœå‰¯è¯ä¸ºçœŸï¼Œé‚£ä¹ˆè¿™äº›å‰¯è¯å½¢å¼éƒ½ä¼šæ¸…é™¤ä¸å­˜åœ¨çš„æ¡ç›®ï¼›å¦‚æœä¸ºå‡çš„è¯ï¼Œå°±ä¼šç•™ä¸‹ä¸å­˜åœ¨çš„é¡¹ï¼Œå°±åƒæ™®é€šçš„åˆ‡ç‰‡é‚£æ ·ã€‚æ‰€ä»¥ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@array</span><span class="o">[</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">]</span> <span class="p">:!</span><span class="s">p</span><span class="p">;</span>  <span class="c1"># returns 0 =&gt; &#39;A&#39;, 1 =&gt; &#39;B&#39;, 2 =&gt; (Any)</span>
<span class="nv">%hash</span><span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;</span>  <span class="p">:!</span><span class="s">kv</span><span class="p">;</span> <span class="c1"># returns &#39;a&#39;, &#39;A&#39;, &#39;b&#39;, &#39;B&#39;, &#39;c&#39;, (Any)</span>
</code></pre></div><p>åŒæ ·åœ°ï¼Œ</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="p">(</span><span class="nv">$a</span><span class="o">,</span><span class="nv">$b</span><span class="o">,</span><span class="nv">$c</span><span class="p">)</span> <span class="o">=</span> <span class="nv">%hash</span><span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;</span> <span class="p">:</span><span class="s">delete</span><span class="p">;</span>
</code></pre></div><p>åˆ é™¤é‚£äº›æ¡ç›®å¹¶é¡ºé“è¿”å›å®ƒä»¬ã€‚è¿™ç§å½¢å¼èƒ½å¤Ÿå·¥ä½œæ˜¯å› ä¸ºä¸‹æ ‡æ˜¯é¡¶ç«¯çš„åœ¨å‰çš„æ“ä½œç¬¦ã€‚å¦‚æœæŸäº›å…¶å®ƒçš„æ“ä½œç¬¦çš„ä¼˜å…ˆçº§æ¯”å¤„äºé¡¶ç«¯çš„é€—å·æ“ä½œç¬¦çš„ä¼˜å…ˆçº§ç´§å‡‘ï¼Œé‚£ä¹ˆä½ å¿…é¡»ç”¨æ‹¬å·æ‹¬èµ·å®ƒæˆ–å¼ºåˆ¶ä¸ºåˆ—è¡¨ä¸Šä¸‹æ–‡ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="nv">%hash</span><span class="p">{</span><span class="nv">$x</span><span class="p">}</span> <span class="p">:</span><span class="s">delete</span><span class="p">);</span>
<span class="nv">$x</span> <span class="o">=</span> <span class="p">(</span><span class="nv">%hash</span><span class="p">{</span><span class="nv">$x</span><span class="p">}</span> <span class="p">:</span><span class="s">delete</span><span class="p">);</span>
<span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="o">=</span> <span class="nv">%hash</span><span class="p">{</span><span class="nv">$x</span><span class="p">}</span> <span class="p">:</span><span class="s">delete</span><span class="p">;</span>
</code></pre></div><p>åªæœ‰åœ¨å‰¯è¯ä¸ºçœŸçš„æ—¶å€™å…ƒç´ æ‰ä¼šè¢«åˆ é™¤ã€‚è€Œ <code>:!delete</code> æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç©ºæ“ä½œï¼›ä½ å¯ä»¥åŸºäºä¼ é€’çš„è¯¸å¦‚ <code>:delete($kill'em)</code> æ ‡è®°é¡ºå¸¦æœ‰æ¡ä»¶åœ°åˆ é™¤æ¡ç›®ã€‚åœ¨ä»»ä½•ä¸€ç§æƒ…å†µä¸‹ï¼Œè¢«åˆ é™¤çš„å€¼ä¼šè¢«è¿”å›ã€‚</p>
<p>ä½ ä¹Ÿå¯ä»¥æ‰§è¡Œå­˜åœ¨æ€§æµ‹è¯•ï¼Œè¦ä¹ˆæµ‹è¯•å•ä¸ªæ¡ç›®æ˜¯å¦å­˜åœ¨ï¼Œè¦ä¹ˆæµ‹è¯•æ¡ç›®çš„è¿æ¥æ˜¯å¦å­˜åœ¨ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="nv">%hash</span><span class="p">&lt;</span><span class="s">foo</span><span class="p">&gt;</span> <span class="p">:</span><span class="s">exists</span>           <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="k">if</span> <span class="nv">%hash</span><span class="p">{</span><span class="nb">any</span> <span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;}</span>  <span class="p">:</span><span class="s">exists</span>  <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="k">if</span> <span class="nv">%hash</span><span class="p">{</span><span class="nb">all</span> <span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;}</span>  <span class="p">:</span><span class="s">exists</span>  <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="k">if</span> <span class="nv">%hash</span><span class="p">{</span><span class="nb">one</span> <span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;}</span>  <span class="p">:</span><span class="s">exists</span>  <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="k">if</span> <span class="nv">%hash</span><span class="p">{</span><span class="nb">none</span> <span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;}</span> <span class="p">:</span><span class="s">exists</span>  <span class="p">{</span><span class="o">...</span><span class="p">}</span>
</code></pre></div><p>æŠŠ <code>:exists</code> å‰¯è¯å’Œä¸€ç»„åˆ‡ç‰‡ç»“æœçš„å¸ƒå°”å€¼åˆ—è¡¨ç»“åˆèµ·æ¥ä½¿ç”¨ï¼Œä½ ä¹Ÿå¯ä»¥ç”¨ç±»å‹çš„è¯­ä¹‰è¿™æ ·ä½¿ç”¨ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="nb">any</span> <span class="nv">%hash</span><span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;</span>  <span class="p">:</span><span class="s">exists</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="k">if</span> <span class="nb">all</span> <span class="nv">%hash</span><span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;</span>  <span class="p">:</span><span class="s">exists</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="k">if</span> <span class="nb">one</span> <span class="nv">%hash</span><span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;</span>  <span class="p">:</span><span class="s">exists</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="k">if</span> <span class="nb">none</span> <span class="nv">%hash</span><span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;</span> <span class="p">:</span><span class="s">exists</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
</code></pre></div><p>ä½ å¯ä»¥ä½¿ç”¨ <code>:!exists</code> æ¥æµ‹è¯•ä¸å­˜åœ¨ã€‚è¿™ç‰¹åˆ«ä¾¿æ·å› ä¸ºä¼˜å…ˆçº§è§„åˆ™è®© <code>!%hash&lt;a&gt; :exists</code> æŠŠ <code>:exists</code> åº”ç”¨åˆ°å‰ç¼€ <code>!</code> ä¸Šã€‚ <code>%hash&lt;a&gt; :!exists</code> æ²¡æœ‰é‚£ä¸ªé—®é¢˜ã€‚</p>
<h2 id="ç»„åˆä¸‹æ ‡å‰¯è¯">ç»„åˆä¸‹æ ‡å‰¯è¯</h2>
<p>åƒè°ƒç”¨ä¸­å¾—å…·åå‚æ•°é‚£æ ·ï¼Œä¸‹æ ‡ä¸­å¤„ç†å¤šä¸ªå‰¯è¯æ˜¯æ²¡æœ‰é¡ºåºä¹‹åˆ†çš„ã€‚æœ‰äº›ç»„åˆæœ‰æ„ä¹‰ï¼Œä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">%a</span> <span class="o">=</span> <span class="nv">%b</span><span class="p">{</span><span class="nv">@keys-to-extract</span><span class="p">}</span> <span class="p">:</span><span class="s">delete</span> <span class="p">:</span><span class="s">p</span><span class="p">;</span> <span class="c1"># same as :p :delete</span>
</code></pre></div><p>ä¼šæŠŠç»™å®šçš„é”®åˆ†ç‰‡åˆ°å¦å¤–ä¸€ä¸ªæ•£åˆ—ä¸­ã€‚è€Œ</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@actually-deleted</span> <span class="o">=</span> <span class="nv">%h</span><span class="p">{</span><span class="nv">@keys-to-extract</span><span class="p">}</span> <span class="p">:</span><span class="s">delete</span> <span class="p">:</span><span class="s">k</span><span class="p">;</span> <span class="c1"># same as :k :delete</span>
</code></pre></div><p>ä¼šè¿”å›çœŸæ­£ä»æ•£åˆ—ä¸­åˆ é™¤çš„é”®ã€‚</p>
<p>åªæŒ‡å®šè¿”å›ç±»å‹çš„å‰¯è¯ï¼Œä¸èƒ½è¢«ç»„åˆï¼Œå› ä¸ºè¯¸å¦‚ <code>:kv :p</code>ã€æˆ– <code>:v :k</code> å°±æ²¡æœ‰æ„ä¹‰ã€‚</p>
<p>ä¸‹é¢çš„è¿™äº›å‰¯è¯ç»„åˆè¢«çœ‹åšæ˜¯åˆæ³•çš„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">:</span><span class="s">delete</span> <span class="p">:</span><span class="s">kv</span>            <span class="nb">delete</span><span class="o">,</span> <span class="k">return</span> <span class="nb">key</span><span class="o">/</span><span class="nb">values</span> <span class="k">of</span> <span class="nc">actually</span> <span class="n">deleted</span> <span class="nb">keys</span>
<span class="p">:</span><span class="s">delete</span> <span class="p">:!</span><span class="s">kv</span>           <span class="nb">delete</span><span class="o">,</span> <span class="k">return</span> <span class="nb">key</span><span class="o">/</span><span class="nb">values</span> <span class="k">of</span> <span class="nb">all</span> <span class="nb">keys</span> <span class="n">attempted</span>
<span class="p">:</span><span class="s">delete</span> <span class="p">:</span><span class="s">p</span>             <span class="nb">delete</span><span class="o">,</span> <span class="k">return</span> <span class="nb">pairs</span> <span class="k">of</span> <span class="nc">actually</span> <span class="n">deleted</span> <span class="nb">keys</span>
<span class="p">:</span><span class="s">delete</span> <span class="p">:!</span><span class="s">p</span>            <span class="nb">delete</span><span class="o">,</span> <span class="k">return</span> <span class="nb">pairs</span> <span class="k">of</span> <span class="nb">all</span> <span class="nb">keys</span> <span class="n">attempted</span>
<span class="p">:</span><span class="s">delete</span> <span class="p">:</span><span class="s">k</span>             <span class="nb">delete</span><span class="o">,</span> <span class="k">return</span> <span class="n">actually</span> <span class="n">deleted</span> <span class="nb">keys</span>
<span class="p">:</span><span class="s">delete</span> <span class="p">:!</span><span class="s">k</span>            <span class="nb">delete</span><span class="o">,</span> <span class="k">return</span> <span class="nb">all</span> <span class="nb">keys</span> <span class="n">attempted</span> <span class="nb">to</span> <span class="nb">delete</span>
<span class="p">:</span><span class="s">delete</span> <span class="p">:</span><span class="s">v</span>             <span class="nb">delete</span><span class="o">,</span> <span class="k">return</span> <span class="nb">values</span> <span class="k">of</span> <span class="nc">actually</span> <span class="n">deleted</span> <span class="nb">keys</span>
<span class="p">:</span><span class="s">delete</span> <span class="p">:!</span><span class="s">v</span>            <span class="nb">delete</span><span class="o">,</span> <span class="k">return</span> <span class="nb">values</span> <span class="k">of</span> <span class="nb">all</span> <span class="nb">keys</span> <span class="n">attempted</span>
<span class="p">:</span><span class="s">delete</span> <span class="p">:</span><span class="s">exists</span>        <span class="nb">delete</span><span class="o">,</span> <span class="k">return</span> <span class="n">Bools</span> <span class="n">indicating</span> <span class="nb">keys</span> <span class="n">existed</span>
<span class="p">:</span><span class="s">delete</span> <span class="p">:!</span><span class="s">exists</span>       <span class="nb">delete</span><span class="o">,</span> <span class="k">return</span> <span class="n">Bools</span> <span class="n">indicating</span> <span class="nb">keys</span> <span class="n">did</span> <span class="nb">not</span> <span class="n">exist</span>
<span class="p">:</span><span class="s">delete</span> <span class="p">:</span><span class="s">exists</span> <span class="p">:</span><span class="s">kv</span>    <span class="nb">delete</span><span class="o">,</span> <span class="k">return</span> <span class="nb">list</span> <span class="k">with</span> <span class="nb">key</span><span class="o">,</span><span class="nb">True</span> <span class="k">for</span> <span class="nb">key</span> <span class="n">existed</span>
<span class="p">:</span><span class="s">delete</span> <span class="p">:!</span><span class="s">exists</span> <span class="p">:</span><span class="s">kv</span>   <span class="nb">delete</span><span class="o">,</span> <span class="k">return</span> <span class="nb">list</span> <span class="k">with</span> <span class="nb">key</span><span class="o">,</span><span class="nb">False</span> <span class="k">for</span> <span class="nb">key</span> <span class="n">existed</span>
<span class="p">:</span><span class="s">delete</span> <span class="p">:</span><span class="s">exists</span> <span class="p">:!</span><span class="s">kv</span>   <span class="nb">delete</span><span class="o">,</span> <span class="k">return</span> <span class="nb">list</span> <span class="k">with</span> <span class="nb">key</span><span class="o">,</span><span class="nb">Bool</span> <span class="n">whether</span> <span class="nb">key</span> <span class="n">existed</span>
<span class="p">:</span><span class="s">delete</span> <span class="p">:!</span><span class="s">exists</span> <span class="p">:!</span><span class="s">kv</span>  <span class="nb">delete</span><span class="o">,</span> <span class="k">return</span> <span class="nb">list</span> <span class="k">with</span> <span class="nb">key</span><span class="o">,!</span><span class="nb">Bool</span> <span class="n">whether</span> <span class="nb">key</span> <span class="n">existed</span>
<span class="p">:</span><span class="s">delete</span> <span class="p">:</span><span class="s">exists</span> <span class="p">:</span><span class="s">p</span>     <span class="nb">delete</span><span class="o">,</span> <span class="k">return</span> <span class="nb">pairs</span> <span class="k">with</span> <span class="nb">key</span><span class="o">/</span><span class="nb">True</span> <span class="k">for</span> <span class="nb">key</span> <span class="n">existed</span>
<span class="p">:</span><span class="s">delete</span> <span class="p">:!</span><span class="s">exists</span> <span class="p">:</span><span class="s">p</span>    <span class="nb">delete</span><span class="o">,</span> <span class="k">return</span> <span class="nb">pairs</span> <span class="k">with</span> <span class="nb">key</span><span class="o">/</span><span class="nb">False</span> <span class="k">for</span> <span class="nb">key</span> <span class="n">existed</span>
<span class="p">:</span><span class="s">delete</span> <span class="p">:</span><span class="s">exists</span> <span class="p">:!</span><span class="s">p</span>    <span class="nb">delete</span><span class="o">,</span> <span class="k">return</span> <span class="nb">pairs</span> <span class="k">with</span> <span class="nb">key</span><span class="o">/</span><span class="nb">Bool</span> <span class="n">whether</span> <span class="nb">key</span> <span class="n">existed</span>
<span class="p">:</span><span class="s">delete</span> <span class="p">:!</span><span class="s">exists</span> <span class="p">:!</span><span class="s">p</span>   <span class="nb">delete</span><span class="o">,</span> <span class="k">return</span> <span class="nb">pairs</span> <span class="k">with</span> <span class="nb">key</span><span class="o">/!</span><span class="nb">Bool</span> <span class="n">whether</span> <span class="nb">key</span> <span class="n">existed</span>
<span class="p">:</span><span class="s">exists</span> <span class="p">:</span><span class="s">kv</span>            <span class="k">return</span> <span class="nb">pairs</span> <span class="k">with</span> <span class="nb">key</span><span class="o">,</span><span class="nb">True</span> <span class="k">for</span> <span class="nb">key</span> <span class="n">exists</span>
<span class="p">:!</span><span class="s">exists</span> <span class="p">:</span><span class="s">kv</span>           <span class="k">return</span> <span class="nb">pairs</span> <span class="k">with</span> <span class="nb">key</span><span class="o">,</span><span class="nb">False</span> <span class="k">for</span> <span class="nb">key</span> <span class="n">exists</span>
<span class="p">:</span><span class="s">exists</span> <span class="p">:!</span><span class="s">kv</span>           <span class="k">return</span> <span class="nb">pairs</span> <span class="k">with</span> <span class="nb">key</span><span class="o">,</span><span class="nb">Bool</span> <span class="k">for</span> <span class="nb">key</span> <span class="n">exists</span>
<span class="p">:!</span><span class="s">exists</span> <span class="p">:!</span><span class="s">kv</span>          <span class="k">return</span> <span class="nb">pairs</span> <span class="k">with</span> <span class="nb">key</span><span class="o">,!</span><span class="nb">Bool</span> <span class="k">for</span> <span class="nb">key</span> <span class="n">exists</span>
<span class="p">:</span><span class="s">exists</span> <span class="p">:</span><span class="s">p</span>             <span class="k">return</span> <span class="nb">pairs</span> <span class="k">with</span> <span class="nb">key</span><span class="o">/</span><span class="nb">True</span> <span class="k">for</span> <span class="nb">key</span> <span class="n">exists</span>
<span class="p">:!</span><span class="s">exists</span> <span class="p">:</span><span class="s">p</span>            <span class="k">return</span> <span class="nb">pairs</span> <span class="k">with</span> <span class="nb">key</span><span class="o">/</span><span class="nb">False</span> <span class="k">for</span> <span class="nb">key</span> <span class="n">exists</span>
<span class="p">:</span><span class="s">exists</span> <span class="p">:!</span><span class="s">p</span>            <span class="k">return</span> <span class="nb">pairs</span> <span class="k">with</span> <span class="nb">key</span><span class="o">/</span><span class="nb">Bool</span> <span class="k">for</span> <span class="nb">key</span> <span class="n">exists</span>
<span class="p">:!</span><span class="s">exists</span> <span class="p">:!</span><span class="s">p</span>           <span class="k">return</span> <span class="nb">pairs</span> <span class="k">with</span> <span class="nb">key</span><span class="o">/!</span><span class="nb">Bool</span> <span class="k">for</span> <span class="nb">key</span> <span class="n">exists</span>
</code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/subscript" term="subscript" label="subscript" />
                             
                                <category scheme="https://ohmyweekly.github.io/tags/adverb" term="adverb" label="adverb" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[ä»æ­£åˆ™è¡¨è¾¾å¼åˆ° Grammar(ç¬¬ä¸€éƒ¨åˆ†)]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-04-27-from-regex-to-grammar-part-one/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2015-10-29-from-regex-to-grammar/?utm_source=atom_feed" rel="related" type="text/html" title="ä»æ­£åˆ™è¡¨è¾¾å¼åˆ° Grammar(ç¬¬äºŒéƒ¨åˆ†)" />
                <link href="https://ohmyweekly.github.io/notes/2015-11-16-a-mutable-grammar-for-raku/?utm_source=atom_feed" rel="related" type="text/html" title="A Mutable Grammar for Raku" />
                <link href="https://ohmyweekly.github.io/notes/2016-02-05-raku-grammars/?utm_source=atom_feed" rel="related" type="text/html" title="Raku Grammars" />
                <link href="https://ohmyweekly.github.io/notes/2016-01-01-raku-core-hacking-grammatical-babble/?utm_source=atom_feed" rel="related" type="text/html" title="Raku æ ¸å¿ƒé­”æ”¹: Grammar çš„èƒ¡è¨€ä¹±è¯­" />
                <link href="https://ohmyweekly.github.io/notes/2015-06-14-play-audio-at-given-volume/?utm_source=atom_feed" rel="related" type="text/html" title="ä»¥æŒ‡å®šéŸ³é‡éšæœºæ’­æ”¾éŸ³é¢‘æ–‡ä»¶" />
            
                <id>https://ohmyweekly.github.io/notes/2015-04-27-from-regex-to-grammar-part-one/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>From Regex to Grammar Part One</blockquote><h2 id="into-the-breach">Into the Breach</h2>
<p>å‡è®¾æˆ‘ä»¬ çš„æ—¥å¿—æ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªæ—¶é—´æˆ³ <strong>2016-02-06T14:36+02:00</strong>, æˆ‘ä»¬ä½¿ç”¨æ™ºèƒ½åŒ¹é…:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nv">$logfile</span> <span class="o">~~</span> <span class="p">/</span><span class="mi">2016</span><span class="sr">-</span><span class="mo">02</span><span class="sr">-</span><span class="mo">06</span><span class="sr">T</span><span class="mi">14</span><span class="p">:</span><span class="na">36</span><span class="o">+</span><span class="mo">02</span><span class="p">:</span><span class="na">00</span><span class="p">/;</span>
</code></pre></div><p>è¿™ä¼šæŠ¥é”™:</p>
<blockquote>
<p>Unrecognized regex metacharacter - (must be quoted to match literally)</p>
</blockquote>
<p>åœ¨ Raku çš„æ­£åˆ™è¡¨è¾¾å¼ä¸­ä»»ä½•éå­—æ¯æ•°å­—å­—ç¬¦(&lsquo;a&rsquo;..&lsquo;z&rsquo;, &lsquo;A&rsquo;..&lsquo;Z&rsquo;, 0..9)éƒ½å¿…é¡»ç”¨å¼•å·å¼•èµ·æ¥:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nv">$logfile</span> <span class="o">~~</span> <span class="p">/</span><span class="mi">2016</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="sr"> </span><span class="mo">02</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="sr"> </span><span class="mo">06</span><span class="sr">T</span><span class="mi">14</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">:</span><span class="p">&#39;</span><span class="sr"> </span><span class="mi">36</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="mo">02</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">:</span><span class="p">&#39;</span><span class="sr"> </span><span class="mo">00</span><span class="p">/;</span>
</code></pre></div><p>ç°åœ¨æˆ‘ä»¬å¾—åˆ°ç­‰ä»·çš„å¥‡æ€ªçš„è¡¨è¾¾å¼:</p>
<pre><code>ï½¢2016-01-29T13:25+01:00ï½£
</code></pre><p>è¿™ä»…ä»…å‘Šè¯‰æˆ‘ä»¬, <code>~~</code> æ™ºèƒ½åŒ¹é…æ“ä½œç¬¦åŒ¹é…äº†ä¸€äº›æ–‡æœ¬, è¿™å°±æ˜¯å®ƒåŒ¹é…åˆ°çš„æ–‡æœ¬ã€‚<strong>ï½¢ï½£</strong> æ˜¯æ—¥è¯­å¼•å·æ ‡è®°, æ•…æ„å’Œå‰©ä½™çš„æ–‡æœ¬åŒºåˆ†å¼€æ¥ã€‚</p>
<p>åœ¨ Raku ä¸­, é»˜è®¤æ‰“å°å‡ºå¸¦æœ‰æ˜ç¡®æ ‡è®°çš„åŒ¹é…å¯¹è±¡, å®ƒå‡†ç¡®åœ°å‘Šè¯‰ä½ åŒ¹é…ä»å“ªé‡Œå¼€å§‹, åˆ°å“ªé‡Œç»“æŸã€‚</p>
<h2 id="å½’çº³">å½’çº³</h2>
<p>æˆ‘ä»¬æƒ³è®©è¯¥æ­£åˆ™è¡¨è¾¾å¼æ›´å…·æ™®éæ€§, ä¾‹å¦‚åŒ¹é… 2016 å¹´çš„æ—¥å¿—:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nv">$logfile</span> <span class="o">~~</span> <span class="p">/</span><span class="mi">2015</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="mi">2016</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="sr"> </span><span class="mo">02</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="sr"> </span><span class="mo">06</span><span class="sr">T</span><span class="mi">14</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">:</span><span class="p">&#39;</span><span class="sr"> </span><span class="mi">36</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="mo">02</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">:</span><span class="p">&#39;</span><span class="sr"> </span><span class="mo">00</span><span class="p">/;</span>
</code></pre></div><p>ä½†æ˜¯è¿™è¿˜ä¼šåŒ¹é…åˆ°æˆ‘ä»¬ä¸æƒ³è¦çš„ä¸œè¥¿, ä¾‹å¦‚ Â &lsquo;/post/2015/02&rsquo; æˆ–è€…ç”šè‡³ &lsquo;/number/120153&rsquo;ã€‚å› ä¸º <code>|</code>çš„ä¼˜å…ˆçº§æ²¡æœ‰å­—ç¬¦é—´çš„è¿æ¥ä¼˜å…ˆçº§é«˜ã€‚æ‰€ä»¥:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nv">$logfile</span> <span class="o">~~</span> <span class="p">/</span><span class="sr"> </span><span class="p">[</span><span class="mi">2015</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="mi">2016</span><span class="p">]</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="sr"> </span><span class="mo">02</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="sr"> </span><span class="mo">06</span><span class="sr">T</span><span class="mi">14</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">:</span><span class="p">&#39;</span><span class="sr"> </span><span class="mi">36</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="mo">02</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">:</span><span class="p">&#39;</span><span class="sr"> </span><span class="mo">00</span><span class="p">/;</span>
</code></pre></div><p>é—®é¢˜è§£å†³, ä½†æ˜¯æˆ‘ä»¬æƒ³åŒ¹é… &lsquo;[ 1997 | 1998 | 1999 | 2000&hellip; 2015 ]&rsquo; è¿™äº›å‘¢ï¼Ÿ</p>
<h3 id="learning-shorthnd">Learning Shorthnd</h3>
<p>åŒ¹é…4ä½æ•°å­—çš„å¹´ä»½å¥½äº†:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nv">$logfile</span> <span class="o">~~</span> <span class="p">/</span><span class="sr"> </span><span class="se">\d\d\d\d</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="sr"> </span><span class="mo">02</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="sr"> </span><span class="mo">06</span><span class="sr">T</span><span class="mi">14</span><span class="o">..</span><span class="ni">.</span><span class="p">/;</span>
</code></pre></div><p>å…¶å®ƒéœ€è¦æ•°å­—çš„åœ°æ–¹ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>\d</code> è¿™ç§ä¾¿æ·å½¢å¼çš„æ•°å­—:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nv">$logfile</span> <span class="o">~~</span> <span class="p">/</span><span class="sr"> </span><span class="se">\d\d\d\d</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\d\d</span><span class="sr"> - </span><span class="se">\d\d</span><span class="sr"> T </span><span class="se">\d\d</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">:</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\d\d</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\d\d</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">:</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\d\d</span><span class="p">/;</span>
</code></pre></div><p><code>'+' &lt;digits&gt; : &lt;digits&gt;</code>Â åªä¼šåŒ¹é… <code>+01</code> å’Œ <code>+12</code> ä¹‹é—´çš„æ—¶åŒº, è¿˜æœ‰å…¶å®ƒåœ¨ <code>-11</code> åˆ° <code>-01</code> ä¹‹é—´çš„æ—¶åŒº, æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ <code>|</code> æ¥åŒ¹é… &lsquo;+&rsquo; æˆ– &lsquo;-&rsquo;, åƒè¿™æ ·:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nv">$logfile</span> <span class="o">~~</span> <span class="p">/</span><span class="sr"> </span><span class="se">\d\d\d\d</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\d\d</span><span class="sr"> - </span><span class="se">\d\d</span><span class="sr"> T </span><span class="se">\d\d</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">:</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\d\d</span><span class="sr"> </span><span class="p">[</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">]</span><span class="sr"> </span><span class="se">\d\d</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">:</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\d\d</span><span class="p">/;</span>
</code></pre></div><p>åŸºæœ¬æ­£ç¡®äº†, ä½†æ˜¯ç”±äºå†å²åŸå› , æ—¶åŒºè¿˜èƒ½æ˜¯ä¸€ä¸ªå­—æ¯ <code>Z</code>, æ‰€ä»¥, è¿˜æœ‰ä¸€å¤„è¦ä¿®æ”¹:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nv">$logfile</span> <span class="o">~~</span> <span class="p">/</span><span class="sr"> </span><span class="se">\d\d\d\d</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\d\d</span><span class="sr"> - </span><span class="se">\d\d</span><span class="sr"> T </span><span class="se">\d\d</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">:</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\d\d</span><span class="sr"> </span><span class="p">[</span><span class="sr"> </span><span class="p">[</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">]</span><span class="sr"> </span><span class="se">\d\d</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">:</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\d\d</span><span class="sr"> </span><span class="o">|</span><span class="sr"> Z </span><span class="p">]</span><span class="sr"> </span><span class="p">/;</span>
</code></pre></div><h2 id="é‡æ„">é‡æ„</h2>
<p>ä½†æ˜¯é‚£ä¸ª <strong><code>[ '+' ... Z ]</code></strong> è¡¨è¾¾å¼å¤ªé•¿äº†, èƒ½é‡æ„å°±æ›´å¥½äº†ã€‚<strong>regex</strong> å¯¹è±¡æ¥æ‹¯æ•‘æˆ‘ä»¬äº†, å®ƒå¸®åŠ©æˆ‘ä»¬æ¸…ç†ä»£ç ã€‚</p>
<p><strong>regex</strong> å¯¹è±¡çœ‹èµ·æ¥å¾ˆåƒåŒ¹é…è¡¨è¾¾å¼, é™¤äº†å®ƒä½¿ç”¨èŠ±æ‹¬å·æ¥å‘Šè¯‰ä»å“ªå¼€å§‹, åˆ°å“ªç»“æŸ:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="k">regex</span> <span class="nf">Timezone</span> <span class="p">{</span><span class="sr"> Z </span><span class="o">|</span><span class="sr"> </span><span class="p">[&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;]</span><span class="sr"> </span><span class="se">\d\d</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">:</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\d\d</span><span class="sr"> </span><span class="p">};</span>
<span class="nb">say</span> <span class="nv">$logfile</span> <span class="o">~~</span> <span class="p">/</span><span class="sr"> </span><span class="se">\d\d\d\d</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\d\d</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\d\d</span><span class="sr"> T </span><span class="se">\d\d</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">:</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\d\d</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Timezone</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">/;</span>
</code></pre></div><p><code>&lt;..&gt;</code> ä»å¤–è¡¨ä¸Šçœ‹æŠŠé‡æ„åçš„è¡¨è¾¾å¼å’Œä¸»æ–‡æœ¬åˆ†å¼€äº†, è€Œè®© Timezone è¡¨è¾¾å¼åˆ†ç¦»æ„å‘³ç€æˆ‘ä»¬èƒ½åœ¨ä»£ç ä¸­çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨å®ƒäº†ã€‚äº‹å®ä¸Šæˆ‘ä»¬å¯ä»¥é‡æ„å…¶å®ƒçš„æ­£åˆ™:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="k">regex</span> <span class="nf">Date</span> <span class="p">{</span><span class="sr"> </span><span class="se">\d\d\d\d</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\d\d</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\d\d</span><span class="sr"> </span><span class="p">};</span>
<span class="k">my</span> <span class="k">regex</span> <span class="nf">Time</span> <span class="p">{</span><span class="sr"> </span><span class="se">\d\d</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">:</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\d\d</span><span class="sr">              </span><span class="p">};</span>
<span class="k">my</span> <span class="k">regex</span> <span class="nf">Timezone</span> <span class="p">{</span><span class="sr"> Z </span><span class="o">|</span><span class="sr"> </span><span class="p">[</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">]</span><span class="sr"> </span><span class="se">\d\d</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">:</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\d\d</span><span class="sr"> </span><span class="p">};</span>

<span class="nb">say</span> <span class="nv">$logfile</span> <span class="o">~~</span> <span class="p">/</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Date</span><span class="p">&gt;</span><span class="sr"> T </span><span class="p">&lt;</span><span class="nf">Time</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Timezone</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">/;</span>
</code></pre></div><p>è®©æ‰€æœ‰è¿™äº› <code>\d\d</code> ååœ¨ä¸€å—å„¿æœ‰äº›ç¢çœ¼, æ‰€ä»¥æˆ‘ä»¬å†é‡æ„ä¸‹:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="k">regex</span> <span class="nf">Integer</span> <span class="p">{</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="sr"> </span><span class="p">};</span>

<span class="k">my</span> <span class="k">regex</span> <span class="nf">Date</span>     <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Integer</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Integer</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Integer</span><span class="p">&gt;</span><span class="sr">     </span><span class="p">};</span>
<span class="k">my</span> <span class="k">regex</span> <span class="nf">Time</span>     <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Integer</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">:</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Integer</span><span class="p">&gt;</span><span class="sr">                   </span><span class="p">};</span>
<span class="k">my</span> <span class="k">regex</span> <span class="nf">Timezone</span> <span class="p">{</span><span class="sr"> Z </span><span class="o">|</span><span class="sr"> </span><span class="p">[</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">]</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Integer</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">:</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Integer</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">};</span>

<span class="nb">say</span> <span class="nv">$logfile</span> <span class="o">~~</span> <span class="p">/</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Date</span><span class="p">&gt;</span><span class="sr"> T </span><span class="p">&lt;</span><span class="nf">Time</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Timezone</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">/;</span>
</code></pre></div><p><a href="http://theperlfisher.blogspot.jp/2016/02/from-regular-expressions-to-grammars-pt.html">http://theperlfisher.blogspot.jp/2016/02/from-regular-expressions-to-grammars-pt.html</a></p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/regex" term="regex" label="regex" />
                             
                                <category scheme="https://ohmyweekly.github.io/tags/grammar" term="grammar" label="grammar" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[ä»æ­£åˆ™è¡¨è¾¾å¼åˆ° Grammar(ç¬¬äºŒéƒ¨åˆ†)]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-10-29-from-regex-to-grammar/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2015-04-27-from-regex-to-grammar-part-one/?utm_source=atom_feed" rel="related" type="text/html" title="ä»æ­£åˆ™è¡¨è¾¾å¼åˆ° Grammar(ç¬¬ä¸€éƒ¨åˆ†)" />
                <link href="https://ohmyweekly.github.io/notes/2015-11-16-a-mutable-grammar-for-raku/?utm_source=atom_feed" rel="related" type="text/html" title="A Mutable Grammar for Raku" />
                <link href="https://ohmyweekly.github.io/notes/2016-02-05-raku-grammars/?utm_source=atom_feed" rel="related" type="text/html" title="Raku Grammars" />
                <link href="https://ohmyweekly.github.io/notes/2016-01-01-raku-core-hacking-grammatical-babble/?utm_source=atom_feed" rel="related" type="text/html" title="Raku æ ¸å¿ƒé­”æ”¹: Grammar çš„èƒ¡è¨€ä¹±è¯­" />
                <link href="https://ohmyweekly.github.io/notes/2015-06-14-play-audio-at-given-volume/?utm_source=atom_feed" rel="related" type="text/html" title="ä»¥æŒ‡å®šéŸ³é‡éšæœºæ’­æ”¾éŸ³é¢‘æ–‡ä»¶" />
            
                <id>https://ohmyweekly.github.io/notes/2015-10-29-from-regex-to-grammar/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>From Regex to Grammar</blockquote><p>å¦‚æœä½ æ˜¯æ­£åˆ™è¡¨è¾¾å¼æ–°äºº(è‡³å°‘å½“å®ƒä»¬ç”¨äº Raku ä¸­æ—¶), é‚£æˆ‘å»ºè®®ä½ ä»è¿™ä¸ªç³»åˆ—çš„<a href="http://theperlfisher.blogspot.ro/2016/02/from-regular-expressions-to-grammars-pt.html">ç¬¬ä¸€éƒ¨åˆ†</a>å¼€å§‹ã€‚é‚£äº›æŒæ¡äº†ä¸€å®šæ­£åˆ™è¡¨è¾¾å¼çš„äººå¯ä»¥è·³è¿‡<a href="http://theperlfisher.blogspot.ro/2016/02/from-regular-expressions-to-grammars-pt_20.html">ä¸Šå‘¨</a>çš„æ–‡ç« ã€‚ç°åœ¨, ç»§ç»­æ¼”ç¤º!</p>
<h2 id="ä¸Šå‘¨è½¶äº‹">ä¸Šå‘¨è½¶äº‹</h2>
<p>æˆ‘ä»¬å¼€å§‹å¼€å‘ä¸€ä¸ªæ¥æ”¶è¯¸å¦‚:</p>
<div class="highlight"><pre class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Hey, did you konw a = &#34;</span> <span class="o">+</span> <span class="nx">a</span> <span class="o">+</span> <span class="s2">&#34;?&#34;</span><span class="p">);</span>
</code></pre></div><p>Javascript è¡¨è¾¾å¼çš„ Raku ç¼–è¯‘å™¨, å¹¶æŠŠè¿™æ®µä»£ç è½¬æ¢ä¸º <a href="http://raku.org/">Rakudo</a> é‚£æ ·çš„ç¼–è¯‘å™¨èƒ½è¿è¡Œçš„ Raku ä»£ç ã€‚åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰, æƒ³æƒ³è½¬æ¢åçš„ Raku ä»£ç çœ‹èµ·æ¥æ˜¯ä»€ä¹ˆæ ·çš„å¯èƒ½ä¼šæ˜¯ä¸ªå¥½ä¸»æ„ã€‚å¦‚æœä½ å·²ç»çŸ¥é“äº† Perl 5, é‚£ä¹ˆä½ åº”è¯¥ç†Ÿæ‚‰è¿™æ ·çš„ä»£ç ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-perl" data-lang="perl"><span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="n">say</span> <span class="s">&#34;Hey, did you konw a = &#34;</span> <span class="o">~</span> <span class="nv">$a</span> <span class="o">~</span> <span class="s">&#34;?&#34;</span><span class="p">;</span>
</code></pre></div><p>æˆ‘ä»¬å°†éœ€è¦ç¡®ä¿æˆ‘ä»¬çš„æ­£åˆ™è¡¨è¾¾å¼æ•è·åˆ°äº† Javascript çš„è¦ç´ ã€‚å¦‚æœä½ è¿˜è®°å¾—ä¸Šä¸€æ¬¡, æˆ‘ä»¬ä½¿ç”¨è¿™æ ·ä¸€ç»„æ­£åˆ™è¡¨è¾¾å¼æ¥æ•è·æˆ‘ä»¬çš„æ–‡æœ¬:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="k">rule</span> <span class="nf">Number</span>                <span class="p">{</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="sr">                                                          </span><span class="p">};</span>
<span class="k">my</span> <span class="k">rule</span> <span class="nf">Variable</span>              <span class="p">{</span><span class="sr"> </span><span class="se">\w</span><span class="o">+</span><span class="sr">                                                          </span><span class="p">};</span>
<span class="k">my</span> <span class="k">rule</span> <span class="nf">String</span>                <span class="p">{</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">&#34;</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">-</span><span class="p">[</span><span class="sr">&#34; </span><span class="p">]&gt;</span><span class="o">+</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">&#34;</span><span class="p">&#39;</span><span class="sr">                                             </span><span class="p">};</span>
<span class="k">my</span> <span class="k">rule</span> <span class="nf">Assignment-Expression</span> <span class="p">{</span><span class="sr"> var </span><span class="p">&lt;</span><span class="nf">Variable</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Number</span><span class="p">&gt;</span><span class="sr">                                  </span><span class="p">};</span>
<span class="k">my</span> <span class="k">rule</span> <span class="nf">Function-Call</span>         <span class="p">{</span><span class="sr"> console </span><span class="p">&#39;</span><span class="s1">.</span><span class="p">&#39;</span><span class="sr"> log </span><span class="p">&#39;</span><span class="s1">(</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">String</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Variable</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">String</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">)</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">};</span>

<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">var a = 3; console.log(&#34;Hey, did you konw a = &#34; + a + &#34;?&#34;);</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="k">rule</span> <span class="p">{</span> <span class="p">&lt;</span><span class="s">Assignment-Expression</span><span class="p">&gt;</span> <span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span>  <span class="p">&lt;</span><span class="s">Function-Call</span><span class="p">&gt;</span> <span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span> <span class="p">};</span>
</code></pre></div><p>å¦‚æœä½ æŠŠè¿™æ®µä»£ç æ”¾åˆ°ä¸€ä¸ª Raku æºæ–‡ä»¶ä¸­å¹¶è¿è¡Œå®ƒ, é‚£ä¹ˆå®ƒçš„è¾“å‡ºç¬¬ä¸€æ¬¡çœ‹èµ·æ¥å¯èƒ½ä¼šæœ‰ç‚¹å¥‡æ€ª:</p>
<pre><code>ï½¢var a = 3; console.log( &quot;Hey, did you know a = &quot; + a + &quot;?&quot; );ï½£
 Assignment-Expression =&gt; ï½¢var a = 3ï½£
    Variable =&gt; ï½¢a ï½£
    Number =&gt; ï½¢3ï½£
 Function-Call =&gt; ï½¢console.log( &quot;Hey, did you know a = &quot; + a + &quot;?&quot; )ï½£
    String =&gt; ï½¢&quot;Hey, did you know a = &quot; ï½£
    Variable =&gt; ï½¢a ï½£
    String =&gt; ï½¢&quot;?&quot; ï½£
</code></pre><p>å¦‚æœä½ æ„¿æ„æš‚æ—¶å¿½ç•¥ ã€Œã€ æ ‡è®°, ä½ ä¼šçœ‹åˆ°åŒ¹é…è¢«ç¼©è¿›äº†, å‡ ä¹åƒèµ„æºç®¡ç†å™¨çª—å£ä¸€æ ·, <code>&lt;Assignment-Expression&gt;</code> ä½œä¸ºç›®å½•, <code>Variable</code> å’Œ <code>Number</code> ä½œä¸ºç›®å½•é‡Œé¢çš„æ–‡ä»¶ã€‚å®é™…ä¸Š, é‚£ç¦»çœŸç›¸ä¸è¿œäº†ã€‚å½“æˆ‘çœ‹åˆ°è¿™ç§ç»“æ„æ—¶, æˆ‘å‘ç°ä½¿ç”¨ä¸€ç‚¹æ·»åŠ çš„è¯­æ³•èƒ½å¸®åŠ©æˆ‘ä»¬åƒè¿™æ ·æ¥è§‚å¯Ÿå®ƒ:</p>
<pre><code>$/ =&gt; ï½¢var a = 3; console.log( &quot;Hey, did you know a = &quot; + a + &quot;?&quot; );ï½£
 &lt;Assignment-Expression&gt; =&gt; ï½¢var a = 3ï½£
    &lt;Variable&gt; =&gt; ï½¢a ï½£
    &lt;Number&gt; =&gt; ï½¢3ï½£
 &lt;Function-Call&gt; =&gt; ï½¢console.log( &quot;Hey, did you know a = &quot; + a + &quot;?&quot; )ï½£
    &lt;String&gt; =&gt; ï½¢&quot;Hey, did you know a = &quot; ï½£
    &lt;Variable&gt; =&gt; ï½¢a ï½£
    &lt;String&gt; =&gt; ï½¢&quot;?&quot; ï½£
</code></pre><p>è¿™å‡ ä¹è®©æ€ä¹ˆæ‰“å°å‡ºæ–‡æœ¬å˜å¾—æ›´å®¹æ˜“, å¹¶åœ¨æˆ‘ä»¬çš„æ­£åˆ™è¡¨è¾¾å¼ä¸­æŒ‡å‡ºäº†ä¸€ä¸ªå°é—®é¢˜ã€‚æˆ‘ä»¬æ¥æ‰“å°ç»™å˜é‡ <em>a</em> æ‰€èµ‹çš„æ•°å­—, ä»è¿™å„¿å¼€å§‹ã€‚ç¬¬ä¸€è¡Œå‘Šè¯‰æˆ‘ä»¬ç›®å½•çš„æ ¹, æˆ–è€…åŒ¹é…æ ‘æ˜¯ <code>$/</code>ã€‚å¦‚æœä½ åœ¨æµ‹è¯•æ–‡ä»¶çš„æœ«å°¾æ·»åŠ ä¸Š <code>say $/;</code> å¹¶è¿”å›å®ƒ, é‚£ä¹ˆä½ ä¼šçœ‹åˆ°æ•´ä¸ªè¡¨è¾¾å¼è¢«æ‰“å°å‡ºäº† 2 æ¬¡ã€‚é‚£ä¸€å®šæ„å‘³ç€ <code>$/</code> å°±æ˜¯æ•´ä¸ªåŒ¹é…ã€‚</p>
<p>æ¯å‘ä¸‹æ¨è¿›ä¸€å±‚å°±æ˜¯æŠŠ <code>=&gt;</code> ç®­å¤´çš„å·¦ä¾§çš„ä¸œè¥¿æ·»åŠ åˆ° <code>$/</code> çš„å³è¾¹ã€‚æŠŠä¹‹å‰çš„ <code>say</code> è¯­å¥ä¿®æ”¹ä¸º <code>say  $/&lt;Assignment-Expression&gt;;</code>, å¹¶çœ‹çœ‹è¾“å‡ºå‘ç”Ÿäº†ä»€ä¹ˆæ”¹å˜ã€‚å®ƒç°åœ¨çœ‹èµ·æ¥åº”è¯¥åƒè¿™æ ·:</p>
<pre><code>ï½¢var a = 3ï½£
  Variable =&gt; ï½¢a ï½£
  Number =&gt; ï½¢3ï½£
</code></pre><p>è®©æˆ‘ä»¬æŠŠæŠŠæ ‡è®°(ä¸å¯è§)æ·»åŠ è¿›æ¥, æ‰€ä»¥æˆ‘ä»¬èƒ½çŸ¥é“åˆ°äº†å“ªé‡Œ&hellip;</p>
<pre><code>$/&lt;Assignment-Expression&gt; =&gt; ï½¢var a = 3ï½£
  &lt;Variable&gt; =&gt; ï½¢a ï½£
  &lt;Number&gt; =&gt; ï½¢3ï½£
</code></pre><p>æˆ‘ä»¬ç°åœ¨èƒ½çœ‹åˆ°æˆ‘ä»¬çš„ç›®æ ‡, æ•°å­— 3, ä»…ä»…å®åœ¨æ›´ä¸‹é¢çš„ä¸€å±‚ã€‚å’Œä¸Šæ¬¡ä¸€æ ·, æˆ‘ä»¬èƒ½å¤Ÿæ·»åŠ è¡¨è¾¾å¼å·¦ä¾§çš„ä¸œè¥¿, æ‰€ä»¥æˆ‘ä»¬å°±åŠ¨æ‰‹å§ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Assignment-Expression</span><span class="p">&gt;&lt;</span><span class="s">Number</span><span class="p">&gt;;</span>
  <span class="p">ï½¢</span><span class="s">3</span><span class="p">ï½£</span>
</code></pre></div><p>æˆ‘ä»¬å‡ ä¹å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„äº†ã€‚ã€Œã€ æŒ¡é“, æ‰€ä»¥æˆ‘ä»¬åœ¨è¿™å„¿æŠŠå€¼è½¬æ¢å›æ•°å­—ã€‚æˆ‘æŠŠè½¬æ¢(cast)ç”¨å¼•å·æ‰©èµ·æ¥, å› ä¸ºå®ƒä¸æ˜¯ <code>C/C++</code> ç¨‹åºå‘˜é‚£æ ·è®¤ä¸ºçš„&quot;casting&quot;ã€‚æˆ‘ä»¬æƒ³åšçš„å¤§çº¦ç­‰ä»·äº <code>sscanf(str,&quot;%d&quot;,&amp;num)</code>, ä½†æ˜¯åœ¨ Raku ä¸­, è¿™ä¸ªæ“ä½œç¬¦æ›´åŠ ç®€å•:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="o">+</span><span class="nv">$/</span><span class="p">&lt;</span><span class="s">Assignment-Expression</span><span class="p">&gt;&lt;</span><span class="s">Number</span><span class="p">&gt;;</span> <span class="c1"># 3</span>
</code></pre></div><p>å¦‚æœä¸æ·±å…¥æ›´å¤šç»†èŠ‚, é‚£ä¹ˆ <code>$/</code> æ˜¯ä¸€ä¸ªé‡Œé¢è—ç€éšå¼æ•°å­—ã€å­—ç¬¦ä¸²å’Œå¸ƒå°”å€¼çš„å¯¹è±¡ã€‚å‰é¢æ·»åŠ çš„ <code>+</code> æŠŠéšè—åœ¨ <code>$/</code> å¯¹è±¡ä¸­çš„æ•°å­—æ˜¾ç¤ºå‡ºæ¥äº†ã€‚</p>
<h2 id="ä»-javascript-åˆ°-perl">ä» Javascript åˆ° Perl</h2>
<p>æˆ‘ä»¬ç¦»ä» Javascript ç”Ÿæˆ Raku ä»£ç ä¸è¿œäº†ã€‚è®©æˆ‘ä»¬ä½¿ç”¨ä¸Šé¢æ‰€å­¦çš„å¼€å§‹æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªè¯­å¥, èµ‹å€¼è¯­å¥ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#39;</span><span class="s1">my $</span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Assignment-Expression</span><span class="p">&gt;&lt;</span><span class="s">Variable</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> = </span><span class="p">&#39;</span> <span class="o">~</span>
      <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Assignment-Expression</span><span class="p">&gt;&lt;</span><span class="s">Number</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;;</span>

<span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</code></pre></div><p>æˆ‘ä»¬ä»…ä»…ä½¿ç”¨äº† 7 è¡Œ Raku å°±æŠŠä»£ç ä»ä¸€ç§è¯­è¨€è½¬æ¢ä¸ºå¦å¤–ä¸€ç§è¯­è¨€ã€‚å¹¶ä¸”å¤§éƒ¨åˆ†çš„ Raku ä»£ç éƒ½æ˜¯å¯é‡ç”¨çš„, å› ä¸ºå­—ç¬¦ä¸², æ•°å­—, å’Œ <code>Javascript/C/Java</code> é£æ ¼çš„å˜é‡ååœ¨å¤§éƒ¨åˆ†è¯­è¨€ä¹‹é—´æ˜¯é€šç”¨çš„ã€‚</p>
<p>ä¸Šæ¬¡, æˆ‘ä»¬å­¦ä¹ äº†æ€ä¹ˆä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥åˆ›å»ºåŒ¹é…ã€‚è¿™æ¬¡æˆ‘ä»¬å­¦ä¼šäº†æ€ä¹ˆä½¿ç”¨æˆ‘ä»¬è¯´åŒ¹é…åˆ°çš„ä¸œè¥¿, è¿˜æœ‰æ€ä¹ˆåœ¨ <em>say</em> è¯­å¥ä¸­æ‰¾å‡ºæˆ‘ä»¬æƒ³è¦çš„ä¸œè¥¿ã€‚ ä¸å¯è§çš„åŒ¹é…æ ‡è®°ç›¸å½“æœ‰ç”¨, æˆ‘å¯èƒ½ä¼šå†™ä¸€ä¸ªæ¨¡å—æ¥æŠŠå®ƒä»¬æ”¾å›åˆ°åŒ¹é…è¡¨è¾¾å¼ä¸­, é‚£åº”è¯¥ä¸éš¾ã€‚</p>
<p>é‚£ä¸ªæ–¹æ¡ˆæœ‰ä¸€ä¸ªé—®é¢˜, å¦‚æœæˆ‘ä»¬çœ‹ä¸€ä¸‹ <code>&lt;Function-Call&gt;</code> åŒ¹é…, ä¼šå¾ˆå®¹æ˜“å‘ç°é‚£ä¸ªé—®é¢˜ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$/</span><span class="p">&lt;</span><span class="s">Function-Call</span><span class="p">&gt;</span> <span class="o">=&gt;</span> <span class="p">ï½¢</span><span class="s">console.log( &#34;Hey, did you know a = &#34; + a + &#34;?&#34; )</span><span class="p">ï½£</span>
  <span class="p">&lt;</span><span class="s">String</span><span class="p">&gt;</span> <span class="o">=&gt;</span> <span class="p">ï½¢</span><span class="s">&#34;Hey, did you know a = &#34; </span><span class="p">ï½£</span>
  <span class="p">&lt;</span><span class="s">Variable</span><span class="p">&gt;</span> <span class="o">=&gt;</span> <span class="p">ï½¢</span><span class="s">a </span><span class="p">ï½£</span>
  <span class="p">&lt;</span><span class="s">String</span><span class="p">&gt;</span> <span class="o">=&gt;</span> <span class="p">ï½¢</span><span class="s">&#34;?&#34; </span><span class="p">ï½£</span>
</code></pre></div><p>å½“æˆ‘ä»¬å†™äº† <code>say $/&lt;Function-Call&gt;&lt;String&gt;;</code> æ—¶, æˆ‘ä»¬ä¼šè·å–å“ªä¸ª <code>&lt;String&gt;?</code> åœ¨ä½ è¿è¡Œè¿™æ®µä»£ç ä¹‹å‰, å…ˆçŒœæµ‹ä¸€ä¸‹ã€‚ä¼šæ˜¯ç¬¬ä¸€ä¸ªå—, å› ä¸ºä¸€æ—¦åŒ¹é…å¯¹è±¡è¢«åˆ›å»º,  Raku å°±ä¸ä¼šæŠŠå®ƒæ›¿æ¢æ‰? ä¼šæ˜¯æœ€åä¸€ä¸ªå—, å› ä¸ºæœ€åä¸€ä¸ª&quot;è¦†ç›–&quot;äº†ç¬¬ä¸€ä¸ª? ç¼–è¯‘å™¨ä¼šä»…ä»…&quot;æ„Ÿåˆ°å›°æƒ‘&quot;ç„¶åä»€ä¹ˆä¹Ÿä¸æ‰“å°å—? è¿è¡Œä¸€ä¸‹çœ‹çœ‹!</p>
<p>å®ƒå®é™…ä¸Šä»¥ä¸€ä¸ªåˆ—è¡¨çš„å½¢å¼æŠŠä¸¤ä¸ªåŒ¹é…éƒ½è¿”å›äº†, æ‰€ä»¥ä½ å¯ä»¥å¼•ç”¨ä»»ä½•ä¸€ä¸ªã€‚ æˆ‘ä»¬çš„ä¸å¯è§æ ‡è®°ç°åœ¨çœ‹èµ·æ¥é•¿è¿™æ ·:</p>
<pre><code>$/&lt;Function-Call&gt; =&gt; ï½¢console.log( &quot;Hey, did you know a = &quot; + a + &quot;?&quot; )ï½£
  &lt;String&gt;[0] =&gt; ï½¢&quot;Hey, did you know a = &quot; ï½£
  &lt;Variable&gt; =&gt; ï½¢a ï½£
  &lt;String&gt;[1] =&gt; ï½¢&quot;?&quot; ï½£
</code></pre><p>æ‰€ä»¥, å¦‚æœæˆ‘ä»¬æƒ³æ‰“å°ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸², æˆ‘ä»¬å¯ä»¥å†™ä¸Š <code>say $/&lt;Function-Call&gt;&lt;String&gt;[0];</code> å¹¶å¾—åˆ°å«æœ‰æ—¶é«¦çš„æ—¥è¯­æ ‡è®°çš„ã€Œ&ldquo;Hey, did you know a = &quot; ã€ã€‚å¹¸è¿çš„æ˜¯æœ‰ä¸€ç§ä¾¿æ·æ–¹å¼æ¥é¿å…é‚£äº›æ—¥è¯­æ ‡è®°, å°±åƒæ•°å­— 3 ä¸­çš„é‚£æ ·:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="o">~</span><span class="nv">$/</span><span class="p">&lt;</span><span class="s">Function-Call</span><span class="p">&gt;&lt;</span><span class="s">String</span><span class="p">&gt;</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
 <span class="p">&#34;</span><span class="s2">Hey, did you know a = </span><span class="p">&#34;</span>
</code></pre></div><p><strong>~</strong> æ“ä½œç¬¦ä½¿åŒ¹é…å­—ç¬¦ä¸²åŒ–, å°±åƒ <code>+</code> è®©è¿”å›çš„åŒ¹é…æ•°å­—åŒ–ä¸€æ ·ã€‚æ‰€ä»¥ä½ å¯èƒ½è‡ªå·±æŠŠæœ€åä¸€è¡Œå†™ä½œ:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#39;</span><span class="s1">say </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Function-Call</span><span class="p">&gt;&lt;</span><span class="s">String</span><span class="p">&gt;</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> ~ </span><span class="p">&#39;</span>
  <span class="p">&#39;</span><span class="s1"> $</span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Function-Call</span><span class="p">&gt;&lt;</span><span class="s">Variable</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> ~ </span><span class="p">&#39;</span>
  <span class="nv">$&lt;Function-Call&gt;&lt;String&gt;</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;;</span>

<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hey, did you know a = </span><span class="p">&#34;</span> <span class="o">~</span> <span class="nv">$a</span> <span class="o">~</span> <span class="p">&#34;</span><span class="s2">?</span><span class="p">&#34;;</span>
</code></pre></div><p>æˆ‘ä»¬å·²ç»æŠŠæˆ‘ä»¬çš„ä¸¤è¡Œ Javascript ä»£ç ç¼–è¯‘æˆ Raku ä»£ç äº†ã€‚</p>
<h2 id="é‡æ„">é‡æ„</h2>
<p>ç°åœ¨å·²ç»èƒ½å·¥ä½œäº†, ä½†æ˜¯æœ‰å¾ˆå¤šé‡å¤ã€‚ç›®å‰æˆ‘ä»¬å¾—åˆ°æ˜¯:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="k">rule</span> <span class="nf">Variable</span>               <span class="p">{</span><span class="sr"> </span><span class="se">\w</span><span class="o">+</span><span class="sr">                                                          </span><span class="p">};</span>
<span class="k">my</span> <span class="k">rule</span> <span class="nf">String</span>                 <span class="p">{</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">&#34;</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">-</span><span class="p">[</span><span class="sr"> &#34; </span><span class="p">]&gt;</span><span class="o">+</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">&#34;</span><span class="p">&#39;</span><span class="sr">                                            </span><span class="p">};</span>
<span class="k">my</span> <span class="k">rule</span> <span class="nf">Assignment-Expression</span>  <span class="p">{</span><span class="sr"> var </span><span class="p">&lt;</span><span class="nf">Variable</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Number</span><span class="p">&gt;</span><span class="sr">                                  </span><span class="p">};</span>
<span class="k">my</span> <span class="k">rule</span> <span class="nf">Function-Call</span>          <span class="p">{</span><span class="sr"> console </span><span class="p">&#39;</span><span class="s1">.</span><span class="p">&#39;</span><span class="sr"> log </span><span class="p">&#39;</span><span class="s1">(</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">String</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Variable</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">String</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">)</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">};</span>

<span class="p">&#39;</span><span class="s1">var a = 3; console.log( &#34;Hey, did you know a = &#34; + a + &#34;?&#34; );</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="k">rule</span> <span class="p">{</span> <span class="p">&lt;</span><span class="s">Assignment-Expression</span><span class="p">&gt;</span> <span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span> <span class="p">&lt;</span><span class="s">Function-Call</span><span class="p">&gt;</span> <span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span> <span class="p">}</span>

<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">my $</span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Assignment-Expression</span><span class="p">&gt;&lt;</span><span class="s">Variable</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> = </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Assignment-Expression</span><span class="p">&gt;&lt;</span><span class="s">Number</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;;</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">say </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Function-Call</span><span class="p">&gt;&lt;</span><span class="s">String</span><span class="p">&gt;</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> ~ $</span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Function-Call</span><span class="p">&gt;&lt;</span><span class="s">Variable</span><span class="p">&gt;</span> <span class="o">~</span>  <span class="p">&#39;</span><span class="s1"> ~ </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Function-Call</span><span class="p">&gt;&lt;</span><span class="s">String</span><span class="p">&gt;</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">~</span>  <span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;;</span>
</code></pre></div><p>é‚£äº› rules çœ‹èµ·æ¥ç›¸å½“å¥½,  <code>&lt;String&gt;</code> å’Œ <code>&lt;Variable&gt;</code> çš„é‡å¤ä¹Ÿæ˜¯ä¸å¯é¿å…çš„ã€‚ ä½†æ˜¯çœ‹çœ‹ <code>say</code> è¯­å¥, ä½ ä¼šçœ‹åˆ° <code>&lt;Assignment-Expression&gt;</code> å’Œ <code>&lt;Function-Call&gt;</code> é‡å¤äº†è‡ªèº«å¥½å‡ æ¬¡ã€‚é¿å…è¿™ç§é‡å¤çš„ä¸€ç§æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªä¸´æ—¶å˜é‡, ä½†æ˜¯é‚£å¯èƒ½ä¼šå˜å¾—ä¸‘é™‹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$assignment-expression</span> <span class="o">=</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Assignment-Expression</span><span class="p">&gt;;</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">my $</span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$assignment-expression</span><span class="p">&lt;</span><span class="s">Variable</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> = </span><span class="p">&#39;</span> <span class="o">~</span>  <span class="nv">$assignment-expression</span><span class="p">&lt;</span><span class="s">Number</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span>
</code></pre></div><p>ç›¸å, æˆ‘ä»¬åˆ©ç”¨ Raku çš„å­ä¾‹ç¨‹ç­¾å, å¹¶ä¸”é‡ç”¨ <code>$/</code> å˜é‡åä»¥ä½¿æˆ‘ä»¬èƒ½é‡ç”¨ä¸Šé¢æ‰€å†™çš„ä»£ç , ç„¶åæ‹¿æ‰ <code>&lt;Assignment-Expression&gt;</code> éƒ¨åˆ†ã€‚ æˆ‘ä¼šæŠŠå­ä¾‹ç¨‹çš„åå­—å‘½åä¸º rule çš„åå­—, åªæ˜¯ä¸ºäº†ç›´æ¥äº†å½“ã€‚(ä½ ä¼šåœ¨ä¹‹åçœ‹åˆ°ä¸ºä»€ä¹ˆè¿™æ ·åšã€‚)</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span>  <span class="nf">assignment-expression</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">&#39;</span><span class="s1">my $</span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Variable</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> = </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Number</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="nf">assignment-expression</span><span class="p">(</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Assignment-Expression</span><span class="p">&gt;</span> <span class="p">);</span>
</code></pre></div><p>è®©æˆ‘ä»¬å¯¹ <code>&lt;Function-Call&gt;</code> ä¹ŸåšåŒæ ·çš„äº‹æƒ…, åˆ›å»ºä¸€ä¸ªå«æœ‰ <code>$/</code> å­ä¾‹ç¨‹ç­¾åçš„åŒåå‡½æ•°ã€‚ å®ƒç°åœ¨å†™åœ¨ä¸€è¡Œé‡Œé¢å°±å¾ˆæ•´æ´äº†, å¹¶ä¸”åªé‡å¤ <em><!-- raw HTML omitted --></em> éƒ¨åˆ†, å› ä¸ºå®ƒä¸å¾—ä¸é‡å¤ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">function-call</span><span class="p">(</span> <span class="nv">$/</span> <span class="p">)</span> <span class="p">{</span>
     <span class="p">&#39;</span><span class="s1">say </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">String</span><span class="p">&gt;</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> ~ </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Variable</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> ~ </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">String</span><span class="p">&gt;</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="nf">function-call</span><span class="p">(</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Function-Call</span><span class="p">&gt;</span> <span class="p">);</span>
</code></pre></div><h2 id="å¯¹è±¡åŒ–">å¯¹è±¡åŒ–</h2>
<p>ä¸€è·¯ä¸Šæˆ‘åšäº†ç›¸å½“å¤šçš„é€‰æ‹©, è®©æˆ‘ä»¬åˆ°è¾¾è¿™é‡Œã€‚è¿™å°±æ˜¯æˆ‘ä»¬ä¸Šæ¬¡é‡æ„çš„åœ°æ–¹:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="k">rule</span> <span class="nf">Number</span>                <span class="p">{</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="sr">                                                          </span><span class="p">};</span>
<span class="k">my</span> <span class="k">rule</span> <span class="nf">Variable</span>              <span class="p">{</span><span class="sr"> </span><span class="se">\w</span><span class="o">+</span><span class="sr">                                                          </span><span class="p">};</span>
<span class="k">my</span> <span class="k">rule</span> <span class="nf">String</span>                <span class="p">{</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">&#34;</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">-</span><span class="p">[</span><span class="sr"> &#34; </span><span class="p">]&gt;</span><span class="o">+</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">&#34;</span><span class="p">&#39;</span><span class="sr">                                            </span><span class="p">};</span>
<span class="k">my</span> <span class="k">rule</span> <span class="nf">Assignment-Expression</span> <span class="p">{</span><span class="sr"> var </span><span class="p">&lt;</span><span class="nf">Variable</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Number</span><span class="p">&gt;</span><span class="sr">                                  </span><span class="p">};</span>
<span class="k">my</span> <span class="k">rule</span> <span class="nf">Function-Call</span>         <span class="p">{</span><span class="sr"> console </span><span class="p">&#39;</span><span class="s1">.</span><span class="p">&#39;</span><span class="sr"> log </span><span class="p">&#39;</span><span class="s1">(</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">String</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Variable</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">String</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">)</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">};</span>

<span class="p">&#39;</span><span class="s1">var a = 3; console.log( &#34;Hey, did you know a = &#34; + a + &#34;?&#34; );</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="k">rule</span> <span class="p">{</span> <span class="p">&lt;</span><span class="s">Assignment-Expression</span><span class="p">&gt;</span> <span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span> <span class="p">&lt;</span><span class="s">Function-Call</span><span class="p">&gt;</span> <span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span> <span class="p">}</span>

<span class="k">sub</span> <span class="nf">assignment-expression</span><span class="p">(</span> <span class="nv">$/</span> <span class="p">)</span> <span class="p">{</span>
    <span class="p">&#39;</span><span class="s1">my $</span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Variable</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> = </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Number</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">function-call</span><span class="p">(</span> <span class="nv">$/</span> <span class="p">)</span> <span class="p">{</span>
    <span class="p">&#39;</span><span class="s1">say </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">String</span><span class="p">&gt;</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> ~ $</span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Variable</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> ~ </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">String</span><span class="p">&gt;</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;;</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="nf">assignment-expression</span><span class="p">(</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Assignment-Expression</span><span class="p">&gt;</span> <span class="p">);</span>
<span class="nb">say</span> <span class="nf">function-call</span><span class="p">(</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Function-Call</span><span class="p">&gt;</span> <span class="p">);</span>
</code></pre></div><p>è¿™å°±æ˜¯æˆ‘ä»¬çš„å›æŠ¥ã€‚æˆ‘ä»¬å…ˆæ¡èµ·æœ€åé‚£ä¸¤ä¸ª <code>say</code> è¯­å¥ã€‚ æˆ‘ä»¬è¿˜æ²¡æœ‰ç»™é¡¶å±‚ rule ä¸€ä¸ªåå­—, æ‰€ä»¥æˆ‘ä»¬å°±å«å®ƒ&hellip; å¥½å§, ç°åœ¨è¿˜æ˜¯å« &lsquo;top&rsquo; å§ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">top</span><span class="p">(</span> <span class="nv">$/</span> <span class="p">)</span> <span class="p">{</span> <span class="nf">assignment-expression</span><span class="p">(</span> <span class="nv">$/</span> <span class="p">)</span> <span class="o">~</span> <span class="nf">function-call</span><span class="p">(</span> <span class="nv">$/</span> <span class="p">)</span> <span class="p">}</span>
</code></pre></div><h2 id="æ”¶å›ä½ çš„åæ§½">æ”¶å›ä½ çš„åæ§½</h2>
<p>æˆ‘ä»¬æš‚æ—¶è¿˜æ²¡æœ‰å¯¹å¤„äºæ–‡ä»¶é¡¶å±‚çš„ rules åšå¤ªå¤šå¤„ç†, æ‰€ä»¥è®©æˆ‘ä»¬å¼€å§‹å·¥ä½œå§ã€‚ åœ¨ Raku ä¸­, å°±ä¸€èˆ¬ç¼–ç¨‹è€Œè¨€, æŠŠä½ çš„ä»£ç æ‰“åŒ…å¤ç”¨æ˜¯ä¸é”™çš„æ³¨æ„ã€‚è€Œ Raku è®©æˆ‘ä»¬ä½¿ç”¨ <code>class</code> å…³é”®å­—å°†æˆ‘ä»¬çš„ç¨‹åºæ‰“åŒ…, æˆ‘ä»¬æ‹¥æœ‰çš„é‚£äº› rules ä»ä»»ä½•æ„ä¹‰ä¸Šæ¥è¯´å®é™…ä¸Šä¸æ˜¯&quot;ä»£ç &rdquo;ã€‚è€Œå®ƒä»¬èƒ½å¤Ÿç”¨äºä»£ç ä¸­, å¹¶ä¸”æˆ‘ä»¬ç¡®å®ä½¿ç”¨äº†å®ƒä»¬, å®ƒä»¬è‡ªèº«å®é™…ä¸Šå¹¶æ²¡æœ‰åšå‡ºä»»ä½•å†³å®šã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬ä¸åº”è¯¥ä½¿ç”¨ <code>class</code> å…³é”®å­—æ¥æŠŠå®ƒä»¬æ‰“åŒ…åˆ°ä¸€å—ã€‚ç›¸å, æœ‰å¦å¤–ä¸€ç§ä¾¿æ·çš„ç±»å‹ç”¨äºæŠŠä¸€å †æ­£åˆ™è¡¨è¾¾å¼å’Œ rules æ‰“åŒ…åˆ°ä¸€å—å„¿, å®ƒå«åš <code>grammar</code>ã€‚</p>
<p>å®ƒçš„è¯­æ³•å°±åƒå£°æ˜ä¸€ä¸ªã€Œruleã€ é‚£æ ·ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">grammar</span> <span class="nc">Javascript</span> <span class="p">{</span>
    <span class="k">rule</span> <span class="nf">Number</span>                <span class="p">{</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="sr">                                                          </span><span class="p">};</span>
    <span class="k">rule</span> <span class="nf">Variable</span>              <span class="p">{</span><span class="sr"> </span><span class="se">\w</span><span class="o">+</span><span class="sr">                                                          </span><span class="p">};</span>
    <span class="k">rule</span> <span class="nf">String</span>                <span class="p">{</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">&#34;</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">-</span><span class="p">[</span><span class="sr"> &#34; </span><span class="p">]&gt;</span><span class="o">+</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">&#34;</span><span class="p">&#39;</span><span class="sr">                                            </span><span class="p">};</span>
    <span class="k">rule</span> <span class="nf">Assignment-Expression</span> <span class="p">{</span><span class="sr"> var </span><span class="p">&lt;</span><span class="nf">Variable</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Number</span><span class="p">&gt;</span><span class="sr">                                  </span><span class="p">};</span>
    <span class="k">rule</span> <span class="nf">Function-Call</span>         <span class="p">{</span><span class="sr"> console </span><span class="p">&#39;</span><span class="s1">.</span><span class="p">&#39;</span><span class="sr"> log </span><span class="p">&#39;</span><span class="s1">(</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">String</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Variable</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">String</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">)</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">};</span>      

    <span class="k">rule</span> <span class="nf">TOP</span>                   <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Assignment-Expression</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Function-Call</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span><span class="sr">              </span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div><p>ä½ ä¼šæ³¨æ„åˆ°, æˆ‘ä»¬ç»™æˆ‘ä»¬çš„é¡¶å±‚ rule ä¹Ÿèµ·äº†ä¸ªåå­—, å¹¶ä¸”æš‚æ—¶æŠŠå®ƒå«åš ã€ŒTOPã€ å§ã€‚ å¦‚æœä½ æ­£åœ¨å®¶ç‹¬è‡ªç©è€, ä½ å¯èƒ½å·²ç»åšå‡ºæ›´æ”¹å¹¶æƒ³çŸ¥é“ ã€Œ&lsquo;var a = 3;&hellip;&rsquo; ~~ rule { &hellip; }ã€ æ˜¯æ€ä¹ˆèµ·ä½œç”¨çš„, å› ä¸ºé”®å…¥è¯¸å¦‚ ã€Œ&lsquo;var a = 3;&hellip;&rsquo; ~~ JavaScript;ã€è¿™æ ·çš„ä¸œè¥¿å¯èƒ½ä¸ä¼šé‚£ä¹ˆæœ‰ä½œç”¨ã€‚</p>
<p>Grammars å°±åƒç±»ä¸€æ ·, åœ¨é‡Œé¢å®ƒä»¬å®é™…ä¸Šæ˜¯ä¸€å—å¯èƒ½çš„ä»£ç ã€‚ å®ƒä»¬æœ¬èº«ä¸ä¼šå·¥ä½œ, å®ƒä»¬å¿…é¡»ä»æ½œåœ¨çš„è½¬æ¢ä¸ºåŠ¨æ€çš„ä»£ç ã€‚æˆ‘ä»¬å¯ä»¥åƒä½ åœ¨ç±»ä¸­åšçš„é‚£æ ·:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$JavaScript</span> <span class="o">=</span> <span class="n">JavaScript</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>
</code></pre></div><p>ç°åœ¨æˆ‘ä»¬æ‹¥æœ‰äº†ä¸€ä¸ªå¯ä»¥å·¥ä½œçš„å˜é‡ã€‚ ç°åœ¨, è®©æˆ‘ä»¬æ¥ä½¿ç”¨å®ƒã€‚æ‰€æœ‰çš„ Grammar ç±»éƒ½æœ‰ä¸€ä¸ªå†…ç½®çš„ ã€Œparse()ã€ æ–¹æ³•, ä»¥ä½¿æˆ‘ä»¬èƒ½å¾—åˆ° grammar ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚ æˆ‘ä»¬æ¥ä¿®æ”¹æˆ‘ä»¬çš„åŒ¹é…è¯­å¥ä»¥åˆ©ç”¨ parse() æ–¹æ³•:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$JavaScript</span><span class="o">.</span><span class="nb">parse</span><span class="p">(&#39;</span><span class="s1">var a = 3; console.log( &#34;Hey, did you know a = &#34; + a + &#34;?&#34; );</span><span class="p">&#39;);</span>
</code></pre></div><p>æˆ‘ä»¬çš„ä»£ç åº”è¯¥åˆèƒ½å·¥ä½œäº†ã€‚</p>
<h2 id="æ¥æ”¶åŠ¨ä½œ">æ¥æ”¶åŠ¨ä½œ</h2>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»æŠŠæˆ‘ä»¬æ‰€æœ‰çš„åŒ¹é…çš„ä¸œè¥¿æ‰“åŒ…åˆ°ä¸€ä¸ªå°å‹çš„ç±»é‡Œé¢äº†, å¦‚æœæˆ‘ä»¬èƒ½å¯¹é‚£äº›å­ä¾‹ç¨‹åšåŒæ ·çš„å¤„ç†å°†ä¼šå¾ˆæ£’ã€‚ æˆ‘ä»¬åœ¨è¿™å„¿è¯•è¯•, æŠŠæˆ‘ä»¬çš„å­ä¾‹ç¨‹æ”¾åˆ°å®ƒä»¬è‡ªå·±çš„å‘½åç©ºé—´ä¸­, å°±åƒæˆ‘ä»¬å¯¹ rule åšçš„é‚£æ ·ã€‚ æˆ‘ä»¬å¿…é¡»ä» ã€Œsubã€ ä¿®æ”¹ä¸º ã€Œmethodã€, è€Œæˆ‘ä»¬çš„ ã€Œtopã€ æ–¹æ³•å°†ä¼šä½¿ç”¨ ã€Œself.ã€ å»è°ƒç”¨å…¶å®ƒæ–¹æ³•ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Actions</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">assignment-expression</span><span class="p">(</span> <span class="nv">$/</span> <span class="p">)</span> <span class="p">{</span>
        <span class="p">&#39;</span><span class="s1">my $</span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Variable</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> = </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Number</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">function-call</span><span class="p">(</span> <span class="nv">$/</span> <span class="p">)</span> <span class="p">{</span>
        <span class="p">&#39;</span><span class="s1">say </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">String</span><span class="p">&gt;</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> ~ $</span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Variable</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> ~ </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">String</span><span class="p">&gt;</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;;</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">top</span><span class="p">(</span> <span class="nv">$/</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nb">self</span><span class="o">.</span><span class="nf">assignment-expression</span><span class="p">(</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Assignment-Expression</span><span class="p">&gt;</span> <span class="p">)</span> <span class="o">~</span>
        <span class="nb">self</span><span class="o">.</span><span class="nf">function-call</span><span class="p">(</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Function-Call</span><span class="p">&gt;</span> <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>å°±åƒä¹‹å‰é‚£æ ·, æˆ‘ä»¬å¯ä»¥åœ¨ä¸€è¡Œé‡Œé¢åˆ›å»º Actions å¯¹è±¡:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$actions</span> <span class="o">=</span> <span class="n">Actions</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>
</code></pre></div><p>å¹¶ä¸”è°ƒç”¨ top å‡ ä¹åƒæˆ‘ä»¬ä¹‹å‰åšçš„é‚£æ ·:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nv">$actions</span><span class="o">.</span><span class="nf">top</span><span class="p">(</span> <span class="nv">$/</span> <span class="p">);</span>
</code></pre></div><p>æˆ‘ä»¬å·²ç»ä¿®æ”¹äº†å¾ˆå¤šä¸œè¥¿äº†, æ‰€ä»¥æˆ‘ä»¬æ¥çœ‹çœ‹åˆ°å“ªäº†ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">grammar</span> <span class="nc">JavaScript</span> <span class="p">{</span>
  <span class="k">rule</span> <span class="nf">Number</span>                <span class="p">{</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="sr">                                                          </span><span class="p">};</span>
  <span class="k">rule</span> <span class="nf">Variable</span>              <span class="p">{</span><span class="sr"> </span><span class="se">\w</span><span class="o">+</span><span class="sr">                                                          </span><span class="p">};</span>
  <span class="k">rule</span> <span class="nf">String</span>                <span class="p">{</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">&#34;</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">-</span><span class="p">[</span><span class="sr"> &#34; </span><span class="p">]&gt;</span><span class="o">+</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">&#34;</span><span class="p">&#39;</span><span class="sr">                                            </span><span class="p">};</span>
  <span class="k">rule</span> <span class="nf">Assignment-Expression</span> <span class="p">{</span><span class="sr"> var </span><span class="p">&lt;</span><span class="nf">Variable</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Number</span><span class="p">&gt;</span><span class="sr">                                  </span><span class="p">};</span>
  <span class="k">rule</span> <span class="nf">Function-Call</span>         <span class="p">{</span><span class="sr"> console </span><span class="p">&#39;</span><span class="s1">.</span><span class="p">&#39;</span><span class="sr"> log </span><span class="p">&#39;</span><span class="s1">(</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">String</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Variable</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">String</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">)</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">};</span>
  <span class="k">rule</span> <span class="nf">TOP</span>                   <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Assignment-Expression</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Function-Call</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span><span class="sr">              </span><span class="p">}</span>
<span class="p">}</span>
<span class="k">my</span> <span class="nv">$j</span> <span class="o">=</span> <span class="n">JavaScript</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>

<span class="nv">$j</span><span class="o">.</span><span class="nb">parse</span><span class="p">(&#39;</span><span class="s1">var a = 3; console.log( &#34;Hey, did you know a = &#34; + a + &#34;?&#34; );</span><span class="p">&#39;);</span>

<span class="k">class</span> <span class="nc">Actions</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">assignment-expression</span><span class="p">(</span> <span class="nv">$/</span> <span class="p">)</span> <span class="p">{</span>
      <span class="p">&#39;</span><span class="s1">my $</span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Variable</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> = </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Number</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">function-call</span><span class="p">(</span> <span class="nv">$/</span> <span class="p">)</span> <span class="p">{</span>
      <span class="p">&#39;</span><span class="s1">say </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">String</span><span class="p">&gt;</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> ~ $</span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Variable</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> ~ </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">String</span><span class="p">&gt;</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;;</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">top</span><span class="p">(</span> <span class="nv">$/</span> <span class="p">)</span> <span class="p">{</span>
      <span class="nb">self</span><span class="o">.</span><span class="nf">assignment-expression</span><span class="p">(</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Assignment-Expression</span><span class="p">&gt;</span> <span class="p">)</span> <span class="o">~</span>
      <span class="nb">self</span><span class="o">.</span><span class="nf">function-call</span><span class="p">(</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Function-Call</span><span class="p">&gt;</span> <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$actions</span> <span class="o">=</span> <span class="n">Actions</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$actions</span><span class="o">.</span><span class="nf">top</span><span class="p">(</span><span class="nv">$/</span><span class="p">);</span>
</code></pre></div><p>ä¸ç”¨æ‹…å¿ƒ, æˆ‘ä»¬å¿«è¦åˆ°äº†ã€‚æ—¢ç„¶æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå•ç‹¬çš„ç±»æ¥å¤„ç† Actions, æˆ‘ä»¬æŠŠæ–¹æ³•é‡å‘½åä¸º Grammar ä¸­æ‰€åŒ¹é…çš„ rule çš„åå­—, ä»¥ä½¿æˆ‘ä»¬ä¸ä¼šå¿˜è®°å®ƒä»¬æ˜¯ä»€ä¹ˆã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Actions</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">Assignment-Expression</span><span class="p">(</span> <span class="nv">$/</span> <span class="p">)</span> <span class="p">{</span>
        <span class="p">&#39;</span><span class="s1">my $</span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Variable</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> = </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Number</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">Function-Call</span><span class="p">(</span> <span class="nv">$/</span> <span class="p">)</span> <span class="p">{</span>
        <span class="p">&#39;</span><span class="s1">say </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">String</span><span class="p">&gt;</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> ~$</span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Variable</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> ~ </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">String</span><span class="p">&gt;</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;;</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">TOP</span><span class="p">(</span> <span class="nv">$/</span> <span class="p">)</span> <span class="p">{</span>
        <span class="nb">self</span><span class="o">.</span><span class="nf">Assignment-Expression</span><span class="p">(</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Assignment-Expression</span><span class="p">&gt;</span> <span class="p">)</span> <span class="o">~</span>
        <span class="nb">self</span><span class="o">.</span><span class="nf">Function-Call</span><span class="p">(</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Function-Call</span><span class="p">&gt;</span> <span class="p">)</span>

    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>æ›´è¿›ä¸€æ­¥, æˆ‘ä»¬è¿˜æœ‰æœ€åä¸€ç‚¹é­”æ³•èƒ½å¤Ÿåˆ©ç”¨ã€‚ æˆ‘ä»¬å°†æŠŠ <code>$javascript</code> å’Œ <code>$actions</code> å¯¹è±¡åƒè¿™æ ·ç»„åˆåœ¨ä¸€å—ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nv">$javascript</span><span class="o">.</span><span class="nb">parse</span><span class="p">(&#39;</span><span class="s1">...</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">:</span><span class="s">actions</span><span class="p">(</span><span class="nv">$actions</span><span class="p">)</span> <span class="p">);</span>
</code></pre></div><p>ã€Œ:actions(&hellip;)ã€ ç»™ ã€Œparse()ã€æ–¹æ³•å£°æ˜çš„å¯é€‰å‚æ•°ã€‚æˆ‘ä»¬æ­£å‘Šè¯‰æ­£åˆ™è¡¨è¾¾å¼å¼•æ“, ä»»ä½•æ—¶å€™, åƒ <code>&lt;Function-Call&gt;</code> æˆ– <code>&lt;TOP&gt;</code> è¿™æ ·çš„ rule åŒ¹é…æ—¶, æˆ‘ä»¬ä¼šåœ¨æˆ‘ä»¬çš„ç±»ä¸­è®©å®ƒè°ƒç”¨å¯¹åº”çš„åŒåæ–¹æ³•ã€‚</p>
<p>è¿™å‡ ä¹æ˜¯æŒ‰åŸæ ·å·¥ä½œçš„, ä½†æ˜¯å¦‚æœä½ è¿è¡Œä¿®æ”¹åçš„ä»£ç ,  ä½ ä¼šå‘ç°è§£æè¿”å›äº†åŸæ¥çš„åŒ¹é…å¯¹è±¡, å¸¦ç€æ—¥è¯­å¼•ç”¨æ ‡è®°ã€‚æ‰€ä»¥çœ‹èµ·æ¥å¥½åƒæˆ‘ä»¬åˆå›åˆ°äº†åŸåœ°ã€‚ä¸å®Œå…¨æ˜¯ã€‚</p>
<p>ç»§ç»­, æˆ‘ä»¬åœ¨å…¶ä¸­ä¹‹ä¸€çš„æ–¹æ³•ä¸­æ·»åŠ ä¸€ä¸ªä¸´æ—¶çš„ <code>&quot;say 'Hello';&quot;</code> è¯­å¥, ä»…ä»…æ˜¯ä¸ºäº†ç¡®è®¤å®ƒä»¬æ­£è¢«è°ƒç”¨ã€‚è¿™æ˜¯æ­£åˆ™å¼•æ“æ­£åœ¨å·¥ä½œå¹¶ä¸”å¯èƒ½æ­£è§£æå®ƒæ‰€ going over çš„ä¸€ä¸ªé‡è¦è¯æ®ã€‚ ä½ ç”šè‡³å¯ä»¥ä½¿ç”¨æŸäº›æˆ‘ä»¬ä¸Šé¢å·²ç»å­¦åˆ°çš„æŠ€å·§ç„¶åå†™ä¸Š ã€Œ<code>say $/&lt;Variable&gt;;</code>ã€ æ¥æŸ¥çœ‹åŒ¹é…æ˜¯å¦æ­£åƒä½ æƒ³çš„é‚£æ ·è¿è¡Œã€‚ç»§ç»­è¿è¡Œå¹¶ç©ç©, åšå®Œçš„æ—¶å€™å†å›åˆ°è¿™å„¿ã€‚</p>
<h2 id="æ··åˆä¿¡å·mixed-signals">æ··åˆä¿¡å·(Mixed Signals)</h2>
<p>æ­£å‘ç”Ÿçš„æ˜¯æ–¹æ³•æ­£è¢«è°ƒç”¨, ä½†æ˜¯å®ƒä»¬çš„è¾“å‡ºè¢«ä¸¢å¼ƒã€‚æˆ‘ä»¬æ¥æ•è·è¾“å‡ºç„¶åä½¿ç”¨ grammar çš„æœ€åä¸€ä¸ªç‰¹æ€§, æŠ½è±¡è¯­æ³•æ ‘ã€‚ç°åœ¨,  è¿™å¯èƒ½ä¼šå‹¾èµ·ååœ¨æ•™å®¤é‡Œçœ‹é»‘æ¿ä¸Šç”»å‡ºçš„ç›’å­å’Œçº¿æ®µçš„åœºæ™¯, ä½†æ˜¯ä¹Ÿæ²¡æœ‰é‚£ä¹ˆç³Ÿç³•äº†ã€‚æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†ä¸€ä¸ª, å®é™…ä¸Š <strong>say()</strong> çš„è¾“å‡ºå°±æ˜¯ä¸€ä¸ª ASTã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸‹å…¶å®ƒè¯­æ³•æ ‘, æˆ‘ä»¬åœ¨åå°åˆ›å»ºçš„é‚£ä¸ªã€‚åœ¨ &ldquo;$javascript.parse(&hellip;)&rdquo; è°ƒç”¨çš„æœ«å°¾æ·»åŠ ä¸Š ã€Œ.astã€, è¿™ä¼šç»™æˆ‘ä»¬å±•ç¤ºæˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„è¯­æ³•æ ‘ã€‚</p>
<p>å¦‚æœä½ è¿™æ ·åšäº†, ä½ ä¼šçœ‹åˆ°å®ƒæ‰“å°äº†(Any), è¿™é€šå¸¸ç­‰ä»·äºã€ŒåŒ¹é…å¤±è´¥ã€, å•æ˜¯æˆ‘ä»¬ä»ä¹‹å‰çš„æµ‹è¯•ä¸­çŸ¥é“åŒ¹é…æ²¡æœ‰å¤±è´¥ã€‚æ‰€ä»¥è¿™å„¿å‘ç”Ÿäº†ä»€ä¹ˆ? å½“æˆ‘ä»¬çš„æ–¹æ³•è¿è¡Œçš„æ—¶å€™, å®ƒä»¬è¿”å›è¾“å‡º, ä½†æ˜¯ Raku ä¸çŸ¥é“æ€ä¹ˆå¤„ç†è¿™äº›è¾“å‡º, æˆ–è€…è¯´å®ƒä¸çŸ¥é“æŠŠè¾“å‡ºå®‰è£…åˆ°å®ƒæ‰€åˆ›å»ºçš„ AST ä¸­çš„å“ªä¸ªä½ç½®ã€‚</p>
<p>å…³é”®æ˜¯ä¸€ä¸ªå«åšã€Œmakeã€çš„å°ä¸œè¥¿ã€‚åœ¨æ–¹æ³•çš„å¼€å¤´, æŠŠè¿™ä¸ªæ·»åŠ åˆ°è¿‡å»æˆ‘ä»¬æ”¾ç½®ã€Œsayã€çš„åœ°æ–¹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Actions</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">Assignment-Expression</span><span class="p">(</span> <span class="nv">$/</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">make</span> <span class="p">&#39;</span><span class="s1">my $</span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Variable</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> = </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Number</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">Function-Call</span><span class="p">(</span> <span class="nv">$/</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">make</span> <span class="p">&#39;</span><span class="s1">say </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">String</span><span class="p">&gt;</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> ~ $</span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Variable</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> ~ </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">String</span><span class="p">&gt;</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">TOP</span><span class="p">(</span> <span class="nv">$/</span> <span class="p">)</span> <span class="p">{</span>
      <span class="k">make</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Assignment-Expression</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">ast</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Function-Call</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">ast</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>è¿˜æœ‰, å› ä¸º Raku ä¸ºæˆ‘ä»¬è°ƒç”¨æ–¹æ³•, æˆ‘ä»¬ä¸éœ€è¦è‡ªå·±æ¥è°ƒç”¨ <code>self.Function-Call(...)</code>, æˆ‘ä»¬éœ€è¦åšçš„å…¨éƒ¨å·¥ä½œå°±æ˜¯æŸ¥çœ‹ <code>Function-Call(...)</code> è¿”å›ç»™æˆ‘ä»¬çš„è¯­æ³•æ ‘ã€‚æœ€ç»ˆæˆ‘ä»¬åšåˆ°äº†ã€‚ä¸€ä¸ªå®Œæ•´, è™½ç„¶å¾®å°çš„ç¼–è¯‘å™¨ã€‚ä¸ºäº†é˜²æ­¢ä½ åœ¨ç¼–è¾‘æ—¶è¿·å¤±, è¿™å„¿æœ‰ä¸€ä¸ªæœ€ç»ˆçš„ç»“æœã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">grammar</span> <span class="nc">JavaScript</span> <span class="p">{</span>
    <span class="k">rule</span> <span class="nf">Number</span>                <span class="p">{</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="sr">                                                          </span><span class="p">};</span>
    <span class="k">rule</span> <span class="nf">Variable</span>              <span class="p">{</span><span class="sr"> </span><span class="se">\w</span><span class="o">+</span><span class="sr">                                                          </span><span class="p">};</span>
    <span class="k">rule</span> <span class="nf">String</span>                <span class="p">{</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">&#34;</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">-</span><span class="p">[</span><span class="sr"> &#34; </span><span class="p">]&gt;</span><span class="o">+</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">&#34;</span><span class="p">&#39;</span><span class="sr">                                            </span><span class="p">};</span>
    <span class="k">rule</span> <span class="nf">Assignment-Expression</span> <span class="p">{</span><span class="sr"> var </span><span class="p">&lt;</span><span class="nf">Variable</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Number</span><span class="p">&gt;</span><span class="sr">                                  </span><span class="p">};</span>
    <span class="k">rule</span> <span class="nf">Function-Call</span>         <span class="p">{</span><span class="sr"> console </span><span class="p">&#39;</span><span class="s1">.</span><span class="p">&#39;</span><span class="sr"> log </span><span class="p">&#39;</span><span class="s1">(</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">String</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Variable</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">String</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">)</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">};</span>
    <span class="k">rule</span> <span class="nf">TOP</span>                   <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Assignment-Expression</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">Function-Call</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span><span class="sr">              </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Actions</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">Assignment-Expression</span><span class="p">(</span> <span class="nv">$/</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">make</span> <span class="p">&#39;</span><span class="s1">my $</span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Variable</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> = </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Number</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">Function-Call</span><span class="p">(</span> <span class="nv">$/</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">make</span> <span class="p">&#39;</span><span class="s1">say </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">String</span><span class="p">&gt;</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> ~ $</span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Variable</span><span class="p">&gt;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> ~ </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">String</span><span class="p">&gt;</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;;</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">TOP</span><span class="p">(</span> <span class="nv">$/</span> <span class="p">)</span> <span class="p">{</span>
        <span class="k">make</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Assignment-Expression</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">ast</span> <span class="o">~</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">Function-Call</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">ast</span> 
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$j</span> <span class="o">=</span> <span class="n">JavaScript</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="n">Actions</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$j</span><span class="o">.</span><span class="nb">parse</span><span class="p">(</span>
   <span class="p">&#39;</span><span class="s1">var a = 3; console.log( &#34;Hey, did you know a = &#34; + a + &#34;?&#34; );</span><span class="p">&#39;</span><span class="o">,</span>
   <span class="p">:</span><span class="s">actions</span><span class="p">(</span><span class="nv">$a</span><span class="p">))</span><span class="o">.</span><span class="nb">ast</span><span class="p">;</span>
</code></pre></div><h2 id="åˆ°å“ªé‡Œå»">åˆ°å“ªé‡Œå»</h2>
<p>ä¸€ä¸ªç®€å•ä½†æ•´æ´çš„æ›´æ”¹æ˜¯ä½ å¯ä»¥æ‰©å±• Assignment-Expression æ¥æ—¢æ¥æ”¶æ•°å­—åˆæ¥æ”¶å­—ç¬¦ä¸²ã€‚ä¸Šæ¬¡æˆ‘ä»¬è°ˆè®ºäº† rules ä¸­çš„è½®è¯•,æ‰€ä»¥è¿™ä¸ªæç¤ºåº”è¯¥è¶³å¤Ÿè®©ä½ å¼€å§‹äº†:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">rule</span> <span class="nf">Assignment-Expression</span> <span class="p">{</span><span class="sr"> var </span><span class="p">&lt;</span><span class="nf">Variable</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">(&lt;</span><span class="nf">Number</span><span class="p">&gt;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">String</span><span class="p">&gt;)</span><span class="sr"> }
</span></code></pre></div><p>ä½ å¿…é¡»ä¿®æ”¹ä¸‹ Assignment-Expression æ–¹æ³•ä»¥ä½¿å®ƒèµ·ä½œç”¨ã€‚æˆ–è€…ä½ å¯ä»¥ç‹¡çŒ¾ä¸€ç‚¹ç„¶åå‘ç°( <code>&lt;Number&gt; | &lt;String&gt;</code> ) å¯ä»¥è½¬æ¢ä¸ºå®ƒè‡ªå·±çš„å°çš„æ™®é€šçš„ &ldquo;Term&rdquo; rule, &ldquo;rule Term { <!-- raw HTML omitted --> | <!-- raw HTML omitted --> }&rdquo;, ç„¶åæ·»åŠ ä¸€ä¸ª action &ldquo;method Term($/) { make $/<!-- raw HTML omitted --> or $/<!-- raw HTML omitted -->}&rdquo; è€Œåªåœ¨ Assignment-Expression ä¸­ä¿®æ”¹ä¸€ä¸ªä¸œè¥¿ã€‚</p>
<p><a href="http://theperlfisher.blogspot.fr/2016/02/from-regular-expressions-to-grammars-pt_28.html">http://theperlfisher.blogspot.fr/2016/02/from-regular-expressions-to-grammars-pt_28.html</a></p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/regex" term="regex" label="regex" />
                             
                                <category scheme="https://ohmyweekly.github.io/tags/grammar" term="grammar" label="grammar" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[ä»¥æŒ‡å®šéŸ³é‡éšæœºæ’­æ”¾éŸ³é¢‘æ–‡ä»¶]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-06-14-play-audio-at-given-volume/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2015-04-27-from-regex-to-grammar-part-one/?utm_source=atom_feed" rel="related" type="text/html" title="ä»æ­£åˆ™è¡¨è¾¾å¼åˆ° Grammar(ç¬¬ä¸€éƒ¨åˆ†)" />
                <link href="https://ohmyweekly.github.io/notes/2015-10-29-from-regex-to-grammar/?utm_source=atom_feed" rel="related" type="text/html" title="ä»æ­£åˆ™è¡¨è¾¾å¼åˆ° Grammar(ç¬¬äºŒéƒ¨åˆ†)" />
            
                <id>https://ohmyweekly.github.io/notes/2015-06-14-play-audio-at-given-volume/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Play Audio at Given Volume</blockquote><p>ä»¥æŒ‡å®šéŸ³é‡éšæœºæ’­æ”¾éŸ³é¢‘æ–‡ä»¶ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#!/usr/bin/env raku</span>

<span class="k">my</span> <span class="nv">%v</span><span class="p">;</span>                                 <span class="c1"># hash to hold data</span>
<span class="k">my</span> <span class="k">token</span> <span class="nf">filename</span>    <span class="p">{</span><span class="sr"> </span><span class="ni">.</span><span class="o">+?</span><span class="sr"> \</span><span class="ni">.</span><span class="se">\S\S\S</span><span class="sr"> </span><span class="p">};</span> <span class="c1"># filenames end in .???</span>
<span class="k">my</span> <span class="k">token</span> <span class="nf">volume</span>      <span class="p">{</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="sr"> </span><span class="p">};</span>          <span class="c1"># any digits for volume</span>
<span class="k">my</span> <span class="k">regex</span> <span class="nf">extra</span>       <span class="p">{</span><span class="sr"> </span><span class="ni">.</span><span class="o">+</span><span class="sr"> </span><span class="se">\S</span><span class="sr"> </span><span class="p">};</span>        <span class="c1"># anything following that</span>
<span class="k">my</span> <span class="nv">$mixer</span>          <span class="o">=</span> <span class="p">&#39;</span><span class="s1">mixer</span><span class="p">&#39;;</span>
<span class="k">my</span> <span class="nv">$player</span>         <span class="o">=</span> <span class="p">&#39;</span><span class="s1">mplayer -vf dsize=600:-2 -geometry +200-10 </span><span class="p">&#39;;</span>
<span class="k">my</span> <span class="nv">$lockfile</span>       <span class="o">=</span> <span class="p">&#39;</span><span class="s1">/tmp/myplayer</span><span class="p">&#39;;</span>

<span class="nv">$lockfile</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">spurt</span><span class="p">(</span> <span class="vg">$*PID</span> <span class="p">);</span>          <span class="c1"># store the process ID so other process can kill this one</span>
<span class="k">END</span> <span class="p">{</span> <span class="nv">$lockfile</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">unlink</span><span class="p">;</span> <span class="p">}</span>          <span class="c1"># remove the lockfile at end</span>

<span class="k">for</span> <span class="nv">$=finish</span><span class="o">.</span><span class="nb">lines</span> <span class="p">{</span>                  <span class="c1"># loop through the lines below &#39;=begin finish&#39;</span>
    <span class="nb">last</span> <span class="k">if</span> <span class="o">/</span><span class="n">STOP</span><span class="o">/</span><span class="p">;</span>                   <span class="c1"># stop at a STOP line</span>
    <span class="k">if</span> <span class="k">m</span><span class="p">/</span><span class="sr">     </span><span class="p">(&lt;</span><span class="nf">filename</span><span class="p">&gt;)</span><span class="sr">
</span><span class="sr">          </span><span class="se">\s</span><span class="o">+</span><span class="sr"> </span><span class="p">(&lt;</span><span class="nf">volume</span><span class="p">&gt;)</span><span class="sr">
</span><span class="sr">          </span><span class="se">\s</span><span class="o">*</span><span class="sr"> </span><span class="p">(&lt;</span><span class="nf">extra</span><span class="p">&gt;</span><span class="o">?</span><span class="p">)</span><span class="sr"> </span><span class="p">/</span> <span class="p">{</span>          <span class="c1"># use the regexes/tokens</span>
        <span class="k">my</span> <span class="p">(</span> <span class="nv">$m</span><span class="o">,</span> <span class="nv">$v</span><span class="o">,</span> <span class="nv">$e</span> <span class="p">)</span> <span class="o">=</span> <span class="nv">$/</span><span class="o">[</span><span class="mi">0</span><span class="o">..</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span> <span class="c1"># get captured values from $/</span>
        <span class="k">if</span> <span class="nv">$m</span> <span class="ow">and</span> <span class="nv">$v</span> <span class="p">{</span>                <span class="c1"># if there&#39;s a filename and volume</span>
            <span class="nv">%v</span><span class="p">{</span><span class="nv">$m</span><span class="p">}&lt;</span><span class="s">v</span><span class="p">&gt;</span> <span class="o">~=</span> <span class="nv">$v</span><span class="p">;</span>          <span class="c1">#   store it in the hash</span>
            <span class="nv">%v</span><span class="p">{</span><span class="nv">$m</span><span class="p">}&lt;</span><span class="s">e</span><span class="p">&gt;</span> <span class="o">~=</span> <span class="nv">$e</span> <span class="o">//</span> <span class="p">&#39;&#39;;</span>    <span class="c1">#   with any extra arguments</span>
        <span class="p">}}}</span> <span class="c1"># lisp-y to save lines</span>

<span class="k">for</span> <span class="nv">%v</span><span class="o">.</span><span class="nb">keys</span><span class="o">.</span><span class="nb">pick</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nv">$m</span> <span class="p">{</span>           <span class="c1"># loop randomly through keys</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Playing </span><span class="nv">$m</span><span class="p">&#34;;</span>
    <span class="nb">print</span> <span class="k">qq</span><span class="sa">x</span><span class="p">{</span><span class="s2"> </span><span class="nv">$mixer</span><span class="s2">  </span><span class="nv">%v</span><span class="p">{</span><span class="nv">$m</span><span class="p">}&lt;</span><span class="s">v</span><span class="p">&gt;</span><span class="s2">      </span><span class="p">};</span>  <span class="c1"># set the volume</span>
    <span class="nb">print</span> <span class="k">qq</span><span class="sa">x</span><span class="p">{</span><span class="s2"> </span><span class="nv">$player</span><span class="s2"> </span><span class="nv">%v</span><span class="p">{</span><span class="nv">$m</span><span class="p">}&lt;</span><span class="s">e</span><span class="p">&gt;</span><span class="s2"> &#34;</span><span class="nv">$m</span><span class="s2">&#34; </span><span class="p">};</span>  <span class="c1"># play the file</span>
<span class="p">}</span>

<span class="k">=begin</span><span class="sd"> </span><span class="k">finish</span><span class="sd">
</span><span class="sd">300.avi 77
</span><span class="sd">Crystal Skull Rifftrax.avi 77 -aid 2
</span><span class="sd">Star Trek 5.avi 77
</span><span class="sd">Star Trek 7.avi
</span><span class="sd">aeon-flux.avi 93
</span><span class="sd"></span><span class="k">=end finish</span></code></pre></div><p>æ”¹è¿›ç‰ˆï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#! /usr/bin/env raku</span>

<span class="k">my</span> <span class="nv">@mixer</span>    <span class="o">=</span> <span class="p">&#39;</span><span class="s1">mixer</span><span class="p">&#39;;</span>
<span class="k">my</span> <span class="nv">@player</span>   <span class="o">=</span> <span class="p">&lt;</span><span class="s"> m6player -vf dsize=600:-2 -geometry +200-10 </span><span class="p">&gt;;</span>
<span class="k">my</span> <span class="nv">$lockfile</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">/tmp/myplayer</span><span class="p">&#39;;</span>

<span class="nv">$lockfile</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">spurt</span><span class="p">(</span> <span class="vg">$*PID</span> <span class="p">);</span>

<span class="k">END</span> <span class="p">{</span> <span class="nv">$lockfile</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">unlink</span><span class="p">;</span> <span class="p">}</span>

<span class="k">my</span> <span class="k">token</span> <span class="nf">filename</span>    <span class="p">{</span><span class="sr"> </span><span class="ni">.</span><span class="o">+?</span><span class="sr"> \</span><span class="ni">.</span><span class="se">\S\S\S</span><span class="sr"> </span><span class="p">};</span>
<span class="k">my</span> <span class="k">token</span> <span class="nf">volume</span>      <span class="p">{</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="sr"> </span><span class="p">};</span>
<span class="k">my</span> <span class="k">regex</span> <span class="nf">extra</span>       <span class="p">{</span><span class="sr"> </span><span class="ni">.</span><span class="o">*</span><span class="sr"> </span><span class="p">};</span>

<span class="k">my</span> <span class="nv">%song-data</span><span class="p">;</span>

<span class="k">for</span> <span class="nv">$=finish</span><span class="o">.</span><span class="nb">lines</span> <span class="p">{</span>
    <span class="nb">last</span> <span class="k">if</span> <span class="o">/^</span> \<span class="k">s</span><span class="p">*</span><span class="sr"> STOP </span><span class="se">\s</span><span class="p">*</span><span class="s2"> $/;
</span><span class="s2">    next unless  m/ \s</span><span class="p">*</span> <span class="p">&lt;</span><span class="s">filename</span><span class="p">&gt;</span> \<span class="k">s</span><span class="err">+</span> <span class="p">&lt;</span><span class="sr">volume</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="s">extra</span><span class="p">&gt;</span> <span class="o">/</span><span class="p">;</span>
    <span class="c1"># $&lt;extra&gt; is short for $/{&#39;extra&#39;}</span>
    <span class="nv">%song-data</span><span class="p">{</span><span class="o">~</span><span class="nv">$&lt;filename&gt;</span><span class="p">}&lt;</span><span class="s">v e</span><span class="p">&gt;</span> <span class="o">=</span> <span class="o">+</span><span class="nv">$&lt;volume&gt;</span><span class="o">,</span> <span class="o">[</span><span class="nv">$&lt;extra&gt;</span><span class="o">.</span><span class="nb">words</span><span class="o">]</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># uses sub-signature unpacking</span>
<span class="k">for</span> <span class="nv">%song-data</span><span class="o">.</span><span class="nb">pick</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="p">(</span> <span class="p">:</span><span class="s">key</span><span class="p">(</span><span class="nv">$m</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">value</span><span class="p">(</span><span class="nv">$</span><span class="p">)</span> <span class="p">(</span><span class="o">:</span><span class="nv">$v</span><span class="o">,:</span><span class="nv">@e</span><span class="p">))</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Playing </span><span class="nv">$m</span><span class="p">&#34;;</span>
    <span class="nb">print</span> <span class="nb">run</span><span class="p">(</span> <span class="nv">@mixer</span><span class="o">,</span>  <span class="nv">$v</span><span class="o">,</span>     <span class="p">:</span><span class="s">out</span> <span class="p">)</span><span class="o">.</span><span class="nf">out</span><span class="o">.</span><span class="nb">slurp-rest</span><span class="o">.</span><span class="nb">indent</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
    <span class="nb">print</span> <span class="nb">run</span><span class="p">(</span> <span class="nv">@player</span><span class="o">,</span> <span class="nv">@e</span><span class="o">,</span> <span class="nv">$m</span><span class="o">,</span> <span class="p">:</span><span class="s">out</span> <span class="p">)</span><span class="o">.</span><span class="nf">out</span><span class="o">.</span><span class="nb">slurp-rest</span><span class="o">.</span><span class="nb">indent</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">=begin</span><span class="sd"> </span><span class="k">finish</span><span class="sd">
</span><span class="sd">300.avi 77
</span><span class="sd">Crystal Skull Rifftrax.avi 77 -aid 2
</span><span class="sd">Star Trek 5.avi 77
</span><span class="sd">Star Trek 7.avi
</span><span class="sd">aeon-flux.avi 93
</span><span class="sd"></span><span class="k">=end finish</span></code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/regex" term="regex" label="regex" />
                             
                                <category scheme="https://ohmyweekly.github.io/tags/audio" term="audio" label="audio" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[ä½¿ç”¨ Grammar è§£ææ–‡æœ¬: ä¸€ä¸ªä¾‹å­]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-07-11-an-example-of-parsing-text-in-grammar/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2015-11-16-a-mutable-grammar-for-raku/?utm_source=atom_feed" rel="related" type="text/html" title="A Mutable Grammar for Raku" />
                <link href="https://ohmyweekly.github.io/notes/2016-02-05-raku-grammars/?utm_source=atom_feed" rel="related" type="text/html" title="Raku Grammars" />
                <link href="https://ohmyweekly.github.io/notes/2016-01-01-raku-core-hacking-grammatical-babble/?utm_source=atom_feed" rel="related" type="text/html" title="Raku æ ¸å¿ƒé­”æ”¹: Grammar çš„èƒ¡è¨€ä¹±è¯­" />
                <link href="https://ohmyweekly.github.io/notes/2015-04-27-from-regex-to-grammar-part-one/?utm_source=atom_feed" rel="related" type="text/html" title="ä»æ­£åˆ™è¡¨è¾¾å¼åˆ° Grammar(ç¬¬ä¸€éƒ¨åˆ†)" />
                <link href="https://ohmyweekly.github.io/notes/2015-10-29-from-regex-to-grammar/?utm_source=atom_feed" rel="related" type="text/html" title="ä»æ­£åˆ™è¡¨è¾¾å¼åˆ° Grammar(ç¬¬äºŒéƒ¨åˆ†)" />
            
                <id>https://ohmyweekly.github.io/notes/2015-07-11-an-example-of-parsing-text-in-grammar/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>An Example of Parsing Text in Grammar</blockquote><ul>
<li>è§£æ<code>[ ]</code> é‡Œé¢çš„æ•°æ®ï¼š</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">use</span> <span class="nn">Grammar::Debugger</span><span class="p">;</span>

<span class="k">grammar</span> <span class="nc">Lines</span> <span class="p">{</span>
    <span class="k">token</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="ni">^</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">line</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="ni">$</span><span class="sr">
</span><span class="sr">    </span><span class="p">}</span>

    <span class="k">token</span> <span class="nf">line</span> <span class="p">{</span><span class="sr">
</span><span class="sr">        \[
</span><span class="sr">        </span><span class="p">&lt;</span><span class="nf">student</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">semicolon</span><span class="p">&gt;</span><span class="sr">
</span><span class="sr">        \]
</span><span class="sr">        </span><span class="se">\n</span><span class="sr">                   </span><span class="c1"># æ¢è¡Œ \n æ˜¯æœ€å®¹æ˜“è¢«å¿½ç•¥çš„åœ°æ–¹
</span><span class="c1"></span><span class="sr">    </span><span class="p">}</span>

    <span class="k">token</span> <span class="nf">student</span> <span class="p">{</span><span class="sr">
</span><span class="sr">       </span><span class="p">&lt;</span><span class="nf">myname</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">comma</span><span class="p">&gt;</span><span class="sr">   </span><span class="c1"># åˆ†éš”ç¬¦ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª subrule
</span><span class="c1"></span><span class="sr">    </span><span class="p">}</span>

    <span class="k">token</span> <span class="nf">myname</span> <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="p">&lt;[</span><span class="sr">A</span><span class="o">..</span><span class="sr">Za</span><span class="o">..</span><span class="sr">z-</span><span class="p">]&gt;</span><span class="o">+</span><span class="sr">       </span><span class="c1"># å­—ç¬¦ç±»çš„å†™æ³• &lt;[...]&gt;
</span><span class="c1"></span><span class="sr">    </span><span class="p">}</span>

    <span class="k">token</span> <span class="nf">comma</span> <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="p">&#39;</span><span class="s1">,</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\s</span><span class="o">+</span><span class="sr">              </span><span class="c1"># é€—å·, åˆ†å· ä¸èƒ½è£¸éœ²å‡ºç°åœ¨ token ä¸­
</span><span class="c1"></span><span class="sr">    </span><span class="p">}</span>

    <span class="k">token</span> <span class="nf">semicolon</span> <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\s</span><span class="o">+</span><span class="sr">
</span><span class="sr">    </span><span class="p">}</span>

<span class="p">}</span>

<span class="k">my</span> <span class="nv">$parse</span> <span class="o">=</span> <span class="n">Lines</span><span class="o">.</span><span class="nb">parsefile</span><span class="p">(&#39;</span><span class="s1">test.txt</span><span class="p">&#39;);</span>
<span class="nb">say</span> <span class="nv">$parse</span><span class="p">;</span>
</code></pre></div><p>test.txt çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code>[Lue, Fan]
[Lou, Man-Li]
[Tian, Mijie; Zhou, Lin; Zou, Xiao; Zheng, Qiaoji; Luo, Lingling; Jiang, Na; Lin, Dunmin]
</code></pre><p>ä¸‹é¢çš„ Grammar ç”¨äºè§£æä¸€ä¸ªå­—ç¬¦ä¸², ç”±äº tokens ä¸èƒ½å›æº¯, æ‰€ä»¥å½“è§£æ <code>$str</code> æ—¶ä½¿ç”¨äº† Grammar çš„ç»§æ‰¿, é‡å†™äº† university è¿™ä¸ª token:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$string</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">[Wang, Zhiguo; Zhao, Zhiguo] Hangzhou Normal Univ, Ctr Cognit &amp; Brain Disorders, Hangzhou, Zhejiang, Peoples R China; [Wang, Zhiguo; Theeuwes, Jan] Vrije Univ Amsterdam, Dept Cognit Psychol, Amsterdam, Netherlands</span><span class="p">&#34;;</span>

<span class="k">grammar</span> <span class="nc">University::Grammar</span> <span class="p">{</span>
    <span class="k">token</span> <span class="nf">TOP</span>             <span class="p">{</span><span class="sr"> </span><span class="ni">^</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">university</span><span class="p">&gt;</span><span class="sr"> </span><span class="ni">$</span><span class="sr">             }
</span><span class="sr">    token university      </span><span class="p">{</span> <span class="o">[</span> <span class="p">&lt;</span><span class="s">bracket</span><span class="p">&gt;</span> <span class="p">&lt;</span><span class="s">info</span><span class="p">&gt;</span> <span class="o">]+</span> <span class="nv">%</span> <span class="p">&#39;</span><span class="s1">; </span><span class="p">&#39;</span> <span class="p">}</span><span class="sr">
</span><span class="sr">    token bracket         </span><span class="p">{</span> <span class="p">&#39;</span><span class="s1">[</span><span class="p">&#39;</span> <span class="p">&lt;</span><span class="s">studentname</span><span class="p">&gt;</span>  <span class="p">&#39;</span><span class="s1">] </span><span class="p">&#39;</span>      <span class="p">}</span><span class="sr">
</span><span class="sr">    token studentname     </span><span class="p">{</span> <span class="p">&lt;</span><span class="s">stdname=.info</span><span class="p">&gt;</span><span class="o">+</span> <span class="nv">%</span> <span class="p">&#39;</span><span class="s1">; </span><span class="p">&#39;</span>      <span class="p">}</span><span class="sr">
</span><span class="sr">    token info            </span><span class="p">{</span> <span class="p">&lt;</span><span class="s">field</span><span class="p">&gt;</span><span class="o">+</span> <span class="nv">%</span> <span class="p">&#39;</span><span class="s1">, </span><span class="p">&#39;</span>              <span class="p">}</span><span class="sr">
</span><span class="sr">    token field           </span><span class="p">{</span> <span class="p">&lt;</span><span class="s">-[,\]\[;\n]</span><span class="p">&gt;</span><span class="o">+</span>               <span class="p">}</span><span class="sr">
</span><span class="sr">}
</span><span class="sr">
</span><span class="sr"></span><span class="c1"># grammar åƒç±»ä¸€æ ·å¯ä»¥ç»§æ‰¿, é‡Œé¢çš„ token å¯ä»¥è¢«é‡å†™
</span><span class="c1"></span><span class="sr">grammar MyUniversity  is University</span><span class="o">:</span><span class="p">:</span><span class="na">Grammar</span><span class="sr"> </span><span class="p">{</span>
    <span class="k">token</span> <span class="nf">university</span>      <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">info</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">; </span><span class="p">&#39;</span><span class="sr"> </span><span class="p">}</span><span class="sr">
</span><span class="sr"></span><span class="p">}</span>

<span class="k">my</span> <span class="nv">$str</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">Zhejiang Univ, Coll Environm &amp; Resources Sci, Dept Resource Sci, Hangzhou 310029, Peoples R China; La Trobe Univ, Dept Agr Sci, Bundoora, Vic 3083, Australia; Hangzhou Normal Coll, Fac Life Sci, Hangzhou, Peoples R China</span><span class="p">&#34;;</span>

<span class="k">my</span> <span class="nv">$parsed</span> <span class="o">=</span> <span class="n">University::Grammar</span><span class="o">.</span><span class="nb">parse</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
<span class="c1"># my $parsed = MyUniversity.parse($str);</span>

<span class="k">for</span> <span class="nv">@</span><span class="p">(</span><span class="nv">$parsed</span><span class="p">&lt;</span><span class="s">university</span><span class="p">&gt;&lt;</span><span class="s">info</span><span class="p">&gt;)</span> <span class="k">-&gt;</span> <span class="nv">$f</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$f</span><span class="p">&lt;</span><span class="s">field</span><span class="p">&gt;</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/grammar" term="grammar" label="grammar" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[ä½¿ç”¨ Grammar è§£ææ—¥æœŸ]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-09-15-use-grammar-to-parse-date/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2015-11-16-a-mutable-grammar-for-raku/?utm_source=atom_feed" rel="related" type="text/html" title="A Mutable Grammar for Raku" />
                <link href="https://ohmyweekly.github.io/notes/2016-02-05-raku-grammars/?utm_source=atom_feed" rel="related" type="text/html" title="Raku Grammars" />
                <link href="https://ohmyweekly.github.io/notes/2016-01-01-raku-core-hacking-grammatical-babble/?utm_source=atom_feed" rel="related" type="text/html" title="Raku æ ¸å¿ƒé­”æ”¹: Grammar çš„èƒ¡è¨€ä¹±è¯­" />
                <link href="https://ohmyweekly.github.io/notes/2015-04-27-from-regex-to-grammar-part-one/?utm_source=atom_feed" rel="related" type="text/html" title="ä»æ­£åˆ™è¡¨è¾¾å¼åˆ° Grammar(ç¬¬ä¸€éƒ¨åˆ†)" />
                <link href="https://ohmyweekly.github.io/notes/2015-10-29-from-regex-to-grammar/?utm_source=atom_feed" rel="related" type="text/html" title="ä»æ­£åˆ™è¡¨è¾¾å¼åˆ° Grammar(ç¬¬äºŒéƒ¨åˆ†)" />
            
                <id>https://ohmyweekly.github.io/notes/2015-09-15-use-grammar-to-parse-date/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Use Grammar to Parse Date</blockquote><h3 id="æè¿°">æè¿°</h3>
<p>ä¸‹é¢çš„æ—¥æœŸ, æœ‰äº›ä½¿ç”¨äº† <code>M D Y</code> æ ¼å¼, æœ‰äº›ä½¿ç”¨äº† <code>Y M D</code> æ ¼å¼, è¿˜ä½¿ç”¨äº†ä»»æ„åˆ†éš”ç¬¦! è¯·æŠŠè¿™äº›æ•£ä¹±çš„æ–‡æœ¬è§£ææˆåˆé€‚çš„ ISO 8601 (<code>YYYY-MM-DD</code>) æ ¼å¼åŒ–æ—¥æœŸã€‚</p>
<p>å‡è®¾åªæœ‰ä»¥ 4 ä¸ªæ•°å­—å¼€å¤´çš„æ—¥æœŸä½¿ç”¨ <code>Y M D</code> æ ¼å¼, å…¶å®ƒçš„ä½¿ç”¨ <code>M D Y</code> æ ¼å¼ã€‚</p>
<h3 id="è¾“å…¥æ ·æœ¬">è¾“å…¥æ ·æœ¬</h3>
<pre><code>2/13/15
1-31-10
5 10 2015
2012 3 17
2001-01-01
2008/01/07
</code></pre><h3 id="è¾“å‡ºæ ·æœ¬">è¾“å‡ºæ ·æœ¬</h3>
<pre><code>2015-02-13
2010-01-31
2015-05-10
2012-03-17
2001-01-01
2008-01-07
</code></pre><h3 id="æ‰©å±•æŒ‘æˆ˜-ä¸­çº§">æ‰©å±•æŒ‘æˆ˜ [ä¸­çº§]</h3>
<p>ä½¿ç”¨ <code>2014-12-24</code> ä½œä¸ºç›¸å¯¹æ—¥æœŸçš„åŸºå‡†ã€‚</p>
<p>å½“æ·»åŠ  <code>days</code>(å¤©æ•°) æ—¶, è¦è€ƒè™‘åˆ°æ¯æœˆä¼šæœ‰ä¸åŒçš„å¤©æ•°, å¿½ç•¥é—°å¹´ã€‚</p>
<p>å½“æ·»åŠ æœˆå’Œå¹´æ—¶, ä½¿ç”¨æ•´ä¸ª <code>units</code>, ä»¥è‡³äº:</p>
<p>one month before october 10 is september 10</p>
<p>one year after 2001-04-02 is 2002-04-02</p>
<p>one month after january 30 is february 28 (not march 1)</p>
<h3 id="sallys-inputs">Sally&rsquo;s inputs:</h3>
<pre><code>tomorrow
2010-dec-7
OCT 23
1 week ago
next Monday
last sunDAY
1 year ago
1 month ago
last week
LAST MONTH
10 October 2010
an year ago
2 years from tomoRRow
1 month from 2016-01-31
4 DAYS FROM today
9 weeks from yesterday
</code></pre><h3 id="sallys-expected-outputs">Sally&rsquo;s expected outputs:</h3>
<pre><code>2014-12-25
2010-12-01
2014-10-23
2014-12-17
2014-12-29
2014-12-21
2013-12-24
2014-11-24
2014-12-15
2014-11-24
2010-10-10
2013-12-24
2016-12-25
2016-02-28
2014-12-28
2015-02-25
</code></pre><p>smls å¤§ç¥ç»™å‡ºäº†å®Œæ•´çš„ grammarï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$today</span> <span class="o">=</span> <span class="nb">Date</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="mi">2014</span><span class="o">,</span> <span class="mi">12</span><span class="o">,</span> <span class="mi">24</span><span class="p">);</span>

<span class="k">grammar</span> <span class="nc">MessyDate</span> <span class="p">{</span>
    <span class="k">rule</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr">    </span><span class="p">&lt;</span><span class="nf">date</span><span class="p">&gt;</span><span class="sr">                 </span><span class="p">{</span> <span class="k">make</span> <span class="nv">$&lt;date&gt;</span><span class="o">.</span><span class="k">made</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">duration</span><span class="p">&gt;</span><span class="sr"> ago         </span><span class="p">{</span> <span class="k">make</span> <span class="nv">$today</span><span class="o">.</span><span class="nb">earlier</span><span class="o">:</span> <span class="o">|</span><span class="nv">$&lt;duration&gt;</span><span class="o">.</span><span class="k">made</span>     <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">duration</span><span class="p">&gt;</span><span class="sr"> from </span><span class="p">&lt;</span><span class="nf">date</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">{</span> <span class="k">make</span> <span class="nv">$&lt;date&gt;</span><span class="o">.</span><span class="k">made</span><span class="o">.</span><span class="nb">later</span><span class="o">:</span> <span class="o">|</span><span class="nv">$&lt;duration&gt;</span><span class="o">.</span><span class="k">made</span> <span class="p">}</span><span class="sr">
</span><span class="sr">    </span><span class="p">}</span>

    <span class="k">rule</span> <span class="nf">date</span> <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">[</span><span class="sr"> </span><span class="o">||</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">month</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">(&lt;</span><span class="nf">sep</span><span class="p">&gt;</span><span class="o">?</span><span class="p">)</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">day</span><span class="p">&gt;</span><span class="sr">   </span><span class="p">[</span><span class="nv">$0</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">year</span><span class="p">&gt;]</span><span class="o">?</span><span class="sr">
</span><span class="sr">            </span><span class="o">||</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">day</span><span class="p">&gt;</span><span class="sr">   </span><span class="p">(&lt;</span><span class="nf">sep</span><span class="p">&gt;</span><span class="o">?</span><span class="p">)</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">month</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">[</span><span class="nv">$0</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">year</span><span class="p">&gt;]</span><span class="o">?</span><span class="sr">
</span><span class="sr">            </span><span class="o">||</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">year</span><span class="p">&gt;</span><span class="sr">  </span><span class="p">(&lt;</span><span class="nf">sep</span><span class="p">&gt;</span><span class="o">?</span><span class="p">)</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">month</span><span class="p">&gt;</span><span class="sr">  </span><span class="nv">$0</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">day</span><span class="p">&gt;</span><span class="sr">    </span><span class="p">]</span><span class="sr">
</span><span class="sr">          </span><span class="p">{</span> <span class="k">make</span> <span class="nb">Date</span><span class="o">.</span><span class="nb">new</span><span class="o">:</span> <span class="nv">$&lt;year&gt;</span><span class="o">.</span><span class="k">made</span><span class="o">//</span><span class="nv">$today</span><span class="o">.</span><span class="nb">year</span><span class="o">,</span> <span class="o">|</span><span class="nv">$&lt;month day&gt;</span><span class="o">Â».</span><span class="k">made</span> <span class="p">}</span><span class="sr">
</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> today          </span><span class="p">{</span> <span class="k">make</span> <span class="nv">$today</span>     <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> yesterday      </span><span class="p">{</span> <span class="k">make</span> <span class="nv">$today</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> tomorrow       </span><span class="p">{</span> <span class="k">make</span> <span class="nv">$today</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> last </span><span class="p">&lt;</span><span class="nf">weekday</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">{</span> <span class="k">make</span> <span class="nv">$today</span> <span class="o">-</span> <span class="p">(</span><span class="nv">$today</span><span class="o">.</span><span class="nb">day-of-week</span> <span class="o">-</span> <span class="nv">$&lt;weekday&gt;</span><span class="o">.</span><span class="k">made</span><span class="p">)</span> <span class="nv">%</span> <span class="mi">7</span> <span class="o">||</span> <span class="mi">7</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> next </span><span class="p">&lt;</span><span class="nf">weekday</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">{</span> <span class="k">make</span> <span class="nv">$today</span> <span class="o">+</span> <span class="p">(</span><span class="nv">$&lt;weekday&gt;</span><span class="o">.</span><span class="k">made</span> <span class="o">-</span> <span class="nv">$today</span><span class="o">.</span><span class="nb">day-of-week</span><span class="p">)</span> <span class="nv">%</span> <span class="mi">7</span> <span class="o">||</span> <span class="mi">7</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> last </span><span class="p">&lt;</span><span class="nf">unit</span><span class="p">&gt;</span><span class="sr">    </span><span class="p">{</span> <span class="k">make</span> <span class="nv">$today</span><span class="o">.</span><span class="nb">earlier</span><span class="o">:</span> <span class="o">|</span><span class="p">(</span><span class="nv">$&lt;unit&gt;</span><span class="o">.</span><span class="s">made</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> next </span><span class="p">&lt;</span><span class="nf">unit</span><span class="p">&gt;</span><span class="sr">    </span><span class="p">{</span> <span class="k">make</span> <span class="nv">$today</span><span class="o">.</span><span class="nb">later</span><span class="o">:</span>   <span class="o">|</span><span class="p">(</span><span class="nv">$&lt;unit&gt;</span><span class="o">.</span><span class="s">made</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">}</span><span class="sr">
</span><span class="sr">    </span><span class="p">}</span>

    <span class="k">rule</span> <span class="nf">duration</span> <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="p">&lt;</span><span class="nf">count</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">unit</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">{</span> <span class="k">make</span> <span class="nv">$&lt;unit&gt;</span><span class="o">.</span><span class="s">made</span> <span class="o">=&gt;</span> <span class="nv">$&lt;count&gt;</span><span class="o">.</span><span class="k">made</span> <span class="p">}</span><span class="sr">
</span><span class="sr">    </span><span class="p">}</span>

    <span class="k">token</span> <span class="nf">year</span> <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">number</span><span class="p">(</span><span class="mi">4</span><span class="p">)&gt;</span><span class="sr">        </span><span class="p">{</span> <span class="k">make</span> <span class="o">+</span><span class="nv">$&lt;number&gt;</span>       <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">number</span><span class="p">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">..</span><span class="mi">49</span><span class="p">)&gt;</span><span class="sr"> </span><span class="p">{</span> <span class="k">make</span> <span class="mi">2000</span> <span class="o">+</span> <span class="nv">$&lt;number&gt;</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">number</span><span class="p">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">50</span><span class="o">..*</span><span class="p">)&gt;</span><span class="sr"> </span><span class="p">{</span> <span class="k">make</span> <span class="mi">1900</span> <span class="o">+</span> <span class="nv">$&lt;number&gt;</span> <span class="p">}</span><span class="sr">
</span><span class="sr">    </span><span class="p">}</span>

    <span class="k">token</span> <span class="nf">month</span> <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">number</span><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">..</span><span class="mi">12</span><span class="p">)&gt;</span><span class="sr"> </span><span class="p">{</span> <span class="k">make</span> <span class="o">+</span><span class="nv">$&lt;number&gt;</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> Jan</span><span class="p">[</span><span class="sr">uary</span><span class="p">]</span><span class="o">?</span><span class="sr">   </span><span class="p">{</span> <span class="k">make</span>  <span class="mi">1</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> Feb</span><span class="p">[</span><span class="sr">ruary</span><span class="p">]</span><span class="o">?</span><span class="sr">  </span><span class="p">{</span> <span class="k">make</span>  <span class="mi">2</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> Mar</span><span class="p">[</span><span class="sr">ch</span><span class="p">]</span><span class="o">?</span><span class="sr">     </span><span class="p">{</span> <span class="k">make</span>  <span class="mi">3</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> Apr</span><span class="p">[</span><span class="sr">il</span><span class="p">]</span><span class="o">?</span><span class="sr">     </span><span class="p">{</span> <span class="k">make</span>  <span class="mi">4</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> May          </span><span class="p">{</span> <span class="k">make</span>  <span class="mi">5</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> Jun</span><span class="p">[</span><span class="sr">e</span><span class="p">]</span><span class="o">?</span><span class="sr">      </span><span class="p">{</span> <span class="k">make</span>  <span class="mi">6</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> Jul</span><span class="p">[</span><span class="sr">y</span><span class="p">]</span><span class="o">?</span><span class="sr">      </span><span class="p">{</span> <span class="k">make</span>  <span class="mi">7</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> Aug</span><span class="p">[</span><span class="sr">ust</span><span class="p">]</span><span class="o">?</span><span class="sr">    </span><span class="p">{</span> <span class="k">make</span>  <span class="mi">8</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> Sep</span><span class="p">[</span><span class="sr">tember</span><span class="p">]</span><span class="o">?</span><span class="sr"> </span><span class="p">{</span> <span class="k">make</span>  <span class="mi">9</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> Oct</span><span class="p">[</span><span class="sr">ober</span><span class="p">]</span><span class="o">?</span><span class="sr">   </span><span class="p">{</span> <span class="k">make</span> <span class="mi">10</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> Nov</span><span class="p">[</span><span class="sr">ember</span><span class="p">]</span><span class="o">?</span><span class="sr">  </span><span class="p">{</span> <span class="k">make</span> <span class="mi">11</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> Dec</span><span class="p">[</span><span class="sr">ember</span><span class="p">]</span><span class="o">?</span><span class="sr">  </span><span class="p">{</span> <span class="k">make</span> <span class="mi">12</span> <span class="p">}</span><span class="sr">
</span><span class="sr">    </span><span class="p">}</span>

    <span class="k">token</span> <span class="nf">day</span> <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">number</span><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">..</span><span class="mi">31</span><span class="p">)&gt;</span><span class="sr"> </span><span class="p">{</span> <span class="k">make</span> <span class="o">+</span><span class="nv">$&lt;number&gt;</span> <span class="p">}</span><span class="sr"> </span><span class="p">}</span>

    <span class="k">token</span> <span class="nf">weekday</span> <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> Mon</span><span class="p">[</span><span class="sr">day</span><span class="p">]</span><span class="o">?</span><span class="sr">    </span><span class="p">{</span> <span class="k">make</span> <span class="mi">1</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> Tue</span><span class="p">[</span><span class="sr">sday</span><span class="p">]</span><span class="o">?</span><span class="sr">   </span><span class="p">{</span> <span class="k">make</span> <span class="mi">2</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> Wed</span><span class="p">[</span><span class="sr">nesday</span><span class="p">]</span><span class="o">?</span><span class="sr"> </span><span class="p">{</span> <span class="k">make</span> <span class="mi">3</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> Thu</span><span class="p">[</span><span class="sr">rsday</span><span class="p">]</span><span class="o">?</span><span class="sr">  </span><span class="p">{</span> <span class="k">make</span> <span class="mi">4</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> Fri</span><span class="p">[</span><span class="sr">day</span><span class="p">]</span><span class="o">?</span><span class="sr">    </span><span class="p">{</span> <span class="k">make</span> <span class="mi">5</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> Sat</span><span class="p">[</span><span class="sr">urday</span><span class="p">]</span><span class="o">?</span><span class="sr">  </span><span class="p">{</span> <span class="k">make</span> <span class="mi">6</span> <span class="p">}</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> Sun</span><span class="p">[</span><span class="sr">day</span><span class="p">]</span><span class="o">?</span><span class="sr">    </span><span class="p">{</span> <span class="k">make</span> <span class="mi">7</span> <span class="p">}</span><span class="sr">
</span><span class="sr">    </span><span class="p">}</span>

    <span class="k">token</span> <span class="nf">sep</span>   <span class="p">{</span><span class="sr"> </span><span class="p">&lt;[</span><span class="sr">-/.</span><span class="se">\h</span><span class="p">]&gt;</span><span class="sr"> </span><span class="p">}</span> 
    <span class="k">token</span> <span class="nf">count</span> <span class="p">{</span><span class="sr"> </span><span class="p">(&lt;[</span><span class="mi">0</span><span class="o">..</span><span class="mi">9</span><span class="p">]&gt;</span><span class="o">+</span><span class="p">)</span><span class="sr"> </span><span class="p">{</span> <span class="k">make</span> <span class="o">+</span><span class="nv">$0</span> <span class="p">}</span><span class="sr">  </span><span class="o">|</span><span class="sr">  an</span><span class="o">?</span><span class="sr"> </span><span class="p">{</span> <span class="k">make</span> <span class="mi">1</span> <span class="p">}</span><span class="sr"> </span><span class="p">}</span>
    <span class="k">token</span> <span class="nf">unit</span>  <span class="p">{</span><span class="sr"> </span><span class="p">:</span><span class="na">i</span><span class="sr"> </span><span class="p">(</span><span class="sr">day</span><span class="o">|</span><span class="sr">week</span><span class="o">|</span><span class="sr">month</span><span class="o">|</span><span class="sr">year</span><span class="p">)</span><span class="sr"> s</span><span class="o">?</span><span class="sr"> </span><span class="p">{</span> <span class="k">make</span> <span class="nv">$0</span><span class="o">.</span><span class="nb">lc</span> <span class="p">}</span><span class="sr"> }
</span><span class="sr">
</span><span class="sr">    multi token number </span><span class="p">(</span><span class="nv">$digits</span><span class="p">)</span><span class="sr">        </span><span class="p">{</span>  <span class="p">&lt;</span><span class="s">[0..9]</span><span class="p">&gt;</span> <span class="o">**</span> <span class="p">{</span><span class="nv">$digits</span><span class="p">}</span><span class="sr"> }
</span><span class="sr">    multi token number </span><span class="p">(</span><span class="nv">$digits</span><span class="sr">, </span><span class="nv">$test</span><span class="p">)</span><span class="sr"> </span><span class="p">{</span> <span class="p">(&lt;</span><span class="s">[0..9]</span><span class="p">&gt;</span> <span class="o">**</span> <span class="p">{</span><span class="nv">$digits</span><span class="p">})</span> <span class="o">&lt;?</span><span class="p">{</span> <span class="o">+</span><span class="nv">$0</span> <span class="o">~~</span> <span class="nv">$test</span> <span class="p">}</span><span class="o">&gt;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">for</span> <span class="nb">lines</span><span class="p">()</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="n">MessyDate</span><span class="o">.</span><span class="nb">parse</span><span class="p">(</span><span class="nv">$_</span><span class="p">)</span><span class="o">.</span><span class="k">made</span> <span class="o">//</span> <span class="p">&#34;</span><span class="s2">failed to parse &#39;</span><span class="nv">$_&#39;</span><span class="p">&#34;;</span>
<span class="p">}</span>
</code></pre></div><ul>
<li><code>[...]</code> æ˜¯éæ•è·åˆ†ç»„</li>
<li><code>&lt;[...]&gt;</code> æ˜¯ Raku ä¸­çš„å­—ç¬¦ç±»</li>
<li><code>&lt;number(4)&gt;</code> æ˜¯æ‰©å±•çš„ <code>&lt;...&gt;</code> è¯­æ³•, å®é™…ä¸Šæ˜¯æ–¹æ³•è°ƒç”¨</li>
</ul>
<p>åœ¨ grammar ä¸­, æœ‰ä¸¤ä¸ª regex çš„å˜ä½“, <code>rule</code> å’Œ <code>token</code>ã€‚rule é»˜è®¤ä¸ä¼šå›æº¯ã€‚<code>rule</code> ä¸ <code>token</code> çš„ä¸€ä¸ªé‡è¦åŒºåˆ«æ˜¯, <code>rule</code> è¿™æ ·çš„æ­£åˆ™é‡‡å–äº† <code>:sigspace</code> ä¿®é¥°ç¬¦ã€‚ <code>rule</code> å®é™…ä¸Šæ˜¯</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">regex</span> <span class="p">:</span><span class="s">ratchet</span> <span class="p">:</span><span class="s">sigspace</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div><p>çš„ç®€å†™ã€‚<code>ratchet </code>è¿™ä¸ªå•è¯çš„æ„æ€æ˜¯: (é˜²å€’è½¬çš„)æ£˜é½¿, æ„æ€å®ƒæ˜¯ä¸èƒ½å›æº¯çš„! è€Œ <code>:sigspace</code> è¡¨æ˜æ­£åˆ™ä¸­çš„ç©ºç™½æ˜¯æœ‰æ„ä¹‰çš„, è€Œ <code>token</code> å®é™…ä¸Šæ˜¯:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">regex</span> <span class="p">:</span><span class="s">ratchet</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div><p>çš„ç®€å†™ã€‚ æ‰€ä»¥åœ¨ token ä¸­, è‹¥ä¸æ˜¯æ˜¾å¼çš„å†™ä¸Š <code>\s</code>ã€<code>\h</code>ã€<code>\n</code> ç­‰ç©ºç™½ç¬¦å·, å…¶å®ƒæƒ…å†µä¸‹å°±å¥½åƒç©ºç™½éšèº«äº†ä¸€æ ·, è™½ç„¶ä½ å†™äº†, ä½†æ˜¯ç¼–è¯‘å™¨å´è§†è€Œä¸è§ã€‚</p>
<p><code>//</code> åœ¨å·¦ä¾§åŒ¹é…å¤±è´¥æ—¶ä¼šåœ¨å³ä¾§æä¾›ä¸€ä¸ªé»˜è®¤å€¼ã€‚</p>
<p><code>&lt;number(4)&gt;</code>  å’Œ <code>&lt;number(2, 0..49)&gt;</code> ä¸­ä½¿ç”¨äº†æ‰©å±•äº†çš„ <code>&lt;...&gt;</code> å…ƒè¯­æ³•ã€‚ æ ‡è¯†ç¬¦(ä¾‹å¦‚å·¦é¢çš„ number)åé¢çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å†³å®šäº†é—­åˆå°–æ‹¬å·ä¹‹å‰å‰©ä½™æ–‡æœ¬çš„å¤„ç†ã€‚å®ƒçš„åº•å±‚è¯­ä¹‰æ˜¯å‡½æ•°æˆ–æ–¹æ³•è°ƒç”¨, æ‰€ä»¥, å¦‚æœæ ‡è¯†ç¬¦åé¢çš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯å·¦åœ†æ‹¬å·, é‚£ä¹ˆå®ƒè¦ä¹ˆæ˜¯æ–¹æ³•è°ƒç”¨, è¦ä¹ˆæ˜¯å‡½æ•°è°ƒç”¨:</p>
<p><code>&lt;number(4)&gt;</code> ç­‰ä»·äº <code>&lt;number=&amp;number(4)&gt;</code></p>
<p><code>&lt;number(2, 0..49)&gt;</code> ç­‰ä»·äº <code>&lt;number=&amp;number(2, 0..49)&gt;</code></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">token</span> <span class="nf">number</span> <span class="p">(</span><span class="nv">$digits</span><span class="p">)</span>        <span class="p">{</span><span class="sr">  </span><span class="p">&lt;[</span><span class="mi">0</span><span class="o">..</span><span class="mi">9</span><span class="p">]&gt;</span><span class="sr"> </span><span class="o">**</span><span class="sr"> </span><span class="p">{</span><span class="nv">$digits</span><span class="p">}</span><span class="sr"> </span><span class="p">}</span>
<span class="k">multi</span> <span class="k">token</span> <span class="nf">number</span> <span class="p">(</span><span class="nv">$digits</span><span class="o">,</span> <span class="nv">$test</span><span class="p">)</span> <span class="p">{</span><span class="sr"> </span><span class="p">(&lt;[</span><span class="mi">0</span><span class="o">..</span><span class="mi">9</span><span class="p">]&gt;</span><span class="sr"> </span><span class="o">**</span><span class="sr"> </span><span class="p">{</span><span class="nv">$digits</span><span class="p">})</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">?</span><span class="p">{</span> <span class="o">+</span><span class="nv">$0</span> <span class="o">~~</span> <span class="nv">$test</span> <span class="p">}&gt;</span><span class="sr"> </span><span class="p">}</span>
</code></pre></div><p>åœ¨æ‰©å±•çš„ <code>&lt;...&gt;</code> è¯­æ³•ä¸­, ä¸€ä¸ªå‰ç½®çš„ <code>?{</code> æˆ– <code>!{</code> æ ‡ç¤ºç€ä»£ç æ–­è¨€:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">(&lt;</span><span class="s">[0..9]</span><span class="p">&gt;</span> <span class="o">**</span> <span class="p">{</span><span class="nv">$digits</span><span class="p">})</span> <span class="o">&lt;?</span><span class="p">{</span> <span class="o">+</span><span class="nv">$0</span> <span class="o">~~</span> <span class="nv">$test</span> <span class="p">}</span><span class="o">&gt;</span>
</code></pre></div><p>ç­‰ä»·äºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># + å¼ºåˆ¶åé¢çš„$0ä¸ºæ•°å€¼ä¸Šä¸‹æ–‡, ä»¥åŒ¹é… $test ä¸­çš„æ•°å­—</span>
<span class="p">(&lt;</span><span class="s">[0..9]</span><span class="p">&gt;</span> <span class="o">**</span> <span class="p">{</span><span class="nv">$digits</span><span class="p">})</span> <span class="p">{</span> <span class="o">+</span><span class="nv">$0</span> <span class="o">~~</span> <span class="nv">$test</span> <span class="ow">or</span> <span class="nb">fail</span> <span class="p">}</span>
</code></pre></div><p>ä¸Šé¢çš„ä¸¤å¥ä»£ç , å…·å <code>regex</code>, <code>token</code>, æˆ– <code>rule</code> æ˜¯ä¸€ä¸ªå­ä¾‹ç¨‹, æ‰€ä»¥å¯ä»¥ä¼ é€’å‚æ•°ç»™å…·å tokenã€‚</p>
<p>è¿™ä»æ ‡å‡†è¾“å…¥é‡Œè¯»å–æ•£ä¹±çš„æ—¥æœŸå¹¶æŠŠå¯¹åº”çš„ ISO æ—¥æœŸå†™åˆ°æ ‡å‡†è¾“å‡ºã€‚</p>
<p>å®ƒèƒ½è§£æä»»åŠ¡æè¿°ä¸­çš„æ‰€æœ‰æ—¥æœŸï¼ˆåŒ…å«æ‰©å±•ï¼‰, è¿˜æœ‰ - ç„¶è€Œ, åœ¨å®ƒä»¬ä¸­æˆ‘å¾—åˆ° 4 ä¸ªä¸åŒçš„ç»“æœã€‚è¯·å¼„æ¸…å®ƒä»¬æ˜¯å¦æ˜¯é”™è¯¯çš„, å¹¶ä¸”ä¸ºä»€ä¹ˆæ˜¯é”™çš„:</p>
<p>2010-dec-7 &ndash;&gt; æˆ‘å¾—åˆ°  2010-12-07 è€Œä¸æ˜¯ 2010-12-01</p>
<p>last week &ndash;&gt; æˆ‘å¾—åˆ° 2014-12-17 è€Œä¸æ˜¯ 2014-12-15</p>
<p>1 month from 2016-01-31 &ndash;&gt; æˆ‘å¾—åˆ°  2016-02-29 è€Œä¸æ˜¯ 2016-02-28</p>
<p>9 weeks from yesterday &ndash;&gt; æˆ‘å¾—åˆ°  2015-02-24 è€Œä¸æ˜¯ 2015-02-25</p>
<p>æœ‰äººåœ¨è¯„è®ºä¸­é—®ä»– <code>make/made</code> æ˜¯ç±»ä¸­çš„æ–¹æ³•å—ï¼Ÿ</p>
<p>æ˜¯çš„, å®ƒä»¬æ˜¯ Match ç±»çš„æ–¹æ³•ã€‚</p>
<h3 id="match-objectsæ³¨æ„-object-æ˜¯å¤æ•°">Match objects(æ³¨æ„ object æ˜¯å¤æ•°)</h3>
<p>æ¯ä¸ª regex match(å¹¶ä¸”é€šè¿‡æ‰©å±•, æ¯ä¸ª grammar token match)çš„ç»“æœè¢«è¡¨ç¤ºä¸ºä¸€ä¸ª Match å¯¹è±¡ã€‚</p>
<p>é€šè¿‡è¿™ä¸ªå¯¹è±¡ä½ èƒ½è®¿é—®å„ç§ä¿¡æ¯ç‰‡æ®µ:</p>
<ul>
<li>åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²</li>
<li>å…³äºè¾“å…¥å­—ç¬¦ä¸²åŒ¹é…çš„å¼€å§‹å’Œç»“æŸä½ç½®</li>
<li>æ¯ä¸ªä½ç½®æ•è·å’Œå…·åæ•è·çš„sub-matches</li>
<li>ä¸è¿™ä¸ªåŒ¹é…æœ‰å…³çš„ AST ç‰‡æ®µ, å¦‚æœæœ‰çš„è¯</li>
</ul>
<h3 id="ast-ç‰‡æ®µ">AST ç‰‡æ®µ</h3>
<p>åœ¨ <code>token/rule</code> é‡Œé¢è°ƒç”¨ <code>make</code>, è®¾ç½®å°†ä¼šä¸å½“å‰åŒ¹é…å…³è”çš„ &ldquo;AST ç‰‡æ®µ&rdquo;ã€‚ç„¶å, ä½ å¯ä»¥é€šè¿‡åœ¨å½“å‰ç»“æœ Match å¯¹è±¡èº«ä¸Šè°ƒç”¨ <code>.made</code> æ–¹æ³•æ¥è·å–é‚£ä¸ªå…³è”æ•°æ®ã€‚</p>
<p>è¿™æ­£æ˜¯è‡ªç”±å½¢å¼çš„æ’æ§½, å…è®¸ä½ ä½¿ç”¨ Match å¯¹è±¡å­˜å‚¨ä»»ä½•ä½ æƒ³è¦çš„ä¸œè¥¿å¹¶åœ¨ä»¥åæ£€ç´¢å®ƒ, å°½ç®¡æ˜¾è€Œæ˜“è§è¿™æ„å‘³ç€åƒæˆ‘é‚£æ ·åˆ›å»ºä¸€ä¸ª ASTã€‚</p>
<h3 id="åœ¨-grammar-ä¸­åˆ›å»º-ast">åœ¨ grammar ä¸­åˆ›å»º &ldquo;AST&rdquo;</h3>
<p>åœ¨æˆ‘çš„ grammar ä¸­æ¯ä¸ª <code>token/rule</code> ä½¿ç”¨ <code>.made</code> æ¥å–å¾—å®ƒçš„ sub-rule åŒ¹é…æ„å»ºçš„æ•°æ®ç‰‡æ®µ, æŠŠå®ƒä»¬ç»„åˆæˆä¸€ä¸ªæ›´å¤§çš„æ•°æ®ç‰‡æ®µ, è¿™æ˜¯ä¸ºäº†è®©å®ƒçš„ parent rule èƒ½æ£€ç´¢ã€‚ç­‰ç­‰ã€‚</p>
<p>æˆ‘åœ¨æ¯ä¸ª token/rule é‡Œé¢ä½¿ç”¨è¿™äº›è¯­æ³•ç®€å†™æ¥å¼•ç”¨ sub-matches çš„ Match å¯¹è±¡:</p>
<ul>
<li><code>$0</code> å¼•ç”¨ sub-matchï¼ˆç”±ä¸€ä¸ª <code>()</code> æ•è·ç»„å¯¼è‡´ï¼‰ çš„ç¬¬ä¸€ä¸ªä½ç½®å¤„çš„ Match å¯¹è±¡ã€‚</li>
<li><code>$&lt;date&gt;</code> å¼•ç”¨ä¸€ä¸ªåå­—ä¸º <code>date</code> çš„å…·å sub-match çš„ Match å¯¹è±¡(é€šè¿‡ <code>&lt;date&gt;</code> é€’å½’å¼•ç”¨åä¸º date çš„ <code>token</code> å¯¼è‡´).</li>
</ul>
<p><a href="https://www.reddit.com/r/dailyprogrammer/comments/3wshp7/20151214_challenge_245_easy_date_dilemma/">https://www.reddit.com/r/dailyprogrammer/comments/3wshp7/20151214_challenge_245_easy_date_dilemma/</a></p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/grammar" term="grammar" label="grammar" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[ä½¿ç”¨ Raku çš„ subsets å’Œ multi è¾¨åˆ«å¹´é¾„]]></title>
            <link href="https://ohmyweekly.github.io/notes/2016-01-04-an-example-of-raku-subset-and-multi/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2015-11-20-guess-who/?utm_source=atom_feed" rel="related" type="text/html" title="Guess Who" />
                <link href="https://ohmyweekly.github.io/notes/2015-06-10-list-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="List in Raku" />
                <link href="https://ohmyweekly.github.io/notes/2016-01-28-the-s-operator-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="Raku ä¸­çš„ S/// æ“ä½œç¬¦" />
                <link href="https://ohmyweekly.github.io/notes/2015-12-11-twigils-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="Raku ä¸­çš„ twigil" />
                <link href="https://ohmyweekly.github.io/notes/2015-11-11-add-a-method-to-an-existing-class-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="åœ¨ Raku ä¸­æ€ä¹ˆä¸ºå·²å­˜åœ¨çš„ç±»æ·»åŠ æ–¹æ³•" />
            
                <id>https://ohmyweekly.github.io/notes/2016-01-04-an-example-of-raku-subset-and-multi/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>An Example of Raku Subset and Multi</blockquote><p>ä¸¾ä¸ªä¾‹å­, å‡è®¾ person æœ‰ä¸€ä¸ª age å±æ€§. æˆ‘èƒ½å†™ä¸€ä¸ª <code>multimethod</code>, è®©å®ƒæ¥æ”¶ä¸€ä¸ª person ä½œä¸ºå‚æ•°, å¹¶è¿”å›è¿™æ ·çš„ç»“æœå—:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">return</span> <span class="p">&#34;</span><span class="s2">child</span><span class="p">&#34;</span>  <span class="k">if</span> <span class="n">age</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span>
<span class="k">return</span> <span class="p">&#34;</span><span class="s2">adult</span><span class="p">&#34;</span>  <span class="k">if</span> <span class="mi">16</span> <span class="o">&lt;=</span> <span class="n">age</span> <span class="o">&lt;</span> <span class="mi">66</span><span class="p">;</span>
<span class="k">return</span> <span class="p">&#34;</span><span class="s2">senior</span><span class="p">&#34;</span> <span class="k">if</span> <span class="n">age</span> <span class="o">&gt;=</span> <span class="mi">66</span><span class="p">;</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-r" data-lang="r"><span class="n">class</span> <span class="n">Person</span> <span class="p">{</span>
    <span class="n">has</span> <span class="n">Int</span> <span class="o">$</span><span class="n">.age</span><span class="p">;</span>
    <span class="n">has</span> <span class="n">Str</span> <span class="o">$</span><span class="n">.name</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>è¿™ä»…ä»…å®šä¹‰äº†ä¸€ä¸ªæ‹¥æœ‰ä¸¤ä¸ªå±æ€§, å«åš Person çš„ç±». age å¿…é¡»æ˜¯ Int å‹, name å¿…é¡»æ˜¯ Str å‹. <code>.</code> è¯­æ³•ä¼šç”Ÿæˆä¸€ä¸ªåªè¯»è®¿é—®å™¨, ä»¥ä½¿æˆ‘ä»¬èƒ½ä»ç±»çš„å¤–éƒ¨è®¿é—® getter æ–¹æ³•.</p>
<p>ç°åœ¨æˆ‘ä»¬æ¥å®šä¹‰ä¸€ä¸ª <code>age-group</code> multi æ¥å‘Šè¯‰ä¸€ä¸ª person å±äºå“ªä¸ª age-group:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="nf">age-group</span> <span class="p">(</span><span class="nv">$person</span> <span class="k">where</span> <span class="p">(</span><span class="o">*.</span><span class="nf">age</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">)</span>  <span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">child</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nf">age-group</span> <span class="p">(</span><span class="nv">$person</span> <span class="k">where</span> <span class="p">(</span><span class="o">*.</span><span class="nf">age</span> <span class="o">&gt;=</span> <span class="mi">66</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">senior</span><span class="p">&#34;}</span>
<span class="k">multi</span> <span class="nf">age-group</span> <span class="p">(</span><span class="nv">$person</span><span class="p">)</span>                      <span class="p">{</span> <span class="p">&#34;</span><span class="s2">adult</span><span class="p">&#34;</span> <span class="p">}</span>
</code></pre></div><p><code>where</code>ä»å¥ç»™å‚æ•°æ·»åŠ äº†ä¸€ä¸ª<code>çº¦æŸ</code>, è¿™ä¸ªçº¦æŸå‘Šè¯‰å‚æ•°å¿…é¡»åŒ¹é…è¿™ä¸ªå‚æ•°å³è¾¹çš„ä¸œè¥¿.è¿™ç”¨äºåŒºåˆ«å°†è¦é€‰å–çš„ multi. <code>where</code>ä»å¥å¯ä»¥æ˜¯ä¸€ä¸ª regex, ç±»å‹, ä¸€ä¸ªç¡®åˆ‡çš„å€¼, ä¸€ä¸ªæ–­è¨€ block,æˆ–è€…ä¸€äº›å…¶å®ƒä¸œè¥¿.</p>
<p><code>*.age &lt; 16</code> éƒ¨åˆ†å¯èƒ½çœ‹èµ·æ¥æ›´è®©äººè¿·æƒ‘. æ˜Ÿå·æ˜¯ä»€ä¹ˆ? æ˜Ÿå·æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å€¼, å«åš Whatever. å®ƒé€šå¸¸åœ¨ç»™å®šæƒ…å†µä¸‹æ»¡è¶³ä½ çš„éœ€æ±‚. åœ¨æ™ºèƒ½åŒ¹é…ä¸­, å®ƒæ€»æ˜¯åŒ¹é…, æ‰€ä»¥ä½ å¯ä»¥åœ¨ <code>given/when</code> block ä¸­å°†å®ƒç”¨ä½œé»˜è®¤å€¼. ä½†æ˜¯ Whatever æœ€æœ‰ç”¨çš„åœ°æ–¹ä¹‹ä¸€æ˜¯åˆ›å»ºåŒ¿å block. å¯¹äºå¤§éƒ¨åˆ†æ“ä½œç¬¦, å¦‚æœä½ åœ¨ Whatever ä¸Šæ‰§è¡Œå®ƒä»¬, å®ƒä¼šäº§ç”Ÿä¸€ä¸ªåŒ¿å block å¹¶ä½¿ç”¨å®ƒä»¬çš„å‚æ•°æ‰§è¡Œæ“ä½œç¬¦. å¦‚æœä¸€ä¸ªè¡¨è¾¾å¼ä¸­æœ‰å¤šä¸ª Whatever, åˆ™ç”Ÿæˆçš„åŒ¿å block ä¼šæœ‰å¤šä¸ªå‚æ•°å¯¹åº”äºç›¸åº”çš„ Whatever ä½ç½®.</p>
<p>ä¾‹å¦‚, <code>* + 1</code> äº§ç”Ÿä¸€ä¸ª block,ä½¿å‚æ•°çš„å€¼åŠ 1. <code>* + *</code> äº§ç”Ÿä¸€ä¸ª block ä½¿å®ƒçš„ä¸¤ä¸ªå‚æ•°ç›¸åŠ . è¿™ä¸ªä¾‹å­ä¸­, æˆ‘ä»¬è°ƒç”¨ Whatever çš„ <code>age</code>æ–¹æ³•, å¹¶è¯¢é—®å®ƒæ˜¯å¦å°äº 16. æˆ‘ä»¬èƒ½ç”¨å…¶å®ƒå‡ ç§æ–¹å¼è¾¾åˆ°åŒæ ·çš„æ•ˆæœ, ä½†æ˜¯æ›´å•°å—¦:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="p">(</span><span class="nv">$person</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$person</span><span class="o">.</span><span class="nf">age</span> <span class="o">&lt;</span> <span class="mi">16</span> <span class="p">}</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">-&gt;</span> <span class="nv">$person</span>    <span class="p">{</span> <span class="nv">$person</span><span class="o">.</span><span class="nf">age</span> <span class="o">&lt;</span> <span class="mi">16</span> <span class="p">}</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">{</span> <span class="o">.</span><span class="nf">age</span> <span class="o">&lt;</span> <span class="mi">16</span> <span class="p">}</span>
</code></pre></div><p>ä½†æ˜¯å¯¹äºåƒè¿™ç§ç®€å•çš„æ“ä½œ, Whatever é€šå¸¸æ¯”å…¶å®ƒæ–¹å¼æ›´æ˜“è¯»ä¹Ÿæ›´ç®€æ´. ä¸å¹¸çš„æ˜¯, åœ¨å‚æ•°åˆ—è¡¨çš„ where ä»å¥ä¸­, ä½ éœ€è¦ä½¿ç”¨æ‹¬å·æ‹¬èµ·å¾ˆå¤šå¤æ‚çš„è¡¨è¾¾å¼, åŒ…æ‹¬ Whatever block.</p>
<p>ç°åœ¨è®©æˆ‘ä»¬åœ¨ Rakudo çš„ REPL ä¸­è¯•è¯•å®ƒå§:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">&gt;</span> <span class="n">age-group</span> <span class="n">Person</span><span class="o">.</span><span class="nb">new</span><span class="p">(:</span><span class="s">name</span><span class="p">&lt;</span><span class="s">timmy</span><span class="p">&gt;</span><span class="o">,</span> <span class="p">:</span><span class="s">age</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="nb">child</span>
<span class="o">&gt;</span> <span class="n">age-group</span> <span class="n">Person</span><span class="o">.</span><span class="nb">new</span><span class="p">(:</span><span class="s">name</span><span class="p">&lt;</span><span class="s">john</span><span class="p">&gt;</span><span class="o">,</span> <span class="p">:</span><span class="s">age</span><span class="p">(</span><span class="mi">23</span><span class="p">))</span>
<span class="n">adult</span>
<span class="o">&gt;</span> <span class="n">age-group</span> <span class="n">Person</span><span class="o">.</span><span class="nb">new</span><span class="p">(:</span><span class="s">name</span><span class="p">&lt;</span><span class="s">ezekiel</span><span class="p">&gt;</span><span class="o">,</span> <span class="p">:</span><span class="s">age</span><span class="p">(</span><span class="mi">89</span><span class="p">))</span>
<span class="n">senior</span>
</code></pre></div><p>ç›®å‰ä¸ºæ­¢, å¾ˆå¥½. ä½†æ˜¯å¦‚æœæˆ‘ä»¬æ„å¤–åœ°ä¼ é€’äº†ä¸€ä¸ª age è€Œä¸æ˜¯ Person ç»™ age-group å‘¢?</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">&gt;</span> <span class="n">age-group</span> <span class="mi">15</span>
<span class="nb">Method</span> <span class="p">&#39;</span><span class="s1">age</span><span class="p">&#39;</span> <span class="nb">not</span> <span class="n">found</span> <span class="k">for</span> <span class="nb">invocant</span> <span class="k">of</span> <span class="k">class</span> <span class="nc">&#39;Int&#39;</span>
</code></pre></div><p>æˆ‘ä»¬èƒ½æŒ‡å®šåªæœ‰ Person å¯¹äº age-group æ˜¯åˆæ³•çš„:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="nf">age-group</span> <span class="p">(</span><span class="n">Person</span> <span class="nv">$person</span> <span class="k">where</span> <span class="p">(</span><span class="o">*.</span><span class="nf">age</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">))</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">child</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nf">age-group</span> <span class="p">(</span><span class="n">Person</span> <span class="nv">$person</span> <span class="k">where</span> <span class="p">(</span><span class="o">*.</span><span class="nf">age</span> <span class="o">&gt;=</span> <span class="mi">66</span><span class="p">))</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">senior</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nf">age-group</span> <span class="p">(</span><span class="n">Person</span> <span class="nv">$person</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">adult</span><span class="p">&#34;</span> <span class="p">}</span>
</code></pre></div><p>è¿™æ­£ç¡®åœ°å¤„ç†äº† Person é—®é¢˜. è°ƒç”¨å¸¦æœ‰ age å‚æ•°çš„ age-group ä¼šæ€æ ·å‘¢?</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">&gt;</span> <span class="n">age-group</span> <span class="mi">15</span>
<span class="n">No</span> <span class="n">applicable</span> <span class="nb">candidates</span> <span class="n">found</span> <span class="nb">to</span> <span class="n">dispatch</span> <span class="nb">to</span> <span class="k">for</span> <span class="p">&#39;</span><span class="s1">age-group</span><span class="p">&#39;</span><span class="o">.</span> <span class="n">Available</span> <span class="nb">candidates</span> <span class="n">are:</span>
<span class="o">:</span><span class="p">(</span><span class="n">Person</span> <span class="nv">$person</span> <span class="k">where</span> <span class="p">({</span> <span class="o">...</span> <span class="p">}))</span>
<span class="o">:</span><span class="p">(</span><span class="n">Person</span> <span class="nv">$person</span> <span class="k">where</span> <span class="p">({</span> <span class="o">...</span> <span class="p">}))</span>
<span class="o">:</span><span class="p">(</span><span class="n">Person</span> <span class="nv">$person</span><span class="p">)</span>
</code></pre></div><p>çœ‹èµ·æ¥æ›´å¥½. å‡å¦‚æˆ‘ä»¬å…è®¸è¯¢é—® age æ‰€å±çš„ age-group å‘¢?</p>
<p>æˆ‘ä»¬èƒ½é‡å†™ age-group çš„ Person å˜ä½“, æ¥æ”¶ Int ç±»å‹çš„ age, å¹¶å†™ä¸€ä¸ªå•ä¸ªçš„ Person å˜ä½“æ¥è°ƒç”¨ age-group:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="nf">age-group</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$age</span> <span class="k">where</span> <span class="p">(</span><span class="o">*</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">)</span>  <span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">child</span><span class="p">&#34;</span>  <span class="p">}</span>
<span class="k">multi</span> <span class="nf">age-group</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$age</span> <span class="k">where</span> <span class="p">(</span><span class="o">*</span> <span class="o">&gt;=</span> <span class="mi">66</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">senior</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nf">age-group</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$age</span><span class="p">)</span>                  <span class="p">{</span> <span class="p">&#34;</span><span class="s2">adult</span><span class="p">&#34;</span>  <span class="p">}</span>
<span class="k">multi</span> <span class="nf">age-group</span><span class="p">(</span><span class="n">Person</span> <span class="nv">$person</span><span class="p">)</span> <span class="p">{</span> <span class="n">age-group</span> <span class="nv">$person</span><span class="o">.</span><span class="nf">age</span> <span class="p">}</span>
</code></pre></div><p>è¿™å¯¹äºæ¯ä¸ª Person ä¾‹å­éƒ½æœ‰æ•ˆ, è¿˜æœ‰å®ƒä»¬çš„ ages.</p>
<p>ç°åœ¨,è®©æˆ‘ä»¬ä½¿ç”¨ <code>age-group</code> å®šä¹‰ä¸€ä¸ªå«åš <code>print-name</code> çš„ <code>multi</code> æ¥åˆ†å‘.
æ ¹æ® <code>age-group</code> åˆ†å‘æœ€æ˜æ˜¾çš„æ–¹æ³•æ˜¯ä½¿ç”¨ where ä»å¥.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="nf">print-name</span><span class="p">(</span><span class="n">Person</span> <span class="nv">$person</span> <span class="k">where</span> <span class="p">(</span><span class="nf">age-group</span><span class="p">(</span><span class="nv">$person</span><span class="p">)</span> <span class="ow">eq</span> <span class="p">&#34;</span><span class="s2">child</span><span class="p">&#34;))</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">Little </span><span class="p">{</span><span class="nv">$person</span><span class="o">.</span><span class="nb">name</span><span class="p">}&#34;</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nf">print-name</span><span class="p">(</span><span class="n">Person</span> <span class="nv">$person</span> <span class="k">where</span> <span class="p">(</span><span class="nf">age-group</span><span class="p">(</span><span class="nv">$person</span><span class="p">)</span> <span class="ow">eq</span> <span class="p">&#34;</span><span class="s2">adult</span><span class="p">&#34;))</span> <span class="p">{</span> <span class="nv">$person</span><span class="o">.</span><span class="nb">name</span>            <span class="p">}</span>
<span class="k">multi</span> <span class="nf">print-name</span><span class="p">(</span><span class="n">Person</span> <span class="nv">$person</span> <span class="k">where</span> <span class="p">(</span><span class="nf">age-group</span><span class="p">(</span><span class="nv">$person</span><span class="p">)</span> <span class="ow">eq</span> <span class="p">&#34;</span><span class="s2">senior</span><span class="p">&#34;)){</span> <span class="p">&#34;</span><span class="s2">Old Man </span><span class="p">{</span><span class="nv">$person</span><span class="o">.</span><span class="nb">name</span><span class="p">}&#34;}</span>
</code></pre></div><p>åŒå¼•å·å­—ç¬¦ä¸²ä¸­çš„ <code>{$person.name}</code> å°† block çš„ç»“æœæ’å€¼åˆ°å­—ç¬¦ä¸²ä¸­.</p>
<p>è®©æˆ‘ä»¬å†è¯•è¯•:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">&gt; print-name Person.new<span class="o">(</span>:name&lt;timmy&gt;, :age<span class="o">(</span>10<span class="o">))</span>
Little Timmy
&gt; print-name Person.new<span class="o">(</span>:name&lt;john&gt;, :age<span class="o">(</span>23<span class="o">))</span>
John
&gt; print-name Person.new<span class="o">(</span>:name&lt;ezekiel&gt;, :age<span class="o">(</span>89<span class="o">))</span>
Old Man Ezekiel
</code></pre></div><p>é‚£å¾ˆæ£’. ä½†æ˜¯å¦‚æœæˆ‘ä»¬æœ‰æ›´å¤šçš„åŸºäº person çš„ <code>age-group</code> çš„ multis è¦åˆ†å‘å‘¢? éš¾é“æˆ‘ä»¬çœŸçš„æ¯æ¬¡éƒ½è¦å†™å‡º <code>(Person $person where (age-group($person) eq &quot;child&quot;))</code> è¿™æ ·çš„ä»£ç å—? ä¸, æˆ‘ä»¬ä¸éœ€è¦, æ„Ÿè°¢ subset ç±»å‹.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">subset</span> <span class="nc">Child</span>  <span class="k">of</span> <span class="nc">Person</span> <span class="k">where</span> <span class="o">*.</span><span class="nf">age</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span>
<span class="k">subset</span> <span class="nc">Adult</span>  <span class="k">of</span> <span class="nc">Person</span> <span class="k">where</span> <span class="k">-&gt;</span> <span class="nv">$person</span> <span class="p">{</span> <span class="mi">16</span> <span class="o">&lt;=</span> <span class="nv">$person</span><span class="o">.</span><span class="nf">age</span> <span class="o">&lt;</span> <span class="mi">66</span> <span class="p">};</span>
<span class="k">subset</span> <span class="nc">Senior</span> <span class="k">of</span> <span class="nc">Person</span> <span class="k">where</span> <span class="o">*.</span><span class="nf">age</span> <span class="o">&gt;=</span> <span class="mi">66</span><span class="p">;</span>

<span class="k">multi</span> <span class="nf">print-name</span><span class="p">(</span><span class="n">Child</span> <span class="nv">$person</span><span class="p">)</span>  <span class="p">{</span> <span class="p">&#34;</span><span class="s2">Little </span><span class="p">{</span><span class="nv">$person</span><span class="o">.</span><span class="nb">name</span><span class="p">}&#34;</span>  <span class="p">}</span>
<span class="k">multi</span> <span class="nf">print-name</span><span class="p">(</span><span class="n">Adult</span> <span class="nv">$person</span><span class="p">)</span>  <span class="p">{</span> <span class="nv">$person</span><span class="o">.</span><span class="nb">name</span>             <span class="p">}</span>
<span class="k">multi</span> <span class="nf">print-name</span><span class="p">(</span><span class="n">Senior</span> <span class="nv">$person</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">Old Man </span><span class="p">{</span><span class="nv">$person</span><span class="o">.</span><span class="nb">name</span><span class="p">}&#34;</span> <span class="p">}</span>
</code></pre></div><p>ç”±äº Rakudo åœ¨å¤„ç†å«æœ‰ç»„åˆçš„é“¾å¼æ¯”è¾ƒæ“ä½œç¬¦çš„ Whatever æ—¶æœ‰ä¸€ä¸ª bug, æˆ‘ä»¬ä¸å¾—ä¸ä¸º Adult å†™ä¸€ä¸ªæ˜¾å¼çš„ block.</p>
<p>è¿™ä¸ª bug ç°å·²ä¿®å¤, æ‰€ä»¥:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">subset</span> <span class="nc">Adult</span>  <span class="k">of</span> <span class="nc">Person</span> <span class="k">where</span> <span class="k">-&gt;</span> <span class="nv">$person</span> <span class="p">{</span> <span class="mi">16</span> <span class="o">&lt;=</span> <span class="nv">$person</span><span class="o">.</span><span class="nf">age</span> <span class="o">&lt;</span> <span class="mi">66</span> <span class="p">};</span>
</code></pre></div><p>ç­‰ä»·äº:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">subset</span> <span class="nc">Adult</span>  <span class="k">of</span> <span class="nc">Person</span> <span class="k">where</span>  <span class="mi">16</span> <span class="o">&lt;=</span> <span class="o">*.</span><span class="nf">age</span> <span class="o">&lt;</span> <span class="mi">66</span><span class="p">;</span>
</code></pre></div><p>è¿™ä¸ªæ–°ç‰ˆæœ¬çš„ <code>print-name</code> ä¸ä¹‹å‰æ—§ç‰ˆæœ¬äº§ç”ŸåŒæ ·çš„ç»“æœ. ç°åœ¨æˆ‘ä»¬èƒ½ä» <code>Child/Adult/Senior</code> çš„è§’åº¦é‡å†™ <code>age-group</code> :</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="nf">age-group</span><span class="p">(</span><span class="n">Child</span><span class="p">)</span>  <span class="p">{</span> <span class="p">&#34;</span><span class="s2">child</span><span class="p">&#34;</span>  <span class="p">}</span>
<span class="k">multi</span> <span class="nf">age-group</span><span class="p">(</span><span class="n">Adult</span><span class="p">)</span>  <span class="p">{</span> <span class="p">&#34;</span><span class="s2">adult</span><span class="p">&#34;</span>  <span class="p">}</span>
<span class="k">multi</span> <span class="nf">age-group</span><span class="p">(</span><span class="n">Senior</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">senior</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nf">age-group</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$age</span><span class="p">)</span> <span class="p">{</span> <span class="n">age-group</span> <span class="n">Person</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="o">:</span><span class="nv">$age</span><span class="p">)</span> <span class="p">}</span>
</code></pre></div><p><code>:$age</code> æ˜¯ <code>:age($age)</code> çš„ç®€å†™æ–¹å¼.</p>
<p>åˆä¸€æ¬¡, æˆ‘ä»¬æœ‰äº†äº§ç”Ÿæƒ³è¦çš„ç»“æœçš„æ›´æ¸…æ™°çš„ä»£ç , å¤šäºäº† multiple åˆ†å‘å’Œ subset ç±»å‹.</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[åœ¨ Raku ä¸­ä¸ºè‡ªå®šä¹‰çš„ç±»æ·»åŠ ä¸‹æ ‡]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-08-18-add-subscripts-for-custom-class-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2015-05-18-subscripts-adverbs/?utm_source=atom_feed" rel="related" type="text/html" title="ä¸‹æ ‡å‰¯è¯" />
            
                <id>https://ohmyweekly.github.io/notes/2015-08-18-add-subscripts-for-custom-class-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Add Subscripts for Custom Class in Raku</blockquote><h3 id="ä¸ºè‡ªå®šä¹‰çš„ç±»æ·»åŠ ä¸‹æ ‡subscripts">ä¸ºè‡ªå®šä¹‰çš„ç±»æ·»åŠ ä¸‹æ ‡(subscripts)</h3>
<p>å‡å¦‚ä½ å®šä¹‰äº†ä¸€ä¸ªç±», ä½ æƒ³æŠŠç±»çš„å®ä¾‹ç”¨ä½œæ•£åˆ—é‚£æ ·, å¯ä»¥ç´¢å¼•å…¶ä¸­çš„å…ƒç´ , é‚£ä¹ˆä½ éœ€è¦è®©ä½ å¾—è‡ªå®šä¹‰éµå®ˆ Associative æ¥å£, å¹¶é‡å†™ <code>AT-KEY</code>ã€<code>EXISTS-KEY</code>ã€<code>DELETE-KEY</code>ã€<code>push</code> ç­‰è·Ÿæ•£åˆ—æœ‰å…³çš„æ–¹æ³•:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">HTTPHeader</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>

<span class="k">class</span> <span class="nc">HTTPHeader</span> <span class="k">does</span> <span class="nb">Associative</span>  <span class="p">{</span>

    <span class="k">has</span> <span class="nv">%!fields</span> <span class="nb">handles</span> <span class="p">&lt;</span><span class="s">self.AT-KEY self.EXISTS-KEY self.DELETE-KEY self.push list kv keys values</span><span class="p">&gt;;</span>
    <span class="k">method</span> <span class="nb">Str</span> <span class="p">{</span> <span class="nb">say</span> <span class="nb">self</span><span class="o">.</span><span class="nb">hash</span><span class="o">.</span><span class="nb">fmt</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">multi</span> <span class="k">method</span> <span class="nb">EXISTS-KEY</span> <span class="p">(</span><span class="nv">$key</span><span class="p">)</span>       <span class="p">{</span> <span class="nv">%!fields</span><span class="p">{</span><span class="n">normalize-key</span> <span class="nv">$key</span><span class="p">}:</span><span class="s">exists</span> <span class="p">}</span>
    <span class="k">multi</span> <span class="k">method</span> <span class="nb">DELETE-KEY</span> <span class="p">(</span><span class="nv">$key</span><span class="p">)</span>       <span class="p">{</span> <span class="nv">%!fields</span><span class="p">{</span><span class="n">normalize-key</span> <span class="nv">$key</span><span class="p">}:</span><span class="s">delete</span> <span class="p">}</span>
    <span class="k">multi</span> <span class="k">method</span> <span class="nb">push</span> <span class="p">(</span><span class="o">*</span><span class="nv">@_</span><span class="p">)</span>              <span class="p">{</span> <span class="nv">%!fields</span><span class="o">.</span><span class="nb">push</span><span class="o">:</span> <span class="nv">@_</span>                   <span class="p">}</span>

    <span class="k">sub</span> <span class="nf">normalize-key</span> <span class="p">(</span><span class="nv">$key</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$key</span><span class="o">.</span><span class="nb">subst</span><span class="p">(/</span><span class="se">\w</span><span class="o">+</span><span class="p">/</span><span class="o">,</span> <span class="o">*.</span><span class="nb">tc</span><span class="o">,</span> <span class="p">:</span><span class="s">g</span><span class="p">)</span> <span class="p">}</span> <span class="c1"># titileCase é©¼å³°å¼çš„é”®</span>

    <span class="k">method</span> <span class="nb">AT-KEY</span> <span class="p">(</span><span class="vg">::?CLASS:D</span><span class="o">:</span> <span class="nv">$key</span><span class="p">)</span> <span class="k">is</span> <span class="k">rw</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">$element</span> <span class="o">:=</span> <span class="nv">%!fields</span><span class="p">{</span><span class="n">normalize-key</span> <span class="nv">$key</span><span class="p">};</span>

        <span class="nb">Proxy</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span>
            <span class="s">FETCH</span> <span class="o">=&gt;</span> <span class="k">method</span> <span class="p">()</span> <span class="p">{</span> <span class="nv">$element</span> <span class="p">}</span>,

            <span class="s">STORE</span> <span class="o">=&gt;</span> <span class="k">method</span> <span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$element</span> <span class="o">=</span> <span class="nb">do</span> <span class="k">given</span> <span class="nv">$value</span><span class="o">Â».</span><span class="nb">split</span><span class="p">(/&#39;</span><span class="s1">,</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\s</span><span class="o">+</span><span class="p">/)</span><span class="o">.</span><span class="nb">flat</span> <span class="p">{</span>
                    <span class="k">when</span> <span class="mi">1</span>  <span class="p">{</span> <span class="o">.[</span><span class="mi">0</span><span class="o">]</span> <span class="p">}</span>    <span class="c1"># a single value is stored as a string</span>
                    <span class="k">default</span> <span class="p">{</span> <span class="o">.</span><span class="nb">Array</span> <span class="p">}</span>  <span class="c1"># multiple values are stored as an array</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="k">my</span> <span class="nv">$header</span> <span class="o">=</span> <span class="n">HTTPHeader</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$header</span><span class="o">.</span><span class="nb">WHAT</span><span class="p">;</span>  <span class="c1">#-&gt; (HTTPHeader)</span>
<span class="p">&#34;&#34;</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>

<span class="nv">$header</span><span class="p">&lt;</span><span class="s">Accept</span><span class="p">&gt;</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">text/plain</span><span class="p">&#34;;</span>
<span class="nv">$header</span><span class="p">{&#39;</span><span class="s1">Accept-</span><span class="p">&#39;</span> <span class="ow">X</span><span class="o">~</span> <span class="p">&lt;</span><span class="s">Charset Encoding Language</span><span class="p">&gt;}</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">utf-8 gzip en</span><span class="p">&gt;;</span>
<span class="nv">$header</span><span class="o">.</span><span class="nb">push</span><span class="p">(&#39;</span><span class="s1">Accept-Language</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">fr</span><span class="p">&#34;);</span>  <span class="c1"># like .push on a Hash</span>

<span class="nb">say</span> <span class="nv">$header</span><span class="o">.</span><span class="nb">hash</span><span class="o">.</span><span class="nb">fmt</span><span class="p">;</span>
<span class="p">&#34;&#34;</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>
<span class="c1"># say $header.Str; # åŒä¸Š</span>

<span class="nb">say</span> <span class="nv">$header</span><span class="p">&lt;</span><span class="s">Accept-Language</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">values</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$header</span><span class="p">&lt;</span><span class="s">Accept-Charset</span><span class="p">&gt;;</span>
</code></pre></div><p>è¾“å‡ºï¼š</p>
<pre><code>(HTTPHeader)

Accept	text/plain
Accept-Charset	utf-8
Accept-Encoding	gzip
Accept-Language	en fr

(en fr)
utf-8
</code></pre><p>åŒæ ·, ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æ•°ç»„ä¸‹æ ‡, åªè¦ä½ é‡å†™ç›¸åº”åœ°æ–¹æ³•ã€‚</p>
<p>å…³äºä¸ºè‡ªå®šä¹‰çš„ç±»æ·»åŠ ä¸‹æ ‡è¿™ä¸ªé—®é¢˜,  stackoverflow ä¸Šçš„å›ç­”æ˜¯ä¸éœ€è¦åœ¨ handles åé¢æ‰€è·Ÿçš„æ–¹æ³•ä¸­æ·»åŠ  <code>self</code>ã€‚ ä»–çš„è§£é‡Šå¦‚ä¸‹:</p>
<h2 id="ä¸ºè‡ªå®šä¹‰çš„ç±»æ·»åŠ ä¸‹æ ‡subscriptshttpstackoverflowcomquestions36773986how-to-add-subscripts-to-my-custom-class-in-perl-6"><a href="http://stackoverflow.com/questions/36773986/how-to-add-subscripts-to-my-custom-class-in-perl-6">ä¸ºè‡ªå®šä¹‰çš„ç±»æ·»åŠ ä¸‹æ ‡(subscripts)</a></h2>
<p>åœ¨è‡ªå®šä¹‰ç±»ä¸Šå®ç°å…³è”å¼ä¸‹æ ‡(associative subscripting)ã€‚</p>
<h3 id="é€šè¿‡ä»£ç†å®ç°">é€šè¿‡ä»£ç†å®ç°</h3>
<p>Raku é€šè¿‡åœ¨å®ç°äº†é›†åˆç±»å‹çš„å¯¹è±¡èº«ä¸Šè°ƒç”¨è‰¯å®šä¹‰çš„æ–¹æ³•æ¥å®ç°å…³è”å¼ä¸‹æ ‡å’Œä½ç½®ä¸‹æ ‡ï¼ˆå¯¹äºå†…ç½®ç±»å‹ï¼‰ã€‚é€šè¿‡åœ¨ <code>%!fields</code> å±æ€§åé¢æ·»åŠ  <code>handles</code> ç‰¹æ€§(trait),  ä½ å°±æŠŠè¿™äº›æ–¹æ³•è°ƒç”¨ä¼ é€’ç»™äº† <code>%!fields</code> - å®ƒä½œä¸ºä¸€ä¸ªæ•£åˆ—, ä¼šçŸ¥é“æ€ä¹ˆæ¥å¤„ç†é‚£äº›æ–¹æ³•ã€‚</p>
<h3 id="çµæ´»çš„é”®">çµæ´»çš„é”®</h3>
<blockquote>
<p>However, HTTP header field names are supposed to be case-insensitive (and preferred in camel-case). We can accommodate this by taking the *-KEY and push methods out of the handles list, and implementing them separately&hellip;</p>
</blockquote>
<p>æŠŠæ‰€æœ‰çš„é”®å¤„ç†æ–¹æ³•ä»£ç†ç»™å†…éƒ¨çš„æ•£åˆ—æ„å‘³ç€ä½ çš„é”®å¾—åˆ°äº†æ•£åˆ—é‚£æ ·çš„æ’å€¼ - æ„å‘³ç€å®ƒä»¬å°†æ˜¯å¤§å°å†™æ— å…³çš„å› ä¸ºæ•£åˆ—çš„é”®æ˜¯å¤§å°å†™æ— å…³çš„ã€‚ä¸ºäº†é¿å…é‚£, ä½ æŠŠæ‰€æœ‰è·Ÿé”®æœ‰å…³çš„æ–¹æ³•ä» <em>handles</em> å­å¥ä¸­æ‹¿å‡ºå¹¶è‡ªå·±å®ç°é‚£äº›æ–¹æ³•ã€‚åœ¨ä¾‹å­ä¸­, é”®åœ¨è¢«ç´¢å¼•åˆ° <code>%!fields</code> è®©é”®å˜æˆå¤§å°å†™æ— å…³ä¹‹å‰å…ˆè¿›è¡Œäº†é”®çš„ã€Œæ ‡å‡†åŒ–ã€ã€‚</p>
<h3 id="çµæ´»çš„å€¼">çµæ´»çš„å€¼</h3>
<p>ä¾‹å­ä¸­çš„æœ€åä¸€éƒ¨åˆ†å±•ç¤ºäº†å½“å€¼å­˜å…¥åˆ°æ•£åˆ—é‚£æ ·çš„å®¹å™¨ä¸­æ—¶ä½ å¦‚ä½•æ§åˆ¶å€¼çš„æ’å€¼ã€‚åˆ°ç›®å‰ä¸ºæ­¢, é€šè¿‡èµ‹å€¼ç»™è¿™ä¸ªè‡ªå®šä¹‰å®¹å™¨çš„å®ä¾‹æä¾›çš„å€¼è¦ä¹ˆæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸², è¦ä¹ˆæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„æ•°ç»„ã€‚é¢å¤–çš„æ§åˆ¶æ˜¯é€šè¿‡ç§»é™¤å®šä¹‰åœ¨çµæ´»çš„é”®ä¸­çš„  <strong>AT-KEY</strong> æ–¹æ³•æ¥è¾¾æˆçš„å¹¶æä¾›ä¸€ä¸ª <strong><a href="https://doc.raku.org/type/Proxy">Proxy</a></strong> å¯¹è±¡æ¥ä»£æ›¿å®ƒã€‚å¦‚æœä½ ç»™å®¹å™¨èµ‹å€¼, é‚£ä¹ˆä»£ç†äººå¯¹è±¡çš„ <strong>STORE</strong> æ–¹æ³•ä¼šè¢«è°ƒç”¨å¹¶ä¸”é‚£ä¸ªæ–¹æ³•ä¼šæ‰«ææ‰€æä¾›çš„å­—ç¬¦ä¸²å€¼ä¸­çš„ <code>&quot;, &quot;</code>ï¼ˆæ³¨æ„ç©ºæ ¼æ˜¯å¿…è¦çš„ï¼‰ã€‚å¦‚æœæ‰¾åˆ°ä¼šæ¥æ”¶é‚£ä¸ªå­—ç¬¦ä¸²å€¼ä½œä¸ºå‡ ä¸ªå­—ç¬¦ä¸²å€¼çš„è¯´æ˜ä¹¦ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">HTTPHeader</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>

<span class="k">class</span> <span class="nc">HTTPHeader</span> <span class="k">does</span> <span class="nb">Associative</span>  <span class="p">{</span>

    <span class="k">has</span> <span class="nv">%!fields</span>  <span class="nb">handles</span> <span class="p">&lt;</span><span class="s">list kv keys values</span><span class="p">&gt;;</span>
    <span class="k">method</span> <span class="nb">Str</span> <span class="p">{</span> <span class="nb">say</span> <span class="nb">self</span><span class="o">.</span><span class="nb">hash</span><span class="o">.</span><span class="nb">fmt</span><span class="p">;</span> <span class="p">}</span>


    <span class="k">multi</span> <span class="k">method</span> <span class="nb">EXISTS-KEY</span> <span class="p">(</span><span class="nv">$key</span><span class="p">)</span>       <span class="p">{</span> <span class="nv">%!fields</span><span class="p">{</span><span class="n">normalize-key</span> <span class="nv">$key</span><span class="p">}:</span><span class="s">exists</span> <span class="p">}</span>
    <span class="k">multi</span> <span class="k">method</span> <span class="nb">DELETE-KEY</span> <span class="p">(</span><span class="nv">$key</span><span class="p">)</span>       <span class="p">{</span> <span class="nv">%!fields</span><span class="p">{</span><span class="n">normalize-key</span> <span class="nv">$key</span><span class="p">}:</span><span class="s">delete</span> <span class="p">}</span>
    <span class="k">multi</span> <span class="k">method</span> <span class="nb">push</span> <span class="p">(</span><span class="o">*</span><span class="nv">@_</span><span class="p">)</span>              <span class="p">{</span> <span class="nv">%!fields</span><span class="o">.</span><span class="nb">push</span><span class="o">:</span> <span class="nv">@_</span>                   <span class="p">}</span>

    <span class="k">sub</span> <span class="nf">normalize-key</span> <span class="p">(</span><span class="nv">$key</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$key</span><span class="o">.</span><span class="nb">subst</span><span class="p">(/</span><span class="se">\w</span><span class="o">+</span><span class="p">/</span><span class="o">,</span> <span class="o">*.</span><span class="nb">tc</span><span class="o">,</span> <span class="p">:</span><span class="s">g</span><span class="p">)</span> <span class="p">}</span>

    <span class="k">method</span> <span class="nb">AT-KEY</span> <span class="p">(</span><span class="vg">::?CLASS:D</span><span class="o">:</span> <span class="nv">$key</span><span class="p">)</span> <span class="k">is</span> <span class="k">rw</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">$element</span> <span class="o">:=</span> <span class="nv">%!fields</span><span class="p">{</span><span class="n">normalize-key</span> <span class="nv">$key</span><span class="p">};</span>

        <span class="nb">Proxy</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span>
            <span class="s">FETCH</span> <span class="o">=&gt;</span> <span class="k">method</span> <span class="p">()</span> <span class="p">{</span> <span class="nv">$element</span> <span class="p">}</span>,

            <span class="s">STORE</span> <span class="o">=&gt;</span> <span class="k">method</span> <span class="p">(</span><span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$element</span> <span class="o">=</span> <span class="nb">do</span> <span class="k">given</span> <span class="nv">$value</span><span class="o">Â».</span><span class="nb">split</span><span class="p">(/&#39;</span><span class="s1">,</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\s</span><span class="o">+</span><span class="p">/)</span><span class="o">.</span><span class="nb">flat</span> <span class="p">{</span>
                    <span class="k">when</span> <span class="mi">1</span>  <span class="p">{</span> <span class="o">.[</span><span class="mi">0</span><span class="o">]</span> <span class="p">}</span>    <span class="c1"># a single value is stored as a string</span>
                    <span class="k">default</span> <span class="p">{</span> <span class="o">.</span><span class="nb">Array</span> <span class="p">}</span>  <span class="c1"># multiple values are stored as an array</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="k">my</span> <span class="nv">$header</span> <span class="o">=</span> <span class="n">HTTPHeader</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$header</span><span class="o">.</span><span class="nb">WHAT</span><span class="p">;</span>  <span class="c1">#-&gt; (HTTPHeader)</span>
<span class="p">&#34;&#34;</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>

<span class="nv">$header</span><span class="p">&lt;</span><span class="s">Accept</span><span class="p">&gt;</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">text/plain</span><span class="p">&#34;;</span>
<span class="nv">$header</span><span class="p">{&#39;</span><span class="s1">Accept-</span><span class="p">&#39;</span> <span class="ow">X</span><span class="o">~</span> <span class="p">&lt;</span><span class="s">Charset Encoding Language</span><span class="p">&gt;}</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">utf-8 gzip en</span><span class="p">&gt;;</span>
<span class="nv">$header</span><span class="o">.</span><span class="nb">push</span><span class="p">(&#39;</span><span class="s1">Accept-Language</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">fr</span><span class="p">&#34;);</span>  <span class="c1"># like .push on a Hash</span>

<span class="nb">say</span> <span class="nv">$header</span><span class="o">.</span><span class="nb">hash</span><span class="o">.</span><span class="nb">fmt</span><span class="p">;</span>
<span class="p">&#34;&#34;</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>
<span class="c1"># say $header.Str; # åŒä¸Š</span>

<span class="nb">say</span> <span class="nv">$header</span><span class="p">&lt;</span><span class="s">Accept-Language</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">values</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$header</span><span class="p">&lt;</span><span class="s">Accept-Charset</span><span class="p">&gt;;</span>
</code></pre></div><p>è¾“å‡ºï¼š</p>
<pre><code>(HTTPHeader)

Accept	text/plain
Accept-Charset	utf-8
Accept-Encoding	gzip
Accept-Language	en fr

(en fr)
utf-8
</code></pre><p>åŒæ ·, ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æ•°ç»„ä¸‹æ ‡, åªè¦ä½ é‡å†™ç›¸åº”åœ°æ–¹æ³•ã€‚</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/subscript" term="subscript" label="subscript" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[åœ¨ Raku ä¸­æ€ä¹ˆä¸ºå·²å­˜åœ¨çš„ç±»æ·»åŠ æ–¹æ³•]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-11-11-add-a-method-to-an-existing-class-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2015-11-20-guess-who/?utm_source=atom_feed" rel="related" type="text/html" title="Guess Who" />
                <link href="https://ohmyweekly.github.io/notes/2015-06-10-list-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="List in Raku" />
                <link href="https://ohmyweekly.github.io/notes/2016-01-28-the-s-operator-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="Raku ä¸­çš„ S/// æ“ä½œç¬¦" />
                <link href="https://ohmyweekly.github.io/notes/2015-12-11-twigils-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="Raku ä¸­çš„ twigil" />
                <link href="https://ohmyweekly.github.io/notes/2016-01-04-an-example-of-raku-subset-and-multi/?utm_source=atom_feed" rel="related" type="text/html" title="ä½¿ç”¨ Raku çš„ subsets å’Œ multi è¾¨åˆ«å¹´é¾„" />
            
                <id>https://ohmyweekly.github.io/notes/2015-11-11-add-a-method-to-an-existing-class-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Add a Method to an Existing Class in Raku</blockquote><h2 id="raku-ä¸­æ€ä¹ˆä¸ºå·²å­˜åœ¨çš„ç±»æ·»åŠ æ–¹æ³•">Raku ä¸­æ€ä¹ˆä¸ºå·²å­˜åœ¨çš„ç±»æ·»åŠ æ–¹æ³•</h2>
<p>Int ç±»æœ‰ä¸€ä¸ªæ–¹æ³•å«åš <code>is-prime</code>, æˆ‘æƒ³ä¸º <code>Int</code> ç±»å‹æ·»åŠ å…¶å®ƒçš„æ–¹æ³•ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">MyInt</span> <span class="k">is</span> <span class="nb">Int</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">is-even</span> <span class="p">()</span> <span class="k">returns</span> <span class="nb">Bool:D</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">False</span> <span class="k">if</span> <span class="nb">self</span> <span class="nv">%</span> <span class="mi">2</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">True</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$n</span> <span class="o">=</span> <span class="n">MyInt</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="mi">138</span><span class="p">);</span>
<span class="nb">say</span> <span class="nv">$n</span><span class="o">.</span><span class="nf">is-even</span><span class="p">;</span>
</code></pre></div><p>é€šè¿‡ç±»çš„ç»§æ‰¿ä¹Ÿæ˜¯ä¸€ç§æ–¹æ³•, ä½†æ˜¯ä¸æ˜¯æˆ‘æƒ³è¦çš„ã€‚Swift ä¸­å¯ä»¥é€šè¿‡æ‰©å±•æ¥å®ç°, Raku ä¸­æœ‰ä¸€ä¸ª <code>add_method</code> æ–¹æ³•:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">method</span> <span class="nb">add_method</span><span class="p">(</span><span class="n">Metamodel::MethodContainer:</span> <span class="nv">$obj</span><span class="o">,</span> <span class="nv">$name</span><span class="o">,</span> <span class="nv">$code</span><span class="p">)</span>
</code></pre></div><p>è¿™ä¼šç»™å…ƒç±»(meta class)æ·»åŠ ä¸€ä¸ªæ–¹æ³•, ä½¿ç”¨ <code>$name</code> ä½œä¸ºè°ƒç”¨çš„æ–¹æ³•åã€‚è¿™åªä¼šåœ¨ç±»å‹è¢«ç»„åˆå‰ä½¿ç”¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">Int</span><span class="o">.^</span><span class="nb">add_method</span><span class="p">(</span> <span class="p">&#39;</span><span class="s1">is-even</span><span class="p">&#39;</span><span class="o">,</span> <span class="k">method</span> <span class="p">()</span> <span class="k">returns</span> <span class="nb">Bool:D</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">False</span> <span class="k">if</span> <span class="nb">self</span> <span class="nv">%</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">return</span> <span class="nb">True</span><span class="p">;</span>
    <span class="p">}</span> <span class="p">);</span>

<span class="nb">say</span> <span class="mi">137</span><span class="o">.</span><span class="nf">is-even</span><span class="p">;</span>
<span class="nb">say</span> <span class="nb">Int</span><span class="o">.^</span><span class="nb">methods</span><span class="p">;</span>
</code></pre></div><p>å¦‚æœæˆ‘è°ƒç”¨ <code>Int.^methods</code> æ—¶, <code>is-even</code> æ²¡æœ‰å‡ºç°ã€‚ä½†æ˜¯ä¸Šé¢çš„ä»£ç èƒ½è¢«è°ƒç”¨å¹¶èµ·ä½œç”¨äº†ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">Int</span><span class="o">.^</span><span class="nb">add_method</span><span class="p">(&#39;</span><span class="s1">fac</span><span class="p">&#39;</span><span class="o">,</span> <span class="k">method</span> <span class="p">()</span> <span class="k">returns</span> <span class="nb">Int:D</span> <span class="p">{</span>
     <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="nb">self</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
     <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="nb">self</span> <span class="o">==</span> <span class="mi">1</span><span class="p">;</span>
     <span class="k">my</span> <span class="nv">$sum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="k">for</span> <span class="mi">1</span> <span class="o">..</span> <span class="nb">self</span>  <span class="p">{</span><span class="nv">$sum</span> <span class="o">*=</span> <span class="nv">$_</span><span class="p">};</span> <span class="k">return</span> <span class="nv">$sum</span><span class="p">;</span>
<span class="p">});</span>

<span class="mi">1</span><span class="o">.</span><span class="nf">fac</span> <span class="c1"># 1</span>
<span class="mi">5</span><span class="o">.</span><span class="nf">fac</span> <span class="c1"># 120</span>
</code></pre></div><p><code>method</code> åé¢çš„åœ†æ‹¬å·æ˜¯æ–¹æ³•çš„ç­¾åï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">Int</span><span class="o">.^</span><span class="nb">add_method</span><span class="p">(&#39;</span><span class="s1">power</span><span class="p">&#39;</span><span class="o">,</span> <span class="k">method</span> <span class="p">(</span><span class="nb">Int</span> <span class="nv">$num</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Int:D</span> <span class="p">{</span>
     <span class="k">return</span> <span class="nb">self</span> <span class="o">**</span> <span class="nv">$num</span><span class="p">;</span>
<span class="p">});</span>

<span class="mi">2</span><span class="o">.</span><span class="nf">power</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>  <span class="c1"># 8</span>
<span class="mi">2</span><span class="o">.</span><span class="nf">power</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span> <span class="c1"># 1024</span>
</code></pre></div><h2 id="è¯æ³•æ–¹æ³•">è¯æ³•æ–¹æ³•</h2>
<p>æˆ‘å¯ä»¥è®©æ–¹æ³•ä¸ä¾é™„äºä»»ä½•ç±», å¹¶ä¸”èƒ½åœ¨å¯¹è±¡ä¸Šè°ƒç”¨è¯¥æ–¹æ³•:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">&amp;is-even</span> <span class="o">=</span> <span class="k">method</span> <span class="p">(</span><span class="nb">Int:D</span> <span class="o">:</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool:D</span> <span class="p">{</span> <span class="nb">self</span> <span class="nv">%%</span> <span class="mi">2</span> <span class="p">};</span>
</code></pre></div><p>è¿™æ„å»ºäº†ä¸€ä¸ª <code>Callable</code>ï¼ˆæŸ¥çœ‹ä»¥ä¸‹ <code>&amp;is-even.WHAT</code>ï¼‰ã€‚ åœ¨ç­¾åä¸­, æˆ‘æŠŠå®ƒçº¦æŸä¸ºä¸€ä¸ªå®šä¹‰äº†çš„ Int ç±»å‹çš„å€¼(<code>Int:D</code>), ä½†æ˜¯æ²¡æœ‰ç»™å®ƒåå­—ã€‚æˆ‘åœ¨ç±»å‹çº¦æŸåé¢æ·»åŠ å†’å·æ¥è¯´æ˜ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è°ƒç”¨è€…ã€‚ç°åœ¨æˆ‘èƒ½æŠŠè¿™ä¸ªæ–¹æ³•åº”ç”¨åˆ°ä»»ä½•æˆ‘æƒ³è¦çš„å¯¹è±¡ä¸Š:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="mi">137</span><span class="o">.&amp;</span><span class="nf">is-even</span><span class="p">;</span>
<span class="nb">say</span> <span class="mi">138</span><span class="o">.&amp;</span><span class="nf">is-even</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">foo</span><span class="p">&#34;</span><span class="o">.&amp;</span><span class="nf">is-even</span><span class="p">;</span>  <span class="c1"># works, although inside is-even blow up</span>
</code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[åœ¨ Raku ä¸­æ‰§è¡Œæœ‰è¶…æ—¶çš„å¤–éƒ¨ç¨‹åº]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-05-14-execute-an-external-program-with-timeout-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-05-14-execute-an-external-program-with-timeout-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Execute an External Program With Timeout in Raku</blockquote><p>Proc::Async å…è®¸æˆ‘ä»¬å¼‚æ­¥åœ°æ‰§è¡Œå¤–éƒ¨ç¨‹åºã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$proc</span> <span class="o">=</span> <span class="nb">Proc::Async</span><span class="o">.</span><span class="nb">new</span><span class="p">(&#34;</span><span class="s2">curl</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">-s</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">-o</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">index.html</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">http://www.cpan.org</span><span class="p">&#34;);</span>
<span class="k">my</span> <span class="nv">$res</span> <span class="o">=</span> <span class="nb">await</span> <span class="nv">$proc</span><span class="o">.</span><span class="k">start</span><span class="p">;</span>
</code></pre></div><p>æˆ‘ä»¬å¯ä»¥åœ¨ Proc::Async ä¸­ä½¿ç”¨è¶…æ—¶å—? Proc::Async æ²¡æœ‰æ­£å¼æ”¯æŒè¯¥åŠŸèƒ½ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°å®ç°å®ƒã€‚çœ‹ä¸€ä¸‹è¿™ä¸ªï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Proc::Async::Timeout</span> <span class="k">is</span> <span class="nb">Proc::Async</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.timeout</span> <span class="k">is</span> <span class="k">rw</span><span class="p">;</span>
    <span class="k">method</span> <span class="k">start</span><span class="p">(</span><span class="nv">$self:</span> <span class="o">|</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">callsame</span> <span class="k">unless</span> <span class="nv">$.timeout</span><span class="p">;</span>

        <span class="k">my</span> <span class="nv">$killer</span> <span class="o">=</span> <span class="nb">Promise</span><span class="o">.</span><span class="nb">in</span><span class="p">(</span><span class="nv">$.timeout</span><span class="p">)</span><span class="o">.</span><span class="nb">then</span><span class="o">:</span> <span class="p">{</span> <span class="nv">$self</span><span class="o">.</span><span class="nb">kill</span> <span class="p">};</span>
        <span class="k">my</span> <span class="nv">$promise</span> <span class="o">=</span> <span class="nb">callsame</span><span class="p">;</span>

        <span class="nb">Promise</span><span class="o">.</span><span class="nb">anyof</span><span class="p">(</span><span class="nv">$promise</span><span class="o">,</span> <span class="nv">$killer</span><span class="p">)</span><span class="o">.</span><span class="nb">then</span><span class="o">:</span> <span class="p">{</span> <span class="nv">$promise</span><span class="o">.</span><span class="nb">result</span> <span class="p">};</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$proc</span> <span class="o">=</span> <span class="n">Proc::Async::Timeout</span><span class="o">.</span><span class="nb">new</span><span class="p">(&#34;</span><span class="s2">perl</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">-E</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">sleep 5; warn &#39;end&#39;</span><span class="p">&#34;);</span>
<span class="nv">$proc</span><span class="o">.</span><span class="nf">timeout</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$res</span> <span class="o">=</span> <span class="nb">await</span> <span class="nv">$proc</span><span class="o">.</span><span class="k">start</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">maybe timeout</span><span class="p">&#34;</span> <span class="k">if</span> <span class="nv">$res</span><span class="o">.</span><span class="nb">signal</span><span class="p">;</span>
</code></pre></div><p>ä½ ç”šè‡³å¯ä»¥è¿™æ ·åšï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$start</span> <span class="o">=</span> <span class="nb">Proc::Async</span><span class="o">.^</span><span class="nb">methods</span><span class="o">.</span><span class="nb">first</span><span class="p">(</span><span class="o">*.</span><span class="nb">name</span> <span class="ow">eq</span> <span class="p">&#34;</span><span class="s2">start</span><span class="p">&#34;);</span>

<span class="nv">$start</span><span class="o">.</span><span class="nb">wrap</span><span class="o">:</span> <span class="k">method</span> <span class="p">(</span><span class="nv">$self:</span> <span class="o">:</span><span class="nv">$timeout</span><span class="o">,</span> <span class="o">|</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">callwith</span><span class="p">(</span><span class="nv">$self</span><span class="o">,</span> <span class="o">|</span><span class="n">c</span><span class="p">)</span> <span class="k">unless</span> <span class="nv">$timeout</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">$killer</span> <span class="o">=</span> <span class="nb">Promise</span><span class="o">.</span><span class="nb">in</span><span class="p">(</span><span class="nv">$timeout</span><span class="p">)</span><span class="o">.</span><span class="nb">then</span><span class="o">:</span> <span class="p">{</span> <span class="nv">$self</span><span class="o">.</span><span class="nb">kill</span> <span class="p">};</span>
    <span class="k">my</span> <span class="nv">$promise</span> <span class="o">=</span> <span class="nb">callwith</span><span class="p">(</span><span class="nv">$self</span><span class="o">,</span> <span class="o">|</span><span class="n">c</span><span class="p">);</span>
    
    <span class="nb">Promise</span><span class="o">.</span><span class="nb">anyof</span><span class="p">(</span><span class="nv">$promise</span><span class="o">,</span> <span class="nv">$killer</span><span class="p">)</span><span class="o">.</span><span class="nb">then</span><span class="o">:</span> <span class="p">{</span> <span class="nv">$promise</span><span class="o">.</span><span class="nb">result</span> <span class="p">};</span>
<span class="p">};</span>

<span class="nb">say</span> <span class="nb">await</span> <span class="nb">Proc::Async</span><span class="o">.</span><span class="nb">new</span><span class="p">(&#34;</span><span class="s2">perl</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">-E</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">sleep 3; say &#34;end&#34;</span><span class="p">&#39;)</span><span class="o">.</span><span class="k">start</span><span class="p">(</span><span class="s">timeout</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">);</span>
</code></pre></div><p>å“‡ï¼Œå“‡ï¼å¦‚æœä½ å‘ç°äº†æ›´é…·çš„æ–¹æ³•ï¼Œè¯·å‘Šè¯‰æˆ‘ã€‚</p>
<p><a href="http://ks0608.hatenablog.com/entry/2016/05/17/001826">http://ks0608.hatenablog.com/entry/2016/05/17/001826</a></p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/proc" term="proc" label="proc" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[åœ¨ Raku ä¸­è‡ªå®šä¹‰å­˜å–å™¨]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-05-19-how-to-write-custom-accessor-methods-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-05-19-how-to-write-custom-accessor-methods-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>How to Write Custom Accessor Methods in Raku</blockquote><h2 id="how-does-one-write-custom-accessor-methods-in-raku">How does one write custom accessor methods in Raku?</h2>
<p>æˆ‘æœ‰ä¸€ä¸ªç±»:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Wizard</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nb">Int</span> <span class="nv">$.mana</span> <span class="k">is</span> <span class="k">rw</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>æˆ‘å¯ä»¥è¿™æ ·åš:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="n">Wizard</span> <span class="nv">$gandalf</span> <span class="o">.=</span> <span class="nb">new</span><span class="p">;</span>
<span class="nv">$gandalf</span><span class="o">.</span><span class="nf">mana</span> <span class="o">=</span> <span class="mi">150</span><span class="p">;</span>
</code></pre></div><p>æˆ‘æƒ³åœ¨ä¸æ”¾å¼ƒä½¿ç”¨ <code>$gandalf.mana = 150;</code> çš„æƒ…å†µä¸‹, åœ¨ <code>setter</code> é‡Œé¢åšä¸€äº›æ£€æŸ¥ã€‚æ¢å¥è¯è¯´, æˆ‘ä¸æƒ³è¿™æ ·å†™: <code>$gandalf.setMana(150)</code>ã€‚ å¦‚æœç¨‹åºå°è¯•è®¾ç½®ä¸€ä¸ªè´Ÿå€¼çš„è¯, å°±é€€å‡ºã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Wizard</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nb">Int</span> <span class="nv">$!mana</span><span class="p">;</span>

    <span class="k">method</span> <span class="nf">mana</span><span class="p">()</span> <span class="k">is</span> <span class="k">rw</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">Proxy</span><span class="o">.</span><span class="nb">new</span><span class="o">:</span>
            <span class="s">FETCH</span> <span class="o">=&gt;</span> <span class="k">sub</span> <span class="p">(</span><span class="nv">$</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$!mana</span> <span class="p">}</span>,
            <span class="s">STORE</span> <span class="o">=&gt;</span> <span class="k">sub</span> <span class="p">(</span><span class="nv">$</span>, <span class="nv">$mana</span><span class="p">)</span> <span class="p">{</span>
                <span class="nb">die</span> <span class="p">&#34;</span><span class="s2">It&#39;s over 9000!</span><span class="p">&#34;</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$mana</span> <span class="o">//</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">9000</span><span class="p">;</span>
                <span class="nv">$!mana</span> <span class="o">=</span> <span class="nv">$mana</span><span class="p">;</span>
            <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="n">Wizard</span> <span class="nv">$gandalf</span> <span class="o">.=</span> <span class="nb">new</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$gandalf</span><span class="o">.</span><span class="nf">mana</span><span class="p">;</span>
<span class="nv">$gandalf</span><span class="o">.</span><span class="nf">mana</span> <span class="o">=</span> <span class="mi">150</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$gandalf</span><span class="o">.</span><span class="nf">mana</span><span class="p">;</span>
</code></pre></div><p><code>Pxoxy</code> æ˜¯ä¸€ç§æ‹¦æˆªå¯¹å­˜å‚¨è¿›è¡Œè¯»å†™è°ƒç”¨, å¹¶åšä¸€äº›éé»˜è®¤è¡Œä¸ºçš„æ–¹å¼ã€‚åœ¨è§£æåƒ <code>$gandalf.mana = $gandalf.mana + 5</code> è¿™ç§è¡¨è¾¾å¼çš„æ—¶å€™, Raku ä¼šè‡ªåŠ¨è°ƒç”¨ <code>FETCH</code> å’Œ <code>STORE</code> æ–¹æ³•ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Baby</span> <span class="p">{</span>
    <span class="c1"># use . instead of ! for better `.raku` representation  </span>
    <span class="k">has</span> <span class="nb">Int</span> <span class="nv">$.mana</span><span class="p">;</span> 

    <span class="c1"># overwrite the method the attribute declaration added</span>
    <span class="k">method</span> <span class="nf">mana</span> <span class="p">()</span> <span class="k">is</span> <span class="k">rw</span> <span class="p">{</span>
        <span class="nb">Proxy</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span>
            <span class="s">FETCH</span> <span class="o">=&gt;</span> <span class="k">-&gt;</span> <span class="nv">$</span> <span class="p">{</span> <span class="nv">$!mana</span> <span class="p">}</span>,
            <span class="s">STORE</span> <span class="o">=&gt;</span> <span class="k">-&gt;</span> <span class="nv">$</span>, <span class="nb">Int</span> <span class="nv">$new</span> <span class="p">{</span>
                <span class="nb">die</span> <span class="p">&#39;</span><span class="s1">invalid mana</span><span class="p">&#39;</span> <span class="k">unless</span> <span class="nv">$new</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1"># placeholder for a better error</span>
                <span class="nv">$!mana</span> <span class="o">=</span> <span class="nv">$new</span><span class="p">;</span>
        <span class="p">})</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="n">Baby</span> <span class="nv">$baby</span> <span class="o">.=</span> <span class="nb">new</span><span class="p">;</span>
<span class="nv">$baby</span><span class="o">.</span><span class="nf">mana</span> <span class="o">=</span> <span class="mi">9</span><span class="p">;</span>

<span class="nb">say</span> <span class="nv">$baby</span><span class="o">.</span><span class="nf">mana</span><span class="p">;</span>
<span class="nv">$baby</span><span class="o">.</span><span class="nf">mana</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9</span><span class="p">;</span>
</code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/accessor" term="accessor" label="accessor" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[æ‰©å±• Raku ä¸­çš„ç±»å‹]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-11-25-there-is-more-than-one-way-to-extend-it/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-11-25-there-is-more-than-one-way-to-extend-it/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>There Is More Than One Way to Extend It</blockquote><h1 id="æ‰©å±•-raku-ä¸­çš„ç±»å‹">æ‰©å±• Raku ä¸­çš„ç±»å‹</h1>
<h2 id="ä½¿ç”¨ç»§æ‰¿">ä½¿ç”¨ç»§æ‰¿</h2>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">BetterInt</span> <span class="k">is</span> <span class="nb">Int</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">even</span> <span class="p">{</span> <span class="nb">self</span> <span class="nv">%%</span> <span class="mi">2</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="n">BetterInt</span> <span class="nv">$x</span> <span class="o">.=</span> <span class="nb">new</span><span class="o">:</span> <span class="mi">42</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$x</span><span class="o">.</span><span class="nf">even</span><span class="p">;</span>

<span class="nv">$x</span> <span class="o">.=</span> <span class="nb">new</span><span class="o">:</span> <span class="mi">71</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$x</span><span class="o">.</span><span class="nf">even</span><span class="p">;</span>

<span class="nb">say</span> <span class="nv">$x</span> <span class="o">+</span> <span class="mi">42</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># True</span>
<span class="c1"># False</span>
<span class="c1"># 113</span>
</code></pre></div><p><code>my BetterInt $x</code> çº¦æŸ <code>$x</code> åªèƒ½åŒ…å«  <em>BetterInt</em> æˆ–å®ƒçš„å­ç±»è¿™ç§ç±»å‹çš„å¯¹è±¡ã€‚<code>.= new: 42</code> ç­‰ä»·äº <code>= BetterInt.new: 42</code>ã€‚
ä¸‹é¢çš„å­ä¾‹ç¨‹æœŸæœ›æ¥æ”¶ä¸€ä¸ª <em>Int</em> å‹çš„å‚æ•°ï¼Œä½†æ˜¯ä½ ç»™å®ƒä¼ é€’ä¸€ä¸ª <em>BetterInt</em> ç±»å‹çš„å‚æ•°å®ƒä¼šå¾ˆé«˜å…´:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">foo</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">\$x is </span><span class="nv">$x</span><span class="p">&#34;}</span>

<span class="k">my</span> <span class="n">BetterInt</span> <span class="nv">$x</span> <span class="o">.=</span> <span class="nb">new</span><span class="o">:</span> <span class="mi">42</span><span class="p">;</span>
<span class="n">foo</span> <span class="nv">$x</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># $x is 42</span>
</code></pre></div><h2 id="but-but-but">But&hellip; But&hellip; But&hellip;</h2>
<p>å¦å¤–ä¸€ä¸ªé€‰æ‹©æ˜¯æºåˆè¿›ä¸€ä¸ªè§’è‰²(role)ã€‚<em>but</em> ä¸­ç¼€æ“ä½œç¬¦åˆ›å»ºå¯¹è±¡çš„ä¸€ä»½æ‹·è´å¹¶ä¸ºè¯¥å¯¹è±¡æ·»åŠ ä¸€ä¸ªæ–¹æ³•:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$x</span> <span class="o">=</span> <span class="mi">42</span> <span class="k">but</span> <span class="k">role</span> <span class="p">{</span> <span class="k">method</span> <span class="nf">even</span> <span class="p">{</span> <span class="nb">self</span> <span class="nv">%%</span> <span class="mi">2</span> <span class="p">}</span> <span class="p">};</span>
<span class="nb">say</span> <span class="nv">$x</span><span class="o">.</span><span class="nf">even</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># True</span>
</code></pre></div><p>å½“ç„¶è§’è‰²ä¸ä¸€å®šæ˜¯å†…è”çš„ã€‚è¿™å„¿æœ‰å¦å¤–ä¸€ä¸ªä¾‹å­ä½¿ç”¨äº†ä¸€ä¸ªé¢„å®šä¹‰çš„è§’è‰²å¹¶ä¸”è¿˜å±•ç¤ºäº†æˆ‘ä»¬çš„å¯¹è±¡ç¡®å®è¢«æ‹·è´äº†ä¸€ä»½ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">Better</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">better</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">Yes, I am better</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.attr</span> <span class="k">is</span> <span class="k">rw</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$original</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="nb">new</span><span class="o">:</span> <span class="p">:</span><span class="s">attr</span><span class="p">&lt;</span><span class="s">original</span><span class="p">&gt;;</span>
<span class="k">my</span> <span class="nv">$copy</span>     <span class="o">=</span> <span class="nv">$original</span> <span class="k">but</span> <span class="nc">Better</span><span class="p">;</span>
<span class="nv">$copy</span><span class="o">.</span><span class="nf">attr</span>   <span class="o">=</span> <span class="p">&#39;</span><span class="s1">copy</span><span class="p">&#39;;</span>

<span class="nb">say</span> <span class="nv">$original</span><span class="o">.</span><span class="nf">attr</span><span class="p">;</span>  <span class="c1"># still &#39;original&#39;</span>
<span class="nb">say</span> <span class="nv">$copy</span><span class="o">.</span><span class="nf">attr</span><span class="p">;</span>      <span class="c1"># this one is &#39;copy&#39;</span>

<span class="nb">say</span> <span class="nv">$copy</span><span class="o">.</span><span class="nf">better</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$original</span><span class="o">.</span><span class="nf">better</span><span class="p">;</span> <span class="c1"># fatal error: can&#39;t find method</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># original</span>
<span class="c1"># copy</span>
<span class="c1"># Yes, I am better</span>
<span class="c1"># Method &#39;better&#39; not found for invocant of class &#39;Foo&#39;</span>
<span class="c1">#   in block &lt;unit&gt; at test.p6 line 18</span>
</code></pre></div><p>è¿™çœ‹èµ·æ¥æŒºä¸é”™çš„ï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬åŸæ¥çš„ç›®æ ‡æ¥è¯´ï¼Œè¿™ä¸ªæ–¹æ³•è¿˜æ˜¯ç›¸å½“å¼±çš„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$x</span> <span class="o">=</span> <span class="mi">42</span> <span class="k">but</span> <span class="k">role</span> <span class="p">{</span> <span class="k">method</span> <span class="nf">even</span> <span class="p">{</span> <span class="nb">self</span> <span class="nv">%%</span> <span class="mi">2</span> <span class="p">}</span> <span class="p">};</span>
<span class="nb">say</span> <span class="nv">$x</span><span class="o">.</span><span class="nf">even</span><span class="p">;</span> <span class="c1"># True</span>
<span class="nv">$x</span> <span class="o">=</span> <span class="mi">72</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$x</span><span class="o">.</span><span class="nf">even</span><span class="p">;</span> <span class="c1"># No such method!</span>
</code></pre></div><p>é‚£ä¸ªè§’è‰²è¢«æ··åˆè¿›æˆ‘ä»¬å®¹å™¨é‡Œé¢å­˜å‚¨çš„å¯¹è±¡ä¸­äº†ï¼›æ‰€ä»¥ä¸€æ—¦æˆ‘ä»¬åœ¨å®¹å™¨ä¸­æ”¾è¿›äº†ä¸€ä¸ªæ–°çš„å€¼ï¼Œæˆ–é«˜çº§ç‚¹çš„ä¸œè¥¿ï¼Œé‚£ä¹ˆ <em>.even</em> æ–¹æ³•å°±ä¸è§äº†ï¼Œé™¤éæˆ‘ä»¬å†æ¬¡æŠŠé‚£ä¸ªè§’è‰²æ··åˆè¿›æ¥ã€‚</p>
<h2 id="å­ä¾‹ç¨‹">å­ä¾‹ç¨‹</h2>
<p>ä½ çŸ¥é“ä½ å¯ä»¥æŠŠå­ä¾‹ç¨‹å½“åšæ–¹æ³•ç”¨å˜›ï¼Ÿ ä½ æ¥æ”¶é‚£ä¸ªå¯¹è±¡ä½œä¸ºå­ä¾‹ç¨‹çš„ç¬¬ä¸€ä¸ªä½ç½®å‚æ•°å¹¶ä¸”ä½ ç”šè‡³èƒ½ç»§ç»­ä½¿ç”¨é“¾å¼æ–¹æ³•è°ƒç”¨ï¼Œä½†æ˜¯ä¸èƒ½æŠŠé‚£äº›é“¾å­åˆ†è§£æˆå¤šè¡Œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">even</span> <span class="p">{</span> <span class="nv">$^a</span> <span class="nv">%%</span> <span class="mi">2</span> <span class="p">};</span>
<span class="nb">say</span> <span class="mi">42</span><span class="o">.&amp;</span><span class="nf">even</span><span class="o">.</span><span class="nb">uc</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># TRUE</span>
</code></pre></div><p>è¿™ç¡®å®æ˜¯ä¸ºæ ¸å¿ƒç±»å‹æ·»åŠ é¢å¤–åŠŸèƒ½çš„ä¸€ç§å¾—ä½“æ–¹å¼ã€‚æˆ‘ä»¬çš„å­ä¾‹ç¨‹å®šä¹‰ä¸­çš„ <code>$^a</code> å¼•ç”¨ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆæˆ‘ä»¬åœ¨è°ƒç”¨çš„é‚£ä¸ªå¯¹è±¡ï¼‰å¹¶ä¸”æ•´ä¸ªå­ä¾‹ç¨‹ä¹Ÿå¯ä»¥è¢«å†™ä¸ºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$x</span> <span class="nv">%%</span> <span class="mi">2</span> <span class="p">}</span>
</code></pre></div><h2 id="é£é¾™åœ¨å¤©">é£é¾™åœ¨å¤©</h2>
<p>ä¸ç®¡<a href="http://shop.oreilly.com/product/9780596517748.do">Javaccript çš„é‚£äº›äººä»¬æ€ä¹ˆè·Ÿä½ è¯´</a>, ç„¶è€Œæ‰©å……åŸç”Ÿç±»å‹æ˜¯å±é™©çš„ã€‚å› ä¸ºä½ æ­£å½±å“ç¨‹åºçš„æ‰€æœ‰éƒ¨åˆ†ã€‚ç”šè‡³çœ‹ä¸åˆ°ä½ çš„æ‰©å……çš„æ¨¡å—ä¹Ÿå—åˆ°å½±å“ã€‚</p>
<p>ç°åœ¨æˆ‘æœ‰æƒå‘Šè¯‰ä½ ï¼Œæˆ‘è·Ÿä½ è¯´è¿‡ï¼Œä½ å·¥ä½œçš„æ ¸ç”µå‚èåŒ–äº†ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ä¸€äº›ä»£ç ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># Foo.pm6</span>
<span class="k">unit</span> <span class="k">module</span> <span class="nn">Foo</span><span class="p">;</span>

<span class="k">sub</span> <span class="nf">fob</span> <span class="k">is</span> <span class="k">export</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="mi">42</span><span class="o">.</span><span class="nf">even</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># Bar.pm6</span>
<span class="k">unit</span> <span class="k">module</span> <span class="nn">Bar</span><span class="p">;</span>

<span class="k">use</span> <span class="nb">MONKEY-TYPING</span><span class="p">;</span>

<span class="k">augment</span> <span class="k">class</span> <span class="nb">Int</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">even</span> <span class="p">{</span> <span class="nb">self</span> <span class="nv">%%</span> <span class="mi">2</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># test.p6</span>
<span class="k">use</span> <span class="nn">Foo</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">Bar</span><span class="p">;</span>

<span class="nb">say</span> <span class="mi">72</span><span class="o">.</span><span class="nf">even</span><span class="p">;</span>
<span class="n">fob</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># True</span>
<span class="c1"># True</span>
</code></pre></div><p>æ‰€æœ‰çš„è¡Œä¸ºéƒ½å‘ç”Ÿåœ¨ <em>Bar.pm6</em> ä¸­ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å†™äº†ä¸€è¡Œ <em>use MONKEY-TYPING</em> å£°æ˜ï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬æ­£åœ¨åšä¸€äº›å±é™©çš„è¡Œä¸ºã€‚ç„¶åæˆ‘ä»¬åœ¨ç±» <strong>class Int</strong> çš„å‰é¢ä½¿ç”¨äº† <em>augment</em> å…³é”®å­—ä»¥æ‰©å……è¿™ä¸ªå·²ç»å­˜åœ¨çš„ç±»ã€‚æˆ‘ä»¬çš„æ‰©å……æ·»åŠ äº†ä¸€ä¸ªå« <em>even</em> çš„æ–¹æ³•ä»¥å‘Šè¯‰æˆ‘ä»¬é‚£ä¸ª Int æ˜¯å¦æ˜¯å¶æ•°ã€‚</p>
<p>æ‰€æœ‰çš„æ•´æ•°éƒ½å¯ä»¥ä½¿ç”¨ <em>even</em> æ–¹æ³•äº†ï¼Œè¿™è™½ç„¶è¾¾åˆ°äº†æˆ‘ä»¬çš„è¦æ±‚ä½†æ˜¯æœ‰ç‚¹å±é™©ã€‚</p>
<h2 id="æˆ‘é‚ªæ¶äº†">æˆ‘é‚ªæ¶äº†</h2>
<p>æˆ‘ä»¬æ¥æ‰©å…… <a href="http://docs.raku.org/type/Cool">Cool ç±»å‹</a>ä»¥æ¶µç›–æ‰€æœ‰çš„è¥¿æ–‡æ’ç‰ˆè¡Œé•¿å•ä½ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">use</span> <span class="nb">MONKEY-TYPING</span><span class="p">;</span>

<span class="k">augment</span> <span class="k">class</span> <span class="nb">Cool</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">even</span> <span class="p">{</span> <span class="nb">self</span> <span class="nv">%%</span> <span class="mi">2</span> <span class="p">}</span>
<span class="p">}</span>

<span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="mi">72</span><span class="o">.</span><span class="nf">even</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">72</span><span class="p">&#39;</span><span class="o">.</span><span class="nf">even</span><span class="o">,</span> <span class="no">pi</span><span class="o">.</span><span class="nf">even</span><span class="o">,</span> Â½<span class="o">.</span><span class="nf">even</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># Method &#39;even&#39; not found for invocant of class &#39;Int&#39;</span>
<span class="c1"># in block &lt;unit&gt; at test.p6 line 8</span>
</code></pre></div><p>ç³Ÿç³•ï¼Œç¨‹åºå¥”æºƒäº†ï¼åŸå› æ˜¯åœ¨æˆ‘ä»¬æ‰©å…… <strong>Cool</strong> ç±»å‹çš„æ—¶å€™ï¼Œæ´¾ç”Ÿè‡ª <strong>Cool</strong> çš„æ‰€æœ‰ç±»å‹å·²ç»æˆå‹äº†(composed)ã€‚æ‰€ä»¥ä¸ºäº†è®©å®ƒèƒ½å·¥ä½œï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨ <code>.^compose</code> å…ƒå¯¹è±¡åè®®æ–¹æ³•æ¥é‡æ–°æ„æˆå®ƒä»¬ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">use</span> <span class="nb">MONKEY-TYPING</span><span class="p">;</span>

<span class="k">augment</span> <span class="k">class</span> <span class="nb">Cool</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">even</span> <span class="p">{</span> <span class="nb">self</span> <span class="nv">%%</span> <span class="mi">2</span> <span class="p">}</span>
<span class="p">}</span>

<span class="o">.^</span><span class="nb">compose</span> <span class="k">for</span> <span class="nb">Int</span><span class="o">,</span> <span class="nb">Num</span><span class="o">,</span> <span class="nb">Rat</span><span class="o">,</span> <span class="nb">Str</span><span class="o">,</span> <span class="nb">IntStr</span><span class="o">,</span> <span class="nb">NumStr</span><span class="o">,</span> <span class="nb">RatStr</span><span class="p">;</span>

<span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="mi">72</span><span class="o">.</span><span class="nf">even</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">72</span><span class="p">&#39;</span><span class="o">.</span><span class="nf">even</span><span class="o">,</span> <span class="no">pi</span><span class="o">.</span><span class="nf">even</span><span class="o">,</span> Â½<span class="o">.</span><span class="nf">even</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># True</span>
<span class="c1"># True</span>
<span class="c1"># False</span>
<span class="c1"># False</span>
</code></pre></div><p>å®ƒç°åœ¨èƒ½å·¥ä½œäº†ï¼Int, Num, Rat, Str, IntStr, NumStr, RatStr ç±»å‹æ‹¥æœ‰äº† <code>.even</code> æ–¹æ³•(æ³¨æ„ï¼šè¿™äº›ä¸æ˜¯ç»§æ‰¿è‡ª Cool çš„ä»…æœ‰çš„ç±»å‹)! è¿™æ—¢é‚ªæ¶åˆè®©äººåƒæƒŠã€‚</p>
<h2 id="ç»“è®º">ç»“è®º</h2>
<p>å½“æ‰©å…… Raku çš„æ ¸å¿ƒç±»å‹æˆ–å…¶å®ƒä»»æ„ç±»çš„åŠŸèƒ½æ—¶ï¼Œä½ æœ‰å‡ ç§é€‰æ‹©ã€‚</p>
<ul>
<li>ä½¿ç”¨ <strong>is Class</strong> å­ç±»</li>
<li>ä½¿ç”¨ <strong>but Role</strong> æ··åˆä¸€ä¸ªè§’è‰²</li>
<li>ä½¿ç”¨ <code>$objec.&amp;sub</code> è°ƒç”¨å­ä¾‹ç¨‹ä½œä¸ºæ–¹æ³•ä½¿ç”¨</li>
<li>ä½¿ç”¨  augmentï¼ˆæ³¨æ„å®‰å…¨ï¼‰</li>
</ul>
<p><a href="http://blogs.perl.org/users/zoffix_znet/2016/04/extra-typical-perl-6.html">http://blogs.perl.org/users/zoffix_znet/2016/04/extra-typical-perl-6.html</a></p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/but" term="but" label="but" />
                             
                                <category scheme="https://ohmyweekly.github.io/tags/compose" term="compose" label="compose" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[æ‰¾åˆ°ä¸¤ä¸ªæ–‡ä»¶ä¸­å…±æœ‰çš„è¡Œ]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-06-18-find-the-common-lines-in-two-files/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-06-18-find-the-common-lines-in-two-files/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Find the Common Lines in Two Files</blockquote><h2 id="æ‰¾å‡ºä¸¤ä¸ªæ–‡ä»¶ä¸­å…±æœ‰çš„è¡Œ-é¡ºåºæ— å…³ç´§è¦">æ‰¾å‡ºä¸¤ä¸ªæ–‡ä»¶ä¸­å…±æœ‰çš„è¡Œ, é¡ºåºæ— å…³ç´§è¦</h2>
<p>åœ¨ Perl 5 é‡Œ, ä½ å¯ä»¥è¿™æ ·:</p>
<div class="highlight"><pre class="chroma"><code class="language-perl" data-lang="perl"><span class="ch">#!/usr/bin/env perl</span>
<span class="k">use</span> <span class="mf">5.010</span><span class="p">;</span> <span class="k">use</span> <span class="nn">warnings</span><span class="p">;</span> <span class="k">use</span> <span class="nn">strict</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">%filea</span> <span class="o">=</span> <span class="nb">map</span> <span class="p">{</span> <span class="nv">$_</span> <span class="o">=&gt;</span> <span class="mi">1</span> <span class="p">}</span> <span class="k">do</span> <span class="p">{</span> <span class="nb">open</span> <span class="k">my</span> <span class="nv">$fa</span><span class="p">,</span> <span class="s">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s">&#39;filea&#39;</span> <span class="ow">or</span> <span class="nb">die</span> <span class="vg">$!</span><span class="p">;</span> <span class="sr">&lt;$fa&gt;</span> <span class="p">};</span>
<span class="k">my</span> <span class="nv">%fileb</span> <span class="o">=</span> <span class="nb">map</span> <span class="p">{</span> <span class="nv">$_</span> <span class="o">=&gt;</span> <span class="mi">1</span> <span class="p">}</span> <span class="k">do</span> <span class="p">{</span> <span class="nb">open</span> <span class="k">my</span> <span class="nv">$fb</span><span class="p">,</span> <span class="s">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s">&#39;fileb&#39;</span> <span class="ow">or</span> <span class="nb">die</span> <span class="vg">$!</span><span class="p">;</span> <span class="sr">&lt;$fb&gt;</span> <span class="p">};</span>
<span class="k">for</span><span class="p">(</span> <span class="nb">keys</span> <span class="nv">%filea</span> <span class="p">){</span>
    <span class="k">print</span> <span class="k">if</span> <span class="nv">$fileb</span><span class="p">{</span><span class="nv">$_</span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div><p>åœ¨ Raku ä¸­å°±é•¿è¿™æ ·:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#!/usr/bin/env raku</span>

<span class="k">my</span> <span class="nv">@a</span> <span class="o">:=</span> <span class="p">&#34;</span><span class="s2">filea</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">lines</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">@b</span> <span class="o">:=</span> <span class="p">&#34;</span><span class="s2">fileb</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">lines</span><span class="p">;</span>
<span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="nb">keys</span><span class="p">(</span> <span class="nv">@a</span> <span class="o">âˆ©</span> <span class="nv">@b</span> <span class="p">);</span>
</code></pre></div><p>å› ä¸º  Raku ä¸­çš„&quot;æƒ°æ€§åˆ—è¡¨â€, åº•å±‚å®ç°èƒ½æŠŠå·¥ä½œåˆ†å‰²æˆä¸åŒçš„ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œ, ç„¶ååœ¨éœ€è¦ç»“æœçš„æ—¶å€™è¿”å›ç»™å®ƒä»¬ã€‚æ‰€ä»¥, è¿™ç§æƒ…å†µä¸‹, <code>@a</code> å’Œ <code>@b</code> çš„å¡«å……å¯ä»¥åŒæ—¶è¿è¡Œ.ä½†æ˜¯è¦ç‚¹æ˜¯, å¦‚æœä½ æœ‰è€—è´¹æ—¶é—´, ä¸å½¼æ­¤ä¾èµ–çš„æ“ä½œ, æˆ–è€…å‡½æ•° A è¦ä¼ é€’ä¸€ä¸ª item åˆ—è¡¨ç»™å‡½æ•° B, è¿™äº›æ“ä½œå¯èƒ½å¹¶è¡Œæ‰§è¡Œ, æé«˜é€Ÿåº¦, ä½ ä¸éœ€è¦åšä»»ä½•çº¿ç¨‹ç›¸å…³çš„ä¸œè¥¿ã€‚éå¸¸èµ!</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/set" term="set" label="set" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[æ¢ç´¢ Raku ä¸­çš„ç­¾å(ç¬¬äºŒéƒ¨åˆ†)]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-08-29-exploring-raku-signatures-part-two/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-08-29-exploring-raku-signatures-part-two/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Exploring Raku Signatures Part Two</blockquote><p>åœ¨æˆ‘ä»¬æ¢ç´¢ Raku ç­¾åçš„<a href="http://friedo.com/blog/2016/01/exploring-perl-6-signatures-part-1">ç¬¬ä¸€éƒ¨åˆ†</a>ä¸­, æˆ‘ä»¬äº†è§£äº†æ€ä¹ˆä½¿ç”¨ Raku å¼ºå¤§è€Œçµæ´»çš„ç±»å‹ç³»ç»Ÿæ¥çº¦æŸå…·åå‚æ•°å’Œä½ç½®å‚æ•°æ˜¯å¦‚ä½•è¢«ä¼ é€’ç»™å­ä¾‹ç¨‹å’Œæ–¹æ³•çš„ã€‚æˆ‘ä»¬è¿˜æ¶‰åŠäº†æ€ä¹ˆä½¿ç”¨ <em>slurp</em> ç­¾åæ¥åˆ›å»ºèƒ½æ¥æ”¶ä»»æ„å…·åå’Œä½ç½®å‚æ•°åˆ—è¡¨çš„å¯å˜å‡½æ•°ã€‚</p>
<p>Raku çš„ç­¾åç³»ç»Ÿæä¾›äº†æ›´å¤šã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬å°†éªŒè¯å…¶ä¸­æ›´é«˜çº§çš„ç‰¹æ€§, å®ƒä»¬è®© Raku çš„è°ƒç”¨è¯­ä¹‰æ›´å¼ºå¤§ã€‚</p>
<h2 id="class-çº¦æŸ">Class çº¦æŸ</h2>
<p>ä½ å¯ä»¥ä½¿ç”¨ç­¾åæ¥æŒ‡å®šä¼ é€’è¿›å‡½æ•°ä¸­çš„å‚æ•°çš„ç±»å‹çº¦æŸã€‚ä½ ä½¿ç”¨çš„ç±»å‹å¯ä»¥æ˜¯ä»»æ„ç±»åã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku">
<span class="k">sub</span> <span class="nf">foo</span><span class="p">(</span> <span class="nb">Numeric</span> <span class="nv">$foo</span><span class="o">,</span> <span class="nb">Str</span> <span class="nv">$bar</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">my string is </span><span class="nv">$bar</span><span class="s2"> and my number is </span><span class="nv">$foo</span><span class="p">&#34;</span>
<span class="p">}</span>
</code></pre></div><p>è¿™ä¸ªç­¾åè¦æ±‚æˆ‘ä»¬ä¼ é€’ <strong>Numeric</strong> å’Œ <strong>Str</strong> ç±»å‹çš„å‚æ•°ã€‚ä½†æ˜¯å› ä¸º Raku çš„å†…ç½®ç±»å‹å®é™…ä¸Šå°±æ˜¯ç±»(classes), å¹¶ä¸”å› ä¸º <strong>Numeric</strong> æ‹¥æœ‰å‡ ä¸ªå­ç±»å‹, æˆ‘ä»¬å¯ä»¥ä¼ é€’è¿›ä»»ä½•æ•°å­—ç±»å‹, å®ƒéƒ½èƒ½å·¥ä½œ:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nf">foo</span><span class="p">(</span><span class="mi">42</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">blah</span><span class="p">&#34;);</span>
<span class="nf">foo</span><span class="p">(</span><span class="mf">42.99</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">yoohoo</span><span class="p">&#34;);</span>
<span class="nf">foo</span><span class="p">(</span><span class="mi">3</span><span class="o">+</span><span class="mi">9</span><span class="no">i</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">hellooooooo</span><span class="p">&#34;);</span>
<span class="c1"># etc</span>
</code></pre></div><p>æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ç±»ä¸­ç­¾åçš„å·¥ä½œåŸç†ä¹Ÿä¸€æ ·ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.prop</span> <span class="k">is</span> <span class="k">rw</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">inspect-a-foo</span><span class="p">(</span> <span class="n">Foo</span> <span class="nv">$my-foo</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">this foo&#39;s property is </span><span class="p">&#34;</span> <span class="o">~</span> <span class="nv">$my-foo</span><span class="o">.</span><span class="nf">prop</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$f</span> <span class="o">=</span> <span class="n">Foo</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span> <span class="s">prop</span> <span class="o">=&gt;</span> <span class="mi">42</span> <span class="p">);</span>
<span class="nf">inspect-a-foo</span><span class="p">(</span><span class="nv">$f</span><span class="p">);</span>
<span class="c1"># this foo&#39;s property is 42</span>
</code></pre></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­,  å­ä¾‹ç¨‹ <em>inspect-a-foo</em> åªä¼šæ¥æ”¶ <strong>Foo</strong> ç±»å‹çš„å‚æ•°, æˆ–è€… <strong>Foo</strong> çš„å­ç±»ã€‚</p>
<h2 id="å¸¦æœ‰-where-block-çš„ç‰¹å¼‚æ€§">å¸¦æœ‰ <strong>where</strong> block çš„ç‰¹å¼‚æ€§</h2>
<p>é€šè¿‡åœ¨ç­¾åä¸­ä½¿ç”¨ <em>where</em> å­å¥, Raku å…è®¸æˆ‘ä»¬æ›´è¿›ä¸€æ­¥çš„é™åˆ¶å­ä¾‹ç¨‹çš„å‚æ•°ã€‚<em>where</em> å­å¥æ¥æ”¶ä»»ä½• code block, è¿™ä¸ª <code>code block</code> å¿…é¡»è¿”å›ä¸€ä¸ª true å€¼ä»¥ä½¿ç±»å‹çº¦æŸé€šè¿‡ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">foo</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$positive</span> <span class="k">where</span> <span class="p">{</span> <span class="nv">$positive</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">æˆ‘å¾ˆç¡®ä¿¡ </span><span class="nv">$positive</span><span class="s2"> æ˜¯æ­£çš„!</span><span class="p">&#34;</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">bar</span><span class="p">(</span> <span class="n">Foo</span> <span class="nv">$foo</span> <span class="k">where</span> <span class="p">{</span> <span class="nv">$foo</span><span class="o">.</span><span class="nf">prop</span><span class="o">.</span><span class="nb">isa</span><span class="p">(</span> <span class="nb">Int</span> <span class="p">)</span> <span class="ow">and</span> <span class="nv">$foo</span><span class="o">.</span><span class="nf">prop</span> <span class="o">&gt;</span> <span class="mi">40</span> <span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">è¿™ä¸ª Foo çš„å±æ€§æ˜¯ä¸€ä¸ªå¤§äº 40 çš„æ•´æ•°</span><span class="p">&#34;</span>
<span class="p">}</span>
</code></pre></div><p>å¯ä»¥æŒ‡å®šå¤šä¸ª <em>where</em> å­å¥æ¥çº¦æŸå¤šä¸ªå‚æ•°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku">
<span class="k">sub</span> <span class="nf">quadrant2</span><span class="p">(</span> <span class="nb">Real</span> <span class="nv">$x</span> <span class="k">where</span> <span class="p">{</span> <span class="nv">$x</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="p">}</span><span class="o">,</span> <span class="nb">Real</span> <span class="nv">$y</span> <span class="k">where</span> <span class="p">{</span> <span class="nv">$y</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">}</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">at the point (</span><span class="nv">$x</span><span class="s2">, </span><span class="nv">$y</span><span class="s2">)</span><span class="p">&#34;</span>
<span class="p">}</span>

<span class="nf">quadrant2</span><span class="p">(</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="c1"># Constraint type check failed for parameter &#39;$x&#39;</span>
<span class="nf">quadrant2</span><span class="p">(</span> <span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">);</span>
<span class="c1"># Constraint type check failed for parameter &#39;$y&#39;</span>
<span class="nf">quadrant2</span><span class="p">(</span> <span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span> <span class="p">);</span>
<span class="c1"># at the point (-1, 1)</span>
</code></pre></div><p>çº¦æŸå—å„¿(Constraint blocks)ç”šè‡³ä¸éœ€è¦æ˜¯ <em>blocks</em>ã€‚äº‹å®ä¸Š, ä»»ä½• <strong>Callable</strong> ç±»éƒ½å¯ä»¥ã€‚å› æ­¤, ä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°è·å¾—åŠŸèƒ½å‡½æ•°çš„çº¦æŸæ£€æµ‹, å®ƒä»¬èƒ½åœ¨å¤šä¸ªä¸åŒçš„å­ä¾‹ç¨‹ä¹‹é—´å¾ªç¯åˆ©ç”¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">is-positive</span><span class="p">(</span> <span class="nb">Real</span> <span class="nv">$n</span> <span class="p">)</span> <span class="p">{</span> <span class="nv">$n</span> <span class="o">&gt;</span> <span class="mi">0</span>  <span class="p">}</span>
<span class="k">sub</span> <span class="nf">is-negative</span><span class="p">(</span> <span class="nb">Real</span> <span class="nv">$n</span> <span class="p">)</span> <span class="p">{</span> <span class="nv">$n</span> <span class="o">&lt;</span> <span class="mi">0</span>  <span class="p">}</span>
<span class="k">sub</span> <span class="nf">is-zero</span><span class="p">(</span> <span class="nb">Real</span> <span class="nv">$n</span> <span class="p">)</span>     <span class="p">{</span> <span class="nv">$n</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">}</span>

<span class="k">sub</span> <span class="nf">quadrant1</span><span class="p">(</span> <span class="nb">Real</span> <span class="nv">$x</span> <span class="k">where</span> <span class="nf">is-positive</span><span class="p">(</span> <span class="nv">$x</span> <span class="p">)</span><span class="o">,</span> <span class="nb">Real</span> <span class="nv">$y</span> <span class="k">where</span> <span class="nf">is-positive</span><span class="p">(</span> <span class="nv">$y</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="k">sub</span> <span class="nf">quadrant2</span><span class="p">(</span> <span class="nb">Real</span> <span class="nv">$x</span> <span class="k">where</span> <span class="nf">is-negative</span><span class="p">(</span> <span class="nv">$x</span> <span class="p">)</span><span class="o">,</span> <span class="nb">Real</span> <span class="nv">$y</span> <span class="k">where</span> <span class="nf">is-positive</span><span class="p">(</span> <span class="nv">$y</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="k">sub</span> <span class="nf">quadrant3</span><span class="p">(</span> <span class="nb">Real</span> <span class="nv">$x</span> <span class="k">where</span> <span class="nf">is-negative</span><span class="p">(</span> <span class="nv">$x</span> <span class="p">)</span><span class="o">,</span> <span class="nb">Real</span> <span class="nv">$y</span> <span class="k">where</span> <span class="nf">is-negative</span><span class="p">(</span> <span class="nv">$y</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="k">sub</span> <span class="nf">quadrant4</span><span class="p">(</span> <span class="nb">Real</span> <span class="nv">$x</span> <span class="k">where</span> <span class="nf">is-positive</span><span class="p">(</span> <span class="nv">$x</span> <span class="p">)</span><span class="o">,</span> <span class="nb">Real</span> <span class="nv">$y</span> <span class="k">where</span> <span class="nf">is-negative</span><span class="p">(</span> <span class="nv">$y</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="k">sub</span> <span class="nf">x-axis</span><span class="p">(</span> <span class="nb">Real</span> <span class="nv">$x</span><span class="o">,</span> <span class="nb">Real</span> <span class="nv">$y</span> <span class="k">where</span> <span class="nf">is-zero</span><span class="p">(</span> <span class="nv">$y</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="k">sub</span> <span class="nf">y-axis</span><span class="p">(</span> <span class="nb">Real</span> <span class="nv">$x</span> <span class="k">where</span> <span class="nf">is-zero</span><span class="p">(</span> <span class="nv">$x</span> <span class="p">)</span><span class="o">,</span> <span class="nb">Real</span> <span class="nv">$y</span> <span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="k">sub</span> <span class="nf">origin</span><span class="p">(</span> <span class="nb">Real</span> <span class="nv">$x</span> <span class="k">where</span> <span class="nf">is-zero</span><span class="p">(</span> <span class="nv">$x</span> <span class="p">)</span><span class="o">,</span> <span class="nb">Real</span> <span class="nv">$y</span> <span class="k">where</span> <span class="nf">is-zero</span><span class="p">(</span> <span class="nv">$y</span> <span class="p">)</span> <span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div><h2 id="return-types">Return Types</h2>
<p>æ¯ä¸ª Raku å­ä¾‹ç¨‹ä¹Ÿèƒ½æŒ‡å®šå®ƒè‡ªå·±çš„è¿”å›å€¼ç±»å‹ä½œä¸ºç­¾åçš„ä¸€éƒ¨åˆ†ã€‚è¿™å¯ä»¥ä½¿ç”¨ <em>returns</em> å…³é”®å­—æ¥æ˜¾å¼åœ°æŒ‡å®š, ä½†æ˜¯æˆ‘æ›´å–œæ¬¢ç”¨å¿«æ·å½¢å¼çš„ <code>--&gt;</code> æ“ä½œç¬¦, å®ƒåœ¨ç­¾åè‡ªèº«ä¹‹å†…ã€‚ä¸‹é¢å£°æ˜çš„ä¸¤ä¸ªå­ä¾‹ç¨‹æ˜¯ç­‰ä»·çš„:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">are-they-equal</span><span class="p">(</span> <span class="nb">Str</span> <span class="nv">$foo</span><span class="o">,</span> <span class="nb">Str</span> <span class="nv">$bar</span> <span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool</span> <span class="p">{</span>
    <span class="nv">$foo</span> <span class="ow">eq</span> <span class="nv">$bar</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">are-they-equal</span><span class="p">(</span> <span class="nb">Str</span> <span class="nv">$foo</span><span class="o">,</span> <span class="nb">Str</span> <span class="nv">$bar</span> <span class="k">--&gt;</span> <span class="nb">Bool</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nv">$foo</span> <span class="ow">eq</span> <span class="nv">$bar</span>
<span class="p">}</span>
</code></pre></div><p>æ¯«æ— ç–‘é—®åœ°, å¦‚æœè¿”å›é”™è¯¯çš„ç±»å‹ Raku ä¼šæŠ›å‡ºé”™è¯¯ã€‚</p>
<h2 id="è‡ªçœ">è‡ªçœ</h2>
<p>Raku ä¸­å­ä¾‹ç¨‹æ˜¯ä¸€ç­‰å¯¹è±¡ã€‚ä½†æ˜¯ Raku å¸¦æ¥äº†ä¸€å¤§å †æ–°çš„å†…çœå·¥å…·, åŒ…å«è¯¢é—®å­ä¾‹ç¨‹çš„ç­¾åä¿¡æ¯çš„èƒ½åŠ›ã€‚æ¯ä¸ªå­ä¾‹ç¨‹çš„ç­¾åå®é™…ä¸Šå°±æ˜¯ <strong>Signature</strong> ç±»çš„ä¸€ä¸ªå¯¹è±¡ã€‚æˆ‘ä»¬èƒ½æ‰¾å‡ºå­ä¾‹ç¨‹çš„å…ƒæ•°å’Œè¿”å›å€¼ç±»å‹ã€‚æˆ‘ä»¬ç”šè‡³èƒ½å¤Ÿåœ¨ç­¾åä¸­æŠ“å–ä¸€ä¸ª <strong>Parameter</strong> å¯¹è±¡çš„åˆ—è¡¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">are-they-equal</span><span class="p">(</span> <span class="nb">Str</span> <span class="nv">$foo</span><span class="o">,</span> <span class="nb">Str</span> <span class="nv">$bar</span> <span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool</span> <span class="p">{</span>
    <span class="nv">$foo</span> <span class="ow">eq</span> <span class="nv">$bar</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="nv">&amp;are-they-equal</span><span class="o">.</span><span class="nb">signature</span><span class="o">.</span><span class="nb">arity</span><span class="p">;</span>    <span class="c1"># 2</span>
<span class="nb">say</span> <span class="nv">&amp;are-they-equal</span><span class="o">.</span><span class="nb">signature</span><span class="o">.</span><span class="k">returns</span><span class="p">;</span>  <span class="c1"># (Bool)</span>

<span class="k">my</span> <span class="nv">@params</span> <span class="o">=</span> <span class="nv">&amp;are-they-equal</span><span class="o">.</span><span class="nb">signature</span><span class="o">.</span><span class="nb">params</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">@params</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="nb">name</span><span class="p">;</span>      <span class="c1"># $foo</span>
<span class="nb">say</span> <span class="nv">@params</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="nb">type</span><span class="p">;</span>      <span class="c1"># (Str)</span>
<span class="nb">say</span> <span class="nv">@params</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="nb">sigil</span><span class="p">;</span>     <span class="c1"># $</span>
</code></pre></div><p>æ€»ä¹‹, Raku çš„ç­¾åå¾ˆå¥½å¾ˆå¼ºå¤§ã€‚</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/signature" term="signature" label="signature" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[æ•£åˆ—ä¹Ÿæ˜¯å®¹å™¨]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-06-28-hash-is-also-containers/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-06-28-hash-is-also-containers/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Hash Is Also Containers</blockquote><h2 id="æ•£åˆ—ä¹Ÿæ˜¯å®¹å™¨">æ•£åˆ—ä¹Ÿæ˜¯å®¹å™¨</h2>
<p>å‡è®¾æˆ‘ä»¬æƒ³è®¡ç®—æŸä¸ªä¸œè¥¿çš„å‡ºç°æ¬¡æ•°, æˆ‘ä»¬é€šå¸¸çš„åšæ³•æ˜¯å¼„ä¸€ä¸ª &ldquo;seen-hash&rdquo; æ•£åˆ—ã€‚æœ‰æ—¶å€™æˆ‘ä»¬æœ‰ä¸€ç»„å¾…æŸ¥è¯¢çš„é”®, å…¶ä¸­æœ‰äº›é”®å¯èƒ½ä¸åœ¨æˆ‘ä»¬æ‰€æ‰«æçš„æ•°æ®ä¸­ã€‚é‚£æ˜¯ä¸€ç§ç‰¹æ®Šæƒ…å†µ, ä½†æ˜¯ Raku èƒ½å¤Ÿå®Œç¾åœ°è§£å†³, å› ä¸ºæ•£åˆ—ä¹Ÿæ˜¯å®¹å™¨, å› æ­¤æˆ‘ä»¬èƒ½å¤Ÿæ‹¥æœ‰é»˜è®¤å€¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$words</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">Hashes are containers too</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">lc</span><span class="p">;</span>
<span class="k">constant</span> <span class="no">alphabet</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;</span> <span class="o">..</span> <span class="p">&#39;</span><span class="s1">z</span><span class="p">&#39;;</span>

<span class="k">my</span> <span class="nv">%seen</span> <span class="k">of</span> <span class="nb">Int</span> <span class="k">is</span> <span class="k">default</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="nv">%seen</span><span class="p">{</span><span class="nv">$_</span><span class="p">}</span><span class="o">++</span> <span class="k">for</span> <span class="nv">$words</span><span class="o">.</span><span class="nb">comb</span><span class="p">;</span>
<span class="nb">put</span> <span class="p">&#34;</span><span class="nv">$_:</span><span class="s2"> </span><span class="nv">%seen</span><span class="p">{</span><span class="nv">$_</span><span class="p">}&#34;</span> <span class="k">for</span> <span class="n">alphabet</span><span class="p">;</span>
</code></pre></div><p>è¾“å‡ºç»“æœ:</p>
<pre><code>a: 3
b: 0
c: 1
d: 0
e: 3
f: 0
g: 0
h: 2
i: 1
j: 0
k: 0
l: 0
m: 0
n: 2
o: 3
p: 0
q: 0
r: 2
s: 3
t: 2
u: 0
v: 0
w: 0
x: 0
y: 0
z: 0
</code></pre><p><code>$words</code> ä¸­æ²¡æœ‰å‡ºç°çš„ç‰¹æ®Šå­—ç¬¦ç”± <code>is default(0)</code> å¤„ç†äº†ã€‚</p>
<p>é»˜è®¤å€¼å¯ä»¥è¢«ç²¾å¿ƒè®¾è®¡ã€‚æˆ‘ä»¬æ¥å¼„ä¸€ä¸ªåœ¨æ•°å€¼ä¸Šä¸‹æ–‡ä¸­ä¸ºé»˜è®¤å€¼ä¸º 0 ä½†æ˜¯åœ¨å­—ç¬¦ä¸²ä¸Šä¸‹æ–‡ä¸­ä¸ºé»˜è®¤å€¼ä¸º NULL å¹¶ä¸”æ€»æ˜¯è¢«å®šä¹‰çš„ä¸€ä¸ªæ•£åˆ—ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%seen</span> <span class="k">of</span> <span class="nb">Int</span> <span class="k">is</span> <span class="k">default</span><span class="p">(</span><span class="mi">0</span> <span class="k">but</span> <span class="k">role</span> <span class="nc">::</span> <span class="p">{</span> <span class="k">method</span> <span class="nb">Str</span><span class="p">()</span> <span class="p">{&#39;</span><span class="s1">NULL</span><span class="p">&#39;}</span> <span class="p">});</span>
<span class="nb">say</span> <span class="nv">%seen</span><span class="p">&lt;</span><span class="s">not-there</span><span class="p">&gt;</span><span class="o">,</span> <span class="nv">%seen</span><span class="p">&lt;</span><span class="s">not-there</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">defined</span><span class="o">,</span> <span class="nb">Int</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="nv">%seen</span><span class="p">&lt;</span><span class="s">not-there</span><span class="p">&gt;);</span>

<span class="c1"># OUTPUT</span>
<span class="c1"># Â«NULLTrue0â¤Â»</span>
</code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/container" term="container" label="container" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[ç»™æ•°å­—æ·»åŠ åƒåˆ†ä½ç¬¦]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-12-14-add-separator/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2015-07-14-the-king-of-list-manipulation/?utm_source=atom_feed" rel="related" type="text/html" title="rotor: åˆ—è¡¨æ“ä½œä¹‹ç‹" />
            
                <id>https://ohmyweekly.github.io/notes/2015-12-14-add-separator/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Add Separator</blockquote><h2 id="ä½¿ç”¨é“¾å¼å‡½æ•°è°ƒç”¨">ä½¿ç”¨é“¾å¼å‡½æ•°è°ƒç”¨</h2>
<p>è€ƒè™‘æœ€ç®€å•çš„ä¸€ç§æƒ…å†µ, ä¸å¸¦å°æ•°ç‚¹çš„æ•°å­—:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">&#34;</span><span class="s2">1234567890</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">comb</span><span class="o">.</span><span class="nb">reverse</span><span class="o">.</span><span class="nb">rotor</span><span class="p">(</span><span class="mi">3</span><span class="o">,</span><span class="p">:</span><span class="s">partial</span><span class="p">)</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="o">*.</span><span class="nb">join</span><span class="p">(&#39;&#39;))</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;</span><span class="s1">,</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">comb</span><span class="o">.</span><span class="nb">reverse</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;&#39;)</span>  
<span class="c1"># 1,234,567,890</span>
</code></pre></div><p>ä½¿ç”¨ <code>\\</code> è½¬ä¹‰ç©ºç™½, ä½¿ä»£ç å¯¹é½:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">&#34;</span><span class="s2">1234567890</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">comb</span>\
            <span class="o">.</span><span class="nb">reverse</span>\
            <span class="o">.</span><span class="nb">rotor</span><span class="p">(</span><span class="mi">3</span><span class="o">,</span><span class="p">:</span><span class="s">partial</span><span class="p">)</span>\
            <span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="o">*.</span><span class="nb">join</span><span class="p">(</span>â€˜â€™<span class="p">))</span>\
            <span class="o">.</span><span class="nb">join</span><span class="p">(</span>â€˜<span class="o">,</span>â€™<span class="p">)</span>\
            <span class="o">.</span><span class="nb">comb</span>\
            <span class="o">.</span><span class="nb">reverse</span>\
            <span class="o">.</span><span class="nb">join</span><span class="p">(</span>â€˜â€™<span class="p">)</span>\
            <span class="o">.</span><span class="nb">say</span><span class="p">;</span>

</code></pre></div><h2 id="ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼">ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼</h2>
<h2 id="ä½¿ç”¨-grammar">ä½¿ç”¨ Grammar</h2>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/rotor" term="rotor" label="rotor" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Grammar Generating Grammar]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-04-15-grammar-generating-grammar/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-04-15-grammar-generating-grammar/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-10T00:00:00+08:00</published>
            <updated>2021-07-10T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Grammar Generating Grammar</blockquote><p>ç°åœ¨ä½ å¯èƒ½å·²ç»ä¹ æƒ¯äº† Raku ä¸­åˆ°å¤„å‡ºç°çš„å‰ç¼€ &ldquo;meta&rdquo;ã€‚<strong>Metaclasses</strong>, <strong>Metaobjects</strong>, <strong>Metaoperators</strong>, è¿˜æœ‰è¿·ä¸€èˆ¬çš„ Meta-Object åè®®ã€‚å¬èµ·æ¥ä¸€ç‚¹ä¹Ÿä¸å¯æ€•, ä½ éƒ½è§è¿‡äº†ä¸æ˜¯å—ï¼Ÿä»Šå¤©, åœ¨ Raku Advent Calendar ä¸Š, æˆ‘ä»¬å°†è¿›è¡Œå®Œå…¨çš„ <strong>meta</strong> åŒ–(full meta)ã€‚æˆ‘ä»¬å°†æ‹¥æœ‰èƒ½è§£æ grammar çš„ grammar, ç„¶åç”Ÿæˆå°†ç”¨äºè§£æ grammar çš„ grammarã€‚</p>
<p>Grammar æ— ç–‘æ˜¯ Raku çš„æ€æ‰‹çº§åŠŸèƒ½ã€‚æˆ‘ä»¬æ‹¥æœ‰äº†æ­£åˆ™è¡¨è¾¾å¼æ›¾ç»æ²¡æœ‰çš„ä¸œè¥¿: å¯è¯»æ€§ã€å¯ç»„åˆæ€§å½“ç„¶è¿˜æœ‰è§£æ Raku è‡ªèº«çš„èƒ½åŠ›ã€‚â€” å¦‚æœè¿™ä¸èƒ½å±•ç¤ºå®ƒçš„å¼ºå¤§, é‚£æˆ‘ä¸çŸ¥é“ä»€ä¹ˆèƒ½å¤Ÿ!</p>
<p>ä¸ºé¢„å®šä¹‰å¥½çš„ grammar(ä¾‹å¦‚ä»¥ <a href="https://en.wikipedia.org/wiki/Backus%E2%80%93Naur_Form">Bachus-Naur</a> å½¢å¼)å†™è§£æå™¨æ€»æ˜¯æœ‰ç‚¹æ— è¶£, å‡ ä¹å’Œå¤åˆ¶ç²˜è´´ä¸€æ ·ã€‚å¦‚æœä½ æ›¾ç»åä¸‹æ¥é‡å¤´å¼€å§‹å†™ä¸€ä¸ªè§£æå™¨(æˆ–è€…æœŸé—´æ¸©ä¹ ä¸€éé‚£æœ¬ä¼˜ç§€çš„&quot;è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç¼–è¯‘å™¨&quot;å›¾ä¹¦), ä½ å¯èƒ½ä¼šæ„è¯†åˆ°æ¨¡å¼æ˜¯å¦‚æ­¤ç›¸ä¼¼:ä»ä½ çš„ grammar ä¸­æ‹¿å‡ºå•ä¸ª rule, ä¸ºå®ƒå†™ä¸€ä¸ªå­ä¾‹ç¨‹, è®©å®ƒè°ƒç”¨(å¯èƒ½æ˜¯é€’å½’çš„)å…¶å®ƒç±»ä¼¼çš„ä¸ºå…¶å®ƒ grmmars rules å®šä¹‰çš„å­ä¾‹ç¨‹, æ¸…æ´—, é‡å¤ã€‚ç°åœ¨æˆ‘ä»¬æœ‰äº†Raku grammar! åœ¨è¿™ä¸ªæ–°ä¸–ç•Œä¸­, æˆ‘ä»¬ä¸å¿…ä¸ºæ¯ä¸ª token å†™ä¸Šå­ä¾‹ç¨‹æ¥å®Œæˆå·¥ä½œäº†ã€‚ ç°åœ¨æˆ‘ä»¬å†™ <strong>grammar</strong> ç±», é‡Œé¢æ”¾ä¸Š <em>tokens</em>ã€<em>rules</em>ã€<em>regexes</em> æ ‡å¿—ã€‚åœ¨æ ‡å¿—é‡Œå†™æ­£åˆ™è¡¨è¾¾å¼(æˆ–ä»£ç )å¹¶å¼•ç”¨(å¯èƒ½æ˜¯é€’å½’çš„) Raku gramamr ä¸­çš„å…¶å®ƒæ ‡å¿—ã€‚å¦‚æœä½ æ›¾ç»ä½¿ç”¨è¿‡è¿™äº›ä¸œè¥¿, ä½ è‚¯å®šä¼šæ„è¯†åˆ° Raku ä¸­çš„ grammar æ˜¯å¤šä¹ˆçš„æ–¹ä¾¿ã€‚</p>
<p>ä½†æ˜¯å‡å¦‚æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ª grammar, ä¾‹å¦‚ä¹‹å‰æåˆ°è¿‡çš„ BNF? æˆ‘ä»¬æ‰€åšçš„å°±æ˜¯å°å¿ƒåœ°æŠŠå·²ç»å­˜åœ¨çš„ grammar(å®é™…ä¸Šåœ¨æˆ‘ä»¬å¤´è„‘ä¸­è§£æå®ƒ)é‡æ–°é”®å…¥åˆ°ä¸€ä¸ªæ–°çš„ Raku  Grammar ä¸­ä»¥ä»£è¡¨åŒæ ·çš„ä¸€ä¸ªä¸œè¥¿, ä½†æ˜¯é‚£ç¡®å®æœ‰ä¸€ä¸ªå¯ä½œä¸ºå¯æ‰§è¡Œä»£ç çš„ä¼˜åŠ¿ã€‚å¯¹å¤§å¤šæ•°äººæ¥è¯´, é‚£éƒ½ä¸æ˜¯äº‹å„¿ã€‚æˆ‘ä»¬ä¸æ˜¯æ™®é€šäºº, æˆ‘ä»¬æ˜¯ç¨‹åºå‘˜ã€‚æˆ‘ä»¬æ‹¥æœ‰èµ„æºã€‚å®ƒä»¬ä¼šè®©è¿™äº› grammar å˜å¾—æœ‰æ„ä¹‰ã€‚</p>
<p>ç»å¦™çš„æ˜¯ Raku grammar å’Œè¯­è¨€çš„å…¶å®ƒå…ƒç´ æ²¡ä»€ä¹ˆä¸¤æ ·ã€‚grammar å°±åƒç±»é‚£æ ·ä¹Ÿæ˜¯å¤´ç­‰å…¬æ°‘, å¯ä»¥å†…çœ, æ‰©å±•ã€‚å®é™…ä¸Š, ä½ å¯ä»¥æŸ¥çœ‹ç¼–è¯‘å™¨æºä»£ç è‡ªèº«, ä½ ä¼šæ³¨æ„åˆ° <a href="https://github.com/rakudo/rakudo/blob/nom/src/Raku/Metamodel/GrammarHOW.nqp">grammar å°±æ˜¯ä¸€ç§ç‰¹å®šç§ç±»çš„ç±»</a>ã€‚å®ƒä»¬éµå®ˆå’Œç±»ä¸€æ ·çš„è§„åˆ™, å…è®¸æˆ‘ä»¬å°±åœ°åˆ›å»º grammar, å°±åœ°ç»™ grammar æ·»åŠ  tokens, æœ€ç»ˆå®Œç»“è¿™ä¸ª gramamr ä»¥æ‹¥æœ‰ä¸€ä¸ªåˆé€‚çš„èƒ½å®ä¾‹åŒ–çš„ç±»å¯¹è±¡ã€‚ç°åœ¨æ—¢ç„¶æˆ‘ä»¬èƒ½è§£æ BNF grammar(å› ä¸ºå®ƒä»¬å°±æ˜¯æ™®é€šçš„æ–‡æœ¬)å¹¶ä»ä»£ç ä¸­åˆ›å»º Raku grammar, è®©æˆ‘ä»¬æŠŠè¿™äº›ç‰‡æ®µæ”¾åœ¨ä¸€èµ·å¹¶å†™ç‚¹èƒ½æ‰‹åŠ¨æŠŠ BNF gramamr è½¬åŒ–ä¸º Raku grammar çš„ä¸œè¥¿ã€‚</p>
<h4 id="è§£æ-bnf-grammar-çš„-grammar">è§£æ BNF grammar çš„ grammar</h4>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">grammar</span> <span class="nc">Grammar::BNF</span> <span class="p">{</span>
    <span class="k">token</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr"> </span><span class="se">\s</span><span class="o">*</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">rule</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="se">\s</span><span class="o">*</span><span class="sr"> </span><span class="p">}</span>

    <span class="k">token</span> <span class="nf">rule</span> <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="p">&lt;</span><span class="nf">opt-ws</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">&lt;</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">rule-name</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">&gt;</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">opt-ws</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">::=</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">opt-ws</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">expression</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">line-end</span><span class="p">&gt;</span><span class="sr">
</span><span class="sr">    </span><span class="p">}</span>

    <span class="k">token</span> <span class="nf">expression</span> <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="p">&lt;</span><span class="nf">list-of-terms</span><span class="p">&gt;</span><span class="sr"> </span><span class="o">+</span><span class="nv">%</span><span class="sr"> </span><span class="p">[</span><span class="se">\s</span><span class="o">*</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">|</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">opt-ws</span><span class="p">&gt;]</span><span class="sr">
</span><span class="sr">    </span><span class="p">}</span>

    <span class="k">token</span> <span class="nf">term</span> <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="p">&lt;</span><span class="nf">literal</span><span class="p">&gt;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">&lt;</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">rule-name</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">&gt;</span><span class="p">&#39;</span><span class="sr">
</span><span class="sr">    </span><span class="p">}</span>

    <span class="k">token</span> <span class="nf">list-of-terms</span> <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">term</span><span class="p">&gt;</span><span class="sr"> </span><span class="o">+</span><span class="nv">%</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">opt-ws</span><span class="p">&gt;</span><span class="sr">                </span><span class="p">}</span>
    <span class="k">token</span> <span class="nf">rule-name</span>     <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">-</span><span class="p">[</span><span class="sr">&gt;</span><span class="p">]&gt;</span><span class="o">+</span><span class="sr">                           </span><span class="p">}</span>
    <span class="k">token</span> <span class="nf">opt-ws</span>        <span class="p">{</span><span class="sr"> </span><span class="se">\h</span><span class="o">*</span><span class="sr">                               </span><span class="p">}</span>
    <span class="k">token</span> <span class="nf">line-end</span>      <span class="p">{</span><span class="sr"> </span><span class="p">[</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">opt-ws</span><span class="p">&gt;</span><span class="sr"> </span><span class="se">\n</span><span class="sr"> </span><span class="p">]</span><span class="o">+</span><span class="sr">                  </span><span class="p">}</span>
    <span class="k">token</span> <span class="nf">literal</span>       <span class="p">{</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">&#34;</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">-</span><span class="p">[</span><span class="sr">&#34;</span><span class="p">]&gt;</span><span class="o">*</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">&#34;</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&#34;</span><span class="s2">&#39;</span><span class="p">&#34;</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">-</span><span class="p">[</span><span class="sr">&#39;</span><span class="p">]&gt;</span><span class="o">*</span><span class="sr"> </span><span class="p">&#34;</span><span class="s2">&#39;</span><span class="p">&#34;</span><span class="sr"> </span><span class="p">}</span>

    <span class="o">...</span>
<span class="p">}</span>
</code></pre></div><p>æœ€ä¸Šå±‚çš„ 3 ä¸ª token å‘ç”Ÿäº†æœ‰æ„æ€çš„äº‹æƒ…ã€‚<em>rule</em> æ˜¯ BNF grammar çš„æ ¸å¿ƒæ„é€ å—: ä¸€ä¸ª <code>&lt;symbol&gt; ::=  &lt;expression&gt;</code> å—å„¿, åé¢è·Ÿç€ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚æ•´ä¸ª grammar å°±æ˜¯ä¸€åˆ— ruleã€‚æ¯ä¸ªè¡¨è¾¾å¼æ˜¯ä¸€åˆ—é¡¹ã€æˆ–å¯èƒ½çš„å’Œå®ƒä»¬çš„å¤‡é€‰åˆ†æ”¯ã€‚æ¯ä¸ªé¡¹è¦ä¹ˆæ˜¯ä¸€ä¸ªå­—é¢å€¼, æˆ–ä¸€ä¸ªç”±å°–æ‹¬å·åŒ…å›´çš„æ ‡å¿—åã€‚è¶³å¤Ÿäº†! é‚£æ¶µç›–äº†è§£æéƒ¨åˆ†ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ç”Ÿæˆè‡ªèº«ã€‚æˆ‘ä»¬çš„ç¡®æœ‰ä¸€ç§&quot;ä¸º grammar ä¸­çš„æ¯ä¸ª token åšæŸäº‹&quot;çš„æœºåˆ¶, ä»¥ <strong>Actions</strong>çš„å½¢å¼, è®©æˆ‘ä»¬ç»§ç»­å¹¶ä½¿ç”¨å®ƒ:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="k">class</span> <span class="nc">Actions</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.name</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">BNFGrammar</span><span class="p">&#39;;</span>
    <span class="k">method</span> <span class="nf">TOP</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">$grmr</span> <span class="o">:=</span> <span class="n">Metamodel::GrammarHOW</span><span class="o">.</span><span class="nb">new_type</span><span class="p">(</span><span class="o">:</span><span class="nv">$.name</span><span class="p">);</span>
        <span class="nv">$grmr</span><span class="o">.^</span><span class="nb">add_method</span><span class="p">(&#39;</span><span class="s1">TOP</span><span class="p">&#39;</span><span class="o">,</span>
            <span class="nb">EVAL</span> <span class="p">&#39;</span><span class="s1">token { &lt;</span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$&lt;rule&gt;</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="nb">ast</span><span class="o">.</span><span class="nb">key</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">&gt; }</span><span class="p">&#39;);</span>
        <span class="k">for</span> <span class="nv">$&lt;rule&gt;</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="o">*.</span><span class="nb">ast</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nv">$rule</span> <span class="p">{</span>
            <span class="nv">$grmr</span><span class="o">.^</span><span class="nb">add_method</span><span class="p">(</span><span class="nv">$rule</span><span class="o">.</span><span class="nb">key</span><span class="o">,</span> <span class="nv">$rule</span><span class="o">.</span><span class="nb">value</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nv">$grmr</span><span class="o">.^</span><span class="nb">compose</span><span class="p">;</span>
        <span class="k">make</span> <span class="nv">$grmr</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">expression</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">make</span> <span class="nb">EVAL</span> <span class="p">&#39;</span><span class="s1">token { </span><span class="p">&#39;</span> <span class="o">~</span> <span class="o">~</span><span class="nv">$/</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1"> }</span><span class="p">&#39;;</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="k">rule</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">make</span> <span class="o">~</span><span class="nv">$&lt;rule-name&gt;</span> <span class="o">=&gt;</span> <span class="nv">$&lt;expression&gt;</span><span class="o">.</span><span class="nb">ast</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p><strong>TOP</strong> æ–¹æ³•æ¯«æ— ç–‘é—®æ˜¯æœ€é­”å¹»å’Œæœ€ææ€–çš„, æ‰€ä»¥æ“’è´¼å…ˆæ“’ç‹, å…¶å®ƒå°å–½å•°å°±æ— å…³ç´§è¦äº†ã€‚åŸºæœ¬ä¸Š, <em>TOP</em> é‚£å„¿å‘ç”Ÿäº†ä¸‰ä»¶äº‹:</p>
<ul>
<li>1ã€æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ grammar, ä½œä¸ºä¸€ä¸ªæ–°çš„ Raku ç±»å‹</li>
<li>2ã€æˆ‘ä»¬ä½¿ç”¨ <code>^add_method</code> æ–¹æ³•ä¸º grammar æ·»åŠ  token</li>
<li>3ã€æˆ‘ä»¬ä½¿ç”¨ <code>^compose</code> æ–¹æ³•å®šå‹è¯¥ grammar</li>
</ul>
<p>è™½ç„¶ Raku æŒ‡å®šåä¸º <strong>TOP</strong> çš„ token æ˜¯è§£æå¼€å§‹çš„åœ°æ–¹, åœ¨ BNF ä¸­ç¬¬ä¸€ä¸ª rule æ€»æ˜¯å¼€å§‹ç‚¹ã€‚ä¸ºäº†å½¼æ­¤é€‚åº”,  æˆ‘ä»¬ç²¾å·§åœ°åˆ¶ä½œäº†ä¸€ä¸ªå‡çš„ <strong>TOP</strong> token, å®ƒæ­£æ˜¯è°ƒç”¨äº† BNF grammar ä¸­æŒ‡å®šçš„ç¬¬ä¸€ä¸ª ruleã€‚ä¸å¯é¿å…åœ°, ææ€–åˆä»¤äººå¤±æœ›çš„ <strong>EVAL</strong> å¼•èµ·äº†æˆ‘ä»¬çš„æ³¨æ„, å°±åƒå®ƒè¯´äº†&quot;è¿™å„¿å‘ç”Ÿäº†å¯æ€•çš„äº‹æƒ…&quot; ä¸€æ ·ã€‚å®ƒé‚£æ ·è¯´å¹¶ä¸æ˜¯å®Œå…¨é”™è¯¯çš„, ä½†æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰å…¶å®ƒç¨‹åºåŒ–æ„å»ºå•ç‹¬æ­£åˆ™çš„æ–¹æ³•, æˆ‘ä»¬ä¸å¾—ä¸æ¥å—è¿™ç‚¹ä¸é€‚ã€‚</p>
<p><strong>TOP</strong> ä¹‹åæˆ‘ä»¬ç»§ç»­ä¸ºæˆ‘ä»¬çš„ grammar æ·»åŠ  BNF rule çš„å‰©ä½™éƒ¨åˆ†, è¿™ä¸€æ¬¡ä¿ç•™å®ƒä»¬åŸæ¥çš„åå­—, ç„¶å <code>^compose</code> æ•´ä¸ªä¸œè¥¿, æœ€åè®©å®ƒ(make)æˆä¸ºè§£æçš„ç»“æœ: ä¸€ä¸ªåšå¥½çš„è§£æç±»ã€‚</p>
<p>åœ¨ <em>expression</em> æ–¹æ³•ä¸­æˆ‘ä»¬æŠŠè§£æè¿‡çš„ BNF å…ƒç´ ç²˜è´´åˆ°ä¸€å—ä»¥äº§ç”Ÿåˆæ³•çš„ Raku ä»£ç ã€‚è¿™å˜å¾—ç‰¹åˆ«å®¹æ˜“, å› ä¸ºé‚£ä¿©ä¸ªå•ç‹¬çš„æ ‡å¿—å¸¦æœ‰ç©ºæ ¼, ä½¿ç”¨ç®¡é“ç¬¦å·æ¥è½®è¯•å¤‡é€‰åˆ†æ”¯, å¹¶ä½¿ç”¨å°–æ‹¬å·åŒ…å›´æ ‡å¿—åã€‚ç›®å‰ä¸ºæ­¢, ä¸€ä¸ª rule çœ‹èµ·æ¥åƒè¿™æ ·:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">&lt;</span><span class="s">foo</span><span class="p">&gt;</span> <span class="o">::=</span> <span class="p">&#39;</span><span class="s1">bar</span><span class="p">&#39;</span> <span class="o">|</span> <span class="p">&lt;</span><span class="s">baz</span><span class="p">&gt;</span>
</code></pre></div><p>æˆ‘ä»¬æ±‚å€¼(EVAL)çš„ Raku ä»£ç å˜ä¸º:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">token</span> <span class="p">{</span> <span class="p">&#39;</span><span class="s1">bar</span><span class="p">&#39;</span> <span class="o">|</span> <span class="p">&lt;</span><span class="s">baz</span><span class="p">&gt;</span> <span class="p">}</span>
</code></pre></div><p>å› ä¸ºæˆ‘ä»¬å·²ç»åœ¨æˆ‘ä»¬ä»£ç çš„ grammar éƒ¨åˆ†æ£€æµ‹æˆ‘ä»¬è§£æçš„ BNF æ˜¯æ­£ç¡®çš„, æ²¡æœ‰ä»€ä¹ˆèƒ½å¤Ÿé˜»æ­¢æˆ‘ä»¬ä¼ é€’è§£ææ•´ä¸ªè¡¨è¾¾å¼å­—é¢å€¼åˆ°æˆ‘ä»¬çš„ä»£ç ä¸­å¹¶ä½¿ç”¨ä¸€ä¸ª <code>token  { }</code> æ¥åŒ…è£¹å®ƒ, æ‰€ä»¥è®©æˆ‘ä»¬ç»§ç»­ã€‚</p>
<p>æœ€å, å¯¹äºæˆ‘ä»¬è§£æçš„æ¯ä¸€ä¸ª BNF rule, æˆ‘ä»¬äº§ç”Ÿäº†ä¸€ä¸ªå¾ˆä¸é”™çš„ <em>Pair</em>, æ‰€ä»¥æˆ‘ä»¬çš„ <strong>TOP</strong> æ–¹æ³•å¾ˆæ„‰å¿«åœ°å¤„ç†å®ƒä»¬ä¸­çš„æ¯ä¸ªã€‚</p>
<p>çœ‹èµ·æ¥æˆ‘ä»¬å¥½åƒåœ¨è¿™å„¿ç»“æŸäº†, ä½†æ˜¯ä»…ä»…æ˜¯ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨è€…, è®©æˆ‘ä»¬å†™ä¸€ä¸ªæ›´å¥½çš„æ–¹æ³•, æ¥æ”¶ä¸€ä¸ª BNF grammar, å¹¶ä¸ºæˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªå‡†å¤‡å¥½ä½¿ç”¨çš„ç±»å‹å¯¹è±¡ã€‚æˆ‘ä»¬è®°å¾—, grammar å°±æ˜¯ç±», æ‰€ä»¥æˆ‘ä»¬æ²¡æœ‰ä»€ä¹ˆèƒ½é˜»æ­¢æˆ‘ä»¬ç›´æ¥ä¸ºæˆ‘ä»¬çš„ gramamr æ·»åŠ å®ƒ:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">grammar</span> <span class="nc">Grammar::BNF</span> <span class="p">{</span>
    <span class="o">...</span>
    <span class="k">method</span> <span class="nf">generate</span><span class="p">(</span><span class="nv">$source</span><span class="o">,</span> <span class="o">:</span><span class="nv">$name</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">BNFGrammar</span><span class="p">&#39;)</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">$actions</span> <span class="o">=</span> <span class="n">Actions</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="o">:</span><span class="nv">$name</span><span class="p">);</span>
        <span class="k">my</span> <span class="nv">$ret</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="nb">new</span><span class="o">.</span><span class="nb">parse</span><span class="p">(</span><span class="nv">$source</span><span class="o">,</span> <span class="o">:</span><span class="nv">$actions</span><span class="p">)</span><span class="o">.</span><span class="nb">ast</span><span class="p">;</span>
        <span class="k">return</span> <span class="nv">$ret</span><span class="o">.</span><span class="nb">WHAT</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>è¿™å„¿çœ‹èµ·æ¥å¾ˆä¸é”™! åœ¨ä½ å¼€å§‹å¾€ä½ è‡ªå·±çš„é¡¹ç›®ä¸­å¤åˆ¶ç²˜è´´æ‰€æœ‰è¿™äº›ä¹‹å‰, è®°å¾— <a href="https://github.com/tadzik/Grammar-BNF/">Grammar::BNF</a>Â æ˜¯ä¸€ä¸ªå¯åœ¨ <a href="http://modules.raku.org/">Raku Module Ecosystem</a>è·å¾—çš„ Raku æ¨¡å—, ä½¿ç”¨ä½ å–œæ¬¢çš„æ¨¡å—ç®¡ç†å™¨å®‰è£…ã€‚</p>
<p>å‡è®¾ä½ ç¡®å®èŠ±è´¹æ—¶é—´æŸ¥çœ‹äº†å¼€å¤´çš„ post, ä½ å¯èƒ½ä¼šè®°å¾—æˆ‘è®¸è¯ºè¿‡æˆ‘ä»¬å°†æœ‰ grammar(ç¬¬ä¸€æ¡)æ¥è§£æ grammar(ç¬¬äºŒæ¡), ç„¶åç”Ÿæˆ grammar(ç¬¬ä¸‰æ¡), ä½¿ç”¨ç”Ÿæˆçš„ grammar æ¥è§£æ grammar(ç¬¬å››æ¡)ã€‚ç›®å‰ä¸ºæ­¢ï¼Œ æˆ‘ä»¬å·²ç»çœ‹åˆ°è¿‡ BNF::Grammar  grammar(é‚£æ˜¯ç¬¬ä¸€æ¡), å¹¶è§£æä¸€ä¸ª BNF grammar(é‚£æ˜¯ç¬¬äºŒæ¡), ä»¥ç±»å¯¹è±¡çš„å½¢å¼æ¥ç”Ÿæˆ Raku grammar(ç¬¬ä¸‰æ¡)ã€‚ å°±è¿™äº›ã€‚æˆ‘ä»¬ä»æ—§ç¼ºä¹æœ€åä¸€éƒ¨åˆ†, ä½¿ç”¨æ•´ä¸ªä¸œè¥¿æ¥è§£æ grammarã€‚ æˆ‘ä»¬åªå®Œæˆäº† 75% çš„ meta åŒ–, ä»Šå¤©è¶³å¤Ÿäº†ã€‚ä¸ºä»€ä¹ˆç°åœ¨åœæ­¢? ä¸ºä»€ä¹ˆä¸æ‹¿ä¸€ä¸ª BNF grammar , ä½¿ç”¨ Raku grammar æ¥è§£æ grammar, ä½¿ç”¨ Raku BNF grammar çš„ç»“æœæ¥è§£ææˆ‘ä»¬åŸæ¥çš„ BNF Grammar? é‚£ä¸æ˜¯å¾ˆå¥½å—ï¼Ÿæ˜¯çš„, é‚£å¾ˆå¥½, æˆ‘ä»¬åªæ˜¯ç•™äº†ä¸€ä¸ªç»ƒä¹ ç»™ä½ ã€‚</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/grammar" term="grammar" label="grammar" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Junction in Raku]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-03-22-junctions-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-03-22-junctions-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-10T00:00:00+08:00</published>
            <updated>2021-07-10T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Junction in Raku</blockquote><p><a href="https://en.wikipedia.org/wiki/Erwin_Schr%C3%B6dinger">è–›å®šè°”æ¬§æ–‡</a>åº”è¯¥æ˜¯å–œæ¬¢ Raku çš„, å› ä¸ºä»–çš„è‘—åçš„<a href="https://en.wikipedia.org/wiki/Schr%C3%B6dinger%27s_cat">è–›å®šè°”çš„çŒ«</a>å¯ä»¥ç”¨ Raku çš„ <a href="https://docs.raku.org/type/Junction">Junction</a>è¡¨è¾¾:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$cat</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">dead</span><span class="p">&#39;</span> <span class="o">|</span> <span class="p">&#39;</span><span class="s1">alive</span><span class="p">&#39;;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">cat is both dead and alive</span><span class="p">&#34;</span> <span class="k">if</span> <span class="nv">$cat</span> <span class="ow">eq</span> <span class="p">&#39;</span><span class="s1">dead</span><span class="p">&#39;</span> <span class="ow">and</span> <span class="nv">$cat</span> <span class="ow">eq</span> <span class="p">&#39;</span><span class="s1">alive</span><span class="p">&#39;;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># cat is both dead and alive</span>
</code></pre></div><p>è¿™é‡Œé¢å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…? æˆ‘ä¼šå‘Šè¯‰ä½ å…¨éƒ¨çš„!</p>
<h2 id="anyone-æ¸¸æˆ">Anyone æ¸¸æˆ?</h2>
<p>æ‹¿æœ€ç®€å•çš„æ¥è¯´, Junction å…è®¸ä½ æŠŠä¸€å †å€¼å½“ä½œå•ä¸ªå€¼ã€‚ä¾‹å¦‚, ä½ å¯ä»¥ä½¿ç”¨ <code>any</code> Junction æ¥æµ‹è¯•ä¸€ä¸ªå˜é‡æ˜¯å¦ç­‰äºæ‰€ç»™å®šå€¼ä¸­çš„ä»»æ„ä¸€ä¸ª:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#39;</span><span class="s1">it matches!</span><span class="p">&#39;</span> <span class="k">if</span> <span class="p">&#39;</span><span class="s1">foo</span><span class="p">&#39;</span> <span class="ow">eq</span> <span class="p">&#39;</span><span class="s1">foo</span><span class="p">&#39;</span> <span class="o">|</span> <span class="p">&#39;</span><span class="s1">bar</span><span class="p">&#39;</span> <span class="o">|</span> <span class="p">&#39;</span><span class="s1">ber</span><span class="p">&#39;;</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">single-digit prime</span><span class="p">&#39;</span> <span class="k">if</span> <span class="mi">5</span> <span class="o">==</span> <span class="nb">any</span> <span class="o">^</span><span class="mi">9</span><span class="o">.</span><span class="nb">grep</span><span class="o">:</span> <span class="o">*.</span><span class="nb">is-prime</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">@values</span> <span class="o">=</span> <span class="o">^</span><span class="mi">100</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">it&#39;s in there!</span><span class="p">&#34;</span> <span class="k">if</span> <span class="mi">42</span> <span class="o">==</span> <span class="nv">@values</span><span class="o">.</span><span class="nb">any</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># it matches!</span>
<span class="c1"># single-digit prime</span>
<span class="c1"># it&#39;s in there!</span>
</code></pre></div><p>è¦ä»ä¸€å †å€¼ä¸­åˆ›å»ºä¸€ä¸ª <code>any</code> Junction, ä½ å¯ä»¥ä½¿ç”¨ <code>|</code> ä¸­ç¼€æ“ä½œç¬¦ã€è°ƒç”¨ <code>any</code> å‡½æ•°æˆ–è€…ä½¿ç”¨ <code>.any</code> æ–¹æ³•ã€‚ä¸Šé¢çš„æ¡ä»¶ä¼šè¿”å› True å¦‚æœ Junction ä¸­çš„ä»»æ„ä¸€ä¸ª(<code>any</code>) å€¼åŒ¹é…æ‰€ç»™å®šçš„å€¼çš„è¯ã€‚äº‹å®ä¸Š, æ²¡æœ‰äººèƒ½é˜»æ­¢ä½ åœ¨ä¸¤ç«¯éƒ½ä½¿ç”¨ Junction:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@one</span> <span class="o">=</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">@two</span> <span class="o">=</span> <span class="mi">5</span><span class="o">..</span><span class="mi">15</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">There&#39;s overlap!</span><span class="p">&#34;</span> <span class="k">if</span> <span class="nv">@one</span><span class="o">.</span><span class="nb">any</span> <span class="o">==</span> <span class="nv">@two</span><span class="o">.</span><span class="nb">any</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># there&#39;s overlap!</span>
</code></pre></div><p>è¿ç®—ç¬¦ä¼šè¿”å› True å¦‚æœ <code>@one</code> ä¸­çš„ä»»æ„ä¸€ä¸ªå€¼(<code>any</code>) åœ¨æ•°å€¼ä¸Šç­‰äº <code>@two</code> ä¸­çš„ä»»æ„ä¸€ä¸ªå€¼(<code>any</code>)çš„è¯ã€‚è¿™ä¸ªè¯­æ³•ç³–å¾ˆç”œ, ä½†æ˜¯æˆ‘ä»¬è¿˜å¯ä»¥åšçš„æ›´å¤šã€‚</p>
<h2 id="all-for-one-and-any-for-none">All for One and Any for None</h2>
<p><code>any</code> Junction å”¯ä¸€ä¸€ä¸ªä½ èƒ½è·å¾—çš„ Junctionã€‚ä½ è¿˜å¯ä»¥é€‰æ‹© <code>all</code>ã€<code>any</code>ã€<code>one</code> å’Œ <code>none</code>ã€‚å½“åœ¨å¸ƒå°”ä¸Šä¸‹æ–‡ä¸­æ—¶, å®ƒä»¬çš„æ„æ€å°±åƒä¸‹é¢è¿™æ ·; æ„å»º Junction çš„å‡½æ•°/æ–¹æ³•åå’Œ Junction è‡ªèº«çš„åå­—ä¸€æ ·å¹¶ä¸”ä¸‹é¢è¿˜åˆ—å‡ºäº†æ„å»º Junction çš„ä¸­ç¼€æ“ä½œç¬¦:</p>
<ul>
<li><code>all</code> â€” æ‰€æœ‰çš„å€¼éƒ½è¢«è®¡ç®—ä¸º True(ä½¿ç”¨ä¸­ç¼€ <code>&amp;</code>)</li>
<li><code>any</code> â€” è‡³å°‘å…¶ä¸­çš„ä¸€ä¸ªå€¼è¢«è®¡ç®—ä¸º True(ä½¿ç”¨ä¸­ç¼€ <code>|</code>)</li>
<li><code>one</code> â€” æ­£å¥½å…¶ä¸­æœ‰ä¸€ä¸ªå€¼è¢«è®¡ç®—ä¸º True(ä½¿ç”¨ä¸­ç¼€ <code>^</code>)</li>
<li><code>none</code> â€” æ²¡æœ‰ä¸€ä¸ªå€¼è¢«è®¡ç®—ä¸º True(æ²¡æœ‰å¯ç”¨çš„ä¸­ç¼€)</li>
</ul>
<p>ä½¿ç”¨ <code>all</code> JUnction æ—¶è¦ç‰¹åˆ«æ³¨æ„:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@values</span> <span class="o">=</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">5</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">all primes</span><span class="p">&#39;</span> <span class="k">if</span> <span class="nv">@values</span><span class="o">.</span><span class="nb">all</span> <span class="o">~~</span> <span class="o">*.</span><span class="nb">is-prime</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">@moar-values</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">also all primes</span><span class="p">&#39;</span> <span class="k">if</span> <span class="nv">@moar-values</span><span class="o">.</span><span class="nb">all</span> <span class="o">~~</span> <span class="o">*.</span><span class="nb">is-prime</span><span class="p">;</span>
</code></pre></div><p>å³ä½¿å®ƒæ²¡æœ‰å€¼çš„æ—¶å€™ä¹Ÿä¼šè¿”å› True, è¿™å¯èƒ½ä¸æ˜¯ä½ æƒ³è¦çš„ã€‚åœ¨é‚£äº›æƒ…å†µä¸‹, ä½ å¯ä»¥ä½¿ç”¨:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@moar-values</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">also all primes</span><span class="p">&#39;</span> <span class="k">if</span> <span class="nv">@moar-values</span> <span class="ow">and</span> <span class="nv">@moar-values</span><span class="o">.</span><span class="nb">all</span> <span class="o">~~</span> <span class="o">*.</span><span class="nb">is-prime</span><span class="p">;</span>
</code></pre></div><h2 id="call-me-baby">Call Me, Baby</h2>
<p>ä½ å¯ä»¥æŠŠ Junction ç”¨ä½œå¹¶ä¸æœŸæœ› Junction çš„å­ä¾‹ç¨‹çš„å‚æ•°ã€‚é‚£ä¹ˆä¼šå‘ç”Ÿä»€ä¹ˆå‘¢? å¯¹äºæ¯ä¸€ä¸ª Junctioned çš„å€¼, é‚£ä¸ªå­ä¾‹ç¨‹éƒ½ä¼šè¢«è°ƒç”¨ä¸€æ¬¡, å¹¶ä¸”è¿”å›å€¼ä¼šæ˜¯ä¸€ä¸ª Junctionï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">caculate-things</span><span class="p">(</span><span class="nv">$n</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$n</span><span class="s2"> is prime</span><span class="p">&#34;</span>          <span class="k">if</span> <span class="nv">$n</span><span class="o">.</span><span class="nb">is-prime</span><span class="p">;</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$n</span><span class="s2"> is an even number</span><span class="p">&#34;</span> <span class="k">if</span> <span class="nv">$n</span> <span class="nv">%%</span> <span class="mi">2</span><span class="p">;</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$n</span><span class="s2"> is pretty big</span><span class="p">&#34;</span>     <span class="k">if</span> <span class="nv">$n</span> <span class="o">&gt;</span> <span class="mf">1e6</span><span class="p">;</span>
    <span class="nv">$n</span>Â²<span class="p">;</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">@values</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">42</span><span class="o">,</span> <span class="mf">1e10</span><span class="o">.</span><span class="nb">Int</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">EXACTLY ONE square is larger than 1e10</span><span class="p">&#39;</span>
    <span class="k">if</span> <span class="mf">1e10</span> <span class="o">&lt;</span> <span class="n">calculate-things</span> <span class="nv">@values</span><span class="o">.</span><span class="nb">one</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># 5 is a prime</span>
<span class="c1"># 42 is an even number</span>
<span class="c1"># 10000000000 is an even number</span>
<span class="c1"># 10000000000 is pretty big</span>
<span class="c1"># EXACTLY ONE square is larger than 1e10</span>
</code></pre></div><p>æš´éœ²çš„å‰¯ä½œç”¨å¯èƒ½æœ‰ç‚¹å¤ªè¿‡ç¥å¥‡å¹¶ä¸”ä½ å¯èƒ½ä¸æƒ³åœ¨ç”Ÿäº§ä»£ç ä¸­çœ‹åˆ°å®ƒ, ä½†æ˜¯ä½¿ç”¨ä¸€ä¸ªå­ä¾‹ç¨‹æ¥ä¿®æ”¹åŸæ¥çš„ Junctioned åŒ–çš„å€¼æ˜¯ç›¸å½“èƒ½æ¥å—çš„ã€‚æ‰§è¡Œä¸€ä¸ªæ•°æ®åº“æŸ¥è¯¢æ¥è·å–&quot;å®é™…çš„&quot;å€¼å¹¶ä¸”åœ¨ä¹‹åè®¡ç®—é‚£ä¸ªæ¡ä»¶æ€ä¹ˆæ ·ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">use</span> <span class="nn">DBIish</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$dbh</span> <span class="o">=</span> <span class="n">DBIish</span><span class="o">.</span><span class="nb">connect</span><span class="o">:</span> <span class="p">&#39;</span><span class="s1">SQLite</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">:</span><span class="s">database</span><span class="p">&lt;</span><span class="s">test.db</span><span class="p">&gt;;</span>

<span class="k">sub</span> <span class="nb">lookup</span> <span class="p">(</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">given</span> <span class="nv">$dbh</span><span class="o">.</span><span class="nf">prepare:</span> <span class="p">&#39;</span><span class="s1">SELECT id, text FROM stuff WHERE id = ?</span><span class="p">&#39;</span> <span class="p">{</span>
        <span class="o">.</span><span class="nf">execute:</span> <span class="nv">$id</span><span class="p">;</span>
        <span class="o">.</span><span class="nf">allrows</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">1</span><span class="o">]</span> <span class="o">//</span> <span class="p">&#39;&#39;;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">@ids</span> <span class="o">=</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">10</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">yeah, it got it, bruh</span><span class="p">&#39;</span> <span class="k">if</span> <span class="p">&#39;</span><span class="s1">meow</span><span class="p">&#39;</span> <span class="ow">eq</span> <span class="nb">lookup</span> <span class="nv">@ids</span><span class="o">.</span><span class="nb">any</span><span class="p">;</span>

<span class="c1"># OUTPUT (the database has a row with id = 5 and text = &#39;meow&#39;):</span>
<span class="c1"># yeah, it got it, bruh</span>
</code></pre></div><h2 id="æˆ‘ä»¬ä¸€ç›´åœ¨æœŸç›¼ä½ -è¯·å">æˆ‘ä»¬ä¸€ç›´åœ¨æœŸç›¼ä½ , è¯·å</h2>
<p>é‚£ä¸ªæ¸¸æˆå˜åŒ–äº†å½“ä½ çš„å­ä¾‹ç¨‹æ­£å¥½æœŸæœ›ä¸€ä¸ª Junction ä½œä¸ºå‚æ•°çš„æ—¶å€™ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">do-stuff</span> <span class="p">(</span><span class="nb">Junction</span> <span class="nv">$n</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">value is even</span><span class="p">&#39;</span>  <span class="k">if</span> <span class="nv">$n</span> <span class="nv">%%</span> <span class="mi">2</span><span class="p">;</span>
    <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">value is prime</span><span class="p">&#39;</span> <span class="k">if</span> <span class="nv">$n</span><span class="o">.</span><span class="nb">is-prime</span><span class="p">;</span>
    <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">value is large</span><span class="p">&#39;</span> <span class="k">if</span> <span class="nv">$n</span> <span class="o">&gt;</span> <span class="mf">1e10</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">do-stuff</span> <span class="p">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mf">1e11</span><span class="o">.</span><span class="nb">Int</span><span class="p">)</span><span class="o">.</span><span class="nb">one</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">---</span><span class="p">&#39;;</span>
<span class="n">do-stuff</span> <span class="p">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mf">1e11</span><span class="o">.</span><span class="nb">Int</span><span class="p">)</span><span class="o">.</span><span class="nb">any</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># value is large</span>
<span class="c1"># ---</span>
<span class="c1"># value is even</span>
<span class="c1"># value is prime</span>
<span class="c1"># value is large</span>
</code></pre></div><p>å½“æˆ‘ä»¬æä¾›äº†ä¸€ä¸ª <code>one</code> Junction æ—¶, åªæœ‰æ­£å¥½æ»¡è¶³ç»™å®šå€¼ä¸­çš„å…¶ä¸­ä¸€ä¸ªæ¡ä»¶æ‰ä¼šè¢«è§¦å‘ã€‚å½“æˆ‘ä»¬æä¾›ä¸€ä¸ª <code>any</code> Junction æ—¶, æ»¡è¶³æ¡ä»¶çš„ä»»ä½•ä¸€ä¸ªç»™å®šå€¼éƒ½ä¼šè§¦å‘ã€‚</p>
<p>ä½†æ˜¯! ä½ æ²¡æœ‰å¿…è¦éç­‰ç€ä¸–ç•Œä¸ºä½ åˆ†å‘ Junctionã€‚ä½ è‡ªå·±åˆ¶é€ ä¸€ä¸ªæ€ä¹ˆæ ·å‘¢, è¿˜èƒ½åœ¨æµ‹è¯•æ¡ä»¶æ—¶èŠ‚çœä»£ç :</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">do-stuff</span> <span class="p">(</span><span class="o">*</span><span class="nv">@v</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$n</span> <span class="o">=</span> <span class="nv">@v</span><span class="o">.</span><span class="nb">one</span><span class="p">;</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$n</span><span class="s2"> is even</span><span class="p">&#34;</span>  <span class="k">if</span> <span class="nv">$n</span> <span class="nv">%%</span> <span class="mi">2</span><span class="p">;</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$n</span><span class="s2"> is prime</span><span class="p">&#34;</span> <span class="k">if</span> <span class="nv">$n</span><span class="o">.</span><span class="nb">is-prime</span><span class="p">;</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$n</span><span class="s2"> is large</span><span class="p">&#34;</span> <span class="k">if</span> <span class="nv">$n</span> <span class="o">&gt;</span> <span class="mf">1e10</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">do-stuff</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mf">1e11</span><span class="o">.</span><span class="nb">Int</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">---</span><span class="p">&#39;;</span>
<span class="n">do-stuff</span> <span class="mi">42</span><span class="p">;</span>

<span class="c1"># OUTPUT:</span>
<span class="c1"># one(2, 3, 100000000000) is large</span>
<span class="c1"># ---</span>
<span class="c1"># one(42) is even</span>
</code></pre></div><h2 id="æ²¡æœ‰äººæƒ³è¿‡å°†æ¥å—">æ²¡æœ‰äººæƒ³è¿‡å°†æ¥å—?</h2>
<p>è¿˜æœ‰ä¸€ä¸ªå°ç§˜å¯†: Junction è¢«è®¾è®¡ä¸ºæ—¶<a href="https://en.wikipedia.org/wiki/Automatic_parallelization">è‡ªåŠ¨çº¿ç¨‹åŒ–</a>çš„(å³ auto-threaded)ã€‚å°½ç®¡åœ¨å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™å®ƒä»¬åªä¼šä½¿ç”¨ä»…ä»…ä¸€ä¸ªçº¿ç¨‹, ä½ ä¸åº”è¯¥ä¾èµ–å®ƒä»¬èƒ½ä»¥ä»»ä½•å¯é¢„æµ‹çš„é¡ºåºè¢«æ‰§è¡Œã€‚è‡ªåŠ¨çº¿ç¨‹åŒ–ä¼šåœ¨ 2018 å¹´çš„æŸä¸ªæ—¶é—´è¢«å®ç°, æ‰€ä»¥ä¿æŒå…³æ³¨&hellip; ä½ ä¸å¿…åšä»»ä½•äº‹æƒ…, ä½ çš„å€¼å¾—è‡ªåŠ¨çº¿ç¨‹åŒ–çš„å¤æ‚ Junctioned åŒ–çš„æ“ä½œå¯èƒ½ä¼šåœ¨å‡ å¹´ä¹‹å†…å˜å¾—æ›´å¿«ã€‚</p>
<h2 id="ç»“è®º">ç»“è®º</h2>
<p>Raku çš„ Junction æ˜¯å€¼çš„å åŠ æ€, å®ƒå…è®¸ä½ æµ‹è¯•å¤šä¸ªå€¼å°±åƒå®ƒä»¬æ˜¯ä¸€ä¸ªå€¼ä¸€æ ·ã€‚é™¤äº†æä¾›éå¸¸çŸ­å¹¶ä¸”æ˜“è¯»çš„è¯­æ³•, Junction è¿˜å…è®¸ä½ ä½¿ç”¨å­ä¾‹ç¨‹å˜æ¢å åŠ å€¼æˆ–è€…ä½¿ç”¨å‰¯ä½œç”¨ã€‚</p>
<p>ä½ è¿˜å¯ä»¥ç”Ÿæˆæ˜¾å¼æ“ä½œ Junction çš„å­ä¾‹ç¨‹æˆ–è€…æŠŠæä¾›çš„å¤šä¸ªå€¼è½¬æ¢æˆ Junction ä»¥ç®€åŒ–ä»£ç ã€‚</p>
<p>æœ€å, Junction è¢«è®¾è®¡ä¸ºèƒ½ä½¿ç”¨æ‰€æœ‰ä½ è®¡ç®—æœºæ‰€æä¾›çš„å¯ç”¨èƒ½åŠ›å¹¶ä¸”åœ¨ä¸ä¹…çš„å°†æ¥ä¼šåšæˆè‡ªåŠ¨çº¿ç¨‹åŒ–ã€‚</p>
<p>Junction å¾ˆç²¾å½©, ä½¿ç”¨å®ƒä»¬, ç©çš„å¼€å¿ƒ!</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/junction" term="junction" label="junction" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä¸­çš„æ•è·]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-04-01-capture-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-04-01-capture-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-10T00:00:00+08:00</published>
            <updated>2021-07-10T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Capture in Raku</blockquote><p><a href="http://doc.raku.org/type/Capture">Capture</a> çš„å®šä¹‰:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nb">Capture</span> <span class="k">does</span> <span class="nb">Positional</span> <span class="k">does</span> <span class="nb">Associative</span> <span class="p">{</span> <span class="p">}</span>
</code></pre></div><p>Capture æ˜¯ä¸€ä¸ªç”¨äºç»™ code å¯¹è±¡ä¼ é€’å‚æ•°çš„å®¹å™¨ã€‚Captures æ˜¯ç­¾åçš„å¦ä¸€é¢ â€” Captures åœ¨è°ƒç”¨æ–¹å®šä¹‰å®å‚, è€Œç­¾å(Signatures) åœ¨è¢«è°ƒç”¨æ–¹å®šä¹‰å½¢å¼å‚æ•°ã€‚</p>
<p>å½“ä½ è°ƒç”¨ <code>print $a, $b</code> æ—¶, <code>$a, $b</code> è¿™éƒ¨åˆ†å°±æ˜¯ä¸€ä¸ª Captureã€‚<code>$a, $b</code> åœ¨è¿™å„¿æ˜¯å®å‚ã€‚</p>
<p>Captures åŒ…å«ä¸€ä¸ª list-like éƒ¨åˆ†çš„ä½ç½®å‚æ•°å’Œä¸€ä¸ª hash-like éƒ¨åˆ†çš„å…·åå‚æ•°ã€‚å¯¹äºå…·åå‚æ•°, Captures ä½¿ç”¨ä¸€ç§ç•¥å¾®ä¸åŒçš„è¯­æ³•è€Œä¸æ˜¯æ™®é€šçš„ Listã€‚æœ‰ä¸¤ç§ç®€å•çš„æ–¹æ³•ç”Ÿæˆä¸€ä¸ªå…·åå‚æ•°ï¼š</p>
<ul>
<li>ä½¿ç”¨ä¸€ä¸ªæœªå¼•èµ·çš„é”®å‘½åä¸€ä¸ªå½¢å‚, åé¢è·Ÿç€ <code>=&gt;</code>, ç„¶åè·Ÿç€å‚æ•°</li>
<li>ä½¿ç”¨ä»¥å½¢å‚å‘½åçš„å†’å·å¯¹å„¿å­—é¢é‡</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nb">unique</span> <span class="mi">1</span><span class="o">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="s">as</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nb">abs</span> <span class="nv">$_</span> <span class="p">};</span> <span class="c1"># 1</span>, <span class="o">-</span><span class="mi">2</span><span class="o">,</span> <span class="mi">3</span>
<span class="c1"># ... is the same thing as:</span>
<span class="nb">say</span> <span class="nb">unique</span> <span class="mi">1</span><span class="o">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="p">:</span><span class="s">as</span><span class="p">({</span> <span class="nb">abs</span> <span class="nv">$_</span> <span class="p">});</span>  <span class="c1"># 1, -2, 3</span>
<span class="c1"># Be careful not to quote the name of a named parameter:</span>
<span class="nb">say</span> <span class="nb">unique</span> <span class="mi">1</span><span class="o">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">as</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nb">abs</span> <span class="nv">$_</span> <span class="p">};</span> <span class="c1"># 1, -2, 2, 3, &#34;as&#34; =&gt; { ... }</span>
</code></pre></div><p>å•ä¸ªç‹¬ç«‹çš„ Capture ä¹Ÿèƒ½è¢«ç”Ÿæˆ, å­˜å‚¨, ç„¶åä¾›ä¹‹åä½¿ç”¨ã€‚ åœ¨é¡¹(term)é‚£å„¿å‰ç½®ä¸€ä¸ªåæ–œçº¿ <code>\</code> èƒ½ç”Ÿæˆä¸€ä¸ªå­—é¢çš„ Captureã€‚é€šå¸¸, è¿™ä¸ª term ä¼šæ˜¯ä¸€ä¸ª terms çš„åˆ—è¡¨, åœ¨è¿™ä¸ªåˆ—è¡¨é‡Œé¢, ä»»ä½• Pair å­—é¢å€¼ä¼šè¢«æ”¾åœ¨ Capture çš„å…·åéƒ¨åˆ†, è€Œå…¶å®ƒ terms ä¼šè¢«æ”¾åœ¨Capture çš„ä½ç½®(positional) éƒ¨åˆ†ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$c</span> <span class="o">=</span> \<span class="p">(</span><span class="mi">42</span><span class="p">);</span>          <span class="c1"># å¸¦æœ‰ä¸€ä¸ª positional éƒ¨åˆ†çš„ Capture        </span>
<span class="nv">$c</span> <span class="o">=</span> \<span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="s">a</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">b</span><span class="p">&#39;);</span> <span class="c1"># å¸¦æœ‰ä¸¤ä¸ª positional éƒ¨åˆ†å’Œä¸€ä¸ªå…·åéƒ¨åˆ†çš„ Capture</span>
</code></pre></div><p>è¦ä½¿ç”¨è¿™æ ·çš„ Capture, åœ¨å‡½æ•°è°ƒç”¨é‡Œä½ å¯ä»¥åœ¨è¿™ä¸ª Capture å‰é¢ä½¿ç”¨ <code>|</code> , é‚£ä¹ˆå®ƒçœ‹èµ·æ¥ä¼šåƒè¿™ä¸ª Capture ä¸­çš„æ‰€æœ‰å€¼éƒ½è¢«ä½œä¸ºå®å‚ç›´æ¥ä¼ é€’è¿™ä¸ªå‡½æ•°äº† â€” å…·åå‚æ•°ä½œä¸ºå…·åå‚æ•°ä¼ é€’, è€Œä½ç½®å‚æ•°ä¼šä½œä¸ºä½ç½®å‚æ•°ä¼ é€’ã€‚ åªè¦ä½ æ„¿æ„, ä½ å¯ä»¥é‡ç”¨è¿™ä¸ª Capture ä»»æ„æ¬¡, ç”šè‡³ä½¿ç”¨ä¸åŒçš„å‡½æ•°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$c</span> <span class="o">=</span> \<span class="p">(</span><span class="mi">4</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="p">);</span>
<span class="nb">reverse</span><span class="p">(</span><span class="o">|</span><span class="nv">$c</span><span class="p">)</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span> <span class="c1"># 3 2 4</span>
<span class="nb">sort</span><span class="p">(</span><span class="mi">5</span><span class="o">,|</span><span class="nv">$c</span><span class="p">)</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>  <span class="c1"># 2 3 4 5</span>
</code></pre></div><p>åœ¨ç­¾å( Signature) é‡Œé¢, å¯ä»¥åœ¨ä¸å«ç¬¦å·çš„å½¢å‚é‚£å„¿å‰ç½®ä¸€ä¸ªç«–çº¿ <code>|</code> æ¥åˆ›å»ºä¸€ä¸ª Captureã€‚è¿™ä¼šæŠŠä½™ä¸‹çš„å‚æ•°åˆ—è¡¨æ‰“åŒ…åˆ°é‚£ä¸ªå½¢å‚ä¸­ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">f</span><span class="p">(</span><span class="nv">$a</span><span class="o">,</span> <span class="o">|</span><span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="n">c</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">f</span><span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="s">a</span> <span class="o">=&gt;</span> <span class="mi">4</span>, <span class="s">b</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">);</span>
<span class="c1"># c  is  \(2, 3, a =&gt; 4, b =&gt; 5)</span>
</code></pre></div><p>è¯·æ³¨æ„ï¼ŒCapture ä»ç„¶æ˜¯åˆ—è¡¨ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½åŒ…å«å®¹å™¨ï¼Œè€Œä¸åªæ˜¯å€¼:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$c</span> <span class="o">=</span> \<span class="p">(</span><span class="mi">4</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="nv">$b</span><span class="o">,</span><span class="mi">3</span><span class="p">);</span>
<span class="nb">sort</span><span class="p">(</span><span class="o">|</span><span class="nv">$c</span><span class="p">)</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>        <span class="c1"># 1 2 3 4</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
<span class="nb">sort</span><span class="p">(</span><span class="o">|</span><span class="nv">$c</span><span class="p">)</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>        <span class="c1"># 2 3 4 6</span>
</code></pre></div><h3 id="capture-æ–¹æ³•from-mu">Capture æ–¹æ³•(From Mu)</h3>
<p>å®šä¹‰ä¸º:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">method</span> <span class="nb">Capture</span><span class="p">(</span><span class="n">Mu:D:</span> <span class="k">--&gt;</span> <span class="nb">Capture:D</span><span class="p">)</span>
</code></pre></div><p>è¿”å›ä¸è°ƒç”¨è€…çš„å…¬å…±å±æ€§ç›¸å¯¹åº”çš„å‘½åå‚æ•°çš„ <a href="https://docs.raku.org/type/Capture">Capture</a>ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.foo</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.bar</span> <span class="o">=</span> <span class="mi">70</span><span class="p">;</span>
    <span class="k">method</span> <span class="nf">bar</span> <span class="p">{</span> <span class="p">&#39;</span><span class="s1">something else</span><span class="p">&#39;</span> <span class="p">}</span>
<span class="p">}</span><span class="o">.</span><span class="nb">new</span><span class="o">.</span><span class="nb">Capture</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>

<span class="c1"># OUTPUT: Â«\(:bar(&#34;something else&#34;), :foo(42))â¤Â» </span>
</code></pre></div><h3 id="cpature-æ–¹æ³•from-list">Cpature æ–¹æ³•(from List)</h3>
<p>å®šä¹‰ä¸º:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">method</span> <span class="nb">Capture</span><span class="p">(</span><span class="k">--&gt;</span> <span class="nb">Capture:D</span><span class="p">)</span>
</code></pre></div><p>è¿”å›ä¸€ä¸ª <a href="https://docs.raku.org/type/Capture">Capture</a>ï¼Œå…¶ä¸­åˆ—è¡¨ä¸­çš„æ¯ä¸ª <a href="https://docs.raku.org/type/Pair">Pair</a>ï¼ˆå¦‚æœæœ‰ï¼‰å·²è½¬æ¢ä¸ºå‘½åå‚æ•°ï¼ˆä½¿ç”¨Pair stringçš„é”®ï¼‰ã€‚åˆ—è¡¨ä¸­çš„æ‰€æœ‰å…¶ä»–å…ƒç´ æŒ‰ç…§å®ƒä»¬è¢«å‘ç°çš„é¡ºåºè½¬æ¢ä¸ºä½ç½®å‚æ•°ï¼Œå³åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªé Pair item æˆä¸ºç¬¬ä¸€ä¸ªä½ç½®å‚æ•°ï¼Œå…¶è·å¾—ç´¢å¼• 0ï¼Œç¬¬äºŒä¸ªé pair item æˆä¸ºç¬¬äºŒä¸ªä½ç½®å‚æ•°ï¼Œç´¢å¼•ä¸º 1 ç­‰ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$list</span> <span class="o">=</span> <span class="p">(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="s">a</span> <span class="o">=&gt;</span> <span class="mi">2</span>, <span class="s">b</span> <span class="o">=&gt;</span> <span class="mi">17</span><span class="p">);</span>
<span class="k">my</span> <span class="nv">$capture</span> <span class="o">=</span> <span class="nv">$list</span><span class="o">.</span><span class="nb">Capture</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$capture</span><span class="o">.</span><span class="nb">keys</span><span class="p">;</span> <span class="c1"># OUTPUT: Â«(0 1 a b)â¤Â» </span>
<span class="nf">my-sub</span><span class="p">(</span><span class="o">|</span><span class="nv">$capture</span><span class="p">);</span> <span class="c1"># RESULT: Â«7, 5, 2, 17Â» </span>
 
<span class="k">sub</span> <span class="nf">my-sub</span><span class="p">(</span><span class="nv">$first</span><span class="o">,</span> <span class="nv">$second</span><span class="o">,</span> <span class="o">:</span><span class="nv">$a</span><span class="o">,</span> <span class="o">:</span><span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$first</span><span class="s2">, </span><span class="nv">$second</span><span class="s2">, </span><span class="nv">$a</span><span class="s2">, </span><span class="nv">$b</span><span class="p">&#34;</span>
<span class="p">}</span>
</code></pre></div><p>ä¸€ä¸ªæ›´é«˜çº§çš„ä¾‹å­æ˜¯æ‰€è¿”å›çš„ <code>Capture</code> ä¸ <a href="https://docs.raku.org/type/Signature">ç­¾å</a> è¿›è¡Œæ™ºèƒ½åŒ¹é…ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$list</span> <span class="o">=</span> <span class="p">(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="s">a</span> <span class="o">=&gt;</span> <span class="mi">2</span>, <span class="s">b</span> <span class="o">=&gt;</span> <span class="mi">17</span><span class="p">);</span>
<span class="nb">say</span> <span class="nb">so</span> <span class="nv">$list</span><span class="o">.</span><span class="nb">Capture</span> <span class="o">~~</span> <span class="o">:</span><span class="p">(</span><span class="nv">$</span> <span class="k">where</span> <span class="o">*</span> <span class="o">==</span> <span class="mi">7</span><span class="o">,</span><span class="nv">$</span><span class="o">,:</span><span class="nv">$a</span><span class="o">,:</span><span class="nv">$b</span><span class="p">);</span> <span class="c1"># OUTPUT: Â«Trueâ¤Â» </span>
 
<span class="nv">$list</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="s">a</span> <span class="o">=&gt;</span> <span class="mi">2</span>, <span class="s">b</span> <span class="o">=&gt;</span> <span class="mi">17</span><span class="p">);</span>
<span class="nb">say</span> <span class="nb">so</span> <span class="nv">$list</span><span class="o">.</span><span class="nb">Capture</span> <span class="o">~~</span> <span class="o">:</span><span class="p">(</span><span class="nv">$</span> <span class="k">where</span> <span class="o">*</span> <span class="o">==</span> <span class="mi">7</span><span class="o">,</span><span class="nv">$</span><span class="o">,:</span><span class="nv">$a</span><span class="o">,:</span><span class="nv">$b</span><span class="p">);</span> <span class="c1"># OUTPUT: Â«Falseâ¤Â» </span>
</code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/capture" term="capture" label="capture" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä¸­çš„æ“ä½œç¬¦]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-03-16-operator-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-03-16-operator-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-10T00:00:00+08:00</published>
            <updated>2021-07-10T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Operator in Raku</blockquote><h2 id="æ“ä½œç¬¦httpsdocsrakuorglanguageoperators"><a href="https://docs.raku.org/language/operators">æ“ä½œç¬¦</a></h2>
<h3 id="æ“ä½œç¬¦ä¼˜å…ˆçº§">æ“ä½œç¬¦ä¼˜å…ˆçº§</h3>
<p>åœ¨åƒ <code>1 + 2 * 3</code> è¿™æ ·çš„è¡¨è¾¾å¼ä¸­, <code>2 * 3</code> è¢«é¦–å…ˆè®¡ç®—, å› ä¸ºä¸­ç¼€æ“ä½œç¬¦  <code>*</code> çš„ä¼˜å…ˆçº§æ¯” <code>+</code> çš„ä¼˜å…ˆçº§é«˜ã€‚ä¸‹é¢çš„è¡¨ä¸­æ€»ç»“äº† Perl  6 ä¸­  çš„ä¼˜å…ˆçº§çº§åˆ«, ä»æœ€ç‰¢å›ºåˆ°æœ€æ¾æ•£ï¼š</p>
<pre><code>A	Level	           Examples
N	Terms	           42 3.14 &quot;eek&quot; qq[&quot;foo&quot;] $x :!verbose @$array
L	æ–¹æ³•åç¼€	        .meth .+ .? .* .() .[] .{} .&lt;&gt; .Â«Â» .:: .= .^ .:
N	è‡ªå¢	              ++ --
R	æ±‚å¹‚	              **
L	Symbolic unary	   ! + - ~ ? | || +^ ~^ ?^ ^
L	ä¹˜æ³•	              * / % %% +&amp; +&lt; +&gt; ~&amp; ~&lt; ~&gt; ?&amp; div mod gcd lcm
L	åŠ æ³•	              + - +| +^ ~| ~^ ?| ?^
L	é‡å¤	              x xx
X	è¿ç»“                ~
X	Junctive and	   &amp;
X	Junctive or	       | ^
L	Named unary	       temp let
N	Structural infix   but does &lt;=&gt; leg cmp .. ..^ ^.. ^..^
C	Chaining infix	   != == &lt; &lt;= &gt; &gt;= eq ne lt le gt ge ~~ === eqv !eqv
X	Tight and	       &amp;&amp;
X	Tight or	       || ^^ // min max
R	Conditional	       ?? !! ff fff
R	Item assignment	   = =&gt; += -= **= xx= .=
L	Loose unary	       so not
X	Comma operator	   , :
X	List infix	       Z minmax X X~ X* Xeqv ...
R	List prefix	       print push say die map substr ... [+] [*] any Z=
X	Loose and	       and andthen
X	Loose or	       or xor orelse
X	Sequencer	       &lt;==, ==&gt;, &lt;&lt;==, ==&gt;&gt;
N	Terminator	       ; {...}, unless, extra ), ], }
</code></pre><p>ä¸‹é¢ä½¿ç”¨çš„ä¸¤å¤„ <code>!</code> ç¬¦å·ä¸€èˆ¬ä»£è¡¨ä»»ä½•ä¸€å¯¹å„¿æ‹¥æœ‰ç›¸åŒä¼˜å…ˆçº§çš„æ“ä½œç¬¦, ä¸Šè¡¨æŒ‡å®šçš„äºŒå…ƒæ“ä½œç¬¦çš„ç»“åˆæ€§è§£é‡Šå¦‚ä¸‹(å…¶ä¸­ A ä»£è¡¨ç»“åˆæ€§, associativities )ï¼š</p>
<pre><code>A	Assoc	Meaning of $a ! $b ! $c
L	left	($a ! $b) ! $c
R	right	$a ! ($b ! $c)
N	non	    ILLEGAL
C	chain	($a ! $b) and ($b ! $c)
X	list	infix:&lt;!&gt;($a; $b; $)
</code></pre><p>å¯¹äºä¸€å…ƒæ“ä½œç¬¦, è¿™è§£é‡Šä¸º:</p>
<pre><code>A	Assoc	Meaning of !$a!
L	left	(!$a)!
R	right	!($a!)
N	non	    ILLEGAL
</code></pre><p>ä¸‹é¢æè¿°çš„æ“ä½œç¬¦, é»˜è®¤å‡å®šä¸º left ç»“åˆæ€§ã€‚</p>
<h3 id="æ“ä½œç¬¦ç§ç±»">æ“ä½œç¬¦ç§ç±»</h3>
<p>æ“ä½œç¬¦èƒ½å‡ºç°åœ¨ç›¸å¯¹äº term çš„å‡ ä¸ªä½ç½®å¤„ï¼š</p>
<pre><code>+term	        prefix         (åç¼€)
term1 + term2	infix          (ä¸­ç¼€)
term++	        postfix        (åç¼€)
(term)	        circumfix      (ç¯ç¼€)
term1[term2]	postcircumfix  (åç¯ç¼€)
</code></pre><p>æ¯ä¸ªæ“ä½œç¬¦ä¹Ÿå¯ä»¥ç”¨ä½œå­ä¾‹ç¨‹ã€‚è¿™æ ·çš„å­ä¾‹ç¨‹çš„åå­—ç”±æ“ä½œç¬¦çš„ç§ç±», ç„¶ååè·Ÿä¸€ä¸ªå†’å·, å†åŠ ä¸Šä¸€ç»„å¼•å·ç»“æ„, å¼•å·ç»“æ„ä¸­æ˜¯ç»„æˆæ“ä½œç¬¦çš„ç¬¦å·(s):</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">+</span><span class="p">&gt;(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="p">)</span>                           <span class="c1"># same as 1 + 2</span>
<span class="n">circumfix:</span><span class="p">Â«</span><span class="s2">( )</span><span class="p">Â»(&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">b</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">c</span><span class="p">&#39;)</span>            <span class="c1"># same as (&#39;a&#39;, &#39;b&#39;, &#39;c&#39;), ç›®å‰ç¼–è¯‘é”™è¯¯ã€‚</span>
<span class="n">circumfix:</span><span class="p">&lt;</span><span class="s">[ ]</span><span class="p">&gt;(&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">b</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">c</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">raku</span><span class="o">.</span><span class="nb">say</span>   <span class="c1"># [&#34;a&#34;, &#34;b&#34;, &#34;c&#34;]</span>
</code></pre></div><p>ä½œä¸ºä¸€ç§ç‰¹æ®Šæƒ…å†µ, listop(åˆ—è¡¨æ“ä½œç¬¦)æ—¢èƒ½ä½œä¸º term åˆèƒ½ä½œä¸ºå‰ç¼€ã€‚å­ä¾‹ç¨‹è°ƒç”¨æ˜¯æœ€å¸¸è§çš„åˆ—è¡¨æ“ä½œç¬¦ã€‚å…¶å®ƒæƒ…å†µåŒ…æ‹¬å…ƒè¿ç®—ä¸­ç¼€æ“ä½œç¬¦ <code>[+]| 1, 2, 3</code> å’Œ <code>prefix</code> ç­‰ stub æ“ä½œç¬¦ã€‚</p>
<p>å®šä¹‰è‡ªå®šä¹‰æ“ä½œç¬¦åœ¨ <a href="http://doc.raku.org/language/functions#Defining_Operators"> /language/functions#Defining_Operators.</a>  ä¸­æœ‰æ¶‰åŠã€‚</p>
<h3 id="term-ä¼˜å…ˆçº§">Term ä¼˜å…ˆçº§</h3>
<h4 id="ç¯ç¼€--">ç¯ç¼€ &lt; &gt;</h4>
<p>å¼•èµ·å•è¯çš„ç»“æ„, ä»¥ç©ºç™½éš”å¼€å†…å®¹ã€‚å¦‚æœå•è¯çœ‹èµ·æ¥åƒæ•°å­—å­—é¢é‡æˆ– <code>Pair</code> å­—é¢é‡, é‚£ä¹ˆå®ƒä¼šè¢«è½¬ä¸ºåˆé€‚çš„æ•°å­—ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>  <span class="c1"># b</span>
</code></pre></div><h3 id="ç¯ç¼€---1">ç¯ç¼€ ( )</h3>
<p>åˆ†ç»„æ“ä½œç¬¦ã€‚</p>
<p>åœ¨å‚æ•°åˆ—è¡¨ä¸­, åœ¨å‚æ•°å‘¨å›´æ”¾ä¸Šåœ†æ‹¬å·é˜²æ­¢äº†å‚æ•°è¢«è§£é‡Šä¸ºå…·åå‚æ•°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nf">p</span><span class="p">(</span><span class="o">:</span><span class="nv">$a</span><span class="o">!</span><span class="p">)</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">named</span><span class="p">&#39;</span>      <span class="p">}</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nf">p</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span>   <span class="p">{</span> <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">positional</span><span class="p">&#39;</span> <span class="p">}</span>
<span class="n">p</span> <span class="s">a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">;</span>       <span class="c1"># named</span>
<span class="n">p</span> <span class="p">(</span><span class="s">a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">);</span>     <span class="c1"># positional</span>
</code></pre></div><h3 id="ç¯ç¼€---2">ç¯ç¼€ { }</h3>
<p>Block æˆ– æ•£åˆ—æ„é€ å™¨ã€‚</p>
<p>å¦‚æœ <code>{}</code> é‡Œé¢çš„å†…å®¹çœ‹èµ·æ¥åƒä¸€ç»„ pairs å¹¶ä¸”æ²¡æœ‰ <code>$_</code> æˆ–å…¶å®ƒå ä½ç¬¦å‚æ•°, å°±è¿”å›ä¸€ä¸ªæ•£åˆ—, è¿™ä¸ªæ•£åˆ—ç”±é€é¡¹é€é¡¹çš„ Pair ç»„æˆã€‚</p>
<p>å¦åˆ™å°±è¿”å›ä¸€ä¸ª Blockã€‚</p>
<p>æ³¨æ„, è¿™ä¸ªç»“æ„æ²¡æœ‰é‡æ–°è§£æå†…å®¹; è€Œé‡Œé¢çš„å†…å®¹æ€»æ˜¯è¢«è§£æä¸ºä¸€ç»„å¥å­ï¼ˆä¾‹å¦‚, åƒä¸€ä¸ª blockï¼‰, å¹¶ä¸”å¦‚æœåé¢çš„åˆ†æè¡¨æ˜å®ƒéœ€è¦è¢«è§£ææˆä¸€ä¸ªæ•£åˆ—, é‚£ä¹ˆ block å°±ä¼šè¢«æ‰§è¡Œå¹¶å¼ºè½¬ä¸ºæ•£åˆ—ã€‚</p>
<h3 id="ç¯ç¼€---3">ç¯ç¼€ [ ]</h3>
<p>æ•°ç»„æ„é€ å™¨ã€‚åœ¨åˆ—è¡¨ä¸Šä¸‹æ–‡ä¸­è¿”å›ä¸€ä¸ªä¸ä¼šå±•å¹³çš„ item åŒ–çš„æ•°ç»„ã€‚</p>
<h2 id="æ–¹æ³•åç¼€ä¼˜å…ˆçº§">æ–¹æ³•åç¼€ä¼˜å…ˆçº§</h2>
<h3 id="åç¯ç¼€--">åç¯ç¼€ [ ]</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">postcircumfix:</span><span class="p">&lt;</span><span class="s">[ ]</span><span class="p">&gt;(</span><span class="nv">@container</span><span class="o">,</span> <span class="o">**</span><span class="nv">@index</span><span class="o">,</span>
                        <span class="o">:</span><span class="nv">$k</span><span class="o">,</span> <span class="o">:</span><span class="nv">$v</span><span class="o">,</span> <span class="o">:</span><span class="nv">$kv</span><span class="o">,</span> <span class="o">:</span><span class="nv">$p</span><span class="o">,</span> <span class="o">:</span><span class="nv">$exists</span><span class="o">,</span> <span class="o">:</span><span class="nv">$delete</span><span class="p">)</span>
</code></pre></div><p><code>:$k</code> ä¼šåˆ›å»ºä¸€ä¸ª Pair, å®ƒæ˜¯æ•£åˆ—ä¸­çš„ä¸€ä¸ªæ¡ç›®ã€‚é”®æ˜¯ <code>k</code>, é”®å€¼ä¸º <code>$kv</code>ã€‚æ‰€ä»¥, <code>$k</code> ç­‰ä»·äº <code>k</code> =&gt; <code>$k</code></p>
<p>è®¿é—® <code>@container</code>  ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ , å³æ•°ç»„ç´¢å¼•æ“ä½œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@alphabet</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;</span> <span class="o">..</span> <span class="p">&#39;</span><span class="s1">z</span><span class="p">&#39;;</span>
<span class="nb">say</span> <span class="nv">@alphabet</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>                   <span class="c1">#-&gt; a</span>
<span class="nb">say</span> <span class="nv">@alphabet</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>                   <span class="c1">#-&gt; b</span>
<span class="nb">say</span> <span class="nv">@alphabet</span><span class="o">[*-</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>                 <span class="c1">#-&gt; z</span>
<span class="nb">say</span> <span class="nv">@alphabet</span><span class="o">[</span><span class="mi">100</span><span class="o">]</span><span class="p">:</span><span class="s">exists</span><span class="p">;</span>          <span class="c1">#-&gt; False</span>
<span class="nb">say</span> <span class="nv">@alphabet</span><span class="o">[</span><span class="mi">15</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">17</span><span class="o">,</span> <span class="mi">11</span><span class="o">].</span><span class="nb">join</span><span class="p">;</span>  <span class="c1">#-&gt; perl</span>
<span class="nb">say</span> <span class="nv">@alphabet</span><span class="o">[</span><span class="mi">23</span> <span class="o">..</span> <span class="o">*].</span><span class="nb">raku</span><span class="p">;</span>        <span class="c1">#-&gt; (&#34;x&#34;, &#34;y&#34;, &#34;z&#34;)</span>

<span class="nv">@alphabet</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">]</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">B</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">C</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="nv">@alphabet</span><span class="o">[</span><span class="mi">0</span><span class="o">..</span><span class="mi">3</span><span class="o">].</span><span class="nb">raku</span>            <span class="c1">#-&gt; (&#34;a&#34;, &#34;B&#34;, &#34;C&#34;, &#34;d&#34;)</span>
</code></pre></div><p>æŸ¥çœ‹ <a href="http://doc.raku.org/language/subscripts">Subscripts</a> è·å–å…³äºè¯¥æ“ä½œç¬¦è¡Œä¸ºçš„æ›´è¯¦ç»†çš„è§£é‡Š, è¿˜æœ‰æ€ä¹ˆåœ¨è‡ªå®šä¹‰ç±»å‹ä¸­å®ç°å¯¹å®ƒçš„æ”¯æŒã€‚</p>
<h3 id="åç¯ç¼€---1">åç¯ç¼€ { }</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">postcircumfix:</span><span class="p">&lt;</span><span class="s">{ }</span><span class="p">&gt;(</span><span class="nv">%container</span><span class="o">,</span> <span class="o">**</span><span class="nv">@key</span><span class="o">,</span>
                        <span class="o">:</span><span class="nv">$k</span><span class="o">,</span> <span class="o">:</span><span class="nv">$v</span><span class="o">,</span> <span class="o">:</span><span class="nv">$kv</span><span class="o">,</span> <span class="o">:</span><span class="nv">$p</span><span class="o">,</span> <span class="o">:</span><span class="nv">$exists</span><span class="o">,</span> <span class="o">:</span><span class="nv">$delete</span><span class="p">)</span>
</code></pre></div><p>è®¿é—® <code>%container</code> çš„ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ , å³æ•£åˆ—ç´¢å¼•æ“ä½œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span>  <span class="nv">%color</span> <span class="o">=</span> <span class="s">kiwi</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">green</span><span class="p">&#34;</span>, <span class="s">banana</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">yellow</span><span class="p">&#34;</span>, <span class="s">cherry</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">red</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="nv">%color</span><span class="p">{&#34;</span><span class="s2">banana</span><span class="p">&#34;};</span>               <span class="c1">#-&gt; yellow</span>
<span class="nb">say</span> <span class="nv">%color</span><span class="p">{&#34;</span><span class="s2">cherry</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">kiwi</span><span class="p">&#34;}</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>  <span class="c1">#-&gt; (&#34;red&#34;, &#34;green&#34;)</span>
<span class="nb">say</span> <span class="nv">%color</span><span class="p">{&#34;</span><span class="s2">strawberry</span><span class="p">&#34;}:</span><span class="s">exists</span><span class="p">;</span>    <span class="c1">#-&gt; False</span>

<span class="nv">%color</span><span class="p">{&#34;</span><span class="s2">banana</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">lime</span><span class="p">&#34;}</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">yellowish</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">green</span><span class="p">&#34;;</span>
<span class="nv">%color</span><span class="p">{&#34;</span><span class="s2">cherry</span><span class="p">&#34;}:</span><span class="s">delete</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">%color</span><span class="p">;</span>  <span class="c1">#-&gt; banana =&gt; yellowish, kiwi =&gt; green, lime =&gt; green</span>
</code></pre></div><p>æŸ¥çœ‹åç¯ç¼€ <code>&lt; &gt;</code> å’Œåç¯ç¼€ <code>Â« Â»</code> ä½œä¸ºä¾¿æ·å½¢å¼, æŸ¥çœ‹ <code>Subscripts</code> è·å–è¿™ä¸ªæ“ä½œç¬¦è¡Œä¸ºçš„æ›´è¯¦ç»†è§£é‡Š, è¿˜æœ‰æ€ä¹ˆåœ¨è‡ªå®šä¹‰ç±»å‹ä¸­å®ç°å¯¹å®ƒçš„æ”¯æŒã€‚</p>
<h3 id="åç¯ç¼€---2">åç¯ç¼€ &lt; &gt;</h3>
<p>åç¯ç¼€ <code>{ }</code> çš„ç®€å†™å½¢å¼, å®ƒä¼šå¼•èµ·å®ƒçš„å‚æ•°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%color</span> <span class="o">=</span> <span class="s">kiwi</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">green</span><span class="p">&#34;</span>, <span class="s">banana</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">yellow</span><span class="p">&#34;</span>, <span class="s">cherry</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">red</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="nv">%color</span><span class="p">&lt;</span><span class="s">banana</span><span class="p">&gt;;</span>             <span class="c1">#-&gt; yellow</span>
<span class="nb">say</span> <span class="nv">%color</span><span class="p">&lt;</span><span class="s">cherry kiwi</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>   <span class="c1">#-&gt; (&#34;red&#34;, &#34;green&#34;)</span>
<span class="nb">say</span> <span class="nv">%color</span><span class="p">&lt;</span><span class="s">strawberry</span><span class="p">&gt;:</span><span class="s">exists</span><span class="p">;</span>  <span class="c1">#-&gt; False</span>
</code></pre></div><p>è¿™ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„æ“ä½œç¬¦, å®ƒä»…ä»…æ˜¯ä¸€ä¸ªåœ¨ç¼–è¯‘æ—¶æŠŠ <code>&lt; &gt;</code> å˜æˆ <code>{}</code> åç¯ç¼€æ“ä½œç¬¦çš„è¯­æ³•ç³–ã€‚</p>
<h3 id="åç¯ç¼€---3">åç¯ç¼€ Â« Â»</h3>
<p>åç¯ç¼€ <code>{ }</code> çš„ç®€å†™å½¢å¼ã€‚å®ƒä¼šå¼•èµ·å®ƒçš„å‚æ•°, å¹¶ä¸” <code>Â« Â»</code> ä¸­èƒ½è¿›è¡Œå˜é‡æ’å€¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%color</span> <span class="o">=</span> <span class="s">kiwi</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">green</span><span class="p">&#34;</span>, <span class="s">banana</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">yellow</span><span class="p">&#34;</span>, <span class="s">cherry</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">red</span><span class="p">&#34;;</span>
<span class="k">my</span> <span class="nv">$fruit</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">kiwi</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="nv">%color</span><span class="p">Â«</span><span class="s2">cherry </span><span class="nv">$fruit</span><span class="p">Â»</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>   <span class="c1">#-&gt; (&#34;red&#34;, &#34;green&#34;)</span>
</code></pre></div><p>è¿™ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„æ“ä½œç¬¦, å®ƒä»…ä»…æ˜¯ä¸€ä¸ªåœ¨ç¼–è¯‘æ—¶æŠŠ <code>Â« Â»</code> å˜æˆ <code>{}</code> åç¯ç¼€æ“ä½œç¬¦çš„è¯­æ³•ç³–ã€‚</p>
<h3 id="åç¯ç¼€---4">åç¯ç¼€ ( )</h3>
<p>è°ƒç”¨æ“ä½œç¬¦ã€‚æŠŠè°ƒç”¨è€…å½“ä½œ <code>Callable</code> å¹¶å¼•ç”¨å®ƒ, å®ƒä½¿ç”¨åœ†æ‹¬å·ä¹‹é—´çš„è¡¨è¾¾å¼ä½œä¸ºå‚æ•°ã€‚</p>
<p>æ³¨æ„, æ ‡è¯†ç¬¦åé¢ç›´æ¥è·Ÿç€ä¸€å¯¹å„¿åœ†æ‹¬å·æ€»æ˜¯è¢«è§£æä¸ºå­ä¾‹ç¨‹è°ƒç”¨ã€‚</p>
<p>å¦‚æœä½ æƒ³è¦ä½ çš„å¯¹è±¡å“åº”è¯¥è°ƒç”¨æ“ä½œç¬¦, ä½ éœ€è¦å®ç° <code>CALL-ME</code> æ–¹æ³•ã€‚</p>
<h3 id="postfix-">postfix .</h3>
<p>è¯¥æ“ä½œç¬¦ç”¨äºè°ƒç”¨ä¸€ä¸ªæ–¹æ³•, <code>$invocant.method</code>ã€‚</p>
<p>æŠ€æœ¯ä¸Šè®², è¿™ä¸æ˜¯ä¸€ä¸ªæ“ä½œç¬¦, è€Œæ˜¯ç¼–è¯‘å™¨ä¸­ç‰¹æ®Šæƒ…å†µä¸‹çš„è¯­æ³•ã€‚</p>
<h3 id="postfix--1">postfix .=</h3>
<p>å¯å˜çš„æ–¹æ³•è°ƒç”¨ã€‚<code>$invocant.=method</code>, è„±å»è¯­æ³•ç³–åå°±æ˜¯ <code>$invocant = $invocant.method</code>, è¿™ä¸ <a href="http://doc.raku.org/routine/op%3D">op=.</a> ç±»ä¼¼ã€‚</p>
<p>æŠ€æœ¯ä¸Šè®², è¿™ä¸æ˜¯ä¸€ä¸ªæ“ä½œç¬¦, è€Œæ˜¯ç¼–è¯‘å™¨ä¸­ç‰¹æ®Šæƒ…å†µä¸‹çš„è¯­æ³•ã€‚</p>
<h3 id="postfix--2">postfix .^</h3>
<p>å…ƒæ–¹æ³•è°ƒç”¨ã€‚<code> $invocant.^method</code> åœ¨ <code>$invocant</code> çš„å…ƒç±»èº«ä¸Šè°ƒç”¨æ–¹æ³•ã€‚è„±å»è¯­æ³•ç³–å, å®ƒå°±æ˜¯ <code>$invocant.HOW.method($invocant, ...)</code>ã€‚æŸ¥çœ‹ <a href="http://doc.raku.org/type/HOW">HOW</a> è·å–æ›´å¤šä¿¡æ¯ã€‚</p>
<p>æŠ€æœ¯ä¸Šè®², è¿™ä¸æ˜¯ä¸€ä¸ªæ“ä½œç¬¦, è€Œæ˜¯ç¼–è¯‘å™¨ä¸­ç‰¹æ®Šæƒ…å†µä¸‹çš„è¯­æ³•ã€‚</p>
<h3 id="postfix--3">postfix .?</h3>
<p>æœ‰å¯èƒ½è¢«è°ƒç”¨çš„æ–¹æ³•è°ƒç”¨ã€‚å¦‚æœæœ‰åä¸º <code>method</code> çš„æ–¹æ³•, <code>$invocant.?method</code> å°±åœ¨ <code>$invocant</code> ä¸Šè°ƒç”¨ <code>method</code> æ–¹æ³•ã€‚å¦åˆ™å®ƒå°±è¿”å› <code>Nil</code>ã€‚</p>
<p>æŠ€æœ¯ä¸Šè®², è¿™ä¸æ˜¯ä¸€ä¸ªæ“ä½œç¬¦, è€Œæ˜¯ç¼–è¯‘å™¨ä¸­ç‰¹æ®Šæƒ…å†µä¸‹çš„è¯­æ³•ã€‚</p>
<h3 id="postfix--4">postfix .+</h3>
<p><code>$invocant.+method </code> ä» <code>$invocant</code> èº«ä¸Šè°ƒç”¨æ‰€æœ‰å«åš <code>method</code> çš„æ–¹æ³•ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªåå­—çš„æ–¹æ³•, å°±ä¼šæ­»æ‰ã€‚</p>
<p>æŠ€æœ¯ä¸Šè®², è¿™ä¸æ˜¯ä¸€ä¸ªæ“ä½œç¬¦, è€Œæ˜¯ç¼–è¯‘å™¨ä¸­ç‰¹æ®Šæƒ…å†µä¸‹çš„è¯­æ³•ã€‚</p>
<h3 id="postfix--5">postfix .*</h3>
<p><code>$invocant.*method</code> ä» <code>$invocant</code> èº«ä¸Šè°ƒç”¨æ‰€æœ‰å«åš <code>method</code> çš„æ–¹æ³•ã€‚</p>
<p>æŠ€æœ¯ä¸Šè®², è¿™ä¸æ˜¯ä¸€ä¸ªæ“ä½œç¬¦, è€Œæ˜¯ç¼–è¯‘å™¨ä¸­ç‰¹æ®Šæƒ…å†µä¸‹çš„è¯­æ³•ã€‚</p>
<h3 id="postfix-postfix">postfix .postfix</h3>
<p>å¤§å¤šæ•°æƒ…å†µä¸‹, å¯ä»¥åœ¨åç¼€æˆ–åç¯ç¼€å‰é¢æ”¾ä¸Šä¸€ä¸ªç‚¹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@a</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">]</span><span class="p">;</span>
<span class="nv">@a</span><span class="o">.[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">]</span><span class="p">;</span> <span class="c1"># Same</span>
</code></pre></div><p>è¿™å¯¹äºè§†è§‰æ¸…æ™°æˆ–ç®€æ´å¾ˆæœ‰å¸®åŠ©ã€‚ä¾‹å¦‚, å¦‚æœå¯¹è±¡çš„å±æ€§æ˜¯ä¸€ä¸ªå‡½æ•°, åœ¨å±æ€§ååé¢æ”¾ç½®ä¸€å¯¹å„¿åœ†æ‹¬å·ä¼šå˜æˆæ–¹æ³•è°ƒç”¨çš„ä¸€éƒ¨åˆ†ã€‚æ‰€ä»¥è¦ä¹ˆä½¿ç”¨ä¸¤å¯¹å„¿åœ†æ‹¬å·, è¦ä¹ˆåœ¨åœ†æ‹¬å·å‰é¢æ”¾ä¸Šä¸€ä¸ªç‚¹æ¥é˜»æ­¢æ–¹æ³•è°ƒç”¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Operation</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.symbol</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">&amp;.function</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$addition</span> <span class="o">=</span> <span class="n">Operation</span><span class="o">.</span><span class="nb">new</span><span class="p">(:</span><span class="s">symbol</span><span class="p">&lt;</span><span class="s">+</span><span class="p">&gt;</span><span class="o">,</span> 
                             <span class="p">:</span><span class="s">function</span><span class="p">{</span> <span class="nv">$^a</span> <span class="o">+</span> <span class="nv">$^b</span> <span class="p">});</span>
<span class="nb">say</span> <span class="nv">$addition</span><span class="o">.</span><span class="nf">function</span><span class="p">()(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="p">);</span> <span class="c1"># 3</span>
</code></pre></div><p>æˆ–è€…:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nv">$addition</span><span class="o">.</span><span class="nf">function</span><span class="o">.</span><span class="p">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="p">);</span> <span class="c1"># 3</span>
</code></pre></div><p>ç„¶è€Œ, å¦‚æœåç¼€æ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦, é‚£ä¹ˆå®ƒä¼šè¢«è§£é‡Šä¸ºä¸€ä¸ªæ™®é€šçš„æ–¹æ³•è°ƒç”¨ã€‚</p>
<pre><code>1.i # No such method 'i' for invocant of type 'Int'
</code></pre><p>æŠ€æœ¯ä¸Šè®², è¿™ä¸æ˜¯ä¸€ä¸ªæ“ä½œç¬¦, è€Œæ˜¯ç¼–è¯‘å™¨ä¸­ç‰¹æ®Šæƒ…å†µä¸‹çš„è¯­æ³•ã€‚</p>
<h3 id="postfix-prefix">postfix .:<!-- raw HTML omitted --></h3>
<p>å‰ç¼€èƒ½å¤Ÿåƒæ–¹æ³•é‚£æ ·, ä½¿ç”¨å†’å·å¯¹å„¿æ ‡è®°æ³•æ¥è°ƒç”¨ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nb">say</span> <span class="o">++</span><span class="nv">$a</span><span class="p">;</span>     <span class="c1"># 2</span>
<span class="nb">say</span> <span class="nv">$a</span><span class="o">.:</span><span class="p">&lt;</span><span class="s">++</span><span class="p">&gt;;</span> <span class="c1"># 3</span>
</code></pre></div><p>æŠ€æœ¯ä¸Šè®², è¿™ä¸æ˜¯ä¸€ä¸ªæ“ä½œç¬¦, è€Œæ˜¯ç¼–è¯‘å™¨ä¸­ç‰¹æ®Šæƒ…å†µä¸‹çš„è¯­æ³•ã€‚</p>
<h3 id="postfix--6">postfix .::</h3>
<p>ä¸€ä¸ªç±»é™å®šçš„æ–¹æ³•è°ƒç”¨, ç”¨äºè°ƒç”¨ä¸€ä¸ªå®šä¹‰åœ¨çˆ¶ç±»æˆ– role ä¸­çš„æ–¹æ³•, ç”šè‡³åœ¨å­ç±»ä¸­é‡æ–°å®šä¹‰äº†ä¹‹åã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Bar</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">baz</span> <span class="p">{</span> <span class="mi">42</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">Foo</span> <span class="k">is</span> <span class="nc">Bar</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">baz</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">nope</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="n">Foo</span><span class="o">.</span><span class="nf">Bar::baz</span><span class="p">;</span> <span class="c1"># 42</span>
</code></pre></div><h2 id="è‡ªå¢ä¼˜å…ˆçº§">è‡ªå¢ä¼˜å…ˆçº§</h2>
<h3 id="prefix-">prefix ++</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">prefix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">++</span><span class="p">&gt;(</span><span class="nv">$x</span> <span class="k">is</span> <span class="k">rw</span><span class="p">)</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">none</span><span class="p">&gt;</span>
</code></pre></div><p>æŠŠå®ƒçš„å‚æ•°å¢åŠ  1, å¹¶è¿”å›å¢åŠ åçš„å€¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$x</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="nb">say</span> <span class="o">++</span><span class="nv">$x</span><span class="p">;</span>    <span class="c1"># 4</span>
<span class="nb">say</span> <span class="nv">$x</span><span class="p">;</span>      <span class="c1"># 4</span>
</code></pre></div><p>å®ƒçš„å·¥ä½œåŸç†æ˜¯åœ¨å®ƒçš„å‚æ•°èº«ä¸Šè°ƒç”¨ <code>succ</code> æ–¹æ³•, è¿™å¯ä»¥è®©è‡ªå®šä¹‰ç±»å‹è‡ªç”±åœ°å®ç°å®ƒä»¬è‡ªå·±çš„å¢é‡è¯­ä¹‰ã€‚</p>
<h3 id="prefix---">prefix &ndash;</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">prefix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">--</span><span class="p">&gt;(</span><span class="nv">$x</span> <span class="k">is</span> <span class="k">rw</span><span class="p">)</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">none</span><span class="p">&gt;</span>
</code></pre></div><p>æŠŠå®ƒçš„å‚æ•°å‡å°‘ 1, å¹¶è¿”å›å‡å°‘åçš„å€¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$x</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="nb">say</span> <span class="o">--</span><span class="nv">$x</span><span class="p">;</span>       <span class="c1"># 2</span>
<span class="nb">say</span> <span class="nv">$x</span><span class="p">;</span>         <span class="c1"># 2</span>
</code></pre></div><p>å®ƒçš„å·¥ä½œåŸç†æ˜¯åœ¨å®ƒçš„å‚æ•°èº«ä¸Šè°ƒç”¨ <code>pred</code> æ–¹æ³•, è¿™å¯ä»¥è®©è‡ªå®šä¹‰ç±»å‹è‡ªç”±åœ°å®ç°å®ƒä»¬è‡ªå·±çš„å‡é‡è¯­ä¹‰ã€‚</p>
<h3 id="postfix--7">postfix ++</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">postfix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">++</span><span class="p">&gt;(</span><span class="nv">$x</span> <span class="k">is</span> <span class="k">rw</span><span class="p">)</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">none</span><span class="p">&gt;</span>
</code></pre></div><p>æŠŠå®ƒçš„å‚æ•°å¢åŠ  1, å¹¶è¿”å› <code>unincremented</code> çš„é‚£ä¸ªå€¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$x</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$x</span><span class="o">++</span><span class="p">;</span>       <span class="c1"># 3</span>
<span class="nb">say</span> <span class="nv">$x</span><span class="p">;</span>         <span class="c1"># 4</span>
</code></pre></div><p>å®ƒçš„å·¥ä½œåŸç†æ˜¯åœ¨å®ƒçš„å‚æ•°èº«ä¸Šè°ƒç”¨ <code>succ</code> æ–¹æ³•, è¿™å¯ä»¥è®©è‡ªå®šä¹‰ç±»å‹è‡ªç”±åœ°å®ç°å®ƒä»¬è‡ªå·±çš„å¢é‡è¯­ä¹‰ã€‚</p>
<p>æ³¨æ„è¿™å¹¶ä¸ä¸€å®šè¿”å›å®ƒçš„å‚æ•°ã€‚ä¾‹å¦‚, å¯¹äºæœªå®šä¹‰çš„å€¼, å®ƒè¿”å› 0:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$x</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$x</span><span class="o">++</span><span class="p">;</span>       <span class="c1"># 0</span>
<span class="nb">say</span> <span class="nv">$x</span><span class="p">;</span>         <span class="c1"># 1</span>
</code></pre></div><h3 id="postfix---">postfix &ndash;</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">postfix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">--</span><span class="p">&gt;(</span><span class="nv">$x</span> <span class="k">is</span> <span class="k">rw</span><span class="p">)</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">none</span><span class="p">&gt;</span>
</code></pre></div><p>æŠŠå®ƒçš„å‚æ•°å‡å°‘ 1, å¹¶è¿”å› <code>undecremented</code> çš„é‚£ä¸ªå€¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$x</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$x--</span><span class="p">;</span>       <span class="c1"># 3</span>
<span class="nb">say</span> <span class="nv">$x</span><span class="p">;</span>         <span class="c1"># 2</span>
</code></pre></div><p>å®ƒçš„å·¥ä½œåŸç†æ˜¯åœ¨å®ƒçš„å‚æ•°èº«ä¸Šè°ƒç”¨ <code>pred</code> æ–¹æ³•, è¿™å¯ä»¥è®©è‡ªå®šä¹‰ç±»å‹è‡ªç”±åœ°å®ç°å®ƒä»¬è‡ªå·±çš„å‡é‡è¯­ä¹‰ã€‚</p>
<p>æ³¨æ„è¿™å¹¶ä¸ä¸€å®šè¿”å›å®ƒçš„å‚æ•°ã€‚ä¾‹å¦‚, å¯¹äºæœªå®šä¹‰çš„å€¼, å®ƒè¿”å› 0:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$x</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$x--</span><span class="p">;</span>       <span class="c1"># 0</span>
<span class="nb">say</span> <span class="nv">$x</span><span class="p">;</span>         <span class="c1"># -1</span>
</code></pre></div><h2 id="æ±‚å¹‚ä¼˜å…ˆçº§">æ±‚å¹‚ä¼˜å…ˆçº§</h2>
<h3 id="infix-">infix **</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">**</span><span class="p">&gt;(</span><span class="nb">Any</span><span class="o">,</span> <span class="nb">Any</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Numeric:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">right</span><span class="p">&gt;</span>
</code></pre></div><p>æ±‚å¹‚æ“ä½œç¬¦æŠŠå®ƒçš„ä¸¤ä¸ªå‚æ•°éƒ½å¼ºåˆ¶è½¬ä¸º <code>Numeric</code> , ç„¶åè®¡ç®—, å³ä¾§ä¸ºå¹‚ã€‚</p>
<p>å¦‚æœ <code>**</code> å³è¾¹æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°, å¹¶ä¸”å·¦ä¾§æ˜¯ä»»æ„ç²¾åº¦ç±»å‹(Int, FatRat), é‚£ä¹ˆè®¡ç®—ä¸ä¼šæŸå¤±ç²¾åº¦ã€‚</p>
<h2 id="è±¡å½¢ä¸€å…ƒæ“ä½œç¬¦çš„ä¼˜å…ˆçº§">è±¡å½¢ä¸€å…ƒæ“ä½œç¬¦çš„ä¼˜å…ˆçº§</h2>
<h3 id="prefix--1">prefix ?</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">prefix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">?</span><span class="p">&gt;(</span><span class="nb">Mu</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool:D</span>
</code></pre></div><p>å¸ƒå°”ä¸Šä¸‹æ–‡æ“ä½œç¬¦ã€‚</p>
<p>é€šè¿‡åœ¨å‚æ•°èº«ä¸Šè°ƒç”¨ <code>Bool</code> æ–¹æ³•å¼ºåˆ¶å®ƒçš„å‚æ•°ä¸º Boolã€‚æ³¨æ„, è¿™ä¼šä½¿ Junctions å¤±æ•ˆã€‚</p>
<h3 id="prefix--2">prefix !</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">prefix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">!</span><span class="p">&gt;(</span><span class="nb">Mu</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool:D</span>
</code></pre></div><p>å¦å®šçš„å¸ƒå°”ä¸Šä¸‹æ–‡æ“ä½œç¬¦ã€‚</p>
<p>é€šè¿‡åœ¨å‚æ•°èº«ä¸Šè°ƒç”¨ <code>Bool</code> æ–¹æ³•å¼ºåˆ¶å®ƒçš„å‚æ•°ä¸º Bool, å¹¶è¿”å›ç»“æœçš„å¦å®šå€¼ã€‚æ³¨æ„, è¿™ä¼šä½¿ Junctions å¤±æ•ˆã€‚</p>
<h3 id="prefix--3">prefix +</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">prefix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">+</span><span class="p">&gt;(</span><span class="nb">Any</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Numeric:D</span>
</code></pre></div><p>Numeric ä¸Šä¸‹æ–‡æ“ä½œç¬¦ã€‚</p>
<p>é€šè¿‡åœ¨å‚æ•°èº«ä¸Šè°ƒç”¨ Numeric æ–¹æ³•å¼ºåˆ¶å°†å‚æ•°è½¬ä¸º Numeric ç±»å‹ã€‚</p>
<h3 id="prefix--">prefix -</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">prefix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">-</span><span class="p">&gt;(</span><span class="nb">Any</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Numeric:D</span>
</code></pre></div><p>å¦å®šçš„ Numeric ä¸Šä¸‹æ–‡æ“ä½œç¬¦ã€‚</p>
<p>é€šè¿‡åœ¨å‚æ•°èº«ä¸Šè°ƒç”¨ Numeric æ–¹æ³•å¼ºåˆ¶å°†å‚æ•°è½¬ä¸º Numeric ç±»å‹, å¹¶è¿”å›ç»“æœçš„å¦å®šå€¼ã€‚</p>
<h3 id="prefix--4">prefix ~</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">prefix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">-</span><span class="p">&gt;(</span><span class="nb">Any</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Str:D</span>
</code></pre></div><p>å­—ç¬¦ä¸²ä¸Šä¸‹æ–‡æ“ä½œç¬¦ã€‚</p>
<p>é€šè¿‡åœ¨å‚æ•°èº«ä¸Šè°ƒç”¨ <code>Str</code> æ–¹æ³•å¼ºåˆ¶æŠŠå‚æ•°è½¬ä¸º <code>Str</code> ç±»å‹ã€‚</p>
<h3 id="prefix--5">prefix |</h3>
<p>å°† Capture, Enum, Pair, List, EnumMap å’Œ Hash å±•å¹³åˆ°å‚æ•°åˆ—è¡¨ä¸­ã€‚</p>
<p>ï¼ˆåœ¨ Rakudo ä¸­, è¿™ä¸æ˜¯ä½œä¸ºä¸€ä¸ªåˆé€‚çš„æ“ä½œç¬¦æ¥å®ç°çš„, è€Œæ˜¯ç¼–è¯‘å™¨ä¸­çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µ, è¿™æ„å‘³ç€å®ƒåªå¯¹å‚æ•°åˆ—è¡¨æœ‰æ•ˆ, è€Œéåœ¨ä»»æ„ä»£ç ä¸­éƒ½æœ‰æ•ˆã€‚ï¼‰</p>
<h3 id="prefix--6">prefix +^</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">prefix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">+^</span><span class="p">&gt;(</span><span class="nb">Any</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Int:D</span>
</code></pre></div><p>æ•´æ•°æŒ‰ä½å–åã€‚</p>
<p>å°†å‚æ•°å¼ºè½¬ä¸º Int ç±»å‹å¹¶å¯¹ç»“æœæŒ‰ä½å–å, å‡è®¾ä¸¤è€…äº’è¡¥ã€‚</p>
<h3 id="prefix--7">prefix ?^</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">prefix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">?^</span><span class="p">&gt;(</span><span class="nb">Mu</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool:D</span>
</code></pre></div><p>å¸ƒå°”æŒ‰ä½å–åã€‚</p>
<p>å°†å‚æ•°å¼ºè½¬ä¸º Bool, ç„¶åæŒ‰ä½åè½¬, è¿™ä½¿å®ƒå’Œ prefix:&lt;!&gt;  ä¸€æ ·ã€‚</p>
<h3 id="prefix--8">prefix ^</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">prefix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">^</span><span class="p">&gt;(</span><span class="nb">Any</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Range:D</span>
</code></pre></div><p>upto æ“ä½œç¬¦.</p>
<p>å¼ºåˆ¶æŠŠå®ƒçš„å‚æ•°è½¬ä¸º Numeric, ç”Ÿæˆä¸€ä¸ªä» 0 ç›´åˆ°ï¼ˆä½†æ˜¯æ’é™¤ï¼‰ å‚æ•°ä¸ºæ­¢çš„èŒƒå›´ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="o">^</span><span class="mi">5</span><span class="p">;</span>         <span class="c1"># 0..^5</span>
<span class="k">for</span> <span class="o">^</span><span class="mi">5</span> <span class="p">{</span> <span class="p">}</span>      <span class="c1"># 5 iterations</span>
</code></pre></div><h2 id="ä¹˜æ³•ä¼˜å…ˆçº§">ä¹˜æ³•ä¼˜å…ˆçº§</h2>
<h3 id="infix--1">infix *</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">*</span><span class="p">&gt;(</span><span class="nb">Any</span><span class="o">,</span> <span class="nb">Any</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Numeric:D</span>
</code></pre></div><p>æŠŠä¸¤è¾¹çš„å‚æ•°éƒ½å¼ºè½¬ä¸º Numeric å¹¶æŠŠå®ƒä»¬ç›¸ä¹˜ã€‚ç»“æœæ˜¯ä¸€ä¸ªæ›´å®½çš„ç±»å‹ã€‚æŸ¥çœ‹ Numeric è·å–æ›´è¯¦ç»†ä¿¡æ¯ã€‚</p>
<h3 id="infix--2">infix /</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">/</span><span class="p">&gt;(</span><span class="nb">Any</span><span class="o">,</span> <span class="nb">Any</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Numeric:D</span>
</code></pre></div><p>æŠŠä¸¤è¾¹çš„å‚æ•°éƒ½å¼ºåˆ¶ä¸º Numeric, å¹¶ç”¨å·¦è¾¹é™¤ä»¥å³è¾¹çš„æ•°ã€‚æ•´æ•°ç›¸é™¤è¿”å› Rat, å¦åˆ™è¿”å›&quot;æ›´å®½ç±»å‹&quot;çš„ç»“æœã€‚</p>
<h3 id="infix-div">infix div</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">div</span><span class="p">&gt;(</span><span class="nb">Int:D</span><span class="o">,</span> <span class="nb">Int:D</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Int:D</span>
</code></pre></div><p>æ•´é™¤ã€‚å‘ä¸‹å–æ•´ã€‚</p>
<h3 id="infix--3">infix %</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">%</span><span class="p">&gt;(</span><span class="nv">$x</span><span class="o">,</span> <span class="nv">$y</span><span class="p">)</span> <span class="k">return</span> <span class="nb">Numeric:D</span>
</code></pre></div><p>æ¨¡æ“ä½œç¬¦ã€‚é¦–å…ˆå¼ºåˆ¶ä¸º Numericã€‚</p>
<p>é€šå¸¸, ä¸‹é¢çš„ç­‰å¼æ˜¯æˆç«‹çš„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$x</span> <span class="nv">%</span> <span class="nv">$y</span> <span class="o">==</span> <span class="nv">$x</span> <span class="o">-</span> <span class="nb">floor</span><span class="p">(</span><span class="nv">$x</span> <span class="o">/</span> <span class="nv">$y</span><span class="p">)</span> <span class="o">*</span> <span class="nv">$y</span>
</code></pre></div><h3 id="infix--4">infix %%</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">%%</span><span class="p">&gt;(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool:D</span>
</code></pre></div><p>æ•´é™¤æ“ä½œç¬¦, å¦‚æœ <code>$a % $b == 0</code> åˆ™è¿”å› True.</p>
<h3 id="infix-mod">infix mod</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">mod</span><span class="p">&gt;(</span><span class="nb">Int:D</span> <span class="nv">$a</span><span class="o">,</span> <span class="nb">Int:D</span> <span class="nv">$b</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Int:D</span>
</code></pre></div><p>æ•´æ•°å–æ¨¡æ“ä½œç¬¦ã€‚è¿”å›æ•´æ•°å–æ¨¡æ“ä½œçš„å‰©ä½™éƒ¨åˆ†ã€‚</p>
<h3 id="infix--5">infix +&amp;</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">+&amp;</span><span class="p">&gt;(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Int:D</span>
</code></pre></div><p>Numeric æŒ‰ä½ <code>AND</code>ã€‚æŠŠä¸¤ä¸ªå‚æ•°éƒ½å¼ºè½¬ä¸º Int å¹¶æ‰§è¡ŒæŒ‰ä½ AND æ“ä½œ, å‡å®šä¸¤è€…æ˜¯äº’è¡¥çš„ã€‚</p>
<h3 id="infix--6">infix +&lt;</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;&lt;</span><span class="s2"> +&lt; </span><span class="p">&gt;&gt;(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Int:D</span>
</code></pre></div><p>å‘å·¦ç§»åŠ¨æ•´æ•°ä¸ªä½ã€‚</p>
<h3 id="infix--7">infix +&gt;</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;&lt;</span><span class="s2"> +&gt; </span><span class="p">&gt;&gt;(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Int:D</span>
</code></pre></div><p>å‘å³ç§»åŠ¨æ•´æ•°ä¸ªä½ã€‚</p>
<h3 id="infix-gcd">infix gcd</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">gcd</span><span class="p">&gt;(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Int:D</span>
</code></pre></div><p>å¼ºåˆ¶ä¸¤ä¸ªå‚æ•°éƒ½ä¸º Int å¹¶è¿”å›æœ€å¤§å…¬åˆ†æ¯ï¼ˆgreatest common denominatorï¼‰ã€‚</p>
<h3 id="infix-lcm">infix lcm</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">lcm</span><span class="p">&gt;(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Int:D</span>
</code></pre></div><p>å¼ºåˆ¶ä¸¤ä¸ªå‚æ•°ä¸º Int å¹¶è¿”å›æœ€å°å…¬å€æ•°(least common multiple)</p>
<h2 id="åŠ æ³•ä¼˜å…ˆçº§">åŠ æ³•ä¼˜å…ˆçº§</h2>
<h3 id="infix--8">infix +</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">+</span><span class="p">&gt;(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Numeric:D</span>
</code></pre></div><p>å¼ºåˆ¶ä¸¤ä¸ªå‚æ•°ä¸º Numeric å¹¶æŠŠå®ƒä»¬ç›¸åŠ ã€‚</p>
<h3 id="infix--">infix -</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">-</span><span class="p">&gt;(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Numeric:D</span>
</code></pre></div><p>å¼ºåˆ¶ä¸¤ä¸ªå‚æ•°ä¸º Numeric å¹¶ç”¨ç¬¬ä¸€ä¸ªå‚æ•°å‡å»ç¬¬äºŒä¸ªå‚æ•°ã€‚</p>
<h3 id="infix--9">infix +|</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">+|</span><span class="p">&gt;(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Int:D</span>
</code></pre></div><p>å¼ºåˆ¶ä¸¤ä¸ªå‚æ•°ä¸º Int å¹¶æ‰§è¡ŒæŒ‰ä½ ORï¼ˆåŒ…æ‹¬ ORï¼‰</p>
<h3 id="infix--10">infix +^</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">+^</span><span class="p">&gt;(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Int:D</span>
</code></pre></div><p>å¼ºåˆ¶ä¸¤ä¸ªå‚æ•°ä¸º Int å¹¶æ‰§è¡ŒæŒ‰ä½ XORï¼ˆä¸åŒ…æ‹¬ ORï¼‰</p>
<h3 id="infix--11">infix ?|</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">?|</span><span class="p">&gt;(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool:D</span>
</code></pre></div><p>å¼ºåˆ¶ä¸¤ä¸ªå‚æ•°ä¸º Bool å¹¶æ‰§è¡Œé€»è¾‘ ORï¼ˆä¸åŒ…æ‹¬ ORï¼‰</p>
<h2 id="é‡å¤æ“ä½œç¬¦ä¼˜å…ˆçº§">é‡å¤æ“ä½œç¬¦ä¼˜å…ˆçº§</h2>
<h3 id="infix-x">infix x</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">proto</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">x</span><span class="p">&gt;(</span><span class="nb">Any</span><span class="o">,</span> <span class="nb">Any</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Str:D</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">x</span><span class="p">&gt;(</span><span class="nb">Any</span><span class="o">,</span> <span class="nb">Any</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">x</span><span class="p">&gt;(</span><span class="nb">Str:D</span><span class="o">,</span> <span class="nb">Int:D</span><span class="p">)</span>
</code></pre></div><p>æŠŠ <code>$a</code> å¼ºè½¬ä¸º Str , æŠŠ <code>$b</code> å¼ºè½¬ä¸º Int, å¹¶é‡å¤å­—ç¬¦ä¸² <code>$b</code> æ¬¡ã€‚å¦‚æœ <code>$b &lt;= 0</code> åˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#39;</span><span class="s1">ab</span><span class="p">&#39;</span> <span class="nb">x</span> <span class="mi">3</span><span class="p">;</span>       <span class="c1"># ababab</span>
<span class="nb">say</span> <span class="mi">42</span> <span class="nb">x</span> <span class="mi">3</span><span class="p">;</span>         <span class="c1"># 424242</span>
</code></pre></div><h3 id="infix-xx">infix xx</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">xx</span><span class="p">&gt;(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span>
</code></pre></div><p>è¿”å›ä¸€ç»„é‡å¤çš„ <code>$a</code> å¹¶è®¡ç®— <code>$b</code> æ¬¡ï¼ˆ<code>$b</code> è¢«å¼ºè½¬ä¸º Intï¼‰ã€‚å¦‚æœ <code>$b &lt;= 0</code> ,åˆ™è¿”å›ä¸€ä¸ªç©ºåˆ—è¡¨ã€‚</p>
<p>æ¯æ¬¡é‡å¤éƒ½ä¼šè®¡ç®—å·¦ä¾§çš„å€¼, æ‰€ä»¥</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">]</span> <span class="ow">xx</span> <span class="mi">5</span>
</code></pre></div><p>è¿”å› 5 ä¸ªä¸åŒçš„æ•°ç»„ï¼ˆä½†æ˜¯æ¯æ¬¡éƒ½æ˜¯ç›¸åŒçš„å†…å®¹ï¼‰å¹¶ä¸”</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">rand</span> <span class="ow">xx</span> <span class="mi">3</span>
</code></pre></div><p>è¿”å› 3 ä¸ªç‹¬ç«‹çš„ä¼ªéšæœºæ•°ã€‚å³ä¾§å¯ä»¥æ˜¯ <code>*</code>, è¿™æ—¶ä¼šè¿”å›ä¸€ä¸ªæƒ°æ€§çš„, æ— é™çš„åˆ—è¡¨ã€‚</p>
<h2 id="è¿ç»“">è¿ç»“</h2>
<h3 id="infix--12">infix ~</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">proto</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">~</span><span class="p">&gt;(</span><span class="nb">Any</span><span class="o">,</span> <span class="nb">Any</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Str:D</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">~</span><span class="p">&gt;(</span><span class="nb">Any</span><span class="o">,</span>  <span class="nb">Any</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">~</span><span class="p">&gt;(</span><span class="nb">Str:D</span><span class="o">,</span> <span class="nb">Str:D</span><span class="p">)</span>
</code></pre></div><p>å¼ºåˆ¶ä¸¤ä¸ªå‚æ•°ä¸º Str å¹¶è¿ç»“å®ƒä»¬ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#39;</span><span class="s1">ab</span><span class="p">&#39;</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">c</span><span class="p">&#39;;</span>     <span class="c1"># abc</span>
</code></pre></div><h2 id="junctive-and-all-ä¼˜å…ˆçº§">Junctive AND (all) ä¼˜å…ˆçº§</h2>
<h3 id="infix--13">infix &amp;</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">&amp;</span><span class="p">&gt;(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Junction:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">list</span><span class="p">&gt;</span>
</code></pre></div><p>ç”¨å®ƒçš„å‚æ•°åˆ›å»ºä¸€ä¸ª <code>all</code> Junctionã€‚æŸ¥çœ‹ Junctions è·å–æ›´å¤šè¯¦æƒ…ã€‚</p>
<h2 id="junctive-or-any-precedence">Junctive OR (any) Precedence</h2>
<h3 id="infix--14">infix |</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">|</span><span class="p">&gt;(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Junction:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">list</span><span class="p">&gt;</span>
</code></pre></div><p>ç”¨å®ƒçš„å‚æ•°åˆ›å»ºä¸€ä¸ª <code>any</code> Junctionã€‚æŸ¥çœ‹ Junctions è·å–æ›´å¤šè¯¦æƒ…ã€‚</p>
<h3 id="infix--15">infix ^</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">^</span><span class="p">&gt;(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Junction:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">list</span><span class="p">&gt;</span>
</code></pre></div><p>ç”¨å®ƒçš„å‚æ•°åˆ›å»ºä¸€ä¸ª <code>one</code> Junctionã€‚æŸ¥çœ‹ Junctions è·å–æ›´å¤šè¯¦æƒ…ã€‚</p>
<h2 id="named-unary-precedence">Named Unary Precedence</h2>
<h3 id="prefix-temp">prefix temp</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">prefix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">temp</span><span class="p">&gt;(</span><span class="nb">Mu</span> <span class="nv">$a</span> <span class="k">is</span> <span class="k">rw</span><span class="p">)</span>
</code></pre></div><p>temporizes ä¼ å…¥çš„å˜é‡ä½œä¸ºå‚æ•°, è¿™æ„å‘³ç€é€€å‡ºä½œç”¨åŸŸåå®ƒè¢«é‡ç½®ä¸ºæ—§å€¼ã€‚ï¼ˆè¿™å’Œ Perl 5 ä¸­çš„ local æ“ä½œç¬¦ç±»ä¼¼, é™¤äº† temp ä¸é‡ç½®å€¼ä¹‹å¤–ã€‚ï¼‰</p>
<h3 id="prefix-let">prefix let</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">prefix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">let</span><span class="p">&gt;(</span><span class="nb">Mu</span> <span class="nv">$a</span> <span class="k">is</span> <span class="k">rw</span><span class="p">)</span>
</code></pre></div><p>å‡å®šé‡ç½®ï¼šå¦‚æœé€šè¿‡å¼‚å¸¸æˆ– fail() é€€å‡ºå½“å‰ä½œç”¨åŸŸ, æ—§å€¼å°±ä¼šè¢«æ¢å¤ã€‚</p>
<h2 id="nonchaining-binary-precedence">Nonchaining Binary Precedence</h2>
<h3 id="infix-does">infix does</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">does</span><span class="p">&gt;(</span><span class="nb">Mu</span> <span class="nv">$obj</span><span class="o">,</span> <span class="nb">Mu</span> <span class="nv">$role</span><span class="p">)</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">none</span><span class="p">&gt;</span>
</code></pre></div><p>åœ¨è¿è¡Œæ—¶æŠŠ <code>$role</code> æ··åˆè¿› <code>$obj</code> ä¸­ã€‚è¦æ±‚ <code>$obj</code> æ˜¯å¯å˜çš„ã€‚</p>
<p>å‚æ•° <code>$role</code> ä¸ä¸€å®šè¦æ±‚æ˜¯ä¸€ä¸ª role, å®ƒå¯ä»¥è¡¨ç°çš„åƒæ˜¯ä¸€ä¸ª role, ä¾‹å¦‚æšä¸¾å€¼ã€‚</p>
<h3 id="infix-but">infix but</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">but</span><span class="p">&gt;(</span><span class="nb">Mu</span> <span class="nv">$obj</span><span class="o">,</span> <span class="nb">Mu</span> <span class="nv">$role</span><span class="p">)</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">none</span><span class="p">&gt;</span>
</code></pre></div><p>æŠŠ <code>$role</code> æ··åˆè¿› <code>$obj</code> å¹¶åˆ›å»ºä¸€ä¸ª <code>$obj</code> çš„å‰¯æœ¬ã€‚å› ä¸º <code>$obj</code> æ˜¯ä¸èƒ½ä¿®æ”¹çš„, ä½†æ˜¯èƒ½ä½¿ç”¨ mixins ç”¨äºåˆ›å»ºä¸å¯å˜å€¼ã€‚</p>
<p>å‚æ•° <code>$role</code> ä¸ä¸€å®šè¦æ±‚æ˜¯ä¸€ä¸ª role, å®ƒå¯ä»¥è¡¨ç°çš„åƒæ˜¯ä¸€ä¸ª role, ä¾‹å¦‚æšä¸¾å€¼ã€‚</p>
<h3 id="infix-cmp">infix cmp</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">proto</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">cmp</span><span class="p">&gt;(</span><span class="nb">Any</span><span class="o">,</span> <span class="nb">Any</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Order:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">none</span><span class="p">&gt;</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">cmp</span><span class="p">&gt;(</span><span class="nb">Any</span><span class="o">,</span>      <span class="nb">Any</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">cmp</span><span class="p">&gt;(</span><span class="nb">Real:D</span><span class="o">,</span>   <span class="nb">Real:D</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">cmp</span><span class="p">&gt;(</span><span class="nb">Str:D</span><span class="o">,</span>    <span class="nb">Str:D</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">cmp</span><span class="p">&gt;(</span><span class="n">Enum:D</span><span class="o">,</span>   <span class="n">Enum:D</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">cmp</span><span class="p">&gt;(</span><span class="nb">Version:D</span><span class="o">,</span> <span class="nb">Version:D</span><span class="p">)</span>
</code></pre></div><p>ä¸€èˆ¬çš„, â€œæ™ºèƒ½çš„â€ ä¸‰è·¯æ¯”è¾ƒå™¨ã€‚</p>
<p>æ¯”è¾ƒå­—ç¬¦ä¸²æ—¶ä½¿ç”¨å­—ç¬¦ä¸²è¯­ä¹‰, æ¯”è¾ƒæ•°å­—æ—¶ä½¿ç”¨æ•°å­—è¯­ä¹‰, æ¯”è¾ƒ Pair å¯¹è±¡æ—¶, å…ˆæ¯”è¾ƒé”®, å†æ¯”è¾ƒå€¼, ç­‰ç­‰ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="nv">$a</span> <span class="ow">eqv</span> <span class="nv">$b</span><span class="o">,</span> <span class="nb">then</span> <span class="nv">$a</span> <span class="ow">cmp</span> <span class="nv">$b</span> <span class="n">always</span> <span class="k">returns</span> <span class="n">Order::Same</span><span class="o">.</span>
<span class="nb">say</span> <span class="p">(</span><span class="s">a</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">cmp</span> <span class="p">(</span><span class="s">a</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">);</span>      <span class="c1"># Less</span>
<span class="nb">say</span> <span class="mi">4</span>        <span class="ow">cmp</span> <span class="mf">4.0</span><span class="p">;</span>           <span class="c1"># Same</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">b</span><span class="p">&#39;</span>      <span class="ow">cmp</span> <span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;;</span>           <span class="c1"># More</span>
</code></pre></div><h3 id="infix-leg">infix leg</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">proto</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">leg</span><span class="p">&gt;(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Order:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">none</span><span class="p">&gt;</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">leg</span><span class="p">&gt;(</span><span class="nb">Any</span><span class="o">,</span>  <span class="nb">Any</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">leg</span><span class="p">&gt;(</span><span class="nb">Str:D</span><span class="o">,</span> <span class="nb">Str:D</span><span class="p">)</span>
</code></pre></div><p>å­—ç¬¦ä¸²ä¸‰è·¯æ¯”è¾ƒå™¨ã€‚leg æ˜¯  less, equal è¿˜æœ‰ greater çš„ç®€å†™å½¢å¼ï¼Ÿ</p>
<p>æŠŠä¸¤ä¸ªå‚æ•°éƒ½å¼ºè½¬ä¸º <code>Str</code>, ç„¶åæŒ‰ç…§å­—æ¯æ¬¡åºæ¯”è¾ƒã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;</span> <span class="ow">leg</span> <span class="p">&#39;</span><span class="s1">b</span><span class="p">&#39;;</span>        <span class="nb">Less</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;</span> <span class="ow">leg</span> <span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;;</span>        <span class="nb">Same</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">b</span><span class="p">&#39;</span> <span class="ow">leg</span> <span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;;</span>        <span class="nb">More</span>
</code></pre></div><h3 id="infix--16">infix &lt;=&gt;</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">Â«</span><span class="s2">&lt;=&gt;</span><span class="p">Â»(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Order:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">none</span><span class="p">&gt;</span>
</code></pre></div><p>Numeric ä¸‰è·¯æ¯”è¾ƒå™¨ã€‚</p>
<p>æŠŠä¸¤ä¸ªå‚æ•°å¼ºè½¬ä¸º Real, å¹¶æ‰§è¡Œæ•°å€¼æ¯”è¾ƒã€‚</p>
<h3 id="infix--17">infix ..</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">..</span><span class="p">&gt;(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Range:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">none</span><span class="p">&gt;</span>
</code></pre></div><p>ç”±å‚æ•°åˆ›å»ºä¸€ä¸ª Rangeã€‚</p>
<h3 id="infix--18">infix ..^</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">..^</span><span class="p">&gt;(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Range:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">none</span><span class="p">&gt;</span>
</code></pre></div><p>ç”±å‚æ•°åˆ›å»ºä¸€ä¸ª Range, ä¸åŒ…å«æœ«ç«¯ã€‚</p>
<h3 id="infix--19">infix ^..</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">^..</span><span class="p">&gt;(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Range:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">none</span><span class="p">&gt;</span>
</code></pre></div><p>ç”±å‚æ•°åˆ›å»ºä¸€ä¸ª Range, ä¸åŒ…å«å¼€å§‹ç«¯ç‚¹ã€‚</p>
<h3 id="infix--20">infix ^..^</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">^..^</span><span class="p">&gt;(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Range:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">none</span><span class="p">&gt;</span>
</code></pre></div><p>ç”±å‚æ•°åˆ›å»ºä¸€ä¸ª Range, ä¸åŒ…å«å¼€ç«¯å’Œæœ«ç«¯ã€‚</p>
<h2 id="chaining-binary-precedence">Chaining Binary Precedence</h2>
<h3 id="infix--21">infix ==</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">proto</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">==</span><span class="p">&gt;(</span><span class="nv">$</span><span class="o">,</span> <span class="nv">$</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool:D</span> <span class="k">is</span> <span class="nc">assoc:</span><span class="p">&lt;</span><span class="s">chain</span><span class="p">&gt;</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">==</span><span class="p">&gt;(</span><span class="nb">Any</span><span class="o">,</span> <span class="nb">Any</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">==</span><span class="p">&gt;(</span><span class="nb">Int:D</span><span class="o">,</span> <span class="nb">Int:D</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">==</span><span class="p">&gt;(</span><span class="nb">Num:D</span><span class="o">,</span> <span class="nb">Num:D</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">==</span><span class="p">&gt;(</span><span class="nb">Rational:D</span><span class="o">,</span> <span class="nb">Rational:D</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">==</span><span class="p">&gt;(</span><span class="nb">Real:D</span><span class="o">,</span> <span class="nb">Real:D</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">==</span><span class="p">&gt;(</span><span class="nb">Complex:D</span><span class="o">,</span> <span class="nb">Complex:D</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">==</span><span class="p">&gt;(</span><span class="nb">Numeric:D</span><span class="o">,</span> <span class="nb">Numeric:D</span><span class="p">)</span>
</code></pre></div><p>å¼ºè½¬ä¸¤ä¸ªå‚æ•°ä¸º Numericï¼ˆå¦‚æœå¿…è¦ï¼‰, å¹¶è¿”å› True å¦‚æœå®ƒä»¬ç›¸ç­‰ã€‚</p>
<h3 id="infix--22">infix !=</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">proto</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">!=</span><span class="p">&gt;(</span><span class="nb">Mu</span><span class="o">,</span> <span class="nb">Mu</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">chain</span><span class="p">&gt;</span>
</code></pre></div><p>å¼ºè½¬ä¸¤ä¸ªå‚æ•°ä¸º Numericï¼ˆå¦‚æœå¿…è¦ï¼‰, å¹¶è¿”å› True å¦‚æœå®ƒä»¬ä¸ç›¸ç­‰ã€‚</p>
<h3 id="infix--23">infix &lt;</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">proto</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">Â«</span><span class="s2">&lt;</span><span class="p">Â»(</span><span class="nb">Any</span><span class="o">,</span> <span class="nb">Any</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">chain</span><span class="p">&gt;</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">Â«</span><span class="s2">&lt;</span><span class="p">Â»(</span><span class="nb">Int:D</span><span class="o">,</span> <span class="nb">Int:D</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">Â«</span><span class="s2">&lt;</span><span class="p">Â»(</span><span class="nb">Num:D</span><span class="o">,</span> <span class="nb">Num:D</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">Â«</span><span class="s2">&lt;</span><span class="p">Â»(</span><span class="nb">Real:D</span><span class="o">,</span> <span class="nb">Real:D</span><span class="p">)</span>
</code></pre></div><p>å¼ºè½¬ä¸¤ä¸ªå‚æ•°ä¸º Real ï¼ˆå¦‚æœå¿…è¦ï¼‰, å¹¶è¿”å› True å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°å°äºç¬¬äºŒä¸ªå‚æ•°ã€‚</p>
<h3 id="infix--24">infix &lt;=</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">proto</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">Â«</span><span class="s2">&lt;=</span><span class="p">Â»(</span><span class="nb">Any</span><span class="o">,</span> <span class="nb">Any</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">chain</span><span class="p">&gt;</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">Â«</span><span class="s2">&lt;=</span><span class="p">Â»(</span><span class="nb">Int:D</span><span class="o">,</span> <span class="nb">Int:D</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">Â«</span><span class="s2">&lt;=</span><span class="p">Â»(</span><span class="nb">Num:D</span><span class="o">,</span> <span class="nb">Num:D</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">Â«</span><span class="s2">&lt;=</span><span class="p">Â»(</span><span class="nb">Real:D</span><span class="o">,</span> <span class="nb">Real:D</span><span class="p">)</span>
</code></pre></div><p>å¼ºè½¬ä¸¤ä¸ªå‚æ•°ä¸º Real ï¼ˆå¦‚æœå¿…è¦ï¼‰, å¹¶è¿”å› True å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°å°äºç¬¬äºŒä¸ªå‚æ•°ã€‚</p>
<h3 id="infix--25">infix &gt;</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">proto</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">Â«</span><span class="s2">&gt;</span><span class="p">Â»(</span><span class="nb">Any</span><span class="o">,</span> <span class="nb">Any</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">chain</span><span class="p">&gt;</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">Â«</span><span class="s2">&gt;</span><span class="p">Â»(</span><span class="nb">Int:D</span><span class="o">,</span> <span class="nb">Int:D</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">Â«</span><span class="s2">&gt;</span><span class="p">Â»(</span><span class="nb">Num:D</span><span class="o">,</span> <span class="nb">Num:D</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">Â«</span><span class="s2">&gt;</span><span class="p">Â»(</span><span class="nb">Real:D</span><span class="o">,</span> <span class="nb">Real:D</span><span class="p">)</span>
</code></pre></div><p>å¼ºè½¬ä¸¤ä¸ªå‚æ•°ä¸º Real ï¼ˆå¦‚æœå¿…è¦ï¼‰, å¹¶è¿”å› True å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°å¤§äºç¬¬äºŒä¸ªå‚æ•°ã€‚</p>
<h3 id="infix--26">infix &gt;=</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">proto</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">Â«</span><span class="s2">&gt;=</span><span class="p">Â»(</span><span class="nb">Any</span><span class="o">,</span> <span class="nb">Any</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">chain</span><span class="p">&gt;</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">Â«</span><span class="s2">&gt;=</span><span class="p">Â»(</span><span class="nb">Int:D</span><span class="o">,</span> <span class="nb">Int:D</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">Â«</span><span class="s2">&gt;=</span><span class="p">Â»(</span><span class="nb">Num:D</span><span class="o">,</span> <span class="nb">Num:D</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">Â«</span><span class="s2">&gt;=</span><span class="p">Â»(</span><span class="nb">Real:D</span><span class="o">,</span> <span class="nb">Real:D</span><span class="p">)</span>
</code></pre></div><p>å¼ºè½¬ä¸¤ä¸ªå‚æ•°ä¸º Real ï¼ˆå¦‚æœå¿…è¦ï¼‰, å¹¶è¿”å› True å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°å¤§äºæˆ–ç­‰äºç¬¬äºŒä¸ªå‚æ•°ã€‚</p>
<h3 id="infix-eq">infix eq</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">proto</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">eq</span><span class="p">&gt;(</span><span class="nb">Any</span><span class="o">,</span> <span class="nb">Any</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">chain</span><span class="p">&gt;</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">eq</span><span class="p">&gt;(</span><span class="nb">Any</span><span class="o">,</span>  <span class="nb">Any</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">eq</span><span class="p">&gt;(</span><span class="nb">Str:D</span><span class="o">,</span> <span class="nb">Str:D</span><span class="p">)</span>
</code></pre></div><p>å¼ºè½¬ä¸¤ä¸ªå‚æ•°ä¸º Strï¼ˆå¦‚æœå¿…è¦ï¼‰, å¹¶è¿”å› True å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ç­‰äºç¬¬äºŒä¸ªå‚æ•°ã€‚</p>
<p>åŠ©è®°æ³•: equal</p>
<h3 id="infix-ne">infix ne</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">proto</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">ne</span><span class="p">&gt;(</span><span class="nb">Mu</span><span class="o">,</span> <span class="nb">Mu</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">chain</span><span class="p">&gt;</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">ne</span><span class="p">&gt;(</span><span class="nb">Mu</span><span class="o">,</span>   <span class="nb">Mu</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">ne</span><span class="p">&gt;(</span><span class="nb">Str:D</span><span class="o">,</span> <span class="nb">Str:D</span><span class="p">)</span>
</code></pre></div><p>å¼ºè½¬ä¸¤ä¸ªå‚æ•°ä¸º Strï¼ˆå¦‚æœå¿…è¦ï¼‰, å¹¶è¿”å› False å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ç­‰äºç¬¬äºŒä¸ªå‚æ•°ã€‚</p>
<p>åŠ©è®°æ³•: not equal</p>
<h3 id="infix-gt">infix gt</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">proto</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">gt</span><span class="p">&gt;(</span><span class="nb">Mu</span><span class="o">,</span> <span class="nb">Mu</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">chain</span><span class="p">&gt;</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">gt</span><span class="p">&gt;(</span><span class="nb">Mu</span><span class="o">,</span>   <span class="nb">Mu</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">gt</span><span class="p">&gt;(</span><span class="nb">Str:D</span><span class="o">,</span> <span class="nb">Str:D</span><span class="p">)</span>
</code></pre></div><p>å¼ºè½¬ä¸¤ä¸ªå‚æ•°ä¸º Strï¼ˆå¦‚æœå¿…è¦ï¼‰, å¹¶è¿”å› True å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°å¤§äºç¬¬äºŒä¸ªå‚æ•°ã€‚</p>
<p>åŠ©è®°æ³•: greater than</p>
<h3 id="infix-ge">infix ge</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">proto</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">ge</span><span class="p">&gt;(</span><span class="nb">Mu</span><span class="o">,</span> <span class="nb">Mu</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">chain</span><span class="p">&gt;</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">ge</span><span class="p">&gt;(</span><span class="nb">Mu</span><span class="o">,</span>   <span class="nb">Mu</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">ge</span><span class="p">&gt;(</span><span class="nb">Str:D</span><span class="o">,</span> <span class="nb">Str:D</span><span class="p">)</span>
</code></pre></div><p>å¼ºè½¬ä¸¤ä¸ªå‚æ•°ä¸º Strï¼ˆå¦‚æœå¿…è¦ï¼‰, å¹¶è¿”å› True å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°å¤§äºç¬¬äºŒä¸ªå‚æ•°ã€‚</p>
<p>åŠ©è®°æ³•: greater or equal</p>
<h3 id="infix-lt">infix lt</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">proto</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">lt</span><span class="p">&gt;(</span><span class="nb">Mu</span><span class="o">,</span> <span class="nb">Mu</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">chain</span><span class="p">&gt;</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">lt</span><span class="p">&gt;(</span><span class="nb">Mu</span><span class="o">,</span>   <span class="nb">Mu</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">lt</span><span class="p">&gt;(</span><span class="nb">Str:D</span><span class="o">,</span> <span class="nb">Str:D</span><span class="p">)</span>
</code></pre></div><p>å¼ºè½¬ä¸¤ä¸ªå‚æ•°ä¸º Strï¼ˆå¦‚æœå¿…è¦ï¼‰, å¹¶è¿”å› True å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°å°äºç¬¬äºŒä¸ªå‚æ•°ã€‚</p>
<p>åŠ©è®°æ³•: less than</p>
<h3 id="infix-le">infix le</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">proto</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">le</span><span class="p">&gt;(</span><span class="nb">Mu</span><span class="o">,</span> <span class="nb">Mu</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">chain</span><span class="p">&gt;</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">le</span><span class="p">&gt;(</span><span class="nb">Mu</span><span class="o">,</span>   <span class="nb">Mu</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">le</span><span class="p">&gt;(</span><span class="nb">Str:D</span><span class="o">,</span> <span class="nb">Str:D</span><span class="p">)</span>
</code></pre></div><p>å¼ºè½¬ä¸¤ä¸ªå‚æ•°ä¸º Strï¼ˆå¦‚æœå¿…è¦ï¼‰, å¹¶è¿”å› True å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°å°äºæˆ–ç­‰äºç¬¬äºŒä¸ªå‚æ•°ã€‚</p>
<p>åŠ©è®°æ³•: less or equal</p>
<h3 id="infix-before">infix before</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">proto</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">before</span><span class="p">&gt;(</span><span class="nb">Any</span><span class="o">,</span> <span class="nb">Any</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">chain</span><span class="p">&gt;</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">before</span><span class="p">&gt;(</span><span class="nb">Any</span><span class="o">,</span>      <span class="nb">Any</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">before</span><span class="p">&gt;(</span><span class="nb">Real:D</span><span class="o">,</span>   <span class="nb">Real:D</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">before</span><span class="p">&gt;(</span><span class="nb">Str:D</span><span class="o">,</span>    <span class="nb">Str:D</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">before</span><span class="p">&gt;(</span><span class="n">Enum:D</span><span class="o">,</span>   <span class="n">Enum:D</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">before</span><span class="p">&gt;(</span><span class="nb">Version:D</span><span class="o">,</span> <span class="nb">Version:D</span><span class="p">)</span>
</code></pre></div><p>ä¸€èˆ¬çš„æ’åº, ä½¿ç”¨å’Œ cmp ç›¸åŒçš„è¯­ä¹‰ã€‚å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°å°äºç¬¬äºŒä¸ªå‚æ•°åˆ™è¿”å› Trueã€‚</p>
<h3 id="infix-after">infix after</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">proto</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">after</span><span class="p">&gt;(</span><span class="nb">Any</span><span class="o">,</span> <span class="nb">Any</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">chain</span><span class="p">&gt;</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">after</span><span class="p">&gt;(</span><span class="nb">Any</span><span class="o">,</span>      <span class="nb">Any</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">after</span><span class="p">&gt;(</span><span class="nb">Real:D</span><span class="o">,</span>   <span class="nb">Real:D</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">after</span><span class="p">&gt;(</span><span class="nb">Str:D</span><span class="o">,</span>    <span class="nb">Str:D</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">after</span><span class="p">&gt;(</span><span class="n">Enum:D</span><span class="o">,</span>   <span class="n">Enum:D</span><span class="p">)</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">after</span><span class="p">&gt;(</span><span class="nb">Version:D</span><span class="o">,</span> <span class="nb">Version:D</span><span class="p">)</span>
</code></pre></div><p>ä¸€èˆ¬çš„æ’åº, ä½¿ç”¨å’Œ cmp ç›¸åŒçš„è¯­ä¹‰ã€‚å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°å¤§äºç¬¬äºŒä¸ªå‚æ•°åˆ™è¿”å› Trueã€‚</p>
<h3 id="infix-eqv">infix eqv</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">proto</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">eqv</span><span class="p">&gt;(</span><span class="nb">Any</span><span class="o">,</span> <span class="nb">Any</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">chain</span><span class="p">&gt;</span>
<span class="k">proto</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">eqv</span><span class="p">&gt;(</span><span class="nb">Any</span><span class="o">,</span> <span class="nb">Any</span><span class="p">)</span>
</code></pre></div><p>ç­‰å€¼æ“ä½œç¬¦ã€‚å¦‚æœä¸¤ä¸ªå‚æ•°åœ¨ç»“æ„ä¸Šç›¸åŒå°±è¿”å› Trueã€‚ä¾‹å¦‚, ç›¸åŒç±»å‹ï¼ˆå¹¶ä¸”é€’å½’ï¼‰åŒ…å«ç›¸åŒçš„å€¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">]</span> <span class="ow">eqv</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">]</span><span class="p">;</span>        <span class="c1"># True</span>
<span class="nb">say</span> <span class="nb">Any</span> <span class="ow">eqv</span> <span class="nb">Any</span><span class="p">;</span>                    <span class="c1"># True</span>
<span class="nb">say</span> <span class="mi">1</span> <span class="ow">eqv</span> <span class="mi">2</span><span class="p">;</span>                        <span class="c1"># False</span>
<span class="nb">say</span> <span class="mi">1</span> <span class="ow">eqv</span> <span class="mf">1.0</span><span class="p">;</span>                      <span class="c1"># False</span>
</code></pre></div><p>å¯¹äºä»»æ„å¯¹è±¡ä½¿ç”¨é»˜è®¤çš„ eqv æ“ä½œæ˜¯ä¸å¯èƒ½çš„ã€‚ä¾‹å¦‚, eqv ä¸è®¤ä¸ºåŒä¸€å¯¹è±¡çš„ä¸¤ä¸ªå®ä¾‹åœ¨ç»“æ„ä¸Šæ˜¯ç›¸ç­‰çš„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.a</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="n">A</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">a</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="ow">eqv</span> <span class="n">A</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">a</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">);</span>  <span class="k">#=</span><span class="p">&gt;</span><span class="sd"> False</span>
</code></pre></div><p>è¦å¾—åˆ°è¿™ä¸ªç±»çš„å¯¹è±¡ç›¸ç­‰ï¼ˆeqvï¼‰è¯­ä¹‰, éœ€è¦å®ç°ä¸€ä¸ªåˆé€‚çš„ä¸­ç¼€ eqv æ“ä½œç¬¦ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">A</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.a</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">multi</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">eqv</span><span class="p">&gt;(</span><span class="n">A</span> <span class="nv">$l</span><span class="o">,</span> <span class="n">A</span> <span class="nv">$r</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$l</span><span class="o">.</span><span class="nf">a</span> <span class="ow">eqv</span> <span class="nv">$r</span><span class="o">.</span><span class="nf">a</span> <span class="p">}</span>
<span class="nb">say</span> <span class="n">A</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">a</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="ow">eqv</span> <span class="n">A</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">a</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">);</span>  <span class="k">#=</span><span class="p">&gt;</span><span class="sd"> True</span>
</code></pre></div><h3 id="infix--27">infix ===</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">proto</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">===</span><span class="p">&gt;(</span><span class="nb">Any</span><span class="o">,</span> <span class="nb">Any</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">chain</span><span class="p">&gt;</span>
<span class="k">proto</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">===</span><span class="p">&gt;(</span><span class="nb">Any</span><span class="o">,</span> <span class="nb">Any</span><span class="p">)</span>
</code></pre></div><p>å€¼ç›¸ç­‰ã€‚å¦‚æœä¸¤ä¸ªå‚æ•°éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡åˆ™è¿”å› Trueã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">A</span> <span class="p">{</span> <span class="p">};</span>

<span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$a</span> <span class="o">===</span> <span class="nv">$a</span><span class="p">;</span>              <span class="c1"># True</span>
<span class="nb">say</span> <span class="n">A</span><span class="o">.</span><span class="nb">new</span> <span class="o">===</span> <span class="n">A</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>        <span class="c1"># False</span>
<span class="nb">say</span> <span class="n">A</span> <span class="o">===</span> <span class="n">A</span><span class="p">;</span>                <span class="c1"># True</span>
</code></pre></div><p>å¯¹äºå€¼çš„ç±»å‹,  <code>===</code> è¡¨ç°çš„å’Œ eqv ä¸€æ ·:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;</span> <span class="o">===</span> <span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;;</span>            <span class="c1"># True</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;</span> <span class="o">===</span> <span class="p">&#39;</span><span class="s1">b</span><span class="p">&#39;;</span>            <span class="c1"># False</span>

<span class="c1"># different types</span>
<span class="nb">say</span> <span class="mi">1</span> <span class="o">===</span> <span class="mf">1.0</span><span class="p">;</span>              <span class="c1"># False</span>
</code></pre></div><p><code>===</code> ä½¿ç”¨ <code>WHICH</code> æ–¹æ³•æ¥è·å–å¯¹è±¡ç›¸ç­‰, æ‰€ä»¥æ‰€æœ‰çš„å€¼ç±»å‹å¿…é¡»é‡å†™æ–¹æ³• <code>WHICH</code>ã€‚</p>
<h3 id="infix--28">infix =:=</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">proto</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">=:=</span><span class="p">&gt;(</span><span class="nb">Mu</span> \<span class="n">a</span><span class="o">,</span> <span class="nb">Mu</span> \<span class="n">b</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">chain</span><span class="p">&gt;</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">=:=</span><span class="p">&gt;(</span><span class="nb">Mu</span> \<span class="n">a</span><span class="o">,</span> <span class="nb">Mu</span> \<span class="n">b</span><span class="p">)</span>
</code></pre></div><p>å®¹å™¨ç›¸ç­‰ã€‚è¿”å› True å¦‚æœä¸¤ä¸ªå‚æ•°éƒ½ç»‘å®šåˆ°åŒä¸€ä¸ªå®¹å™¨ä¸Šã€‚å¦‚æœå®ƒè¿”å› True, é‚£é€šå¸¸æ„å‘³ç€ä¿®æ”¹ä¸€ä¸ªå‚æ•°ä¹Ÿä¼šåŒæ—¶ä¿®æ”¹å¦å¤–ä¸€ä¸ªã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="p">(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="nb">say</span> <span class="nv">$a</span> <span class="o">=:=</span> <span class="nv">$b</span><span class="p">;</span>      <span class="c1"># False</span>
<span class="nv">$b</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$a</span><span class="p">;</span>             <span class="c1"># 1</span>
<span class="nv">$b</span> <span class="o">:=</span> <span class="nv">$a</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$a</span> <span class="o">=:=</span> <span class="nv">$b</span><span class="p">;</span>      <span class="c1"># True</span>
<span class="nv">$a</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$b</span><span class="p">;</span>             <span class="c1"># 5</span>
</code></pre></div><h3 id="infix--29">infix ~~</h3>
<p>æ™ºèƒ½åŒ¹é…æ“ä½œç¬¦ã€‚æŠŠå·¦ä¾§å‚æ•°èµ·åˆ«åä¸º <code>$_</code> , ç„¶åè®¡ç®—å³ä¾§çš„å€¼, å¹¶åœ¨å®ƒèº«ä¸Šè°ƒç”¨ <code>.ACCEPTS($_)</code> ã€‚åŒ¹é…çš„è¯­ä¹‰ç”±å³ä¾§æ“ä½œæ•°çš„ç±»å‹å†³å®šã€‚</p>
<p>è¿™å„¿æœ‰ä¸€ä¸ªå†…å»ºæ™ºèƒ½åŒ¹é…å‡½æ•°çš„æ‘˜è¦ï¼š</p>
<pre><code>å³ä¾§      æ¯”è¾ƒè¯­ä¹‰
Mu:U	  ç±»å‹æ£€æŸ¥
Str	      å­—ç¬¦ä¸²ç›¸ç­‰
Numeric	  æ•°å€¼ç›¸ç­‰
Regex	  æ­£åˆ™åŒ¹é…
Callable  è°ƒç”¨çš„å¸ƒå°”ç»“æœ
Any:D	  å¯¹è±¡ç›¸ç­‰
</code></pre><h2 id="tight-and-precedence">Tight AND Precedence</h2>
<h3 id="infix--30">infix &amp;&amp;</h3>
<p>åœ¨å¸ƒå°”ä¸Šä¸‹æ–‡ä¸­è¿”å›ç¬¬ä¸€ä¸ªæ±‚å€¼ä¸º False çš„å‚æ•°, å¦åˆ™è¿”å›æœ€åä¸€ä¸ªå‚æ•°ã€‚</p>
<p>æ³¨æ„è¿™æ˜¯çŸ­è·¯æ“ä½œç¬¦, å¦‚æœå…¶ä¸­çš„ä¸€ä¸ªå‚æ•°è®¡ç®—ä¸º false å€¼, é‚£ä¹ˆè¯¥å‚æ•°å³ä¾§çš„å€¼ç»ä¸ä¼šè¢«è®¡ç®—ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">a</span> <span class="p">{</span> <span class="mi">1</span> <span class="p">}</span>
<span class="k">sub</span> <span class="nf">b</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">}</span>
<span class="k">sub</span> <span class="nf">c</span> <span class="p">{</span> <span class="nb">die</span> <span class="p">&#34;</span><span class="s2">never called</span><span class="p">&#34;</span> <span class="p">};</span>
<span class="nb">say</span> <span class="nf">a</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nf">b</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nf">c</span><span class="p">();</span>      <span class="c1"># 0</span>
</code></pre></div><h2 id="tight-or-precedence">Tight OR Precedence</h2>
<h3 id="infix--31">infix ||</h3>
<p>åœ¨å¸ƒå°”ä¸Šä¸‹æ–‡ä¸­è¿”å›ç¬¬ä¸€ä¸ªæ±‚å€¼ä¸º True çš„å‚æ•°, å¦åˆ™è¿”å›æœ€åä¸€ä¸ªå‚æ•°ã€‚</p>
<p>æ³¨æ„è¿™æ˜¯çŸ­è·¯æ“ä½œç¬¦, å¦‚æœå…¶ä¸­çš„ä¸€ä¸ªå‚æ•°è®¡ç®—ä¸º true å€¼, é‚£ä¹ˆè¯¥å‚æ•°å³ä¾§çš„å€¼ç»ä¸ä¼šè¢«è®¡ç®—ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">a</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">}</span>
<span class="k">sub</span> <span class="nf">b</span> <span class="p">{</span> <span class="mi">1</span> <span class="p">}</span>
<span class="k">sub</span> <span class="nf">c</span> <span class="p">{</span> <span class="nb">die</span> <span class="p">&#34;</span><span class="s2">never called</span><span class="p">&#34;</span> <span class="p">};</span>
<span class="nb">say</span> <span class="nf">a</span><span class="p">()</span> <span class="o">||</span> <span class="nf">b</span><span class="p">()</span> <span class="o">||</span> <span class="nf">c</span><span class="p">();</span>      <span class="c1"># 1</span>
</code></pre></div><h3 id="infix--32">infix ^^</h3>
<p>è¿”å›ç¬¬ä¸€ä¸ªå€¼ä¸º true çš„å‚æ•°å¦‚æœåªæœ‰ä¸€ä¸ªçš„è¯, å¦åˆ™è¿”å› Nilã€‚åªè¦æ‰¾åˆ°ä¸¤ä¸ªå€¼ä¸º true çš„å‚æ•°å°±å‘ç”ŸçŸ­è·¯ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="mi">0</span> <span class="o">^^</span> <span class="mi">42</span><span class="p">;</span>                <span class="c1"># 42</span>
<span class="nb">say</span> <span class="mi">0</span> <span class="o">^^</span> <span class="mi">42</span> <span class="o">^^</span> <span class="mi">1</span> <span class="o">^^</span> <span class="nb">die</span> <span class="mi">8</span><span class="p">;</span>  <span class="c1"># (empty line)</span>
</code></pre></div><p>æ³¨æ„, è¿™ä¸ªæ“ä½œç¬¦çš„è¯­ä¹‰å¯èƒ½ä¸æ˜¯ä½ å‡æƒ³çš„é‚£æ ·ï¼š infix <code>^^</code> ç¿»åˆ°å®ƒæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ª true å€¼, æ‰¾åˆ°ç¬¬äºŒä¸ª true å€¼åæ°¸è¿œåœ°åè½¬ä¸º Nil å€¼, ä¸ç®¡è¿˜æœ‰å¤šå°‘ true å€¼ã€‚ï¼ˆæ¢å¥è¯è¯´, å®ƒçš„è¯­ä¹‰æ˜¯&quot;æ‰¾åˆ°ä¸€ä¸ªçœŸå€¼&quot;, è€Œä¸æ˜¯å¸ƒå°”èµ·å¥‡å¶æ ¡éªŒè¯­ä¹‰ï¼‰</p>
<h3 id="infix--33">infix //</h3>
<p>Defined-or  æ“ä½œç¬¦ã€‚è¿”å›ç¬¬ä¸€ä¸ªå®šä¹‰äº†çš„æ“ä½œæ•°, å¦åˆ™è¿”å›æœ€åä¸€ä¸ªæ“ä½œæ•°ã€‚çŸ­è·¯æ“ä½œç¬¦ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nb">Any</span> <span class="o">//</span> <span class="mi">0</span> <span class="o">//</span> <span class="mi">42</span><span class="p">;</span>         <span class="c1"># 0</span>
</code></pre></div><h3 id="infix-min">infix min</h3>
<p>è¿”å›å‚æ•°çš„æœ€å°å€¼ã€‚è¯­ä¹‰ç”± cmp è¯­ä¹‰å†³å®šã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$foo</span> <span class="nb">min</span><span class="o">=</span> <span class="mi">0</span>  <span class="c1"># read as: $foo decreases to 0</span>
</code></pre></div><h3 id="infix-max">infix max</h3>
<p>è¿”å›å‚æ•°çš„æœ€å¤§å€¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$foo</span> <span class="nb">max</span><span class="o">=</span> <span class="mi">0</span>  <span class="c1"># read as: $foo increases to 0</span>
</code></pre></div><h2 id="conditional-operator-precedence">Conditional Operator Precedence</h2>
<h3 id="infix---1">infix ?? !!</h3>
<p>ä¸‰ç›®æ“ä½œç¬¦, æ¡ä»¶æ“ä½œç¬¦ã€‚</p>
<p><code>$condition ?? $true !! $false</code> è®¡ç®—å¹¶è¿”å› <code>$true</code> è¡¨è¾¾å¼, å¦‚æœ <code>$condition</code> ä¸ºçœŸçš„è¯ã€‚å¦åˆ™è®¡ç®—å¹¶è¿”å› <code>$false</code> åˆ†æ”¯ã€‚</p>
<h3 id="infix-ff">infix ff</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">ff</span><span class="p">&gt;(</span><span class="nb">Mu</span> <span class="nv">$a</span><span class="o">,</span> <span class="nb">Mu</span> <span class="nv">$b</span><span class="p">)</span>
</code></pre></div><p>è§¦å‘å™¨æ“ä½œç¬¦ã€‚</p>
<p>æŠŠä¸¤ä¸ªå‚æ•°éƒ½è·Ÿ <code>$_</code> è¿›è¡Œæ¯”è¾ƒï¼ˆå³, <code>$_ ~~ $a</code> å’Œ <code>$_ ~~ $b</code>ï¼‰ã€‚æ±‚å€¼ä¸º False ç›´åˆ°å·¦ä¾§çš„æ™ºèƒ½åŒ¹é…ä¸ºçœŸ, è¿™æ—¶, å®ƒæ±‚å€¼ä¸ºçœŸ, ç›´åˆ°å³ä¾§çš„æ™ºèƒ½åŒ¹é…ä¸ºçœŸã€‚</p>
<p>å®é™…ä¸Š, å·¦è¾¹çš„å‚æ•°æ˜¯&quot;å¼€å§‹â€æ¡ä»¶, å³ä¾§çš„å‚æ•°æ˜¯â€åœæ­¢â€ æ¡ä»¶ã€‚è¿™ç§ç»“æ„ä¸€èˆ¬ç”¨äºæ”¶é›†åªåœ¨ç‰¹å®šåŒºåŸŸçš„è¡Œã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$excerpt</span> <span class="o">=</span> <span class="k">q</span><span class="sa">:to</span><span class="p">/END/;</span><span class="s">
</span><span class="s">Here&#39;s some unimportant text.
</span><span class="s">=begin code
</span><span class="s">    This code block is what we&#39;re after.
</span><span class="s">    We&#39;ll use &#39;ff&#39; to get it.
</span><span class="s">=end code
</span><span class="s">More unimportant text.
</span><span class="s"></span><span class="p">END</span>

<span class="k">my</span> <span class="nv">@codelines</span> <span class="o">=</span> <span class="k">gather</span> <span class="k">for</span> <span class="nv">$excerpt</span><span class="o">.</span><span class="nb">lines</span> <span class="p">{</span>
    <span class="nb">take</span> <span class="nv">$_</span> <span class="k">if</span> <span class="p">&#34;</span><span class="s2">=begin code</span><span class="p">&#34;</span> <span class="ow">ff</span> <span class="p">&#34;</span><span class="s2">=end code</span><span class="p">&#34;</span>
<span class="p">}</span>

<span class="c1"># this will print four lines,</span>
<span class="c1"># starting with &#34;=begin code&#34; and ending with &#34;=end code&#34;</span>
<span class="nb">say</span> <span class="nv">@codelines</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#34;</span><span class="s2">\n</span><span class="p">&#34;);</span>
</code></pre></div><p>åŒ¹é…å¼€å§‹æ¡ä»¶ä¹‹å, æ“ä½œç¬¦ä¼šç»§ç»­å°†åœæ­¢æ¡ä»¶ä¸ <code>$_</code> è¿›è¡ŒåŒ¹é…, å¦‚æœæˆåŠŸå°±åšç›¸åº”åœ°è¡¨ç°ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­, åªæœ‰ç¬¬ä¸€ä¸ªå…ƒç´ è¢«æ‰“å°äº†ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="p">&lt;</span><span class="s">AB C D B E F</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$_</span> <span class="k">if</span> <span class="o">/</span><span class="n">A</span><span class="o">/</span> <span class="ow">ff</span> <span class="o">/</span><span class="n">B</span><span class="o">/</span><span class="p">;</span>  <span class="c1"># prints only &#34;AB&#34;</span>
<span class="p">}</span>
</code></pre></div><p>å¦‚æœä½ æƒ³æµ‹è¯•å¼€å§‹æ¡ä»¶, å¹¶ä¸”æ²¡æœ‰ç»“æŸæ¡ä»¶, <code>*</code> èƒ½ç”¨ä½œ â€œåœæ­¢â€ æ¡ä»¶ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="p">&lt;</span><span class="s">A B C D E</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$_</span> <span class="k">if</span> <span class="o">/</span><span class="n">C</span><span class="o">/</span> <span class="ow">ff</span> <span class="o">*</span><span class="p">;</span> <span class="c1"># prints C, D, and E</span>
<span class="p">}</span>
</code></pre></div><p>å¯¹äº sed-like ç‰ˆæœ¬, åœ¨å¼€å§‹æ¡ä»¶åŒ¹é…æˆåŠŸä¹‹å, å®ƒä¸ä¼šä½¿ç”¨åœæ­¢æ¡ä»¶ä¸ <code>$_</code> è¿›è¡ŒåŒ¹é…ã€‚</p>
<p>è¿™ä¸ªæ“ä½œç¬¦ä¸èƒ½è¢«é‡è½½, å› ä¸ºå®ƒè¢«ç¼–è¯‘å™¨ç‰¹æ®Šå¤„ç†è¿‡ã€‚</p>
<h3 id="infix-ff-1">infix ^ff</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">^ff</span><span class="p">&gt;(</span><span class="nb">Mu</span> <span class="nv">$a</span><span class="o">,</span> <span class="nb">Mu</span> <span class="nv">$b</span><span class="p">)</span>
</code></pre></div><p>åƒ <code>ff</code> é‚£æ ·å·¥ä½œ, é™¤äº†å®ƒä¸ä¼šåœ¨æ¡ç›®åŒ¹é…å¼€å§‹æ¡ä»¶æ—¶è¿”å›çœŸã€‚ï¼ˆåŒ…æ‹¬åŒ¹é…åœæ­¢æ¡ä»¶çš„æ¡ç›®ï¼‰</p>
<p>ä¸€ä¸ªæ¯”è¾ƒ:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@list</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">A B C</span><span class="p">&gt;;</span>
<span class="nb">say</span> <span class="nv">$_</span> <span class="k">if</span> <span class="o">/</span><span class="n">A</span><span class="o">/</span> <span class="ow">ff</span> <span class="o">/</span><span class="n">C</span><span class="o">/</span> <span class="k">for</span> <span class="nv">@list</span><span class="p">;</span>  <span class="c1"># prints A, B, and C</span>
<span class="nb">say</span> <span class="nv">$_</span> <span class="k">if</span> <span class="o">/</span><span class="n">A</span><span class="o">/</span> <span class="ow">^ff</span> <span class="o">/</span><span class="n">C</span><span class="o">/</span> <span class="k">for</span> <span class="nv">@list</span><span class="p">;</span> <span class="c1"># prints B and C</span>
</code></pre></div><p>è¿™ä¸ªæ“ä½œç¬¦ä¸èƒ½è¢«é‡è½½, å› ä¸ºå®ƒè¢«ç¼–è¯‘å™¨ç‰¹æ®Šå¤„ç†è¿‡ã€‚</p>
<h3 id="infix-ff-2">infix ff^</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">ff^</span><span class="p">&gt;(</span><span class="nb">Mu</span> <span class="nv">$a</span><span class="o">,</span> <span class="nb">Mu</span> <span class="nv">$b</span><span class="p">)</span>
</code></pre></div><p>åƒ ff é‚£æ ·å·¥ä½œ, é™¤äº†å®ƒä¸ä¼šåœ¨æ¡ç›®åŒ¹é…åœæ­¢æ¡ä»¶æ—¶è¿”å›çœŸã€‚ï¼ˆåŒ…æ‹¬ç¬¬ä¸€æ¬¡åŒ¹é…å¼€å§‹æ¡ä»¶çš„æ¡ç›®ï¼‰</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@list</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">A B C</span><span class="p">&gt;;</span>
<span class="nb">say</span> <span class="nv">$_</span> <span class="k">if</span> <span class="o">/</span><span class="n">A</span><span class="o">/</span> <span class="ow">ff</span> <span class="o">/</span><span class="n">C</span><span class="o">/</span> <span class="k">for</span> <span class="nv">@list</span><span class="p">;</span>  <span class="c1"># prints A, B, and C</span>
<span class="nb">say</span> <span class="nv">$_</span> <span class="k">if</span> <span class="o">/</span><span class="n">A</span><span class="o">/</span> <span class="ow">ff^</span> <span class="o">/</span><span class="n">C</span><span class="o">/</span> <span class="k">for</span> <span class="nv">@list</span><span class="p">;</span> <span class="c1"># prints A and B</span>
</code></pre></div><p>è¿™ä¸ªæ“ä½œç¬¦ä¸èƒ½è¢«é‡è½½, å› ä¸ºå®ƒè¢«ç¼–è¯‘å™¨ç‰¹æ®Šå¤„ç†è¿‡ã€‚</p>
<h3 id="infix-ff-3">infix ^ff^</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">^ff^</span><span class="p">&gt;(</span><span class="nb">Mu</span> <span class="nv">$a</span><span class="o">,</span> <span class="nb">Mu</span> <span class="nv">$b</span><span class="p">)</span>
</code></pre></div><p>åƒ ff é‚£æ ·å·¥ä½œ, é™¤äº†å®ƒä¸ä¼šåœ¨æ¡ç›®åŒ¹é…åœæ­¢æ¡ä»¶æ—¶è¿”å›çœŸ, ä¹Ÿä¸ä¼šåœ¨æ¡ç›®åŒ¹é…å¼€å§‹æ—¶è¿”å›çœŸã€‚ï¼ˆæˆ–è€…ä¸¤è€…ï¼‰</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@list</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">A B C</span><span class="p">&gt;;</span>
<span class="nb">say</span> <span class="nv">$_</span> <span class="k">if</span> <span class="o">/</span><span class="n">A</span><span class="o">/</span> <span class="ow">ff</span> <span class="o">/</span><span class="n">C</span><span class="o">/</span> <span class="k">for</span> <span class="nv">@list</span><span class="p">;</span>  <span class="c1"># prints A, B, and C</span>
<span class="nb">say</span> <span class="nv">$_</span> <span class="k">if</span> <span class="o">/</span><span class="n">A</span><span class="o">/</span> <span class="ow">^ff</span><span class="o">^</span> <span class="o">/</span><span class="n">C</span><span class="o">/</span> <span class="k">for</span> <span class="nv">@list</span><span class="p">;</span> <span class="c1"># prints B</span>
</code></pre></div><p>è¿™ä¸ªæ“ä½œç¬¦ä¸èƒ½è¢«é‡è½½, å› ä¸ºå®ƒè¢«ç¼–è¯‘å™¨ç‰¹æ®Šå¤„ç†è¿‡ã€‚</p>
<h3 id="infix-fff">infix fff</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">fff</span><span class="p">&gt;(</span><span class="nb">Mu</span> <span class="nv">$a</span><span class="o">,</span> <span class="nb">Mu</span> <span class="nv">$b</span><span class="p">)</span>
</code></pre></div><p>æ‰§è¡Œ sed-like é‚£æ ·çš„ flipflop æ“ä½œ, åœ¨å…¶ä¸­, å®ƒè¿”å› False ç›´åˆ°å·¦ä¾§çš„å‚æ•°ä¸ <code>$_</code> æ™ºèƒ½åŒ¹é…, å¹¶ä¸”åœ¨é‚£ä¹‹åè¿”å› True ç›´åˆ°å³ä¾§çš„å‚æ•°å’Œ <code>$_</code>  æ™ºèƒ½åŒ¹é…ã€‚</p>
<p>åƒ ff é‚£æ ·å·¥ä½œ, é™¤äº†å®ƒæ¯æ¬¡è°ƒç”¨åªå°è¯•ä¸€ä¸ªå‚æ•°ä¹‹å¤–ã€‚å³, å¦‚æœ <code>$_</code> å’Œå·¦ä¾§çš„å‚æ•°æ™ºèƒ½åŒ¹é…, fff éšåä¸ä¼šå°è¯•å°†åŒä¸€ä¸ª <code>$_</code> å’Œå³ä¾§çš„å‚æ•°è¿›è¡ŒåŒ¹é…ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="p">&lt;</span><span class="s">AB C D B E F</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$_</span> <span class="k">if</span> <span class="o">/</span><span class="n">A</span><span class="o">/</span> <span class="ow">fff</span> <span class="o">/</span><span class="n">B</span><span class="o">/</span><span class="p">;</span>  <span class="c1"># Prints &#34;AB&#34;, &#34;C&#34;, &#34;D&#34;, and &#34;B&#34;</span>
<span class="p">}</span>
</code></pre></div><p>å¯¹äº non-sed-like ç‰ˆæœ¬, æŸ¥çœ‹ <code>ff</code>.</p>
<p>è¿™ä¸ªæ“ä½œç¬¦ä¸èƒ½è¢«é‡è½½, å› ä¸ºå®ƒè¢«ç¼–è¯‘å™¨ç‰¹æ®Šå¤„ç†è¿‡ã€‚</p>
<h3 id="infix-fff-1">infix ^fff</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">^fff</span><span class="p">&gt;(</span><span class="nb">Mu</span> <span class="nv">$a</span><span class="o">,</span> <span class="nb">Mu</span> <span class="nv">$b</span><span class="p">)</span>
</code></pre></div><p>åƒ fff é‚£æ ·, é™¤äº†å®ƒå¯¹äºå·¦ä¾§çš„åŒ¹é…ä¸è¿”å›çœŸä¹‹å¤–ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@list</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">A B C</span><span class="p">&gt;;</span>
<span class="nb">say</span> <span class="nv">$_</span> <span class="k">if</span> <span class="o">/</span><span class="n">A</span><span class="o">/</span> <span class="ow">fff</span> <span class="o">/</span><span class="n">C</span><span class="o">/</span> <span class="k">for</span> <span class="nv">@list</span><span class="p">;</span>  <span class="c1"># prints A, B, and C</span>
<span class="nb">say</span> <span class="nv">$_</span> <span class="k">if</span> <span class="o">/</span><span class="n">A</span><span class="o">/</span> <span class="ow">^fff</span> <span class="o">/</span><span class="n">C</span><span class="o">/</span> <span class="k">for</span> <span class="nv">@list</span><span class="p">;</span> <span class="c1"># prints B and C</span>
</code></pre></div><p>å¯¹äº non-sed ç‰ˆæœ¬, æŸ¥çœ‹ <code>^ff</code>ã€‚</p>
<p>è¿™ä¸ªæ“ä½œç¬¦ä¸èƒ½è¢«é‡è½½, å› ä¸ºå®ƒè¢«ç¼–è¯‘å™¨ç‰¹æ®Šå¤„ç†è¿‡ã€‚</p>
<h3 id="infix-fff-2">infix fff^</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">fff^</span><span class="p">&gt;(</span><span class="nb">Mu</span> <span class="nv">$a</span><span class="o">,</span> <span class="nb">Mu</span> <span class="nv">$b</span><span class="p">)</span>
</code></pre></div><p>åƒ fff é‚£æ ·, é™¤äº†å®ƒå¯¹äºå³ä¾§çš„åŒ¹é…ä¸è¿”å›çœŸä¹‹å¤–ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@list</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">A B C</span><span class="p">&gt;;</span>
<span class="nb">say</span> <span class="nv">$_</span> <span class="k">if</span> <span class="o">/</span><span class="n">A</span><span class="o">/</span> <span class="ow">fff</span> <span class="o">/</span><span class="n">C</span><span class="o">/</span> <span class="k">for</span> <span class="nv">@list</span><span class="p">;</span>  <span class="c1"># prints A, B, and C</span>
<span class="nb">say</span> <span class="nv">$_</span> <span class="k">if</span> <span class="o">/</span><span class="n">A</span><span class="o">/</span> <span class="ow">fff^</span> <span class="o">/</span><span class="n">C</span><span class="o">/</span> <span class="k">for</span> <span class="nv">@list</span><span class="p">;</span> <span class="c1"># prints A and B</span>
</code></pre></div><p>å¯¹äº non-sed ç‰ˆæœ¬, æŸ¥çœ‹ <code>ff^</code>ã€‚</p>
<p>è¿™ä¸ªæ“ä½œç¬¦ä¸èƒ½è¢«é‡è½½, å› ä¸ºå®ƒè¢«ç¼–è¯‘å™¨ç‰¹æ®Šå¤„ç†è¿‡ã€‚</p>
<h3 id="infix-fff-3">infix ^fff^</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">^fff^</span><span class="p">&gt;(</span><span class="nb">Mu</span> <span class="nv">$a</span><span class="o">,</span> <span class="nb">Mu</span> <span class="nv">$b</span><span class="p">)</span>
</code></pre></div><p>åƒ fff é‚£æ ·, é™¤äº†å®ƒå¯¹äºå·¦ä¾§å’Œå³ä¾§çš„åŒ¹é…éƒ½ä¸è¿”å›çœŸä¹‹å¤–ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@list</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">A B C</span><span class="p">&gt;;</span>
<span class="nb">say</span> <span class="nv">$_</span> <span class="k">if</span> <span class="o">/</span><span class="n">A</span><span class="o">/</span> <span class="ow">fff</span> <span class="o">/</span><span class="n">C</span><span class="o">/</span> <span class="k">for</span> <span class="nv">@list</span><span class="p">;</span>   <span class="c1"># prints A, B, and C</span>
<span class="nb">say</span> <span class="nv">$_</span> <span class="k">if</span> <span class="o">/</span><span class="n">A</span><span class="o">/</span> <span class="ow">^fff</span><span class="o">^</span> <span class="o">/</span><span class="n">C</span><span class="o">/</span> <span class="k">for</span> <span class="nv">@list</span><span class="p">;</span> <span class="c1"># prints B</span>
</code></pre></div><p>å¯¹äº non-sed ç‰ˆæœ¬, æŸ¥çœ‹ <code>^ff^</code>.</p>
<p>è¿™ä¸ªæ“ä½œç¬¦ä¸èƒ½è¢«é‡è½½, å› ä¸ºå®ƒè¢«ç¼–è¯‘å™¨ç‰¹æ®Šå¤„ç†è¿‡ã€‚</p>
<h2 id="item-assignment-precedence">Item Assignment Precedence</h2>
<h3 id="infix--34">infix =</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">=</span><span class="p">&gt;(</span><span class="nb">Mu</span> <span class="nv">$a</span> <span class="k">is</span> <span class="k">rw</span><span class="o">,</span> <span class="nb">Mu</span> <span class="nv">$b</span><span class="p">)</span>
</code></pre></div><p>Item èµ‹å€¼ã€‚</p>
<p>æŠŠ = å·å³ä¾§çš„å€¼æ”¾å…¥å·¦ä¾§çš„å®¹å™¨ä¸­ã€‚å®ƒçœŸæ­£çš„è¯­ä¹‰æ˜¯ç”±å·¦ä¾§çš„å®¹å™¨ç±»å‹å†³å®šçš„ã€‚</p>
<p>ï¼ˆæ³¨æ„ item èµ‹å€¼å’Œåˆ—è¡¨èµ‹å€¼çš„ä¼˜å…ˆçº§çº§åˆ«ä¸åŒ, å¹¶ä¸”ç­‰å·å·¦ä¾§çš„è¯­æ³•å†³å®šäº†ç­‰å·æ˜¯è¢«è§£æä¸º item èµ‹å€¼è¿˜æ˜¯åˆ—è¡¨èµ‹å€¼æ“ä½œç¬¦ï¼‰ã€‚</p>
<h3 id="infix--35">infix =&gt;</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">Â«</span><span class="s2">=&gt;</span><span class="p">Â»(</span><span class="nv">$key</span><span class="o">,</span> <span class="nb">Mu</span> <span class="nv">$value</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Pair:D</span>
</code></pre></div><p>Pair æ„é€ å™¨ã€‚</p>
<p>ä½¿ç”¨å·¦ä¾§å€¼ä½œä¸ºé”®, å³ä¾§å€¼ä½œä¸ºå€¼, æ„é€ ä¸€ä¸ª Pair å¯¹è±¡ã€‚</p>
<p>æ³¨æ„ <code>=&gt;</code> æ“ä½œç¬¦æ˜¯è¯­æ³•ä¸Šçš„ç‰¹ä¾‹, åœ¨è¿™ä¸ªç»“æ„ä¸­, å®ƒå…è®¸å·¦ä¾§æ˜¯ä¸€ä¸ªæœªè¢«å¼•èµ·çš„æ ‡è¯†ç¬¦ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$p</span> <span class="o">=</span> <span class="s">a</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$p</span><span class="o">.</span><span class="nb">key</span><span class="p">;</span>         <span class="c1"># a</span>
<span class="nb">say</span> <span class="nv">$p</span><span class="o">.</span><span class="nb">value</span><span class="p">;</span>       <span class="c1"># 1</span>
</code></pre></div><p>åœ¨å‚æ•°åˆ—è¡¨ä¸­, åœ¨ <code>=&gt;</code> å·¦ä¾§ä½¿ç”¨æœªè¢«å¼•èµ·çš„æ ‡è¯†ç¬¦æ„å»ºçš„ Pair ä¼šè¢«è§£é‡Šä¸ºä¸€ä¸ªå…·åå‚æ•°ã€‚</p>
<p>æŸ¥çœ‹ Terms è¯­è¨€æ–‡æ¡£äº†è§£æ›´å¤šåˆ›å»º Pair å¯¹è±¡çš„æ–¹å¼ã€‚</p>
<h2 id="loose-unary-precedence">Loose Unary Precedence</h2>
<h3 id="prefix-not">prefix not</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">prefix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">not</span><span class="p">&gt;(</span><span class="nb">Mu</span> <span class="nv">$x</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool:D</span>
</code></pre></div><p>åœ¨å¸ƒå°”ä¸Šä¸‹æ–‡ä¸­è®¡ç®—å®ƒçš„å‚æ•°ï¼ˆå› æ­¤ä½¿ Junctions å¤±æ•ˆï¼‰, å¹¶è¿”å›å¦å®šçš„ç»“æœã€‚</p>
<h3 id="prefix-so">prefix so</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">prefix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">so</span><span class="p">&gt;(</span><span class="nb">Mu</span> <span class="nv">$x</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Bool:D</span>
</code></pre></div><p>åœ¨å¸ƒå°”ä¸Šä¸‹æ–‡ä¸­è®¡ç®—å®ƒçš„å‚æ•°ï¼ˆå› æ­¤ä½¿ Junctions å¤±æ•ˆï¼‰, å¹¶è¿”å›ç»“æœã€‚</p>
<h2 id="é€—å·æ“ä½œç¬¦ä¼˜å…ˆçº§">é€—å·æ“ä½œç¬¦ä¼˜å…ˆçº§</h2>
<h3 id="infix--36">infix :</h3>
<p>å°±åƒä¸­ç¼€æ“ä½œç¬¦ <code>,</code> é‚£æ ·, <code>:</code> ç”¨ä½œå‚æ•°åˆ†éš”ç¬¦, å¹¶æŠŠå®ƒå·¦ä¾§çš„å‚æ•°æ ‡è®°ä¸ºè°ƒç”¨è€…ã€‚</p>
<p>é‚£ä¼šæŠŠå‡½æ•°è°ƒç”¨è½¬ä¸ºæ–¹æ³•è°ƒç”¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">substr</span><span class="p">(&#39;</span><span class="s1">abc</span><span class="p">&#39;</span><span class="o">:</span> <span class="mi">1</span><span class="p">);</span> <span class="c1"># same as &#39;abc&#39;.substr(1)</span>
</code></pre></div><p>Infix <code>:</code> åªå…è®¸å‡ºç°åœ¨éæ–¹æ³•è°ƒç”¨çš„ç¬¬ä¸€ä¸ªå‚æ•°åé¢ã€‚åœ¨å…¶å®ƒä½ç½®å®ƒä¼šæ˜¯è¯­æ³•é”™è¯¯ã€‚</p>
<h2 id="list-infix-precedence">List Infix Precedence</h2>
<h3 id="infix-z">infix Z</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">Z</span><span class="p">&gt;(</span><span class="o">**</span><span class="nv">@lists</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">chain</span><span class="p">&gt;</span>
</code></pre></div><p>Zip operatorã€‚</p>
<p>Z åƒä¸€ä¸ªæ‹‰é“¾é‚£æ ·æŠŠåˆ—è¡¨æ’å…¥è¿›æ¥, åªè¦ç¬¬ä¸€ä¸ªè¾“å…¥åˆ—è¡¨è€—å°½å°±åœæ­¢ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span> <span class="ow">Z</span> <span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;</span> <span class="ow">Z</span> <span class="p">&lt;</span><span class="s">+ -</span><span class="p">&gt;)</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>  <span class="c1"># ((1, &#34;a&#34;, &#34;+&#34;), (2, &#34;b&#34;, &#34;-&#34;)).list</span>
</code></pre></div><p><code>Z</code> æ“ä½œç¬¦ä¹Ÿä½œä¸ºå…ƒæ“ä½œç¬¦å­˜åœ¨ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="mi">100</span><span class="o">,</span> <span class="mi">200</span> <span class="ow">Z</span><span class="o">+</span> <span class="mi">42</span><span class="o">,</span> <span class="mi">23</span><span class="p">;</span>             <span class="c1"># 142, 223</span>
<span class="nb">say</span> <span class="mi">1</span><span class="o">..</span><span class="mi">3</span> <span class="ow">Z</span><span class="o">~</span> <span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;</span> <span class="ow">Z</span><span class="o">~</span> <span class="p">&#39;</span><span class="s1">x</span><span class="p">&#39;</span> <span class="ow">xx</span> <span class="mi">3</span><span class="p">;</span>    <span class="c1"># 1ax 2bx 3cx</span>
</code></pre></div><h3 id="infix-x-1">infix X</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">X</span><span class="p">&gt;(</span><span class="o">**</span><span class="nv">@lists</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">List:D</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">chain</span><span class="p">&gt;</span>
</code></pre></div><p>ä»æ‰€æœ‰åˆ—è¡¨åˆ›å»ºä¸€ä¸ªå¤–ç§¯ã€‚æœ€å³è¾¹çš„å…ƒç´ å˜åŒ–å¾—æœ€è¿…é€Ÿã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="mi">1</span><span class="o">..</span><span class="mi">3</span> <span class="ow">X</span> <span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;</span> <span class="ow">X</span> <span class="mi">9</span>

<span class="c1"># produces   (1, &#39;a&#39;, 9), (1, &#39;b&#39;, 9), (1, &#39;c&#39;, 9),</span>
<span class="c1">#         (2, &#39;a&#39;, 9), (2, &#39;b&#39;, 9), (2, &#39;c&#39;, 9),</span>
<span class="c1">#         (3, &#39;a&#39;, 9), (3, &#39;b&#39;, 9), (3, &#39;c&#39;, 9)</span>

</code></pre></div><p>X æ“ä½œç¬¦ä¹Ÿå¯ä»¥ä½œä¸ºå…ƒæ“ä½œç¬¦ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="mi">1</span><span class="o">..</span><span class="mi">3</span> <span class="ow">X</span><span class="o">~</span> <span class="p">&lt;</span><span class="s">a b c</span><span class="p">&gt;</span> <span class="ow">X</span><span class="o">~</span> <span class="mi">9</span>

<span class="c1"># produces   &#39;1a9&#39;, &#39;1b9&#39;, &#39;1c9&#39;,</span>

         <span class="p">&#39;</span><span class="s1">2a9</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">2b9</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">2c9</span><span class="p">&#39;</span><span class="o">,</span>
         <span class="p">&#39;</span><span class="s1">3a9</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">3b9</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">3c9</span><span class="p">&#39;</span>
</code></pre></div><h3 id="infix--37">infix &hellip;</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">...</span><span class="p">&gt;(</span><span class="o">**</span><span class="nv">@</span><span class="p">)</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">list</span><span class="p">&gt;</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">...^</span><span class="p">&gt;(</span><span class="o">**</span><span class="nv">@</span><span class="p">)</span> <span class="k">is</span> <span class="nc">assoc</span><span class="p">&lt;</span><span class="s">list</span><span class="p">&gt;</span>
</code></pre></div><p>åºåˆ—æ“ä½œç¬¦æ˜¯ä¸€ä¸ªç”¨äºäº§ç”Ÿæƒ°æ€§åˆ—è¡¨çš„æ™®é€šæ“ä½œç¬¦ã€‚</p>
<p>å®ƒå¯ä»¥æœ‰ä¸€ä¸ªåˆå§‹å…ƒç´ å’Œä¸€ä¸ªç”Ÿæˆå™¨åœ¨ <code>â€¦</code> çš„å·¦ä¾§, åœ¨å³ä¾§æ˜¯ä¸€ä¸ªç«¯ç‚¹ã€‚</p>
<p>åºåˆ—æ“ä½œç¬¦ä¼šä½¿ç”¨å°½å¯èƒ½å¤šçš„å‚æ•°æ¥è°ƒç”¨ç”Ÿæˆå™¨ã€‚å‚æ•°ä¼šä»åˆå§‹å…ƒç´ å’Œå·²ç”Ÿæˆå…ƒç´ ä¸­è·å–ã€‚</p>
<p>é»˜è®¤çš„ç”Ÿæˆå™¨æ˜¯ <code>*.succ</code> æˆ– <code>*.pred</code>, å–å†³äºæœ«ç«¯æ€ä¹ˆæ¯”è¾ƒï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="mi">1</span> <span class="o">...</span> <span class="mi">4</span><span class="p">;</span>        <span class="c1"># 1 2 3 4</span>
<span class="nb">say</span> <span class="mi">4</span> <span class="o">...</span> <span class="mi">1</span><span class="p">;</span>        <span class="c1"># 4 3 2 1</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;</span> <span class="o">...</span> <span class="p">&#39;</span><span class="s1">e</span><span class="p">&#39;;</span>    <span class="c1"># a b c d e</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">e</span><span class="p">&#39;</span> <span class="o">...</span> <span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;;</span>    <span class="c1"># e d c b a</span>
</code></pre></div><p><code>*</code> (Whatever) æœ«ç«¯ç”Ÿæˆä¸€ä¸ªæ— é™åºåˆ—, ä½¿ç”¨çš„æ˜¯é»˜è®¤çš„ç”Ÿæˆå™¨ <code>*.succ</code>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">(</span><span class="mi">1</span> <span class="o">...</span> <span class="o">*</span><span class="p">)</span><span class="o">[^</span><span class="mi">5</span><span class="o">]</span><span class="p">;</span>  <span class="c1"># 1 2 3 4 5</span>
</code></pre></div><p>è‡ªå®šä¹‰ç”Ÿæˆå™¨æ˜¯åœ¨ <code>â€¦</code> æ“ä½œç¬¦ä¹‹å‰çš„æœ€åä¸€ä¸ªå‚æ•°ã€‚ä¸‹é¢è¿™ä¸ªè‡ªå®šä¹‰ç”Ÿæˆå™¨æ¥æ”¶ä¸¤ä¸ªå‚æ•°, ç”Ÿæˆäº†æ–æ³¢çº³å¥‘æ•°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="k">-&gt;</span> <span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span> <span class="p">{</span> <span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span> <span class="p">}</span> <span class="o">...</span> <span class="o">*</span><span class="p">)</span><span class="o">[^</span><span class="mi">8</span><span class="o">]</span><span class="p">;</span>    <span class="c1"># 1 1 2 3 5 8 13 21</span>
<span class="c1"># same but shorter</span>
<span class="nb">say</span> <span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="o">*+*</span> <span class="o">...</span> <span class="o">*</span><span class="p">)</span><span class="o">[^</span><span class="mi">8</span><span class="o">]</span><span class="p">;</span>                      <span class="c1"># 1 1 2 3 5 8 13 21</span>
</code></pre></div><p>å½“ç„¶è‡ªå®šä¹‰ç”Ÿæˆå™¨ä¹Ÿèƒ½åªæ¥æ”¶ä¸€ä¸ªå‚æ•°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="mi">5</span><span class="o">,</span> <span class="p">{</span> <span class="nv">$_</span> <span class="o">*</span> <span class="mi">2</span> <span class="p">}</span> <span class="o">...</span> <span class="mi">40</span><span class="p">;</span>                       <span class="c1"># 5 10 20 40</span>
</code></pre></div><p>ç”Ÿæˆå™¨çš„å‚æ•°ä¸ªæ•°è‡³å°‘è¦å’Œåˆå§‹å…ƒç´ çš„ä¸ªæ•°ä¸€æ ·å¤šã€‚</p>
<p>å¦‚æœæ²¡æœ‰ç”Ÿæˆå™¨, å¹¶ä¸”æœ‰ä¸æ­¢ä¸€ä¸ªåˆå§‹å…ƒç´ , æ‰€æœ‰çš„åˆå§‹å…ƒç´ éƒ½æ˜¯æ•°å€¼, é‚£ä¹ˆåºåˆ—æ“ä½œç¬¦ä¼šå°è¯•æ¨å¯¼å‡ºç”Ÿæˆå™¨ã€‚å®ƒçŸ¥é“æ•°å­¦å’Œå‡ ä½•åºåˆ—ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">6</span> <span class="o">...</span> <span class="mi">12</span><span class="p">;</span>     <span class="c1"># 2 4 6 8 10 12</span>
<span class="nb">say</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">4</span> <span class="o">...</span> <span class="mi">32</span><span class="p">;</span>     <span class="c1"># 1 2 4 8 16 32</span>
</code></pre></div><p>å¦‚æœæœ«ç«¯ä¸æ˜¯ <code>*</code>, å®ƒä¼šå’Œæ¯ä¸ªç”Ÿæˆçš„å…ƒç´ è¿›è¡Œæ™ºèƒ½åŒ¹é…, å½“æ™ºèƒ½åŒ¹é…æˆåŠŸçš„æ—¶å€™åºåˆ—å°±è¢«ç»ˆæ­¢ã€‚å¯¹äº <code>...</code>  æ“ä½œç¬¦, ä¼šåŒ…å«æœ€åä¸€ä¸ªå…ƒç´ , å¯¹äº <code>...^</code> æ“ä½œç¬¦, ä¼šæ’é™¤æœ€åçš„é‚£ä¸ªå…ƒç´ ã€‚</p>
<p>è¿™å…è®¸ä½ è¿™æ ·å†™ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="o">*+*</span> <span class="o">...^</span> <span class="o">*&gt;=</span> <span class="mi">100</span><span class="p">;</span>
</code></pre></div><p>æ¥ç”Ÿæˆæ‰€æœ‰ç›´åˆ° 100 ä½†ä¸åŒ…æ‹¬ 100 çš„æ–æ³¢çº³å¥‘æ•°ã€‚</p>
<p><code>...</code> æ“ä½œç¬¦è¿˜ä¼šæŠŠåˆå§‹å€¼çœ‹ä½œâ€å·²ç”Ÿæˆçš„å…ƒç´ â€, æ‰€ä»¥å®ƒä»¬ä¹Ÿä¼šå¯¹æœ«ç«¯è¿›è¡Œæ£€æŸ¥ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$end</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="nb">say</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">16</span> <span class="o">...</span> <span class="nv">$end</span><span class="p">;</span>
<span class="c1"># outputs 1 2 4</span>
</code></pre></div><h2 id="list-prefix-precedence">List Prefix Precedence</h2>
<h3 id="infix--38">infix =</h3>
<p>åˆ—è¡¨èµ‹å€¼ã€‚ å®ƒçœŸæ­£çš„è¯­ä¹‰æ˜¯ç”±å·¦ä¾§çš„å®¹å™¨ç±»å‹å†³å®šçš„ã€‚æŸ¥çœ‹ Array å’Œ Hash è·å–æ™®é€šæ¡ˆä¾‹ã€‚</p>
<p>item èµ‹å€¼å’Œåˆ—è¡¨èµ‹å€¼çš„ä¼˜å…ˆçº§çº§åˆ«ä¸åŒ, å¹¶ä¸”ç­‰å·å·¦ä¾§çš„è¯­æ³•å†³å®šäº†ç­‰å·æ˜¯è¢«è§£æä¸º item èµ‹å€¼è¿˜æ˜¯åˆ—è¡¨èµ‹å€¼æ“ä½œç¬¦ã€‚</p>
<h3 id="infix--39">infix :=</h3>
<p>ç»‘å®šã€‚è€Œ <code>$x = $y</code> æ˜¯æŠŠ <code>$y</code> ä¸­çš„å€¼æ”¾åˆ° <code>$x</code> é‡Œé¢, <code>$x := $y</code> ä¼šè®© <code>$x</code> å’Œ <code>$y</code> å¼•ç”¨åŒä¸€ä¸ªå€¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$b</span> <span class="o">=</span> <span class="nv">$a</span><span class="p">;</span>
<span class="nv">$b</span><span class="o">++</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$a</span><span class="p">;</span>
</code></pre></div><p>è¿™ä¼šè¾“å‡º 42, å› ä¸º <code>$a</code> å’Œ <code>$b</code> éƒ½åŒ…å«äº†æ•°å­— 42, ä½†æ˜¯å®¹å™¨æ˜¯ä¸åŒçš„ã€‚</p>
<pre><code>my $a = 42;
my $b := $a;
$b++;
say $a;
</code></pre><p>è¿™ä¼šæ‰“å° 43, å› ä¸º <code>$b</code> å’Œ <code>$a</code> éƒ½ä»£è¡¨ç€<code>åŒä¸€ä¸ªå¯¹è±¡</code>ã€‚</p>
<h3 id="infix--40">infix ::=</h3>
<p>åªè¯»ç»‘å®š. æŸ¥çœ‹ infix :=.</p>
<h3 id="listop-">listop &hellip;</h3>
<p>è¿™æ˜¯ yada, yada, yada æ“ä½œç¬¦ æˆ– stub æ“ä½œç¬¦ã€‚å¦‚æœå®ƒåœ¨å­ä¾‹ç¨‹æˆ–ç±»å‹ä¸­æ˜¯å”¯ä¸€çš„è¯­å¥, å®ƒä¼šæŠŠå­ä¾‹ç¨‹æˆ–ç±»å‹æ ‡è®°ä¸º stubï¼ˆè¿™åœ¨é¢„å£°æ˜ç±»å‹å’Œç»„æˆ roles ä¸Šä¸‹æ–‡ä¸­æ˜¯æœ‰æ„ä¹‰çš„ï¼‰</p>
<p>å¦‚æœ <code>...</code> è¯­å¥è¢«æ‰§è¡Œäº†, å®ƒä¼šè°ƒç”¨ <code>&amp;fail</code> , ä¼´éšç€é»˜è®¤çš„æ¶ˆæ¯ stub ä»£ç çš„æ‰§è¡Œã€‚</p>
<h3 id="listop--1">listop !!!</h3>
<p>å¦‚æœå®ƒåœ¨å­ä¾‹ç¨‹æˆ–ç±»å‹ä¸­æ˜¯å”¯ä¸€çš„è¯­å¥, å®ƒä¼šæŠŠå­ä¾‹ç¨‹æˆ–ç±»å‹æ ‡è®°ä¸º stubï¼ˆè¿™åœ¨é¢„å£°æ˜ç±»å‹å’Œç»„æˆ roles ä¸Šä¸‹æ–‡ä¸­æ˜¯æœ‰æ„ä¹‰çš„ï¼‰</p>
<p>å¦‚æœ <code>!!!</code> è¯­å¥è¢«æ‰§è¡Œäº†, å®ƒä¼šè°ƒç”¨ <code>&amp;die</code> , ä¼´éšç€é»˜è®¤çš„æ¶ˆæ¯ stub ä»£ç çš„æ‰§è¡Œã€‚</p>
<h3 id="listop--2">listop ???</h3>
<p>å¦‚æœå®ƒåœ¨å­ä¾‹ç¨‹æˆ–ç±»å‹ä¸­æ˜¯å”¯ä¸€çš„è¯­å¥, å®ƒä¼šæŠŠå­ä¾‹ç¨‹æˆ–ç±»å‹æ ‡è®°ä¸º stubï¼ˆè¿™åœ¨é¢„å£°æ˜ç±»å‹å’Œç»„æˆ roles ä¸Šä¸‹æ–‡ä¸­æ˜¯æœ‰æ„ä¹‰çš„ï¼‰</p>
<p>å¦‚æœ <code>???</code> è¯­å¥è¢«æ‰§è¡Œäº†, å®ƒä¼šè°ƒç”¨ <code>&amp;warn</code> , ä¼´éšç€é»˜è®¤çš„æ¶ˆæ¯ stub ä»£ç çš„æ‰§è¡Œã€‚</p>
<h2 id="loose-and-precedence">Loose AND precedence</h2>
<h3 id="infix-and">infix and</h3>
<p>å’Œä¸­ç¼€æ“ä½œç¬¦ <code>&amp;&amp;</code> ä¸€æ ·, é™¤äº†ä¼˜å…ˆçº§æ›´å®½æ¾ã€‚</p>
<p>åœ¨å¸ƒå°”ä¸Šä¸‹æ–‡ä¸­è¿”å›ç¬¬ä¸€ä¸ªæ±‚å€¼ä¸º False çš„æ“ä½œæ•°, å¦åˆ™è¿”å›æœ€åä¸€ä¸ªæ“ä½œæ•°ã€‚çŸ­è·¯æ“ä½œç¬¦ã€‚</p>
<h3 id="infix-andthen">infix andthen</h3>
<p>è¿”å›ç¬¬ä¸€ä¸ªæœªå®šä¹‰çš„å‚æ•°, å¦åˆ™è¿”å›æœ€åä¸€ä¸ªå‚æ•°ã€‚çŸ­è·¯æ“ä½œç¬¦ã€‚å·¦ä¾§çš„ç»“æœè¢«ç»‘å®šåˆ° <code>$_</code> èº«ä¸Š, åœ¨å³ä¾§ä¸­ä½¿ç”¨, æˆ–è€…ä½œä¸ºå‚æ•°è¢«ä¼ é€’, å¦‚æœå³ä¾§æ˜¯ä¸€ä¸ª block æˆ– pointy block.</p>
<h2 id="loose-or-precedence">Loose OR Precedence</h2>
<h3 id="infix-or">infix or</h3>
<p>å’Œä¸­ç¼€æ“ä½œç¬¦ <code>||</code> ä¸€æ ·, é™¤äº†ä¼˜å…ˆçº§æ›´å®½æ¾ã€‚</p>
<p>åœ¨å¸ƒå°”ä¸Šä¸‹æ–‡ä¸­è¿”å›ç¬¬ä¸€ä¸ªæ±‚å€¼ä¸º True çš„å‚æ•°, å¦åˆ™è¿”å›æœ€åä¸€ä¸ªå‚æ•°ã€‚çŸ­è·¯æ“ä½œç¬¦ã€‚</p>
<h3 id="infix-orelse">infix orelse</h3>
<p>å’Œä¸­ç¼€æ“ä½œç¬¦ <code>//</code> ä¸€æ ·, é™¤äº†ä¼˜å…ˆçº§æ›´å®½æ¾ä¹‹å¤–ã€‚</p>
<p>è¿”å›ç¬¬ä¸€ä¸ªå®šä¹‰è¿‡çš„å‚æ•°, å¦åˆ™è¿”å›æœ€åä¸€ä¸ªå‚æ•°ã€‚çŸ­è·¯æ“ä½œç¬¦ã€‚</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/operator" term="operator" label="operator" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä¸­çš„æ¨¡å—]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-03-23-modules-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2020-08-05-modules-in-julia/?utm_source=atom_feed" rel="related" type="text/html" title="Julia ä¸­çš„ æ¨¡å—" />
            
                <id>https://ohmyweekly.github.io/notes/2015-03-23-modules-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-10T00:00:00+08:00</published>
            <updated>2021-07-10T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Modules in Raku</blockquote><h1 id="modules">Modules</h1>
<h2 id="exporting-and-selective-importing">Exporting and Selective Importing</h2>
<h3 id="is-export">is export</h3>
<p>packages(åŒ…), subroutines(å­ä¾‹ç¨‹), variables(å˜é‡), constants(å¸¸é‡) å’Œ enums(æšä¸¾) , é€šè¿‡åœ¨å®ƒä»¬çš„åå­—åé¢æ·»åŠ  <code>is export</code> ç‰¹æ€§æ¥å¯¼å‡ºã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">unit</span> <span class="k">module</span> <span class="nn">MyModule</span><span class="p">;</span>
<span class="k">our</span> <span class="nv">$var</span> <span class="k">is</span> <span class="k">export</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="k">sub</span> <span class="nf">foo</span> <span class="k">is</span> <span class="k">export</span> <span class="p">{</span> <span class="o">...</span> <span class="p">};</span>
<span class="k">constant</span> <span class="nv">$FOO</span> <span class="k">is</span> <span class="k">export</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">foobar</span><span class="p">&#34;;</span>
<span class="k">enum</span> <span class="n">FooBar</span> <span class="k">is</span> <span class="k">export</span> <span class="p">&lt;</span><span class="s">one two three</span><span class="p">&gt;;</span>

<span class="c1"># Packages like classes can be exported too</span>
<span class="k">class</span> <span class="nc">MyClass</span> <span class="k">is</span> <span class="k">export</span> <span class="p">{};</span>

<span class="c1"># If a subpackage is in the namespace of the current package</span>
<span class="c1"># it doesn&#39;t need to be explicitly exported</span>
<span class="k">class</span> <span class="nc">MyModule::MyClass</span> <span class="p">{};</span>
</code></pre></div><p>å°±åƒæ‰€æœ‰çš„ traits ä¸€æ ·, å¦‚æœåº”ç”¨åˆ°å­ä¾‹ç¨‹(routine)ä¸Š, &ldquo;is export&rdquo; åº”è¯¥å‡ºç°åœ¨å‚æ•°åˆ—è¡¨çš„åé¢:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">foo</span> <span class="p">(</span><span class="nb">Str</span> <span class="nv">$string</span><span class="p">)</span> <span class="k">is</span> <span class="k">export</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
</code></pre></div><p>ä½ å¯ä»¥ç»™ <code>is export</code> ä¼ é€’å‘½åå‚æ•°ä»¥ç»„ç»‡è¦å¯¼å‡ºçš„ç¬¦å·, ç„¶åå¯¼å…¥ç¨‹åº (importer) å¯ä»¥å‰”é™¤å’Œé€‰æ‹©å¯¼å…¥å“ªä¸€ä¸ªã€‚æœ‰ 3 ä¸ªé¢„å…ˆå®šä¹‰å¥½çš„æ ‡ç­¾ï¼š<code>ALL</code>, <code>DEFAULT</code>, <code>MANDATORY</code>ï¼ˆå¼ºåˆ¶çš„ï¼‰ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># lib/MyModule.pm</span>
<span class="k">unit</span> <span class="k">module</span> <span class="nn">MyModule</span><span class="p">;</span>
<span class="k">sub</span> <span class="nb">bag</span>        <span class="k">is</span> <span class="k">export</span>              <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="k">sub</span> <span class="nf">pants</span>      <span class="k">is</span> <span class="k">export</span><span class="p">(:</span><span class="s">MANDATORY</span><span class="p">)</span>  <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="k">sub</span> <span class="nf">sunglasses</span> <span class="k">is</span> <span class="k">export</span><span class="p">(:</span><span class="s">day</span><span class="p">)</span>        <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="k">sub</span> <span class="nf">torch</span>      <span class="k">is</span> <span class="k">export</span><span class="p">(:</span><span class="s">night</span><span class="p">)</span>      <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="k">sub</span> <span class="nf">underpants</span> <span class="k">is</span> <span class="k">export</span><span class="p">(:</span><span class="s">ALL</span><span class="p">)</span>        <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># main.pl</span>
<span class="k">use</span> <span class="nb">lib</span> <span class="p">&#39;</span><span class="s1">lib</span><span class="p">&#39;;</span>
<span class="k">use</span> <span class="nn">MyModule</span><span class="p">;</span>           <span class="c1">#bag, pants</span>
<span class="k">use</span> <span class="nn">MyModule</span> <span class="p">:</span><span class="s">DEFAULT</span><span class="p">;</span>  <span class="c1">#the same</span>
<span class="k">use</span> <span class="nn">MyModule</span> <span class="p">:</span><span class="s">day</span><span class="p">;</span>      <span class="c1">#pants, sunglasses</span>
<span class="k">use</span> <span class="nn">MyModule</span> <span class="p">:</span><span class="s">night</span><span class="p">;</span>    <span class="c1">#pants, torch</span>
<span class="k">use</span> <span class="nn">MyModule</span> <span class="p">:</span><span class="s">ALL</span><span class="p">;</span>      <span class="c1">#bag, pants, sunglasses, torch, underpants</span>
</code></pre></div><h3 id="unitexport">UNIT::EXPORT::*</h3>
<p>è¡¨è±¡ä¹‹ä¸‹, å…¶å® <code>is export</code> æ˜¯æŠŠç¬¦å·æ·»åŠ åˆ° <code>EXPORT</code> å‘½åç©ºé—´ä¸­çš„ <code>UNIT</code> ä½œç”¨åŸŸåŒ…ä¸­ã€‚ä¾‹å¦‚, <code>is export(:FOO)</code> ä¼šæŠŠç›®æ ‡æ·»åŠ åˆ° <code>UNIT::EXPORT::FOO</code> åŒ…ä¸­ã€‚è¿™æ­£æ˜¯ Raku å†³å®šå¯¼å…¥ä»€ä¹ˆæ‰€åšçš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">unit</span> <span class="k">module</span> <span class="nn">MyModule</span><span class="p">;</span>

<span class="k">sub</span> <span class="nf">foo</span> <span class="k">is</span> <span class="k">export</span>         <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="k">sub</span> <span class="nf">bar</span> <span class="k">is</span> <span class="k">export</span><span class="p">(:</span><span class="s">other</span><span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div><p>ç­‰ä»·äº:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">unit</span> <span class="k">module</span> <span class="nn">MyModule</span><span class="p">;</span>

<span class="k">my</span> <span class="nb">package</span> <span class="nn">EXPORT::DEFAULT</span> <span class="p">{</span>
  <span class="k">our</span> <span class="k">sub</span> <span class="nf">foo</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nb">package</span> <span class="nn">EXPORT::other</span> <span class="p">{</span>
  <span class="k">our</span> <span class="k">sub</span> <span class="nf">bar</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>å¤šæ•°æ—¶å€™, <code>is export</code> è¶³å¤Ÿç”¨äº†, ä½†æ˜¯å½“ä½ æƒ³åŠ¨æ€ç”Ÿæˆè¦å¯¼å‡ºçš„ç¬¦å·æ—¶, <code>EXPORT</code> åŒ…å°±å¾ˆæœ‰ç”¨äº†ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># lib/MyModule.pm</span>
<span class="k">unit</span> <span class="k">module</span> <span class="nn">MuModule</span><span class="p">;</span>

<span class="k">my</span> <span class="nb">package</span> <span class="nn">EXPORT::DEFAULT</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">&lt;</span><span class="s">zero one two three four</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">kv</span> <span class="k">-&gt;</span> <span class="nv">$number</span><span class="o">,</span> <span class="nv">$name</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">&lt;</span><span class="s">sqrt log</span><span class="p">&gt;</span> <span class="k">-&gt;</span> <span class="nv">$func</span> <span class="p">{</span>
          <span class="n">OUR::</span><span class="p">{&#39;</span><span class="s1">&amp;</span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$func</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">-of-</span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$name</span> <span class="p">}</span> <span class="o">:=</span> <span class="k">sub</span> <span class="p">{</span> <span class="nv">$number</span><span class="o">.</span><span class="p">&#34;</span><span class="nv">$func</span><span class="s2">()</span><span class="p">&#34;</span> <span class="p">};</span>
      <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># main.pl</span>
<span class="k">use</span> <span class="nn">MyModule</span><span class="p">;</span>
<span class="nb">say</span> <span class="n">sqrt-of-four</span><span class="p">;</span> <span class="c1">#-&gt; 2</span>
<span class="nb">say</span> <span class="n">log-of-zero</span><span class="p">;</span>  <span class="c1">#-&gt; -Inf</span>
</code></pre></div><h3 id="export">EXPORT</h3>
<p>ä½ å¯ä»¥ç”¨ä¸€ä¸ª <code>EXPORT</code> å­ä¾‹ç¨‹å¯¼å‡ºä»»æ„ç¬¦å·ã€‚<code>EXPORT</code> å¿…é¡»è¿”å›ä¸€ä¸ª <code>Map</code>, åœ¨ map é‡Œé¢é”®æ˜¯ç¬¦å·å, é”®å€¼æ˜¯æƒ³è¦çš„å€¼ã€‚ç¬¦å·ååº”è¯¥åŒ…å«(å¦‚æœæœ‰çš„è¯)å…³è”ç±»å‹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">MyModule::Class</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>

<span class="k">sub</span> <span class="nf">EXPORT</span> <span class="p">{</span>
  <span class="p">{</span>
      <span class="p">&#39;</span><span class="s1">$var</span><span class="p">&#39;</span>      <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">one</span><span class="p">&#39;</span><span class="o">,</span>
      <span class="p">&#39;</span><span class="s1">@array</span><span class="p">&#39;</span>    <span class="o">=&gt;</span> <span class="p">&lt;</span><span class="s">one two three</span><span class="p">&gt;</span><span class="o">,</span>
      <span class="p">&#39;</span><span class="s1">%hash</span><span class="p">&#39;</span>     <span class="o">=&gt;</span> <span class="p">{</span> <span class="s">one</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">two</span><span class="p">&#39;</span>, <span class="s">three</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">four</span><span class="p">&#39;}</span>,
      <span class="p">&#39;</span><span class="s1">&amp;doit</span><span class="p">&#39;</span>     <span class="o">=&gt;</span> <span class="k">sub</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span><span class="o">,</span>
      <span class="p">&#39;</span><span class="s1">ShortName</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="n">MyModule::class</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># main.pl</span>
<span class="k">use</span> <span class="nb">lib</span> <span class="p">&#39;</span><span class="s1">lib</span><span class="p">&#39;;</span>
<span class="k">use</span> <span class="nn">MyModule</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$var</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">@array</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">%hash</span><span class="p">;</span>
<span class="nf">doit</span><span class="p">();</span>
<span class="nb">say</span> <span class="n">ShortName</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>  <span class="c1">#-&gt; MyModule::Class.new</span>
</code></pre></div><p>æ³¨æ„, <code>EXPORT</code> ä¸èƒ½å£°æ˜åœ¨åŒ…å†…, å› ä¸ºç›®å‰çš„ rakudo(2015.09) å¥½åƒæŠŠ EXPORT å½“ä½œ compunit çš„ä¸€éƒ¨åˆ†è€ŒéåŒ…çš„ä¸€éƒ¨åˆ†ã€‚</p>
<p>è™½ç„¶ <code>UNIT::EXPORT</code> åŒ…å¤„ç†ä¼ é€’ç»™ <code>use</code> çš„å‘½åå‚æ•°, è€Œ <code>EXPORT</code> sub å¤„ç†ä½ç½®å‚æ•°ã€‚å¦‚æœä½ æŠŠä½ç½®å‚æ•°ä¼ é€’ç»™ <code>use</code>, é‚£ä¹ˆè¿™äº›å‚æ•°ä¼šè¢«ä¼ é€’ç»™ <code>EXPORT</code>ã€‚å¦‚æœä¼ é€’äº†ä½ç½®å‚æ•°, é‚£ä¹ˆ module å°±ä¸å†éœ€è¦å¯¼å‡ºé»˜è®¤ç¬¦å·äº†ã€‚ä½ ä»ç„¶å¯ä»¥ä¼´éšç€ä½ çš„ä½ç½®å‚æ•°, é€šè¿‡æ˜¾å¼åœ°ç»™ use ä¼ é€’ <code>:DEFAULT</code> å‚æ•°æ¥å¯¼å…¥å®ƒä»¬ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># lib/MyModule</span>

<span class="k">class</span> <span class="nc">MyModule::Class</span> <span class="p">{}</span>

<span class="k">sub</span> <span class="nf">EXPORT</span><span class="p">(</span><span class="nv">$short_name</span><span class="o">?</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">{</span>
      <span class="nb">do</span> <span class="nv">$short_name</span> <span class="o">=&gt;</span> <span class="n">MyModule::Class</span> <span class="k">if</span> <span class="nv">$short_name</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">always</span> <span class="k">is</span> <span class="k">export</span><span class="p">(:</span><span class="s">MANDATORY</span><span class="p">)</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">works</span><span class="p">&#34;</span> <span class="p">}</span>

<span class="c1">#import with :ALL or :DEFAULT to get</span>
<span class="k">sub</span> <span class="nf">shy</span> <span class="k">is</span> <span class="k">export</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">you found me!</span><span class="p">&#34;</span> <span class="p">}</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># main.pl</span>
<span class="k">use</span> <span class="nb">lib</span> <span class="p">&#39;</span><span class="s1">lib</span><span class="p">&#39;;</span>
<span class="k">use</span> <span class="nn">MyModule</span> <span class="p">&#39;</span><span class="s1">foo</span><span class="p">&#39;;</span>
<span class="nb">say</span> <span class="n">foo</span><span class="o">.</span><span class="nb">new</span><span class="p">();</span> <span class="c1">#MyModule::Class.new</span>
<span class="nf">always</span><span class="p">();</span>      <span class="c1">#OK   - is imported</span>
<span class="nf">shy</span><span class="p">();</span>         <span class="c1">#FAIL - won&#39;t be imported</span>
</code></pre></div><h2 id="å‘å¸ƒæ¨¡å—">å‘å¸ƒæ¨¡å—</h2>
<p>å¦‚æœä½ å·²ç»å†™äº†ä¸€ä¸ª Raku æ¨¡å—, ä½ æƒ³æŠŠå®ƒåˆ†äº«åˆ°ç¤¾åŒº, æˆ‘ä»¬ä¼šå¾ˆé«˜å…´åœ°æŠŠå®ƒæ”¾åˆ° Raku æ¨¡å—æ–‡ä»¶å¤¹æ¸…å•ä¸­ã€‚<a href="http://modules.raku.org/">Raku modules directory</a></p>
<p>ç°åœ¨, ä½ éœ€è¦ä½¿ç”¨ git å¯¹ä½ çš„æ¨¡å—è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ã€‚</p>
<p>è¿™éœ€è¦ä½ æœ‰ä¸€ä¸ª Github å¸å·, ä»¥ä½¿ä½ çš„æ¨¡å—èƒ½è¢«ä»å®ƒçš„ Github ä»“åº“ä¸­åˆ†äº«å‡ºå»ã€‚</p>
<p>è¦åˆ†äº«ä½ çš„æ¨¡å—, æŒ‰ç…§ä¸‹é¢è¯´çš„åšï¼š</p>
<ul>
<li>
<p>åˆ›å»ºä¸€ä¸ªä»¥ä½ çš„æ¨¡å—å‘½åçš„å·¥ç¨‹æ–‡ä»¶å¤¹ã€‚ä¾‹å¦‚, å¦‚æœä½ çš„æ¨¡å—æ˜¯ <code>Vortex::TotalPerspective</code>, é‚£ä¹ˆå°±åˆ›å»ºä¸€ä¸ªå«åš <code>Vortex::TotalPerspective</code> çš„å·¥ç¨‹æ–‡ä»¶å¤¹ã€‚è¿™ä¸ªå·¥ç¨‹ç›®å½•çš„åå­—ä¹Ÿä¼šè¢«ç”¨ä½œ Github ä»“åº“çš„åå­—ã€‚</p>
</li>
<li>
<p>è®©ä½ çš„å·¥ç¨‹ç›®å½•çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="n">Vortex-TotalPerspective</span><span class="o">/</span>
<span class="o">|--</span> <span class="nb">lib</span>
<span class="o">|</span>   `<span class="o">--</span> <span class="n">Vortex</span>
<span class="o">|</span>       `<span class="o">--</span> <span class="n">TotalPerspective</span><span class="o">.</span><span class="nf">pm</span>
<span class="o">|--</span> <span class="n">LICENSE</span>
<span class="o">|--</span> <span class="n">META</span><span class="o">.</span><span class="nf">info</span>
<span class="o">|--</span> <span class="n">README</span><span class="o">.</span><span class="nf">md</span>
`<span class="o">--</span> <span class="nb">t</span>
    `<span class="o">--</span> <span class="n">basic</span><span class="o">.</span><span class="nb">t</span>
</code></pre></div><p>å¦‚æœä½ çš„å·¥ç¨‹åŒ…å«èƒ½å¸®åŠ©ä¸»æ¨¡å—å®Œæˆå·¥ä½œçš„å…¶å®ƒæ¨¡å—, å®ƒä»¬åº”è¯¥è¢«æ”¾åˆ°ä½ çš„ lib ç›®å½•ä¸­åƒè¿™æ ·ç»„ç»‡ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku">
<span class="nb">lib</span>
`<span class="o">--</span> <span class="n">Vortex</span>
    <span class="o">|--</span> <span class="n">TotalPerspective</span><span class="o">.</span><span class="nf">pm</span>
    `<span class="o">--</span> <span class="n">TotalPerspective</span>
        <span class="o">|--</span> <span class="n">FairyCake</span><span class="o">.</span><span class="nf">pm</span>
        `<span class="o">--</span> <span class="n">Gargravarr</span><span class="o">.</span><span class="nf">pm</span>
</code></pre></div><ul>
<li>
<p><code>README.md</code> æ–‡ä»¶æ˜¯ä¸€ä¸ª markdown æ ¼å¼çš„æ–‡ä»¶, å®ƒç¨åä¼šè¢« Github è‡ªåŠ¨æ¸²æŸ“æˆ HTML</p>
</li>
<li>
<p>å…³äº LICENSE æ–‡ä»¶, å¦‚æœä½ æ²¡æœ‰å…¶å®ƒé€‰æ‹©, å°±æ˜¯ç”¨å’Œ Rakudo Raku ä¸€æ ·çš„ LICENSE æŠŠã€‚ä»…ä»…æŠŠå®ƒçš„åŸå§‹ <a href="https://github.com/rakudo/rakudo/blob/nom/LICENSE">license</a> å¤åˆ¶/ç²˜è´´è¿›ä½ è‡ªå·±çš„ LICENSE æ–‡ä»¶ä¸­ã€‚</p>
</li>
<li>
<p>å¦‚æœä½ è¿˜æ²¡æœ‰ä»»ä½•æµ‹è¯•, ç°åœ¨ä½ å¯ä»¥å¿½ç•¥ <code>t</code> ç›®å½• å’Œ <code>basic.t</code> æ–‡ä»¶ã€‚å…³äºå¦‚ä½•å†™æµ‹è¯•, ä½ å¯ä»¥çœ‹çœ‹å…¶å®ƒæ¨¡å—æ˜¯æ€ä¹ˆä½¿ç”¨ <code>Test</code> çš„ã€‚å®ƒå’Œ Perl'5 çš„ <code>Test::More</code> å¾ˆç±»ä¼¼ã€‚</p>
</li>
<li>
<p>å¦‚æœè¦æ–‡æ¡£åŒ–ä½ çš„æ¨¡å—, åœ¨ä½ çš„æ¨¡å—ä¸­ä½¿ç”¨ <a href="http://design.raku.org/S26.html">Raku Pod</a> æ ‡è®°ã€‚æ¬¢è¿ç»™æ¨¡å—å†™æ–‡æ¡£, å¹¶ä¸”ä¸ºäº†æµè§ˆçš„æ–¹ä¾¿, ä¸€æ—¦ Raku module directory(æˆ–å…¶å®ƒç½‘ç«™) å¼€å§‹æŠŠ Pod æ–‡æ¡£æ¸²æŸ“æˆ HTML, å†™æ–‡æ¡£å°¤ä¸ºé‡è¦ã€‚</p>
</li>
<li>
<p>è®©ä½ çš„ <code>META.info</code> æ–‡ä»¶çœ‹èµ·æ¥åƒè¿™æ ·:</p>
</li>
</ul>
</li>
</ul>
<pre><code> {
        &quot;name&quot;        : &quot;Vortex::TotalPerspective&quot;,
        &quot;version&quot;     : &quot;0.1.0&quot;,
        &quot;description&quot; : &quot;Wonderful simulation to get some perspective.&quot;,
        &quot;author&quot;      : &quot;Your Name&quot;,
        &quot;provides&quot;    : {
            &quot;Vortex::TotalPerspective&quot; : &quot;lib/Vortex/TotalPerspective.pm&quot;
        },
        &quot;depends&quot;     : [ ],
        &quot;source-url&quot;  : &quot;git://github.com/you/Vortex-TotalPerspective.git&quot;
    }
</code></pre><p>å…³äºé€‰æ‹©ç‰ˆæœ¬å·çš„æ–¹æ¡ˆ, æˆ–è®¸ä½¿ç”¨ &ldquo;major.minor.patch&rdquo; ï¼ˆæŸ¥çœ‹  the spec on versioning è·å–è¯¦ç»†ä¿¡æ¯ ï¼‰ã€‚å¦‚æœç‰ˆæœ¬å·ç°åœ¨å¯¹ä½ æˆ–ä½ çš„ç”¨æˆ·æ¥è¯´ä¸é‡è¦, ä½ å¯ä»¥ç»™ç‰ˆæœ¬é‚£å„¿æ”¾ä¸Šä¸€é¢—æ˜Ÿ(*)ã€‚</p>
<p>åœ¨ <code>provides</code> ä¸€èŠ‚, åŒ…å«è¿›ä½ çš„å‘å¸ƒä¸­æä¾›çš„æ‰€æœ‰å‘½åç©ºé—´ã€‚</p>
<ul>
<li>æŠŠä½ çš„å·¥ç¨‹æ”¾åœ¨ git ç‰ˆæœ¬æ§åˆ¶ä¹‹ä¸‹, å¦‚æœä½ è¿˜æœªè¿™æ ·åšã€‚</li>
<li>ä¸€æ—¦ä½ å¯¹ä½ çš„å·¥ç¨‹æ»¡æ„äº†, åœ¨ Github ä¸Šä¸ºå®ƒåˆ›å»ºä¸€ä¸ªä»“åº“ã€‚å¿…è¦çš„è¯,  æŸ¥çœ‹ <a href="https://help.github.com/">Github&rsquo;s help docs</a>ã€‚ ä½ çš„ Github ä»“åº“çš„åå­—åº”è¯¥å’Œä½ å·¥ç¨‹ç›®å½•çš„åå­—ä¸€æ ·ã€‚åˆ›å»ºå®Œ Githhub ä»“åº“å, Github ä¼šä¸ºä½ å±•ç¤ºæ€ä¹ˆé…ç½®ä½ çš„æœ¬åœ°ä»“åº“ä»¥è·æ‚‰ä½ çš„ Github ä»“åº“ã€‚</li>
<li>æŠŠä½ çš„å·¥ç¨‹æ¨é€åˆ° Github</li>
<li>åœ¨ IRC é¢‘é“æ‰¾ä¸ªäººå¸®ä½ å±•ç¤ºæ€ä¹ˆæŠŠä½ çš„æ¨¡å—æ·»åŠ åˆ°<a href="https://github.com/raku/ecosystem">ecosystem</a>, æˆ–è€…è®©ä»–ä»¬æ˜¯å¦èƒ½æ›¿ä½ æ·»åŠ ã€‚</li>
<li>pull è¯·æ±‚è¢«æ¥æ”¶ä¹‹å, ç­‰ä¸ªæŠŠå°æ—¶ã€‚å¦‚æœä½ çš„æ¨¡å—æ²¡æœ‰å‡ºç°åœ¨  <a href="http://modules.raku.org/,">http://modules.raku.org/,</a> è¯·åˆ° <a href="http://modules.raku.org/log/update.log">http://modules.raku.org/log/update.log</a> ç¿»çœ‹log æ—¥å¿—æ–‡ä»¶, ä»¥æŸ¥æ‰¾æ˜¯å¦æœ‰é”™è¯¯ã€‚</li>
</ul>
<p>å°±æ˜¯è¿™æ ·å•¦ï¼æ„Ÿè°¢ä¸º Raku ç¤¾åŒºåšè´¡çŒ®ï¼</p>
<p>å¦‚æœä½ æƒ³å°è¯•å®‰è£…ä½ çš„æ¨¡å—, ä½¿ç”¨ç†ŠçŒ« panda å®‰è£…å·¥å…·, è¿™å·²ç»åŒ…å«åœ¨ Rakudo Raku ä¸­äº†:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="n">zef</span> <span class="nb">install</span> <span class="n">Vortex::TotalPerspective</span>
</code></pre></div><p>è¿™ä¼šä¸‹è½½ä½ çš„æ¨¡å—åˆ°å®ƒè‡ªå·±çš„å·¥ä½œç›®å½•(~/.zef), åœ¨é‚£å„¿åˆ›å»º build, å¹¶æŠŠæ¨¡å—å®‰è£…åˆ° <code>~/.raku</code></p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/module" term="module" label="module" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku ä¸­çš„ç‰¹æ€§(äºŒ)]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-03-16-features-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2015-03-23-sneaking-into-a-loop/?utm_source=atom_feed" rel="related" type="text/html" title="Sneaking Into a Loop" />
                <link href="https://ohmyweekly.github.io/notes/2015-03-14-using-raku/?utm_source=atom_feed" rel="related" type="text/html" title="Using Raku" />
            
                <id>https://ohmyweekly.github.io/notes/2015-03-16-features-in-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-10T00:00:00+08:00</published>
            <updated>2021-07-10T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Features in Raku</blockquote><h2 id="set">Set</h2>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$keywords</span> <span class="o">=</span> <span class="nb">set</span> <span class="p">&lt;</span><span class="s">if for unless while</span><span class="p">&gt;;</span> <span class="c1"># create a set</span>

<span class="k">sub</span> <span class="nf">has-keyword</span><span class="p">(</span><span class="o">*</span><span class="nv">@words</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="nv">@words</span> <span class="k">-&gt;</span> <span class="nv">$word</span> <span class="p">{</span>
        <span class="c1"># ä¾æ¬¡æ£€æŸ¥æ•°ç»„ä¸­çš„å…ƒç´ æ˜¯å¦å±äºé›†åˆ $keywords</span>
        <span class="k">return</span> <span class="nb">True</span> <span class="k">if</span> <span class="nv">$word</span> <span class="ow">(elem)</span> <span class="nv">$keywords</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nb">False</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="n">has-keyword</span> <span class="p">&#39;</span><span class="s1">not</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">one</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">here</span><span class="p">&#39;;</span>  <span class="c1"># False</span>
<span class="nb">say</span> <span class="n">has-keyword</span> <span class="p">&#39;</span><span class="s1">but</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">here</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">for</span><span class="p">&#39;;</span>  <span class="c1"># True</span>
</code></pre></div><h2 id="series-operator">Series Operator</h2>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@a</span><span class="o">=</span><span class="p">&lt;</span><span class="s">A G C T</span><span class="p">&gt;;</span>
<span class="k">my</span> <span class="nv">$x</span><span class="o">=</span><span class="nv">@a</span><span class="p">;</span>

<span class="k">for</span> <span class="mi">1</span> <span class="o">...</span> <span class="o">*</span> <span class="k">-&gt;</span> <span class="nv">$a</span> <span class="p">{</span>  
  <span class="p">((</span> <span class="o">[</span><span class="ow">X</span><span class="o">~]</span> <span class="nv">$x</span> <span class="ow">xx</span> <span class="nv">$a</span> <span class="p">))</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;</span><span class="s1">,</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>
  <span class="nb">last</span> <span class="k">if</span> <span class="nv">$a</span> <span class="o">==</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>å€’åºçš„ range:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="mi">10</span> <span class="o">...</span> <span class="mi">0</span> <span class="p">{</span>
    <span class="o">.</span><span class="nb">say</span><span class="p">;</span>
<span class="p">}</span>

</code></pre></div><h2 id="flipplop">flip/plop</h2>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$file</span> <span class="o">=</span> <span class="nb">open</span> <span class="p">&#39;</span><span class="s1">flip_flop.txt</span><span class="p">&#39;;</span>

<span class="k">for</span> <span class="nv">$file</span><span class="o">.</span><span class="nb">lines</span> <span class="k">-&gt;</span> <span class="nv">$line</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$line</span> <span class="k">if</span> <span class="o">!</span><span class="p">(</span><span class="nv">$line</span> <span class="o">~~</span> <span class="k">m</span><span class="p">/</span><span class="ni">^</span><span class="sr">\;</span><span class="p">/</span> <span class="ow">ff</span> <span class="nv">$line</span> <span class="o">~~</span> <span class="k">m</span><span class="p">/</span><span class="ni">^</span><span class="sr">\&#34;</span><span class="p">/);</span>
<span class="p">}</span>
</code></pre></div><p><code>$line ~~ m/^\;/ ff $line ~~ m/^\&quot;/</code> è¿‡æ»¤æ‰ <code>;</code> å’Œ <code>&quot;</code> ä¹‹é—´çš„å†…å®¹, å†å¯¹å®ƒè¿›è¡Œå–åæ“ä½œå°±æ˜¯è¿‡æ»¤åå‰©ä¸‹çš„æ–‡æœ¬ã€‚</p>
<p>flip_flop.txt å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code>; next is some lines to skip,include this line
fuck fuck fuck
dam dam dam
mie mie mie
&quot; next is subject
There is more than one way to do it
                                -- Larry Wall

We hope Raku is wrote by the hole Socfilia
                                -- Larry Wall
; next is some lines to skip,include this line
fuck fuck fuck
dam dam dam
mie mie mie
&quot; next is subject
programming is hard,Let's go shopping
                               -- Larry Wall
Ruby is Another Raku
                               -- Larry Wall
</code></pre><p>è¾“å‡ºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">There is more than one way to do it
                                -- Larry Wall
We hope Raku is wrote by the hole Socfilia
                                -- Larry Wall
programming is hard,Let&#39;s go shopping
                               -- Larry Wall
Ruby is Another Raku
                               -- Larry Wall
</code></pre></div><p><code>ff</code> æ“ä½œç¬¦å·¦å³ä¸¤ä¾§çš„ <code>^</code> è¡¨ç¤ºæ’é™¤:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="mi">20</span> <span class="p">{</span><span class="o">.</span><span class="nb">say</span> <span class="k">if</span> <span class="nv">$_</span><span class="o">==</span><span class="mi">9</span> <span class="ow">ff</span> <span class="nv">$_</span><span class="o">==</span><span class="mi">16</span><span class="p">}</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span> <span class="nb">x</span> <span class="mi">10</span><span class="p">;</span>
<span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="mi">20</span> <span class="p">{</span><span class="o">.</span><span class="nb">say</span> <span class="k">if</span> <span class="nv">$_</span><span class="o">==</span><span class="mi">9</span> <span class="ow">^ff</span> <span class="nv">$_</span><span class="o">==</span><span class="mi">16</span><span class="p">}</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span> <span class="nb">x</span> <span class="mi">10</span><span class="p">;</span>
<span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="mi">20</span> <span class="p">{</span><span class="o">.</span><span class="nb">say</span> <span class="k">if</span> <span class="nv">$_</span><span class="o">==</span><span class="mi">9</span> <span class="ow">ff^</span> <span class="nv">$_</span><span class="o">==</span><span class="mi">16</span><span class="p">}</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span> <span class="nb">x</span> <span class="mi">10</span><span class="p">;</span>
<span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="mi">20</span> <span class="p">{</span><span class="o">.</span><span class="nb">say</span> <span class="k">if</span> <span class="nv">$_</span><span class="o">==</span><span class="mi">9</span> <span class="ow">^ff</span><span class="o">^</span> <span class="nv">$_</span><span class="o">==</span><span class="mi">16</span><span class="p">}</span>
</code></pre></div><p>è¾“å‡º:</p>
<pre><code>9
10
11
12
13
14
15
16
----------
10
11
12
13
14
15
16
----------
9
10
11
12
13
14
15
----------
10
11
12
13
14
15
</code></pre><h2 id="grammars">Grammars</h2>
<p>è§£æ CSV:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku">ï»¿<span class="k">grammar</span> <span class="n">CSV</span> <span class="p">{</span>
    <span class="k">token</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr"> </span><span class="p">[</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">line</span><span class="p">&gt;</span><span class="sr"> </span><span class="se">\n</span><span class="o">?</span><span class="sr"> </span><span class="p">]</span><span class="o">+</span><span class="sr"> </span><span class="p">}</span>
    <span class="k">token</span> <span class="nf">line</span> <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="ni">^^</span><span class="sr">            </span><span class="c1"># Beginning of a line
</span><span class="c1"></span><span class="sr">        </span><span class="p">&lt;</span><span class="nf">value</span><span class="p">&gt;</span><span class="o">*</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> \, </span><span class="c1"># Any number of &lt;value&gt;s with commas in `between` them
</span><span class="c1"></span><span class="sr">        </span><span class="ni">$$</span><span class="sr">            </span><span class="c1"># End of a line
</span><span class="c1"></span><span class="sr">    </span><span class="p">}</span>
    <span class="k">token</span> <span class="nf">value</span> <span class="p">{</span><span class="sr">
</span><span class="sr">        </span><span class="p">[</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">-</span><span class="p">[</span><span class="sr">&#34;,</span><span class="se">\n</span><span class="p">]&gt;</span><span class="sr">     </span><span class="c1"># Anything not a double quote, comma or newline
</span><span class="c1"></span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">quoted-text</span><span class="p">&gt;</span><span class="sr"> </span><span class="c1"># Or some quoted text
</span><span class="c1"></span><span class="sr">        </span><span class="p">]</span><span class="o">*</span><span class="sr">              </span><span class="c1"># Any number of times
</span><span class="c1"></span><span class="sr">    </span><span class="p">}</span>
    <span class="k">token</span> <span class="nf">quoted-text</span> <span class="p">{</span><span class="sr">
</span><span class="sr">        \&#34;
</span><span class="sr">        </span><span class="p">[</span><span class="sr">
</span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">-</span><span class="p">[</span><span class="sr">&#34;\\</span><span class="p">]&gt;</span><span class="sr"> </span><span class="c1"># Anything not a &#34; or \
</span><span class="c1"></span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">\&#34;</span><span class="p">&#39;</span><span class="sr">     </span><span class="c1"># Or \&#34;, an escaped quotation mark
</span><span class="c1"></span><span class="sr">        </span><span class="p">]</span><span class="o">*</span><span class="sr">         </span><span class="c1"># Any number of times
</span><span class="c1"></span><span class="sr">        \&#34;
</span><span class="sr">    </span><span class="p">}</span>
<span class="p">}</span>
<span class="c1"># method parse($str, :$rule = &#39;TOP&#39;, :$actions) returns Match:D</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Valid CSV file!</span><span class="p">&#34;</span> <span class="k">if</span> <span class="n">CSV</span><span class="o">.</span><span class="nb">parse</span><span class="p">(</span> <span class="k">q</span><span class="sa">:to</span><span class="p">/EOCSV/ </span><span class="s">);
</span><span class="s">    Year,Make,Model,Length
</span><span class="s">    1997,Ford,E350,2.34
</span><span class="s">    2000,Mercury,Cougar,2.38
</span><span class="s">    </span><span class="p">EOCSV</span>

<span class="nb">say</span> <span class="n">CSV</span><span class="o">.</span><span class="nb">parse</span><span class="p">(</span> <span class="k">q</span><span class="sa">:to</span><span class="p">/EOCSV/,</span><span class="s"> &#39;line&#39;, :$actions );
</span><span class="s">    Year,Make,Model,Length
</span><span class="s">    1997,Ford,E350,2.34
</span><span class="s">    2000,Mercury,Cougar,2.38
</span><span class="s">    </span><span class="p">EOCSV</span>
</code></pre></div><p>è§£æå¤©æ°”æ•°æ®:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">grammar</span> <span class="nc">StationDataParser</span> <span class="p">{</span>
    <span class="k">token</span> <span class="nf">TOP</span>          <span class="p">{</span><span class="sr"> </span><span class="ni">^</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">keyval</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">observations</span><span class="p">&gt;</span><span class="sr"> </span><span class="ni">$</span><span class="sr">             </span><span class="p">}</span>
    <span class="k">token</span> <span class="nf">keyval</span>       <span class="p">{</span><span class="sr"> </span><span class="nv">$&lt;key&gt;</span><span class="o">=</span><span class="p">[&lt;</span><span class="o">-</span><span class="p">[</span><span class="sr">=</span><span class="p">]&gt;</span><span class="o">+</span><span class="p">]</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\h</span><span class="o">*</span><span class="sr"> </span><span class="nv">$&lt;val&gt;</span><span class="o">=</span><span class="p">[</span><span class="se">\N</span><span class="o">+</span><span class="p">]</span><span class="sr"> </span><span class="se">\n</span><span class="sr"> </span><span class="p">}</span>
    <span class="k">token</span> <span class="nf">observations</span> <span class="p">{</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">Obs:</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\h</span><span class="o">*</span><span class="sr"> </span><span class="se">\n</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">observation</span><span class="p">&gt;</span><span class="o">+</span><span class="sr">             </span><span class="p">}</span>
    <span class="k">token</span> <span class="nf">observation</span>  <span class="p">{</span><span class="sr"> </span><span class="nv">$&lt;year&gt;</span><span class="o">=</span><span class="p">[</span><span class="se">\d</span><span class="o">+</span><span class="p">]</span><span class="sr"> </span><span class="se">\h</span><span class="o">*</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">temp</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="nv">%%</span><span class="sr"> </span><span class="p">[</span><span class="se">\h</span><span class="o">*</span><span class="p">]</span><span class="sr"> </span><span class="se">\n</span><span class="sr">    </span><span class="p">}</span>
    <span class="k">token</span> <span class="nf">temp</span>         <span class="p">{</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="o">?</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="sr"> \</span><span class="ni">.</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="sr">                          </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">StationData</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$.name</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$.country</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">@.data</span><span class="p">;</span>

    <span class="k">submethod</span> <span class="nb">BUILD</span><span class="p">(</span><span class="o">:</span><span class="nv">%info</span> <span class="p">(:</span><span class="s">Name</span><span class="p">(</span><span class="nv">$!name</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">Country</span><span class="p">(</span><span class="nv">$!country</span><span class="p">)</span><span class="o">,</span> <span class="o">*</span><span class="nv">%</span><span class="p">)</span><span class="o">,</span> <span class="o">:</span><span class="nv">@!data</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">StationDataActions</span> <span class="p">{</span>
    <span class="k">method</span> <span class="nf">TOP</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">make</span> <span class="n">StationData</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span>
            <span class="s">info</span> <span class="o">=&gt;</span> <span class="nv">$&lt;keyval&gt;</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="o">*.</span><span class="nb">ast</span><span class="p">)</span><span class="o">.</span><span class="nb">hash</span>,
            <span class="s">data</span> <span class="o">=&gt;</span> <span class="nv">$&lt;observations&gt;</span><span class="o">.</span><span class="nb">ast</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">method</span> <span class="nf">keyval</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">make</span> <span class="o">~</span><span class="nv">$&lt;key&gt;</span> <span class="o">=&gt;</span> <span class="o">~</span><span class="nv">$&lt;val&gt;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">method</span> <span class="nf">observations</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">make</span> <span class="nv">$&lt;observation&gt;</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="o">*.</span><span class="nb">ast</span><span class="p">)</span><span class="o">.</span><span class="nb">grep</span><span class="p">(</span><span class="o">*.</span><span class="nb">value</span><span class="o">.</span><span class="nb">none</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">99</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">method</span> <span class="nf">observation</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">make</span> <span class="o">+</span><span class="nv">$&lt;year&gt;</span> <span class="o">=&gt;</span> <span class="nv">$&lt;temp&gt;</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="o">*.</span><span class="nb">Num</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="n">StationDataParser</span><span class="o">.</span><span class="nb">parse</span><span class="p">(</span> <span class="k">q</span><span class="sa">:to</span><span class="p">/EOCSV/,</span><span class="s"> :actions(StationDataActions)).ast
</span><span class="s">Name= Jan Mayen
</span><span class="s">Country= NORWAY
</span><span class="s">Lat=   70.9
</span><span class="s">Long=    8.7
</span><span class="s">Height= 10
</span><span class="s">Start year= 1921
</span><span class="s">End year= 2009
</span><span class="s">Obs:
</span><span class="s">1921 -4.4 -7.1 -6.8 -4.3 -0.8  2.2  4.7  5.8  2.7 -2.0 -2.1 -4.0  
</span><span class="s">1922 -0.9 -1.7 -6.2 -3.7 -1.6  2.9  4.8  6.3  2.7 -0.2 -3.8 -2.6  
</span><span class="s">2008 -2.8 -2.7 -4.6 -1.8  1.1  3.3  6.1  6.9  5.8  1.2 -3.5 -0.8  
</span><span class="s">2009 -2.3 -5.3 -3.2 -1.6  2.0  2.9  6.7  7.2  3.8  0.6 -0.3 -1.3
</span><span class="s"></span><span class="p">EOCSV</span>
</code></pre></div><h2 id="raku-examples">Raku Examples</h2>
<ul>
<li>1ã€ç”Ÿæˆ8ä½éšæœºå¯†ç </li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span>  <span class="nv">@char_set</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">9</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">z</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">A</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">Z</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">~</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">!</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">@</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">#</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">$</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">%</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">^</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">&amp;</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">*</span><span class="p">&#39;);</span>
<span class="nb">say</span> <span class="nv">@char_set</span><span class="o">.</span><span class="nb">pick</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#34;&#34;)</span> <span class="c1"># ä¸é‡å¤çš„8ä½å¯†ç </span>

<span class="nb">say</span> <span class="nv">@char_set</span><span class="o">.</span><span class="nb">roll</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#34;&#34;)</span> <span class="c1"># å¯ä»¥é‡å¤</span>
</code></pre></div><ul>
<li>2ã€æ‰“å°å‰5ä¸ªæ•°å­—</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="o">[^</span><span class="mi">5</span><span class="o">]</span>
<span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span> <span class="o">...</span> <span class="o">[^</span><span class="mi">10</span><span class="o">]</span>  <span class="c1"># è¿™ä¸ªä¼šæ— é™å¾ªç¯</span>
</code></pre></div><ul>
<li>
<p>3ã€æ’åº</p>
</li>
<li>
<p>3.1 æŒ‰æ•°å€¼æ’åº</p>
</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%hash</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">Perl</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="o">,</span>
           <span class="p">&#39;</span><span class="s1">Python</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="o">,</span>
           <span class="p">&#39;</span><span class="s1">Go</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="o">,</span>
           <span class="p">&#39;</span><span class="s1">CMD</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">20</span><span class="o">,</span>
           <span class="p">&#39;</span><span class="s1">Php</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">80</span><span class="o">,</span>
           <span class="p">&#39;</span><span class="s1">Java</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">85</span><span class="p">;</span>

<span class="nv">%hash</span><span class="o">.</span><span class="nb">values</span><span class="o">.</span><span class="nb">sort</span><span class="p">;</span>
<span class="nv">%hash</span><span class="o">.</span><span class="nb">values</span><span class="o">.</span><span class="nb">sort</span><span class="p">(</span><span class="o">-*</span><span class="p">);</span>
</code></pre></div><ul>
<li>3.2 æŒ‰åˆ†æ•°æ’åºæ•£åˆ—ï¼š</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%hash</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">Perl</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">80</span><span class="o">,</span>
         <span class="p">&#39;</span><span class="s1">Python</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="o">,</span>
             <span class="p">&#39;</span><span class="s1">Go</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">95</span><span class="o">,</span>
            <span class="p">&#39;</span><span class="s1">CMD</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">20</span><span class="o">,</span>
            <span class="p">&#39;</span><span class="s1">Php</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">80</span><span class="o">,</span>
           <span class="p">&#39;</span><span class="s1">Java</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">85</span><span class="p">;</span>

<span class="k">for</span> <span class="nv">%hash</span><span class="o">.</span><span class="nb">sort</span><span class="p">({</span><span class="o">-.</span><span class="nb">value</span><span class="p">})</span><span class="o">.</span><span class="nb">hash</span><span class="o">.</span><span class="nb">keys</span> <span class="k">-&gt;</span> <span class="nv">$key</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$key</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">\t</span><span class="p">&#34;</span><span class="o">,</span> <span class="nv">%hash</span><span class="p">{&#34;</span><span class="nv">$key</span><span class="p">&#34;}</span>
<span class="p">}</span>
</code></pre></div><p>è¾“å‡º:</p>
<pre><code>Python	100
Go	95
Java	85
Perl	80
Php	80
CMD	20
</code></pre><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">(&#39;</span><span class="s1">xx</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">zz</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">classify</span><span class="p">(</span><span class="o">*.</span><span class="nb">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">))&lt;</span><span class="s">z</span><span class="p">&gt;;</span> <span class="c1"># xz yz zz</span>
</code></pre></div><p>åŠ å¯†ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">rot13</span> <span class="p">{</span> <span class="nv">$^s</span><span class="o">.</span><span class="nb">trans</span><span class="p">(&#39;</span><span class="s1">a..z</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">n..za..m</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">A..Z</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">N..ZA..M</span><span class="p">&#39;)</span> <span class="p">}</span>
</code></pre></div><ul>
<li>4ã€æ±‚ 1! + 2! + 3! + 4! +5! + 6! +7! +8! +9! +10!</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">postfix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">!</span><span class="p">&gt;(</span><span class="nb">Int</span> <span class="nv">$x</span><span class="p">){</span> <span class="o">[*]</span> <span class="mi">1</span><span class="o">..</span><span class="nv">$x</span> <span class="p">}</span>
<span class="nb">say</span> <span class="o">[+]</span> <span class="mi">1</span><span class="o">!,</span><span class="mi">2</span><span class="o">!,</span><span class="mi">3</span><span class="o">!,</span><span class="mi">4</span><span class="o">!,</span><span class="mi">5</span><span class="o">!,</span><span class="mi">6</span><span class="o">!,</span><span class="mi">7</span><span class="o">!,</span><span class="mi">8</span><span class="o">!,</span><span class="mi">9</span><span class="o">!,</span><span class="mi">10</span><span class="o">!</span> <span class="c1"># 4037913</span>
</code></pre></div><ul>
<li>5ã€åˆ—å‡ºå¯¹è±¡æ‰€æœ‰å¯ç”¨çš„æ–¹æ³•</li>
</ul>
<p>ä½¿ç”¨å…ƒå¯¹è±¡åè®®ï¼Œ å³ <code>å¯¹è±¡å.^methods</code></p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">&gt;</span> <span class="p">&#34;</span><span class="s2">JZY</span><span class="p">&#34;</span><span class="o">.^</span><span class="nb">methods</span>
</code></pre></div><blockquote>
<p>BUILD Int Num chomp chop substr pred succ match ords lines samecase samespace tr
im-leading trim-trailing trim words encode wordcase trans indent codes path WHIC
H Bool Str Stringy DUMP ACCEPTS Numeric gist perl comb subst split</p>
</blockquote>
<ul>
<li>6ã€ åŒ¿åå­ä¾‹ç¨‹</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$x</span> <span class="o">=</span> <span class="k">sub</span><span class="p">(</span><span class="nv">$a</span><span class="p">){</span> <span class="nv">$a</span><span class="o">+</span><span class="mi">2</span> <span class="p">};</span><span class="nb">say</span> <span class="nv">$x</span><span class="p">(</span><span class="nv">$_</span><span class="p">)</span> <span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="mi">4</span>
<span class="k">my</span> <span class="nv">$x</span> <span class="o">=</span> <span class="k">-&gt;</span> <span class="nv">$a</span> <span class="p">{</span> <span class="nv">$a</span><span class="o">+</span><span class="mi">2</span> <span class="p">};</span><span class="nb">say</span> <span class="nv">$x</span><span class="p">(</span><span class="nv">$_</span><span class="p">)</span> <span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="mi">4</span>
<span class="k">my</span> <span class="nv">$x</span> <span class="o">=</span> <span class="o">*</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span><span class="nb">say</span> <span class="nv">$x</span><span class="p">(</span><span class="nv">$_</span><span class="p">)</span> <span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="mi">4</span>
</code></pre></div><ul>
<li>7ã€å­—ç¬¦ä¸²ç¿»è½¬ä¸åˆ†å‰²</li>
</ul>
<pre><code>&gt; 1223.flip
3221
&gt; 'abcd'.flip
dcba
&gt; 1234.comb
1 2 3 4
&gt; 1234.comb(/./)
1 2 3 4
&gt; 'abcd'.comb
a b c d
</code></pre><ul>
<li>8ã€æœ‰è¿™ä¹ˆä¸€ä¸ªå››ä½æ•° Aï¼Œå…¶ä¸ªä½æ•°ç›¸åŠ å¾—åˆ° Bï¼Œå°† B ä¹˜ä»¥ B çš„åè½¬æ•°åå¾—åˆ° Aï¼Œè¯·æ±‚å‡ºè¿™ä¸ªæ•°å­—ã€‚</li>
</ul>
<p>ä¸¾ä¾‹ï¼Œ 1458 å°±ç¬¦åˆè¿™ä¸ªæ¡ä»¶ï¼Œ1+4+5+8 ï¼ 18ï¼Œ 18 ï¼Š 81 ï¼1458</p>
<p>è¯·æ‰¾å‡ºå¦ä¸€ä¸ªç¬¦åˆä¸Šé¢æ¡ä»¶çš„å››ä½æ•°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">(</span><span class="o">^</span><span class="mi">37</span><span class="p">)</span><span class="o">.</span><span class="nb">map</span><span class="o">:</span> <span class="p">{</span>
  <span class="k">my</span> <span class="nv">$r</span> <span class="o">=</span> <span class="nv">$_</span> <span class="o">*</span> <span class="o">.</span><span class="nb">flip</span><span class="p">;</span>
  <span class="mi">1000</span> <span class="o">&lt;</span> <span class="nv">$r</span> <span class="ow">and</span> <span class="nv">$_</span> <span class="o">==</span> <span class="o">[+]</span> <span class="nv">$r</span><span class="o">.</span><span class="nb">comb</span> <span class="ow">and</span> <span class="nb">say</span> <span class="nv">$r</span>
<span class="p">}</span>
</code></pre></div><p><code>^37</code> äº§ç”Ÿä¸€ä¸ªèŒƒå›´  0 .. ^37, å°±æ˜¯ 0åˆ°36ä¹‹å‰çš„æ•°ï¼Œåœ¨è¡¨è¾¾å¼ä¸­ä»£è¡¨ B</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$b</span><span class="p">;</span>
<span class="k">for</span> <span class="mi">1000</span><span class="o">..^</span><span class="mi">10000</span> <span class="k">-&gt;</span> <span class="nv">$i</span> <span class="p">{</span>
  <span class="nv">$b</span><span class="o">=[+]</span> <span class="nv">$i</span><span class="o">.</span><span class="nb">comb</span><span class="p">;</span>
  <span class="nb">say</span> <span class="nv">$i</span> <span class="k">if</span> <span class="nv">$b</span><span class="o">*</span><span class="nv">$b</span><span class="o">.</span><span class="nb">flip</span> <span class="o">==</span> <span class="nv">$i</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>è¾“å‡º:</p>
<pre><code>1458
1729
</code></pre><ul>
<li>9ã€ å¤§å°å†™è½¬æ¢</li>
</ul>
<pre><code>&gt; my $word= &quot;I Love Raku&quot;
I Love Raku
&gt; $word.wordcase()
I Love Raku
&gt; my $lowercase = &quot;i love perl 6&quot;
i love perl 6
&gt; $lowercase.wordcase()
I Love Raku
&gt; $word.samecase('A')
I LOVE PERL 6
&gt; $word.samecase('a')
i love perl 6
&gt; $word.samecase('a').wordcase()
I Love Raku
</code></pre><ul>
<li>10ã€ å¤šè¡Œæ–‡æœ¬</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$string</span> <span class="o">=</span> <span class="k">q</span><span class="sa">:to</span><span class="p">/THE END/;</span><span class="s">
</span><span class="s">Norway
</span><span class="s">    Oslo : 59.914289,10.738739 : 2
</span><span class="s">    Bergen : 60.388533,5.331856 : 4
</span><span class="s">Ukraine
</span><span class="s">    Kiev : 50.456001,30.50384 : 3
</span><span class="s">Switzerland
</span><span class="s">    Wengen : 46.608265,7.922065 : 3
</span><span class="s"></span><span class="p">THE END</span>

<span class="nb">say</span> <span class="nv">$string</span><span class="p">;</span>
</code></pre></div><ul>
<li>11ã€ è¶…è¿ç®—ç¬¦ä¸å­ä¾‹ç¨‹</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@a</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">1 2 3 4</span><span class="p">&gt;;</span>

<span class="k">sub</span> <span class="nf">by2</span><span class="p">(</span><span class="nv">$n</span><span class="p">){</span>
    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="nv">$n</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">power2</span><span class="p">(</span><span class="nv">$n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">@b</span> <span class="o">=</span> <span class="nv">@a</span><span class="o">Â».&amp;</span><span class="nf">by2</span><span class="o">Â».&amp;</span><span class="nf">power2</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">@b</span><span class="p">;</span> <span class="c1"># 4 16 36 64</span>
</code></pre></div><p>ä¸ºä»€ä¹ˆæ˜¯ <code>&amp;function</code> å‘¢ï¼š</p>
<blockquote>
<p>the name of the by2 function is &amp;by2, just as the name of the foo scalar is $foo and the name of the foo array is @foo</p>
</blockquote>
<ul>
<li>12ã€ å¦‚ä½•åœ¨ Raku ä¸­æ‰§è¡Œå¤–éƒ¨å‘½ä»¤å¹¶æ•è·è¾“å‡º</li>
</ul>
<pre><code>&gt; my $res = qqx{mkdir 123456}

# æˆ–ä½¿ç”¨ qx{ }
&gt; my $res = qx{mkdir 112233}
</code></pre><ul>
<li>13ã€Does Raku support something equivalent to Perl5&rsquo;s <strong>DATA</strong> and <strong>END</strong> sections?</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="n">=foo</span><span class="sd"> This is a Pod block. A single line one. This Pod block&#39;s name is &#39;foo&#39;.
</span><span class="sd"></span>
<span class="k">=begin</span><span class="sd"> </span><span class="k">qux</span><span class="sd">
</span><span class="sd">This is another syntax for defining a Pod block.
</span><span class="sd">It allows for multi line content.
</span><span class="sd">This block&#39;s name is &#39;qux&#39;.
</span><span class="sd"></span><span class="k">=end qux</span>

<span class="k">=data</span><span class="sd"> A data block -- a Pod block with the name &#39;data&#39;.
</span><span class="sd"></span>
<span class="c1"># Data blocks are P6&#39;s version of P5&#39;s __DATA__.</span>
<span class="c1"># But you can have multiple data blocks:</span>

<span class="k">=begin</span><span class="sd"> </span><span class="k">data</span><span class="sd">
</span><span class="sd">Another data block.
</span><span class="sd">This time a multi line one.
</span><span class="sd"></span><span class="k">=end data</span>

<span class="nv">$=pod</span><span class="o">.</span><span class="nb">grep</span><span class="p">(</span><span class="o">*.</span><span class="nb">name</span> <span class="ow">eq</span> <span class="p">&#39;</span><span class="s1">data</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="o">*.</span><span class="nb">contents</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="nb">contents</span><span class="o">.</span><span class="nb">say</span><span class="p">);</span>

<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span> <span class="nb">x</span> <span class="mi">45</span><span class="p">;</span>

<span class="k">for</span> <span class="nv">@$=pod</span> <span class="p">{</span>
  <span class="k">if</span> <span class="o">.</span><span class="nb">name</span> <span class="ow">eq</span> <span class="p">&#39;</span><span class="s1">data</span><span class="p">&#39;</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="o">.</span><span class="nb">contents</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="nb">contents</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><ul>
<li>14ã€ç”Ÿæˆå«æœ‰26ä¸ªè‹±æ–‡å­—æ¯å’Œä¸‹åˆ’çº¿çš„ junction</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">any</span><span class="p">(&#39;</span><span class="s1">A</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">Z</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">z</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">_</span><span class="p">&#39;);</span>
</code></pre></div><ul>
<li>15ã€åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦æ˜¯å¦åœ¨æŸä¸ªé›†åˆä¸­</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">&gt;</span>  <span class="nb">so</span> <span class="nb">any</span><span class="p">(&#39;</span><span class="s1">A</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">Z</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">z</span><span class="p">&#39;)</span> <span class="o">âˆˆ</span> <span class="nb">set</span><span class="p">(&#34;</span><span class="s2">12a34</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">comb</span><span class="p">)</span>
</code></pre></div><p>&ldquo;12a34&rdquo;.comb ä¼šæŠŠå­—ç¬¦ä¸²åˆ†å‰²ä¸ºå•ä¸ªå­—ç¬¦ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦æ•°ç»„ã€‚</p>
<ul>
<li>16ã€ç”Ÿæˆ IP åœ°å€èŒƒå›´</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="p">&#34;</span><span class="s2">192.168.10.</span><span class="p">&#34;</span> <span class="p">Â«</span><span class="s2">~</span><span class="p">Â»</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="nb">list</span>
</code></pre></div><ul>
<li>17ã€ ç”Ÿæˆ OC ä¸­çš„æµ‹è¯•æ•°ç»„</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="p">&#34;</span><span class="s2">@</span><span class="p">&#34;</span> <span class="p">Â«</span><span class="s2">~</span><span class="p">Â»</span> <span class="p">&#39;</span><span class="s1">&#34;Perl</span><span class="p">&#39;</span> <span class="p">Â«</span><span class="s2">~</span><span class="p">Â»</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">30</span><span class="p">)</span><span class="o">.</span><span class="nb">list</span> <span class="p">Â«</span><span class="s2">~</span><span class="p">Â»</span> <span class="p">&#39;</span><span class="s1">&#34;,</span><span class="p">&#39;</span>
</code></pre></div><pre><code>@&quot;Perl&quot;1&quot;,
@&quot;Perl&quot;2&quot;,
@&quot;Perl&quot;3&quot;,
@&quot;Perl&quot;4&quot;,
@&quot;Perl&quot;5&quot;,
â€¦
</code></pre>
<ul>
<li>18ã€æˆ‘æƒ³ä»¥ AGCT 4 ç§å­—æ¯ä¸ºåŸºç¡€ç”Ÿæˆå­—ç¬¦ä¸²ã€‚</li>
</ul>
<p>æ¯”å¦‚å¸Œæœ›é•¿åº¦ä¸º1ï¼Œè¾“å‡ºA,G,C,Tã€‚</p>
<p>å¦‚æœé•¿åº¦ä¸º2ï¼Œè¾“å‡º AA,AG,AC,AT,GA,GG,GC,GT,CA,CG,CC,CT,TA,TG,TC,TTã€‚è¿™æ ·çš„ç»“æœã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@a</span> <span class="ow">X</span><span class="o">~</span> <span class="p">&#34;&#34;</span>             <span class="c1"># é•¿åº¦ä¸º1</span>
<span class="p">(</span><span class="nv">@a</span> <span class="ow">X</span><span class="o">~</span> <span class="nv">@a</span><span class="p">)</span>           <span class="c1"># é•¿åº¦ä¸º2</span>
<span class="p">(</span><span class="nv">@a</span> <span class="ow">X</span><span class="o">~</span> <span class="nv">@a</span><span class="p">)</span> <span class="ow">X</span><span class="o">~</span> <span class="nv">@a</span>     <span class="c1"># é•¿åº¦ä¸º3</span>
<span class="nv">@a</span> <span class="ow">X</span><span class="o">~</span> <span class="nv">@a</span> <span class="ow">X</span><span class="o">~</span> <span class="nv">@a</span> <span class="ow">X</span><span class="o">~</span> <span class="nv">@a</span> <span class="c1"># é•¿åº¦ä¸º4</span>
</code></pre></div><pre><code>&gt; my @a=&lt;A G C T&gt;
A G C T
&gt; my $x=@a
A G C T
&gt; $x xx 2
A G C T A G C T
&gt; $x xx 3
A G C T A G C T A G C T
&gt; ($x xx 3).WHAT
(List)
&gt; $x.WHAT
(Array)

&gt; ([X~] $x xx 2).join(',')
AA,AG,AC,AT,GA,GG,GC,GT,CA,CG,CC,CT,TA,TG,TC,TT
</code></pre><p>æƒ°æ€§æ“ä½œç¬¦ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@a</span><span class="o">=</span><span class="p">&lt;</span><span class="s">A G C T</span><span class="p">&gt;;</span>
<span class="k">my</span> <span class="nv">$x</span><span class="o">=</span><span class="nv">@a</span><span class="p">;</span>  <span class="c1"># æˆ–è€…ä½¿ç”¨ $x = @(&#39;A&#39;,&#39;G&#39;,&#39;C&#39;,&#39;T&#39;)</span>
<span class="k">for</span> <span class="mi">1</span> <span class="o">...^</span> <span class="o">*</span> <span class="k">-&gt;</span> <span class="nv">$a</span> <span class="p">{((</span><span class="o">[</span><span class="ow">X</span><span class="o">~]</span> <span class="nv">$x</span> <span class="ow">xx</span> <span class="nv">$a</span><span class="p">))</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;</span><span class="s1">,</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span><span class="nb">last</span> <span class="k">if</span> <span class="nv">$a</span><span class="o">==</span><span class="mi">4</span><span class="p">;};</span>
</code></pre></div><h2 id="best-of-raku">Best Of Raku</h2>
<ul>
<li>Command Line å‘½ä»¤è¡Œ</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"> <span class="c1">#               Perl 5                                     Raku</span>
 <span class="nb">print</span> <span class="p">&#34;</span><span class="s2">bananas are good\n</span><span class="p">&#34;;</span>                     <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">bananas are good</span><span class="p">&#34;;</span>
 <span class="nb">print</span> <span class="p">&#34;</span><span class="s2">and I said: </span><span class="nv">$quotes</span><span class="p">{</span>\&#34;<span class="n">me</span>\&#34;<span class="p">}</span><span class="s2">\n</span><span class="p">&#34;;</span>          <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">and I said: </span><span class="nv">%quotes</span><span class="p">{&#34;</span><span class="s2">me</span><span class="p">&#34;}</span><span class="s2">.</span><span class="p">&#34;;</span>
 <span class="nb">print</span> <span class="p">&#34;</span><span class="s2">and I said: </span><span class="nv">$quotes</span><span class="p">{</span>\&#34;<span class="n">me</span>\&#34;<span class="p">}</span><span class="s2">\n</span><span class="p">&#34;;</span>          <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">and I said: </span><span class="nv">%quotes</span><span class="p">&lt;</span><span class="s">me</span><span class="p">&gt;</span><span class="s2">.</span><span class="p">&#34;;</span>
 <span class="nb">print</span> <span class="p">&#34;</span><span class="s2">What is ... </span><span class="p">&#34;;</span>                           <span class="nv">$result</span> <span class="o">=</span> <span class="nb">prompt</span> <span class="p">&#34;</span><span class="s2">What is ... </span><span class="p">&#34;;</span>
 <span class="nb">chomp</span><span class="p">(</span><span class="nv">$result</span> <span class="o">=</span> <span class="o">&lt;&gt;</span><span class="p">);</span>
</code></pre></div><ul>
<li>File IO</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"> <span class="c1">#              Perl 5                                     Raku</span>
 <span class="nv">$content</span> <span class="o">=</span> <span class="nb">do</span> <span class="p">{</span> <span class="nb">local</span> <span class="nv">$/</span><span class="p">;</span>                       <span class="nv">$content</span> <span class="o">=</span> <span class="nb">slurp</span> <span class="p">&#34;</span><span class="s2">poetry.txt</span><span class="p">&#34;;</span>
    <span class="nb">open</span> <span class="k">my</span> <span class="nv">$FH</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">poetry.txt</span><span class="p">&#34;;</span> <span class="p">&lt;</span><span class="s">$FH</span><span class="p">&gt;</span>
 <span class="p">};</span>

<span class="nb">chomp</span><span class="p">(</span><span class="nv">@content</span> <span class="o">=</span> <span class="nb">do</span> <span class="p">{</span>                            <span class="nv">@content</span> <span class="o">=</span> <span class="nb">lines</span> <span class="p">&#34;</span><span class="s2">poetry.txt</span><span class="p">&#34;;</span>
    <span class="nb">open</span> <span class="k">my</span> <span class="nv">$FH</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">poetry.txt</span><span class="p">&#34;;</span> <span class="p">&lt;</span><span class="s">$FH</span><span class="p">&gt;</span>
<span class="p">});</span>
</code></pre></div><ul>
<li>Automatic multithreading</li>
</ul>
<p>Applying operations to junctions and arrays is now syntactically compact and readable.
Raku will create threads where appropriate to use multiple processors, cores or hyperthreading for high level language SIMD concurrent processing.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"> <span class="c1">#              Perl 5                                     Raku</span>
 <span class="k">my</span> <span class="nv">$sum</span><span class="p">;</span>                                        <span class="k">my</span> <span class="nv">$sum</span> <span class="o">=</span> <span class="o">[+]</span> <span class="nv">@numbers</span><span class="p">;</span>
 <span class="nv">$sum</span> <span class="o">+=</span> <span class="nv">$_</span> <span class="k">for</span> <span class="nv">@numbers</span><span class="p">;</span>
 <span class="k">for</span> <span class="p">(</span><span class="mi">0</span> <span class="o">..</span> <span class="nv">$</span><span class="c1">#factor1) {                          @product = @factor1 &gt;&gt;*&lt;&lt; @factor2;</span>
   <span class="nv">$product</span><span class="o">[</span><span class="nv">$</span><span class="o">]</span> <span class="o">=</span> <span class="nv">$factor1</span><span class="o">[</span><span class="nv">$</span><span class="o">]</span> <span class="o">*</span> <span class="nv">$factor2</span><span class="o">[</span><span class="nv">$_</span><span class="o">]</span><span class="p">;</span>
 <span class="p">}</span>
</code></pre></div><p>The Perl 5 code is a simplification, of course Raku &ldquo;does the right thing&rdquo; when the arrays have different lengths.</p>
<ul>
<li>æ¯”è¾ƒ</li>
</ul>
<p>Here are junctions, then chained comparison operators.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"> <span class="c1">#            Perl 5                                     Raku</span>
 <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">or</span> <span class="nv">$a</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">or</span> <span class="nv">$a</span> <span class="o">==</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>        <span class="k">if</span> <span class="nv">$a</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">|</span> <span class="mi">4</span> <span class="o">|</span> <span class="mi">7</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
 <span class="k">if</span> <span class="p">(</span><span class="mi">4</span> <span class="o">&lt;</span> <span class="nv">$a</span> <span class="ow">and</span> <span class="nv">$a</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">)</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>                   <span class="k">if</span> <span class="mi">4</span> <span class="o">&lt;</span> <span class="nv">$a</span> <span class="o">&lt;</span> <span class="mi">12</span>    <span class="p">{</span><span class="o">...</span><span class="p">}</span>
 <span class="k">if</span> <span class="p">(</span><span class="mi">4</span> <span class="o">&lt;</span> <span class="nv">$a</span> <span class="ow">and</span> <span class="nv">$a</span> <span class="o">&lt;=</span> <span class="mi">12</span><span class="p">)</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>                  <span class="k">if</span> <span class="nv">$a</span> <span class="o">~~</span> <span class="mi">4</span><span class="o">^..</span><span class="mi">12</span>   <span class="p">{</span><span class="o">...</span><span class="p">}</span>
 <span class="nv">$a</span> <span class="o">=</span> <span class="nb">defined</span> <span class="nv">$b</span> <span class="o">?</span> <span class="nv">$b</span> <span class="o">:</span> <span class="nv">$c</span><span class="p">;</span>                      <span class="nv">$a</span> <span class="o">=</span> <span class="nv">$b</span> <span class="o">//</span> <span class="nv">$c</span><span class="p">;</span>
</code></pre></div><p>The defined-OR operator eases lot of cases where Perl 5 newbies could fall into traps.</p>
<ul>
<li>Case ç»“æ„</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku">  <span class="c1">#            Perl 5                                      Raku</span>
                                                     <span class="k">given</span> <span class="nv">$a</span> <span class="p">{</span>
 <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="nv">$a</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span> <span class="p">}}</span>                      <span class="k">when</span> <span class="mi">2</span> <span class="o">|</span> <span class="mi">5</span>  <span class="p">{</span><span class="o">...</span><span class="p">}</span>
 <span class="k">elsif</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">or</span> <span class="nv">$a</span> <span class="o">==</span> <span class="mi">7</span> <span class="ow">or</span> <span class="nv">$a</span> <span class="o">==</span> <span class="mi">8</span> <span class="ow">or</span> <span class="nv">$a</span> <span class="o">==</span> <span class="mi">9</span><span class="p">)</span> <span class="p">{}</span>   <span class="k">when</span> <span class="mi">6</span> <span class="o">..</span> <span class="mi">9</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
 <span class="k">elsif</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">=~</span> <span class="o">/</span><span class="n">g</span><span class="o">/</span><span class="p">)</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>                               <span class="k">when</span> <span class="p">&#39;</span><span class="s1">g</span><span class="p">&#39;</span>    <span class="p">{</span><span class="o">...</span><span class="p">}</span>
 <span class="k">else</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>                                            <span class="k">default</span>     <span class="p">{</span><span class="o">...</span><span class="p">}</span>
                                                     <span class="p">}</span>
</code></pre></div><p>That new construct (backported to 5.10) is clear to read, very versatile and when used in combination with junctions, becomes even clearer.</p>
<ul>
<li>å¼ºå¤§çš„å¾ªç¯</li>
</ul>
<p>List iteration via for is now much more versatile.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"> <span class="c1">#            Perl 5                                     Raku</span>
 <span class="k">for</span> <span class="k">my</span> <span class="nv">$i</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">15</span><span class="p">)</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>                         <span class="k">for</span> <span class="o">^</span><span class="mi">16</span> <span class="k">-&gt;</span> <span class="nv">$i</span>        <span class="p">{</span><span class="o">...</span><span class="p">}</span>
 <span class="k">for</span> <span class="p">(</span><span class="k">my</span> <span class="nv">$i</span><span class="o">=</span><span class="mi">15</span><span class="p">;</span> <span class="nv">$i</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">;</span> <span class="nv">$i-2</span><span class="p">)</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>                <span class="k">for</span> <span class="mi">15</span><span class="o">,*-</span><span class="mi">2</span><span class="o">...</span><span class="mi">1</span> <span class="k">-&gt;</span> <span class="nv">$i</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
 <span class="k">for</span> <span class="k">my</span> <span class="nv">$key</span> <span class="p">(</span><span class="nb">keys</span> <span class="nv">%hash</span><span class="p">)</span> <span class="p">{</span>                      <span class="k">for</span> <span class="nv">%hash</span><span class="o">.</span><span class="nb">kv</span> <span class="k">-&gt;</span> <span class="nv">$key</span><span class="o">,</span> <span class="nv">$value</span> <span class="p">{</span>
   <span class="nb">print</span> <span class="p">&#34;</span><span class="nv">$key</span><span class="s2"> =&gt; </span><span class="nv">$hash</span><span class="p">{</span><span class="nv">$key</span><span class="p">}</span><span class="s2">\n</span><span class="p">&#34;;</span> <span class="o">...</span>              <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$key</span><span class="s2"> =&gt; </span><span class="nv">$value</span><span class="p">&#34;;</span> <span class="o">...</span>
 <span class="k">for</span> <span class="k">my</span> <span class="nv">$i</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="nv">$</span><span class="c1">#a) {                            for zip(@a; @b; @c) -&gt; $a, $b, $c {...}</span>
   <span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="nv">@a</span><span class="o">[</span><span class="nv">$i</span><span class="o">]</span><span class="p">;</span>
   <span class="k">my</span> <span class="nv">$b</span> <span class="o">=</span> <span class="nv">@b</span><span class="o">[</span><span class="nv">$i</span><span class="o">]</span><span class="p">;</span>
   <span class="k">my</span> <span class="nv">$c</span> <span class="o">=</span> <span class="nv">@c</span><span class="o">[</span><span class="nv">$i</span><span class="o">]</span><span class="p">;</span> <span class="o">...</span>
</code></pre></div><ul>
<li>å­ä¾‹ç¨‹ä¸­çš„å…·åå‚æ•°</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"> <span class="c1">#            Perl 5                                     Raku</span>
 <span class="k">sub</span> <span class="nf">routine</span> <span class="p">{</span>                                   <span class="k">sub</span> <span class="nf">routine</span> <span class="p">(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="o">,</span> <span class="o">*</span><span class="nv">@rest</span><span class="p">)</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
   <span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
   <span class="k">my</span> <span class="nv">$b</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
   <span class="k">my</span> <span class="nv">@rest</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
 <span class="p">}</span>
</code></pre></div><ul>
<li>Objects with auto generated new and getters and setters</li>
</ul>
<p>Simple Object creation is now as easy as it gets.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"> <span class="c1">#              Perl 5                                     Raku</span>
 <span class="nb">package</span> <span class="nn">Heart::Gold</span><span class="p">;</span>                            <span class="k">class</span> <span class="nc">Heart::Gold</span> <span class="p">{</span>
                                                   <span class="k">has</span> <span class="nv">$.speed</span><span class="p">;</span>
 <span class="k">sub</span> <span class="nb">new</span> <span class="p">{</span>                                         <span class="k">method</span> <span class="nf">stop</span> <span class="p">{</span> <span class="nv">$.speed</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">}</span>
   <span class="nb">bless</span> <span class="p">{</span><span class="s">speed</span> <span class="o">=&gt;</span> <span class="mi">0</span> <span class="p">}</span>, <span class="nb">shift</span><span class="p">;</span>                   <span class="p">}</span>  
 <span class="p">}</span>
                                                 <span class="k">my</span> <span class="n">Heart::Gold</span> <span class="nv">$hg1</span> <span class="o">.=</span> <span class="nb">new</span><span class="p">;</span>
 <span class="k">sub</span> <span class="nf">speed</span> <span class="p">{</span>                                     <span class="nv">$hg1</span><span class="o">.</span><span class="nf">speed</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
   <span class="k">my</span> <span class="nv">$self</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>                             <span class="k">my</span> <span class="nv">$hg2</span> <span class="o">=</span> <span class="nv">$hg1</span><span class="o">.</span><span class="nb">clone</span><span class="p">;</span>
   <span class="k">my</span> <span class="nv">$speed</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
   <span class="k">if</span> <span class="p">(</span><span class="nb">defined</span> <span class="nv">$speed</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$self-</span><span class="o">&gt;</span><span class="p">{</span><span class="n">speed</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$speed</span> <span class="p">}</span>
   <span class="k">else</span> <span class="p">{</span> <span class="nv">$self-</span><span class="o">&gt;</span><span class="p">{</span><span class="n">speed</span><span class="p">}</span> <span class="p">}</span>
 <span class="p">}</span>

 <span class="k">sub</span> <span class="nf">stop</span> <span class="p">{</span>
   <span class="k">my</span> <span class="nv">$self</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
   <span class="nv">$self-</span><span class="o">&gt;</span><span class="p">{</span><span class="n">speed</span><span class="p">}</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
 <span class="p">}</span>
</code></pre></div><h2 id="raku-variable">Raku Variable</h2>
<ul>
<li>Variable Types</li>
</ul>
<p>Raku (as Perl 5) knows 3 basic types of variables: Scalars (single values), Arrays (ordered and indexed lists of several values) and Hashes (2 column table, with ID and associated value pairs). They can be easily distinguished, because in front of their name is a special character called sigil (latin for sign). It&rsquo;s the $ (similar to S) for Scalars, @ (like an a) for Arrays and a % (kv pair icon) for a Hash. They are now invariant (not changing), which means for instance, an array vaiable starts always with an @, even if you just want a slice of the content.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$scalar</span>
<span class="nv">@array</span>
<span class="nv">@array</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>              <span class="c1"># $array[1]   in Perl 5</span>
<span class="nv">@array</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">]</span>            <span class="c1"># @array[1,2] in Perl 5</span>
<span class="nv">%hash</span>
<span class="nv">%hash</span><span class="p">{&#39;</span><span class="s1">ba</span><span class="p">&#39;}</span>            <span class="c1"># $hash{&#39;ba&#39;} in Perl 5</span>
<span class="nv">%hash</span><span class="p">{&#39;</span><span class="s1">ba</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">da</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">bim</span><span class="p">&#39;}</span> <span class="c1"># @hash{&#39;ba&#39;,&#39;da&#39;,&#39;bim&#39;} in Perl 5</span>
</code></pre></div><p>The sigils also mark distinct namespaces, meaning: in one lexical scope you can have 3 different variables named $stuff, @stuff and %stuff. These sigils can also be used as an operator to enforce a context in which the following data will be seen.</p>
<p>The fourth namespace is for subroutines and similar, even if you don&rsquo;t usually think of them as variables. It&rsquo;s sigil &amp; is used to refer to subroutines without calling them.</p>
<p>All special namespaces from Perl 5 (often marked with special syntax), like tokens (<strong>PACKAGE</strong>), formats, file or dir handles, or builtins are now regular variables or routines.</p>
<p>Because all variables contain objects, they have methods. In fact, all operators, including square or curly bracket subscripts, are just methods of an object with a fancy name.</p>
<p>The primary sigil can be followed by a secondary sigil, called a twigil, which indicates a special scope for that variable.</p>
<h3 id="scalar">Scalar</h3>
<p>This type stores one value, usually a reference to something: a value of a data type, a code object, an object or a compound of values like a pair, junction, array, hash or capture. The scalar context is now called item context, hence the scalar instruction from Perl 5 was renamed to item.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$CHAPTER</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>              <span class="c1"># first comment!</span>
<span class="nv">$bin</span> <span class="o">=</span> <span class="mb">0b11</span><span class="p">;</span>               <span class="c1"># same value in binary format</span>
<span class="nv">$pi</span> <span class="o">=</span> <span class="mf">3.14159_26535_89793</span><span class="p">;</span> <span class="c1"># the underscores just ease reading</span>
<span class="nv">$float</span> <span class="o">=</span> <span class="mf">6.02e-23</span><span class="p">;</span>         <span class="c1"># floating number in scientific notation</span>
<span class="nv">$text</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">Welcome all!</span><span class="p">&#39;;</span>    <span class="c1"># single quoted string</span>

<span class="c1"># double quoted string, does eval $pi to it&#39;s content</span>
<span class="nv">$text</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2"> What is </span><span class="nv">$pi</span><span class="s2">?</span><span class="p">&#34;;</span>
<span class="nv">$text</span> <span class="o">=</span> <span class="k">q</span><span class="sa">:to</span><span class="p">&#39;EOT&#39;;</span><span class="s">         # heredoc string
</span><span class="s">
</span><span class="s">    handy for multiline text
</span><span class="s">    like HTML templates or email
</span><span class="s">
</span><span class="s"></span><span class="p">EOT</span>
<span class="nv">$handle</span> <span class="o">=</span> <span class="nb">open</span> <span class="nv">$file_name</span><span class="p">;</span> <span class="c1"># file handle</span>
<span class="c1"># an object from a class with a nested namespace</span>
<span class="nv">$object</span> <span class="o">=</span> <span class="n">Class::Name</span><span class="o">.</span><span class="nb">new</span><span class="p">();</span>
<span class="nv">$condition</span> <span class="o">=</span> <span class="mi">3</span><span class="o">|</span><span class="mi">5</span><span class="o">|</span><span class="mi">7</span><span class="p">;</span>                <span class="c1"># a junction, a logical conjunction of values</span>
<span class="nv">$arrayref</span> <span class="o">=</span> <span class="o">[</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="mi">13</span><span class="o">,</span><span class="mi">21</span><span class="o">]</span><span class="p">;</span> <span class="c1"># an array stored as a single item</span>

<span class="c1"># a hash stored as a single item</span>
<span class="nv">$hashref</span> <span class="o">=</span> <span class="p">{&#39;</span><span class="s1">audreyt</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">pugs</span><span class="p">&#39;</span><span class="o">,</span>
            <span class="p">&#39;</span><span class="s1">pm</span><span class="p">&#39;</span>      <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">pct</span><span class="p">&#39;</span><span class="o">,</span>
            <span class="p">&#39;</span><span class="s1">damian</span><span class="p">&#39;</span>  <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">larrys evil henchman</span><span class="p">&#39;};</span>
<span class="c1"># pointing to a callable</span>
<span class="nv">$coderef</span> <span class="o">=</span> <span class="k">sub</span> <span class="p">{</span> <span class="nf">do_something_completely_diffenent</span><span class="p">(</span><span class="nv">@_</span><span class="p">)</span> <span class="p">};</span>
</code></pre></div><p>(For info on some of those terms: comment, binary format, the underscores ease reading, scientific notation, single-quoted string, double-quoted string, heredoc string, file handle, class, junction, list of values, hash, callable.)</p>
<p>Unlike Perl 5, references are automatically dereferenced to a fitting context. So you could use these $arrayrefs and $hashrefs similarly to an array or hash, making $ the universal variable prefix, pretty much like in PHP. The primary difference is that $ prefixed lists are not flattened in lists.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="p">);</span>
<span class="k">my</span> <span class="nv">@a</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="p">;</span>
<span class="k">for</span> <span class="nv">$a</span> <span class="p">{</span> <span class="p">}</span>          <span class="c1"># just one iteration</span>
<span class="k">for</span> <span class="nv">@a</span> <span class="p">{</span> <span class="p">}</span>          <span class="c1"># three iterations</span>
</code></pre></div><h3 id="scalar-methods">Scalar Methods</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$chapter</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="nb">undefine</span> <span class="nv">$chapter</span><span class="p">;</span>
<span class="nb">defined</span> <span class="nv">$a</span><span class="p">;</span> <span class="c1"># false, returns 0</span>
</code></pre></div><ul>
<li>Array</li>
</ul>
<p>An array is an ordered and indexed list of scalars. If not specified otherwise, they can be changed, expanded and shortened anytime and used as a list, stack, queue and much more. As in Haskell, lists are processed lazily, which means: the compiler looks only at the part it currently needs. This way Raku can handle infinite lists or do computation on lists that have not been computed yet. The lazy command enforces this and the eager command forces all values to be computed.</p>
<p>The list context is forced with a @() operator or list() command. That&rsquo;s not autoflattening like in Perl 5 (automatically convert a List of Lists into one List). If you still want that, say flat(). Or say lol() to explicitly prevent autoflattening.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@primes</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">11</span><span class="o">,</span><span class="mi">13</span><span class="o">,</span><span class="mi">17</span><span class="o">,</span><span class="mi">19</span><span class="o">,</span><span class="mi">23</span><span class="p">);</span> <span class="c1"># an array gets filled like in Perl 5</span>
<span class="nv">@primes</span> <span class="o">=</span>  <span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">11</span><span class="o">,</span><span class="mi">13</span><span class="o">,</span><span class="mi">17</span><span class="o">,</span><span class="mi">19</span><span class="o">,</span><span class="mi">23</span> <span class="p">;</span> <span class="c1"># same thing, since unlike P5 round braces just do group</span>
<span class="nv">@primes</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">2 3 5 7 11 13 17 19 23</span><span class="p">&gt;;</span> <span class="c1"># ditto, &lt;&gt; is the new qw()</span>
<span class="nv">$primes</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">11</span><span class="o">,</span><span class="mi">13</span><span class="o">,</span><span class="mi">17</span><span class="o">,</span><span class="mi">19</span><span class="o">,</span><span class="mi">23</span><span class="p">);</span> <span class="c1"># same array object just sits in $primes, $primes[0] is 2</span>
<span class="nv">$primes</span> <span class="o">=</span> <span class="nb">item</span> <span class="nv">@primes</span><span class="p">;</span>             <span class="c1"># same thing, more explicit</span>
<span class="nv">$primes</span> <span class="o">=</span> <span class="mi">2</span><span class="o">,</span><span class="p">;</span>                       <span class="c1"># just 2, first element of the Parcel</span>
<span class="nv">@primes</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>                        <span class="c1"># array with one element</span>
<span class="nv">@primes</span> <span class="o">=</span> <span class="o">[</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">11</span><span class="o">,</span><span class="mi">13</span><span class="o">,</span><span class="mi">17</span><span class="o">,</span><span class="mi">19</span><span class="o">,</span><span class="mi">23</span><span class="o">]</span><span class="p">;</span> <span class="c1"># array with one element (List of Lists - LoL)</span>
<span class="nv">@dev</span>    <span class="o">=</span> <span class="p">{&#39;</span><span class="s1">dan</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">parrot</span><span class="p">&#39;};</span>      <span class="c1"># array with one element (a Hash)</span>
<span class="nv">@data</span>   <span class="o">=</span> <span class="o">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="o">],[</span><span class="mi">6</span><span class="o">..</span><span class="mi">10</span><span class="o">],[</span><span class="mi">11</span><span class="o">..</span><span class="mi">15</span><span class="o">]</span><span class="p">;</span>  <span class="c1"># Array of Arrays (LoL)</span>
<span class="nv">@list</span>   <span class="o">=</span> <span class="n">lol</span> <span class="nv">@data</span><span class="p">;</span>                <span class="c1"># no change</span>
<span class="nv">@list</span>   <span class="o">=</span> <span class="nb">flat</span> <span class="nv">@data</span><span class="p">;</span>               <span class="c1"># returns 1..15</span>
</code></pre></div><ul>
<li>Array Slices</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@primes</span>                       <span class="c1"># all values as list</span>
<span class="nv">@primes</span><span class="o">.</span><span class="nb">values</span>                <span class="c1"># same thing</span>
<span class="nv">@primes</span><span class="o">.</span><span class="nb">keys</span>                  <span class="c1"># list of all indices</span>
<span class="p">&#34;</span><span class="nv">@primes</span><span class="o">[]</span><span class="p">&#34;</span>                   <span class="c1"># insert all values in a string, uses [] to distinguish from mail adresses</span>
<span class="nv">$prime</span> <span class="o">=</span> <span class="nv">@primes</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>          <span class="c1"># get the first prime</span>
<span class="nv">$prime</span> <span class="o">=</span> <span class="nv">@primes</span><span class="o">[*-</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>        <span class="c1"># get the last one</span>
<span class="nv">@some</span> <span class="o">=</span> <span class="nv">@primes</span><span class="o">[</span><span class="mi">2</span><span class="o">..</span><span class="mi">5</span><span class="o">]</span><span class="p">;</span>        <span class="c1"># get several</span>
<span class="nv">$cell</span> <span class="o">=</span> <span class="nv">@data</span><span class="o">[</span><span class="mi">1</span><span class="o">][</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span>          <span class="c1"># get 8, third value of second value (list)</span>
<span class="nv">$cell</span> <span class="o">=</span> <span class="nv">@data</span><span class="o">[</span><span class="mi">1</span><span class="p">;</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span>           <span class="c1"># same thing, shorten syntax</span>
<span class="nv">@numbers</span> <span class="o">=</span> <span class="nv">@data</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>          <span class="c1"># get a copy of the second subarray (6..10)</span>
<span class="nv">@copy</span> <span class="o">=</span> <span class="nv">@data</span><span class="p">;</span>                <span class="c1"># shallow copy of the array</span>
</code></pre></div><ul>
<li>Array Methods</li>
</ul>
<p>Some of the more important things you can do with lists. All the methods can also used like ops in &ldquo;elems @array;&rdquo;</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">?</span> <span class="nv">@array</span><span class="p">;</span>              <span class="c1"># boolean context, Bool::True if array has any value in it, even if it&#39;s a 0</span>
<span class="o">+</span> <span class="nv">@array</span><span class="p">;</span>              <span class="c1"># numeric context, number of elements (like in Perl 5 scalar @a)</span>
<span class="o">~</span> <span class="nv">@array</span><span class="p">;</span>              <span class="c1"># string context, you get content of all cells, stringified and joined, same as &#34;@primes[]&#34;</span>

<span class="nv">@array</span><span class="o">.</span><span class="nb">elems</span><span class="p">;</span>          <span class="c1"># same as + @array</span>
<span class="nv">@array</span><span class="o">.</span><span class="nb">end</span><span class="p">;</span>            <span class="c1"># number of the last element, equal to @array.elems-1</span>
<span class="nv">@array</span><span class="o">.</span><span class="nf">cat</span><span class="p">;</span>            <span class="c1"># same ~ @array</span>
<span class="nv">@array</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;&#39;);</span>       <span class="c1"># also same result, you can put another string as parameter that gets between all values</span>
<span class="nv">@array</span><span class="o">.</span><span class="nb">unshift</span><span class="p">;</span>        <span class="c1"># prepend one value to the array</span>
<span class="nv">@array</span><span class="o">.</span><span class="nb">shift</span><span class="p">;</span>          <span class="c1"># remove the first value and return it</span>
<span class="nv">@array</span><span class="o">.</span><span class="nb">push</span><span class="p">;</span>           <span class="c1"># add one value on the end</span>
<span class="nv">@array</span><span class="o">.</span><span class="nb">pop</span><span class="p">;</span>            <span class="c1"># remove one value from the end and return it</span>
<span class="nv">@array</span><span class="o">.</span><span class="nb">splice</span><span class="p">(</span><span class="nv">$pos</span><span class="o">,</span><span class="nv">$n</span><span class="p">);</span><span class="c1"># starting at $pos remove $n values and replace them with values that follow those two</span>
</code></pre></div><ul>
<li>parameters</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@array</span><span class="o">.</span><span class="nb">delete</span><span class="p">(</span><span class="nv">@ind</span><span class="p">);</span>   <span class="c1"># delete all cells with indices in @ind</span>
<span class="nv">@array</span><span class="o">.</span><span class="nf">exists</span><span class="p">(</span><span class="nv">@ind</span><span class="p">);</span>   <span class="c1"># Bool::True if all indices of @ind have a value (can be 0 or &#39;&#39;)</span>
<span class="nv">@array</span><span class="o">.</span><span class="nb">pick</span><span class="p">(</span><span class="o">[</span><span class="nv">$n</span><span class="o">]</span><span class="p">);</span>     <span class="c1"># return $n (default is 1) randomly selected values, without duplication</span>
<span class="nv">@array</span><span class="o">.</span><span class="nb">roll</span><span class="p">(</span><span class="o">[</span><span class="nv">$n</span><span class="o">]</span><span class="p">);</span>     <span class="c1"># return $n (default is 1) randomly selected values, duplication possible (like roll dice)</span>
<span class="nv">@array</span><span class="o">.</span><span class="nb">reverse</span><span class="p">;</span>        <span class="c1"># all elements in reversed order</span>
<span class="c1"># returns a list where $n times first item is taken to last</span>
<span class="c1"># position if $n is positive, if negative the other way around</span>
<span class="nv">@array</span><span class="o">.</span><span class="nb">rotate</span><span class="p">(</span><span class="nv">$n</span><span class="p">);</span>

<span class="nv">@array</span><span class="o">.</span><span class="nb">sort</span><span class="p">(</span><span class="nv">$coderef</span><span class="p">);</span> <span class="c1"># returns a list sorted by a user-defined criteria, default is alphanumerical sorting</span>
<span class="nv">@array</span><span class="o">.</span><span class="nb">min</span><span class="p">;</span>            <span class="c1"># numerical smallest value of that array</span>
<span class="nv">@array</span><span class="o">.</span><span class="nb">max</span><span class="p">;</span>            <span class="c1"># numerical largest value of that array</span>
<span class="nv">$a</span><span class="o">,</span><span class="nv">$b</span><span class="o">=</span> <span class="nv">@array</span><span class="o">.</span><span class="nb">minmax</span><span class="p">;</span>  <span class="c1"># both at once, like in .sort,  .min, or .max, a sorting algorithm can be provided</span>

<span class="nv">@array</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="nv">$coderef</span><span class="p">);</span>  <span class="c1"># high oder map function, runs $coderef with every value as $_ and returns the list or results</span>
<span class="nv">@array</span><span class="o">.</span><span class="nb">classify</span><span class="p">(</span><span class="nv">$cr</span><span class="p">);</span>  <span class="c1"># kind of map, but creates a hash, where keys are the results of $cr and values are from @array</span>
<span class="nv">@array</span><span class="o">.</span><span class="nb">categorize</span><span class="p">(</span><span class="nv">$cr</span><span class="p">);</span><span class="c1"># kind of classify, but closure can have no (Nil) or several results, so a key can have a list of values</span>
<span class="nv">@array</span><span class="o">.</span><span class="nb">grep</span><span class="p">({</span><span class="nv">$_</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">});</span>   <span class="c1"># high order grep, returns only these elements that pass a condition ($cr returns something positive)</span>
<span class="nv">@array</span><span class="o">.</span><span class="nb">first</span><span class="p">(</span><span class="nv">$coder</span><span class="p">);</span>  <span class="c1"># kind of grep, return just the first matching value</span>
<span class="nv">@array</span><span class="o">.</span><span class="nb">zip</span><span class="p">;</span>            <span class="c1"># join arrays by picking first element left successively from here and then there</span>
<span class="n">There</span> <span class="k">is</span> <span class="nc">even</span> <span class="n">a</span> <span class="n">whole</span> <span class="k">class</span> <span class="k">of</span> <span class="nc">metaoperators</span> <span class="n">that</span> <span class="n">work</span> <span class="n">upon</span> <span class="n">lists</span><span class="o">.</span>
</code></pre></div><ul>
<li>Hash</li>
</ul>
<p>In Raku a Hash is an unordered list of Pairs. A Pair is a single key =&gt; value association and appears in many places of the language syntax. A hash allows lookup of values by key using {} or &lt;&gt; syntax.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">%dev</span> <span class="o">=</span>  <span class="p">&#39;</span><span class="s1">pugs</span><span class="p">&#39;</span><span class="o">=&gt;</span><span class="p">&#39;</span><span class="s1">audreyt</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">pct</span><span class="p">&#39;</span><span class="o">=&gt;</span><span class="p">&#39;</span><span class="s1">pm</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">STD</span><span class="p">&#34;</span><span class="o">=&gt;</span><span class="p">&#39;</span><span class="s1">larry</span><span class="p">&#39;;</span>
<span class="nv">%dev</span> <span class="o">=</span> <span class="p">:</span><span class="s">rakudo</span><span class="p">(&#39;</span><span class="s1">jnthn</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">:</span><span class="s">testsuite</span><span class="p">(&#39;</span><span class="s1">moritz</span><span class="p">&#39;);</span>            <span class="c1"># adverb (pair) syntax works as well</span>
<span class="nv">%dev</span> <span class="o">=</span> <span class="p">(&#39;</span><span class="s1">audreyt</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">pugs</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">pm</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">pct</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">larry</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">STD</span><span class="p">&#34;);</span>  <span class="c1"># lists get autoconverted in hash context</span>
<span class="nv">%compiler</span> <span class="o">=</span> <span class="s">Parrot</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="s">Rakudo</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">jnthn</span><span class="p">&#39;}</span>, <span class="s">SMOP</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="s">Mildew</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">ruoso</span><span class="p">&#39;};</span>       <span class="c1"># hash of hashes (HoH)</span>
</code></pre></div><ul>
<li>Hash Slices</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$value</span> <span class="o">=</span> <span class="nv">%dev</span><span class="p">{&#39;</span><span class="s1">key</span><span class="p">&#39;};</span>      <span class="c1"># just give me the value related to that key, like in P5</span>
<span class="nv">$value</span> <span class="o">=</span> <span class="nv">%dev</span><span class="p">&lt;</span><span class="s">pm</span><span class="p">&gt;;</span>         <span class="c1"># &lt;&gt; autoquotes like qw() in P5</span>
<span class="nv">$value</span> <span class="o">=</span> <span class="nv">%dev</span><span class="p">&lt;&lt;</span><span class="nv">$name</span><span class="p">&gt;&gt;;</span>    <span class="c1"># same thing, just with eval</span>
<span class="nv">@values</span> <span class="o">=</span> <span class="nv">%dev</span><span class="p">{&#39;</span><span class="s1">key1</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">key2</span><span class="p">&#39;};</span>
<span class="nv">@values</span> <span class="o">=</span> <span class="nv">%dev</span><span class="p">&lt;</span><span class="s">key1 key2</span><span class="p">&gt;;</span>
<span class="nv">@values</span> <span class="o">=</span> <span class="nv">%dev</span><span class="p">&lt;&lt;</span><span class="s2">key1 key2 </span><span class="nv">$key3</span><span class="p">&gt;&gt;;</span>
<span class="nv">%compiler</span><span class="p">&lt;</span><span class="s">Parrot</span><span class="p">&gt;&lt;</span><span class="s">Rakudo</span><span class="p">&gt;;</span> <span class="c1"># value in a HoH, returns &#39;jnthn&#39;</span>
<span class="nv">%compiler</span><span class="p">&lt;</span><span class="s">SMOP</span><span class="p">&gt;;</span>           <span class="c1"># returns the Pair: Mildew =&gt; &#39;ruoso&#39;</span>

<span class="nv">%dev</span>   <span class="p">{&#39;</span><span class="s1">audrey</span><span class="p">&#39;};</span>         <span class="c1"># error, spaces between varname and braces (postcircumfix operator) are no longer allowed</span>
<span class="nv">%dev</span>\  <span class="p">{&#39;</span><span class="s1">allison</span><span class="p">&#39;};</span>        <span class="c1"># works, quote the space</span>
<span class="nv">%dev</span>   <span class="o">.</span><span class="p">&lt;</span><span class="s">dukeleto</span><span class="p">&gt;;</span>        <span class="c1"># error</span>
<span class="nv">%dev</span>\ <span class="o">.</span><span class="p">{&#39;</span><span class="s1">patrick</span><span class="p">&#39;};</span>        <span class="c1"># works too, &#34;long dot style&#34;, because it&#39;s an object in truth</span>
</code></pre></div><ul>
<li>Hash Methods</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">?</span> <span class="nv">%dev</span>                     <span class="c1"># bool context, true if hash has any pairs</span>
<span class="o">+</span> <span class="nv">%dev</span>                     <span class="c1"># numeric context, returns number of pairs(keys)</span>
<span class="o">~</span> <span class="nv">%dev</span>                     <span class="c1"># string context, nicely formatted 2 column table using \t and \n</span>

<span class="nv">$table</span> <span class="o">=</span> <span class="nv">%dev</span><span class="p">;</span>             <span class="c1"># same as ~ %dev</span>
<span class="nv">%dev</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>                  <span class="c1"># stringified, but only $key and $value are separated by \t</span>
<span class="nv">@pairs</span> <span class="o">=</span> <span class="nv">%dev</span><span class="p">;</span>             <span class="c1"># list of all containing pairs</span>
<span class="nv">%dev</span><span class="o">.</span><span class="nb">pairs</span>                 <span class="c1"># same thing in all context</span>
<span class="nv">%dev</span><span class="o">.</span><span class="nb">elems</span>                 <span class="c1"># same as + %dev or + %dev.pairs</span>
<span class="nv">%dev</span><span class="o">.</span><span class="nb">keys</span>                  <span class="c1"># returns a list of all keys</span>
<span class="nv">%dev</span><span class="o">.</span><span class="nb">values</span>                <span class="c1"># list of all values</span>
<span class="nv">%dev</span><span class="o">.</span><span class="nb">kv</span>                    <span class="c1"># flat list with key1, value1, key 2 ...</span>
<span class="nv">%dev</span><span class="o">.</span><span class="nb">invert</span>                <span class="c1"># reverse all key =&gt; value relations</span>
<span class="nv">%dev</span><span class="o">.</span><span class="nb">push</span> <span class="p">(</span><span class="nv">@pairs</span><span class="p">)</span>         <span class="c1"># inserts a list of pairs, if a key is already present in %dev, both values gets added to an array</span>
</code></pre></div><ul>
<li>Callable</li>
</ul>
<p>Internally subroutines, methods and alike are variables with the sigil &amp; and stored in a fourth namespace. Unlike Perl 5, all subroutines can be overwritten or augmented with user defined routines. Of course scalars can also contain routines.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">&amp;function</span> <span class="o">=</span> <span class="k">sub</span> <span class="p">{</span> <span class="o">...</span> <span class="p">};</span>         <span class="c1"># store subroutine in callable namespace</span>
<span class="nf">function</span><span class="p">();</span>                      <span class="c1"># call/run it</span>

<span class="nv">$coderef</span> <span class="o">=</span> <span class="k">sub</span> <span class="p">{</span> <span class="o">...</span> <span class="p">};</span>          <span class="c1"># store it in a scalar</span>
<span class="nv">$coderef</span><span class="p">(</span><span class="nv">$several</span><span class="o">,</span> <span class="nv">$parameter</span><span class="p">);</span>  <span class="c1"># run that code</span>
</code></pre></div><ul>
<li>Data Types</li>
</ul>
<p>In contrast to variable types (container types) every value has a type too. These are organized internally as classes or roles and can be categorized into 3 piles: the undefined, immutable, and the mutable types.</p>
<p>You can assign one of these types to scalar, array, or hash variables, which enforces the contents to be that type.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nb">Int</span> <span class="nv">$a</span><span class="p">;</span>
<span class="k">my</span> <span class="nb">Int</span> <span class="nv">@a</span><span class="p">;</span>  <span class="c1"># array of Int</span>
</code></pre></div><ul>
<li>Pair</li>
</ul>
<p>Pairs are new and their syntax is used nearly everywhere in the language where there is an association between a name and a value.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$pair</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">jakub</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">helena</span><span class="p">&#39;;</span>  <span class="c1"># &#34;=&gt;&#34; is the pair constructor</span>
<span class="nv">$pair</span> <span class="o">=</span> <span class="p">:</span><span class="s">jakub</span><span class="p">(&#39;</span><span class="s1">helena</span><span class="p">&#39;);</span>     <span class="c1"># same in adverbial notation</span>
<span class="nv">$pair</span> <span class="o">=</span> <span class="p">:</span><span class="s">jakub</span><span class="p">&lt;</span><span class="s">helena</span><span class="p">&gt;;</span>       <span class="c1"># same using &lt;&gt;, the new qw()</span>
<span class="nv">$pair</span><span class="o">.</span><span class="nb">key</span>                     <span class="c1"># returns &#39;jakub&#39;</span>
<span class="nv">$pair</span><span class="o">.</span><span class="nb">value</span>                   <span class="c1"># returns &#39;helena&#39;</span>
<span class="nv">$pair</span><span class="o">.</span><span class="nb">isa</span><span class="p">(</span><span class="nb">Pair</span><span class="p">)</span>               <span class="c1"># Bool::True</span>
</code></pre></div><ul>
<li>Capture</li>
</ul>
<p>Captures are also a new type, which holds the parameters a routine gets. Because Perl now knows both positional and named parameters, it is a mixture of a list and array.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$cap</span> <span class="o">=</span> \<span class="p">(</span><span class="nv">@a</span><span class="o">,</span><span class="nv">$s</span><span class="o">,</span><span class="nv">%h</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">=&gt;</span><span class="mi">3</span><span class="p">);</span>    <span class="c1"># creating a capture, &#34;\&#34; was free since there are no references anymore</span>
<span class="o">|</span><span class="nv">$cap</span>                         <span class="c1"># flatten into argument list (without |, it will pass it as a single value)</span>
<span class="o">||</span><span class="nv">$cap</span>                        <span class="c1"># flatten into semicolon list (meant for variadic functions that take list of lists)</span>
</code></pre></div><p>One important difference between a capture and a compound structure of lists and hashes: While assignments with = will copy the complete content of the named variables, this is not so in the case of a capture. When I change sinthelastexample,â€†thecontentofcap changes too, because when parameters to a routine are variables, they are also interpolated in the moment the routine is called, not when it&rsquo;s defined.</p>
<ul>
<li>
<p>Assignment and Binding</p>
</li>
<li>
<p>Assignment</p>
</li>
</ul>
<p>As rightfully expected, assignments are done with the equal sign. But unlike Perl 5 you always get a copy of the right side data assigned to the left, no matter how nested the data structure was (lists of lists eg). You never get in Raku a reference with =. The only exception may be seen captures.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@original</span> <span class="o">=</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">],[</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">]</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$copy</span> <span class="o">=</span> <span class="nv">@original</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span> <span class="c1"># $copy points to [1,2]</span>
<span class="nv">@original</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">fresh stuff</span><span class="p">&#39;;</span> <span class="c1"># $copy[0] holds still 1</span>
</code></pre></div><ul>
<li>Binding</li>
</ul>
<p>Since every variable in Raku is a reference, programmers can use binding to get 2 variables that point to the same memory location.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$original</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="nv">$original</span> <span class="o">:=</span> <span class="nv">$mirror</span><span class="p">;</span>       <span class="c1"># normal binding, done on runtime</span>
<span class="nv">$original</span> <span class="o">::=</span> <span class="nv">$mirror</span><span class="p">;</span>      <span class="c1"># same thing, but done during compile time</span>
<span class="nv">$original</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">$mirror</span><span class="p">;</span>                <span class="c1"># prints 3</span>
<span class="nv">$original</span> <span class="o">=:=</span> <span class="nv">$mirror</span>       <span class="c1"># true, because they&#39;re bound together</span>
<span class="nv">$original</span> <span class="o">===</span> <span class="nv">$mirror</span>       <span class="c1"># also true, because content and type are equal</span>
</code></pre></div><ul>
<li>FP oriented</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">balanced</span><span class="p">(</span><span class="nv">$s</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">.</span><span class="nb">none</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="o">.[*-</span><span class="mi">1</span><span class="o">]</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">given</span> <span class="o">[</span>\<span class="o">+]</span> <span class="p">&#39;</span><span class="s1">\\</span><span class="p">&#39;</span> <span class="o">Â«</span><span class="ow">leg</span><span class="o">Â«</span> <span class="nv">$s</span><span class="o">.</span><span class="nb">comb</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$n</span> <span class="o">=</span> <span class="nb">prompt</span> <span class="p">&#34;</span><span class="s2">Number of bracket pairs: </span><span class="p">&#34;;</span>
<span class="k">my</span> <span class="nv">$s</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">[ ]</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">roll</span><span class="p">(</span><span class="nv">$n</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">;</span>

<span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$s</span><span class="s2"> </span><span class="p">{</span> <span class="nf">balanced</span><span class="p">(</span><span class="nv">$s</span><span class="p">)</span> <span class="o">??</span> <span class="p">&#34;</span><span class="s2">is</span><span class="p">&#34;</span> <span class="o">!!</span> <span class="p">&#34;</span><span class="s2">is not</span><span class="p">&#34;</span> <span class="p">}</span><span class="s2"> well-balanced</span><span class="p">&#34;</span>
</code></pre></div><ul>
<li>String munging</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">balanced</span><span class="p">(</span><span class="nv">$_</span> <span class="k">is</span> <span class="nb">copy</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">()</span> <span class="k">while</span> <span class="k">s</span><span class="p">:</span><span class="na">g</span><span class="p">/&#39;</span><span class="s1">[]</span><span class="p">&#39;//;</span>
    <span class="nv">$_</span> <span class="ow">eq</span> <span class="p">&#39;&#39;;</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$n</span> <span class="o">=</span> <span class="nb">prompt</span> <span class="p">&#34;</span><span class="s2">Number of bracket pairs: </span><span class="p">&#34;;</span>
<span class="k">my</span> <span class="nv">$s</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">[ ]</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">roll</span><span class="p">(</span><span class="nv">$n</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">;</span>

<span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$s</span><span class="s2"> is</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1"> not</span><span class="p">&#39;</span> <span class="ow">xx</span> <span class="nb">not</span> <span class="nf">balanced</span><span class="p">(</span><span class="nv">$s</span><span class="p">))</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2"> well-balanced</span><span class="p">&#34;;</span>
</code></pre></div><ul>
<li>Parsing with a grammar</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">grammar</span> <span class="nc">BalBrack</span> <span class="p">{</span> <span class="k">token</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">[</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">TOP</span><span class="p">&gt;</span><span class="o">*</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">]</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">}</span> <span class="p">}</span>

<span class="k">my</span> <span class="nv">$n</span> <span class="o">=</span> <span class="nb">prompt</span> <span class="p">&#34;</span><span class="s2">Number of bracket pairs: </span><span class="p">&#34;;</span>
<span class="k">my</span> <span class="nv">$s</span> <span class="o">=</span> <span class="p">(&#39;</span><span class="s1">[</span><span class="p">&#39;</span> <span class="ow">xx</span> <span class="nv">$n</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">]</span><span class="p">&#39;</span> <span class="ow">xx</span> <span class="nv">$n</span><span class="p">)</span><span class="o">.</span><span class="nb">pick</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$s</span><span class="s2"> </span><span class="p">{</span> <span class="n">BalBrack</span><span class="o">.</span><span class="nb">parse</span><span class="p">(</span><span class="nv">$s</span><span class="p">)</span> <span class="o">??</span> <span class="p">&#34;</span><span class="s2">is</span><span class="p">&#34;</span> <span class="o">!!</span> <span class="p">&#34;</span><span class="s2">is not</span><span class="p">&#34;</span> <span class="p">}</span><span class="s2"> well-balanced</span><span class="p">&#34;;</span>
</code></pre></div><ul>
<li>å‡¯æ’’åŠ å¯†</li>
</ul>
<p>å®ç°ä¸€ä¸ªå‡¯æ’’åŠ å¯†ï¼Œ ç¼–ç å’Œè§£ç éƒ½è¦æœ‰</p>
<p>key æ˜¯ä¸€ä¸ª 1 åˆ° 25 ä¹‹é—´çš„æ•´æ•°</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@alpha</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">A</span><span class="p">&#39;</span> <span class="o">..</span> <span class="p">&#39;</span><span class="s1">Z</span><span class="p">&#39;;</span>

<span class="k">sub</span> <span class="nf">encrypt</span> <span class="p">(</span> <span class="nv">$key</span> <span class="k">where</span> <span class="mi">1</span><span class="o">..</span><span class="mi">25</span><span class="o">,</span> <span class="nv">$plaintext</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nv">$plaintext</span><span class="o">.</span><span class="nb">trans</span><span class="p">(</span> <span class="nv">@alpha</span> <span class="ow">Z</span><span class="o">=&gt;</span> <span class="nv">@alpha</span><span class="o">.</span><span class="nb">rotate</span><span class="p">(</span><span class="nv">$key</span><span class="p">)</span> <span class="p">);</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">decrypt</span> <span class="p">(</span> <span class="nv">$key</span> <span class="k">where</span> <span class="mi">1</span><span class="o">..</span><span class="mi">25</span><span class="o">,</span> <span class="nv">$cyphertext</span> <span class="p">)</span> <span class="p">{</span>
    <span class="nv">$cyphertext</span><span class="o">.</span><span class="nb">trans</span><span class="p">(</span> <span class="nv">@alpha</span><span class="o">.</span><span class="nb">rotate</span><span class="p">(</span><span class="nv">$key</span><span class="p">)</span> <span class="ow">Z</span><span class="o">=&gt;</span> <span class="nv">@alpha</span> <span class="p">);</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$original</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">THE FIVE BOXING WIZARDS JUMP QUICKLY</span><span class="p">&#39;;</span>
<span class="k">my</span> <span class="nv">$en</span> <span class="o">=</span> <span class="nf">encrypt</span><span class="p">(</span> <span class="mi">13</span><span class="o">,</span> <span class="nv">$original</span> <span class="p">);</span>
<span class="k">my</span> <span class="nv">$de</span> <span class="o">=</span> <span class="nf">decrypt</span><span class="p">(</span> <span class="mi">13</span><span class="o">,</span> <span class="nv">$en</span> <span class="p">);</span>

<span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="nv">$original</span><span class="o">,</span> <span class="nv">$en</span><span class="o">,</span> <span class="nv">$de</span><span class="p">;</span>

<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">OK</span><span class="p">&#39;</span> <span class="k">if</span> <span class="nv">$original</span> <span class="ow">eq</span> <span class="nb">all</span><span class="p">(</span> <span class="nb">map</span> <span class="p">{</span> <span class="o">.&amp;</span><span class="nf">decrypt</span><span class="p">(</span><span class="o">.&amp;</span><span class="nf">encrypt</span><span class="p">(</span><span class="nv">$original</span><span class="p">))</span> <span class="p">}</span><span class="o">,</span> <span class="mi">1</span><span class="o">..</span><span class="mi">25</span> <span class="p">);</span>
</code></pre></div><pre><code>Output:
THE FIVE BOXING WIZARDS JUMP QUICKLY
GUR SVIR OBKVAT JVMNEQF WHZC DHVPXYL
THE FIVE BOXING WIZARDS JUMP QUICKLY
OK
</code></pre>
<ul>
<li>æ—¥æœŸæ ¼å¼åŒ–</li>
</ul>
<p>ä½¿ç”¨ &ldquo;2007-11-10&rdquo; å’Œ &ldquo;Sunday, November 10, 2007&rdquo; æ—¥æœŸæ ¼å¼æ˜¾å¼å½“å‰æ—¥æœŸ:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">use</span> <span class="nb">DateTime</span><span class="o">:</span><span class="p">:</span><span class="s">Utils</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$dt</span> <span class="o">=</span> <span class="nb">DateTime</span><span class="o">.</span><span class="nb">now</span><span class="p">;</span>

<span class="nb">say</span> <span class="nf">strftime</span><span class="p">(&#39;</span><span class="s1">%Y-%m-%d</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$dt</span><span class="p">);</span>
<span class="nb">say</span> <span class="nf">strftime</span><span class="p">(&#39;</span><span class="s1">%A, %B %d, %Y</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$dt</span><span class="p">);</span>
</code></pre></div><ul>
<li>é˜¶ä¹˜</li>
</ul>
<p>n çš„é˜¶ä¹˜å®šä¹‰ä¸º <code>n*(n-1)*(n-2)â€¦*1</code>, é›¶çš„é˜¶ä¹˜ä¸º1.</p>
<p>å®šä¹‰ä¸€ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªæ•°å­—çš„é˜¶ä¹˜ã€‚</p>
<ul>
<li>ä½¿ç”¨è‡ªå®šä¹‰åç¼€æ“ä½œç¬¦</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku">
<span class="k">sub</span> <span class="nb">postfix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">!</span><span class="p">&gt;(</span><span class="nv">$n</span> <span class="k">where</span> <span class="nv">$n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">[*]</span> <span class="mi">2</span><span class="o">..</span><span class="nv">$n</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="mi">5</span><span class="o">!</span>
</code></pre></div><ul>
<li>[*]</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@a</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="o">[</span>\<span class="o">*]</span> <span class="mi">1</span><span class="o">..*</span><span class="p">;</span>
<span class="nb">say</span> <span class="nv">@a</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span><span class="p">;</span>
</code></pre></div><p>æ ‡é‡å®¹å™¨ä¸­å­˜å‚¨çš„å¯¹è±¡ä¸ä¼šåœ¨ flattening ä¸Šä¸‹æ–‡ä¸­æ’å€¼ï¼Œå³ä½¿é‚£ä¸ªå¯¹è±¡æ˜¯å¯è¿­ä»£çš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@a</span> <span class="o">=</span> <span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">5</span><span class="p">;</span>
<span class="k">for</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="nv">@a</span> <span class="p">{</span> <span class="o">.</span><span class="nb">say</span> <span class="p">}</span> <span class="c1"># 5æ¬¡è¿­ä»£</span>
</code></pre></div><p>è¾“å‡º:</p>
<pre><code>1
2
3
4
5
</code></pre><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$s</span> <span class="o">=</span> <span class="nv">@a</span><span class="p">;</span>
<span class="k">for</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="nv">$s</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span> <span class="c1"># 3æ¬¡è¿­ä»£</span>
</code></pre></div><p>è¾“å‡º:</p>
<pre><code>1
2
3 4 5
</code></pre><p>è¿™é‡Œï¼Œ<code>$s</code> å’Œ <code>@a</code> æŒ‡å‘åŒä¸€ä¸ªæ•°ç»„å¯¹è±¡ï¼Œä½†æ˜¯æ ‡é‡å®¹å™¨çš„å‡ºç°é˜»æ­¢ <code>$s</code> è¢«å±•å¼€åˆ° for å¾ªç¯ä¸­ã€‚</p>
<p>.list å’Œ .flat æ–¹æ³•èƒ½è¢«ç”¨äºè¿˜åŸå±•å¼€è¡Œä¸ºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="nv">$s</span><span class="o">.</span><span class="nb">list</span> <span class="p">{</span> <span class="o">.</span><span class="nb">say</span> <span class="p">}</span>    <span class="c1"># 5æ¬¡éå†</span>
<span class="k">for</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="nv">@</span><span class="p">(</span><span class="nv">$s</span><span class="p">)</span>   <span class="p">{</span> <span class="o">.</span><span class="nb">say</span>  <span class="p">}</span>   <span class="c1"># 5æ¬¡éå†ï¼Œ@()ä¼šå¼ºåˆ¶ä¸ºåˆ—è¡¨ä¸Šä¸‹æ–‡</span>
</code></pre></div><p>è¾“å‡º:</p>
<pre><code>1
2
3
4
5
</code></pre><p>ç›¸åï¼Œ<code>.item</code> æ–¹æ³•å’Œ <code>$()</code> èƒ½ç”¨äºé˜²æ­¢æ’å€¼ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@b</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="nv">@a</span><span class="p">;</span>           <span class="c1"># @b æœ‰5ä¸ªå…ƒç´ </span>
<span class="k">my</span> <span class="nv">@c</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="nv">@a</span><span class="o">.</span><span class="nb">item</span><span class="p">;</span>      <span class="c1"># @c æœ‰3ä¸ªå…ƒç´ </span>
<span class="k">my</span> <span class="nv">@c</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="nv">$</span><span class="p">(</span><span class="nv">@a</span><span class="p">);</span>        <span class="c1"># åŒä¸Š</span>

<span class="nb">say</span> <span class="o">+</span><span class="nv">@c</span><span class="p">;</span> <span class="c1"># 3</span>
</code></pre></div><ul>
<li>Feed operators</li>
</ul>
<p>feed æ“ä½œç¬¦æ˜¯å®Œå…¨æ‡’æƒ°çš„ï¼Œæ„å‘³ç€åœ¨ä½¿ç”¨è€…è¦æ±‚ä»»ä½•å…ƒç´ ä¹‹å‰ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œã€‚è¿™å°±æ˜¯</p>
<pre><code class="language-rraku" data-lang="rraku">my @a &lt;== grep { ... } &lt;== map { ... } &lt;== grep { ... } &lt;== 1, 2, 3
</code></pre><p>æ˜¯å®Œå…¨æ‡’æƒ°çš„ã€‚</p>
<ul>
<li>Grammars</li>
</ul>
<p>æ–‡æ³•æ˜¯ä¸€ç§å¼ºå¤§çš„å·¥å…·, ç”¨äºæ‹†è§£æ–‡æœ¬,å¹¶é€šå¸¸è¿”å›æ•°æ®ç»“æ„
ä¾‹å¦‚, Raku æ˜¯ä½¿ç”¨ Raku é£æ ¼çš„æ–‡æ³•è§£æå’Œæ‰§è¡Œçš„.
å¯¹æ™®é€š Raku ç”¨æˆ·æ¥è¯´,ä¸€ä¸ªæ›´å®ç”¨çš„ä¾‹å­å°±æ˜¯ JSON::Simple æ¨¡å—, è¿™ä¸ªæ¨¡å—èƒ½ååºåˆ—åŒ–ä»»ä½•æœ‰æ•ˆçš„ JSON æ–‡ä»¶, ååºåˆ—åŒ–ä»£ç è¿˜å†™äº†ä¸åˆ° 100 è¡Œ, ç®€å•,å¯æ‰©å±•.</p>
<p>è¯æ³•å…è®¸ä½ ç»„ç»‡æ­£åˆ™, å°±åƒç±»å…è®¸ä½ ç»„ç»‡æ™®é€šä»£ç çš„æ–¹æ³•ä¸€æ ·.</p>
<h2 id="å‘½åæ­£åˆ™">å‘½åæ­£åˆ™</h2>
<p>å‘½åæ­£åˆ™æœ‰ç‰¹æ®Šçš„è¯­æ³•, ä¸<strong>å­ä¾‹ç¨‹</strong>çš„å®šä¹‰ç±»ä¼¼:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="k">regex</span> <span class="nf">number</span> <span class="p">{</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="sr"> </span><span class="p">[</span><span class="sr"> \</span><span class="ni">.</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="sr"> </span><span class="p">]</span><span class="o">?</span><span class="sr"> }
</span></code></pre></div><p>è¿™ä¸ªä¾‹å­ä¸­, æˆ‘ä»¬å¿…é¡»ä½¿ç”¨ <strong>my</strong> å…³é”®è¯æŒ‡å®šè¿™ä¸ªæ­£åˆ™æ˜¯è¯æ³•ä½œç”¨åŸŸçš„, å› ä¸º <strong>å‘½åæ­£åˆ™</strong> é€šå¸¸ç”¨åœ¨ è¯æ³•ä¸­.
ç»™æ­£åˆ™å‘½ååæœ‰åˆ©äºåœ¨å…¶ä»–åœ°æ–¹<code>å¤ç”¨</code>æ­£åˆ™:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">32.51</span><span class="p">&#34;</span>    <span class="o">~~</span> <span class="nv">&amp;number</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">15 + 4.5</span><span class="p">&#34;</span> <span class="o">~~</span> <span class="p">/</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">number</span><span class="p">&gt;</span><span class="sr"> </span><span class="se">\s</span><span class="o">*</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\s</span><span class="o">*</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">number</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">/</span>
</code></pre></div><p>é¦–å…ˆè¯´ä¸‹, ä½¿ç”¨ <code>regex/token/rule</code> å®šä¹‰äº†ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼åæ€ä¹ˆå»è°ƒç”¨å®ƒã€‚å°±åƒè°ƒç”¨ä¸€ä¸ªå­ä¾‹ç¨‹é‚£æ ·, ä½¿ç”¨ <code>&amp;</code> ç¬¦å·:
<code>&amp;</code> åé¢è·Ÿæ­£åˆ™è¡¨è¾¾å¼çš„åå­—,  å³ <code>&amp;regex_name</code>ã€‚</p>
<p>regex ä¸æ˜¯å‘½åæ­£åˆ™ä»…æœ‰çš„æ ‡è¯†ç¬¦ &ndash; å®é™…ä¸Š, å®ƒç”¨çš„ä¸å¤š. å¤§å¤šæ•°æ—¶å€™, ç”¨çš„æœ€å¤šçš„æ˜¯ <code>token</code> å’Œ <code>rule</code> æ ‡è¯†ç¬¦. å®ƒä»¬éƒ½æ˜¯<code>ä¸èƒ½å›æº¯</code>çš„, è¿™æ„å‘³ç€æ­£åˆ™å¼•æ“åœ¨åŒ¹é…å¤±è´¥æ—¶ä¸ä¼šå¤‡ä»½å’Œé‡è¯•. è¿™é€šå¸¸æ˜¯ä½ æƒ³è¦çš„, ä½†ä¸æ˜¯å¯¹æ‰€æœ‰åœºåˆéƒ½åˆé€‚:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="k">regex</span> <span class="nf">works-but-slow</span> <span class="p">{</span><span class="sr"> </span><span class="ni">.</span><span class="o">+</span><span class="sr"> q </span><span class="p">}</span>
<span class="k">my</span> <span class="k">token</span> <span class="nf">fails-but-fast</span> <span class="p">{</span><span class="sr"> </span><span class="ni">.</span><span class="o">+</span><span class="sr"> q </span><span class="p">}</span>

<span class="c1"># Tokens ä¸ä¼šæ²¿åŸè·¯è¿”å›, è¿™è®©å®ƒä»¬æ›´å¿«åœ°å¤±è´¥!</span>
<span class="k">my</span> <span class="nv">$s</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">Tokens won\&#39;t backtrack, which makes them fail quicker!</span><span class="p">&#39;;</span>

<span class="nb">say</span> <span class="nb">so</span> <span class="nv">$s</span> <span class="o">~~</span> <span class="nv">&amp;works-but-slow</span><span class="p">;</span> <span class="c1"># True</span>
<span class="nb">say</span> <span class="nb">so</span> <span class="nv">$s</span> <span class="o">~~</span> <span class="nv">&amp;fails-but-fast</span><span class="p">;</span> <span class="c1"># False, the entire string get taken by the .+</span>
</code></pre></div><p><code>token</code> å’Œ <code>rule</code> æ ‡è¯†ç¬¦çš„ä¸åŒä¹‹å¤„åœ¨äº <code>rule</code> æ ‡è¯†ç¬¦è®© <code>Regex</code> çš„ <code>:sigspace</code> èµ·ä½œç”¨äº†:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="k">token</span> <span class="nf">non-space-y</span> <span class="p">{</span><span class="sr"> once upon a time </span><span class="p">}</span>
<span class="k">my</span> <span class="k">rule</span> <span class="nf">space-y</span>      <span class="p">{</span><span class="sr"> once upon a time </span><span class="p">}</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">onceuponatime</span><span class="p">&#39;</span>    <span class="o">~~</span> <span class="nv">&amp;non-space-y</span><span class="p">;</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">once upon a time</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="nv">&amp;space-y</span><span class="p">;</span>
</code></pre></div><h2 id="action-classes">Action Classes</h2>
<p>å®é™…ä¸Š, å‘½åæ­£åˆ™ç”šè‡³èƒ½æ¥å—é¢å¤–çš„å‚æ•°, å®ƒä½¿ç”¨çš„è¯­æ³•è·Ÿå­ä¾‹ç¨‹å‚æ•°åˆ—è¡¨çš„è¯­æ³•ä¸€æ ·.</p>
<p>â€‹å†™ä¸€ä¸ªç¨‹åºæ‰“å°ä» 1  åˆ° 100 çš„æ•´æ•°ï¼Œä½†æ˜¯å¯¹ 3 çš„å€æ•°æ‰“å° &ldquo;Fizz&rdquo;, å¯¹ 5 çš„å€æ•°æ‰“å° &ldquo;Buzz&rdquo;, å¯¹äºå³æ˜¯ 3 çš„å€æ•°ï¼Œåˆæ˜¯ 5 çš„å€æ•°çš„æ‰“å° &ldquo;FizzBuzz&rdquo;.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="mi">1</span> <span class="o">..</span> <span class="mi">100</span> <span class="p">{</span>
    <span class="k">when</span> <span class="nv">$_</span> <span class="nv">%%</span> <span class="p">(</span><span class="mi">3</span> <span class="o">&amp;</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">FizzBuzz</span><span class="p">&#39;;</span> <span class="p">}</span>
    <span class="k">when</span> <span class="nv">$_</span> <span class="nv">%%</span> <span class="mi">3</span>       <span class="p">{</span> <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">Fizz</span><span class="p">&#39;;</span>     <span class="p">}</span>
    <span class="k">when</span> <span class="nv">$_</span> <span class="nv">%%</span> <span class="mi">5</span>       <span class="p">{</span> <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">Buzz</span><span class="p">&#39;;</span>     <span class="p">}</span>
    <span class="k">default</span>            <span class="p">{</span> <span class="o">.</span><span class="nb">say</span><span class="p">;</span>           <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>Or abusing multi subs:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="k">sub</span> <span class="nf">fizzbuzz</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$</span> <span class="k">where</span> <span class="o">*</span> <span class="nv">%%</span> <span class="mi">15</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#39;</span><span class="s1">FizzBuzz</span><span class="p">&#39;</span> <span class="p">}</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nf">fizzbuzz</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$</span> <span class="k">where</span> <span class="o">*</span> <span class="nv">%%</span> <span class="mi">5</span><span class="p">)</span>  <span class="p">{</span> <span class="p">&#39;</span><span class="s1">Buzz</span><span class="p">&#39;</span>     <span class="p">}</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nf">fizzbuzz</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$</span> <span class="k">where</span> <span class="o">*</span> <span class="nv">%%</span> <span class="mi">3</span><span class="p">)</span>  <span class="p">{</span> <span class="p">&#39;</span><span class="s1">Fizz</span><span class="p">&#39;</span>     <span class="p">}</span>
<span class="k">multi</span> <span class="k">sub</span> <span class="nf">fizzbuzz</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$number</span> <span class="p">)</span>        <span class="p">{</span> <span class="nv">$number</span>    <span class="p">}</span>
<span class="p">(</span><span class="mi">1</span> <span class="o">..</span> <span class="mi">100</span><span class="p">)</span><span class="o">Â».</span><span class="nv">&amp;fizzbuzz</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#34;</span><span class="s2">\n</span><span class="p">&#34;)</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>
</code></pre></div><p>Most concisely:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#39;</span><span class="s1">Fizz</span><span class="p">&#39;</span> <span class="nb">x</span> <span class="nv">$_</span> <span class="nv">%%</span> <span class="mi">3</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">Buzz</span><span class="p">&#39;</span> <span class="nb">x</span> <span class="nv">$_</span> <span class="nv">%%</span> <span class="mi">5</span> <span class="o">||</span> <span class="nv">$_</span> <span class="k">for</span> <span class="mi">1</span> <span class="o">..</span> <span class="mi">100</span><span class="p">;</span>
</code></pre></div><p>And here&rsquo;s an implementation that never checks for divisibility:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">.</span><span class="nb">say</span> <span class="k">for</span>
    <span class="p">((&#39;&#39;</span> <span class="ow">xx</span> <span class="mi">2</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Fizz</span><span class="p">&#39;)</span> <span class="ow">xx</span> <span class="o">*</span> <span class="ow">Z</span><span class="o">~</span>
    <span class="p">(&#39;&#39;</span> <span class="ow">xx</span> <span class="mi">4</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Buzz</span><span class="p">&#39;)</span> <span class="ow">xx</span> <span class="o">*</span><span class="p">)</span> <span class="ow">Z</span><span class="o">||</span><span class="err">1</span> <span class="o">..</span> <span class="mi">100</span><span class="p">;</span>
</code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku åœ£è¯æœˆå† 2012]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-04-15-raku-calendar-2012/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2014-12-19-raku-calendar/?utm_source=atom_feed" rel="related" type="text/html" title="Raku åœ£è¯æœˆå† - 2014" />
            
                <id>https://ohmyweekly.github.io/notes/2015-04-15-raku-calendar-2012/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-10T00:00:00+08:00</published>
            <updated>2021-07-10T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Raku Calendar 2012</blockquote><h2 id="ä¸€ä¸ªæ—¥å†">ä¸€ä¸ªæ—¥å†</h2>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#!/usr/bin/env raku</span>

<span class="k">constant</span> <span class="nv">@months</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">January February March April May June July August September October November December</span><span class="p">&gt;;</span>
<span class="k">constant</span> <span class="nv">@days</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">Su Mo Tu We Th Fr Sa</span><span class="p">&gt;;</span>

<span class="k">sub</span> <span class="nf">center</span><span class="p">(</span><span class="nb">Str</span> <span class="nv">$text</span><span class="o">,</span> <span class="nb">Int</span> <span class="nv">$width</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$prefix</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1"> </span><span class="p">&#39;</span> <span class="nb">x</span> <span class="p">(</span><span class="nv">$width</span> <span class="o">-</span> <span class="nv">$text</span><span class="o">.</span><span class="nb">chars</span><span class="p">)</span> <span class="ow">div</span> <span class="mi">2</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$suffix</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1"> </span><span class="p">&#39;</span> <span class="nb">x</span> <span class="nv">$width</span> <span class="o">-</span> <span class="nv">$text</span><span class="o">.</span><span class="nb">chars</span> <span class="o">-</span> <span class="nv">$prefix</span><span class="o">.</span><span class="nb">chars</span><span class="p">;</span>
    <span class="k">return</span> <span class="nv">$prefix</span> <span class="o">~</span> <span class="nv">$text</span> <span class="o">~</span> <span class="nv">$suffix</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nb">MAIN</span><span class="p">(</span><span class="o">:</span><span class="nv">$year</span> <span class="o">=</span> <span class="nb">Date</span><span class="o">.</span><span class="nb">today</span><span class="o">.</span><span class="nb">year</span><span class="o">,</span> <span class="o">:</span><span class="nv">$month</span> <span class="o">=</span> <span class="nb">Date</span><span class="o">.</span><span class="nb">today</span><span class="o">.</span><span class="nb">month</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$dt</span> <span class="o">=</span> <span class="nb">Date</span><span class="o">.</span><span class="nb">new</span><span class="p">(:</span><span class="s">year</span><span class="p">(</span><span class="nv">$year</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">month</span><span class="p">(</span><span class="nv">$month</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">day</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">);</span>
    <span class="k">my</span> <span class="nv">$ss</span> <span class="o">=</span> <span class="nv">$dt</span><span class="o">.</span><span class="nb">day-of-week</span> <span class="nv">%</span> <span class="mi">7</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">@slots</span> <span class="o">=</span> <span class="p">&#39;&#39;</span><span class="o">.</span><span class="nb">fmt</span><span class="p">(&#34;</span><span class="nv">%2s</span><span class="p">&#34;)</span> <span class="ow">xx</span> <span class="nv">$ss</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$days-in-month</span> <span class="o">=</span> <span class="nv">$dt</span><span class="o">.</span><span class="nb">days-in-month</span><span class="p">;</span>

    <span class="k">for</span> <span class="nv">$ss</span> <span class="o">..^</span> <span class="nv">$ss</span> <span class="o">+</span> <span class="nv">$days-in-month</span> <span class="p">{</span>
        <span class="nv">@slots</span><span class="o">[</span><span class="nv">$_</span><span class="o">]</span> <span class="o">=</span> <span class="nv">$dt</span><span class="o">.</span><span class="nb">day</span><span class="o">.</span><span class="nb">fmt</span><span class="p">(&#34;</span><span class="nv">%2d</span><span class="p">&#34;);</span>
        <span class="nv">$dt</span><span class="o">++</span>
    <span class="p">}</span>

    <span class="k">my</span> <span class="nv">$weekdays</span> <span class="o">=</span> <span class="nv">@days</span><span class="o">.</span><span class="nb">fmt</span><span class="p">(&#34;</span><span class="nv">%2s</span><span class="p">&#34;)</span><span class="o">.</span><span class="nb">join</span><span class="o">:</span> <span class="p">&#34;</span><span class="s2"> </span><span class="p">&#34;;</span>
    <span class="nb">say</span> <span class="nf">center</span><span class="p">(</span><span class="nv">@months</span><span class="o">[</span><span class="nv">$month-1</span><span class="o">]</span> <span class="o">~</span> <span class="p">&#34;</span><span class="s2"> </span><span class="p">&#34;</span> <span class="o">~</span> <span class="nv">$year</span><span class="o">,</span> <span class="nv">$weekdays</span><span class="o">.</span><span class="nb">chars</span><span class="p">);</span>
    <span class="nb">say</span> <span class="nv">$weekdays</span><span class="p">;</span>

    <span class="k">for</span> <span class="nv">@slots</span><span class="o">.</span><span class="nb">kv</span> <span class="k">-&gt;</span> <span class="nv">$k</span><span class="o">,</span> <span class="nv">$v</span> <span class="p">{</span>
        <span class="nb">print</span> <span class="p">&#34;</span><span class="nv">$v</span><span class="s2"> </span><span class="p">&#34;;</span>
        <span class="nb">print</span> <span class="p">&#34;</span><span class="s2">\n</span><span class="p">&#34;</span> <span class="k">if</span> <span class="p">(</span><span class="nv">$k</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="nv">%%</span> <span class="mi">7</span> <span class="ow">or</span> <span class="nv">$v</span> <span class="o">==</span> <span class="nv">$days-in-month</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h2 id="bags-and-sets">Bags and Sets</h2>
<p>è¿‡å»å‡ å¹´, æˆ‘å†™äº†å¾ˆå¤šè¿™ç§ä»£ç çš„å˜ç§ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%words</span><span class="p">;</span>
<span class="k">for</span> <span class="nb">slurp</span><span class="o">.</span><span class="nb">comb</span><span class="p">(/</span><span class="se">\w</span><span class="o">+</span><span class="p">/)</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="o">*.</span><span class="nb">lc</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nv">$word</span> <span class="p">{</span>
    <span class="nv">%words</span><span class="p">{</span><span class="nv">$word</span><span class="p">}</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>(æ­¤å¤–: <code>slurp.comb(/\w+/).map(*.lc)</code> ä»æŒ‡å®šçš„æ ‡å‡†è¾“å…¥æˆ–å‘½ä»¤è¡Œè¯»å–æ–‡ä»¶, éå†æ•°æ®ä¸­çš„å•è¯, ç„¶åå°å†™åŒ–è¯¥å•è¯ã€‚ eg: raku slurp.pl score.txt)</p>
<p>Raku å¼•å…¥äº†ä¸¤ç§æ–°çš„ç»„åˆç±»å‹æ¥å®ç°è¿™ç§åŠŸèƒ½ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹, åŠè·¯æ€å‡ºä¸ª KeyBag ä»£æ›¿äº† hash:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%words</span> <span class="o">:=</span> <span class="n">KeyBag</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>
<span class="k">for</span> <span class="nb">slurp</span><span class="o">.</span><span class="nb">comb</span><span class="p">(/</span><span class="se">\w</span><span class="o">+</span><span class="p">/)</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="o">*.</span><span class="nb">lc</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nv">$word</span> <span class="p">{</span>
    <span class="nv">%words</span><span class="p">{</span><span class="nv">$word</span><span class="p">}</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>è¿™ç§æƒ…å†µä¸‹, ä¸ºä»€ä¹ˆä½ ä¼šå–œæ¬¢ KeyBag å¤šäºæ•£åˆ—å‘¢, éš¾é“æ˜¯å‰è€…ä»£ç æ›´å¤šå—ï¼Ÿå¾ˆå¥½, å¦‚æœä½ æƒ³è¦çš„æ˜¯ä¸€ä¸ªæ­£æ•´æ•°å€¼çš„æ•£åˆ—çš„è¯, KeyBag å°†æ›´å¥½åœ°è¡¨è¾¾å‡ºä½ çš„æ„æ€ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">%words</span><span class="p">{&#34;</span><span class="s2">the</span><span class="p">&#34;}</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">green</span><span class="p">&#34;;</span>
</code></pre></div><p>æœªå¤„ç†è¿‡çš„å¼‚å¸¸ï¼šä¸èƒ½è§£ææ•°å­—ï¼šgreen</p>
<p>ç„¶è€Œ KeyBag æœ‰å‡ æ¡é”¦å›Šå¦™è®¡ã€‚é¦–å…ˆ, å››è¡Œä»£ç åˆå§‹åŒ–ä½ çš„ KeyBag ä¸æ˜¯å¾ˆç½—å—¦, ä½†æ˜¯ Raku èƒ½è®©å®ƒå…¨éƒ¨å†™åœ¨ä¸€è¡Œä¹Ÿä¸ä¼šæœ‰é—®é¢˜ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%words</span> <span class="o">:=</span> <span class="n">KeyBag</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="nb">slurp</span><span class="o">.</span><span class="nb">comb</span><span class="p">(/</span><span class="se">\w</span><span class="o">+</span><span class="p">/)</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="o">*.</span><span class="nb">lc</span><span class="p">));</span>
</code></pre></div><p>KeyBag.new å°½åŠ›æŠŠæ”¾åˆ°å®ƒé‡Œé¢çš„ä¸œè¥¿å˜æˆ KeyBag çš„å†…å®¹ã€‚ç»™å‡ºä¸€ä¸ªåˆ—è¡¨, åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½ä¼šè¢«æ·»åŠ åˆ° KeyBag ä¸­, ç»“æœå’Œä¹‹å‰çš„ä»£ç å—æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚</p>
<p>å¦‚æœä½ ä¸éœ€è¦åœ¨åˆ›å»ºbagåå»ä¿®æ”¹å®ƒ, ä½ å¯ä»¥ä½¿ç”¨ Bag æ¥ä»£æ›¿ KeyBagã€‚ä¸åŒä¹‹å¤„æ˜¯ Bag æ˜¯ä¸ä¼šæ”¹å˜çš„ï¼›å¦‚æœ %words æ˜¯ä¸€ä¸ª Bag, åˆ™ %words{$word}++ æ˜¯éæ³•çš„ã€‚å¦‚æœå¯¹ä½ çš„ç¨‹åºæ¥è¯´, ä¸å˜æ²¡æœ‰é—®é¢˜çš„è¯, é‚£ä½ å¯ä»¥è®©ä»£ç æ›´ç´§å‡‘ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%words</span> <span class="o">:=</span> <span class="nb">bag</span> <span class="nb">slurp</span><span class="o">.</span><span class="nb">comb</span><span class="p">(/</span><span class="se">\w</span><span class="o">+</span><span class="p">/)</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="o">*.</span><span class="nb">lc</span><span class="p">);</span>  <span class="c1"># æ•£åˆ— %words ä¸ä¼šå†å˜åŒ–</span>
</code></pre></div><p>bag æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å­ä¾‹ç¨‹, å®ƒåªæ˜¯å¯¹ä»»ä½•ä½ ç»™å®ƒçš„ä¸œè¥¿ä¸Šè°ƒç”¨ Bag.new æ–¹æ³•ã€‚ï¼ˆæˆ‘ä¸æ¸…æ¥šä¸ºä»€ä¹ˆæ²¡æœ‰åŒæ ·åŠŸèƒ½çš„ keybag å­ä¾‹ç¨‹ï¼‰</p>
<p>Bag å’Œ KeyBag æœ‰å‡ ä¸ªé›•è™«å°æŠ€ã€‚å®ƒä»¬éƒ½æœ‰å®ƒä»¬è‡ªå·±çš„ .roll å’Œ .pick æ–¹æ³•, ä»¥æ ¹æ®ç»™å®šçš„å€¼æ¥æƒè¡¡å®ƒä»¬çš„ç»“æœï¼š</p>
<pre><code>&gt; my $bag = bag &quot;red&quot; =&gt; 2, &quot;blue&quot; =&gt; 10;
&gt; say $bag.roll(10);
&gt; say $bag.pick(*).join(&quot; &quot;);

blue blue blue blue blue blue red blue red blue
blue red blue blue red blue blue blue blue blue blue blue
This wouldnâ€™t be too hard to emulate using a normal Array, but this version would be:
&gt; $bag = bag &quot;red&quot; =&gt; 20000000000000000001, &quot;blue&quot; =&gt; 100000000000000000000;
&gt; say $bag.roll(10);
&gt; say $bag.pick(10).join(&quot; &quot;);
blue blue blue blue red blue red blue blue blue
blue blue blue red blue blue blue red blue blue
</code></pre><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">MAIN</span><span class="p">(</span><span class="nv">$file1</span><span class="o">,</span> <span class="nv">$file2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$words1</span> <span class="o">=</span> <span class="nb">bag</span> <span class="nb">slurp</span><span class="p">(</span><span class="nv">$file1</span><span class="p">)</span><span class="o">.</span><span class="nb">comb</span><span class="p">(/</span><span class="se">\w</span><span class="o">+</span><span class="p">/)</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="o">*.</span><span class="nb">lc</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$words2</span> <span class="o">=</span> <span class="nb">set</span> <span class="nb">slurp</span><span class="p">(</span><span class="nv">$file2</span><span class="p">)</span><span class="o">.</span><span class="nb">comb</span><span class="p">(/</span><span class="se">\w</span><span class="o">+</span><span class="p">/)</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="o">*.</span><span class="nb">lc</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$unique</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$words1</span> <span class="ow">(-)</span> <span class="nv">$words2</span><span class="p">);</span>

    <span class="k">for</span> <span class="nv">$unique</span><span class="o">.</span><span class="nb">list</span><span class="o">.</span><span class="nb">sort</span><span class="p">({</span> <span class="o">-</span><span class="nv">$words1</span><span class="p">{</span><span class="nv">$_</span><span class="p">}</span> <span class="p">})</span><span class="o">[^</span><span class="mi">10</span><span class="o">]</span> <span class="k">-&gt;</span> <span class="nv">$word</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$word:</span><span class="s2"> </span><span class="p">{</span> <span class="nv">$words1</span><span class="p">{</span><span class="nv">$word</span><span class="p">}</span><span class="s2"> }</span><span class="p">&#34;;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>ä¼ é€’ä¸¤ä¸ªæ–‡ä»¶å, è¿™ä½¿å¾— Bag ä»ç¬¬ä¸€ä¸ªæ–‡ä»¶ä¸­è·å–å•è¯, è®© Set ä»ç¬¬äºŒä¸ªæ–‡ä»¶ä¸­è·å–å•è¯, ç„¶åä½¿ç”¨ é›†åˆå·® æ“ä½œç¬¦ <code>(-)</code> æ¥è®¡ç®—åªåœ¨ç¬¬ä¸€ä¸ªæ–‡ä»¶ä¸­å«æœ‰çš„å•è¯, æŒ‰é‚£äº›å•è¯å‡ºç°çš„é¢‘ç‡æ’åº, ç„¶åæ‰“å°å‡ºå‰10 ä¸ªå•è¯ã€‚</p>
<p>è¿™æ˜¯ä»‹ç» Set çš„æœ€å¥½æ—¶æœºã€‚å°±åƒä½ ä»ä¸Šé¢çŒœåˆ°çš„ä¸€æ ·, Set è·Ÿ Bag çš„ä½œç”¨å¾ˆåƒã€‚ä¸åŒçš„åœ°æ–¹åœ¨äº, å®ƒä»¬éƒ½æ˜¯æ•£åˆ—, è€Œ Bag æ˜¯ä»Anyåˆ°æ­£æ•´æ•°çš„æ˜ å°„, Set æ˜¯ä» Any åˆ° Bool::True çš„æ˜ å°„ã€‚é›†åˆ Set æ˜¯ä¸å¯æ”¹å˜çš„, æ‰€ä»¥ä¹Ÿæœ‰ä¸€ä¸ª å¯å˜çš„ KeySetã€‚</p>
<p>åœ¨ Set å’Œ Bag ä¹‹é—´, æˆ‘ä»¬æœ‰å¾ˆä¸°å¯Œçš„æ“ä½œç¬¦ï¼š</p>
<pre><code>æ“ä½œç¬¦	Unicode	â€œTexasâ€	ç»“æœç±»å‹

å±äº	âˆˆ	(elem)	Bool
ä¸å±äº	âˆ‰	!(elem)	Bool
åŒ…å«	âˆ‹	(cont)	Bool
ä¸åŒ…å«	âˆŒ	!(cont)	Bool

å¹¶é›†	âˆª	(|)	Set æˆ– Bag
äº¤é›†	âˆ©	(&amp;)	Set æˆ– Bag
å·®é›†	        (-)	Set

å­é›†	âŠ†	(&lt;=)	Bool
éå­é›†	âŠˆ	!(&lt;=)	Bool
çœŸå­é›†	âŠ‚	(&lt;)	Bool
éçœŸå­é›†	âŠ„	!(&lt;)	Bool

è¶…çº§	âŠ‡	(&gt;=)	Bool
éè¶…çº§	âŠ‰	!(&gt;=)	Bool
çœŸè¶…çº§	âŠƒ	(&gt;)	Bool
éçœŸè¶…çº§	âŠ…	!(&gt;)	Bool

bag multiplication	âŠ	(.)	Bag
bag addition	âŠ	(+)	Bag
set symmetric difference (^)	Set
</code></pre><p>å®ƒä»¬ä¸­çš„å¤§å¤šæ•°éƒ½èƒ½ä¸è¨€è‡ªæ˜ã€‚è¿”å› Set çš„æ“ä½œç¬¦åœ¨åšè¿ç®—å‰ä¼šå°†å®ƒä»¬çš„å‚æ•°æå‡ä¸º Setã€‚è¿”å› Bag çš„æ“ä½œç¬¦åœ¨åšè¿ç®—å‰ä¼šå°†å®ƒä»¬çš„å‚æ•°æå‡ä¸º Bagã€‚è¿”å› Set æˆ– Bag çš„æ“ä½œç¬¦åœ¨åšè¿ç®—å‰ä¼šå°†å®ƒä»¬çš„å‚æ•°æå‡ä¸º Bag, å¦‚æœå®ƒä»¬ä¸­è‡³å°‘æœ‰ä¸€ä¸ªæ˜¯ Bag æˆ– KeyBag, å¦åˆ™ä¼šè½¬æ¢ä¸º Setï¼›åœ¨ä»»ä½•ä¸€ç§æƒ…å†µä¸‹, å®ƒä»¬éƒ½è¿”å›æå‡åçš„ç±»å‹ã€‚</p>
<pre><code>&gt; my $a = bag &lt;a a a b b c&gt;;  # bag(a(3), b(2), c)
&gt; my $b = bag &lt;a b b b&gt;;      # bag(a, b(3))

&gt; $a (|) $b;
bag(&quot;a&quot; =&gt; 3, &quot;b&quot; =&gt; 3, &quot;c&quot; =&gt; 1)

&gt; $a (&amp;) $b;
bag(&quot;a&quot; =&gt; 1, &quot;b&quot; =&gt; 2)

&gt; $a (+) $b;
bag(&quot;a&quot; =&gt; 4, &quot;b&quot; =&gt; 5, &quot;c&quot; =&gt; 1)

&gt; $a (.) $b;
bag(&quot;a&quot; =&gt; 3, &quot;b&quot; =&gt; 6)
</code></pre><p><a href="https://github.com/colomon/raku-set-bag-demo">ä¸‹é¢æ˜¯ä½œè€…æ”¾åœ¨ githubä¸Šçš„ Demo</a></p>
<p>A quick example of getting the 10 most common words in Hamlet which are not found in Much Ado About Nothing:</p>
<pre><code>&gt; raku bin/most-common-unique.pl data/Hamlet.txt data/Much_Ado_About_Nothing.txt
</code></pre><p>ham: 358
queen: 119
hamlet: 118
hor: 111
pol: 86
laer: 62
oph: 58
ros: 53
horatio: 48
clown: 47</p>
<h2 id="è¶…æ£’çš„åŒ¿åå‡½æ•°">è¶…æ£’çš„åŒ¿åå‡½æ•°</h2>
<p>Raku å¯¹å‡½æ•°æœ‰å¾ˆå¥½çš„æ”¯æŒã€‚Raku ä»¤äººæƒŠå¹çš„æŠŠå‡½æ•°å£°æ˜åŒ…èµ·æ¥, è®©ä½ å¯ä»¥ç”¨å„ç§æ–¹æ³•æ¥å®šä¹‰ä¸€ä¸ªå‡½æ•°åˆä¸ä¸¢å¤±ä»»ä½•ç‰¹æ€§ã€‚ä½ å¯ä»¥å®šä¹‰å‚æ•°ç±»å‹ã€å¯é€‰å‚æ•°ã€å‘½åå‚æ•°, ç”šè‡³åœ¨å­å¥é‡Œä¹Ÿå¯ä»¥ã€‚å¦‚æœæˆ‘ä¸çŸ¥é“æ›´å¥½çš„ç†ç”±çš„è¯, æˆ‘å¯èƒ½éƒ½åœ¨æ€€ç–‘è¿™æ˜¯ä¸æ˜¯åœ¨è¡¥å¿ Perl5 é‡Œé‚£ä¸ªç›¸å½“åŸºæœ¬çš„å‚æ•°å¤„ç†ï¼ˆå’³å’³ , <code>@_</code>, ä½ æ‡‚çš„ï¼‰ã€‚
é™¤å¼€è¿™äº›, Raku ä¹Ÿå…è®¸ä½ å®šä¹‰æ²¡æœ‰å‘½åçš„å‡½æ•°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="p">{</span><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">lol, I&#39;m so anonymous!</span><span class="p">&#34;</span> <span class="p">}</span>
</code></pre></div><p>è¿™æœ‰ä»€ä¹ˆç”¨ï¼Ÿä½ ä¸å‘½åå®ƒ, å°±æ²¡æ³•è°ƒç”¨å®ƒå•Š, å¯¹ä¸ï¼Ÿé”™ï¼</p>
<p>ä½ å¯ä»¥ä¿å­˜è¿™ä¸ªå‡½æ•°åˆ°ä¸€ä¸ªå˜é‡é‡Œã€‚æˆ–è€…ä»å¦ä¸€ä¸ªå‡½æ•°é‡Œ return è¿™ä¸ªå‡½æ•°ã€‚æˆ–è€…ä¼ å‚ç»™ä¸‹ä¸€ä¸ªå‡½æ•°ã€‚äº‹å®ä¸Š, å½“ä½ ä¸å‘½åä½ çš„å‡½æ•°çš„æ—¶å€™, ä½ éšåè¦è¿è¡Œä»€ä¹ˆä»£ç å°±å˜å¾—éå¸¸æ¸…æ™°äº†ã€‚å°±åƒä¸€ä¸ªå¯æ‰§è¡Œçš„ &ldquo;todo&rdquo; åˆ—è¡¨ä¸€æ ·ã€‚</p>
<p>ç°åœ¨è®©æˆ‘ä»¬è¯´è¯´åŒ¿åå‡½æ•°å¯ä»¥ç»™æˆ‘ä»¬åšç‚¹ä»€ä¹ˆã€‚åœ¨ Raku é‡Œå®ƒçœ‹èµ·æ¥ä¼šæ˜¯ä»€ä¹ˆæ ·å­å‘¢ï¼Ÿ</p>
<p>å—¯, å°±ç”¨æœ€è‘—åçš„æ’åºæ¥åšä¾‹å­å§ã€‚ä½ å¯èƒ½æƒ³è±¡ Raku æœ‰ä¸€ä¸ª sort_lexicographically å‡½æ•°å’Œä¸€ä¸ª sort_numberically å‡½æ•°ã€‚ä¸è¿‡å…¶å®æ²¡æœ‰ã€‚åªæœ‰ä¸€ä¸ª sort å‡½æ•°ã€‚å½“ä½ éœ€è¦å…·ä½“ç”¨æŸç§å½¢å¼çš„æ’åºæ—¶, ä½ å°±å¯ä»¥ä¼ é€’ä¸€ä¸ªåŒ¿åå‡½æ•°ç»™ sort ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@sorted_words</span>   <span class="o">=</span> <span class="nv">@words</span><span class="o">.</span><span class="nb">sort</span><span class="p">({</span> <span class="o">~</span><span class="nv">$_</span> <span class="p">});</span>
<span class="k">my</span> <span class="nv">@sorted_numbers</span> <span class="o">=</span> <span class="nv">@numbers</span><span class="o">.</span><span class="nb">sort</span><span class="p">({</span> <span class="o">+</span><span class="nv">$_</span> <span class="p">});</span>
</code></pre></div><p>ï¼ˆä»æŠ€æœ¯ä¸Šæ¥è¯´, è¿™æ˜¯å—, ä¸æ˜¯å‡½æ•°ã€‚ä¸è¿‡å¦‚æœä½ ä¸æ‰“ç®—åœ¨é‡Œé¢ä½¿ç”¨ return çš„è¯, å·®å¼‚ä¸å¤§ã€‚ï¼‰
å½“ç„¶ä½ å¯ä»¥åšçš„æ¯”è¿™ä¸¤ä¸ªæ’åºåŠæ³•å¤šå¤šäº†ã€‚ä½ å¯ä»¥é€šè¿‡é‹å­å¤§å°æ’åº, æˆ–è€…æœ€å¤§åœ°é¢é€Ÿåº¦, æˆ–è€…è‡ªç‡ƒå¯èƒ½æ€§çš„é™åºç­‰ç­‰ã€‚å› ä¸ºä½ å¯ä»¥æŠŠä»»ä½•é€»è¾‘ä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ é€’è¿›å»ã€‚é¢å‘å¯¹è±¡çš„æ•™å¾’ä»¬å¯¹è¿™ç§æ¨¡å¼å¯éå¸¸è‡ªè±ª, è¿˜ä¸“é—¨å‘½åä¸ºâ€œä¾èµ–æ³¨å…¥â€ã€‚</p>
<p>æƒ³æƒ³çœ‹, mapã€ grep å’Œ reduce éƒ½å¾ˆä¾èµ–è¿™ç§å‡½æ•°ä¼ é€’ã€‚æˆ‘ä»¬æœ‰æ—¶å€™æŠŠè¿™ç§ä¼ é€’å‡½æ•°ç»™å‡½æ•°çš„åšæ³•å«â€œé«˜é˜¶ç¼–ç¨‹â€, å¥½åƒè¿™æ˜¯æŸäº›é«˜æ‰‹çš„ç‰¹æƒä¼¼çš„ã€‚ä½†å…¶å®è¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨è€Œä¸”å¯ä»¥æ™®é€šä½¿ç”¨çš„æŠ€èƒ½ã€‚</p>
<p>ä¸Šé¢çš„ç¤ºä¾‹éƒ½æ˜¯åœ¨å½“å‰æ‰§è¡Œæ—¶å°±è¿è¡Œå‡½æ•°äº†ã€‚å…¶å®è¿™é‡Œæ²¡ä»€ä¹ˆé™åˆ¶ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºå‡½æ•°, ç„¶åç¨åå†è¿è¡Œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">make_surprise_for</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">sub</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Sur-priiise, </span><span class="nv">$name</span><span class="s2">!</span><span class="p">&#34;</span> <span class="p">};</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$reveal_surprise</span> <span class="o">=</span> <span class="nf">make_surprise_for</span><span class="p">(&#34;</span><span class="s2">Finn</span><span class="p">&#34;);</span>    <span class="c1">#</span>

<span class="c1"># ç›®å‰ä»€ä¹ˆéƒ½æ²¡å‘ç”Ÿ</span>
<span class="c1"># ç­‰ç€</span>
<span class="c1"># ç»§ç»­ç­‰ç€</span>
<span class="c1"># ç­‰å•Šç­‰å•Šç­‰å•Š</span>
<span class="nv">$reveal_surprise</span><span class="p">();</span>        <span class="c1"># &#34;Sur-priiise, Finn!&#34;</span>
</code></pre></div><p><code>$reveal_surpirse</code> é‡Œçš„å‡½æ•°è®°ä½äº† <code>$name</code> å˜é‡å€¼, è™½ç„¶åŸå§‹å‡½æ•°æ˜¯åœ¨å¾ˆæ—©ä¹‹å‰ä¼ é€’è¿›å»çš„å‚æ•°ã€‚æ£’æäº†ï¼è¿™ä¸ªæ•ˆæœå°±å«åœ¨ <code>$name</code> å˜é‡ä¸Šé—­åˆçš„åŒ¿åå‡½æ•°ã€‚ä¸è¿‡è¿™é‡Œå¯æ²¡ä»€ä¹ˆæŠ€æœ¯ - åæ­£å¾ˆæ£’å°±æ˜¯äº†ã€‚</p>
<p>äº‹å®ä¸Š, å¦‚æœæ”¾åœ¨å…¶ä»–ä¸»è¦å­˜å‚¨æœºåˆ¶æ¯”å¦‚æ•°ç»„å’Œæ•£åˆ—æ—è¾¹å†çœ‹åŒ¿åå‡½æ•°æœ¬èº«, è¿™æ„Ÿè§‰æ˜¯å¾ˆè‡ªç„¶çš„äº‹æƒ…ã€‚æ‰€æœ‰è¿™äº›éƒ½å¯ä»¥å­˜å‚¨åœ¨å˜é‡é‡Œ, ä½œä¸ºå‚æ•°ä¼ é€’æˆ–è€…ä»å‡½æ•°é‡Œè¿”å›ã€‚ä¸€ä¸ªåŒ¿åæ•°ç»„å…è®¸ä½ ä¿å­˜åºåˆ—ç»™ä»¥åè°ƒç”¨ã€‚ä¸€ä¸ªåŒ¿åæ•£åˆ—å…è®¸ä½ å­˜å‚¨æ˜ å°„ç»™ä»¥åè°ƒç”¨ã€‚ä¸€ä¸ªåŒ¿åå‡½æ•°å…è®¸ä½ å­˜å‚¨è®¡ç®—æˆ–è€…è¡Œä¸ºç»™ä»¥åè°ƒç”¨ã€‚</p>
<p>æœ¬æœˆæ™šäº›æ—¶å€™, æˆ‘ä¼šå†™ç¯‡ä»‹ç»æ€æ ·é€šè¿‡ Raku çš„åŠ¨æ€åŸŸæ¥åˆ›å»ºæ¼‚äº®çš„ DSL-y æ¥å£ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åŒ¿åå‡½æ•°åœ¨é‚£é‡Œæ˜¯æ€ä¹ˆå‘æŒ¥ä½œç”¨çš„ã€‚</p>
<h2 id="ç¬¬ä¹å¤©æœ€é•¿æ ‡ç¤ºåŒ¹é…">ç¬¬ä¹å¤©:æœ€é•¿æ ‡ç¤ºåŒ¹é…</h2>
<p>Raku æ­£åˆ™è¡¨è¾¾å¼åå¥½å°½å¯èƒ½çš„åŒ¹é…æœ€é•¿çš„é€‰æ‹©ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">food and drink</span><span class="p">&#34;</span> <span class="o">~~</span> <span class="p">/</span><span class="sr"> foo </span><span class="o">|</span><span class="sr"> food </span><span class="p">/;</span>   <span class="c1"># food</span>
</code></pre></div><p>è¿™è·Ÿ Perl5 ä¸ä¸€æ ·ã€‚Perl5 æ›´å–œæ¬¢ä¸Šé¢ä¾‹å­ä¸­çš„ç¬¬ä¸€ä¸ªé€‰æ‹©, ç»“æœåŒ¹é…çš„æ˜¯ &ldquo;foo&rdquo;ã€‚
å¦‚æœä½ å¸Œæœ›çš„è¯, ä½ ä¾ç„¶å¯ä»¥æŒ‰ç…§ä¼˜å…ˆåŒ¹é…çš„åŸåˆ™è¿è¡Œ, è¿™ä¸ªåŸåˆ™éšè—åœ¨ç¨é•¿é€‰æ‹©æ“ä½œç¬¦ <code>||</code> èƒŒåï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">food and drink</span><span class="p">&#34;</span> <span class="o">~~</span> <span class="p">/</span><span class="sr"> foo </span><span class="o">||</span><span class="sr"> food </span><span class="p">/;</span>  <span class="c1"># foo</span>
</code></pre></div><p>&hellip;å°±æ˜¯è¿™æ ·ã€‚è¿™å°±æ˜¯æœ€é•¿æ ‡è®°åŒ¹é…ã€‚ â˜º çŸ­æ–‡å®Œæ¯•ã€‚</p>
<p>â€œå–‚, ç­‰ç­‰ï¼â€ä½ å¬è§ä½ ç»æœ›è€ŒæƒŠè®¶çš„å¤§å«äº†, æ»¡è¶³ä½ å¸Œæœ›è®©æ¯å¤©çš„ Raku åœ£ä¸´å†èµ°çš„æ…¢ä¸€ç‚¹çš„æ„¿æœ›ã€‚â€œä¸ºä»€ä¹ˆè¯´æœ€é•¿æ ‡è®°åŒ¹é…å¾ˆé‡è¦ï¼Ÿè°ä¼šåœ¨æ„è¿™ä¸ªï¼Ÿâ€</p>
<p>æˆ‘å¾ˆé«˜å…´ä½ è¿™æ ·é—®ã€‚äº‹å®è¯æ˜, æœ€é•¿æ ‡è®°åŒ¹é…ï¼ˆç®€ç§° LTM ï¼‰åœ¨å¦‚ä½•è§£æçš„æ—¶å€™å’Œæˆ‘ä»¬çš„ç›´è§‰é…åˆç›¸å½“é»˜å¥‘ã€‚å¦‚æœä½ åˆ›é€ äº†ä¸€é—¨è¯­è¨€, ä½ å¸Œæœ›äººä»¬å¯ä»¥å£°æ˜ä¸€ä¸ªå« forest_density çš„å˜é‡è€Œä¸ç”¨æåŠè¿™ä¸ªå•è¯å’Œå¾ªç¯é‡Œç”¨çš„ for è¯­æ³•å†²çª, LTM å¯ä»¥åšåˆ°ã€‚</p>
<p>æˆ‘å–œæ¬¢â€œå¥‡æ€ªçš„ä¸€è‡´æ€§â€è¿™ä¸ªè¯´æ³• - å°¤å…¶å½“ç¨‹åºè¯­è¨€è®¾è®¡çš„å…±æ€§è®©å¤§å®¶è¶Šæ¥è¶Šé›·åŒçš„æ—¶å€™ã€‚è¿™é‡Œå°±æ˜¯ä¸€ç§åœ¨ç±»å’Œè¯­æ³•ä¹‹é—´çš„ä¸€è‡´æ€§ã€‚ Raku åŸºæœ¬ä¸ŠæŠŠè¿™ç§ä¸€è‡´æ€§å‘æŒ¥åˆ°äº†æè‡´ã€‚è®©æˆ‘ç®€å•çš„é˜è¿°ä¸‹æˆ‘çš„æ„æ€ã€‚
ç°åœ¨æˆ‘ä»¬ä¹ æƒ¯äºå†™ä¸€ä¸ªç±», æ€»ä½“æ¥çœ‹, ç±»å·®ä¸å¤šæ˜¯é•¿è¿™ä¸ªæ ·å­çš„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="p">{</span>
    <span class="k">method</span>
    <span class="k">method</span>
    <span class="k">method</span>
<span class="p">}</span>
</code></pre></div><p>å¥‡æ€ªçš„æ˜¯, è¯­æ³•æœ‰ä¸ªéå¸¸ç±»ä¼¼çš„ç»“æ„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">grammar</span> <span class="p">{</span>
    <span class="k">rule</span>
    <span class="nf">rule</span>
    rule
}
</code></pre></div><p>(å®é™…ä¸Šå…³é”®è¯æœ‰ regex, token å’Œ rule, ä¸è¿‡å½“æˆ‘ä»¬æŠŠä»–å½“ä½œä¸€ä¸ªç»„æ¥è®¨è®ºçš„æ—¶å€™, æˆ‘ä»¬æš‚æ—¶ç»Ÿä¸€å«åš rules)</p>
<p>æˆ‘ä»¬åŒæ ·ä¹ æƒ¯äºæ´¾ç”Ÿå­ç±»ï¼ˆclass B is Aï¼‰, ç„¶åæ·»åŠ æˆ–è€…é‡å†™æ–¹æ³•æ¥äº§ç”Ÿä¸€ä¸ªæ–°æ—§è¡Œä¸ºåœ¨ä¸€èµ·çš„ç»„åˆã€‚Pelr6 æä¾›äº† multi methods , å®ƒå…è®¸ä½ æ·»åŠ ç›¸åŒåå­—çš„æ–°æ–¹æ³•, è€Œä¸”ä¸é‡å†™åŸæœ‰çš„, å®ƒåªå°è¯•åŒ¹é…æ‰€æœ‰çš„åˆ°æ–°æ–¹æ³•è€Œå·²ã€‚è¿™ä¸ªè°ƒåº¦æ˜¯ç”±ä¸€ä¸ªï¼ˆé€šå¸¸è‡ªåŠ¨ç”Ÿæˆçš„ï¼‰ proto method å¤„ç†çš„ã€‚å®ƒè´Ÿè´£è°ƒåº¦ç»™æ‰€æœ‰åˆæ ¼çš„å€™é€‰è€…ã€‚</p>
<p>è¿™äº›æ˜¯æ€æ ·ç”¨è¯­æ³•å’Œè§’è‰²è¿è¡Œèµ·æ¥çš„å‘¢ï¼Ÿé¢, é¦–å…ˆå®ƒä»åŸæœ‰çš„é‡Œé¢æ´¾ç”Ÿå‡ºæ–°çš„è¯­æ³•, å’Œæ´¾ç”Ÿå­ç±»ä¸€æ ·ã€‚ï¼ˆäº‹å®ä¸Š, åº•å±‚æ˜¯ å®Œå…¨ ç›¸åŒçš„æœºåˆ¶ã€‚è¯­æ³•ä¸è¿‡æ˜¯æœ‰ä¸ªä¸åŒå…ƒç±»å¯¹è±¡çš„ç±»ç½¢äº†ã€‚ï¼‰æ–°çš„è§’è‰²ä¹Ÿä¼šé‡å†™åŸæœ‰çš„è§’è‰², å’Œä½ åœ¨æ–¹æ³•ä¸Šä¹ æƒ¯çš„ä¸€æ ·ã€‚</p>
<p>S05 æœ‰ä¸ªæ¼‚äº®çš„è§£æä¿¡ä»¶çš„ç¤ºä¾‹ã€‚ç„¶åæ´¾ç”Ÿå‡ºæ¥è§£ææ­£å¼ä¿¡ä»¶çš„è¯­æ³•ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">grammar</span> <span class="nc">Letter</span> <span class="p">{</span>
    <span class="k">rule</span> <span class="nf">text</span>     <span class="p">{</span><span class="sr">    </span><span class="p">}</span>
    <span class="k">rule</span> <span class="nf">greet</span> <span class="p">{</span><span class="sr"> </span><span class="p">[</span><span class="sr">Hi</span><span class="o">|</span><span class="sr">Hey</span><span class="o">|</span><span class="sr">Yo</span><span class="p">]</span><span class="sr"> </span><span class="ni">$</span><span class="o">=</span><span class="p">(</span><span class="se">\S</span><span class="o">+?</span><span class="p">)</span><span class="sr"> , </span><span class="ni">$$</span><span class="p">}</span>
    <span class="k">rule</span> <span class="nf">body</span>     <span class="p">{</span><span class="sr"> </span><span class="o">+?</span><span class="sr"> </span><span class="p">}</span>   <span class="c1"># note: backtracks forwards via +?</span>
    <span class="k">rule</span> <span class="nf">close</span> <span class="p">{</span><span class="sr"> Later dude, </span><span class="ni">$</span><span class="o">=</span><span class="p">(</span><span class="ni">.</span><span class="o">+</span><span class="p">)</span><span class="sr"> </span><span class="p">}</span>
<span class="p">}</span>

<span class="k">grammar</span> <span class="nc">FormalLetter</span> <span class="k">is</span> <span class="nc">Letter</span> <span class="p">{</span>
    <span class="k">rule</span> <span class="nf">greet</span> <span class="p">{</span><span class="sr"> Dear </span><span class="ni">$</span><span class="o">=</span><span class="p">(</span><span class="se">\S</span><span class="o">+?</span><span class="p">)</span><span class="sr"> , </span><span class="ni">$$</span><span class="p">}</span>
    <span class="k">rule</span> <span class="nf">close</span> <span class="p">{</span><span class="sr"> Yours sincerely, </span><span class="ni">$</span><span class="o">=</span><span class="p">(</span><span class="ni">.</span><span class="o">+</span><span class="p">)</span><span class="sr"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>æ´¾ç”Ÿå‡ºæ¥çš„ FormalLetter é‡å†™äº† greet å’Œ close, ä½†æ˜¯æ²¡é‡å†™ bodyã€‚</p>
<p>ä½†æ˜¯è¿™ä¸€åˆ‡åœ¨ multi æ–¹æ³•ä¸‹ä¹Ÿèƒ½æ­£å¸¸è¿è¡Œå—ï¼Ÿæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥å®šä¹‰ä¸€ç§â€œåŸå‹è§’è‰²â€æ¥å…è®¸æˆ‘ä»¬åœ¨ä¸€ä¸ªè¯­æ³•é‡Œç”¨åŒæ ·çš„åå­—æœ‰å¤šç§è§’è‰², å†…å®¹å„ä¸ç›¸åŒï¼Ÿæ¯”å¦‚, æˆ‘ä»¬å¯èƒ½å¸Œæœ›ç”¨ä¸€ä¸ªè§’è‰² term æ¥è§£æè¯­è¨€, ä¸è¿‡æœ‰å¾ˆå¤šä¸åŒçš„ termsï¼šå­—ç¬¦ä¸²ã€æ•°å­—â€¦â€¦è€Œä¸”æ•°å­—å¯èƒ½æ˜¯åè¿›åˆ¶ã€äºŒè¿›åˆ¶ã€å…«è¿›åˆ¶ã€åå…­è¿›åˆ¶ç­‰â€¦â€¦</p>
<p>Raku è¯­æ³•å¯ä»¥åŒ…å«ä¸€ä¸ªåŸå‹è§’è‰², ç„¶åä½ å¯ä»¥å®šä¹‰ã€é‡å®šä¹‰åŒåè§’è‰²éšä¾¿å¤šå°‘æ¬¡ã€‚æ˜¾ç„¶è®©æˆ‘ä»¬å›åˆ°æ–‡ç« æœ€å¼€å§‹çš„ <code>/ foo | food /</code>ã€‚æ‰€æœ‰ä½ èµ·äº†ç›¸åŒåå­—çš„è§’è‰²ä¼šç¼–è¯‘æˆä¸€ä¸ªå¤§çš„ alternationã€‚</p>
<p>ä¸ä»…å¦‚æ­¤ - è°ƒç”¨å…¶ä»–è§’è‰²çš„è§’è‰², æœ‰äº›å¯èƒ½æ˜¯åŸå‹è§’è‰², è¿™äº›ä¹Ÿä¼šå…¨éƒ¨æ‰å¹³åŒ–åˆ°ä¸€ä¸ªå¤§çš„ LTM è½®æµé€‰æ‹©é‡Œã€‚å®è·µä¸­, è¿™æ„å‘³ç€ä¸€ä¸ª term çš„æ‰€æœ‰å¯èƒ½ä¼šä¸€æ¬¡è¢«å…¨éƒ¨å°è¯•ä¸€é, æœºä¼šå¹³ç­‰ã€‚æ²¡å“ªä¸ªä¼šå› ä¸ºè‡ªå·±æ˜¯å…ˆå®šä¹‰çš„æ‰€ä»¥èƒœå‡º, åªæœ‰æœ€é•¿åŒ¹é…çš„é‚£ä¸ªé€‰æ‹©æ‰èƒœå‡ºã€‚</p>
<p>è¿™ä¸ªå¥‡æ€ªçš„ä¸€è‡´æ€§è¯´æ˜äº‹å®ä¸Š, åœ¨è°ƒç”¨æŸä¸ªæ–¹å¼çš„æ—¶å€™, æœ€å…·ä½“çš„æ–¹æ³•èƒœå‡º, è€Œä¸”è¿™ä¸ªâ€œæœ€å…·ä½“â€å¿…é¡»åŠ ä¸Šå¼•å·ã€‚ç­¾åé‡Œå‚æ•°æè¿°ç±»å‹è¶Šå¥½, æ–¹æ³•å°±è¶Šå…·ä½“ã€‚</p>
<p>åœ¨åˆ†ææŸä¸ªè§’è‰²çš„æ—¶å€™, åŒæ ·æ˜¯æœ€å…·ä½“çš„è§’è‰²èƒœå‡º, ä¸è¿‡è¿™é‡Œâ€œæœ€å…·ä½“â€å¿…é¡»æˆåŠŸè§£ææ‰è¡Œã€‚è§’è‰²æè¿°ä¸‹ä¸€æ­¥è¿›å…¥çš„æ–‡æœ¬è¶Šè¯¦ç»†, è§’è‰²å°±è¶Šå…·ä½“ã€‚</p>
<p>è¿™å°±æ˜¯å¥‡æ€ªçš„ä¸€è‡´æ€§ã€‚å› ä¸ºè¡¨é¢ä¸Šæ–¹æ³•å’Œè§’è‰²çœ‹èµ·æ¥å°±æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„æ€ªå…½ã€‚</p>
<p>æˆ‘ä»¬çœŸå¿ƒç›¸ä¿¡æˆ‘ä»¬ç†è§£äº†æ´¾ç”Ÿè¯­æ³•çš„åŸç†å¹¶ä¸”å¾—åˆ°äº†ä¸€é—¨æ–°çš„è¯­è¨€ã€‚ LTM å°±æ˜¯æœ€åˆé€‚çš„å› ä¸ºå®ƒå…è®¸æ–°æ—§è§’è‰²é€šè¿‡ä¸€ä¸ªå…¬å¹³å’Œå¯é¢„æµ‹çš„åŠæ³•æ··æ‚åœ¨ä¸€èµ·ã€‚è§’è‰²ä¸æ˜¯å› ä¸ºä»–ä»¬å®šä¹‰çš„å‰åè€Œèƒœå‡º, è€Œæ˜¯å› ä¸ºå®ƒèƒ½æœ€å¥½çš„è§£ææ–‡æœ¬ã€‚è¿™æ‰æ˜¯æŒ‘é€‰ç²¾è‹±çš„åŠæ³•ã€‚</p>
<p>äº‹å®ä¸Š, Raku ç¼–è¯‘å™¨è‡ªå·±å°±æ˜¯è¿™æ ·å·¥ä½œçš„ã€‚å®ƒä½¿ç”¨ Raku è¯­æ³•è§£æä½ çš„ç¨‹åº, è¿™ä¸ªè¯­æ³•æ˜¯å¯ä»¥æ´¾ç”Ÿçš„â€¦â€¦ä¸ç®¡ä½ åœ¨ç¨‹åºé‡Œä»€ä¹ˆæ—¶å€™å£°æ˜äº†ä¸€ä¸ªæ–°æ“ä½œç¬¦, éƒ½ä¼šç»™ä½ æ´¾ç”Ÿå‡ºä¸€ä¸ªæ–°çš„è¯­æ³•ã€‚æ–°æ“ä½œç¬¦çš„è§£æå°±ä½œä¸ºæ–°è§’è‰²åŠ å…¥åˆ°æ–°è¯­æ³•é‡Œã€‚ç„¶åæŠŠè§£æå‰©ä½™ç¨‹åºçš„ä»»åŠ¡äº¤ç»™æ–°çš„è¯­æ³•ã€‚ä½ çš„æ–°æ“ä½œç¬¦ä¼šèƒœè¿‡é‚£å†™ç›¸åŒä½†åŒ¹é…æ›´çŸ­çš„, ä¸è¿‡è¾“ç»™ç›¸åŒä½†åŒ¹é…æ›´é•¿çš„ã€‚</p>
<h2 id="å¼€å¼€å¿ƒå¿ƒç©-rakudo-å’Œ-euler-é¡¹ç›®">å¼€å¼€å¿ƒå¿ƒç© Rakudo å’Œ Euler é¡¹ç›®</h2>
<p>Raku å®ç°çš„é¢†å…ˆè€… Rakudo , ç›®å‰è¿˜ä¸å®Œç¾, è¯´èµ·æ€§èƒ½ä¹Ÿå°¤å…¶è®©äººå°´å°¬ã€‚ç„¶è€Œå…ˆè¡Œè€…ä¸ä¼šé—®â€œä»–å¿«ä¹ˆï¼Ÿâ€, è€Œä¼šé—®â€œä»–å¤Ÿå¿«ä¹ˆï¼Ÿâ€, ç”šè‡³æ˜¯â€œæˆ‘æ€æ ·èƒ½å¸®ä»–å˜å¾—æ›´å¿«å‘¢ï¼Ÿâ€ã€‚</p>
<p>ä¸ºäº†è¯´æœä½  Rakudo å·²ç»èƒ½åšåˆ°è¶³å¤Ÿå¿«äº†ã€‚æˆ‘ä»¬å‡†å¤‡å°è¯•åšä¸€ç»„ Euler é¡¹ç›®æµ‹è¯•ã€‚å…¶ä¸­å¾ˆå¤šæ¶‰åŠå¼ºè¡Œçš„æ•°å€¼è®¡ç®—, Rakudo ç›®å‰è¿˜ä¸æ˜¯å¾ˆæ“…é•¿ã€‚ä¸è¿‡æˆ‘ä»¬å¯æ²¡å¿…è¦å°±æ­¤é¡¿è¶³ï¼šè¯­è¨€æ€§èƒ½é™ä½äº†, ç¨‹åºå‘˜å°±è¦æ›´å¿ƒçµæ‰‹å·§äº†, è¿™æ­£æ˜¯ä¹è¶£æ‰€åœ¨å•Šã€‚</p>
<p>æ‰€æœ‰çš„ä»£ç éƒ½æ˜¯åœ¨ Rakudo 2012.11 ä¸Šæµ‹è¯•é€šè¿‡çš„ã€‚</p>
<p>å…ˆä»ä¸€äº›ç®€å•çš„ä¾‹å­å¼€å§‹ã€‚</p>
<p>æƒ³æƒ³æ–æ³¢é‚£å¥‘åºåˆ—é‡Œæ•°å€¼ä¸è¶…è¿‡å››ç™¾ä¸‡çš„å…ƒç´ , è®¡ç®—è¿™äº›å€¼çš„æ€»å’Œã€‚åŠæ³•è¶…çº§ç®€å•ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="o">[+]</span> <span class="nb">grep</span> <span class="o">*</span> <span class="nv">%%</span> <span class="mi">2</span><span class="o">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="o">*+*</span> <span class="o">...^</span> <span class="o">*</span> <span class="o">&gt;</span> <span class="mi">4_000_000</span><span class="p">);</span>
</code></pre></div><p>è¿è¡Œæ—¶é—´ï¼š0.4ç§’</p>
<p>æ³¨æ„æ€æ ·ä½¿ç”¨æ“ä½œç¬¦æ‰èƒ½è®©ä»£ç å³ç´§å‡‘åˆä¿æŒå¯è¯»æ€§(å½“ç„¶è¿™ç‚¹å¤§å®¶è‚¯å®šæ„è§ä¸ä¸€)ã€‚æˆ‘ä»¬ç”¨äº†ï¼š</p>
<ul>
<li>æ— è®ºå¦‚ä½•ç”¨ <code>*</code> åˆ›å»º lambda å‡½æ•°</li>
<li>ç”¨åºåˆ—æ“ä½œç¬¦ <code>...^</code> æ¥å»ºç«‹æ–æ³¢é‚£å¥‘åºåˆ—</li>
<li>ç”¨æ•´é™¤æ“ä½œç¬¦ <code>%%</code> æ¥è¿‡æ»¤å…ƒç´ </li>
<li>ç”¨ <code>[+]</code> åš reduce æ“ä½œè®¡ç®—å’Œ</li>
</ul>
<p>å½“ç„¶, æ²¡äººå¼ºåˆ¶ä½ è¿™æ ·ç–¯ç‹‚çš„ä½¿ç”¨æ“ä½œç¬¦ - é¦™è‰(vanilla)å‘½ä»¤å¼çš„ä»£ç ä¹Ÿæ²¡é—®é¢˜ï¼š</p>
<blockquote>
<p>600851475143 çš„æœ€å¤§ç´ å› æ•°æ˜¯å¤šå°‘ï¼Ÿ</p>
</blockquote>
<p>å‘½ä»¤å¼çš„è§£å†³æ–¹æ¡ˆæ˜¯è¿™æ ·çš„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">largest-prime-factor</span><span class="p">(</span><span class="nv">$n</span> <span class="k">is</span> <span class="nb">copy</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="o">*+</span><span class="mi">2</span> <span class="o">...</span> <span class="o">*</span> <span class="p">{</span>
        <span class="k">while</span> <span class="nv">$n</span> <span class="nv">%%</span> <span class="nv">$_</span> <span class="p">{</span>
            <span class="nv">$n</span> <span class="ow">div</span><span class="o">=</span> <span class="nv">$_</span><span class="p">;</span>
            <span class="k">return</span> <span class="nv">$_</span> <span class="k">if</span> <span class="nv">$_</span> <span class="o">&gt;</span> <span class="nv">$n</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="nf">largest-prime-factor</span><span class="p">(</span><span class="mi">600_851_475_143</span><span class="p">);</span>
</code></pre></div><p>è¿è¡Œæ—¶é—´ï¼š2.6ç§’</p>
<p>æ³¨æ„ç”¨çš„ <code>is copy</code>, å› ä¸º Raku çš„ç»‘å®šå‚æ•°é»˜è®¤æ˜¯åªè¯»çš„ã€‚è¿˜æœ‰ç”¨äº†æ•´æ•°é™¤æ³• <code>div</code>, è€Œæ²¡ç”¨æ•°å€¼é™¤æ³•çš„ <code>/</code>ã€‚</p>
<p>åˆ°ç›®å‰ä¸ºæ­¢éƒ½æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„, æˆ‘ä»¬ç»§ç»­:</p>
<p>nä»1åˆ°100, <!-- raw HTML omitted -->n<!-- raw HTML omitted -->C<!-- raw HTML omitted -->r<!-- raw HTML omitted --> çš„å€¼, ä¸ä¸€å®šè¦æ±‚ä¸åŒ, æœ‰å¤šå°‘å¤§äºä¸€ç™¾ä¸‡çš„ï¼Ÿ</p>
<p>æˆ‘ä»¬å°†ä½¿ç”¨ feed æ“ä½œç¬¦ <code>==&gt;</code> æ¥åˆ†è§£ç®—æ³•æˆè®¡ç®—çš„æ¯ä¸€æ­¥ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">[</span><span class="mi">1</span><span class="o">],</span> <span class="k">-&gt;</span> <span class="nv">@p</span> <span class="p">{</span> <span class="o">[</span><span class="mi">0</span><span class="o">,</span> <span class="nv">@p</span> <span class="ow">Z</span><span class="o">+</span> <span class="nv">@p</span><span class="o">,</span> <span class="mi">0</span><span class="o">]</span> <span class="p">}</span> <span class="o">...</span> <span class="o">*</span> <span class="c1"># ç”Ÿæˆæ¨è¾‰ä¸‰è§’</span>
<span class="o">==&gt;</span> <span class="p">(</span><span class="o">*[</span><span class="mi">0</span><span class="o">..</span><span class="mi">100</span><span class="o">]</span><span class="p">)()</span>                     <span class="c1"># ç”Ÿæˆ0åˆ°100çš„nè¡Œ</span>
<span class="o">==&gt;</span> <span class="nb">map</span> <span class="o">*.</span><span class="nb">list</span>                        <span class="c1"># å¹³é“ºæˆä¸€ä¸ªåˆ—è¡¨</span>
<span class="o">==&gt;</span> <span class="nb">grep</span> <span class="o">*</span> <span class="o">&gt;</span> <span class="mi">1_000_000</span>                <span class="c1"># è¿‡æ»¤è¶…è¿‡1000000çš„æ•°</span>
<span class="o">==&gt;</span> <span class="nb">elems</span><span class="p">()</span>                           <span class="c1"># è®¡ç®—ä¸ªæ•°</span>
<span class="o">==&gt;</span> <span class="nb">say</span><span class="p">;</span>                              <span class="c1"># è¾“å‡ºç»“æœ</span>
</code></pre></div><p>è¿è¡Œæ—¶é—´ï¼š5.2s</p>
<p>æ³¨æ„ä½¿ç”¨äº† <code>Z</code> æ“ä½œç¬¦å’Œ <code>+</code> æ¥å‹ç¼© <code>0,@p</code> å’Œ <code>@p,0</code> çš„ä¸¤ä¸ªåˆ—è¡¨ã€‚</p>
<p>è¿™ä¸ªå•è¡Œç”Ÿæˆæ¨è¾‰ä¸‰è§’çš„å†™æ³•æ˜¯ä» Rosetta ä»£ç é‡Œå·è¿‡æ¥çš„ã€‚é‚£æ˜¯å¦ä¸€ä¸ªä¸é”™çš„é¡¹ç›®, å¦‚æœä½ å¯¹ Raku çš„ç‰‡æ®µç»ƒä¹ å¾ˆæ„Ÿå…´è¶£çš„è¯ã€‚</p>
<p>è®©æˆ‘ä»¬åšäº›æ›´å·§å¦™çš„ã€‚</p>
<p>å­˜åœ¨ä¸€ä¸ªæ¯•è¾¾å“¥æ‹‰æ–¯ä¸‰å…ƒæ•°ç»„è®© <code>a +b + c = 1000</code> ã€‚æ±‚ aã€bã€c çš„å€¼ã€‚</p>
<p>æš´åŠ›ç ´è§£å¯ä»¥å®Œæˆ (Polettix çš„è§£å†³åŠæ³•), ä½†æ˜¯è¿™ä¸ªåŠæ³•ä¸å¤Ÿå¿«ï¼ˆåœ¨æˆ‘æœºå™¨ä¸ŠèŠ±äº†11ç§’å·¦å³ï¼‰ã€‚è®©æˆ‘ä»¬ç”¨ç‚¹ä»£æ•°çŸ¥è¯†æŠŠé—®é¢˜æ›´ç®€å•çš„è§£å†³ã€‚</p>
<p>å…ˆåˆ›å»ºä¸€ä¸ª (a, b, c) ç»„æˆçš„æ¯•è¾¾å“¥æ‹‰æ–¯ä¸‰å…ƒæ•°ç»„:</p>
<pre><code>a &lt; b &lt; c
aÂ² + bÂ² = cÂ²
</code></pre><p>è¦æ±‚ <code>N = a + b +c</code> å°±è¦ç¬¦åˆï¼š</p>
<pre><code>b = NÂ·(N - 2a) / 2Â·(N - a)
c = NÂ·(N - 2a) / 2Â·(N - a) + aÂ²/(N - a)
</code></pre><p>è¿™å°±è‡ªåŠ¨ç¬¦åˆäº† <code>b &lt; c</code> çš„æ¡ä»¶ã€‚
è€Œ <code>a &lt; b</code> çš„æ¡ä»¶åˆ™äº§ç”Ÿä¸‹é¢è¿™ä¸ªçº¦æŸï¼š</p>
<pre><code>a &lt; (1 - 1/âˆš2)Â·N
</code></pre><p>æˆ‘ä»¬å°±å¾—åˆ°ä»¥ä¸‹ä»£ç äº†ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">triplets</span><span class="p">(</span>\<span class="n">N</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="nb">Int</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="nb">sqrt</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span> <span class="o">*</span> <span class="n">N</span><span class="p">)</span> <span class="k">-&gt;</span> \<span class="n">a</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">\u</span> <span class="o">=</span> <span class="n">N</span> <span class="o">*</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">);</span>
        <span class="k">my</span> <span class="nv">\v</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="n">a</span><span class="p">);</span>

        <span class="c1"># æ£€æŸ¥ b = u/v æ˜¯å¦æ˜¯æ•´æ•°</span>
        <span class="c1"># å¦‚æœæ˜¯, æˆ‘ä»¬å°±æ‰¾åˆ°äº†ä¸€ä¸ªä¸‰å…ƒæ•°ç»„</span>
        <span class="k">if</span> <span class="n">u</span> <span class="nv">%%</span> <span class="n">v</span> <span class="p">{</span>
            <span class="k">my</span> <span class="nv">\b</span> <span class="o">=</span> <span class="n">u</span> <span class="ow">div</span> <span class="n">v</span><span class="p">;</span>
            <span class="k">my</span> <span class="nv">\c</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
            <span class="nb">take</span> <span class="nv">$</span><span class="p">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">c</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="o">[*]</span> <span class="o">.</span><span class="nb">list</span> <span class="k">for</span> <span class="k">gather</span> <span class="nf">triplets</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
</code></pre></div><p>è¿è¡Œæ—¶é—´ï¼š0.5s</p>
<p>æ³¨æ„ sigilless å˜é‡ <code>\N</code>, <code>\a</code> â€¦â€¦ çš„å£°æ˜, <code>$(...)</code> æ˜¯æ€ä¹ˆç”¨æ¥æŠŠä¸‰å…ƒæ•°ç»„ä½œä¸ºå•ç‹¬å…ƒç´ è¿”å›çš„, ç”¨<code>$_.list</code> çš„ç¼©å†™ <code>.list</code> æ¥æ¢å¤å…¶åˆ—è¡¨æ€§ã€‚</p>
<p><code>&amp;triplets</code> å­ä¾‹ç¨‹ä½œä¸ºç”Ÿæˆå™¨, å¹¶ä¸”ä½¿ç”¨ <code>&amp;take</code> åˆ‡æ¢åˆ°ç»“æœã€‚ç›¸åº”çš„ <code>&amp;gather</code> ç”¨æ¥åˆ’å®šç”Ÿæˆå™¨çš„(åŠ¨æ€)ä½œç”¨åŸŸ, è€Œä¸”å®ƒä¹Ÿå¯ä»¥æ”¾è¿› <code>&amp;triplets</code>, è¿™ä¸ªå¯èƒ½è¿”å›ä¸€ä¸ªæƒ°æ€§åˆ—è¡¨ã€‚</p>
<p>æˆ‘ä»¬åŒæ ·å¯ä»¥ä½¿ç”¨æµæ“ä½œç¬¦æ”¹å†™æˆæ•°æ®æµé©±åŠ¨çš„é£æ ¼ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">constant</span> <span class="no">N</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>

<span class="mi">1</span><span class="o">..</span><span class="nb">Int</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="nb">sqrt</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span> <span class="o">*</span> <span class="n">N</span><span class="p">)</span>
<span class="o">==&gt;</span> <span class="nb">map</span> <span class="k">-&gt;</span> \<span class="n">a</span> <span class="p">{</span> <span class="o">[</span> <span class="n">a</span><span class="o">,</span> <span class="n">N</span> <span class="o">*</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span><span class="o">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">N</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">]</span> <span class="p">}</span>
<span class="o">==&gt;</span> <span class="nb">grep</span> <span class="k">-&gt;</span> <span class="o">[</span> \<span class="n">a</span><span class="o">,</span> \<span class="n">u</span><span class="o">,</span> \<span class="n">v</span> <span class="o">]</span> <span class="p">{</span> <span class="n">u</span> <span class="nv">%%</span> <span class="n">v</span> <span class="p">}</span>
<span class="o">==&gt;</span> <span class="nb">map</span> <span class="k">-&gt;</span> <span class="o">[</span> \<span class="n">a</span><span class="o">,</span> \<span class="n">u</span><span class="o">,</span> \<span class="n">v</span> <span class="o">]</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">\b</span> <span class="o">=</span> <span class="n">u</span> <span class="ow">div</span> <span class="n">v</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">\c</span> <span class="o">=</span> <span class="n">N</span> <span class="o">-</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">;</span>
    <span class="n">a</span> <span class="o">*</span> <span class="n">b</span> <span class="o">*</span> <span class="n">c</span>
<span class="p">}</span>
<span class="o">==&gt;</span> <span class="nb">say</span><span class="p">;</span>
</code></pre></div><p>è¿è¡Œæ—¶é—´ï¼š0.5s</p>
<p>æ³¨æ„æˆ‘ä»¬æ˜¯æ€æ ·ç”¨è§£å‹ç­¾åç»‘å®š <code>-&gt; [...]</code> æ¥è§£å‹ä¼ é€’è¿‡æ¥çš„æ•°ç»„çš„ã€‚</p>
<p>ä½¿ç”¨è¿™ç§ç‰¹æ®Šçš„é£æ ¼æ²¡æœ‰ä»€ä¹ˆå®è´¨çš„å¥½å¤„ï¼šäº‹å®ä¸Šè¿˜å¾ˆå®¹æ˜“å½±å“åˆ°æ€§èƒ½, æˆ‘ä»¬éšåä¼šçœ‹åˆ°ä¸€ä¸ªè¿™æ–¹é¢çš„ä¾‹å­ã€‚
å†™çº¯å‡½æ•°å¼ç®—æ³•æ˜¯ä¸ªè¶…çº§å¥½çš„è·¯å­ã€‚ä¸è¿‡åŸåˆ™ä¸Šè¿™å°±æ„å‘³ç€è®©é‚£äº›è¶³å¤Ÿå…ˆè¿›çš„ä¼˜åŒ–å™¨ä¹±æ¥ï¼ˆæƒ³æƒ³è‡ªåŠ¨å‘é‡åŒ–å’Œçº¿ç¨‹ï¼‰ã€‚ä¸è¿‡ Rakudo è¿˜æ²¡åˆ°è¿™ä¸ªå¤æ‚åœ°æ­¥ã€‚</p>
<p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬æ²¡æœ‰èªæ˜åˆ°å¯ä»¥æ‰¾åˆ°è¿™ä¹ˆç‰›å‰çš„è§£å†³åŠæ³•, è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>æ±‚ç¬¬ä¸€ä¸ªè¿ç»­å››ä¸ªæ•´æ•°, ä»–ä»¬æœ‰å››ä¸ªä¸åŒçš„ç´ å› æ•°ã€‚</p>
<p>é™¤äº†æš´åŠ›ç ´è§£, æˆ‘æ²¡æ‰¾åˆ°ä»»ä½•æ›´å¥½çš„åŠæ³•ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">constant</span> <span class="nv">$N</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">for</span> <span class="mi">2</span><span class="o">..*</span> <span class="p">{</span>
    <span class="nv">$i</span> <span class="o">=</span> <span class="nf">factors</span><span class="p">(</span><span class="nv">$_</span><span class="p">)</span> <span class="o">==</span> <span class="nv">$N</span> <span class="o">??</span> <span class="nv">$i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">!!</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="nv">$i</span> <span class="o">==</span> <span class="nv">$N</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="nv">$_</span> <span class="o">-</span> <span class="nv">$N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="nb">last</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>è¿™é‡Œ, <code>&amp;fators</code> è¿”å›ç´ å› æ•°çš„ä¸ªæ•°, åŸå§‹çš„å®ç°å·®ä¸å¤šæ˜¯è¿™æ ·çš„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">factors</span><span class="p">(</span><span class="nv">$n</span> <span class="k">is</span> <span class="nb">copy</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="o">*+</span><span class="mi">2</span> <span class="o">...^</span> <span class="o">*</span> <span class="o">&gt;</span> <span class="nv">$n</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nv">$n</span> <span class="nv">%%</span> <span class="nv">$_</span> <span class="p">{</span>
            <span class="o">++</span><span class="nv">$i</span><span class="p">;</span>
            <span class="k">repeat</span> <span class="k">while</span> <span class="nv">$n</span> <span class="nv">%%</span> <span class="nv">$_</span> <span class="p">{</span>
                <span class="nv">$n</span> <span class="ow">div</span><span class="o">=</span> <span class="nv">$_</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$i</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>è¿è¡Œæ—¶é—´ï¼šunknown (33s for N=3)</p>
<p>æ³¨æ„ <code>repeat while ...{...}</code> çš„ç”¨æ³•, è¿™æ˜¯ <code>do {...} while(...);</code> çš„æ–°å†™æ³•ã€‚
æˆ‘ä»¬å¯ä»¥åŠ ä¸Šç‚¹ç¼“å­˜æ¥åŠ é€Ÿç¨‹åºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">BEGIN</span> <span class="k">my</span> <span class="nv">%cache</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">;</span>

<span class="k">multi</span> <span class="nf">factors</span><span class="p">(</span><span class="nv">$n</span> <span class="k">where</span> <span class="nv">%cache</span><span class="p">)</span> <span class="p">{</span> <span class="nv">%cache</span><span class="p">{</span><span class="nv">$n</span><span class="p">}</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nf">factors</span><span class="p">(</span><span class="nv">$n</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="o">*+</span><span class="mi">2</span> <span class="o">...^</span> <span class="o">*</span> <span class="o">&gt;</span> <span class="nb">sqrt</span><span class="p">(</span><span class="nv">$n</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="nv">$n</span> <span class="nv">%%</span> <span class="nv">$_</span> <span class="p">{</span>
            <span class="k">my</span> <span class="nv">$r</span> <span class="o">=</span> <span class="nv">$n</span><span class="p">;</span>
            <span class="nv">$r</span> <span class="ow">div</span><span class="o">=</span> <span class="nv">$_</span> <span class="k">while</span> <span class="nv">$r</span> <span class="nv">%%</span> <span class="nv">$_</span><span class="p">;</span>
            <span class="k">return</span> <span class="nv">%cache</span><span class="p">{</span><span class="nv">$n</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nf">factors</span><span class="p">(</span><span class="nv">$r</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">%cache</span><span class="p">{</span><span class="nv">$n</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>è¿è¡Œæ—¶é—´ï¼šunknown (3.5s for N=3)</p>
<p>æ³¨æ„ç”¨ <code>BEGIN</code> æ¥åˆå§‹åŒ–ç¼“å­˜, ä¸ç®¡å‡ºç°åœ¨æºä»£ç é‡Œå“ªä¸ªä½ç½®ã€‚è¿˜æœ‰ç”¨ <code>multi</code> æ¥å¯ç”¨å¯¹ <code>&amp;factors</code> çš„å¤šæ ·è°ƒåº¦ã€‚<code>where</code> å­å¥å¯ä»¥æ ¹æ®å‚æ•°çš„å€¼è¿›è¡ŒåŠ¨æ€è°ƒåº¦ã€‚</p>
<p>å“ªæ€•æœ‰ç¼“å­˜, æˆ‘ä»¬ä¾ç„¶æ— æ³•åœ¨ä¸€ä¸ªåˆç†çš„æ—¶é—´å†…å›ç­”ä¸Šæ¥åŸæ¥çš„é—®é¢˜ã€‚ç°åœ¨æˆ‘ä»¬æ€ä¹ˆåŠï¼Ÿåªèƒ½ç”¨ç‚¹éª—å­æ‰‹æ®µäº†Zavolaj â€“ Rakudo ç‰ˆæœ¬çš„ NativeCall â€“ æ¥åœ¨Cè¯­è¨€é‡Œå®ç°å› å¼åˆ†è§£ã€‚</p>
<p>äº‹å®è¯æ˜è¿™è¿˜ä¸å¤Ÿå¥½, æ‰€ä»¥æˆ‘ä»¬ç»§ç»­é‡æ„å‰©ä¸‹çš„ä»£ç , æ·»åŠ ä¸€äº›åŸå‹å£°æ˜ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">use</span> <span class="nb">NativeCall</span><span class="p">;</span>

<span class="k">sub</span> <span class="nf">factors</span><span class="p">(</span><span class="nb">int</span> <span class="nv">$n</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">int</span> <span class="k">is</span> <span class="k">native</span><span class="p">(&#39;</span><span class="s1">./prob047-gerdr</span><span class="p">&#39;)</span> <span class="p">{</span> <span class="o">*</span> <span class="p">}</span>

<span class="k">my</span> <span class="nb">int</span> <span class="nv">$N</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>

<span class="k">my</span> <span class="nb">int</span> <span class="nv">$n</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="k">my</span> <span class="nb">int</span> <span class="nv">$i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="k">while</span> <span class="nv">$i</span> <span class="o">!=</span> <span class="nv">$N</span> <span class="p">{</span>
    <span class="nv">$i</span> <span class="o">=</span> <span class="nf">factors</span><span class="p">(</span><span class="nv">$n</span><span class="p">)</span> <span class="o">==</span> <span class="nv">$N</span> <span class="o">??</span> <span class="nv">$i</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">!!</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nv">$n</span> <span class="o">=</span> <span class="nv">$n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="nv">$n</span> <span class="o">-</span> <span class="nv">$N</span><span class="p">;</span>
</code></pre></div><p>è¿è¡Œæ—¶é—´ï¼š1m2s (0.8s for N=3)</p>
<p>ç›¸æ¯”ä¹‹ä¸‹, å®Œå…¨ä½¿ç”¨Cè¯­è¨€å®ç°è¿™ä¸ªç®—æ³•, è¿è¡Œæ—¶é—´åœ¨0.1ç§’ä¹‹å†…ã€‚æ‰€ä»¥ç›®å‰ Rakudo è¿˜æ²¡æ³•èµ¢å¾—ä»»ä½•ä¸€ç§é€Ÿåº¦æµ‹è¯•ã€‚</p>
<p>é‡å¤ä¸€ä¸‹, ç”¨ä¸‰ç§åŠæ³•åšä¸€ä»¶äº‹ï¼š</p>
<p>åœ¨ <code>2 â‰¤ a â‰¤ 100</code> å’Œ <code>2 â‰¤ b â‰¤ 100</code> çš„æƒ…å†µä¸‹ç”± a<!-- raw HTML omitted -->b<!-- raw HTML omitted --> ç”Ÿæˆçš„åºåˆ—é‡Œæœ‰å¤šå°‘ä¸ä¸€æ ·çš„å…ƒç´ ï¼Ÿ
ä¸‹é¢æ˜¯ä¸€ä¸ªå¾ˆæ¼‚äº®ä½†å¾ˆæ…¢çš„è§£å†³åŠæ³•, å¯ä»¥ç”¨æ¥éªŒè¯å…¶ä»–åŠæ³•æ˜¯å¦æ­£ç¡®ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="o">+</span><span class="p">(</span><span class="mi">2</span><span class="o">..</span><span class="mi">100</span> <span class="ow">X</span><span class="o">=&gt;</span> <span class="mi">2</span><span class="o">..</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="nb">classify</span><span class="p">({</span> <span class="o">.</span><span class="nb">key</span> <span class="o">**</span> <span class="o">.</span><span class="nb">value</span> <span class="p">});</span>
</code></pre></div><p>è¿è¡Œæ—¶é—´ï¼š11s</p>
<p>æ³¨æ„ä½¿ç”¨ <code>X=&gt;</code> æ¥æ„é€ ç¬›å¡å°”ä¹˜ç§¯ã€‚ç”¨å¯¹æ„é€ å™¨ <code>=&gt;</code> é˜²æ­¢åºåˆ—è¢«å‹æ‰è€Œå·²ã€‚</p>
<p>å› ä¸º Rakudo æ”¯æŒå¤§æ•´æ•°è¯­ä¹‰, æ‰€ä»¥åœ¨è®¡ç®—åƒ 100100 è¿™ç§å¤§æ•°çš„æ—¶å€™æ²¡æœ‰ç²¾å¯†åº¦ä¸Šçš„æŸå¤±ã€‚</p>
<p>ä¸è¿‡æˆ‘ä»¬å¹¶ä¸çœŸçš„åœ¨æ„å¹‚çš„å€¼, ä¸è¿‡ç”¨åŸºæ•°å’ŒæŒ‡æ•°æ¥å”¯ä¸€æ ‡ç¤ºå¹‚ã€‚æˆ‘ä»¬éœ€è¦æ³¨æ„åŸºæ•°å¯èƒ½è‡ªå·±æœ¬èº«å°±æ˜¯å‰é¢æŸæ¬¡çš„å¹‚å€¼ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">constant</span> <span class="no">A</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="k">constant</span> <span class="no">B</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>

<span class="k">my</span> <span class="p">(</span><span class="nv">%powers</span><span class="o">,</span> <span class="nv">%count</span><span class="p">);</span>

<span class="c1"># æ‰¾å‡ºé‚£äº›æ˜¯ä¹‹å‰åŸºæ•°çš„å¹‚çš„åŸºæ•°</span>
<span class="c1"># åˆ†åˆ«å­˜å‚¨åŸºæ•°å’ŒæŒ‡æ•°</span>
<span class="k">for</span> <span class="mi">2</span><span class="o">..</span><span class="nb">Int</span><span class="p">(</span><span class="nb">sqrt</span> <span class="n">A</span><span class="p">)</span> <span class="k">-&gt;</span> \<span class="n">a</span> <span class="p">{</span>
    <span class="nb">next</span> <span class="k">if</span> <span class="n">a</span> <span class="o">~~</span> <span class="nv">%powers</span><span class="p">;</span>
    <span class="nv">%powers</span><span class="p">{</span><span class="n">a</span><span class="o">,</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">,</span> <span class="n">a</span><span class="o">**</span><span class="mi">3</span> <span class="o">...^</span> <span class="o">*</span> <span class="o">&gt;</span> <span class="n">A</span><span class="p">}</span> <span class="o">=</span> <span class="n">a</span> <span class="ow">X</span><span class="o">=&gt;</span> <span class="mi">1</span><span class="o">..*</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1"># è®¡ç®—é‡å¤çš„ä¸ªæ•°</span>
<span class="k">for</span> <span class="nv">%powers</span><span class="o">.</span><span class="nb">values</span> <span class="k">-&gt;</span> \<span class="n">p</span> <span class="p">{</span>
    <span class="k">for</span> <span class="mi">2</span><span class="o">..</span><span class="n">B</span> <span class="k">-&gt;</span> \<span class="nb">e</span> <span class="p">{</span>
        <span class="c1"># ä¸Šå‡åˆ° \e çš„å¹‚</span>
        <span class="c1"># æ ¹æ®ä¹‹å‰çš„åŸºæ•°å’Œå¯¹åº”æŒ‡æ•°åˆ†ç±»</span>
        <span class="o">++</span><span class="nv">%count</span><span class="p">{</span><span class="n">p</span><span class="o">.</span><span class="s">key</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="o">.</span><span class="nb">value</span> <span class="o">*</span> <span class="nb">e</span><span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># æ·»åŠ  +%count ä½œä¸ºä¸€ä¸ªéœ€è¦ä¿å­˜çš„å‰¯æœ¬</span>
<span class="nb">say</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nv">%count</span> <span class="o">-</span> <span class="o">[+]</span> <span class="nv">%count</span><span class="o">.</span><span class="nb">values</span><span class="p">;</span>
</code></pre></div><p>è¿è¡Œæ—¶é—´ï¼š0.9s</p>
<p>æ³¨æ„ç”¨åºåˆ—æ“ä½œç¬¦ <code>...^</code> æ¨æ–­é›†åˆåºåˆ—, åªè¦æä¾›è‡³å°‘ä¸‰ä¸ªå…ƒç´ , åˆ—è¡¨èµ‹å€¼ <code>%powers{...} = ...</code> å°±ä¼šæ— ä¼‘æ­¢çš„è¿›è¡Œä¸‹å»ã€‚</p>
<p>æˆ‘ä»¬å†æ¬¡ç”¨æ•°æ®é©±åŠ¨çš„å‡½æ•°å¼çš„é£æ ¼é‡å†™ä¸€éï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">cross</span><span class="p">(</span><span class="nv">@a</span><span class="o">,</span> <span class="nv">@b</span><span class="p">)</span> <span class="p">{</span> <span class="nv">@a</span> <span class="ow">X</span> <span class="nv">@b</span> <span class="p">}</span>
<span class="k">sub</span> <span class="nf">dups</span><span class="p">(</span><span class="nv">@a</span><span class="p">)</span> <span class="p">{</span> <span class="nv">@a</span> <span class="o">-</span> <span class="nv">@a</span><span class="o">.</span><span class="nf">uniq</span> <span class="p">}</span>

<span class="k">constant</span> <span class="no">A</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="k">constant</span> <span class="no">B</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>

<span class="mi">2</span><span class="o">..</span><span class="nb">Int</span><span class="p">(</span><span class="nb">sqrt</span> <span class="n">A</span><span class="p">)</span>
<span class="o">==&gt;</span> <span class="nb">map</span> <span class="k">-&gt;</span> \<span class="n">a</span> <span class="p">{</span> <span class="p">(</span><span class="n">a</span><span class="o">,</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">,</span> <span class="n">a</span><span class="o">**</span><span class="mi">3</span> <span class="o">...^</span> <span class="o">*</span> <span class="o">&gt;</span> <span class="n">A</span><span class="p">)</span> <span class="ow">Z</span><span class="o">=&gt;</span> <span class="p">(</span><span class="n">a</span> <span class="ow">X</span> <span class="mi">1</span><span class="o">..*</span><span class="p">)</span><span class="o">.</span><span class="nb">tree</span> <span class="p">}</span>
<span class="o">==&gt;</span> <span class="nb">reverse</span><span class="p">()</span>
<span class="o">==&gt;</span> <span class="nb">hash</span><span class="p">()</span>
<span class="o">==&gt;</span> <span class="nb">values</span><span class="p">()</span>
<span class="o">==&gt;</span> <span class="nb">cross</span><span class="p">(</span><span class="mi">2</span><span class="o">..</span><span class="n">B</span><span class="p">)</span>
<span class="o">==&gt;</span> <span class="nb">map</span> <span class="k">-&gt;</span> \<span class="n">n</span><span class="o">,</span> <span class="o">[</span>\<span class="nb">r</span><span class="o">,</span> \<span class="nb">e</span><span class="o">]</span> <span class="p">{</span> <span class="p">(</span><span class="nb">r</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">e</span> <span class="o">*</span> <span class="n">n</span> <span class="p">}</span>
<span class="o">==&gt;</span> <span class="nf">dups</span><span class="p">()</span>
<span class="o">==&gt;</span> <span class="p">((</span><span class="n">A</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">B</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="o">*</span><span class="p">)()</span>
<span class="o">==&gt;</span> <span class="nb">say</span><span class="p">();</span>
</code></pre></div><p>è¿è¡Œæ—¶é—´ï¼š1.5s</p>
<p>æ³¨æ„æˆ‘ä»¬æ€ä¹ˆç”¨ <code>&amp;tree</code> æ¥é˜²æ­¢å‹æ‰çš„ã€‚æˆ‘ä»¬å¯ä»¥åƒä¹‹å‰é‚£æ ·ç”¨ <code>X=&gt;</code> æ›¿ä»£ X , ä¸è¿‡è¿™ä¼šè®©é€šè¿‡ <code>-&gt;  \n, [\r, \e]</code> è§£æ„å˜å¾—å¾ˆå¤æ‚ã€‚</p>
<p>å’Œé¢„æƒ³çš„ä¸€æ ·, è¿™ä¸ªå†™æ³•æ²¡åƒå‘½ä»¤å¼çš„é‚£æ ·æ‰§è¡Œå‡ºæ¥ã€‚æ€ä¹ˆæ‰èƒ½æ­£å¸¸è¿è¡Œå‘¢ï¼Ÿè¿™ç®—æ˜¯æˆ‘ç•™ç»™è¯»è€…çš„ä½œä¸šå§ã€‚</p>
<h2 id="è§£æ-ipv4-åœ°å€">è§£æ IPv4 åœ°å€</h2>
<p>Raku çš„æ­£åˆ™ç°åœ¨æ˜¯ä¸€ç§å­è¯­è¨€äº†, å¾ˆå¤šè¯­æ³•æ²¡æœ‰å˜:</p>
<pre><code>/\d+/
</code></pre><p>æ•è·æ•°å­—ï¼š</p>
<pre><code>/(\d+)/
</code></pre><p>ç°åœ¨ <code>$0</code> å­˜å‚¨ç€åŒ¹é…åˆ°çš„æ•°å­—, è€Œä¸æ˜¯ Perl 5 ä¸­çš„ <code>$1</code>. æ‰€æœ‰çš„ç‰¹æ®Šå˜é‡ <code>$0</code>,<code>$1</code>,<code>$2</code> åœ¨ Raku é‡Œå°±æ˜¯ <code>$/[0]</code>, <code>$/[1]</code>, <code>$/[2]</code>. åœ¨ Perl 5 ä¸­, <code>$0</code> æ˜¯è„šæœ¬æˆ–ç¨‹åºçš„æ–‡ä»¶å, ä½†æ˜¯è¿™åœ¨ Raku ä¸­å˜æˆäº† <code>$*EXECUTABLE_NAME</code>ã€‚</p>
<p>å¦‚æœä½ å¯¹è·å¾—ä¸€ä¸ªæ­£åˆ™åŒ¹é…çš„æ‰€æœ‰æ•è·ç»„æ„Ÿå…´è¶£, ä½ å¯ä»¥ä½¿ç”¨ <code>@()</code>, å®ƒæ˜¯ <code>@($/)</code> çš„è¯­æ³•ç³–ã€‚
<code>$/</code> å˜é‡ä¸­çš„å¯¹è±¡æ‹¥æœ‰è®¸å¤šå…³äºæœ€åä¸€æ¬¡åŒ¹é…çš„æœ‰ç”¨ä¿¡æ¯ã€‚ä¾‹å¦‚, <code>$/.from</code> å°†ç»™ä½ åŒ¹é…çš„èµ·å§‹å­—ç¬¦ä¸²ä½ç½®ã€‚
ä½†æ˜¯ <code>$0</code> å°†ä½¿æˆ‘ä»¬åœ¨è¿™ç¯‡æ–‡ç« ä¸­èµ°å¾—è¶³å¤Ÿè¿œã€‚æˆ‘ä»¬ç”¨å®ƒæ¥ä»ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æå–å•ä¸ªç‰¹å¾ã€‚</p>
<p>ä¿®é¥°ç¬¦ç°åœ¨æ”¾åœ¨å‰é¢äº†:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$_</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">1 23 456 78.9</span><span class="p">&#39;;</span>
<span class="nb">say</span> <span class="o">.</span><span class="nb">Str</span> <span class="k">for</span> <span class="k">m</span><span class="p">:</span><span class="na">g</span><span class="p">/(</span><span class="se">\d</span><span class="o">+</span><span class="p">)</span><span class="sr">/; </span><span class="c1"># 1 23 456 78 9
</span></code></pre></div><p>åŒ¹é…æ‰€æœ‰çœ‹èµ·æ¥åƒè¿™æ ·çš„ä¸œè¥¿å¾ˆæœ‰ç”¨, ä»¥è‡³äºå®ƒæœ‰ä¸€ä¸ªä¸“é—¨çš„ <code>.comb</code> æ–¹æ³•ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$str</span><span class="o">.</span><span class="nb">comb</span><span class="p">(/</span><span class="se">\d</span><span class="o">+</span><span class="p">/);</span>
</code></pre></div><p>å¦‚æœä½ å¯¹ <code>.split</code> å¾ˆç†Ÿæ‚‰, ä½ å¯ä»¥æƒ³åˆ° <code>.comb</code> å°±æ˜¯å®ƒçš„è¡¨å“¥, å®ƒåŒ¹é… <code>.split</code> ä¸¢å¼ƒçš„ä¸œè¥¿ ã€‚
Perl 5 ä¸­åŒ¹é… IPv4 åœ°å€çš„æ­£åˆ™å¦‚ä¸‹:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">/(</span><span class="se">\d</span><span class="p">{</span><span class="mi">1</span><span class="o">,</span><span class="mi">3</span><span class="p">})</span><span class="sr">\</span><span class="ni">.</span><span class="p">(</span><span class="se">\d</span><span class="p">{</span><span class="mi">1</span><span class="o">,</span><span class="mi">3</span><span class="p">})</span><span class="sr">\</span><span class="ni">.</span><span class="p">(</span><span class="se">\d</span><span class="p">{</span><span class="mi">1</span><span class="o">,</span><span class="mi">3</span><span class="p">})</span><span class="sr">\</span><span class="ni">.</span><span class="p">(</span><span class="se">\d</span><span class="p">{</span><span class="mi">1</span><span class="o">,</span><span class="mi">3</span><span class="p">})/</span>
</code></pre></div><p>è¿™åœ¨ Raku ä¸­æ˜¯æ— æ•ˆçš„ã€‚é¦–å…ˆ, {} å—åœ¨ Raku çš„ æ­£åˆ™ä¸­æ˜¯çœŸæ­£çš„ä»£ç å—ï¼›å®ƒä»¬åŒ…å« Raku ä»£ç ã€‚ç¬¬äºŒ, åœ¨ Raku ä¸­è¯·ä½¿ç”¨ <code>** N..M</code> (æˆ– <code>** N..*</code>)  ä»£æ›¿ <code>{N,M}</code></p>
<p>åœ¨ Raku ä¸­åŒ¹é…1åˆ°3ä½æ•°å­—çš„æ­£åˆ™å¦‚ä¸‹:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">/</span><span class="se">\d</span><span class="sr"> </span><span class="o">**</span><span class="sr"> </span><span class="mi">1</span><span class="o">..</span><span class="mi">3</span><span class="p">/</span>
</code></pre></div><p>åŒ¹é… Ipv4åœ°å€ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">/(</span><span class="se">\d</span><span class="o">**</span><span class="mi">1</span><span class="o">..</span><span class="mi">3</span><span class="p">)</span><span class="sr"> \</span><span class="ni">.</span><span class="sr"> </span><span class="p">(</span><span class="se">\d</span><span class="o">**</span><span class="mi">1</span><span class="o">..</span><span class="mi">3</span><span class="p">)</span><span class="sr"> \</span><span class="ni">.</span><span class="sr"> </span><span class="p">(</span><span class="se">\d</span><span class="o">**</span><span class="mi">1</span><span class="o">..</span><span class="mi">3</span><span class="p">)</span><span class="sr"> \</span><span class="ni">.</span><span class="sr"> </span><span class="p">(</span><span class="se">\d</span><span class="o">**</span><span class="mi">1</span><span class="o">..</span><span class="mi">3</span><span class="p">)/</span>
</code></pre></div><p>é‚£ä»æœ‰ç‚¹ç¬¨æ‹™ã€‚åœ¨ Raku çš„æ­£åˆ™ä¸­, ä½ å¯ä»¥ä½¿ç”¨é‡å¤æ“ä½œç¬¦ <code>%</code> , ä¸‹é¢æ˜¯é‡å¤ <code>(\d ** 1..3)</code> è¿™ä¸ªæ­£åˆ™ 4æ¬¡, å¹¶ä½¿ç”¨ <code>.</code> ç‚¹å·ä½œä¸ºåˆ†éš”ç¬¦ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">/</span><span class="sr"> </span><span class="p">(</span><span class="se">\d</span><span class="sr"> </span><span class="o">**</span><span class="sr"> </span><span class="mi">1</span><span class="o">..</span><span class="mi">3</span><span class="p">)</span><span class="sr"> </span><span class="o">**</span><span class="sr"> </span><span class="mi">4</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">.</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">/</span>
</code></pre></div><p><code>%</code> æ“ä½œç¬¦æ˜¯ä¸€ä¸ªé‡è¯ä¿®é¥°ç¬¦, æ‰€ä»¥å®ƒåªè·Ÿåœ¨ä¸€ä¸ªåƒ <code>*</code> æˆ– <code>+</code> æˆ– <code>**</code> çš„é‡è¯åé¢ã€‚ä¸Šé¢çš„æ­£åˆ™æ„æ€æ˜¯ åŒ¹é… 4 ç»„æ•°å­—, åœ¨æ¯ç»„æ•°å­—é—´æ’å…¥ä¸€ä¸ªç›´æ¥é‡ ç‚¹å· <code>.</code>ã€‚</p>
<p>ä½ ä¹Ÿå¯èƒ½æ³¨æ„åˆ° <code>\.</code> å˜æˆäº† <code>'.'</code> , å®ƒä»¬æ˜¯ä¸€æ ·çš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$_</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">Go 127.0.0.1, I said! He went to 173.194.32.32.</span><span class="p">&#34;;</span>

<span class="nb">say</span> <span class="o">.</span><span class="nb">Str</span> <span class="k">for</span> <span class="k">m</span><span class="p">:</span><span class="na">g</span><span class="p">/</span><span class="sr"> </span><span class="p">(</span><span class="se">\d</span><span class="sr"> </span><span class="o">**</span><span class="sr"> </span><span class="mi">1</span><span class="o">..</span><span class="mi">3</span><span class="p">)</span><span class="sr"> </span><span class="o">**</span><span class="sr"> </span><span class="mi">4</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">.</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">/;</span>
<span class="c1"># output: 127.0.0.1 173.194.32.32</span>
</code></pre></div><p>æˆ–è€…æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>.comb</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$_</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">Go 127.0.0.1, I said! He went to 173.194.32.32.</span><span class="p">&#34;;</span>
<span class="k">my</span> <span class="nv">@ip4addrs</span> <span class="o">=</span> <span class="o">.</span><span class="nb">comb</span><span class="p">(/</span><span class="sr"> </span><span class="p">(</span><span class="se">\d</span><span class="sr"> </span><span class="o">**</span><span class="sr"> </span><span class="mi">1</span><span class="o">..</span><span class="mi">3</span><span class="p">)</span><span class="sr"> </span><span class="o">**</span><span class="sr"> </span><span class="mi">4</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">.</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">/);</span>   <span class="c1"># 127.0.0.1 173.194.32.32</span>
</code></pre></div><p>å¦‚æœæˆ‘ä»¬å¯¹å•ç‹¬çš„æ•°å­—æ„Ÿå…´è¶£ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$_</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">Go 127.0.0.1, I said! He went to 173.194.32.32.</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="o">.</span><span class="nb">list</span><span class="o">&gt;&gt;.</span><span class="nb">Str</span><span class="o">.</span><span class="nb">perl</span> <span class="k">for</span> <span class="k">m</span><span class="p">:</span><span class="na">g</span><span class="p">/</span><span class="sr"> </span><span class="p">(</span><span class="se">\d</span><span class="sr"> </span><span class="o">**</span><span class="sr"> </span><span class="mi">1</span><span class="o">..</span><span class="mi">3</span><span class="p">)</span><span class="sr"> </span><span class="o">**</span><span class="sr"> </span><span class="mi">4</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">.</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">/;</span>
<span class="c1"># output: (&#34;127&#34;, &#34;0&#34;, &#34;0&#34;, &#34;1&#34;) (&#34;173&#34;, &#34;194&#34;, &#34;32&#34;, &#34;32&#34;)</span>
</code></pre></div><h2 id="å¼•å·">å¼•å·</h2>
<p>åœ¨å¾ˆå¤šåœ°æ–¹, Raku éƒ½æä¾›ç»™ä½ æ›´åˆç†çš„é»˜è®¤è®¾ç½®ä»¥ä¾¿åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹è®©ä½ çš„å·¥ä½œå˜å¾—æ›´ç®€å•æœ‰è¶£ã€‚å¼•å·ä¹Ÿä¸ä¾‹å¤–ã€‚</p>
<p>æœ€å¸¸è§çš„ä¸¤ç§å¼•å·å°±æ˜¯å•å¼•å·å’ŒåŒå¼•å·ã€‚å•å¼•å·æœ€ç®€å•ï¼šè®©ä½ å¼•èµ·ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚å”¯ä¸€çš„â€œé­”æ³•â€å°±æ˜¯ä½ å¯ä»¥ç”¨åæ–œæ è½¬ä¹‰ä¸€ä¸ªå•å¼•å·ã€‚è€Œå› ä¸ºåæ–œæ çš„è¿™ä¸ªä½œç”¨, ä½ å¯ä»¥ç”¨ <code>\\</code> æ¥è¡¨ç¤ºåæ–œæ æœ¬èº«äº†ã€‚ä¸è¿‡å…¶å®è¿™ä¸ªåšæ³•ä¹Ÿæ˜¯æ²¡å¿…è¦çš„, åæ–œæ è‡ªå·±å¯ä»¥ç›´æ¥ä¼ é€’ã€‚ä¸‹é¢æ˜¯ä¸€ç»„ä¾‹å­ï¼š</p>
<pre><code>&gt; say 'Everybody loves Magical Trevorâ€™;
Everybody loves Magical Trevor
&gt; say 'Oh wow, it\'s backslashed!â€™;
Oh wow, it's backslashed!
&gt; say 'You can include a \\ like thisâ€™;
You can include a \ like this
&gt; say 'Nothing like \n is availableâ€™;
Nothing like \n is available
&gt; say 'And a \ on its own is no problemâ€™;
And a \ on its own is no problem
</code></pre><p>åŒå¼•å·, é¢, ä»å­—é¢ä¸Šçœ‹å°±çŸ¥é“äº†, ä¸¤å€è‡ªç„¶æ›´å¼ºå¤§äº†ã€‚:-) å®ƒæ”¯æŒåæ–œæ è½¬ä¹‰, ä½†æ›´é‡è¦çš„æ˜¯ä»–æ”¯æŒ<code>å†…æ’</code>ã€‚ä¹Ÿå°±æ˜¯è¯´<code>å˜é‡</code>å’Œ<code>é—­åŒ…</code>å¯ä»¥æ”¾è¿›åŒå¼•å·é‡Œã€‚å¤§å¤§çš„å¸®ä½ èŠ‚çº¦ä½¿ç”¨è¿æ¥æ“ä½œç¬¦æˆ–è€…å­—ç¬¦ä¸²æ ¼å¼å®šä¹‰ç­‰ç­‰çš„æ—¶é—´ã€‚</p>
<p>ä¸‹é¢æ˜¯å‡ ä¸ªç®€å•çš„ä¾‹å­ï¼š</p>
<pre><code>&gt; say &quot;Ooh look!\nLine breaks!&quot;
Ooh look!
Line breaks!
&gt; my $who = 'Ninochka'; say &quot;Hello, dear $who&quot;
Hello, dear Ninochka
&gt; say &quot;Hello, { prompt 'Enter your name: ' }!&quot;
Enter your name: _Jonathan_
Hello, Jonathan!
</code></pre><p>ä¸Šé¢ç¬¬äºŒä¸ªä¾‹å­å±•ç¤ºäº†æ ‡é‡å†…æ’, ç¬¬ä¸‰ä¸ªåˆ™å±•ç¤ºäº†é—­åŒ…ä¹Ÿå¯ä»¥æ’å…¥åŒå¼•å·å­—ç¬¦ä¸²é‡Œã€‚é—­åŒ…äº§ç”Ÿçš„å€¼ä¼šè¢«å­—ç¬¦ä¸²åŒ–ç„¶åæ’å…¥å­—ç¬¦ä¸²ä¸­ã€‚é‚£é™¤äº† <code>$</code> å¼€å¤´çš„å‘¢ï¼Ÿ è§„åˆ™æ˜¯è¿™æ ·çš„ï¼šæ‰€æœ‰çš„éƒ½å¯ä»¥æ’å…¥, ä½†å‰ææ˜¯å®ƒä»¬è¢«æŸäº›åç¯ç¼€(è¯‘è€…æ³¨ï¼špostcircumfix)(ä¹Ÿå°±æ˜¯å¸¦ä¸‹æ ‡æˆ–è€…æ‰©çš„æ•°ç»„æˆ–è€…å“ˆå¸Œ, å¯ä»¥åšå¼•ç”¨æˆ–è€…æ–¹æ³•è°ƒç”¨)å…è®¸ã€‚äº‹å®ä¸Šä½ ä¹Ÿå¯ä»¥æŠŠä»–ä»¬éƒ½å­˜è¿›æ ‡é‡é‡Œã€‚</p>
<pre><code>&gt; my @beer = &lt;Chimay Hobgoblin Yeti&gt;;
Chimay Hobgoblin Yeti
&gt; say &quot;First up, a @beer[0]&quot;
First up, a Chimay
&gt; say &quot;Then @beer[1,2].join(' and ')!&quot;
Then Hobgoblin and Yeti!
&gt; say &quot;Tu je &amp;prompt('Ktore pivo chces? ')&quot;
Ktore pivo chces? _Starobrno_
Tu je Starobrno
</code></pre><p>è¿™é‡Œä½ çœ‹åˆ°äº†ä¸€ä¸ªæ•°ç»„å…ƒç´ çš„å†…æ’, ä¸€ä¸ªè¢«è°ƒç”¨äº†æ–¹æ³•çš„æ•°ç»„åˆ‡ç‰‡çš„å†…æ’å’Œä¸€ä¸ªå‡½æ•°è°ƒç”¨çš„å†…æ’ã€‚åç¯ç¼€è§„åˆ™æ„å‘³ç€æˆ‘ä»¬å†ä¹Ÿä¸ä¼šç ¸æ‰ä½ å£å¹´çš„é‚®ç®±åœ°å€äº†(è¯‘è€…æ³¨ï¼šé‚®ç®±åœ°å€é‡Œæœ‰@å·)ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">&gt;</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Please spam me at blackhole</span><span class="nv">@jnthn</span><span class="s2">.net</span><span class="p">&#34;</span>
<span class="n">Please</span> <span class="n">spam</span> <span class="n">me</span> <span class="nb">at</span> <span class="n">blackhole</span><span class="nv">@jnthn</span><span class="o">.</span><span class="nf">net</span>
</code></pre></div><h3 id="é€‰æ‹©ä½ è‡ªå·±çš„åˆ†éš”ç¬¦">é€‰æ‹©ä½ è‡ªå·±çš„åˆ†éš”ç¬¦</h3>
<p>å•/åŒå¼•å·å¯¹å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½å¾ˆå¥½ç”¨, ä¸è¿‡å¦‚æœä½ æƒ³åœ¨å­—ç¬¦ä¸²é‡Œä½¿ç”¨è¿™äº›å¼•å·çš„æ—¶å€™å’‹åŠï¼Ÿç»§ç»­ç”¨åæ–œæ ä¸æ˜¯ä»€ä¹ˆå¥½ä¸»æ„ã€‚å…¶å®ä½ å¯ä»¥è‡ªå®šä¹‰å…¶ä»–å­—ç¬¦åšä¸ºå¼•å·å­—ç¬¦ã€‚Raku æ›¿ä½ é€‰å¥½äº†ã€‚<code>q</code> å’Œ <code>qq</code> å¼•å·ç»“æ„åé¢ç´§è·Ÿçš„å­—ç¬¦å°±ä¼šè¢«ä½œä¸ºåˆ†éš”ç¬¦ã€‚å¦‚æœè¿™ä¸ªå­—ç¬¦æœ‰ç›¸å¯¹åº”çš„å…³é—­ç¬¦, é‚£ä¹ˆå°±è‡ªåŠ¨æŸ¥æ‰¾è¿™ä¸ªï¼ˆæ¯”å¦‚, å¦‚æœä½ ç”¨äº†ä¸€ä¸ªå¼€å¯èŠ±æ‹¬å·{, é‚£ä¹ˆå­—ç¬¦ä¸²å°±ä¼šåœ¨é—­åˆèŠ±æ‹¬å·}å¤„ç»“æŸã€‚æ³¨æ„ä½ è¿˜å¯ä»¥ä½¿ç”¨å¤šå­—ç¬¦å¼€å¯ç¬¦å’Œé—­åˆç¬¦ï¼ˆä¸è¿‡è¦æ±‚æ˜¯ç›¸åŒå­—ç¬¦é‡å¤ç»„æˆçš„å¤šå­—ç¬¦ï¼‰ï¼‰ã€‚å¦å¤–, <code>q</code> çš„è¯­ä¹‰ç­‰åŒäºå•å¼•å·, <code>qq</code> çš„è¯­ä¹‰ç­‰åŒäºåŒå¼•å·ã€‚</p>
<pre><code>&gt; say q{C'est la vie}
C'est la vie
&gt; say q{{Unmatched } and { are { OK } in { here}}
Unmatched } and { are { OK } in { here
&gt; say qq!Lottery results: {(1..49).roll(6).sort}!
Lottery results: 12 13 26 34 36 46
</code></pre><h3 id="å®šç•Œç¬¦heredoc">å®šç•Œç¬¦(Heredoc)</h3>
<p>æ‰€æœ‰çš„å¼•å·ç»“æ„éƒ½å…è®¸ä½ åŒ…å«å¤šè¡Œå†…å®¹ã€‚ä¸è¿‡, è¿˜æœ‰æ›´å¥½çš„åŠæ³•ï¼šå®šç•Œæ–‡æ¡£ã€‚è¿˜æ˜¯ç”¨ <code>q</code> æˆ–è€… <code>qq</code> å¼€å§‹, ç„¶åè·Ÿä¸Š <code>:to</code> å‰¯è¯æ¥å®šä¹‰æˆ‘ä»¬æœŸæœ›åœ¨æ–‡æœ¬æœ€åæŸè¡ŒåŒ¹é…çš„å­—ç¬¦ã€‚è®©æˆ‘ä»¬é€šè¿‡ä¸‹é¢è¿™ä¸ªæ„Ÿäººçš„æ•…äº‹çœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆå·¥ä½œçš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">print</span> <span class="k">q</span><span class="sa">:to</span><span class="p">/THE END/
</span><span class="p"></span><span class="s">    Once upon a time, there was a pub. The pub had
</span><span class="s">    lots of awesome beer. One day, a Perl workshop
</span><span class="s">    was held near to the pub. The hackers drank
</span><span class="s">    the pub dry. The pub owner could finally afford
</span><span class="s">    a vacation.
</span><span class="s">    </span><span class="p">THE END</span>
</code></pre></div><p>è„šæœ¬çš„è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<pre><code>Once upon a time, there was a pub. The pub had
lots of awesome beer. One day, a Perl workshop
was held near to the pub. The hackers drank
the pub dry. The pub owner could finally afford
a vacation.
</code></pre><p>æ³¨æ„è¾“å‡ºæ–‡æœ¬å¹¶æ²¡æœ‰åƒæºç¨‹åºé‚£æ ·ç¼©è¿›ã€‚å®šç•Œç¬¦ä¼šè‡ªåŠ¨æ¸…æ¥šç¼©è¿›åˆ°ç»ˆç«¯çš„çº§åˆ«ã€‚å¦‚æœæˆ‘ä»¬ç”¨ qq , æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾€å®šç•Œç¬¦é‡Œæ’å…¥ä¸œè¥¿ã€‚æ³¨æ„è¿™äº›éƒ½æ˜¯é€šè¿‡å­—ç¬¦ä¸²çš„ ident æ–¹æ³•å®ç°çš„, ä½†æ˜¯å¦‚æœä½ çš„å­—ç¬¦ä¸²é‡Œæ²¡æœ‰å†…æ’, æˆ‘ä»¬ä¼šåœ¨ç¼–è¯‘æœŸçš„æ—¶å€™è°ƒç”¨ ident ä½œä¸ºä¸€ç§ä¼˜åŒ–æ‰‹æ®µã€‚</p>
<p>ä½ åŒæ ·å¯ä»¥æœ‰å¤šä¸ªå®šç•Œç¬¦, åŒ…æ‹¬è°ƒç”¨å®šç•Œç¬¦é‡Œçš„æ•°æ®çš„æ–¹æ³•ä¹Ÿæ˜¯å¯ä»¥çš„ï¼ˆæ³¨æ„ä¸‹é¢çš„ç¨‹åºå°±è°ƒç”¨äº† lines æ–¹æ³•ï¼‰ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="p">(</span><span class="nv">$input</span><span class="o">,</span> <span class="nv">@searches</span><span class="p">)</span> <span class="o">=</span> <span class="k">q</span><span class="sa">:to</span><span class="p">/INPUT/,</span><span class="s"> q:to/SEARCHES/.lines;
</span><span class="s">    Once upon a time, there was a pub. The pub had
</span><span class="s">    lots of awesome beer. One day, a Perl workshop
</span><span class="s">    was held near to the pub. The hackers drank
</span><span class="s">    the pub dry. The pub owner could finally afford
</span><span class="s">    a vacation.
</span><span class="s">    </span><span class="p">INPUT</span>
    <span class="n">beer</span>
    <span class="n">masak</span>
    <span class="n">vacation</span>
    <span class="n">whisky</span>
    <span class="n">SEARCHES</span>

<span class="k">for</span> <span class="nv">@searches</span> <span class="k">-&gt;</span> <span class="nv">$s</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$input</span> <span class="o">~~</span> <span class="p">/</span><span class="nv">$s</span><span class="p">/</span>
        <span class="o">??</span> <span class="p">&#34;</span><span class="s2">Found </span><span class="nv">$s</span><span class="p">&#34;</span>
        <span class="o">!!</span> <span class="p">&#34;</span><span class="s2">Didn&#39;t find </span><span class="nv">$s</span><span class="p">&#34;;</span>
<span class="p">}</span>
</code></pre></div><p>è¿™ä¸ªç¨‹åºè¾“å‡ºæ˜¯ï¼š</p>
<pre><code>Found beer
Didn't find masak
Found vacation
Didn't find whisky
</code></pre><h3 id="è‡ªå®šä¹‰å¼•å·ç»“æ„çš„å¼•å·å‰¯è¯">è‡ªå®šä¹‰å¼•å·ç»“æ„çš„å¼•å·å‰¯è¯</h3>
<p>å•/åŒå¼•å·çš„è¯­ä¹‰, ä¹Ÿæ˜¯ q å’Œ qq çš„è¯­ä¹‰, å·²ç»å¯ä»¥è§£å†³ç»å¤§å¤šæ•°æƒ…å†µäº†ã€‚ä¸è¿‡å¦‚æœä½ æœ‰è¿™ä¹ˆç§æƒ…å†µï¼šä½ è¦è¾“å‡ºå†…æ’é—­åŒ…è€Œä¸æ˜¯æ ‡é‡æ€ä¹ˆåŠï¼Ÿè¿™æ—¶å€™å°±è¦ç”¨ä¸Šå¼•å·å‰¯è¯äº†ã€‚å®ƒä»¬å†³å®šä½ æ˜¯å¦å¼€å¯å¼•å·ç‰¹æ€§ã€‚ä¸‹é¢æ˜¯ä¾‹å­ï¼š</p>
<pre><code>&gt; say qq:!s&quot;It costs $10 to {&lt;eat nom&gt;.pick} here.&quot;
It costs $10 to eat here.
</code></pre><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† qq è¯­ä¹‰, ä½†æ˜¯å…³é—­é‡Œæ ‡é‡å†…æ’, è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥æ”¾å¿ƒå¾€é‡Œå†™ä»·é’±è€Œä¸ç”¨æ‹…å¿ƒä»–ä¼šè¯•å›¾è§£ææˆä¸Šä¸€æ¬¡æ­£åˆ™åŒ¹é…çš„ç¬¬åä¸€ä¸ªæ•è·å€¼ã€‚æ³¨æ„è¿™é‡Œä½¿ç”¨çš„æ ‡å‡†çš„å†’å·å¯¹(colonpair)è¯­æ³•ã€‚å¦‚æœä½ å¸Œæœ›ä»ä¸€ä¸ªæœ€åŸºç¡€çš„å¼•å·ç»“æ„å¼€å§‹, ç„¶åè‡ªå·±æ‰‹åŠ¨çš„ä¸€ä¸ªä¸ªæ‰“å¼€é€‰é¡¹, é‚£ä¹ˆä½ åº”è¯¥ä½¿ç”¨ Q ç»“æ„ã€‚</p>
<pre><code>&gt; say Q{$*OS\n&amp;sin(3)}
$*OS\n&amp;sin(3)
&gt; say Q:s{$*OS\n&amp;sin(3)}
MSWin32\n&amp;sin(3)
&gt; say Q:s:b{$*OS\n&amp;sin(3)}
MSWin32
&amp;sin(3)
&gt; say Q:s:b:f{$*OS\n&amp;sin(3)}
MSWin32
0.141120008059867
</code></pre><p>è¿™é‡Œæˆ‘ä»¬ç”¨äº†æ— ç‰¹æ€§å¼•å·ç»“æ„, ç„¶åæ‰“å¼€é™„åŠ ç‰¹æ€§, åœ°ä¸€ä¸ªæ˜¯æ ‡é‡å†…æ’, ç„¶åæ˜¯åæ–œæ è½¬ä¹‰, ç„¶åå‡½æ•°å†…æ’ã€‚æ³¨æ„æˆ‘ä»¬åŒæ ·å¯ä»¥é€‰æ‹©è‡ªå·±å¸Œæœ›çš„ä»»ä½•åˆ†éš”ç¬¦ã€‚</p>
<h3 id="å¼•å·ç»“æ„æ˜¯ä¸€é—¨è¯­è¨€">å¼•å·ç»“æ„æ˜¯ä¸€é—¨è¯­è¨€</h3>
<p>æœ€å, å€¼å¾—ä¸€æçš„æ˜¯ï¼šå½“è§£æå™¨è¿›å…¥å¼•å·ç»“æ„çš„æ—¶å€™, å…¶å®ä»–æ˜¯åˆ‡æ¢æˆè§£æå¦å¤–ä¸€ä¸ªè¯­è¨€äº†ã€‚å½“æˆ‘ä»¬ç”¨å‰¯è¯æ„å»ºå¼•å·ç»“æ„çš„æ—¶å€™, ä»–åªä¸è¿‡æ˜¯æŠŠè¿™äº›é¢å¤–çš„è§’è‰²æ··åˆè¿›åŸºç¡€çš„å¼•å·è¯­è¨€é‡Œæ¥å¼€å¯é¢å¤–çš„ç‰¹æ€§ã€‚å¥½å¥‡çš„ç«¥é‹å¯ä»¥çœ‹è¿™é‡Œï¼š Rakudo æ€ä¹ˆåšåˆ°çš„ã€‚è€Œå½“æˆ‘ä»¬ç¢°åˆ°é—­åŒ…æˆ–è€…å…¶ä»–å†…æ’çš„æ—¶å€™, è§£æå™¨å†ä¸´æ—¶åˆ‡æ¢å›ä¸»è¯­è¨€ã€‚æ‰€ä»¥ä½ å¯ä»¥è¿™æ ·å†™ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">&gt;</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hello, </span><span class="p">{</span> <span class="nb">prompt</span> <span class="p">&#34;</span><span class="s2">Enter your name: </span><span class="p">&#34;</span> <span class="p">}</span><span class="s2">!</span><span class="p">&#34;</span>
<span class="n">Enter</span> <span class="nf">your</span> <span class="nb">name</span><span class="o">:</span> <span class="n">Jonathan</span>
<span class="n">Hello</span><span class="o">,</span> <span class="n">Jonathan</span><span class="o">!</span>
</code></pre></div><p>è§£æå™¨ä¸ä¼šå›°æƒ‘äºå†…æ’çš„é—­åŒ…é‡Œåˆå¸¦æœ‰å…¶ä»–åŒå¼•å·å­—ç¬¦ä¸²çš„é—®é¢˜ã€‚å› ä¸ºæˆ‘ä»¬è§£æä¸»è¯­è¨€, ç„¶ååˆ‡æ¢åˆ°å¼•å·è¯­è¨€, ç„¶åè¿”å›ä¸»è¯­è¨€, ç„¶åé‡æ–°å†è¿”å›å¼•å·è¯­è¨€æ¥è§£æè¿™ä¸ªç¨‹åºé‡Œçš„å­—ç¬¦ä¸²é‡Œçš„é—­åŒ…é‡Œçš„å­—ç¬¦ä¸²ã€‚è¿™å°±æ˜¯ Raku è§£æå™¨é€ç»™æˆ‘ä»¬çš„åœ£è¯èŠ‚ç¤¼ç‰©, ä¿„ç½—æ–¯å¥—å¨ƒå¨ƒã€‚</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/calendar" term="calendar" label="calendar" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Sneaking Into a Loop]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-03-23-sneaking-into-a-loop/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2015-03-16-features-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="Raku ä¸­çš„ç‰¹æ€§(äºŒ)" />
                <link href="https://ohmyweekly.github.io/notes/2015-03-14-using-raku/?utm_source=atom_feed" rel="related" type="text/html" title="Using Raku" />
            
                <id>https://ohmyweekly.github.io/notes/2015-03-23-sneaking-into-a-loop/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-10T00:00:00+08:00</published>
            <updated>2021-07-10T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Sneaking Into a Loop</blockquote><h2 id="sneaking-into-a-loop">Sneaking into a loop</h2>
<p>Zoffix å›ç­”äº†ä¸€ä¸ªå…³äº Perl 5 çš„ <code>&lt;&gt;</code> æ“ä½œç¬¦çš„<a href="http://irclog.perlgeek.de/raku/2016-08-09#i_12993090">é—®é¢˜</a>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">slurp</span><span class="o">.</span><span class="nb">words</span><span class="o">.</span><span class="nb">Bag</span><span class="o">.</span><span class="nb">sort</span><span class="p">(</span><span class="o">-*.</span><span class="nb">value</span><span class="p">)</span><span class="o">.</span><span class="nb">fmt</span><span class="p">(&#34;</span><span class="nv">%10s3d</span><span class="s2">\n</span><span class="p">&#34;)</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>
</code></pre></div><p><code>slurp</code> ä¼šä» STDIN ä¸­è¯»å–æ•´ä¸ª &ldquo;file&rdquo; å¹¶è¿”å›ä¸€ä¸ª Strã€‚æ–¹æ³• <code>Str::words</code> ä¼šæŒ‰ç…§æŸç§ Unicode æ„ä¹‰çš„å•è¯æŠŠè¯¥å­—ç¬¦ä¸²åˆ†å‰²æˆä¸€ä¸ªåˆ—è¡¨ã€‚æŠŠåˆ—è¡¨å¼ºè½¬ä¸º Bag åˆ™åˆ›å»ºä¸€ä¸ªè®¡æ•° Hash, å®ƒæ˜¯å¦‚ä¸‹è¡¨è¿°çš„å¿«æ·æ–¹å¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%h</span><span class="p">;</span>
<span class="nv">%h</span><span class="p">{</span><span class="nv">$_</span><span class="p">}</span><span class="o">++</span> <span class="k">for</span> <span class="p">&lt;</span><span class="s">peter paul marry</span><span class="p">&gt;;</span>
<span class="n">dd</span> <span class="nv">%h</span><span class="p">;</span>

<span class="c1"># OUTPUTÂ«Hash %h = {:marry(1), :paul(1), :peter(1)}â¤Â»</span>
</code></pre></div><p>åœ¨å…³è”æ•°ç»„ä¸Šè°ƒç”¨ <code>.sort(-*.value)</code> ä¼šæŒ‰ç…§å€¼çš„é™åºæ’åºå¹¶è¿”å›ä¸€ä¸ªæ’åºåçš„ Pairs åˆ—è¡¨ã€‚List::fmt ä¼šè°ƒç”¨ Pair::fmt, å®ƒè°ƒç”¨ fmt æ–¹æ³•, <code>.key</code> ä½œä¸ºå…¶ç¬¬äºŒä¸ªå‚æ•°, <code>.value</code> ä¹Ÿä½œä¸ºå‚æ•°ã€‚say ä¼šä¼šä½¿ç”¨ä¸€ä¸ªç©ºæ ¼è¿æ¥å„ä¸ªå…ƒç´ å¹¶è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚æœ€åä¸€æ­¥æœ‰ä¸€ç‚¹é”™è¯¯å› ä¸ºé™¤äº†ç¬¬ä¸€è¡Œä¹‹å¤–çš„æ¯ä¸€è¡Œå‰é¢éƒ½ä¼šæœ‰ä¸€ä¸ªé¢å¤–çš„ç©ºæ ¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">slurp</span><span class="o">.</span><span class="nb">words</span><span class="o">.</span><span class="nb">Bag</span><span class="o">.</span><span class="nb">sort</span><span class="p">(</span><span class="o">-*.</span><span class="nb">value</span><span class="p">)</span><span class="o">.</span><span class="nb">fmt</span><span class="p">(&#34;</span><span class="nv">%10s</span><span class="s2"> =&gt; </span><span class="nv">%3d</span><span class="p">&#34;)</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#34;</span><span class="s2">\n</span><span class="p">&#34;)</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>
</code></pre></div><p>æ‰‹åŠ¨è¿æ¥å­—ç¬¦ä¸²æ›´å¥½ã€‚è¿™å¯¹äºç®€çŸ­çš„å•è¡Œç¨‹åºæ¥è¯´æœ‰ç‚¹å¤šäº†ã€‚æˆ‘ä»¬éœ€è¦æ‰¾åˆ°æœ€é•¿çš„å•è¯å¹¶ä½¿ç”¨ <code>.chars</code> æ¥è·å–åˆ—å®½ã€‚</p>
<p>slurp ä¼šåœ¨ <code>$*IN</code> èº«ä¸Šè°ƒç”¨ <code>.slurp-rest</code> æ–¹æ³•ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="vg">$*IN</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">peter paul marry peter paul paul</span><span class="p">&gt;</span> <span class="k">but</span> <span class="k">role</span> <span class="p">{</span> <span class="k">method</span> <span class="nb">slurp-rest</span> <span class="p">{</span> <span class="nb">self</span><span class="o">.</span><span class="nb">Str</span> <span class="p">}</span> <span class="p">};</span>
</code></pre></div><p>è¿™æ˜¯ä¸€ç§ hack å› ä¸ºå®ƒä¼šåœ¨ä»»ä½•å½¢å¼çš„ç±»å‹æ£€æµ‹ä¸Šå¤±è´¥å¹¶ä¸”å®ƒé™¤äº† slurp ä¹‹å¤–ä¸ä¼šå¯¹ä»»ä½•ä¸œè¥¿èµ·ä½œç”¨ã€‚è¿˜æœ‰, å®é™…ä¸Šæˆ‘ä»¬ä» <code>$*IN</code> é‚£é‡Œè§£ç»‘ STDINã€‚ä¸è¦åœ¨å·¥ä½œä¸­ä½¿ç”¨è¿™ä¸ªå¥‡æ·«æŠ€å·§ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬èƒ½å¼€å¿ƒåœ°åå™¬å¹¶å¼€å§‹è®¡æ•°äº†ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%counted-words</span> <span class="o">=</span> <span class="nb">slurp</span><span class="o">.</span><span class="nb">words</span><span class="o">.</span><span class="nb">Bag</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$word-width</span> <span class="o">=</span> <span class="o">[</span><span class="nb">max</span><span class="o">]</span> <span class="nv">%counted-words</span><span class="o">.</span><span class="nb">keys</span><span class="o">Â».</span><span class="nb">chars</span><span class="p">;</span>
</code></pre></div><p>å¹¶ä¸”ç»§ç»­åœ¨é“¾å­æ–­å¼€çš„åœ°æ–¹ç»§ç»­ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">%counted-words</span><span class="o">.</span><span class="nb">sort</span><span class="p">(</span><span class="o">-*.</span><span class="nb">value</span><span class="p">)</span><span class="o">.</span><span class="nb">fmt</span><span class="p">(&#34;</span><span class="s2">%</span><span class="p">{</span><span class="nv">$word-width</span><span class="p">}</span><span class="s2">s3d</span><span class="p">&#34;)</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#34;</span><span class="s2">\n</span><span class="p">&#34;)</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>
</code></pre></div><p>é—®é¢˜è§£å†³äº†ä½†æ˜¯å¾ˆä¸‘é™‹ã€‚æˆ‘ä»¬æŠŠä¸€ä¸ªå•è¡Œç¨‹åºæ‹†å¼€äº†ã€‚æˆ‘ä»¬æ¥ä¿®å¤ fmt ä»¥ä½¿å®ƒå†æ¬¡å®Œæ•´ã€‚</p>
<p>æˆ‘ä»¬æƒ³è¦çš„æ˜¯ä¸€ä¸ª fmt æ–¹æ³•, å®ƒæ¥æ”¶ä¸€ä¸ªä½ç½®çš„(Positional), ä¸€ä¸ª printf é£æ ¼çš„æ ¼å¼å­—ç¬¦ä¸²å’Œä¸€ä¸ªæ ¼å¼å­—ç¬¦ä¸²ä¸­çš„ block per <code>%*</code>ã€‚è¿˜æœ‰, æˆ‘ä»¬å¯èƒ½éœ€è¦åœ¨ self.fmt å‰é¢æ”¾ä¸Šä¸€ä¸ªåˆ†éš”ç¬¦ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="k">multi</span> <span class="k">method</span> <span class="nb">fmt</span><span class="p">(</span><span class="n">Positional:D:</span> <span class="nv">$fmt-str</span><span class="o">,</span> 
                    <span class="o">*</span><span class="nv">@width</span> <span class="k">where</span> <span class="o">*.</span><span class="nb">all</span> <span class="o">~~</span> <span class="nb">Callable</span><span class="o">,</span>
                    <span class="o">:</span><span class="nv">$separator</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2"> </span><span class="p">&#34;){</span>
    <span class="nb">self</span><span class="o">.</span><span class="nb">fmt</span><span class="p">(</span>
        <span class="nv">$fmt-str</span><span class="o">.</span><span class="nb">subst</span><span class="p">(:</span><span class="s">g</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">%*</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">{</span>
            <span class="k">my</span> <span class="nv">&amp;width</span> <span class="o">=</span> <span class="nv">@width</span><span class="o">[</span><span class="nv">$</span><span class="o">++]</span> <span class="o">//</span> <span class="nb">Failure</span><span class="o">.</span><span class="nb">new</span><span class="p">(&#34;</span><span class="s2">missingh block</span><span class="p">&#34;);</span>
            <span class="p">&#39;</span><span class="s1">%</span><span class="p">&#39;</span> <span class="o">~</span> <span class="p">(</span><span class="nv">&amp;width</span><span class="o">.</span><span class="nb">count</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">??</span> <span class="nf">width</span><span class="p">(</span><span class="nb">self</span><span class="o">,</span> <span class="nv">$_</span><span class="p">)</span> <span class="o">!!</span> <span class="nf">width</span><span class="p">(</span><span class="nb">self</span><span class="p">))</span>
        <span class="p">})</span><span class="o">,</span> <span class="nv">$separator</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>è¡¨è¾¾å¼ <code>*.all ~~ Callable</code> æ£€æŸ¥ <a href="https://docs.raku.org/type/Signature#Slurpy_(A.K.A._Variadic)_Parameters">slurp array</a>ä¸­çš„æ‰€æœ‰å…ƒç´ æ˜¯å¦å®ç°äº† CALL-ME(é‚£æ˜¯å®é™…è¢«æ‰§è¡Œçš„æ–¹æ³•åœ¨ä½ æ‰§è¡Œ foo()çš„æ—¶å€™)ã€‚</p>
<p>ç„¶åæˆ‘ä»¬åœ¨æ ¼å¼å­—ç¬¦ä¸²ä¸Šä½¿ç”¨äº† <code>subst</code> æ¥æ›¿æ¢ <code>%*</code>, æ›¿æ¢æ˜¯ä¸€ä¸ª(é—­åŒ…)å—å„¿, å®ƒæ¯æ¬¡åŒ¹é…è¢«è°ƒç”¨ä¸€æ¬¡ã€‚è€Œä¸”è¿™å„¿æˆ‘ä»¬æœ‰ä¸é”™çš„æƒ¯ç”¨æ³•ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">1-a 2-b 3-c</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">subst</span><span class="p">(:</span><span class="s">g</span><span class="o">,</span> <span class="p">/</span><span class="se">\d</span><span class="p">/</span><span class="o">,</span> <span class="p">{&lt;</span><span class="s">one two three</span><span class="p">&gt;</span><span class="o">[</span><span class="nv">$</span><span class="o">++]</span><span class="p">});</span>
<span class="c1"># one-a two-b three-c</span>
</code></pre></div><p>åŒ¿åçŠ¶æ€å˜é‡ <code>$</code> ä» 0  å¼€å§‹è®¡æ•°, æ¯æ¬¡ä»£ç å—æ‰§è¡Œæ—¶å¢ 1ã€‚å®é™…ä¸Šæˆ‘ä»¬åœ¨è¿™å„¿åšçš„å°±æ˜¯ç§»é™¤ä¸€ä¸ªå¾ªç¯å¹¶ç»™ subst å·å·åŠ å…¥ä¸€ä¸ªé¢å¤–çš„è®¡æ•°å™¨å’Œæ•°ç»„ä¸‹æ ‡ã€‚æˆ–è€…å¯ä»¥è¯´æˆ‘ä»¬æ³¨å†Œäº†ä¸€ä¸ªè¿­ä»£å™¨åˆ° subst é‡Œé¢çš„å¾ªç¯ä¸­ã€‚æœ‰äººå¯èƒ½ä¼šè´¨ç–‘ subst åº”è¯¥æ¥æ”¶ä¸€ä¸ª Seq ä½œä¸ºå®ƒçš„ç¬¬äºŒä¸ªä½ç½®å‚æ•°, å®ƒä¼šè®©è°ƒç”¨å˜å¾—å†—é•¿ã€‚æ— è®ºå¦‚ä½•, æˆ‘ä»¬æŠŠæ´è¡¥ä¸Šäº†ã€‚</p>
<p>åœ¨ç¬¬ 11 è¡Œ, æˆ‘ä»¬ä»åå™¬æ•°ç»„ä¸­æ‹¿å‡ºä¸€ä¸ªå…ƒç´ æˆ–è€…åœ¨æ²¡æœ‰å…ƒç´ æ—¶åˆ›å»ºä¸€ä¸ª Failureã€‚æˆ‘ä»¬æŠŠ block å­˜å‚¨åœ¨ä¸€ä¸ªå˜é‡ä¸­å› ä¸ºæˆ‘ä»¬æƒ³åœ¨ç¬¬ 12 è¡Œä¸­å†…çœã€‚å¦‚æœé‚£ä¸ª block æ¥æ”¶ä¸¤ä¸ªä½ç½®å‚æ•°,we feed the topic subst is calling the block with as a 2nd parameter to our stored block. é‚£ç¢°å·§æ˜¯ä¸€ä¸ª Match å¹¶ä¸”å¯¹äºå½±å“æ‰€åŒ¹é…çš„ä¸œè¥¿å¯èƒ½æœ‰ç”¨ã€‚åœ¨æˆ‘ä»¬è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬å¯¹ <code>%*</code> è¿›è¡ŒåŒ¹é…å¹¶ä¸”å½“å‰ä½ç½®ç”± <code>$++</code> è®¡æ•°ã€‚åšå®Œé‚£ä¸ªä¹‹åæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªæ ¼å¼å­—ç¬¦ä¸², å®ƒå¸¦æœ‰ä¸€ä¸ªç”±ç”¨æˆ·æä¾›çš„ fmt ç‰ˆæœ¬çš„åˆ—å®½å‚æ•°ã€‚</p>
<p>ç”¨æˆ·æä¾›çš„å—å„¿ä½¿ç”¨ä¸€ç»„ Pairs è°ƒç”¨ã€‚æˆ‘ä»¬ä¸å¾—ä¸æ·±å…¥ä¸€å±‚ä»¥å¾—åˆ°æ›´å¤§çš„é”®ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">{</span><span class="o">[</span><span class="nb">max</span><span class="o">]</span> <span class="o">.</span><span class="nb">values</span><span class="o">Â».</span><span class="nb">keys</span><span class="o">Â».</span><span class="nb">chars</span><span class="p">}</span>
</code></pre></div><p>å¾—åˆ°ç¬¬ä¸€åˆ—çš„åˆ—å®½ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">print</span> <span class="nv">%counted-words</span><span class="o">.</span><span class="nb">sort</span><span class="p">(</span><span class="o">-*.</span><span class="nb">value</span><span class="p">)</span><span class="o">.&amp;</span><span class="nb">fmt</span><span class="p">(</span>
    <span class="p">&#34;</span><span class="nv">%*s3d</span><span class="p">&#34;</span><span class="o">,</span> 
    <span class="p">{</span><span class="o">[</span><span class="nb">max</span><span class="o">]</span> <span class="o">.</span><span class="nb">values</span><span class="o">Â».</span><span class="nb">keys</span><span class="o">Â».</span><span class="nb">chars</span><span class="p">}</span><span class="o">,</span> 
    <span class="s">separator</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">\n</span><span class="p">&#34;);</span>
</code></pre></div><p>é‚£ä¸ªæ—¶é«¦çš„ <code>.&amp;fmt</code> è°ƒç”¨æ˜¯å¿…é¡»çš„å› ä¸ºæˆ‘ä»¬å…è´¹çš„æµ®ç‚¹æ–¹æ³•ä¸æ˜¯ List çš„æ–¹æ³•ã€‚</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Subset]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-03-19-subset/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-03-19-subset/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-10T00:00:00+08:00</published>
            <updated>2021-07-10T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Subset</blockquote><h2 id="subset-å­é›†">Subset å­é›†</h2>
<p>Subset å¯ç”¨äºå£°æ˜æŸä¸€ç±»å‹çš„å­é›†ã€‚</p>
<p>è¾“å…¥ä¸€ä¸ªå¯†ç ,  è¦æ±‚å¯†ç å¿…é¡»æ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼š</p>
<p>1ã€ è‡³å°‘ 8 ä½
2ã€ å¿…é¡»åŒ…å«å¤§å†™å­—æ¯ã€å°å†™å­—æ¯ å’Œ æ•°å­—</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">subset</span> <span class="nc">Length8</span>      <span class="k">of</span> <span class="nb">Str</span> <span class="k">where</span> <span class="o">*.</span><span class="nb">chars</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span>
<span class="k">subset</span> <span class="nc">UpCase</span>       <span class="k">of</span> <span class="nb">Str</span> <span class="k">where</span> <span class="nb">none</span><span class="p">(&#39;</span><span class="s1">A</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">Z</span><span class="p">&#39;)</span>  <span class="o">âˆˆ</span> <span class="o">*.</span><span class="nb">comb</span><span class="o">.</span><span class="nb">Set</span><span class="p">;</span>
<span class="k">subset</span> <span class="nc">LowerCase</span>    <span class="k">of</span> <span class="nb">Str</span> <span class="k">where</span> <span class="nb">none</span><span class="p">(&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">z</span><span class="p">&#39;)</span>  <span class="o">âˆˆ</span> <span class="o">*.</span><span class="nb">comb</span><span class="o">.</span><span class="nb">Set</span><span class="p">;</span>
<span class="k">subset</span> <span class="nc">IntNumber</span>    <span class="k">of</span> <span class="nb">Str</span> <span class="k">where</span> <span class="nb">none</span><span class="p">(&#39;</span><span class="s1">0</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">9</span><span class="p">&#39;)</span>  <span class="o">âˆˆ</span> <span class="o">*.</span><span class="nb">comb</span><span class="o">.</span><span class="nb">Set</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$guess</span> <span class="o">=</span> <span class="nb">prompt</span><span class="p">(&#39;</span><span class="s1">Enter your password:</span><span class="p">&#39;);</span>

<span class="k">given</span> <span class="nv">$guess</span> <span class="p">{</span>
    <span class="k">when</span> <span class="n">Length8</span>     <span class="p">{</span> <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">å¯†ç é•¿åº¦å¿…é¡»ä¸º 8 ä½ ä»¥ä¸Š</span><span class="p">&#39;;</span> <span class="k">proceed</span> <span class="p">}</span>
    <span class="k">when</span>  <span class="n">UpCase</span>     <span class="p">{</span> <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">å¯†ç å¿…é¡»åŒ…æ‹¬å¤§å†™å­—æ¯</span><span class="p">&#39;;</span>     <span class="k">proceed</span> <span class="p">}</span>
    <span class="k">when</span> <span class="n">LowerCase</span>   <span class="p">{</span> <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">å¯†ç å¿…é¡»åŒ…å«å°å†™å­—æ¯</span><span class="p">&#39;;</span>     <span class="k">proceed</span> <span class="p">}</span>
    <span class="k">when</span> <span class="n">IntNumber</span>   <span class="p">{</span> <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">å¯†ç å¿…é¡»åŒ…å«æ•°å­—</span><span class="p">&#39;;</span>                <span class="p">}</span>   
 <span class="p">}</span>
</code></pre></div><p>è¯¥ç¨‹åºå…·æœ‰å¯æ‰©å±•æ€§, è¦å¢åŠ ä¸€ç§å¯†ç éªŒè¯, åªæœ‰æ·»åŠ ä¸€ä¸ª subset å°±å¥½äº†, ç„¶ååœ¨ <code>given/when</code> é‡Œé¢å¢åŠ ä¸€ä¸ªå¤„ç†ã€‚</p>
<p><code>proceed</code> ç›¸å½“äº <code>continue</code>, ä¸åƒ C é‡Œé¢çš„ falling through, Raku é‡Œé¢çš„ proceed åœ¨ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ª <code>when</code> è¯­å¥æ—¶ä¼šè®¡ç®— when åé¢çš„æ¡ä»¶ã€‚æ‰€ä»¥, åªè¦æœ‰ proceed, åˆ™ proceed åé¢çš„é‚£ä¸ªæ¡ä»¶å°±ä¼šè¢«æ‰§è¡Œã€‚</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/subset" term="subset" label="subset" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[When and Where]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-03-15-when-and-where/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-03-15-when-and-where/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-10T00:00:00+08:00</published>
            <updated>2021-07-10T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>When and Where</blockquote><h2 id="when-å¯ä»¥ç”¨åœ¨ä¸»é¢˜åŒ–_çš„è¯­å¥ä¸­">When å¯ä»¥ç”¨åœ¨ä¸»é¢˜åŒ–(<code>$_</code>)çš„è¯­å¥ä¸­</h2>
<p>Raku é‡Œé¢æœ‰ä¸ªç‰¹æ®Šçš„å˜é‡å« <code>$_</code>, å³ä¸»é¢˜åŒ–å˜é‡, the variable in question.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="p">(&#39;</span><span class="s1">Swift</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">PHP</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Python</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Perl</span><span class="p">&#39;)</span> <span class="k">-&gt;</span> <span class="nv">$item</span>  <span class="p">{</span> 
    <span class="nb">say</span> <span class="nv">$item</span> <span class="k">when</span> <span class="nv">$item</span> <span class="o">~~</span> <span class="p">/</span><span class="ni">^</span><span class="sr">P</span><span class="p">/;</span>
<span class="p">}</span> 
</code></pre></div><p>è¾“å‡º:</p>
<pre><code>PHP
Python
Perl
</code></pre><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="p">(</span><span class="mi">12</span><span class="o">,</span> <span class="mi">24</span><span class="o">,</span> <span class="mi">56</span><span class="o">,</span> <span class="mi">42</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">.</span><span class="nb">say</span> <span class="k">when</span> <span class="o">*&gt;</span><span class="mi">40</span> 
<span class="p">}</span>
</code></pre></div><p>è¾“å‡º:</p>
<pre><code>56
42
</code></pre><p>è€Œ <em>where</em> ç”¨äºå¯¹ç±»å‹è¿›è¡Œçº¦æŸ:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="p">(&#39;</span><span class="s1">Swift</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">PHP</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Python</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Perl</span><span class="p">&#39;</span><span class="o">,</span> <span class="mi">42</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nv">$item</span> <span class="k">where</span> <span class="nv">$item</span> <span class="o">~~</span> <span class="nb">Str</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$item</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>è¾“å‡º:</p>
<pre><code>Swift                                                                               
PHP                                                                                 
Python                                                                              
Perl                                                                                    
Constraint type check failed for parameter '$item'       
</code></pre>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/where" term="where" label="where" />
                             
                                <category scheme="https://ohmyweekly.github.io/tags/when" term="when" label="when" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku åœ£è¯æœˆå† - 2014]]></title>
            <link href="https://ohmyweekly.github.io/notes/2014-12-19-raku-calendar/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2014-12-19-raku-calendar/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-07T00:00:00+08:00</published>
            <updated>2021-07-07T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Raku Calendar</blockquote><h2 id="data-munging-in-raku">Data munging in Raku</h2>
<p>æ¡ˆä¾‹å­¦ä¹ : ç”Ÿæˆæˆç»©æŠ¥å‘Šå•</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">example.txt
STDOUT
Peter	B
Celine	A-
ZsÃ³fia	B+
JoÃ£o	F
Maryam	B+
ç§€è‹±	B-
Finn	D+
Aarav	A
Emma	F
Omar	B
</code></pre></div><p>è¾“å‡ºæŠ¥å‘Šå•ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">ZsÃ³fia&#39;s grade: B+
List of students with a failing grade:
  JoÃ£o, Emma
Distribution of grades by letter:
  A: 2 students
  B: 5 students
  D: 1 student
  F: 2 students
</code></pre></div><p>example.txt æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶, æ¯è¡Œä¸€ä¸ªå­¦ç”Ÿå§“åå’Œåˆ†æ•°, ä¸­é—´ç”¨ç©ºæ ¼åˆ†å‰²ã€‚
æˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„è„šæœ¬èƒ½è§£æè¿™æ ·çš„æ–‡ä»¶å¹¶æ‰“å°å«æœ‰å¦‚ä¸‹ä¿¡æ¯çš„æŠ¥å‘Šï¼š</p>
<p>å­¦ç”Ÿåä¸º â€œZsÃ³fiaâ€ çš„æˆç»©<br>
æ‰€æœ‰ä¸åŠæ ¼å­¦ç”Ÿçš„åå­— (i.e. worse than D-),<br>
æ ¹æ®å­—æ¯( ä¸å¸¦ <code>+</code>/<code>-</code> ) æŠŠæˆç»©åˆ†ç»„ã€‚å¾—åˆ°å­¦ç”Ÿæˆç»©çš„åˆ†å¸ƒã€‚</p>
<p>è®©æˆ‘ä»¬ä¸€æ­¥æ­¥æ¥, æ·»åŠ  shebang è¡Œ:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#!/usr/bin/env raku</span>
</code></pre></div><p>åœ¨ Raku ä¸­æ‰€æœ‰è¿™äº›éƒ½ä¸ºæˆ‘ä»¬åšå¥½äº†ã€‚</p>
<p>è¯»å–å¹¶è§£æè¾“å…¥:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%grade</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">grades.txt</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">lines</span><span class="o">.</span><span class="nb">map</span><span class="o">:</span> <span class="p">{</span>
   <span class="k">m</span><span class="p">:</span><span class="na">s</span><span class="p">/</span><span class="ni">^</span><span class="p">(</span><span class="se">\w</span><span class="o">+</span><span class="p">)</span><span class="sr"> </span><span class="p">(&lt;[</span><span class="sr">A</span><span class="o">..</span><span class="sr">F</span><span class="p">]&gt;&lt;[</span><span class="sr">+-</span><span class="p">]&gt;</span><span class="o">?</span><span class="p">)</span><span class="ni">$</span><span class="p">/</span>
        <span class="ow">or</span> <span class="nb">die</span> <span class="p">&#34;</span><span class="s2">Can&#39;t parse line &#39;</span><span class="nv">$_&#39;</span><span class="p">&#34;;</span>
    <span class="o">~</span><span class="nv">$0</span> <span class="o">=&gt;</span> <span class="o">~</span><span class="nv">$1</span>
<span class="p">};</span>
</code></pre></div><p>åœ¨ Raku ä¸­, å¯¹æ–‡ä»¶åå­—ç¬¦ä¸²è°ƒç”¨ <a href="https://docs.raku.org/type/IO::Path">.IO</a> æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªä»£è¡¨æ–‡ä»¶ç³»ç»Ÿè·¯å¾„çš„å¯¹è±¡, æˆ‘ä»¬å¯ä»¥ç»§ç»­åœ¨è¿™ä¸ªå¯¹è±¡ä¸Šè°ƒç”¨ <a href="https://docs.raku.org/routine/lines">.lines</a> æ–¹æ³•, å¾—åˆ°æ–‡ä»¶çš„æ‰€æœ‰è¡Œçš„ä¸€ä¸ªæƒ°æ€§åˆ—è¡¨ã€‚â€œLazyâ€ æ„å‘³ç€å®ƒåªä¼šä»ç£ç›˜ä¸­æŒ‰éœ€è¯»å–æ–°è¡Œ, å½“æˆ‘ä»¬ä½¿ç”¨ <a href="https://docs.raku.org/routine/map">.map</a> æ–¹æ³•éå†åˆ—è¡¨å…ƒç´ çš„æ—¶å€™, è¿™æ ·èƒ½ä½¿ç”¨å•ä¸ªèµ‹å€¼æ“ä½œå°±èƒ½ä¼˜é›…åœ°åˆå§‹åŒ–ä¸€ä¸ªæ•£åˆ—ã€‚</p>
<p>æˆ‘ä»¬ä¸éœ€è¦è®©æ–‡ä»¶å¥æŸ„è¯†åˆ« Unicode, ä¹Ÿä¸ç”¨ç®¡æ–‡ä»¶å¥æŸ„æ˜¯å¦æ­£ç¡®å…³é—­, è¿™åœ¨ Raku ä¸­éƒ½æ˜¯é»˜è®¤å‘ç”Ÿçš„ã€‚</p>
<p><code>method: ...</code> è¯­æ³•ä¹Ÿå¯ä»¥å†™ä¸º <code>.method(...)</code>, å‰è€…ä½¿ map çœ‹èµ·æ¥æ›´åƒä¸€ä¸ª block è¯­å¥, å¹¶å‡å°‘äº†æ‹¬å·å‡Œä¹±ã€‚
<code>:s</code>(&ldquo;sigspace&rdquo;) æ­£åˆ™ä¿®é¥°ç¬¦ä½¿è§£æ token é—´çš„ç©ºç™½æ›´ä¼˜é›…ã€‚ä½† Raku ä¸­çš„å­—ç¬¦ç±»æ¯” Perl 5 å¤æ‚äº†ä¸€ä¸¢ä¸¢ã€‚
æ­£åˆ™æ•è·ç»“æœå˜é‡(<code>$0</code>, <code>$1</code>, â€¦) è¿”å›ä¸€ä¸ªå®Œæ•´çš„ <a href="https://docs.raku.org/type/Match">Match</a> å¯¹è±¡ - å®ƒä¸ºå¤æ‚ä½¿ç”¨åœºæ™¯å¢åŠ äº†å¾ˆå¤šçµæ´»æ€§, ä½†æ˜¯è¿™é‡Œæˆ‘ä»¬åªæƒ³ä¿ç•™å­—ç¬¦ä¸², æ‰€ä»¥ä½¿ç”¨ <a href="https://docs.raku.org/routine/~">~</a> å‰ç½®æ“ä½œç¬¦å­—ç¬¦ä¸²åŒ–äº†åŒ¹é…å¯¹è±¡ã€‚</p>
<p>æŸ¥çœ‹æ•°æ®çš„ç‰¹å®šé¡¹:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">ZsÃ³fia&#39;s grade: </span><span class="nv">%grade</span><span class="p">&lt;</span><span class="s">ZsÃ³fia</span><span class="p">&gt;&#34;;</span>
</code></pre></div><p>Raku æ€»æ˜¯æŠŠæ•£åˆ—ä¸­ <code>{ }</code> ä¸­çš„ä¸œè¥¿è§£æä¸ºè¡¨è¾¾å¼, ä½¿ç”¨ <code>&lt; &gt;</code> è¡¨ç¤ºå­—é¢å€¼ã€‚</p>
<p>è¿‡æ»¤æ•°æ®:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">List of students with a failing grade:</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">  </span><span class="p">&#34;</span> <span class="o">~</span> <span class="nv">%grade</span><span class="o">.</span><span class="nb">grep</span><span class="p">(</span><span class="o">*.</span><span class="nb">value</span> <span class="ow">ge</span> <span class="p">&#34;</span><span class="s2">E</span><span class="p">&#34;)</span><span class="o">Â».</span><span class="nb">key</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#34;</span><span class="s2">, </span><span class="p">&#34;);</span>
</code></pre></div><p>Raku ä¸­å…è®¸æˆ‘ä»¬æŒ‰æ‰§è¡Œé¡ºåºæŠŠä¸€äº›åˆ—æ–¹æ³•å†™ä¸ºé“¾å¼æ“ä½œã€‚æœ‰ä¸€ä¸ªé‡è¦åŒºåˆ«ï¼šRaku èƒ½è®©æˆ‘ä»¬ç›´æ¥éå†æ•£åˆ—çš„é¡¹, æ•£åˆ—ä¸­æ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ª <a href="https://docs.raku.org/type/Pair">Pair</a> å¯¹è±¡(Pair å¯¹è±¡èƒ½ä½¿ç”¨ <a href="https://docs.raku.org/type/Pair#method_key">.key</a> å’Œ <a href="https://docs.raku.org/type/Pair#method_value">.value</a> æ–¹æ³•)ã€‚</p>
<p><code>*</code> <a href="https://docs.raku.org/type/Whatever">Whatever</a> star ç”¨äºå®šä¹‰ä¸€ä¸ªç®€å•çš„å›è°ƒ, è€Œä¸ç”¨å†™ä¸€ä¸ªèŠ±æ‹¬å·å—ã€‚
<code>Â».</code> <a href="https://docs.raku.org/language/operators#index-entry-hyper_%3C%3C-hyper_%3E%3E-hyper_%C2%AB-hyper_%C2%BB-Hyper_operators">hyper operator</a> ç”¨äºå¯¹ <a href="https://docs.raku.org/routine/grep">.grep</a> è¿”å›çš„ Pairs çš„æ¯ä¸ª Pair ä¸Šè°ƒç”¨ ä¸€æ¬¡ .key æ–¹æ³•, å¾—å‡ºå§“ååˆ—è¡¨</p>
<p>ä»æ•°æ®ä¸­åˆ›å»ºé¢‘ç‡åˆ†å¸ƒ:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Distribution of grades by letter:</span><span class="p">&#34;;</span>
<span class="nb">say</span> <span class="p">&#34;{</span><span class="o">.</span><span class="nb">key</span><span class="p">}</span><span class="s2">: </span><span class="p">{</span><span class="o">+.</span><span class="nb">value</span><span class="p">}</span><span class="s2"> student</span><span class="p">{&#34;</span><span class="s2">s</span><span class="p">&#34;</span> <span class="k">if</span> <span class="o">.</span><span class="nb">value</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">}&#34;</span>

<span class="k">for</span> <span class="nv">%grade</span><span class="o">.</span><span class="nb">classify</span><span class="p">(</span><span class="o">*.</span><span class="nb">value</span><span class="o">.</span><span class="nb">comb</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">)</span><span class="o">.</span><span class="nb">sort</span><span class="p">(</span><span class="o">*.</span><span class="nb">key</span><span class="p">);</span>
</code></pre></div><p>è®¡æ•°å’Œåˆ†ç»„å®åœ¨å¤ªå¸¸è§äº†, Raku æä¾›äº† <a href="https://docs.raku.org/routine/classify">.classify</a> æ–¹æ³•ã€‚
classify æ–¹æ³•é‡Œéœ€è¦æŒ‡å®šè¦åˆ†ç»„çš„é¡¹(è¿™é‡Œæ˜¯ä»£è¡¨ <code>%grade</code> æ¡ç›®çš„ Pair å¯¹è±¡), è¿™äº›é¡¹åº”è¯¥æ ¹æ®ä»€ä¹ˆè§„åˆ™è¿›è¡Œåˆ†ç»„(è¿™é‡Œæ˜¯æ ¹æ®ç¬¬ä¸€ä¸ªå­—æ¯çš„å€¼, å®ƒä»£è¡¨åˆ†æ•°(æ²¡æœ‰ <code>+</code>/<code>-</code>)ã€‚</p>
<p>è¿™ç”Ÿæˆä¸€ä¸ªåŒ¿åçš„æ•£åˆ—, æ•£åˆ—çš„å€¼æ˜¯åŒ¿åæ•°ç»„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">%(&#34;B&#34; =&gt; [&#34;Peter&#34; =&gt; &#34;B&#34;, &#34;ZsÃ³fia&#34; =&gt; &#34;B+&#34;, &#34;Maryam&#34; =&gt; &#34;B+&#34;,
 &#34;ç§€è‹±&#34; =&gt; &#34;B-&#34;, &#34;Omar&#34; =&gt; &#34;B&#34;], &#34;A&#34; =&gt; [&#34;Celine&#34; =&gt; &#34;A-&#34;, &#34;Aarav&#34; =&gt; &#34;A&#34;], &#34;F&#34; =&gt; [&#34;JoÃ£o&#34; =&gt; &#34;F&#34;, &#34;Emma&#34; =&gt; &#34;F&#34;], &#34;D&#34; =&gt; [&#34;Finn&#34; =&gt; &#34;D+&#34;])
</code></pre></div><p>å› ä¸ºæˆ‘ä»¬åªå¯¹æ¯ç»„å…ƒç´ çš„ä¸ªæ•°æ„Ÿå…´è¶£, æˆ‘ä»¬ä½¿ç”¨ <a href="https://docs.raku.org/routine/+">+</a> å‰ç½®æ“ä½œç¬¦æ•°å­—åŒ–æ¯ä¸ªå€¼ç„¶åæ‰“å°å®ƒ, åœ¨æ•°ç»„å‰é¢æ·»åŠ  <code>+</code> ç¬¦å·ä¼šå¾—åˆ°æ•°ç»„å…ƒç´ çš„ä¸ªæ•°ã€‚</p>
<p>åœ¨ term ä½ç½®ä¸Šä¸€ä¸ªå•ç‹¬çš„ <code>.method</code> æ–¹æ³•ç­‰ä»·äº <code>$_.method</code>, æ„æ€æ˜¯å¯¹å½“å‰å¾ªç¯å˜é‡è°ƒç”¨è¯¥æ–¹æ³•ã€‚ä»»æ„ä»£ç çš„è¿”å›å€¼èƒ½ä½¿ç”¨èŠ±æ‹¬å· <code>{}</code> æ’å€¼åˆ°å­—ç¬¦ä¸²ä¸­ã€‚</p>
<p><code>if</code> è¯­å¥èƒ½è¢«ç”¨ä½œè¡¨è¾¾å¼ - å½“æ¡ä»¶ä¸º false æ—¶, è¿”å›ç©ºåˆ—è¡¨, ç„¶åè¢«å­—ç¬¦ä¸²åŒ–ä¸ºç©ºå­—ç¬¦ä¸²ã€‚å¯¹å­—ç¬¦ä¸²è°ƒç”¨ä¸å¸¦å‚æ•°çš„ <a href="https://docs.raku.org/routine/comb">.comb</a> ä¼šç”Ÿæˆè¯¥å­—ç¬¦ä¸²çš„ä¸€ä¸ªå­—ç¬¦åˆ—è¡¨ã€‚</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/calendar" term="calendar" label="calendar" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Using Raku]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-03-14-using-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-03-14-using-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-07-07T00:00:00+08:00</published>
            <updated>2021-07-07T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Using Raku</blockquote><h2 id="ç¬¬ä¸€ç« -æ¦‚è¦">ç¬¬ä¸€ç«  æ¦‚è¦</h2>
<p>ç•¥</p>
<h2 id="ç¬¬äºŒç« -åŸºç¡€">ç¬¬äºŒç«  åŸºç¡€</h2>
<p>å‡è®¾æœ‰ä¸€åœºä¹’ä¹“çƒæ¯”èµ›, æ¯”èµ›ç»“æœä»¥è¿™ç§æ ¼å¼è®°å½•ï¼š</p>
<pre><code>Player1 Player2 | 3:2
</code></pre><p>è¿™æ„å‘³ç€é€‰æ‰‹1ä¸é€‰æ‰‹2çš„æ¯”åˆ†ä¸º 3:2, ä½ éœ€è¦ä¸€ä¸ªè„šæœ¬ç®—å‡ºæ¯ä½é€‰æ‰‹èµ¢äº†å‡ åœºæ¯”èµ›å¹¶ä¸”èƒœäº†å‡ å±€ã€‚è¾“å…¥æ•°æ®(å­˜å‚¨åœ¨ä¸€ä¸ªå«åš scores çš„æ–‡ä»¶ä¸­)åƒä¸‹é¢è¿™æ ·ï¼š</p>
<pre><code>Beth Ana Charlie Dave
Ana Dave        | 3:0
Charlie Beth    | 3:1
Ana Beth        | 2:3
Dave Charlie    | 3:0
Ana Charlie     | 3:1
Beth Dave       | 0:3
</code></pre><p>ç¬¬ä¸€è¡Œæ˜¯é€‰æ‰‹æ¸…å•ã€‚éšåæ¯ä¸€è¡Œè®°å½•ç€æ¯”èµ›ç»“æœã€‚</p>
<p>è¿™é‡Œä½¿ç”¨ Raku ç»™å‡ºä¸€ç§è§£å†³æ–¹æ¡ˆï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#!/usr/bin/env raku</span>

<span class="k">my</span> <span class="nv">$file</span> <span class="o">=</span> <span class="nb">open</span> <span class="p">&#39;</span><span class="s1">scores</span><span class="p">&#39;;</span>
<span class="k">my</span> <span class="nv">@names</span> <span class="o">=</span> <span class="nv">$file</span><span class="o">.</span><span class="nb">get</span><span class="o">.</span><span class="nb">words</span> <span class="p">;</span>  <span class="c1"># get æ–¹æ³•è¯»å…¥ä¸€è¡Œ, æ¯è°ƒç”¨ä¸€æ¬¡ get, è¯»å–ä¸€è¡Œ</span>
<span class="k">my</span> <span class="nv">%matches</span><span class="p">;</span>                   <span class="c1"># èµ¢å¾—æ¯”èµ›æ¬¡æ•°</span>
<span class="k">my</span> <span class="nv">%sets</span><span class="p">;</span>                      <span class="c1"># èµ¢å¾—æ¯”èµ›å±€æ•°</span>

<span class="k">for</span> <span class="nv">$file</span><span class="o">.</span><span class="nb">lines</span> <span class="k">-&gt;</span> <span class="nv">$line</span> <span class="p">{</span>                       <span class="c1"># .lines æ˜¯æƒ°æ€§çš„</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$pairing</span><span class="o">,</span> <span class="nv">$result</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$line</span><span class="o">.</span><span class="nb">split</span><span class="p">(&#39;</span><span class="s1"> | </span><span class="p">&#39;);</span> <span class="c1"># å¯¹å‰©ä¸‹çš„æ¯ä¸€è¡Œè°ƒç”¨ split æ“ä½œ</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$p1</span><span class="o">,</span> <span class="nv">$p2</span><span class="p">)</span>          <span class="o">=</span> <span class="nv">$pairing</span><span class="o">.</span><span class="nb">words</span><span class="p">;</span>     <span class="c1"># æå–é€‰æ‰‹1å’Œé€‰æ‰‹2çš„åå­—</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$r1</span><span class="o">,</span> <span class="nv">$r2</span><span class="p">)</span>          <span class="o">=</span> <span class="nv">$result</span><span class="o">.</span><span class="nb">split</span><span class="p">(&#39;</span><span class="s1">:</span><span class="p">&#39;);</span> <span class="c1"># æå–æ¯”èµ›æ¯”åˆ†</span>

    <span class="nv">%sets</span><span class="p">{</span><span class="nv">$p1</span><span class="p">}</span> <span class="o">+=</span> <span class="nv">$r1</span><span class="p">;</span>  <span class="c1"># é€‰æ‰‹1èµ¢å¾—çš„æ¯”èµ›å±€æ•°</span>
    <span class="nv">%sets</span><span class="p">{</span><span class="nv">$p2</span><span class="p">}</span> <span class="o">+=</span> <span class="nv">$r2</span><span class="p">;</span>  <span class="c1"># é€‰æ‰‹2èµ¢å¾—çš„æ¯”èµ›å±€æ•°</span>

    <span class="k">if</span> <span class="nv">$r1</span> <span class="o">&gt;</span> <span class="nv">$r2</span> <span class="p">{</span> <span class="c1"># å¦‚æœæ¯åœºæ¯”èµ›ä¸­, é€‰æ‰‹1èµ¢çš„å±€æ•°å¤šäºé€‰æ‰‹2, åˆ™é€‰æ‰‹1èµ¢å¾—çš„æ¯”èµ›æ•°+1, åä¹‹é€‰æ‰‹2çš„+1</span>
        <span class="nv">%matches</span><span class="p">{</span><span class="nv">$p1</span><span class="p">}</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">%matches</span><span class="p">{</span><span class="nv">$p2</span><span class="p">}</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">@sorted</span> <span class="o">=</span> <span class="nv">@names</span><span class="o">.</span><span class="nb">sort</span><span class="p">(</span> <span class="p">{</span> <span class="nv">%sets</span><span class="p">{</span><span class="nv">$_</span><span class="p">}</span> <span class="p">}</span> <span class="p">)</span><span class="o">.</span><span class="nb">sort</span><span class="p">({</span> <span class="nv">%matches</span><span class="p">{</span><span class="nv">$_</span><span class="p">}</span> <span class="p">}</span> <span class="p">)</span><span class="o">.</span><span class="nb">reverse</span><span class="p">;</span>

<span class="k">for</span> <span class="nv">@sorted</span> <span class="k">-&gt;</span> <span class="nv">$n</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$n</span><span class="s2"> has won </span><span class="nv">%matches</span><span class="p">{</span><span class="nv">$n</span><span class="p">}</span><span class="s2"> matches and </span><span class="nv">%sets</span><span class="p">{</span><span class="nv">$n</span><span class="p">}</span><span class="s2"> sets</span><span class="p">&#34;;</span>
<span class="p">}</span>
</code></pre></div><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<pre><code>Ana has won 2 matches and 8 sets
Dave has won 2 matches and 6 sets
Charlie has won 1 matches and 4 sets
Beth has won 1 matches and 4 sets
</code></pre><p>æ¯ä¸ª Raku ç¨‹åºåº”è¯¥ä»¥ <code>#!/usr/bin/env raku</code> ä½œä¸ºå¼€å§‹ã€‚</p>
<p>åœ¨ Raku ä¸­, å˜é‡åä»¥ä¸€ä¸ªé­”ç¬¦æ‰“å¤´, è¿™ä¸ªé­”ç¬¦æ˜¯ä¸€ä¸ªéå­—æ¯æ•°å­—ç¬¦å·, è¯¸å¦‚ <code>$</code>, <code>@</code>, <code>%</code> æˆ–è€… <code>&amp;</code>, è¿˜æœ‰æ›´å°‘è§çš„åŒå†’å· <code>::</code>ã€‚
å†…ç½®å‡½æ•° <a href="https://docs.raku.org/routine/open">open</a> æ‰“å¼€äº†ä¸€ä¸ªåå« scores çš„æ–‡ä»¶, å¹¶è¿”å›ä¸€ä¸ªæ–‡ä»¶å¥æŸ„, å³ä¸€ä¸ªä»£è¡¨è¯¥æ–‡ä»¶çš„å¯¹è±¡ã€‚èµ‹å€¼ç¬¦å· <code>=</code> å°†å¥æŸ„èµ‹å€¼ç»™å·¦è¾¹çš„å˜é‡, è¿™æ„å‘³ç€ <code>$file</code> ç°åœ¨å­˜å‚¨ç€è¯¥æ–‡ä»¶å¥æŸ„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@names</span> <span class="o">=</span> <span class="nv">$file</span><span class="o">.</span><span class="nb">get</span><span class="o">.</span><span class="nb">words</span><span class="p">;</span>
</code></pre></div><p>ä¸Šè¾¹è¿™å¥çš„å³ä¾§å¯¹å­˜å‚¨åœ¨ <code>$file</code> ä¸­çš„æ–‡ä»¶å¥æŸ„è°ƒç”¨äº† <a href="https://docs.raku.org/routine/get">get</a> æ–¹æ³•, <code>get</code> æ–¹æ³•ä»æ–‡ä»¶ä¸­è¯»å–å¹¶è¿”å›ä¸€è¡Œ, å¹¶å»æ‰è¡Œçš„æœ«å°¾ã€‚<a href="https://docs.raku.org/routine/words">.words</a> ä¹Ÿæ˜¯ä¸€ä¸ªæ–¹æ³•, ç”¨äºä» get æ–¹æ³•è¿”å›çš„å­—ç¬¦ä¸²ä¸Šã€‚<code>.words</code> æ–¹æ³•å°†å®ƒçš„ç»„ä»¶ - å®ƒæ“ä½œçš„å­—ç¬¦ä¸², åˆ†è§£æˆä¸€ç»„å•è¯, è¿™é‡Œå³æ„å‘³ç€ä¸å«ç©ºæ ¼çš„å­—ç¬¦ä¸²ã€‚å®ƒæŠŠå•ä¸ªå­—ç¬¦ä¸² &lsquo;Beth Ana Charlie Dave&rsquo; è½¬æ¢æˆä¸€ç»„å­—ç¬¦ä¸² &lsquo;Beth&rsquo;, &lsquo;Ana&rsquo;, &lsquo;Charlie&rsquo;, &lsquo;Dave&rsquo;ã€‚æœ€å, è¿™ç»„å­—ç¬¦ä¸²å­˜å‚¨åœ¨æ•°ç»„ <code>@names</code> ä¸­ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%matches</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">%sets</span><span class="p">;</span>
</code></pre></div><p>åœ¨æ¯”åˆ†è®¡æ•°ç¨‹åºä¸­, <code>%matches</code> å­˜å‚¨æ¯ä½é€‰æ‰‹èµ¢å¾—çš„æ¯”èµ›æ•°, <code>%sets</code> å­˜å‚¨æ¯ä½é€‰æ‰‹èµ¢å¾—çš„æ¯”èµ›å±€æ•°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="nv">$file</span><span class="o">.</span><span class="nb">lines</span> <span class="k">-&gt;</span> <span class="nv">$line</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre></div><p>for å¾ªç¯ä¸­ $file.lines äº§ç”Ÿä¸€ç»„ä»æ–‡ä»¶ scores è¯»å–çš„è¡Œ, ä»ä¸Šæ¬¡ $file.lines ç¦»å¼€çš„åœ°æ–¹å¼€å§‹, ä¸€ç›´åˆ°æ–‡ä»¶æœ«å°¾ç»“æŸã€‚
åœ¨ç¬¬ä¸€æ¬¡å¾ªç¯ä¸­, $line ä¼šåŒ…å«å­—ç¬¦ä¸² <code>Ana Dave | 3:0;</code> åœ¨ç¬¬äºŒæ¬¡å¾ªç¯ä¸­, $line ä¼šåŒ…å« <code>Charlie Beth | 3:1</code>,ä»¥æ­¤ç±»æ¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="p">(</span><span class="nv">$pairing</span><span class="o">,</span> <span class="nv">$result</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$line</span><span class="o">.</span><span class="nb">split</span><span class="p">(&#39;</span><span class="s1"> | </span><span class="p">&#39;);</span>
</code></pre></div><p>splitæ­¤å¤„æ˜¯ä¸€ä¸ªæ–¹æ³•, å­—ç¬¦ä¸² &lsquo;|&rsquo; æ˜¯å®ƒçš„å‚æ•°ã€‚</p>
<p>ç¬¬ä¸€æ¬¡å¾ªç¯ç»“æŸï¼š</p>
<pre><code>Variable       Contents
$line           'Ana Dave | 3:0'
$pairing        'Ana Dave'
$result         '3:0'
$p1             'Ana'
$p2             'Dave'
$r1              '3'
$r2              '0'
</code></pre>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@sorted</span> <span class="o">=</span> <span class="nv">@names</span><span class="o">.</span><span class="nb">sort</span><span class="p">({</span> <span class="nv">%sets</span><span class="p">{</span><span class="nv">$_</span><span class="p">}</span> <span class="p">})</span><span class="o">.</span><span class="nb">sort</span><span class="p">({</span> <span class="nv">%matches</span><span class="p">{</span><span class="nv">$_</span><span class="p">}</span> <span class="p">})</span><span class="o">.</span><span class="nb">reverse</span><span class="p">;</span>
</code></pre></div><p>è¿™ä¸€å¥æ˜¯æ’åº, å…ˆæŒ‰æ¯”èµ›å±€æ•°å¤šå°‘æ’åº, å†æŒ‰èµ¢å¾—çš„æ¯”èµ›æ•°æ’åº, ç„¶ååè½¬ã€‚æ‰“å°é€‰æ‰‹åå­—çš„æ—¶å€™ä»¥èƒœè´Ÿæ¬¡åºæ’åº, ä»£ç å¿…é¡»ä½¿ç”¨é€‰æ‰‹çš„åˆ†æ•°, è€Œéä»–ä»¬çš„åå­—æ¥è¿›è¡Œæ’åºã€‚sort æ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ªä»£ç å—, ç”¨äºå°†æ•°ç»„å…ƒç´ ï¼ˆé€‰æ‰‹çš„åå­—ï¼‰è½¬æ¢æˆç”¨äºæ’åºçš„æ•°æ®ã€‚æ•°ç»„çš„å…ƒç´ é€šè¿‡å˜é‡ <code>$_</code> ä¼ é€’åˆ°ä»£ç å—ä¸­ã€‚</p>
<p>æœ€ç®€å•çš„ä½¿ç”¨åˆ†æ•°æ’åºé€‰æ‰‹çš„æ–¹æ³•åº”è¯¥æ˜¯:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@names</span><span class="o">.</span><span class="nb">sort</span><span class="p">(</span> <span class="p">{</span> <span class="nv">%matches</span><span class="p">{</span><span class="nv">$_</span><span class="p">}</span> <span class="p">}</span> <span class="p">)</span>
</code></pre></div><p>è¿™æ˜¯é€šè¿‡ä½¿ç”¨èµ¢å¾—æ¯”èµ›çš„æ¬¡æ•°æ¥è¿›è¡Œæ’åºã€‚ç„¶è€Œ, Ana å’Œ Daveéƒ½èµ¢äº†ä¸¤åœºæ¯”èµ›ã€‚è¿˜éœ€è¦æ¯”è¾ƒè°èµ¢çš„çš„æ¯”èµ›å±€æ•°å¤š, æ‰èƒ½å†³å®šæ¯”èµ›çš„æ’åã€‚</p>
<p>åœ¨åŒå¼•å·æ‹¬èµ·çš„å­—ç¬¦ä¸²ä¸­, æ ‡é‡å’ŒèŠ±æ‹¬å·ä¸­çš„å˜é‡èƒ½è¿›è¡Œå˜é‡æ’å€¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$names</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">things</span><span class="p">&#39;;</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">Do not call me $names</span><span class="p">&#39;;</span> <span class="c1"># Do not call me $names</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Do not call me </span><span class="nv">$names</span><span class="p">&#34;;</span> <span class="c1"># Do not call me things</span>
</code></pre></div><p>èŠ±æ‹¬å·ä¸­çš„æ•°ç»„è¿›è¡Œæ’å€¼åä¼šå˜æˆç”¨ç©ºæ ¼åˆ†éš”çš„æ¡ç›®ã€‚èŠ±æ‹¬å·ä¸­çš„æ•£åˆ—æ’å€¼åæ¯ä¸ªæ•£åˆ—é”®å€¼å¯¹å•ç‹¬æˆä¸ºä¸€è¡Œ, æ¯è¡ŒåŒ…å«ä¸€ä¸ªå¥, éšåæ˜¯ä¸€ä¸ª tab åˆ¶è¡¨ç¬¦, ç„¶åæ˜¯é”®å€¼, æœ€åæ˜¯ä¸€ä¸ªæ–°è¡Œç¬¦ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Math: </span><span class="p">{</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="p">}&#34;</span>     <span class="c1"># Math: 3</span>
<span class="k">my</span> <span class="nv">@people</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">Luke Matthew Mark</span><span class="p">&gt;;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">The synoptics are: </span><span class="p">{</span><span class="nv">@people</span><span class="p">}&#34;</span> <span class="c1"># The synoptics are: Luke Matthew Mark</span>

<span class="nb">say</span> <span class="p">&#34;{</span><span class="nv">%sets</span><span class="p">}&#34;;</span> <span class="c1"># From the table tennis tournament</span>

<span class="c1"># Charlie 4</span>
<span class="c1"># Dave 6</span>
<span class="c1"># Ana 8</span>
<span class="c1"># Beth 4</span>
</code></pre></div><p>å½“æ•°ç»„å’Œæ•£åˆ—å˜é‡ç›´æ¥å‡ºç°åœ¨åŒå¼•å·å­—ç¬¦ä¸²ä¸­(å¹¶ä¸”ä¸åœ¨èŠ±æ‹¬å· <code>{}</code> é‡Œ), å®ƒä»¬åªåœ¨å®ƒä»¬çš„åå­—åè·Ÿç€ä¸€ä¸ª postcircumfix - ä¸€å¯¹æ‹¬å·, åé¢è·Ÿç€è¯­å¥æ—¶æ‰ä¼šè¿›è¡Œæ’å€¼ã€‚åœ¨å˜é‡åå’Œåç½®ç¯ç¼€ä¹‹é—´è¿›è¡Œæ–¹æ³•è°ƒç”¨ä¹Ÿæ˜¯å¯ä»¥çš„(ä¾‹å¦‚ <code>@flavours.sort()</code>)</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@flavours</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">vanilla peach</span><span class="p">&gt;;</span>

<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">we have </span><span class="nv">@flavours</span><span class="p">&#34;;</span>    <span class="c1"># we have @flavours, è¿™é‡Œæ²¡è¿›è¡Œæ’å€¼</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">we have </span><span class="nv">@flavours</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">&#34;;</span> <span class="c1"># we have vanilla, åç½®ç¯ç¼€, å˜é‡åå­—åé¢è·Ÿç€ä¸€å¯¹å„¿æ‹¬å·</span>
<span class="c1"># so-called &#34;Zen slice&#34;</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">we have </span><span class="nv">@flavours</span><span class="o">[]</span><span class="p">&#34;;</span>  <span class="c1"># we have vanilla peach</span>

<span class="c1"># ä»¥åç½®ç¯ç¼€ç»“å°¾çš„æ–¹æ³•è°ƒç”¨</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">we have </span><span class="nv">@flavours</span><span class="o">.</span><span class="nf">sort</span><span class="p">()&#34;;</span> <span class="c1"># we have peach vanilla</span>

<span class="c1"># é“¾å¼æ–¹æ³•è°ƒç”¨:</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">we have </span><span class="nv">@flavours</span><span class="o">.</span><span class="nf">sort.join</span><span class="p">(&#39;</span><span class="s1">, </span><span class="p">&#39;)&#34;;</span>
<span class="c1"># we have peach, vanilla</span>
</code></pre></div><h3 id="ç»ƒä¹ ">ç»ƒä¹ </h3>
<p>ä¾‹å­ä¸­çš„ç¬¬ä¸€è¡Œé€‰æ‰‹çš„åå­—æ˜¯å¤šä½™çš„, ä½ å¯ä»¥åœ¨å‚åŠ æ¯”èµ›çš„é€‰æ‰‹ä¸­æ‰¾å‡ºæ‰€æœ‰é€‰æ‰‹çš„åå­—ï¼å¦‚æœä¾‹å­ä¸­çš„ç¬¬ä¸€è¡Œè¢«çœç•¥äº†, ä½ å¦‚ä½•æ›´æ”¹ç¨‹åºï¼Ÿæç¤ºï¼š<code>%hash.keys</code> è¿”å›æ•£åˆ— <code>%hash</code> ä¸­çš„æ‰€æœ‰é”®ã€‚</p>
<p>ç­”æ¡ˆ: ç§»é™¤æ­¤è¡Œï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@names</span> <span class="o">=</span> <span class="nv">$file</span><span class="o">.</span><span class="nb">get</span><span class="o">.</span><span class="nb">words</span><span class="p">;</span>
</code></pre></div><p>å¹¶ä¸”å°†</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@sorted</span> <span class="o">=</span> <span class="nv">@names</span><span class="o">.</span><span class="nb">sort</span><span class="p">({</span> <span class="nv">%sets</span><span class="p">{</span><span class="nv">$_</span><span class="p">}</span> <span class="p">})</span><span class="o">.</span><span class="nb">sort</span><span class="p">({</span> <span class="nv">%matches</span><span class="p">{</span><span class="nv">$_</span><span class="p">}</span> <span class="p">})</span><span class="o">.</span><span class="nb">reverse</span><span class="p">;</span>
</code></pre></div><p>å˜æˆ:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@sorted</span> <span class="o">=</span> <span class="nv">%sets</span><span class="o">.</span><span class="nb">keys</span><span class="o">.</span><span class="nb">sort</span><span class="p">({</span> <span class="nv">%sets</span><span class="p">{</span><span class="nv">$_</span><span class="p">}</span> <span class="p">})</span><span class="o">.</span><span class="nb">sort</span><span class="p">({</span> <span class="nv">%matches</span><span class="p">{</span><span class="nv">$_</span><span class="p">}</span> <span class="p">})</span><span class="o">.</span><span class="nb">reverse</span><span class="p">;</span>
</code></pre></div><p>é™¤äº†ç§»é™¤å†—ä½™, ä½ ä¹Ÿå¯ä»¥ç”¨å®ƒæ¥æé†’æˆ‘ä»¬, å¦‚æœä¸€ä¸ªé€‰æ‰‹æ²¡æœ‰åœ¨ç¬¬ä¸€è¡Œçš„åå­—æ¸…å•ä¸­è¢«æåˆ°, ä¾‹å¦‚å› ä¸ºè¾“å…¥é”™è¯¯, ä½ è¯¥æ€æ ·ä¿®æ”¹ä½ çš„ç¨‹åºï¼Ÿ</p>
<p>ç­”æ¡ˆ: å¼•å…¥å¦å¤–ä¸€ä¸ªæ•£åˆ—, åˆæ³•é€‰æ‰‹çš„åå­—ä½œä¸ºé”®, å½“è¯»å–é€‰æ‰‹åå­—çš„æ—¶å€™æŸ¥æ‰¾è¯¥æ•£åˆ—ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@names</span> <span class="o">=</span> <span class="nv">$file</span><span class="o">.</span><span class="nb">get</span><span class="o">.</span><span class="nb">split</span><span class="p">(&#39;</span><span class="s1"> </span><span class="p">&#39;);</span>
<span class="k">my</span> <span class="nv">%legitimate-players</span><span class="p">;</span>

<span class="k">for</span> <span class="nv">@names</span> <span class="k">-&gt;</span> <span class="nv">$n</span> <span class="p">{</span> <span class="c1">#  -&gt; ä¸¤ä¾§è¦æœ‰ç©ºæ ¼</span>
    <span class="nv">%legitimate-players</span><span class="p">{</span><span class="nv">$n</span><span class="p">}</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="nv">$file</span><span class="o">.</span><span class="nb">lines</span> <span class="k">-&gt;</span> <span class="nv">$line</span> <span class="p">{</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$pairing</span><span class="o">,</span> <span class="nv">$result</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$line</span><span class="o">.</span><span class="nb">split</span><span class="p">(&#39;</span><span class="s1"> | </span><span class="p">&#39;);</span>
    <span class="k">my</span> <span class="p">(</span><span class="nv">$p1</span><span class="o">,</span> <span class="nv">$p2</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$pairing</span><span class="o">.</span><span class="nb">split</span><span class="p">(&#39;</span><span class="s1"> </span><span class="p">&#39;);</span>
    
    <span class="k">for</span> <span class="nv">$p1</span><span class="o">,</span> <span class="nv">$p2</span> <span class="k">-&gt;</span> <span class="nv">$p</span> <span class="p">{</span>
        <span class="k">if</span> <span class="o">!</span><span class="nv">%legitimate-players</span><span class="p">{</span><span class="nv">$p</span><span class="p">}</span> <span class="p">{</span>
            <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Warning: &#39;</span><span class="nv">$p&#39;</span><span class="s2"> is not on our list!</span><span class="p">&#34;;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre></div><h2 id="ç¬¬ä¸‰ç« -æ“ä½œç¬¦">ç¬¬ä¸‰ç«  æ“ä½œç¬¦</h2>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@scores</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">Ana</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">8</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Dave</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">6</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Charlie</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Beth</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$screen-width</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">$label-area-width</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="o">[</span><span class="nb">max</span><span class="o">]</span> <span class="nv">@scores</span><span class="o">Â».</span><span class="nb">key</span><span class="o">Â».</span><span class="nb">chars</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$max-score</span> <span class="o">=</span> <span class="o">[</span><span class="nb">max</span><span class="o">]</span> <span class="nv">@scores</span><span class="o">Â».</span><span class="nb">value</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$unit</span> <span class="o">=</span> <span class="p">(</span><span class="nv">$screen-width</span> <span class="o">-</span> <span class="nv">$label-area-width</span><span class="p">)</span> <span class="o">/</span> <span class="nv">$max-score</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$format</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">%- </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$label-area-width</span> <span class="o">~</span> <span class="p">&#34;</span><span class="s2">s</span><span class="nv">%s</span><span class="s2">\n</span><span class="p">&#34;;</span>

<span class="k">for</span> <span class="nv">@scores</span> <span class="p">{</span>
    <span class="nb">printf</span> <span class="nv">$format</span><span class="o">,</span> <span class="o">.</span><span class="nb">key</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">X</span><span class="p">&#39;</span> <span class="nb">x</span> <span class="p">(</span><span class="nv">$unit</span> <span class="o">*</span> <span class="o">.</span><span class="nb">value</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­, æˆ‘ä»¬è®¡ç®—ä¸€ä¸‹æ¯ä½é€‰æ‰‹åœ¨ç«æ ‡èµ›ä¸­èµ¢å¾—æ¯”èµ›çš„å±€æ•°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@scores</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">Ana</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">8</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Dave</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">6</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Charlie</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Beth</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">;</span>  
</code></pre></div><p>è¿™ä¸€å¥å±€åŒ…å«äº†ä¸‰ä¸ªä¸åŒçš„æ“ä½œç¬¦ <code>=</code> å’Œ <code>=&gt;</code> å’Œ <code>,</code>ã€‚ä»¥å­—ç¬¦ä¸²è¿æ¥æ“ä½œç¬¦ <code>~</code> ä¸ºä¾‹, <code>$string ~= &quot;text&quot;</code> ç­‰ä»·äº <code>$string = $string ~ &quot;text&quot;</code>ã€‚</p>
<p><code>=&gt;</code> æ“ä½œç¬¦(å¤§é”®å·)åˆ›å»ºäº†ä¸€ä¸ªé”®å€¼å¯¹å¯¹è±¡, ä¸€ä¸ªé”®å€¼å¯¹å­˜å‚¨ç€é”®å’Œå€¼ï¼›é”®åœ¨ <code>=&gt;</code> æ“ä½œç¬¦çš„å·¦ä¾§, å€¼åœ¨å³ä¾§ã€‚è¿™ä¸ªæ“ä½œç¬¦æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ç‰¹æ€§ï¼šç¼–è¯‘å™¨ä¼šæŠŠ <code>=&gt;</code> æ“ä½œç¬¦å·¦ä¾§çš„ä»»ä½•è£¸æ ‡è¯†ç¬¦è§£é‡Šä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ä½ ä¹Ÿå¯ä»¥è¿™æ ·å†™ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@scores</span> <span class="o">=</span> <span class="s">Ana</span> <span class="o">=&gt;</span> <span class="mi">8</span>, <span class="s">Dave</span> <span class="o">=&gt;</span> <span class="mi">6</span>, <span class="s">Charlie</span> <span class="o">=&gt;</span> <span class="mi">4</span>, <span class="s">Beth</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">;</span>
</code></pre></div><p>æœ€åé€—å·æ“ä½œç¬¦ <code>,</code> æ„å»ºäº†ä¸€ä¸ªå¯¹è±¡åºåˆ—, åœ¨è¯¥æƒ…å†µä¸‹, æ‰€è°“çš„å¯¹è±¡å°±æ˜¯é”®å€¼å¯¹ã€‚</p>
<p>è¿™ä¸‰ä¸ªæ“ä½œç¬¦éƒ½æ˜¯ä¸­ç¼€æ“ä½œç¬¦, è¿™æ„å‘³ç€å®ƒåœ¨ä¸¤ä¸ªæ¡ç›®ä¹‹é—´ã€‚</p>
<p>ä¸€ä¸ªé¡¹å‰é¢å¯ä»¥æœ‰0ä¸ªæˆ–å¤šä¸ªå‰ç¼€æ“ä½œç¬¦, æ‰€ä»¥ä½ å¯ä»¥å†™æ¯”å¦‚ <code>4 + -5</code>ã€‚<code>+</code> å·ï¼ˆä¸€ä¸ªä¸­ç¼€æ“ä½œç¬¦ï¼‰çš„åé¢, ç¼–è¯‘å™¨æœŸæœ›ä¸€ä¸ªé¡¹, ä¸ºäº†å°† <code>-</code> å·è§£é‡Šä¸ºé¡¹ 5 çš„ä¸€ä¸ªå‰ç¼€ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$label-area-width</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="o">[</span><span class="nb">max</span><span class="o">]</span> <span class="nv">@scores</span><span class="o">Â».</span><span class="nb">key</span><span class="o">Â».</span><span class="nb">chars</span><span class="p">;</span>
</code></pre></div><p><code>Â»</code> æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç¬¦å·, æ‰“å°ä¸å‡ºæ¥å¯ä»¥ç”¨ä¸¤ä¸ªå¤§äºå· <code>&gt;&gt;</code> ä»£æ›¿ã€‚ä¸­ç¼€æ“ä½œç¬¦ <code>max</code> è¿”å›ä¸¤ä¸ªå€¼ä¸­çš„è¾ƒå¤§è€…, æ‰€ä»¥ <code>2 max 3</code> è¿”å› 3ã€‚æ–¹æ‹¬å·åŒ…è£¹ç€ä¸€ä¸ªä¸­ç¼€æ“ä½œç¬¦è®© Raku å°†è¯¥ä¸­ç¼€æ“ä½œç¬¦åº”ç”¨åˆ°åˆ—è¡¨ä¸­çš„å…ƒç´ ä¹‹é—´ã€‚<code>[max] 1,5,3,7</code> å’Œ <code>1 max 5 max 3 max 7</code> ä¸€æ ·, ç»“æœéƒ½ä¸º 7ã€‚</p>
<p>åŒæ ·åœ°, <code>[+]</code> ç”¨æ¥è®¡ç®—åˆ—è¡¨å…ƒç´ çš„å’Œ, <code>[*]</code> ç”¨æ¥è®¡ç®—åˆ—è¡¨å…ƒç´ çš„ç§¯, <code>[&lt;=]</code> ç”¨æ¥æ£€æŸ¥ä¸€ä¸ªåˆ—è¡¨çš„å€¼æ˜¯å¦æŒ‰é€’å¢æ’åºã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@scores</span><span class="o">Â».</span><span class="nb">key</span><span class="o">Â».</span><span class="nb">chars</span>
<span class="k">my</span> <span class="nv">@scores</span> <span class="o">=</span> <span class="s">Ana</span> <span class="o">=&gt;</span> <span class="mi">8</span>, <span class="s">Dave</span> <span class="o">=&gt;</span> <span class="mi">6</span>, <span class="s">Charlie</span> <span class="o">=&gt;</span> <span class="mi">4</span>, <span class="s">Beth</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">;</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="n">Ana</span>     <span class="mi">8</span> <span class="n">Dave</span>  <span class="mi">6</span> <span class="n">Charlie</span>       <span class="mi">4</span> <span class="n">Beth</span>  <span class="mi">4</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@scores</span><span class="o">.</span><span class="nb">key</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">Method &#39;key&#39; not found for invocant of class &#39;Array&#39;
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@scores</span><span class="o">&gt;&gt;.</span><span class="nb">key</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">Ana Dave Charlie Beth
</code></pre></div><p>å°±åƒ <code>@variable.method</code> åœ¨ <code>@variable</code> ä¸Šè°ƒç”¨ä¸€ä¸ªæ–¹æ³•ä¸€æ ·, <code>@arrayÂ».method</code> å¯¹ <code>@array</code> ä¸­çš„æ¯ä¸€é¡¹è°ƒç”¨ <code>method</code> æ–¹æ³•, å¹¶ä¸”è¿”å›ä¸€ä¸ªè¿”å›å€¼çš„åˆ—è¡¨ã€‚å³ <code>@scores&gt;&gt;.key</code> è¿”å›ä¸€ä¸ªåˆ—è¡¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@scores</span><span class="o">&gt;&gt;.</span><span class="nb">key</span><span class="o">&gt;&gt;.</span><span class="nb">chars</span>  <span class="c1"># æ¯ä¸ªåå­—å«æœ‰å‡ ä¸ªå­—ç¬¦</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">4 7 4
</code></pre></div><p>è¡¨è¾¾å¼ <code>[max] @scoresÂ».keyÂ».chars</code> ç»™å‡º (3,4,7,4) ä¸­çš„æœ€å¤§å€¼ã€‚å®ƒä¸ä¸‹é¢çš„è¡¨è¾¾å¼ç›¸åŒï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@scores</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="nb">key</span><span class="o">.</span><span class="nb">chars</span>
<span class="nb">max</span> <span class="nv">@scores</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="nb">key</span><span class="o">.</span><span class="nb">chars</span>
<span class="nb">max</span> <span class="nv">@scores</span><span class="o">[</span><span class="mi">2</span><span class="o">].</span><span class="nb">key</span><span class="o">.</span><span class="nb">chars</span>
<span class="nb">max</span> <span class="o">...</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@scores</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">&#34;</span><span class="s2">Ana</span><span class="p">&#34;</span> <span class="o">=&gt;</span> <span class="mi">8</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@scores</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="nb">key</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">Ana
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$format</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">%- </span><span class="p">&#39;</span> <span class="o">~</span> <span class="nv">$label-area-width</span> <span class="o">~</span> <span class="p">&#34;</span><span class="s2">s</span><span class="nv">%s</span><span class="s2">\n</span><span class="p">&#34;;</span>

<span class="k">for</span> <span class="nv">@scores</span> <span class="p">{</span>
    <span class="nb">printf</span> <span class="nv">$format</span><span class="o">,</span> <span class="o">.</span><span class="nb">key</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">X</span><span class="p">&#39;</span> <span class="nb">x</span> <span class="p">(</span><span class="nv">$unit</span> <span class="o">*</span> <span class="o">.</span><span class="nb">value</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>å®šä¹‰ä¸€ä¸ªæ ¼å¼, <code>%-</code> è¡¨ç¤ºå·¦å¯¹é½, <code>~</code> æ˜¯å­—ç¬¦ä¸²è¿æ¥æ“ä½œç¬¦ <code>.for</code> å¾ªç¯ä¸­, <code>@scores</code> ä¸­çš„æ¯ä¸€é¡¹è¢«ç»‘å®šç»™ç‰¹æ®Šå˜é‡ <code>$_</code>, <code>.key</code> æ˜¯æ¯é¡¹çš„é”®, å³åå­—, <code>.value</code> æ˜¯æ¯é¡¹çš„é”®å€¼, å³å¾—åˆ†ã€‚å° x æ˜¯å­—ç¬¦ä¸²é‡å¤æ“ä½œç¬¦ã€‚</p>
<h3 id="å…³äºä¼˜å…ˆçº§çš„çš„ä¸€å¥è¯">å…³äºä¼˜å…ˆçº§çš„çš„ä¸€å¥è¯</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@scores</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">Ana</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">8</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Dave</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">6</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Charlie</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Beth</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">;</span>
</code></pre></div><p>ç­‰å·å³ä¾§äº§ç”Ÿä¸€ä¸ªåˆ—è¡¨ï¼ˆå› ä¸ºé€—å·, æ“ä½œç¬¦ï¼‰, è¿™ä¸ªåˆ—è¡¨ç”±å¯¹å„¿ç»„æˆ(å› ä¸º <code>=&gt;</code>), å¹¶ä¸”ç»“æœèµ‹å€¼ç»™æ•°ç»„å˜é‡ã€‚
åœ¨ Perl5 ä¸­ä¼šè¿™æ ·è§£é‡Š:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">(</span><span class="k">my</span> <span class="nv">@scores</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">Ana</span><span class="p">&#39;)</span> <span class="o">=&gt;</span> <span class="mi">8</span>, <span class="p">&#39;</span><span class="s1">Dave</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">6</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Charlie</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Beth</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">;</span>
</code></pre></div><p>ä»¥è‡³äºæ•°ç»„ <code>@scores</code> ä¸­åªæœ‰ä¸€ä¸ªé¡¹, è¡¨è¾¾å¼çš„å…¶ä½™éƒ¨åˆ†è¢«è®¡ç®—åä¸¢å¼ƒã€‚</p>
<p>ä¼˜å…ˆçº§è§„åˆ™æ§åˆ¶ç€ç¼–è¯‘å™¨å¦‚ä½•è§£é‡Šè¿™ä¸€è¡Œã€‚Raku çš„ä¼˜å…ˆçº§è§„åˆ™ç”³æ˜ ä¸­ç¼€æ“ä½œç¬¦ <code>=&gt;</code> æ¯” <code>,</code> ä¸­ç¼€æ“ä½œç¬¦å¯¹äºå‚æ•°çš„ç»‘å®šæ›´ç´§, è€Œé€—å·æ“ä½œç¬¦æ¯”ç­‰å·èµ‹å€¼æ“ä½œç¬¦ç»‘å®šçš„æ›´ç´§ã€‚</p>
<p>å®é™…ä¸Šæœ‰ä¸¤ç§ä¸åŒä¼˜å…ˆçº§çš„èµ‹å€¼æ“ä½œç¬¦ã€‚å½“èµ‹å€¼æ“ä½œç¬¦å³ä¾§æ˜¯ä¸€ä¸ªæ ‡é‡æ—¶, ä½¿ç”¨è¾ƒç´§ä¼˜å…ˆçº§çš„é¡¹èµ‹å€¼æ“ä½œç¬¦, å¦åˆ™ä½¿ç”¨è¾ƒæ¾ä¼˜å…ˆçº§çš„åˆ—è¡¨èµ‹å€¼æ“ä½œç¬¦ã€‚(å¦‚åŒèºä¸çš„æ¾ç´§)
æ¯”è¾ƒ <code>$a = 1, $b = 2</code> å’Œ <code>@a = 1, 2,</code> å‰è€…æ˜¯åœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­èµ‹å€¼ç»™ä¸¤ä¸ªå˜é‡, åè€…æ˜¯å°†å«æœ‰ä¸¤ä¸ªé¡¹çš„ä¸€ä¸ªåˆ—è¡¨èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="mi">5</span> <span class="o">-</span> <span class="mi">7</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>   <span class="c1"># 5 - 3.5 = 1.5</span>
<span class="nb">say</span> <span class="p">(</span><span class="mi">5</span> <span class="o">-</span> <span class="mi">7</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="c1"># (-2) / 2 = -1</span>
</code></pre></div><p>Raku ä¸­çš„ä¼˜å…ˆçº§å¯ä»¥ç”¨åœ†æ‹¬å·æ”¹å˜, ä½†æ˜¯å¦‚æœåœ†æ‹¬å·ç›´æ¥è·Ÿåœ¨æ ‡è¯†ç¬¦çš„åé¢è€Œä¸åŠ ç©ºæ ¼çš„è¯, åˆ™ä¼šè¢«è§£é‡Šä¸ºå‚æ•°åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span><span class="p">(</span><span class="mi">5</span> <span class="o">-</span> <span class="mi">7</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="c1"># -2</span>
</code></pre></div><p>åªæ‰“å°å‡ºäº† <code>5-7</code> çš„å€¼ã€‚</p>
<p>ä¼˜å…ˆçº§è¡¨</p>
<table>
<thead>
<tr>
<th style="text-align:left">expression</th>
<th style="text-align:left">åç§°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">(), 42.5</td>
<td style="text-align:left">(tightest precedence)</td>
</tr>
<tr>
<td style="text-align:left">42.rand</td>
<td style="text-align:left">term</td>
</tr>
<tr>
<td style="text-align:left">$x++</td>
<td style="text-align:left">method calls and postcircumfixes</td>
</tr>
<tr>
<td style="text-align:left">$x**2</td>
<td style="text-align:left">autoincrement and autodecrement</td>
</tr>
<tr>
<td style="text-align:left">?$x, !$x</td>
<td style="text-align:left">exponentiation operator</td>
</tr>
<tr>
<td style="text-align:left">+$x, ~$x</td>
<td style="text-align:left">boolean prefix</td>
</tr>
<tr>
<td style="text-align:left">2*3, 7/5</td>
<td style="text-align:left">prefix context operators</td>
</tr>
<tr>
<td style="text-align:left">1+2, 7-5</td>
<td style="text-align:left">multiplicative infix operators</td>
</tr>
<tr>
<td style="text-align:left">$a x 3</td>
<td style="text-align:left">additive infix operators</td>
</tr>
<tr>
<td style="text-align:left">$x ~&quot;.nn&quot;</td>
<td style="text-align:left">replication operators</td>
</tr>
<tr>
<td style="text-align:left">1&amp;2</td>
<td style="text-align:left">string concatenation</td>
</tr>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">2</td>
</tr>
<tr>
<td style="text-align:left">abs $x</td>
<td style="text-align:left">junctive OR</td>
</tr>
<tr>
<td style="text-align:left">$x cmp 3</td>
<td style="text-align:left">named unary prefix</td>
</tr>
<tr>
<td style="text-align:left">$x == 3</td>
<td style="text-align:left">non-chaining binary operators</td>
</tr>
<tr>
<td style="text-align:left">$x &amp;&amp; $y</td>
<td style="text-align:left">chaining binary operators</td>
</tr>
<tr>
<td style="text-align:left">$x</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">$x &gt; 0 ?? 1 !! -1</td>
<td style="text-align:left">tight OR infix</td>
</tr>
<tr>
<td style="text-align:left">$x = 1</td>
<td style="text-align:left">conditional operator</td>
</tr>
<tr>
<td style="text-align:left">not $x</td>
<td style="text-align:left">item assignment</td>
</tr>
<tr>
<td style="text-align:left">1, 2</td>
<td style="text-align:left">loose unary prefix</td>
</tr>
<tr>
<td style="text-align:left">1, 2 Z @a</td>
<td style="text-align:left">comma</td>
</tr>
<tr>
<td style="text-align:left">@a = 1, 2</td>
<td style="text-align:left">list infix</td>
</tr>
<tr>
<td style="text-align:left">$x and say &ldquo;Yes&rdquo;</td>
<td style="text-align:left">list prefix, list assignment</td>
</tr>
<tr>
<td style="text-align:left">$x or die &ldquo;No&rdquo;</td>
<td style="text-align:left">loose AND infix</td>
</tr>
<tr>
<td style="text-align:left">;</td>
<td style="text-align:left">loose OR infix</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">statement terminator</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left">(loosest precedence)</td>
</tr>
</tbody>
</table>
<h3 id="æ¯”è¾ƒå’Œæ™ºèƒ½åŒ¹é…">æ¯”è¾ƒå’Œæ™ºèƒ½åŒ¹é…</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@a</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">@b</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="p">;</span>

<span class="nb">say</span> <span class="nv">@a</span> <span class="o">===</span> <span class="nv">@a</span><span class="p">;</span> <span class="c1"># Bool::True</span>
<span class="nb">say</span> <span class="nv">@a</span> <span class="o">===</span> <span class="nv">@b</span><span class="p">;</span> <span class="c1"># Bool::False</span>

<span class="c1"># these use identity for value</span>
<span class="nb">say</span> <span class="mi">3</span> <span class="o">===</span> <span class="mi">3</span> <span class="c1"># Bool::True</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;</span> <span class="o">===</span> <span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;;</span> <span class="c1"># Bool::True</span>

<span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;;</span>
<span class="nb">say</span> <span class="nv">$a</span> <span class="o">===</span> <span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;;</span> <span class="c1"># Bool::True</span>

<span class="nv">@b</span><span class="o">===</span><span class="nv">@a</span><span class="p">;</span>   <span class="c1"># False</span>
<span class="nv">@a</span> <span class="ow">eqv</span> <span class="nv">@b</span><span class="p">;</span> <span class="c1"># True</span>
<span class="p">&#39;</span><span class="s1">2</span><span class="p">&#39;</span> <span class="ow">eqv</span> <span class="mi">2</span><span class="p">;</span> <span class="c1"># False</span>
</code></pre></div><p>åªæœ‰å½“ä¸¤ä¸ªå¯¹è±¡æœ‰ç›¸åŒçš„ç±»å‹å’Œç›¸åŒçš„ç»“æ„æ—¶, eqv æ“ä½œç¬¦æ‰è¿”å› Trueã€‚åœ¨å‰é¢å®šä¹‰çš„ä¾‹å­ä¸­, @a  eqv  @b ç»“æœä¸º True, å› ä¸º @a å’Œ @b å„è‡ªåŒ…å«ç›¸åŒçš„å€¼, å¦ä¸€æ–¹é¢, &lsquo;2&rsquo; eqv 2 è¿”å› &lsquo;False&rsquo; ,å› ä¸ºä¸€ä¸ªå‚æ•°æ˜¯å­—ç¬¦ä¸², å¦ä¸€ä¸ªæ˜¯æ•´æ•°, ç±»å‹ä¸ç›¸åŒã€‚</p>
<h4 id="æ•°å­—æ¯”è¾ƒ">æ•°å­—æ¯”è¾ƒ</h4>
<p>ä½¿ç”¨ == ä¸­ç¼€æ“ä½œç¬¦æŸ¥çœ‹ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦æœ‰ç›¸åŒçš„æ•°å­—å€¼ã€‚å¦‚æœæŸä¸ªå¯¹è±¡ä¸æ˜¯æ•°å­—, Perl ä¼šåœ¨æ¯”è¾ƒä¹‹å‰å°½åŠ›ä½¿å…¶æ•°å­—åŒ–ã€‚å¦‚æœæ²¡æœ‰æ›´å¥½çš„æ–¹å¼å°†å¯¹è±¡è½¬æ¢ä¸ºæ•°å­—, Perl ä¼šä½¿ç”¨é»˜è®¤çš„æ•°å­— 0 ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="mi">1</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">;</span>  <span class="c1"># Bool::True</span>
<span class="nb">say</span> <span class="mi">1</span> <span class="o">==</span> <span class="p">&#39;</span><span class="s1">1</span><span class="p">&#39;;</span>  <span class="c1"># Bool::True</span>
<span class="nb">say</span> <span class="mi">1</span> <span class="o">==</span> <span class="p">&#39;</span><span class="s1">2</span><span class="p">&#39;;</span>  <span class="c1"># Bool::False</span>
<span class="nb">say</span> <span class="mi">3</span> <span class="o">==</span> <span class="p">&#39;</span><span class="s1">3b</span><span class="p">&#39;;</span> <span class="c1"># fails</span>
</code></pre></div><p>è·Ÿæ•°å­—æ¯”è¾ƒç›¸å…³çš„è¿˜æœ‰ <code>&lt;</code>,<code>&lt;=</code>,<code>&gt;</code>,<code>&gt;=</code>ã€‚å¦‚æœä¸¤ä¸ªå¯¹è±¡çš„æ•°å­—å€¼ä¸åŒ, ä½¿ç”¨ <code>!=</code> ä¼šè¿”å› True ã€‚</p>
<p>å¦‚æœä½ å°†æ•°ç»„æˆ–åˆ—è¡¨ä½œä¸ºæ•°å­—, å®ƒä¼šè®¡ç®—åˆ—è¡¨ä¸­é¡¹çš„ä¸ªæ•°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@colors</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">red blue green</span><span class="p">&gt;;</span>

<span class="k">if</span> <span class="nv">@colors</span> <span class="o">==</span> <span class="mi">3</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">It&#39;s true, </span><span class="nv">@colors</span><span class="s2"> contains 3 items</span><span class="p">&#34;;</span>
<span class="p">}</span>
</code></pre></div><h4 id="å­—ç¬¦ä¸²æ¯”è¾ƒ">å­—ç¬¦ä¸²æ¯”è¾ƒ</h4>
<p>Raku ä¸­ä½¿ç”¨ eq æ¯”è¾ƒå­—ç¬¦ä¸², å¿…è¦æ—¶ä¼šå°†å…¶å‚æ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="nv">$greeting</span> <span class="ow">eq</span> <span class="p">&#39;</span><span class="s1">hello</span><span class="p">&#39;</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">welcome</span><span class="p">&#39;;</span>
<span class="p">}</span>
</code></pre></div><p>Table 3.2: Operators and Comparisons</p>
<table>
<thead>
<tr>
<th style="text-align:left">æ•°å­—æ¯”è¾ƒ</th>
<th style="text-align:left">å­—ç¬¦ä¸²æ¯”è¾ƒ</th>
<th style="text-align:left">æ„æ€</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">==</td>
<td style="text-align:left">eq</td>
<td style="text-align:left">ç­‰äº</td>
</tr>
<tr>
<td style="text-align:left">!=</td>
<td style="text-align:left">ne</td>
<td style="text-align:left">ä¸ç­‰äº</td>
</tr>
<tr>
<td style="text-align:left">!==</td>
<td style="text-align:left">!eq</td>
<td style="text-align:left">ä¸ç­‰äº</td>
</tr>
<tr>
<td style="text-align:left">&lt;</td>
<td style="text-align:left">lt</td>
<td style="text-align:left">å°äº</td>
</tr>
<tr>
<td style="text-align:left">&lt;=</td>
<td style="text-align:left">le</td>
<td style="text-align:left">å°äºæˆ–ç­‰äº</td>
</tr>
<tr>
<td style="text-align:left">&gt;</td>
<td style="text-align:left">gt</td>
<td style="text-align:left">å¤§äº</td>
</tr>
<tr>
<td style="text-align:left">&gt;=</td>
<td style="text-align:left">ge</td>
<td style="text-align:left">å¤§äºæˆ–ç­‰äº</td>
</tr>
</tbody>
</table>
<p>ä¾‹å¦‚, <code>'a' lt 'b'</code> ä¸º true, <code>'a' lt 'aa'</code> ä¹Ÿä¸º trueã€‚ != æ˜¯ <code>!==</code> çš„ä¾¿æ·å½¢å¼, å®ƒå®é™…æ˜¯ <code>!</code> å…ƒæ“ä½œç¬¦åŠ åœ¨ ä¸­ç¼€æ“ä½œç¬¦ <code>==</code> ä¹‹å‰ã€‚åŒæ ·åœ°, <code>ne</code> å’Œ <code>!eq</code>s æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>ä¸‰è·¯æ“ä½œç¬¦</p>
<p>ä¸‰è·¯æ“ä½œç¬¦æœ‰ä¸¤ä¸ªæ“ä½œæ•°, å¦‚æœå·¦ä¾§è¾ƒå°, è¿”å› Order::Increase , ä¸¤ä¾§ç›¸ç­‰åˆ™è¿”å› Order::Same, å¦‚æœå³ä¾§è¾ƒå°åˆ™è¿”å› Order::Decreaseã€‚å¯¹äºæ•°å­—ä½¿ç”¨ä¸‰è·¯æ“ä½œç¬¦ <code>&lt;=&gt;</code>,å¯¹äºå­—ç¬¦ä¸², ä½¿ç”¨ä¸‰è·¯æ“ä½œç¬¦ <code>leg</code> ï¼ˆå–è‡ª lesser, equal, greaterï¼‰ã€‚ä¸­ç¼€æ“ä½œç¬¦ cmp æ˜¯ä¸€ä¸ªå¯¹ç±»å‹æ•æ„Ÿçš„ä¸‰è·¯æ“ä½œç¬¦, å®ƒåƒ <code>&lt;=&gt;</code> ä¸€æ ·æ¯”è¾ƒæ•°å­—, åƒ leg ä¸€æ ·æ¯”è¾ƒå­—ç¬¦ä¸², å¹¶ä¸”æ¯”è¾ƒé”®å€¼å¯¹å„¿æ—¶, å…ˆæ¯”è¾ƒé”®, å¦‚æœé”®ç›¸åŒå†æ¯”è¾ƒé”®å€¼ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="mi">10</span> <span class="o">&lt;=&gt;</span> <span class="mi">5</span><span class="p">;</span>     <span class="c1"># +1</span>
<span class="nb">say</span> <span class="mi">10</span> <span class="ow">leg</span> <span class="mi">5</span><span class="p">;</span>     <span class="c1"># because &#39;1&#39; lt &#39;5&#39;</span>
<span class="nb">say</span> <span class="p">&#39;</span><span class="s1">ab</span><span class="p">&#39;</span> <span class="ow">leg</span> <span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;;</span> <span class="c1"># +1, lexicographic comparison</span>
</code></pre></div><p>ä¸‰è·¯æ“ä½œç¬¦çš„å…¸å‹ç”¨å¤„å°±æ˜¯ç”¨åœ¨æ’åºä¸­ã€‚åˆ—è¡¨ä¸­çš„ <code>.sort</code> æ–¹æ³•èƒ½ä½¿ç”¨ä¸€ä¸ªå«æœ‰ä¸¤ä¸ªå€¼çš„å—æˆ–ä¸€ä¸ªå‡½æ•°, æ¯”è¾ƒå®ƒä»¬, å¹¶è¿”å›ä¸€ä¸ªå°äº, ç­‰äºæˆ–å¤§äº 0 çš„å€¼ã€‚ sort æ–¹æ³•æ ¹æ®è¯¥è¿”å›å€¼è¿›è¡Œæ’åºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="o">~&lt;</span><span class="n">abstract</span> <span class="n">Concrete</span><span class="o">&gt;.</span><span class="nb">sort</span><span class="p">;</span>
<span class="c1"># output: Concrete abstract</span>

<span class="nb">say</span> <span class="o">~&lt;</span><span class="n">abstract</span> <span class="n">Concrete</span><span class="o">&gt;.</span><span class="nb">sort</span><span class="o">:</span> <span class="k">-&gt;</span> <span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span> <span class="p">{</span> <span class="nb">uc</span><span class="p">(</span><span class="nv">$a</span><span class="p">)</span> <span class="ow">leg</span> <span class="nb">uc</span><span class="p">(</span><span class="nv">$b</span><span class="p">)</span> <span class="p">};</span>
<span class="c1"># output: abstract Concrete</span>
</code></pre></div><p>é»˜è®¤çš„, æ¯”è¾ƒæ˜¯å¤§å°å†™æ•æ„Ÿçš„, é€šè¿‡æ¯”è¾ƒå®ƒä»¬çš„å¤§å†™å˜å½¢, è€Œä¸æ˜¯æ¯”è¾ƒå®ƒä»¬çš„å€¼, è¿™ä¸ªä¾‹å­ä½¿ç”¨äº†å¤§å°å†™æ•æ„Ÿæ’åºã€‚</p>
<h4 id="æ™ºèƒ½åŒ¹é…">æ™ºèƒ½åŒ¹é…</h4>
<p>ä½¿ç”¨ <code>~~</code> åšæ­£ç¡®çš„äº‹æƒ…ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="nv">$pints-drunk</span> <span class="o">~~</span> <span class="mi">8</span> <span class="p">{</span>
   <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Go home, you&#39;ve had enough!</span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="k">if</span> <span class="nv">$country</span> <span class="o">~~</span> <span class="p">&#39;</span><span class="s1">Sweden</span><span class="p">&#39;</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Meatballs with lingonberries and potato moose, please.</span><span class="p">&#34;</span>
<span class="p">}</span>

<span class="k">unless</span> <span class="nv">$group-size</span> <span class="o">~~</span> <span class="mi">2</span><span class="o">..</span><span class="mi">4</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">You must have between 2 and 4 people to book this tour.</span><span class="p">&#34;;</span>
<span class="p">}</span>
</code></pre></div><p>æ™ºèƒ½åŒ¹é…æ€»æ˜¯æ ¹æ® <code>~~</code> å³ä¾§å€¼çš„ç±»å‹æ¥å†³å®šä½¿ç”¨å“ªç§æ¯”è¾ƒã€‚ä¸Šä¸ªä¾‹å­ä¸­, æ¯”è¾ƒçš„æ˜¯æ•°å­—ã€å­—ç¬¦ä¸²å’ŒèŒƒå›´ã€‚
æ™ºèƒ½åŒ¹é…çš„å·¥ä½œæ–¹å¼ <code>$answer ~~ 42</code> ç­‰ä»·äº <code>42.ACCPETS( $answer )</code>ã€‚å¯¹ <code>~~</code> æ“ä½œç¬¦å³ä¾§çš„æ“ä½œæ•°è°ƒç”¨ ACCEPTS æ–¹æ³•, å¹¶å°†å·¦æ“ä½œæ•°ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚</p>
<h2 id="ç¬¬å››ç« -å­ä¾‹ç¨‹å’Œç­¾å">ç¬¬å››ç«  å­ä¾‹ç¨‹å’Œç­¾å</h2>
<p>ä¸€ä¸ªå­ä¾‹ç¨‹å°±æ˜¯ä¸€æ®µæ‰§è¡Œç‰¹æ®Šä»»åŠ¡çš„ä»£ç ç‰‡æ®µã€‚å®ƒå¯ä»¥å¯¹æä¾›çš„æ•°æ®(<code>å®å‚</code>)æ“ä½œ, å¹¶äº§ç”Ÿç»“æœï¼ˆè¿”å›å€¼ï¼‰ã€‚å­ä¾‹ç¨‹çš„ç­¾åæ˜¯å®ƒ<code>æ‰€å«çš„å‚æ•°</code>å’Œå®ƒäº§ç”Ÿçš„<code>è¿”å›å€¼</code>çš„æè¿°ã€‚ä»æŸä¸€æ„ä¹‰ä¸Šæ¥è¯´, ç¬¬ä¸‰ç« æè¿°çš„æ“ä½œç¬¦ä¹Ÿæ˜¯ Raku ç”¨ç‰¹æ®Šæ–¹å¼è§£é‡Šçš„å­ä¾‹ç¨‹ã€‚</p>
<h3 id="ç”³æ˜å­ä¾‹ç¨‹">ç”³æ˜å­ä¾‹ç¨‹</h3>
<p>å­ä¾‹ç¨‹ç”³æ˜ç”±å‡ éƒ¨åˆ†ç»„æˆã€‚é¦–å…ˆ, <code>sub</code> è¡¨æ˜ä½ åœ¨ç”³æ˜ä¸€ä¸ªå­ä¾‹ç¨‹, ç„¶åæ˜¯å¯é€‰çš„å­ä¾‹ç¨‹çš„åç§°å’Œå¯é€‰çš„ç­¾åã€‚å­ä¾‹ç¨‹çš„ä¸»ä½“æ˜¯ä¸€ä¸ªç”¨èŠ±æ‹¬å·æ‰©èµ·æ¥çš„ä»£ç å—ã€‚
é»˜è®¤çš„, å­ä¾‹ç¨‹æ˜¯æœ¬åœ°ä½œç”¨åŸŸçš„, å°±åƒä»»ä½•ä½¿ç”¨ <code>my</code> ç”³æ˜çš„å˜é‡ä¸€æ ·ã€‚è¿™æ„å‘³ç€, ä¸€ä¸ªå­ä¾‹ç¨‹åªèƒ½åœ¨å®ƒè¢«ç”³æ˜çš„ä½œç”¨åŸŸå†…è¢«è°ƒç”¨ã€‚ä½¿ç”¨ <code>our</code> æ¥ç”³æ˜å­ä¾‹ç¨‹å¯ä»¥ä½¿å…¶åœ¨å½“å‰åŒ…ä¸­å¯è§ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">{</span>
    <span class="k">our</span> <span class="k">sub</span> <span class="nf">eat</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">om nom nom</span><span class="p">&#34;;</span>
    <span class="p">}</span>

    <span class="k">sub</span> <span class="nf">drink</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">glug glug</span><span class="p">&#34;;</span>
    <span class="p">}</span>
 <span class="p">}</span>

<span class="k">our</span> <span class="nv">&amp;eat</span><span class="p">;</span> <span class="c1"># makes the package-scoped sub eat available in this lexical scope</span>

<span class="nf">eat</span><span class="p">();</span>   <span class="c1"># om nom nom</span>
<span class="nf">drink</span><span class="p">();</span> <span class="c1"># å¤±è´¥, can&#39;t drink outside of the block</span>
</code></pre></div><p>our ä¹Ÿèƒ½è®©å­ä¾‹ç¨‹ä»åŒ…æˆ–æ¨¡å—çš„å¤–éƒ¨æ˜¯å¯è§çš„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">module</span> <span class="nn">EatAndDrink</span> <span class="p">{</span>
    <span class="k">our</span> <span class="k">sub</span> <span class="nf">eat</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">om nom nom</span><span class="p">&#34;;</span>
    <span class="p">}</span>

    <span class="k">sub</span> <span class="nf">drink</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">glug glug</span><span class="p">&#34;;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nf">EatAndDrink::eat</span><span class="p">();</span> <span class="c1"># om nom nom</span>
<span class="nf">EatAndDrink::drink</span><span class="p">();</span> <span class="c1"># fails, not declared with &#34;our&#34;</span>
</code></pre></div><p>ä½ ä¹Ÿå¯ä»¥<code>å¯¼å‡º</code>ä¸€ä¸ªå­ä¾‹ç¨‹, è®©å®ƒåœ¨å¦å¤–çš„ä½œç”¨åŸŸå†…å¯è§ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># in file Math/Trivial.pm</span>
<span class="k">module</span> <span class="nn">Math::Trivial</span> <span class="p">{</span>
    <span class="k">sub</span> <span class="nf">double</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="k">is</span> <span class="k">export</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="nv">$x</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>ç„¶ååœ¨å…¶å®ƒç¨‹åºæˆ–æ¨¡å—ä¸­ä½ å¯ä»¥è¿™æ ·å†™:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">use</span> <span class="nn">Math::Trivial</span><span class="p">;</span> <span class="c1"># imports sub double</span>
<span class="nb">say</span> <span class="nf">double</span><span class="p">(</span><span class="mi">21</span><span class="p">);</span>    <span class="c1"># 21 is only half the truth</span>
</code></pre></div><p>Raku çš„å­ä¾‹ç¨‹éƒ½æ˜¯å¯¹è±¡ã€‚ä½ å¯ä»¥å°†å®ƒä»¬éšæ„ä¼ é€’å¹¶å­˜å‚¨åœ¨æ•°æ®ç»“æ„ä¸­ã€‚ç¼–ç¨‹è¯­è¨€è®¾è®¡è€…å¸¸å¸¸å°†å®ƒä»¬ç§°ä¹‹ä¸º first-class å­ä¾‹ç¨‹ï¼›å®ƒä»¬å°±åƒæ•°ç»„å’Œæ•£åˆ—ä¸€æ ·ä½œä¸ºè¯­è¨€çš„åŸºç¡€ã€‚</p>
<p>First-class å­ä¾‹ç¨‹èƒ½å¸®åŠ©ä½ è§£å†³å¤æ‚çš„é—®é¢˜ã€‚ä¾‹å¦‚, ä¸ºäº†åšå‡ºä¸€ä¸ªå¾®å‹çš„ASCIIè‰ºæœ¯èˆè¹ˆå›¾, ä½ å¯èƒ½è¦å»ºç«‹ä¸€ä¸ªæ•£åˆ—, é”®æ˜¯èˆè¹ˆåŠ¨ä½œçš„åç§°, é”®å€¼æ˜¯åŒ¿åæ•£åˆ—ã€‚å‡ä½¿ä½¿ç”¨è€…èƒ½é”®å…¥ä¸€ç³»åˆ—èˆè¹ˆåŠ¨ä½œï¼ˆå¯èƒ½æ˜¯ç«™åœ¨èˆè¹ˆå¹³å°ä¸Šæˆ–å…¶å®ƒå¤–éƒ¨è¾“å…¥è®¾å¤‡ï¼‰ã€‚ ä½ æ€ä¹ˆä¿æŒä¸€ä¸ªå˜é‡æ¸…å•ä¸­éƒ½æ˜¯åˆæ³•çš„è¡Œä¸º, å…è®¸ä½¿ç”¨è€…è¾“å…¥, å¹¶é™åˆ¶è¾“å…¥æ˜¯ä¸€ç³»åˆ—å®‰å…¨çš„è¡Œä¸ºå‘¢ï¼Ÿ</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%moves</span> <span class="o">=</span>
<span class="s">hands-over-head</span>       <span class="o">=&gt;</span> <span class="k">sub</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">/o\ </span><span class="p">&#39;</span>  <span class="p">}</span>,
<span class="s">bird-arms</span>             <span class="o">=&gt;</span> <span class="k">sub</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">|/o\| </span><span class="p">&#39;}</span>,
<span class="s">left</span>                  <span class="o">=&gt;</span> <span class="k">sub</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">&gt;o </span><span class="p">&#39;</span>   <span class="p">}</span>,
<span class="s">right</span>                 <span class="o">=&gt;</span> <span class="k">sub</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">o&lt; </span><span class="p">&#39;</span>   <span class="p">}</span>,
<span class="s">arms-up</span>               <span class="o">=&gt;</span> <span class="k">sub</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">\o/ </span><span class="p">&#39;</span>  <span class="p">};</span>

<span class="k">my</span> <span class="nv">@awesome-dance</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">arms-up bird-arms right hands-over-head</span><span class="p">&gt;;</span>

<span class="k">for</span> <span class="nv">@awesome-dance</span> <span class="k">-&gt;</span> <span class="nv">$move</span> <span class="p">{</span>
    <span class="nv">%moves</span><span class="p">{</span><span class="nv">$move</span><span class="p">}</span><span class="o">.</span><span class="p">();</span>  <span class="c1"># åœ¨æ•£åˆ—ä¸Šè°ƒç”¨æ–¹æ³•</span>
<span class="p">}</span>
</code></pre></div><pre><code>outputs:
 \o/
|/o\|
  o&lt;
 /o\.
</code></pre>
<h3 id="adding-signatures">Adding Signatures</h3>
<p>å­ä¾‹ç¨‹çš„ç­¾åæ‰§è¡Œä¸¤ä¸ªä»»åŠ¡ã€‚é¦–å…ˆ, å®ƒç”³æ˜å“ªä¸ªè°ƒç”¨è€…å¯èƒ½æˆ–å¿…é¡»å°†å‚æ•°ä¼ é€’ç»™å­ä¾‹ç¨‹ã€‚ç¬¬äºŒ, å®ƒç”³æ˜å­ä¾‹ç¨‹ä¸­çš„å˜é‡è¢«ç»‘å®šåˆ°å“ªäº›å‚æ•°ä¸Šã€‚è¿™äº›å˜é‡å«åšå‚æ•°ã€‚Raku çš„ç­¾åæ›´æ·±å…¥, å®ƒä»¬å…è®¸ä½ é™åˆ¶å‚æ•°çš„ç±»å‹, å€¼å’Œå‚æ•°çš„å®šä¹‰, å¹¶å‡†ç¡®åŒ¹é…å¤æ‚æ•°æ®ç»“æ„çš„æŸä¸€éƒ¨åˆ†ã€‚æ­¤å¤–, å®ƒä»¬ä¹Ÿå…è®¸ä½ æ˜¾å¼åœ°æŒ‡å®šå­ä¾‹ç¨‹è¿”å›å€¼çš„ç±»å‹ã€‚</p>
<h4 id="åŸºç¡€">åŸºç¡€</h4>
<p>ç­¾åæœ€ç®€å•çš„å½¢å¼æ˜¯, ç»‘å®šåˆ°è¾“å…¥å‚æ•°ä¸Šçš„ç”¨é€—å·åˆ†éš”çš„ä¸€åˆ—å˜é‡çš„åå­—ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">order-beer</span><span class="p">(</span><span class="nv">$type</span><span class="o">,</span> <span class="nv">$pints</span><span class="p">)</span> <span class="p">{</span>
   <span class="nb">say</span> <span class="p">(</span><span class="nv">$pints</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">??</span> <span class="p">&#39;</span><span class="s1">A pint</span><span class="p">&#39;</span> <span class="o">!!</span> <span class="p">&#34;</span><span class="nv">$pints</span><span class="s2"> pints</span><span class="p">&#34;)</span> <span class="o">~</span> <span class="p">&#34;</span><span class="s2"> of </span><span class="nv">$type</span><span class="s2">, please.</span><span class="p">&#34;</span>
<span class="p">}</span>

<span class="nf">order-beer</span><span class="p">(&#39;</span><span class="s1">Hobgoblin</span><span class="p">&#39;</span><span class="o">,</span> <span class="mi">1</span><span class="p">);</span>    <span class="c1"># A pint of Hobgoblin, please.</span>
<span class="nf">order-beer</span><span class="p">(&#39;</span><span class="s1">ZlatÃ½ BaÅ¾ant</span><span class="p">&#39;</span><span class="o">,</span> <span class="mi">3</span><span class="p">);</span> <span class="c1"># 3 pints of ZlatÃ½ BaÅ¾ant, please.</span>
</code></pre></div><p>è¿™é‡Œä½¿ç”¨çš„å…³ç³»ç»‘å®šè€Œéèµ‹å€¼å°±æ˜¯ç­¾åã€‚é»˜è®¤åœ°, åœ¨ Raku ä¸­, å­ä¾‹ç¨‹ä¸­å¼•ç”¨åˆ°ä¼ å…¥å‚æ•°çš„ç­¾åçš„å˜é‡æ˜¯åªè¯»çš„ã€‚è¿™æ„å‘³ç€ä½ ä¸èƒ½ä»å­ä¾‹ç¨‹å†…éƒ¨ä¿®æ”¹å®ƒä»¬ã€‚
å¦‚æœåªè¯»ç»‘å®šå¤ªå—é™åˆ¶äº†, ä½ å¯ä»¥å°† <code>is rw</code> (rw æ˜¯ read/write çš„ç¼©å†™) ç‰¹æ€§åº”ç”¨åˆ°å‚æ•°ä¸Šä»¥é™ä½è¿™ç§é™åˆ¶ã€‚è¿™ä¸ªç‰¹æ€§è¯´æ˜å‚æ•°æ˜¯å¯è¯»å¯å†™çš„, è¿™å…è®¸ä½ ä»å­ä¾‹ç¨‹å†…éƒ¨ä¿®æ”¹å‚æ•°ã€‚ä½¿ç”¨çš„æ—¶å€™å¿…é¡»å°å¿ƒ, å› ä¸ºå®ƒä¼šä¿®æ”¹ä¼ å…¥çš„åŸå§‹å¯¹è±¡ã€‚å¦‚æœä½ è¯•å›¾ä¼ å…¥ä¸€ä¸ªå­—é¢å€¼, ä¸€ä¸ªå¸¸é‡, æˆ–å…¶å®ƒç±»å‹çš„ä¸å¯å˜å¯¹è±¡åˆ°ä¸€ä¸ªæœ‰ <code>is rw</code> ç‰¹æ€§çš„å‚æ•°ä¸­, ç»‘å®šä¼šåœ¨è°ƒç”¨æ—¶å¤±è´¥å¹¶æŠ›å‡ºå¼‚å¸¸:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">make-it-more-so</span><span class="p">(</span><span class="nv">$it</span> <span class="k">is</span> <span class="k">rw</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$it</span> <span class="o">~=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$it</span><span class="o">,</span> <span class="nv">$it</span><span class="o">.</span><span class="nb">chars</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="nb">x</span> <span class="mi">5</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$happy</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">yay!</span><span class="p">&#34;;</span>
<span class="nf">make-it-more-so</span><span class="p">(</span><span class="nv">$happy</span><span class="p">);</span>
<span class="nb">say</span> <span class="nv">$happy</span><span class="p">;</span> <span class="c1"># yay!!!!!!   # åŸå§‹ä¼ å…¥å¯¹è±¡è¢«ä¿®æ”¹äº†</span>
<span class="nf">make-it-more-so</span><span class="p">(&#34;</span><span class="s2">uh-oh</span><span class="p">&#34;);</span> <span class="c1"># å¤±è´¥, ä¸èƒ½ä¿®æ”¹ä¸€ä¸ªå¸¸é‡</span>
</code></pre></div><p>å¦‚æœä½ æƒ³å°†å‚æ•°çš„æœ¬åœ°å‰¯æœ¬ç”¨åœ¨å­ä¾‹ç¨‹å†…éƒ¨è€Œä¸æ”¹å˜è°ƒç”¨è€…çš„å˜é‡, ä½¿ç”¨ <code>is copy</code> ç‰¹æ€§ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">say-it-one-higher</span><span class="p">(</span><span class="nv">$it</span> <span class="k">is</span> <span class="nb">copy</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$it</span><span class="o">++</span><span class="p">;</span>
    <span class="nb">say</span> <span class="nv">$it</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">$unanswer</span> <span class="o">=</span> <span class="mi">41</span><span class="p">;</span>
<span class="nf">say-it-one-higher</span><span class="p">(</span><span class="nv">$unanswer</span><span class="p">);</span> <span class="c1"># 42</span>
<span class="nf">say-it-one-higher</span><span class="p">(</span><span class="mi">41</span><span class="p">);</span>        <span class="c1"># 42</span>
<span class="nb">say</span> <span class="nv">$unanswer</span><span class="p">;</span>                <span class="c1"># 41</span>
</code></pre></div><p>åœ¨è¯¸å¦‚ <code>C/C++</code> å’Œ Scheme ç­‰å…¶å®ƒç±»å‹çš„ç¼–ç¨‹è¯­è¨€ä¸­,è¿™ç§å¹¿ä¸ºäººçŸ¥çš„æ±‚å€¼ç­–ç•¥å°±æ˜¯æŒ‰å€¼ä¼ é€’ã€‚å½“ä½¿ç”¨ <code>is copy</code> ç‰¹æ€§æ—¶, åªæœ‰æœ¬åœ°å‰¯æœ¬è¢«èµ‹å€¼ã€‚å…¶å®ƒä»»ä½•ä¼ é€’ç»™å­ä¾‹ç¨‹çš„å‚æ•°åœ¨è°ƒç”¨è€…çš„ä½œç”¨åŸŸå†…ä¿æŒä¸å˜ã€‚ï¼ˆä¸€ä¸ªä¸å¯å˜å¯¹è±¡æ˜¯å½“è¿™ä¸ªå¯¹è±¡è¢«åˆ›å»ºå, å®ƒçš„çŠ¶æ€ä¸ä¼šæ”¹å˜, ä½œä¸ºæ¯”è¾ƒ, ä¸€ä¸ªå¯å˜å¯¹è±¡çš„çŠ¶æ€åœ¨åˆ›å»ºåæ˜¯ä¼šè¢«æ”¹å˜çš„ï¼‰</p>
<h4 id="ä¼ é€’æ•°ç»„æ•£åˆ—å’Œä»£ç ">ä¼ é€’æ•°ç»„ã€æ•£åˆ—å’Œä»£ç </h4>
<p>ä¸€ä¸ªå˜é‡çš„é­”ç¬¦è¡¨æ˜å®ƒçš„æœ¬æ„ç”¨é€”ã€‚åœ¨ç­¾åä¸­, å˜é‡çš„é­”ç¬¦ä¹Ÿèµ·ç€é™åˆ¶ä¼ å…¥çš„å‚æ•°ç±»å‹çš„ä½œç”¨ã€‚ä¾‹å¦‚, <code>@</code> ç¬¦å·æ£€æŸ¥ä¼ å…¥çš„å¯¹è±¡è¡Œä½¿ä½ç½®è§’è‰²ï¼ˆä¸€ä¸ªè§’è‰²åŒ…å«åƒæ•°ç»„å’Œåˆ—è¡¨çš„ç±»å‹ï¼‰ã€‚å¦‚æœä¼ é€’çš„ä¸œè¥¿ä¸èƒ½åŒ¹é…è¿™æ ·çš„é™åˆ¶, ä¼šå¼•èµ·è°ƒç”¨å¤±è´¥ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">shout-them</span><span class="p">(</span><span class="nv">@words</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="nv">@words</span> <span class="k">-&gt;</span> <span class="nv">$w</span> <span class="p">{</span>
        <span class="nb">print</span> <span class="nb">uc</span><span class="p">(&#34;</span><span class="nv">$w</span><span class="s2"> </span><span class="p">&#34;);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">@last_words</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">do not want</span><span class="p">&gt;;</span>

<span class="nf">shout-them</span><span class="p">(</span><span class="nv">@last_words</span><span class="p">);</span> <span class="c1"># DO NOT WANT</span>
<span class="nf">shout-them</span><span class="p">(&#39;</span><span class="s1">help</span><span class="p">&#39;);</span>      <span class="c1"># å¤±è´¥äº†, å­—ç¬¦ä¸²ä¸æ˜¯ä½ç½®å‚æ•°</span>
</code></pre></div><p>ç±»ä¼¼åœ°, <code>%</code> ç¬¦å·è¡¨æ˜è°ƒç”¨è€…å¿…é¡»ä¼ é€’ä¸€ä¸ªè¡Œä½¿å…³ç³»è§’è‰²çš„å¯¹è±¡ï¼›å³å…è®¸é€šè¿‡ <code>&lt;...&gt;</code> æˆ– <code>{...}</code> è¿›è¡Œç´¢å¼•çš„ä¸œè¥¿ã€‚ <code>&amp;</code> ç¬¦å·è¦æ±‚è°ƒç”¨è€…ä¼ é€’ä¸€ä¸ªè¯¸å¦‚åŒ¿åæ•£åˆ—ä¹‹ç±»çš„è¡Œä½¿èƒ½è°ƒç”¨çš„è§’è‰²çš„å¯¹è±¡ã€‚åœ¨é‚£ç§æƒ…å†µä¸‹, ä½ ä¹Ÿå¯ä»¥ä¸ç”¨ <code>&amp;</code> ç¬¦å·è°ƒç”¨å¯è°ƒç”¨çš„å‚æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">do-it-lots</span><span class="p">(</span><span class="nv">&amp;it</span><span class="o">,</span> <span class="nv">$how-many-times</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="nv">$how-many-times</span> <span class="p">{</span>
        <span class="nf">it</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nf">do-it-lots</span><span class="p">(</span><span class="k">sub</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Eating a stroopwafel</span><span class="p">&#34;</span> <span class="p">}</span><span class="o">,</span> <span class="mi">10</span><span class="p">);</span> <span class="c1"># æ­¤å¤„æ˜¯ä¸€ä¸ªåŒ¿åå­ä¾‹ç¨‹</span>
</code></pre></div><p>æ ‡é‡ä½¿ç”¨ <code>$</code> ç¬¦å·, å¹¶è¡¨æ˜æ²¡æœ‰é™åˆ¶ã€‚ä»€ä¹ˆéƒ½å¯ä»¥ç»‘å®šåœ¨å®ƒä¸Šé¢, å³ä½¿å®ƒä½¿ç”¨å¦å¤–çš„ç¬¦å·ç»‘å®šåˆ°ä¸€ä¸ªå¯¹è±¡ä¸Šã€‚</p>
<h4 id="æ’å€¼æ•°ç»„å’Œæ•£åˆ—">æ’å€¼ã€æ•°ç»„å’Œæ•£åˆ—</h4>
<p>æœ‰æ—¶ä½ æƒ³ä»æ•°ç»„ä¸­å¡«å……å ä½å‚æ•°ã€‚ä½ å¯ä»¥é€šè¿‡åœ¨æ•°ç»„å‰æ·»åŠ ä¸€ä¸ªå‚ç›´ç«–æ¡æˆ–ç®¡é“å­—ç¬¦ ( <code>|</code> ): <code>eat(|@food)</code>, è€Œä¸æ˜¯å†™ä½œ <code>eat(@food[0], @food[1], @food[2], ...)</code> ç­‰å°†å®ƒä»¬å¸è¿›å‚æ•°åˆ—è¡¨( <code>|</code> åƒä¸åƒä¸€ä¸ªå¸ç®¡, ^_^)ã€‚</p>
<p>åŒæ ·åœ°, ä½ å¯ä»¥å°†æ•£åˆ—æ’å€¼è¿›å…·åå‚æ•°:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">order-shrimps</span><span class="p">(</span><span class="nv">$count</span><span class="o">,</span> <span class="o">:</span><span class="nv">$from</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">I&#39;d like </span><span class="nv">$count</span><span class="s2"> pieces of shrimp from the </span><span class="nv">$from</span><span class="s2">, please</span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nv">%user-preferences</span> <span class="o">=</span> <span class="s">from</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">Northern Sea</span><span class="p">&#39;;</span>

<span class="nf">order-shrimps</span><span class="p">(</span><span class="mi">3</span><span class="o">,</span> <span class="o">|</span><span class="nv">%user-preferences</span><span class="p">);</span>
<span class="c1"># I&#39;d like 3 pieces of shrimp from the Northern Sea, please</span>
</code></pre></div><h4 id="å¯é€‰å‚æ•°">å¯é€‰å‚æ•°</h4>
<p>ä¸ºä½¿å‚æ•°å¯é€‰, è¦ä¹ˆç»™ç­¾åçš„å‚æ•°èµ‹å€¼ä¸ºé»˜è®¤å€¼ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">order-steak</span><span class="p">(</span><span class="nv">$how</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">medium</span><span class="p">&#39;)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">I&#39;d like a steak, </span><span class="nv">$how</span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="nf">order-steak</span><span class="p">();</span>
<span class="nf">order-steak</span><span class="p">(&#39;</span><span class="s1">well done</span><span class="p">&#39;);</span>
</code></pre></div><p>æˆ–è€…åœ¨å‚æ•°åå­—çš„åé¢æ·»åŠ ä¸€ä¸ªé—®å·(?):</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">order-burger</span><span class="p">(</span><span class="nv">$type</span><span class="o">,</span> <span class="nv">$side</span><span class="o">?</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">I&#39;d like a </span><span class="nv">$type</span><span class="s2"> burger</span><span class="p">&#34;</span> <span class="o">~</span>
    <span class="p">(</span> <span class="nb">defined</span><span class="p">(</span><span class="nv">$side</span><span class="p">)</span> <span class="o">??</span> <span class="p">&#34;</span><span class="s2"> with a side of </span><span class="nv">$side</span><span class="p">&#34;</span> <span class="o">!!</span> <span class="p">&#34;&#34;</span> <span class="p">);</span>
<span class="p">}</span>

<span class="nf">order-burger</span><span class="p">(&#34;</span><span class="s2">triple bacon</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">deep fried onion rings</span><span class="p">&#34;);</span>
</code></pre></div><p>å¦‚æœæ²¡æœ‰å‚æ•°è¢«ä¼ é€’, å‚æ•°ä¼šè¢«ç»‘å®šæˆä¸€ä¸ªæœªå®šä¹‰çš„å€¼ã€‚<code>defined(...)</code> å‡½æ•°ç”¨æ¥æ£€æŸ¥æ˜¯å¦æœ‰å€¼ã€‚</p>
<h4 id="å¼ºåˆ¶å‚æ•°">å¼ºåˆ¶å‚æ•°</h4>
<p>é»˜è®¤åœ°, ä½ç½®å‚æ•°æ˜¯å¿…ä¸å¯å°‘çš„ã€‚ç„¶è€Œ, ä½ å¯ä»¥é€šè¿‡åœ¨å‚æ•°åé¢è¿½åŠ ä¸€ä¸ªæ„Ÿå¹å·æ¥æ˜¾å¼åœ°æŒ‡å®šè¯¥å‚æ•°æ˜¯å¿…é¡»çš„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">order-drink</span><span class="p">(</span><span class="nv">$size</span><span class="o">,</span> <span class="nv">$flavor</span><span class="o">!</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$size</span><span class="s2"> </span><span class="nv">$flavor</span><span class="s2">, coming right up!</span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="nf">order-drink</span><span class="p">(&#39;</span><span class="s1">Large</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Mountain Dew</span><span class="p">&#39;);</span> <span class="c1"># OK</span>
<span class="nf">order-drink</span><span class="p">(&#39;</span><span class="s1">Small</span><span class="p">&#39;);</span>                 <span class="c1"># Error</span>
</code></pre></div><h4 id="å…·åå®å‚å’Œå½¢å‚">å…·åå®å‚å’Œå½¢å‚</h4>
<ul>
<li>arguments  å®å‚</li>
<li>parameters å½¢å‚</li>
</ul>
<p>å½“ä¸€ä¸ªå­ä¾‹ç¨‹æœ‰å¾ˆå¤šå‚æ•°æ—¶, è°ƒç”¨è€…å¾ˆéš¾è®°æ¸…ä¼ é€’å‚æ•°çš„é¡ºåºã€‚è¿™ç§æƒ…å†µä¸‹, é€šè¿‡åå­—ä¼ é€’å‚æ•°å¾€å¾€æ›´å®¹æ˜“ã€‚è¿™æ ·, å‚æ•°å‡ºç°çš„é¡ºåºå°±æ— å…³ç´§è¦äº†:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">order-beer</span><span class="p">(</span><span class="nv">$type</span><span class="o">,</span> <span class="nv">$pints</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">(</span><span class="nv">$pints</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">??</span> <span class="p">&#39;</span><span class="s1">A pint</span><span class="p">&#39;</span> <span class="o">!!</span> <span class="p">&#34;</span><span class="nv">$pints</span><span class="s2"> pints</span><span class="p">&#34;)</span> <span class="o">~</span> <span class="p">&#34;</span><span class="s2"> of </span><span class="nv">$type</span><span class="s2">, please.</span><span class="p">&#34;</span>
<span class="p">}</span>

<span class="nf">order-beer</span><span class="p">(</span><span class="s">type</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">Hobgoblin</span><span class="p">&#39;</span>, <span class="s">pints</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">);</span>
<span class="c1"># A pint of Hobgoblin, please.</span>

<span class="nf">order-beer</span><span class="p">(</span><span class="s">pints</span> <span class="o">=&gt;</span> <span class="mi">3</span>, <span class="s">type</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">ZlatÃ½ BaÅ¾ant</span><span class="p">&#39;);</span>
<span class="c1"># 3 pints of ZlatÃ½ BaÅ¾ant, please.</span>
</code></pre></div><p>ä½ ä¹Ÿå¯ä»¥æŒ‡å®šå‚æ•°åªèƒ½æŒ‰åå­—è¢«ä¼ é€’ï¼ˆè¿™æ„å‘³ç€å®ƒä¸å…è®¸æŒ‰ä½ç½®ä¼ é€’ï¼‰ã€‚è¿™æ ·çš„è¯, åœ¨å‚æ•°åå­—å‰åŠ ä¸€ä¸ªå†’å·ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">order-shrimps</span><span class="p">(</span><span class="nv">$count</span><span class="o">,</span> <span class="o">:</span><span class="nv">$from</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">Northern Sea</span><span class="p">&#39;)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">I&#39;d like </span><span class="nv">$count</span><span class="s2"> pieces of shrimp from the </span><span class="nv">$from</span><span class="s2">, please</span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="nf">order-shrimps</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span> <span class="c1"># takes &#39;Northern Sea&#39;</span>
<span class="nf">order-shrimps</span><span class="p">(</span><span class="mi">4</span><span class="o">,</span> <span class="s">from</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">Atlantic Ocean</span><span class="p">&#39;);</span>
<span class="nf">order-shrimps</span><span class="p">(</span><span class="mi">22</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Mediterranean Sea</span><span class="p">&#39;);</span>   <span class="c1"># ä¸å…è®¸, :$from is named only</span>
</code></pre></div><p>ä¸åƒä½ç½®å‚æ•°, å‘½åå‚æ•°é»˜è®¤æ˜¯å¯é€‰çš„ã€‚åœ¨å‘½åå‚æ•°åé¢è¿½åŠ ä¸€ä¸ª <code>!</code> å·ä½¿å‘½åå‚æ•°å¼ºåˆ¶æ€§å­˜åœ¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">design-ice-cream-mixture</span><span class="p">(</span><span class="nv">$base</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">Vanilla</span><span class="p">&#39;</span><span class="o">,</span> <span class="o">:</span><span class="nv">$name</span><span class="o">!</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Creating a new recipe named </span><span class="nv">$name</span><span class="s2">!</span><span class="p">&#34;</span>
<span class="p">}</span>

<span class="nf">design-ice-cream-mixture</span><span class="p">(</span><span class="s">name</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">Plain</span><span class="p">&#39;);</span>
<span class="nf">design-ice-cream-mixture</span><span class="p">(</span><span class="s">base</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">Strawberry chip</span><span class="p">&#39;);</span> <span class="c1"># é”™è¯¯</span>,<span class="n">æ²¡æœ‰æŒ‡å®š</span> <span class="nv">$name</span>
</code></pre></div><p><strong>é‡å‘½åå‚æ•°</strong></p>
<p>å› ä¸ºæŒ‰åå­—ä¼ é€’å®å‚ç»™å½¢å‚æ˜¯åˆç†çš„, å½¢å‚çš„åå­—åº”è¯¥åº”è¯¥ä½œä¸ºå­ä¾‹ç¨‹å…¬å…± API çš„ä¸€éƒ¨åˆ†è¢«è€ƒè™‘åœ¨å†…. å°å¿ƒåœ°æŒ‘é€‰å®ƒä»¬å§! æœ‰æ—¶å€™, ä½¿ç”¨ä¸€ä¸ªåå­—æš´éœ²å½¢å‚è€Œä½¿ç”¨å¦å¤–ä¸€ä¸ªåå­—ç»‘å®šåˆ°å˜é‡ä¼šå¾ˆæ–¹ä¾¿:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">announce-time</span><span class="p">(:</span><span class="s">dinner</span><span class="p">(</span><span class="nv">$supper</span><span class="p">)</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">8pm</span><span class="p">&#39;)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">We eat dinner at </span><span class="nv">$supper</span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="nf">announce-time</span><span class="p">(</span><span class="s">dinner</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">9pm</span><span class="p">&#39;);</span> <span class="c1"># We eat dinner at 9pm</span>
</code></pre></div><p>å‚æ•°å¯ä»¥æœ‰å¤šä¸ªåå­—, å¦‚æœä½ çš„ç”¨æˆ·æœ‰äº›æ˜¯è‹±å›½äºº, æœ‰äº›æ˜¯ç¾å›½äºº, ä½ å¯èƒ½è¿™æ ·å†™ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">paint-rectangle</span><span class="p">(</span>
    <span class="o">:</span><span class="nv">$x</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span>
    <span class="o">:</span><span class="nv">$y</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span>
    <span class="o">:</span><span class="nv">$width</span> <span class="o">=</span> <span class="mi">100</span><span class="o">,</span>
    <span class="o">:</span><span class="nv">$height</span> <span class="o">=</span> <span class="mi">50</span><span class="o">,</span>
    <span class="p">:</span><span class="s">color</span><span class="p">(:</span><span class="s">colour</span><span class="p">(</span><span class="nv">$c</span><span class="p">)))</span> <span class="p">{</span>

    <span class="c1"># print a piece of SVG that represents a rectangle</span>
    <span class="nb">say</span> <span class="k">qq</span><span class="p">[</span><span class="s2">&lt;rect x=&#34;</span><span class="nv">$x</span><span class="s2">&#34; y=&#34;</span><span class="nv">$y</span><span class="s2">&#34; width=&#34;</span><span class="nv">$width</span><span class="s2">&#34; height=&#34;</span><span class="nv">$height</span><span class="s2">&#34; &gt;</span><span class="p">]</span>
<span class="p">}</span>

<span class="c1"># both calls work the same</span>
<span class="n">paint-rectangle</span> <span class="p">:</span><span class="s">color</span><span class="p">&lt;</span><span class="s">Blue</span><span class="p">&gt;;</span>
<span class="n">paint-rectangle</span> <span class="p">:</span><span class="s">colour</span><span class="p">&lt;</span><span class="s">Blue</span><span class="p">&gt;;</span>

<span class="c1"># of course you can still fill the other options</span>
<span class="n">paint-rectangle</span> <span class="p">:</span><span class="s">width</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">height</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">colour</span><span class="p">&lt;</span><span class="s">Blue</span><span class="p">&gt;;</span>
</code></pre></div><p><strong>å¯é€‰çš„å‘½åå‚æ•°è¯­æ³•</strong></p>
<p>å‘½åå˜é‡é€šå¸¸æ˜¯æˆå¯¹çš„ï¼ˆé”®å€¼å¯¹ï¼‰ã€‚å†™ä¸€ä¸ª <code>Pairs</code> æœ‰å¤šç§æ–¹å¼ã€‚å„ç§æ–¹æ³•çš„ä¸åŒä¹‹å¤„å°±æ˜¯æ¸…æ™°æ€§, å› ä¸ºæ¯ç§é€‰æ‹©æä¾›ä¸åŒçš„å¼•è¿°æœºåˆ¶ã€‚ä¸‹é¢çš„ä¸‰ç§è°ƒç”¨æ˜¯ä¸€æ ·çš„æ„æ€ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nf">announce-time</span><span class="p">(</span><span class="s">dinner</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">9pm</span><span class="p">&#39;);</span>
<span class="nf">announce-time</span><span class="p">(:</span><span class="s">dinner</span><span class="p">(&#39;</span><span class="s1">9pm</span><span class="p">&#39;));</span>
<span class="nf">announce-time</span><span class="p">(:</span><span class="s">dinner</span><span class="p">&lt;</span><span class="s">9pm</span><span class="p">&gt;);</span>
</code></pre></div><p>å¦‚æœä¼ é€’çš„æ˜¯å¸ƒå°”å€¼, ä½ å¯ä»¥çœç•¥é”®å€¼å¯¹çš„é”®å€¼ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nf">toggle-blender</span><span class="p">(</span> <span class="p">:</span><span class="s">enabled</span><span class="p">);</span> <span class="c1"># enables the blender å¼€å¯æœæ±æœº</span>
<span class="nf">toggle-blender</span><span class="p">(:!</span><span class="s">enabled</span><span class="p">);</span> <span class="c1"># disables the blender å…³é—­æœæ±æœº</span>
</code></pre></div><p>å½¢å¦‚ <code>:name</code> ä½†ä¸å¸¦å€¼çš„å‘½åå‚æ•°æœ‰ä¸€ä¸ªéšå¼çš„å¸ƒå°”çœŸå€¼ <code>Bool::True</code>ã€‚å®ƒçš„å¯¹ç«‹å½¢å¼æ˜¯ <code>:!name</code> , å…¶å€¼æ˜¯éšå¼çš„å¸ƒå°”å‡å€¼ <code>Bool::false</code>ã€‚å¦‚æœä½ ä½¿ç”¨å˜é‡åˆ›å»ºäº†ä¸€ä¸ª <code>Pair</code>, ä½ å¯ä»¥å°†å˜é‡åä½œä¸º <code>Pair</code> çš„é”®å¤ç”¨.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$dinner</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">9pm</span><span class="p">&#39;;</span>
<span class="n">announce-dinner</span> <span class="o">:</span><span class="nv">$dinner</span><span class="p">;</span> <span class="c1"># same as dinner =&gt; $dinner;</span>
</code></pre></div><pre><code>                        Pair forms and their meanings.

    Shorthand      Long form                          Description
:allowed           allowed =&gt; Bool::True               Boolean flag
:!allowed          allowed =&gt; Bool::False              Boolean flag
:bev&lt;tea coffee&gt;   bev =&gt; ('tea', 'coffee')            List
:times[1, 3]       times =&gt; [1, 3]                     Array
:opts{ a =&gt; 2 }    opts =&gt; { a =&gt; 2 }                  Hash
:$var              var =&gt; $var Scalar                  variable
:@var              var =&gt; @var Array                   variable
:%var              var =&gt; %var Hash                    variable
:&amp;var              vaf =&gt; &amp;var Callable/ Subroutine    variable
</code></pre>
<p>ä½ å¯ä»¥ä½¿ç”¨åœ¨ä»»ä½•å¯ä»¥ä½¿ç”¨ Pair å¯¹è±¡çš„ä¸Šä¸‹æ–‡ä½¿ç”¨è¡¨ä¸­çš„ä»»æ„ä¸€ç§å½¢å¼. ä¾‹å¦‚, ç”Ÿæˆæ•£åˆ—:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># TODO: better example</span>
<span class="k">my</span> <span class="nv">$black</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">%color-popularities</span> <span class="o">=</span> <span class="o">:</span><span class="nv">$black</span><span class="o">,</span> <span class="p">:</span><span class="s">blue</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">,</span> <span class="s">red</span> <span class="o">=&gt;</span> <span class="mi">18</span>, <span class="p">:</span><span class="s">white</span><span class="p">&lt;</span><span class="s">0</span><span class="p">&gt;;</span>

<span class="c1"># ä¸æ­¤ç›¸åŒï¼š</span>
<span class="c1"># my %color-popularities =</span>
<span class="c1"># black =&gt; 12,</span>
<span class="c1"># blue =&gt; 8,</span>
<span class="c1"># red =&gt; 18,</span>
<span class="c1"># white =&gt; 0;</span>
</code></pre></div><p>æœ€å, é€šè¿‡ä½ç½®è€Œéåå­—ä¼ é€’ä¸€ä¸ªå·²å­˜åœ¨çš„ Pair å¯¹è±¡åˆ°å­ä¾‹ç¨‹ä¸­, è¦ä¹ˆæŠŠå®ƒæ”¾åœ¨åœ†æ‹¬å·ä¸­ ( å°±åƒ (<code>:$thing</code>) ), æˆ–è€…ä½¿ç”¨ <code>=&gt;</code> æ“ä½œç¬¦å¼•èµ·å·¦ä¾§çš„å­—ç¬¦ä¸²: <code>&quot;thing&quot; =&gt; $thing</code>ã€‚</p>
<p><strong>å‚æ•°çš„é¡ºåº</strong></p>
<p>å½“ä½ç½®å‚æ•°å’Œå‘½åå‚æ•°éƒ½å‡ºç°åœ¨ç­¾åä¸­æ—¶, æ‰€æœ‰çš„ä½ç½®å‚æ•°éƒ½è¦å‡ºç°åœ¨å‘½åå‚æ•°ä¹‹å‰ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">mix</span><span class="p">(</span><span class="nv">@ingredients</span><span class="o">,</span> <span class="o">:</span><span class="nv">$name</span><span class="p">)</span>    <span class="p">{</span> <span class="o">...</span> <span class="p">}</span> <span class="c1"># OK</span>
<span class="k">sub</span> <span class="nf">notmix</span><span class="p">(</span><span class="o">:</span><span class="nv">$name</span><span class="o">,</span> <span class="nv">@ingredients</span><span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span> <span class="c1"># Error</span>
</code></pre></div><p>å¿…é¡»çš„ä½ç½®å‚æ•°è¦åœ¨å¯é€‰çš„ä½ç½®å‚æ•°ä¹‹å‰ã€‚ç„¶è€Œ, å‘½åå‚æ•°æ²¡æœ‰è¿™ç§é™åˆ¶ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">copy-machine</span><span class="p">(</span><span class="nv">$amount</span><span class="o">,</span> <span class="nv">$size</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">A4</span><span class="p">&#39;</span><span class="o">,</span> <span class="o">:</span><span class="nv">$color</span><span class="o">!,</span> <span class="o">:</span><span class="nv">$quality</span><span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span> <span class="c1"># OK</span>
<span class="k">sub</span> <span class="nf">fax-machine</span><span class="p">(</span><span class="nv">$amount</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="nv">$number</span><span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span> <span class="c1"># Error</span>
</code></pre></div><h4 id="slurpy-å‚æ•°">Slurpy å‚æ•°</h4>
<p>æœ‰æ—¶å€™, ä½ ä¼šå¸Œæœ›è®©å­ä¾‹ç¨‹æ¥å—ä»»ä½•æ•°é‡çš„å‚æ•°, å¹¶ä¸”å°†æ‰€æœ‰è¿™äº›å‚æ•°æ”¶é›†åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„, ç»™ç­¾åæ·»åŠ ä¸€ä¸ªæ•°ç»„å‚æ•°, å°±æ˜¯åœ¨æ•°ç»„å‰æ·»åŠ ä¸€ä¸ª <code>*</code> å·å‰ç¼€ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">shout-them</span><span class="p">(</span><span class="o">*</span><span class="nv">@words</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="nv">@words</span> <span class="k">-&gt;</span> <span class="nv">$w</span> <span class="p">{</span>
        <span class="nb">print</span> <span class="nb">uc</span><span class="p">(&#34;</span><span class="nv">$w</span><span class="s2"> </span><span class="p">&#34;);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># ç°åœ¨ä½ å¯ä»¥ä¼ é€’é¡¹</span>
<span class="nf">shout-them</span><span class="p">(&#39;</span><span class="s1">go</span><span class="p">&#39;);</span>         <span class="c1"># GO</span>
<span class="nf">shout-them</span><span class="p">(&#39;</span><span class="s1">go</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">home</span><span class="p">&#39;);</span> <span class="c1"># GO HOME</span>
</code></pre></div><p>é™¤äº†é›†åˆæ‰€æœ‰çš„å€¼ä¹‹å¤–, slurpy å‚æ•°ä¼šå±•å¹³ä»»ä½•å®ƒæ¥æ”¶åˆ°çš„æ•°ç»„, æœ€åä½ åªä¼šå¾—åˆ°ä¸€ä¸ªå±•å¹³çš„åˆ—è¡¨, å› æ­¤ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@words</span> <span class="o">=</span> <span class="p">(&#39;</span><span class="s1">go</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">home</span><span class="p">&#39;);</span>
<span class="nf">shout-them</span><span class="p">(</span><span class="nv">@words</span><span class="p">);</span>
</code></pre></div><p>ä¼šå¯¼è‡´ <code>*@words</code> å‚æ•°æœ‰ä¸¤ä¸ªå­—ç¬¦ä¸²å…ƒç´ , è€Œéåªæœ‰å•ä¸ªæ•°ç»„å…ƒç´ ã€‚</p>
<p>ä½ å¯ä»¥é€‰æ‹©å°†æŸäº›å‚æ•°æ•è·åˆ°ä½ç½®å‚æ•°ä¸­, å¹¶è®©å…¶å®ƒå‚æ•°è¢«å¸è¿›æ•°ç»„å‚æ•°é‡Œã€‚è¿™ç§æƒ…å†µä¸‹, <code>slupy</code> åº”è¯¥æ”¾åˆ°æœ€åã€‚ç›¸ä¼¼åœ°, <code>*%hash</code> slurps æ‰€æœ‰å‰©ä¸‹çš„æœªç»‘å®šçš„å‘½åå‚æ•°åˆ°æ•£åˆ— <code>%hash</code> ä¸­ã€‚<code>Slurpy</code> æ•°ç»„å’Œæ•£åˆ—å…è®¸ä½ ä¼ é€’æ‰€æœ‰çš„ä½ç½®å‚æ•°å’Œå‘½åå‚æ•°åˆ°å¦ä¸€ä¸ªå­ä¾‹ç¨‹ä¸­ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku">
<span class="k">sub</span> <span class="nf">debug-wrapper</span><span class="p">(</span><span class="nv">&amp;code</span><span class="o">,</span> <span class="o">*</span><span class="nv">@positional</span><span class="o">,</span> <span class="o">*</span><span class="nv">%named</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">warn</span> <span class="p">&#34;</span><span class="s2">Calling &#39;</span><span class="nv">&amp;code</span><span class="o">.</span><span class="nf">name</span><span class="p">()</span><span class="s2">&#39; with arguments </span><span class="p">&#34;</span>
    <span class="o">~</span> <span class="p">&#34;</span><span class="nv">@positional</span><span class="o">.</span><span class="nf">perl</span><span class="p">()</span><span class="s2">, </span><span class="nv">%named</span><span class="o">.</span><span class="nf">perl</span><span class="p">()</span><span class="s2">\n</span><span class="p">&#34;;</span>
    <span class="nb">code</span><span class="p">(</span><span class="o">|</span><span class="nv">@positional</span><span class="o">,</span> <span class="o">|</span><span class="nv">%named</span><span class="p">);</span>
    <span class="nb">warn</span> <span class="p">&#34;</span><span class="s2">... back from &#39;</span><span class="nv">&amp;code</span><span class="o">.</span><span class="nf">name</span><span class="p">()</span><span class="s2">&#39;\n</span><span class="p">&#34;;</span>
<span class="p">}</span>

<span class="nf">debug-wrapper</span><span class="p">(</span><span class="nv">&amp;order-shrimps</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="s">from</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">Atlantic Ocean</span><span class="p">&#39;);</span>
</code></pre></div><h3 id="è¿”å›å€¼">è¿”å›å€¼</h3>
<p>å­ä¾‹ç¨‹ä¹Ÿèƒ½è¿”å›å€¼ã€‚ä¹‹å‰æœ¬ç« ä¸­çš„ ASCII è‰ºæœ¯èˆè¹ˆä¾‹å­ä¼šæ›´ç®€å•å½“æ¯ä¸ªå­ä¾‹ç¨‹è¿”å›ä¸€ä¸ªæ–°å­—ç¬¦ä¸²ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%moves</span> <span class="o">=</span> <span class="s">hands-over-head</span> <span class="o">=&gt;</span> <span class="k">sub</span> <span class="p">{</span> <span class="k">return</span> <span class="p">&#39;</span><span class="s1">/o\ </span><span class="p">&#39;</span>   <span class="p">}</span>,
            <span class="s">bird-arms</span>       <span class="o">=&gt;</span> <span class="k">sub</span> <span class="p">{</span> <span class="k">return</span> <span class="p">&#39;</span><span class="s1">|/o\| </span><span class="p">&#39;</span> <span class="p">}</span>,
            <span class="s">left</span>            <span class="o">=&gt;</span> <span class="k">sub</span> <span class="p">{</span> <span class="k">return</span> <span class="p">&#39;</span><span class="s1">&gt;o </span><span class="p">&#39;</span>    <span class="p">}</span>,
            <span class="s">right</span>           <span class="o">=&gt;</span> <span class="k">sub</span> <span class="p">{</span> <span class="k">return</span> <span class="p">&#39;</span><span class="s1">o&lt; </span><span class="p">&#39;</span>    <span class="p">}</span>,
            <span class="s">arms-up</span>         <span class="o">=&gt;</span> <span class="k">sub</span> <span class="p">{</span> <span class="k">return</span> <span class="p">&#39;</span><span class="s1">\o/ </span><span class="p">&#39;</span>   <span class="p">};</span>

<span class="k">my</span> <span class="nv">@awesome-dance</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">arms-up bird-arms right hands-over-head</span><span class="p">&gt;;</span>

<span class="k">for</span> <span class="nv">@awesome-dance</span> <span class="k">-&gt;</span> <span class="nv">$move</span> <span class="p">{</span>
    <span class="nb">print</span> <span class="nv">%moves</span><span class="p">{</span><span class="nv">$move</span><span class="p">}</span><span class="o">.</span><span class="p">();</span>
<span class="p">}</span>

<span class="nb">print</span> <span class="p">&#34;</span><span class="s2">\n</span><span class="p">&#34;;</span>
</code></pre></div><p>å­ä¾‹ç¨‹ä¹Ÿèƒ½è¿”å›å¤šä¸ªå€¼ï¼ˆè¯‘è€…æ³¨ï¼šé‚£ä¸å°±æ˜¯è¿”å›ä¸€ä¸ªåˆ—è¡¨å˜›ï¼‰ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">menu</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nb">rand</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(&#39;</span><span class="s1">fish</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">white wine</span><span class="p">&#39;)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">(&#39;</span><span class="s1">steak</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">red wine</span><span class="p">&#39;);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="p">(</span><span class="nv">$food</span><span class="o">,</span> <span class="nv">$beverage</span><span class="p">)</span> <span class="o">=</span> <span class="nf">menu</span><span class="p">();</span>
</code></pre></div><p>å¦‚æœä½ æŠŠ return è¯­å¥æ’é™¤åœ¨å¤–, åˆ™åœ¨å­ä¾‹ç¨‹å†…éƒ¨è¿è¡Œçš„æœ€åä¸€ä¸ªè¯­å¥äº§ç”Ÿçš„å€¼è¢«è¿”å›ã€‚è¿™æ„å‘³ç€å‰ä¸€ä¸ªä¾‹å­å¯ä»¥ç®€åŒ–ä¸ºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">menu</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nb">rand</span> <span class="o">&lt;</span> <span class="mf">0.5</span> <span class="p">{</span>
        <span class="p">&#39;</span><span class="s1">fish</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">white wine</span><span class="p">&#39;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="p">&#39;</span><span class="s1">steak</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">red wine</span><span class="p">&#39;;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">my</span> <span class="p">(</span><span class="nv">$food</span><span class="o">,</span> <span class="nv">$beverage</span><span class="p">)</span> <span class="o">=</span> <span class="nf">menu</span><span class="p">();</span>
</code></pre></div><p>è®°å¾—ï¼šå½“å­ä¾‹ç¨‹ä¸­çš„æ§åˆ¶æµæå…¶å¤æ‚æ—¶, æ·»åŠ ä¸€ä¸ªæ˜¾å¼çš„ return ä¼šè®©ä»£ç æ›´æ¸…æ™°, æ‰€ä»¥ return è¿˜æ˜¯åŠ ä¸Šçš„å¥½ã€‚
return å¦å¤–çš„å‰¯ä½œç”¨å°±æ˜¯æ‰§è¡Œåç«‹å³é€€å‡ºå­ä¾‹ç¨‹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">create-world</span><span class="p">(</span><span class="o">*</span><span class="nv">%characteristics</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$world</span> <span class="o">=</span> <span class="n">World</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="nv">%characteristics</span><span class="p">);</span>
    <span class="k">return</span> <span class="nv">$world</span> <span class="k">if</span> <span class="nv">%characteristics</span><span class="p">&lt;</span><span class="s">temporary</span><span class="p">&gt;;</span>

    <span class="nf">save-world</span><span class="p">(</span><span class="nv">$world</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>&hellip;å¹¶ä¸”ä½ æœ€å¥½åˆ«æ”¾é”™ä½ çš„æ–°å•è¯ <code>$word</code> å¦‚æœå®ƒæ˜¯ä¸´æ—¶çš„ã€‚å› ä¸ºè¿™æ˜¯ä½ è¦è·å–çš„ä»…æœ‰çš„ä¸€ä¸ªã€‚</p>
<h3 id="è¿”å›å€¼çš„ç±»å‹">è¿”å›å€¼çš„ç±»å‹</h3>
<p>åƒå…¶å®ƒç°ä»£è¯­è¨€ä¸€æ ·, Raku å…è®¸ä½ æ˜¾å¼åœ°æŒ‡å®šå­ä¾‹ç¨‹è¿”å›å€¼çš„ç±»å‹ã€‚è¿™å…è®¸ä½ é™åˆ¶ä»å­ä¾‹ç¨‹ä¸­è¿”å›çš„å€¼çš„ç±»å‹ã€‚ä½¿ç”¨ <code>returns</code> ç‰¹æ€§å¯ä»¥åšåˆ°è¿™æ ·ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">double-up</span><span class="p">(</span><span class="nv">$i</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Int</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$i</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">my</span> <span class="nb">Int</span> <span class="nv">$ultimate-answer</span> <span class="o">=</span> <span class="nf">double-up</span><span class="p">(</span><span class="mi">21</span><span class="p">);</span>  <span class="c1"># 42</span>
</code></pre></div><p>å½“ç„¶, ä½¿ç”¨è¿™ä¸ª <code>returns</code> ç‰¹æ€§æ˜¯å¯é€‰çš„</p>
<h3 id="working-with-types">Working With Types</h3>
<p>å¾ˆå¤šå­ä¾‹ç¨‹ä¸èƒ½å®Œæ•´æ„ä¹‰ä¸Šä½¿ç”¨ä»»æ„å‚æ•°å·¥ä½œ, ä½†æ˜¯è¦æ±‚å‚æ•°æ”¯æŒç¡®å®šçš„æ–¹æ³•æˆ–æœ‰å…¶å®ƒå±æ€§ã€‚è¿™ç§æƒ…å†µä¸‹, é™åˆ¶å‚æ•°ç±»å‹å°±æœ‰æ„ä¹‰äº†, è¯¸å¦‚ä¼ é€’ä¸æ­£ç¡®å€¼ä½œä¸ºå‚æ•°, å½“è°ƒç”¨å­ä¾‹ç¨‹æ—¶, è¿™ä¼šå¼•èµ· Raku å‘å‡ºé”™è¯¯, æˆ–è€…ç”šè‡³åœ¨ç¼–è¯‘æ—¶, å¦‚æœç¼–è¯‘å™¨è¶³å¤Ÿèªæ˜æ¥æ•æ‰é”™è¯¯ã€‚</p>
<h4 id="åŸºæœ¬ç±»å‹">åŸºæœ¬ç±»å‹</h4>
<p>æœ€ç®€å•çš„é™åˆ¶å­ä¾‹ç¨‹æ¥æ”¶å¯èƒ½çš„å€¼çš„æ–¹æ³•æ˜¯åœ¨å‚æ•°å‰å†™ä¸Šç±»å‹åã€‚ä¾‹å¦‚, ä¸€ä¸ªå­ä¾‹ç¨‹å¯¹å…¶å‚æ•°æ‰§è¡Œæ•°å€¼è®¡ç®—, è¿™è¦æ±‚å®ƒçš„å‚æ•°ç±»å‹æ˜¯ Numericï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">mean</span><span class="p">(</span><span class="nb">Numeric</span> <span class="nv">$a</span><span class="o">,</span> <span class="nb">Numeric</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">return</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">+</span> <span class="nv">$b</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="n">mean</span> <span class="mf">2.5</span><span class="o">,</span> <span class="mf">1.5</span><span class="p">;</span>
<span class="nb">say</span> <span class="n">mean</span> <span class="p">&#39;</span><span class="s1">some</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">strings</span><span class="p">&#39;;</span>
</code></pre></div><p>äº§ç”Ÿè¾“å‡ºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-txt" data-lang="txt">Nominal type check failed for parameter &#39;$a&#39;;
expected Numeric but got Str instead
</code></pre></div><p>nominal ç±»å‹æ˜¯ä¸€ä¸ªäººå®é™…ç±»å‹çš„åå­—, è¿™é‡Œæ˜¯ Numericã€‚
å¦‚æœå¤šä¸ªå‚æ•°æœ‰ç±»å‹é™åˆ¶, æ¯ä¸ªå‚æ•°å¿…é¡»å¡«å……å®ƒç»‘å®šçš„å‚æ•°é™åˆ¶çš„ç±»å‹</p>
<h4 id="æ·»åŠ é™åˆ¶">æ·»åŠ é™åˆ¶</h4>
<p>æœ‰æ—¶, ç±»å‹çš„åå­—ä¸è¶³ä»¥æè¿°å‚æ•°çš„è¦æ±‚ã€‚è¿™ç§æƒ…å†µä¸‹, ä½ å¯èƒ½ä½¿ç”¨ <code>where</code> ä»£ç å—æ·»åŠ ä¸€ä¸ªé¢å¤–çš„é™åˆ¶ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">circle-radius-from-area</span><span class="p">(</span><span class="nb">Real</span> <span class="nv">$area</span> <span class="k">where</span> <span class="p">{</span> <span class="nv">$area</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">})</span> <span class="p">{</span>
    <span class="p">(</span><span class="nv">$area</span> <span class="o">/</span> <span class="no">pi</span><span class="p">)</span><span class="o">.</span><span class="nb">sqrt</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="nf">circle-radius-from-area</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>  <span class="c1"># OK</span>
<span class="nb">say</span> <span class="nf">circle-radius-from-area</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">);</span> <span class="c1"># Error</span>
</code></pre></div><p>å› ä¸ºè¿™ç§è®¡ç®—åªå¯¹éè´Ÿé¢ç§¯å€¼æœ‰æ„ä¹‰, è¯¥å­ä¾‹ç¨‹çš„å‚æ•°åŒ…å«äº†ä¸€ä¸ªé™åˆ¶, å¯¹äºéè´Ÿå€¼å®ƒä¼šè¿”å›çœŸã€‚å¦‚æœè¿™ä¸ªé™åˆ¶è¿”å›ä¸€ä¸ªå‡çš„å€¼, ç±»å‹æ£€æŸ¥ä¼šå¤±è´¥, å½“æœ‰äº›ä¸œè¥¿è°ƒç”¨è¯¥å­ä¾‹ç¨‹æ—¶ã€‚</p>
<p>where ä¹‹åçš„ä»£ç å—æ˜¯å¯é€‰çš„ã€‚Raku é€šè¿‡é€šè¿‡æ™ºèƒ½åŒ¹é… where åé¢çš„å‚æ•°æ¥æ‰§è¡Œæ£€æŸ¥ã€‚
ä¾‹å¦‚, å®ƒå¯èƒ½æ¥å—åœ¨æŸä¸€ç¡®å®šèŒƒå›´ä¸­çš„å‚æ•°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">set-volume</span><span class="p">(</span><span class="nb">Numeric</span> <span class="nv">$volume</span> <span class="k">where</span> <span class="mi">0</span><span class="o">..</span><span class="mi">11</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Turning it up to </span><span class="nv">$volume</span><span class="p">&#34;;</span>
<span class="p">}</span>
</code></pre></div><p>æˆ–è€…ä½ å¯ä»¥å°†å‚æ•°é™åˆ¶ä¸ºæ•£åˆ—çš„é”®ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">%in-stock</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">Staropramen</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">8</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Mori</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">La Trappe</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">9</span><span class="p">;</span>

<span class="k">sub</span> <span class="nf">order-beer</span><span class="p">(</span><span class="nb">Str</span> <span class="nv">$name</span> <span class="k">where</span> <span class="nv">%in-stock</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Here&#39;s your </span><span class="nv">$name</span><span class="p">&#34;;</span>
    <span class="nv">%in-stock</span><span class="p">{</span><span class="nv">$name</span><span class="p">}</span><span class="o">--</span><span class="p">;</span>
    <span class="k">if</span> <span class="nv">%in-stock</span><span class="p">{</span><span class="nv">$name</span><span class="p">}</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">OH NO! That was the last </span><span class="nv">$name</span><span class="s2">, folks! :&#39;(</span><span class="p">&#34;;</span>
        <span class="nv">%in-stock</span><span class="o">.</span><span class="nb">delete</span><span class="p">(</span><span class="nv">$name</span><span class="p">);</span>
     <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="æŠ½è±¡å‚æ•°å’Œå…·ä½“å‚æ•°">æŠ½è±¡å‚æ•°å’Œå…·ä½“å‚æ•°</h3>
<p>ä¸‹é¢æ£€æµ‹å˜é‡æ˜¯å¦å®šä¹‰ã€‚åœ¨ Raku ä¸­è¿™æ ·å†™:</p>
<div class="highlight"><pre class="chroma"><code class="language-perl" data-lang="perl"> <span class="k">sub</span> <span class="nf">foo</span><span class="p">(Int:D $arg) {</span>
     <span class="c1"># Do something</span>
 <span class="p">}</span>
</code></pre></div><p>ç•™æ„é™„åŠ åœ¨å‚æ•°ç±»å‹åé¢çš„ <code>:D</code> ç¬‘è„¸ã€‚è¿™ä¸ªåŠ¨è¯è¡¨æ˜ç»™å®šçš„å‚æ•°å¿…é¡»è¢«ç»‘å®šåˆ°ä¸€ä¸ªå…·ä½“çš„å¯¹è±¡ä¸Šã€‚å¦‚æœä¸æ˜¯çš„è¯, ä¼šæŠ›å‡ºä¸€ä¸ªè¿è¡Œæ—¶å¼‚å¸¸ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒé‚£ä¹ˆé«˜å…´ï¼ä½œä¸ºå¯¹æ¯”, åŠ¨è¯ <code>:U</code> ç”¨äºè¡¨æ˜è¯¥å‚æ•°éœ€è¦ä¸€ä¸ªæœªå®šä¹‰çš„æˆ–æŠ½è±¡çš„å¯¹è±¡ã€‚æ­¤å¤–, åŠ¨è¯ <code>:_</code> å…è®¸å®šä¹‰æˆ–æœªå®šä¹‰çš„å€¼ã€‚å®é™…ä¸Š, ä½¿ç”¨ <code>:_</code> æœ‰ç‚¹å¤šä½™ã€‚</p>
<p>æœ€å, åŠ¨è¯ <code>:T</code> èƒ½ç”¨äºè¡¨æ˜å‚æ•°åªèƒ½æ˜¯ç±»å‹å¯¹è±¡, ä¾‹å¦‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">say-foobar</span><span class="p">(</span><span class="nb">Int</span><span class="p">:</span><span class="s">T</span> <span class="nv">$arg</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">FOOBAR!</span><span class="p">&#39;;</span>
<span class="p">}</span>

<span class="nf">say-foobar</span><span class="p">(</span><span class="nb">Int</span><span class="p">);</span>
<span class="c1"># FOOBAR!</span>
</code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Roles or When One Is Many]]></title>
            <link href="https://ohmyweekly.github.io/notes/2021-06-22-roles-or-when-one-is-many/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2021-06-17-raku-syntax-i-miss-in-other-languages/?utm_source=atom_feed" rel="related" type="text/html" title="Raku Syntax I Miss in Other Languages" />
                <link href="https://ohmyweekly.github.io/notes/2021-06-05-learn-raku-from-roast/?utm_source=atom_feed" rel="related" type="text/html" title="Learn Raku From Roast" />
                <link href="https://ohmyweekly.github.io/notes/2021-04-15-raku-multiple-dispatch-with-the-new-moarvm-dispatcher/?utm_source=atom_feed" rel="related" type="text/html" title="Raku Multiple Dispatch With the New MoarVM Dispatcher" />
                <link href="https://ohmyweekly.github.io/notes/2021-05-19-a-tour-of-rust-standard-library-traits/?utm_source=atom_feed" rel="related" type="text/html" title="Rust çš„æ ‡å‡†åº“ Trait ä¹‹æ—…" />
                <link href="https://ohmyweekly.github.io/notes/2021-04-05-psql/?utm_source=atom_feed" rel="related" type="text/html" title="Psql" />
            
                <id>https://ohmyweekly.github.io/notes/2021-06-22-roles-or-when-one-is-many/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-06-22T00:00:00+08:00</published>
            <updated>2021-06-22T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Roles or When One Is Many</blockquote><p>è®© Raku ä¸ Perl ç›¸å½“ä¸åŒçš„ä¸€ç‚¹æ˜¯ï¼Œ<a href="https://raku.org/">Raku</a> é¿å…äº†é­”æ³•ã€‚æœ‰å‡ ä¸ªåœ°æ–¹äººä»¬å¯ä»¥è¯´ï¼Œ&ldquo;å®ƒç¥å¥‡åœ°å‘ç”Ÿäº†&rdquo;ã€‚ä½†ä»”ç»†çœ‹ä¸€ä¸‹ï¼Œé€šå¸¸ä¼šå‘ç°è¡Œä¸ºèƒŒåæœ‰ç›¸å½“å¥½è§£é‡Šçš„æœºåˆ¶ã€‚è¿™å°±åƒçœ‹é­”æœ¯å¸ˆçš„æŠŠæˆï¼šæˆ‘ä»¬æ€»æ˜¯çŸ¥é“æœ‰è§£é‡Šï¼Œè€Œä¸”å®ƒä»¬è‚¯å®šæ˜¯ç¬¦åˆé€»è¾‘çš„ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘æœ‰ä¸ªå°æŠŠæˆç»™ä½ ã€‚çœ‹ä¸€ä¸‹ä»£ç ï¼Œå‘Šè¯‰æˆ‘ï¼šä½ åœ¨è¿™é‡Œçœ‹åˆ°äº†å¤šå°‘ä¸ªè§’è‰²ï¼Ÿ</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="ow">R</span><span class="p">[</span><span class="o">:</span><span class="p">:</span><span class="s">T</span><span class="p">]</span> <span class="p">{</span> <span class="k">has</span> <span class="nb">T</span> <span class="nv">$.a</span><span class="p">;</span> <span class="p">}</span>
<span class="k">class</span> <span class="nc">C</span> <span class="k">does</span> <span class="ow">R</span><span class="p">[</span><span class="nb">Int</span><span class="p">]</span> <span class="p">{</span> <span class="p">}</span>
</code></pre></div><p>ç›´è§‚çš„ç­”æ¡ˆå½“ç„¶æ˜¯ 1ï¼Œè¿™ä¹Ÿæ˜¯äº‹å®ã€‚ä½†è¿™é‡Œçš„éƒ¨åˆ†æŠ€å·§æ˜¯æœ¯è¯­çš„æ›¿æ¢ï¼šåœ¨ä½¿ç”¨&quot;è§’è‰²&quot;ä¸€è¯çš„åœ°æ–¹ï¼Œæ›´å‡†ç¡®çš„æœ¯è¯­åº”è¯¥æ˜¯&quot;è§’è‰²ç±»å‹å¯¹è±¡&quot;ã€‚ç°åœ¨ï¼Œè¯•ç€çŒœå‡ºæ­£ç¡®ç­”æ¡ˆã€‚è€Œä¸”ï¼Œè¦ç¡®å®šçš„æ˜¯ï¼Œå®ƒä¸æ­¢ä¸€ä¸ªã€‚</p>
<h2 id="raku-é­”æœ¯æ˜¯å¦‚ä½•ä¸ç¥å¥‡çš„">Raku é­”æœ¯æ˜¯å¦‚ä½•ä¸ç¥å¥‡çš„</h2>
<p>Raku çš„æœ€å¤§ä¼˜ç‚¹ä¹‹ä¸€ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œæˆ‘è¶Šæ¥è¶Šå­¦ä¼šé‡è§†ï¼Œå°±æ˜¯å®ƒåšä»»ä½•äº‹æƒ…éƒ½è¦ä¿æŒé€»è¾‘æ€§ã€‚æœ‰æ—¶è¿™å¹¶ä¸æ„å‘³ç€è¦æœ‰ç›´è§‰ã€‚æœ‰äº›è¡Œä¸ºä¸€å¼€å§‹ç”šè‡³å¯èƒ½ä½¿åˆå­¦è€…æ„Ÿåˆ°å›°æƒ‘ã€‚ä½†æ˜¯ï¼Œåœ¨è§£é‡Šæ—¶ï¼Œé€»è¾‘é€šå¸¸æ˜¯ç›¸å½“æœ‰è¯´æœåŠ›çš„ã€‚Raku æä¾›çš„ä¸€å¥—å¹¿æ³›çš„å†…çœå·¥å…·ï¼Œé€šå¸¸å¯¹ç†è§£å®ƒæœ‰å¾ˆå¤§å¸®åŠ©ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å°è¯•ä»¥&quot;é­”æœ¯å¸ˆ&quot;çš„æ–¹å¼æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨å…¶ä¸­çš„ä¸€äº›å·¥å…·æ¥å°†ä¸€åªå…”å­å˜æˆè®¸å¤šåªã€‚</p>
<p>æˆ‘è¿˜å°†åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–äº <a href="https://rakudo.org/">Rakudo</a> å¯¹ Raku çš„å®ç°ï¼Œå®ƒæ˜¯åŸºäº <a href="https://vrurg.github.io/arfb-publication/02-everything-is-an-object-mop/#rakudo-nqp-runtime-vm-and-implementation-stack">NQP</a> çš„ï¼Œè¿™ä½¿å¾—åœ¨æŸäº›æƒ…å†µä¸‹ç›¸å½“å®¹æ˜“çœ‹åˆ° Raku è¯­æ³•çš„å¹•åã€‚é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œè¿™ä¹Ÿæ˜¯ Raku ä¸­çš„é­”æ³•é‡å¤„äºå¯å¿½ç•¥ä¸è®¡çš„æ°´å¹³çš„å¦ä¸€ä¸ªåŸå› ã€‚ä½ ä»¬å½“ä¸­æœ‰å¤šå°‘äººï¼Œæˆ‘çš„è¯»è€…ï¼Œæ›¾ç»ç ”ç©¶è¿‡ Perl æˆ–ä»»ä½•ä½ æœ€å–œæ¬¢çš„è¯­è¨€çš„æ¥æºï¼Ÿå¦‚æœæˆ‘ä¸ºè‡ªå·±å›ç­”ï¼Œé‚£ä¹ˆå°±æ˜¯ä¸€ä¸ªè¯ï¼šä»æœªã€‚å°½ç®¡ C è¯­è¨€æ˜¯æˆ‘å¤šå¹´æ¥çš„é¦–é€‰è¯­è¨€ã€‚ä½†ç°åœ¨æˆ‘ä¼šåšæŒè¦æ±‚ä½ åœ¨ä½ çš„ä¸»ç›®å½•ä¸‹çš„æŸä¸ªåœ°æ–¹åš git clone <a href="https://github.com/rakudo/rakudo.git">https://github.com/rakudo/rakudo.git</a>ï¼Œæ‰€æœ‰å…¶ä»–é¡¹ç›®éƒ½æ”¾åœ¨é‚£é‡Œã€‚ç„¶åï¼Œåªè¦ä½ é‡åˆ°é—®é¢˜ï¼Œç­”æ¡ˆå¾ˆå¯èƒ½å°±åœ¨ Rakudo é¡¹ç›®çš„ src/Perl6/Metamodel ç›®å½•ä¸‹çš„ä¸€ä¸ªæ–‡ä»¶é‡Œã€‚</p>
<h2 id="å››ä½ä¸€ä½“">å››ä½ä¸€ä½“</h2>
<p>æˆ‘ä¸å¾—ä¸è°·æ­Œä¸€ä¸‹è¿™ä¸ªè¯ã€‚ä»ç¬¬ä¸€éƒ¨ã€Šé»‘å®¢å¸å›½ã€‹ç”µå½±å¼€å§‹ï¼Œ&ldquo;ä¸‰ä½ä¸€ä½“&quot;å¯¹æˆ‘æ¥è¯´å°±å¾ˆç†Ÿæ‚‰äº†ï¼Œä½†å¯¹è¿™ä¸€è¡Œä¸­çš„å…¶ä»–è¯å´ä¸ç†Ÿæ‚‰ã€‚æ˜¯çš„ï¼Œè¿™ä¸ªè¯å°±æ˜¯è¿™ä¸ªæ£˜æ‰‹é—®é¢˜çš„ç­”æ¡ˆã€‚Raku è§’è‰²æ˜¯å››ä½ä¸€ä½“ã€‚è¿™ç¯‡æ–‡ç« å°†ä¸€æ­¥ä¸€æ­¥åœ°å‘Šè¯‰ä½ ä¸ºä»€ä¹ˆã€‚</p>
<p>åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘æƒ³æé†’çš„æ˜¯ï¼Œåçœå’Œä¹åº“å…ƒæ¨¡å‹çš„ä¸€èˆ¬çŸ¥è¯†å°†æ˜¯éå¸¸æœ‰ç›Šçš„ã€‚ä¸€äº›ä¿¡æ¯å¯ä»¥åœ¨æœ¬å‘¨æœŸçš„å‰å‡ ç¯‡æ–‡ç« ä¸­æ‰¾åˆ°ï¼Œä¸€äº›å¯ä»¥åœ¨Rakuæ–‡æ¡£ä¸­æ‰¾åˆ°ã€‚</p>
<h3 id="ç¬¬1æ­¥-å¤šé‡æ€§">ç¬¬1æ­¥: å¤šé‡æ€§</h3>
<p>è®©æˆ‘ä»¬ä»æœ€ç®€å•çš„è‡ªçœå¼€å§‹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku">â‡’ <span class="nb">raku</span> <span class="o">-</span><span class="no">e</span> <span class="p">&#39;</span><span class="s1">role R[::T] { }; say R.WHAT</span><span class="p">&#39;</span>
<span class="p">(</span><span class="ow">R</span><span class="err">)</span>
</code></pre></div><p>ä¸è¦å’Œ &lsquo;â‡’&rsquo; å­—ç¬¦æ··æ·†ï¼Œè¿™åªæ˜¯æˆ‘æœ€å–œæ¬¢çš„å‘½ä»¤è¡Œæç¤ºã€‚</p>
<p>æ³¨æ„ï¼Œæˆ‘ä»¬åªç”¨æ–¹æ‹¬å·æ¥å£°æ˜è§’è‰²ï¼Œè€Œä¸æ˜¯å¯¹å®ƒè°ƒç”¨æ–¹æ³•ã€‚è¿˜è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªè§’è‰²æŠ¥å‘Šè‡ªå·±åªæ˜¯ <code>R</code>ï¼›åŒæ ·ï¼Œæ²¡æœ‰æ¶‰åŠæ–¹æ‹¬å·ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œä½ å¯èƒ½å·²ç»çŸ¥é“ï¼Œåœ¨ Raku ä¸­ï¼ŒåŒä¸€ä¸ªè§’è‰²æœ‰å¯èƒ½æœ‰ä¸åŒçš„å˜ä½“ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku">â‡’ <span class="nb">raku</span> <span class="o">-</span><span class="no">e</span> <span class="p">&#39;</span><span class="s1">role R[::T] { }; role R { }; say R.WHAT</span><span class="p">&#39;</span>
<span class="p">(</span><span class="ow">R</span><span class="err">)</span>
</code></pre></div><p>æˆ‘ä»¬æœ‰ä¸¤ä¸ªå£°æ˜ï¼Œä½†ä»ç„¶åªä½¿ç”¨ <code>R</code> æ¥è°ƒç”¨ <code>WHAT</code>ã€‚</p>
<p>è®©æˆ‘ä»¬æ¢ä¸ªè§’åº¦ï¼Œçœ‹çœ‹è¿™ä¸ªè§’è‰²æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku">â‡’ <span class="nb">raku</span> <span class="o">-</span><span class="no">e</span> <span class="p">&#39;</span><span class="s1">role R[::T] { }; say R.HOW.^name</span><span class="p">&#39;</span>
<span class="n">Perl6::Metamodel::ParametricRoleGroupHOW</span>
</code></pre></div><p>æ³¨æ„åå­—ä¸­çš„ <code>Group</code> éƒ¨åˆ†ã€‚æ–°æ‰‹å¯èƒ½ä¼šå¯¹è¿™ä¸ªè¯æ„Ÿåˆ°å›°æƒ‘ï¼Œåªè¦ä»–ä»¬åªä½¿ç”¨ä¸€ä¸ªè§’è‰²çš„å˜ä½“ã€‚ä½†æ˜¯å½“ä»–ä»¬åˆ°äº†æœ¬èŠ‚ç¬¬äºŒä¸ªä¾‹å­çš„æ—¶å€™ï¼Œäº‹æƒ…å°±å¼€å§‹å˜å¾—æ¯”è¾ƒæ¸…æ¥šäº†ã€‚è®©æˆ‘å†æŠŠå®ƒä»¬å˜å¾—æ›´åŠ æ··ä¹±ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="ow">R</span><span class="p">[</span><span class="o">:</span><span class="p">:</span><span class="s">T</span><span class="p">]</span> <span class="p">{</span> <span class="k">method</span> <span class="nf">foo</span> <span class="p">{</span> <span class="mi">42</span> <span class="p">}</span> <span class="p">}</span>
<span class="k">role</span> <span class="nc">R</span> <span class="p">{</span> <span class="p">}</span>
<span class="nb">say</span> <span class="ow">R</span><span class="o">.^</span><span class="err">lookup(&#39;foo&#39;);</span>
</code></pre></div><p>ä½ å¸Œæœ›è¿™æ®µä»£ç èƒ½è¾“å‡ºä»€ä¹ˆï¼Ÿæ ¹æ®<a href="https://docs.raku.org/routine/lookup">æ–‡æ¡£</a>ï¼Œåœ¨ä¸€ä¸ªç±»ä¸Šè¿™æ ·åšä¼šå¾—åˆ°ç›¸å½“å¯é¢„æµ‹çš„ç»“æœã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">class</span> <span class="nc">Foo</span> <span class="p">{</span> <span class="k">method</span> <span class="nf">foo</span> <span class="p">{</span> <span class="p">}</span> <span class="p">};</span> 
<span class="nb">say</span> <span class="n">Foo</span><span class="o">.^</span><span class="nb">lookup</span><span class="p">(&#34;</span><span class="s2">foo</span><span class="p">&#34;);</span> <span class="c1"># foo</span>
</code></pre></div><p>ç°åœ¨ï¼Œå¿˜è®°è¿™ä¸ªç»éªŒå§ã€‚å› ä¸ºå¯¹äºä¸Šé¢çš„ä¾‹å­ä¸­çš„ <code>R</code>ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ° <code>(Mu)</code>ï¼Œæ„æ€æ˜¯æ²¡æœ‰æ‰¾åˆ°æ–¹æ³•ï¼è€Œå¯¹äº <code>R</code>ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ° <code>(Mu)</code>ã€‚</p>
<p>åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘æƒ³é€€ä¸€æ­¥è¯´ã€‚å¦‚æœä½ è¯»äº† Raku çš„æ–‡æ¡£æˆ–ä¹¦ï¼Œåšäº†å…³äºè§’è‰²å’Œå‚æ•°åŒ–çš„éƒ¨åˆ†ï¼Œæœ‰ä¸€ä¸ªç»†èŠ‚å¯èƒ½ä¼šè®©ä½ è§‰å¾—ç›¸å½“ç†Ÿæ‚‰ã€‚å¦‚æœè¿™ä¹Ÿæ˜¯æˆ‘è¦æŒ‡å‡ºçš„&quot;ä¸œè¥¿&rdquo;ï¼Œé‚£ä¹ˆä½ å°±ä¸ä¼šé”™äº†ï¼šå‚æ•°åŒ–æ˜¯å…³äºå‚æ•°çš„ï¼›æœ‰äº†å‚æ•°ï¼Œå°±æœ‰äº†ç­¾åï¼&quot;ã€‚ç°åœ¨è¿™æ®µä»£ç ä¸€å®šæ˜¯å®Œå…¨æœ‰æ„ä¹‰çš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="ow">R</span><span class="err">[Int</span><span class="o">:</span><span class="err">D</span> <span class="nv">$a</span><span class="o">,</span> <span class="nb">Str:D</span> <span class="nv">$b</span><span class="o">]</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div><p>è§’è‰²å£°æ˜ä¸­è¢«æ–¹æ‹¬å·æ‹¬èµ·æ¥çš„éƒ¨åˆ†æ˜¯ä¸€ä¸ªç­¾åï¼Œè¿™æœ‰å¦ä¸€å±‚æ„æ€ï¼Œæˆ‘å°†åœ¨åé¢å†è°ˆã€‚</p>
<p>ä¸å¹¸çš„æ˜¯ï¼Œæˆ‘åœ¨å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™æœ‰ç‚¹è¶…æ—¶ï¼Œå®ƒåº”è¯¥åœ¨æ¶‰åŠåˆ°å‡ ä¸ªæ›´åŸºæœ¬çš„ä¸»é¢˜ä¹‹åå†å®Œæˆã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼Œæˆ‘ä¸ºä¸‹é¢çš„ä¸€ç‚¹ç¦»é¢˜è€Œé“æ­‰ã€‚</p>
<h2 id="å¤šé‡åˆ†æ´¾">å¤šé‡åˆ†æ´¾</h2>
<p>äººä»¬å¯ä»¥åœ¨ Raku æ–‡æ¡£ä¸­æ‰¾åˆ°è¿™ä¸€<a href="https://docs.raku.org/language/glossary#Multi-dispatch">éƒ¨åˆ†</a>ã€‚<a href="https://docs.raku.org/syntax/multi">å¦ä¸€èŠ‚</a>é˜è¿°äº†å…¶è¯­æ³•å’ŒåŠŸèƒ½ã€‚ä½†æˆ‘æƒ³ç®€å•åœ°è°ˆè°ˆè¿™ä¸ªåŠŸèƒ½çš„å†…éƒ¨å®ç°ã€‚è®©æˆ‘ä»¬ä»ä¸€ä¸ªåŸºæœ¬çš„å£°æ˜å¼€å§‹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">proto</span> <span class="nf">foo</span><span class="ow">(|)</span> <span class="p">{</span><span class="o">*</span><span class="p">}</span>
<span class="k">multi</span> <span class="nf">foo</span><span class="p">(</span><span class="nb">Int:D</span> <span class="nv">$i</span><span class="p">)</span> <span class="p">{}</span>
<span class="k">multi</span> <span class="nf">foo</span><span class="p">(</span><span class="nb">Str:D</span> <span class="nv">$s</span><span class="p">)</span> <span class="p">{}</span>
<span class="nb">say</span> <span class="nv">&amp;foo</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span> <span class="c1"># proto sub foo (|) {*}</span>
</code></pre></div><p>æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œ<code>raku</code> æ–¹æ³•åªæŠ¥å‘Šäº† <code>proto</code>ã€‚å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬å¯¹ <code>&amp;foo</code> è°ƒç”¨ <code>is_dispatcher</code> æ–¹æ³•ï¼Œå®ƒå°†è¿”å› <code>True</code>ã€‚å¥½çš„ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ª <code>multi</code> åœ¨å“ªé‡Œï¼Œå½“æˆ‘ä»¬è°ƒç”¨ <code>foo(&quot;bar&quot;)</code> æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿç”¨ä¸¤å¥è¯æ¥è¯´ï¼ŒRaku é¦–å…ˆä¼šæ‰¾åˆ° <code>proto</code> æ–¹æ³•ã€‚å¦‚æœå®ƒé€šè¿‡æ£€æŸ¥ <code>is_dispatcher</code> çš„è¿”å›å€¼è¯†åˆ«å‡ºå®ƒæ˜¯è¿™æ ·çš„ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šé€šè¿‡è°ƒç”¨ <code>&amp;foo.candidates</code> æ¥è·å–å·²çŸ¥çš„å€™é€‰åˆ—è¡¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nv">&amp;foo</span><span class="o">.</span><span class="nb">candidates</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="o">*.</span><span class="nb">raku</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#34;</span><span class="s2">\n</span><span class="p">&#34;);</span>
<span class="c1"># multi sub foo (Int:D $i) { #`(Sub|140560053018928) ... }</span>
<span class="c1"># multi sub foo (Str:D $s) { #`(Sub|140560053019072) ... }</span>
</code></pre></div><p>ç„¶åï¼Œå®ƒè¯•å›¾å°†æä¾›çš„å‚æ•°ä¸æ¯ä¸ªå€™é€‰è€…çš„ç­¾åç»‘å®šã€‚å¦‚æœç»‘å®šæˆåŠŸï¼Œåˆ™è°ƒç”¨è¯¥å€™é€‰ç¨‹åºï¼ˆå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼‰ã€‚</p>
<p>æ˜¾ç„¶ï¼Œåœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œäº‹æƒ…è¦å¤æ‚å¾—å¤šï¼Œä½†æˆ‘ä»¬è¿˜ä¸éœ€è¦çŸ¥é“è¿™äº›&hellip;&hellip;</p>
<h2 id="å›åˆ°å¤šé‡è§’è‰²çš„é—®é¢˜ä¸Š">å›åˆ°å¤šé‡è§’è‰²çš„é—®é¢˜ä¸Š</h2>
<p>æœ‰æ—¶æˆ‘å¯¹ä¸èƒ½åœ¨æ–‡ç« çš„çº¯æ–‡æœ¬ä¸­é€’å½’åˆ°ä¸€ä¸ªå­ä¸»é¢˜æ„Ÿåˆ°å¥‡æ€ªã€‚å°±æŠŠè¿™ä¸€èŠ‚çš„æ ‡é¢˜çœ‹æˆæ˜¯ä¸Šä¸€èŠ‚çš„ <code>return</code> è¯­å¥&hellip;&hellip;å•Šï¼Œç®—äº†ï¼ä¸è¯´äº†ã€‚</p>
<p>å¥½å§ï¼Œæˆ‘çš„è§‚ç‚¹æ˜¯ä»€ä¹ˆï¼Œå°±æ˜¯è¦è®²è¿°å¤šé‡è°ƒåº¦çš„æ•…äº‹ï¼Ÿå½“æˆ‘ä»¬çœ‹åˆ° <code>R.HOW</code> åœ¨ç±»åä¸­æŠ¥å‘Šäº†ä¸€ä¸ª <code>Group</code>ï¼Œå°±å¯ä»¥å’Œå¤šé‡è°ƒåº¦å®ç°ä¸­çš„ <code>proto</code> ç›¸æå¹¶è®ºäº†ã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬è°ƒç”¨ <code>HOW</code> æ–¹æ³•çš„ç±»å‹å¯¹è±¡ <code>R</code> æ˜¯ä¸€ä¸ªä¼çŠ¶çš„å®ä½“ï¼Œåœ¨å…¶å…±åŒçš„åå­—ä¸‹ä»£è¡¨äº†è§’è‰²çš„æ‰€æœ‰å˜ä½“ã€‚è€Œä¸”ï¼Œå½“æˆ‘ä»¬æŠŠ <code>R[Int]</code> åº”ç”¨äºä¸€ä¸ªç±»æ—¶ï¼Œå®é™…å‘ç”Ÿçš„è¿‡ç¨‹æ˜¯ä¸€ç§å¤šé‡åˆ†æ´¾ï¼ŒRaku è¯•å›¾æŠŠæ–¹æ‹¬å·ä¸­çš„å‚æ•°ä¸è§’è‰²å€™é€‰è€…çš„ç­¾åç›¸åŒ¹é…ã€‚ç±»ä¼¼äºæˆ‘ä»¬å¦‚ä½•åˆ—å‡º <code>&amp;foo</code> çš„å€™é€‰è€…ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ—å‡º <code>R</code> çš„å€™é€‰è€…ã€‚</p>
<p>``raku
say R.^candidates.map(*.^name).join(&quot;, &ldquo;); # R, R</p>
<pre><code>
å”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œè¿™æ¬¡æˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå…ƒæ–¹æ³• `.^candidates`ã€‚

åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œè¿˜æœ‰ä¸€ä¸ªè°œå›¢æ²¡æœ‰è¢«æ­å¼€ã€‚è¿˜è®°å¾—ä½¿ç”¨ `.^lookup` çš„é‚£ä¸ªä¾‹å­å—ï¼Ÿä¸ºä»€ä¹ˆå®ƒä¸èƒ½æ‰¾åˆ°è¿™ä¸ªæ–¹æ³•ï¼Ÿ

`Perl6::Metamodel::ParametricRoleGroupHOW` æ‰€æ”¯æŒçš„ç±»å‹å¯¹è±¡å¹¶ä¸æ˜¯ä¸€ä¸ªæˆ‘ä»¬å¯ä»¥å®é™…ä½¿ç”¨çš„è§’è‰²ã€‚å®ƒæ—¢æ²¡æœ‰æ–¹æ³•ä¹Ÿæ²¡æœ‰å±æ€§ã€‚ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›å®ƒå‡è£…æ˜¯ä¸€ä¸ªæˆç†Ÿçš„è§’è‰²ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œå®ƒé€‰æ‹©äº†ä¸€ä¸ªå€™é€‰è§’è‰²ä½œä¸ºé»˜è®¤è§’è‰²ï¼Œç„¶ååœ¨å…¶ä¸Šé‡æ–°åˆ†é…å¤–éƒ¨è¯·æ±‚ã€‚å½“æœ‰ä¸€ä¸ªæ²¡æœ‰ç­¾åçš„å€™é€‰è€…æ—¶ï¼ˆå¦‚æˆ‘ä»¬çš„ `role R {}`ï¼‰ï¼Œå®ƒå°±æˆä¸ºéšå¼é»˜è®¤ã€‚å¦åˆ™ï¼Œç¬¬ä¸€ä¸ªå£°æ˜çš„æœ‰ç­¾åçš„å€™é€‰è€…å°±ä¼šæˆä¸ºé»˜è®¤çš„å€™é€‰è€…ã€‚

å›åˆ°æˆ‘ä»¬çš„ä¾‹å­ï¼Œ`R.^lookup('foo')` å¤±è´¥äº†ï¼Œå› ä¸º `role R {}` æ²¡æœ‰å£°æ˜ä¸€ä¸ªæœ‰è¿™ä¸ªåå­—çš„æ–¹æ³•ã€‚

### ç¬¬äºŒæ­¥: å€™é€‰è€…

ç›´å¥”ä¸»é¢˜ï¼Œè®©æˆ‘ä»¬å¯¹å€™é€‰è€…æœ¬èº«è¿›è¡Œè‡ªçœã€‚

```raku
say R.^candidates.map({ .HOW.^name }).join(&quot;, &quot;);
</code></pre><p>è¿™çœ‹èµ·æ¥ä¸€å®šå¾ˆç†Ÿæ‚‰ï¼Œåªæ˜¯æˆ‘ä»¬åŠ å…¥äº†.HOWçš„è°ƒç”¨ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬ç”¨å®ƒå¾—åˆ°çš„ä¸œè¥¿ã€‚</p>
<pre><code>Perl6::Metamodel::ParametricRoleHOW, Perl6::Metamodel::ParametricRoleHOW
</code></pre><p>å®ƒçœ‹èµ·æ¥ä¹Ÿå¾ˆç†Ÿæ‚‰ï¼Œé™¤äº†&hellip;&hellip;æ˜¯çš„ï¼Œåœ¨ç±»åç§°ä¸­æ²¡æœ‰ <code>Group</code>ï¼Œæˆ‘æƒ³æ¬¢è¿æˆ‘ä»¬çš„ç¬¬äºŒç§è§’è‰²! å®é™…ä¸Šï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†ã€‚å¦‚æœæˆ‘åƒè¿™æ ·æŒ¥èˆç€æˆ‘çš„æ‰‹ï¼Œè®©æˆ‘çš„è§‚ä¼—åˆ†å¿ƒï¼Œç”¨&hellip;</p>
<p>å“å‘€ï¼Œæœ€åä¸€å¥è¯åº”è¯¥æ˜¯è½åœ¨å¦ä¸€ä¸ªçª—å£é‡Œçš„! å¯¹äºä½ ï¼Œæˆ‘çš„è§‚ä¼—ï¼Œæˆ‘è¿˜æœ‰ä¸€è¡Œä»£ç ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">R</span> <span class="p">{}</span><span class="o">.</span><span class="nb">HOW</span><span class="o">.^</span><span class="nb">name</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span> <span class="c1"># Perl6::Metamodel::ParametricRoleHOW</span>
</code></pre></div><p>BTWï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œè¯´æ˜æ— å¤„ä¸åœ¨çš„ Raku æ¦‚å¿µï¼Œå³æ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚ç”šè‡³å£°æ˜ä¹Ÿæ˜¯ï¼›è€Œä¸”ï¼Œåªæ˜¯ä¸ºäº†å¥½ç©ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">foo</span><span class="p">&#34;</span> <span class="p">}</span><span class="o">.^</span><span class="nb">name</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span> <span class="c1"># Block</span>
</code></pre></div><p>ä½†æ˜¯æˆ‘åˆ†å¿ƒäº†&hellip;</p>
<p>æ‰€ä»¥ï¼Œè¿™é‡ŒçœŸæ­£é‡è¦çš„æ˜¯ï¼Œå½“æˆ‘ä»¬å£°æ˜ä¸€ä¸ªè§’è‰²æ—¶ï¼ŒRaku ä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª <code>Perl6::Metamodel::ParametricRoleHOW</code> ç±»çš„å®ä¾‹ã€‚æ¯ä¸ªå£°æ˜éƒ½æœ‰ä¸€ä¸ªç‹¬ç‰¹çš„ç±»çš„å®ä¾‹æ”¯æŒï¼Œå®ƒè´Ÿè´£æŒæœ‰è§’è‰²ç±»å‹å¯¹è±¡çš„æ¯ä¸ªç»†èŠ‚ã€‚ä¾‹å¦‚ï¼Œè¦æƒ³çŸ¥é“å®ƒæ˜¯å¦å¯ä»¥è¢«å‚æ•°åŒ–ï¼Œå¯ä»¥è¿™æ ·åšã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">is_parameterized</span><span class="p">(</span><span class="nb">Mu</span> \<span class="nb">r</span> <span class="k">--&gt;</span> <span class="nb">Bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">?</span> <span class="nb">r</span><span class="o">.^</span><span class="nf">signatured</span>
<span class="p">}</span>
<span class="nb">say</span> <span class="nf">is_parameterized</span><span class="p">(</span><span class="k">role</span> <span class="ow">R</span><span class="p">[</span><span class="o">:</span><span class="p">:</span><span class="s">T</span><span class="p">]</span> <span class="p">{});</span> <span class="c1"># True</span>
<span class="nb">say</span> <span class="nf">is_parameterized</span><span class="p">(</span><span class="k">role</span> <span class="ow">R</span> <span class="p">{});</span> <span class="c1"># False</span>
</code></pre></div><p>è¯·æ³¨æ„ï¼Œç”±äº <code>signatured</code> æ˜¯åœ¨ NQP ä¸­å®ç°çš„æ–¹æ³•ï¼Œå®ƒä¸çŸ¥é“é«˜çº§ç±»å‹ï¼Œå¹¶è¿”å›0æˆ–1ã€‚æœ‰æ—¶æƒ…å†µä¼šå˜å¾—æ›´ç³Ÿç³•ã€‚æˆ‘ä¸Šé¢æåˆ°çš„æŸ¥æ‰¾å…ƒæ–¹æ³•å®é™…ä¸Šè¿”å› <code>nqp::null()</code>ï¼Œè¿™æ˜¯ä¸€ç§ VM çº§çš„å¯¹è±¡ã€‚å®ƒå†³ä¸èƒ½å‡ºç°åœ¨ Raku ä¸Šã€‚å› æ­¤è¯­è¨€æŠŠå®ƒå˜æˆäº† <code>Mu</code>ï¼Œè¿™æ˜¯æœ€åŸºæœ¬çš„ Raku ç±»ã€‚</p>
<p>å…³äº <code>Perl6::Metamodel::ParametricRoleHOW</code>ï¼Œåœ¨è¿™ä¸€ç‚¹ä¸Šæ²¡æœ‰ä»€ä¹ˆå¯è¯´çš„ã€‚ä½†æˆ‘ä»¬ç¨åä¼šå›åˆ°å®ƒä¸Šé¢å»ã€‚</p>
<h3 id="ç¬¬ä¸‰æ­¥-ä¸ç¡®å®šæ€§">ç¬¬ä¸‰æ­¥: ä¸ç¡®å®šæ€§</h3>
<p>ä¸ºäº†æ›´æ¥è¿‘æˆ‘ä»¬çš„ç¬¬ä¸‰ç§è§’è‰²ï¼Œæˆ‘ä»¬ä»ä¸‹é¢è¿™ä¸ªç‰‡æ®µå¼€å§‹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">R1</span><span class="o">[:</span><span class="p">:</span><span class="s">T</span> <span class="nb">Stringy</span><span class="o">,</span> <span class="o">:</span><span class="p">:</span><span class="s">V</span><span class="o">]</span> <span class="p">{</span> <span class="k">method</span> <span class="nf">foo</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">stringy</span><span class="p">&#34;</span> <span class="p">}</span> <span class="p">}</span>
<span class="k">role</span> <span class="nc">R1</span><span class="o">[:</span><span class="p">:</span><span class="s">T</span> <span class="nb">Numeric</span><span class="o">,</span> <span class="o">:</span><span class="p">:</span><span class="s">V</span><span class="o">]</span> <span class="p">{</span> <span class="k">method</span> <span class="nf">foo</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">numeric</span><span class="p">&#34;</span> <span class="p">}</span> <span class="p">}</span>
<span class="k">my</span> <span class="nv">\r</span> <span class="o">=</span> <span class="k">role</span> <span class="nc">R2</span><span class="o">[:</span><span class="p">:</span><span class="s">T</span><span class="o">]</span> <span class="k">does</span> <span class="nc">R1</span><span class="o">[</span><span class="nb">Int</span><span class="o">,</span> <span class="nb">T</span><span class="o">]</span> <span class="p">{</span> <span class="p">}</span>
</code></pre></div><p>è®©æˆ‘ä»¬è‡ªçœä¸€ä¸‹ <code>R1</code>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># We know there is only one role, </span>
<span class="c1"># hence .head for prettier output</span>
<span class="nb">say</span> <span class="nb">r</span><span class="o">.^</span><span class="nf">roles</span><span class="o">.</span><span class="nb">map</span><span class="p">({</span> <span class="o">.^</span><span class="nb">name</span> <span class="o">~</span> <span class="p">&#34;</span><span class="s2"> of </span><span class="p">&#34;</span> <span class="o">~</span> <span class="o">.</span><span class="nb">HOW</span><span class="o">.^</span><span class="nb">name</span> <span class="p">})</span><span class="o">.</span><span class="nb">head</span><span class="p">;</span>
<span class="c1"># R1[Int,T] of Perl6::Metamodel::CurriedRoleHOW</span>
</code></pre></div><p>è¾“å‡ºæ˜¾ç¤ºäº†ä¸¤ä¸ªæ˜æ˜¾çš„å˜åŒ–ã€‚é¦–å…ˆï¼Œè§’è‰²åç§°ç°åœ¨æŠ¥å‘Šäº†å®ƒçš„å‚æ•°ã€‚ç¬¬äºŒï¼Œå…ƒå¯¹è±¡ç°åœ¨å±äº <code>Perl6::Metamodel::CurriedRoleHOW</code> ç±»ã€‚è¿™æ˜¯ Rakudo åœ¨å¹•ååšçš„å¦ä¸€ç§&quot;é­”æ³•&rdquo;ï¼Œæˆ‘å°†åœ¨æœ¬èŠ‚ä¸­æŠ«éœ²ã€‚</p>
<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒR2 å£°æ˜æœ€å¼•äººæ³¨ç›®çš„ç‰¹ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿäº‹å®ä¸Šï¼Œåœ¨å®ƒæ¶ˆè€— <code>R1</code> çš„åœ°æ–¹ï¼Œæˆ‘ä»¬åªçŸ¥é“ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œç¬¬äºŒä¸ªå‚æ•°ä»ç„¶æ˜¯ä¸€ä¸ªé€šç”¨å‚æ•°ã€‚ä¸ºäº†è¡¨ç¤ºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯¹è§’è‰²çš„äº†è§£æ˜¯ä¸å®Œæ•´çš„ï¼ŒRakudo ä½¿ç”¨äº†æŸ¯é‡ŒåŒ–çš„è§’è‰²ã€‚</p>
<p>ä»èµ·æºçš„è§’åº¦æ¥çœ‹ï¼ŒæŸ¯é‡ŒåŒ–è§’è‰²ä¸å‰ä¸¤ç§è§’è‰²çš„å…³é”®åŒºåˆ«åœ¨äºï¼Œæ²¡æœ‰åŠæ³•å£°æ˜ä¸€ä¸ªè§’è‰²ã€‚æŸ¯é‡ŒåŒ–åªèƒ½æ˜¯ä¸€ä¸ªç»„çš„å‚æ•°åŒ–çš„ç»“æœã€‚è€Œä¸”ï¼Œå®é™…ä¸Šï¼Œæˆ‘å¾ˆæ¸…æ¥šï¼Œæ­£å¼çš„ç»„åœ¨ Raku è¯­æ³•ä¸­å¹¶æ²¡æœ‰è¡¨ç¤ºã€‚ä½†æ˜¯åªè¦å®ƒä½œä¸ºç¬¬ä¸€ä¸ªè§’è‰²å£°æ˜çš„ç»“æœå‡ºç°ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¯´å®ƒæ˜¯ç”±å®ƒäº§ç”Ÿçš„ã€‚è€ŒæŸ¯é‡ŒåŒ–åˆ™å®Œå…¨ç”±å‚æ•°åŒ–äº§ç”Ÿã€‚</p>
<p>ä¹Ÿè®¸æœ‰äº›ä»¤äººæƒŠè®¶ï¼Œä½†åœ¨æ‰€æœ‰å‚æ•°éƒ½ä¸ºç¼–è¯‘å™¨æ‰€ç†ŸçŸ¥çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥å‘ç°æŸ¯é‡ŒåŒ–çš„å­˜åœ¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="n">R2</span><span class="o">[</span><span class="nb">Str</span><span class="o">].</span><span class="nb">HOW</span><span class="o">.^</span><span class="nb">name</span><span class="p">;</span> <span class="c1"># Perl6::Metamodel::CurriedRoleHOW</span>
</code></pre></div><p>éƒ¨åˆ†åŸå› æ˜¯ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨è¿™æ ·çš„è§’è‰²æ—¶ï¼Œæˆ‘ä»¬æ‰€éœ€è¦çš„ä¹Ÿè®¸æ˜¯ä¸€äº›å†…çœã€ç±»å‹æ£€æŸ¥æˆ–ä»»ä½•å…¶ä»–ä¸éœ€è¦å…·ä½“å¯¹è±¡çš„æ“ä½œã€‚æ¯”å¦‚è¯´ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">foo</span><span class="p">(</span><span class="n">R1</span><span class="o">[</span><span class="nb">Int</span><span class="o">,</span> <span class="nb">Str</span><span class="o">]</span> <span class="nv">$a</span><span class="p">)</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
</code></pre></div><p>æˆ‘ä»¬åœ¨è¿™é‡Œéœ€è¦çš„æ˜¯ <code>foo</code> å‚æ•°ï¼Œä»¥é€šè¿‡å¯¹ <code>R1[Int, Str]</code> çš„ç±»å‹æ£€æŸ¥ã€‚å› ä¸ºæŸ¯é‡ŒåŒ–ä¼šå¸®æˆ‘ä»¬å®Œæˆè¿™ä¸ªå·¥ä½œï¼Œæ‰€ä»¥ Rakudo åœ¨è¿™é‡Œä½¿ç”¨å®ƒã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nv">&amp;foo</span><span class="o">.</span><span class="nb">signature</span><span class="o">.</span><span class="nb">params</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="nb">type</span><span class="o">.</span><span class="nb">HOW</span><span class="o">.^</span><span class="nb">name</span><span class="p">;</span>
<span class="c1"># Perl6::Metamodel::CurriedRoleHOW</span>
</code></pre></div><p>è¿™æ˜¯å› ä¸º:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="n">R2</span><span class="o">[</span><span class="nb">Str</span><span class="o">]</span> <span class="o">~~</span> <span class="n">R1</span><span class="o">[</span><span class="nb">Int</span><span class="o">,</span> <span class="nb">Str</span><span class="o">]</span><span class="p">;</span> <span class="c1"># True</span>
<span class="nb">say</span> <span class="n">R2</span><span class="o">[</span><span class="nb">Int</span><span class="o">]</span> <span class="o">~~</span> <span class="n">R1</span><span class="o">[</span><span class="nb">Int</span><span class="o">,</span> <span class="nb">Str</span><span class="o">]</span><span class="p">;</span> <span class="c1"># False</span>
</code></pre></div><p>ä½†è¿˜æœ‰ä¸€ä¸ªä¸»è¦åŸå› ã€‚å®ƒå°†åœ¨ä¸‹ä¸€èŠ‚ä¸­æŠ«éœ²ã€‚</p>
<h3 id="ç¬¬4æ­¥-å…·ä½“æ€§">ç¬¬4æ­¥: å…·ä½“æ€§</h3>
<p>ä»»ä½•è§’è‰²çš„å‘½è¿éƒ½æ˜¯è¢«ä¸€ä¸ªç±»æ‰€åå™¬ã€‚(BTWï¼Œè¿™é‡Œçš„åŒå…³è¯­ä¹Ÿä¸ä¾‹å¤–ã€‚)ç°åœ¨æ˜¯æ—¶å€™è€ƒè™‘è¿™æœ€åé˜¶æ®µäº†ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">R1</span><span class="o">[:</span><span class="p">:</span><span class="s">T</span><span class="o">]</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">role</span> <span class="nc">R2</span><span class="o">[:</span><span class="p">:</span><span class="s">T</span><span class="o">]</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">role</span> <span class="nc">R3</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">class</span> <span class="nc">C</span> <span class="k">does</span> <span class="nc">R1</span><span class="o">[</span><span class="nb">Int</span><span class="o">]</span> <span class="k">does</span> <span class="nc">R2</span><span class="o">[</span><span class="nb">Str</span><span class="o">]</span> <span class="k">does</span> <span class="nc">R3</span> <span class="p">{</span> <span class="p">}</span>
</code></pre></div><p>é€šè¿‡åçœç±»ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°æ‰€æœ‰çš„è€æœ‹å‹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="n">C</span><span class="o">.^</span><span class="nf">roles</span>
     <span class="o">.</span><span class="nb">map</span><span class="p">({</span> <span class="o">.^</span><span class="nb">name</span> <span class="o">~</span> <span class="p">&#34;</span><span class="s2"> of </span><span class="p">&#34;</span> <span class="o">~</span> <span class="o">.</span><span class="nb">HOW</span><span class="o">.^</span><span class="nb">name</span> <span class="p">})</span>
     <span class="o">.</span><span class="nb">join</span><span class="p">(&#34;</span><span class="s2">\n</span><span class="p">&#34;);</span>
<span class="c1"># R3 of Perl6::Metamodel::ParametricRoleGroupHOW</span>
<span class="c1"># R2[Str] of Perl6::Metamodel::CurriedRoleHOW</span>
<span class="c1"># R1[Int] of Perl6::Metamodel::CurriedRoleHOW</span>
</code></pre></div><p>æœ‰è¶£çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå‘ç°äº†ä¸åŒç§ç±»çš„è§’è‰²çš„æ··åˆã€‚å…¶åŸå› æ˜¯æµ®åœ¨ä¸Šé¢çš„ï¼šä¸ <code>R3</code> ç›¸åï¼Œå¦å¤–ä¸¤ä¸ªè§’è‰²æ˜¯å‚æ•°åŒ–çš„ã€‚</p>
<p>ä½†ç”±äºæˆ‘å–œæ¬¢è¿·æƒ‘å¬ä¼—ï¼Œæ‰€ä»¥æˆ‘è¦å‘Šè¯‰ä½ ï¼šè¿™äº›å…¶å®ä¸æ˜¯è¿™ä¸ªç±»æ‰€å»ºç«‹çš„è§’è‰²ï¼è¿™æ˜¯å¦ä¸€ä¸ªæ“ä½œã€‚</p>
<p>å½“ç„¶ï¼Œè¿™æ˜¯å¦ä¸€ç§æ“ä½œã€‚å®Œæ•´çš„çŸ­è¯­å¿…é¡»æ˜¯ä½¿ç”¨è¿™ä¸ªã€‚&ldquo;ä¸æ˜¯ç›´æ¥ä½¿ç”¨çš„è§’è‰²&rdquo;ã€‚</p>
<p>å½“æˆ‘ä»¬å°è¯•å¦ä¸€ç§æ–¹æ³•æ—¶ï¼Œæƒ…å†µå°±ä¼šå¤§ä¸ç›¸åŒã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="n">C</span><span class="o">.^</span><span class="nb">mro</span><span class="p">(:</span><span class="s">roles</span><span class="p">)</span>
     <span class="o">.</span><span class="nb">map</span><span class="p">({</span> <span class="o">.^</span><span class="nb">name</span> <span class="o">~</span> <span class="p">&#34;</span><span class="s2"> of </span><span class="p">&#34;</span> <span class="o">~</span> <span class="o">.</span><span class="nb">HOW</span><span class="o">.^</span><span class="nb">name</span> <span class="p">})</span>
     <span class="o">.</span><span class="nb">join</span><span class="p">(&#34;</span><span class="s2">\n</span><span class="p">&#34;);</span>
<span class="c1"># C of Perl6::Metamodel::ClassHOW</span>
<span class="c1"># R3 of Perl6::Metamodel::ConcreteRoleHOW</span>
<span class="c1"># R2 of Perl6::Metamodel::ConcreteRoleHOW</span>
<span class="c1"># R1 of Perl6::Metamodel::ConcreteRoleHOW</span>
</code></pre></div><p><code>.^roles</code> å’Œ <code>.^mro</code> çš„åŒºåˆ«åœ¨äºï¼Œå‰è€…ä¸ºæˆ‘ä»¬æä¾›äº†ç”¨äºå£°æ˜ç±»çš„å†…å®¹ï¼›è€Œåè€…åˆ™ä¸ºæˆ‘ä»¬æä¾›äº†å®é™…æ„å»ºçš„å†…å®¹ã€‚</p>
<p>æ­£å¦‚ <code>HOW</code> ç±»çš„åå­—æ‰€æš—ç¤ºçš„ï¼Œæˆ‘ä»¬ç°åœ¨å¤„ç†çš„æ˜¯è§’è‰²çš„å…·ä½“è¡¨ç°ã€‚æ¢å¥è¯è¯´ï¼Œè¿™æ˜¯ä¸€ç§æ‰€æœ‰ç»†èŠ‚éƒ½çŸ¥é“çš„è§’è‰²ï¼Œå®ƒä»¬æ˜¯ä¸ºè¿™ä¸ªç‰¹å®šçš„ç±»ä¸“é—¨è®¾è®¡çš„ã€‚è¿™é‡Œå¼ºè°ƒçš„æ˜¯ç›®çš„ï¼šè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºç‰¹åŒ–ï¼›è€Œ specialize æ˜¯å®ç°å®ƒçš„å…ƒæ¨¡å‹æ–¹æ³•çš„åç§°ã€‚</p>
<p>æˆ‘è¿˜æƒ³æé†’ä½ ä¸€ä¸‹ä¸Šä¸€èŠ‚çš„æœ€åä¸€å¥è¯ã€‚ä¸ºä»€ä¹ˆæ¯å½“äººä»¬ä½¿ç”¨ <code>R[Int]</code> æˆ–ç±»ä¼¼å½¢å¼çš„è§’è‰²å‚æ•°åŒ–æ—¶ï¼Œä»–ä»¬éƒ½è¦å¤„ç†ä¸€ä¸ªæŸ¯é‡ŒåŒ–çš„è§’è‰²ï¼ŒåŸå› æ˜¯å®Œå…¨çš„ç‰¹åŒ–éœ€è¦è§’è‰²è¢«æ¶ˆè€—çš„ç±»ã€‚ç¨åæˆ‘å°†è¯´æ˜åŸå› ã€‚</p>
<p>æˆ‘ä»¬ç°åœ¨å¯ä»¥é€€ä¸€æ­¥ï¼Œæ¦‚è¿°ä¸€ä¸‹è§’è‰²çš„ç”Ÿå‘½å‘¨æœŸã€‚</p>
<ol>
<li>ä¸€ä¸ª <code>Perl6::Metamodel::ParametricRoleGroupHOW</code> è¢«åˆ›å»ºã€‚</li>
<li>ä¸€ä¸ª <code>Perl6::Metamodel::ParametricRoleHOW</code> è¢«åˆ›å»ºå¹¶æ·»åŠ åˆ°è¯¥ç»„ã€‚</li>
<li>ä¸€ä¸ªç±»è¢«å£°æ˜å¹¶ <code>does</code> è¿™ä¸ªè§’è‰²ã€‚ç¼–è¯‘å™¨å°è¯•å¯¹è§’è‰²è¿›è¡Œå‚æ•°åŒ–ï¼Œå¦‚æœéœ€è¦å‚æ•°åŒ–ï¼Œ<code>Perl6::Metamodel::CurriedRoleHOW</code> å°±ä¼šè¢«åˆ›å»ºï¼›å¦åˆ™å°±ä¼šä½¿ç”¨åŸæ¥çš„ <code>Perl6::Metamodel::ParametricRoleHOW</code>ã€‚</li>
<li>å‚æ•°åŒ–çš„ç»“æœè¢«æ·»åŠ åˆ°ç±»çš„è§’è‰²åˆ—è¡¨ä¸­ã€‚</li>
<li>å½“ç±»è¢«ç»„æˆæ—¶ï¼Œæ‰€æœ‰åœ¨ä¸Šä¸€æ­¥ä¸­æ·»åŠ çš„è§’è‰²éƒ½è¢«èµ‹äºˆäº†å„è‡ªçš„å‚æ•°å’Œç±»çš„ç±»å‹å¯¹è±¡ã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬å¾—åˆ°äº†ç”± <code>Perl6::Metamodel::ConcreteRoleHOW</code> æ”¯æŒçš„è§’è‰²ç±»å‹å¯¹è±¡ï¼Œæˆ–è€…æ¢å¥è¯è¯´ï¼Œè§’è‰²å…·ä½“åŒ–ã€‚</li>
<li>è¿™äº›å…·ä½“åŒ–è¢«æ·»åŠ åˆ°ç±»ä¸­ã€‚</li>
<li>å…·ä½“åŒ–æ˜¯é€šè¿‡å°†å…¶å±æ€§å’Œæ–¹æ³•è¿ç§»åˆ°ç±»çš„ç±»å‹å¯¹è±¡ä¸­æ¥åº”ç”¨çš„ã€‚</li>
</ol>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå…·ä½“åŒ–è¢«ä¿ç•™ä¸ºç‹¬ç«‹çš„å®ä½“ï¼Œä¸å®ƒä»¬æ‰€äº§ç”Ÿçš„è§’è‰²åˆ†å¼€ã€‚è¿™å°±æ˜¯æˆ‘ä»¬åœ¨ä¸Šé¢é€šè¿‡ä½¿ç”¨ <code>.^roles</code> å’Œ <code>.^mro</code> è¿›è¡Œå†…çœè§‚å¯Ÿåˆ°çš„ã€‚å®ƒä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>.^concretizations</code> å…ƒæ¨¡å‹æ–¹æ³•æ¥è®¿é—®ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="n">C</span><span class="o">.^</span><span class="nf">concretizations</span>
     <span class="o">.</span><span class="nb">map</span><span class="p">({</span> <span class="o">.^</span><span class="nb">name</span> <span class="o">~</span> <span class="p">&#34;</span><span class="s2"> of </span><span class="p">&#34;</span> <span class="o">~</span> <span class="o">.</span><span class="nb">HOW</span><span class="o">.^</span><span class="nb">name</span> <span class="p">})</span>
     <span class="o">.</span><span class="nb">join</span><span class="p">(&#34;</span><span class="s2">\n</span><span class="p">&#34;);</span>
<span class="c1"># R3 of Perl6::Metamodel::ConcreteRoleHOW</span>
<span class="c1"># R2 of Perl6::Metamodel::ConcreteRoleHOW</span>
<span class="c1"># R1 of Perl6::Metamodel::ConcreteRoleHOW</span>
</code></pre></div><p>åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæœ‰ä¸¤ä¸ªç›¸å½“å¤§çš„ä¸»é¢˜ä»ç„¶æ•…æ„ä¸æ¸…æ¥šï¼šä¸€ä¸ªè§’è‰²å€™é€‰äººæ˜¯å¦‚ä½•è¢«é€‰æ‹©çš„ï¼Ÿ ä»¥åŠç‰¹åŒ–æ˜¯åšä»€ä¹ˆçš„ï¼Ÿç¬¬ä¸€ä¸ªé—®é¢˜æˆ‘ä¹Ÿè®¸å¯ä»¥æˆ–å¤šæˆ–å°‘åœ°å®Œæ•´åœ°ä»‹ç»ä¸€ä¸‹ã€‚ç¬¬äºŒä¸ªé—®é¢˜å¯¹æœ¬æ–‡æ¥è¯´å¤ªå¤æ‚äº†ï¼Œä½†æœ‰å‡ ä¸ªå…³é”®ç‚¹ç»å¯¹å€¼å¾—ä¸€æã€‚</p>
<h3 id="ç¬¬1aæ­¥-é€‰æ‹©">ç¬¬1aæ­¥: é€‰æ‹©</h3>
<p>éœ‡æƒŠä¸€ä¸ªæ— è¾œçš„è¯»è€…åœ¨åª’ä½“ä¸­éå¸¸æµè¡Œã€‚è™½ç„¶æˆ‘å‹‰å¼ºç®—æ˜¯ä¸ªè®°è€…ï¼Œä½†åªè¦æˆ‘æŠŠè¿™ç¯‡æ–‡ç« ç§°ä¸ºæ–‡ç« &ndash;æˆ‘æœ‰ä»€ä¹ˆèµ„æ ¼æ‰“ç ´è§„åˆ™ï¼Ÿæ‰€ä»¥ï¼Œè¯·åå¥½ï¼Œæ¡ç´§ä½ çš„å¤§è„‘ã€‚</p>
<p>æˆ‘ä»¬å¼€å§‹äº†&hellip;&hellip;å‡†å¤‡å¥½äº†æ²¡æœ‰&hellip;&hellip;çœŸç›¸å³å°†æ­æ™“ï¼&quot;ã€‚</p>
<p>è§’è‰²æ˜¯ä¸€ç§ä¾‹ç¨‹ã€‚</p>
<p>å¾ˆå¥½ï¼Œå¼€å§‹äº†ã€‚æˆ‘è¯´äº†ï¼æˆ‘ä¸€ç›´æƒ³è¯´çš„!</p>
<p>è¯´çœŸçš„ï¼Œæ­£å¦‚ç»å¸¸å‘ç°çš„å…³äºç‚¹å‡»ç‡çš„æ–°é—»ä¸€æ ·ï¼Œè¿™å¹¶ä¸å®Œå…¨æ˜¯çœŸçš„ï¼Œä½†æœ‰ä¸€ç‚¹æ˜¯çœŸçš„ã€‚æˆ‘æƒ³è®©ä½ è€ƒè™‘ä¸€ä¸ªä¾‹å­ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">R</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">inside the role</span><span class="p">&#34;;</span>
<span class="p">}</span>
<span class="k">module</span> <span class="nn">Foo</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">inside Foo</span><span class="p">&#34;;</span>
<span class="p">}</span>
<span class="k">class</span> <span class="nc">C</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">inside the class</span><span class="p">&#34;;</span>
<span class="p">}</span>
<span class="c1"># inside Foo</span>
<span class="c1"># inside the class</span>
</code></pre></div><p>æˆ‘ä»¬åªçœ‹åˆ°ä¸¤è¡Œè¾“å‡ºï¼Œè®©æˆ‘ä»¬äº†è§£åˆ°ç±»çš„å£°æ˜ä¸æ¨¡å—çš„è¡Œä¸ºæ˜¯ä¸€æ ·çš„ã€‚ä½†ä¸æ˜¯è§’è‰²ã€‚è®©æˆ‘ä»¬åœ¨è¿™ä¸ªä¾‹å­ä¸­å†åŠ ä¸€è¡Œã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ow">R</span><span class="o">.^</span><span class="err">candidates[0</span><span class="o">].^</span><span class="nf">body_block</span><span class="o">.</span><span class="p">(</span><span class="n">C</span><span class="p">);</span>
<span class="c1"># inside the role</span>
</code></pre></div><p>ä¸ºä»€ä¹ˆæ˜¯è¿™æ ·ï¼Œä¸ºä»€ä¹ˆæˆ‘æŠŠ <code>C</code> ä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ é€’ï¼Œæˆ‘å°†åœ¨ä¸‹é¢å…³äºç‰¹åŒ–çš„éƒ¨åˆ†å°è¯•å›ç­”ã€‚</p>
<p>ç°åœ¨æˆ‘å»ºè®®å¯¹ä¸»ä½“å—è¿›è¡Œå†…çœï¼Œä½†é¦–å…ˆè¦åœ¨ä¸Šè¿°ç‰‡æ®µä¸­å¢åŠ ä¸€ä¸ªè§’è‰²çš„å˜ä½“ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">\r</span> <span class="o">=</span> <span class="k">role</span> <span class="ow">R</span><span class="err">[</span><span class="o">::</span><span class="err">T</span><span class="o">,</span> <span class="o">:</span><span class="p">:</span><span class="s">V</span> <span class="nb">Numeric</span><span class="o">]</span> <span class="p">{</span> <span class="p">}</span>
<span class="nb">say</span> <span class="nb">r</span><span class="o">.^</span><span class="nf">body_block</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>
<span class="c1"># multi sub (::$?CLASS ::::?CLASS Mu $, ::T Mu $, ::V Numeric $) { #`(Sub|94052949943024) ... }</span>
</code></pre></div><p>ç°åœ¨æœ‰å°è±¡äº†å—ï¼Ÿ<code>sub</code> å‰é¢çš„ <code>multi</code> è¿™ä¸ªè¯è¯´æ˜äº†ä¸€åˆ‡ï¼Œæˆ‘ç°åœ¨çš„å·¥ä½œå·²ç»å‡å°‘åˆ°æ‰€éœ€çš„æœ€å°çš„æªè¾ã€‚</p>
<p>å½“ç¼–è¯‘å™¨å»ºç«‹ä¸€ä¸ªè§’è‰²ç»„æ—¶ï¼Œå®ƒä¹Ÿåˆ›å»ºäº†ä¸€ä¸ªå¤šè°ƒåº¦ä¾‹ç¨‹ã€‚åœ¨å†…éƒ¨ï¼Œå®ƒè¢«ç§°ä¸ºé€‰æ‹©å™¨ã€‚åœ¨æ¯ä¸€ä¸ªæ–°æ·»åŠ çš„å‚æ•°åŒ–è§’è‰²ä¸­ï¼Œå®ƒçš„ä¸»ä½“å—ï¼ˆå®é™…ä¸Šæ˜¯ä¸€ä¸ª <code>multi sub</code>ï¼‰éƒ½ä¼šè¢«æŠ½å–å‡ºæ¥ï¼Œå¹¶ä½œä¸ºä¸€ä¸ªå¤šé‡è°ƒåº¦å€™é€‰ç¨‹åºæ·»åŠ åˆ°é€‰æ‹©å™¨ä¸­ã€‚ç°åœ¨ï¼Œå½“äººä»¬åœ¨ä»–ä»¬çš„ä»£ç ä¸­å†™ä¸‹åƒ <code>R[Int, Str]</code> è¿™æ ·çš„ä¸œè¥¿æ—¶ï¼Œç¼–è¯‘å™¨ä¼šåšä¸€ä¸ªç±»ä¼¼äºé€‰æ‹©å¤šé‡è°ƒåº¦ä¾‹ç¨‹å€™é€‰è€…çš„è¿‡ç¨‹ã€‚åŸºäºè¿›ç¨‹æä¾›çš„ä¸»ä½“å—å€™é€‰ï¼Œå®ƒé€‰æ‹©äº†è¯¥å—æ‰€å±çš„è§’è‰²ã€‚</p>
<p>æ‰€ä»¥ï¼Œç°åœ¨å½“æˆ‘ä»¬æåˆ°è§’è‰²ç­¾åæ—¶ï¼Œä¸€å®šä¼šæœ‰æ›´å¤šçš„æ„ä¹‰ã€‚å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªç­¾åï¼Œä½œä¸ºä¸€ä¸ªäº‹å®ã€‚å¦‚æœæˆ‘æŠŠä¸€ä¸ªè§’è‰²å£°æ˜ <code>role R[::T, ::V] {}</code> ä»¥æŸç§æ›´é€‚åˆäººç±»ç¨‹åºå‘˜é˜…è¯»çš„æ–¹å¼é‡æ–°è¡¨è¿°ï¼Œå®ƒå¯èƒ½çœ‹èµ·æ¥åƒã€‚</p>
<blockquote>
<p>å£°æ˜ä¸€ä¸ªå€™é€‰è§’è‰² <code>R</code>ï¼Œå…¶ä¸»ä½“ä¸ºå—<code>sub (::T, ::V) {...}</code>ã€‚</p>
</blockquote>
<p>å¾ˆå¥½ï¼Œæˆ‘ä»¬ç°åœ¨å·²ç»è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ä½†æ˜¯ï¼Œæˆ‘ç»†å¿ƒçš„è¯»è€…ï¼Œæ˜¯ä¸æ˜¯æœ‰ä»€ä¹ˆäº‹æƒ…å›°æ‰°ç€ä½ ï¼Ÿä¸Šé¢çš„&quot;ç±»ä¼¼&quot;ä¸€è¯æ˜¯ä¸æ˜¯æ„å‘³ç€æŸç§&hellip;&hellip;å‘ƒ&hellip;&hellip;æƒŠå–œï¼Ÿå¥½å§ï¼Œä¸å¹¸çš„æ˜¯ï¼Œå€™é€‰çš„é€‰æ‹©å¹¶ä¸éµå¾ªå®Œæ•´çš„å¤šé‡è°ƒåº¦åè®®ï¼Œå› ä¸ºå®ƒç¼ºä¹å¯¹å‘½åå‚æ•°çš„æ”¯æŒã€‚è¿™æ˜¯ç”±äºç±»å‹å‚æ•°åŒ–çš„ä½çº§å®ç°çš„é™åˆ¶ã€‚è¿™æ„å‘³ç€ä¸‹é¢çš„ä¸¤ä¸ªå£°æ˜è¢«è®¤ä¸ºæ˜¯ç›¸åŒçš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="ow">R</span><span class="err">[Int</span><span class="o">,</span> <span class="nb">Bool</span> <span class="o">:</span><span class="nv">$foo</span><span class="o">]</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
<span class="k">role</span> <span class="ow">R</span><span class="err">[Int</span><span class="o">,</span> <span class="nb">Str:D</span> <span class="o">:</span><span class="nv">$bar</span><span class="o">]</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
</code></pre></div><p>å¸Œæœ›å½“æ–°çš„åˆ†æ´¾æœºåˆ¶åˆ°è¾¾ Raku æ—¶ï¼Œæƒ…å†µä¼šæœ‰æ‰€æ”¹å˜ï¼Œä½†æˆ‘åœ¨æ­¤ä¸åšä»»ä½•æ‰¿è¯ºã€‚</p>
<p>ä¸æ­¤åŒæ—¶ï¼Œä½ ä»ç„¶å¯ä»¥ä½¿ç”¨è¿™äº›åå­—ï¼Œåªæ˜¯ä¸è¦ä¾é å®ƒä»¬æ¥å”¯ä¸€åœ°è¯†åˆ«ä½ çš„è§’è‰²å€™é€‰äººã€‚</p>
<h2 id="ä¸€ä¸ªé»‘é­”æ³•å¡æ©æ–¯">ä¸€ä¸ªé»‘é­”æ³•å¡æ©æ–¯</h2>
<p>è¿™å…¶å®ä¸é€‰æ‹©å€™é€‰è€…æ— å…³ï¼Œä½†æˆ‘ä¸èƒ½å¿å—ä¸ç»™ä½ çœ‹ä¸€äº›æ£˜æ‰‹çš„ä¸œè¥¿ã€‚æ­¤å¤–ï¼Œåœ¨è®¸å¤šå°è¯´å’Œç«¥è¯æ•…äº‹ä¸­ï¼Œé»‘é­”æ³•æ˜¯ä¸€ç§å¯ä»¥è®©ä½ å®ç°ç›®æ ‡çš„ä¸œè¥¿ï¼Œä½†æœ‰ä¸€ä¸ªé™„åŠ çš„ä»·æ ¼æ ‡ç­¾ã€‚æœ‰æ—¶è¿™ä¸ªæ ‡ç­¾æ˜¯ç›¸å½“è¡€è…¥çš„ï¼Œä½†è¿™ä¸æ˜¯æˆ‘çš„æƒ…å†µã€‚å®é™…ä¸Šï¼Œæˆ‘çš„ç›®æ ‡å’Œä»£ä»·æ˜¯ä¸€æ ·çš„ï¼šæˆ‘æƒ³ç”¨ä¸åŒçš„ä¸œè¥¿æ¥å¸å¼•ä½ ã€‚</p>
<p>è¿™å°±æ˜¯è¦æ–½çš„æ³•æœ¯ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">use</span> <span class="nb">nqp</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">\r</span> <span class="o">=</span> <span class="k">role</span> <span class="ow">R</span><span class="err">[</span><span class="o">::</span><span class="err">T</span><span class="o">,</span> <span class="o">:</span><span class="p">:</span><span class="s">V</span> <span class="nb">Numeric</span><span class="o">]</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">class</span> <span class="nc">C</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">my</span> <span class="nv">\tenv</span> <span class="o">=</span> <span class="nb">r</span><span class="o">.^</span><span class="nf">body_block</span><span class="p">()</span><span class="o">.</span><span class="p">(</span><span class="n">C</span><span class="o">,</span> <span class="nb">Str</span><span class="o">,</span> <span class="nb">Int</span><span class="p">);</span>
<span class="k">my</span> <span class="nv">\ctx</span> <span class="o">=</span> <span class="nf">nqp::atpos</span><span class="p">(</span><span class="n">tenv</span><span class="o">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">my</span> <span class="nv">\iter</span> <span class="o">=</span> <span class="nf">nqp::iterator</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>
<span class="k">while</span> <span class="n">iter</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">\elem</span> <span class="o">=</span> <span class="nf">nqp::shift</span><span class="p">(</span><span class="n">iter</span><span class="p">);</span>
    <span class="nb">say</span> <span class="nf">nqp::iterkey_s</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2"> =&gt; </span><span class="p">&#34;</span><span class="o">,</span> <span class="nf">nqp::iterval</span><span class="p">(</span><span class="n">elem</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>åªè¦ä¸»ä½“å—æ˜¯ä¸€ä¸ªä¾‹ç¨‹ï¼Œæ˜¾ç„¶æˆ‘ä»¬å¯ä»¥è‡ªå·±è°ƒç”¨å®ƒã€‚ä¸ºäº†ç†è§£å‰©ä¸‹çš„å‡ è¡Œå’Œæ‰€æœ‰ä½¿ç”¨çš„ <code>nqp:: ops</code>ï¼Œäººä»¬éœ€è¦å‚è€ƒ <a href="https://github.com/Raku/nqp/blob/master/docs/ops.markdown">NQP ops</a> æ–‡æ¡£ã€‚</p>
<p>æ€»ä¹‹ï¼Œ&ldquo;å’’è¯­&quot;äº§ç”Ÿçš„è¾“å‡ºå¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ã€‚</p>
<pre><code>::?CLASS =&gt; (C)
$?ROLE =&gt; (R)
T =&gt; (Str)
$?CONCRETIZATION =&gt; (Mu)
$?PACKAGE =&gt; (R)
::?PACKAGE =&gt; (R)
V =&gt; (Int)
::?ROLE =&gt; (R)
$?CLASS =&gt; (C)
$_ =&gt; (Mu)
</code></pre><p>ç”¨ä¸¤ä¸ªå­—æ¥è¯´ï¼Œè§’è‰²ä½“å—è¿”å›ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„ã€‚ç¬¬äºŒä¸ªå…ƒç´ æ˜¯ç¬¦å·åç§°åˆ°å…¶å…·ä½“å€¼çš„æ˜ å°„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ <code>=&gt;</code> ç®­å¤´å·¦ä¾§çš„é”®ä¸­ï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°ä»è§’è‰²ç­¾åä¸­å‘ç°æˆ‘ä»¬çš„ <code>T</code> å’Œ <code>V</code> ç±»å‹æ•è·ï¼›ä»¥åŠç¼–è¯‘å™¨å¸¸é‡ï¼Œå¦‚ <code>::?CLASS</code> å’Œå…¶ä»–ã€‚</p>
<p>æ€»çš„æ¥è¯´ï¼Œä»£ç è¿”å›çš„ä¸œè¥¿è¢«ç§°ä¸ºå†…éƒ¨ç±»å‹ç¯å¢ƒï¼Œå¹¶è¢«ç”¨äºå¦ä¸€ç§å¹¿æ³›é‡‡ç”¨çš„æœºåˆ¶ï¼Œå³æ³›å‹å®ä¾‹åŒ–ã€‚ä½†è¿™ä¸ªè¯é¢˜è‚¯å®šè¿œè¿œè¶…å‡ºäº†æœ¬æ–‡çš„ç›®çš„ã€‚è¿™é‡Œç¡®å®å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæ‰€æœ‰åŒ…å«åœ¨ç¯å¢ƒä¸­çš„ç¬¦å·å®é™…ä¸Šéƒ½æ˜¯è§’è‰²ä½“è¯æ³•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æŠŠæˆ‘çš„ <code>FOO = 42</code> åŠ å…¥åˆ°ä¸»ä½“ä¸­ï¼Œé‚£ä¹ˆä¸Šé¢çš„è¾“å‡ºå°±ä¼šæœ‰ä»¥ä¸‹ä¸€è¡ŒåŠ å…¥åˆ°å…¶ä¸­ã€‚</p>
<pre><code>FOO =&gt; 42
</code></pre><p>å¦å¤–ï¼Œçœ‹ç€è¿™äº›ç¬¦å·ï¼Œä½ ç°åœ¨ç”šè‡³å¯ä»¥æ›´å¥½åœ°ç†è§£ä¸ºä»€ä¹ˆè§’è‰²çš„ç‰¹åŒ–éœ€è¦ä¸€ä¸ªç±»æ¥æ¶ˆè€—å®ƒã€‚ä½ ä¸‹æ¬¡åœ¨åšç±»ä¼¼çš„äº‹æƒ…æ—¶å¯èƒ½ä¼šè€ƒè™‘åˆ°è¿™ä¸€ç‚¹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">method</span> <span class="nf">foo</span><span class="p">(</span><span class="vg">::?CLASS:D</span><span class="o">:</span> <span class="o">|</span><span class="p">)</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
</code></pre></div><p>æœ€åæˆ‘æƒ³æŒ‡å‡ºçš„ä¸€ç‚¹æ˜¯ <code>$?CONCRETIZATION</code> ç¬¦å·ï¼Œå®ƒè¿˜æ²¡æœ‰è¢«è®°å½•ä¸‹æ¥ã€‚å®ƒåªåœ¨è§’è‰²ä¸»ä½“å’Œè§’è‰²æ–¹æ³•ä¸­å¯ç”¨ï¼Œå¹¶ä¸”å½“å®ƒå¯ç”¨æ—¶è¢«ç»‘å®šåˆ°è§’è‰²çš„å…·ä½“åŒ–ä¸­ã€‚è¿™ä¸ªç¬¦å·ä¸»è¦æ˜¯ç”¨äºè‡ªçœçš„ç›®çš„ã€‚</p>
<h3 id="æ­¥éª¤4a-ç‰¹åŒ–">æ­¥éª¤4a: ç‰¹åŒ–</h3>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå€™é€‰è€…ã€‚æˆ‘ä»¬çŸ¥é“å…·ä½“çš„å‚æ•°ã€‚æˆ‘ä»¬çŸ¥é“æ¶ˆè€—å®ƒçš„ç±»ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ç¡®å®çŸ¥é“äº†ä¸€åˆ‡ï¼Œå¯ä»¥è¿›è¡Œç‰¹åŒ–ï¼Œå¹¶å¾—åˆ°å…·ä½“åŒ–ï¼Œæœ€ç»ˆå°†è¿™ä¸ªè§’è‰²çº³å…¥æ¶ˆè´¹å®ƒçš„ç±»ä¸­ã€‚</p>
<p>æ­£å¦‚æˆ‘åœ¨ä¸Šé¢å·²ç»æåˆ°çš„ï¼Œç‰¹åŒ–æ˜¯ä¸€ä¸ªç›¸å½“å¤æ‚çš„è¿‡ç¨‹ã€‚åœ¨ Rakudo å…ƒæ¨¡å‹çš„å®ç°ä¸­ï¼Œå®ƒåˆ†å¸ƒåœ¨å‡ ä¸ªæºæ–‡ä»¶ä¸­ï¼Œå¹¶æ¶‰åŠåˆ°ä¸€äº›å…¶ä»–çš„å†…éƒ¨æœºåˆ¶ï¼Œå¦‚é€šç”¨å®ä¾‹åŒ–ï¼Œæˆ‘åœ¨ä¸Šé¢ä¹Ÿæš—ç¤ºè¿‡ã€‚æˆ‘æœ€å¥½ä¸è¦æ·±ç©¶å…¶ä¸­çš„ç»†èŠ‚ï¼Œè€Œæ˜¯ä¸“æ³¨äºä¸»è¦çš„é˜¶æ®µã€‚é‚£äº›çœŸæ­£å¥½å¥‡çš„äººå¯ä»¥ä» Rakudo ç¼–è¯‘å™¨æºæ–‡ä»¶ src/Perl6/Metamodel/ParametricRoleHOW.nqp ä¸­çš„æ–¹æ³•ç‰¹åŒ–å¼€å§‹ã€‚</p>
<p>ç‰¹åŒ–ä¸€ä¸ªæ–°çš„è§’è‰²ï¼Œé¦–å…ˆè¦åˆ›å»ºä¸€ä¸ª <code>Perl6::Metamodel::ConcreteRoleHOW</code> çš„æ–°å®ä¾‹å’Œç›¸åº”çš„å…·ä½“è§’è‰²ç±»å‹å¯¹è±¡ã€‚ç„¶åè°ƒç”¨ body block æ¥è·å¾—ä¸€ä¸ªç±»å‹ç¯å¢ƒç»“æ„ã€‚æˆ‘å°†é‡ç‚¹ä»‹ç»ä¸€ä¸‹è¿™ä¸ªã€‚åƒå¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬å…ˆä¸¾ä¸€ä¸ªä¾‹å­ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">R</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">inside the role, class is </span><span class="p">&#34;</span><span class="o">,</span> <span class="vg">::?CLASS</span><span class="o">.^</span><span class="nb">name</span><span class="p">;</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">class is composed? </span><span class="p">&#34;</span><span class="o">,</span> <span class="vg">::?CLASS</span><span class="o">.^</span><span class="nf">is_composed</span> <span class="o">??</span> <span class="p">&#34;</span><span class="s2">yes</span><span class="p">&#34;</span> <span class="o">!!</span> <span class="p">&#34;</span><span class="s2">no</span><span class="p">&#34;;</span>
<span class="p">}</span>
<span class="k">class</span> <span class="nc">C1</span> <span class="k">does</span> <span class="nc">R</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">class</span> <span class="nc">C2</span> <span class="k">does</span> <span class="nc">R</span> <span class="p">{</span> <span class="p">}</span>
<span class="c1"># inside the role, class is C1</span>
<span class="c1"># class is composed? no</span>
<span class="c1"># inside the role, class is C2</span>
<span class="c1"># class is composed? no</span>
</code></pre></div><p>æˆ‘ä»¬åœ¨è¿™é‡Œè§‚å¯Ÿåˆ°çš„æ˜¯ï¼Œè§’è‰²ä¸»ä½“å·²ç»è¢«è°ƒç”¨äº†ä¸¤æ¬¡ï¼Œå®ƒçŸ¥é“å®ƒæ‰€åº”ç”¨çš„ç±»ï¼Œè€Œä¸”è¿™ä¸ªç±»è¿˜æ²¡æœ‰è¢«ç»„æˆï¼ˆæˆ‘åœ¨<a href="https://vrurg.github.io/arfb-publication/02-everything-is-an-object-mop/#raku-metamodel">å¦ä¸€ç¯‡æ–‡ç« </a>ä¸­ä»‹ç»äº†ä¸€äº›å…³äºç±»ç”Ÿå‘½å‘¨æœŸçš„ä¿¡æ¯ï¼‰ã€‚å¦å¤–ï¼Œæ­£å¦‚æˆ‘å·²ç»æåˆ°çš„ï¼Œå…·ä½“åŒ–åœ¨è¿™ä¸€ç‚¹ä¸Šå­˜åœ¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">R</span> <span class="p">{</span>
	<span class="nb">say</span> <span class="nv">$?CONCRETIZATION</span><span class="o">.^</span><span class="nb">name</span><span class="p">;</span> <span class="c1"># R</span>
<span class="p">}</span>
</code></pre></div><p>ä½†å®ƒè¿˜æ˜¯ç©ºçš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nv">$?CONCRETIZATION</span><span class="o">.^</span><span class="nb">attributes</span><span class="o">.</span><span class="nb">elems</span><span class="p">;</span> <span class="c1"># 0</span>
<span class="nb">say</span> <span class="nv">$?CONCRETIZATION</span><span class="o">.^</span><span class="nb">methods</span><span class="o">.</span><span class="nb">elems</span><span class="p">;</span>    <span class="c1"># 0</span>
</code></pre></div><p>è€Œä¸”ï¼Œå¾ˆæ˜æ˜¾ï¼Œæ²¡æœ‰ç»„æˆã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nv">$?CONCRETIZATION</span><span class="o">.^</span><span class="nf">is_composed</span> <span class="o">??</span> <span class="p">&#34;</span><span class="s2">yes</span><span class="p">&#34;</span> <span class="o">!!</span> <span class="p">&#34;</span><span class="s2">no</span><span class="p">&#34;;</span> <span class="c1"># no</span>
</code></pre></div><p>æ‰€æœ‰è¿™äº›ä½¿å¾—è§’è‰²ä½“æˆä¸ºä¸€ä¸ªå¥½åœ°æ–¹ï¼Œå¯ä»¥åœ¨è§’è‰²è¢«å®é™…æ¶ˆè´¹æ—¶åšéœ€è¦åšçš„äº‹æƒ…ã€‚</p>
<p>ç°åœ¨ï¼Œæœ‰äº†æ‰€æœ‰å¿…è¦çš„ä¿¡æ¯ï¼Œå…ƒæ¨¡å‹é€šè¿‡å®ä¾‹åŒ–åŸå§‹å‚æ•°åŒ–æˆ–æŸ¯é‡ŒåŒ–è§’è‰²çš„å±æ€§å’Œæ–¹æ³•ï¼Œå¹¶å°†å®ƒä»¬å®‰è£…åˆ°æ–°åˆ›å»ºçš„å…·ä½“åŒ–ä¸­æ¥æœ€ç»ˆå®Œæˆä¸“ä¸šåŒ–ã€‚ä¾‹å¦‚è¿™ä¸ªç‰‡æ®µçš„ä¾‹å­ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="ow">R</span><span class="p">[</span><span class="o">:</span><span class="p">:</span><span class="s">T</span><span class="p">]</span> <span class="p">{</span> <span class="k">has</span> <span class="nb">T</span> <span class="nv">$.attr</span> <span class="p">}</span>
<span class="k">class</span> <span class="nc">C</span> <span class="ow">R</span><span class="p">[</span><span class="nb">Str</span><span class="p">]</span> <span class="p">{</span> <span class="p">}</span>
</code></pre></div><p>å¦‚æœæˆ‘ä»¬è½¬å‚¨åŸå§‹è§’è‰²å’Œå…·ä½“åŒ–çš„å±æ€§ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šçœ‹åˆ°ç±»ä¼¼äºä¸‹é¢çš„è¾“å‡ºã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">attr:</span> <span class="p">(</span><span class="nb">Attribute</span><span class="o">|</span><span class="mi">94613946040184</span> <span class="nb">T</span> <span class="nv">$!attr</span><span class="p">)</span>
<span class="nf">concretization</span> <span class="n">attr:</span> <span class="p">(</span><span class="nb">Attribute</span><span class="o">|</span><span class="mi">94613946043184</span> <span class="nb">Str</span> <span class="nv">$!attr</span><span class="p">)</span>
</code></pre></div><p>å½“ç”¨å±æ€§å’Œæ–¹æ³•å®Œæˆæ—¶ï¼Œä»»ä½•è¢«æ¶ˆè€—çš„è§’è‰²éƒ½ä¼šè¢«å®ä¾‹åŒ–å’Œå…·ä½“åŒ–ã€‚ä¾‹å¦‚ï¼Œå¯¹äºè¿™ä¸ªå£°æ˜ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">role</span> <span class="nc">R1</span><span class="o">[:</span><span class="p">:</span><span class="s">T</span><span class="o">,</span> <span class="o">:</span><span class="p">:</span><span class="s">V</span><span class="o">]</span> <span class="k">does</span> <span class="nc">R2</span><span class="o">[:</span><span class="p">:</span><span class="s">T</span><span class="o">]</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div><p><code>R2</code> çš„å…·ä½“åŒ–å°†è¢«æ·»åŠ åˆ° <code>R1</code> çš„å…·ä½“åŒ–ä¸­ï¼Œç„¶å <code>R2</code> çš„å…·ä½“åŒ–å°†è¢«æ·»åŠ åˆ° <code>R1</code> çš„å…·ä½“åŒ–ä¸­ã€‚</p>
<p>æœ€åï¼Œå¦‚æœæœ‰ä»»ä½•çˆ¶ç±»æ·»åŠ åˆ°è§’è‰²ä¸­ï¼Œå®ƒä»¬ä¹Ÿä¼šè¢«å®ä¾‹åŒ–å’Œæ·»åŠ ã€‚</p>
<p>å½“æ‰€æœ‰ä¸Šè¿°å‡†å¤‡å·¥ä½œå®Œæˆåï¼Œæˆ‘ä»¬çš„å…·ä½“åŒ–å°±è¢«ç»„æˆäº†ã€‚å®ƒç°åœ¨å·²ç»å‡†å¤‡å¥½è¢«æ·»åŠ åˆ°å®ƒçš„æ¶ˆè´¹ç±»ä¸­ã€‚</p>
<p>æ•…äº‹å°±è¿™æ ·ç»“æŸäº†ã€‚</p>
<h2 id="å¿è¿˜å€ºåŠ¡">å¿è¿˜å€ºåŠ¡</h2>
<p>çŸ¥é“å¾ˆä¹…ä»¥å‰çš„æ‰¿è¯ºæœ€ç»ˆå¾—åˆ°äº†å…‘ç°ï¼ŒçœŸçš„è®©äººæ¾äº†ä¸€å£æ°”ã€‚ä¸å¹¸çš„æ˜¯ï¼Œä¸ºäº†æ¶µç›–è¿™ä¸ªä¸»é¢˜ï¼Œæˆ‘å·²ç»è·³è¿‡äº†å…¶ä»–ä¸€äº›æ›´åŸºæœ¬çš„ä¸»é¢˜ã€‚ä¾‹å¦‚ï¼Œè®©è¯»è€…æ›´å¥½åœ°äº†è§£å¤šé‡è°ƒåº¦ã€ç±»å‹å¯¹è±¡çš„ç»„æˆï¼Œä»¥åŠ Rakudoã€NQP å’Œåç«¯è™šæ‹Ÿæœºæ˜¯å¦‚ä½•ç›¸äº’ä½œç”¨çš„ï¼Œè¿™å¯¹è¯»è€…æ˜¯æœ‰ç›Šçš„ã€‚å¦‚æœæˆ‘å†™äº†è¶³å¤Ÿå¤šçš„æ–‡ç« ï¼Œå¹¶è€ƒè™‘æŠŠè¿™äº›ææ–™ç¼–æˆä¸€æœ¬ä¹¦ï¼Œé‚£ä¹ˆç”±è¿™æ®µæ–‡å­—ç»„æˆçš„ç« èŠ‚å°†è¢«æ”¾åœ¨ç¦»ä¹¦çš„å¼€å¤´æ›´è¿œçš„åœ°æ–¹ã€‚</p>
<p>ä¸ç®¡æ€ä¹ˆè¯´ï¼Œæˆ‘å·²ç»å°½äº†æœ€å¤§çš„åŠªåŠ›ï¼Œè¿œç¦»é‚£äº›è¿˜æœªè¢«æåŠçš„æ¦‚å¿µï¼Œå¸Œæœ›ä½ åœ¨è¿™é‡Œæ‰¾åˆ°æœ‰ç”¨çš„ä¿¡æ¯ã€‚</p>
<p>åŸæ–‡é“¾æ¥: <a href="https://vrurg.github.io/arfb-publication/07-roles-or-when-one-is-many/">https://vrurg.github.io/arfb-publication/07-roles-or-when-one-is-many/</a></p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/raku" term="raku" label="Raku" />
                             
                                <category scheme="https://ohmyweekly.github.io/tags/role" term="role" label="Role" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku Syntax I Miss in Other Languages]]></title>
            <link href="https://ohmyweekly.github.io/notes/2021-06-17-raku-syntax-i-miss-in-other-languages/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2021-06-05-learn-raku-from-roast/?utm_source=atom_feed" rel="related" type="text/html" title="Learn Raku From Roast" />
                <link href="https://ohmyweekly.github.io/notes/2021-04-15-raku-multiple-dispatch-with-the-new-moarvm-dispatcher/?utm_source=atom_feed" rel="related" type="text/html" title="Raku Multiple Dispatch With the New MoarVM Dispatcher" />
                <link href="https://ohmyweekly.github.io/notes/2021-05-19-a-tour-of-rust-standard-library-traits/?utm_source=atom_feed" rel="related" type="text/html" title="Rust çš„æ ‡å‡†åº“ Trait ä¹‹æ—…" />
                <link href="https://ohmyweekly.github.io/notes/2021-04-05-psql/?utm_source=atom_feed" rel="related" type="text/html" title="Psql" />
                <link href="https://ohmyweekly.github.io/notes/2021-03-15-towards-a-new-general-dispatch-mechanism-in-moarvm/?utm_source=atom_feed" rel="related" type="text/html" title="äº‰å–åœ¨ MoarVM ä¸­å»ºç«‹ä¸€ä¸ªæ–°çš„æ€»è°ƒåº¦æœºåˆ¶" />
            
                <id>https://ohmyweekly.github.io/notes/2021-06-17-raku-syntax-i-miss-in-other-languages/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-06-17T00:00:00+08:00</published>
            <updated>2021-06-17T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Raku Syntax I Miss in Other Languages</blockquote><h1 id="self-describing-code">Self-describing code</h1>
<h2 id="junctions">Junctions</h2>
<ul>
<li>Distributive</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">%hash</span><span class="p">{</span><span class="nb">any</span><span class="p">(</span><span class="nv">@keys</span><span class="p">)}</span>
</code></pre></div><p>ç­‰ä»·äº:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">any</span><span class="p">(</span><span class="nv">%hash</span><span class="p">{</span><span class="nv">@keys</span><span class="p">})</span>
</code></pre></div><ul>
<li>Boolean</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">ç±»å‹</th>
<th style="text-align:left">æ“ä½œç¬¦</th>
<th style="text-align:left">True if &hellip;</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">any</td>
<td style="text-align:left">|</td>
<td style="text-align:left">è‡³å°‘ä¸€ä¸ªå€¼ä¸ºçœŸ</td>
</tr>
<tr>
<td style="text-align:left">all</td>
<td style="text-align:left">&amp;</td>
<td style="text-align:left">æ‰€æœ‰å€¼éƒ½ä¸ºçœŸ</td>
</tr>
<tr>
<td style="text-align:left">one</td>
<td style="text-align:left">^</td>
<td style="text-align:left">åªæœ‰ä¸€ä¸ªå€¼ä¸ºçœŸ</td>
</tr>
<tr>
<td style="text-align:left">none</td>
<td style="text-align:left"></td>
<td style="text-align:left">å€¼éƒ½ä¸ä¸ºçœŸ</td>
</tr>
</tbody>
</table>
<p>Junctions é€šå¸¸å‡ºç°åœ¨å¸ƒå°”ä¸Šä¸‹æ–‡ä¸­ã€‚ä¾‹å¦‚, åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­, <code>$value</code> å’Œå‡ ä¸ªå€¼è¿›è¡Œç›¸ç­‰æ€§æ¯”è¾ƒã€‚å¾ˆå®¹æ˜“å†™å‡ºè¿™æ ·çš„ä»£ç :</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="nv">$value</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">||</span> <span class="nv">$value</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">||</span> <span class="nv">$value</span> <span class="o">==</span> <span class="mi">5</span>
</code></pre></div><p>ä½¿ç”¨ <code>any</code> Junction ä¼šç®€æ´ä¸å°‘:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="nv">$value</span> <span class="o">==</span> <span class="nb">any</span><span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="k">if</span> <span class="nv">$value</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="nb">any</span>
</code></pre></div><p>æƒ¯ç”¨æ³•æ˜¯ä½¿ç”¨ <code>|</code> æ“ä½œç¬¦å·æ¥è¿›è¡Œå¤šå€¼æ¯”è¾ƒ:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="nv">$value</span> <span class="o">==</span> <span class="mi">1</span><span class="o">|</span><span class="mi">2</span><span class="o">|</span><span class="mi">5</span>
</code></pre></div><p>æ‰¾å‡ºæ•°ç»„ä¸­æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ , æˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„å¯èƒ½æ˜¯, ä½¿ç”¨ <code>for</code> å¾ªç¯è¿­ä»£æ•°ç»„, æ‰¾å‡ºæ»¡è¶³æ¡ä»¶çš„å…ƒç´ å°±ç«‹å³é€€å‡ºå¾ªç¯:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$result</span> <span class="o">=</span> <span class="nb">False</span><span class="p">;</span>

<span class="k">for</span> <span class="nv">@values</span> <span class="k">-&gt;</span> <span class="nv">$value</span> <span class="p">{</span>
    <span class="k">if</span> <span class="nv">$value</span> <span class="o">&gt;</span> <span class="mi">42</span> <span class="p">{</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nb">True</span><span class="p">;</span>
        <span class="nb">last</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">if</span> <span class="nv">$result</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div><p>æ”¹ç”¨ Junction åç­‰ä»·äº:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nv">@values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">42</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div><p>è¿˜å¯ä»¥åœ¨ Junction ä¸Šè°ƒç”¨æ–¹æ³•æˆ–è¿ç®—ç¬¦:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="nb">one</span><span class="p">(</span><span class="nv">@values</span><span class="p">)</span><span class="o">.</span><span class="nb">is-prime</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nv">@values</span><span class="p">)</span> <span class="nv">%%</span> <span class="mi">3</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div><h2 id="named-argumentså‘½åå‚æ•°">Named arguments(å‘½åå‚æ•°)</h2>
<p>Colonpair(å†’å·å¯¹å„¿) é€šå¸¸ç”¨äºå‘½åå‚æ•°ä¸­:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">:</span><span class="s">foo</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="s">foo</span> <span class="o">=&gt;</span> <span class="mi">42</span>

<span class="k">sub</span> <span class="nf">bar</span><span class="p">(</span><span class="o">:</span><span class="nv">$foo</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$foo</span><span class="p">;</span>
<span class="p">}</span>

<span class="nf">bar</span><span class="p">(:</span><span class="s">foo</span><span class="p">(</span><span class="mi">42</span><span class="p">));</span>
</code></pre></div><p>æœ‰å‡ ç§ç‰¹æ®Šå½¢å¼çš„å†’å·å¯¹å„¿:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">:</span><span class="s">foo</span>
<span class="p">:</span><span class="s">foo</span><span class="p">(</span><span class="nb">True</span><span class="p">)</span>

<span class="p">:!</span><span class="s">foo</span>
<span class="p">:</span><span class="s">foo</span><span class="p">(</span><span class="nb">False</span><span class="p">)</span>

<span class="p">:</span><span class="s">foo</span><span class="p">&lt;</span><span class="s">bar</span><span class="p">&gt;</span>
<span class="p">:</span><span class="s">foo</span><span class="p">(&#34;</span><span class="s2">bar</span><span class="p">&#34;)</span>
</code></pre></div><p><code>:foo</code> ä¸ <code>foo =&gt; True</code> ç›¸åŒ, <code>:!foo</code> ç­‰ä»·äº <code>foo =&gt; False</code>ã€‚<code>:foo&lt;bar&gt;</code> ä½¿ç”¨äº†ä¸€ç»„å°–æ‹¬å·å¼•èµ·äº†å€¼, å€¼åœ¨å°–æ‹¬å·ä¸­ä¸è¿›è¡Œæ’å€¼ã€‚</p>
<p>æ¥çœ‹ä¸€ä¸ªå‘½åå‚æ•°ä¾‹å­, ä¸‹é¢çš„ä»£ç éå† <code>@dirs</code> ä¸­çš„ç›®å½•, æ‰¾å‡ºåç¼€åä¸º txt ä¸”ä¸ä¸ºç©ºçš„æ–‡ä»¶:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="nb">find</span><span class="p">(</span><span class="nv">@dirs</span><span class="o">,</span> <span class="p">:</span><span class="s">file</span><span class="o">,</span> <span class="p">:</span><span class="s">ext</span><span class="p">&lt;</span><span class="s">txt</span><span class="p">&gt;</span><span class="o">,</span> <span class="p">:!</span><span class="s">empty</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nv">$file</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre></div><p>å†’å·å¯¹å„¿çš„å€¼å¯ä»¥æ˜¯å˜é‡, ä½†æ˜¯åœ¨åœ†æ‹¬å·ä¸­å†å†™ä¸€éå˜é‡åå°±æ˜¾å¾—å•°å—¦:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nf">foo</span><span class="p">(:</span><span class="s">bar</span><span class="p">(</span><span class="nv">$bar</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">baz</span><span class="p">(</span><span class="nv">$baz</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">quz</span><span class="p">(</span><span class="nv">$quz</span><span class="p">))</span>
</code></pre></div><p>å› æ­¤, å†’å·å¯¹å„¿æä¾›äº†ä¸€ç§ç®€å†™å½¢å¼, å¦‚æœå†’å·åé¢ç´§è·Ÿç€ <code>$</code>ã€<code>@</code>ã€<code>%</code> å’Œ <code>&amp;</code> ç­‰ç¬¦å·, é‚£ä¹ˆå†’å·å¯¹å„¿çš„å€¼å°±æ˜¯ <code>$sth</code>ã€<code>@sth</code>ã€<code>%sth</code> å’Œ <code>&amp;sth</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nf">foo</span><span class="p">(</span><span class="o">:</span><span class="nv">$bar</span><span class="o">,</span> <span class="o">:</span><span class="nv">$baz</span><span class="o">,</span> <span class="o">:</span><span class="nv">$quz</span><span class="p">)</span>
</code></pre></div><p>è¿™ç§ç®€å†™å½¢å¼æ¶ˆé™¤äº†å‘½åå‚æ•°çš„é‡å¤ã€‚</p>
<h2 id="pointy-blockså°–å·å—å„¿">Pointy blocks(å°–å·å—å„¿)</h2>
<p>All blocks are <strong>Callable</strong>, å³æ‰€æœ‰çš„å—å„¿éƒ½æ˜¯å¯è°ƒç”¨çš„ã€‚</p>
<ul>
<li><code>for</code> blocks</li>
</ul>
<p><code>-&gt; $elem { ...}</code> å°±æ˜¯å°–å·å—å„¿:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="nv">@array</span> <span class="k">-&gt;</span> <span class="nv">$elem</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre></div><p><code>for</code> å¾ªç¯ä¾æ¬¡æŠŠ <code>@array</code> ä¸­çš„æ¯ä¸ªå…ƒç´ èµ‹å€¼ç»™å°–å·å—å„¿ä¸­çš„ <code>$elem</code> å˜é‡, ç„¶åæ‰§è¡Œå°–å·å—å„¿çš„ä¸»ä½“ã€‚</p>
<ul>
<li>Ordering</li>
</ul>
<p>å¦‚æœ <code>foo</code> ä¾‹ç¨‹æœ‰è¿”å›å€¼ä¸”ä¸ä¸ºå‡, åˆ™èµ‹å€¼ç»™ <code>$value</code>, ç„¶åæ‰§è¡Œå—å„¿çš„ä¸»ä½“:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="k">my</span> <span class="nv">$value</span> <span class="o">=</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div><p>ä½†æ˜¯ä¸Šé¢çš„è¯­å¥åœ¨ Raku  ä¸­æ˜¯ä¸åˆæ³•çš„, è¦ä½¿ç”¨å°–å·å—å„¿çš„æ–¹å¼:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="nf">foo</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="nv">$value</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div><h2 id="signaturesç­¾å">Signatures(ç­¾å)</h2>
<p><code>for</code> å¾ªç¯å¯ä»¥ä¸€æ¬¡è¿­ä»£ä¸¤ä¸ª(æˆ–å¤šä¸ª)å…ƒç´ ã€‚å°–å·å—å„¿ç›¸å½“äºåŒ¿åå‡½æ•°, å…¶ä¸­çš„ <code>$first, $second</code> å°±æ˜¯å°–å·å—å„¿çš„ç­¾åã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="nv">@array</span> <span class="k">-&gt;</span> <span class="nv">$first</span><span class="o">,</span> <span class="nv">$second</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre></div><p>ä¸‹é¢çš„æ™ºèƒ½åŒ¹é…ä¸­, å˜é‡ <code>$1</code> å’Œ <code>$2</code> æœ‰äº›å¤šä½™:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="o">/</span> <span class="p">(</span>\<span class="k">S</span><span class="err">+</span><span class="p">)</span><span class="sr"> </span><span class="se">\s</span><span class="o">+</span><span class="sr"> </span><span class="p">(</span><span class="ni">.</span><span class="o">*</span><span class="p">)</span><span class="sr"> / </span><span class="p">{</span> 
    <span class="k">my</span> <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$1</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$value</span> <span class="o">=</span> <span class="nv">$2</span><span class="p">;</span>
    <span class="o">...</span>
 <span class="p">}</span><span class="sr">
</span></code></pre></div><p>é€šè¿‡å°–å·å—å„¿, æŠŠåŒ¹é…ç»“æœç›´æ¥èµ‹å€¼ç»™ <code>$name</code> å’Œ <code>$value</code>, èŠ‚çœäº†ä¸¤ä¸ªå˜é‡å:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="o">/</span> <span class="p">(</span>\<span class="k">S</span><span class="err">+</span><span class="p">)</span><span class="sr"> </span><span class="se">\s</span><span class="o">+</span><span class="sr"> </span><span class="p">(</span><span class="ni">.</span><span class="o">*</span><span class="p">)</span><span class="sr"> / -</span><span class="p">&gt;</span> <span class="p">(</span><span class="nv">$name</span><span class="o">,</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre></div><p><code>for</code> å°–å·å—å„¿å’Œ <code>if</code> å°–å·å—å„¿çš„ç»“æ„ç±»ä¼¼, è¯­æ³•ä¸Šéå¸¸æ•´é½:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="nf">expression</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="nv">$value</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="k">if</span> <span class="nf">expression</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="nv">$value</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre></div><h2 id="whatever-code">Whatever code</h2>
<p>å¦‚æœ grep çš„è¿‡æ»¤æ¡ä»¶ä¸­æœ‰å¤šä¸ªå˜é‡, é‚£ä¹ˆä½¿ç”¨å°–å·å—å„¿è¿™ç§åŒ¿åå‡½æ•°æ¯”è¾ƒåˆé€‚:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@numbers</span><span class="o">.</span><span class="nb">grep</span><span class="p">(</span><span class="k">-&gt;</span> <span class="nv">$n</span> <span class="p">{</span> <span class="nv">$n</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="p">});</span>
</code></pre></div><p>å¦‚æœè¿‡æ»¤æ¡ä»¶ä¸­åªæœ‰ä¸€ä¸ªå˜é‡, é‚£ä¹ˆå½¢å¼æ›´çŸ­çš„ Whatever code æ›´ç¬¦åˆæƒ¯ç”¨æ³•:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@numbers</span><span class="o">.</span><span class="nb">grep</span><span class="p">(</span><span class="o">*</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">);</span>
</code></pre></div><h2 id="meta-operators">Meta-operators</h2>
<ul>
<li>Reduction</li>
<li>Zip</li>
<li>Corss</li>
<li>Hyper</li>
</ul>
<p>Reduction meta operators</p>
<ul>
<li>fold/reduce an infix operator</li>
<li>Respects associativity</li>
</ul>
<p><code>reduce</code> è¿ç®—ç¬¦å¯ä»¥ç”¨äºæ±‚å’Œ:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$sum</span> <span class="o">=</span> <span class="nb">reduce</span> <span class="p">{</span> <span class="nv">$^a</span> <span class="o">+</span> <span class="nv">$^b</span> <span class="p">}</span><span class="o">,</span> <span class="nv">@list</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$sum</span> <span class="o">=</span> <span class="o">[+]</span> <span class="nv">@list</span>
</code></pre></div><pre><code>[+]   # sum
[*]   # product
[~]   # join
[===] # all equal
[&lt;&gt;]  # ascending order
[||]  # first true value, if any
</code></pre>
<p>Zip å…ƒè¿ç®—ç¬¦ç”¨äºè¿æ¥åˆ—è¡¨:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">Z</span><span class="o">+</span> <span class="p">(</span><span class="mi">30</span><span class="o">,</span> <span class="mi">20</span> <span class="o">,</span><span class="mi">10</span><span class="p">)</span>
<span class="c1"># (21, 22, 13)</span>
</code></pre></div><p><code>-&gt; ($a, $b)</code> è§£æ„ Zip åçš„å…ƒç´ :</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="nv">@a</span> <span class="ow">Z</span> <span class="nv">@b</span> <span class="k">-&gt;</span> <span class="p">(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">...</span>
<span class="p">}</span>
</code></pre></div><p><code>Z=&gt;</code> è¿ç®—ç¬¦é€šå¸¸ç”¨äºä»ä¸¤ä¸ªåˆ—è¡¨ä¸­åˆ¶ä½œå“ˆå¸Œ:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">%hash</span> <span class="o">=</span> <span class="nv">@keys</span> <span class="ow">Z</span><span class="o">=&gt;</span> <span class="nv">@values</span>
</code></pre></div><p>Zip å…ƒè¿ç®—ç¬¦å¯ä»¥å†™æˆé“¾å¼çš„:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@a</span> <span class="ow">Z</span> <span class="nv">@b</span> <span class="ow">Z</span> <span class="nv">@c</span>
<span class="o">[</span><span class="ow">Z</span><span class="o">]</span> <span class="nv">@list-of-lists</span>
</code></pre></div><p>Cross æ˜¯äº¤å‰è¿ç®—ç¬¦ã€‚ä½¿ç”¨ä¸¤å±‚ for å¾ªç¯ä¹Ÿå¯ä»¥å®ç°äº¤å‰è¿ç®—ç¬¦çš„åŠŸèƒ½, å°±æ˜¯ä»£ç ç¨é•¿:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">gather</span> <span class="k">for</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">9</span> <span class="k">-&gt;</span> <span class="nv">$i</span> <span class="p">{</span>
    <span class="k">for</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">10</span> <span class="k">-&gt;</span> <span class="nv">$j</span> <span class="p">{</span>
        <span class="nb">take</span> <span class="nv">$i</span> <span class="o">+</span> <span class="nv">$j</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>è€Œä½¿ç”¨äº¤å‰è¿ç®—ç¬¦, ä¸€è¡Œä»£ç æå®š:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="mi">3</span><span class="o">,</span> <span class="mi">9</span> <span class="ow">X</span><span class="o">+</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">10</span>
</code></pre></div><p>æ·»åŠ å‰ç¼€ä¹Ÿå¾ˆç®€å•:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">&#34;</span><span class="s2">prefix-</span><span class="p">&#34;</span> <span class="ow">X</span><span class="o">~</span> <span class="nv">@list</span>
</code></pre></div><p>Hyper è¿ç®—ç¬¦å¯ä»¥æŠŠä»»ä½•è¿ç®—ç¬¦(ä¸­ç¼€ã€å‰ç¼€å’Œåç¼€ç­‰)åº”ç”¨åˆ°åˆ—è¡¨ä¸Š:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@list</span><span class="o">Â».</span><span class="nb">abs</span>
<span class="nv">@list</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="o">*.</span><span class="nb">abs</span><span class="p">)</span>

<span class="o">!</span><span class="p">Â«</span><span class="nv">@list</span><span class="s2">
</span><span class="s2"></span><span class="nv">@list</span><span class="o">.</span><span class="nf">map</span><span class="p">(</span><span class="o">!*</span><span class="p">)</span><span class="s2">
</span><span class="s2">
</span><span class="s2"></span><span class="nv">@list</span><span class="p">Â»</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>
<span class="nv">@list</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="o">*[</span><span class="mi">1</span><span class="o">]</span><span class="p">)</span>
</code></pre></div><p>æ¬§å‡ é‡Œå¾—è·ç¦»:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@a</span> <span class="ow">Z</span><span class="o">-</span> <span class="nv">@b</span>
</code></pre></div><p>Squared(å¹³æ–¹)</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">(</span><span class="nv">@a</span> <span class="ow">Z</span><span class="o">-</span> <span class="nv">@b</span><span class="p">)</span><span class="o">Â»</span>Â²
</code></pre></div><p>Summed(æ±‚å’Œ)</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">[+]</span> <span class="p">(</span><span class="nv">@a</span> <span class="ow">Z</span><span class="o">-</span> <span class="nv">@b</span><span class="p">)</span><span class="o">Â»</span>Â²
</code></pre></div><p>Square root(æ±‚å¹³æ–¹æ ¹)</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">sqrt</span> <span class="o">[+]</span> <span class="p">(</span><span class="nv">@a</span> <span class="ow">Z</span><span class="o">-</span> <span class="nv">@b</span><span class="p">)</span><span class="o">Â»</span>Â²
</code></pre></div><h2 id="smartmatchæ™ºèƒ½åŒ¹é…">Smartmatch(æ™ºèƒ½åŒ¹é…)</h2>
<p>â€œIs the value part of this setâ€</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@list</span><span class="o">.</span><span class="nb">grep</span><span class="p">(</span><span class="o">*</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span>
<span class="nv">@list</span><span class="o">.</span><span class="nb">grep</span><span class="p">({</span> <span class="nv">$_</span> <span class="ow">eq</span> <span class="p">&#34;</span><span class="s2">foo</span><span class="p">&#34;</span> <span class="p">})</span>
<span class="nv">@list</span><span class="o">.</span><span class="nb">grep</span><span class="p">(</span><span class="nb">Int</span><span class="p">)</span>
<span class="nv">@list</span><span class="o">.</span><span class="nb">grep</span><span class="p">({</span> <span class="o">.</span><span class="nb">isa</span><span class="p">(</span><span class="n">Innt</span><span class="p">)</span> <span class="p">})</span>
<span class="nv">@list</span><span class="o">.</span><span class="nb">grep</span><span class="p">(/</span><span class="sr">foo </span><span class="ni">.</span><span class="o">*</span><span class="sr"> bar</span><span class="p">/)</span>
<span class="nv">@list</span><span class="o">.</span><span class="nb">grep</span><span class="p">({</span> <span class="o">.</span><span class="nb">match</span><span class="p">(/</span><span class="sr">foo </span><span class="ni">.</span><span class="o">*</span><span class="sr"> bar</span><span class="p">/)</span> <span class="p">})</span>
<span class="nv">@list</span><span class="o">.</span><span class="nb">grep</span><span class="p">(</span><span class="mi">2</span><span class="o">..</span><span class="mi">4</span><span class="p">)</span>
<span class="nv">@list</span><span class="o">.</span><span class="nb">grep</span><span class="p">({</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="nv">$_</span> <span class="o">&lt;=</span> <span class="mi">4</span> <span class="p">})</span>

<span class="nv">@list</span><span class="o">.</span><span class="nb">grep</span><span class="p">(:</span><span class="s">is-prime</span><span class="p">)</span>
<span class="nv">@list</span><span class="o">.</span><span class="nb">grep</span><span class="p">({</span> <span class="o">.</span><span class="nb">is-prime</span> <span class="p">})</span>
</code></pre></div><p>combine junctions(ç»“åˆ Junctions):</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">@list</span><span class="o">.</span><span class="nb">grep</span><span class="p">(:</span><span class="s">is-prime</span> <span class="o">&amp;</span> <span class="o">/</span><span class="mi">22</span><span class="o">/</span><span class="p">)</span>
<span class="nv">@list</span><span class="o">.</span><span class="nb">grep</span><span class="p">({</span> <span class="o">.</span><span class="nb">is-prime</span> <span class="o">&amp;&amp;</span> <span class="o">.</span><span class="nf">matches</span><span class="p">(/</span><span class="mi">22</span><span class="p">/)</span> <span class="p">})</span>

<span class="nv">@list</span><span class="o">.</span><span class="nb">grep</span><span class="p">(</span><span class="nb">none</span><span class="p">(/</span><span class="mi">22</span><span class="p">/))</span>
<span class="nv">@list</span><span class="o">.</span><span class="nb">grep</span><span class="p">({</span> <span class="o">!.</span><span class="nf">matches</span><span class="p">(/</span><span class="mi">22</span><span class="p">/)</span> <span class="p">})</span>
</code></pre></div><p>æœ€å, è¿˜æ˜¯æŸ¥æ‰¾æ–‡ä»¶çš„ä¾‹å­:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">find</span><span class="p">(</span><span class="nv">@dirs</span><span class="o">,</span>
  <span class="p">:</span><span class="s">ext</span><span class="p">(&#39;</span><span class="s1">rakumo</span><span class="p">&#39;</span><span class="o">|</span><span class="p">&#39;</span><span class="s1">pm6</span><span class="p">&#39;)</span><span class="o">,</span>
  <span class="p">:</span><span class="s">size</span><span class="p">(</span><span class="o">*</span> <span class="o">&gt;</span> <span class="mi">1024</span><span class="p">)</span><span class="o">,</span>
  <span class="p">:</span><span class="s">depth</span><span class="p">(</span><span class="mi">3</span><span class="o">..</span><span class="mi">5</span><span class="p">)</span><span class="o">,</span>
  <span class="p">:</span><span class="s">contains</span><span class="p">(/</span><span class="sr">raku</span><span class="p">/)</span>
<span class="p">);</span>
</code></pre></div><p>åŸæ–‡é“¾æ¥: <a href="https://www.youtube.com/watch?v=elalwvfmYgk">https://www.youtube.com/watch?v=elalwvfmYgk</a></p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/raku" term="raku" label="Raku" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Raku Multiple Dispatch With the New MoarVM Dispatcher]]></title>
            <link href="https://ohmyweekly.github.io/notes/2021-04-15-raku-multiple-dispatch-with-the-new-moarvm-dispatcher/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2021-05-19-a-tour-of-rust-standard-library-traits/?utm_source=atom_feed" rel="related" type="text/html" title="Rust çš„æ ‡å‡†åº“ Trait ä¹‹æ—…" />
                <link href="https://ohmyweekly.github.io/notes/2021-04-05-psql/?utm_source=atom_feed" rel="related" type="text/html" title="Psql" />
                <link href="https://ohmyweekly.github.io/notes/2021-03-15-towards-a-new-general-dispatch-mechanism-in-moarvm/?utm_source=atom_feed" rel="related" type="text/html" title="äº‰å–åœ¨ MoarVM ä¸­å»ºç«‹ä¸€ä¸ªæ–°çš„æ€»è°ƒåº¦æœºåˆ¶" />
                <link href="https://ohmyweekly.github.io/notes/2021-03-07-difference-between-build-and-tweak-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="BUILD å’Œ TWEAK çš„åŒºåˆ«" />
                <link href="https://ohmyweekly.github.io/notes/2021-03-01-how-to-type-unicode-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="å¦‚ä½•åœ¨ Raku ä¸­è¾“å…¥ Unicode" />
            
                <id>https://ohmyweekly.github.io/notes/2021-04-15-raku-multiple-dispatch-with-the-new-moarvm-dispatcher/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-04-15T00:00:00+08:00</published>
            <updated>2021-04-15T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Raku Multiple Dispatch With the New Moarvm Dispatcher</blockquote><p>æˆ‘æœ€è¿‘å†™äº†ä¸€ç¯‡å…³äº<a href="https://ohmyweekly.github.io/notes/2021-03-15-towards-a-new-general-dispatch-mechanism-in-moarvm/">æ–°çš„ MoarVM è°ƒåº¦æœºåˆ¶</a>çš„æ–‡ç« ï¼Œå¹¶åœ¨é‚£ç¯‡æ–‡ç« ä¸­æŒ‡å‡ºï¼Œæˆ‘åœ¨ Raku çš„å¤šé‡åˆ†æ´¾è¯­ä¹‰æ–¹é¢è¿˜æœ‰ä¸å°‘éœ€è¦å®ç°çš„åœ°æ–¹ã€‚ä»é‚£ä»¥åï¼Œæˆ‘åœ¨è¿™ä¸ªæ–¹å‘ä¸Šå–å¾—äº†ä¸å°çš„è¿›å±•ã€‚è¿™ç¯‡æ–‡ç« åŒ…å«äº†å¯¹æ‰€é‡‡å–çš„æ–¹æ³•çš„æ¦‚è¿°ï¼Œä»¥åŠä¸€äº›éå¸¸ç²—ç•¥çš„æ€§èƒ½æµ‹é‡ã€‚</p>
<h2 id="æˆ‘çš„å¤©å•Šè¯­ä¹‰å¤ªå¤šäº†">æˆ‘çš„å¤©å•Šï¼Œè¯­ä¹‰å¤ªå¤šäº†</h2>
<p>åœ¨ Raku çš„æ‰€æœ‰åˆ†æ´¾ä¸­ï¼Œå¤šé‡åˆ†æ´¾æ˜¯æœ€å¤æ‚çš„ã€‚å¤šé‡åˆ†æ´¾å…è®¸æˆ‘ä»¬å†™ä¸€ç»„å€™é€‰è€…ï¼Œç„¶åæ ¹æ®å‚æ•°çš„æ•°é‡è¿›è¡Œé€‰æ‹©ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="nb">ok</span><span class="p">(</span><span class="nv">$condition</span><span class="o">,</span> <span class="nv">$desc</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">(</span><span class="nv">$condition</span> <span class="o">??</span> <span class="p">&#39;</span><span class="s1">ok</span><span class="p">&#39;</span> <span class="o">!!</span> <span class="p">&#39;</span><span class="s1">not ok</span><span class="p">&#39;)</span> <span class="o">~</span> <span class="p">&#34;</span><span class="s2"> - </span><span class="nv">$desc</span><span class="p">&#34;;</span>
<span class="p">}</span>
<span class="k">multi</span> <span class="nb">ok</span><span class="p">(</span><span class="nv">$condition</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">ok</span><span class="p">(</span><span class="nv">$condition</span><span class="o">,</span> <span class="p">&#39;&#39;);</span>
<span class="p">}</span>
</code></pre></div><p>æˆ–æ ¹æ®å‚æ•°çš„ç±»å‹:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="nf">to-json</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$i</span><span class="p">)</span> <span class="p">{</span> <span class="o">~</span><span class="nv">$i</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nf">to-json</span><span class="p">(</span><span class="nb">Bool</span> <span class="nv">$b</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$b</span> <span class="o">??</span> <span class="p">&#39;</span><span class="s1">true</span><span class="p">&#39;</span> <span class="o">!!</span> <span class="p">&#39;</span><span class="s1">false</span><span class="p">&#39;</span> <span class="p">}</span>
</code></pre></div><p>è€Œä¸”ä¸åªæ˜¯ä¸€ä¸ªå‚æ•°ï¼Œè€Œæ˜¯å¯èƒ½æœ‰å¾ˆå¤šå‚æ•°:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="nb">truncate</span><span class="p">(</span><span class="nb">Str</span> <span class="nv">$str</span><span class="o">,</span> <span class="nb">Int</span> <span class="nv">$chars</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$str</span><span class="o">.</span><span class="nb">chars</span> <span class="o">&lt;</span> <span class="nv">$chars</span> <span class="o">??</span> <span class="nv">$str</span> <span class="o">!!</span> <span class="nv">$str</span><span class="o">.</span><span class="nb">substr</span><span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="nv">$chars</span><span class="p">)</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">...</span><span class="p">&#39;</span>
<span class="p">}</span>

<span class="k">multi</span> <span class="nb">truncate</span><span class="p">(</span><span class="nb">Str</span> <span class="nv">$str</span><span class="o">,</span> <span class="nb">Str</span> <span class="nv">$after</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">with</span> <span class="nv">$str</span><span class="o">.</span><span class="nb">index</span><span class="p">(</span><span class="nv">$after</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nv">$pos</span> <span class="p">{</span>
        <span class="nv">$str</span><span class="o">.</span><span class="nb">substr</span><span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="nv">$pos</span><span class="p">)</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">...</span><span class="p">&#39;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$str</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>æˆ‘ä»¬å¯ä»¥æ·»åŠ  <code>where</code> å­å¥æ¥åŒºåˆ†æ™®é€šç±»å‹æ— æ³•æ•æ‰çš„å±æ€§ä¸Šçš„å€™é€‰è€…ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="nf">fac</span><span class="p">(</span><span class="nv">$n</span> <span class="k">where</span> <span class="nv">$n</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="mi">1</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nf">fac</span><span class="p">(</span><span class="nv">$n</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$n</span> <span class="o">*</span> <span class="nf">fac</span><span class="p">(</span><span class="nv">$n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">}</span>
</code></pre></div><p>æ¯å½“æˆ‘ä»¬å†™å‡ºä¸€ç»„è¿™æ ·çš„ <code>multi</code> å€™é€‰åˆ—è¡¨æ—¶ï¼Œç¼–è¯‘å™¨å°±ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª <code>proto</code> ä¾‹ç¨‹ã€‚è¿™å°±æ˜¯å®‰è£…åœ¨ç¬¦å·è¡¨ä¸­çš„ï¼Œå­˜æ”¾å€™é€‰åˆ—è¡¨çš„ä¸œè¥¿ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å†™è‡ªå·±çš„ <code>proto</code>ï¼Œå¹¶ä½¿ç”¨ç‰¹æ®Šçš„æœ¯è¯­ <code>{*}</code> æ¥å†³å®šåœ¨å“ªä¸€ç‚¹ä¸Šè¿›è¡Œè°ƒåº¦ï¼Œå¦‚æœæœ‰çš„è¯ã€‚</p>
<pre><code class="language-rakuu" data-lang="rakuu">proto mean($collection) {
    $collection.elems == 0 ?? Nil !! {*}
}

multi mean(@arr) {
    @arr.sum / @arr.elems
}

multi mean(%hash) {
    %hash.values.sum / %hash.elems
}
</code></pre><p>å€™é€‰è€…æŒ‰çª„åº¦æ’åºï¼ˆä½¿ç”¨æ‹“æ‰‘æ’åºï¼‰ã€‚å¦‚æœå¤šä¸ªå€™é€‰è€…åŒ¹é…ï¼Œä½†å®ƒä»¬çª„åº¦ç›¸åŒï¼Œé‚£ä¹ˆè¿™å°±æ˜¯ä¸€ä¸ªæ­§ä¹‰é”™è¯¯ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬è°ƒç”¨æœ€çª„çš„ä¸€ä¸ªã€‚ç„¶åï¼Œæˆ‘ä»¬é€‰æ‹©çš„å€™é€‰è€…å¯èƒ½ä¼šä½¿ç”¨ <code>callsame</code> å’Œå®ƒçš„æœ‹å‹ä»¬æ¥æ¨è¿Ÿåˆ°ä¸‹ä¸€ä¸ªæœ€çª„çš„å€™é€‰è€…ï¼Œåè€…å¯èƒ½ä¹Ÿä¼šè¿™æ ·åšï¼Œç›´åˆ°æˆ‘ä»¬è¾¾åˆ°æœ€ä¸€èˆ¬çš„åŒ¹é…çš„å€™é€‰è€…ã€‚</p>
<h2 id="å¤šé‡åˆ†æ´¾æ— å¤„ä¸åœ¨">å¤šé‡åˆ†æ´¾æ— å¤„ä¸åœ¨</h2>
<p>Raku åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–äºå¤šé‡åˆ†æ´¾ã€‚Raku ä¸­çš„å¤§å¤šæ•°æ“ä½œç¬¦éƒ½è¢«ç¼–è¯‘æˆå¯¹å¤šé‡åˆ†æ´¾å­ç¨‹åºçš„è°ƒç”¨ã€‚å³ä½¿æ˜¯ <code>$a+$b</code> ä¹Ÿä¼šæ˜¯ä¸€ä¸ªå¤šé‡åˆ†æ´¾ã€‚è¿™æ„å‘³ç€é«˜æ•ˆåœ°è¿›è¡Œå¤šé‡åˆ†æ´¾å¯¹æ€§èƒ½çœŸçš„å¾ˆé‡è¦ã€‚è€ƒè™‘åˆ°å…¶è¯­ä¹‰çš„ä¸°å¯Œæ€§ï¼Œè¿™æœ‰å¯èƒ½æœ‰ç‚¹ä»¤äººæ‹…å¿§ã€‚ä¸è¿‡ï¼Œä¹Ÿæœ‰å¥½æ¶ˆæ¯ã€‚</p>
<h2 id="å¤§å¤šæ•°å¤šé‡è°ƒåº¦éƒ½å¾ˆæ— èŠ">å¤§å¤šæ•°å¤šé‡è°ƒåº¦éƒ½å¾ˆæ— èŠ</h2>
<p>æˆ‘ä»¬é‡åˆ°çš„ç»å¤§å¤šæ•°æƒ…å†µæ˜¯:</p>
<ul>
<li>ä¸€ä¸ªä»…ç”±å‚æ•°å’Œåä¹‰ç±»å‹çš„æ•°é‡æ‰€åšçš„å†³å®šã€‚</li>
<li>æ—  where å­å¥</li>
<li>æ— è‡ªå®šä¹‰ proto</li>
<li>æ—  callsame</li>
</ul>
<p>è¿™å¹¶ä¸æ˜¯è¯´å…¶ä»–æƒ…å†µä¸é‡è¦ï¼Œå®ƒä»¬ç¡®å®ç›¸å½“æœ‰ç”¨ï¼Œè€Œä¸”å®ƒä»¬çš„è¡¨ç°ä¹Ÿæ˜¯å¯å–çš„ã€‚ä¸è¿‡ï¼Œåœ¨æ™®é€šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬èƒ½çœåˆ™çœï¼Œä¹Ÿæ˜¯å¯å–çš„ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›æ€¥äºè®¡ç®—æ¯ä¸€ä¸ªå•æ¬¡å¤šé‡è°ƒåº¦çš„å…¨éƒ¨å¯èƒ½çš„å€™é€‰è€…ï¼Œå› ä¸ºå¤§å¤šæ•°æ—¶å€™åªæœ‰ç¬¬ä¸€ä¸ªæ‰æ˜¯é‡è¦çš„ã€‚è¿™ä¸ä»…ä»…æ˜¯æ—¶é—´ä¸Šçš„é—®é¢˜ï¼šå›æƒ³ä¸€ä¸‹ï¼Œæ–°çš„è°ƒåº¦æœºåˆ¶ä¼šåœ¨æ¯ä¸ªè°ƒç”¨ç‚¹å­˜å‚¨è°ƒåº¦ç¨‹åºï¼Œå¦‚æœæˆ‘ä»¬åœ¨æ¯ä¸ªè°ƒç”¨ç‚¹å­˜å‚¨æ‰€æœ‰åŒ¹é…çš„å€™é€‰ç¨‹åºåˆ—è¡¨ï¼Œæˆ‘ä»¬ä¹Ÿä¼šæµªè´¹å¾ˆå¤šå†…å­˜ã€‚</p>
<h2 id="æˆ‘ä»¬ä»Šå¤©æ€ä¹ˆåš">æˆ‘ä»¬ä»Šå¤©æ€ä¹ˆåšï¼Ÿ</h2>
<p>å¦‚ä»Š Rakuo çš„æƒ…å†µå¦‚ä¸‹:</p>
<ul>
<li>
<p>å¦‚æœè°ƒåº¦åªç”±å…ƒæ•°å’Œåä¹‰ç±»å‹å†³å®šï¼Œå¹¶ä¸”ä½ ä¸ä½¿ç”¨æ‰å¹³åŒ–çš„å‚æ•°æ¥è°ƒç”¨å®ƒï¼Œå®ƒå¯èƒ½ä¼šè¡¨ç°å¾—å¾ˆå¥½ï¼Œç”šè‡³å¯èƒ½ä¼šäº«å—åˆ°å€™é€‰è€…çš„å†…è”å’Œæ¶ˆé™¤åœ¨æ…¢é€Ÿè·¯å¾„ä¸Šå‘ç”Ÿçš„é‡å¤ç±»å‹æ£€æŸ¥ã€‚è¿™è¦å½’åŠŸäº proto æŒæœ‰ä¸€ä¸ª &ldquo;dispatch cache&rdquo;ï¼Œè¿™æ˜¯ä¸€ä¸ªåœ¨ VM ä¸­å®ç°çš„ç‰¹ä¾‹æœºåˆ¶ï¼Œå®ƒä½¿ç”¨æœç´¢æ ‘ï¼Œæ¯ä¸ªå‚æ•°æœ‰ä¸€ä¸ªçº§åˆ«ã€‚</p>
</li>
<li>
<p>å¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œä½†å®ƒæœ‰ä¸€ä¸ªè‡ªå®šä¹‰çš„ protoï¼Œä¹Ÿä¸ä¼šå¤ªå·®ï¼Œè™½ç„¶ä¸ä¼šå‘ç”Ÿå†…è”ï¼Œå®ƒä»ç„¶å¯ä»¥ä½¿ç”¨æœç´¢æ ‘ã€‚</p>
</li>
<li>
<p>å¦‚æœå®ƒä½¿ç”¨ <code>where</code> å­å¥ï¼Œé€Ÿåº¦ä¼šå¾ˆæ…¢ï¼Œå› ä¸ºæœç´¢æ ‘åªå¤„ç†åœ¨æ¯ä¸€ä¸ªåä¹‰ç±»å‹é›†åˆä¸­æ‰¾åˆ°ä¸€ä¸ªå€™é€‰è€…ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨å®ƒã€‚</p>
</li>
<li>
<p>åŒæ ·çš„é“ç†ä¹Ÿé€‚ç”¨äº <code>callsame</code>ï¼Œå®ƒçš„é€Ÿåº¦ä¹Ÿä¼šå¾ˆæ…¢ã€‚</p>
</li>
</ul>
<p>å®é™…ä¸Šï¼Œä»Šå¤©çš„æƒ…å†µæ˜¯ï¼Œå¦‚æœåœ¨çƒ­è·¯å¾„é™„è¿‘çš„ä»»ä½•åœ°æ–¹ï¼Œä½ æ ¹æœ¬ä¸ä¼šåœ¨å¤šé‡è°ƒåº¦ä¸­ä½¿ç”¨ <code>where</code>å­å¥ï¼ˆå¥½å§ï¼Œå¦‚æœä½ çŸ¥é“çƒ­è·¯å¾„åœ¨å“ªé‡Œï¼Œå¹¶ä¸”çŸ¥é“è¿™ç§è°ƒåº¦å¾ˆæ…¢ï¼‰ã€‚åŒç†ï¼Œ<code>callsame</code> ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œè™½ç„¶é‚£ä¸å¤ªå¸¸è§¦è¾¾ã€‚é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½ç”¨æ–°çš„è°ƒåº¦å™¨åšå¾—æ›´å¥½ï¼Ÿ</p>
<h2 id="å®ˆå«ç±»å‹">å®ˆå«ç±»å‹</h2>
<p>æˆ‘ä»¬å…ˆçœ‹çœ‹æœ€ç®€å•çš„æƒ…å†µæ˜¯å¦‚ä½•å¤„ç†çš„ï¼Œç„¶åå†ä»é‚£é‡Œå¼€å§‹å»ºç«‹ã€‚(è¿™å…¶å®æ˜¯æˆ‘åœ¨å®ç°ä¸Šçš„åšæ³•ï¼Œä½†åŒæ—¶æˆ‘ä¹Ÿæœ‰ä¸€ä¸ªå¤§æ¦‚çš„æƒ³æ³•ï¼Œæˆ‘å¸Œæœ›æœ€ç»ˆçš„ç»“æœæ˜¯ä»€ä¹ˆ)ã€‚</p>
<p>å›å¿†ä¸€ä¸‹è¿™å¯¹å€™é€‰è€…ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="nb">truncate</span><span class="p">(</span><span class="nb">Str</span> <span class="nv">$str</span><span class="o">,</span> <span class="nb">Int</span> <span class="nv">$chars</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$str</span><span class="o">.</span><span class="nb">chars</span> <span class="o">&lt;</span> <span class="nv">$chars</span> <span class="o">??</span> <span class="nv">$str</span> <span class="o">!!</span> <span class="nv">$str</span><span class="o">.</span><span class="nb">substr</span><span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="nv">$chars</span><span class="p">)</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">...</span><span class="p">&#39;</span>
<span class="p">}</span>

<span class="k">multi</span> <span class="nb">truncate</span><span class="p">(</span><span class="nb">Str</span> <span class="nv">$str</span><span class="o">,</span> <span class="nb">Str</span> <span class="nv">$after</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">with</span> <span class="nv">$str</span><span class="o">.</span><span class="nb">index</span><span class="p">(</span><span class="nv">$after</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nv">$pos</span> <span class="p">{</span>
        <span class="nv">$str</span><span class="o">.</span><span class="nb">substr</span><span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="nv">$pos</span><span class="p">)</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">...</span><span class="p">&#39;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$str</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>ç„¶åæˆ‘ä»¬æœ‰ä¸€ä¸ªè°ƒç”¨ <code>truncate($message, &quot;\n&quot;)</code>ï¼Œå…¶ä¸­ <code>$message</code> æ˜¯ <code>Str</code> ç±»å‹çš„ã€‚åœ¨æ–°çš„è°ƒåº¦æœºåˆ¶ä¸‹ï¼Œè°ƒç”¨æ˜¯ä½¿ç”¨ <code>raku-call</code> dispatcher è¿›è¡Œçš„ï¼Œå®ƒè¯†åˆ«å‡ºè¿™æ˜¯ä¸€ä¸ª <code>multi</code> æ–¹æ³•è°ƒåº¦ï¼Œå› æ­¤å§”æ‰˜ç»™ <code>raku-multi</code>ã€‚(<code>multi</code> æ–¹æ³•è°ƒåº¦ä¹Ÿä¼šåœ¨é‚£é‡Œç»“æŸ)ã€‚</p>
<p>è°ƒåº¦çš„è®°å½•é˜¶æ®µ - åœ¨æˆ‘ä»¬ç¬¬ä¸€æ¬¡åˆ°è¾¾è¿™ä¸ªè°ƒç”¨ç‚¹æ—¶ - å°†è¿›è¡Œå¦‚ä¸‹æ“ä½œã€‚</p>
<ol>
<li>è¿­ä»£å€™é€‰è€…</li>
<li>å¦‚æœæŸä¸ªå€™é€‰è€…åœ¨å‚æ•°æ•°ä¸Šä¸åŒ¹é…ï¼Œå°±ç›´æ¥ä¸¢å¼ƒå®ƒã€‚ç”±äº <code>callsite</code> çš„å½¢çŠ¶æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œè€Œä¸”æˆ‘ä»¬åœ¨æ¯ä¸ª <code>callsite</code> éƒ½ä¼šè®¡ç®— dispatch ç¨‹åºï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦ä¸ºæ­¤å»ºç«‹ä»»ä½•é˜²æŠ¤æªæ–½ã€‚</li>
<li>å¦‚æœåœ¨ç±»å‹åŒ¹é…å¹¶ä¸”æˆåŠŸäº†ï¼Œæ³¨æ„æ¶‰åŠå“ªäº›å‚æ•°ï¼Œéœ€è¦ä»€ä¹ˆæ ·çš„å®ˆå«ã€‚</li>
<li>å¦‚æœæ²¡æœ‰åŒ¹é…æˆ–è€…æ¨¡æ£±ä¸¤å¯ï¼Œå°±æŠ¥é”™ï¼Œä¸äº§ç”Ÿè°ƒåº¦ç¨‹åºã€‚</li>
<li>å¦åˆ™ï¼Œåœ¨ç¡®å®šäº†ç±»å‹å®ˆå«åï¼Œå°†é€‰å®šçš„å€™é€‰ç¨‹åºå§”æ‰˜ç»™ <code>raku-invoke</code> è°ƒåº¦ç¨‹åºã€‚</li>
</ol>
<p>å½“æˆ‘ä»¬å†æ¬¡åˆ°è¾¾åŒä¸€ä¸ªè°ƒç”¨ç‚¹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œè°ƒåº¦ç¨‹åºï¼Œå®ƒå¯ä»¥å¿«é€Ÿæ£€æŸ¥å‚æ•°ç±»å‹æ˜¯å¦ä¸ä¸Šæ¬¡çœ‹åˆ°çš„å‚æ•°ç±»å‹ç›¸åŒ¹é…ï¼Œå¦‚æœç›¸åŒ¹é…ï¼Œæˆ‘ä»¬å°±çŸ¥é“è¦è°ƒç”¨å“ªä¸ªå€™é€‰ç¨‹åºã€‚è¿™äº›æ£€æŸ¥éå¸¸ä¾¿å®œ - æ¯”éå†æ‰€æœ‰å€™é€‰è€…å¹¶æ£€æŸ¥æ¯ä¸ªå€™é€‰è€…æ˜¯å¦åŒ¹é…è¦ä¾¿å®œå¾—å¤šã€‚ä¼˜åŒ–å™¨ä»¥åå¯èƒ½ä¼šè¯æ˜è¿™äº›æ£€æŸ¥æ€»æ˜¯ä¼šæˆä¸ºäº‹å®ï¼Œå¹¶æ¶ˆé™¤å®ƒä»¬ã€‚</p>
<p>å› æ­¤ï¼Œæ•´ä¸ªè°ƒåº¦è¿‡ç¨‹ - è‡³å°‘å¯¹äºè¿™ä¸ªæˆ‘ä»¬åªæœ‰ç±»å‹å’Œå…ƒæ•°çš„ç®€å•æ¡ˆä¾‹ - å¯ä»¥å‘è™šæ‹Ÿæœº &ldquo;è§£é‡Š&rdquo; ä¸º &ldquo;å¦‚æœå‚æ•°å…·æœ‰è¿™äº›ç¡®åˆ‡çš„ç±»å‹ï¼Œå°±è°ƒç”¨è¿™ä¸ªä¾‹ç¨‹&rdquo;ã€‚è¿™å’Œæˆ‘ä»¬å¯¹æ–¹æ³•åˆ†æ´¾æ‰€åšçš„å·®ä¸å¤šï¼Œé™¤äº†æˆ‘ä»¬åªå…³å¿ƒç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ - è°ƒç”¨è€… - å’Œæ–¹æ³•åçš„å€¼ã€‚(è¿˜è®°å¾—ä¸Šä¸€ç¯‡æ–‡ç« ä¸­è¯´è¿‡ï¼Œå¦‚æœæ˜¯ <code>multi</code> æ–¹æ³•è°ƒåº¦ï¼Œé‚£ä¹ˆæ–¹æ³•è°ƒåº¦å’Œ <code>multi</code> æ–¹æ³•è°ƒåº¦éƒ½ä¼šå®ˆæŠ¤ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ï¼Œä½†æ˜¯æ¶ˆé™¤äº†é‡å¤ï¼Œæ‰€ä»¥åªåšä¸€æ¬¡æ£€æŸ¥)ã€‚</p>
<h2 id="è¿™å°±è¿›å…¥äº†æ¢å¤ä¹‹æ´">è¿™å°±è¿›å…¥äº†æ¢å¤ä¹‹æ´</h2>
<p>æƒ³å‡ºå¥½çš„æŠ½è±¡æ˜¯å¾ˆéš¾çš„ï¼Œæ–°çš„è°ƒåº¦æœºåˆ¶çš„å¾ˆå¤šæŒ‘æˆ˜å°±åœ¨äºæ­¤ã€‚Raku æœ‰ä¸å°‘ä¸åŒçš„ç±»ä¼¼è°ƒåº¦çš„ä¸œè¥¿ã€‚ç„¶è€Œï¼Œå°†å®ƒä»¬å…¨éƒ¨ç›´æ¥ç¼–ç åœ¨è™šæ‹Ÿæœºä¸­ä¼šå¯¼è‡´å¾ˆé«˜çš„å¤æ‚åº¦ï¼Œè¿™ä½¿å¾—æ„å»ºå¯é çš„ä¼˜åŒ–ï¼ˆç”šè‡³æ˜¯å¯é çš„æœªä¼˜åŒ–çš„å®ç°ï¼ï¼‰å…·æœ‰æŒ‘æˆ˜æ€§ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ç ”ç©¶å‡ºä¸€å¥—ç›¸å¯¹è¾ƒå°çš„åŸè¯­ï¼Œå…è®¸ä»¥è¿™æ ·ä¸€ç§æ–¹å¼å‘è™šæ‹Ÿæœº &ldquo;è§£é‡Š&rdquo; è°ƒåº¦ï¼Œä½¿å…¶èƒ½å¤Ÿæä¾›ä¸é”™çš„æ€§èƒ½ã€‚</p>
<p>å¾ˆæ˜æ˜¾ï¼Œ<code>callsame</code> æ˜¯ä¸€ç§è°ƒåº¦æ¢å¤ï¼Œä½†è‡ªå®šä¹‰ proto è¿™ç§æƒ…å†µå’Œ <code>where</code> å­å¥è¿™ç§æƒ…å†µå‘¢ï¼Ÿäº‹å®è¯æ˜ï¼Œè¿™äº›ä¹Ÿéƒ½å¯ä»¥ç”¨è°ƒåº¦æ¢å¤çš„æ–¹å¼æ•´é½åœ°è¡¨è¾¾å‡ºæ¥ï¼ˆ<code>where</code> å­å¥æƒ…å†µéœ€è¦åœ¨è™šæ‹Ÿæœºå±‚é¢å¢åŠ ä¸€ä¸ªå°çš„å†…å®¹ï¼Œåˆ°æ—¶å€™å¯èƒ½å¯¹å…¶ä»–äº‹æƒ…ä¹Ÿæœ‰ç”¨ï¼‰ã€‚ä¸ä»…å¦‚æ­¤ï¼Œç”¨è°ƒåº¦æ¢å¤æ¥ç¼–ç è¿™äº›ç‰¹æ€§ä¹Ÿæ˜¯ç›¸å½“ç›´æ¥çš„ï¼Œå› æ­¤åº”è¯¥æ˜¯é«˜æ•ˆçš„ã€‚æˆ‘ä»¬æ•™ç»™ä¸“é—¨äººå‘˜çš„å…³äºå¦‚ä½•æ›´å¥½åœ°ä½¿ç”¨è°ƒåº¦æ¢å¤çš„æ¯ä¸€ä¸ªæŠ€å·§ï¼Œéƒ½å¯ä»¥è®©æ‰€æœ‰ä½¿ç”¨å®ƒä»¬å®ç°çš„è¯­è¨€ç‰¹æ€§ä¹Ÿå—ç›Šã€‚</p>
<h2 id="è‡ªå®šä¹‰-proto">è‡ªå®šä¹‰ proto</h2>
<p>å›é¡¾è¿™ä¸ªä¾‹å­ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">proto</span> <span class="nf">mean</span><span class="p">(</span><span class="nv">$collection</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$collection</span><span class="o">.</span><span class="nb">elems</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">??</span> <span class="nb">Nil</span> <span class="o">!!</span> <span class="p">{</span><span class="o">*</span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¸Œæœ›è¿è¡Œ proto çš„ä¸»ä½“ï¼Œç„¶ååœ¨ <code>{*}</code> è¿™é‡Œè¿›è¡Œå€™é€‰è€…çš„é€‰æ‹©ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œå½“æˆ‘ä»¬æ²¡æœ‰è‡ªå®šä¹‰çš„ proto æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›ç®€å•åœ°ç»§ç»­è°ƒç”¨æ­£ç¡®çš„å¤šã€‚</p>
<p>ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œæˆ‘é¦–å…ˆå°† <code>multi</code> å€™é€‰è€…çš„é€‰æ‹©é€»è¾‘ä» <code>raku-multi</code> è°ƒåº¦å™¨ç§»åˆ°äº† <code>raku-multi-core</code> è°ƒåº¦å™¨ä¸­ã€‚ç„¶åï¼Œ<code>raku-multi</code> dispatcher ä¼šæ£€æŸ¥æˆ‘ä»¬æ˜¯å¦æœ‰ä¸€ä¸ª &ldquo;onlystar&rdquo; protoï¼ˆä¸€ä¸ªä¸éœ€è¦æˆ‘ä»¬è¿è¡Œçš„ protoï¼‰ã€‚å¦‚æœæœ‰ï¼Œå®ƒå°±ä¼šç«‹å³å§”æ‰˜ç»™ <code>raku-multi-core</code>ã€‚å¦‚æœæ²¡æœ‰ï¼Œå®ƒå°±å°†è°ƒåº¦çš„å‚æ•°ä¿å­˜ä¸ºæ¢å¤åˆå§‹åŒ–çŠ¶æ€ï¼Œç„¶åè°ƒç”¨ protoã€‚proto çš„ <code>{*}</code> è¢«ç¼–è¯‘æˆä¸€ä¸ª dispatch resumptionã€‚ç„¶åï¼Œè¿™ä¸ª resumption å§”æ‰˜ç»™ <code>raku-multi-core</code>ã€‚æˆ–è€…ï¼Œåœ¨ä»£ç ä¸­ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-nqp" data-lang="nqp"><span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-register</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">raku-multi</span><span class="p">&#39;</span><span class="o">,</span>
    <span class="c1"># Initial dispatch, only setting up resumption if we need to invoke the</span>
    <span class="c1"># proto.</span>
    <span class="k">-&gt;</span> <span class="nv">$capture</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">$callee</span> <span class="o">:=</span> <span class="nf">nqp::captureposarg</span><span class="p">(</span><span class="nv">$capture</span><span class="o">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="k">my</span> <span class="nb">int</span> <span class="nv">$onlystar</span> <span class="o">:=</span> <span class="nf">nqp::getattr_i</span><span class="p">(</span><span class="nv">$callee</span><span class="o">,</span> <span class="nb">Routine</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">$!onlystar</span><span class="p">&#39;);</span>
        <span class="k">if</span> <span class="nv">$onlystar</span> <span class="p">{</span>
            <span class="c1"># Don&#39;t need to invoke the proto itself, so just get on with the</span>
            <span class="c1"># candidate dispatch.</span>
            <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-delegate</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">raku-multi-core</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$capture</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="c1"># Set resume init args and run the proto.</span>
            <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-set-resume-init-args</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$capture</span><span class="p">);</span>
            <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-delegate</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">raku-invoke</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$capture</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="o">,</span>
    <span class="c1"># Resumption means that we have reached the {*} in the proto and so now</span>
    <span class="c1"># should go ahead and do the dispatch. Make sure we only do this if we</span>
    <span class="c1"># are signalled to that it&#39;s a resume for an onlystar (resumption kind 5).</span>
    <span class="k">-&gt;</span> <span class="nv">$capture</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">$track_kind</span> <span class="o">:=</span> <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-track-arg</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$capture</span><span class="o">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-guard-literal</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$track_kind</span><span class="p">);</span>
        <span class="k">my</span> <span class="nb">int</span> <span class="nv">$kind</span> <span class="o">:=</span> <span class="nf">nqp::captureposarg_i</span><span class="p">(</span><span class="nv">$capture</span><span class="o">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="k">if</span> <span class="nv">$kind</span> <span class="o">==</span> <span class="mi">5</span> <span class="p">{</span>
            <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-delegate</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">raku-multi-core</span><span class="p">&#39;</span><span class="o">,</span>
                <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-get-resume-init-args</span><span class="p">&#39;));</span>
        <span class="p">}</span>
        <span class="k">elsif</span> <span class="o">!</span><span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-next-resumption</span><span class="p">&#39;)</span> <span class="p">{</span>
            <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-delegate</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">boot-constant</span><span class="p">&#39;</span><span class="o">,</span>
                <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-insert-arg-literal-obj</span><span class="p">&#39;</span><span class="o">,</span>
                    <span class="nv">$capture</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="nb">Nil</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">});</span>
</code></pre></div><h2 id="åˆäºŒä¸ºä¸€">åˆäºŒä¸ºä¸€</h2>
<p>æ¨è¿Ÿåˆ°ä¸‹ä¸€ä¸ªå€™é€‰è€…ï¼ˆä¾‹å¦‚ç”¨ <code>callsame</code>ï¼‰å’Œå› ä¸º <code>where</code> å­å¥å¤±è´¥è€Œå°è¯•ä¸‹ä¸€ä¸ªå€™é€‰è€…çœ‹èµ·æ¥éå¸¸ç›¸ä¼¼ï¼šä¸¤è€…éƒ½æ¶‰åŠéå†ä¸€ä¸ªå¯èƒ½çš„å€™é€‰è€…åˆ—è¡¨ã€‚æœ‰ä¸€äº›ç»†èŠ‚ï¼Œä½†å®ƒä»¬æœ‰å¾ˆå¤šå…±åŒç‚¹ï¼Œå¦‚æœèƒ½åœ¨ä½¿ç”¨æ–°çš„ dispatcher å®ç°å¤šé‡åˆ†æ´¾çš„è¿‡ç¨‹ä¸­ä½“ç°å‡ºæ¥å°±æ›´å¥½äº†ã€‚</p>
<p>åœ¨è¿™ä¹‹å‰ï¼Œå…ˆè¯´ä¸€ä¸ªç•¥æ˜¾å¯æ€•çš„ç»†èŠ‚ï¼Œå½“æˆ‘ä»¬æœ‰ <code>where</code> å­å¥çš„æ—¶å€™ï¼Œä»Šå¤©åœ¨ Rakuo ä¸­æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚é¦–å…ˆï¼Œè°ƒåº¦å™¨ä¼šåšä¸€ä¸ª &ldquo;è¯•ç”¨ç»‘å®š&rdquo;ï¼Œå®ƒé—®ä¸€ä¸ªé—®é¢˜ï¼šè¿™ä¸ªç­¾åä¼šä¸ä¼šç»‘å®šï¼Ÿè¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œå®ƒå¿…é¡»è¯„ä¼°æ‰€æœ‰çš„ <code>where</code> å­å¥ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œå®ƒè¿˜å¿…é¡»ä½¿ç”¨æ…¢è·¯å¾„ç­¾åç»‘å®šå™¨ï¼Œå®ƒå¯¹ç­¾åè¿›è¡Œè§£é‡Šï¼Œå°½ç®¡æˆ‘ä»¬åœ¨å¾ˆå¤šæƒ…å†µä¸‹å¯ä»¥ç¼–è¯‘å®ƒã€‚å¦‚æœå€™é€‰è€…åŒ¹é…ï¼Œå¾ˆå¥½ï¼Œæˆ‘ä»¬é€‰æ‹©å®ƒï¼Œç„¶åè°ƒç”¨å®ƒ&hellip;&hellip;è¿™å°†ç¬¬äºŒæ¬¡è¿è¡Œ <code>where</code> å­å¥ï¼Œä½œä¸ºç¼–è¯‘åçš„ç­¾åç»‘å®šä»£ç çš„ä¸€éƒ¨åˆ†ã€‚è¿™æ ·åšä¸€ç‚¹ä¹Ÿä¸é«˜æ•ˆï¼Œé™¤äº†åœ¨å¼€å‘äººå‘˜çš„æ—¶é—´ä¸Šè¦é«˜æ•ˆå¾—å¤šï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¦è¿™æ ·åšçš„åŸå› ã€‚</p>
<p>æ€»ä¹‹ï¼Œæ¯‹åº¸ç½®ç–‘ï¼Œåœ¨æˆ‘ä½¿ç”¨æ–°çš„è°ƒåº¦å™¨é‡æ–°å®ç°æ—¶ï¼Œæˆ‘ç›¸å½“å¸Œæœ›å°½å¯èƒ½é¿å…è¿™ç§é‡å¤çš„å·¥ä½œå’Œæ…¢è·¯å¾„ç»‘å®šã€‚è€Œä¸”ï¼Œä»¤äººé«˜å…´çš„æ˜¯ï¼Œä¸€ä¸ªå°å°çš„è¡¥å……æä¾›äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚æœ‰ä¸€ä¸ª op <code>assertparamcheck</code>ï¼Œä»»ä½•ç±»å‹çš„å‚æ•°æ£€æŸ¥éƒ½ä¼šè¢«ç¼–è¯‘æˆï¼ˆæ— è®ºæ˜¯ç±»å‹æ£€æŸ¥ã€<code>where</code> å­å¥æ£€æŸ¥ç­‰ï¼‰ï¼Œè¿™å°†è§¦å‘å¯¹ä¸€ä¸ªå‡½æ•°çš„è°ƒç”¨ï¼Œè¯¥å‡½æ•°è·å–å‚æ•°ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯•å›¾è°ƒç”¨çš„ä¸œè¥¿ï¼Œç„¶åå¯ä»¥é€šè¿‡å®ƒä»¬æ¥äº§ç”Ÿé”™è¯¯ä¿¡æ¯ã€‚è¯€çªæ˜¯æä¾›ä¸€ç§è°ƒç”¨ä¾‹ç¨‹çš„æ–¹æ³•ï¼Œä½¿ç»‘å®šå¤±è´¥åï¼Œä¸æ˜¯è°ƒç”¨æŠ¥é”™å‡½æ•°ï¼Œè€Œæ˜¯ç¦»å¼€ä¾‹ç¨‹ï¼Œç„¶ååšä¸€ä¸ªè°ƒåº¦æ¢å¤! è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å°†ä¼ é€’ <code>where</code> å­å¥æ£€æŸ¥å¤±è´¥å˜æˆä¸€ä¸ªè°ƒåº¦æ¢å¤ï¼Œç„¶åä¼šèµ°åˆ°ä¸‹ä¸€ä¸ªå€™é€‰è€…ï¼Œå¹¶ä»£æ›¿å®ƒè¿›è¡Œå°è¯•ã€‚</p>
<h2 id="çç¢vséçç¢">çç¢VSéçç¢</h2>
<p>è¿™è®©æˆ‘ä»¬å¾—åˆ°äº†å¤§éƒ¨åˆ†çš„è§£å†³æ–¹æ³•ï¼Œä½†åœ¨å¸¸è§çš„æƒ…å†µä¸‹ï¼Œä»ç„¶å­˜åœ¨å†…å­˜å’Œæ—¶é—´æ•ˆç‡çš„é—®é¢˜ï¼Œå³æ²¡æœ‰æ¢å¤å’Œæ²¡æœ‰ <code>where</code> å­å¥ã€‚æˆ‘ä¸ºè¿™ç§æƒ…å†µåˆ›é€ äº†ä¸€ä¸ªæœ¯è¯­ &ldquo;trivial multiple dispatch&rdquo;ï¼Œè¿™ä½¿å¾—å…¶ä»–æƒ…å†µå˜å¾— &ldquo;non-trivial&rdquo;ã€‚äº‹å®ä¸Šï¼Œæˆ‘ç”šè‡³åšäº†ä¸€ä¸ªè°ƒåº¦å™¨ï¼Œå«åš <code>raku-multi-non-trivial</code>! æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥ç»“æŸã€‚</p>
<ol>
<li>æœ€åˆå°è¯•å¯»æ‰¾åŒ¹é…çš„å€™é€‰è€…ï¼Œå†³å®šäº†æˆ‘ä»¬å¿…é¡»è€ƒè™‘ <code>where</code> å­å¥ã€‚ä¸€æ—¦æˆ‘ä»¬çœ‹åˆ°æ˜¯è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å°±ä¼šç»§ç»­åˆ¶ä½œä¸€ä¸ªå¯èƒ½åŒ¹é…çš„å€™é€‰è€…çš„å®Œæ•´åˆ—è¡¨ã€‚è¿™æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼ˆåŸå› è§æˆ‘ä¹‹å‰çš„æ–‡ç« ï¼‰ã€‚</li>
<li>æœ€åˆå°è¯•å¯»æ‰¾åŒ¹é…çš„å€™é€‰è€…æ—¶ï¼Œå‘ç°äº†ä¸€ä¸ªå¯ä»¥çº¯ç²¹æ ¹æ®å‚æ•°æ•°å’Œåè¯ç±»å‹æ¥æŒ‘é€‰çš„å€™é€‰è€…ã€‚æˆ‘ä»¬å°±æ­¤åœæ­¢ï¼Œè€Œä¸æ˜¯è¯•å›¾å»ºç«‹ä¸€ä¸ªå®Œæ•´çš„å€™é€‰åˆ—è¡¨ï¼Œå¹¶è¿è¡ŒåŒ¹é…çš„å€™é€‰ã€‚åœ¨ <code>callsame</code> çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æœ€ç»ˆè¿›å…¥çç¢çš„è°ƒåº¦æ¢å¤å¤„ç†ç¨‹åºï¼Œå®ƒ - å› ä¸ºè¿™ç§æƒ…å†µç°åœ¨æ˜¯éçç¢çš„ - å»ºç«‹å®Œæ•´çš„å€™é€‰è€…åˆ—è¡¨ï¼Œä»å®ƒä¸Šé¢å‰ªä¸‹ç¬¬ä¸€é¡¹ï¼ˆå› ä¸ºæˆ‘ä»¬å·²ç»è¿è¡Œäº†é‚£é¡¹ï¼‰ï¼Œç„¶åå§”æ‰˜ç»™ <code>raku-multi-non-trivial</code>ã€‚</li>
</ol>
<p>åœ¨è¿™ä¸ªæè¿°ä¸­å¤±å»äº†å¦ä¸€ä¸ªé‡è¦çš„æ”¹è¿›ï¼šä»Šå¤©ï¼Œå½“æœ‰ <code>where</code> å­å¥æ—¶ï¼Œæˆ‘ä»¬å®Œå…¨å¤±å»äº†ä½¿ç”¨ MoarVM å¤šé‡è°ƒåº¦ç¼“å­˜çš„èƒ½åŠ›ï¼Œä½†åœ¨æ–°çš„è°ƒåº¦å™¨ä¸‹ï¼Œæˆ‘ä»¬åœ¨ <code>callsite</code> å­˜å‚¨äº†ä¸€ä¸ªç±»å‹è¿‡æ»¤çš„å€™é€‰åˆ—è¡¨ï¼Œç„¶åä½¿ç”¨å»‰ä»·çš„ç±»å‹å®ˆå«æ¥æ£€æŸ¥å®ƒæ˜¯å¦æœ‰æ•ˆä½¿ç”¨ã€‚</p>
<h2 id="åˆæ­¥ç»“æœ">åˆæ­¥ç»“æœ</h2>
<p>æˆ‘åšäº†ä¸€äº›åŸºå‡†æµ‹è¯•ï¼Œçœ‹çœ‹æ–°çš„è°ƒåº¦æœºåˆ¶åœ¨ä»Šå¤© Raku å·²çŸ¥çš„å‡ ç§æ¬¡ä¼˜æƒ…å†µä¸‹çš„è¡¨ç°ã€‚è¿™äº›æ•°å­—å¹¶ä¸èƒ½åæ˜ å‡ºä»€ä¹ˆæ˜¯å¯èƒ½çš„ï¼Œå› ä¸ºç›®å‰ä¸“é—¨äººå‘˜å¯¹æ–°çš„è°ƒåº¦å™¨è¿˜æ²¡æœ‰å¤ªå¤šçš„äº†è§£ã€‚ç›¸åï¼Œå®ƒä»¬åæ˜ äº†æˆ‘ä»¬å¯ä»¥æœŸæœ›çš„æœ€å°æ”¹è¿›ã€‚</p>
<p>è€ƒè™‘è¿™ä¸ªåŸºå‡†ï¼Œä½¿ç”¨ä¸€ä¸ªå¸¦æœ‰ <code>where</code> å­å¥çš„ <code>multi</code> æ¥é€’å½’å®ç° factorialã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="nf">fac</span><span class="p">(</span><span class="nv">$n</span> <span class="k">where</span> <span class="nv">$n</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="mi">1</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nf">fac</span><span class="p">(</span><span class="nv">$n</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$n</span> <span class="o">*</span> <span class="nf">fac</span><span class="p">(</span><span class="nv">$n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">}</span>

<span class="k">for</span> <span class="o">^</span><span class="mi">100_000</span> <span class="p">{</span>
    <span class="nf">fac</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="p">}</span>
<span class="nb">say</span> <span class="nb">now</span> <span class="o">-</span> <span class="k">INIT</span> <span class="nb">now</span><span class="p">;</span>
</code></pre></div><p>è¿™éœ€è¦è¿›è¡Œä¸€äº›è°ƒæ•´ï¼ˆå¹¶åœ¨ç¯å¢ƒå˜é‡ä¸‹è¿è¡Œï¼‰ä»¥ä½¿ç”¨æ–°çš„è°ƒåº¦å™¨ï¼›è¿™äº›éƒ½æ˜¯æš‚æ—¶çš„ï¼Œç›´åˆ°æˆ‘å°† Rakudo è½¬æ¢ä¸ºé»˜è®¤ä½¿ç”¨æ–°çš„è°ƒåº¦å™¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-nqp" data-lang="nqp"><span class="k">use</span> <span class="nb">nqp</span><span class="p">;</span>

<span class="k">multi</span> <span class="nf">fac</span><span class="p">(</span><span class="nv">$n</span> <span class="k">where</span> <span class="nv">$n</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="mi">1</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nf">fac</span><span class="p">(</span><span class="nv">$n</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$n</span> <span class="o">*</span> <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">raku-call</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">&amp;fac</span><span class="o">,</span> <span class="nv">$n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">}</span>

<span class="k">for</span> <span class="o">^</span><span class="mi">100_000</span> <span class="p">{</span>
    <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">raku-call</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">&amp;fac</span><span class="o">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="p">}</span>
<span class="nb">say</span> <span class="nb">now</span> <span class="o">-</span> <span class="k">INIT</span> <span class="nb">now</span><span class="p">;</span>
</code></pre></div><p>åœ¨æˆ‘çš„æœºå™¨ä¸Šï¼Œç¬¬ä¸€ä¸ªè¿è¡Œæ—¶é—´ä¸º4.86ç§’ï¼Œç¬¬äºŒä¸ªè¿è¡Œæ—¶é—´ä¸º1.34ç§’ã€‚å› æ­¤ï¼Œåœ¨æ–°çš„è°ƒåº¦å™¨ä¸‹ï¼Œè¿è¡Œæ—¶é—´åªéœ€è¿‡å»çš„å››åˆ†ä¹‹ä¸€å¤šä¸€ç‚¹ - è¿™å·²ç»æ˜¯ä¸€ä¸ªç›¸å½“å¤§çš„æ”¹è¿›äº†ã€‚</p>
<p>ä¸€ä¸ªæ¶‰åŠ <code>callsame</code> çš„æ¡ˆä¾‹ä¹Ÿå¾ˆæœ‰æ„æ€ã€‚è¿™é‡Œæ˜¯æ²¡æœ‰ä½¿ç”¨æ–°è°ƒåº¦å™¨çš„æƒ…å†µã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="nf">fallback</span><span class="p">(</span><span class="nb">Any</span> <span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">a</span><span class="nv">$x</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nf">fallback</span><span class="p">(</span><span class="nb">Numeric</span> <span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">n</span><span class="p">&#34;</span> <span class="o">~</span> <span class="nb">callsame</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nf">fallback</span><span class="p">(</span><span class="nb">Real</span> <span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">r</span><span class="p">&#34;</span> <span class="o">~</span> <span class="nb">callsame</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nf">fallback</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">i</span><span class="p">&#34;</span> <span class="o">~</span> <span class="nb">callsame</span> <span class="p">}</span>

<span class="k">for</span> <span class="o">^</span><span class="mi">1_000_000</span> <span class="p">{</span>
    <span class="nf">fallback</span><span class="p">(</span><span class="mi">4</span><span class="o">+</span><span class="mi">2</span><span class="no">i</span><span class="p">);</span>
    <span class="nf">fallback</span><span class="p">(</span><span class="mf">4.2</span><span class="p">);</span>
    <span class="nf">fallback</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
<span class="p">}</span>   
<span class="nb">say</span> <span class="nb">now</span> <span class="o">-</span> <span class="k">INIT</span> <span class="nb">now</span><span class="p">;</span>
</code></pre></div><p>è€Œé…åˆä¸´æ—¶è°ƒæ•´ä½¿ç”¨æ–°çš„è°ƒåº¦å™¨:</p>
<div class="highlight"><pre class="chroma"><code class="language-nqp" data-lang="nqp"><span class="k">use</span> <span class="nb">nqp</span><span class="p">;</span>

<span class="k">multi</span> <span class="nf">fallback</span><span class="p">(</span><span class="nb">Any</span> <span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">a</span><span class="nv">$x</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nf">fallback</span><span class="p">(</span><span class="nb">Numeric</span> <span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">n</span><span class="p">&#34;</span> <span class="o">~</span> <span class="n">new-disp-callsame</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nf">fallback</span><span class="p">(</span><span class="nb">Real</span> <span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">r</span><span class="p">&#34;</span> <span class="o">~</span> <span class="n">new-disp-callsame</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nf">fallback</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$x</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#34;</span><span class="s2">i</span><span class="p">&#34;</span> <span class="o">~</span> <span class="n">new-disp-callsame</span> <span class="p">}</span>

<span class="k">for</span> <span class="o">^</span><span class="mi">1_000_000</span> <span class="p">{</span>
    <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">raku-call</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">&amp;fallback</span><span class="o">,</span> <span class="mi">4</span><span class="o">+</span><span class="mi">2</span><span class="no">i</span><span class="p">);</span>
    <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">raku-call</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">&amp;fallback</span><span class="o">,</span> <span class="mf">4.2</span><span class="p">);</span>
    <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">raku-call</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">&amp;fallback</span><span class="o">,</span> <span class="mi">42</span><span class="p">);</span>
<span class="p">}</span>
<span class="nb">say</span> <span class="nb">now</span> <span class="o">-</span> <span class="k">INIT</span> <span class="nb">now</span><span class="p">;</span>
</code></pre></div><p>åœ¨æˆ‘çš„æœºå™¨ä¸Šï¼Œç¬¬ä¸€ä¸ªè¿è¡Œæ—¶é—´ä¸º31.3sï¼Œç¬¬äºŒä¸ªè¿è¡Œæ—¶é—´ä¸º11.5sï¼Œè¿™æ„å‘³ç€ä½¿ç”¨æ–°çš„è°ƒåº¦å™¨ï¼Œæˆ‘ä»¬æœ€ç»ˆéœ€è¦çš„æ—¶é—´åªæœ‰å½“å‰ Rakudo çš„ä¸‰åˆ†ä¹‹ä¸€å¤šä¸€ç‚¹ã€‚</p>
<p>è¿™äº›éƒ½æ˜¯ç›¸å½“é¼“èˆäººå¿ƒçš„ï¼Œä½†æ­£å¦‚å‰é¢æåˆ°çš„ï¼Œå¤§éƒ¨åˆ†çš„å¤šé‡è°ƒåº¦éƒ½æ˜¯çç¢çš„é‚£ç§ï¼Œæ²¡æœ‰ä½¿ç”¨è¿™äº›åŠŸèƒ½ã€‚å¦‚æœæˆ‘åœ¨è®©å…¶ä»–äº‹æƒ…å˜å¾—æ›´å¥½çš„è·¯ä¸ŠæŠŠæœ€å¸¸è§çš„æƒ…å†µå˜å¾—æ›´ç³Ÿï¼Œé‚£å°±ä¸å¥½äº†ã€‚ç°åœ¨è¿˜ä¸èƒ½å¯¹æ­¤è¿›è¡Œå…¬å¹³çš„æ¯”è¾ƒï¼šçç¢çš„å¤šé‡åˆ†æ´¾åœ¨ç‰¹åŒ–å™¨ä¸­å·²ç»å—åˆ°äº†å¾ˆå¤šå…³æ³¨ï¼Œè€Œä¸”å®ƒè¿˜ä¸èƒ½å¾ˆå¥½åœ°ä¼˜åŒ–ä½¿ç”¨æ–°è°ƒåº¦å™¨çš„ä»£ç ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿™æ ·çš„ä¾‹å­ä¸­ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">multi</span> <span class="nf">m</span><span class="p">(</span><span class="nb">Int</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nf">m</span><span class="p">(</span><span class="nb">Str</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

<span class="k">for</span> <span class="o">^</span><span class="mi">1_000_000</span> <span class="p">{</span>
    <span class="k">m</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">m</span><span class="p">(&#34;</span><span class="s2">x</span><span class="p">&#34;);</span>
<span class="p">}</span>
<span class="nb">say</span> <span class="nb">now</span> <span class="o">-</span> <span class="k">INIT</span> <span class="nb">now</span><span class="p">;</span>
</code></pre></div><p>å†…åµŒå’Œå…¶ä»–ä¼˜åŒ–ä¼šå°†å…¶å˜æˆä¸€ä¸ªç©ºå¾ªç¯ï¼Œè¿™æ˜¯å¾ˆéš¾åšåˆ°çš„ã€‚ä¸è¿‡æœ‰ä¸€ä»¶äº‹æˆ‘ä»¬å·²ç»å¯ä»¥åšäº†ï¼šåœ¨ç¦ç”¨ specializer çš„æƒ…å†µä¸‹è¿è¡Œå®ƒã€‚æ–°çš„è°ƒåº¦å™¨ç‰ˆæœ¬çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-nqp" data-lang="nqp"><span class="k">use</span> <span class="nb">nqp</span><span class="p">;</span>

<span class="k">multi</span> <span class="nf">m</span><span class="p">(</span><span class="nb">Int</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">multi</span> <span class="nf">m</span><span class="p">(</span><span class="nb">Str</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>

<span class="k">for</span> <span class="o">^</span><span class="mi">1_000_000</span> <span class="p">{</span>
    <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">raku-call</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">&amp;m</span><span class="o">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">raku-call</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">&amp;m</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">x</span><span class="p">&#34;);</span>
<span class="p">}</span>
<span class="nb">say</span> <span class="nb">now</span> <span class="o">-</span> <span class="k">INIT</span> <span class="nb">now</span><span class="p">;</span>
</code></pre></div><p>ç»“æœåˆ†åˆ«æ˜¯0.463så’Œ0.332sã€‚å› æ­¤ï¼ŒåŸºçº¿æ‰§è¡Œæ—¶é—´ - åœ¨ç‰¹åŒ–å™¨å‘æŒ¥å…¶é­”åŠ›ä¹‹å‰ - ä½¿ç”¨æ–°çš„é€šç”¨è°ƒåº¦æœºåˆ¶æ¯”ä½¿ç”¨æˆ‘ä»¬ç›®å‰ä½¿ç”¨çš„ç‰¹åŒ–å¤šé‡è°ƒåº¦ç¼“å­˜è¦å°‘ã€‚åœ¨åšæµ‹é‡ä¹‹å‰ï¼Œæˆ‘ä¸çŸ¥é“è¿™é‡Œä¼šæœ‰ä»€ä¹ˆé¢„æœŸã€‚é‰´äºæˆ‘ä»¬è¦ä»ä¸€ä¸ªå·²ç»è¢«å‰–æå’Œè°ƒæ•´è¿‡çš„ç‰¹åŒ–æœºåˆ¶è½¬åˆ°ä¸€ä¸ªæ²¡æœ‰å—åˆ°å¦‚æ­¤å…³æ³¨çš„æ–°çš„é€šç”¨æœºåˆ¶ï¼Œæˆ‘å·²ç»åšå¥½äº†æœ€åˆåšå¾—å·®ä¸€ç‚¹çš„å‡†å¤‡ï¼Œå¦‚æœèƒ½åšåˆ°å¹³ä»·å°±å¥½äº†ã€‚åœ¨70%çš„æ—¶é—´é‡Œï¼Œè·‘è¿›äº†70%çš„æ—¶é—´ï¼Œè¿™æ¯”æˆ‘é¢„æœŸçš„è¿›æ­¥æ›´å¤§ã€‚</p>
<p>æˆ‘æœŸæœ›ï¼Œä¸€æ—¦ç‰¹åŒ–å™¨æ›´å¥½åœ°ç†è§£æ–°çš„è°ƒåº¦æœºåˆ¶ï¼Œå®ƒä¹Ÿèƒ½æŠŠä¸Šé¢çš„å†…å®¹å˜æˆä¸€ä¸ªç©ºå¾ªç¯ - ä¸è¿‡ï¼Œç”±äºæ¯æ¬¡ä¼˜åŒ–å¯ä»¥è¿›è¡Œæ›´å¤šçš„è¿­ä»£ï¼Œè¿™åº”è¯¥è¿˜æ˜¯è¡¨ç°ä¸ºæ–°è°ƒåº¦å™¨çš„èƒœåˆ©ã€‚</p>
<h2 id="æœ€åçš„æƒ³æ³•">æœ€åçš„æƒ³æ³•</h2>
<p>åªè¦å¢åŠ ä¸€ä¸ªç›¸å¯¹è¾ƒå°çš„åŠŸèƒ½ï¼Œæ–°çš„è°ƒåº¦æœºåˆ¶å·²ç»å¯ä»¥å¤„ç†å¤§éƒ¨åˆ†çš„ Raku å¤šé‡è°ƒåº¦è¯­ä¹‰ã€‚æ­¤å¤–ï¼Œå³ä½¿åœ¨ specializer å’Œ JIT æ²¡æœ‰çœŸæ­£èƒ½å¤Ÿåšå¥½çš„æƒ…å†µä¸‹ï¼Œä¸€äº›å¾®åŸºå‡†å·²ç»æ˜¾ç¤ºå‡º3å€-4å€çš„æå‡ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹ã€‚</p>
<p>åœ¨æˆ‘ä»¬ä½¿ç”¨æ–°çš„è°ƒåº¦å™¨å‡ºè´§ Rakudo ç‰ˆæœ¬ä¹‹å‰ï¼Œè¿˜æœ‰å¾ˆå¤šå·¥ä½œè¦åšã€‚ç„¶è€Œï¼Œå¤šé‡è°ƒåº¦æ˜¯è®¾è®¡ä¸­å‰©ä¸‹çš„æœ€å¤§å¨èƒï¼šå®ƒæ¯”å…¶ä»–ç§ç±»çš„è°ƒåº¦ç›¸å½“å¤šçš„å‚ä¸ï¼Œè€Œä¸”å¾ˆæœ‰å¯èƒ½ä¸€ä¸ªæ„æƒ³ä¸åˆ°çš„ç¼ºç‚¹ä¼šå¼•å‘æ–°ä¸€è½®çš„è®¾è®¡å·¥ä½œï¼Œæˆ–è€…æ­ç¤ºå‡ºä¸€èˆ¬æœºåˆ¶ä¸åŸºçº¿æœªä¼˜åŒ–çš„æƒ…å†µä¸‹, ä¸æ›´ä¸“ä¸šçš„æœºåˆ¶ç›¸æ¯”ï¼Œæ€§èƒ½ä¼šå¾ˆåƒåŠ›ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ²¡æœ‰ä»»ä½•è¿¹è±¡è¡¨æ˜è¿™ä¸¤ç§æƒ…å†µï¼Œæˆ‘è°¨æ…ä¹è§‚åœ°è®¤ä¸ºæ•´ä½“è®¾è®¡æ˜¯å·®ä¸å¤šçš„ã€‚</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/raku" term="raku" label="Raku" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Rust çš„æ ‡å‡†åº“ Trait ä¹‹æ—…]]></title>
            <link href="https://ohmyweekly.github.io/notes/2021-05-19-a-tour-of-rust-standard-library-traits/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2021-04-15-raku-multiple-dispatch-with-the-new-moarvm-dispatcher/?utm_source=atom_feed" rel="related" type="text/html" title="Raku Multiple Dispatch With the New MoarVM Dispatcher" />
                <link href="https://ohmyweekly.github.io/notes/2021-04-05-psql/?utm_source=atom_feed" rel="related" type="text/html" title="Psql" />
                <link href="https://ohmyweekly.github.io/notes/2021-03-15-towards-a-new-general-dispatch-mechanism-in-moarvm/?utm_source=atom_feed" rel="related" type="text/html" title="äº‰å–åœ¨ MoarVM ä¸­å»ºç«‹ä¸€ä¸ªæ–°çš„æ€»è°ƒåº¦æœºåˆ¶" />
                <link href="https://ohmyweekly.github.io/notes/2021-03-07-difference-between-build-and-tweak-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="BUILD å’Œ TWEAK çš„åŒºåˆ«" />
                <link href="https://ohmyweekly.github.io/notes/2021-03-01-how-to-type-unicode-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="å¦‚ä½•åœ¨ Raku ä¸­è¾“å…¥ Unicode" />
            
                <id>https://ohmyweekly.github.io/notes/2021-05-19-a-tour-of-rust-standard-library-traits/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-04-15T00:00:00+08:00</published>
            <updated>2021-04-15T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Raku Multiple Dispatch With the New Moarvm Dispatcher</blockquote><h1 id="rust-çš„æ ‡å‡†åº“-trait-ä¹‹æ—…">Rust çš„æ ‡å‡†åº“ Trait ä¹‹æ—…</h1>
<p><strong>Table of Contents</strong></p>
<ul>
<li><a href="#intro">Intro</a></li>
<li><a href="#trait-basics">Trait Basics</a>
<ul>
<li><a href="#trait-items">Trait Items</a>
<ul>
<li><a href="#self">Self</a></li>
<li><a href="#functions">Functions</a></li>
<li><a href="#methods">Methods</a></li>
<li><a href="#associated-types">Associated Types</a></li>
<li><a href="#generic-parameters">Generic Parameters</a></li>
<li><a href="#generic-types-vs-associated-types">Generic Types vs Associated Types</a></li>
</ul>
</li>
<li><a href="#scope">Scope</a></li>
<li><a href="#derive-macros">Derive Macros</a></li>
<li><a href="#default-impls">Default Impls</a></li>
<li><a href="#generic-blanket-impls">Generic Blanket Impls</a></li>
<li><a href="#subtraits--supertraits">Subtraits &amp; Supertraits</a></li>
<li><a href="#trait-objects">Trait Objects</a></li>
<li><a href="#marker-traits">Marker Traits</a></li>
<li><a href="#auto-traits">Auto Traits</a></li>
<li><a href="#unsafe-traits">Unsafe Traits</a></li>
</ul>
</li>
<li><a href="#auto-traits-1">Auto Traits</a>
<ul>
<li><a href="#send--sync">Send &amp; Sync</a></li>
<li><a href="#sized">Sized</a></li>
</ul>
</li>
<li><a href="#general-traits">General Traits</a>
<ul>
<li><a href="#default">Default</a></li>
<li><a href="#clone">Clone</a></li>
<li><a href="#copy">Copy</a></li>
<li><a href="#any">Any</a></li>
</ul>
</li>
<li><a href="#formatting-traits">Formatting Traits</a>
<ul>
<li><a href="#display--tostring">Display &amp; ToString</a></li>
<li><a href="#debug">Debug</a></li>
</ul>
</li>
<li><a href="#operator-traits">Operator Traits</a>
<ul>
<li><a href="#comparison-traits">Comparison Traits</a>
<ul>
<li><a href="#partialeq--eq">PartialEq &amp; Eq</a></li>
<li><a href="#hash">Hash</a></li>
<li><a href="#partialord--ord">PartialOrd &amp; Ord</a></li>
</ul>
</li>
<li><a href="#arithmetic-traits">Arithmetic Traits</a>
<ul>
<li><a href="#add--addassign">Add &amp; AddAssign</a></li>
</ul>
</li>
<li><a href="#closure-traits">Closure Traits</a>
<ul>
<li><a href="#fnonce-fnmut--fn">FnOnce, FnMut, &amp; Fn</a></li>
</ul>
</li>
<li><a href="#other-traits">Other Traits</a>
<ul>
<li><a href="#deref--derefmut">Deref &amp; DerefMut</a></li>
<li><a href="#index--indexmut">Index &amp; IndexMut</a></li>
<li><a href="#drop">Drop</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#conversion-traits">Conversion Traits</a>
<ul>
<li><a href="#from--into">From &amp; Into</a></li>
</ul>
</li>
<li><a href="#error-handling">Error Handling</a>
<ul>
<li><a href="#error">Error</a></li>
</ul>
</li>
<li><a href="#conversion-traits-continued">Conversion Traits Continued</a>
<ul>
<li><a href="#tryfrom--tryinto">TryFrom &amp; TryInto</a></li>
<li><a href="#fromstr">FromStr</a></li>
<li><a href="#asref--asmut">AsRef &amp; AsMut</a></li>
<li><a href="#borrow--borrowmut">Borrow &amp; BorrowMut</a></li>
<li><a href="#toowned">ToOwned</a></li>
</ul>
</li>
<li><a href="#iteration-traits">Iteration Traits</a>
<ul>
<li><a href="#iterator">Iterator</a></li>
<li><a href="#intoiterator">IntoIterator</a></li>
<li><a href="#fromiterator">FromIterator</a></li>
</ul>
</li>
<li><a href="#io-traits">I/O Traits</a>
<ul>
<li><a href="#read--write">Read &amp; Write</a></li>
</ul>
</li>
<li><a href="#conclusion">Conclusion</a></li>
<li><a href="#discuss">Discuss</a></li>
<li><a href="#notifications">Notifications</a></li>
<li><a href="#further-reading">Further Reading</a></li>
</ul>
<h2 id="intro">Intro</h2>
<p>ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œè¿™ä¸¤è€…ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«?</p>
<ul>
<li><code>Deref&lt;Target = T&gt;</code>, <code>AsRef&lt;T&gt;</code> å’Œ <code>Borrow&lt;T&gt;</code>?</li>
<li><code>Clone</code>, <code>Copy</code> å’Œ <code>ToOwned</code>?</li>
<li><code>From&lt;T&gt;</code> å’Œ <code>Into&lt;T&gt;</code>?</li>
<li><code>TryFrom&lt;&amp;str&gt;</code> å’Œ <code>FromStr</code>?</li>
<li><code>FnOnce</code>, <code>FnMut</code>, <code>Fn</code> å’Œ <code>fn</code>?</li>
</ul>
<p>æˆ–è€…æ›¾ç»é—®è¿‡è‡ªå·±è¿™æ ·çš„é—®é¢˜:</p>
<ul>
<li>åœ¨æˆ‘çš„ trait ä¸­, æˆ‘ä»€ä¹ˆæ—¶å€™ä½¿ç”¨å…³è”ç±»å‹, ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ³›å‹ç±»å‹?</li>
<li>ä»€ä¹ˆæ˜¯æ³›å‹çš„ blanket å®ç°?</li>
<li>subtrait å’Œ supertrait æ˜¯å¦‚ä½•å·¥ä½œçš„?</li>
<li>ä¸ºä»€ä¹ˆè¿™ä¸ª trait æ²¡æœ‰ä»»ä½•æ–¹æ³•?</li>
</ul>
<p>é‚£ä¹ˆè¿™ç¯‡æ–‡ç« å°±æ˜¯ä¸ºä½ å‡†å¤‡çš„! å®ƒå›ç­”äº†ä»¥ä¸Šæ‰€æœ‰çš„é—®é¢˜ä»¥åŠæ›´å¤šçš„é—®é¢˜ã€‚æˆ‘ä»¬å°†ä¸€èµ·å¯¹ Rust æ ‡å‡†åº“ä¸­æ‰€æœ‰æœ€æµè¡Œã€æœ€å¸¸ç”¨çš„ trait è¿›è¡Œå¿«é€Ÿé£è¶Šä¹‹æ—…!</p>
<p>ä½ å¯ä»¥æŒ‰é¡ºåºé€èŠ‚é˜…è¯»æœ¬æ–‡ï¼Œä¹Ÿå¯ä»¥è·³è½¬åˆ°ä½ æœ€æ„Ÿå…´è¶£çš„ traitï¼Œå› ä¸ºæ¯ä¸ª trait éƒ¨åˆ†éƒ½æœ‰ä¸€ä¸ªé“¾æ¥åˆ—è¡¨ï¼Œé“¾æ¥åˆ° â€œå…ˆå†³çŸ¥è¯†â€ éƒ¨åˆ†ï¼Œä½ åº”è¯¥é˜…è¯»è¿™äº›é“¾æ¥ï¼Œä»¥ä¾¿æœ‰è¶³å¤Ÿçš„èƒŒæ™¯æ¥ç†è§£å½“å‰éƒ¨åˆ†çš„è§£é‡Šã€‚</p>
<h2 id="trait-åŸºç¡€">Trait åŸºç¡€</h2>
<p>We&rsquo;ll cover just enough of the basics so that the rest of the article can be streamlined without having to repeat the same explanations of the same concepts over and over as they reappear in different traits.</p>
<p>æˆ‘ä»¬å°†åªæ¶‰åŠè¶³å¤Ÿçš„åŸºç¡€çŸ¥è¯†ï¼Œä»¥ä¾¿æ–‡ç« çš„å…¶ä½™éƒ¨åˆ†å¯ä»¥ç²¾ç®€ï¼Œè€Œä¸å¿…åœ¨ä¸åŒçš„ trait ä¸­é‡æ–°å‡ºç°æ—¶é‡å¤ç›¸åŒçš„æ¦‚å¿µè§£é‡Šã€‚</p>
<h3 id="trait-é¡¹">Trait é¡¹</h3>
<p>Trait é¡¹æ˜¯æŒ‡ä½œä¸º trait å£°æ˜ä¸€éƒ¨åˆ†çš„ä»»ä½•é¡¹ã€‚</p>
<h4 id="self">Self</h4>
<p><code>Self</code> æ€»æ˜¯æŒ‡å®ç°ç±»å‹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// always returns i32
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">returns_num</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">i32</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="c1">// returns implementing type
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">returns_self</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">SomeType</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">OtherType</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SomeType</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">returns_num</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">i32</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="mi">5</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="c1">// Self == SomeType
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">returns_self</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">SomeType</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">OtherType</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">returns_num</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">i32</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="mi">6</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="c1">// Self == OtherType
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">returns_self</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">OtherType</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><h4 id="å‡½æ•°">å‡½æ•°</h4>
<p>Trait å‡½æ•°æ˜¯ä»»ä½•ç¬¬ä¸€ä¸ªå‚æ•°ä¸ä½¿ç”¨ <code>self</code> å…³é”®å­—çš„å‡½æ•°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="nb">Default</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// function
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">default</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>Trait å‡½æ•°å¯ä»¥é€šè¿‡ trait æˆ–å®ç°ç±»å‹æŒ‰ç…§å‘½åç©ºé—´çš„æ–¹å¼æ¥è°ƒç”¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">zero</span>: <span class="kt">i32</span> <span class="o">=</span><span class="w"> </span><span class="nb">Default</span>::<span class="n">default</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">i32</span>::<span class="n">default</span><span class="p">();</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><h4 id="æ–¹æ³•">æ–¹æ³•</h4>
<p>Trait æ–¹æ³•æ˜¯æŒ‡ç¬¬ä¸€ä¸ªå‚æ•°ä½¿ç”¨ <code>self</code> å…³é”®å­—å¹¶ä¸”ç±»å‹ä¸º <code>Self</code>ã€<code>&amp;Self</code>ã€<code>&amp;mut Self</code> çš„ä»»ä½•å‡½æ•°ã€‚å‰é¢çš„ç±»å‹ä¹Ÿå¯ä»¥ç”¨ <code>Box</code>ã€<code>Rc</code>ã€<code>Arc</code> æˆ– <code>Pin</code> æ¥åŒ…è£…ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// methods
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">takes_self</span><span class="p">(</span><span class="bp">self</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">takes_immut_self</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">takes_mut_self</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="c1">// above methods desugared
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">takes_self</span><span class="p">(</span><span class="bp">self</span>: <span class="nc">Self</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">takes_immut_self</span><span class="p">(</span><span class="bp">self</span>: <span class="kp">&amp;</span><span class="nc">Self</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">takes_mut_self</span><span class="p">(</span><span class="bp">self</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Self</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// example from standard library
</span><span class="c1"></span><span class="k">trait</span><span class="w"> </span><span class="nb">ToString</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">to_string</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">String</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>å¯ä»¥ä½¿ç”¨å®ç°ç±»å‹ä¸Šçš„ç‚¹è¿ç®—ç¬¦æ¥è°ƒç”¨æ–¹æ³•ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">five</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5.</span><span class="n">to_string</span><span class="p">();</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>ç„¶è€Œï¼Œä¸å‡½æ•°ç±»ä¼¼ï¼Œå®ƒä»¬ä¹Ÿå¯ä»¥é€šè¿‡ trait æˆ–å®ç°ç±»å‹æŒ‰ç…§å‘½åç©ºé—´çš„æ–¹å¼æ¥è°ƒç”¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">five</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">ToString</span>::<span class="n">to_string</span><span class="p">(</span><span class="o">&amp;</span><span class="mi">5</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">five</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">i32</span>::<span class="n">to_string</span><span class="p">(</span><span class="o">&amp;</span><span class="mi">5</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><h4 id="å…³è”ç±»å‹">å…³è”ç±»å‹</h4>
<p>Trait å¯ä»¥æœ‰å…³è”ç±»å‹ã€‚å½“æˆ‘ä»¬éœ€è¦åœ¨å‡½æ•°ç­¾åä¸­ä½¿ç”¨ <code>Self</code> ä»¥å¤–çš„å…¶ä»–ç±»å‹ï¼Œä½†åˆå¸Œæœ›ç±»å‹ç”±å®ç°è€…é€‰æ‹©ï¼Œè€Œä¸æ˜¯åœ¨ trait å£°æ˜ä¸­ç¡¬ç¼–ç æ—¶ï¼Œè¿™å¾ˆæœ‰ç”¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">AssociatedType</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">func</span><span class="p">(</span><span class="n">arg</span>: <span class="nc">Self</span>::<span class="n">AssociatedType</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">SomeType</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">OtherType</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// any type implementing Trait can
</span><span class="c1">// choose the type of AssociatedType
</span><span class="c1"></span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SomeType</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">AssociatedType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">i8</span><span class="p">;</span><span class="w"> </span><span class="c1">// chooses i8
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">func</span><span class="p">(</span><span class="n">arg</span>: <span class="nc">Self</span>::<span class="n">AssociatedType</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">OtherType</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">AssociatedType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">u8</span><span class="p">;</span><span class="w"> </span><span class="c1">// chooses u8
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">func</span><span class="p">(</span><span class="n">arg</span>: <span class="nc">Self</span>::<span class="n">AssociatedType</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">SomeType</span>::<span class="n">func</span><span class="p">(</span><span class="o">-</span><span class="mi">1_</span><span class="k">i8</span><span class="p">);</span><span class="w"> </span><span class="c1">// can only call func with i8 on SomeType
</span><span class="c1"></span><span class="w">    </span><span class="n">OtherType</span>::<span class="n">func</span><span class="p">(</span><span class="mi">1_</span><span class="k">u8</span><span class="p">);</span><span class="w"> </span><span class="c1">// can only call func with u8 on OtherType
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><h4 id="æ³›å‹å‚æ•°">æ³›å‹å‚æ•°</h4>
<p>â€œæ³›å‹å‚æ•°â€ æ³›æŒ‡æ³›å‹ç±»å‹å‚æ•°ã€æ³›å‹ lifetime å‚æ•°å’Œæ³›å‹å¸¸é‡å‚æ•°ã€‚ç”±äºè¿™äº›è¯´èµ·æ¥éƒ½å¾ˆæ‹—å£ï¼Œæ‰€ä»¥äººä»¬é€šå¸¸æŠŠå®ƒä»¬ç¼©å†™ä¸º <em>&ldquo;generic types&rdquo;</em>, <em>&ldquo;lifetimes&rdquo;</em> å’Œ <em>&ldquo;generic consts&rdquo;</em>ã€‚ç”±äº generic consts æ²¡æœ‰åœ¨æˆ‘ä»¬å°†è¦æ¶‰åŠçš„ä»»ä½•æ ‡å‡†åº“ trait ä¸­ä½¿ç”¨ï¼Œæ‰€ä»¥å®ƒä»¬ä¸åœ¨æœ¬æ–‡çš„èŒƒå›´ä¹‹å†…ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‚æ•°æ¥æ³›å‹åŒ–ä¸€ä¸ª trait å£°æ˜ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="c1">// trait declaration generalized with lifetime &amp; type parameters
</span><span class="c1"></span><span class="k">trait</span><span class="w"> </span><span class="n">Trait</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// signature uses generic type
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">func1</span><span class="p">(</span><span class="n">arg</span>: <span class="nc">T</span><span class="p">);</span><span class="w">
</span><span class="w">    
</span><span class="w">    </span><span class="c1">// signature uses lifetime
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">func2</span><span class="p">(</span><span class="n">arg</span>: <span class="kp">&amp;</span><span class="na">&#39;a</span><span class="w"> </span><span class="kt">i32</span><span class="p">);</span><span class="w">
</span><span class="w">    
</span><span class="w">    </span><span class="c1">// signature uses generic type &amp; lifetime
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">func3</span><span class="p">(</span><span class="n">arg</span>: <span class="kp">&amp;</span><span class="na">&#39;a</span><span class="w"> </span><span class="n">T</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">SomeType</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Trait</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="p">,</span><span class="w"> </span><span class="kt">i8</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SomeType</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">func1</span><span class="p">(</span><span class="n">arg</span>: <span class="kt">i8</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">func2</span><span class="p">(</span><span class="n">arg</span>: <span class="kp">&amp;</span><span class="na">&#39;a</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">func3</span><span class="p">(</span><span class="n">arg</span>: <span class="kp">&amp;</span><span class="na">&#39;a</span><span class="w"> </span><span class="kt">i8</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="o">&lt;</span><span class="na">&#39;b</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Trait</span><span class="o">&lt;</span><span class="na">&#39;b</span><span class="p">,</span><span class="w"> </span><span class="kt">u8</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SomeType</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">func1</span><span class="p">(</span><span class="n">arg</span>: <span class="kt">u8</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">func2</span><span class="p">(</span><span class="n">arg</span>: <span class="kp">&amp;</span><span class="na">&#39;b</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">func3</span><span class="p">(</span><span class="n">arg</span>: <span class="kp">&amp;</span><span class="na">&#39;b</span><span class="w"> </span><span class="kt">u8</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>å¯ä»¥ä¸ºæ³›å‹ç±»å‹æä¾›é»˜è®¤å€¼ã€‚æœ€å¸¸ç”¨çš„é»˜è®¤å€¼æ˜¯ <code>Self</code>ï¼Œä½†ä»»ä½•ç±»å‹éƒ½å¯ä»¥ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="c1">// make T = Self by default
</span><span class="c1"></span><span class="k">trait</span><span class="w"> </span><span class="n">Trait</span><span class="o">&lt;</span><span class="n">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Self</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">func</span><span class="p">(</span><span class="n">t</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// any type can be used as the default
</span><span class="c1"></span><span class="k">trait</span><span class="w"> </span><span class="n">Trait2</span><span class="o">&lt;</span><span class="n">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">i32</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">func2</span><span class="p">(</span><span class="n">t</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">SomeType</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// omitting the generic type will
</span><span class="c1">// cause the impl to use the default
</span><span class="c1">// value, which is Self here
</span><span class="c1"></span><span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SomeType</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">func</span><span class="p">(</span><span class="n">t</span>: <span class="nc">SomeType</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// default value here is i32
</span><span class="c1"></span><span class="k">impl</span><span class="w"> </span><span class="n">Trait2</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SomeType</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">func2</span><span class="p">(</span><span class="n">t</span>: <span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// the default is overridable as we&#39;d expect
</span><span class="c1"></span><span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SomeType</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">func</span><span class="p">(</span><span class="n">t</span>: <span class="nb">String</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// overridable here too
</span><span class="c1"></span><span class="k">impl</span><span class="w"> </span><span class="n">Trait2</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SomeType</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">func2</span><span class="p">(</span><span class="n">t</span>: <span class="nb">String</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>é™¤äº†å¯¹ trait è¿›è¡Œå‚æ•°åŒ–å¤–ï¼Œè¿˜å¯ä»¥å¯¹å•ä¸ªå‡½æ•°å’Œæ–¹æ³•è¿›è¡Œå‚æ•°åŒ–ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">func</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t</span>: <span class="kp">&amp;</span><span class="na">&#39;a</span><span class="w"> </span><span class="n">T</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><h4 id="æ³›å‹ç±»å‹-vs-å…³è”ç±»å‹">æ³›å‹ç±»å‹ vs å…³è”ç±»å‹</h4>
<p>æ³›å‹ç±»å‹å’Œå…³è”ç±»å‹éƒ½å°†å†³å®šæƒäº¤ç»™äº†å®ç°è€…ï¼Œè®©ä»–ä»¬å†³å®šåœ¨ trait çš„å‡½æ•°å’Œæ–¹æ³•ä¸­åº”è¯¥ä½¿ç”¨å“ªç§å…·ä½“ç±»å‹ï¼Œæ‰€ä»¥æœ¬èŠ‚è¯•å›¾è§£é‡Šä»€ä¹ˆæ—¶å€™ä½¿ç”¨ä¸€ç§ç±»å‹è€Œä¸æ˜¯å¦ä¸€ç§ç±»å‹ã€‚</p>
<p>ä¸€èˆ¬çš„ç»éªŒæ³•åˆ™æ˜¯</p>
<ul>
<li>å½“æ¯ä¸ªç±»å‹åªèƒ½æœ‰ä¸€ä¸ª trait çš„å®ç°æ—¶ï¼Œä½¿ç”¨å…³è”ç±»å‹ã€‚</li>
<li>å½“æ¯ä¸ªç±»å‹å¯ä»¥æœ‰è®¸å¤šå¯èƒ½çš„ trait çš„å®ç°æ—¶ï¼Œä½¿ç”¨æ³›å‹ç±»å‹ã€‚</li>
</ul>
<p>å‡è®¾æˆ‘ä»¬æƒ³å®šä¹‰ä¸€ä¸ªåä¸º <code>Add</code> çš„ traitï¼Œå®ƒå…è®¸æˆ‘ä»¬å°†å€¼åŠ åœ¨ä¸€èµ·ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªåˆå§‹è®¾è®¡å’Œåªä½¿ç”¨å…³è”ç±»å‹çš„å®ç°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Rhs</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Output</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">rhs</span>: <span class="nc">Self</span>::<span class="n">Rhs</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Output</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Rhs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">rhs</span>: <span class="nc">Point</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">x</span>: <span class="nc">self</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">y</span>: <span class="nc">self</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">1</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p1</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">p2</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">p3</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">p3</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>æ¯”æ–¹è¯´ï¼Œæˆ‘ä»¬æƒ³ç»™ <code>Point</code> æ·»åŠ å’Œ <code>i32</code> ç›¸åŠ çš„èƒ½åŠ›ï¼Œå…¶ä¸­ <code>i32</code> å°†å’Œ <code>x</code> å’Œ <code>y</code> æˆå‘˜ç›¸åŠ ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Rhs</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Output</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">rhs</span>: <span class="nc">Self</span>::<span class="n">Rhs</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Output</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Rhs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">rhs</span>: <span class="nc">Point</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">x</span>: <span class="nc">self</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">y</span>: <span class="nc">self</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// âŒ
</span><span class="c1"></span><span class="w">    </span><span class="k">type</span> <span class="nc">Rhs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">i32</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">rhs</span>: <span class="kt">i32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">x</span>: <span class="nc">self</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rhs</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">y</span>: <span class="nc">self</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rhs</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">1</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p1</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">p2</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">p3</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">p3</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">
</span><span class="w">    
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">1</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">int2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p1</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">int2</span><span class="p">);</span><span class="w"> </span><span class="c1">// âŒ
</span><span class="c1"></span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">p3</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">p3</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>è¿™æŠ›å‡º:</p>
<pre><code class="language-none" data-lang="none">error[E0119]: conflicting implementations of trait `Add` for type `Point`:
  --&gt; src/main.rs:23:1
   |
12 | impl Add for Point {
   | ------------------ first implementation here
...
23 | impl Add for Point {
   | ^^^^^^^^^^^^^^^^^^ conflicting implementation for `Point`
</code></pre><p>ç”±äº <code>Add</code> trait æ²¡æœ‰ä»»ä½•æ³›å‹ç±»å‹çš„å‚æ•°åŒ–ï¼Œæˆ‘ä»¬åªèƒ½å¯¹æ¯ä¸ªç±»å‹è¿›è¡Œä¸€æ¬¡å®ç°ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬åªèƒ½ä¸º <code>Rhs</code> å’Œ <code>Output</code> é€‰æ‹©ä¸€æ¬¡ç±»å‹ï¼ä¸ºäº†å…è®¸ <code>Point</code> å’Œ <code>Point</code> ç›¸åŠ ,ä»¥åŠ <code>i32</code> å’Œ <code>Point</code> ç›¸åŠ ï¼Œæˆ‘ä»¬å¿…é¡»å°† <code>Rhs</code> ä»å…³è”ç±»å‹é‡æ„ä¸ºæ³›å‹ç±»å‹ï¼Œè¿™å°†å…è®¸æˆ‘ä»¬ç”¨ä¸åŒçš„ç±»å‹å‚æ•°ä¸º <code>Rhs</code> å¤šæ¬¡å®ç° <code>Point</code> traitã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">Add</span><span class="o">&lt;</span><span class="n">Rhs</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Output</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">rhs</span>: <span class="nc">Rhs</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Output</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Add</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Self</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">rhs</span>: <span class="nc">Point</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Output</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">x</span>: <span class="nc">self</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">y</span>: <span class="nc">self</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Add</span><span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">    </span><span class="k">type</span> <span class="nc">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Self</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">rhs</span>: <span class="kt">i32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Output</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">x</span>: <span class="nc">self</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rhs</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">y</span>: <span class="nc">self</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rhs</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">1</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p1</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">p2</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">p3</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">p3</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">
</span><span class="w">    
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">1</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">int2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p1</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">int2</span><span class="p">);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">p3</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">p3</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>æ¯”æ–¹è¯´ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªåä¸º <code>Line</code> çš„æ–°ç±»å‹ï¼Œå®ƒåŒ…å«ä¸¤ä¸ª <code>Point</code>ï¼Œç°åœ¨åœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­ï¼Œå°†ä¸¤ä¸ª <code>Point</code> ç›¸åŠ åº”è¯¥äº§ç”Ÿä¸€ä¸ª <code>Line</code> è€Œä¸æ˜¯ <code>Point</code>ã€‚è€ƒè™‘åˆ° <code>Add</code> trait å½“å‰çš„è®¾è®¡ï¼Œè¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸º <code>Output</code> æ˜¯ä¸€ä¸ªå…³è”ç±»å‹ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡å°† <code>Output</code> ä»å…³è”ç±»å‹é‡æ„ä¸ºæ³›å‹ç±»å‹æ¥æ»¡è¶³è¿™äº›æ–°çš„è¦æ±‚ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">Add</span><span class="o">&lt;</span><span class="n">Rhs</span><span class="p">,</span><span class="w"> </span><span class="n">Output</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">rhs</span>: <span class="nc">Rhs</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Output</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Add</span><span class="o">&lt;</span><span class="n">Point</span><span class="p">,</span><span class="w"> </span><span class="n">Point</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">rhs</span>: <span class="nc">Point</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">x</span>: <span class="nc">self</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">y</span>: <span class="nc">self</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Add</span><span class="o">&lt;</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">Point</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">rhs</span>: <span class="kt">i32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">x</span>: <span class="nc">self</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rhs</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">y</span>: <span class="nc">self</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rhs</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Line</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">start</span>: <span class="nc">Point</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">end</span>: <span class="nc">Point</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Add</span><span class="o">&lt;</span><span class="n">Point</span><span class="p">,</span><span class="w"> </span><span class="n">Line</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">rhs</span>: <span class="nc">Point</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Line</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Line</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">start</span>: <span class="nc">self</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">end</span>: <span class="nc">rhs</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">1</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p3</span>: <span class="nc">Point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p1</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">p2</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">assert</span><span class="o">!</span><span class="p">(</span><span class="n">p3</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">p3</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">1</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">int2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p1</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">int2</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">assert</span><span class="o">!</span><span class="p">(</span><span class="n">p3</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">p3</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">1</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">l</span>: <span class="nc">Line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p1</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">p2</span><span class="p">);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">    </span><span class="n">assert</span><span class="o">!</span><span class="p">(</span><span class="n">l</span><span class="p">.</span><span class="n">start</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">l</span><span class="p">.</span><span class="n">start</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">l</span><span class="p">.</span><span class="n">end</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">l</span><span class="p">.</span><span class="n">end</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>é‚£ä¹ˆï¼Œä¸Šé¢çš„ <code>Add</code> trait å“ªç§æœ€å¥½å‘¢ï¼Ÿè¿™çœŸçš„å–å†³äºä½ çš„ç¨‹åºçš„è¦æ±‚! åˆé€‚çš„å°±æ˜¯æœ€å¥½çš„ã€‚</p>
<h3 id="ä½œç”¨åŸŸ">ä½œç”¨åŸŸ</h3>
<p>Trait é¡¹ä¸èƒ½ä½¿ç”¨ï¼Œé™¤éè¯¥ trait åœ¨ä½œç”¨åŸŸå†…ã€‚å¤§å¤šæ•° Rustaceans åœ¨ç¬¬ä¸€æ¬¡å°è¯•å†™ä¸€ä¸ªç”¨ I/O åšä»»ä½•äº‹æƒ…çš„ç¨‹åºæ—¶ï¼Œéƒ½ä¼šè‰°éš¾åœ°å­¦ä¼šè¿™ä¸€ç‚¹ï¼Œå› ä¸º <code>Read</code> å’Œ <code>Write</code> trait ä¸åœ¨æ ‡å‡†åº“çš„é¢„åŠ è½½ä¸­ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">fs</span>::<span class="n">File</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">io</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">io</span>::<span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span>::<span class="n">open</span><span class="p">(</span><span class="s">&#34;Cargo.toml&#34;</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">new</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">file</span><span class="p">.</span><span class="n">read_to_string</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">buffer</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// âŒ read_to_string not found in File
</span><span class="c1"></span><span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><code>read_to_string(buf: &amp;mut String)</code> ç”± <code>std::io::Read</code> trait å£°æ˜ï¼Œå¹¶ç”± <code>std::fs::File</code> ç»“æ„ä½“å®ç°ï¼Œä½†ä¸ºäº†è°ƒç”¨å®ƒï¼Œ<code>std::io::Read</code> å¿…é¡»åœ¨ä½œç”¨åŸŸå†…ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">fs</span>::<span class="n">File</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">io</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">io</span>::<span class="n">Read</span><span class="p">;</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">io</span>::<span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span>::<span class="n">open</span><span class="p">(</span><span class="s">&#34;Cargo.toml&#34;</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">new</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">file</span><span class="p">.</span><span class="n">read_to_string</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">buffer</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>æ ‡å‡†åº“ä¸­çš„ prelude æ˜¯æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œå³ <code>std::prelude::v1</code>ï¼Œå®ƒåœ¨æ¯ä¸ªå…¶ä»–æ¨¡å—çš„é¡¶éƒ¨è¢«è‡ªåŠ¨å¯¼å…¥ï¼Œå³ <code>use std::prelude::v1::*</code>ã€‚å› æ­¤ï¼Œä¸‹é¢çš„ trait æ€»æ˜¯åœ¨ä½œç”¨åŸŸå†…ï¼Œæˆ‘ä»¬æ°¸è¿œä¸éœ€è¦æ˜¾å¼å¯¼å…¥å®ƒä»¬ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ prelude çš„ä¸€éƒ¨åˆ†ã€‚</p>
<ul>
<li><a href="#asref--asmut">AsMut</a></li>
<li><a href="#asref--asmut">AsRef</a></li>
<li><a href="#clone">Clone</a></li>
<li><a href="#copy">Copy</a></li>
<li><a href="#default">Default</a></li>
<li><a href="#drop">Drop</a></li>
<li><a href="#partialeq--eq">Eq</a></li>
<li><a href="#fnonce-fnmut--fn">Fn</a></li>
<li><a href="#fnonce-fnmut--fn">FnMut</a></li>
<li><a href="#fnonce-fnmut--fn">FnOnce</a></li>
<li><a href="#from--into">From</a></li>
<li><a href="#from--into">Into</a></li>
<li><a href="#toowned">ToOwned</a></li>
<li><a href="#intoiterator">IntoIterator</a></li>
<li><a href="#iterator">Iterator</a></li>
<li><a href="#partialeq--eq">PartialEq</a></li>
<li><a href="#partialord--ord">PartialOrd</a></li>
<li><a href="#send--sync">Send</a></li>
<li><a href="#sized">Sized</a></li>
<li><a href="#send--sync">Sync</a></li>
<li><a href="#display--tostring">ToString</a></li>
<li><a href="#partialord--ord">Ord</a></li>
</ul>
<h3 id="æ´¾ç”Ÿå®">æ´¾ç”Ÿå®</h3>
<p>æ ‡å‡†åº“å¯¼å‡ºäº†ä¸€äº›æ´¾ç”Ÿå®ï¼Œå¦‚æœä¸€ä¸ªç±»å‹çš„æ‰€æœ‰æˆå‘˜éƒ½å®ç°äº†æŸä¸ª trait, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™äº›å®æ¥å¿«é€Ÿæ–¹ä¾¿åœ°åœ¨è¿™ä¸ªç±»å‹ä¸Šå®ç°è¯¥ traitã€‚è¿™äº›æ´¾ç”Ÿå®ä»¥å®ƒä»¬æ‰€å®ç°çš„ trait å‘½åã€‚</p>
<ul>
<li><a href="#clone">Clone</a></li>
<li><a href="#copy">Copy</a></li>
<li><a href="#debug">Debug</a></li>
<li><a href="#default">Default</a></li>
<li><a href="#partialeq--eq">Eq</a></li>
<li><a href="#hash">Hash</a></li>
<li><a href="#partialord--ord">Ord</a></li>
<li><a href="#partialeq--eq">PartialEq</a></li>
<li><a href="#partialord--ord">PartialOrd</a></li>
</ul>
<p>ä½¿ç”¨ç¤ºä¾‹:</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="c1">// macro derives Copy &amp; Clone impl for SomeType
</span><span class="c1"></span><span class="cp">#[derive(Copy, Clone)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">SomeType</span><span class="p">;</span><span class="w">
</span></code></pre></div><p>æ³¨æ„ï¼šæ´¾ç”Ÿå®åªæ˜¯è¿‡ç¨‹å®ï¼Œå¯ä»¥åšä»»ä½•äº‹æƒ…ï¼Œæ²¡æœ‰ç¡¬æ€§è§„å®šä¸€å®šè¦å®ç°ä¸€ä¸ª traitï¼Œä¹Ÿæ²¡æœ‰è§„å®šåªæœ‰åœ¨ç±»å‹çš„æ‰€æœ‰æˆå‘˜éƒ½å®ç°ä¸€ä¸ª trait çš„æƒ…å†µä¸‹æ‰èƒ½å·¥ä½œï¼Œè¿™äº›åªæ˜¯æ ‡å‡†åº“ä¸­æ´¾ç”Ÿå®æ‰€éµå¾ªçš„çº¦å®šã€‚</p>
<h3 id="é»˜è®¤å®ç°">é»˜è®¤å®ç°</h3>
<p>Trait å¯ä»¥ä¸ºå…¶å‡½æ•°å’Œæ–¹æ³•æä¾›é»˜è®¤çš„å®ç°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">method</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;default impl&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">SomeType</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">OtherType</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// use default impl for Trait::method
</span><span class="c1"></span><span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SomeType</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">OtherType</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// use our own impl for Trait::method
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">method</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;OtherType impl&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">SomeType</span><span class="p">.</span><span class="n">method</span><span class="p">();</span><span class="w"> </span><span class="c1">// prints &#34;default impl&#34;
</span><span class="c1"></span><span class="w">    </span><span class="n">OtherType</span><span class="p">.</span><span class="n">method</span><span class="p">();</span><span class="w"> </span><span class="c1">// prints &#34;OtherType impl&#34;
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>å¦‚æœä¸€äº› trait æ–¹æ³•å¯ä»¥åªç”¨å…¶ä»– trait æ–¹æ³•æ¥å®ç°ï¼Œè¿™å°±ç‰¹åˆ«æ–¹ä¾¿ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">Greet</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">greet</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">name</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">String</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">greet_loudly</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">name</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">String</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">greet</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;!&#34;</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Hello</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Hola</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Greet</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Hello</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">greet</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">name</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">String</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">format</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;Hello {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="c1">// use default impl for greet_loudly
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Greet</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Hola</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">greet</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">name</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">String</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">format</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;Hola {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="c1">// override default impl
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">greet_loudly</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">name</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">String</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">greeting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">greet</span><span class="p">(</span><span class="n">name</span><span class="p">);</span><span class="w">
</span><span class="w">        </span><span class="n">greeting</span><span class="p">.</span><span class="n">insert_str</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;Â¡&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">        </span><span class="n">greeting</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;!&#34;</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">Hello</span><span class="p">.</span><span class="n">greet</span><span class="p">(</span><span class="s">&#34;John&#34;</span><span class="p">));</span><span class="w"> </span><span class="c1">// prints &#34;Hello John&#34;
</span><span class="c1"></span><span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">Hello</span><span class="p">.</span><span class="n">greet_loudly</span><span class="p">(</span><span class="s">&#34;John&#34;</span><span class="p">));</span><span class="w"> </span><span class="c1">// prints &#34;Hello John!&#34;
</span><span class="c1"></span><span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">Hola</span><span class="p">.</span><span class="n">greet</span><span class="p">(</span><span class="s">&#34;John&#34;</span><span class="p">));</span><span class="w"> </span><span class="c1">// prints &#34;Hola John&#34;
</span><span class="c1"></span><span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">Hola</span><span class="p">.</span><span class="n">greet_loudly</span><span class="p">(</span><span class="s">&#34;John&#34;</span><span class="p">));</span><span class="w"> </span><span class="c1">// prints &#34;Â¡Hola John!&#34;
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>æ ‡å‡†åº“ä¸­çš„è®¸å¤š trait ä¸ºå®ƒä»¬çš„è®¸å¤šæ–¹æ³•æä¾›äº†é»˜è®¤çš„å®ç°ã€‚</p>
<h3 id="generic-blanket-impls">Generic Blanket Impls</h3>
<p>é€šç”¨å…¨é¢å®ç°æ˜¯åœ¨æ³›å‹ç±»å‹è€Œä¸æ˜¯å…·ä½“ç±»å‹ä¸Šçš„å®ç°ã€‚ä¸ºäº†è§£é‡Šä¸ºä»€ä¹ˆä»¥åŠå¦‚ä½•ä½¿ç”¨ï¼Œè®©æˆ‘ä»¬ä»ä¸ºæ•°å­—ç±»å‹ç¼–å†™ä¸€ä¸ª <code>is_even</code> æ–¹æ³•å¼€å§‹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">Even</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">is_even</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Even</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="kt">i8</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">is_even</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2_</span><span class="k">i8</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0_</span><span class="k">i8</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Even</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="kt">u8</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">is_even</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2_</span><span class="k">u8</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0_</span><span class="k">u8</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Even</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="kt">i16</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">is_even</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2_</span><span class="k">i16</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0_</span><span class="k">i16</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// etc
</span><span class="c1"></span><span class="w">
</span><span class="w"></span><span class="cp">#[test]</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">test_is_even</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">assert</span><span class="o">!</span><span class="p">(</span><span class="mi">2_</span><span class="k">i8</span><span class="p">.</span><span class="n">is_even</span><span class="p">());</span><span class="w">
</span><span class="w">    </span><span class="n">assert</span><span class="o">!</span><span class="p">(</span><span class="mi">4_</span><span class="k">u8</span><span class="p">.</span><span class="n">is_even</span><span class="p">());</span><span class="w">
</span><span class="w">    </span><span class="n">assert</span><span class="o">!</span><span class="p">(</span><span class="mi">6_</span><span class="k">i16</span><span class="p">.</span><span class="n">is_even</span><span class="p">());</span><span class="w">
</span><span class="w">    </span><span class="c1">// etc
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>æ˜¾ç„¶ï¼Œè¿™æ˜¯å¾ˆå•°å—¦çš„ã€‚è€Œä¸”ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„å®ç°å‡ ä¹éƒ½æ˜¯ä¸€æ ·çš„ã€‚æ­¤å¤–ï¼Œå¦‚æœ Rust å†³å®šåœ¨æœªæ¥æ·»åŠ æ›´å¤šçš„æ•°å­—ç±»å‹ï¼Œæˆ‘ä»¬å¿…é¡»è®°å¾—å›åˆ°è¿™æ®µä»£ç ï¼Œå¹¶ç”¨æ–°çš„æ•°å­—ç±»å‹æ›´æ–°å®ƒã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªé€šç”¨çš„å…¨é¢å®ç°æ¥è§£å†³æ‰€æœ‰è¿™äº›é—®é¢˜ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">fmt</span>::<span class="n">Debug</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">convert</span>::<span class="n">TryInto</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">ops</span>::<span class="n">Rem</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">trait</span><span class="w"> </span><span class="n">Even</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">is_even</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// generic blanket impl
</span><span class="c1"></span><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Even</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">T</span><span class="w">
</span><span class="w"></span><span class="k">where</span><span class="w">
</span><span class="w">    </span><span class="n">T</span>: <span class="nc">Rem</span><span class="o">&lt;</span><span class="n">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">PartialEq</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Sized</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="kt">u8</span>: <span class="nc">TryInto</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="o">&lt;</span><span class="kt">u8</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">TryInto</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span>::<span class="n">Error</span>: <span class="nc">Debug</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">is_even</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="c1">// these unwraps will never panic
</span><span class="c1"></span><span class="w">        </span><span class="bp">self</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">2.</span><span class="n">try_into</span><span class="p">().</span><span class="n">unwrap</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0.</span><span class="n">try_into</span><span class="p">().</span><span class="n">unwrap</span><span class="p">()</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[test]</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">test_is_even</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">assert</span><span class="o">!</span><span class="p">(</span><span class="mi">2_</span><span class="k">i8</span><span class="p">.</span><span class="n">is_even</span><span class="p">());</span><span class="w">
</span><span class="w">    </span><span class="n">assert</span><span class="o">!</span><span class="p">(</span><span class="mi">4_</span><span class="k">u8</span><span class="p">.</span><span class="n">is_even</span><span class="p">());</span><span class="w">
</span><span class="w">    </span><span class="n">assert</span><span class="o">!</span><span class="p">(</span><span class="mi">6_</span><span class="k">i16</span><span class="p">.</span><span class="n">is_even</span><span class="p">());</span><span class="w">
</span><span class="w">    </span><span class="c1">// etc
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>Unlike default impls, which provide <em>an</em> impl, generic blanket impls provide <em>the</em> impl, so they are not overridable.
ä¸é»˜è®¤å®ç°ä¸åŒï¼Œé»˜è®¤çš„å®ç°æä¾›äº†ä¸€ä¸ªå®ç°ï¼Œè€Œé€šç”¨çš„å…¨é¢å®ç°æä¾›äº†ç‰¹å®šçš„å®ç°ï¼Œæ‰€ä»¥å®ƒä»¬æ˜¯ä¸å¯è¦†ç›–çš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">fmt</span>::<span class="n">Debug</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">convert</span>::<span class="n">TryInto</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">ops</span>::<span class="n">Rem</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">trait</span><span class="w"> </span><span class="n">Even</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">is_even</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Even</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">T</span><span class="w">
</span><span class="w"></span><span class="k">where</span><span class="w">
</span><span class="w">    </span><span class="n">T</span>: <span class="nc">Rem</span><span class="o">&lt;</span><span class="n">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">PartialEq</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Sized</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="kt">u8</span>: <span class="nc">TryInto</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="o">&lt;</span><span class="kt">u8</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">TryInto</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span>::<span class="n">Error</span>: <span class="nc">Debug</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">is_even</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">2.</span><span class="n">try_into</span><span class="p">().</span><span class="n">unwrap</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0.</span><span class="n">try_into</span><span class="p">().</span><span class="n">unwrap</span><span class="p">()</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Even</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="kt">u8</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// âŒ
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">is_even</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mi">2_</span><span class="k">u8</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0_</span><span class="k">u8</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>è¿™æŠ›å‡º:</p>
<pre><code class="language-none" data-lang="none">error[E0119]: conflicting implementations of trait `Even` for type `u8`:
  --&gt; src/lib.rs:22:1
   |
10 | / impl&lt;T&gt; Even for T
11 | | where
12 | |     T: Rem&lt;Output = T&gt; + PartialEq&lt;T&gt; + Sized,
13 | |     u8: TryInto&lt;T&gt;,
...  |
19 | |     }
20 | | }
   | |_- first implementation here
21 | 
22 |   impl Even for u8 {
   |   ^^^^^^^^^^^^^^^^ conflicting implementation for `u8`
</code></pre><p>These impls overlap, hence they conflict, hence Rust rejects the code to ensure trait coherence. Trait coherence is the property that there exists at most one impl of a trait for any given type. The rules Rust uses to enforce trait coherence, the implications of those rules, and workarounds for the implications are outside the scope of this article.</p>
<p>è¿™äº›å®ç°é‡å äº†ï¼Œå› æ­¤å®ƒä»¬å†²çªï¼Œå› æ­¤ Rust æ‹’ç»äº†ç¡®ä¿ trait ä¸€è‡´æ€§çš„ä»£ç ã€‚Trait ä¸€è‡´æ€§æ˜¯æŒ‡ä»»ä½•ç»™å®šç±»å‹çš„ trait æœ€å¤šå­˜åœ¨ä¸€ä¸ªå®ç°çš„å±æ€§ã€‚Rust ç”¨æ¥å¼ºåˆ¶æ‰§è¡Œ trait ä¸€è‡´æ€§çš„è§„åˆ™ï¼Œè¿™äº›è§„åˆ™çš„å«ä¹‰ï¼Œä»¥åŠå«ä¹‰çš„å˜é€šæ–¹æ³•éƒ½ä¸åœ¨æœ¬æ–‡çš„èŒƒå›´å†…ã€‚</p>
<h3 id="subtraits--supertraits">Subtraits &amp; Supertraits</h3>
<p>&ldquo;subtrait&rdquo; ä¸­çš„ &ldquo;sub&rdquo; æŒ‡çš„æ˜¯å­é›†ï¼Œ&ldquo;supertrait&rdquo; ä¸­çš„ &ldquo;super&rdquo; æŒ‡çš„æ˜¯è¶…é›†ã€‚å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªè¿™æ ·çš„ trait å£°æ˜ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">Subtrait</span>: <span class="nc">Supertrait</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></code></pre></div><p>All of the types which impl <code>Subtrait</code> are a subset of all the types which impl <code>Supertrait</code>, or to put it in opposite but equivalent terms: all the types which impl <code>Supertrait</code> are a superset of all the types which impl <code>Subtrait</code>.</p>
<p>Also, the above is just syntax sugar for:
æ‰€æœ‰å®ç° <code>Subtrait</code> çš„ç±»å‹éƒ½æ˜¯æ‰€æœ‰å®ç° <code>Supertrait</code> çš„ç±»å‹çš„å­é›†ï¼Œæˆ–è€…ç”¨ç›¸åä½†ç­‰ä»·çš„è¯è¯­æ¥è¡¨è¾¾ï¼šæ‰€æœ‰å®ç° <code>Supertrait</code> çš„ç±»å‹éƒ½æ˜¯æ‰€æœ‰å®ç° <code>Subtrait</code> çš„ç±»å‹çš„è¶…é›†ã€‚</p>
<p>å¦å¤–ï¼Œä¸Šé¢çš„ä»£ç åªæ˜¯ä¸‹é¢è¿™æ®µä»£ç çš„è¯­æ³•ç³–:</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">Subtrait</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">Self</span>: <span class="nc">Supertrait</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></code></pre></div><p>è¿™æ˜¯ä¸€ä¸ªå¾®å¦™è€Œåˆé‡è¦çš„åŒºåˆ«ï¼Œè¦ç†è§£çš„æ˜¯ï¼Œçº¦æŸæ˜¯åœ¨ <code>Self</code> ä¸Šçš„ï¼Œå³å®ç° <code>Subtrait</code> çš„ç±»å‹ï¼Œè€Œä¸æ˜¯åœ¨ <code>Subtrait</code> æœ¬èº«ã€‚åè€…æ˜¯æ²¡æœ‰ä»»ä½•æ„ä¹‰çš„ï¼Œå› ä¸º trait çº¦æŸåªèƒ½åº”ç”¨äºå…·ä½“çš„ç±»å‹ï¼Œè¿™äº›ç±»å‹å¯ä»¥å®ç° traitã€‚Trait ä¸èƒ½å®ç°å…¶ä»– traitã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">Supertrait</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">method</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;in supertrait&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">trait</span><span class="w"> </span><span class="n">Subtrait</span>: <span class="nc">Supertrait</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// this looks like it might impl or
</span><span class="c1"></span><span class="w">    </span><span class="c1">// override Supertrait::method but it
</span><span class="c1"></span><span class="w">    </span><span class="c1">// does not
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">method</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;in subtrait&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">SomeType</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// adds Supertrait::method to SomeType
</span><span class="c1"></span><span class="k">impl</span><span class="w"> </span><span class="n">Supertrait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SomeType</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// adds Subtrait::method to SomeType
</span><span class="c1"></span><span class="k">impl</span><span class="w"> </span><span class="n">Subtrait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SomeType</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// both methods exist on SomeType simultaneously
</span><span class="c1">// neither overriding or shadowing the other
</span><span class="c1"></span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">SomeType</span><span class="p">.</span><span class="n">method</span><span class="p">();</span><span class="w"> </span><span class="c1">// âŒ ambiguous method call
</span><span class="c1"></span><span class="w">    </span><span class="c1">// must disambiguate using fully-qualified syntax
</span><span class="c1"></span><span class="w">    </span><span class="o">&lt;</span><span class="n">SomeType</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Supertrait</span><span class="o">&gt;</span>::<span class="n">method</span><span class="p">(</span><span class="o">&amp;</span><span class="n">st</span><span class="p">);</span><span class="w"> </span><span class="c1">// âœ… prints &#34;in supertrait&#34;
</span><span class="c1"></span><span class="w">    </span><span class="o">&lt;</span><span class="n">SomeType</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Subtrait</span><span class="o">&gt;</span>::<span class="n">method</span><span class="p">(</span><span class="o">&amp;</span><span class="n">st</span><span class="p">);</span><span class="w"> </span><span class="c1">// âœ… prints &#34;in subtrait&#34;
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>Furthermore, there are no rules for how a type must impl both a subtrait and a supertrait. It can use the methods from either in the impl of the other.
æ­¤å¤–ï¼Œæ²¡æœ‰è§„å®šä¸€ä¸ªç±»å‹å¿…é¡»åŒæ—¶å®ç°ä¸€ä¸ª subtrait å’Œä¸€ä¸ª supertraitã€‚å®ƒå¯ä»¥åœ¨å¦ä¸€ä¸ªç±»å‹çš„å®ç°ä¸­ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªç±»å‹çš„æ–¹æ³•ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">Supertrait</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">super_method</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">trait</span><span class="w"> </span><span class="n">Subtrait</span>: <span class="nc">Supertrait</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">sub_method</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">CallSuperFromSub</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Supertrait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">CallSuperFromSub</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">super_method</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;in super&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Subtrait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">CallSuperFromSub</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">sub_method</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;in sub&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">super_method</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">CallSubFromSuper</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Supertrait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">CallSubFromSuper</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">super_method</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;in super&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">sub_method</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Subtrait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">CallSubFromSuper</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">sub_method</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;in sub&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">CallEachOther</span><span class="p">(</span><span class="kt">bool</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Supertrait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">CallEachOther</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">super_method</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;in super&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="bp">self</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">
</span><span class="w">            </span><span class="bp">self</span><span class="p">.</span><span class="n">sub_method</span><span class="p">();</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Subtrait</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">CallEachOther</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">sub_method</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;in sub&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="bp">self</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span><span class="w">
</span><span class="w">            </span><span class="bp">self</span><span class="p">.</span><span class="n">super_method</span><span class="p">();</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">CallSuperFromSub</span><span class="p">.</span><span class="n">super_method</span><span class="p">();</span><span class="w"> </span><span class="c1">// prints &#34;in super&#34;
</span><span class="c1"></span><span class="w">    </span><span class="n">CallSuperFromSub</span><span class="p">.</span><span class="n">sub_method</span><span class="p">();</span><span class="w"> </span><span class="c1">// prints &#34;in sub&#34;, &#34;in super&#34;
</span><span class="c1"></span><span class="w">    
</span><span class="w">    </span><span class="n">CallSubFromSuper</span><span class="p">.</span><span class="n">super_method</span><span class="p">();</span><span class="w"> </span><span class="c1">// prints &#34;in super&#34;, &#34;in sub&#34;
</span><span class="c1"></span><span class="w">    </span><span class="n">CallSubFromSuper</span><span class="p">.</span><span class="n">sub_method</span><span class="p">();</span><span class="w"> </span><span class="c1">// prints &#34;in sub&#34;
</span><span class="c1"></span><span class="w">    
</span><span class="w">    </span><span class="n">CallEachOther</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="n">super_method</span><span class="p">();</span><span class="w"> </span><span class="c1">// prints &#34;in super&#34;, &#34;in sub&#34;
</span><span class="c1"></span><span class="w">    </span><span class="n">CallEachOther</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="n">sub_method</span><span class="p">();</span><span class="w"> </span><span class="c1">// prints &#34;in sub&#34;, &#34;in super&#34;
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>Hopefully the examples above show that the relationship between subtraits and supertraits can be complex. Before introducing a mental model that neatly encapsulates all of that complexity let&rsquo;s quickly review and establish the mental model we use for understanding trait bounds on generic types:
å¸Œæœ›ä¸Šé¢çš„ä¾‹å­èƒ½è¡¨æ˜ï¼Œsubtrait å’Œ supertrait ä¹‹é—´çš„å…³ç³»å¯èƒ½å¾ˆå¤æ‚ã€‚åœ¨ä»‹ç»ä¸€ä¸ªèƒ½æ•´é½åœ°æ¦‚æ‹¬æ‰€æœ‰è¿™äº›å¤æ‚æ€§çš„å¿ƒç†æ¨¡å‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å¿«é€Ÿå›é¡¾å¹¶å»ºç«‹æˆ‘ä»¬ç”¨äºç†è§£æ³›å‹ä¸Šçš„ trait çº¦æŸçš„å¿ƒç†æ¨¡å‹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">function</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nb">Clone</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// impl
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>Without knowing anything about the impl of this function we could reasonably guess that <code>t.clone()</code> gets called at some point because when a generic type is bounded by a trait that strongly implies it has a dependency on the trait. The mental model for understanding the relationship between generic types and their trait bounds is a simple and intuitive one: generic types <em>depend on</em> their trait bounds.</p>
<p>Now let&rsquo;s look the trait declaration for <code>Copy</code>:
åœ¨ä¸äº†è§£è¿™ä¸ªå‡½æ•°çš„å®ç°çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆç†åœ°çŒœæµ‹ <code>t.clone()</code> åœ¨æŸäº›æ—¶å€™ä¼šè¢«è°ƒç”¨ï¼Œå› ä¸ºå½“ä¸€ä¸ªæ³›å‹è¢«ä¸€ä¸ª trait çº¦æŸæ—¶ï¼Œå¼ºçƒˆåœ°æ„å‘³ç€å®ƒå¯¹ trait æœ‰ä¾èµ–æ€§ã€‚ç†è§£æ³›å‹ä¸å…¶ trait çº¦æŸä¹‹é—´å…³ç³»çš„å¿ƒç†æ¨¡å‹æ˜¯ä¸€ä¸ªç®€å•è€Œç›´è§‚çš„æ¨¡å‹ï¼šæ³›å‹ â€œä¾èµ–â€ å…¶ trait çº¦æŸã€‚</p>
<p>ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ <code>Copy</code> çš„ trait å£°æ˜ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="nb">Copy</span>: <span class="nb">Clone</span> <span class="p">{}</span><span class="w">
</span></code></pre></div><p>ä¸Šé¢çš„è¯­æ³•çœ‹èµ·æ¥éå¸¸ç±»ä¼¼äºåœ¨æ³›å‹ç±»å‹ä¸Šåº”ç”¨ trait çº¦æŸçš„è¯­æ³•ï¼Œç„¶è€Œ <code>Copy</code> æ ¹æœ¬ä¸ä¾èµ–äº <code>Clone</code>ã€‚æˆ‘ä»¬å‰é¢å¼€å‘çš„å¿ƒç†æ¨¡å‹åœ¨è¿™é‡Œå¹¶ä¸èƒ½å¸®åŠ©æˆ‘ä»¬ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œç†è§£ subtrait å’Œ supertrait ä¹‹é—´å…³ç³»çš„æœ€ç®€å•ã€æœ€ä¼˜é›…çš„å¿ƒç†æ¨¡å‹æ˜¯ï¼šsubtrait â€œç²¾ç‚¼â€ å…¶ supertraitã€‚</p>
<p>â€œç²¾ç‚¼â€ è¿™ä¸ªè¯æ•…æ„ä¿æŒæœ‰äº›æ¨¡ç³Šï¼Œå› ä¸ºå®ƒåœ¨ä¸åŒçš„è¯­å¢ƒä¸­å¯ä»¥æœ‰ä¸åŒçš„å«ä¹‰ã€‚</p>
<ul>
<li>subtrait å¯èƒ½ä¼šä½¿å®ƒçš„ supertrait çš„æ–¹æ³•æ›´åŠ ç‰¹åŒ–ï¼Œé€Ÿåº¦æ›´å¿«ï¼Œä½¿ç”¨æ›´å°‘çš„å†…å­˜ï¼Œä¾‹å¦‚ï¼š<code>Copy: Clone</code></li>
<li>subtrait å¯ä»¥å¯¹ supertrait çš„æ–¹æ³•çš„å®ç°åšå‡ºé¢å¤–çš„ä¿è¯ï¼Œä¾‹å¦‚ <code>Eq: PartialEq</code>, <code>Ord: PartialOrd</code>, <code>ExactSizeIterator: Iterator</code></li>
<li>subtrait å¯èƒ½ä½¿ supertrait çš„æ–¹æ³•æ›´çµæ´»æˆ–æ›´å®¹æ˜“è°ƒç”¨ï¼Œä¾‹å¦‚ <code>FnMut: FnOnce</code>, `Fn: FnMut</li>
<li>subtrait å¯ä»¥æ‰©å±•ä¸€ä¸ª supertraitï¼Œå¹¶æ·»åŠ æ–°çš„æ–¹æ³•ï¼Œä¾‹å¦‚ <code>DoubleEndedIterator: Iterator</code>, <code>ExactSizeIterator: Iterator</code></li>
</ul>
<h3 id="trait-å¯¹è±¡">Trait å¯¹è±¡</h3>
<p>æ³›å‹ç»™äº†æˆ‘ä»¬ç¼–è¯‘æ—¶çš„å¤šæ€æ€§ï¼Œè€Œ trait å¯¹è±¡ç»™äº†æˆ‘ä»¬è¿è¡Œæ—¶çš„å¤šæ€æ€§ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ trait å¯¹è±¡æ¥å…è®¸å‡½æ•°åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°è¿”å›ä¸åŒçš„ç±»å‹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">example</span><span class="p">(</span><span class="n">condition</span>: <span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="n">vec</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Box</span><span class="o">&lt;</span><span class="n">dyn</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">i32</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">iter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="p">.</span><span class="n">into_iter</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">condition</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="c1">// Has type:
</span><span class="c1"></span><span class="w">        </span><span class="c1">// Box&lt;Map&lt;IntoIter&lt;i32&gt;, Fn(i32) -&gt; i32&gt;&gt;
</span><span class="c1"></span><span class="w">        </span><span class="c1">// But is cast to:
</span><span class="c1"></span><span class="w">        </span><span class="c1">// Box&lt;dyn Iterator&lt;Item = i32&gt;&gt;
</span><span class="c1"></span><span class="w">        </span><span class="nb">Box</span>::<span class="n">new</span><span class="p">(</span><span class="n">iter</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">n</span><span class="o">|</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="c1">// Has type:
</span><span class="c1"></span><span class="w">        </span><span class="c1">// Box&lt;Filter&lt;IntoIter&lt;i32&gt;, Fn(&amp;i32) -&gt; bool&gt;&gt;
</span><span class="c1"></span><span class="w">        </span><span class="c1">// But is cast to:
</span><span class="c1"></span><span class="w">        </span><span class="c1">// Box&lt;dyn Iterator&lt;Item = i32&gt;&gt;
</span><span class="c1"></span><span class="w">        </span><span class="nb">Box</span>::<span class="n">new</span><span class="p">(</span><span class="n">iter</span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="o">|&amp;</span><span class="n">n</span><span class="o">|</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>Trait å¯¹è±¡è¿˜å…è®¸æˆ‘ä»¬åœ¨é›†åˆä¸­å­˜å‚¨å¼‚æ„ç±»å‹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="kt">f64</span>::<span class="n">consts</span>::<span class="n">PI</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Circle</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">radius</span>: <span class="kt">f64</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Square</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">side</span>: <span class="kt">f64</span>
<span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">trait</span><span class="w"> </span><span class="n">Shape</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">area</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">f64</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Shape</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Circle</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">area</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">f64</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">PI</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">radius</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">radius</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Shape</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Square</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">area</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">f64</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">side</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">side</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">get_total_area</span><span class="p">(</span><span class="n">shapes</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">Box</span><span class="o">&lt;</span><span class="n">dyn</span><span class="w"> </span><span class="n">Shape</span><span class="o">&gt;&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">f64</span> <span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">shapes</span><span class="p">.</span><span class="n">into_iter</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="o">|</span><span class="n">s</span><span class="o">|</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">area</span><span class="p">()).</span><span class="n">sum</span><span class="p">()</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">example</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">shapes</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">Box</span><span class="o">&lt;</span><span class="n">dyn</span><span class="w"> </span><span class="n">Shape</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="w">
</span><span class="w">        </span><span class="nb">Box</span>::<span class="n">new</span><span class="p">(</span><span class="n">Circle</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">radius</span>: <span class="mf">1.0</span><span class="w"> </span><span class="p">}),</span><span class="w"> </span><span class="c1">// Box&lt;Circle&gt; cast to Box&lt;dyn Shape&gt;
</span><span class="c1"></span><span class="w">        </span><span class="nb">Box</span>::<span class="n">new</span><span class="p">(</span><span class="n">Square</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">side</span>: <span class="mf">1.0</span><span class="w"> </span><span class="p">}),</span><span class="w"> </span><span class="c1">// Box&lt;Square&gt; cast to Box&lt;dyn Shape&gt;
</span><span class="c1"></span><span class="w">    </span><span class="p">];</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">PI</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="n">get_total_area</span><span class="p">(</span><span class="n">shapes</span><span class="p">));</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>Trait å¯¹è±¡æ˜¯ä¸ç¡®å®šå¤§å°çš„ï¼Œæ‰€ä»¥å®ƒä»¬å¿…é¡»æ€»æ˜¯åœ¨æŒ‡é’ˆåé¢ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®ç±»å‹ä¸­æ˜¯å¦å­˜åœ¨ <code>dyn</code> å…³é”®å­—æ¥åŒºåˆ†å…·ä½“ç±»å‹å’Œ trait å¯¹è±¡ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">struct</span> <span class="nc">Struct</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">trait</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// regular struct
</span><span class="c1"></span><span class="o">&amp;</span><span class="n">Struct</span><span class="w">
</span><span class="w"></span><span class="nb">Box</span><span class="o">&lt;</span><span class="n">Struct</span><span class="o">&gt;</span><span class="w">
</span><span class="w"></span><span class="n">Rc</span><span class="o">&lt;</span><span class="n">Struct</span><span class="o">&gt;</span><span class="w">
</span><span class="w"></span><span class="n">Arc</span><span class="o">&lt;</span><span class="n">Struct</span><span class="o">&gt;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// trait objects
</span><span class="c1"></span><span class="o">&amp;</span><span class="n">dyn</span><span class="w"> </span><span class="n">Trait</span><span class="w">
</span><span class="w"></span><span class="nb">Box</span><span class="o">&lt;</span><span class="n">dyn</span><span class="w"> </span><span class="n">Trait</span><span class="o">&gt;</span><span class="w">
</span><span class="w"></span><span class="n">Rc</span><span class="o">&lt;</span><span class="n">dyn</span><span class="w"> </span><span class="n">Trait</span><span class="o">&gt;</span><span class="w">
</span><span class="w"></span><span class="n">Arc</span><span class="o">&lt;</span><span class="n">dyn</span><span class="w"> </span><span class="n">Trait</span><span class="o">&gt;</span><span class="w">
</span></code></pre></div><p>å¹¶éæ‰€æœ‰çš„ trait éƒ½å¯ä»¥è½¬æ¢ä¸º trait å¯¹è±¡ã€‚å¦‚æœä¸€ä¸ª trait æ»¡è¶³è¿™äº›è¦æ±‚ï¼Œå®ƒå°±æ˜¯å¯¹è±¡å®‰å…¨çš„ã€‚</p>
<ul>
<li>trait ä¸éœ€è¦ <code>Self: Sized</code>ã€‚</li>
<li>æ‰€æœ‰ trait çš„æ–¹æ³•éƒ½æ˜¯å¯¹è±¡å®‰å…¨çš„ã€‚</li>
</ul>
<p>å¦‚æœ trait æ–¹æ³•æ»¡è¶³è¿™äº›è¦æ±‚ï¼Œå®ƒå°±æ˜¯å¯¹è±¡å®‰å…¨çš„ã€‚</p>
<ul>
<li>æ–¹æ³•éœ€è¦ <code>Self: Sized</code> æˆ–</li>
<li>è¯¥æ–¹æ³•åªåœ¨æ¥æ”¶å™¨ä½ç½®ä½¿ç”¨ <code>Self</code> ç±»å‹ã€‚</li>
</ul>
<p>ç†è§£ä¸ºä»€ä¹ˆè¦æ±‚æ˜¯è¿™æ ·çš„ï¼Œä¸æœ¬æ–‡å…¶ä»–éƒ¨åˆ†æ— å…³ï¼Œä½†å¦‚æœä½ ä»ç„¶å¥½å¥‡ï¼Œåœ¨ <a href="https://ohmyweekly.github.io/notes/2021-04-11-sizedness-in-rust/">Sizedness in Rust</a> ä¸­ä¼šæœ‰ä»‹ç»ã€‚</p>
<h3 id="marker-traits">Marker Traits</h3>
<p>æ ‡è®° trait æ˜¯æ²¡æœ‰ trait é¡¹çš„ traitã€‚å®ƒä»¬çš„å·¥ä½œæ˜¯å°†å®ç°ç±»å‹ â€œæ ‡è®°â€ ä¸ºå…·æœ‰æŸäº›å±æ€§ï¼Œå¦åˆ™ä¸å¯èƒ½ç”¨ç±»å‹ç³»ç»Ÿæ¥è¡¨ç¤ºã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="c1">// Impling PartialEq for a type promises
</span><span class="c1">// that equality for the type has these properties:
</span><span class="c1">// - symmetry: a == b implies b == a, and
</span><span class="c1">// - transitivity: a == b &amp;&amp; b == c implies a == c
</span><span class="c1">// But DOES NOT promise this property:
</span><span class="c1">// - reflexivity: a == a
</span><span class="c1"></span><span class="k">trait</span><span class="w"> </span><span class="nb">PartialEq</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">eq</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// Eq has no trait items! The eq method is already
</span><span class="c1">// declared by PartialEq, but &#34;impling&#34; Eq
</span><span class="c1">// for a type promises this additional equality property:
</span><span class="c1">// - reflexivity: a == a
</span><span class="c1"></span><span class="k">trait</span><span class="w"> </span><span class="nb">Eq</span>: <span class="nb">PartialEq</span> <span class="p">{}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// f64 impls PartialEq but not Eq because NaN != NaN
</span><span class="c1">// i32 impls PartialEq &amp; Eq because there&#39;s no NaNs :)
</span></code></pre></div><h3 id="auto-traits">Auto Traits</h3>
<p>è‡ªåŠ¨ trait æ˜¯æŒ‡å¦‚æœä¸€ä¸ªç±»å‹çš„æ‰€æœ‰æˆå‘˜éƒ½å®ç°äº†è¿™ä¸ª traitï¼Œé‚£ä¹ˆè¿™ä¸ª trait å°±ä¼šè¢«è‡ªåŠ¨å®ç°ã€‚â€œæˆå‘˜â€ çš„å«ä¹‰å–å†³äºç±»å‹ï¼Œä¾‹å¦‚ï¼šç»“æ„ä½“çš„å­—æ®µã€æšä¸¾çš„å˜ä½“ã€æ•°ç»„çš„å…ƒç´ ã€å…ƒç»„çš„é¡¹ç­‰ç­‰ã€‚</p>
<p>æ‰€æœ‰çš„è‡ªåŠ¨ trait éƒ½æ˜¯æ ‡è®° traitï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„æ ‡è®° trait éƒ½æ˜¯è‡ªåŠ¨ traitã€‚è‡ªåŠ¨ trait å¿…é¡»æ˜¯æ ‡è®° traitï¼Œè¿™æ ·ç¼–è¯‘å™¨å°±å¯ä»¥ä¸ºå®ƒä»¬æä¾›ä¸€ä¸ªè‡ªåŠ¨çš„ç¼ºçœå®ç°ï¼Œå¦‚æœå®ƒä»¬æœ‰ä»»ä½• trait é¡¹ï¼Œé‚£å°±ä¸å¯èƒ½äº†ã€‚</p>
<p>è‡ªåŠ¨ trait çš„ä¾‹å­ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="c1">// implemented for types which are safe to send between threads
</span><span class="c1"></span><span class="k">unsafe</span><span class="w"> </span><span class="n">auto</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="nb">Send</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// implemented for types whose references are safe to send between threads
</span><span class="c1"></span><span class="k">unsafe</span><span class="w"> </span><span class="n">auto</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="nb">Sync</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></code></pre></div><h3 id="unsafe-traits">Unsafe Traits</h3>
<p>Trait å¯ä»¥è¢«æ ‡è®°ä¸ºä¸å®‰å…¨ï¼Œä»¥è¡¨æ˜å®ç°è¯¥ trait å¯èƒ½éœ€è¦ä¸å®‰å…¨çš„ä»£ç ã€‚<code>Send</code> å’Œ <code>Sync</code> éƒ½è¢«æ ‡è®°ä¸º <code>unsafe</code>ï¼Œå› ä¸ºå¦‚æœå®ƒä»¬æ²¡æœ‰è¢«è‡ªåŠ¨å®ç°ï¼Œå°±æ„å‘³ç€å®ƒä¸€å®šåŒ…å«ä¸€äº›é <code>Send</code> æˆ–é <code>Sync</code> æˆå‘˜ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æ‰‹åŠ¨æ ‡è®°ç±»å‹ä¸º <code>Send</code> å’Œ <code>Sync</code>ï¼Œæˆ‘ä»¬ä½œä¸ºå®ç°è€…å¿…é¡»æ ¼å¤–å°å¿ƒï¼Œä»¥ç¡®ä¿æ²¡æœ‰æ•°æ®ç«äº‰ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="c1">// SomeType is not Send or Sync
</span><span class="c1"></span><span class="k">struct</span> <span class="nc">SomeType</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">not_send_or_sync</span>: <span class="o">*</span><span class="k">const</span><span class="w"> </span><span class="p">(),</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// but if we&#39;re confident that our impl doesn&#39;t have any data
</span><span class="c1">// races we can explicitly mark it as Send and Sync using unsafe
</span><span class="c1"></span><span class="k">unsafe</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="nb">Send</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SomeType</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w"></span><span class="k">unsafe</span><span class="w"> </span><span class="k">impl</span><span class="w"> </span><span class="nb">Sync</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SomeType</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></code></pre></div><h2 id="auto-traits-1">Auto Traits</h2>
<h3 id="send--sync">Send &amp; Sync</h3>
<p>é¢„å¤‡çŸ¥è¯†</p>
<ul>
<li><a href="#marker-traits">Marker Traits</a></li>
<li><a href="#auto-traits">Auto Traits</a></li>
<li><a href="#unsafe-traits">Unsafe Traits</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">unsafe</span><span class="w"> </span><span class="n">auto</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="nb">Send</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w"></span><span class="k">unsafe</span><span class="w"> </span><span class="n">auto</span><span class="w"> </span><span class="k">trait</span><span class="w"> </span><span class="nb">Sync</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></code></pre></div><p>å¦‚æœä¸€ä¸ªç±»å‹æ˜¯ <code>Send</code>ï¼Œæ„å‘³ç€åœ¨çº¿ç¨‹ä¹‹é—´å‘é€æ˜¯å®‰å…¨çš„ã€‚å¦‚æœä¸€ä¸ªç±»å‹æ˜¯ <code>Sync</code>ï¼Œè¿™æ„å‘³ç€åœ¨çº¿ç¨‹ä¹‹é—´å…±äº«å®ƒçš„å¼•ç”¨æ˜¯å®‰å…¨çš„ã€‚æ›´å‡†ç¡®åœ°è¯´ï¼Œå¦‚æœä¸”ä»…å½“ <code>&amp;T</code> æ˜¯ <code>Send</code> æ—¶ï¼Œä¸€äº›ç±»å‹ <code>T</code> æ˜¯ <code>Sync</code>ã€‚</p>
<p>å‡ ä¹æ‰€æœ‰ç±»å‹éƒ½æ˜¯ <code>Send</code> å’Œ <code>Sync</code> çš„ã€‚å”¯ä¸€å€¼å¾—æ³¨æ„çš„ <code>Send</code> å¼‚å¸¸æ˜¯ <code>Rc</code>ï¼Œå”¯ä¸€å€¼å¾—æ³¨æ„çš„ <code>Sync</code> å¼‚å¸¸æ˜¯ <code>Rc</code>ã€<code>Cell</code> å’Œ <code>RefCell</code>ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦ä¸€ä¸ª <code>Rc</code> çš„ <code>Send</code> ç‰ˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>Arc</code>ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦ <code>Cell</code> æˆ– <code>RefCell</code> çš„ <code>Sync</code> ç‰ˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ <code>Mutex</code> æˆ– <code>RwLock</code>ã€‚è™½ç„¶å¦‚æœæˆ‘ä»¬ä½¿ç”¨ <code>Mutex</code> æˆ– <code>RwLock</code> åªæ˜¯åŒ…è£¹ä¸€ä¸ªåŸè¯­ç±»å‹ï¼Œé€šå¸¸æœ€å¥½ä½¿ç”¨æ ‡å‡†åº“æä¾›çš„åŸå­åŸè¯­ç±»å‹ï¼Œå¦‚ <code>AtomicBool</code>ã€<code>AtomicI32</code>ã€<code>AtomicUsize</code> ç­‰ã€‚</p>
<p>å‡ ä¹æ‰€æœ‰çš„ç±»å‹éƒ½æ˜¯ <code>Sync</code>ï¼Œè¿™å¯èƒ½ä¼šè®©ä¸€äº›äººæ„Ÿåˆ°æƒŠè®¶ï¼Œä½†æ˜¯æ˜¯çš„ï¼Œå³ä½¿å¯¹äºæ²¡æœ‰ä»»ä½•å†…éƒ¨åŒæ­¥çš„ç±»å‹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚è¿™è¦å½’åŠŸäº Rust ä¸¥æ ¼çš„å€Ÿç”¨è§„åˆ™ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å°†åŒä¸€æ•°æ®çš„è®¸å¤šä¸å¯å˜çš„å¼•ç”¨ä¼ é€’ç»™è®¸å¤šçº¿ç¨‹ï¼Œè€Œä¸”æˆ‘ä»¬ä¿è¯ä¸ä¼šå‡ºç°æ•°æ®ç«äº‰ï¼Œå› ä¸ºåªè¦æœ‰ä»»ä½•ä¸å¯å˜çš„å¼•ç”¨å­˜åœ¨ï¼Œ Rust å°±ä¼šé™æ€åœ°ä¿è¯åº•å±‚æ•°æ®ä¸èƒ½è¢«ä¿®æ”¹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">crossbeam</span>::<span class="n">thread</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">greeting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">&#34;Hello&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">greeting_ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">greeting</span><span class="p">;</span><span class="w">
</span><span class="w">    
</span><span class="w">    </span><span class="n">thread</span>::<span class="n">scope</span><span class="p">(</span><span class="o">|</span><span class="n">scoped_thread</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="c1">// spawn 3 threads
</span><span class="c1"></span><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">1</span><span class="p">..</span><span class="o">=</span><span class="mi">3</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="c1">// greeting_ref copied into every thread
</span><span class="c1"></span><span class="w">            </span><span class="n">scoped_thread</span><span class="p">.</span><span class="n">spawn</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">                </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;{} {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">greeting_ref</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">);</span><span class="w"> </span><span class="c1">// prints &#34;Hello {n}&#34;
</span><span class="c1"></span><span class="w">            </span><span class="p">});</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">        
</span><span class="w">        </span><span class="c1">// line below could cause UB or data races but compiler rejects it
</span><span class="c1"></span><span class="w">        </span><span class="n">greeting</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&#34; world&#34;</span><span class="p">;</span><span class="w"> </span><span class="c1">// âŒ cannot mutate greeting while immutable refs exist
</span><span class="c1"></span><span class="w">    </span><span class="p">});</span><span class="w">
</span><span class="w">    
</span><span class="w">    </span><span class="c1">// can mutate greeting after every thread has joined
</span><span class="c1"></span><span class="w">    </span><span class="n">greeting</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&#34; world&#34;</span><span class="p">;</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">greeting</span><span class="p">);</span><span class="w"> </span><span class="c1">// prints &#34;Hello world&#34;
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥å°†å•ä¸ªå¯å˜å¼•ç”¨ä¼ é€’ç»™ä¸€äº›æ•°æ®åˆ°ä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ä¿è¯ä¸ä¼šå‡ºç°æ•°æ®ç«äº‰ï¼Œå› ä¸º Rust é™æ€åœ°ä¿è¯äº†åˆ«åçš„å¯å˜å¼•ç”¨ä¸èƒ½å­˜åœ¨ï¼Œåº•å±‚æ•°æ®ä¸èƒ½é€šè¿‡ç°æœ‰çš„å•ä¸ªå¯å˜å¼•ç”¨ä»¥å¤–çš„ä»»ä½•ä¸œè¥¿è¿›è¡Œä¿®æ”¹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">crossbeam</span>::<span class="n">thread</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">greeting</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">&#34;Hello&#34;</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">greeting_ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">greeting</span><span class="p">;</span><span class="w">
</span><span class="w">    
</span><span class="w">    </span><span class="n">thread</span>::<span class="n">scope</span><span class="p">(</span><span class="o">|</span><span class="n">scoped_thread</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="c1">// greeting_ref moved into thread
</span><span class="c1"></span><span class="w">        </span><span class="n">scoped_thread</span><span class="p">.</span><span class="n">spawn</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="o">*</span><span class="n">greeting_ref</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&#34; world&#34;</span><span class="p">;</span><span class="w">
</span><span class="w">            </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">greeting_ref</span><span class="p">);</span><span class="w"> </span><span class="c1">// prints &#34;Hello world&#34;
</span><span class="c1"></span><span class="w">        </span><span class="p">});</span><span class="w">
</span><span class="w">        
</span><span class="w">        </span><span class="c1">// line below could cause UB or data races but compiler rejects it
</span><span class="c1"></span><span class="w">        </span><span class="n">greeting</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&#34;!!!&#34;</span><span class="p">;</span><span class="w"> </span><span class="c1">// âŒ cannot mutate greeting while mutable refs exist
</span><span class="c1"></span><span class="w">    </span><span class="p">});</span><span class="w">
</span><span class="w">    
</span><span class="w">    </span><span class="c1">// can mutate greeting after the thread has joined
</span><span class="c1"></span><span class="w">    </span><span class="n">greeting</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&#34;!!!&#34;</span><span class="p">;</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">greeting</span><span class="p">);</span><span class="w"> </span><span class="c1">// prints &#34;Hello world!!!&#34;
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¤§å¤šæ•°ç±»å‹éƒ½æ˜¯ <code>Sync</code> è€Œä¸éœ€è¦ä»»ä½•æ˜¾å¼åŒæ­¥ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨å¤šä¸ªçº¿ç¨‹ä¸­åŒæ—¶ä¿®æ”¹ä¸€äº›æ•°æ® <code>T</code>ï¼Œç¼–è¯‘å™¨ä¸ä¼šè®©æˆ‘ä»¬è¿™æ ·åšï¼Œç›´åˆ°æˆ‘ä»¬å°†æ•°æ®åŒ…è£¹åœ¨ <code>Arc&lt;Mutex&lt;T&gt;&gt;</code> æˆ– <code>Arc&lt;RwLock&lt;T&gt;&gt;</code> ä¸­ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨å¼ºåˆ¶è¦æ±‚åœ¨éœ€è¦æ—¶ä½¿ç”¨æ˜¾å¼åŒæ­¥ã€‚</p>
<h3 id="sized">Sized</h3>
<p>é¢„å¤‡çŸ¥è¯†</p>
<ul>
<li><a href="#marker-traits">Marker Traits</a></li>
<li><a href="#auto-traits">Auto Traits</a></li>
</ul>
<p>å¦‚æœä¸€ä¸ªç±»å‹æ˜¯ <code>Sized</code> çš„ï¼Œè¿™æ„å‘³ç€å®ƒçš„å­—èŠ‚å¤§å°åœ¨ç¼–è¯‘æ—¶æ˜¯å·²çŸ¥çš„ï¼Œå¹¶ä¸”å¯ä»¥å°†è¯¥ç±»å‹çš„å®ä¾‹æ”¾åœ¨æ ˆä¸Šã€‚</p>
<p>ç±»å‹çš„å¤§å°å’Œå®ƒçš„å«ä¹‰æ˜¯ä¸€ä¸ªå¾®å¦™è€Œåˆå·¨å¤§çš„è¯é¢˜ï¼Œå®ƒå½±å“åˆ°è¯­è¨€çš„å¾ˆå¤šä¸åŒæ–¹é¢ã€‚å®ƒæ˜¯å¦‚æ­¤é‡è¦ï¼Œä»¥è‡³äºæˆ‘å†™äº†æ•´æ•´ä¸€ç¯‡æ–‡ç« ï¼Œå«åš <a href="https://ohmyweekly.github.io/notes/2021-04-11-sizedness-in-rust/">Sizedness in Rust</a>ï¼Œæˆ‘å¼ºçƒˆæ¨èä»»ä½•æƒ³æ·±å…¥äº†è§£ç±»å‹å¤§å°çš„äººé˜…è¯»ã€‚æˆ‘æ€»ç»“ä¸€ä¸‹ä¸æœ¬æ–‡ç›¸å…³çš„å‡ ä¸ªå…³é”®å†…å®¹ã€‚</p>
<ol>
<li>æ‰€æœ‰çš„æ³›å‹ç±»å‹éƒ½ä¼šå¾—åˆ°ä¸€ä¸ªéšå¼çš„ <code>Sized</code> çº¦æŸã€‚</li>
</ol>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">func</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t</span>: <span class="kp">&amp;</span><span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// example above desugared
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">func</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nb">Sized</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t</span>: <span class="kp">&amp;</span><span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></code></pre></div><ol start="2">
<li>ç”±äºæ‰€æœ‰æ³›å‹ç±»å‹éƒ½æœ‰ä¸€ä¸ªéšå¼çš„ <code>Sized</code> çº¦æŸï¼Œå¦‚æœæˆ‘ä»¬æƒ³é€€å‡ºè¿™ä¸ªéšå¼çº¦æŸï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ç‰¹æ®Šçš„ &ldquo;æ”¾å®½çº¦æŸ&rdquo; è¯­æ³• <code>?Sized</code>ï¼Œå®ƒç›®å‰åªå­˜åœ¨äº <code>Sized</code> traitã€‚</li>
</ol>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="c1">// now T can be unsized
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">func</span><span class="o">&lt;</span><span class="n">T</span>: <span class="o">?</span><span class="nb">Sized</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t</span>: <span class="kp">&amp;</span><span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></code></pre></div><ol start="3">
<li>æ‰€æœ‰çš„ trait éƒ½æœ‰ä¸€ä¸ªéšå¼çš„ <code>?Sized</code> çº¦æŸã€‚</li>
</ol>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">Trait</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// example above desugared
</span><span class="c1"></span><span class="k">trait</span><span class="w"> </span><span class="n">Trait</span>: <span class="o">?</span><span class="nb">Sized</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></code></pre></div><p>è¿™æ˜¯ä¸ºäº†è®© trait å¯¹è±¡å¯ä»¥å®ç° traitã€‚åŒæ ·ï¼Œæ‰€æœ‰çš„çç¢ç»†èŠ‚éƒ½åœ¨ <a href="https://ohmyweekly.github.io/notes/2021-04-11-sizedness-in-rust/">Sizedness in Rust</a> ä¸­ã€‚</p>
<h2 id="general-traits">General traits</h2>
<h3 id="default">Default</h3>
<p>é¢„å¤‡çŸ¥è¯†</p>
<ul>
<li><a href="#self">Self</a></li>
<li><a href="#functions">Functions</a></li>
<li><a href="#derive-macros">Derive Macros</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="nb">Default</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">default</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>å¯ä»¥æ„å»º <code>Default</code> ç±»å‹çš„é»˜è®¤å€¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">struct</span> <span class="nc">Color</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">r</span>: <span class="kt">u8</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">g</span>: <span class="kt">u8</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">b</span>: <span class="kt">u8</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">Default</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Color</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// default color is black
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">default</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Color</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">r</span>: <span class="mi">0</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">g</span>: <span class="mi">0</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">b</span>: <span class="mi">0</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>è¿™å¯¹å¿«é€Ÿå»ºç«‹åŸå‹å¾ˆæœ‰ç”¨ï¼Œä½†åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªç±»å‹çš„å®ä¾‹ï¼Œè€Œä¸”å¯¹å®ƒæ˜¯ä»€ä¹ˆå¹¶ä¸æŒ‘å‰”ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// just give me some color!
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Color</span>::<span class="n">default</span><span class="p">();</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>è¿™ä¹Ÿæ˜¯ä¸€ä¸ªæˆ‘ä»¬å¯èƒ½æƒ³æ˜ç¡®åœ°æš´éœ²ç»™æˆ‘ä»¬çš„å‡½æ•°ç”¨æˆ·çš„é€‰é¡¹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">struct</span> <span class="nc">Canvas</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">enum</span> <span class="nc">Shape</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">Circle</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Rectangle</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Canvas</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// let user optionally pass a color
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">paint</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">shape</span>: <span class="nc">Shape</span><span class="p">,</span><span class="w"> </span><span class="n">color</span>: <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Color</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="c1">// if no color is passed use the default color
</span><span class="c1"></span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">color</span><span class="p">.</span><span class="n">unwrap_or_default</span><span class="p">();</span><span class="w">
</span><span class="w">        </span><span class="c1">// etc
</span><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><code>Default</code> åœ¨æˆ‘ä»¬éœ€è¦æ„é€ æ³›å‹ç±»å‹çš„æ³›å‹è¯­å¢ƒä¸­ä¹Ÿå¾ˆæœ‰ç”¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">guarantee_length</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nb">Default</span><span class="o">&gt;</span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">vec</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">min_len</span>: <span class="kt">usize</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="p">..</span><span class="n">min_len</span><span class="p">.</span><span class="n">saturating_sub</span><span class="p">(</span><span class="n">vec</span><span class="p">.</span><span class="n">len</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">vec</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">T</span>::<span class="n">default</span><span class="p">());</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="n">vec</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ <code>Default</code> ç±»å‹çš„å¦ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨ Rust çš„ç»“æ„ä½“æ›´æ–°è¯­æ³•å¯¹ç»“æ„ä½“è¿›è¡Œéƒ¨åˆ†åˆå§‹åŒ–ã€‚æˆ‘ä»¬å¯ä»¥ä¸º <code>Color</code> è®¾ç½®ä¸€ä¸ª <code>new</code> æ„é€ å‡½æ•°ï¼Œå°†æ¯ä¸ªæˆå‘˜ä½œä¸ºä¸€ä¸ªå‚æ•°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">impl</span><span class="w"> </span><span class="n">Color</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">r</span>: <span class="kt">u8</span><span class="p">,</span><span class="w"> </span><span class="n">g</span>: <span class="kt">u8</span><span class="p">,</span><span class="w"> </span><span class="n">b</span>: <span class="kt">u8</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Color</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">r</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">g</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">b</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>ç„¶è€Œï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨æ–¹ä¾¿çš„æ„é€ å‡½æ•°ï¼Œæ¯ä¸ªæ„é€ å‡½æ•°åªæ¥å—ä¸€ä¸ªç‰¹å®šçš„ç»“æ„ä½“æˆå‘˜ï¼Œå…¶ä»–ç»“æ„ä½“æˆå‘˜åˆ™ä½¿ç”¨é»˜è®¤å€¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">impl</span><span class="w"> </span><span class="n">Color</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">red</span><span class="p">(</span><span class="n">r</span>: <span class="kt">u8</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Color</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">r</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="p">..</span><span class="n">Color</span>::<span class="n">default</span><span class="p">()</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">green</span><span class="p">(</span><span class="n">g</span>: <span class="kt">u8</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Color</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">g</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="p">..</span><span class="n">Color</span>::<span class="n">default</span><span class="p">()</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">blue</span><span class="p">(</span><span class="n">b</span>: <span class="kt">u8</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Color</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">b</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="p">..</span><span class="n">Color</span>::<span class="n">default</span><span class="p">()</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>è¿˜æœ‰ä¸€ä¸ª <code>Default</code> çš„æ´¾ç”Ÿå®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·ç¼–å†™ <code>Color</code>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="c1">// default color is still black
</span><span class="c1">// because u8::default() == 0
</span><span class="c1"></span><span class="cp">#[derive(Default)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Color</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">r</span>: <span class="kt">u8</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">g</span>: <span class="kt">u8</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">b</span>: <span class="kt">u8</span>
<span class="p">}</span><span class="w">
</span></code></pre></div><h3 id="clone">Clone</h3>
<p>é¢„å¤‡çŸ¥è¯†</p>
<ul>
<li><a href="#self">Self</a></li>
<li><a href="#methods">Methods</a></li>
<li><a href="#default-impls">Default Impls</a></li>
<li><a href="#derive-macros">Derive Macros</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="nb">Clone</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">clone</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="c1">// provided default impls
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">clone_from</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">source</span>: <span class="kp">&amp;</span><span class="nc">Self</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>æˆ‘ä»¬å¯ä»¥å°† <code>Clone</code> ç±»å‹çš„ä¸å¯å˜å¼•ç”¨è½¬æ¢ä¸ºè‡ªæœ‰å€¼(owned values)ï¼Œå³ <code>&amp;T</code> -&gt; <code>T</code>ã€‚<code>Clone</code> æ²¡æœ‰å¯¹è¿™ç§è½¬æ¢çš„æ•ˆç‡åšå‡ºæ‰¿è¯ºï¼Œæ‰€ä»¥å®ƒå¯èƒ½æ˜¯ç¼“æ…¢å’Œæ˜‚è´µçš„ã€‚ä¸ºäº†å¿«é€Ÿåœ°åœ¨ä¸€ä¸ªç±»å‹ä¸Šå®ç° <code>Clone</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ´¾ç”Ÿå®ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="cp">#[derive(Clone)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">SomeType</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">cloneable_member1</span>: <span class="nc">CloneableType1</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">cloneable_member2</span>: <span class="nc">CloneableType2</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="c1">// etc
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// macro generates impl below
</span><span class="c1"></span><span class="k">impl</span><span class="w"> </span><span class="nb">Clone</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SomeType</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">clone</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">SomeType</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">cloneable_member1</span>: <span class="nc">self</span><span class="p">.</span><span class="n">cloneable_member1</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w">
</span><span class="w">            </span><span class="n">cloneable_member2</span>: <span class="nc">self</span><span class="p">.</span><span class="n">cloneable_member2</span><span class="p">.</span><span class="n">clone</span><span class="p">(),</span><span class="w">
</span><span class="w">            </span><span class="c1">// etc
</span><span class="c1"></span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><code>Clone</code> ä¹Ÿå¯ä»¥åœ¨æ³›å‹ä¸Šä¸‹æ–‡ä¸­æ„å»ºä¸€ä¸ªç±»å‹çš„å®ä¾‹ã€‚ä¸‹é¢æ˜¯ä¸Šä¸€èŠ‚ä¸­çš„ä¸€ä¸ªä¾‹å­ï¼Œé™¤äº†ä½¿ç”¨ <code>Clone</code> è€Œä¸æ˜¯ <code>Default</code>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">guarantee_length</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nb">Clone</span><span class="o">&gt;</span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">vec</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">min_len</span>: <span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="n">fill_with</span>: <span class="kp">&amp;</span><span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="p">..</span><span class="n">min_len</span><span class="p">.</span><span class="n">saturating_sub</span><span class="p">(</span><span class="n">vec</span><span class="p">.</span><span class="n">len</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">vec</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">fill_with</span><span class="p">.</span><span class="n">clone</span><span class="p">());</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="n">vec</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>äººä»¬ä¹Ÿç»å¸¸ä½¿ç”¨å…‹éš†ä½œä¸ºé€ƒé¿çš„æ–¹æ³•ï¼Œä»¥é¿å…ä¸å€Ÿç”¨æ£€æŸ¥å™¨æ‰“äº¤é“ã€‚ç®¡ç†å¸¦æœ‰å¼•ç”¨çš„ç»“æ„ä½“å¯èƒ½å¾ˆæœ‰æŒ‘æˆ˜æ€§ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡å…‹éš†å°†å¼•ç”¨å˜æˆè‡ªæœ‰å€¼(owned values)ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="c1">// oof, we gotta worry about lifetimes ğŸ˜Ÿ
</span><span class="c1"></span><span class="k">struct</span> <span class="nc">SomeStruct</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">data</span>: <span class="kp">&amp;</span><span class="na">&#39;a</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// now we&#39;re on easy street ğŸ˜
</span><span class="c1"></span><span class="k">struct</span> <span class="nc">SomeStruct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">data</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>å¦‚æœæˆ‘ä»¬æ­£åœ¨å¼€å‘çš„ç¨‹åºçš„æ€§èƒ½ä¸æ˜¯æœ€é‡è¦çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸éœ€è¦ä¸ºå…‹éš†æ•°æ®è€Œçƒ¦æ¼ã€‚Rust æ˜¯ä¸€ç§ä½çº§åˆ«çš„è¯­è¨€ï¼Œæš´éœ²äº†å¾ˆå¤šä½çº§åˆ«çš„ç»†èŠ‚ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“è¢«è¿‡æ—©çš„ä¼˜åŒ–æ‰€å¸å¼•ï¼Œè€Œä¸æ˜¯çœŸæ­£è§£å†³æ‰‹å¤´çš„é—®é¢˜ã€‚å¯¹äºè®¸å¤šç¨‹åºæ¥è¯´ï¼Œæœ€å¥½çš„ä¼˜å…ˆé¡ºåºé€šå¸¸æ˜¯é¦–å…ˆå»ºç«‹æ­£ç¡®æ€§ï¼Œå…¶æ¬¡æ˜¯ä¼˜é›…æ€§ï¼Œç¬¬ä¸‰æ˜¯æ€§èƒ½ï¼Œåªæœ‰åœ¨å¯¹ç¨‹åºè¿›è¡Œå‰–æå¹¶ç¡®å®šäº†æ€§èƒ½ç“¶é¢ˆä¹‹åæ‰å…³æ³¨æ€§èƒ½ã€‚è¿™æ˜¯å¾ˆå¥½çš„ä¸€èˆ¬æ€§å»ºè®®ï¼Œå¦‚æœå®ƒä¸é€‚ç”¨äºä½ çš„ç‰¹å®šç¨‹åºï¼Œä½ å°±ä¼šçŸ¥é“ã€‚</p>
<h3 id="copy">Copy</h3>
<p>é¢„å¤‡çŸ¥è¯†</p>
<ul>
<li><a href="#marker-traits">Marker Traits</a></li>
<li><a href="#subtraits--supertraits">Subtraits &amp; Supertraits</a></li>
<li><a href="#derive-macros">Derive Macros</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="nb">Copy</span>: <span class="nb">Clone</span> <span class="p">{}</span><span class="w">
</span></code></pre></div><p>æˆ‘ä»¬å¤åˆ¶ <code>Copy</code> ç±»å‹ï¼Œä¾‹å¦‚ï¼š<code>T</code> -&gt; <code>T</code>ã€‚<code>Copy</code> æ‰¿è¯ºå¤åˆ¶æ“ä½œå°†æ˜¯ä¸€ä¸ªç®€å•çš„æŒ‰ä½(bitwise)æ‹·è´ï¼Œæ‰€ä»¥å®ƒå°†æ˜¯éå¸¸å¿«é€Ÿå’Œé«˜æ•ˆçš„ã€‚æˆ‘ä»¬ä¸èƒ½è‡ªå·±å®ç° <code>Copy</code>ï¼Œåªæœ‰ç¼–è¯‘å™¨å¯ä»¥æä¾›ä¸€ä¸ªå®ç°ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ <code>Copy</code> æ´¾ç”Ÿå®ï¼Œä»¥åŠ <code>Clone</code> æ´¾ç”Ÿå®æ¥å‘Šè¯‰ç¼–è¯‘å™¨è¿™æ ·åšï¼Œå› ä¸º <code>Copy</code> æ˜¯ <code>Clone</code> çš„ä¸€ä¸ªå­ traitã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="cp">#[derive(Copy, Clone)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">SomeType</span><span class="p">;</span><span class="w">
</span></code></pre></div><p><code>Copy</code> å®Œå–„äº†(refine) <code>Clone</code>ã€‚<code>Clone</code> å¯èƒ½æ˜¯ç¼“æ…¢å’Œæ˜‚è´µçš„ï¼Œä½† <code>Copy</code> ä¿è¯æ˜¯å¿«é€Ÿå’Œä¾¿å®œçš„ï¼Œæ‰€ä»¥ <code>Copy</code> åªæ˜¯ä¸€ä¸ªå¿«é€Ÿ <code>Clone</code>ã€‚å¦‚æœä¸€ä¸ªç±»å‹å®ç°äº† <code>Copy</code>ï¼Œè¿™å°±ä½¿å¾— <code>Clone</code> çš„å®ç°å˜å¾—å¾®ä¸è¶³é“äº†ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="c1">// this is what the derive macro generates
</span><span class="c1"></span><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nb">Copy</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">Clone</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// the clone method becomes just a copy
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">clone</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="o">*</span><span class="bp">self</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>å½“ä¸€ä¸ªç±»å‹è¢«ç§»åŠ¨æ—¶ï¼Œå®ç°è¯¥ç±»å‹çš„ <code>Copy</code> ä¼šæ”¹å˜å…¶è¡Œä¸ºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç±»å‹éƒ½æœ‰â€œç§»åŠ¨è¯­ä¹‰â€ï¼Œä½†æ˜¯ä¸€æ—¦ä¸€ä¸ªç±»å‹å®ç°äº† `Copy'ï¼Œå®ƒå°±ä¼šå¾—åˆ°â€œå¤åˆ¶è¯­ä¹‰â€ã€‚ä¸ºäº†è§£é‡Šè¿™ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™äº›ç®€å•çš„åœºæ™¯ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="c1">// a &#34;move&#34;, src: !Copy
</span><span class="c1"></span><span class="kd">let</span><span class="w"> </span><span class="n">dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src</span><span class="p">;</span><span class="w"> 
</span><span class="w">
</span><span class="w"></span><span class="c1">// a &#34;copy&#34;, src: Copy
</span><span class="c1"></span><span class="kd">let</span><span class="w"> </span><span class="n">dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">src</span><span class="p">;</span><span class="w">
</span></code></pre></div><p>åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œ<code>dest = src</code> å¯¹ <code>src</code> çš„å†…å®¹è¿›è¡Œç®€å•çš„æŒ‰ä½å¤åˆ¶ï¼Œå¹¶å°†ç»“æœç§»åŠ¨åˆ° <code>dest</code> ä¸­ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œåœ¨â€œç§»åŠ¨â€çš„æƒ…å†µä¸‹ï¼Œå€Ÿç”¨æ£€æŸ¥å™¨ä½¿ <code>src</code> å˜é‡æ— æ•ˆï¼Œå¹¶ç¡®ä¿å®ƒä»¥åä¸ä¼šè¢«ç”¨äºå…¶ä»–åœ°æ–¹ï¼Œè€Œåœ¨â€œå¤åˆ¶â€çš„æƒ…å†µä¸‹ï¼Œ<code>src</code> ä»ç„¶æœ‰æ•ˆå¹¶å¯ä½¿ç”¨ã€‚</p>
<p>ä¸€è¨€ä»¥è”½ä¹‹ã€‚æ‹·è´å°±â€œæ˜¯â€ç§»åŠ¨ã€‚ç§»åŠ¨å°±â€œæ˜¯â€æ‹·è´ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯å€Ÿç”¨æ£€æŸ¥å™¨å¯¹å®ƒä»¬çš„å¤„ç†æ–¹å¼ã€‚</p>
<p>å…³äºç§»åŠ¨çš„ä¸€ä¸ªæ›´å…·ä½“çš„ä¾‹å­ï¼Œå‡è®¾ <code>src</code> æ˜¯ä¸€ä¸ª <code>Vec&lt;i32&gt;</code>ï¼Œå…¶å†…å®¹æ˜¯è¿™æ ·çš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="p">{</span><span class="w"> </span><span class="n">data</span>: <span class="o">*</span><span class="k">mut</span><span class="w"> </span><span class="p">[</span><span class="kt">i32</span><span class="p">],</span><span class="w"> </span><span class="n">length</span>: <span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="n">capacity</span>: <span class="kt">usize</span> <span class="p">}</span><span class="w">
</span></code></pre></div><p>å½“æˆ‘ä»¬å†™ä¸‹ <code>dest = src</code> æ—¶ï¼Œæˆ‘ä»¬çš„ç»“æœæ˜¯ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">data</span>: <span class="o">*</span><span class="k">mut</span><span class="w"> </span><span class="p">[</span><span class="kt">i32</span><span class="p">],</span><span class="w"> </span><span class="n">length</span>: <span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="n">capacity</span>: <span class="kt">usize</span> <span class="p">}</span><span class="w">
</span><span class="w"></span><span class="n">dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">data</span>: <span class="o">*</span><span class="k">mut</span><span class="w"> </span><span class="p">[</span><span class="kt">i32</span><span class="p">],</span><span class="w"> </span><span class="n">length</span>: <span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="n">capacity</span>: <span class="kt">usize</span> <span class="p">}</span><span class="w">
</span></code></pre></div><p>è¿™ä¸ªæ—¶å€™ï¼Œ<code>src</code> å’Œ <code>dest</code> éƒ½æœ‰å¯¹ç›¸åŒæ•°æ®çš„åˆ«åå¯å˜å¼•ç”¨ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤§å¿Œï¼Œæ‰€ä»¥å€Ÿç”¨æ£€æŸ¥å™¨ä½¿ <code>src</code> å˜é‡æ— æ•ˆï¼Œè¿™æ ·å®ƒå°±ä¸èƒ½å†è¢«ä½¿ç”¨è€Œä¸ä¼šäº§ç”Ÿç¼–è¯‘é”™è¯¯ã€‚</p>
<p>å¯¹äºä¸€ä¸ªæ›´å…·ä½“çš„æ‹·è´ä¾‹å­ï¼Œå‡è®¾ <code>src</code> æ˜¯ä¸€ä¸ª <code>Option&lt;i32&gt;</code>ï¼Œå®ƒçš„å†…å®¹æ˜¯è¿™æ ·çš„ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="p">{</span><span class="w"> </span><span class="n">is_valid</span>: <span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="n">data</span>: <span class="kt">i32</span> <span class="p">}</span><span class="w">
</span></code></pre></div><p>ç°åœ¨ï¼Œå½“æˆ‘ä»¬å†™ä¸‹ <code>dest = src</code> æ—¶ï¼Œæˆ‘ä»¬çš„ç»“æœæ˜¯ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="n">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">is_valid</span>: <span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="n">data</span>: <span class="kt">i32</span> <span class="p">}</span><span class="w">
</span><span class="w"></span><span class="n">dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">is_valid</span>: <span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="n">data</span>: <span class="kt">i32</span> <span class="p">}</span><span class="w">
</span></code></pre></div><p>è¿™äº›éƒ½æ˜¯å¯ä»¥åŒæ—¶ä½¿ç”¨çš„! å› æ­¤ <code>Option&lt;i32&gt;</code> æ˜¯å¯ä»¥ <code>Copy</code> çš„ã€‚</p>
<p>è™½ç„¶ <code>Copy</code> å¯ä»¥æ˜¯ä¸€ä¸ªè‡ªåŠ¨ traitï¼Œä½† Rust è¯­è¨€çš„è®¾è®¡è€…å†³å®šè®©ç±»å‹æ˜¾å¼åœ°é€‰æ‹©å¤åˆ¶è¯­ä¹‰ï¼Œè€Œä¸æ˜¯åœ¨ç±»å‹ç¬¦åˆæ¡ä»¶æ—¶é»˜é»˜åœ°ç»§æ‰¿å¤åˆ¶è¯­ä¹‰ï¼Œå› ä¸ºåè€…ä¼šå¯¼è‡´ä»¤äººæƒŠè®¶çš„æ··ä¹±è¡Œä¸ºï¼Œç»å¸¸å¯¼è‡´é”™è¯¯ã€‚</p>
<h3 id="any">Any</h3>
<p>é¢„å¤‡çŸ¥è¯†</p>
<ul>
<li><a href="#self">Self</a></li>
<li><a href="#generic-blanket-impls">Generic Blanket Impls</a></li>
<li><a href="#subtraits--supertraits">Subtraits &amp; Supertraits</a></li>
<li><a href="#trait-objects">Trait Objects</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">Any</span>: <span class="nb">&#39;static</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">type_id</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">TypeId</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>Rust çš„å¤šæ€æ€§é£æ ¼æ˜¯å‚æ•°åŒ–çš„ï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨ç±»ä¼¼äºåŠ¨æ€ç±»å‹è¯­è¨€çš„å¤šæ€æ€§é£æ ¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>Any</code> trait æ¥æ¨¡ä»¿ã€‚æˆ‘ä»¬ä¸éœ€è¦ä¸ºæˆ‘ä»¬çš„ç±»å‹æ‰‹åŠ¨å®ç°è¿™ä¸ª traitï¼Œå› ä¸ºä¸‹é¢è¿™ä¸ªæ³›å‹å…¨é¢å®ç°å·²ç»è¦†ç›–äº†ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nb">&#39;static</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">?</span><span class="nb">Sized</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Any</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">type_id</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">TypeId</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">TypeId</span>::<span class="n">of</span>::<span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">()</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>æˆ‘ä»¬ä» <code>dyn Any</code> ä¸­å¾—åˆ° <code>T</code> çš„æ–¹æ³•æ˜¯é€šè¿‡ä½¿ç”¨ <code>downcast_ref::&lt;T&gt;()</code> å’Œ <code>downcast_mut::&lt;T&gt;()</code> æ–¹æ³•ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">any</span>::<span class="n">Any</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[derive(Default)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">inc</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">map_any</span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">any</span>: <span class="nb">Box</span><span class="o">&lt;</span><span class="n">dyn</span><span class="w"> </span><span class="n">Any</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Box</span><span class="o">&lt;</span><span class="n">dyn</span><span class="w"> </span><span class="n">Any</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">num</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">any</span><span class="p">.</span><span class="n">downcast_mut</span>::<span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="o">*</span><span class="n">num</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">any</span><span class="p">.</span><span class="n">downcast_mut</span>::<span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="o">*</span><span class="n">string</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&#34;!&#34;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">point</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">any</span><span class="p">.</span><span class="n">downcast_mut</span>::<span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">point</span><span class="p">.</span><span class="n">inc</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="n">any</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">vec</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">Box</span><span class="o">&lt;</span><span class="n">dyn</span><span class="w"> </span><span class="n">Any</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="w">
</span><span class="w">        </span><span class="nb">Box</span>::<span class="n">new</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w">
</span><span class="w">        </span><span class="nb">Box</span>::<span class="n">new</span><span class="p">(</span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">&#34;a&#34;</span><span class="p">)),</span><span class="w">
</span><span class="w">        </span><span class="nb">Box</span>::<span class="n">new</span><span class="p">(</span><span class="n">Point</span>::<span class="n">default</span><span class="p">()),</span><span class="w">
</span><span class="w">    </span><span class="p">];</span><span class="w">
</span><span class="w">    </span><span class="c1">// vec = [0, &#34;a&#34;, Point { x: 0, y: 0 }]
</span><span class="c1"></span><span class="w">    </span><span class="n">vec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="p">.</span><span class="n">into_iter</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="n">map_any</span><span class="p">).</span><span class="n">collect</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="c1">// vec = [1, &#34;a!&#34;, Point { x: 1, y: 1 }]
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>è¿™ä¸ª trait å¾ˆå°‘éœ€è¦ä½¿ç”¨ï¼Œå› ä¸ºåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå‚æ•°åŒ–å¤šæ€æ€§è¦ä¼˜äºä¸´æ—¶å¤šæ€æ€§ï¼Œåè€…ä¹Ÿå¯ä»¥ç”¨æšä¸¾æ¥æ¨¡æ‹Ÿï¼Œå› ä¸ºæšä¸¾çš„ç±»å‹æ›´å®‰å…¨ï¼Œéœ€è¦çš„è¿‚å›æ›´å°‘ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸Šé¢çš„ä¾‹å­å†™æˆè¿™æ ·ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="cp">#[derive(Default)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">inc</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">enum</span> <span class="nc">Stuff</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">Integer</span><span class="p">(</span><span class="kt">i32</span><span class="p">),</span><span class="w">
</span><span class="w">    </span><span class="nb">String</span><span class="p">(</span><span class="nb">String</span><span class="p">),</span><span class="w">
</span><span class="w">    </span><span class="n">Point</span><span class="p">(</span><span class="n">Point</span><span class="p">),</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">map_stuff</span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">stuff</span>: <span class="nc">Stuff</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Stuff</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">stuff</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Stuff</span>::<span class="n">Integer</span><span class="p">(</span><span class="n">num</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">*</span><span class="n">num</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">Stuff</span>::<span class="nb">String</span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">*</span><span class="n">string</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="s">&#34;!&#34;</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">Stuff</span>::<span class="n">Point</span><span class="p">(</span><span class="n">point</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">point</span><span class="p">.</span><span class="n">inc</span><span class="p">(),</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="n">stuff</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">vec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="w">
</span><span class="w">        </span><span class="n">Stuff</span>::<span class="n">Integer</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="w">
</span><span class="w">        </span><span class="n">Stuff</span>::<span class="nb">String</span><span class="p">(</span><span class="nb">String</span>::<span class="n">from</span><span class="p">(</span><span class="s">&#34;a&#34;</span><span class="p">)),</span><span class="w">
</span><span class="w">        </span><span class="n">Stuff</span>::<span class="n">Point</span><span class="p">(</span><span class="n">Point</span>::<span class="n">default</span><span class="p">()),</span><span class="w">
</span><span class="w">    </span><span class="p">];</span><span class="w">
</span><span class="w">    </span><span class="c1">// vec = [0, &#34;a&#34;, Point { x: 0, y: 0 }]
</span><span class="c1"></span><span class="w">    </span><span class="n">vec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="p">.</span><span class="n">into_iter</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="n">map_stuff</span><span class="p">).</span><span class="n">collect</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="c1">// vec = [1, &#34;a!&#34;, Point { x: 1, y: 1 }]
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>å°½ç®¡ <code>Any</code> å¾ˆå°‘è¢«éœ€è¦ï¼Œä½†æœ‰æ—¶ä½¿ç”¨èµ·æ¥è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œæˆ‘ä»¬å°†åœ¨åé¢çš„â€œé”™è¯¯å¤„ç†â€éƒ¨åˆ†çœ‹åˆ°ã€‚</p>
<h2 id="formatting-traits">Formatting Traits</h2>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>std::fmt</code> ä¸­çš„æ ¼å¼åŒ–å®å°†ç±»å‹åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œå…¶ä¸­æœ€è‘—åçš„æ˜¯ <code>println!</code>ã€‚æˆ‘ä»¬å¯ä»¥å°†æ ¼å¼åŒ–å‚æ•°ä¼ é€’ç»™æ ¼å¼ <code>str</code> ä¸­ä½¿ç”¨çš„ <code>{}</code> å ä½ç¬¦ï¼Œç„¶åç”¨æ¥é€‰æ‹©ä½¿ç”¨å“ªä¸ª trait å®ç°æ¥åºåˆ—åŒ–å ä½ç¬¦çš„å‚æ•°ã€‚</p>
<table>
<thead>
<tr>
<th>Trait</th>
<th>Placeholder</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Display</code></td>
<td><code>{}</code></td>
<td>display representation</td>
</tr>
<tr>
<td><code>Debug</code></td>
<td><code>{:?}</code></td>
<td>debug representation</td>
</tr>
<tr>
<td><code>Octal</code></td>
<td><code>{:o}</code></td>
<td>octal representation</td>
</tr>
<tr>
<td><code>LowerHex</code></td>
<td><code>{:x}</code></td>
<td>lowercase hex representation</td>
</tr>
<tr>
<td><code>UpperHex</code></td>
<td><code>{:X}</code></td>
<td>uppercase hex representation</td>
</tr>
<tr>
<td><code>Pointer</code></td>
<td><code>{:p}</code></td>
<td>memory address</td>
</tr>
<tr>
<td><code>Binary</code></td>
<td><code>{:b}</code></td>
<td>binary representation</td>
</tr>
<tr>
<td><code>LowerExp</code></td>
<td><code>{:e}</code></td>
<td>lowercase exponential representation</td>
</tr>
<tr>
<td><code>UpperExp</code></td>
<td><code>{:E}</code></td>
<td>uppercase exponential representation</td>
</tr>
</tbody>
</table>
<h3 id="display--tostring">Display &amp; ToString</h3>
<p>é¢„å¤‡çŸ¥è¯†</p>
<ul>
<li><a href="#self">Self</a></li>
<li><a href="#methods">Methods</a></li>
<li><a href="#generic-blanket-impls">Generic Blanket Impls</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">Display</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">fmt</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Formatter</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><code>Display</code> ç±»å‹å¯ä»¥è¢«åºåˆ—åŒ–ä¸º <code>String</code>ï¼Œè¿™å¯¹ç¨‹åºçš„ç»ˆç«¯ç”¨æˆ·å¾ˆå‹å¥½ã€‚ä¾‹å¦‚ï¼Œç»™ <code>Point</code> å®ç° <code>Display</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">fmt</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[derive(Default)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">fmt</span>::<span class="n">Display</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">fmt</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">fmt</span>::<span class="n">Formatter</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">fmt</span>::<span class="nb">Result</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">write</span><span class="o">!</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;({}, {})&#34;</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;origin: {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">Point</span>::<span class="n">default</span><span class="p">());</span><span class="w">
</span><span class="w">    </span><span class="c1">// prints &#34;origin: (0, 0)&#34;
</span><span class="c1"></span><span class="w">
</span><span class="w">    </span><span class="c1">// get Point&#39;s Display representation as a String
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">stringified_point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">format</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">Point</span>::<span class="n">default</span><span class="p">());</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;(0, 0)&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">stringified_point</span><span class="p">);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>é™¤äº†ä½¿ç”¨ <code>format!</code> å®æ¥è·å¾—ä¸€ä¸ªç±»å‹çš„æ˜¾ç¤ºè¡¨ç¤ºä¸º <code>String</code> ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ <code>ToString</code> traitã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="nb">ToString</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">to_string</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">String</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>æˆ‘ä»¬æ²¡æœ‰å¿…è¦è‡ªå·±å»å®ç°è¿™ä¸ª traitã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬ä¸èƒ½è¿™æ ·åšï¼Œå› ä¸ºä¸‹é¢è¿™ä¸ªæ³›å‹å…¨é¢å®ç°ï¼Œå¯¹äºä»»ä½•å®ç° <code>Display</code> çš„ç±»å‹ï¼Œéƒ½è‡ªåŠ¨å®ç° <code>ToString</code>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nc">Display</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">?</span><span class="nb">Sized</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">ToString</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">T</span><span class="p">;</span><span class="w">
</span></code></pre></div><p>å°† <code>ToString</code> ä¸ <code>Point</code> ä¸€èµ·ä½¿ç”¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="cp">#[test]</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">display_point</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span>::<span class="n">default</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">format</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">origin</span><span class="p">),</span><span class="w"> </span><span class="s">&#34;(0, 0)&#34;</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[test]</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">point_to_string</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span>::<span class="n">default</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">origin</span><span class="p">.</span><span class="n">to_string</span><span class="p">(),</span><span class="w"> </span><span class="s">&#34;(0, 0)&#34;</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[test]</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">display_equals_to_string</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span>::<span class="n">default</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">format</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">origin</span><span class="p">),</span><span class="w"> </span><span class="n">origin</span><span class="p">.</span><span class="n">to_string</span><span class="p">());</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id="debug">Debug</h3>
<p>é¢„å¤‡çŸ¥è¯†</p>
<ul>
<li><a href="#self">Self</a></li>
<li><a href="#methods">Methods</a></li>
<li><a href="#derive-macros">Derive Macros</a></li>
<li><a href="#display--tostring">Display &amp; ToString</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">Debug</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">fmt</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Formatter</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><code>Debug</code> ä¸ <code>Display</code> æœ‰ç›¸åŒçš„ç­¾åã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ <code>{:?}</code> æ ¼å¼ç¬¦æ—¶ï¼Œ<code>Debug</code> å®ç°è¢«è°ƒç”¨ã€‚`Debug' å¯ä»¥è¢«æ´¾ç”Ÿã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">fmt</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[derive(Debug)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// derive macro generates impl below
</span><span class="c1"></span><span class="k">impl</span><span class="w"> </span><span class="n">fmt</span>::<span class="n">Debug</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">fmt</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">fmt</span>::<span class="n">Formatter</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">fmt</span>::<span class="nb">Result</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">f</span><span class="p">.</span><span class="n">debug_struct</span><span class="p">(</span><span class="s">&#34;Point&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">            </span><span class="p">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#34;x&#34;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="w">
</span><span class="w">            </span><span class="p">.</span><span class="n">field</span><span class="p">(</span><span class="s">&#34;y&#34;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="w">            </span><span class="p">.</span><span class="n">finish</span><span class="p">()</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>ä¸ºä¸€ä¸ªç±»å‹å®ç° <code>Debug</code> ä¹Ÿå…è®¸å®ƒåœ¨ <code>dbg!</code> å®ä¸­ä½¿ç”¨ï¼Œè¿™æ¯” <code>println!</code> æ›´æœ‰åˆ©äºä¸´æ—¶åº”æ€¥çš„æ‰“å°æ—¥å¿—ã€‚å®ƒçš„ä¸€äº›ä¼˜ç‚¹å¦‚ä¸‹:</p>
<ol>
<li><code>dbg!</code> æ‰“å°åˆ° stderr è€Œä¸æ˜¯ stdoutï¼Œæ‰€ä»¥è°ƒè¯•æ—¥å¿—å¾ˆå®¹æ˜“ä¸æˆ‘ä»¬ç¨‹åºçš„å®é™… stdout è¾“å‡ºåˆ†å¼€ã€‚</li>
<li><code>dbg!</code> æ‰“å°ä¼ é€’ç»™å®ƒçš„è¡¨è¾¾å¼ï¼Œä»¥åŠè¡¨è¾¾å¼æ‰€è¯„ä¼°çš„å€¼ã€‚</li>
<li><code>dbg!</code> æ‹¥æœ‰å…¶å‚æ•°çš„æ‰€æœ‰æƒï¼Œå¹¶è¿”å›è¿™äº›å‚æ•°ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨å®ƒã€‚</li>
</ol>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">some_condition</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kc">true</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// no logging
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">example</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">some_condition</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="c1">// some code
</span><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// println! logging
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">example_println</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// ğŸ¤¦
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">some_condition</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;{}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">);</span><span class="w"> </span><span class="c1">// just prints &#34;true&#34;
</span><span class="c1"></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="c1">// some code
</span><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// dbg! logging
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">example_dbg</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// ğŸ˜
</span><span class="c1"></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">dbg</span><span class="o">!</span><span class="p">(</span><span class="n">some_condition</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// prints &#34;[src/main.rs:22] some_condition() = true&#34;
</span><span class="c1"></span><span class="w">        </span><span class="c1">// some code
</span><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>å”¯ä¸€çš„ç¼ºç‚¹æ˜¯ï¼Œ<code>dbg!</code> åœ¨å‘å¸ƒç‰ˆæœ¬ä¸­ä¸ä¼šè¢«è‡ªåŠ¨å‰¥ç¦»ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬ä¸æƒ³åœ¨æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ä½¿ç”¨å®ƒï¼Œå°±å¿…é¡»ä»æˆ‘ä»¬çš„ä»£ç ä¸­æ‰‹åŠ¨åˆ é™¤å®ƒã€‚</p>
<h2 id="operator-traits">Operator Traits</h2>
<p>Rust ä¸­çš„æ‰€æœ‰è¿ç®—ç¬¦éƒ½ä¸ trait ç›¸å…³ã€‚å¦‚æœæˆ‘ä»¬æƒ³ä¸ºæˆ‘ä»¬çš„ç±»å‹å®ç°è¿ç®—ç¬¦ï¼Œå°±å¿…é¡»å®ç°ç›¸å…³çš„ traitã€‚</p>
<table>
<thead>
<tr>
<th>Trait(s)</th>
<th>Category</th>
<th>Operator(s)</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Eq</code>, <code>PartialEq</code></td>
<td>comparison</td>
<td><code>==</code></td>
<td>equality</td>
</tr>
<tr>
<td><code>Ord</code>, <code>PartialOrd</code></td>
<td>comparison</td>
<td><code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code></td>
<td>comparison</td>
</tr>
<tr>
<td><code>Add</code></td>
<td>arithmetic</td>
<td><code>+</code></td>
<td>addition</td>
</tr>
<tr>
<td><code>AddAssign</code></td>
<td>arithmetic</td>
<td><code>+=</code></td>
<td>addition assignment</td>
</tr>
<tr>
<td><code>BitAnd</code></td>
<td>arithmetic</td>
<td><code>&amp;</code></td>
<td>bitwise AND</td>
</tr>
<tr>
<td><code>BitAndAssign</code></td>
<td>arithmetic</td>
<td><code>&amp;=</code></td>
<td>bitwise assignment</td>
</tr>
<tr>
<td><code>BitXor</code></td>
<td>arithmetic</td>
<td><code>^</code></td>
<td>bitwise XOR</td>
</tr>
<tr>
<td><code>BitXorAssign</code></td>
<td>arithmetic</td>
<td><code>^=</code></td>
<td>bitwise XOR assignment</td>
</tr>
<tr>
<td><code>Div</code></td>
<td>arithmetic</td>
<td><code>/</code></td>
<td>division</td>
</tr>
<tr>
<td><code>DivAssign</code></td>
<td>arithmetic</td>
<td><code>/=</code></td>
<td>division assignment</td>
</tr>
<tr>
<td><code>Mul</code></td>
<td>arithmetic</td>
<td><code>*</code></td>
<td>multiplication</td>
</tr>
<tr>
<td><code>MulAssign</code></td>
<td>arithmetic</td>
<td><code>*=</code></td>
<td>multiplication assignment</td>
</tr>
<tr>
<td><code>Neg</code></td>
<td>arithmetic</td>
<td><code>-</code></td>
<td>unary negation</td>
</tr>
<tr>
<td><code>Not</code></td>
<td>arithmetic</td>
<td><code>!</code></td>
<td>unary logical negation</td>
</tr>
<tr>
<td><code>Rem</code></td>
<td>arithmetic</td>
<td><code>%</code></td>
<td>remainder</td>
</tr>
<tr>
<td><code>RemAssign</code></td>
<td>arithmetic</td>
<td><code>%=</code></td>
<td>remainder assignment</td>
</tr>
<tr>
<td><code>Shl</code></td>
<td>arithmetic</td>
<td><code>&lt;&lt;</code></td>
<td>left shift</td>
</tr>
<tr>
<td><code>ShlAssign</code></td>
<td>arithmetic</td>
<td><code>&lt;&lt;=</code></td>
<td>left shift assignment</td>
</tr>
<tr>
<td><code>Shr</code></td>
<td>arithmetic</td>
<td><code>&gt;&gt;</code></td>
<td>right shift</td>
</tr>
<tr>
<td><code>ShrAssign</code></td>
<td>arithmetic</td>
<td><code>&gt;&gt;=</code></td>
<td>right shift assignment</td>
</tr>
<tr>
<td><code>Sub</code></td>
<td>arithmetic</td>
<td><code>-</code></td>
<td>subtraction</td>
</tr>
<tr>
<td><code>SubAssign</code></td>
<td>arithmetic</td>
<td><code>-=</code></td>
<td>subtraction assignment</td>
</tr>
<tr>
<td><code>Fn</code></td>
<td>closure</td>
<td><code>(...args)</code></td>
<td>immutable closure invocation</td>
</tr>
<tr>
<td><code>FnMut</code></td>
<td>closure</td>
<td><code>(...args)</code></td>
<td>mutable closure invocation</td>
</tr>
<tr>
<td><code>FnOnce</code></td>
<td>closure</td>
<td><code>(...args)</code></td>
<td>one-time closure invocation</td>
</tr>
<tr>
<td><code>Deref</code></td>
<td>other</td>
<td><code>*</code></td>
<td>immutable dereference</td>
</tr>
<tr>
<td><code>DerefMut</code></td>
<td>other</td>
<td><code>*</code></td>
<td>mutable derenence</td>
</tr>
<tr>
<td><code>Drop</code></td>
<td>other</td>
<td>-</td>
<td>type destructor</td>
</tr>
<tr>
<td><code>Index</code></td>
<td>other</td>
<td><code>[]</code></td>
<td>immutable index</td>
</tr>
<tr>
<td><code>IndexMut</code></td>
<td>other</td>
<td><code>[]</code></td>
<td>mutable index</td>
</tr>
<tr>
<td><code>RangeBounds</code></td>
<td>other</td>
<td><code>..</code></td>
<td>range</td>
</tr>
</tbody>
</table>
<h3 id="comparison-traits">Comparison Traits</h3>
<table>
<thead>
<tr>
<th>Trait(s)</th>
<th>Category</th>
<th>Operator(s)</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Eq</code>, <code>PartialEq</code></td>
<td>comparison</td>
<td><code>==</code></td>
<td>equality</td>
</tr>
<tr>
<td><code>Ord</code>, <code>PartialOrd</code></td>
<td>comparison</td>
<td><code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>, <code>&gt;=</code></td>
<td>comparison</td>
</tr>
</tbody>
</table>
<h4 id="partialeq--eq">PartialEq &amp; Eq</h4>
<p>é¢„å¤‡çŸ¥è¯†</p>
<ul>
<li><a href="#self">Self</a></li>
<li><a href="#methods">Methods</a></li>
<li><a href="#generic-parameters">Generic Parameters</a></li>
<li><a href="#default-impls">Default Impls</a></li>
<li><a href="#generic-blanket-impls">Generic Blanket Impls</a></li>
<li><a href="#marker-traits">Marker Traits</a></li>
<li><a href="#subtraits--supertraits">Subtraits &amp; Supertraits</a></li>
<li><a href="#sized">Sized</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="nb">PartialEq</span><span class="o">&lt;</span><span class="n">Rhs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Self</span><span class="o">&gt;</span><span class="w"> 
</span><span class="w"></span><span class="k">where</span><span class="w">
</span><span class="w">    </span><span class="n">Rhs</span>: <span class="o">?</span><span class="nb">Sized</span><span class="p">,</span><span class="w"> 
</span><span class="w"></span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">eq</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Rhs</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="c1">// provided default impls
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">ne</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Rhs</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><code>PartialEq&lt;Rhs&gt;</code> ç±»å‹å¯ä»¥ä½¿ç”¨ <code>==</code> è¿ç®—ç¬¦æ£€æŸ¥æ˜¯å¦ä¸ <code>Rhs</code> ç±»å‹ç›¸ç­‰ã€‚</p>
<p>æ‰€æœ‰çš„ <code>PartialEq&lt;Rhs&gt;</code> å®ç°å¿…é¡»ç¡®ä¿ç›¸ç­‰æ˜¯å¯¹ç§°çš„å’Œä¼ é€’çš„ã€‚è¿™æ„å‘³ç€å¯¹äºæ‰€æœ‰çš„ <code>a</code>, <code>b</code>, å’Œ <code>c</code>:</p>
<ul>
<li><code>a == b</code> æ„å‘³ç€ <code>b == a</code> (å¯¹ç§°æ€§)</li>
<li><code>a == b &amp;&amp; b == c</code> æ„å‘³ç€ <code>a == c</code> (ä¼ é€’æ€§)</li>
</ul>
<p>é»˜è®¤æƒ…å†µä¸‹ <code>Rhs = Self</code>ï¼Œå› ä¸ºæˆ‘ä»¬å‡ ä¹æ€»æ˜¯æƒ³æŠŠä¸€ä¸ªç±»å‹çš„å®ä¾‹ç›¸äº’æ¯”è¾ƒï¼Œè€Œä¸æ˜¯ä¸ä¸åŒç±»å‹çš„å®ä¾‹æ¯”è¾ƒã€‚è¿™ä¹Ÿè‡ªåŠ¨ä¿è¯äº†æˆ‘ä»¬çš„å®ç°æ˜¯å¯¹ç§°çš„å’Œä¼ é€’çš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span>
<span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// Rhs == Self == Point
</span><span class="c1"></span><span class="k">impl</span><span class="w"> </span><span class="nb">PartialEq</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// impl automatically symmetric &amp; transitive
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">eq</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Point</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">y</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>å¦‚æœä¸€ä¸ªç±»å‹çš„æ‰€æœ‰æˆå‘˜éƒ½å®ç°äº† `PartialEq'ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥è¢«æ´¾ç”Ÿã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="cp">#[derive(PartialEq)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span>
<span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[derive(PartialEq)]</span><span class="w">
</span><span class="w"></span><span class="k">enum</span> <span class="nc">Suit</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">Spade</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Heart</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Club</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Diamond</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>ä¸€æ—¦ä¸ºæˆ‘ä»¬çš„ç±»å‹å®ç°äº† <code>PartialEq</code>ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å…è´¹å¾—åˆ°æˆ‘ä»¬ç±»å‹çš„å¼•ç”¨ä¹‹é—´çš„ç›¸ç­‰æ€§æ¯”è¾ƒï¼Œè¿™è¦æ„Ÿè°¢è¿™äº›æ³›å‹å…¨é¢å®ç°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="c1">// this impl only gives us: Point == Point
</span><span class="c1"></span><span class="cp">#[derive(PartialEq)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span>
<span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// all of the generic blanket impls below
</span><span class="c1">// are provided by the standard library
</span><span class="c1"></span><span class="w">
</span><span class="w"></span><span class="c1">// this impl gives us: &amp;Point == &amp;Point
</span><span class="c1"></span><span class="k">impl</span><span class="o">&lt;</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">PartialEq</span><span class="o">&lt;&amp;</span><span class="na">&#39;_</span><span class="w"> </span><span class="n">B</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="na">&#39;_</span><span class="w"> </span><span class="n">A</span><span class="w">
</span><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">A</span>: <span class="nb">PartialEq</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">?</span><span class="nb">Sized</span><span class="p">,</span><span class="w"> </span><span class="n">B</span>: <span class="o">?</span><span class="nb">Sized</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// this impl gives us: &amp;mut Point == &amp;Point
</span><span class="c1"></span><span class="k">impl</span><span class="o">&lt;</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">PartialEq</span><span class="o">&lt;&amp;</span><span class="na">&#39;_</span><span class="w"> </span><span class="n">B</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="na">&#39;_</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">A</span><span class="w">
</span><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">A</span>: <span class="nb">PartialEq</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">?</span><span class="nb">Sized</span><span class="p">,</span><span class="w"> </span><span class="n">B</span>: <span class="o">?</span><span class="nb">Sized</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// this impl gives us: &amp;Point == &amp;mut Point
</span><span class="c1"></span><span class="k">impl</span><span class="o">&lt;</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">PartialEq</span><span class="o">&lt;&amp;</span><span class="na">&#39;_</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">B</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="na">&#39;_</span><span class="w"> </span><span class="n">A</span><span class="w">
</span><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">A</span>: <span class="nb">PartialEq</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">?</span><span class="nb">Sized</span><span class="p">,</span><span class="w"> </span><span class="n">B</span>: <span class="o">?</span><span class="nb">Sized</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// this impl gives us: &amp;mut Point == &amp;mut Point
</span><span class="c1"></span><span class="k">impl</span><span class="o">&lt;</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">PartialEq</span><span class="o">&lt;&amp;</span><span class="na">&#39;_</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">B</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="na">&#39;_</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">A</span><span class="w">
</span><span class="w"></span><span class="k">where</span><span class="w"> </span><span class="n">A</span>: <span class="nb">PartialEq</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">?</span><span class="nb">Sized</span><span class="p">,</span><span class="w"> </span><span class="n">B</span>: <span class="o">?</span><span class="nb">Sized</span><span class="p">;</span><span class="w">
</span></code></pre></div><p>ç”±äºè¿™ä¸ª trait æ˜¯æ³›å‹åŒ–çš„ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸åŒç±»å‹ä¹‹é—´çš„ç›¸ç­‰æ€§ã€‚æ ‡å‡†åº“åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œå…è®¸æ£€æŸ¥è®¸å¤šç±»ä¼¼å­—ç¬¦ä¸²çš„ç±»å‹ï¼Œå¦‚<code>String</code>ã€<code>&amp;str</code>ã€<code>PathBuf</code>ã€<code>&amp;Path</code>ã€<code>OsString</code>ã€<code>&amp;OsStr</code> ç­‰ä¹‹é—´çš„ç›¸ç­‰æ€§ã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬åªåº”è¯¥åœ¨ä¸åŒç±»å‹ä¹‹é—´å®ç°ç›¸ç­‰æ€§å…³ç³»ï¼Œå¦‚æœå®ƒä»¬å®ç°åŒä¸€ç§æ•°æ®ï¼Œå¹¶ä¸”ç±»å‹ä¹‹é—´çš„å”¯ä¸€åŒºåˆ«æ˜¯å®ƒä»¬å¦‚ä½•è¡¨ç¤ºæ•°æ®æˆ–å¦‚ä½•å…è®¸ä¸æ•°æ®è¿›è¡Œäº¤äº’ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªå¯çˆ±ä½†ç³Ÿç³•çš„ä¾‹å­ï¼Œè¯´æ˜æœ‰äººå¯èƒ½ä¼šè¢«è¯±æƒ‘å®ç° <code>PartialEq</code> æ¥æ£€æŸ¥ä¸ç¬¦åˆä¸Šè¿°æ ‡å‡†çš„ä¸åŒç±»å‹ä¹‹é—´çš„ç›¸ç­‰ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="cp">#[derive(PartialEq)]</span><span class="w">
</span><span class="w"></span><span class="k">enum</span> <span class="nc">Suit</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">Spade</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Club</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Heart</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Diamond</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[derive(PartialEq)]</span><span class="w">
</span><span class="w"></span><span class="k">enum</span> <span class="nc">Rank</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">Ace</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Two</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Three</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Four</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Five</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Six</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Seven</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Eight</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Nine</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Ten</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Jack</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Queen</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">King</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[derive(PartialEq)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Card</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">suit</span>: <span class="nc">Suit</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">rank</span>: <span class="nc">Rank</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// check equality of Card&#39;s suit
</span><span class="c1"></span><span class="k">impl</span><span class="w"> </span><span class="nb">PartialEq</span><span class="o">&lt;</span><span class="n">Suit</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Card</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">eq</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Suit</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">suit</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">*</span><span class="n">other</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// check equality of Card&#39;s rank
</span><span class="c1"></span><span class="k">impl</span><span class="w"> </span><span class="nb">PartialEq</span><span class="o">&lt;</span><span class="n">Rank</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Card</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">eq</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Rank</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">rank</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">*</span><span class="n">other</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">AceOfSpades</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Card</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">suit</span>: <span class="nc">Suit</span>::<span class="n">Spade</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">rank</span>: <span class="nc">Rank</span>::<span class="n">Ace</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="n">assert</span><span class="o">!</span><span class="p">(</span><span class="n">AceOfSpades</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Suit</span>::<span class="n">Spade</span><span class="p">);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">    </span><span class="n">assert</span><span class="o">!</span><span class="p">(</span><span class="n">AceOfSpades</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Rank</span>::<span class="n">Ace</span><span class="p">);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>è¿™å¾ˆæœ‰æ•ˆï¼Œè€Œä¸”æœ‰ç‚¹é“ç†ã€‚ä¸€å¼ é»‘æ¡ƒAçš„ç‰Œæ—¢æ˜¯Aåˆæ˜¯é»‘æ¡ƒï¼Œå¦‚æœæˆ‘ä»¬è¦å†™ä¸€ä¸ªå¤„ç†æ‰‘å…‹ç‰Œçš„åº“ï¼Œé‚£ä¹ˆæˆ‘ä»¬æƒ³è®©å®ƒç®€å•æ–¹ä¾¿åœ°å•ç‹¬æ£€æŸ¥ä¸€å¼ ç‰Œçš„èŠ±è‰²å’Œç­‰çº§æ˜¯åˆç†çš„ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬è¿˜ç¼ºå°‘ä¸€äº›ä¸œè¥¿ï¼šå¯¹ç§°æ€§ã€‚ æˆ‘ä»¬å¯ä»¥ <code>Card == Suit</code> å’Œ <code>Card == Rank</code>ï¼Œä½†æˆ‘ä»¬ä¸èƒ½ <code>Suit == Card</code> æˆ– <code>Rank == Card</code>ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="c1">// check equality of Card&#39;s suit
</span><span class="c1"></span><span class="k">impl</span><span class="w"> </span><span class="nb">PartialEq</span><span class="o">&lt;</span><span class="n">Suit</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Card</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">eq</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Suit</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">suit</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">*</span><span class="n">other</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// added for symmetry
</span><span class="c1"></span><span class="k">impl</span><span class="w"> </span><span class="nb">PartialEq</span><span class="o">&lt;</span><span class="n">Card</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Suit</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">eq</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Card</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="o">*</span><span class="bp">self</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">suit</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// check equality of Card&#39;s rank
</span><span class="c1"></span><span class="k">impl</span><span class="w"> </span><span class="nb">PartialEq</span><span class="o">&lt;</span><span class="n">Rank</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Card</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">eq</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Rank</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">rank</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">*</span><span class="n">other</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// added for symmetry
</span><span class="c1"></span><span class="k">impl</span><span class="w"> </span><span class="nb">PartialEq</span><span class="o">&lt;</span><span class="n">Card</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Rank</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">eq</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Card</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="o">*</span><span class="bp">self</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">rank</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>æˆ‘ä»¬æœ‰å¯¹ç§°æ€§! å¤ªå¥½äº†ã€‚å¢åŠ å¯¹ç§°æ€§åªæ˜¯æ‰“ç ´äº†ä¼ é€’æ€§ï¼è¿™æ˜¯ä¸å¯èƒ½çš„ã€‚å“å‘€ã€‚ç°åœ¨å¯ä»¥è¿™æ ·äº†ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// Ace of Spades
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Card</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">suit</span>: <span class="nc">Suit</span>::<span class="n">Spade</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">rank</span>: <span class="nc">Rank</span>::<span class="n">Ace</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Suit</span>::<span class="n">Spade</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="c1">// King of Spades
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Card</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">suit</span>: <span class="nc">Suit</span>::<span class="n">Spade</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">rank</span>: <span class="nc">Rank</span>::<span class="n">King</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="n">assert</span><span class="o">!</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">c</span><span class="p">);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">    </span><span class="n">assert</span><span class="o">!</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">c</span><span class="p">);</span><span class="w"> </span><span class="c1">// âŒ
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>å®ç° <code>PartialEq</code> ä»¥æ£€æŸ¥ä¸åŒç±»å‹ä¹‹é—´çš„ç›¸ç­‰å…³ç³»çš„ä¸€ä¸ªå¥½ä¾‹å­æ˜¯ä¸€ä¸ªå¤„ç†è·ç¦»çš„ç¨‹åºï¼Œå®ƒä½¿ç”¨ä¸åŒçš„ç±»å‹æ¥ä»£è¡¨ä¸åŒçš„æµ‹é‡å•ä½ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="cp">#[derive(PartialEq)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Foot</span><span class="p">(</span><span class="kt">u32</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[derive(PartialEq)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Yard</span><span class="p">(</span><span class="kt">u32</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[derive(PartialEq)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Mile</span><span class="p">(</span><span class="kt">u32</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">PartialEq</span><span class="o">&lt;</span><span class="n">Mile</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Foot</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">eq</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Mile</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">5280</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">PartialEq</span><span class="o">&lt;</span><span class="n">Foot</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Mile</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">eq</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Foot</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">5280</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="mi">0</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">    
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">PartialEq</span><span class="o">&lt;</span><span class="n">Mile</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Yard</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">eq</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Mile</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1760</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">PartialEq</span><span class="o">&lt;</span><span class="n">Yard</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Mile</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">eq</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Yard</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1760</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="mi">0</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">    
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">PartialEq</span><span class="o">&lt;</span><span class="n">Foot</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Yard</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">eq</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Foot</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="mi">0</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">PartialEq</span><span class="o">&lt;</span><span class="n">Yard</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Foot</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">eq</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Yard</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="mi">0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Foot</span><span class="p">(</span><span class="mi">5280</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Yard</span><span class="p">(</span><span class="mi">1760</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mile</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="w">    
</span><span class="w">    </span><span class="c1">// symmetry
</span><span class="c1"></span><span class="w">    </span><span class="n">assert</span><span class="o">!</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">a</span><span class="p">);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">    </span><span class="n">assert</span><span class="o">!</span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">b</span><span class="p">);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">    </span><span class="n">assert</span><span class="o">!</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">a</span><span class="p">);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">
</span><span class="w">    </span><span class="c1">// transitivity
</span><span class="c1"></span><span class="w">    </span><span class="n">assert</span><span class="o">!</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">c</span><span class="p">);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">    </span><span class="n">assert</span><span class="o">!</span><span class="p">(</span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">a</span><span class="p">);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><code>Eq</code> æ˜¯ä¸€ä¸ªæ ‡è®° traitï¼Œæ˜¯ <code>PartialEq&lt;Self&gt;</code> çš„å­ traitã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="nb">Eq</span>: <span class="nb">PartialEq</span><span class="o">&lt;</span><span class="n">Self</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></code></pre></div><p>å¦‚æœæˆ‘ä»¬ä¸ºä¸€ä¸ªç±»å‹å®ç° <code>Eq</code>ï¼Œåœ¨ <code>PartialEq</code> æ‰€è¦æ±‚çš„å¯¹ç§°æ€§å’Œä¼ é€’æ€§çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬è¿˜ä¿è¯äº†è‡ªåæ€§ï¼Œå³ å¯¹æ‰€æœ‰ <code>a</code>, <code>a == a</code>ã€‚åœ¨è¿™ä¸ªæ„ä¹‰ä¸Šï¼Œ<code>Eq</code> å®Œå–„äº† <code>PartialEq</code>ï¼Œå› ä¸ºå®ƒä»£è¡¨äº†ä¸€ä¸ªæ›´ä¸¥æ ¼çš„ç›¸ç­‰æ€§ç‰ˆæœ¬ã€‚å¦‚æœä¸€ä¸ªç±»å‹çš„æ‰€æœ‰æˆå‘˜éƒ½æ˜¯<code>Eq</code> çš„ï¼Œé‚£ä¹ˆ <code>Eq</code> å®ç°å°±å¯ä»¥ä¸ºè¯¥ç±»å‹æ´¾ç”Ÿã€‚</p>
<p>æµ®ç‚¹ç±»å‹æ˜¯ <code>PartialEq</code> çš„ï¼Œä½†ä¸æ˜¯ <code>Eq</code> çš„ï¼Œå› ä¸º <code>NaN != NaN</code>ã€‚å‡ ä¹æ‰€æœ‰å…¶ä»–çš„ <code>PartialEq</code> ç±»å‹éƒ½æ˜¯ <code>Eq</code>ï¼Œå½“ç„¶ï¼Œé™¤éå®ƒä»¬åŒ…å«æµ®ç‚¹ã€‚</p>
<p>ä¸€æ—¦ä¸€ä¸ªç±»å‹å®ç°äº† <code>PartialEq</code> å’Œ <code>Debug</code>ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ <code>assert_eq!</code> å®ä¸­ä½¿ç”¨å®ƒã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æ¯”è¾ƒ <code>PartialEq</code> ç±»å‹çš„é›†åˆã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="cp">#[derive(PartialEq, Debug)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">example_assert</span><span class="p">(</span><span class="n">p1</span>: <span class="nc">Point</span><span class="p">,</span><span class="w"> </span><span class="n">p2</span>: <span class="nc">Point</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="w"> </span><span class="n">p2</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">example_compare_collections</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nb">PartialEq</span><span class="o">&gt;</span><span class="p">(</span><span class="n">vec1</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">vec2</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// if T: PartialEq this now works!
</span><span class="c1"></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">vec1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">vec2</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="c1">// some code
</span><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="c1">// other code
</span><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><h4 id="hash">Hash</h4>
<p>é¢„å¤‡çŸ¥è¯†</p>
<ul>
<li><a href="#self">Self</a></li>
<li><a href="#methods">Methods</a></li>
<li><a href="#generic-parameters">Generic Parameters</a></li>
<li><a href="#default-impls">Default Impls</a></li>
<li><a href="#derive-macros">Derive Macros</a></li>
<li><a href="#partialeq--eq">PartialEq &amp; Eq</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">Hash</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">hash</span><span class="o">&lt;</span><span class="n">H</span>: <span class="nc">Hasher</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">state</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">H</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="c1">// provided default impls
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">hash_slice</span><span class="o">&lt;</span><span class="n">H</span>: <span class="nc">Hasher</span><span class="o">&gt;</span><span class="p">(</span><span class="n">data</span>: <span class="kp">&amp;</span><span class="p">[</span><span class="n">Self</span><span class="p">],</span><span class="w"> </span><span class="n">state</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">H</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>è¿™ä¸ª trait ä¸ä»»ä½•è¿ç®—ç¬¦æ— å…³ï¼Œä½†è°ˆè®ºå®ƒçš„æœ€å¥½æ—¶æœºæ˜¯åœ¨ <code>PartialEq</code> &amp; <code>Eq</code> ä¹‹åï¼Œæ‰€ä»¥å®ƒåœ¨è¿™é‡Œã€‚<code>Hash</code> ç±»å‹å¯ä»¥ä½¿ç”¨ <code>Hasher</code> è¿›è¡Œæ•£åˆ—ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>:<span class="err">#ï¸âƒ£</span>:<span class="nc">Hasher</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>:<span class="err">#ï¸âƒ£</span>:<span class="nc">Hash</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Hash</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">hash</span><span class="o">&lt;</span><span class="n">H</span>: <span class="nc">Hasher</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">hasher</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">H</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">hasher</span><span class="p">.</span><span class="n">write_i32</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">x</span><span class="p">);</span><span class="w">
</span><span class="w">        </span><span class="n">hasher</span><span class="p">.</span><span class="n">write_i32</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">y</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>æœ‰ä¸€ä¸ªæ´¾ç”Ÿå®ï¼Œå®ƒç”Ÿæˆçš„å®ç°ä¸ä¸Šè¿°ç›¸åŒã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="cp">#[derive(Hash)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>å¦‚æœä¸€ä¸ªç±»å‹åŒæ—¶å®ç°äº† <code>Hash</code> å’Œ <code>Eq</code>ï¼Œè¿™äº›å®ç°å¿…é¡»ç›¸äº’ä¸€è‡´ï¼Œå³å¯¹äºæ‰€æœ‰çš„ <code>a</code> å’Œ <code>b</code>ï¼Œå¦‚æœ <code>a == b</code>ï¼Œé‚£ä¹ˆ <code>a.hash() == b.hash()</code>ã€‚æ‰€ä»¥æˆ‘ä»¬åº”è¯¥æ€»æ˜¯ä½¿ç”¨æ´¾ç”Ÿå®æ¥å®ç°ä¸¤è€…ï¼Œæˆ–è€…æ‰‹åŠ¨å®ç°ä¸¤è€…ï¼Œä½†ä¸èƒ½æ··åˆä½¿ç”¨ï¼Œå¦åˆ™å°±æœ‰å¯èƒ½ç ´åä¸Šè¿°ä¸å˜æ€§ã€‚</p>
<p>ä¸ºä¸€ä¸ªç±»å‹å®ç° <code>Eq</code> å’Œ <code>Hash</code> çš„ä¸»è¦å¥½å¤„æ˜¯ï¼Œå®ƒå…è®¸æˆ‘ä»¬å°†è¯¥ç±»å‹ä½œä¸ºé”®å­˜å‚¨åœ¨ <code>HashMap</code> å’Œ <code>HashSet</code> ä¸­ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">collections</span>::<span class="n">HashSet</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// now our type can be stored
</span><span class="c1">// in HashSets and HashMaps!
</span><span class="c1"></span><span class="cp">#[derive(PartialEq, Eq, Hash)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">example_hashset</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">points</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HashSet</span>::<span class="n">new</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">points</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">0</span><span class="w"> </span><span class="p">});</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><h4 id="partialord--ord">PartialOrd &amp; Ord</h4>
<p>é¢„å¤‡çŸ¥è¯†</p>
<ul>
<li><a href="#self">Self</a></li>
<li><a href="#methods">Methods</a></li>
<li><a href="#generic-parameters">Generic Parameters</a></li>
<li><a href="#default-impls">Default Impls</a></li>
<li><a href="#subtraits--supertraits">Subtraits &amp; Supertraits</a></li>
<li><a href="#derive-macros">Derive Macros</a></li>
<li><a href="#sized">Sized</a></li>
<li><a href="#partialeq--eq">PartialEq &amp; Eq</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">enum</span> <span class="nc">Ordering</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">Less</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Equal</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Greater</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">trait</span><span class="w"> </span><span class="nb">PartialOrd</span><span class="o">&lt;</span><span class="n">Rhs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Self</span><span class="o">&gt;</span>: <span class="nb">PartialEq</span><span class="o">&lt;</span><span class="n">Rhs</span><span class="o">&gt;</span><span class="w"> 
</span><span class="w"></span><span class="k">where</span><span class="w">
</span><span class="w">    </span><span class="n">Rhs</span>: <span class="o">?</span><span class="nb">Sized</span><span class="p">,</span><span class="w"> 
</span><span class="w"></span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">partial_cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Rhs</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Ordering</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="c1">// provided default impls
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">lt</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Rhs</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">le</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Rhs</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">gt</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Rhs</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">ge</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Rhs</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><code>PartialOrd&lt;Rhs&gt;</code> ç±»å‹å¯ä»¥ä½¿ç”¨ <code>&lt;</code>, <code>&lt;=</code>, <code>&gt;</code>, å’Œ <code>&gt;=</code> è¿ç®—ç¬¦ä¸ <code>Rhs</code> ç±»å‹è¿›è¡Œæ¯”è¾ƒã€‚</p>
<p>æ‰€æœ‰çš„ <code>PartialOrd</code> å®ç°å¿…é¡»ç¡®ä¿æ¯”è¾ƒæ˜¯ä¸å¯¹ç§°çš„å’Œä¼ é€’çš„ã€‚è¿™æ„å‘³ç€å¯¹äºæ‰€æœ‰çš„ <code>a</code>, <code>b</code>, å’Œ <code>c</code>:</p>
<ul>
<li><code>a &lt; b</code> æ„å‘³ç€ <code>!(a &gt; b)</code> (ä¸å¯¹ç§°æ€§)</li>
<li><code>a &lt; b &amp;&amp; b &lt; c</code> æ„å‘³ç€ <code>a &lt; c</code> (ä¼ é€’æ€§)</li>
</ul>
<p><code>PartialOrd</code> æ˜¯ <code>PartialEq</code> çš„ä¸€ä¸ªå­ traitï¼Œå®ƒä»¬çš„å®ç°å¿…é¡»æ€»æ˜¯ç›¸äº’ä¸€è‡´ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">must_always_agree</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nb">PartialOrd</span> <span class="o">+</span><span class="w"> </span><span class="nb">PartialEq</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t1</span>: <span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="n">t2</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">t1</span><span class="p">.</span><span class="n">partial_cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">t2</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">Ordering</span>::<span class="n">Equal</span><span class="p">),</span><span class="w"> </span><span class="n">t1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">t2</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><code>PartialOrd</code> æ˜¯å¯¹ <code>PartialEq</code> çš„ç»†åŒ–ï¼Œå½“æ¯”è¾ƒ <code>PartialEq</code> ç±»å‹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥å®ƒä»¬æ˜¯å¦ç›¸ç­‰ï¼Œä½†å½“æ¯”è¾ƒ <code>PartialOrd</code> ç±»å‹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥å®ƒä»¬æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœå®ƒä»¬ä¸ç›¸ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥å®ƒä»¬æ˜¯å¦ä¸ç›¸ç­‰ï¼Œå› ä¸ºç¬¬ä¸€é¡¹å°äºæˆ–å¤§äºç¬¬äºŒé¡¹ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ <code>Rhs = Self</code>ï¼Œå› ä¸ºæˆ‘ä»¬å‡ ä¹æ€»æ˜¯æƒ³æŠŠä¸€ä¸ªç±»å‹çš„å®ä¾‹ç›¸äº’æ¯”è¾ƒï¼Œè€Œä¸æ˜¯å’Œä¸åŒç±»å‹çš„å®ä¾‹æ¯”è¾ƒã€‚è¿™ä¹Ÿè‡ªåŠ¨ä¿è¯äº†æˆ‘ä»¬çš„å®ç°æ˜¯å¯¹ç§°çš„å’Œä¼ é€’çš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">cmp</span>::<span class="n">Ordering</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[derive(PartialEq, PartialOrd)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span>
<span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// Rhs == Self == Point
</span><span class="c1"></span><span class="k">impl</span><span class="w"> </span><span class="nb">PartialOrd</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// impl automatically symmetric &amp; transitive
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">partial_cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Point</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Ordering</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="k">match</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">x</span><span class="p">.</span><span class="n">cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">other</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">Ordering</span>::<span class="n">Equal</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">y</span><span class="p">.</span><span class="n">cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">other</span><span class="p">.</span><span class="n">y</span><span class="p">),</span><span class="w">
</span><span class="w">            </span><span class="n">ordering</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">ordering</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="p">})</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>å¦‚æœä¸€ä¸ªç±»å‹çš„æ‰€æœ‰æˆå‘˜éƒ½å®ç°äº† <code>PartialOrd</code>ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥è¢«æ´¾ç”Ÿã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="cp">#[derive(PartialEq, PartialOrd)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[derive(PartialEq, PartialOrd)]</span><span class="w">
</span><span class="w"></span><span class="k">enum</span> <span class="nc">Stoplight</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">Red</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Yellow</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Green</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><code>PartialOrd</code> æ´¾ç”Ÿå®åŸºäºå…¶æˆå‘˜çš„å­—æ¯é¡ºåºå¯¹ç±»å‹è¿›è¡Œæ’åºã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="c1">// generates PartialOrd impl which orders
</span><span class="c1">// Points based on x member first and
</span><span class="c1">// y member second because that&#39;s the order
</span><span class="c1">// they appear in the source code
</span><span class="c1"></span><span class="cp">#[derive(PartialOrd, PartialEq)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// generates DIFFERENT PartialOrd impl
</span><span class="c1">// which orders Points based on y member
</span><span class="c1">// first and x member second
</span><span class="c1"></span><span class="cp">#[derive(PartialOrd, PartialEq)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><code>Ord</code> is a subtrait of <code>Eq</code> and <code>PartialOrd&lt;Self&gt;</code>:
<code>Ord</code> æ˜¯ <code>Eq</code> å’Œ <code>PartialOrd&lt;Self&gt;</code> çš„å­ traitã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="nb">Ord</span>: <span class="nb">Eq</span> <span class="o">+</span><span class="w"> </span><span class="nb">PartialOrd</span><span class="o">&lt;</span><span class="n">Self</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Ordering</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="c1">// provided default impls
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">max</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="nc">Self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">min</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="nc">Self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">clamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">min</span>: <span class="nc">Self</span><span class="p">,</span><span class="w"> </span><span class="n">max</span>: <span class="nc">Self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>å¦‚æœæˆ‘ä»¬ä¸ºä¸€ä¸ªç±»å‹å®ç° <code>Ord</code>ï¼Œåœ¨ <code>PartialOrd</code> æ‰€è¦æ±‚çš„ä¸å¯¹ç§°æ€§å’Œä¼ é€’æ€§çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬è¿˜ä¿è¯ä¸å¯¹ç§°æ€§æ˜¯å®Œå…¨çš„ï¼Œå³å¯¹äºä»»ä½•ç»™å®šçš„ <code>a</code> å’Œ <code>b</code>ï¼Œ<code>a == b</code> æˆ– <code>a &gt; b</code> ä¸­åªæœ‰ä¸€ä¸ªæ˜¯çœŸçš„ã€‚åœ¨è¿™ä¸ªæ„ä¹‰ä¸Šï¼Œ<code>Ord</code> å®Œå–„äº† <code>Eq</code> å’Œ <code>PartialOrd</code>ï¼Œå› ä¸ºå®ƒä»£è¡¨äº†ä¸€ä¸ªæ›´ä¸¥æ ¼çš„æ¯”è¾ƒç‰ˆæœ¬ã€‚å¦‚æœä¸€ä¸ªç±»å‹å®ç°äº† <code>Ord</code>ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨è¿™ä¸ªå®ç°æ¥å®ç° <code>PartialOrd</code>ã€<code>PartialEq</code> å’Œ <code>Eq</code>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">cmp</span>::<span class="n">Ordering</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// of course we can use the derive macros here
</span><span class="c1"></span><span class="cp">#[derive(Ord, PartialOrd, Eq, PartialEq)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// note: as with PartialOrd, the Ord derive macro
</span><span class="c1">// orders a type based on the lexicographical order
</span><span class="c1">// of its members
</span><span class="c1"></span><span class="w">
</span><span class="w"></span><span class="c1">// but here&#39;s the impls if we wrote them out by hand
</span><span class="c1"></span><span class="k">impl</span><span class="w"> </span><span class="nb">Ord</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Ordering</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">x</span><span class="p">.</span><span class="n">cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">Ordering</span>::<span class="n">Equal</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">y</span><span class="p">.</span><span class="n">cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">y</span><span class="p">),</span><span class="w">
</span><span class="w">            </span><span class="n">ordering</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">ordering</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">PartialOrd</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">partial_cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Ordering</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">cmp</span><span class="p">(</span><span class="n">other</span><span class="p">))</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">PartialEq</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">eq</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="kp">&amp;</span><span class="nc">Self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">cmp</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Ordering</span>::<span class="n">Equal</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">Eq</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></code></pre></div><p>æµ®ç‚¹æ•°å®ç°äº† <code>PartialOrd</code>ï¼Œä½†ä¸æ˜¯ <code>Ord</code>ï¼Œå› ä¸º <code>NaN &lt; 0 == false</code> å’Œ <code>NaN &gt;= 0 == false</code> åŒæ—¶ä¸ºçœŸã€‚å‡ ä¹æ‰€æœ‰å…¶ä»–çš„ <code>PartialOrd</code> ç±»å‹éƒ½æ˜¯ <code>Ord</code>ï¼Œå½“ç„¶ï¼Œé™¤éå®ƒä»¬åŒ…å«æµ®ç‚¹æ•°ã€‚</p>
<p>ä¸€æ—¦ä¸€ä¸ªç±»å‹è¢«è®¤ä¸ºæ˜¯ <code>Ord</code> çš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å…¶å­˜å‚¨åœ¨ <code>BTreeMap</code> å’Œ <code>BTreeSet</code> ä¸­ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ <code>sort()</code> æ–¹æ³•å¯¹å…¶è¿›è¡Œæ’åºï¼Œä»¥åŠå¯¹æ•°ç»„ã€<code>Vec</code> å’Œ <code>VecDeque</code> ç­‰ä»»ä½•ç±»å‹çš„åˆ‡ç‰‡è¿›è¡Œè§£å¼•ç”¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">collections</span>::<span class="n">BTreeSet</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// now our type can be stored
</span><span class="c1">// in BTreeSets and BTreeMaps!
</span><span class="c1"></span><span class="cp">#[derive(Ord, PartialOrd, PartialEq, Eq)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">example_btreeset</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">points</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BTreeSet</span>::<span class="n">new</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">points</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">0</span><span class="w"> </span><span class="p">});</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// we can also .sort() Ord types in collections!
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">example_sort</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nb">Ord</span><span class="o">&gt;</span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">sortable</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">sortable</span><span class="p">.</span><span class="n">sort</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">sortable</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id="arithmetic-traits">Arithmetic Traits</h3>
<table>
<thead>
<tr>
<th>Trait(s)</th>
<th>Category</th>
<th>Operator(s)</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Add</code></td>
<td>arithmetic</td>
<td><code>+</code></td>
<td>addition</td>
</tr>
<tr>
<td><code>AddAssign</code></td>
<td>arithmetic</td>
<td><code>+=</code></td>
<td>addition assignment</td>
</tr>
<tr>
<td><code>BitAnd</code></td>
<td>arithmetic</td>
<td><code>&amp;</code></td>
<td>bitwise AND</td>
</tr>
<tr>
<td><code>BitAndAssign</code></td>
<td>arithmetic</td>
<td><code>&amp;=</code></td>
<td>bitwise assignment</td>
</tr>
<tr>
<td><code>BitXor</code></td>
<td>arithmetic</td>
<td><code>^</code></td>
<td>bitwise XOR</td>
</tr>
<tr>
<td><code>BitXorAssign</code></td>
<td>arithmetic</td>
<td><code>^=</code></td>
<td>bitwise XOR assignment</td>
</tr>
<tr>
<td><code>Div</code></td>
<td>arithmetic</td>
<td><code>/</code></td>
<td>division</td>
</tr>
<tr>
<td><code>DivAssign</code></td>
<td>arithmetic</td>
<td><code>/=</code></td>
<td>division assignment</td>
</tr>
<tr>
<td><code>Mul</code></td>
<td>arithmetic</td>
<td><code>*</code></td>
<td>multiplication</td>
</tr>
<tr>
<td><code>MulAssign</code></td>
<td>arithmetic</td>
<td><code>*=</code></td>
<td>multiplication assignment</td>
</tr>
<tr>
<td><code>Neg</code></td>
<td>arithmetic</td>
<td><code>-</code></td>
<td>unary negation</td>
</tr>
<tr>
<td><code>Not</code></td>
<td>arithmetic</td>
<td><code>!</code></td>
<td>unary logical negation</td>
</tr>
<tr>
<td><code>Rem</code></td>
<td>arithmetic</td>
<td><code>%</code></td>
<td>remainder</td>
</tr>
<tr>
<td><code>RemAssign</code></td>
<td>arithmetic</td>
<td><code>%=</code></td>
<td>remainder assignment</td>
</tr>
<tr>
<td><code>Shl</code></td>
<td>arithmetic</td>
<td><code>&lt;&lt;</code></td>
<td>left shift</td>
</tr>
<tr>
<td><code>ShlAssign</code></td>
<td>arithmetic</td>
<td><code>&lt;&lt;=</code></td>
<td>left shift assignment</td>
</tr>
<tr>
<td><code>Shr</code></td>
<td>arithmetic</td>
<td><code>&gt;&gt;</code></td>
<td>right shift</td>
</tr>
<tr>
<td><code>ShrAssign</code></td>
<td>arithmetic</td>
<td><code>&gt;&gt;=</code></td>
<td>right shift assignment</td>
</tr>
<tr>
<td><code>Sub</code></td>
<td>arithmetic</td>
<td><code>-</code></td>
<td>subtraction</td>
</tr>
<tr>
<td><code>SubAssign</code></td>
<td>arithmetic</td>
<td><code>-=</code></td>
<td>subtraction assignment</td>
</tr>
</tbody>
</table>
<p>ä»”ç»†ç ”ç©¶æ‰€æœ‰è¿™äº›å°†æ˜¯éå¸¸å¤šä½™çš„ã€‚åæ­£å¤§å¤šæ•°åªé€‚ç”¨äºæ•°å­—ç±»å‹ã€‚æˆ‘ä»¬åªè®¨è®º <code>Add</code> å’Œ <code>AddAssign</code>ï¼Œå› ä¸º <code>+</code> æ“ä½œç¬¦é€šå¸¸è¢«é‡è½½æ¥åšå…¶ä»–äº‹æƒ…ï¼Œå¦‚å‘é›†åˆæ·»åŠ é¡¹ç›®æˆ–å°†äº‹ç‰©ä¸²è”èµ·æ¥ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½è¦†ç›–æœ€æœ‰è¶£çš„åœ°æ–¹ï¼Œè€Œä¸ä¼šé‡å¤ã€‚</p>
<h4 id="add--addassign">Add &amp; AddAssign</h4>
<p>é¢„å¤‡çŸ¥è¯†</p>
<ul>
<li><a href="#self">Self</a></li>
<li><a href="#methods">Methods</a></li>
<li><a href="#associated-types">Associated Types</a></li>
<li><a href="#generic-parameters">Generic Parameters</a></li>
<li><a href="#generic-types-vs-associated-types">Generic Types vs Associated Types</a></li>
<li><a href="#derive-macros">Derive Macros</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">Add</span><span class="o">&lt;</span><span class="n">Rhs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Self</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Output</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">rhs</span>: <span class="nc">Rhs</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Output</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><code>Add&lt;Rhs, Output = T&gt;</code> ç±»å‹å¯ä»¥å’Œ <code>Rhs</code> ç±»å‹ç›¸åŠ ï¼Œå¹¶å°†äº§ç”Ÿ <code>T</code> ä½œä¸ºè¾“å‡ºã€‚</p>
<p>ä¾‹å­ <code>Add&lt;Point, Output = Point&gt;</code> æ˜¯é’ˆå¯¹ <code>Point</code> å®ç°çš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="cp">#[derive(Clone, Copy)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">rhs</span>: <span class="nc">Point</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">x</span>: <span class="nc">self</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">y</span>: <span class="nc">self</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">4</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p2</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">p3</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">p1</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p2</span><span class="p">.</span><span class="n">x</span><span class="p">);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">p3</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">p1</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p2</span><span class="p">.</span><span class="n">y</span><span class="p">);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬åªæœ‰å¯¹ <code>Point</code> çš„å¼•ç”¨å‘¢ï¼Ÿé‚£æˆ‘ä»¬è¿˜èƒ½è®©å®ƒä»¬ç›¸åŠ å—ï¼Ÿè®©æˆ‘ä»¬è¯•è¯•ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">4</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p2</span><span class="p">;</span><span class="w"> </span><span class="c1">// âŒ
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>ä¸å¹¸çš„æ˜¯æ²¡æœ‰ã€‚ç¼–è¯‘å™¨ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š</p>
<pre><code class="language-none" data-lang="none">error[E0369]: cannot add `&amp;Point` to `&amp;Point`
  --&gt; src/main.rs:50:25
   |
50 |     let p3: Point = &amp;p1 + &amp;p2;
   |                     --- ^ --- &amp;Point
   |                     |
   |                     &amp;Point
   |
   = note: an implementation of `std::ops::Add` might be missing for `&amp;Point`
</code></pre><p>åœ¨ Rust çš„ç±»å‹ç³»ç»Ÿä¸­ï¼Œå¯¹äºæŸäº›ç±»å‹ <code>T</code> æ¥è¯´ï¼Œ<code>T</code>ã€<code>&amp;T</code> å’Œ <code>&amp;mut T</code> éƒ½è¢«è§†ä¸ºå”¯ä¸€çš„ä¸åŒç±»å‹ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»ä¸ºå®ƒä»¬åˆ†åˆ«æä¾› trait å®ç°ã€‚è®©æˆ‘ä»¬ä¸º <code>&amp;Point</code> å®šä¹‰ä¸€ä¸ª <code>Add</code> å®ç°ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">impl</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">rhs</span>: <span class="kp">&amp;</span><span class="nc">Point</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">x</span>: <span class="nc">self</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">y</span>: <span class="nc">self</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">4</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p2</span><span class="p">;</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">p3</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">p1</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p2</span><span class="p">.</span><span class="n">x</span><span class="p">);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">p3</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">p1</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p2</span><span class="p">.</span><span class="n">y</span><span class="p">);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>ç„¶è€Œï¼Œæœ‰äº›äº‹æƒ…è¿˜æ˜¯æ„Ÿè§‰ä¸å¤§å¯¹åŠ²ã€‚æˆ‘ä»¬æœ‰ä¸¤ä¸ªç‹¬ç«‹çš„ <code>Add</code> å®ç°ï¼Œåˆ†åˆ«ç”¨äº <code>Point</code> å’Œ <code>&amp;Point</code>ï¼Œå®ƒä»¬ç›®å‰åšçš„æ˜¯åŒæ ·çš„äº‹æƒ…ï¼Œä½†ä¸èƒ½ä¿è¯å°†æ¥ä¹Ÿä¼šè¿™æ ·åšã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å†³å®šå½“æˆ‘ä»¬æŠŠä¸¤ä¸ª <code>Point</code> ç›¸åŠ æ—¶ï¼Œæˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ªåŒ…å«è¿™ä¸¤ä¸ª <code>Point</code> çš„ <code>Line</code>ï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>Point</code>ï¼Œæˆ‘ä»¬ä¼šåƒè¿™æ ·æ›´æ–°æˆ‘ä»¬çš„ <code>Add</code> ç¨‹åºï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">ops</span>::<span class="n">Add</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[derive(Copy, Clone)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[derive(Copy, Clone)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Line</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">start</span>: <span class="nc">Point</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">end</span>: <span class="nc">Point</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// we updated this impl
</span><span class="c1"></span><span class="k">impl</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Line</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">rhs</span>: <span class="nc">Point</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Line</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Line</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">start</span>: <span class="nc">self</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">end</span>: <span class="nc">rhs</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// but forgot to update this impl, uh oh!
</span><span class="c1"></span><span class="k">impl</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">rhs</span>: <span class="kp">&amp;</span><span class="nc">Point</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">x</span>: <span class="nc">self</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">y</span>: <span class="nc">self</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">4</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">line</span>: <span class="nc">Line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p2</span><span class="p">;</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">4</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">line</span>: <span class="nc">Line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p2</span><span class="p">;</span><span class="w"> </span><span class="c1">// âŒ expected Line, found Point
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>æˆ‘ä»¬ç›®å‰å¯¹ <code>&amp;Point</code> çš„ <code>Add</code> å®ç°é€ æˆäº†ä¸å¿…è¦çš„ç»´æŠ¤è´Ÿæ‹…ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™ä¸ªå®ç°ä¸ <code>Point</code> çš„å®ç°ç›¸åŒ¹é…ï¼Œè€Œä¸å¿…åœ¨æ¯æ¬¡æ”¹å˜ <code>Point</code> çš„å®ç°æ—¶éƒ½è¦æ‰‹åŠ¨æ›´æ–°ã€‚æˆ‘ä»¬å¸Œæœ›å°½å¯èƒ½åœ°ä¿æŒæˆ‘ä»¬çš„ä»£ç æ˜¯ DRYï¼ˆDon&rsquo;t Repeat Yourselfï¼‰ã€‚å¹¸è¿çš„æ˜¯è¿™æ˜¯å¯ä»¥å®ç°çš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="c1">// updated, DRY impl
</span><span class="c1"></span><span class="k">impl</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="n">Point</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Add</span><span class="o">&gt;</span>::<span class="n">Output</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">rhs</span>: <span class="kp">&amp;</span><span class="nc">Point</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Output</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Point</span>::<span class="n">add</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">rhs</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">4</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">line</span>: <span class="nc">Line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p2</span><span class="p">;</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">4</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">line</span>: <span class="nc">Line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p2</span><span class="p">;</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><code>AddAssign&lt;Rhs&gt;</code> ç±»å‹å…è®¸æˆ‘ä»¬ç›¸åŠ å¹¶åˆ†é… <code>Rhs</code> ç±»å‹ç»™å®ƒä»¬ã€‚Trait å£°æ˜å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">AddAssign</span><span class="o">&lt;</span><span class="n">Rhs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Self</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">add_assign</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">rhs</span>: <span class="nc">Rhs</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>ä¸º <code>Point</code> å’Œ <code>&amp;Point</code> ç±»å‹çš„å®ç°çš„ä¾‹å­å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">ops</span>::<span class="n">AddAssign</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[derive(Copy, Clone)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span>
<span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">AddAssign</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">add_assign</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">rhs</span>: <span class="nc">Point</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">x</span><span class="p">;</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">rhs</span><span class="p">.</span><span class="n">y</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">AddAssign</span><span class="o">&lt;&amp;</span><span class="n">Point</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">add_assign</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">rhs</span>: <span class="kp">&amp;</span><span class="nc">Point</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Point</span>::<span class="n">add_assign</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">rhs</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">2</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span>: <span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="mi">4</span><span class="w"> </span><span class="p">};</span><span class="w">
</span><span class="w">    </span><span class="n">p1</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p2</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="n">p1</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">p2</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="n">assert</span><span class="o">!</span><span class="p">(</span><span class="n">p1</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">7</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">p1</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id="é—­åŒ…-traits">é—­åŒ… Traits</h3>
<table>
<thead>
<tr>
<th>Trait(s)</th>
<th>Category</th>
<th>Operator(s)</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Fn</code></td>
<td>closure</td>
<td><code>(...args)</code></td>
<td>immutable closure invocation</td>
</tr>
<tr>
<td><code>FnMut</code></td>
<td>closure</td>
<td><code>(...args)</code></td>
<td>mutable closure invocation</td>
</tr>
<tr>
<td><code>FnOnce</code></td>
<td>closure</td>
<td><code>(...args)</code></td>
<td>one-time closure invocation</td>
</tr>
</tbody>
</table>
<h4 id="fnonce-fnmut--fn">FnOnce, FnMut, &amp; Fn</h4>
<p>é¢„å¤‡çŸ¥è¯†</p>
<ul>
<li><a href="#self">Self</a></li>
<li><a href="#methods">Methods</a></li>
<li><a href="#associated-types">Associated Types</a></li>
<li><a href="#generic-parameters">Generic Parameters</a></li>
<li><a href="#generic-types-vs-associated-types">Generic Types vs Associated Types</a></li>
<li><a href="#subtraits--supertraits">Subtraits &amp; Supertraits</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="nb">FnOnce</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Output</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">call_once</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">args</span>: <span class="nc">Args</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Output</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">trait</span><span class="w"> </span><span class="nb">FnMut</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;</span>: <span class="nb">FnOnce</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">call_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">args</span>: <span class="nc">Args</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Output</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">trait</span><span class="w"> </span><span class="nb">Fn</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;</span>: <span class="nb">FnMut</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">call</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">args</span>: <span class="nc">Args</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Output</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>è™½ç„¶è¿™äº› trait å­˜åœ¨ï¼Œä½†åœ¨ç¨³å®šçš„ Rust ä¸­ï¼Œæˆ‘ä»¬ä¸å¯èƒ½ä¸ºè‡ªå·±çš„ç±»å‹å®ç°è¿™äº›ç‰¹æ€§ã€‚æˆ‘ä»¬å”¯ä¸€èƒ½åˆ›å»ºçš„å®ç°è¿™äº› trait çš„ç±»å‹æ˜¯é—­åŒ…ã€‚æ ¹æ®é—­åŒ…ä»å…¶ç¯å¢ƒä¸­æ•è·çš„å†…å®¹ï¼Œå†³å®šäº†å®ƒæ˜¯å®ç°äº† <code>FnOnce</code>ã€<code>FnMut</code> è¿˜æ˜¯ <code>Fn</code>ã€‚</p>
<p><code>FnOnce</code> é—­åŒ…åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œå› ä¸ºå®ƒåœ¨æ‰§è¡Œä¸­ä¼šæ¶ˆè€—ä¸€äº›å€¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">..</span><span class="mi">10</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">get_range_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">range</span><span class="p">.</span><span class="n">count</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">get_range_count</span><span class="p">(),</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">    </span><span class="n">get_range_count</span><span class="p">();</span><span class="w"> </span><span class="c1">// âŒ
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>è¿­ä»£å™¨ä¸Šçš„ <code>.count()</code> æ–¹æ³•ä¼šæ¶ˆè€—è¿­ä»£å™¨ï¼Œæ‰€ä»¥å®ƒåªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„é—­åŒ…åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå½“æˆ‘ä»¬è¯•å›¾ç¬¬äºŒæ¬¡è°ƒç”¨å®ƒæ—¶ï¼Œä¼šå‡ºç°è¿™ä¸ªé”™è¯¯ã€‚</p>
<pre><code class="language-none" data-lang="none">error[E0382]: use of moved value: `get_range_count`
 --&gt; src/main.rs:5:5
  |
4 |     assert_eq!(get_range_count(), 10);
  |                ----------------- `get_range_count` moved due to this call
5 |     get_range_count();
  |     ^^^^^^^^^^^^^^^ value used here after move
  |
note: closure cannot be invoked more than once because it moves the variable `range` out of its environment
 --&gt; src/main.rs:3:30
  |
3 |     let get_range_count = || range.count();
  |                              ^^^^^
note: this value implements `FnOnce`, which causes it to be moved when called
 --&gt; src/main.rs:4:16
  |
4 |     assert_eq!(get_range_count(), 10);
  |                ^^^^^^^^^^^^^^^
</code></pre><p><code>FnMut</code> é—­åŒ…å¯ä»¥è¢«å¤šæ¬¡è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥æ”¹å˜å®ƒä»ç¯å¢ƒä¸­æ•è·çš„å˜é‡ã€‚æˆ‘ä»¬å¯ä»¥è¯´ <code>FnMut</code> é—­åŒ…æ˜¯æ‰§è¡Œå‰¯ä½œç”¨çš„ï¼Œæˆ–è€…è¯´æ˜¯æœ‰çŠ¶æ€çš„ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªé—­åŒ…çš„ä¾‹å­ï¼Œå®ƒé€šè¿‡è·Ÿè¸ªåˆ°ç›®å‰ä¸ºæ­¢çœ‹åˆ°çš„æœ€å°å€¼ï¼Œä»è¿­ä»£å™¨ä¸­è¿‡æ»¤å‡ºæ‰€æœ‰éå‡åºçš„å€¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">nums</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">];</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">i32</span>::<span class="n">MIN</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">ascending</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nums</span><span class="p">.</span><span class="n">into_iter</span><span class="p">().</span><span class="n">filter</span><span class="p">(</span><span class="o">|&amp;</span><span class="n">n</span><span class="o">|</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">min</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="kc">false</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w">
</span><span class="w">            </span><span class="kc">true</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}).</span><span class="n">collect</span>::<span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="p">],</span><span class="w"> </span><span class="n">ascending</span><span class="p">);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><code>FnMut</code> å®Œå–„äº† <code>FnOnce</code>ï¼Œå³ <code>FnOnce</code> éœ€è¦å–å¾—å…¶å‚æ•°çš„æ‰€æœ‰æƒï¼Œåªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œä½† <code>FnMut</code> åªéœ€è¦å–å¾—å¯å˜çš„å¼•ç”¨ï¼Œå¯ä»¥å¤šæ¬¡è°ƒç”¨ã€‚<code>FnMut</code> å¯ä»¥åœ¨ä»»ä½•å¯ä»¥ä½¿ç”¨ <code>FnOnce</code> çš„åœ°æ–¹ä½¿ç”¨ã€‚</p>
<p><code>Fn</code> é—­åŒ…å¯ä»¥è¢«å¤šæ¬¡è°ƒç”¨ï¼Œå¹¶ä¸”ä¸æ”¹å˜å®ƒä»ç¯å¢ƒä¸­æ•è·çš„ä»»ä½•å˜é‡ã€‚æˆ‘ä»¬å¯ä»¥è¯´ <code>Fn</code> é—­åŒ…æ²¡æœ‰å‰¯ä½œç”¨æˆ–æ— çŠ¶æ€ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªé—­åŒ…çš„ä¾‹å­ï¼Œå®ƒè¿‡æ»¤æ‰äº†æ‰€æœ‰å°äºå®ƒä»ç¯å¢ƒä¸­æ•è·çš„è¿­ä»£å™¨ä¸­çš„æŸä¸ªæ ˆå˜é‡çš„å€¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">nums</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">];</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">9</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">greater_than_9</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nums</span><span class="p">.</span><span class="n">into_iter</span><span class="p">().</span><span class="n">filter</span><span class="p">(</span><span class="o">|&amp;</span><span class="n">n</span><span class="o">|</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">min</span><span class="p">).</span><span class="n">collect</span>::<span class="o">&lt;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;&gt;</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="mi">18</span><span class="p">,</span><span class="w"> </span><span class="mi">13</span><span class="p">],</span><span class="w"> </span><span class="n">greater_than_9</span><span class="p">);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><code>Fn</code> ç»†åŒ–äº† <code>FnMut</code>ï¼Œå³ <code>FnMut</code> éœ€è¦å¯å˜çš„å¼•ç”¨å¹¶å¯å¤šæ¬¡è°ƒç”¨ï¼Œä½† <code>Fn</code> åªéœ€è¦ä¸å¯å˜çš„å¼•ç”¨å¹¶å¯å¤šæ¬¡è°ƒç”¨ã€‚<code>Fn</code> å¯ä»¥ç”¨åœ¨ä»»ä½•å¯ä»¥ä½¿ç”¨ <code>FnMut</code> çš„åœ°æ–¹ï¼ŒåŒ…æ‹¬å¯ä»¥ä½¿ç”¨ <code>FnOnce</code> çš„åœ°æ–¹ã€‚</p>
<p>å¦‚æœä¸€ä¸ªé—­åŒ…æ²¡æœ‰ä»å®ƒçš„ç¯å¢ƒä¸­æ•è·ä»»ä½•ä¸œè¥¿ï¼Œé‚£ä¹ˆä»æŠ€æœ¯ä¸Šè®²ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œè€Œåªæ˜¯ä¸€ä¸ªåŒ¿åå£°æ˜çš„å†…è”å‡½æ•°ï¼Œå¹¶ä¸”å¯ä»¥ä½œä¸ºä¸€ä¸ªæ™®é€šçš„å‡½æ•°æŒ‡é’ˆè¢«è½¬æ¢ã€ä½¿ç”¨å’Œä¼ é€’ï¼Œä¹Ÿå°±æ˜¯ <code>fn</code>ã€‚å‡½æ•°æŒ‡é’ˆå¯ä»¥åœ¨ä»»ä½•å¯ä»¥ä½¿ç”¨ <code>Fn</code> çš„åœ°æ–¹ä½¿ç”¨ï¼Œè¿™åŒ…æ‹¬å¯ä»¥ä½¿ç”¨ <code>FnMut</code> å’Œ <code>FnOnce </code>çš„åœ°æ–¹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">add_one</span><span class="p">(</span><span class="n">x</span>: <span class="kt">i32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i32</span> <span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">fn_ptr</span>: <span class="nc">fn</span><span class="p">(</span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">i32</span> <span class="o">=</span><span class="w"> </span><span class="n">add_one</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">fn_ptr</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">    
</span><span class="w">    </span><span class="c1">// capture-less closure cast to fn pointer
</span><span class="c1"></span><span class="w">    </span><span class="n">fn_ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">x</span><span class="o">|</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// same as add_one
</span><span class="c1"></span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">fn_ptr</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>ä¼ é€’æ™®é€šå‡½æ•°æŒ‡é’ˆä»¥ä»£æ›¿é—­åŒ…çš„ä¾‹å­:</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">nums</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">];</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">absolutes</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nums</span><span class="p">.</span><span class="n">into_iter</span><span class="p">().</span><span class="n">map</span><span class="p">(</span><span class="kt">i32</span>::<span class="n">abs</span><span class="p">).</span><span class="n">collect</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">],</span><span class="w"> </span><span class="n">absolutes</span><span class="p">);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id="å…¶ä»–-trait">å…¶ä»– Trait</h3>
<table>
<thead>
<tr>
<th>Trait(s)</th>
<th>Category</th>
<th>Operator(s)</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Deref</code></td>
<td>other</td>
<td><code>*</code></td>
<td>immutable dereference</td>
</tr>
<tr>
<td><code>DerefMut</code></td>
<td>other</td>
<td><code>*</code></td>
<td>mutable derenence</td>
</tr>
<tr>
<td><code>Drop</code></td>
<td>other</td>
<td>-</td>
<td>type destructor</td>
</tr>
<tr>
<td><code>Index</code></td>
<td>other</td>
<td><code>[]</code></td>
<td>immutable index</td>
</tr>
<tr>
<td><code>IndexMut</code></td>
<td>other</td>
<td><code>[]</code></td>
<td>mutable index</td>
</tr>
<tr>
<td><code>RangeBounds</code></td>
<td>other</td>
<td><code>..</code></td>
<td>range</td>
</tr>
</tbody>
</table>
<h4 id="deref--derefmut">Deref &amp; DerefMut</h4>
<p>é¢„å¤‡çŸ¥è¯†</p>
<ul>
<li><a href="#self">Self</a></li>
<li><a href="#methods">Methods</a></li>
<li><a href="#associated-types">Associated Types</a></li>
<li><a href="#subtraits--supertraits">Subtraits &amp; Supertraits</a></li>
<li><a href="#sized">Sized</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">Deref</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Target</span>: <span class="o">?</span><span class="nb">Sized</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">deref</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">Self</span>::<span class="n">Target</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">trait</span><span class="w"> </span><span class="n">DerefMut</span>: <span class="nc">Deref</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">deref_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Self</span>::<span class="n">Target</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>å¯ä»¥ä½¿ç”¨è§£å¼•ç”¨æ“ä½œç¬¦ <code>*</code> æŠŠå®ç°äº† <code>Deref&lt;Target = T&gt;</code> trait çš„ç±»å‹è§£å¼•ç”¨ä¸º  <code>T</code> ç±»å‹ã€‚è¿™å¯¹äºæ™ºèƒ½æŒ‡é’ˆç±»å‹ï¼ˆå¦‚ <code>Box</code> å’Œ <code>Rc</code>ï¼‰æœ‰æ˜æ˜¾çš„ç”¨é€”ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å¾ˆå°‘çœ‹åˆ°åœ¨ Rust ä»£ç ä¸­æ˜¾å¼åœ°ä½¿ç”¨è§£å¼•ç”¨æ“ä½œç¬¦ï¼Œè¿™æ˜¯å› ä¸º Rust çš„ä¸€ä¸ªå«åš â€œå¼ºåˆ¶è§£å¼•ç”¨â€(<em>deref coercion</em>)çš„ç‰¹æ€§ã€‚</p>
<p>å½“ç±»å‹ä½œä¸ºå‡½æ•°å‚æ•°ä¼ é€’ã€ä»å‡½æ•°è¿”å›æˆ–ä½œä¸ºæ–¹æ³•è°ƒç”¨çš„ä¸€éƒ¨åˆ†ä½¿ç”¨æ—¶ï¼ŒRust ä¼šè‡ªåŠ¨åœ°å¯¹ç±»å‹è¿›è¡Œè§£å¼•ç”¨ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥å°† <code>&amp;String</code> å’Œ <code>&amp;Vec&lt;T&gt;</code> ä¼ é€’ç»™æœŸæœ› <code>&amp;str</code> å’Œ <code>&amp;[T]</code> çš„å‡½æ•°çš„åŸå› ï¼Œå› ä¸º <code>String</code> å®ç°äº† <code>Deref&lt;Target = str&gt;</code>, <code>Vec&lt;T&gt;</code> å®ç°äº† <code>Deref&lt;Target = [T]&gt;</code>ã€‚</p>
<p><code>Deref</code> å’Œ <code>DerefMut</code> åªåº”ä¸ºæ™ºèƒ½æŒ‡é’ˆç±»å‹è€Œå®ç°ã€‚äººä»¬è¯•å›¾è¯¯ç”¨å’Œæ»¥ç”¨è¿™äº› trait çš„æœ€å¸¸è§æ–¹å¼æ˜¯è¯•å›¾å°†æŸç§ OOP å¼çš„æ•°æ®ç»§æ‰¿å¡è¿› Rust ä¸­ã€‚è¿™æ˜¯è¡Œä¸é€šçš„ã€‚Rust ä¸æ˜¯é¢å‘å¯¹è±¡çš„ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹å‡ ç§ä¸åŒçš„æƒ…å†µï¼Œåœ¨å“ªäº›æƒ…å†µä¸‹ï¼Œå¦‚ä½•ä»¥åŠä¸ºä»€ä¹ˆå®ƒä¸èµ·ä½œç”¨ã€‚è®©æˆ‘ä»¬ä»è¿™ä¸ªä¾‹å­å¼€å§‹:</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">ops</span>::<span class="n">Deref</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Human</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">health_points</span>: <span class="kt">u32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">enum</span> <span class="nc">Weapon</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">Spear</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Axe</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Sword</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// a Soldier is just a Human with a Weapon
</span><span class="c1"></span><span class="k">struct</span> <span class="nc">Soldier</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">human</span>: <span class="nc">Human</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">weapon</span>: <span class="nc">Weapon</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Deref</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Soldier</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Human</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">deref</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">Human</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">human</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">enum</span> <span class="nc">Mount</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">Horse</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Donkey</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Cow</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// a Knight is just a Soldier with a Mount
</span><span class="c1"></span><span class="k">struct</span> <span class="nc">Knight</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">soldier</span>: <span class="nc">Soldier</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">mount</span>: <span class="nc">Mount</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Deref</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Knight</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Soldier</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">deref</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">Soldier</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">soldier</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">enum</span> <span class="nc">Spell</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">MagicMissile</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">FireBolt</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">ThornWhip</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// a Mage is just a Human who can cast Spells
</span><span class="c1"></span><span class="k">struct</span> <span class="nc">Mage</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">human</span>: <span class="nc">Human</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">spells</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Spell</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Deref</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Mage</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Human</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">deref</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">Human</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">human</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">enum</span> <span class="nc">Staff</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">Wooden</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Metallic</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Plastic</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// a Wizard is just a Mage with a Staff
</span><span class="c1"></span><span class="k">struct</span> <span class="nc">Wizard</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">mage</span>: <span class="nc">Mage</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">staff</span>: <span class="nc">Staff</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Deref</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Wizard</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Mage</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">deref</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">Mage</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">mage</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">borrows_human</span><span class="p">(</span><span class="n">human</span>: <span class="kp">&amp;</span><span class="nc">Human</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">borrows_soldier</span><span class="p">(</span><span class="n">soldier</span>: <span class="kp">&amp;</span><span class="nc">Soldier</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">borrows_knight</span><span class="p">(</span><span class="n">knight</span>: <span class="kp">&amp;</span><span class="nc">Knight</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">borrows_mage</span><span class="p">(</span><span class="n">mage</span>: <span class="kp">&amp;</span><span class="nc">Mage</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">borrows_wizard</span><span class="p">(</span><span class="n">wizard</span>: <span class="kp">&amp;</span><span class="nc">Wizard</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">example</span><span class="p">(</span><span class="n">human</span>: <span class="nc">Human</span><span class="p">,</span><span class="w"> </span><span class="n">soldier</span>: <span class="nc">Soldier</span><span class="p">,</span><span class="w"> </span><span class="n">knight</span>: <span class="nc">Knight</span><span class="p">,</span><span class="w"> </span><span class="n">mage</span>: <span class="nc">Mage</span><span class="p">,</span><span class="w"> </span><span class="n">wizard</span>: <span class="nc">Wizard</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// all types can be used as Humans
</span><span class="c1"></span><span class="w">    </span><span class="n">borrows_human</span><span class="p">(</span><span class="o">&amp;</span><span class="n">human</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">borrows_human</span><span class="p">(</span><span class="o">&amp;</span><span class="n">soldier</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">borrows_human</span><span class="p">(</span><span class="o">&amp;</span><span class="n">knight</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">borrows_human</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mage</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">borrows_human</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wizard</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="c1">// Knights can be used as Soldiers
</span><span class="c1"></span><span class="w">    </span><span class="n">borrows_soldier</span><span class="p">(</span><span class="o">&amp;</span><span class="n">soldier</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">borrows_soldier</span><span class="p">(</span><span class="o">&amp;</span><span class="n">knight</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="c1">// Wizards can be used as Mages
</span><span class="c1"></span><span class="w">    </span><span class="n">borrows_mage</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mage</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">borrows_mage</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wizard</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="c1">// Knights &amp; Wizards passed as themselves
</span><span class="c1"></span><span class="w">    </span><span class="n">borrows_knight</span><span class="p">(</span><span class="o">&amp;</span><span class="n">knight</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">borrows_wizard</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wizard</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>å› æ­¤ï¼Œä¹ä¸€çœ‹ï¼Œä¸Šé¢çš„å†…å®¹çœ‹èµ·æ¥å¾ˆä¸é”™ï¼ç„¶è€Œï¼Œåœ¨ä»”ç»†ç ”ç©¶åï¼Œå¾ˆå¿«å°±å‘ç°äº†é—®é¢˜ã€‚é¦–å…ˆï¼Œå¼ºåˆ¶è§£å¼•ç”¨åªå¯¹å¼•ç”¨èµ·ä½œç”¨ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬çœŸæ­£æƒ³è¦ä¼ é€’æ‰€æœ‰æƒæ—¶ï¼Œå®ƒå°±ä¸èµ·ä½œç”¨äº†ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">takes_human</span><span class="p">(</span><span class="n">human</span>: <span class="nc">Human</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">example</span><span class="p">(</span><span class="n">human</span>: <span class="nc">Human</span><span class="p">,</span><span class="w"> </span><span class="n">soldier</span>: <span class="nc">Soldier</span><span class="p">,</span><span class="w"> </span><span class="n">knight</span>: <span class="nc">Knight</span><span class="p">,</span><span class="w"> </span><span class="n">mage</span>: <span class="nc">Mage</span><span class="p">,</span><span class="w"> </span><span class="n">wizard</span>: <span class="nc">Wizard</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// all types CANNOT be used as Humans
</span><span class="c1"></span><span class="w">    </span><span class="n">takes_human</span><span class="p">(</span><span class="n">human</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">takes_human</span><span class="p">(</span><span class="n">soldier</span><span class="p">);</span><span class="w"> </span><span class="c1">// âŒ
</span><span class="c1"></span><span class="w">    </span><span class="n">takes_human</span><span class="p">(</span><span class="n">knight</span><span class="p">);</span><span class="w"> </span><span class="c1">// âŒ
</span><span class="c1"></span><span class="w">    </span><span class="n">takes_human</span><span class="p">(</span><span class="n">mage</span><span class="p">);</span><span class="w"> </span><span class="c1">// âŒ
</span><span class="c1"></span><span class="w">    </span><span class="n">takes_human</span><span class="p">(</span><span class="n">wizard</span><span class="p">);</span><span class="w"> </span><span class="c1">// âŒ
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>æ­¤å¤–ï¼Œå¼ºåˆ¶è§£å¼•ç”¨åœ¨æ³›å‹ä¸Šä¸‹æ–‡ä¸­ä¸èµ·ä½œç”¨ã€‚æ¯”æ–¹è¯´ï¼Œæˆ‘ä»¬åªåœ¨äººç±»èº«ä¸Šå®ç°ä¸€äº› traitï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">Rest</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">rest</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Rest</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Human</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">rest</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">take_rest</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nc">Rest</span><span class="o">&gt;</span><span class="p">(</span><span class="n">rester</span>: <span class="kp">&amp;</span><span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">rester</span><span class="p">.</span><span class="n">rest</span><span class="p">()</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">example</span><span class="p">(</span><span class="n">human</span>: <span class="nc">Human</span><span class="p">,</span><span class="w"> </span><span class="n">soldier</span>: <span class="nc">Soldier</span><span class="p">,</span><span class="w"> </span><span class="n">knight</span>: <span class="nc">Knight</span><span class="p">,</span><span class="w"> </span><span class="n">mage</span>: <span class="nc">Mage</span><span class="p">,</span><span class="w"> </span><span class="n">wizard</span>: <span class="nc">Wizard</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// all types CANNOT be used as Rest types, only Human
</span><span class="c1"></span><span class="w">    </span><span class="n">take_rest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">human</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">take_rest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">soldier</span><span class="p">);</span><span class="w"> </span><span class="c1">// âŒ
</span><span class="c1"></span><span class="w">    </span><span class="n">take_rest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">knight</span><span class="p">);</span><span class="w"> </span><span class="c1">// âŒ
</span><span class="c1"></span><span class="w">    </span><span class="n">take_rest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mage</span><span class="p">);</span><span class="w"> </span><span class="c1">// âŒ
</span><span class="c1"></span><span class="w">    </span><span class="n">take_rest</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wizard</span><span class="p">);</span><span class="w"> </span><span class="c1">// âŒ
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>å¦å¤–ï¼Œå°½ç®¡å¼ºåˆ¶è§£å¼•ç”¨åœ¨å¾ˆå¤šåœ°æ–¹éƒ½èƒ½å·¥ä½œï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰åœ°æ–¹éƒ½èƒ½å·¥ä½œã€‚å®ƒå¯¹æ“ä½œæ•°ä¸èµ·ä½œç”¨ï¼Œå°½ç®¡æ“ä½œç¬¦åªæ˜¯æ–¹æ³•è°ƒç”¨çš„è¯­æ³•ç³–ã€‚æ¯”æ–¹è¯´ï¼Œæˆ‘ä»¬æƒ³è®© <code>Mage</code>(æ³•å¸ˆ) ç”¨ <code>+=</code> è¿ç®—ç¬¦æ¥å­¦ä¹  <code>Spell</code>(å’’è¯­)ï¼Œè¿™å¾ˆå¯çˆ±ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">impl</span><span class="w"> </span><span class="n">DerefMut</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Wizard</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">deref_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Mage</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">mage</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">AddAssign</span><span class="o">&lt;</span><span class="n">Spell</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Mage</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">add_assign</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">spell</span>: <span class="nc">Spell</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">spells</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">spell</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">example</span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">mage</span>: <span class="nc">Mage</span><span class="p">,</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">wizard</span>: <span class="nc">Wizard</span><span class="p">,</span><span class="w"> </span><span class="n">spell</span>: <span class="nc">Spell</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">mage</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">spell</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="n">wizard</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">spell</span><span class="p">;</span><span class="w"> </span><span class="c1">// âŒ wizard not coerced to mage here
</span><span class="c1"></span><span class="w">    </span><span class="n">wizard</span><span class="p">.</span><span class="n">add_assign</span><span class="p">(</span><span class="n">spell</span><span class="p">);</span><span class="w"> </span><span class="c1">// oof, we have to call it like this ğŸ¤¦
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>åœ¨ OOP å¼æ•°æ®ç»§æ‰¿çš„è¯­è¨€ä¸­ï¼Œæ–¹æ³•ä¸­ <code>self</code> çš„å€¼æ€»æ˜¯ç­‰äºè°ƒç”¨è¯¥æ–¹æ³•çš„ç±»å‹ï¼Œä½†åœ¨ Rust ä¸­ï¼Œ<code>self</code> çš„å€¼æ€»æ˜¯ç­‰äºå®ç°è¯¥æ–¹æ³•çš„ç±»å‹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">struct</span> <span class="nc">Human</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">profession</span>: <span class="kp">&amp;</span><span class="nb">&#39;static</span><span class="w"> </span><span class="kt">str</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">health_points</span>: <span class="kt">u32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Human</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// self will always be a Human here, even if we call it on a Soldier
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">state_profession</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;I&#39;m a {}!&#34;</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">profession</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Soldier</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">profession</span>: <span class="kp">&amp;</span><span class="nb">&#39;static</span><span class="w"> </span><span class="kt">str</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">human</span>: <span class="nc">Human</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">weapon</span>: <span class="nc">Weapon</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">example</span><span class="p">(</span><span class="n">soldier</span>: <span class="kp">&amp;</span><span class="nc">Soldier</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;servant&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">soldier</span><span class="p">.</span><span class="n">human</span><span class="p">.</span><span class="n">profession</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;spearman&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">soldier</span><span class="p">.</span><span class="n">profession</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">soldier</span><span class="p">.</span><span class="n">human</span><span class="p">.</span><span class="n">state_profession</span><span class="p">();</span><span class="w"> </span><span class="c1">// prints &#34;I&#39;m a servant!&#34;
</span><span class="c1"></span><span class="w">    </span><span class="n">soldier</span><span class="p">.</span><span class="n">state_profession</span><span class="p">();</span><span class="w"> </span><span class="c1">// still prints &#34;I&#39;m a servant!&#34; ğŸ¤¦
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>å½“åœ¨ä¸€ä¸ªæ–°ç±»å‹ä¸Šå®ç° <code>Deref</code> æˆ– <code>DerefMut</code> æ—¶ï¼Œä¸Šè¿°çš„é—®é¢˜å°¤å…¶ä¸¥é‡ã€‚å‡è®¾æˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ª <code>SortedVec</code> ç±»å‹ï¼Œå®ƒåªæ˜¯ä¸€ä¸ª <code>Vec</code>ï¼Œä½†å®ƒæ€»æ˜¯æŒ‰æ’åºé¡ºåºæ’åˆ—ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬å¦‚ä½•åšçš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">struct</span> <span class="nc">SortedVec</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nb">Ord</span><span class="o">&gt;</span><span class="p">(</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nb">Ord</span><span class="o">&gt;</span><span class="w"> </span><span class="n">SortedVec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">vec</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">vec</span><span class="p">.</span><span class="n">sort</span><span class="p">();</span><span class="w">
</span><span class="w">        </span><span class="n">SortedVec</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">push</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">t</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="mf">0.</span><span class="n">push</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="mf">0.</span><span class="n">sort</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨è¿™é‡Œå®ç° <code>DerefMut&lt;Target = Vec&lt;T&gt;&gt;</code>ï¼Œå¦åˆ™ä»»ä½•ä½¿ç”¨ <code>SortedVec</code> çš„äººéƒ½å¯ä»¥è½»æ˜“åœ°ç ´åæ’åºçš„é¡ºåºã€‚ç„¶è€Œï¼Œå®ç° <code>Deref&lt;Target = Vec&lt;T&gt;&gt;</code> è‚¯å®šæ˜¯å®‰å…¨çš„ï¼Œå¯¹å—ï¼Ÿè¯•ç€åœ¨ä¸‹é¢çš„ç¨‹åºä¸­å‘ç°è¿™ä¸ªé”™è¯¯ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">ops</span>::<span class="n">Deref</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">SortedVec</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nb">Ord</span><span class="o">&gt;</span><span class="p">(</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nb">Ord</span><span class="o">&gt;</span><span class="w"> </span><span class="n">SortedVec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">vec</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">vec</span><span class="p">.</span><span class="n">sort</span><span class="p">();</span><span class="w">
</span><span class="w">        </span><span class="n">SortedVec</span><span class="p">(</span><span class="n">vec</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">push</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">t</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="mf">0.</span><span class="n">push</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="mf">0.</span><span class="n">sort</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nb">Ord</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Deref</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SortedVec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">deref</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="mi">0</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">sorted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SortedVec</span>::<span class="n">new</span><span class="p">(</span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">]);</span><span class="w">
</span><span class="w">    </span><span class="n">sorted</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">sortedClone</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sorted</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">sortedClone</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>æˆ‘ä»¬ä»æœªä¸º <code>SortedVec</code> å®ç° <code>Clone</code>ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è°ƒç”¨ <code>.clone()</code> æ–¹æ³•æ—¶ï¼Œç¼–è¯‘å™¨ä½¿ç”¨å¼ºåˆ¶è§£å¼•ç”¨æ¥è§£å†³å¯¹ <code>Vec</code> çš„æ–¹æ³•è°ƒç”¨ï¼Œæ‰€ä»¥å®ƒè¿”å›ä¸€ä¸ª <code>Vec</code> è€Œä¸æ˜¯ <code>SortedVec</code>!</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">sorted</span>: <span class="nc">SortedVec</span><span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SortedVec</span>::<span class="n">new</span><span class="p">(</span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">]);</span><span class="w">
</span><span class="w">    </span><span class="n">sorted</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// still sorted
</span><span class="c1"></span><span class="w">
</span><span class="w">    </span><span class="c1">// calling clone on SortedVec actually returns a Vec ğŸ¤¦
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">sortedClone</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sorted</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">sortedClone</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span><span class="w"> </span><span class="c1">// sortedClone no longer sorted ğŸ’€
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>æ€»ä¹‹ï¼Œä»¥ä¸Šè¿™äº›é™åˆ¶ã€çº¦æŸæˆ–éº»çƒ¦éƒ½ä¸æ˜¯ Rust çš„ç¼ºç‚¹ï¼Œå› ä¸º Rust ä¸€å¼€å§‹å°±æ²¡æœ‰è¢«è®¾è®¡æˆä¸€ç§ OO è¯­è¨€æˆ–æ”¯æŒä»»ä½• OOP æ¨¡å¼ã€‚</p>
<p>æœ¬èŠ‚çš„ä¸»è¦å¯ç¤ºæ˜¯ï¼Œä¸è¦è¯•å›¾ç”¨ <code>Deref</code> å’Œ <code>DerefMut</code> å®ç°æ¥è¡¨ç°å¯çˆ±æˆ–èªæ˜ã€‚å®ƒä»¬å®é™…ä¸Šåªé€‚åˆäºæ™ºèƒ½æŒ‡é’ˆç±»å‹ï¼Œç›®å‰åªèƒ½åœ¨æ ‡å‡†åº“ä¸­å®ç°ï¼Œå› ä¸ºæ™ºèƒ½æŒ‡é’ˆç±»å‹ç›®å‰éœ€è¦ä¸ç¨³å®šçš„ç‰¹æ€§å’Œç¼–è¯‘å™¨çš„é­”æ³•æ‰èƒ½å·¥ä½œã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦ç±»ä¼¼äº <code>Deref</code> å’Œ <code>DerefMut</code> çš„åŠŸèƒ½å’Œè¡Œä¸ºï¼Œé‚£ä¹ˆæˆ‘ä»¬å®é™…ä¸Šå¯èƒ½è¦æ‰¾çš„æ˜¯ <code>AsRef</code> å’Œ <code>AsMut</code>ï¼Œæˆ‘ä»¬å°†åœ¨åé¢è®¨è®ºã€‚</p>
<h4 id="index--indexmut">Index &amp; IndexMut</h4>
<p>é¢„å¤‡çŸ¥è¯†</p>
<ul>
<li><a href="#self">Self</a></li>
<li><a href="#methods">Methods</a></li>
<li><a href="#associated-types">Associated Types</a></li>
<li><a href="#generic-parameters">Generic Parameters</a></li>
<li><a href="#generic-types-vs-associated-types">Generic Types vs Associated Types</a></li>
<li><a href="#subtraits--supertraits">Subtraits &amp; Supertraits</a></li>
<li><a href="#sized">Sized</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">Index</span><span class="o">&lt;</span><span class="n">Idx</span>: <span class="o">?</span><span class="nb">Sized</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Output</span>: <span class="o">?</span><span class="nb">Sized</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">index</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">index</span>: <span class="nc">Idx</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">Self</span>::<span class="n">Output</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">trait</span><span class="w"> </span><span class="n">IndexMut</span><span class="o">&lt;</span><span class="n">Idx</span><span class="o">&gt;</span>: <span class="nc">Index</span><span class="o">&lt;</span><span class="n">Idx</span><span class="o">&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">Idx</span>: <span class="o">?</span><span class="nb">Sized</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">index_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">index</span>: <span class="nc">Idx</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Self</span>::<span class="n">Output</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>æˆ‘ä»¬å¯ä»¥å°† <code>[]</code> ç´¢å¼•åˆ°æœ‰ <code>T</code> å€¼çš„ <code>Index&lt;T, Output = U&gt;</code> ç±»å‹ï¼Œç´¢å¼•æ“ä½œå°†è¿”å› <code>&amp;U</code> å€¼ã€‚å¯¹äºè¯­æ³•ç³–ï¼Œç¼–è¯‘å™¨ä¼šåœ¨ä»»ä½•ä»ç´¢å¼•æ“ä½œè¿”å›çš„å€¼å‰é¢è‡ªåŠ¨æ’å…¥ä¸€ä¸ªè§£å¼•ç”¨è¿ç®—ç¬¦ <code>*</code>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// Vec&lt;i32&gt; impls Index&lt;usize, Output = i32&gt; so
</span><span class="c1"></span><span class="w">    </span><span class="c1">// indexing Vec&lt;i32&gt; should produce &amp;i32s and yet...
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">vec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">];</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">num_ref</span>: <span class="kp">&amp;</span><span class="kt">i32</span> <span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"> </span><span class="c1">// âŒ expected &amp;i32 found i32
</span><span class="c1"></span><span class="w">    
</span><span class="w">    </span><span class="c1">// above line actually desugars to
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">num_ref</span>: <span class="kp">&amp;</span><span class="kt">i32</span> <span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"> </span><span class="c1">// âŒ expected &amp;i32 found i32
</span><span class="c1"></span><span class="w">
</span><span class="w">    </span><span class="c1">// both of these alternatives work
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">num</span>: <span class="kt">i32</span> <span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">num_ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>ä¸€å¼€å§‹æœ‰ç‚¹è®©äººå›°æƒ‘ï¼Œå› ä¸ºçœ‹èµ·æ¥ <code>Index</code> trait å¹¶ä¸éµå¾ªå®ƒè‡ªå·±çš„æ–¹æ³•ç­¾åï¼Œä½†å®é™…ä¸Šè¿™åªæ˜¯æœ‰é—®é¢˜çš„è¯­æ³•ç³–ã€‚</p>
<p>å› ä¸º <code>Idx</code> æ˜¯ä¸€ä¸ªæ³›å‹ç±»å‹ï¼Œ<code>Index</code> trait å¯ä»¥ä¸ºä¸€ä¸ªç»™å®šçš„ç±»å‹å®ç°å¾ˆå¤šæ¬¡ï¼Œåœ¨ <code>Vec&lt;T&gt;</code> çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥ä½¿ç”¨ <code>usize</code> å¯¹å…¶è¿›è¡Œç´¢å¼•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ <code>Range&lt;usize&gt;</code> å¯¹å…¶è¿›è¡Œç´¢å¼•ï¼Œä»¥è·å¾—åˆ‡ç‰‡ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">vec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">];</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vec</span><span class="p">[..],</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">]);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vec</span><span class="p">[</span><span class="mi">1</span><span class="p">..],</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">]);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vec</span><span class="p">[..</span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">]);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vec</span><span class="p">[</span><span class="mi">1</span><span class="p">..</span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="o">&amp;</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">]);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>ä¸ºäº†å±•ç¤ºæˆ‘ä»¬å¦‚ä½•å®ç° <code>Index</code>ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªæœ‰è¶£çš„ä¾‹å­ï¼Œå±•ç¤ºäº†æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨ä¸€ä¸ªæ–°ç±»å‹å’Œ <code>Index</code> trait æ¥å®ç° <code>Vec</code> çš„åŒ…è£…ç´¢å¼•å’Œè´Ÿç´¢å¼•ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">ops</span>::<span class="n">Index</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">WrappingIndex</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Index</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">WrappingIndex</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">index</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">index</span>: <span class="kt">usize</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">T</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="mi">0</span><span class="p">[</span><span class="n">index</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="mf">0.</span><span class="n">len</span><span class="p">()]</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Index</span><span class="o">&lt;</span><span class="kt">i128</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">WrappingIndex</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">index</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">index</span>: <span class="nc">i128</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">T</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">self_len</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="mf">0.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">i128</span><span class="p">;</span><span class="w">
</span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(((</span><span class="n">index</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">self_len</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">self_len</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">self_len</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">usize</span><span class="p">;</span><span class="w">
</span><span class="w">        </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="mi">0</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[test]</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">indexes</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">wrapping_vec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WrappingIndex</span><span class="p">(</span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">]);</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">wrapping_vec</span><span class="p">[</span><span class="mi">0_</span><span class="k">usize</span><span class="p">]);</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">wrapping_vec</span><span class="p">[</span><span class="mi">1_</span><span class="k">usize</span><span class="p">]);</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">wrapping_vec</span><span class="p">[</span><span class="mi">2_</span><span class="k">usize</span><span class="p">]);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[test]</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">wrapping_indexes</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">wrapping_vec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WrappingIndex</span><span class="p">(</span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">]);</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">wrapping_vec</span><span class="p">[</span><span class="mi">3_</span><span class="k">usize</span><span class="p">]);</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">wrapping_vec</span><span class="p">[</span><span class="mi">4_</span><span class="k">usize</span><span class="p">]);</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">wrapping_vec</span><span class="p">[</span><span class="mi">5_</span><span class="k">usize</span><span class="p">]);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[test]</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">neg_indexes</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">wrapping_vec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WrappingIndex</span><span class="p">(</span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">]);</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">wrapping_vec</span><span class="p">[</span><span class="o">-</span><span class="mi">3_</span><span class="kt">i128</span><span class="p">]);</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">wrapping_vec</span><span class="p">[</span><span class="o">-</span><span class="mi">2_</span><span class="kt">i128</span><span class="p">]);</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">wrapping_vec</span><span class="p">[</span><span class="o">-</span><span class="mi">1_</span><span class="kt">i128</span><span class="p">]);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[test]</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">wrapping_neg_indexes</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">wrapping_vec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">WrappingIndex</span><span class="p">(</span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">]);</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">wrapping_vec</span><span class="p">[</span><span class="o">-</span><span class="mi">6_</span><span class="kt">i128</span><span class="p">]);</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">wrapping_vec</span><span class="p">[</span><span class="o">-</span><span class="mi">5_</span><span class="kt">i128</span><span class="p">]);</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">wrapping_vec</span><span class="p">[</span><span class="o">-</span><span class="mi">4_</span><span class="kt">i128</span><span class="p">]);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>æ²¡æœ‰è¦æ±‚ <code>Idx</code> ç±»å‹å¿…é¡»æ˜¯æ•°å­—ç±»å‹æˆ– <code>Range</code>ï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªæšä¸¾! ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œä½¿ç”¨ç¯®çƒä½ç½®ç´¢å¼•åˆ°ä¸€ä¸ªç¯®çƒé˜Ÿï¼Œä»¥æ£€ç´¢è¯¥é˜Ÿçš„çƒå‘˜ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">ops</span>::<span class="n">Index</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">enum</span> <span class="nc">BasketballPosition</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">PointGuard</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">ShootingGuard</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Center</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">PowerForward</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">SmallForward</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">BasketballPlayer</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">name</span>: <span class="kp">&amp;</span><span class="nb">&#39;static</span><span class="w"> </span><span class="kt">str</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">position</span>: <span class="nc">BasketballPosition</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">BasketballTeam</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">point_guard</span>: <span class="nc">BasketballPlayer</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">shooting_guard</span>: <span class="nc">BasketballPlayer</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">center</span>: <span class="nc">BasketballPlayer</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">power_forward</span>: <span class="nc">BasketballPlayer</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">small_forward</span>: <span class="nc">BasketballPlayer</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Index</span><span class="o">&lt;</span><span class="n">BasketballPosition</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">BasketballTeam</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BasketballPlayer</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">index</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">position</span>: <span class="nc">BasketballPosition</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">BasketballPlayer</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">BasketballPosition</span>::<span class="n">PointGuard</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">point_guard</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">BasketballPosition</span>::<span class="n">ShootingGuard</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">shooting_guard</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">BasketballPosition</span>::<span class="n">Center</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">center</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">BasketballPosition</span>::<span class="n">PowerForward</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">power_forward</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">BasketballPosition</span>::<span class="n">SmallForward</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">small_forward</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><h4 id="drop">Drop</h4>
<p>é¢„å¤‡çŸ¥è¯†</p>
<ul>
<li><a href="#self">Self</a></li>
<li><a href="#methods">Methods</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="nb">Drop</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">drop</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>å¦‚æœä¸€ä¸ªç±»å‹å®ç°äº† <code>Drop</code>ï¼Œé‚£ä¹ˆå½“å®ƒè¶…å‡ºä½œç”¨åŸŸä½†åœ¨è¢«é”€æ¯ä¹‹å‰ï¼Œ<code>drop</code> å°†åœ¨è¯¥ç±»å‹ä¸Šè°ƒç”¨ã€‚æˆ‘ä»¬å¾ˆå°‘éœ€è¦ä¸ºæˆ‘ä»¬çš„ç±»å‹å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œä½†æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯ï¼Œå¦‚æœä¸€ä¸ªç±»å‹æŒæœ‰ä¸€äº›å¤–éƒ¨èµ„æºï¼Œå½“ç±»å‹è¢«é”€æ¯æ—¶ï¼Œè¿™äº›èµ„æºéœ€è¦è¢«æ¸…ç†æ‰ã€‚</p>
<p>åœ¨æ ‡å‡†åº“ä¸­æœ‰ä¸€ä¸ª <code>BufWriter</code> ç±»å‹ï¼Œå…è®¸æˆ‘ä»¬å¯¹ <code>Write</code> ç±»å‹è¿›è¡Œç¼“å†²å†™å…¥ã€‚ç„¶è€Œï¼Œå¦‚æœ <code>BufWriter</code> åœ¨å…¶ç¼“å†²åŒºçš„å†…å®¹è¢«åˆ·æ–°åˆ°åº•å±‚çš„ <code>Write</code> ç±»å‹ä¹‹å‰å°±è¢«é”€æ¯äº†å‘¢ï¼Ÿå¹¸å¥½è¿™æ˜¯ä¸å¯èƒ½çš„! <code>BufWriter</code> å®ç°äº† <code>Drop</code> traitï¼Œæ‰€ä»¥æ¯å½“å®ƒç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œ<code>flush</code> æ€»æ˜¯è¢«è°ƒç”¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">impl</span><span class="o">&lt;</span><span class="n">W</span>: <span class="nc">Write</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">Drop</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">BufWriter</span><span class="o">&lt;</span><span class="n">W</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">drop</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">flush_buf</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>å¦å¤–ï¼ŒRust ä¸­çš„ <code>Mutex</code> æ²¡æœ‰ <code>unlock()</code> æ–¹æ³•ï¼Œå› ä¸ºå®ƒä»¬ä¸éœ€è¦è¿™äº›æ–¹æ³•ã€‚åœ¨ä¸€ä¸ª <code>Mutex</code> ä¸Šè°ƒç”¨ <code>lock()</code> ä¼šè¿”å›ä¸€ä¸ª <code>MutexGuard</code>ï¼Œå½“ <code>Mutex</code> è¶…å‡ºä½œç”¨åŸŸæ—¶ï¼Œç”±äºå®ƒçš„ <code>Drop</code> å®ç°ï¼Œå®ƒä¼šè‡ªåŠ¨è§£é”ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span>: <span class="o">?</span><span class="nb">Sized</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">Drop</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MutexGuard</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">drop</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="k">unsafe</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="bp">self</span><span class="p">.</span><span class="n">lock</span><span class="p">.</span><span class="n">inner</span><span class="p">.</span><span class="n">raw_unlock</span><span class="p">();</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä½ åœ¨æŸäº›èµ„æºä¸Šå®ç°ä¸€ä¸ªæŠ½è±¡ï¼Œåœ¨ä½¿ç”¨åéœ€è¦æ¸…ç†ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯ä½¿ç”¨ <code>Drop</code> trait çš„ä¸€ä¸ªå¾ˆå¥½çš„ç†ç”±ã€‚</p>
<h2 id="è½¬æ¢-traits">è½¬æ¢ Traits</h2>
<h3 id="from--into">From &amp; Into</h3>
<p>é¢„å¤‡çŸ¥è¯†</p>
<ul>
<li><a href="#self">Self</a></li>
<li><a href="#functions">Functions</a></li>
<li><a href="#methods">Methods</a></li>
<li><a href="#generic-parameters">Generic Parameters</a></li>
<li><a href="#generic-blanket-impls">Generic Blanket Impls</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="nb">From</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><code>From&lt;T&gt;</code> ç±»å‹å…è®¸æˆ‘ä»¬å°† <code>T</code> è½¬æ¢ä¸º <code>Self</code>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="nb">Into</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">into</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">T</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><code>Into&lt;T&gt;</code> ç±»å‹å…è®¸æˆ‘ä»¬å°† <code>Self</code> è½¬æ¢ä¸º <code>T</code>ã€‚</p>
<p>è¿™äº› trait æ˜¯ä¸€ä¸ªç¡¬å¸çš„ä¸¤ä¸ªä¸åŒä¾§é¢ã€‚æˆ‘ä»¬åªèƒ½ä¸ºæˆ‘ä»¬çš„ç±»å‹å®ç° <code>From&lt;T&gt;</code>ï¼Œå› ä¸º <code>Into&lt;T&gt;</code> çš„å®ç°æ˜¯ç”±ä¸‹é¢è¿™ä¸ªæ³›å‹å…¨é¢å®ç°è‡ªåŠ¨æä¾›çš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">Into</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">T</span><span class="w">
</span><span class="w"></span><span class="k">where</span><span class="w">
</span><span class="w">    </span><span class="n">U</span>: <span class="nb">From</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">into</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">U</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">U</span>::<span class="n">from</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>è¿™ä¸¤ä¸ª  trait å­˜åœ¨çš„åŸå› æ˜¯ï¼Œå®ƒå…è®¸æˆ‘ä»¬ä»¥ç¨å¾®ä¸åŒçš„æ–¹å¼åœ¨æ³›å‹ç±»å‹ä¸Šç¼–å†™ trait çº¦æŸ(trait bound)ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">function</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t</span>: <span class="nc">T</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="k">where</span><span class="w">
</span><span class="w">    </span><span class="c1">// these bounds are equivalent
</span><span class="c1"></span><span class="w">    </span><span class="n">T</span>: <span class="nb">From</span><span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="kt">i32</span>: <span class="nb">Into</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w">
</span><span class="w"></span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// these examples are equivalent
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">example</span>: <span class="nc">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span>::<span class="n">from</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">example</span>: <span class="nc">T</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.</span><span class="n">into</span><span class="p">();</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>å…³äºä½•æ—¶ä½¿ç”¨è¿™ä¸¤ç§æ–¹æ³•å¹¶æ²¡æœ‰ç¡¬æ€§è§„å®šï¼Œæ‰€ä»¥åœ¨æ¯ç§æƒ…å†µä¸‹éƒ½è¦é€‰æ‹©æœ€åˆç†çš„æ–¹æ³•ã€‚ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ä¸€äº›å…³äº <code>Point</code> çš„ä¾‹å­ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">From</span><span class="o">&lt;</span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">from</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>: <span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">))</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">From</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">i32</span><span class="p">;</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">from</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">]</span>: <span class="p">[</span><span class="kt">i32</span><span class="p">;</span><span class="w"> </span><span class="mi">2</span><span class="p">])</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">example</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// using From
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span>::<span class="n">from</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span>::<span class="n">from</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">]);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="c1">// using Into
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">origin</span>: <span class="nc">Point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">).</span><span class="n">into</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">origin</span>: <span class="nc">Point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">].</span><span class="n">into</span><span class="p">();</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>å®ç°ä¸æ˜¯å¯¹ç§°çš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³æŠŠ <code>Point</code> è½¬æ¢æˆå…ƒç»„å’Œæ•°ç»„ï¼Œæˆ‘ä»¬ä¹Ÿå¿…é¡»æ˜¾ç¤ºåœ°åœ°æ·»åŠ è¿™äº›ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">From</span><span class="o">&lt;</span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">from</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>: <span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">))</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">From</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">}</span>: <span class="nc">Point</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">From</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">i32</span><span class="p">;</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">from</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">]</span>: <span class="p">[</span><span class="kt">i32</span><span class="p">;</span><span class="w"> </span><span class="mi">2</span><span class="p">])</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">From</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">[</span><span class="kt">i32</span><span class="p">;</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">}</span>: <span class="nc">Point</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">]</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">example</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// from (i32, i32) into Point
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span>::<span class="n">from</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">point</span>: <span class="nc">Point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">).</span><span class="n">into</span><span class="p">();</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="c1">// from Point into (i32, i32)
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">tuple</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="o">&gt;</span>::<span class="n">from</span><span class="p">(</span><span class="n">point</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">tuple</span>: <span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">point</span><span class="p">.</span><span class="n">into</span><span class="p">();</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="c1">// from [i32; 2] into Point
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Point</span>::<span class="n">from</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">]);</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">point</span>: <span class="nc">Point</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">].</span><span class="n">into</span><span class="p">();</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="c1">// from Point into [i32; 2]
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="p">[</span><span class="kt">i32</span><span class="p">;</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;</span>::<span class="n">from</span><span class="p">(</span><span class="n">point</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">array</span>: <span class="p">[</span><span class="kt">i32</span><span class="p">;</span><span class="w"> </span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">point</span><span class="p">.</span><span class="n">into</span><span class="p">();</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><code>From&lt;T&gt;</code> çš„ä¸€ä¸ªæ™®éç”¨é€”æ˜¯ç¼©å‡æ¨¡æ¿ä»£ç ã€‚å‡è®¾æˆ‘ä»¬åœ¨ç¨‹åºä¸­åŠ å…¥ä¸€ä¸ªåŒ…å«ä¸‰ä¸ª <code>Point</code> çš„ <code>Triangle</code> ç±»å‹ï¼Œè¿™é‡Œæœ‰è®¸å¤šæ–¹æ³•å¯ä»¥æ„å»ºå®ƒã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">From</span><span class="o">&lt;</span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">from</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>: <span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">))</span><span class="w"> </span>-&gt; <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Triangle</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">p1</span>: <span class="nc">Point</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">p2</span>: <span class="nc">Point</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">p3</span>: <span class="nc">Point</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Triangle</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">p1</span>: <span class="nc">Point</span><span class="p">,</span><span class="w"> </span><span class="n">p2</span>: <span class="nc">Point</span><span class="p">,</span><span class="w"> </span><span class="n">p3</span>: <span class="nc">Point</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Triangle</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Triangle</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">p1</span><span class="p">,</span><span class="w"> </span><span class="n">p2</span><span class="p">,</span><span class="w"> </span><span class="n">p3</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">From</span><span class="o">&lt;</span><span class="p">[</span><span class="n">P</span><span class="p">;</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Triangle</span><span class="w">
</span><span class="w"></span><span class="k">where</span><span class="w">
</span><span class="w">    </span><span class="n">P</span>: <span class="nb">Into</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span><span class="w">
</span><span class="w"></span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">from</span><span class="p">([</span><span class="n">p1</span><span class="p">,</span><span class="w"> </span><span class="n">p2</span><span class="p">,</span><span class="w"> </span><span class="n">p3</span><span class="p">]</span>: <span class="p">[</span><span class="n">P</span><span class="p">;</span><span class="w"> </span><span class="mi">3</span><span class="p">])</span><span class="w"> </span>-&gt; <span class="nc">Triangle</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Triangle</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">p1</span>: <span class="nc">p1</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w">
</span><span class="w">            </span><span class="n">p2</span>: <span class="nc">p2</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w">
</span><span class="w">            </span><span class="n">p3</span>: <span class="nc">p3</span><span class="p">.</span><span class="n">into</span><span class="p">(),</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">example</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// manual construction
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">triangle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Triangle</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">p1</span>: <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">x</span>: <span class="mi">0</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">y</span>: <span class="mi">0</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="p">},</span><span class="w">
</span><span class="w">        </span><span class="n">p2</span>: <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">x</span>: <span class="mi">1</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">y</span>: <span class="mi">1</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="p">},</span><span class="w">
</span><span class="w">        </span><span class="n">p3</span>: <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">x</span>: <span class="mi">2</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">y</span>: <span class="mi">2</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="p">},</span><span class="w">
</span><span class="w">    </span><span class="p">};</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="c1">// using Point::new
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">triangle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Triangle</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">p1</span>: <span class="nc">Point</span>::<span class="n">new</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w">
</span><span class="w">        </span><span class="n">p2</span>: <span class="nc">Point</span>::<span class="n">new</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w">
</span><span class="w">        </span><span class="n">p3</span>: <span class="nc">Point</span>::<span class="n">new</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w">
</span><span class="w">    </span><span class="p">};</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="c1">// using From&lt;(i32, i32)&gt; for Point
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">triangle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Triangle</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">p1</span>: <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">).</span><span class="n">into</span><span class="p">(),</span><span class="w">
</span><span class="w">        </span><span class="n">p2</span>: <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">).</span><span class="n">into</span><span class="p">(),</span><span class="w">
</span><span class="w">        </span><span class="n">p3</span>: <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">).</span><span class="n">into</span><span class="p">(),</span><span class="w">
</span><span class="w">    </span><span class="p">};</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="c1">// using Triangle::new + From&lt;(i32, i32)&gt; for Point
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">triangle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Triangle</span>::<span class="n">new</span><span class="p">(</span><span class="w">
</span><span class="w">        </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">).</span><span class="n">into</span><span class="p">(),</span><span class="w">
</span><span class="w">        </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">).</span><span class="n">into</span><span class="p">(),</span><span class="w">
</span><span class="w">        </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">).</span><span class="n">into</span><span class="p">(),</span><span class="w">
</span><span class="w">    </span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="c1">// using From&lt;[Into&lt;Point&gt;; 3]&gt; for Triangle
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">triangle</span>: <span class="nc">Triangle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="w">
</span><span class="w">        </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w">
</span><span class="w">        </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w">
</span><span class="w">        </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w">
</span><span class="w">    </span><span class="p">].</span><span class="n">into</span><span class="p">();</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>å¯¹äºä½•æ—¶ã€å¦‚ä½•æˆ–ä¸ºä»€ä¹ˆæˆ‘ä»¬åº”è¯¥ä¸ºæˆ‘ä»¬çš„ç±»å‹å®ç° <code>From&lt;T&gt;</code>ï¼Œæ²¡æœ‰ä»»ä½•è§„åˆ™ï¼Œæ‰€ä»¥è¿™å–å†³äºæˆ‘ä»¬å¯¹æ¯ç§æƒ…å†µçš„æœ€ä½³åˆ¤æ–­ã€‚</p>
<p><code>Into&lt;T&gt;</code> çš„ä¸€ä¸ªæµè¡Œç”¨æ³•æ˜¯ä½¿éœ€è¦è‡ªæœ‰å€¼(owned values)çš„å‡½æ•°åœ¨æ¥å—è‡ªæœ‰å€¼æˆ–å€Ÿç”¨å€¼æ—¶å…·æœ‰é€šç”¨æ€§ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">struct</span> <span class="nc">Person</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">name</span>: <span class="nb">String</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// accepts:
</span><span class="c1"></span><span class="w">    </span><span class="c1">// - String
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">new1</span><span class="p">(</span><span class="n">name</span>: <span class="nb">String</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Person</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="c1">// accepts:
</span><span class="c1"></span><span class="w">    </span><span class="c1">// - String
</span><span class="c1"></span><span class="w">    </span><span class="c1">// - &amp;String
</span><span class="c1"></span><span class="w">    </span><span class="c1">// - &amp;str
</span><span class="c1"></span><span class="w">    </span><span class="c1">// - Box&lt;str&gt;
</span><span class="c1"></span><span class="w">    </span><span class="c1">// - Cow&lt;&#39;_, str&gt;
</span><span class="c1"></span><span class="w">    </span><span class="c1">// - char
</span><span class="c1"></span><span class="w">    </span><span class="c1">// since all of the above types can be converted into String
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">new2</span><span class="o">&lt;</span><span class="n">N</span>: <span class="nb">Into</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">name</span>: <span class="nc">N</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Person</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Person</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">name</span>: <span class="nc">name</span><span class="p">.</span><span class="n">into</span><span class="p">()</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><h2 id="é”™è¯¯å¤„ç†">é”™è¯¯å¤„ç†</h2>
<p>è°ˆè®ºé”™è¯¯å¤„ç†å’Œ <code>Error</code> trait çš„æœ€ä½³æ—¶æœºæ˜¯åœ¨è®¨è®ºå®Œ <code>Display</code>ã€<code>Debug</code>ã€<code>Any</code> å’Œ <code>From</code> ä¹‹åï¼Œåœ¨è®¨è®º <code>TryFrom</code> ä¹‹å‰ï¼Œå› æ­¤é”™è¯¯å¤„ç†éƒ¨åˆ†ä¸è½¬æ¢ trait éƒ¨åˆ†å°´å°¬åœ°ä¸€åˆ†ä¸ºäºŒã€‚</p>
<h3 id="error">Error</h3>
<p>é¢„å¤‡çŸ¥è¯†</p>
<ul>
<li><a href="#self">Self</a></li>
<li><a href="#methods">Methods</a></li>
<li><a href="#default-impls">Default Impls</a></li>
<li><a href="#generic-blanket-impls">Generic Blanket Impls</a></li>
<li><a href="#subtraits--supertraits">Subtraits &amp; Supertraits</a></li>
<li><a href="#trait-objects">Trait Objects</a></li>
<li><a href="#display--tostring">Display &amp; ToString</a></li>
<li><a href="#debug">Debug</a></li>
<li><a href="#any">Any</a></li>
<li><a href="#from--into">From &amp; Into</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">Error</span>: <span class="nc">Debug</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Display</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// provided default impls
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">source</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;&amp;</span><span class="p">(</span><span class="n">dyn</span><span class="w"> </span><span class="n">Error</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">&#39;static</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">backtrace</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;&amp;</span><span class="n">Backtrace</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">description</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="kt">str</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">cause</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;&amp;</span><span class="n">dyn</span><span class="w"> </span><span class="n">Error</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>åœ¨ Rust ä¸­ï¼Œé”™è¯¯è¢«è¿”å›ï¼Œè€Œä¸æ˜¯è¢«æŠ›å‡ºã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€äº›ä¾‹å­ã€‚</p>
<p>ç”±äºæ•´æ•°ç±»å‹é™¤ä»¥0ä¼šå¼•èµ· panicï¼Œå¦‚æœæˆ‘ä»¬æƒ³è®©æˆ‘ä»¬çš„ç¨‹åºæ›´å®‰å…¨ã€æ›´æ˜ç¡®ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ª <code>safe_div</code> å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ª <code>Result</code>ï¼Œå°±åƒè¿™æ ·ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">fmt</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">error</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[derive(Debug, PartialEq)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">DivByZero</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">fmt</span>::<span class="n">Display</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">DivByZero</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">fmt</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">fmt</span>::<span class="n">Formatter</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">fmt</span>::<span class="nb">Result</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">write</span><span class="o">!</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;division by zero error&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">error</span>::<span class="n">Error</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">DivByZero</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">safe_div</span><span class="p">(</span><span class="n">numerator</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">denominator</span>: <span class="kt">i32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">DivByZero</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">denominator</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">DivByZero</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="n">numerator</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">denominator</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[test]</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">test_safe_div</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">safe_div</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="mi">4</span><span class="p">));</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">safe_div</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">DivByZero</span><span class="p">));</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>ç”±äºé”™è¯¯æ˜¯è¿”å›çš„ï¼Œè€Œä¸æ˜¯æŠ›å‡ºçš„ï¼Œæ‰€ä»¥å¿…é¡»æ˜¾å¼å¤„ç†ï¼Œå¦‚æœå½“å‰å‡½æ•°ä¸èƒ½å¤„ç†ä¸€ä¸ªé”™è¯¯ï¼Œå®ƒåº”è¯¥å°†å…¶ä¼ æ’­ç»™è°ƒç”¨è€…ã€‚ä¼ æ’­é”™è¯¯çš„æœ€ä¹ æƒ¯çš„æ–¹æ³•æ˜¯ä½¿ç”¨ <code>?</code> æ“ä½œç¬¦ï¼Œå®ƒåªæ˜¯ç°åœ¨è¢«åºŸå¼ƒçš„ <code>try!</code> å®çš„è¯­æ³•ç³–ï¼Œå®ƒåªæ˜¯åšè¿™ä¸ªã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="n">macro_rules</span><span class="o">!</span><span class="w"> </span><span class="kr">try</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="p">(</span><span class="cp">$expr</span>:<span class="nc">expr</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="cp">$expr</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="c1">// if Ok just unwrap the value
</span><span class="c1"></span><span class="w">            </span><span class="nb">Ok</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">val</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="c1">// if Err map the err value using From and return
</span><span class="c1"></span><span class="w">            </span><span class="nb">Err</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="nb">From</span>::<span class="n">from</span><span class="p">(</span><span class="n">err</span><span class="p">));</span><span class="w">
</span><span class="w">            </span><span class="p">}</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">};</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>å¦‚æœæˆ‘ä»¬æƒ³å†™ä¸€ä¸ªå°†æ–‡ä»¶è¯»æˆ <code>String</code> çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼Œç”¨ <code>?</code> å°† <code>io::Error</code> ä¼ æ’­åˆ°å®ƒä»¬å¯èƒ½å‡ºç°çš„ä»»ä½•åœ°æ–¹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">io</span>::<span class="n">Read</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">path</span>::<span class="n">Path</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">io</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">fs</span>::<span class="n">File</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">read_file_to_string</span><span class="p">(</span><span class="n">path</span>: <span class="kp">&amp;</span><span class="nc">Path</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="n">io</span>::<span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span>::<span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// â¬†ï¸ io::Error
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">contents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">new</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">file</span><span class="p">.</span><span class="n">read_to_string</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">contents</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// â¬†ï¸ io::Error
</span><span class="c1"></span><span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="n">contents</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>ä½†æ˜¯ï¼Œå‡è®¾æˆ‘ä»¬æ­£åœ¨è¯»å–çš„æ–‡ä»¶å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ•°å­—åˆ—è¡¨ï¼Œæˆ‘ä»¬æƒ³æŠŠå®ƒä»¬åŠ åœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬ä¼šåƒè¿™æ ·æ›´æ–°æˆ‘ä»¬çš„å‡½æ•°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">io</span>::<span class="n">Read</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">path</span>::<span class="n">Path</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">io</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">fs</span>::<span class="n">File</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">sum_file</span><span class="p">(</span><span class="n">path</span>: <span class="kp">&amp;</span><span class="nc">Path</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="cm">/* What to put here? */</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span>::<span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// â¬†ï¸ io::Error
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">contents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">new</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">file</span><span class="p">.</span><span class="n">read_to_string</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">contents</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// â¬†ï¸ io::Error
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">contents</span><span class="p">.</span><span class="n">lines</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">line</span><span class="p">.</span><span class="n">parse</span>::<span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// â¬†ï¸ ParseIntError
</span><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="n">sum</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>ä½†æ˜¯ç°åœ¨æˆ‘ä»¬çš„ <code>Result</code> çš„é”™è¯¯ç±»å‹æ˜¯ä»€ä¹ˆï¼Ÿå®ƒå¯ä»¥è¿”å›ä¸€ä¸ª <code>io::Error</code> æˆ–è€…ä¸€ä¸ª <code>ParseIntError</code>ã€‚æˆ‘ä»¬å°†çœ‹ä¸€ä¸‹è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸‰ç§æ–¹æ³•ï¼Œä»ä¸´æ—¶åº”æ€¥çš„æ–¹æ³•å¼€å§‹ï¼Œæœ€åæ˜¯æœ€ç¨³å¥çš„æ–¹æ³•ã€‚</p>
<p>ç¬¬ä¸€ç§æ–¹æ³•æ˜¯è®¤è¯†åˆ°æ‰€æœ‰å®ç°äº† <code>Error</code> çš„ç±»å‹ä¹Ÿå®ç°äº† <code>Display</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰çš„é”™è¯¯æ˜ å°„åˆ° <code>String</code>ï¼Œå¹¶ä½¿ç”¨ <code>String</code> ä½œä¸ºæˆ‘ä»¬çš„é”™è¯¯ç±»å‹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">fs</span>::<span class="n">File</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">io</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">io</span>::<span class="n">Read</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">path</span>::<span class="n">Path</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">sum_file</span><span class="p">(</span><span class="n">path</span>: <span class="kp">&amp;</span><span class="nc">Path</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span>::<span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">map_err</span><span class="p">(</span><span class="o">|</span><span class="n">e</span><span class="o">|</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">to_string</span><span class="p">())</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// â¬†ï¸ io::Error -&gt; String
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">contents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">new</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">file</span><span class="p">.</span><span class="n">read_to_string</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">contents</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">.</span><span class="n">map_err</span><span class="p">(</span><span class="o">|</span><span class="n">e</span><span class="o">|</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">to_string</span><span class="p">())</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// â¬†ï¸ io::Error -&gt; String
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">contents</span><span class="p">.</span><span class="n">lines</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">line</span><span class="p">.</span><span class="n">parse</span>::<span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="p">()</span><span class="w">
</span><span class="w">            </span><span class="p">.</span><span class="n">map_err</span><span class="p">(</span><span class="o">|</span><span class="n">e</span><span class="o">|</span><span class="w"> </span><span class="n">e</span><span class="p">.</span><span class="n">to_string</span><span class="p">())</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// â¬†ï¸ ParseIntError -&gt; String
</span><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="n">sum</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>å¯¹æ¯ä¸ªé”™è¯¯è¿›è¡Œå­—ç¬¦ä¸²åŒ–å¤„ç†çš„æ˜æ˜¾ç¼ºç‚¹æ˜¯ï¼Œæˆ‘ä»¬ä¸¢å¼ƒäº†ç±»å‹ä¿¡æ¯ï¼Œè¿™ä½¿å¾—è°ƒç”¨è€…æ›´éš¾å¤„ç†é”™è¯¯ã€‚</p>
<p>ä¸Šè¿°æ–¹æ³•çš„ä¸€ä¸ªéæ˜¾è€Œæ˜“è§çš„å¥½å¤„æ˜¯æˆ‘ä»¬å¯ä»¥å®šåˆ¶å­—ç¬¦ä¸²ä»¥æä¾›æ›´å¤šçš„ç‰¹å®šç¯å¢ƒä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œ<code>ParseIntError</code> é€šå¸¸å­—ç¬¦ä¸²åŒ–ä¸º &ldquo;invalid digit found in string&rdquo;ï¼Œè¿™æ˜¯éå¸¸æ¨¡ç³Šçš„ï¼Œæ²¡æœ‰æåˆ°æ— æ•ˆçš„å­—ç¬¦ä¸²æ˜¯ä»€ä¹ˆæˆ–è€…å®ƒè¯•å›¾è§£ææˆä»€ä¹ˆæ•´æ•°ç±»å‹ã€‚å¦‚æœæˆ‘ä»¬è¦è°ƒè¯•è¿™ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªé”™è¯¯ä¿¡æ¯å‡ ä¹æ˜¯æ— ç”¨çš„ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå·±æä¾›æ‰€æœ‰ä¸ä¸Šä¸‹æ–‡ç›¸å…³çš„ä¿¡æ¯æ¥ä½¿å…¶æ˜æ˜¾æ”¹å–„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">line</span><span class="p">.</span><span class="n">parse</span>::<span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="p">()</span><span class="w">
</span><span class="w">    </span><span class="p">.</span><span class="n">map_err</span><span class="p">(</span><span class="o">|</span><span class="n">_</span><span class="o">|</span><span class="w"> </span><span class="n">format</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;failed to parse {} into i32&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="p">))</span><span class="o">?</span><span class="p">;</span><span class="w">
</span></code></pre></div><p>ç¬¬äºŒç§æ–¹æ³•æ˜¯åˆ©ç”¨æ ‡å‡†åº“ä¸­çš„è¿™ç§æ³›å‹å…¨é¢å®ç°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">impl</span><span class="o">&lt;</span><span class="n">E</span>: <span class="nc">error</span>::<span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">From</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="n">dyn</span><span class="w"> </span><span class="n">error</span>::<span class="n">Error</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span></code></pre></div><p>è¿™æ„å‘³ç€ä»»ä½• <code>Error</code> ç±»å‹éƒ½å¯ä»¥é€šè¿‡ <code>?</code> è¿ç®—ç¬¦éšå¼åœ°è½¬æ¢ä¸º <code>Box&lt;dyn error::Error&gt;</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•äº§ç”Ÿé”™è¯¯çš„å‡½æ•°çš„ <code>Result</code> è¿”å›ç±»å‹ä¸­æŠŠé”™è¯¯ç±»å‹è®¾ç½®ä¸º <code>Box&lt;dyn error::Error&gt;</code>ï¼Œ<code>?</code> è¿ç®—ç¬¦å°†ä¸ºæˆ‘ä»¬å®Œæˆå…¶ä½™çš„å·¥ä½œã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">fs</span>::<span class="n">File</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">io</span>::<span class="n">Read</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">path</span>::<span class="n">Path</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">error</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">sum_file</span><span class="p">(</span><span class="n">path</span>: <span class="kp">&amp;</span><span class="nc">Path</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="nb">Box</span><span class="o">&lt;</span><span class="n">dyn</span><span class="w"> </span><span class="n">error</span>::<span class="n">Error</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span>::<span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// â¬†ï¸ io::Error -&gt; Box&lt;dyn error::Error&gt;
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">contents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">new</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">file</span><span class="p">.</span><span class="n">read_to_string</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">contents</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// â¬†ï¸ io::Error -&gt; Box&lt;dyn error::Error&gt;
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">contents</span><span class="p">.</span><span class="n">lines</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">line</span><span class="p">.</span><span class="n">parse</span>::<span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// â¬†ï¸ ParseIntError -&gt; Box&lt;dyn error::Error&gt;
</span><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="n">sum</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>è™½ç„¶æ›´åŠ ç®€æ´ï¼Œä½†è¿™ä¼¼ä¹ä¸ä¹‹å‰çš„æ–¹æ³•æœ‰ç›¸åŒçš„ç¼ºç‚¹ï¼Œå³ä¸¢å¼ƒäº†ç±»å‹ä¿¡æ¯ã€‚è¿™å¤§éƒ¨åˆ†æ˜¯çœŸçš„ï¼Œä½†æ˜¯å¦‚æœè°ƒç”¨è€…çŸ¥é“æˆ‘ä»¬å‡½æ•°çš„å®ç°ç»†èŠ‚ï¼Œä»–ä»¬ä»ç„¶å¯ä»¥ä½¿ç”¨ <code>error::Error</code> ä¸Šçš„ <code>downcast_ref()</code> æ–¹æ³•æ¥å¤„ç†ä¸åŒçš„é”™è¯¯ç±»å‹ï¼Œè¿™å’Œå®ƒåœ¨ <code>dyn Any</code> ç±»å‹ä¸Šçš„ä½œç”¨æ˜¯ä¸€æ ·çš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">handle_sum_file_errors</span><span class="p">(</span><span class="n">path</span>: <span class="kp">&amp;</span><span class="nc">Path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">sum_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">sum</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;the sum is {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">sum</span><span class="p">),</span><span class="w">
</span><span class="w">        </span><span class="nb">Err</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">err</span><span class="p">.</span><span class="n">downcast_ref</span>::<span class="o">&lt;</span><span class="n">io</span>::<span class="n">Error</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">                </span><span class="c1">// handle io::Error
</span><span class="c1"></span><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">err</span><span class="p">.</span><span class="n">downcast_ref</span>::<span class="o">&lt;</span><span class="n">ParseIntError</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">                </span><span class="c1">// handle ParseIntError
</span><span class="c1"></span><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">                </span><span class="c1">// we know sum_file can only return one of the
</span><span class="c1"></span><span class="w">                </span><span class="c1">// above errors so this branch is unreachable
</span><span class="c1"></span><span class="w">                </span><span class="n">unreachable</span><span class="o">!</span><span class="p">();</span><span class="w">
</span><span class="w">            </span><span class="p">}</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>ç¬¬ä¸‰ç§æ–¹æ³•æ˜¯æœ€ç¨³å¥å’Œç±»å‹å®‰å…¨çš„æ–¹æ³•ï¼Œå¯ä»¥èšåˆè¿™äº›ä¸åŒçš„é”™è¯¯ï¼Œæ˜¯ä½¿ç”¨ä¸€ä¸ªæšä¸¾å»ºç«‹æˆ‘ä»¬è‡ªå·±çš„è‡ªå®šä¹‰é”™è¯¯ç±»å‹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">num</span>::<span class="n">ParseIntError</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">fs</span>::<span class="n">File</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">io</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">io</span>::<span class="n">Read</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">path</span>::<span class="n">Path</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">error</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">fmt</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[derive(Debug)]</span><span class="w">
</span><span class="w"></span><span class="k">enum</span> <span class="nc">SumFileError</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">Io</span><span class="p">(</span><span class="n">io</span>::<span class="n">Error</span><span class="p">),</span><span class="w">
</span><span class="w">    </span><span class="n">Parse</span><span class="p">(</span><span class="n">ParseIntError</span><span class="p">),</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">From</span><span class="o">&lt;</span><span class="n">io</span>::<span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SumFileError</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">err</span>: <span class="nc">io</span>::<span class="n">Error</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">SumFileError</span>::<span class="n">Io</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">From</span><span class="o">&lt;</span><span class="n">ParseIntError</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SumFileError</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">err</span>: <span class="nc">ParseIntError</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">SumFileError</span>::<span class="n">Parse</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">fmt</span>::<span class="n">Display</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SumFileError</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">fmt</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">fmt</span>::<span class="n">Formatter</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">fmt</span>::<span class="nb">Result</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="k">match</span><span class="w"> </span><span class="bp">self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">SumFileError</span>::<span class="n">Io</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">write</span><span class="o">!</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;sum file error: {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">),</span><span class="w">
</span><span class="w">            </span><span class="n">SumFileError</span>::<span class="n">Parse</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">write</span><span class="o">!</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;sum file error: {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="p">),</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">error</span>::<span class="n">Error</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">SumFileError</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// the default impl for this method always returns None
</span><span class="c1"></span><span class="w">    </span><span class="c1">// but we can now override it to make it way more useful!
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">source</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;&amp;</span><span class="p">(</span><span class="n">dyn</span><span class="w"> </span><span class="n">error</span>::<span class="n">Error</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">&#39;static</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="nb">Some</span><span class="p">(</span><span class="k">match</span><span class="w"> </span><span class="bp">self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">SumFileError</span>::<span class="n">Io</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">err</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">SumFileError</span>::<span class="n">Parse</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">err</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="p">})</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">sum_file</span><span class="p">(</span><span class="n">path</span>: <span class="kp">&amp;</span><span class="nc">Path</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">SumFileError</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span>::<span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// â¬†ï¸ io::Error -&gt; SumFileError
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">contents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">new</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">file</span><span class="p">.</span><span class="n">read_to_string</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">contents</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// â¬†ï¸ io::Error -&gt; SumFileError
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">contents</span><span class="p">.</span><span class="n">lines</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">line</span><span class="p">.</span><span class="n">parse</span>::<span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">// â¬†ï¸ ParseIntError -&gt; SumFileError
</span><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="n">sum</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">handle_sum_file_errors</span><span class="p">(</span><span class="n">path</span>: <span class="kp">&amp;</span><span class="nc">Path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">match</span><span class="w"> </span><span class="n">sum_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">sum</span><span class="p">)</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">println</span><span class="o">!</span><span class="p">(</span><span class="s">&#34;the sum is {}&#34;</span><span class="p">,</span><span class="w"> </span><span class="n">sum</span><span class="p">),</span><span class="w">
</span><span class="w">        </span><span class="nb">Err</span><span class="p">(</span><span class="n">SumFileError</span>::<span class="n">Io</span><span class="p">(</span><span class="n">err</span><span class="p">))</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="c1">// handle io::Error
</span><span class="c1"></span><span class="w">        </span><span class="p">},</span><span class="w">
</span><span class="w">        </span><span class="nb">Err</span><span class="p">(</span><span class="n">SumFileError</span>::<span class="n">Parse</span><span class="p">(</span><span class="n">err</span><span class="p">))</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="c1">// handle ParseIntError
</span><span class="c1"></span><span class="w">        </span><span class="p">},</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><h2 id="conversion-traits-continued">Conversion Traits Continued</h2>
<h3 id="tryfrom--tryinto">TryFrom &amp; TryInto</h3>
<p>é¢„å¤‡çŸ¥è¯†</p>
<ul>
<li><a href="#self">Self</a></li>
<li><a href="#functions">Functions</a></li>
<li><a href="#methods">Methods</a></li>
<li><a href="#associated-types">Associated Types</a></li>
<li><a href="#generic-parameters">Generic Parameters</a></li>
<li><a href="#generic-types-vs-associated-types">Generic Types vs Associated Types</a></li>
<li><a href="#generic-blanket-impls">Generic Blanket Impls</a></li>
<li><a href="#from--into">From &amp; Into</a></li>
<li><a href="#error">Error</a></li>
</ul>
<p><code>TryFrom</code> and <code>TryInto</code> are the  versions of <code>From</code> and <code>Into</code>.
<code>TryFrom</code> å’Œ <code>TryInto</code> æ˜¯ <code>From</code> å’Œ <code>Into</code> çš„ä¸å¯é ç‰ˆæœ¬ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">TryFrom</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Error</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">try_from</span><span class="p">(</span><span class="n">value</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="n">Self</span><span class="p">,</span><span class="w"> </span><span class="n">Self</span>::<span class="n">Error</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">trait</span><span class="w"> </span><span class="n">TryInto</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Error</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">try_into</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">Self</span>::<span class="n">Error</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>Similarly to <code>Into</code> we cannot impl <code>TryInto</code> because its impl is provided by this generic blanket impl:
ä¸ <code>Into</code> ç±»ä¼¼ï¼Œæˆ‘ä»¬ä¸èƒ½å®ç° <code>TryInto</code>ï¼Œå› ä¸ºå®ƒçš„å®ç°æ˜¯ç”±ä¸‹é¢è¿™ä¸ªæ³›å‹å…¨é¢å®ç°æä¾›çš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="o">&gt;</span><span class="w"> </span><span class="n">TryInto</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">T</span><span class="w">
</span><span class="w"></span><span class="k">where</span><span class="w">
</span><span class="w">    </span><span class="n">U</span>: <span class="nc">TryFrom</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">U</span>::<span class="n">Error</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">try_into</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="n">U</span><span class="p">,</span><span class="w"> </span><span class="n">U</span>::<span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">U</span>::<span class="n">try_from</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>Let&rsquo;s say that in the context of our program it doesn&rsquo;t make sense for <code>Point</code>s to have <code>x</code> and <code>y</code> values that are less than <code>-1000</code> or greater than <code>1000</code>. This is how we&rsquo;d rewrite our earlier <code>From</code> impls using <code>TryFrom</code> to signal to the users of our type that this conversion can now fail:
å‡è®¾åœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­ï¼Œ<code>Point</code> çš„ <code>x</code> å’Œ <code>y</code> çš„å€¼å°äº <code>-1000</code> æˆ–å¤§äº <code>1000</code> æ˜¯ä¸åˆç†çš„ã€‚è¿™å°±æ˜¯æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨ <code>TryFrom</code> é‡å†™æˆ‘ä»¬å…ˆå‰çš„ <code>From</code> å®ç°ï¼Œå‘æˆ‘ä»¬ç±»å‹çš„ç”¨æˆ·å‘å‡ºä¿¡å·ï¼Œè¿™ä¸ªè½¬æ¢ç°åœ¨å¯ä»¥å¤±è´¥ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">convert</span>::<span class="n">TryFrom</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">error</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">fmt</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[derive(Debug)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">OutOfBounds</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">fmt</span>::<span class="n">Display</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">OutOfBounds</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">fmt</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">fmt</span>::<span class="n">Formatter</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">fmt</span>::<span class="nb">Result</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">write</span><span class="o">!</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;out of bounds&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">error</span>::<span class="n">Error</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">OutOfBounds</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// now fallible
</span><span class="c1"></span><span class="k">impl</span><span class="w"> </span><span class="n">TryFrom</span><span class="o">&lt;</span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OutOfBounds</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">try_from</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>: <span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">))</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="n">Point</span><span class="p">,</span><span class="w"> </span><span class="n">OutOfBounds</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">abs</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">y</span><span class="p">.</span><span class="n">abs</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">OutOfBounds</span><span class="p">);</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">})</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// still infallible
</span><span class="c1"></span><span class="k">impl</span><span class="w"> </span><span class="nb">From</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">}</span>: <span class="nc">Point</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>And here&rsquo;s the refactored <code>TryFrom&lt;[TryInto&lt;Point&gt;; 3]&gt;</code> impl for <code>Triangle</code>:
è¿™é‡Œæ˜¯é‡æ„åçš„ <code>TryFrom&lt;[TryInto&lt;Point&gt;; 3]&gt;</code> å®ç°ï¼Œç”¨äº <code>Triangle</code>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">convert</span>::<span class="p">{</span><span class="n">TryFrom</span><span class="p">,</span><span class="w"> </span><span class="n">TryInto</span><span class="p">};</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">error</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">fmt</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[derive(Debug)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">OutOfBounds</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">fmt</span>::<span class="n">Display</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">OutOfBounds</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">fmt</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">fmt</span>::<span class="n">Formatter</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">fmt</span>::<span class="nb">Result</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">write</span><span class="o">!</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;out of bounds&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">error</span>::<span class="n">Error</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">OutOfBounds</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">TryFrom</span><span class="o">&lt;</span><span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">OutOfBounds</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">try_from</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>: <span class="p">(</span><span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="kt">i32</span><span class="p">))</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="n">Self</span><span class="p">,</span><span class="w"> </span><span class="n">Self</span>::<span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">abs</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">y</span><span class="p">.</span><span class="n">abs</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">OutOfBounds</span><span class="p">);</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">})</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Triangle</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">p1</span>: <span class="nc">Point</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">p2</span>: <span class="nc">Point</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">p3</span>: <span class="nc">Point</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span><span class="w"> </span><span class="n">TryFrom</span><span class="o">&lt;</span><span class="p">[</span><span class="n">P</span><span class="p">;</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Triangle</span><span class="w">
</span><span class="w"></span><span class="k">where</span><span class="w">
</span><span class="w">    </span><span class="n">P</span>: <span class="nc">TryInto</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">P</span>::<span class="n">Error</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">try_from</span><span class="p">([</span><span class="n">p1</span><span class="p">,</span><span class="w"> </span><span class="n">p2</span><span class="p">,</span><span class="w"> </span><span class="n">p3</span><span class="p">]</span>: <span class="p">[</span><span class="n">P</span><span class="p">;</span><span class="w"> </span><span class="mi">3</span><span class="p">])</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="n">Self</span><span class="p">,</span><span class="w"> </span><span class="n">Self</span>::<span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">Triangle</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">p1</span>: <span class="nc">p1</span><span class="p">.</span><span class="n">try_into</span><span class="p">()</span><span class="o">?</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">p2</span>: <span class="nc">p2</span><span class="p">.</span><span class="n">try_into</span><span class="p">()</span><span class="o">?</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">p3</span>: <span class="nc">p3</span><span class="p">.</span><span class="n">try_into</span><span class="p">()</span><span class="o">?</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="p">})</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">example</span><span class="p">()</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="n">Triangle</span><span class="p">,</span><span class="w"> </span><span class="n">OutOfBounds</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">t</span>: <span class="nc">Triangle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)].</span><span class="n">try_into</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="nb">Ok</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id="fromstr">FromStr</h3>
<p>é¢„å¤‡çŸ¥è¯†</p>
<ul>
<li><a href="#self">Self</a></li>
<li><a href="#functions">Functions</a></li>
<li><a href="#associated-types">Associated Types</a></li>
<li><a href="#error">Error</a></li>
<li><a href="#tryfrom--tryinto">TryFrom &amp; TryInto</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">FromStr</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nb">Err</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">from_str</span><span class="p">(</span><span class="n">s</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="n">Self</span><span class="p">,</span><span class="w"> </span><span class="n">Self</span>::<span class="nb">Err</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><code>FromStr</code> types allow performing a fallible conversion from <code>&amp;str</code> into <code>Self</code>. The idiomatic way to use <code>FromStr</code> is to call the <code>.parse()</code> method on <code>&amp;str</code>s:
<code>FromStr</code> ç±»å‹å…è®¸æ‰§è¡Œä» <code>&amp;str</code> åˆ° <code>Self</code> çš„é”™è¯¯è½¬æ¢ã€‚ä½¿ç”¨ <code>FromStr</code> çš„ä¹ æƒ¯æ–¹æ³•æ˜¯å¯¹ <code>&amp;str</code> è°ƒç”¨ <code>.parse()</code> æ–¹æ³•ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="kt">str</span>::<span class="n">FromStr</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">example</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nc">FromStr</span><span class="o">&gt;</span><span class="p">(</span><span class="n">s</span>: <span class="kp">&amp;</span><span class="nb">&#39;static</span><span class="w"> </span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// these are all equivalent
</span><span class="c1"></span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">t</span>: <span class="nb">Result</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FromStr</span>::<span class="n">from_str</span><span class="p">(</span><span class="n">s</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span>::<span class="n">from_str</span><span class="p">(</span><span class="n">s</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">t</span>: <span class="nb">Result</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">parse</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">parse</span>::<span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">();</span><span class="w"> </span><span class="c1">// most idiomatic
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><code>Point</code> å®ç°çš„ä¾‹å­:</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">error</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">fmt</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">iter</span>::<span class="n">Enumerate</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">num</span>::<span class="n">ParseIntError</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="kt">str</span>::<span class="p">{</span><span class="n">Chars</span><span class="p">,</span><span class="w"> </span><span class="n">FromStr</span><span class="p">};</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[derive(Debug, Eq, PartialEq)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">x</span>: <span class="kt">i32</span><span class="p">,</span><span class="w"> </span><span class="n">y</span>: <span class="kt">i32</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[derive(Debug, PartialEq)]</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">ParsePointError</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">fmt</span>::<span class="n">Display</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">ParsePointError</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">fmt</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">fmt</span>::<span class="n">Formatter</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">fmt</span>::<span class="nb">Result</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">write</span><span class="o">!</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;failed to parse point&#34;</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">From</span><span class="o">&lt;</span><span class="n">ParseIntError</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">ParsePointError</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">from</span><span class="p">(</span><span class="n">_e</span>: <span class="nc">ParseIntError</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">ParsePointError</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">error</span>::<span class="n">Error</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">ParsePointError</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">FromStr</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nb">Err</span> <span class="o">=</span><span class="w"> </span><span class="n">ParsePointError</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">from_str</span><span class="p">(</span><span class="n">s</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="n">Self</span><span class="p">,</span><span class="w"> </span><span class="n">Self</span>::<span class="nb">Err</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">is_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">)</span>: <span class="kp">&amp;</span><span class="p">(</span><span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="n">char</span><span class="p">)</span><span class="o">|</span><span class="w"> </span><span class="n">matches</span><span class="o">!</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;0&#39;</span><span class="p">..</span><span class="o">=</span><span class="sc">&#39;9&#39;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="sc">&#39;-&#39;</span><span class="p">);</span><span class="w">
</span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">isnt_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">|</span><span class="n">t</span>: <span class="kp">&amp;</span><span class="p">(</span><span class="n">_</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="o">|</span><span class="w"> </span><span class="o">!</span><span class="n">is_num</span><span class="p">(</span><span class="n">t</span><span class="p">);</span><span class="w">
</span><span class="w">
</span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">get_num</span><span class="w"> </span><span class="o">=</span><span class="w">
</span><span class="w">            </span><span class="o">|</span><span class="n">char_idxs</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Enumerate</span><span class="o">&lt;</span><span class="n">Chars</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="o">&gt;&gt;|</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(</span><span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="kt">usize</span><span class="p">),</span><span class="w"> </span><span class="n">ParsePointError</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">                </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">char_idxs</span><span class="w">
</span><span class="w">                    </span><span class="p">.</span><span class="n">skip_while</span><span class="p">(</span><span class="n">isnt_num</span><span class="p">)</span><span class="w">
</span><span class="w">                    </span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="w">
</span><span class="w">                    </span><span class="p">.</span><span class="n">ok_or</span><span class="p">(</span><span class="n">ParsePointError</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w">
</span><span class="w">                </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">end</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">char_idxs</span><span class="w">
</span><span class="w">                    </span><span class="p">.</span><span class="n">skip_while</span><span class="p">(</span><span class="n">is_num</span><span class="p">)</span><span class="w">
</span><span class="w">                    </span><span class="p">.</span><span class="n">next</span><span class="p">()</span><span class="w">
</span><span class="w">                    </span><span class="p">.</span><span class="n">ok_or</span><span class="p">(</span><span class="n">ParsePointError</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w">
</span><span class="w">                </span><span class="nb">Ok</span><span class="p">((</span><span class="n">start</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="p">))</span><span class="w">
</span><span class="w">            </span><span class="p">};</span><span class="w">
</span><span class="w">
</span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">char_idxs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">chars</span><span class="p">().</span><span class="n">enumerate</span><span class="p">();</span><span class="w">
</span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">x_start</span><span class="p">,</span><span class="w"> </span><span class="n">x_end</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_num</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">char_idxs</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w">
</span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">y_start</span><span class="p">,</span><span class="w"> </span><span class="n">y_end</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_num</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">char_idxs</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">[</span><span class="n">x_start</span><span class="p">..</span><span class="n">x_end</span><span class="p">].</span><span class="n">parse</span>::<span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w">
</span><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">[</span><span class="n">y_start</span><span class="p">..</span><span class="n">y_end</span><span class="p">].</span><span class="n">parse</span>::<span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w">        </span><span class="nb">Ok</span><span class="p">(</span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">})</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[test]</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">pos_x_y</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;(4, 5)&#34;</span><span class="p">.</span><span class="n">parse</span>::<span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">Point</span>::<span class="n">new</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)));</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[test]</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">neg_x_y</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;(-6, -2)&#34;</span><span class="p">.</span><span class="n">parse</span>::<span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="nb">Ok</span><span class="p">(</span><span class="n">Point</span>::<span class="n">new</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span><span class="p">)));</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="cp">#[test]</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">not_a_point</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#34;not a point&#34;</span><span class="p">.</span><span class="n">parse</span>::<span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="nb">Err</span><span class="p">(</span><span class="n">ParsePointError</span><span class="p">));</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><code>FromStr</code> has the same signature as <code>TryFrom&lt;&amp;str&gt;</code>. It doesn&rsquo;t matter which one we impl for a type first as long as we forward the impl to the other one. Here&rsquo;s a <code>TryFrom&lt;&amp;str&gt;</code> impl for <code>Point</code> assuming it already has a <code>FromStr</code> impl:
<code>FromStr</code> ä¸ <code>TryFrom&lt;&amp;str&gt;</code> çš„ç­¾åç›¸åŒã€‚åªè¦æˆ‘ä»¬æŠŠå®ç°è½¬å‘ç»™å¦ä¸€ä¸ªç±»å‹ï¼Œå“ªä¸€ä¸ªå®ç°å¹¶ä¸é‡è¦ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªé’ˆå¯¹ <code>Point</code> çš„ <code>TryFrom&lt;&amp;str&gt;</code> å®ç°ï¼Œå‡è®¾å®ƒå·²ç»æœ‰ä¸€ä¸ª <code>FromStr</code> å®ç°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">impl</span><span class="w"> </span><span class="n">TryFrom</span><span class="o">&lt;&amp;</span><span class="kt">str</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Point</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&lt;</span><span class="n">Point</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">FromStr</span><span class="o">&gt;</span>::<span class="nb">Err</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">try_from</span><span class="p">(</span><span class="n">s</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="n">Point</span><span class="p">,</span><span class="w"> </span><span class="n">Self</span>::<span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="o">&lt;</span><span class="n">Point</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">FromStr</span><span class="o">&gt;</span>::<span class="n">from_str</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id="asref--asmut">AsRef &amp; AsMut</h3>
<p>é¢„å¤‡çŸ¥è¯†</p>
<ul>
<li><a href="#self">Self</a></li>
<li><a href="#methods">Methods</a></li>
<li><a href="#sized">Sized</a></li>
<li><a href="#generic-parameters">Generic Parameters</a></li>
<li><a href="#sized">Sized</a></li>
<li><a href="#deref--derefmut">Deref &amp; DerefMut</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="nb">AsRef</span><span class="o">&lt;</span><span class="n">T</span>: <span class="o">?</span><span class="nb">Sized</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">as_ref</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">T</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">trait</span><span class="w"> </span><span class="nb">AsMut</span><span class="o">&lt;</span><span class="n">T</span>: <span class="o">?</span><span class="nb">Sized</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">as_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">T</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><code>?Sized</code> è¯´æ˜ T ç±»å‹æ˜¯å¤§å°ä¸ç¡®å®šçš„ã€‚<code>As</code> ä½œä¸ºä»‹è¯, è¡¨æ˜å‘ç”Ÿäº†ç±»å‹è½¬æ¢ã€‚</p>
<p><code>AsRef</code> is for cheap reference to reference conversions. However, one of the most common ways it&rsquo;s used is to make functions generic over whether they take ownership or not:</p>
<p><code>AsRef</code> æ˜¯ç”¨äºå»‰ä»·çš„å¼•ç”¨åˆ°å¼•ç”¨çš„è½¬æ¢ã€‚ç„¶è€Œï¼Œå®ƒæœ€å¸¸è§çš„ä½¿ç”¨æ–¹å¼ä¹‹ä¸€æ˜¯ä½¿å‡½æ•°åœ¨æ˜¯å¦æ‹¥æœ‰æ‰€æœ‰æƒä¸Šé€šç”¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="c1">// accepts:
</span><span class="c1">//  - &amp;str
</span><span class="c1">//  - &amp;String
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">takes_str</span><span class="p">(</span><span class="n">s</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// use &amp;str
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// accepts:
</span><span class="c1">//  - &amp;str
</span><span class="c1">//  - &amp;String
</span><span class="c1">//  - String
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">takes_asref_str</span><span class="o">&lt;</span><span class="n">S</span>: <span class="nb">AsRef</span><span class="o">&lt;</span><span class="kt">str</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">s</span>: <span class="nc">S</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">s</span>: <span class="kp">&amp;</span><span class="kt">str</span> <span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">as_ref</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="c1">// use &amp;str
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">example</span><span class="p">(</span><span class="n">slice</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">,</span><span class="w"> </span><span class="n">borrow</span>: <span class="kp">&amp;</span><span class="nb">String</span><span class="p">,</span><span class="w"> </span><span class="n">owned</span>: <span class="nb">String</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">takes_str</span><span class="p">(</span><span class="n">slice</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">takes_str</span><span class="p">(</span><span class="n">borrow</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">takes_str</span><span class="p">(</span><span class="n">owned</span><span class="p">);</span><span class="w"> </span><span class="c1">// âŒ
</span><span class="c1"></span><span class="w">    </span><span class="n">takes_asref_str</span><span class="p">(</span><span class="n">slice</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">takes_asref_str</span><span class="p">(</span><span class="n">borrow</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">takes_asref_str</span><span class="p">(</span><span class="n">owned</span><span class="p">);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>The other most common use-case is returning a reference to inner private data wrapped by a type which protects some invariant. A good example from the standard library is <code>String</code> which is just a wrapper around <code>Vec&lt;u8&gt;</code>:</p>
<p>å¦ä¸€ä¸ªæœ€å¸¸è§çš„ç”¨ä¾‹æ˜¯è¿”å›ä¸€ä¸ªå¯¹å†…éƒ¨ç§æœ‰æ•°æ®çš„å¼•ç”¨ï¼Œè¯¥æ•°æ®ç”±ä¸€ä¸ªä¿æŠ¤æŸäº›ä¸å˜æ€§çš„ç±»å‹åŒ…è£¹ã€‚æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯ <code>String</code>ï¼Œå®ƒåªæ˜¯ <code>Vec&lt;u8&gt;</code> çš„ä¸€ä¸ªåŒ…è£…å™¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">struct</span> <span class="nb">String</span> <span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">vec</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>This inner <code>Vec</code> cannot be made public because if it was people could mutate any byte and break the <code>String</code>&rsquo;s valid UTF-8 encoding. However, it&rsquo;s safe to expose an immutable read-only reference to the inner byte array, hence this impl:
è¿™ä¸ªå†…éƒ¨çš„ <code>Vec</code> ä¸èƒ½è¢«å…¬å¼€ï¼Œå› ä¸ºå¦‚æœå®ƒè¢«å…¬å¼€ï¼Œäººä»¬å¯ä»¥æ”¹å˜ä»»ä½•å­—èŠ‚å¹¶ç ´å <code>String</code> çš„æœ‰æ•ˆ UTF-8 ç¼–ç ã€‚ç„¶è€Œï¼Œå…¬å¼€å†…éƒ¨å­—èŠ‚æ•°ç»„çš„ä¸å¯å˜çš„åªè¯»å¼•ç”¨æ˜¯å®‰å…¨çš„ï¼Œå› æ­¤æœ‰äº†è¿™ä¸ªå®ç°:</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">impl</span><span class="w"> </span><span class="nb">AsRef</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">u8</span><span class="p">]</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nb">String</span><span class="p">;</span><span class="w">
</span></code></pre></div><p>Generally, it often only makes sense to impl <code>AsRef</code> for a type if it wraps some other type to either provide additional functionality around the inner type or protect some invariant on the inner type.</p>
<p>Let&rsquo;s examine a example of bad <code>AsRef</code> impls:
ä¸€èˆ¬æ¥è¯´ï¼Œåªæœ‰å½“ä¸€ä¸ªç±»å‹åŒ…è£…äº†å…¶ä»–ç±»å‹ï¼Œä¸ºå†…éƒ¨ç±»å‹æä¾›äº†é¢å¤–çš„åŠŸèƒ½ï¼Œæˆ–è€…ä¿æŠ¤äº†å†…éƒ¨ç±»å‹çš„æŸäº›ä¸å˜æ€§æ—¶ï¼Œä¸ºå…¶å®ç° <code>AsRef</code> æ‰æœ‰æ„ä¹‰ã€‚</p>
<p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€ä¸ªä¸å¥½çš„ <code>AsRef</code> å®ç°çš„ä¾‹å­ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">struct</span> <span class="nc">User</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">name</span>: <span class="nb">String</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">age</span>: <span class="kt">u32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">AsRef</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">as_ref</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nb">String</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">name</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">AsRef</span><span class="o">&lt;</span><span class="kt">u32</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">as_ref</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="kt">u32</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">age</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>This works and kinda makes sense at first, but quickly falls apart if we add more members to <code>User</code>:
è¿™åœ¨ä¸€å¼€å§‹æ˜¯å¯è¡Œçš„ï¼Œè€Œä¸”æœ‰ç‚¹é“ç†ï¼Œä½†å¦‚æœæˆ‘ä»¬ç»™ <code>User</code> å¢åŠ æ›´å¤šçš„æˆå‘˜ï¼Œå¾ˆå¿«å°±ä¼šå´©æºƒã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">struct</span> <span class="nc">User</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">name</span>: <span class="nb">String</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">email</span>: <span class="nb">String</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">age</span>: <span class="kt">u32</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">height</span>: <span class="kt">u32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">AsRef</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">as_ref</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nb">String</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="c1">// uh, do we return name or email here?
</span><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">AsRef</span><span class="o">&lt;</span><span class="kt">u32</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">as_ref</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="kt">u32</span> <span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="c1">// uh, do we return age or height here?
</span><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>A <code>User</code> is composed of <code>String</code>s and <code>u32</code>s but it&rsquo;s not really the same thing as a <code>String</code> or a <code>u32</code>. Even if we had much more specific types:
<code>User</code> æ˜¯ç”± <code>String</code> å’Œ <code>u32</code> ç»„æˆçš„ï¼Œä½†å®ƒå’Œ <code>String</code> æˆ– <code>u32</code> å¹¶ä¸æ˜¯çœŸæ­£çš„ä¸€å›äº‹ã€‚å³ä½¿æˆ‘ä»¬æœ‰æ›´å…·ä½“çš„ç±»å‹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">struct</span> <span class="nc">User</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">name</span>: <span class="nc">Name</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">email</span>: <span class="nc">Email</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">age</span>: <span class="nc">Age</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">height</span>: <span class="nc">Height</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>It wouldn&rsquo;t make much sense to impl <code>AsRef</code> for any of those because <code>AsRef</code> is for cheap reference to reference conversions between semantically equivalent things, and <code>Name</code>, <code>Email</code>, <code>Age</code>, and <code>Height</code> by themselves are not the same thing as a <code>User</code>.</p>
<p>A good example where we would impl <code>AsRef</code> would be if we introduced a new type <code>Moderator</code> that just wrapped a <code>User</code> and added some moderation specific privileges:
å®ç° <code>AsRef</code> å¯¹è¿™äº›éƒ½æ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸º <code>AsRef</code> æ˜¯ç”¨æ¥åœ¨è¯­ä¹‰ä¸Šç­‰åŒçš„äº‹ç‰©ä¹‹é—´è¿›è¡Œå»‰ä»·çš„å¼•ç”¨è½¬æ¢ï¼Œè€Œ <code>Name</code>ã€<code>Email</code>ã€<code>Age</code> å’Œ <code>Height</code> æœ¬èº«å°±å’Œ <code>User</code> ä¸æ˜¯ä¸€å›äº‹ã€‚</p>
<p>ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å¼•å…¥ä¸€ä¸ªæ–°çš„ç±»å‹ <code>Moderator</code>ï¼Œå®ƒåªæ˜¯åŒ…è£¹äº†ä¸€ä¸ª <code>User</code>ï¼Œå¹¶å¢åŠ äº†ä¸€äº›ç‰¹å®šçš„ç®¡ç†æƒé™ï¼Œæˆ‘ä»¬å°±ä¼šä½¿ç”¨ <code>AsRef</code>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">struct</span> <span class="nc">User</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">name</span>: <span class="nb">String</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">age</span>: <span class="kt">u32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// unfortunately the standard library cannot provide
</span><span class="c1">// a generic blanket impl to save us from this boilerplate
</span><span class="c1"></span><span class="k">impl</span><span class="w"> </span><span class="nb">AsRef</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">User</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">as_ref</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">User</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">enum</span> <span class="nc">Privilege</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">BanUsers</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">EditPosts</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">DeletePosts</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// although Moderators have some special
</span><span class="c1">// privileges they are still regular Users
</span><span class="c1">// and should be able to do all the same stuff
</span><span class="c1"></span><span class="k">struct</span> <span class="nc">Moderator</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">user</span>: <span class="nc">User</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">privileges</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Privilege</span><span class="o">&gt;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">AsRef</span><span class="o">&lt;</span><span class="n">Moderator</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Moderator</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">as_ref</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">Moderator</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">AsRef</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Moderator</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">as_ref</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">User</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">user</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// this should be callable with Users
</span><span class="c1">// and Moderators (who are also Users)
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">create_post</span><span class="o">&lt;</span><span class="n">U</span>: <span class="nb">AsRef</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">u</span>: <span class="nc">U</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">as_ref</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="c1">// etc
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">example</span><span class="p">(</span><span class="n">user</span>: <span class="nc">User</span><span class="p">,</span><span class="w"> </span><span class="n">moderator</span>: <span class="nc">Moderator</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">create_post</span><span class="p">(</span><span class="o">&amp;</span><span class="n">user</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">create_post</span><span class="p">(</span><span class="o">&amp;</span><span class="n">moderator</span><span class="p">);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>This works because <code>Moderator</code>s are just <code>User</code>s. Here&rsquo;s the example from the <code>Deref</code> section except using <code>AsRef</code> instead:
è¿™æ ·åšæ˜¯å› ä¸º <code>Moderator</code> å°±æ˜¯ <code>User</code>ã€‚ä¸‹é¢æ˜¯ <code>Deref</code> éƒ¨åˆ†çš„ä¾‹å­ï¼Œåªæ˜¯ç”¨ <code>AsRef</code> ä»£æ›¿ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">convert</span>::<span class="nb">AsRef</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">Human</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">health_points</span>: <span class="kt">u32</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">AsRef</span><span class="o">&lt;</span><span class="n">Human</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Human</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">as_ref</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">Human</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">enum</span> <span class="nc">Weapon</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">Spear</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Axe</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Sword</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// a Soldier is just a Human with a Weapon
</span><span class="c1"></span><span class="k">struct</span> <span class="nc">Soldier</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">human</span>: <span class="nc">Human</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">weapon</span>: <span class="nc">Weapon</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">AsRef</span><span class="o">&lt;</span><span class="n">Soldier</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Soldier</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">as_ref</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">Soldier</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">AsRef</span><span class="o">&lt;</span><span class="n">Human</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Soldier</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">as_ref</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">Human</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">human</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">enum</span> <span class="nc">Mount</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">Horse</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Donkey</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Cow</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// a Knight is just a Soldier with a Mount
</span><span class="c1"></span><span class="k">struct</span> <span class="nc">Knight</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">soldier</span>: <span class="nc">Soldier</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">mount</span>: <span class="nc">Mount</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">AsRef</span><span class="o">&lt;</span><span class="n">Knight</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Knight</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">as_ref</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">Knight</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">AsRef</span><span class="o">&lt;</span><span class="n">Soldier</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Knight</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">as_ref</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">Soldier</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">soldier</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">AsRef</span><span class="o">&lt;</span><span class="n">Human</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Knight</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">as_ref</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">Human</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">soldier</span><span class="p">.</span><span class="n">human</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">enum</span> <span class="nc">Spell</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">MagicMissile</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">FireBolt</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">ThornWhip</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// a Mage is just a Human who can cast Spells
</span><span class="c1"></span><span class="k">struct</span> <span class="nc">Mage</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">human</span>: <span class="nc">Human</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">spells</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">Spell</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">AsRef</span><span class="o">&lt;</span><span class="n">Mage</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Mage</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">as_ref</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">Mage</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">AsRef</span><span class="o">&lt;</span><span class="n">Human</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Mage</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">as_ref</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">Human</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">human</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">enum</span> <span class="nc">Staff</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">Wooden</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Metallic</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Plastic</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// a Wizard is just a Mage with a Staff
</span><span class="c1"></span><span class="k">struct</span> <span class="nc">Wizard</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">mage</span>: <span class="nc">Mage</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">staff</span>: <span class="nc">Staff</span><span class="p">,</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">AsRef</span><span class="o">&lt;</span><span class="n">Wizard</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Wizard</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">as_ref</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">Wizard</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">AsRef</span><span class="o">&lt;</span><span class="n">Mage</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Wizard</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">as_ref</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">Mage</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">mage</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="nb">AsRef</span><span class="o">&lt;</span><span class="n">Human</span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">Wizard</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">as_ref</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">Human</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">mage</span><span class="p">.</span><span class="n">human</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">borrows_human</span><span class="o">&lt;</span><span class="n">H</span>: <span class="nb">AsRef</span><span class="o">&lt;</span><span class="n">Human</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">human</span>: <span class="nc">H</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">borrows_soldier</span><span class="o">&lt;</span><span class="n">S</span>: <span class="nb">AsRef</span><span class="o">&lt;</span><span class="n">Soldier</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">soldier</span>: <span class="nc">S</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">borrows_knight</span><span class="o">&lt;</span><span class="n">K</span>: <span class="nb">AsRef</span><span class="o">&lt;</span><span class="n">Knight</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">knight</span>: <span class="nc">K</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">borrows_mage</span><span class="o">&lt;</span><span class="n">M</span>: <span class="nb">AsRef</span><span class="o">&lt;</span><span class="n">Mage</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">mage</span>: <span class="nc">M</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">borrows_wizard</span><span class="o">&lt;</span><span class="n">W</span>: <span class="nb">AsRef</span><span class="o">&lt;</span><span class="n">Wizard</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">wizard</span>: <span class="nc">W</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">example</span><span class="p">(</span><span class="n">human</span>: <span class="nc">Human</span><span class="p">,</span><span class="w"> </span><span class="n">soldier</span>: <span class="nc">Soldier</span><span class="p">,</span><span class="w"> </span><span class="n">knight</span>: <span class="nc">Knight</span><span class="p">,</span><span class="w"> </span><span class="n">mage</span>: <span class="nc">Mage</span><span class="p">,</span><span class="w"> </span><span class="n">wizard</span>: <span class="nc">Wizard</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="c1">// all types can be used as Humans
</span><span class="c1"></span><span class="w">    </span><span class="n">borrows_human</span><span class="p">(</span><span class="o">&amp;</span><span class="n">human</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">borrows_human</span><span class="p">(</span><span class="o">&amp;</span><span class="n">soldier</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">borrows_human</span><span class="p">(</span><span class="o">&amp;</span><span class="n">knight</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">borrows_human</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mage</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">borrows_human</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wizard</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="c1">// Knights can be used as Soldiers
</span><span class="c1"></span><span class="w">    </span><span class="n">borrows_soldier</span><span class="p">(</span><span class="o">&amp;</span><span class="n">soldier</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">borrows_soldier</span><span class="p">(</span><span class="o">&amp;</span><span class="n">knight</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="c1">// Wizards can be used as Mages
</span><span class="c1"></span><span class="w">    </span><span class="n">borrows_mage</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mage</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">borrows_mage</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wizard</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="c1">// Knights &amp; Wizards passed as themselves
</span><span class="c1"></span><span class="w">    </span><span class="n">borrows_knight</span><span class="p">(</span><span class="o">&amp;</span><span class="n">knight</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">borrows_wizard</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wizard</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><code>Deref</code> didn&rsquo;t work in the prior version of the example above because deref coercion is an implicit conversion between types which leaves room for people to mistakenly formulate the wrong ideas and expectations for how it will behave. <code>AsRef</code> works above because it makes the conversion between types explicit and there&rsquo;s no room leftover to develop any wrong ideas or expectations.
<code>Deref</code> åœ¨ä¸Šè¿°ä¾‹å­çš„å…ˆå‰ç‰ˆæœ¬ä¸­ä¸èµ·ä½œç”¨ï¼Œå› ä¸º deref coercion æ˜¯ä¸€ç§éšå¼ç±»å‹è½¬æ¢ï¼Œä¸ºäººä»¬é”™è¯¯åœ°åˆ¶å®šé”™è¯¯çš„æƒ³æ³•å’ŒæœŸæœ›ç•™ä¸‹äº†ç©ºé—´ã€‚<code>AsRef</code> åœ¨ä¸Šé¢èµ·ä½œç”¨ï¼Œå› ä¸ºå®ƒä½¿ç±»å‹é—´çš„è½¬æ¢å˜å¾—æ˜ç¡®ï¼Œæ²¡æœ‰ä½™åœ°æ¥å‘å±•ä»»ä½•é”™è¯¯çš„æƒ³æ³•æˆ–æœŸæœ›ã€‚</p>
<h3 id="borrow--borrowmut">Borrow &amp; BorrowMut</h3>
<p>é¢„å¤‡çŸ¥è¯†</p>
<ul>
<li><a href="#self">Self</a></li>
<li><a href="#methods">Methods</a></li>
<li><a href="#generic-parameters">Generic Parameters</a></li>
<li><a href="#subtraits--supertraits">Subtraits &amp; Supertraits</a></li>
<li><a href="#sized">Sized</a></li>
<li><a href="#asref--asmut">AsRef &amp; AsMut</a></li>
<li><a href="#partialeq--eq">PartialEq &amp; Eq</a></li>
<li><a href="#hash">Hash</a></li>
<li><a href="#partialord--ord">PartialOrd &amp; Ord</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">Borrow</span><span class="o">&lt;</span><span class="n">Borrowed</span><span class="o">&gt;</span><span class="w"> 
</span><span class="w"></span><span class="k">where</span><span class="w">
</span><span class="w">    </span><span class="n">Borrowed</span>: <span class="o">?</span><span class="nb">Sized</span><span class="p">,</span><span class="w"> 
</span><span class="w"></span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">borrow</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">Borrowed</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">trait</span><span class="w"> </span><span class="n">BorrowMut</span><span class="o">&lt;</span><span class="n">Borrowed</span><span class="o">&gt;</span>: <span class="nc">Borrow</span><span class="o">&lt;</span><span class="n">Borrowed</span><span class="o">&gt;</span><span class="w"> 
</span><span class="w"></span><span class="k">where</span><span class="w">
</span><span class="w">    </span><span class="n">Borrowed</span>: <span class="o">?</span><span class="nb">Sized</span><span class="p">,</span><span class="w"> 
</span><span class="w"></span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">borrow_mut</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Borrowed</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>These traits were invented to solve the very specific problem of looking up <code>String</code> keys in <code>HashSet</code>s, <code>HashMap</code>s, <code>BTreeSet</code>s, and <code>BTreeMap</code>s using <code>&amp;str</code> values.</p>
<p>We can view <code>Borrow&lt;T&gt;</code> and <code>BorrowMut&lt;T&gt;</code> as stricter versions of <code>AsRef&lt;T&gt;</code> and <code>AsMut&lt;T&gt;</code>, where the returned reference <code>&amp;T</code> has equivalent <code>Eq</code>, <code>Hash</code>, and <code>Ord</code> impls to <code>Self</code>. This is more easily explained with a commented example:
è¿™äº› trait çš„å‘æ˜æ˜¯ä¸ºäº†è§£å†³åœ¨ <code>HashSet</code>, <code>HashMap</code>, <code>BTreeSet</code>, å’Œ <code>BTreeMap</code> ä¸­ä½¿ç”¨ <code>&amp;str</code> å€¼æŸ¥æ‰¾ <code>String</code> é”®çš„ç‰¹æ®Šé—®é¢˜ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æŠŠ <code>Borrow&lt;T&gt;</code> å’Œ <code>BorrowMut&lt;T&gt;</code> çœ‹ä½œæ˜¯ <code>AsRef&lt;T&gt;</code> å’Œ <code>AsMut&lt;T&gt;</code> çš„æ›´ä¸¥æ ¼çš„ç‰ˆæœ¬ï¼Œå…¶ä¸­è¿”å›çš„å¼•ç”¨ <code>&amp;T</code> ä¸ <code>Self</code> çš„ <code>Eq</code>ã€<code>Hash</code> å’Œ <code>Ord</code> ç­‰å€¼ã€‚ç”¨ä¸€ä¸ªæ³¨é‡Šçš„ä¾‹å­å¯ä»¥æ›´å®¹æ˜“åœ°è§£é‡Šè¿™ä¸ªé—®é¢˜ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">borrow</span>::<span class="n">Borrow</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>:<span class="err">#ï¸âƒ£</span>:<span class="nc">Hasher</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">collections</span>::<span class="n">hash_map</span>::<span class="n">DefaultHasher</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>:<span class="err">#ï¸âƒ£</span>:<span class="nc">Hash</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">get_hash</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nc">Hash</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">u64</span> <span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">hasher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DefaultHasher</span>::<span class="n">new</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">t</span><span class="p">.</span><span class="n">hash</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">hasher</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="n">hasher</span><span class="p">.</span><span class="n">finish</span><span class="p">()</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">asref_example</span><span class="o">&lt;</span><span class="n">Owned</span><span class="p">,</span><span class="w"> </span><span class="n">Ref</span><span class="o">&gt;</span><span class="p">(</span><span class="n">owned1</span>: <span class="nc">Owned</span><span class="p">,</span><span class="w"> </span><span class="n">owned2</span>: <span class="nc">Owned</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="k">where</span><span class="w">
</span><span class="w">    </span><span class="n">Owned</span>: <span class="nb">Eq</span> <span class="o">+</span><span class="w"> </span><span class="nb">Ord</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Hash</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">AsRef</span><span class="o">&lt;</span><span class="n">Ref</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Ref</span>: <span class="nb">Eq</span> <span class="o">+</span><span class="w"> </span><span class="nb">Ord</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Hash</span><span class="w">
</span><span class="w"></span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">ref1</span>: <span class="kp">&amp;</span><span class="nc">Ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">owned1</span><span class="p">.</span><span class="n">as_ref</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">ref2</span>: <span class="kp">&amp;</span><span class="nc">Ref</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">owned2</span><span class="p">.</span><span class="n">as_ref</span><span class="p">();</span><span class="w">
</span><span class="w">    
</span><span class="w">    </span><span class="c1">// refs aren&#39;t required to be equal if owned types are equal
</span><span class="c1"></span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">owned1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">owned2</span><span class="p">,</span><span class="w"> </span><span class="n">ref1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ref2</span><span class="p">);</span><span class="w"> </span><span class="c1">// âŒ
</span><span class="c1"></span><span class="w">    
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">owned1_hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_hash</span><span class="p">(</span><span class="o">&amp;</span><span class="n">owned1</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">owned2_hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_hash</span><span class="p">(</span><span class="o">&amp;</span><span class="n">owned2</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">ref1_hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_hash</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ref1</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">ref2_hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_hash</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ref2</span><span class="p">);</span><span class="w">
</span><span class="w">    
</span><span class="w">    </span><span class="c1">// ref hashes aren&#39;t required to be equal if owned type hashes are equal
</span><span class="c1"></span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">owned1_hash</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">owned2_hash</span><span class="p">,</span><span class="w"> </span><span class="n">ref1_hash</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">ref2_hash</span><span class="p">);</span><span class="w"> </span><span class="c1">// âŒ
</span><span class="c1"></span><span class="w">    
</span><span class="w">    </span><span class="c1">// ref comparisons aren&#39;t required to match owned type comparisons
</span><span class="c1"></span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">owned1</span><span class="p">.</span><span class="n">cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">owned2</span><span class="p">),</span><span class="w"> </span><span class="n">ref1</span><span class="p">.</span><span class="n">cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ref2</span><span class="p">));</span><span class="w"> </span><span class="c1">// âŒ
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">borrow_example</span><span class="o">&lt;</span><span class="n">Owned</span><span class="p">,</span><span class="w"> </span><span class="n">Borrowed</span><span class="o">&gt;</span><span class="p">(</span><span class="n">owned1</span>: <span class="nc">Owned</span><span class="p">,</span><span class="w"> </span><span class="n">owned2</span>: <span class="nc">Owned</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="k">where</span><span class="w">
</span><span class="w">    </span><span class="n">Owned</span>: <span class="nb">Eq</span> <span class="o">+</span><span class="w"> </span><span class="nb">Ord</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Hash</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Borrow</span><span class="o">&lt;</span><span class="n">Borrowed</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">Borrowed</span>: <span class="nb">Eq</span> <span class="o">+</span><span class="w"> </span><span class="nb">Ord</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Hash</span><span class="w">
</span><span class="w"></span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">borrow1</span>: <span class="kp">&amp;</span><span class="nc">Borrowed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">owned1</span><span class="p">.</span><span class="n">borrow</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">borrow2</span>: <span class="kp">&amp;</span><span class="nc">Borrowed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">owned2</span><span class="p">.</span><span class="n">borrow</span><span class="p">();</span><span class="w">
</span><span class="w">    
</span><span class="w">    </span><span class="c1">// borrows are required to be equal if owned types are equal
</span><span class="c1"></span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">owned1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">owned2</span><span class="p">,</span><span class="w"> </span><span class="n">borrow1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">borrow2</span><span class="p">);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">    
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">owned1_hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_hash</span><span class="p">(</span><span class="o">&amp;</span><span class="n">owned1</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">owned2_hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_hash</span><span class="p">(</span><span class="o">&amp;</span><span class="n">owned2</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">borrow1_hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_hash</span><span class="p">(</span><span class="o">&amp;</span><span class="n">borrow1</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">borrow2_hash</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_hash</span><span class="p">(</span><span class="o">&amp;</span><span class="n">borrow2</span><span class="p">);</span><span class="w">
</span><span class="w">    
</span><span class="w">    </span><span class="c1">// borrow hashes are required to be equal if owned type hashes are equal
</span><span class="c1"></span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">owned1_hash</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">owned2_hash</span><span class="p">,</span><span class="w"> </span><span class="n">borrow1_hash</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">borrow2_hash</span><span class="p">);</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">    
</span><span class="w">    </span><span class="c1">// borrow comparisons are required to match owned type comparisons
</span><span class="c1"></span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">owned1</span><span class="p">.</span><span class="n">cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">owned2</span><span class="p">),</span><span class="w"> </span><span class="n">borrow1</span><span class="p">.</span><span class="n">cmp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">borrow2</span><span class="p">));</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>It&rsquo;s good to be aware of these traits and understand why they exist since it helps demystify some of the methods on <code>HashSet</code>, <code>HashMap</code>, <code>BTreeSet</code>, and <code>BTreeMap</code> but it&rsquo;s very rare that we would ever need to impl these traits for any of our types because it&rsquo;s very rare that we would ever need create a pair of types where one is the &ldquo;borrowed&rdquo; version of the other in the first place. If we have some <code>T</code> then <code>&amp;T</code> will get the job done 99.99% of the time, and <code>T: Borrow&lt;T&gt;</code> is already implemented for all <code>T</code> because of a generic blanket impl, so we don&rsquo;t need to manually impl it and we don&rsquo;t need to create some <code>U</code> such that <code>T: Borrow&lt;U&gt;</code>.</p>
<p>çŸ¥é“è¿™äº› trait å¹¶ç†è§£å®ƒä»¬å­˜åœ¨çš„åŸå› æ˜¯å¾ˆå¥½çš„ï¼Œå› ä¸ºè¿™æœ‰åŠ©äºè§£å¼€ <code>HashSet</code>ã€<code>HashMap</code>ã€<code>BTreeSet</code> å’Œ <code>BTreeMap</code> ä¸Šçš„ä¸€äº›æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬å¾ˆå°‘éœ€è¦ä¸ºæˆ‘ä»¬çš„ä»»ä½•ç±»å‹å®ç°è¿™äº› traitï¼Œå› ä¸ºæˆ‘ä»¬å¾ˆå°‘éœ€è¦åˆ›å»ºä¸€å¯¹ç±»å‹ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯å¦ä¸€ä¸ªçš„ &ldquo;å€Ÿç”¨&rdquo; ç‰ˆæœ¬ã€‚å¦‚æœæˆ‘ä»¬æœ‰ä¸€äº› <code>T</code>ï¼Œé‚£ä¹ˆ <code>T</code> åœ¨ 99.99% çš„æƒ…å†µä¸‹éƒ½èƒ½å®Œæˆå·¥ä½œï¼Œè€Œä¸” <code>T: Borrow&lt;T&gt;</code> å·²ç»ä¸ºæ‰€æœ‰çš„ <code>T</code> å®ç°äº†ï¼Œå› ä¸ºæœ‰ä¸€ä¸ªé€šç”¨çš„ä¸€æ½å­å®ç°ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨å®ç°å®ƒï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦åˆ›å»ºä¸€äº› <code>U</code>ï¼Œä½¿ <code>T: Borrow&lt;U&gt;</code>ã€‚</p>
<h3 id="toowned">ToOwned</h3>
<p>é¢„å¤‡çŸ¥è¯†</p>
<ul>
<li><a href="#self">Self</a></li>
<li><a href="#methods">Methods</a></li>
<li><a href="#default-impls">Default Impls</a></li>
<li><a href="#clone">Clone</a></li>
<li><a href="#borrow--borrowmut">Borrow &amp; BorrowMut</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="nb">ToOwned</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Owned</span>: <span class="nc">Borrow</span><span class="o">&lt;</span><span class="n">Self</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">to_owned</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Owned</span><span class="p">;</span><span class="w">
</span><span class="w">    
</span><span class="w">    </span><span class="c1">// provided default impls
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">clone_into</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">target</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Self</span>::<span class="n">Owned</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><code>ToOwned</code> is a more generic version of <code>Clone</code>. <code>Clone</code> allows us to take a <code>&amp;T</code> and turn it into an <code>T</code> but <code>ToOwned</code> allows us to take a <code>&amp;Borrowed</code> and turn it into a <code>Owned</code> where <code>Owned: Borrow&lt;Borrowed&gt;</code>.</p>
<p>In other words, we can&rsquo;t &ldquo;clone&rdquo; a <code>&amp;str</code> into a <code>String</code>, or a <code>&amp;Path</code> into a <code>PathBuf</code>, or an <code>&amp;OsStr</code> into an <code>OsString</code>, since the <code>clone</code> method signature doesn&rsquo;t support this kind of cross-type cloning, and that&rsquo;s what <code>ToOwned</code> was made for.</p>
<p>For similar reasons as <code>Borrow</code> and <code>BorrowMut</code>, it&rsquo;s good to be aware of this trait and understand why it exists but it&rsquo;s very rare we&rsquo;ll ever need to impl it for any of our types.</p>
<p><code>ToOwned</code> æ˜¯ <code>Clone</code> çš„ä¸€ä¸ªæ›´é€šç”¨çš„ç‰ˆæœ¬ã€‚<code>Clone</code> å…è®¸æˆ‘ä»¬æŠŠä¸€ä¸ª <code>&amp;T</code> å˜æˆä¸€ä¸ª <code>T</code>ï¼Œä½† <code>ToOwned</code> å…è®¸æˆ‘ä»¬æŠŠä¸€ä¸ª <code>&amp;Borrowed</code> å˜æˆä¸€ä¸ª <code>Owned</code>ï¼Œå…¶ä¸­ <code>Owned: Borrow&lt;Borrowed&gt;</code>ã€‚</p>
<p>æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬ä¸èƒ½æŠŠä¸€ä¸ª <code>&amp;str</code> å…‹éš†æˆä¸€ä¸ª <code>String</code>ï¼Œæˆ–è€…æŠŠä¸€ä¸ª <code>&amp;Path</code> å…‹éš†æˆä¸€ä¸ª <code>PathBuf</code>ï¼Œæˆ–è€…æŠŠä¸€ä¸ª <code>&amp;OsStr</code> å…‹éš†æˆä¸€ä¸ª <code>OsString</code>ï¼Œå› ä¸º <code>clone</code> æ–¹æ³•ç­¾åä¸æ”¯æŒè¿™ç§è·¨ç±»å‹å…‹éš†ï¼Œè€Œè¿™æ­£æ˜¯ <code>ToOwned</code> çš„ç”¨é€”ã€‚</p>
<p>å‡ºäºä¸ <code>Borrow</code> å’Œ <code>BorrowMut</code> ç±»ä¼¼çš„åŸå› ï¼ŒçŸ¥é“è¿™ä¸ª trait å¹¶ç†è§£å®ƒå­˜åœ¨çš„åŸå› æ˜¯å¾ˆå¥½çš„ï¼Œä½†æˆ‘ä»¬å¾ˆå°‘éœ€è¦ä¸ºæˆ‘ä»¬çš„ä»»ä½•ç±»å‹å®ç°è¿™ä¸ª traitã€‚</p>
<h2 id="iteration-traits">Iteration Traits</h2>
<h3 id="iterator">Iterator</h3>
<p>é¢„å¤‡çŸ¥è¯†</p>
<ul>
<li><a href="#self">Self</a></li>
<li><a href="#methods">Methods</a></li>
<li><a href="#associated-types">Associated Types</a></li>
<li><a href="#default-impls">Default Impls</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="nb">Iterator</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Item</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">next</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Self</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="c1">// provided default impls
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">size_hint</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="p">(</span><span class="kt">usize</span><span class="p">,</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">usize</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">last</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Self</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">advance_by</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>: <span class="kt">usize</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="kt">usize</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">nth</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>: <span class="kt">usize</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Self</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">step_by</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">step</span>: <span class="kt">usize</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">StepBy</span><span class="o">&lt;</span><span class="n">Self</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">chain</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;</span><span class="p">(</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">,</span><span class="w"> 
</span><span class="w">        </span><span class="n">other</span>: <span class="nc">U</span><span class="w">
</span><span class="w">    </span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Chain</span><span class="o">&lt;</span><span class="n">Self</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">U</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">IntoIterator</span><span class="o">&gt;</span>::<span class="n">IntoIter</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">U</span>: <span class="nb">IntoIterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Self</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">zip</span><span class="o">&lt;</span><span class="n">U</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="nc">U</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Zip</span><span class="o">&lt;</span><span class="n">Self</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">U</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">IntoIterator</span><span class="o">&gt;</span>::<span class="n">IntoIter</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">U</span>: <span class="nb">IntoIterator</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">map</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="nc">F</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Map</span><span class="o">&lt;</span><span class="n">Self</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">F</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">B</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">for_each</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="nc">F</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">F</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">filter</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">predicate</span>: <span class="nc">P</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Filter</span><span class="o">&lt;</span><span class="n">Self</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">P</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">filter_map</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="nc">F</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">FilterMap</span><span class="o">&lt;</span><span class="n">Self</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">F</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Enumerate</span><span class="o">&lt;</span><span class="n">Self</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">peekable</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Peekable</span><span class="o">&lt;</span><span class="n">Self</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">skip_while</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">predicate</span>: <span class="nc">P</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">SkipWhile</span><span class="o">&lt;</span><span class="n">Self</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">P</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">take_while</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">predicate</span>: <span class="nc">P</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">TakeWhile</span><span class="o">&lt;</span><span class="n">Self</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">P</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">map_while</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">predicate</span>: <span class="nc">P</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">MapWhile</span><span class="o">&lt;</span><span class="n">Self</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">P</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">skip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>: <span class="kt">usize</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Skip</span><span class="o">&lt;</span><span class="n">Self</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">take</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>: <span class="kt">usize</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Take</span><span class="o">&lt;</span><span class="n">Self</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">scan</span><span class="o">&lt;</span><span class="n">St</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">initial_state</span>: <span class="nc">St</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="nc">F</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Scan</span><span class="o">&lt;</span><span class="n">Self</span><span class="p">,</span><span class="w"> </span><span class="n">St</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">F</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">St</span><span class="p">,</span><span class="w"> </span><span class="n">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">flat_map</span><span class="o">&lt;</span><span class="n">U</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="nc">F</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">FlatMap</span><span class="o">&lt;</span><span class="n">Self</span><span class="p">,</span><span class="w"> </span><span class="n">U</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">F</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">U</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">U</span>: <span class="nb">IntoIterator</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">flatten</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Flatten</span><span class="o">&lt;</span><span class="n">Self</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">Self</span>::<span class="n">Item</span>: <span class="nb">IntoIterator</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">fuse</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Fuse</span><span class="o">&lt;</span><span class="n">Self</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">inspect</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="nc">F</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Inspect</span><span class="o">&lt;</span><span class="n">Self</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">F</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">);</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">by_ref</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Self</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">collect</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">B</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">B</span>: <span class="nc">FromIterator</span><span class="o">&lt;</span><span class="n">Self</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">partition</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="nc">F</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">F</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">B</span>: <span class="nb">Default</span> <span class="o">+</span><span class="w"> </span><span class="nb">Extend</span><span class="o">&lt;</span><span class="n">Self</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">partition_in_place</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">P</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">predicate</span>: <span class="nc">P</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">usize</span>
    <span class="nc">where</span><span class="w">
</span><span class="w">        </span><span class="n">Self</span>: <span class="nb">DoubleEndedIterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="na">&#39;a</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">T</span>: <span class="na">&#39;a</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">P</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">is_partitioned</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">predicate</span>: <span class="nc">P</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span>
    <span class="nc">where</span><span class="w">
</span><span class="w">        </span><span class="n">P</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">try_fold</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">init</span>: <span class="nc">B</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="nc">F</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">R</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">F</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">R</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">R</span>: <span class="nc">Try</span><span class="o">&lt;</span><span class="nb">Ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">try_for_each</span><span class="o">&lt;</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="nc">F</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">R</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">F</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">R</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">R</span>: <span class="nc">Try</span><span class="o">&lt;</span><span class="nb">Ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">()</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">fold</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">init</span>: <span class="nc">B</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="nc">F</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">B</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">F</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">B</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">fold_first</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="nc">F</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Self</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">F</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">,</span><span class="w"> </span><span class="n">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">Item</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">all</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="nc">F</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span>
    <span class="nc">where</span><span class="w">
</span><span class="w">        </span><span class="n">F</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">any</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="nc">F</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span>
    <span class="nc">where</span><span class="w">
</span><span class="w">        </span><span class="n">F</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">find</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">predicate</span>: <span class="nc">P</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Self</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">P</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">find_map</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="nc">F</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">F</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">try_find</span><span class="o">&lt;</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">&gt;</span><span class="p">(</span><span class="w">
</span><span class="w">        </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> 
</span><span class="w">        </span><span class="n">f</span>: <span class="nc">F</span><span class="w">
</span><span class="w">    </span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">Self</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">R</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">Try</span><span class="o">&gt;</span>::<span class="n">Error</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">F</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">R</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">R</span>: <span class="nc">Try</span><span class="o">&lt;</span><span class="nb">Ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">position</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">predicate</span>: <span class="nc">P</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">P</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">rposition</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">predicate</span>: <span class="nc">P</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">Self</span>: <span class="nb">ExactSizeIterator</span> <span class="o">+</span><span class="w"> </span><span class="nb">DoubleEndedIterator</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">P</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">max</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Self</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">Self</span>::<span class="n">Item</span>: <span class="nb">Ord</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">min</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Self</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">Self</span>::<span class="n">Item</span>: <span class="nb">Ord</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">max_by_key</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="nc">F</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Self</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">F</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">B</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">B</span>: <span class="nb">Ord</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">max_by</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">compare</span>: <span class="nc">F</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Self</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">F</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Ordering</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">min_by_key</span><span class="o">&lt;</span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="nc">F</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Self</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">F</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">B</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">B</span>: <span class="nb">Ord</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">min_by</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">compare</span>: <span class="nc">F</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Self</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">F</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Ordering</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">rev</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Rev</span><span class="o">&lt;</span><span class="n">Self</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">Self</span>: <span class="nb">DoubleEndedIterator</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">unzip</span><span class="o">&lt;</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">FromA</span><span class="p">,</span><span class="w"> </span><span class="n">FromB</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="p">(</span><span class="n">FromA</span><span class="p">,</span><span class="w"> </span><span class="n">FromB</span><span class="p">)</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">Self</span>: <span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">)</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">FromA</span>: <span class="nb">Default</span> <span class="o">+</span><span class="w"> </span><span class="nb">Extend</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">FromB</span>: <span class="nb">Default</span> <span class="o">+</span><span class="w"> </span><span class="nb">Extend</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">copied</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Copied</span><span class="o">&lt;</span><span class="n">Self</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">Self</span>: <span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="na">&#39;a</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">T</span>: <span class="na">&#39;a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Copy</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">cloned</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Cloned</span><span class="o">&lt;</span><span class="n">Self</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">Self</span>: <span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="na">&#39;a</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">T</span>: <span class="na">&#39;a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Clone</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">cycle</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Cycle</span><span class="o">&lt;</span><span class="n">Self</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">Self</span>: <span class="nb">Clone</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">sum</span><span class="o">&lt;</span><span class="n">S</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">S</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">S</span>: <span class="nc">Sum</span><span class="o">&lt;</span><span class="n">Self</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">product</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">P</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">P</span>: <span class="nc">Product</span><span class="o">&lt;</span><span class="n">Self</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">cmp</span><span class="o">&lt;</span><span class="n">I</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="nc">I</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Ordering</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">I</span>: <span class="nb">IntoIterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Self</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">Self</span>::<span class="n">Item</span>: <span class="nb">Ord</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">cmp_by</span><span class="o">&lt;</span><span class="n">I</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="nc">I</span><span class="p">,</span><span class="w"> </span><span class="n">cmp</span>: <span class="nc">F</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Ordering</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">F</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">I</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">IntoIterator</span><span class="o">&gt;</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Ordering</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">I</span>: <span class="nb">IntoIterator</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">partial_cmp</span><span class="o">&lt;</span><span class="n">I</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="nc">I</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Ordering</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">I</span>: <span class="nb">IntoIterator</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">Self</span>::<span class="n">Item</span>: <span class="nb">PartialOrd</span><span class="o">&lt;&lt;</span><span class="n">I</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">IntoIterator</span><span class="o">&gt;</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">partial_cmp_by</span><span class="o">&lt;</span><span class="n">I</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">,</span><span class="w"> 
</span><span class="w">        </span><span class="n">other</span>: <span class="nc">I</span><span class="p">,</span><span class="w"> 
</span><span class="w">        </span><span class="n">partial_cmp</span>: <span class="nc">F</span><span class="w">
</span><span class="w">    </span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Ordering</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">F</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">I</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">IntoIterator</span><span class="o">&gt;</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Ordering</span><span class="o">&gt;</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">I</span>: <span class="nb">IntoIterator</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">eq</span><span class="o">&lt;</span><span class="n">I</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="nc">I</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span>
    <span class="nc">where</span><span class="w">
</span><span class="w">        </span><span class="n">I</span>: <span class="nb">IntoIterator</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">Self</span>::<span class="n">Item</span>: <span class="nb">PartialEq</span><span class="o">&lt;&lt;</span><span class="n">I</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">IntoIterator</span><span class="o">&gt;</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">eq_by</span><span class="o">&lt;</span><span class="n">I</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="nc">I</span><span class="p">,</span><span class="w"> </span><span class="n">eq</span>: <span class="nc">F</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span>
    <span class="nc">where</span><span class="w">
</span><span class="w">        </span><span class="n">F</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="n">I</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">IntoIterator</span><span class="o">&gt;</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">I</span>: <span class="nb">IntoIterator</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">ne</span><span class="o">&lt;</span><span class="n">I</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="nc">I</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span>
    <span class="nc">where</span><span class="w">
</span><span class="w">        </span><span class="n">I</span>: <span class="nb">IntoIterator</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">Self</span>::<span class="n">Item</span>: <span class="nb">PartialEq</span><span class="o">&lt;&lt;</span><span class="n">I</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">IntoIterator</span><span class="o">&gt;</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">lt</span><span class="o">&lt;</span><span class="n">I</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="nc">I</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span>
    <span class="nc">where</span><span class="w">
</span><span class="w">        </span><span class="n">I</span>: <span class="nb">IntoIterator</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">Self</span>::<span class="n">Item</span>: <span class="nb">PartialOrd</span><span class="o">&lt;&lt;</span><span class="n">I</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">IntoIterator</span><span class="o">&gt;</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">le</span><span class="o">&lt;</span><span class="n">I</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="nc">I</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span>
    <span class="nc">where</span><span class="w">
</span><span class="w">        </span><span class="n">I</span>: <span class="nb">IntoIterator</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">Self</span>::<span class="n">Item</span>: <span class="nb">PartialOrd</span><span class="o">&lt;&lt;</span><span class="n">I</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">IntoIterator</span><span class="o">&gt;</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">gt</span><span class="o">&lt;</span><span class="n">I</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="nc">I</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span>
    <span class="nc">where</span><span class="w">
</span><span class="w">        </span><span class="n">I</span>: <span class="nb">IntoIterator</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">Self</span>::<span class="n">Item</span>: <span class="nb">PartialOrd</span><span class="o">&lt;&lt;</span><span class="n">I</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">IntoIterator</span><span class="o">&gt;</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">ge</span><span class="o">&lt;</span><span class="n">I</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">other</span>: <span class="nc">I</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span>
    <span class="nc">where</span><span class="w">
</span><span class="w">        </span><span class="n">I</span>: <span class="nb">IntoIterator</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">Self</span>::<span class="n">Item</span>: <span class="nb">PartialOrd</span><span class="o">&lt;&lt;</span><span class="n">I</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">IntoIterator</span><span class="o">&gt;</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">is_sorted</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span>
    <span class="nc">where</span><span class="w">
</span><span class="w">        </span><span class="n">Self</span>::<span class="n">Item</span>: <span class="nb">PartialOrd</span><span class="o">&lt;</span><span class="n">Self</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">is_sorted_by</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">compare</span>: <span class="nc">F</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span>
    <span class="nc">where</span><span class="w">
</span><span class="w">        </span><span class="n">F</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="o">&amp;</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Ordering</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">is_sorted_by_key</span><span class="o">&lt;</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">K</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">f</span>: <span class="nc">F</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span>
    <span class="nc">where</span><span class="w">
</span><span class="w">        </span><span class="n">F</span>: <span class="nb">FnMut</span><span class="p">(</span><span class="n">Self</span>::<span class="n">Item</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">K</span><span class="p">,</span><span class="w">
</span><span class="w">        </span><span class="n">K</span>: <span class="nb">PartialOrd</span><span class="o">&lt;</span><span class="n">K</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><code>Iterator&lt;Item = T&gt;</code> ç±»å‹å¯ä»¥è¢«è¿­ä»£ï¼Œå¹¶ä¼šäº§ç”Ÿ <code>T</code> ç±»å‹ã€‚æ²¡æœ‰ <code>IteratorMut</code> traitã€‚æ¯ä¸ª <code>Iterator</code> å®ç°å¯ä»¥é€šè¿‡ <code>Item</code> å…³è”ç±»å‹æŒ‡å®šå®ƒæ˜¯è¿”å›ä¸å¯å˜å¼•ç”¨ã€å¯å˜å¼•ç”¨è¿˜æ˜¯æ‹¥æœ‰å…¶å€¼ã€‚</p>
<table>
<thead>
<tr>
<th><code>Vec&lt;T&gt;</code> æ–¹æ³•</th>
<th>è¿”å›</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>.iter()</code></td>
<td><code>Iterator&lt;Item = &amp;T&gt;</code></td>
</tr>
<tr>
<td><code>.iter_mut()</code></td>
<td><code>Iterator&lt;Item = &amp;mut T&gt;</code></td>
</tr>
<tr>
<td><code>.into_iter()</code></td>
<td><code>Iterator&lt;Item = T&gt;</code></td>
</tr>
</tbody>
</table>
<p>å¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œæœ‰äº›ä¸œè¥¿ä¸æ˜¯å¾ˆæ˜æ˜¾ï¼Œä½†ä¸­çº§ Rustaceans è®¤ä¸ºæ˜¯ç†æ‰€å½“ç„¶çš„ï¼Œé‚£å°±æ˜¯å¤§å¤šæ•°ç±»å‹éƒ½ä¸æ˜¯ä»–ä»¬æœ¬èº«çš„è¿­ä»£å™¨ã€‚å¦‚æœä¸€ä¸ªç±»å‹æ˜¯å¯è¿­ä»£çš„ï¼Œæˆ‘ä»¬å‡ ä¹æ€»æ˜¯å®ç°ä¸€äº›è‡ªå®šä¹‰çš„è¿­ä»£å™¨ç±»å‹æ¥è¿­ä»£å®ƒï¼Œè€Œä¸æ˜¯è¯•å›¾è®©å®ƒè‡ªå·±è¿­ä»£ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">struct</span> <span class="nc">MyType</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">items</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">MyType</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">iter</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">MyTypeIterator</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="n">index</span>: <span class="mi">0</span><span class="p">,</span><span class="w">
</span><span class="w">            </span><span class="n">items</span>: <span class="kp">&amp;</span><span class="nc">self</span><span class="p">.</span><span class="n">items</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">struct</span> <span class="nc">MyTypeIterator</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">index</span>: <span class="kt">usize</span><span class="p">,</span><span class="w">
</span><span class="w">    </span><span class="n">items</span>: <span class="kp">&amp;</span><span class="na">&#39;a</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">Iterator</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MyTypeIterator</span><span class="o">&lt;</span><span class="na">&#39;a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="na">&#39;a</span><span class="w"> </span><span class="nb">String</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">next</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Option</span><span class="o">&lt;</span><span class="n">Self</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">index</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="nb">None</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">items</span><span class="p">[</span><span class="bp">self</span><span class="p">.</span><span class="n">index</span><span class="p">];</span><span class="w">
</span><span class="w">            </span><span class="bp">self</span><span class="p">.</span><span class="n">index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">
</span><span class="w">            </span><span class="nb">Some</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="w">
</span><span class="w">        </span><span class="p">}</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>ä¸ºäº†ä¾¿äºæ•™å­¦ï¼Œä¸Šé¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä»å¤´å¼€å§‹å®ç°ä¸€ä¸ª <code>Iterator</code>ï¼Œä½†åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¹ æƒ¯æ€§çš„è§£å†³æ–¹æ¡ˆå°†åªæ˜¯éµä» <code>Vec</code> çš„ <code>iter</code> æ–¹æ³•ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">struct</span> <span class="nc">MyType</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">items</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="w"> </span><span class="n">MyType</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">iter</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">impl</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="nb">String</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="bp">self</span><span class="p">.</span><span class="n">items</span><span class="p">.</span><span class="n">iter</span><span class="p">()</span><span class="w">
</span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>å¦å¤–ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€šç”¨å…¨é¢å®ç°ï¼Œè¦æ³¨æ„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">impl</span><span class="o">&lt;</span><span class="n">I</span>: <span class="nb">Iterator</span> <span class="o">+</span><span class="w"> </span><span class="o">?</span><span class="nb">Sized</span><span class="o">&gt;</span><span class="w"> </span><span class="nb">Iterator</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">I</span><span class="p">;</span><span class="w">
</span></code></pre></div><p>å®ƒè¯´ä»»ä½•å¯¹è¿­ä»£å™¨çš„å¯å˜å¼•ç”¨ä¹Ÿæ˜¯è¿­ä»£å™¨ï¼Œè¿™ä¸€ç‚¹å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸æˆ‘ä»¬ä½¿ç”¨ <code>self</code> æ¥æ”¶å™¨ï¼Œå°±åƒä½¿ç”¨ <code>&amp;mut self</code> æ¥æ”¶å™¨ä¸€æ ·ã€‚äº†è§£è¿™ä¸€ç‚¹å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸æˆ‘ä»¬ä½¿ç”¨è¿­ä»£å™¨æ–¹æ³•ä¸ <code>self</code> æ¥æ”¶å™¨ï¼Œå°±åƒå®ƒä»¬æœ‰ <code>&amp;mut self</code> æ¥æ”¶å™¨ä¸€æ ·ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œæƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå¯ä»¥å¤„ç†ä¸€ä¸ªè¶…è¿‡ä¸‰ä¸ªé¡¹çš„è¿­ä»£å™¨ï¼Œä½†æ˜¯å‡½æ•°çš„ç¬¬ä¸€æ­¥æ˜¯å–å‡ºè¿­ä»£å™¨çš„å‰ä¸‰é¡¹ï¼Œå¹¶åœ¨è¿­ä»£å‰©ä¸‹çš„é¡¹ä¹‹å‰åˆ†åˆ«å¤„ç†å®ƒä»¬ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªåˆå­¦è€…å¯èƒ½å°è¯•å†™è¿™ä¸ªå‡½æ•°çš„æ–¹æ³•ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">example</span><span class="o">&lt;</span><span class="n">I</span>: <span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">i32</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">iter</span>: <span class="nc">I</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">first3</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iter</span><span class="p">.</span><span class="n">take</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">collect</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">iter</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// âŒ iter consumed in line above
</span><span class="c1"></span><span class="w">        </span><span class="c1">// process remaining items
</span><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>å—¯ï¼Œè¿™å¾ˆçƒ¦äººã€‚<code>take</code> æ–¹æ³•æœ‰ä¸€ä¸ª <code>self</code> æ¥æ”¶å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼¼ä¹ä¸èƒ½åœ¨ä¸æ¶ˆè€—æ•´ä¸ªè¿­ä»£å™¨çš„æƒ…å†µä¸‹è°ƒç”¨å®ƒã€‚ä¸‹é¢æ˜¯ä¸Šé¢ä»£ç çš„ä¸€ä¸ªå¤©çœŸçš„é‡æ„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">example</span><span class="o">&lt;</span><span class="n">I</span>: <span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">i32</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">iter</span>: <span class="nc">I</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">first3</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vec</span><span class="o">!</span><span class="p">[</span><span class="w">
</span><span class="w">        </span><span class="n">iter</span><span class="p">.</span><span class="n">next</span><span class="p">().</span><span class="n">unwrap</span><span class="p">(),</span><span class="w">
</span><span class="w">        </span><span class="n">iter</span><span class="p">.</span><span class="n">next</span><span class="p">().</span><span class="n">unwrap</span><span class="p">(),</span><span class="w">
</span><span class="w">        </span><span class="n">iter</span><span class="p">.</span><span class="n">next</span><span class="p">().</span><span class="n">unwrap</span><span class="p">(),</span><span class="w">
</span><span class="w">    </span><span class="p">];</span><span class="w">
</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">iter</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">        </span><span class="c1">// process remaining items
</span><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>è¿™è¿˜ç®—å¥½çš„ã€‚ç„¶è€Œï¼Œæƒ¯ç”¨çš„é‡æ„å…¶å®æ˜¯è¿™æ ·çš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">example</span><span class="o">&lt;</span><span class="n">I</span>: <span class="nb">Iterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">i32</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">iter</span>: <span class="nc">I</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">first3</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">i32</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">iter</span><span class="p">.</span><span class="n">by_ref</span><span class="p">().</span><span class="n">take</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">collect</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">item</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">iter</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="w">        </span><span class="c1">// process remaining items
</span><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>ä¸å¤ªå®¹æ˜“å‘ç°ã€‚ä½†æ— è®ºå¦‚ä½•ï¼Œç°åœ¨æˆ‘ä»¬çŸ¥é“äº†ã€‚</p>
<p>å¦å¤–ï¼Œå¯¹äºä»€ä¹ˆå¯ä»¥æ˜¯è¿­ä»£å™¨ï¼Œä»€ä¹ˆä¸èƒ½æ˜¯è¿­ä»£å™¨ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆè§„åˆ™æˆ–çº¦å®šã€‚å¦‚æœç±»å‹æ˜¯ <code>Iterator</code>ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ã€‚æ ‡å‡†åº“ä¸­çš„ä¸€äº›åˆ›é€ æ€§çš„ä¾‹å­å¦‚ä¸‹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">sync</span>::<span class="n">mpsc</span>::<span class="n">channel</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">thread</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">paths_can_be_iterated</span><span class="p">(</span><span class="n">path</span>: <span class="kp">&amp;</span><span class="nc">Path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="c1">// iterate over parts of a path
</span><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">fn</span> <span class="nf">receivers_can_be_iterated</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">send</span><span class="p">,</span><span class="w"> </span><span class="n">recv</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">channel</span><span class="p">();</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="n">thread</span>::<span class="n">spawn</span><span class="p">(</span><span class="k">move</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="n">send</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w">
</span><span class="w">        </span><span class="n">send</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">2</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w">
</span><span class="w">        </span><span class="n">send</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="mi">3</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="p">});</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">received</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">recv</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">        </span><span class="c1">// iterate over received values
</span><span class="c1"></span><span class="w">    </span><span class="p">}</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><h3 id="intoiterator">IntoIterator</h3>
<p>é¢„å¤‡çŸ¥è¯†</p>
<ul>
<li><a href="#self">Self</a></li>
<li><a href="#methods">Methods</a></li>
<li><a href="#associated-types">Associated Types</a></li>
<li><a href="#iterator">Iterator</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="nb">IntoIterator</span><span class="w"> 
</span><span class="w"></span><span class="k">where</span><span class="w">
</span><span class="w">    </span><span class="o">&lt;</span><span class="n">Self</span>::<span class="n">IntoIter</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nb">Iterator</span><span class="o">&gt;</span>::<span class="n">Item</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Self</span>::<span class="n">Item</span><span class="p">,</span><span class="w"> 
</span><span class="w"></span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">Item</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">type</span> <span class="nc">IntoIter</span>: <span class="nb">Iterator</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">into_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span>::<span class="n">IntoIter</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><code>IntoIterator</code> ç±»å‹å¯ä»¥è¢«è½¬æ¢ä¸ºè¿­ä»£å™¨ï¼Œå› æ­¤å¾—åã€‚å½“ä¸€ä¸ªç±»å‹åœ¨ <code>for-in</code> å¾ªç¯ä¸­ä½¿ç”¨æ—¶ï¼Œä¼šè°ƒç”¨ <code>into_iter</code> æ–¹æ³•ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="c1">// vec = Vec&lt;T&gt;
</span><span class="c1"></span><span class="k">for</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">vec</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// v = T
</span><span class="c1"></span><span class="w">
</span><span class="w"></span><span class="c1">// above line desugared
</span><span class="c1"></span><span class="k">for</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">vec</span><span class="p">.</span><span class="n">into_iter</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></code></pre></div><p>ä¸ä»… <code>Vec</code> å®ç°äº† <code>IntoIterator</code>ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åˆ†åˆ«è¿­ä»£ä¸å¯å˜å¼•ç”¨æˆ–å¯å˜å¼•ç”¨è€Œä¸æ˜¯æ‹¥æœ‰å…¶å€¼ï¼Œ<code>&amp;Vec</code> å’Œ <code>&amp;mut Vec</code> ä¹Ÿåˆ†åˆ«å®ç°äº† <code>IntoIterator</code>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="c1">// vec = Vec&lt;T&gt;
</span><span class="c1"></span><span class="k">for</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">&amp;</span><span class="n">vec</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// v = &amp;T
</span><span class="c1"></span><span class="w">
</span><span class="w"></span><span class="c1">// above example desugared
</span><span class="c1"></span><span class="k">for</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="n">vec</span><span class="p">).</span><span class="n">into_iter</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// vec = Vec&lt;T&gt;
</span><span class="c1"></span><span class="k">for</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">vec</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="c1">// v = &amp;mut T
</span><span class="c1"></span><span class="w">
</span><span class="w"></span><span class="c1">// above example desugared
</span><span class="c1"></span><span class="k">for</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">vec</span><span class="p">).</span><span class="n">into_iter</span><span class="p">()</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span></code></pre></div><h3 id="fromiterator">FromIterator</h3>
<p>é¢„å¤‡çŸ¥è¯†</p>
<ul>
<li><a href="#self">Self</a></li>
<li><a href="#functions">Functions</a></li>
<li><a href="#generic-parameters">Generic Parameters</a></li>
<li><a href="#iterator">Iterator</a></li>
<li><a href="#intoiterator">IntoIterator</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">FromIterator</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">from_iter</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">iter</span>: <span class="nc">T</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Self</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">T</span>: <span class="nb">IntoIterator</span><span class="o">&lt;</span><span class="n">Item</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p><code>FromIterator</code> ç±»å‹å¯ä»¥ä»è¿­ä»£å™¨ä¸­åˆ›å»ºï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸º <code>FromIterator</code>ã€‚<code>FromIterator</code> æœ€å¸¸è§å’Œæœ€ä¹ æƒ¯çš„ç”¨æ³•æ˜¯è°ƒç”¨ <code>Iterator</code> ä¸Šçš„ <code>collect</code> æ–¹æ³•ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">collect</span><span class="o">&lt;</span><span class="n">B</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">B</span><span class="w">
</span><span class="w"></span><span class="k">where</span><span class="w">
</span><span class="w">    </span><span class="n">B</span>: <span class="nc">FromIterator</span><span class="o">&lt;</span><span class="n">Self</span>::<span class="n">Item</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span></code></pre></div><p>å°† <code>Iterator&lt;Item = char&gt;</code> æ”¶é›†æˆ <code>String</code> çš„ä¾‹å­å¦‚ä¸‹:</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">fn</span> <span class="nf">filter_letters</span><span class="p">(</span><span class="n">string</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">String</span> <span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">string</span><span class="p">.</span><span class="n">chars</span><span class="p">().</span><span class="n">filter</span><span class="p">(</span><span class="o">|</span><span class="n">c</span><span class="o">|</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">is_alphabetic</span><span class="p">()).</span><span class="n">collect</span><span class="p">()</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>æ ‡å‡†åº“ä¸­çš„æ‰€æœ‰é›†åˆéƒ½å®ç°äº† <code>IntoIterator</code> å’Œ <code>FromIterator</code>ï¼Œè¿™æ ·å¯ä»¥æ›´å®¹æ˜“åœ¨å®ƒä»¬ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">collections</span>::<span class="p">{</span><span class="n">BTreeSet</span><span class="p">,</span><span class="w"> </span><span class="n">HashMap</span><span class="p">,</span><span class="w"> </span><span class="n">HashSet</span><span class="p">,</span><span class="w"> </span><span class="n">LinkedList</span><span class="p">};</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// String -&gt; HashSet&lt;char&gt;
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">unique_chars</span><span class="p">(</span><span class="n">string</span>: <span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">HashSet</span><span class="o">&lt;</span><span class="n">char</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">string</span><span class="p">.</span><span class="n">chars</span><span class="p">().</span><span class="n">collect</span><span class="p">()</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// Vec&lt;T&gt; -&gt; BTreeSet&lt;T&gt;
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">ordered_unique_items</span><span class="o">&lt;</span><span class="n">T</span>: <span class="nb">Ord</span><span class="o">&gt;</span><span class="p">(</span><span class="n">vec</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">BTreeSet</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">vec</span><span class="p">.</span><span class="n">into_iter</span><span class="p">().</span><span class="n">collect</span><span class="p">()</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// HashMap&lt;K, V&gt; -&gt; LinkedList&lt;(K, V)&gt;
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">entry_list</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="o">&gt;</span><span class="p">(</span><span class="n">map</span>: <span class="nc">HashMap</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">LinkedList</span><span class="o">&lt;</span><span class="p">(</span><span class="n">K</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="n">map</span><span class="p">.</span><span class="n">into_iter</span><span class="p">().</span><span class="n">collect</span><span class="p">()</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// and countless more possible examples
</span></code></pre></div><h2 id="io-traits">I/O Traits</h2>
<h3 id="read--write">Read &amp; Write</h3>
<p>é¢„å¤‡çŸ¥è¯†</p>
<ul>
<li><a href="#self">Self</a></li>
<li><a href="#methods">Methods</a></li>
<li><a href="#scope">Scope</a></li>
<li><a href="#generic-blanket-impls">Generic Blanket Impls</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">trait</span><span class="w"> </span><span class="n">Read</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">read</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">])</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="c1">// provided default impls
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">read_vectored</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">bufs</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">[</span><span class="n">IoSliceMut</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="o">&gt;</span><span class="p">])</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">is_read_vectored</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">unsafe</span><span class="w"> </span><span class="k">fn</span> <span class="nf">initializer</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Initializer</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">read_to_end</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">read_to_string</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="nb">String</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">read_exact</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">])</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">by_ref</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Self</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">Self</span>: <span class="nb">Sized</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Bytes</span><span class="o">&lt;</span><span class="n">Self</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">Self</span>: <span class="nb">Sized</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">chain</span><span class="o">&lt;</span><span class="n">R</span>: <span class="nc">Read</span><span class="o">&gt;</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">next</span>: <span class="nc">R</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Chain</span><span class="o">&lt;</span><span class="n">Self</span><span class="p">,</span><span class="w"> </span><span class="n">R</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">Self</span>: <span class="nb">Sized</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">take</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">limit</span>: <span class="kt">u64</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nc">Take</span><span class="o">&lt;</span><span class="n">Self</span><span class="o">&gt;</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">Self</span>: <span class="nb">Sized</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="k">trait</span><span class="w"> </span><span class="n">Write</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">write</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span>: <span class="kp">&amp;</span><span class="p">[</span><span class="kt">u8</span><span class="p">])</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">flush</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w">    </span><span class="c1">// provided default impls
</span><span class="c1"></span><span class="w">    </span><span class="k">fn</span> <span class="nf">write_vectored</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">bufs</span>: <span class="kp">&amp;</span><span class="p">[</span><span class="n">IoSlice</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="o">&gt;</span><span class="p">])</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">is_write_vectored</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kt">bool</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">write_all</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">buf</span>: <span class="kp">&amp;</span><span class="p">[</span><span class="kt">u8</span><span class="p">])</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">write_all_vectored</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">bufs</span>: <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="p">[</span><span class="n">IoSlice</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="o">&gt;</span><span class="p">])</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">write_fmt</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">fmt</span>: <span class="nc">Arguments</span><span class="o">&lt;</span><span class="na">&#39;_</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="k">fn</span> <span class="nf">by_ref</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="kp">&amp;</span><span class="nc">mut</span><span class="w"> </span><span class="n">Self</span><span class="w">
</span><span class="w">    </span><span class="k">where</span><span class="w">
</span><span class="w">        </span><span class="n">Self</span>: <span class="nb">Sized</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><p>é€šç”¨çš„å…¨é¢å®ç°å€¼å¾—äº†è§£ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">impl</span><span class="o">&lt;</span><span class="n">R</span>: <span class="nc">Read</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">?</span><span class="nb">Sized</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Read</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">R</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">impl</span><span class="o">&lt;</span><span class="n">W</span>: <span class="nc">Write</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">?</span><span class="nb">Sized</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Write</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">W</span><span class="p">;</span><span class="w">
</span></code></pre></div><p>è¿™è¯´æ˜ä»»ä½•å¯¹ <code>Read</code> ç±»å‹çš„å¯å˜å¼•ç”¨ä¹Ÿæ˜¯ <code>Read</code>ï¼Œå¯¹ <code>Write</code> ä¹Ÿæ˜¯å¦‚æ­¤ã€‚äº†è§£è¿™ä¸€ç‚¹å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸æˆ‘ä»¬ä½¿ç”¨ä»»ä½•å¸¦æœ‰ <code>self</code> æ¥æ”¶å™¨çš„æ–¹æ³•ï¼Œå°±åƒå®ƒæœ‰ä¸€ä¸ª <code>&amp;mut self</code> æ¥æ”¶å™¨ä¸€æ ·ã€‚æˆ‘ä»¬å·²ç»åœ¨ <code>Iterator</code> trait éƒ¨åˆ†ä»‹ç»äº†å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ä»¥åŠä¸ºä»€ä¹ˆå®ƒå¾ˆæœ‰ç”¨ï¼Œæ‰€ä»¥æˆ‘ä¸æ‰“ç®—åœ¨è¿™é‡Œå†æ¬¡é‡å¤ã€‚</p>
<p>æˆ‘æƒ³æŒ‡å‡ºï¼Œ<code>&amp;[u8]</code> å®ç°äº† <code>Read</code>ï¼Œ<code>Vec&lt;u8&gt;</code> å®ç°äº† <code>Write</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°ä½¿ç”¨ <code>String</code> å¯¹æˆ‘ä»¬çš„æ–‡ä»¶å¤„ç†å‡½æ•°è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œè¿™äº›å‡½æ•°å¾ˆå®¹æ˜“è½¬æ¢ä¸º <code>&amp;[u8]</code> å’Œ <code>Vec&lt;u8&gt;</code>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-rust" data-lang="rust"><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">path</span>::<span class="n">Path</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">fs</span>::<span class="n">File</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">io</span>::<span class="n">Read</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">io</span>::<span class="n">Write</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">use</span><span class="w"> </span><span class="n">std</span>::<span class="n">io</span><span class="p">;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// function we want to test
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">uppercase</span><span class="o">&lt;</span><span class="n">R</span>: <span class="nc">Read</span><span class="p">,</span><span class="w"> </span><span class="n">W</span>: <span class="nc">Write</span><span class="o">&gt;</span><span class="p">(</span><span class="k">mut</span><span class="w"> </span><span class="n">read</span>: <span class="nc">R</span><span class="p">,</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">write</span>: <span class="nc">W</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">io</span>::<span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">buffer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">new</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">read</span><span class="p">.</span><span class="n">read_to_string</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">buffer</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">uppercase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="p">.</span><span class="n">to_uppercase</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">write</span><span class="p">.</span><span class="n">write_all</span><span class="p">(</span><span class="n">uppercase</span><span class="p">.</span><span class="n">as_bytes</span><span class="p">())</span><span class="o">?</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="n">write</span><span class="p">.</span><span class="n">flush</span><span class="p">()</span><span class="o">?</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// in actual program we&#39;d pass Files
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">example</span><span class="p">(</span><span class="n">in_path</span>: <span class="kp">&amp;</span><span class="nc">Path</span><span class="p">,</span><span class="w"> </span><span class="n">out_path</span>: <span class="kp">&amp;</span><span class="nc">Path</span><span class="p">)</span><span class="w"> </span>-&gt; <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span><span class="w"> </span><span class="n">io</span>::<span class="n">Error</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">in_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span>::<span class="n">open</span><span class="p">(</span><span class="n">in_path</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">out_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">File</span>::<span class="n">open</span><span class="p">(</span><span class="n">out_path</span><span class="p">)</span><span class="o">?</span><span class="p">;</span><span class="w">
</span><span class="w">    </span><span class="n">uppercase</span><span class="p">(</span><span class="n">in_file</span><span class="p">,</span><span class="w"> </span><span class="n">out_file</span><span class="p">)</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c1">// however in unit tests we can use Strings!
</span><span class="c1"></span><span class="cp">#[test]</span><span class="w"> </span><span class="c1">// âœ…
</span><span class="c1"></span><span class="k">fn</span> <span class="nf">example_test</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">in_file</span>: <span class="nb">String</span> <span class="o">=</span><span class="w"> </span><span class="s">&#34;i am screaming&#34;</span><span class="p">.</span><span class="n">into</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">out_file</span>: <span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">u8</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Vec</span>::<span class="n">new</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">uppercase</span><span class="p">(</span><span class="n">in_file</span><span class="p">.</span><span class="n">as_bytes</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">out_file</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">out_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">String</span>::<span class="n">from_utf8</span><span class="p">(</span><span class="n">out_file</span><span class="p">).</span><span class="n">unwrap</span><span class="p">();</span><span class="w">
</span><span class="w">    </span><span class="n">assert_eq</span><span class="o">!</span><span class="p">(</span><span class="n">out_result</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;I AM SCREAMING&#34;</span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">}</span><span class="w">
</span></code></pre></div><h2 id="ç»“è®º">ç»“è®º</h2>
<p>æˆ‘ä»¬ä¸€èµ·å­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿! äº‹å®ä¸Šï¼Œå¤ªå¤šäº†ã€‚å®ƒç°åœ¨æ˜¯æˆ‘ä»¬çš„äº†:</p>
<p><img src="../assets/jason-jarvis-stdlib-traits.png" alt="rust standard library traits"></p>
<p><em>Artist credit: <a href="https://thejenkinscomic.wordpress.com/2020/05/06/memory/">The Jenkins Comic</a></em></p>
<h2 id="è®¨è®º">è®¨è®º</h2>
<p>åœ¨è¿™é‡Œè®¨è®ºè¿™ç¯‡æ–‡ç« </p>
<ul>
<li><a href="https://github.com/pretzelhammer/rust-blog/discussions">Github</a></li>
<li><a href="https://www.reddit.com/r/learnrust/comments/ml9shl/tour_of_rusts_standard_library_traits/">learnrust subreddit</a></li>
<li><a href="https://users.rust-lang.org/t/blog-post-tour-of-rusts-standard-library-traits/57974">official Rust users forum</a></li>
<li><a href="https://twitter.com/pretzelhammer/status/1379561720176336902">Twitter</a></li>
<li><a href="https://lobste.rs/s/g27ezp/tour_rust_s_standard_library_traits">lobste.rs</a></li>
<li><a href="https://www.reddit.com/r/rust/comments/mmrao0/tour_of_rusts_standard_library_traits/">rust subreddit</a></li>
</ul>
<h2 id="é€šçŸ¥">é€šçŸ¥</h2>
<p>å½“ä¸‹ä¸€ç¯‡åšæ–‡å‘å¸ƒæ—¶ï¼Œä¼šæ”¶åˆ°é€šçŸ¥</p>
<ul>
<li><a href="https://twitter.com/pretzelhammer">Following pretzelhammer on Twitter</a> or</li>
<li>Watching this repo&rsquo;s releases (click <code>Watch</code> -&gt; click <code>Custom</code> -&gt; select <code>Releases</code> -&gt; click <code>Apply</code>)</li>
</ul>
<h2 id="æ›´å¤šé˜…è¯»">æ›´å¤šé˜…è¯»</h2>
<ul>
<li><a href="https://ohmyweekly.github.io/notes/2021-04-11-sizedness-in-rust/">Sizedness in Rust</a></li>
<li><a href="./common-rust-lifetime-misconceptions.md">Common Rust Lifetime Misconceptions</a></li>
<li><a href="./learning-rust-in-2020.md">Learning Rust in 2020</a></li>
<li><a href="./too-many-brainfuck-compilers.md">Learn Assembly with Entirely Too Many Brainfuck Compilers</a></li>
</ul>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/raku" term="raku" label="Raku" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Psql]]></title>
            <link href="https://ohmyweekly.github.io/notes/2021-04-05-psql/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2021-03-15-towards-a-new-general-dispatch-mechanism-in-moarvm/?utm_source=atom_feed" rel="related" type="text/html" title="äº‰å–åœ¨ MoarVM ä¸­å»ºç«‹ä¸€ä¸ªæ–°çš„æ€»è°ƒåº¦æœºåˆ¶" />
                <link href="https://ohmyweekly.github.io/notes/2021-03-07-difference-between-build-and-tweak-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="BUILD å’Œ TWEAK çš„åŒºåˆ«" />
                <link href="https://ohmyweekly.github.io/notes/2021-03-01-how-to-type-unicode-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="å¦‚ä½•åœ¨ Raku ä¸­è¾“å…¥ Unicode" />
                <link href="https://ohmyweekly.github.io/notes/2021-02-17-method-isd/?utm_source=atom_feed" rel="related" type="text/html" title="Method-ish" />
                <link href="https://ohmyweekly.github.io/notes/2021-02-28-pattern-dispatch/?utm_source=atom_feed" rel="related" type="text/html" title="æ¨¡å¼åˆ†æ´¾" />
            
                <id>https://ohmyweekly.github.io/notes/2021-04-05-psql/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-04-05T00:00:00+08:00</published>
            <updated>2021-04-05T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Psql</blockquote><h1 id="raku-ä¸-postgresql-çš„è¿æ¥æ€§ä¸€è§ˆ">Raku ä¸ PostgreSQL çš„è¿æ¥æ€§ä¸€è§ˆ</h1>
<p>åœ¨æˆ‘çœ‹æ¥ï¼ŒRaku æ˜¯ä¸€é—¨ä¼Ÿå¤§çš„è¯­è¨€ï¼Œæˆ‘æ¯å¤©éƒ½åœ¨ä½¿ç”¨å®ƒï¼Œè€Œä¸”è¶Šæ¥è¶Šå¤šã€‚æˆ‘å¯ä»¥è¯´å®ƒå°†å–ä»£æˆ‘çš„ Perl è„šæœ¬ã€‚</p>
<p>Raku æœ‰ä¸€ä¸ªå¹¿æ³›çš„æ¨¡å—åº“ï¼Œå½“ç„¶åŒ…æ‹¬æ•°æ®åº“è¿æ¥ï¼Œè¿™åè¿‡æ¥åˆåŒ…æ‹¬è¿æ¥ PostgreSQL çš„åŠŸèƒ½ã€‚
åœ¨è¿™ç¯‡ç®€å•çš„æ–‡ç« ä¸­ï¼Œæˆ‘å°†å¿«é€Ÿæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ Raku çš„ä¸€æ®µä»£ç æ¥å®Œæˆè®¸å¤šæ¯”æ•°æ®åº“åº”ç”¨ç¨‹åºè¿˜çç¢çš„ä»»åŠ¡ã€‚
è„šæœ¬æ˜¯ä»¥å¢é‡çš„æ–¹å¼å‘ˆç°çš„ï¼Œæ‰€ä»¥è¿æ¥æ•°æ®åº“éƒ¨åˆ†å¿…é¡»å§‹ç»ˆä½œä¸ºè„šæœ¬çš„å‰è¨€ã€‚</p>
<p>DB::Pg æ¨¡å—åœ¨æŸç§ç¨‹åº¦ä¸Šä¸ Perl 5 çš„ DBD::Pg å¾ˆç›¸ä¼¼ï¼Œæ‰€ä»¥å¾ˆå¤šæ¦‚å¿µå’Œæ–¹æ³•åéƒ½ä¼šè®©äººæƒ³èµ·åè€…ã€‚</p>
<h2 id="å®‰è£…æ–¹æ³•">å®‰è£…æ–¹æ³•</h2>
<p>å¯ä»¥ä½¿ç”¨ zef æ¥å®‰è£… DB::Pg æ¨¡å—ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">% zef install DB::Pg
</code></pre></div><p>æ ¹æ®ä½ çš„ç³»ç»Ÿé€Ÿåº¦å’Œå·²ç»å®‰è£…çš„åº“ï¼Œå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿçš„æ—¶é—´ã€‚</p>
<p>å¦‚æœä½ è¦ä½¿ç”¨ LISTEN/NOTIFYï¼Œä½ éœ€è¦åŒæ—¶å®‰è£… epoLl.NET å’Œ EPOLl.NETã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">% zef install epoll
</code></pre></div><h2 id="è¿æ¥åˆ°æ•°æ®åº“">è¿æ¥åˆ°æ•°æ®åº“</h2>
<p>ç°åœ¨å¯ä»¥ä½¿ç”¨ DB::Pg æ¨¡å—è¿æ¥åˆ°æ•°æ®åº“ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç®€å•çš„è„šæœ¬å¯ä»¥æ¥å—å‘½ä»¤è¡Œä¸Šçš„æ‰€æœ‰å‚æ•°ï¼ˆæ¸…æ™°çš„æ–‡æœ¬ï¼ï¼‰ï¼Œå¯ä»¥æ˜¯ï¼š</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="ch">#!raku</span>

<span class="k">use</span> <span class="nn">DB::Pg</span><span class="p">;</span>

<span class="k">sub</span> <span class="nb">MAIN</span><span class="p">(</span> <span class="nb">Str</span> <span class="o">:</span><span class="nv">$host</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">miguel</span><span class="p">&#39;</span><span class="o">,</span>
          <span class="nb">Str</span> <span class="o">:</span><span class="nv">$username</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">luca</span><span class="p">&#39;</span><span class="o">,</span>
          <span class="nb">Str</span> <span class="o">:</span><span class="nv">$password</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">secet</span><span class="p">&#39;</span><span class="o">,</span>
          <span class="nb">Str</span> <span class="o">:</span><span class="nv">$database</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">testdb</span><span class="p">&#39;</span> <span class="p">)</span> <span class="p">{</span>

    <span class="p">&#34;</span><span class="s2">Connecting </span><span class="nv">$username</span><span class="s2"> @ </span><span class="nv">$host</span><span class="s2">/</span><span class="nv">$database</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>

    <span class="k">my</span> <span class="nv">$connection</span> <span class="o">=</span> <span class="n">DB::Pg</span><span class="o">.</span><span class="nb">new</span><span class="o">:</span> <span class="s">conninfo</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">host=</span><span class="nv">$host</span><span class="s2"> user=</span><span class="nv">$username</span><span class="s2"> password=</span><span class="nv">$password</span><span class="s2"> dbname=</span><span class="nv">$database</span><span class="p">&#34;;</span>
</code></pre></div><p>å¦‚ä½ æ‰€è§ï¼ŒDB::Pgæ¨¡å—æ¥å—ä¸€ä¸ª conninfo å­—ç¬¦ä¸²ã€‚</p>
<h2 id="è¯»å–æŸ¥è¯¢å’Œç»“æœ">è¯»å–æŸ¥è¯¢å’Œç»“æœ</h2>
<p><code>.query</code> æ–¹æ³•å…è®¸å‘æ•°æ®åº“å‘å‡ºè¯»å–æŸ¥è¯¢ã€‚ç»“æœæ˜¯ä¸€ä¸ª Result ç±»å¯¹è±¡ï¼Œå®ƒå¯ä»¥é€šè¿‡ä¸åŒçš„æ–¹æ³•æ¥ä½¿ç”¨ï¼Œæœ€è‘—åçš„æ˜¯ <code>.hash</code> å’Œ <code>.arrays</code>ï¼Œå®ƒä»¬è¿”å›ä¸€è¿ä¸²çš„ hash æˆ– arraysï¼Œä»æŸ¥è¯¢ä¸­æå–çš„æ¯ä¸€è¡Œéƒ½æœ‰ä¸€ä¸ª <code>.rows</code> å’Œ <code>.column</code> ç­‰ç‰¹æ®Šæ–¹æ³•åˆ†åˆ«æä¾›äº†æŸ¥è¯¢è¿”å›çš„è¡Œæ•°å’Œç»“æœé›†çš„åˆ—åã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªç®€å•çš„æŸ¥è¯¢ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$query</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">SELECT current_role, current_time</span><span class="p">&#39;;</span>
<span class="k">my</span> <span class="nv">$results</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">.</span><span class="nf">query:</span> <span class="nv">$query</span><span class="p">;</span>

<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">The query </span><span class="p">{</span> <span class="nv">$query</span> <span class="p">}</span><span class="s2"> returned </span><span class="p">{</span> <span class="nv">$results</span><span class="o">.</span><span class="nf">rows</span> <span class="p">}</span><span class="s2"> rows with columns: </span><span class="p">{</span> <span class="nv">$results</span><span class="o">.</span><span class="nf">columns</span><span class="o">.</span><span class="nb">join</span><span class="p">(</span> <span class="p">&#39;</span><span class="s1">, </span><span class="p">&#39;</span> <span class="p">)</span> <span class="p">}&#34;;</span>
<span class="k">for</span> <span class="nv">$results</span><span class="o">.</span><span class="nf">hashes</span> <span class="k">-&gt;</span> <span class="nv">$row</span> <span class="p">{</span>
    <span class="k">for</span> <span class="nv">$row</span><span class="o">.</span><span class="nb">kv</span> <span class="k">-&gt;</span> <span class="nv">$column</span><span class="o">,</span> <span class="nv">$value</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Column </span><span class="nv">$column</span><span class="s2"> = </span><span class="nv">$value</span><span class="p">&#34;;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>ä¸Šé¢è¿™æ®µä»£ç æä¾›äº†ä¸€ä¸ªç±»ä¼¼äºä¸‹é¢çš„è¾“å‡ºã€‚</p>
<p>æŸ¥è¯¢ <code>SELECT current_role, current_time</code> è¿”å›1è¡Œï¼Œåˆ—æ•°ä¸ºï¼š current_role, current_timeã€‚</p>
<pre><code>Column current_role = luca
Column current_time = 14:48:47.147983+02
</code></pre><h2 id="å…‰æ ‡">å…‰æ ‡</h2>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>.query</code> æ–¹æ³•å°†ä»æŸ¥è¯¢ä¸­è·å–æ‰€æœ‰çš„è¡Œï¼Œè¿™å¯¹äºè¾ƒå¤§çš„æ•°æ®é›†æ¥è¯´æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚å¯ä»¥ä½¿ç”¨ <code>.cursor</code> æ–¹æ³•ï¼Œå®ƒå¯ä»¥æ¥å—å¯é€‰çš„æ‰¹é‡å¤§å°ï¼ˆé»˜è®¤ä¸º1000ä¸ªå…ƒç»„ï¼‰ï¼Œå¹¶å¯é€‰åœ°æ¥å—å°†ç»“æœè·å–ä¸ºå“ˆå¸Œåºåˆ—çš„æŒ‡å®šå™¨ã€‚</p>
<p>ä½œä¸ºä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="nv">$connection</span><span class="o">.</span><span class="nf">cursor</span><span class="p">(</span> <span class="p">&#39;</span><span class="s1">select * from raku</span><span class="p">&#39;</span><span class="o">,</span> <span class="s">fetch</span> <span class="o">=&gt;</span> <span class="mi">2</span>, <span class="p">:</span><span class="s">hash</span> <span class="p">)</span> <span class="k">-&gt;</span> <span class="nv">%row</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">====================</span><span class="p">&#34;;</span>
    <span class="k">for</span> <span class="nv">%row</span><span class="o">.</span><span class="nb">kv</span> <span class="k">-&gt;</span> <span class="nv">$column</span><span class="o">,</span> <span class="nv">$value</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Column [ </span><span class="nv">$column</span><span class="s2"> ] = </span><span class="nv">$value</span><span class="p">&#34;;</span>
    <span class="p">}</span>
    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">====================</span><span class="p">&#34;;</span>
<span class="p">}</span>
</code></pre></div><p>äº§ç”Ÿå’Œè¾“å‡ºåƒè¿™æ ·çš„ä¸œè¥¿ã€‚</p>
<pre><code>====================
Column [ pk ] = 2
Column [ t ] = This is value 0
====================
====================
Column [ pk ] = 3
Column [ t ] = This is value 1
====================
====================
Column [ t ] = This is value 2
Column [ pk ] = 4
====================
====================
Column [ pk ] = 5
Column [ t ] = This is value 3
====================
...
</code></pre><h2 id="æ’°å†™å£°æ˜">æ’°å†™å£°æ˜</h2>
<p>ç¼–å†™è¯­å¥å¯ä»¥é€šè¿‡ <code>.execute</code> æ–¹æ³•æ¥æ‰§è¡Œï¼Œå¦‚:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$connection</span><span class="o">.</span><span class="nf">execute:</span> <span class="k">q</span><span class="p">&lt;</span><span class="s"> insert into raku( t ) values( &#39;Hello World&#39; )</span><span class="p">&gt;;</span>
</code></pre></div><h2 id="äº¤æ˜“å’Œç¼–åˆ¶æŠ¥è¡¨">äº¤æ˜“å’Œç¼–åˆ¶æŠ¥è¡¨</h2>
<p>ä¸ºäº†å¤„ç†äº‹åŠ¡ï¼Œä½ éœ€è¦è®¿é—®è¢«&quot;å±è”½&quot;åˆ° DB::Pg ä¸»å¯¹è±¡ä¸­çš„æ•°æ®åº“å¤„ç†ç¨‹åºã€‚æ•°æ®åº“å¯¹è±¡åƒå¾€å¸¸ä¸€æ ·æä¾›äº† <code>.begin</code>ã€<code>.rollback</code>ã€<code>.commit</code>ç­‰æ–¹æ³•ã€‚</p>
<p>æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <code>.prepare</code> æ–¹æ³•æ¥è·å¾—ä¸€ä¸ªå·²å‡†å¤‡å¥½çš„è¯­å¥ï¼Œè¯¥è¯­å¥å¯ä»¥è¢«ç¼“å­˜å¹¶ç”¨äºå¾ªç¯å’Œé‡å¤æ€§ä»»åŠ¡ä¸­ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<code>.prepare</code> æ–¹æ³•ä½¿ç”¨äº† <code>$1</code>ã€<code>$2</code> ç­‰å‚æ•°å ä½ç¬¦ï¼Œå½“è¯­å¥æ¥å—å•ä¸ªå€¼æ—¶ï¼Œå¿…é¡»åœ¨ <code>.execute</code> ä¸­ä¸æŒ‡å®šç´¢å¼•ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$database-handler</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">.</span><span class="nf">db</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$statement</span> <span class="o">=</span> <span class="nv">$database-handler</span><span class="o">.</span><span class="nf">prepare:</span> <span class="p">&#39;</span><span class="s1">insert into raku( t ) values( $1 )</span><span class="p">&#39;;</span>

<span class="nv">$database-handler</span><span class="o">.</span><span class="nf">begin</span><span class="p">;</span>
<span class="nv">$statement</span><span class="o">.</span><span class="nf">execute</span><span class="p">(</span> <span class="p">&#34;</span><span class="s2">This is value </span><span class="nv">$_</span><span class="p">&#34;</span> <span class="p">)</span>  <span class="k">for</span> <span class="mi">0</span> <span class="o">..</span> <span class="mi">10</span><span class="p">;</span>
<span class="nv">$database-handler</span><span class="o">.</span><span class="nf">commit</span><span class="p">;</span>
<span class="nv">$database-handler</span><span class="o">.</span><span class="nb">finish</span><span class="p">;</span>
</code></pre></div><p>ä¸Šè¿°å¾ªç¯ç›¸å½“äºä¸€ä¸ªSQLäº‹åŠ¡ï¼Œå¦‚:</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">BEGIN</span><span class="p">;</span><span class="w">
</span><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">raku</span><span class="p">(</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;This is value 0&#39;</span><span class="w"> </span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">raku</span><span class="p">(</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;This is value 1&#39;</span><span class="w"> </span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">raku</span><span class="p">(</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;This is value 2&#39;</span><span class="w"> </span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="p">...</span><span class="w">
</span><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">raku</span><span class="p">(</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;This is value 10&#39;</span><span class="w"> </span><span class="p">);</span><span class="w">
</span><span class="w"></span><span class="k">COMMIT</span><span class="p">;</span><span class="w">
</span></code></pre></div><p><code>.finish</code> æ–¹æ³•æ˜¯å¿…éœ€çš„ï¼Œå› ä¸º DB::Pg å¤„ç†ç¼“å­˜ã€‚è¯·æ³¨æ„ï¼Œ<code>.commit</code> å’Œ <code>.rollback</code> æ–¹æ³•æ˜¯æµç•…çš„ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¯¹è±¡å®ä¾‹ï¼Œè¿™æ ·ä½ å°±å¯ä»¥è°ƒç”¨ <code>.commit.finish</code>ã€‚</p>
<h2 id="æ•°æ®åº“ä¸è¿æ¥">æ•°æ®åº“ä¸è¿æ¥</h2>
<p>ç¼“å­˜çš„å¤„ç†æ–¹å¼æ˜¯ï¼Œå½“å‘å‡ºä¸€ä¸ªæŸ¥è¯¢æ—¶ï¼Œä¼šæ‰“å¼€ä¸€ä¸ªæ–°çš„è¿æ¥å¹¶ä½¿ç”¨ã€‚ä¸€æ—¦å·¥ä½œå®Œæˆï¼Œè¿æ¥å°±ä¼šè¿”å›åˆ°å†…éƒ¨æ± ä¸­ã€‚DB::Pg::Database å¯¹è±¡åšçš„å·¥ä½œå’Œ DB::Pg çš„ä¸€æ ·ï¼Œä¸åŒçš„æ˜¯å®ƒä¸ä¼šè‡ªåŠ¨å°†è¿æ¥è¿”å›åˆ°æ± ä¸­ï¼Œæ‰€ä»¥éœ€è¦è‡ªå·±è¿›è¡Œ <code>.</code> å®Œæˆã€‚</p>
<p>å› æ­¤ï¼Œä½ å¯ä»¥åœ¨ä¸¤ä¸ªå¯¹è±¡ä¸Šä½¿ç”¨ç›¸åŒçš„ <code>.query</code> å’Œ <code>.execute</code> æ–¹æ³•ï¼Œä½† DB::Pg ä¼šè‡ªåŠ¨å°†è¿æ¥è¿”å›åˆ°å†…éƒ¨æ± ä¸­ï¼Œè€Œæ•°æ®åº“å¯¹è±¡åˆ™å…è®¸ä½ å¯¹ä½•æ—¶å°†è¿æ¥è¿”å›åˆ°æ± ä¸­è¿›è¡Œç»†ç²’åº¦çš„æ§åˆ¶ã€‚</p>
<h2 id="å¤åˆ¶">å¤åˆ¶</h2>
<p>PostgreSQL æä¾›äº†ç‰¹æ®Šçš„ COPY å‘½ä»¤ï¼Œå¯ä»¥ç”¨æ¥å¤åˆ¶ä»å’Œè¿›å…¥ã€‚æœ‰ä¸€ä¸ªæ–¹æ³• <code>.copy-in</code> å¯ä»¥æ‰§è¡Œ <code>COPY FROM</code>ï¼Œè€Œ <code>COPY TO</code> å¯ä»¥åœ¨è¿­ä»£å¾ªç¯ä¸­ä½¿ç”¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$file</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">/tmp/raku.csv</span><span class="p">&#39;</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">open</span><span class="o">:</span> <span class="p">:</span><span class="s">w</span><span class="p">;</span>
<span class="k">for</span> <span class="nv">$connection</span><span class="o">.</span><span class="nf">query:</span> <span class="p">&#39;</span><span class="s1">COPY raku TO stdout (FORMAT CSV)</span><span class="p">&#39;</span>  <span class="k">-&gt;</span> <span class="nv">$row</span> <span class="p">{</span>
    <span class="nv">$file</span><span class="o">.</span><span class="nb">print</span><span class="o">:</span> <span class="nv">$row</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>ä»¥ä¸Šå°† CSV ç»“æœå¯¼å‡ºåˆ°æ–‡æœ¬æ–‡ä»¶ä¸Šã€‚
å¦‚æœè¦è¯»å›æ•°æ®ï¼Œå¯ä»¥å‘å‡º <code>.copy-in</code> æ–¹æ³•ï¼Œä½†é¦–å…ˆéœ€è¦å‘å‡º <code>SQL COPY</code>ã€‚å·¥ä½œæµç¨‹æ˜¯</p>
<pre><code>issue a COPY FROM STDIN;
use .copy-data to slurp all the data;
use .copy-end to notify the database that the COPY is concluded.
</code></pre><p>å¯¹.copy-endçš„éœ€æ±‚æ˜¯ä¸€ä¸ªå»ºè®®ï¼šå¯ä»¥åœ¨ä¸€æ¬¡è¿è¡Œä¸­å‘å‡ºä¸åŒçš„.copy-dataï¼Œä¾‹å¦‚ä»ä¸åŒæ–‡ä»¶ä¸­å¯¼å…¥æ•°æ®ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$database-handler</span> <span class="o">=</span> <span class="nv">$connection</span><span class="o">.</span><span class="nf">db</span><span class="p">;</span>
<span class="nv">$database-handler</span><span class="o">.</span><span class="nf">query:</span> <span class="p">&#39;</span><span class="s1">COPY raku FROM STDIN (FORMAT CSV)</span><span class="p">&#39;;</span>
<span class="nv">$database-handler</span><span class="o">.</span><span class="nf">copy-data:</span>  <span class="p">&#39;</span><span class="s1">/tmp/raku1.csv</span><span class="p">&#39;</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">slurp</span><span class="p">;</span>
<span class="nv">$database-handler</span><span class="o">.</span><span class="nf">copy-data:</span>  <span class="p">&#39;</span><span class="s1">/tmp/raku2.csv</span><span class="p">&#39;</span><span class="o">.</span><span class="nb">IO</span><span class="o">.</span><span class="nb">slurp</span><span class="p">;</span>
<span class="nv">$database-handler</span><span class="o">.</span><span class="nf">copy-end</span><span class="p">;</span>
</code></pre></div><h2 id="è½¬æ¢å™¨">è½¬æ¢å™¨</h2>
<p>å¯ä»¥æŒ‡å®šè½¬æ¢å™¨ï¼Œå³å¤„ç†è¿›å‡ºæ•°æ®åº“çš„å€¼çš„ç‰¹æ®Šè§’è‰²ï¼›è¿™è®©æˆ‘æƒ³èµ·äº† DBI::Class çš„ <code>inflate</code> å’Œ <code>deflate</code> é€‰é¡¹ã€‚
ç¬¬ä¸€æ­¥æ˜¯åœ¨ <code>DB::Pg</code> ä¸­ç»™è½¬æ¢å™¨å®ä¾‹æ·»åŠ ä¸€ä¸ªè§’è‰²ï¼Œè¿™æ ·çš„å®ä¾‹å¿…é¡»ã€‚</p>
<ul>
<li>å¢åŠ ä¸€ä¸ªæ–°çš„ç±»å‹è½¬æ¢æ–¹æ³•ã€‚</li>
<li>å¢åŠ ä¸€ä¸ªè½¬æ¢æ–¹æ³•æ¥å¤„ç†ç±»å‹å­—ç¬¦ä¸²åŒ–çš„å€¼ï¼Œå¹¶è¿”å›æ–°å€¼ï¼ˆåœ¨ä»»ä½• Raku å®ä¾‹ä¸­ï¼‰ã€‚</li>
</ul>
<p>ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œä¸‹é¢å°†ä¸€ä¸ªæ–‡æœ¬ PostgreSQL ç±»å‹è½¬æ¢ä¸ºä¸€ä¸ª Str Raku å¯¹è±¡ï¼Œå¹¶åœ¨å…¶å†…å®¹ä¸Šè¿›è¡Œåè½¬ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nv">$connection</span><span class="o">.</span><span class="nf">converter</span> <span class="k">does</span> <span class="k">role</span> <span class="nc">fluca-converter</span>
<span class="p">{</span>
    <span class="k">submethod</span> <span class="nb">BUILD</span> <span class="p">{</span> <span class="nb">self</span><span class="o">.</span><span class="nf">add-type</span><span class="p">(</span> <span class="s">text</span> <span class="o">=&gt;</span> <span class="nb">Str</span> <span class="p">)</span> <span class="p">}</span>
    <span class="k">multi</span> <span class="k">method</span> <span class="nf">convert</span><span class="p">(</span> <span class="nb">Str:U</span><span class="o">,</span> <span class="nb">Str:D</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$value</span><span class="o">.</span><span class="nb">flip</span><span class="o">.</span><span class="nb">uc</span><span class="p">;</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="nv">$connection</span><span class="o">.</span><span class="nf">query</span><span class="p">(</span> <span class="p">&#39;</span><span class="s1">select * from raku</span><span class="p">&#39;</span> <span class="p">)</span><span class="o">.</span><span class="nf">arrays</span><span class="p">;</span>
</code></pre></div><p>äº§ç”Ÿç±»ä¼¼äºçš„è¾“å‡ºã€‚</p>
<pre><code>[442 DLROW OLLEH]
[454 DLROW OLLEH]
[466 DLROW OLLEH]
</code></pre><p>å…¶ä¸­å­—ç¬¦ä¸² Hello World è¢«ç¿»è½¬ã€‚</p>
<h2 id="listen-å’Œ-notify">listen å’Œ notify</h2>
<p>DB::Pgä¹Ÿå¯ä»¥å¤„ç†LISTENå’ŒNOTIFYï¼Œå®ƒä»¬èƒ½å¤Ÿä¸Rakuçš„reactåŠ¨æ€åŠŸèƒ½è¿›è¡Œäº¤äº’ã€‚
é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªç®€å•çš„æœºåˆ¶æ¥é€šçŸ¥ä¸€äº›äº‹ä»¶ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="s">testdb</span><span class="o">=&gt;</span> <span class="n">create</span> <span class="ow">or</span> <span class="n">replace</span> <span class="k">rule</span> <span class="nf">r_raku_insert</span> 
         <span class="n">as</span> <span class="n">on</span> <span class="n">insert</span> <span class="nb">to</span> <span class="nb">raku</span> 
         <span class="nb">do</span> <span class="k">also</span> 
         <span class="n">SELECT</span> <span class="nf">pg_notify</span><span class="p">(</span> <span class="p">&#39;</span><span class="s1">insert_event</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">INSERTING ROW(S)</span><span class="p">&#39;</span> <span class="p">);</span>
<span class="nb">CREATE</span> <span class="n">RULE</span>

<span class="s">testdb</span><span class="o">=&gt;</span> <span class="n">create</span> <span class="ow">or</span> <span class="n">replace</span> <span class="k">rule</span> <span class="nf">r_raku_delete</span>
         <span class="n">as</span> <span class="n">on</span> <span class="nb">delete</span> <span class="nb">to</span> <span class="nb">raku</span> 
         <span class="nb">do</span> <span class="k">also</span> 
         <span class="n">SELECT</span> <span class="nf">pg_notify</span><span class="p">(</span> <span class="p">&#39;</span><span class="s1">delete_event</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">DELETING ROW(S)</span><span class="p">&#39;</span> <span class="p">);</span>
<span class="nb">CREATE</span> <span class="n">RULE</span>
</code></pre></div><p>ç°åœ¨ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªç­‰å¾…ä¼ å…¥äº‹ä»¶çš„ Raku è„šæœ¬ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">react</span> <span class="p">{</span>
    <span class="k">whenever</span> <span class="nv">$connection</span><span class="o">.</span><span class="nb">listen</span><span class="p">(</span> <span class="p">&#39;</span><span class="s1">delete_event</span><span class="p">&#39;</span> <span class="p">)</span> <span class="p">{</span> <span class="o">.</span><span class="nb">say</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">whenever</span> <span class="nv">$connection</span><span class="o">.</span><span class="nb">listen</span><span class="p">(</span> <span class="p">&#39;</span><span class="s1">insert_event</span><span class="p">&#39;</span> <span class="p">)</span> <span class="p">{</span> <span class="o">.</span><span class="nb">say</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>ç›®çš„æ˜¯ï¼Œæ¯æ¬¡å‘å‡ºä¸€ä¸ªäº‹ä»¶ï¼Œ<code>.listen</code> éƒ½ä¼šå°†æ¶ˆæ¯æœ‰æ•ˆè½½è·ä¼ é€’ç»™ react ä»£ç å—ã€‚å› æ­¤ï¼Œå‘å‡ºä¸€äº› <code>DELETE</code> å’Œ <code>INSERT</code> ä¼šå¯¼è‡´è¾“å‡ºã€‚</p>
<pre><code>DELETING ROW(S)
INSERTING ROW(S)
INSERTING ROW(S)
</code></pre><p>å¯ä»¥é€šè¿‡ <code>.unlisten</code> æ–¹æ³•åœæ­¢ç›‘å¬ååº”å—ã€‚ä¹Ÿå¯ä»¥é€šè¿‡ <code>.notify</code> æ–¹æ³•å‘å‡ºäº‹ä»¶ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>DB::Pg æ˜¯ PostgreSQL çš„ä¸€ä¸ªå¾ˆå¥½çš„é©±åŠ¨ç¨‹åºï¼Œå®ƒå…è®¸ Raku ç›´æ¥åœ¨è¯­è¨€ä¸­åˆ©ç”¨å¾ˆå¤šåŠŸèƒ½ã€‚</p>
<p>æ–‡ç«  A glance at Raku connectivity towards PostgreSQL å·²ç»ç”± Luca Ferrari å‘å¸ƒåœ¨åšå®¢ä¸Šã€‚</p>
<p>åŸæ–‡é“¾æ¥: <a href="https://fluca1978.github.io/2021/03/29/RakuPostgreSQL.html">https://fluca1978.github.io/2021/03/29/RakuPostgreSQL.html</a></p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/raku" term="raku" label="Raku" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[äº‰å–åœ¨ MoarVM ä¸­å»ºç«‹ä¸€ä¸ªæ–°çš„æ€»è°ƒåº¦æœºåˆ¶]]></title>
            <link href="https://ohmyweekly.github.io/notes/2021-03-15-towards-a-new-general-dispatch-mechanism-in-moarvm/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2021-03-07-difference-between-build-and-tweak-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="BUILD å’Œ TWEAK çš„åŒºåˆ«" />
                <link href="https://ohmyweekly.github.io/notes/2021-03-01-how-to-type-unicode-in-raku/?utm_source=atom_feed" rel="related" type="text/html" title="å¦‚ä½•åœ¨ Raku ä¸­è¾“å…¥ Unicode" />
                <link href="https://ohmyweekly.github.io/notes/2021-02-17-method-isd/?utm_source=atom_feed" rel="related" type="text/html" title="Method-ish" />
                <link href="https://ohmyweekly.github.io/notes/2021-02-28-pattern-dispatch/?utm_source=atom_feed" rel="related" type="text/html" title="æ¨¡å¼åˆ†æ´¾" />
                <link href="https://ohmyweekly.github.io/notes/2021-02-28-custom-when/?utm_source=atom_feed" rel="related" type="text/html" title="è‡ªå®šä¹‰ when" />
            
                <id>https://ohmyweekly.github.io/notes/2021-03-15-towards-a-new-general-dispatch-mechanism-in-moarvm/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-03-15T00:00:00+08:00</published>
            <updated>2021-03-15T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Towards a New General Dispatch Mechanism in Moarvm</blockquote><p>æˆ‘çš„å¤©å•Šï¼Œçœ‹æ¥æˆ‘æ˜¯ä¸¤å¹´å¤šæ¥ç¬¬ä¸€æ¬¡å†™ Raku å†…éƒ¨çš„åšæ–‡äº†ã€‚å½“ç„¶ï¼Œä¸¤å¹´å‰è¿˜ä¸å« Rakuã€‚æ€»ä¹‹ï¼Œè¯ä¸å¤šè¯´ï¼Œç»§ç»­è¯´è¯´è¿™ä¸ªå…±åŒçš„è„‘æ´å§ã€‚</p>
<h2 id="ä»€ä¹ˆæ˜¯è°ƒåº¦">ä»€ä¹ˆæ˜¯è°ƒåº¦ï¼Ÿ</h2>
<p>æˆ‘ç”¨ &ldquo;dispatch&rdquo; æ¥è¡¨ç¤ºæˆ‘ä»¬æ¥å—ä¸€ç»„å‚æ•°ï¼Œæœ€åæ ¹æ®è¿™äº›å‚æ•°é‡‡å–ä¸€äº›è¡ŒåŠ¨çš„è¿‡ç¨‹ã€‚ä¸€äº›ç†Ÿæ‚‰çš„ä¾‹å­åŒ…æ‹¬:</p>
<ul>
<li>
<p>è¿›è¡Œä¸€ä¸ªæ–¹æ³•è°ƒç”¨ï¼Œæ¯”å¦‚ <code>$basket.add($product, $quantity)</code>ã€‚ä¼ ç»Ÿä¸Šï¼Œæˆ‘ä»¬å¯èƒ½åªè°ƒç”¨ <code>$product</code> å’Œ <code>$qauntity</code> ä½œä¸ºå‚æ•°ï¼Œä½†å°±æˆ‘çš„ç›®çš„è€Œè¨€ï¼Œæ‰€æœ‰çš„ <code>$basket</code>ã€æ–¹æ³•å  &ldquo;add&rdquo;ã€<code>$product</code> å’Œ <code>$quantity</code> éƒ½æ˜¯ dispatch çš„å‚æ•°ï¼šå®ƒä»¬æ˜¯æˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿ï¼Œä»¥ä¾¿å†³å®šæˆ‘ä»¬è¦åšä»€ä¹ˆã€‚</p>
</li>
<li>
<p>è¿›è¡Œå­ç¨‹åºè°ƒç”¨ï¼Œå¦‚ <code>uc($youtube-comment)</code>ã€‚ç”±äº Raku sub è°ƒç”¨æ˜¯è¯æ³•è§£æçš„ï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè°ƒåº¦çš„å‚æ•°æ˜¯ <code>&amp;uc</code>ï¼ˆæŸ¥æ‰¾å­ç¨‹åºçš„ç»“æœï¼‰å’Œ <code>$youtube-comment</code>ã€‚</p>
</li>
<li>
<p>è°ƒç”¨å¤šä¸ªè°ƒåº¦å­ç¨‹åºæˆ–æ–¹æ³•ï¼Œæ ¹æ®å‚æ•°çš„æ•°é‡å’Œç±»å‹æ¥å†³å®šè°ƒç”¨ä¸€ç»„å€™é€‰ç¨‹åºä¸­çš„å“ªä¸€ä¸ªã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥çœ‹ä½œæ˜¯å‘ç”Ÿåœ¨ä¸Šè¿°ä¸¤ä¸ªè°ƒåº¦ä¸­çš„ä¸€ä¸ª &ldquo;å†…éƒ¨&rdquo;ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ Raku ä¸­æ—¢æœ‰å¤šé‡è°ƒåº¦å­ç¨‹åºï¼Œä¹Ÿæœ‰æ–¹æ³•ã€‚</p>
</li>
</ul>
<p>ä¹ä¸€çœ‹ï¼Œä¹Ÿè®¸å‰ä¸¤ä¸ªçœ‹èµ·æ¥ç›¸å½“ç®€å•ï¼Œç¬¬ä¸‰ä¸ªå°±æœ‰ç‚¹æ‰‹å¿™è„šä¹±äº† - è¿™ä¹Ÿç®—æ˜¯äº‹å®ã€‚ç„¶è€Œï¼ŒRaku è¿˜æœ‰ä¸€äº›å…¶ä»–çš„ç‰¹æ€§ï¼Œä½¿å¾—è°ƒåº¦å˜å¾—ç›¸å½“ï¼Œå—¯ï¼Œæœ‰è¶£ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>
<p><code>wrap</code> å…è®¸æˆ‘ä»¬åŒ…è£…ä»»ä½• Routine (sub æˆ–æ–¹æ³•); åŒ…è£…å™¨å¯ä»¥é€‰æ‹©ç”¨åŸæ¥çš„å‚æ•°æˆ–æ–°çš„å‚æ•°æ¥æœä»åŸæ¥çš„ä¾‹ç¨‹ã€‚</p>
</li>
<li>
<p>å½“è¿›è¡Œå¤šé‡è°ƒåº¦æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªåŸå‹ä¾‹ç¨‹ï¼Œè®©å®ƒé€‰æ‹©ä½•æ—¶ - ç”šè‡³æ˜¯å¦ - è°ƒç”¨åˆé€‚çš„å€™é€‰è€…ã€‚</p>
</li>
<li>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>callsame</code> è¿™æ ·çš„ä¾‹ç¨‹ï¼Œä»¥ä¾¿åœ¨è°ƒåº¦ä¸­æ¨è¿Ÿåˆ°ä¸‹ä¸€ä¸ªå€™é€‰è€…ã€‚ä½†è¿™æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬æ˜¯åœ¨ä¸€ä¸ªå¤šé‡è°ƒåº¦ä¸­ï¼Œå®ƒæ„å‘³ç€ä¸‹ä¸€ä¸ªæœ€é€‚ç”¨çš„å€™é€‰è€…ï¼Œå¦‚æœæœ‰çš„è¯ã€‚å¦‚æœæˆ‘ä»¬æ˜¯åœ¨ä¸€ä¸ªæ–¹æ³•è°ƒåº¦ä¸­ï¼Œé‚£ä¹ˆå®ƒæ„å‘³ç€ä¸€ä¸ªåŸºç±»çš„æ–¹æ³•ã€‚(åŒæ ·çš„äº‹æƒ…ä¹Ÿè¢«ç”¨æ¥å®ç°å»ä¸‹ä¸€ä¸ªå°è£…è€…ï¼Œæˆ–è€…ï¼Œæœ€ç»ˆä¹Ÿæ˜¯å»æœ€åˆå°è£…çš„ä¾‹ç¨‹)ã€‚è€Œä¸”è¿™äº›éƒ½å¯ä»¥ç»“åˆèµ·æ¥ï¼šæˆ‘ä»¬å¯ä»¥åŒ…è£…ä¸€ä¸ª multi æ–¹æ³•ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥æœ‰ 3 ä¸ªå±‚æ¬¡çš„ä¸œè¥¿ï¼Œéƒ½æœ‰å¯èƒ½è´¡çŒ®ä¸‹ä¸€ä¸ªè¦è°ƒç”¨çš„ä¸œè¥¿!</p>
</li>
</ul>
<p>å¤šäºäº†è¿™ä¸€ç‚¹ï¼Œdispatch - è‡³å°‘åœ¨ Raku ä¸­ - å¹¶ä¸æ€»æ˜¯æˆ‘ä»¬æ‰€åšçš„äº‹æƒ…å¹¶äº§ç”Ÿä¸€ä¸ªç»“æœï¼Œè€Œæ˜¯ä¸€ä¸ªå¯èƒ½ä¼šè¢«è¦æ±‚ç»§ç»­å¤šæ¬¡è¿›è¡Œçš„è¿‡ç¨‹!</p>
<p>æœ€åï¼Œè™½ç„¶æˆ‘ä¸Šé¢æ‰€å†™çš„ä¾‹å­éƒ½å¯ä»¥å¾ˆæ¸…æ¥šåœ°çœ‹æˆæ˜¯è°ƒåº¦çš„ä¾‹å­ï¼Œä½†åœ¨ Raku ä¸­ï¼Œå…¶ä»–ä¸€äº›å¸¸è§çš„æ„é€ ä¹Ÿå¯ä»¥è¡¨è¾¾ä¸ºä¸€ç§è°ƒåº¦ã€‚åˆ†é…æ˜¯ä¸€ä¸ªä¾‹å­ï¼šå®ƒçš„è¯­ä¹‰å–å†³äºåˆ†é…çš„ç›®æ ‡å’Œè¢«åˆ†é…çš„å€¼ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é€‰æ‹©æ­£ç¡®çš„è¯­ä¹‰ã€‚å¼ºåˆ¶ç±»å‹è½¬æ¢(Coercion)æ˜¯å¦ä¸€ä¸ªä¾‹å­ï¼Œè¿”å›å€¼ç±»å‹æ£€æŸ¥åˆæ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆè°ƒåº¦å¾ˆé‡è¦">ä¸ºä»€ä¹ˆè°ƒåº¦å¾ˆé‡è¦ï¼Ÿ</h2>
<p>Dispatch åœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­æ— å¤„ä¸åœ¨ï¼Œå®ƒæ‚„æ‚„åœ°æŠŠæƒ³åšäº‹æƒ…çš„ä»£ç å’Œåšäº‹æƒ…çš„ä»£ç è”ç³»åœ¨ä¸€èµ·ã€‚å®ƒçš„æ— å¤„ä¸åœ¨æ„å‘³ç€å®ƒåœ¨ç¨‹åºæ€§èƒ½ä¸­æ‰®æ¼”ç€é‡è¦çš„è§’è‰²ã€‚åœ¨æœ€å¥½çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†æˆæœ¬é™ä¸ºé›¶ã€‚åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œè°ƒåº¦çš„æˆæœ¬é«˜åˆ°è¶³ä»¥è¶…è¿‡ä½œä¸ºè°ƒåº¦ç»“æœçš„å·¥ä½œçš„æˆæœ¬ã€‚</p>
<p>åˆæ­¥ä¼°è®¡ï¼Œå½“è¿è¡Œæ—¶&quot;ç†è§£&quot;è°ƒåº¦æ—¶ï¼Œæ€§èƒ½è‡³å°‘ä¼šæœ‰äº›ä¸é”™ï¼Œä½†å½“è¿è¡Œæ—¶ä¸ç†è§£æ—¶ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šå¾ˆç³Ÿç³•ã€‚è°ƒåº¦å¾€å¾€æ¶‰åŠåˆ°ä¸€ä¸ªå¯ä»¥ç¼“å­˜çš„å·¥ä½œé‡ï¼Œå¾€å¾€ä¼šæœ‰ä¸€äº›å»‰ä»·çš„é˜²æŠ¤æªæ–½æ¥éªŒè¯ç¼“å­˜ç»“æœçš„æœ‰æ•ˆæ€§ã€‚ä¾‹å¦‚ï¼Œåœ¨æ–¹æ³•è°ƒåº¦ä¸­ï¼Œå¤©çœŸåœ°æˆ‘ä»¬éœ€è¦èµ°ä¸€ä¸ªçº¿æ€§åŒ–çš„ç»§æ‰¿å›¾ï¼Œå¹¶è¯¢é—®æ²¿é€”é‡åˆ°çš„æ¯ä¸ªç±»æ˜¯å¦æœ‰æŒ‡å®šåç§°çš„æ–¹æ³•ã€‚æ˜¾ç„¶ï¼Œå¦‚æœæˆ‘ä»¬åœ¨æ¯æ¬¡æ–¹æ³•è°ƒç”¨æ—¶éƒ½è¿™æ ·åšï¼Œé€Ÿåº¦ä¸ä¼šéå¸¸å¿«ã€‚ç„¶è€Œï¼Œç‰¹å®šç±»å‹ä¸Šçš„ç‰¹å®šæ–¹æ³•åï¼ˆç²¾ç¡®è¯†åˆ«ï¼Œä¸è€ƒè™‘å­ç±»ï¼‰æ¯æ¬¡éƒ½ä¼šè§£æåˆ°åŒä¸€ä¸ªæ–¹æ³•ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç¼“å­˜æŸ¥æ‰¾çš„ç»“æœï¼Œåªè¦è°ƒç”¨è€…çš„ç±»å‹ä¸ç”¨äºäº§ç”Ÿç¼“å­˜ç»“æœçš„ç±»å‹ç›¸åŒ¹é…ï¼Œå°±å¯ä»¥ä½¿ç”¨å®ƒã€‚</p>
<h2 id="è¯­è¨€è¿è¡Œæ—¶çš„ä¸“é—¨åŒ–ä¸é€šç”¨åŒ–æœºåˆ¶">è¯­è¨€è¿è¡Œæ—¶çš„ä¸“é—¨åŒ–ä¸é€šç”¨åŒ–æœºåˆ¶</h2>
<p>å½“ä¸€ä¸ªäººå¼€å§‹æ„å»ºä¸€ä¸ªé’ˆå¯¹ç‰¹å®šè¯­è¨€çš„è¿è¡Œæ—¶ï¼Œå¹¶ä¸”å¿…é¡»åœ¨ç›¸å½“ç´§å¼ çš„é¢„ç®—ä¸‹å®Œæˆæ—¶ï¼Œè¦æƒ³è·å¾—æŸç§å¯å®¹å¿çš„æ€§èƒ½ï¼Œæœ€æ˜æ˜¾çš„æ–¹æ³•å°±æ˜¯å°†å„ç§çƒ­è·¯å¾„è¯­è¨€è¯­ä¹‰çƒ˜ç„™åˆ°è¿è¡Œæ—¶ä¸­ã€‚è¿™æ­£æ˜¯ MoarVM çš„èµ·æ­¥æ–¹å¼ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬çœ‹çœ‹ MoarVM å‡ å¹´å‰çš„æ ·å­ï¼Œæˆ‘ä»¬ä¼šå‘ç°è¿™æ ·çš„äº‹æƒ…ã€‚</p>
<ul>
<li>å¯¹æ–¹æ³•ç¼“å­˜çš„ä¸€äº›æ”¯æŒ</li>
<li>ä¸€ä¸ªä¸ Raku çš„å¤šé‡è°ƒåº¦è¯­ä¹‰é«˜åº¦ç»‘å®šçš„å¤šé‡è°ƒåº¦ç¼“å­˜ï¼Œåªæœ‰åœ¨è°ƒåº¦éƒ½æ˜¯åä¹‰ç±»å‹çš„æ—¶å€™æ‰çœŸæ­£èƒ½å¤Ÿèµ·åˆ°å¸®åŠ©ä½œç”¨ï¼ˆæ‰€ä»¥ä½¿ç”¨ <code>where</code> çš„ä»£ä»·éå¸¸é«˜ï¼‰ã€‚</li>
<li>ä¸€ç§æœºåˆ¶ï¼Œç”¨äºæŒ‡å®šå¦‚ä½•åœ¨å°è£…ä»£ç å¯¹è±¡å†…éƒ¨æ‰¾åˆ°å®é™…çš„ä»£ç å¥æŸ„ï¼ˆä¾‹å¦‚ï¼Œ<code>Sub</code> å¯¹è±¡æœ‰ä¸€ä¸ªç§æœ‰å±æ€§ï¼Œå®ƒæŒæœ‰è¯†åˆ«è¦è¿è¡Œçš„å­—èŠ‚ç çš„ä½çº§ä»£ç å¥æŸ„ï¼‰ã€‚</li>
<li>ä¸€äº›æœ‰é™çš„å°è¯•ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿåœ¨çŸ¥é“ä¸€ä¸ªè°ƒåº¦ä¸ä¼šç»§ç»­çš„æƒ…å†µä¸‹æ­£ç¡®åœ°è¿›è¡Œä¼˜åŒ– - è¿™éœ€è¦ç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶ä¹‹é—´çš„è°¨æ…åˆä½œï¼ˆæˆ–è€…ä¸é‚£ä¹ˆå¤–äº¤åœ°è®²ï¼Œè¿™éƒ½æ˜¯ä¸€ä¸ªå¤§é»‘å®¢ï¼‰ã€‚</li>
</ul>
<p>è¿™äº›ä»Šå¤©éƒ½è¿˜åœ¨ï¼Œç„¶è€Œä¹Ÿéƒ½åœ¨æ·˜æ±°çš„è·¯ä¸Šã€‚è¿™ä¸ªæ¦œå•æœ€èƒ½è¯´æ˜é—®é¢˜çš„æ˜¯ä»€ä¹ˆï¼Œä¸åŒ…æ‹¬åœ¨å†…ã€‚æ¯”å¦‚ï¼š</p>
<ul>
<li>ç§æœ‰æ–¹æ³•è°ƒç”¨ï¼Œéœ€è¦ä¸åŒçš„ç¼“å­˜ ä½†æœ€åˆçš„è™šæ‹Ÿæœºè®¾è®¡é™åˆ¶äº†æ¯ä¸€ç§ç±»å‹çš„è°ƒç”¨</li>
<li>åˆæ ¼çš„æ–¹æ³•è°ƒç”¨(<code>$obj.SomeType::method-name()</code>)</li>
<li>ä½“é¢ä¼˜åŒ–è°ƒåº¦æ¢å¤çš„æ–¹æ³•</li>
</ul>
<p>å‡ å¹´å‰ï¼Œæˆ‘å¼€å§‹éƒ¨åˆ†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¼•å…¥äº†ä¸€ç§æœºåˆ¶ï¼Œæˆ‘ç§°ä¹‹ä¸º &ldquo;specializer æ’ä»¶&rdquo;ã€‚ä½†é¦–å…ˆï¼Œä»€ä¹ˆæ˜¯ç‰¹åŒ–å™¨(specializer)ï¼Ÿ</p>
<p>MoarVM åˆšå¼€å§‹çš„æ—¶å€™ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„å­—èŠ‚ç è§£é‡Šå™¨ã€‚å®ƒåªéœ€è¦è¶³å¤Ÿå¿«çš„é€Ÿåº¦å‡»è´¥ Parrot VM å°±å¯ä»¥è·å¾—ç›¸å½“çš„ä½¿ç”¨é‡ï¼Œæˆ‘è®¤ä¸ºåœ¨ç»§ç»­å®ç°ä¸€äº›æ›´æœ‰è¶£çš„ä¼˜åŒ–ä¹‹å‰ï¼Œè¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼ˆå½“æ—¶æˆ‘ä»¬è¿˜æ²¡æœ‰ä»Šå¤©è¿™æ ·çš„å‘å¸ƒå‰è‡ªåŠ¨æµ‹è¯•åŸºç¡€è®¾æ–½ï¼Œå› æ­¤æ›´å¤šçš„æ˜¯ä¾èµ–äºæ—©æœŸé‡‡ç”¨è€…çš„åé¦ˆï¼‰ã€‚æ€»ä¹‹ï¼Œåœ¨èƒ½å¤Ÿåƒå…¶ä»–åç«¯ä¸€æ ·è¿è¡Œ Raku è¯­è¨€åä¸ä¹…ï¼Œæˆ‘å°±å¼€å§‹äº†åŠ¨æ€ä¼˜åŒ–å™¨çš„å¼€å‘ã€‚å®ƒåœ¨ç¨‹åºè¢«è§£é‡Šæ—¶æ”¶é›†ç±»å‹ç»Ÿè®¡ï¼Œè¯†åˆ«çƒ­ä»£ç ï¼Œå°†å…¶æ”¾å…¥ <a href="https://en.wikipedia.org/wiki/Static_single_assignment_form">SSA å½¢å¼</a>ï¼Œä½¿ç”¨ç±»å‹ç»Ÿè®¡æ’å…¥é˜²æŠ¤ï¼Œå°†è¿™äº›ä¸å­—èŠ‚ç çš„é™æ€å±æ€§ä¸€èµ·ä½¿ç”¨æ¥åˆ†æå’Œä¼˜åŒ–ï¼Œå¹¶ä¸ºç›¸å…³å‡½æ•°ç”Ÿæˆä¸“é—¨çš„å­—èŠ‚ç ã€‚è¿™ä¸ªå­—èŠ‚ç å¯ä»¥çœç•¥ç±»å‹æ£€æŸ¥å’Œå„ç§æŸ¥æ‰¾ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ç³»åˆ—çš„å†…éƒ¨æ“ä½œï¼Œåšå‡ºå„ç§å‡è®¾ï¼Œç”±äºä¼˜åŒ–å™¨è¯æ˜äº†ç¨‹åºçš„å±æ€§ï¼Œè¿™äº›å‡è®¾æ˜¯å®‰å…¨çš„ã€‚è¿™è¢«ç§°ä¸ºä¸“é—¨åŒ–çš„å­—èŠ‚ç ï¼Œå› ä¸ºå®ƒçš„å¾ˆå¤šé€šç”¨æ€§ - è¿™å°†ä½¿å®ƒèƒ½å¤Ÿæ­£ç¡®åœ°å·¥ä½œåœ¨æˆ‘ä»¬å¯èƒ½é‡åˆ°çš„æ‰€æœ‰ç±»å‹çš„å€¼ä¸Š - è¢«åˆ é™¤äº†ï¼Œè½¬è€Œå·¥ä½œåœ¨è¿è¡Œæ—¶å®é™…å‘ç”Ÿçš„ç‰¹æ®Šæƒ…å†µä¸‹ã€‚(ä»£ç ï¼Œå°¤å…¶æ˜¯åŠ¨æ€è¯­è¨€ä¸­çš„ä»£ç ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œç†è®ºä¸Šçš„é€šç”¨æ€§è¿œè¿œå¤§äºå®è·µä¸­çš„é€šç”¨æ€§ã€‚)</p>
<p>è¿™ä¸ªç»„ä»¶ - å†…éƒ¨ç§°ä¸º &ldquo;spesh&rdquo; çš„ specializer - ä¸º Raku ç¨‹åºçš„æ€§èƒ½å¸¦æ¥äº†æ˜¾è‘—çš„è¿›ä¸€æ­¥æå‡ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œå®ƒçš„å¤æ‚ç¨‹åº¦ä¹Ÿåœ¨ä¸æ–­æé«˜ï¼Œå¹¶é‡‡ç”¨äº†<a href="https://en.wikipedia.org/wiki/Inline_expansion">å†…è”</a>å’Œ<a href="https://en.wikipedia.org/wiki/Escape_analysis">å¸¦æœ‰æ ‡é‡æ›¿æ¢çš„è½¬ä¹‰åˆ†æ</a>ç­‰ä¼˜åŒ–åŠŸèƒ½ã€‚è¿™äº›å¹¶ä¸æ˜¯å®¹æ˜“æ„å»ºçš„ä¸œè¥¿ - ä½†ä¸€æ—¦è¿è¡Œæ—¶æ‹¥æœ‰äº†å®ƒä»¬ï¼Œå®ƒä»¬å°±ä¼šåˆ›é€ å‡ºä»¥å‰ä¸å­˜åœ¨çš„è®¾è®¡å¯èƒ½æ€§ï¼Œå¹¶ä½¿åœ¨æ²¡æœ‰å®ƒä»¬çš„æƒ…å†µä¸‹åšå‡ºçš„å†³å®šçœ‹èµ·æ¥æ˜¯æ¬¡ä¼˜çš„ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œé‚£äº›ç‰¹æ®Šæƒ…å†µä¸‹çš„è¯­è¨€ç‰¹å®šæœºåˆ¶ï¼Œåœ¨æ—©æœŸä¸ºäº†è·å¾—ä¸€äº›é€Ÿåº¦è€Œè¢«åµŒå…¥åˆ°è¿è¡Œæ—¶ä¸­ï¼Œåè€Œæˆä¸ºäº†ä¸€ç§è´Ÿæ‹…å’Œç“¶é¢ˆã€‚å®ƒä»¬å…·æœ‰å¤æ‚çš„è¯­ä¹‰ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å¯¹ä¼˜åŒ–å™¨æ¥è¯´è¦ä¹ˆæ˜¯ä¸é€æ˜çš„ï¼ˆæ‰€ä»¥ä¼˜åŒ–å™¨æ— æ³•å¯¹å®ƒä»¬è¿›è¡Œæ¨ç†ï¼Œæ„å‘³ç€ä¼˜åŒ–å—åˆ°æŠ‘åˆ¶ï¼‰ï¼Œè¦ä¹ˆå°±æ˜¯éœ€è¦åœ¨ä¼˜åŒ–å™¨ä¸­è¿›è¡Œç‰¹æ®Šçš„å°è£…ï¼ˆä¸€ç§è´Ÿæ‹…ï¼‰ã€‚</p>
<p>æ‰€ä»¥ï¼Œå›åˆ° specializer æ’ä»¶ã€‚æˆ‘åˆ°äº†ä¸€ä¸ªåœ°æ­¥ï¼Œæˆ‘æƒ³æ‰¿æ‹…åƒ <code>$obj.?meth(&quot;call me maybe&quot;, dispatch)</code>ã€<code>$obj.SomeType::meth()</code>(ç”¨ç±»å¼€å§‹å¯»æ‰¾çš„è°ƒåº¦é™å®š)ï¼Œä»¥åŠè§’è‰²ä¸­çš„ç§æœ‰æ–¹æ³•è°ƒç”¨(ä¸èƒ½é™æ€è§£æ)è¿™æ ·çš„æ€§èƒ½ã€‚åŒæ—¶ï¼Œæˆ‘è¿˜å‡†å¤‡å®ç°ä¸€å®šé‡çš„è½¬ä¹‰åˆ†æï¼Œä½†æ„è¯†åˆ°å®ƒçš„ä½œç”¨å°†éå¸¸æœ‰é™ï¼Œå› ä¸ºèµ‹å€¼åœ¨è™šæ‹Ÿæœºä¸­ä¹Ÿè¢«ç‰¹ä¾‹åŒ–äº†ï¼Œæœ‰ä¸€å¤§å—ä¸é€æ˜çš„ C ä»£ç åœ¨åšçƒ­è·¯å¾„çš„äº‹æƒ…ã€‚</p>
<p>ä½†ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦è®© C ä»£ç æ¥åšé‚£äº›çƒ­è·¯å¾„çš„äº‹æƒ…å‘¢ï¼Ÿå—¯ï¼Œå› ä¸ºè®©æ¯ä¸ªèµ‹å€¼éƒ½è°ƒç”¨ä¸€ä¸ªè™šæ‹Ÿæœºçº§åˆ«çš„å‡½æ•°ï¼Œåšä¸€å †æ£€æŸ¥å’Œé€»è¾‘ï¼ŒèŠ±è´¹å¤ªå¤§äº†ã€‚ä¸ºä»€ä¹ˆè¿™æ ·åšæˆæœ¬å¾ˆé«˜ï¼Ÿå› ä¸ºå‡½æ•°è°ƒç”¨çš„å¼€é”€å’Œè§£é‡Šçš„æˆæœ¬ã€‚è¿™åœ¨ä»¥å‰éƒ½æ˜¯æ­£ç¡®çš„ã€‚ä½†æ˜¯ï¼Œè‹¥å¹²å¹´åçš„å‘å±•ã€‚</p>
<ul>
<li>å†…è”è¢«å®ç°äº†ï¼Œå¹¶ä¸”å¯ä»¥æ¶ˆé™¤åšä¸€ä¸ªå‡½æ•°è°ƒç”¨çš„å¼€é”€ã€‚</li>
<li>æˆ‘ä»¬å¯ä»¥ç¼–è¯‘æˆæœºå™¨ä»£ç ï¼Œæ¶ˆé™¤è§£é‡Šå¼€é”€ã€‚</li>
<li>æˆ‘ä»¬å½“æ—¶çš„å¤„å¢ƒæ˜¯ï¼Œæˆ‘ä»¬æ‰‹å¤´æœ‰ specializer çš„ç±»å‹ä¿¡æ¯ï¼Œå¯ä»¥è®©æˆ‘ä»¬æ¶ˆé™¤ C ä»£ç ä¸­çš„åˆ†æ”¯ï¼Œä½†ç”±äºæˆ‘ä»¬è°ƒç”¨çš„åªæ˜¯ä¸€ä¸ªä¸é€æ˜çš„å‡½æ•°ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•æŠ“ä½è¿™ä¸ªæœºä¼š</li>
</ul>
<p>æˆ‘è§£å†³äº†ä¸Šé¢æåˆ°çš„åˆ†é…é—®é¢˜å’Œè°ƒåº¦é—®é¢˜ï¼Œå¼•å…¥äº†ä¸€ä¸ªæ–°çš„æœºåˆ¶ï¼šspecializer æ’ä»¶ã€‚å®ƒä»¬çš„å·¥ä½œåŸç†å¦‚ä¸‹ã€‚</p>
<ul>
<li>å½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡åˆ°è¾¾å­—èŠ‚ç ä¸­çš„ä¸€ä¸ªç»™å®šçš„è°ƒç”¨ç‚¹æ—¶ï¼Œæˆ‘ä»¬å°±ä¼šè¿è¡Œè¿™ä¸ªæ’ä»¶ã€‚å®ƒäº§ç”Ÿäº†ä¸€ä¸ªè¦è°ƒç”¨çš„ä»£ç å¯¹è±¡ï¼Œä»¥åŠä¸€ç»„å®ˆå«ï¼ˆä¸ºäº†ä½¿ç”¨è¯¥ä»£ç å¯¹è±¡ç»“æœè€Œå¿…é¡»æ»¡è¶³çš„æ¡ä»¶ï¼‰ã€‚</li>
<li>ä¸‹ä¸€æ¬¡åˆ°è¾¾æ—¶ï¼Œæˆ‘ä»¬æ£€æŸ¥æ˜¯å¦æ»¡è¶³å®ˆå«ï¼Œå¦‚æœæ»¡è¶³ï¼Œå°±ç”¨ç»“æœ</li>
<li>å¦‚æœæ²¡æœ‰ï¼Œæˆ‘ä»¬å†è¿è¡Œä¸€æ¬¡æ’ä»¶ï¼Œå¹¶åœ¨ callsite å¤„å †ç§¯ä¸€ä¸ªé˜²æŠ¤é›†ã€‚</li>
<li>æˆ‘ä»¬ç»Ÿè®¡äº†ä¸€ä¸ªç»™å®šçš„é˜²æŠ¤é›†æˆåŠŸçš„é¢‘ç‡ï¼Œç„¶åå°†å…¶ç”¨äº specializer</li>
</ul>
<p>ç»å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯å•æ€çš„ï¼Œè¿™æ„å‘³ç€åªäº§ç”Ÿä¸€ç»„å®ˆå«ï¼Œè€Œä¸”ä¹‹åæ€»æ˜¯æˆåŠŸçš„ã€‚å› æ­¤ï¼Œç‰¹æ®ŠåŒ–å™¨å¯ä»¥å°†è¿™äº›å®ˆå«ç¼–è¯‘åˆ°ä¸“é—¨çš„å­—èŠ‚ç ä¸­ï¼Œç„¶åå‡è®¾ç»™å®šçš„ç›®æ ‡è°ƒç”¨è€…å°±æ˜¯å°†è¢«è°ƒç”¨çš„å®ˆå«ã€‚(è¿›ä¸€æ­¥ï¼Œé‡å¤çš„å®ˆå«å¯ä»¥è¢«æ¶ˆé™¤ï¼Œæ‰€ä»¥æŸä¸ªæ’ä»¶å¼•å…¥çš„å®ˆå«å¯èƒ½ä¼šå‡å°‘åˆ°é›¶)ã€‚</p>
<p>Specializer æ’ä»¶æ„Ÿè§‰æŒºå¥½çš„ã€‚ä¸€ä¸ªæ–°æœºåˆ¶è§£å†³äº†å¤šä¸ªä¼˜åŒ–å¤´ç–¼çš„é—®é¢˜ã€‚</p>
<p>æ–°çš„ MoarVM è°ƒåº¦æœºåˆ¶æ˜¯å¯¹ä¸€ä¸ªç›¸å½“ç®€å•çš„é—®é¢˜çš„å›ç­”ï¼šå¦‚æœæˆ‘ä»¬æŠŠæ‰€æœ‰ä¸è°ƒåº¦ç›¸å…³çš„ç‰¹ä¾‹æœºåˆ¶å»æ‰ï¼Œè€Œé‡‡ç”¨æœ‰ç‚¹åƒ specializer æ’ä»¶çš„æœºåˆ¶ï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿç”±æ­¤äº§ç”Ÿçš„æœºåˆ¶éœ€è¦æ˜¯ä¸€ä¸ªæ¯” specializer æ’ä»¶æ›´å¼ºå¤§çš„æœºåˆ¶ã€‚è¿›ä¸€æ­¥è¯´ï¼Œæˆ‘å¯ä»¥å­¦ä¹ ç‰¹æ®Šå™¨æ’ä»¶çš„ä¸€äº›ç¼ºç‚¹ã€‚å› æ­¤ï¼Œè™½ç„¶å®ƒä»¬ä¼šåœ¨æ¯”è¾ƒçŸ­çš„å¯¿å‘½åæ¶ˆå¤±ï¼Œä½†æˆ‘è®¤ä¸ºå¯ä»¥è¯´ï¼Œå¦‚æœæ²¡æœ‰è¿™äº›ç»éªŒï¼Œæˆ‘å°±ä¸ä¼šæœ‰èƒ½åŠ›è®¾è®¡æ–°çš„ MoarVM è°ƒåº¦æœºåˆ¶ã€‚</p>
<h2 id="è°ƒåº¦æ“ä½œå’Œå¼•å¯¼è°ƒåº¦å™¨">è°ƒåº¦æ“ä½œå’Œå¼•å¯¼è°ƒåº¦å™¨</h2>
<p>æ‰€æœ‰çš„æ–¹æ³•ç¼“å­˜ã€‚æ‰€æœ‰çš„å¤šé‡è°ƒåº¦ç¼“å­˜ã€‚æ‰€æœ‰çš„ specializer æ’ä»¶ã€‚æ‰€æœ‰ç”¨äºåœ¨ä»£ç å¯¹è±¡ä¸­è§£åŒ…å­—èŠ‚ç å¥æŸ„çš„è°ƒç”¨åè®®çš„ä¸œè¥¿ã€‚è¿™ä¸€åˆ‡éƒ½å°†è¢«å–æ¶ˆï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä¸€ä¸ªæ–°çš„è°ƒåº¦æŒ‡ä»¤ã€‚å®ƒçš„åå­—å¾ˆæ— èŠï¼Œå« <code>dispatch</code>ã€‚å®ƒçœ‹èµ·æ¥åƒè¿™æ ·ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="n">dispatch_o</span> <span class="nb">result</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-name</span><span class="p">&#39;</span><span class="o">,</span> <span class="n">callsite</span><span class="o">,</span> <span class="n">arg0</span><span class="o">,</span> <span class="n">arg1</span><span class="o">,</span> <span class="o">...,</span> <span class="n">argN</span>
</code></pre></div><p>è¿™æ„å‘³ç€ï¼š</p>
<ul>
<li>ä½¿ç”¨åä¸º dispatcher-name çš„è°ƒåº¦å™¨ã€‚</li>
<li>ç»™å®ƒæŒ‡å®šçš„å‚æ•°å¯„å­˜å™¨ï¼ˆæ‰€å¼•ç”¨çš„è°ƒç”¨ç‚¹è¡¨ç¤ºå‚æ•°çš„æ•°é‡ï¼‰ã€‚</li>
<li>å°†è°ƒåº¦çš„å¯¹è±¡ç»“æœæ”¾å…¥å¯„å­˜å™¨ç»“æœä¸­ã€‚</li>
</ul>
<p>(æ—ç™½ï¼šè¿™æ„å‘³ç€ä¸€ä¸ªæ–°çš„è°ƒç”¨çº¦å®šï¼Œå³æˆ‘ä»¬ä¸å†å°†å‚æ•°å¤åˆ¶åˆ°å‚æ•°ç¼“å†²åŒºï¼Œè€Œæ˜¯å°†å¯„å­˜å™¨é›†çš„åŸºæ•°å’Œä¸€ä¸ªæŒ‡é’ˆä¼ é€’åˆ°æ‰¾åˆ°å¯„å­˜å™¨å‚æ•°æ˜ å°„çš„å­—èŠ‚ç ä¸­ï¼Œç„¶ååšä¸€ä¸ªæŸ¥è¯¢ <code>registers[map[argument_index]]</code> æ¥è·å–ä¸€ä¸ªå‚æ•°çš„å€¼ã€‚ä»…æ­¤ä¸€ç‚¹ï¼Œæˆ‘ä»¬åœ¨è§£é‡Šæ—¶å°±å¾ˆçœäº‹ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å†éœ€è¦æ¯ä¸ªå‚æ•°ç»•ç€è§£é‡Šå™¨å¾ªç¯äº†ï¼‰ã€‚)</p>
<p>æœ‰äº›å‚æ•°å¯èƒ½æ˜¯æˆ‘ä»¬ä¼ ç»Ÿä¸Šç§°ä¹‹ä¸ºå‚æ•°çš„ä¸œè¥¿ã€‚æœ‰äº›åˆ™æ˜¯é’ˆå¯¹è°ƒåº¦è¿‡ç¨‹æœ¬èº«ã€‚è¿™å…¶å®å¹¶ä¸é‡è¦ - ä½†å¦‚æœæˆ‘ä»¬å®‰æ’å°†åªé’ˆå¯¹è°ƒåº¦çš„å‚æ•°æ”¾åœ¨å‰é¢ï¼ˆä¾‹å¦‚ï¼Œæ–¹æ³•åï¼‰ï¼Œè€Œå°†é’ˆå¯¹è°ƒåº¦ç›®æ ‡çš„å‚æ•°æ”¾åœ¨åé¢ï¼ˆä¾‹å¦‚ï¼Œæ–¹æ³•å‚æ•°ï¼‰ï¼Œåˆ™ä¼šæ›´åŠ ç†æƒ³ã€‚</p>
<p>æ–°çš„ bootstrap æœºåˆ¶æä¾›äº†å°‘é‡çš„å†…ç½®è°ƒåº¦å™¨ï¼Œå®ƒä»¬çš„åå­—ä»¥ &ldquo;boot-&rdquo; å¼€å¤´ã€‚å®ƒä»¬æ˜¯ï¼š</p>
<ul>
<li><code>boot-value</code> - å–ç¬¬ä¸€ä¸ªå‚æ•°å¹¶å°†å…¶ä½œä¸ºç»“æœï¼ˆèº«ä»½å‡½æ•°ï¼Œé™¤äº†ä¸¢å¼ƒä»»ä½•å…¶ä»–å‚æ•°ï¼‰ã€‚</li>
<li><code>boot-constant</code> - å–ç¬¬ä¸€ä¸ªå‚æ•°å¹¶å°†å…¶ä½œä¸ºç»“æœï¼Œä½†åŒæ—¶ä¹Ÿå°†å…¶è§†ä¸ºä¸€ä¸ªå°†å§‹ç»ˆäº§ç”Ÿçš„å¸¸é‡å€¼ï¼ˆå› æ­¤æ„å‘³ç€ä¼˜åŒ–å™¨å¯ä»¥å°†ä»»ä½•ç”¨äºè®¡ç®—è¯¥å€¼çš„çº¯ä»£ç è§†ä¸ºæ­»å€¼ï¼‰ã€‚</li>
<li><code>boot-code</code> - å–ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆå¿…é¡»æ˜¯è™šæ‹Ÿæœºå­—èŠ‚ç å¥æŸ„ï¼‰ï¼Œå¹¶è¿è¡Œè¯¥å­—èŠ‚ç ï¼Œå°†å…¶ä½™å‚æ•°ä½œä¸ºå‚æ•°ä¼ ç»™å®ƒï¼›è¯„ä¼°ä¸ºå­—èŠ‚ç çš„è¿”å›å€¼ã€‚</li>
<li><code>boot-syscall</code> - å°†ç¬¬ä¸€ä¸ªå‚æ•°è§†ä¸ºè™šæ‹Ÿæœºæä¾›çš„å†…ç½®æ“ä½œçš„åç§°ï¼Œç„¶åè°ƒç”¨å®ƒï¼Œå¹¶å°†å…¶ä½™å‚æ•°ä½œä¸ºå…¶å‚æ•°ã€‚</li>
<li><code>boot-resume</code> - æ¢å¤æ­£åœ¨è¿›è¡Œçš„æœ€ä¸Šå±‚è°ƒåº¦ã€‚</li>
</ul>
<p>å·®ä¸å¤šå°±æ˜¯è¿™æ ·ã€‚æˆ‘ä»¬æ„å»ºçš„æ¯ä¸€ä¸ªè°ƒåº¦å™¨ï¼Œä¸ºäº†æ•™ç»™è¿è¡Œæ—¶ä¸€äº›å…¶ä»–çš„è°ƒåº¦è¡Œä¸ºï¼Œæœ€ç»ˆéƒ½ä¼šç»ˆæ­¢äºå…¶ä¸­ä¸€ä¸ªã€‚</p>
<h2 id="åœ¨å¼•å¯¼ç¨‹åºçš„åŸºç¡€ä¸Š">åœ¨å¼•å¯¼ç¨‹åºçš„åŸºç¡€ä¸Š</h2>
<p>æ•™ MoarVM äº†è§£ä¸åŒç§ç±»çš„è°ƒåº¦ï¼Œä¸å¤–ä¹ä½¿ç”¨è°ƒåº¦æœºåˆ¶æœ¬èº«! åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ<code>boot-syscall</code> è¢«ç”¨æ¥æ³¨å†Œä¸€ä¸ªè°ƒåº¦å™¨ï¼Œè®¾ç½®å®ˆå«ï¼Œå¹¶æä¾›ä¸å®ƒä»¬ç›¸åŒ¹é…çš„ç»“æœã€‚</p>
<p>è¿™é‡Œæ˜¯ä¸€ä¸ªæœ€å°çš„ä¾‹å­ï¼Œå–è‡ª dispatcher æµ‹è¯•å¥—ä»¶ï¼Œå±•ç¤ºäº†ä¸€ä¸ªæä¾›åŒä¸€æ€§åŠŸèƒ½çš„ dispatcher çš„æ ·å­ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-register</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">identity</span><span class="p">&#39;</span><span class="o">,</span> <span class="k">-&gt;</span> <span class="nv">$capture</span> <span class="p">{</span>
    <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-delegate</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">boot-value</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$capture</span><span class="p">);</span>
<span class="p">});</span>
<span class="k">sub</span> <span class="nf">identity</span><span class="p">(</span><span class="nv">$x</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">identity</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$x</span><span class="p">)</span>
<span class="p">}</span>
<span class="nb">ok</span><span class="p">(</span><span class="nf">identity</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span> <span class="o">==</span> <span class="mi">42</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Can define identity dispatch (1)</span><span class="p">&#39;);</span>
<span class="nb">ok</span><span class="p">(</span><span class="nf">identity</span><span class="p">(&#39;</span><span class="s1">foo</span><span class="p">&#39;)</span> <span class="ow">eq</span> <span class="p">&#39;</span><span class="s1">foo</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Can define identity dispatch (2)</span><span class="p">&#39;);</span>
</code></pre></div><p>åœ¨ç¬¬ä¸€æ¡è¯­å¥ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨ dispatcher-register MoarVM ç³»ç»Ÿè°ƒç”¨ï¼Œä¼ é€’ä¸€ä¸ª dispatcher çš„åç§°ä»¥åŠä¸€ä¸ªé—­åŒ…ï¼Œæ¯æ¬¡æˆ‘ä»¬éœ€è¦å¤„ç†è°ƒåº¦æ—¶ï¼Œéƒ½ä¼šè°ƒç”¨è¿™ä¸ªé—­åŒ…ï¼ˆæˆ‘å€¾å‘äºå°†å…¶ç§°ä¸º&quot;è°ƒåº¦å›è°ƒ&quot;ï¼‰ã€‚å®ƒæ¥æ”¶ä¸€ä¸ªå•ä¸€çš„å‚æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªå‚æ•°çš„æ•è·ï¼ˆå…¶å®ä¸æ˜¯ Raku çº§åˆ«çš„æ•è·ï¼Œä½†æƒ³æ³• - ä¸€ä¸ªåŒ…å«ä¸€ç»„è°ƒç”¨å‚æ•°çš„å¯¹è±¡ - æ˜¯ä¸€æ ·çš„ï¼‰ã€‚</p>
<p>æ¯ä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„è°ƒåº¦å™¨æœ€ç»ˆéƒ½åº”è¯¥ä½¿ç”¨ dispatcher-delegateï¼Œä»¥ä¾¿ç¡®å®šå¦ä¸€ä¸ªè°ƒåº¦å™¨å°†æ§åˆ¶æƒä¼ é€’ç»™å®ƒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒç«‹å³å§”æ‰˜ç»™ <code>boot-value</code> - è¿™æ„å‘³ç€å®ƒé™¤äº†æ˜¯ <code>boot-value</code> å†…ç½®è°ƒåº¦å™¨çš„åŒ…è£…å™¨å¤–ï¼Œå…¶å®ä»€ä¹ˆéƒ½ä¸æ˜¯ã€‚</p>
<p>sub <code>identity</code> åŒ…å«ä¸€ä¸ªè°ƒåº¦æ“ä½œçš„é™æ€å‡ºç°ã€‚é‰´äºæˆ‘ä»¬ä¸¤æ¬¡è°ƒç”¨ subï¼Œæˆ‘ä»¬åœ¨è¿è¡Œæ—¶å°†ä¸¤æ¬¡é‡åˆ°è¿™ä¸ª opï¼Œä½†è¿™ä¸¤æ¬¡æ˜¯éå¸¸ä¸åŒçš„ã€‚</p>
<p>ç¬¬ä¸€æ¬¡æ˜¯ &ldquo;è®°å½•&rdquo; é˜¶æ®µã€‚å‚æ•°å½¢æˆä¸€ä¸ªæ•è·ï¼Œå›è°ƒè¿è¡Œï¼Œå›è°ƒåˆå°†å…¶ä¼ ç»™å¼•å¯¼å€¼è°ƒåº¦å™¨ï¼Œäº§ç”Ÿç»“æœã€‚è¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªæå…¶ç®€å•çš„è°ƒåº¦ç¨‹åºï¼Œå®ƒè¯´ç»“æœåº”è¯¥æ˜¯æ•è·ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚ç”±äºæ²¡æœ‰å®ˆå«ï¼Œæ‰€ä»¥è¿™å°†æ°¸è¿œæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ç»“æœã€‚</p>
<p>ç¬¬äºŒæ¬¡é‡åˆ°è°ƒåº¦æ“ä½œæ—¶ï¼Œå®ƒé‚£é‡Œå·²ç»è®°å½•äº†ä¸€ä¸ªè°ƒåº¦ç¨‹åºï¼Œæ‰€ä»¥æˆ‘ä»¬å¤„äºè¿è¡Œæ¨¡å¼ã€‚åœ¨ MoarVM æºç ä¸­å¼€å¯è°ƒè¯•æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç»“æœçš„è°ƒåº¦ç¨‹åºæ˜¯è¿™æ ·çš„ã€‚</p>
<pre><code>Dispatch program (1 temporaries)
  Ops:
    Load argument 0 into temporary 0
    Set result object value from temporary 0
</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå°†å‚æ•° 0 è¯»å…¥ä¸€ä¸ªä¸´æ—¶ä½ç½®ï¼Œç„¶åå°†å…¶è®¾ç½®ä¸ºè°ƒåº¦çš„ç»“æœã€‚è¯·æ³¨æ„ï¼Œæ²¡æœ‰æåˆ°æˆ‘ä»¬ç»è¿‡äº†é¢å¤–çš„ä¸€å±‚è°ƒåº¦ï¼Œè¿™äº›åœ¨ç»“æœè°ƒåº¦ç¨‹åºä¸­çš„æˆæœ¬ä¸ºé›¶ã€‚</p>
<h2 id="æ•è·æ“ä½œ">æ•è·æ“ä½œ</h2>
<p>å‚æ•°æ•è·æ˜¯ä¸å¯æ”¹å˜çš„ã€‚å„ç§è™šæ‹Ÿæœºç³»ç»Ÿè°ƒç”¨çš„å­˜åœ¨ï¼Œå¯ä»¥é€šè¿‡ä¸€äº›è°ƒæ•´å°†å®ƒä»¬è½¬åŒ–ä¸ºæ–°çš„å‚æ•°æ•è·ï¼Œä¾‹å¦‚åˆ é™¤æˆ–æ’å…¥å‚æ•°ã€‚è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæµ‹è¯•å¥—ä»¶çš„ä¾‹å­ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-register</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">drop-first</span><span class="p">&#39;</span><span class="o">,</span> <span class="k">-&gt;</span> <span class="nv">$capture</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$capture-derived</span> <span class="o">:=</span> <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-drop-arg</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$capture</span><span class="o">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-delegate</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">boot-value</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$capture-derived</span><span class="p">);</span>
<span class="p">});</span>
<span class="nb">ok</span><span class="p">(</span><span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">drop-first</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">first</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">second</span><span class="p">&#39;)</span> <span class="ow">eq</span> <span class="p">&#39;</span><span class="s1">second</span><span class="p">&#39;</span><span class="o">,</span>
    <span class="p">&#39;</span><span class="s1">dispatcher-drop-arg works</span><span class="p">&#39;);</span>
</code></pre></div><p>è¿™å°±åœ¨å°†æ•è·ä¼ é€’ç»™å¼•å¯¼å€¼è°ƒåº¦å™¨ä¹‹å‰ä¸¢å¼ƒäº†ç¬¬ä¸€ä¸ªå‚æ•° - æ„å‘³ç€å®ƒå°†è¿”å›ç¬¬äºŒä¸ªå‚æ•°ã€‚å›å¤´çœ‹ä¸€ä¸‹ä¹‹å‰çš„èº«ä»½å‡½æ•°çš„è°ƒåº¦ç¨‹åºã€‚ä½ èƒ½çŒœåˆ°è¿™ä¸ªç¨‹åºä¼šæ˜¯ä»€ä¹ˆæ ·å­å—ï¼Ÿ</p>
<p>å¥½å§ï¼Œå°±æ˜¯è¿™æ ·ã€‚</p>
<pre><code>Dispatch program (1 temporaries)
  Ops:
    Load argument 1 into temporary 0
    Set result string value from temporary 0
</code></pre><p>åŒæ ·ï¼Œè™½ç„¶åœ¨è¿™æ ·ä¸€ä¸ªè°ƒåº¦å™¨çš„è®°å½•é˜¶æ®µï¼Œæˆ‘ä»¬ç¡®å®æ˜¯åˆ›å»ºäº†æ•è·å¯¹è±¡ï¼Œå¹¶åšäº†ä¸€ä¸ªè°ƒåº¦å™¨ä»£ç†ï¼Œä½†ç”±æ­¤äº§ç”Ÿçš„è°ƒåº¦ç¨‹åºè¦ç®€å•å¾—å¤šã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹çš„ä¾‹å­ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$target</span> <span class="o">:=</span> <span class="k">-&gt;</span> <span class="nv">$x</span> <span class="p">{</span> <span class="nv">$x</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">}</span>
<span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-register</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">call-on-target</span><span class="p">&#39;</span><span class="o">,</span> <span class="k">-&gt;</span> <span class="nv">$capture</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$capture-derived</span> <span class="o">:=</span> <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span>
            <span class="p">&#39;</span><span class="s1">dispatcher-insert-arg-literal-obj</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$capture</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="nv">$target</span><span class="p">);</span>
    <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-delegate</span><span class="p">&#39;</span><span class="o">,</span>
            <span class="p">&#39;</span><span class="s1">boot-code-constant</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$capture-derived</span><span class="p">);</span>
<span class="p">});</span>
<span class="k">sub</span> <span class="nf">cot</span><span class="p">()</span> <span class="p">{</span> <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">call-on-target</span><span class="p">&#39;</span><span class="o">,</span> <span class="mi">49</span><span class="p">)</span> <span class="p">}</span>
<span class="nb">ok</span><span class="p">(</span><span class="nf">cot</span><span class="p">()</span> <span class="o">==</span> <span class="mi">50</span><span class="o">,</span>
    <span class="p">&#39;</span><span class="s1">dispatcher-insert-arg-literal-obj works at start of capture</span><span class="p">&#39;);</span>
<span class="nb">ok</span><span class="p">(</span><span class="nf">cot</span><span class="p">()</span> <span class="o">==</span> <span class="mi">50</span><span class="o">,</span>
    <span class="p">&#39;</span><span class="s1">dispatcher-insert-arg-literal-obj works at start of capture after link too</span><span class="p">&#39;);</span>
</code></pre></div><p>è¿™é‡Œï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå­˜å‚¨åœ¨å˜é‡ <code>$target</code> ä¸­çš„é—­åŒ…ã€‚æˆ‘ä»¬æŠŠå®ƒä½œä¸ºæ•è·çš„ç¬¬ä¸€ä¸ªå‚æ•°æ’å…¥ï¼Œç„¶åå§”æ‰˜ç»™ <code>boot-code-constant</code>ï¼Œå®ƒå°†è°ƒç”¨é‚£ä¸ªä»£ç å¯¹è±¡ï¼Œå¹¶æŠŠå…¶ä»–è°ƒåº¦å‚æ•°ä¼ é€’ç»™å®ƒã€‚å†æ¬¡ï¼Œåœ¨è®°å½•é˜¶æ®µï¼Œæˆ‘ä»¬çœŸæ­£è¦åšçš„äº‹æƒ…æ˜¯è¿™æ ·çš„ã€‚</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªæ–°çš„æ•è· åœ¨å¼€å§‹çš„æ—¶å€™æ’å…¥ä¸€ä¸ªä»£ç å¯¹è±¡ã€‚</li>
<li>å§”æ‰˜ç»™å¼•å¯¼ä»£ç å¸¸é‡åˆ†é…å™¨ï¼Œå®ƒ&hellip;ã€‚</li>
<li>&hellip;åœ¨æ²¡æœ‰åŸå§‹å‚æ•°çš„æƒ…å†µä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„æ•è·ï¼Œå¹¶ä½¿ç”¨è¿™äº›å‚æ•°è¿è¡Œå­—èŠ‚ç ã€‚</li>
</ul>
<p>ç”±æ­¤äº§ç”Ÿçš„è°ƒåº¦ç¨‹åºå‘¢ï¼Ÿå°±æ˜¯è¿™ä¸ª</p>
<pre><code>Dispatch program (1 temporaries)
  Ops:
    Load collectable constant at index 0 into temporary 0
    Skip first 0 args of incoming capture; callsite from 0
    Invoke MVMCode in temporary 0
</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŠ è½½æˆ‘ä»¬è¦è°ƒç”¨çš„å¸¸é‡å­—èŠ‚ç å¥æŸ„ï¼Œè®¾ç½® <code>args</code>ï¼ˆåœ¨æœ¬ä¾‹ä¸­ç­‰äºä¼ å…¥æ•è·çš„å‚æ•°ï¼‰ï¼Œç„¶åç”¨è¿™äº›å‚æ•°è°ƒç”¨å­—èŠ‚ç ã€‚å‚æ•°çš„æ´—ç‰Œï¼Œåˆä¸€æ¬¡æ¶ˆå¤±äº†ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œåªè¦æˆ‘ä»¬åšæœ€ç»ˆçš„å­—èŠ‚ç è°ƒç”¨çš„å‚æ•°æ˜¯åˆå§‹è°ƒåº¦å‚æ•°çš„å°¾å·´ï¼Œå‚æ•°è½¬æ¢å°±ä¼šå˜å¾—ä¸è¿‡æ˜¯ä¸€ä¸ªæŒ‡é’ˆçš„æ·»åŠ ã€‚</p>
<h2 id="å®ˆå«">å®ˆå«</h2>
<p>ç›®å‰çœ‹åˆ°çš„æ‰€æœ‰è°ƒåº¦æ–¹æ¡ˆéƒ½æ˜¯æ— æ¡ä»¶çš„ï¼šä¸€æ—¦åœ¨æŸä¸€é€šè¯åœ°ç‚¹è®°å½•ä¸‹æ¥ï¼Œå°±åº”ä¸€ç›´ä½¿ç”¨ã€‚è¦ä½¿è¿™æ ·çš„æœºåˆ¶å…·æœ‰å®ç”¨æ€§ï¼Œç¼ºå°‘çš„ä¸€å¤§å—å°±æ˜¯å®ˆå«ã€‚å®ˆå«æ–­è¨€äº†ä¸€äº›å±æ€§ï¼Œæ¯”å¦‚å‚æ•°çš„ç±»å‹æˆ–è€…å‚æ•°æ˜¯ç¡®å®šçš„ï¼ˆ<code>Int:D</code>ï¼‰è¿˜æ˜¯ä¸ç¡®å®šçš„ï¼ˆ<code>Int:U</code>ï¼‰ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªæœ‰ç‚¹é•¿çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå¹¶åœ¨å…¶ä¸­æ”¾ç½®äº†ä¸€äº›è§£é‡Šã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># A couple of classes for test purposes</span>
<span class="k">my</span> <span class="k">class</span> <span class="nc">C1</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">my</span> <span class="k">class</span> <span class="nc">C2</span> <span class="p">{</span> <span class="p">}</span>
 
<span class="c1"># A counter used to make sure we&#39;re only invokving the dispatch callback as</span>
<span class="c1"># many times as we expect.</span>
<span class="k">my</span> <span class="nv">$count</span> <span class="o">:=</span> <span class="mi">0</span><span class="p">;</span>
 
<span class="c1"># A type-name dispatcher that maps a type into a constant string value that</span>
<span class="c1"># is its name. This isn&#39;t terribly useful, but it is a decent small example.</span>
<span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-register</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">type-name</span><span class="p">&#39;</span><span class="o">,</span> <span class="k">-&gt;</span> <span class="nv">$capture</span> <span class="p">{</span>
    <span class="c1"># Bump the counter, just for testing purposes.</span>
    <span class="nv">$count</span><span class="o">++</span><span class="p">;</span>
 
    <span class="c1"># Obtain the value of the argument from the capture (using an existing</span>
    <span class="c1"># MoarVM op, though in the future this may go away in place of a syscall)</span>
    <span class="c1"># and then obtain the string typename also.</span>
    <span class="k">my</span> <span class="nv">$arg-val</span> <span class="o">:=</span> <span class="nf">nqp::captureposarg</span><span class="p">(</span><span class="nv">$capture</span><span class="o">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">my</span> <span class="nb">str</span> <span class="nv">$name</span> <span class="o">:=</span> <span class="nv">$arg-val</span><span class="o">.</span><span class="nb">HOW</span><span class="o">.</span><span class="nb">name</span><span class="p">(</span><span class="nv">$arg-val</span><span class="p">);</span>
 
    <span class="c1"># This outcome is only going to be valid for a particular type. We track</span>
    <span class="c1"># the argument (which gives us an object back that we can use to guard</span>
    <span class="c1"># it) and then add the type guard.</span>
    <span class="k">my</span> <span class="nv">$arg</span> <span class="o">:=</span> <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-track-arg</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$capture</span><span class="o">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-guard-type</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$arg</span><span class="p">);</span>
 
    <span class="c1"># Finally, insert the type name at the start of the capture and then</span>
    <span class="c1"># delegate to the boot-constant dispatcher.</span>
    <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-delegate</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">boot-constant</span><span class="p">&#39;</span><span class="o">,</span>
        <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-insert-arg-literal-str</span><span class="p">&#39;</span><span class="o">,</span>
            <span class="nv">$capture</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="nv">$name</span><span class="p">));</span>
<span class="p">});</span>
 
<span class="c1"># A use of the dispatch for the tests. Put into a sub so there&#39;s a single</span>
<span class="c1"># static dispatch op, which all dispatch programs will hang off.</span>
<span class="k">sub</span> <span class="nf">type-name</span><span class="p">(</span><span class="nv">$obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">type-name</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$obj</span><span class="p">)</span>
<span class="p">}</span>
 
<span class="c1"># Check with the first type, making sure the guard matches when it should</span>
<span class="c1"># (although this test would pass if the guard were ignored too).</span>
<span class="nb">ok</span><span class="p">(</span><span class="nf">type-name</span><span class="p">(</span><span class="n">C1</span><span class="p">)</span> <span class="ow">eq</span> <span class="p">&#39;</span><span class="s1">C1</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Dispatcher setting guard works</span><span class="p">&#39;);</span>
<span class="nb">ok</span><span class="p">(</span><span class="nv">$count</span> <span class="o">==</span> <span class="mi">1</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Dispatch callback ran once</span><span class="p">&#39;);</span>
<span class="nb">ok</span><span class="p">(</span><span class="nf">type-name</span><span class="p">(</span><span class="n">C1</span><span class="p">)</span> <span class="ow">eq</span> <span class="p">&#39;</span><span class="s1">C1</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Can use it another time with the same type</span><span class="p">&#39;);</span>
<span class="nb">ok</span><span class="p">(</span><span class="nv">$count</span> <span class="o">==</span> <span class="mi">1</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Dispatch callback was not run again</span><span class="p">&#39;);</span>
 
<span class="c1"># Test it with a second type, both record and run modes. This ensures the</span>
<span class="c1"># guard really is being checked.</span>
<span class="nb">ok</span><span class="p">(</span><span class="nf">type-name</span><span class="p">(</span><span class="n">C2</span><span class="p">)</span> <span class="ow">eq</span> <span class="p">&#39;</span><span class="s1">C2</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Can handle polymorphic sites when guard fails</span><span class="p">&#39;);</span>
<span class="nb">ok</span><span class="p">(</span><span class="nv">$count</span> <span class="o">==</span> <span class="mi">2</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Dispatch callback ran a second time for new type</span><span class="p">&#39;);</span>
<span class="nb">ok</span><span class="p">(</span><span class="nf">type-name</span><span class="p">(</span><span class="n">C2</span><span class="p">)</span> <span class="ow">eq</span> <span class="p">&#39;</span><span class="s1">C2</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Second call with new type works</span><span class="p">&#39;);</span>
 
<span class="c1"># Check that we can use it with the original type too, and it has stacked</span>
<span class="c1"># the dispatch programs up at the same callsite.</span>
<span class="nb">ok</span><span class="p">(</span><span class="nf">type-name</span><span class="p">(</span><span class="n">C1</span><span class="p">)</span> <span class="ow">eq</span> <span class="p">&#39;</span><span class="s1">C1</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Call with original type still works</span><span class="p">&#39;);</span>
<span class="nb">ok</span><span class="p">(</span><span class="nv">$count</span> <span class="o">==</span> <span class="mi">2</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Dispatch callback only ran a total of 2 times</span><span class="p">&#39;);</span>
</code></pre></div><p>è¿™ä¸ªæ—¶å€™å°±ä¼šäº§ç”Ÿä¸¤ä¸ªè°ƒåº¦ç¨‹åºï¼Œä¸€ä¸ªæ˜¯ C1ã€‚</p>
<pre><code>Dispatch program (1 temporaries)
  Ops:
    Guard arg 0 (type=C1)
    Load collectable constant at index 1 into temporary 0
    Set result string value from temporary 0
</code></pre><p>å¦ä¸€ä¸ªæ˜¯ C2:</p>
<pre><code>Dispatch program (1 temporaries)
  Ops:
    Guard arg 0 (type=C2)
    Load collectable constant at index 1 into temporary 0
    Set result string value from temporary 0
</code></pre><p>å†ä¸€æ¬¡ï¼Œæ²¡æœ‰æ•è·æ“ä½œã€è·Ÿè¸ªæˆ–è°ƒåº¦å™¨å§”æ‰˜çš„é—ç•™é—®é¢˜ï¼›è°ƒåº¦ç¨‹åºå¯¹ä¸€ä¸ªå‚æ•°è¿›è¡Œç±»å‹é˜²æŠ¤ï¼Œç„¶åäº§ç”Ÿç»“æœå­—ç¬¦ä¸²ã€‚æ•´ä¸ªå¯¹ <code>$arg-val.HOW.name($arg-val)</code> çš„è°ƒç”¨éƒ½è¢«çœç•¥äº†ï¼Œæˆ‘ä»¬å†™çš„è°ƒåº¦ç¨‹åºå°†çŸ¥è¯†è¿›è¡Œäº†ç¼–ç  - ä»¥è™šæ‹Ÿæœºèƒ½å¤Ÿç†è§£çš„æ–¹å¼ - ä¸€ä¸ªç±»å‹çš„åç§°å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸å¯æ”¹å˜çš„ã€‚</p>
<p>è¿™ä¸ªä¾‹å­æœ‰ç‚¹é€ ä½œï¼Œä½†ç°åœ¨è€ƒè™‘ä¸€ä¸‹ï¼Œæˆ‘ä»¬åè€Œè¦æŸ¥æ‰¾ä¸€ä¸ªæ–¹æ³•ï¼Œå¹¶åœ¨è°ƒç”¨è€…ç±»å‹ä¸Šè¿›è¡Œå®ˆå«ï¼šè¿™å°±æ˜¯ä¸€ä¸ªæ–¹æ³•ç¼“å­˜! å®ˆæŠ¤æ›´å¤šå‚æ•°çš„ç±»å‹ï¼Œæˆ‘ä»¬å°±æœ‰äº†ä¸€ä¸ªå¤šç¼“å­˜ã€‚ä¸¤è€…éƒ½åšï¼Œæˆ‘ä»¬å°±æœ‰äº†ä¸€ä¸ªå¤šæ–¹æ³•ç¼“å­˜ã€‚</p>
<p>åè€…å¾ˆæœ‰æ„æ€ï¼Œå› ä¸ºæ–¹æ³•è°ƒåº¦å’Œå¤šè°ƒåº¦éƒ½æƒ³å¯¹è°ƒç”¨è€…è¿›è¡Œå®ˆæŠ¤ã€‚äº‹å®ä¸Šï¼Œåœ¨ MoarVM ä¸­ï¼Œä»Šå¤©ä¼šæœ‰ä¸¤ä¸ªè¿™æ ·çš„ç±»å‹æµ‹è¯•ï¼Œç›´åˆ°æˆ‘ä»¬åˆ°äº†ç‰¹æ®ŠåŒ–å™¨åšå·¥ä½œå¹¶æ¶ˆé™¤è¿™äº›é‡å¤çš„å®ˆå«ã€‚ç„¶è€Œï¼Œæ–°çš„è°ƒåº¦å™¨å¹¶æ²¡æœ‰å°†è°ƒåº¦å™¨ - guard-ç±»å‹å½“ä½œä¸€ç§å‘½ä»¤å¼æ“ä½œï¼Œå°†å®ˆå«å†™å…¥ç»“æœè°ƒåº¦ç¨‹åºä¸­ã€‚ç›¸åï¼Œå®ƒå£°æ˜ç›¸å…³çš„å‚æ•°å¿…é¡»è¢«é˜²æŠ¤ã€‚å¦‚æœå…¶ä»–çš„è°ƒåº¦å™¨å·²ç»è¿™æ ·åšäº†ï¼Œé‚£å®ƒå°±æ˜¯å¹‚ç­‰çš„ã€‚ä¸€æ—¦æˆ‘ä»¬å§”æ´¾é€šè¿‡çš„æ‰€æœ‰è°ƒåº¦ç¨‹åºï¼Œåœ¨é€šå¾€æœ€ç»ˆç»“æœçš„è·¯å¾„ä¸Šï¼Œéƒ½æœ‰äº†è‡ªå·±çš„å‘è¨€æƒï¼Œå°±ä¼šå‘å‡ºå®ˆå«ã€‚</p>
<p>æœ‰è¶£çš„æ˜¯ï¼šç‰¹åˆ«ç»†å¿ƒçš„äººä¼šæ³¨æ„åˆ°ï¼Œè°ƒåº¦æœºåˆ¶ä¹Ÿè¢«ç”¨ä½œå®ç°æ–°çš„è°ƒåº¦ç¨‹åºçš„ä¸€éƒ¨åˆ†ï¼Œäº‹å®ä¸Šï¼Œè¿™æœ€ç»ˆä¹Ÿå°†æ„å‘³ç€ç‰¹æ®ŠåŒ–è€…å¯ä»¥å°†è°ƒåº¦ç¨‹åºç‰¹æ®ŠåŒ–ï¼Œè®©å®ƒä»¬ä¹Ÿè¢« JIT ç¼–è¯‘æˆæ›´é«˜æ•ˆçš„ä¸œè¥¿ã€‚æ¯•ç«Ÿï¼Œä» MoarVM çš„è§’åº¦æ¥çœ‹ï¼Œè¿™ä¸€åˆ‡éƒ½åªæ˜¯è¦è¿è¡Œçš„å­—èŠ‚ç ï¼Œåªæ˜¯æœ‰äº›å­—èŠ‚ç æ˜¯å‘Šè¯‰ VM å¦‚ä½•æ›´é«˜æ•ˆåœ°æ‰§è¡Œ Raku ç¨‹åºçš„!</p>
<h2 id="æ¢å¤è°ƒåº¦">æ¢å¤è°ƒåº¦</h2>
<p>å¯æ¢å¤è°ƒåº¦å™¨éœ€è¦åšä¸¤ä»¶äº‹ã€‚</p>
<ul>
<li>åœ¨æ³¨å†Œè°ƒåº¦å™¨çš„æ—¶å€™ï¼Œæä¾›ä¸€ä¸ªæ¢å¤å›è°ƒå’Œä¸€ä¸ªè°ƒåº¦å›è°ƒã€‚</li>
<li>åœ¨ dispatch å›è°ƒä¸­ï¼ŒæŒ‡å®šä¸€ä¸ªæ•è·ï¼Œè¿™å°†å½¢æˆæ¢å¤åˆå§‹åŒ–çŠ¶æ€ã€‚</li>
</ul>
<p>å½“å‘ç”Ÿæ¢å¤æ—¶ï¼Œå°†è°ƒç”¨æ¢å¤å›è°ƒï¼Œå¹¶æä¾›æ¢å¤çš„ä»»ä½•å‚æ•°ã€‚å®ƒè¿˜å¯ä»¥è·å¾—åœ¨ dispatch å›è°ƒä¸­è®¾ç½®çš„ resume åˆå§‹åŒ–çŠ¶æ€ã€‚resume åˆå§‹åŒ–çŠ¶æ€åŒ…å«äº†ç¬¬ä¸€æ¬¡æ¢å¤è°ƒåº¦æ—¶ç»§ç»­è¿›è¡Œè°ƒåº¦æ‰€éœ€è¦çš„ä¸œè¥¿ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ–¹æ³•è°ƒåº¦çš„å·¥ä½œåŸç†ï¼Œçœ‹ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ã€‚æˆ‘ä¹Ÿä¼šåœ¨æ­¤æ—¶ï¼Œåˆ‡æ¢åˆ°çœ‹çœŸæ­£çš„ Rakudo è°ƒåº¦å™¨ï¼Œè€Œä¸æ˜¯ç®€åŒ–çš„æµ‹è¯•ç”¨ä¾‹ã€‚</p>
<p>Rakudo è°ƒåº¦å™¨åˆ©ç”¨æˆæƒã€é‡å¤å®ˆå«å’Œæ•è·æ“ä½œéƒ½æ²¡æœ‰è¿è¡Œæ—¶æˆæœ¬çš„ä¼˜åŠ¿ï¼Œåœ¨ç»“æœè°ƒåº¦ç¨‹åºä¸­ï¼Œè‡³å°‘åœ¨æˆ‘çœ‹æ¥ï¼Œå¾ˆå¥½åœ°å› ç´ äº†ä¸€ä¸ªæœ‰äº›å¤æ‚çš„è°ƒåº¦è¿‡ç¨‹ã€‚æ–¹æ³•è°ƒåº¦æœ‰å¤šä¸ªåˆ‡å…¥ç‚¹ï¼šæ™®é€šæ— èŠçš„ <code>$obj.meth()</code>ï¼Œé™å®šçš„ <code>$obj.Type::meth()</code>ï¼Œä»¥åŠè°ƒç”¨æˆ‘ä¹Ÿè®¸ <code>$obj.?meth()</code>ã€‚è¿™äº›éƒ½æœ‰å…±åŒçš„ resume è¯­ä¹‰ - æˆ–è€…è‡³å°‘ï¼Œåªè¦æˆ‘ä»¬åœ¨ resume åˆå§‹åŒ–çŠ¶æ€ä¸­å§‹ç»ˆæºå¸¦ä¸€ä¸ªèµ·å§‹ç±»å‹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åšæ–¹æ³•è°ƒåº¦çš„å¯¹è±¡çš„ç±»å‹ï¼Œå°±å¯ä»¥ä½¿å®ƒä»¬æˆä¸ºã€‚</p>
<p>è¿™é‡Œæ˜¯æ™®é€šæ–¹æ³•è°ƒåº¦çš„åˆ‡å…¥ç‚¹ï¼Œå»æ‰äº†æŠ¥å‘Šç¼ºå¤±æ–¹æ³•é”™è¯¯çš„æ— èŠç»†èŠ‚ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># A standard method call of the form $obj.meth($arg); also used for the</span>
<span class="c1"># indirect form $obj.&#34;$name&#34;($arg). It receives the decontainerized invocant,</span>
<span class="c1"># the method name, and the the args (starting with the invocant including any</span>
<span class="c1"># container).</span>
<span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-register</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">raku-meth-call</span><span class="p">&#39;</span><span class="o">,</span> <span class="k">-&gt;</span> <span class="nv">$capture</span> <span class="p">{</span>
    <span class="c1"># Try to resolve the method call using the MOP.</span>
    <span class="k">my</span> <span class="nv">$obj</span> <span class="o">:=</span> <span class="nf">nqp::captureposarg</span><span class="p">(</span><span class="nv">$capture</span><span class="o">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">my</span> <span class="nb">str</span> <span class="nv">$name</span> <span class="o">:=</span> <span class="nf">nqp::captureposarg_s</span><span class="p">(</span><span class="nv">$capture</span><span class="o">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">my</span> <span class="nv">$meth</span> <span class="o">:=</span> <span class="nv">$obj</span><span class="o">.</span><span class="nb">HOW</span><span class="o">.</span><span class="nb">find_method</span><span class="p">(</span><span class="nv">$obj</span><span class="o">,</span> <span class="nv">$name</span><span class="p">);</span>
 
    <span class="c1"># Report an error if there is no such method.</span>
    <span class="k">unless</span> <span class="nf">nqp::isconcrete</span><span class="p">(</span><span class="nv">$meth</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">!!!</span> <span class="p">&#39;</span><span class="s1">Error reporting logic elided for brevity</span><span class="p">&#39;;</span>
    <span class="p">}</span>
 
    <span class="c1"># Establish a guard on the invocant type and method name (however the name</span>
    <span class="c1"># may well be a literal, in which case this is free).</span>
    <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-guard-type</span><span class="p">&#39;</span><span class="o">,</span>
        <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-track-arg</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$capture</span><span class="o">,</span> <span class="mi">0</span><span class="p">));</span>
    <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-guard-literal</span><span class="p">&#39;</span><span class="o">,</span>
        <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-track-arg</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$capture</span><span class="o">,</span> <span class="mi">1</span><span class="p">));</span>
 
    <span class="c1"># Add the resolved method and delegate to the resolved method dispatcher.</span>
    <span class="k">my</span> <span class="nv">$capture-delegate</span> <span class="o">:=</span> <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span>
        <span class="p">&#39;</span><span class="s1">dispatcher-insert-arg-literal-obj</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$capture</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="nv">$meth</span><span class="p">);</span>
    <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-delegate</span><span class="p">&#39;</span><span class="o">,</span>
        <span class="p">&#39;</span><span class="s1">raku-meth-call-resolved</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$capture-delegate</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div><p>ç°åœ¨æ˜¯è§£ææ–¹æ³• dispatcherï¼Œä¹Ÿå°±æ˜¯å¤„ç†æ¢å¤çš„åœ°æ–¹ã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æ­£å¸¸çš„ dispatch å›è°ƒï¼ˆæ¢å¤å›è°ƒæ˜¯åŒ…å«çš„ï¼Œä½†æ˜¯æ˜¯ç©ºçš„ï¼Œæˆ‘ç¨åä¼šå±•ç¤ºå®ƒï¼‰ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># Resolved method call dispatcher. This is used to call a method, once we have</span>
<span class="c1"># already resolved it to a callee. Its first arg is the callee, the second and</span>
<span class="c1"># third are the type and name (used in deferral), and the rest are the args to</span>
<span class="c1"># the method.</span>
<span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-register</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">raku-meth-call-resolved</span><span class="p">&#39;</span><span class="o">,</span>
    <span class="c1"># Initial dispatch</span>
    <span class="k">-&gt;</span> <span class="nv">$capture</span> <span class="p">{</span>
        <span class="c1"># Save dispatch state for resumption. We don&#39;t need the method that will</span>
        <span class="c1"># be called now, so drop it.</span>
        <span class="k">my</span> <span class="nv">$resume-capture</span> <span class="o">:=</span> <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-drop-arg</span><span class="p">&#39;</span><span class="o">,</span>
            <span class="nv">$capture</span><span class="o">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-set-resume-init-args</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$resume-capture</span><span class="p">);</span>
 
        <span class="c1"># Drop the dispatch start type and name, and delegate to multi-dispatch or</span>
        <span class="c1"># just invoke if it&#39;s single dispatch.</span>
        <span class="k">my</span> <span class="nv">$delegate_capture</span> <span class="o">:=</span> <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-drop-arg</span><span class="p">&#39;</span><span class="o">,</span>
            <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-drop-arg</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$capture</span><span class="o">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">my</span> <span class="nv">$method</span> <span class="o">:=</span> <span class="nf">nqp::captureposarg</span><span class="p">(</span><span class="nv">$delegate_capture</span><span class="o">,</span> <span class="mi">0</span><span class="p">);</span>
        <span class="k">if</span> <span class="nf">nqp::istype</span><span class="p">(</span><span class="nv">$method</span><span class="o">,</span> <span class="nb">Routine</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$method</span><span class="o">.</span><span class="nf">is_dispatcher</span> <span class="p">{</span>
            <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-delegate</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">raku-multi</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$delegate_capture</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-delegate</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">raku-invoke</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$delegate_capture</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span><span class="o">,</span>
    <span class="c1"># Resumption</span>
    <span class="k">-&gt;</span> <span class="nv">$capture</span> <span class="p">{</span>
        <span class="o">...</span> <span class="p">&#39;</span><span class="s1">Will be shown later</span><span class="p">&#39;;</span>
    <span class="p">});</span>
</code></pre></div><p>raku-meth-call ä¸­æœ‰ä¸€ä¸ªå¯ä»¥è®ºè¯çš„æ¬ºéª—ï¼šå®ƒå®é™…ä¸Šå¹¶æ²¡æœ‰æ’å…¥è°ƒç”¨è€…çš„ç±»å‹å¯¹è±¡æ¥ä»£æ›¿è°ƒç”¨è€…ã€‚äº‹å®è¯æ˜ï¼Œè¿™å¹¶ä¸é‡è¦ã€‚å¦åˆ™ï¼Œæˆ‘è®¤ä¸ºæ³¨é‡Šï¼ˆåœ¨çœŸæ­£çš„å®ç°ä¸­ä¹Ÿå¯ä»¥æ‰¾åˆ°ï¼‰å¾ˆå¥½åœ°è¯´æ˜äº†è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>æœ‰ä¸€ä¸ªé‡è¦çš„ç‚¹å¯èƒ½å¹¶ä¸æ¸…æ¥š - ä½†éµå¾ªäº†ä¸€ä¸ªé‡å¤çš„ä¸»é¢˜ - é‚£å°±æ˜¯æ¢å¤åˆå§‹åŒ–çŠ¶æ€çš„è®¾ç½®ä¹Ÿæ›´å¤šçš„æ˜¯ä¸€ç§å£°æ˜å¼è€Œä¸æ˜¯å‘½ä»¤å¼çš„ä¸œè¥¿ï¼šåœ¨è°ƒåº¦çš„æ—¶å€™å¹¶æ²¡æœ‰è¿è¡Œæ—¶æˆæœ¬ï¼Œè€Œæ˜¯æˆ‘ä»¬åœ¨å‘¨å›´ä¿ç•™äº†è¶³å¤Ÿçš„ä¿¡æ¯ï¼Œä»¥ä¾¿èƒ½å¤Ÿåœ¨æˆ‘ä»¬éœ€è¦çš„æ—¶å€™é‡å»ºæ¢å¤åˆå§‹åŒ–çŠ¶æ€ã€‚äº‹å®ä¸Šï¼Œå½“æˆ‘ä»¬å¤„äºæ¢å¤çš„è¿è¡Œé˜¶æ®µæ—¶ï¼Œæˆ‘ä»¬ç”šè‡³ä¸éœ€è¦åœ¨åˆ›å»ºæ•è·å¯¹è±¡çš„æ„ä¹‰ä¸Šé‡å»ºå®ƒï¼‰ã€‚</p>
<p>ç°åœ¨è¯´è¯´å¤ç›˜ã€‚æˆ‘å°†ä»‹ç»ä¸€ä¸ªä¸¥é‡ç®€åŒ–çš„ç‰ˆæœ¬ï¼Œå®ƒåªå¤„ç† callsame è¯­ä¹‰ï¼ˆå®Œæ•´çš„ä¸œè¥¿ä¹Ÿè¦å¤„ç† lastcall å’Œ nextcallee è¿™æ ·çš„ä¹è¶£ï¼‰ã€‚resume åˆå§‹åŒ–çŠ¶æ€çš„å­˜åœ¨æ˜¯ä¸ºäº†ç»™ resumption è¿‡ç¨‹æ’­ç§ã€‚ä¸€æ—¦æˆ‘ä»¬çŸ¥é“æˆ‘ä»¬å®é™…ä¸Šç¡®å®è¦å¤„ç†æ¢å¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥åšä¸€äº›äº‹æƒ…ï¼Œæ¯”å¦‚è®¡ç®—æˆ‘ä»¬æƒ³è¦èµ°è¿‡çš„ç»§æ‰¿å›¾ä¸­çš„å…¨éƒ¨æ–¹æ³•åˆ—è¡¨ã€‚æ¯ä¸ªå¯æ¢å¤çš„è°ƒåº¦å™¨åœ¨è°ƒç”¨æ ˆä¸Šå¾—åˆ°ä¸€ä¸ªå•ä¸€çš„å­˜å‚¨æ§½ï¼Œå®ƒå¯ä»¥ç”¨äºå®ƒçš„çŠ¶æ€ã€‚å®ƒå¯ä»¥åœ¨æ¢å¤çš„ç¬¬ä¸€æ­¥ä¸­åˆå§‹åŒ–è¿™ä¸ªï¼Œç„¶ååœ¨æˆ‘ä»¬èµ°çš„æ—¶å€™æ›´æ–°å®ƒã€‚æˆ–è€…æ›´å‡†ç¡®çš„è¯´ï¼Œå®ƒå¯ä»¥è®¾ç½®ä¸€ä¸ªè°ƒåº¦ç¨‹åºï¼Œåœ¨è¿è¡Œæ—¶å°±ä¼šè¿™æ ·åšã€‚</p>
<p>å¯¹äºæˆ‘ä»¬å°†è¦èµ°è¿‡çš„å€™é€‰é“¾æ¥è¯´ï¼Œé“¾æ¥åˆ—è¡¨åŸæ¥æ˜¯ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„æ•°æ®ç»“æ„ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è·Ÿè¸ªå½“å‰èŠ‚ç‚¹æ¥å®Œæˆé“¾æ¥åˆ—è¡¨çš„å·¥ä½œï¼Œä¹Ÿå°±æ˜¯è¯´åªéœ€è¦æœ‰ä¸€ä¸ªä¸œè¥¿å‘ç”Ÿçªå˜ï¼Œä¹Ÿå°±æ˜¯å½“å‰è°ƒåº¦çš„çŠ¶æ€ã€‚è°ƒåº¦ç¨‹åºæœºåˆ¶è¿˜æä¾›äº†ä¸€ç§ä»å¯¹è±¡ä¸­è¯»å–å±æ€§çš„æ–¹æ³•ï¼Œè¿™å°±è¶³ä»¥å°†éå†é“¾æ¥åˆ—è¡¨è¡¨è¾¾åˆ°è°ƒåº¦ç¨‹åºä¸­ã€‚è¿™ä¹Ÿæ„å‘³ç€é›¶åˆ†é…ã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸å¤šè¯´äº†ï¼Œä¸‹é¢æ˜¯é“¾æ¥åˆ—è¡¨ï¼ˆåœ¨ NQP è¿™ä¸ªå—é™çš„ Raku å­é›†ä¸­ï¼Œç›¸å½“ä¸å¦‚åœ¨å®Œæ•´çš„ Raku ä¸­æ¼‚äº®ï¼‰ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># A linked list is used to model the state of a dispatch that is deferring</span>
<span class="c1"># through a set of methods, multi candidates, or wrappers. The Exhausted class</span>
<span class="c1"># is used as a sentinel for the end of the chain. The current state of the</span>
<span class="c1"># dispatch points into the linked list at the appropriate point; the chain</span>
<span class="c1"># itself is immutable, and shared over (runtime) dispatches.</span>
<span class="k">my</span> <span class="k">class</span> <span class="nc">DeferralChain</span> <span class="p">{</span>
    <span class="k">has</span> <span class="nv">$!code</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">$!next</span><span class="p">;</span>
    <span class="k">method</span> <span class="nb">new</span><span class="p">(</span><span class="nv">$code</span><span class="o">,</span> <span class="nv">$next</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">my</span> <span class="nv">$obj</span> <span class="o">:=</span> <span class="nf">nqp::create</span><span class="p">(</span><span class="nb">self</span><span class="p">);</span>
        <span class="nf">nqp::bindattr</span><span class="p">(</span><span class="nv">$obj</span><span class="o">,</span> <span class="n">DeferralChain</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">$!code</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$code</span><span class="p">);</span>
        <span class="nf">nqp::bindattr</span><span class="p">(</span><span class="nv">$obj</span><span class="o">,</span> <span class="n">DeferralChain</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">$!next</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$next</span><span class="p">);</span>
        <span class="nv">$obj</span>
    <span class="p">}</span>
    <span class="k">method</span> <span class="nb">code</span><span class="p">()</span> <span class="p">{</span> <span class="nv">$!code</span> <span class="p">}</span>
    <span class="k">method</span> <span class="nb">next</span><span class="p">()</span> <span class="p">{</span> <span class="nv">$!next</span> <span class="p">}</span>
<span class="p">};</span>
<span class="k">my</span> <span class="k">class</span> <span class="nc">Exhausted</span> <span class="p">{};</span>
</code></pre></div><p>æœ€åæ˜¯æ¢å¤å¤„ç†ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-register</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">raku-meth-call-resolved</span><span class="p">&#39;</span><span class="o">,</span>
    <span class="c1"># Initial dispatch</span>
    <span class="k">-&gt;</span> <span class="nv">$capture</span> <span class="p">{</span>
        <span class="o">...</span> <span class="p">&#39;</span><span class="s1">Presented earlier;
</span><span class="s1">    },
</span><span class="s1">    # Resumption. The resume init capture</span><span class="p">&#39;</span><span class="k">s</span> <span class="err">first</span> <span class="err">two</span> <span class="err">arguments</span> <span class="err">are</span> <span class="err">the</span> <span class="err">type</span>
    <span class="p">#</span><span class="sr"> that we initially did a method dispatch against and the method name
</span><span class="sr">    </span><span class="p">#</span><span class="s2"> respectively.
</span><span class="s2">    -&gt; </span><span class="nv">$capture</span><span class="s2"> {
</span><span class="s2">        </span><span class="p">#</span> <span class="n">Work</span> <span class="n">out</span> <span class="n">the</span> <span class="nb">next</span> <span class="k">method</span> <span class="nb">to</span> <span class="n">call</span><span class="o">,</span> <span class="k">if</span> <span class="nb">any</span><span class="o">.</span> <span class="n">This</span> <span class="n">depends</span> <span class="n">on</span> <span class="k">if</span> <span class="n">we</span> <span class="n">have</span>
        <span class="c1"># an existing dispatch state (that is, a method deferral is already in</span>
        <span class="c1"># progress).</span>
        <span class="k">my</span> <span class="nv">$init</span> <span class="o">:=</span> <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-get-resume-init-args</span><span class="p">&#39;);</span>
        <span class="k">my</span> <span class="nv">$state</span> <span class="o">:=</span> <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-get-resume-state</span><span class="p">&#39;);</span>
        <span class="k">my</span> <span class="nv">$next_method</span><span class="p">;</span>
        <span class="k">if</span> <span class="nf">nqp::isnull</span><span class="p">(</span><span class="nv">$state</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1"># No state, so just starting the resumption. Guard on the</span>
            <span class="c1"># invocant type and name.</span>
            <span class="k">my</span> <span class="nv">$track_start_type</span> <span class="o">:=</span> <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-track-arg</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$init</span><span class="o">,</span> <span class="mi">0</span><span class="p">);</span>
            <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-guard-type</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$track_start_type</span><span class="p">);</span>
            <span class="k">my</span> <span class="nv">$track_name</span> <span class="o">:=</span> <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-track-arg</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$init</span><span class="o">,</span> <span class="mi">1</span><span class="p">);</span>
            <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-guard-literal</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$track_name</span><span class="p">);</span>
 
            <span class="c1"># Also guard on there being no dispatch state.</span>
            <span class="k">my</span> <span class="nv">$track_state</span> <span class="o">:=</span> <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-track-resume-state</span><span class="p">&#39;);</span>
            <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-guard-literal</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$track_state</span><span class="p">);</span>
 
            <span class="c1"># Build up the list of methods to defer through.</span>
            <span class="k">my</span> <span class="nv">$start_type</span> <span class="o">:=</span> <span class="nf">nqp::captureposarg</span><span class="p">(</span><span class="nv">$init</span><span class="o">,</span> <span class="mi">0</span><span class="p">);</span>
            <span class="k">my</span> <span class="nb">str</span> <span class="nv">$name</span> <span class="o">:=</span> <span class="nf">nqp::captureposarg_s</span><span class="p">(</span><span class="nv">$init</span><span class="o">,</span> <span class="mi">1</span><span class="p">);</span>
            <span class="k">my</span> <span class="nv">@mro</span> <span class="o">:=</span> <span class="nf">nqp::can</span><span class="p">(</span><span class="nv">$start_type</span><span class="o">.</span><span class="nb">HOW</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">mro_unhidden</span><span class="p">&#39;)</span>
                <span class="o">??</span> <span class="nv">$start_type</span><span class="o">.</span><span class="nb">HOW</span><span class="o">.</span><span class="nf">mro_unhidden</span><span class="p">(</span><span class="nv">$start_type</span><span class="p">)</span>
                <span class="o">!!</span> <span class="nv">$start_type</span><span class="o">.</span><span class="nb">HOW</span><span class="o">.</span><span class="nb">mro</span><span class="p">(</span><span class="nv">$start_type</span><span class="p">);</span>
            <span class="k">my</span> <span class="nv">@methods</span><span class="p">;</span>
            <span class="k">for</span> <span class="nv">@mro</span> <span class="p">{</span>
                <span class="k">my</span> <span class="nv">%mt</span> <span class="o">:=</span> <span class="nf">nqp::hllize</span><span class="p">(</span><span class="nv">$_</span><span class="o">.</span><span class="nb">HOW</span><span class="o">.</span><span class="nb">method_table</span><span class="p">(</span><span class="nv">$_</span><span class="p">));</span>
                <span class="k">if</span> <span class="nf">nqp::existskey</span><span class="p">(</span><span class="nv">%mt</span><span class="o">,</span> <span class="nv">$name</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">@methods</span><span class="o">.</span><span class="nb">push</span><span class="p">(</span><span class="nv">%mt</span><span class="p">{</span><span class="nv">$name</span><span class="p">});</span>
                <span class="p">}</span>
            <span class="p">}</span>
 
            <span class="c1"># If there&#39;s nothing to defer to, we&#39;ll evaluate to Nil (just don&#39;t set</span>
            <span class="c1"># the next method, and it happens below).</span>
            <span class="k">if</span> <span class="nf">nqp::elems</span><span class="p">(</span><span class="nv">@methods</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="p">{</span>
                <span class="c1"># We can defer. Populate next method.</span>
                <span class="nv">@methods</span><span class="o">.</span><span class="nb">shift</span><span class="p">;</span> <span class="c1"># Discard the first one, which we initially called</span>
                <span class="nv">$next_method</span> <span class="o">:=</span> <span class="nv">@methods</span><span class="o">.</span><span class="nb">shift</span><span class="p">;</span> <span class="c1"># The immediate next one</span>
 
                <span class="c1"># Build chain of further methods and set it as the state.</span>
                <span class="k">my</span> <span class="nv">$chain</span> <span class="o">:=</span> <span class="n">Exhausted</span><span class="p">;</span>
                <span class="k">while</span> <span class="nv">@methods</span> <span class="p">{</span>
                    <span class="nv">$chain</span> <span class="o">:=</span> <span class="n">DeferralChain</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="nv">@methods</span><span class="o">.</span><span class="nb">pop</span><span class="o">,</span> <span class="nv">$chain</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-set-resume-state-literal</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$chain</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">elsif</span> <span class="o">!</span><span class="nf">nqp::istype</span><span class="p">(</span><span class="nv">$state</span><span class="o">,</span> <span class="n">Exhausted</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1"># Already working through a chain of method deferrals. Obtain</span>
            <span class="c1"># the tracking object for the dispatch state, and guard against</span>
            <span class="c1"># the next code object to run.</span>
            <span class="k">my</span> <span class="nv">$track_state</span> <span class="o">:=</span> <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-track-resume-state</span><span class="p">&#39;);</span>
            <span class="k">my</span> <span class="nv">$track_method</span> <span class="o">:=</span> <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-track-attr</span><span class="p">&#39;</span><span class="o">,</span>
                <span class="nv">$track_state</span><span class="o">,</span> <span class="n">DeferralChain</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">$!code</span><span class="p">&#39;);</span>
            <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-guard-literal</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$track_method</span><span class="p">);</span>
 
            <span class="c1"># Update dispatch state to point to next method.</span>
            <span class="k">my</span> <span class="nv">$track_next</span> <span class="o">:=</span> <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-track-attr</span><span class="p">&#39;</span><span class="o">,</span>
                <span class="nv">$track_state</span><span class="o">,</span> <span class="n">DeferralChain</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">$!next</span><span class="p">&#39;);</span>
            <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-set-resume-state</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$track_next</span><span class="p">);</span>
 
            <span class="c1"># Set next method, which we shall defer to.</span>
            <span class="nv">$next_method</span> <span class="o">:=</span> <span class="nv">$state</span><span class="o">.</span><span class="nb">code</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="c1"># Dispatch already exhausted; guard on that and fall through to returning</span>
            <span class="c1"># Nil.</span>
            <span class="k">my</span> <span class="nv">$track_state</span> <span class="o">:=</span> <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-track-resume-state</span><span class="p">&#39;);</span>
            <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-guard-literal</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$track_state</span><span class="p">);</span>
        <span class="p">}</span>
 
        <span class="c1"># If we found a next method...</span>
        <span class="k">if</span> <span class="nf">nqp::isconcrete</span><span class="p">(</span><span class="nv">$next_method</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1"># Call with same (that is, original) arguments. Invoke with those.</span>
            <span class="c1"># We drop the first two arguments (which are only there for the</span>
            <span class="c1"># resumption), add the code object to invoke, and then leave it</span>
            <span class="c1"># to the invoke or multi dispatcher.</span>
            <span class="k">my</span> <span class="nv">$just_args</span> <span class="o">:=</span> <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-drop-arg</span><span class="p">&#39;</span><span class="o">,</span>
                <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-drop-arg</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$init</span><span class="o">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">,</span>
                <span class="mi">0</span><span class="p">);</span>
            <span class="k">my</span> <span class="nv">$delegate_capture</span> <span class="o">:=</span> <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span>
                <span class="p">&#39;</span><span class="s1">dispatcher-insert-arg-literal-obj</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$just_args</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="nv">$next_method</span><span class="p">);</span>
            <span class="k">if</span> <span class="nf">nqp::istype</span><span class="p">(</span><span class="nv">$next_method</span><span class="o">,</span> <span class="nb">Routine</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$next_method</span><span class="o">.</span><span class="nf">is_dispatcher</span> <span class="p">{</span>
                <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-delegate</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">raku-multi</span><span class="p">&#39;</span><span class="o">,</span>
                        <span class="nv">$delegate_capture</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-delegate</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">raku-invoke</span><span class="p">&#39;</span><span class="o">,</span>
                        <span class="nv">$delegate_capture</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="c1"># No method, so evaluate to Nil (boot-constant disregards all but</span>
            <span class="c1"># the first argument).</span>
            <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-delegate</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">boot-constant</span><span class="p">&#39;</span><span class="o">,</span>
                <span class="nf">nqp::dispatch</span><span class="p">(&#39;</span><span class="s1">boot-syscall</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">dispatcher-insert-arg-literal-obj</span><span class="p">&#39;</span><span class="o">,</span>
                    <span class="nv">$capture</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="nb">Nil</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">});</span>
</code></pre></div><p>è¿™æ˜¯ç›¸å½“å¤šçš„å†…å®¹ï¼Œä¹Ÿæ˜¯ç›¸å½“å¤šçš„ä»£ç ã€‚ä½†è¯·è®°ä½ï¼Œè¿™åªæ˜¯è¿è¡Œåœ¨è°ƒåº¦æ¢å¤çš„è®°å½•é˜¶æ®µã€‚å®ƒè¿˜ä¼šåœ¨ callsame çš„ callsite äº§ç”Ÿä¸€ä¸ªè°ƒåº¦ç¨‹åºï¼Œå¹¶å¸¦æœ‰é€šå¸¸çš„å®ˆå«å’Œç»“æœã€‚éšå¼å®ˆå«æ˜¯ä¸ºæˆ‘ä»¬åœ¨è¯¥ç‚¹æ¢å¤çš„è°ƒåº¦ç¨‹åºåˆ›å»ºçš„ã€‚åœ¨æœ€å¸¸è§çš„æƒ…å†µä¸‹ï¼Œè¿™æœ€ç»ˆå°†æ˜¯å•å½¢æˆ–åŒå½¢çš„ï¼Œå°½ç®¡æ¶‰åŠå¤šä¸ªè°ƒåº¦æˆ–æ–¹æ³•è°ƒåº¦çš„åµŒå¥—çš„æƒ…å†µå¯èƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ›´æœ‰å½¢æ€çš„ callsiteã€‚</p>
<p>æˆ‘é€‰å–çš„è®¾è®¡è¿«ä½¿ resume å›è°ƒå¤„ç†ä¸¤ç§æƒ…å†µï¼šç¬¬ä¸€æ¬¡å¤ç”¨å’Œåä¸€æ¬¡å¤ç”¨ã€‚è¿™åœ¨å‡ ä¸ªæ–¹é¢éƒ½ä¸ç†æƒ³ã€‚</p>
<p>è¿™å¯¹é‚£äº›ç¼–å†™è°ƒåº¦ç®€å†å›è°ƒçš„äººæ¥è¯´æœ‰ç‚¹ä¸æ–¹ä¾¿ã€‚ç„¶è€Œï¼Œè¿™åˆä¸æ˜¯ç‰¹åˆ«å¸¸è§çš„æ´»åŠ¨!</p>
<p>è¿™ç§å·®å¼‚å¯¼è‡´ä¸¤ä¸ªè°ƒåº¦ç¨‹åºå †ç§¯åœ¨ä¸€ä¸ªè°ƒç”¨ç‚¹ï¼Œè€Œåœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œè¿™ä¸ªè°ƒç”¨ç‚¹å¯èƒ½åªå¾—åˆ°ä¸€ä¸ª
åªæœ‰å…¶ä¸­ç¬¬äºŒé¡¹çœŸæ­£é‡è¦ã€‚ä¹‹æ‰€ä»¥ä¸ç»Ÿä¸€ï¼Œæ˜¯ä¸ºäº†ç¡®ä¿ç»å¤§å¤šæ•°ä»æœªæ¢å¤è°ƒåº¦çš„ç”µè¯ï¼Œä¸ä¼šå› å…¶æœ€ç»ˆä»æœªä½¿ç”¨çš„åŠŸèƒ½è€Œäº§ç”Ÿæ¯æ¬¡è°ƒåº¦çš„è´¹ç”¨ã€‚å¦‚æœç»“æœæ˜¯ä½¿ç”¨è¯¥åŠŸèƒ½çš„äººå¤šèŠ±äº†ä¸€ç‚¹æˆæœ¬ï¼Œé‚£å°±è¿™æ ·å§ã€‚äº‹å®ä¸Šï¼Œæ—©æœŸçš„åŸºå‡†æµ‹è¯•æ˜¾ç¤ºï¼Œä½¿ç”¨æ–°è°ƒåº¦å™¨çš„ callsame ä¸ wrap å’Œæ–¹æ³•è°ƒç”¨ä¼¼ä¹æ¯”å½“å‰ Rakudo ä¸­çš„é€Ÿåº¦å¿«äº† 10 å€ï¼Œè¿™è¿˜æ²¡ç­‰ä¸“é—¨äººå‘˜å¯¹å®ƒæœ‰è¶³å¤Ÿçš„äº†è§£ï¼Œå°±å·²ç»è¿›ä¸€æ­¥æ”¹è¿›äº†!</p>
<h2 id="ç›®å‰æ‰€åšçš„äº‹æƒ…">ç›®å‰æ‰€åšçš„äº‹æƒ…</h2>
<p>æˆ‘ä¸Šé¢è®¨è®ºçš„æ‰€æœ‰å†…å®¹éƒ½å·²ç»å®ç°äº†ï¼Œåªæ˜¯æˆ‘å¯èƒ½åœ¨æŸä¸ªåœ°æ–¹ç»™äººçš„å°è±¡æ˜¯ï¼Œä½¿ç”¨æ–°çš„ dispatcher å·²ç»å®Œå…¨å®ç°äº†å¤šé‡è°ƒåº¦ï¼Œè€Œç°åœ¨è¿˜ä¸æ˜¯è¿™æ ·ï¼ˆæ²¡æœ‰å¤„ç† where å­å¥ï¼Œä¹Ÿä¸æ”¯æŒè°ƒåº¦æ¢å¤ï¼‰ã€‚</p>
<h2 id="ä»Šåçš„æ­¥éª¤">ä»Šåçš„æ­¥éª¤</h2>
<p>ä¸‹ä¸€æ­¥æ˜¾ç„¶æ˜¯è¦å®Œå…¨å®ç°å¤šè°ƒåº¦çš„ç¼ºå¤±éƒ¨åˆ†ã€‚å¦ä¸€ä¸ªç¼ºå¤±çš„è¯­ä¹‰æ˜¯å¯¹ callwith å’Œ nextwith çš„æ”¯æŒï¼Œå½“æˆ‘ä»¬å¸Œæœ›æ”¹å˜ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå€™é€‰äººæ—¶ä½¿ç”¨çš„å‚æ•°ã€‚æŠ›å¼€å…¶ä»–ä¸€äº›å°é—®é¢˜ä¸è°ˆï¼Œç†è®ºä¸Šæ¥è¯´ï¼Œè¿™è‡³å°‘å¯ä»¥è®©æ‰€æœ‰çš„ Raku è°ƒåº¦è¯­ä¹‰å¾—åˆ°æ”¯æŒã€‚</p>
<p>ç›®å‰ï¼Œæ‰€æœ‰çš„æ ‡å‡†æ–¹æ³•è°ƒç”¨ï¼ˆ$obj.meth()ï¼‰å’Œå…¶ä»–è°ƒç”¨ï¼ˆfoo()å’Œ$foo()ï¼‰éƒ½ä¼šé€šè¿‡ç°æœ‰çš„è°ƒåº¦æœºåˆ¶ï¼Œè€Œä¸æ˜¯æ–°çš„è°ƒåº¦å™¨ã€‚è¿™äº›ä¹Ÿéœ€è¦è¿ç§»åˆ°æ–°çš„è°ƒåº¦å™¨ä¸Šï¼Œè€Œä¸”ä»»ä½•å‘ç°çš„é”™è¯¯éƒ½éœ€è¦ä¿®å¤ã€‚è¿™å°†ä½¿äº‹æƒ…è¾¾åˆ°æ–°è°ƒåº¦å™¨åœ¨è¯­ä¹‰ä¸Šå·²ç»å‡†å¤‡å¥½çš„ç¨‹åº¦ã€‚</p>
<p>ä¹‹åæ˜¯æ€§èƒ½å·¥ä½œï¼šç¡®ä¿ä¸“ç”¨å™¨èƒ½å¤Ÿå¤„ç†è°ƒåº¦ç¨‹åºçš„é˜²æŠ¤å’Œç»“æœã€‚æœ€åˆçš„ç›®æ ‡æ˜¯ï¼Œè®©å¸¸è§è°ƒç”¨å½¢å¼çš„ç¨³æ€æ€§èƒ½è‡³å°‘ä¸å½“å‰ä¹é“ä¸»åˆ†æ”¯ä¸­çš„æ€§èƒ½ç›¸åŒã€‚å·²ç»å¾ˆæ¸…æ¥šäº†ï¼Œå¯¹äºä¸€äº›åˆ°ç›®å‰ä¸ºæ­¢è¿˜å¾ˆå†°å†·çš„ä¸œè¥¿æ¥è¯´ï¼Œä¼šæœ‰ä¸€äº›å¤§çš„èƒœåˆ©ï¼Œä½†å®ƒä¸åº”è¯¥ä»¥æœ€å¸¸è§çš„è°ƒåº¦ç§ç±»çš„é€€æ­¥ä¸ºä»£ä»·ï¼Œå› ä¸ºè¿™äº›è°ƒåº¦ç§ç±»ä¹‹å‰å·²ç»å¾—åˆ°äº†å¤§é‡çš„ä¼˜åŒ–åŠªåŠ›ã€‚</p>
<p>æ­¤å¤–ï¼ŒNQP - ä¹é“ç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶å†…è„çš„å…¶ä»–ä½å†™çš„ä¹çš„é™åˆ¶å½¢å¼ - ä¹Ÿéœ€è¦è¿ç§»åˆ°ä½¿ç”¨æ–°çš„è°ƒåº¦å™¨ã€‚åªæœ‰åšåˆ°è¿™ä¸€ç‚¹ï¼Œæ‰æœ‰å¯èƒ½ä» MoarVM ä¸­æ‰¯å‡ºå½“å‰çš„æ–¹æ³•ç¼“å­˜ã€å¤šè°ƒåº¦ç¼“å­˜ç­‰ã€‚</p>
<p>ä¸€ä¸ªæ‚¬è€Œæœªå†³çš„é—®é¢˜æ˜¯ï¼Œå¦‚ä½•å¤„ç† MoarVM ä»¥å¤–çš„åç«¯ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæ–°çš„è°ƒåº¦æœºåˆ¶å°†è¢«ç§»æ¤åˆ°è¿™äº›åœ°æ–¹ã€‚ç›¸å½“å¤šçš„å†…å®¹åº”è¯¥å¯ä»¥ç”¨ JVM çš„ invokedynamic æ¥è¡¨è¾¾ï¼ˆè€Œè¿™ä¸€åˆ‡å¯èƒ½ä¼šåœ¨åŸºäº Truffle çš„ Raku å®ç°ä¸­å‘æŒ¥å¾—ç›¸å½“å¥½ï¼Œå°½ç®¡æˆ‘ä¸ç¡®å®šç›®å‰æ˜¯å¦æœ‰è¿™æ–¹é¢çš„ç§¯æåŠªåŠ›ï¼‰ã€‚</p>
<h2 id="æœªæ¥çš„æœºä¼š">æœªæ¥çš„æœºä¼š</h2>
<p>è™½ç„¶æˆ‘ç›®å‰çš„é‡ç‚¹æ˜¯å‘å¸ƒä¸€ä¸ªä½¿ç”¨æ–°è°ƒåº¦æœºåˆ¶çš„ Rakudo å’Œ MoarVM ç‰ˆæœ¬ï¼Œä½†è¿™ä¸ä¼šæ˜¯æ—…ç¨‹çš„ç»ˆç‚¹ã€‚ä¸€äº›çœ¼å‰çš„æƒ³æ³•ã€‚</p>
<ul>
<li>å¯¹è§’è‰²çš„æ–¹æ³•è°ƒç”¨éœ€è¦æŠŠè§’è‰²æ‰“å…¥ä¸€ä¸ªç±»ä¸­ï¼Œ æ‰€ä»¥æ–¹æ³•æŸ¥æ‰¾ä¼šè¿”å›ä¸€ä¸ªé—­åŒ…æ¥å®Œæˆè¿™ä¸ªä»»åŠ¡å¹¶æ›¿æ¢è°ƒç”¨è€…ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„é—´æ¥æ€§ï¼›æ–°çš„è°ƒåº¦è€…å¯ä»¥è·å¾— punï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªè°ƒåº¦ç¨‹åºï¼Œç”¨ punn åŒ–çš„ç±»ç±»å‹å¯¹è±¡æ›¿æ¢è§’è‰²ç±»å‹å¯¹è±¡ï¼Œè¿™å°†ä½¿æ¯æ¬¡è°ƒç”¨çš„æˆæœ¬å¤§å¤§é™ä½ã€‚</li>
<li>æˆ‘æœŸæœ›ä½¿ç”¨æ–°çš„ dispatcher å¯ä»¥ä½¿å¥æŸ„ï¼ˆdlegatedï¼‰å’Œ fallbackï¼ˆå¤„ç†ç¼ºå¤±çš„æ–¹æ³•è°ƒç”¨ï¼‰æœºåˆ¶éƒ½èƒ½æœ‰æ›´å¥½çš„è¡¨ç°</li>
<li>å½“å‰çš„ assuming - ç”¨äºä¸ºä¾‹ç¨‹è®¨ä»·è¿˜ä»·æˆ–å…¶ä»–é¦–è¦å‚æ•° - çš„å®ç°å¹¶ä¸ç†æƒ³ï¼Œåˆ©ç”¨æ–°è°ƒåº¦å™¨çš„å‚æ•°é‡å†™èƒ½åŠ›çš„å®ç°å¯èƒ½ä¼šæœ‰æ›´å¥½çš„è¡¨ç°ã€‚
åœ¨æ–°çš„è°ƒåº¦æœºåˆ¶çš„å¸®åŠ©ä¸‹ï¼Œä¸€äº›æ–°çš„è¯­è¨€åŠŸèƒ½ä¹Ÿå¯èƒ½ä»¥é«˜æ•ˆçš„æ–¹å¼æä¾›ã€‚ä¾‹å¦‚ï¼Œç›®å‰æ²¡æœ‰ä¸€ç§å¯é çš„æ–¹å¼æ¥å°è¯•è°ƒç”¨ä¸€æ®µä»£ç ï¼Œå¦‚æœç­¾åç»‘å®šäº†å°±è¿è¡Œå®ƒï¼Œå¦‚æœæ²¡æœ‰ç»‘å®šå°±åšå…¶ä»–äº‹æƒ…ã€‚ç›¸åï¼Œåƒ Cro è·¯ç”±å™¨è¿™æ ·çš„ä¸œè¥¿ï¼Œå¿…é¡»å…ˆåšç­¾åçš„è¯•ç»‘å®šï¼Œç„¶åå†åšè°ƒç”¨ï¼Œè¿™ä½¿å¾—è·¯ç”±çš„æˆæœ¬ç›¸å½“é«˜ã€‚è¿˜æœ‰ä¸€ä¸ªå»ºè®®å·²ä¹…çš„æƒ³æ³•ï¼Œå°±æ˜¯é€šè¿‡ç­¾åä¸ <code>when</code> æ„é€ æä¾›æ¨¡å¼åŒ¹é… (ä¾‹å¦‚ï¼Œ<code>when * -&gt; ($x) {}; when * -&gt; ($x, *@tail) { }</code>)ï¼Œè¿™å’Œéœ€æ±‚å·®ä¸å¤šï¼Œåªæ˜¯åœ¨ä¸€ä¸ªä¸å¤ªåŠ¨æ€çš„ç¯å¢ƒä¸‹ã€‚</li>
</ul>
<h2 id="æœ€å">æœ€å&hellip;</h2>
<p>åœ¨æ–°çš„è°ƒåº¦æœºåˆ¶ä¸Šçš„å·¥ä½œæ¯”æˆ‘æœ€åˆé¢„æœŸçš„å†ç¨‹è¦é•¿ã€‚è®¾è®¡çš„æ¢å¤éƒ¨åˆ†ç‰¹åˆ«å…·æœ‰æŒ‘æˆ˜æ€§ï¼Œè€Œä¸”è¿˜æœ‰ä¸€äº›é‡è¦çš„ç»†èŠ‚éœ€è¦å¤„ç†ã€‚ä¸€è·¯èµ°æ¥ï¼Œå¤§æ¦‚æœ‰å››ç§æ½œåœ¨çš„æ–¹æ³•è¢«æŠ›å¼ƒäº†ï¼ˆè™½ç„¶å…¶ä¸­çš„å…ƒç´ éƒ½å½±å“äº†æˆ‘åœ¨è¿™ç¯‡æ–‡ç« ä¸­æè¿°çš„å†…å®¹ï¼‰ã€‚èƒ½åšæŒä¸‹æ¥çš„æŠ½è±¡çœŸçš„éå¸¸éå¸¸éš¾ã€‚</p>
<p>æˆ‘æœ€ç»ˆä¹Ÿä¸å¾—ä¸ä»æ ¹æœ¬ä¸Šç¦»å¼€å‡ ä¸ªæœˆåš Raku å·¥ä½œï¼Œåœ¨å…¶ä»–ä¸€äº›å·¥ä½œä¸­æ„Ÿè§‰æœ‰ç‚¹è¢«å‹å®äº†ï¼Œå¹¶ä¸”ä¸€ç›´åœ¨ä¸åŒæ ·é‡è¦çš„ RakuAST é¡¹ç›®ï¼ˆå®ƒå°†å› ä¸ºèƒ½å¤Ÿæ‰¿æ‹…æ–°çš„è°ƒåº¦å™¨çš„å­˜åœ¨è€Œè¢«ç®€åŒ–ï¼Œå¹¶ä¸”è¿˜ä¸ºæˆ‘æä¾›äº†ä¸€ç³»åˆ—æ›´æŸ”å’Œçš„ Raku é»‘å®¢ä»»åŠ¡ï¼Œè€Œè°ƒåº¦å™¨çš„å·¥ä½œæä¾›äº†å¾ˆå°‘çš„è½»æ¾é€‰æ‹©ï¼‰ã€‚</p>
<p>é‰´äºè¿™äº›ï¼Œæˆ‘å¾ˆé«˜å…´ç»ˆäºçœ‹åˆ°äº†éš§é“å°½å¤´çš„å…‰äº®ã€‚å‰©ä¸‹çš„å·¥ä½œæ˜¯æ•°ä¸èƒœæ•°çš„ï¼Œè€Œæˆ‘ä»¬ä½¿ç”¨æ–°çš„è°ƒåº¦å™¨å‘å¸ƒ Rakudo å’Œ MoarVM çš„é‚£ä¸€å¤©ï¼Œæ„Ÿè§‰è¿˜éœ€è¦å‡ ä¸ªæœˆçš„æ—¶é—´ï¼ˆæˆ‘å¸Œæœ›å†™ä¸‹è¿™å¥è¯ä¸æ˜¯åœ¨è¯±æƒ‘å‘½è¿ï¼ï¼‰ã€‚</p>
<p>æ–°çš„è°ƒåº¦å™¨å¯èƒ½æ˜¯ MoarVM è‡ªæˆ‘åˆ›å»ºä»¥æ¥æœ€é‡è¦çš„å˜åŒ–ï¼Œå› ä¸ºå®ƒçœ‹åˆ°æˆ‘ä»¬åˆ é™¤äº†ä¸€å †ä»ä¸€å¼€å§‹å°±å­˜åœ¨çš„ä¸œè¥¿ã€‚RakuAST ä¹Ÿå°†ä¸º Rakudo ç¼–è¯‘å™¨å¸¦æ¥åå¹´æ¥æœ€å¤§çš„æ¶æ„å˜åŒ–ã€‚ä¸¤è€…éƒ½æ˜¯ä¸€ä¸ªæœºä¼šï¼Œå°†å¤šå¹´æ¥å­¦ä¹ çš„ä¸œè¥¿ç¡¬ç”Ÿç”Ÿåœ°æŠ˜åˆåˆ°è¿è¡Œæ—¶å’Œç¼–è¯‘å™¨ä¸­ã€‚æˆ‘å¸Œæœ›å†è¿‡åå¹´ï¼Œå½“æˆ‘å›é¡¾è¿™ä¸€åˆ‡çš„æ—¶å€™ï¼Œè‡³å°‘ä¼šè§‰å¾—è‡ªå·±è¿™æ¬¡çŠ¯äº†æ›´å¤šæœ‰è¶£çš„é”™è¯¯ã€‚</p>
<p>åŸæ–‡é“¾æ¥: <a href="https://6guts.wordpress.com/2021/03/15/towards-a-new-general-dispatch-mechanism-in-moarvm/">https://6guts.wordpress.com/2021/03/15/towards-a-new-general-dispatch-mechanism-in-moarvm/</a></p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/raku" term="raku" label="Raku" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[ä¸ºæœ€å¹´è½»çš„ Raku è´¡çŒ®åŠ›é‡]]></title>
            <link href="https://ohmyweekly.github.io/notes/2021-02-16-contributing-to-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2021-01-30-caesarean-substrings-with-raku-and-perl/?utm_source=atom_feed" rel="related" type="text/html" title="Caesarean Substrings With Raku and Perl" />
                <link href="https://ohmyweekly.github.io/notes/2021-02-07-if-sets-would-dwim/?utm_source=atom_feed" rel="related" type="text/html" title="å¦‚æœé›†åˆå¦‚æˆ‘æ‰€æƒ³" />
                <link href="https://ohmyweekly.github.io/notes/2020-10-04-the-strange-case-of-the-greedy-junction/?utm_source=atom_feed" rel="related" type="text/html" title="è´ªå©ª Junction çš„å¥‡é—»å¼‚äº‹" />
                <link href="https://ohmyweekly.github.io/notes/2020-10-04-reconstructing-raku-junctions/?utm_source=atom_feed" rel="related" type="text/html" title="é‡æ„ Raku çš„ Junction" />
            
                <id>https://ohmyweekly.github.io/notes/2021-02-16-contributing-to-raku/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2021-02-16T00:00:00+08:00</published>
            <updated>2021-02-16T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Contributing to Raku</blockquote><p>åœ¨è¿‡å»çš„å‡ å‘¨é‡Œï¼Œæˆ‘çœ‹åˆ°äº†ä¸€äº›<a href="https://mydeveloperplanet.com/2021/01/20/how-to-start-contributing-to-open-source/">æ–‡ç« </a>å’Œ<a href="https://youtu.be/GAqfMNB-YBU">è§†é¢‘</a>ï¼Œè®²è¿°äº†åœ¨å¼€æºè½¯ä»¶ä¸­æ„æ€æ˜¯å¤šä¹ˆçš„ä¼Ÿå¤§ã€‚è¿™æ¬¡æˆ‘åˆæƒ³èµ·äº†å¦ä¸€ç¯‡æ—§æ–‡<a href="http://strangelyconsistent.org/blog/perl-6-is-my-mmorpg">Raku æ˜¯æˆ‘çš„ MMORPG</a>ã€‚å®ƒè¯´ï¼Œä½ å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢å—ç›Šäºå¼€æºè½¯ä»¶ã€‚æ¯”å¦‚è¯´ï¼Œå¯ä»¥åšä¸€ä¸ªå¤§ä¾ ï¼ŒåŸºäºä¸€äº›å¼€æºè½¯ä»¶æ¥å†™è½¯ä»¶ã€‚ä½œä¸ºå†™æ‰‹ï¼Œå¯ä»¥å†™åšå®¢ã€å¾®åšç­‰ï¼Œå¯¹æ‰€é€‰è½¯ä»¶äº§ç”Ÿå…´è¶£ã€‚æˆ–è€…ä½ å¯ä»¥æˆä¸ºä¸€ä¸ªæ³•å¸ˆ - å®ç°æ–°çš„åŠŸèƒ½å’Œä¿®å¤ bugã€‚ä»Šå¤©å°ç¼–å°±å¸¦ç€å¼“ç®­æ‰‹æ¥å‘Šè¯‰å¤§å®¶å¦‚ä½•æˆä¸º <a href="https://raku.org/">Raku</a> ç¼–ç¨‹è¯­è¨€çš„æ³•å¸ˆã€‚</p>
<h2 id="é€‰æ‹©ä¸€ä¸ªä»»åŠ¡">é€‰æ‹©ä¸€ä¸ªä»»åŠ¡</h2>
<p>è®©æˆ‘ä»¬æŒ‘é€‰ä¸€äº›ç¼–è¯‘å™¨çš„ bugï¼Œå¹¶ä¿®å¤å®ƒã€‚è®©æˆ‘ä»¬å» <a href="https://rakudo.org/">Rakudo</a> ç¼–è¯‘å™¨ <a href="https://github.com/rakudo/rakudo/issues">issues</a>ä¸­é€‰æ‹©æˆ‘ä»¬æƒ³è¦ä¿®å¤çš„ bugã€‚æˆ‘æ»šåŠ¨äº†ä¸€ä¸‹ bug åˆ—è¡¨ï¼Œé‡åˆ°äº†è§£æ - è¿æ°”ä¸é”™ï¼Œæˆ‘å‰æ®µæ—¶é—´ä¸€ç›´åœ¨ç ”ç©¶<a href="https://www.apress.com/gp/book/9781484232279">ç¼–è¯‘å™¨è¯­æ³•</a>ï¼Œçœ‹äº†ä¸€æœ¬è¿™æ–¹é¢çš„å¥½ä¹¦ã€‚æ‰¾åˆ°äº†å››ä¸ªé—®é¢˜ã€‚</p>
<p><img src="https://rakurs.atroxaper.net/assets/img/posts/2021-02-13-contributing-raku-1.png" alt="img"></p>
<ol>
<li>æ ‡ç­¾ä¸º LTA ï¼ˆLess Than Awesome - å½“çœŸå®è¡Œä¸ºä¸ç›´è§‰é¢„æœŸä¸åŒæ—¶ï¼‰- æˆ‘ä»¬æš‚æ—¶æŠŠå®ƒåˆ’æ‰ã€‚</li>
<li>æ ‡ç­¾ &ldquo;éœ€è¦å…±è¯†&rdquo; - æˆ‘ä»¬åªæƒ³ä¿®å¤ä¸€ä¸ªä¸å¤æ‚çš„ bug - è‚¯å®šè¦åˆ’æ‰ã€‚</li>
<li>æ ‡ç­¾ä¸º &ldquo;grammar and actions&rdquo; çš„å…³äºä¸€ä¸ªå¯èƒ½æ­»çš„ä»£ç æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å€™é€‰äººçš„ç¬¬ä¸€ä¸ªä»»åŠ¡ã€‚</li>
</ol>
<p>ä»»åŠ¡ç¡®å®šåï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦é…ç½®å·¥ä½œç¯å¢ƒã€‚åœ¨ Windowsã€Linux å’Œ macOS ä¸­ï¼Œä¸€åˆ‡åº”è¯¥éƒ½å·®ä¸å¤šã€‚æˆ‘å°†é€šè¿‡ macOS çš„ä¾‹å­æ¥å‘Šè¯‰ä½ ã€‚</p>
<h2 id="å»ºç«‹å·¥ä½œç¯å¢ƒ">å»ºç«‹å·¥ä½œç¯å¢ƒ</h2>
<p>ä¸ºæºç å’Œæˆ‘ä»¬å»ºç«‹çš„ç¼–è¯‘å™¨å»ºç«‹æ–‡ä»¶å¤¹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">mkdir ~/dev-rakudo <span class="o">&amp;&amp;</span> mkdir ~/dev-rakudo-install
</code></pre></div><p>Rakudo ç¼–è¯‘å™¨ç”±ä¸‰éƒ¨åˆ†ç»„æˆã€‚</p>
<ol>
<li>è™šæ‹Ÿæœºã€‚ç°åœ¨æœ‰ä¸‰ç§ - JVMã€JS å’Œ MoarVMã€‚æˆ‘ä»¬ä»¥ MoarVM ä¸ºæœ€ç¨³å®šçš„ä¸€ä¸ªã€‚</li>
<li>NQPï¼ˆNot Quite Perlï¼‰ï¼Œæ˜¯ä¸€ç§ä½çº§ï¼ˆä¸­çº§ï¼‰è¯­è¨€çš„å®ç°ï¼Œå®ƒæ˜¯ Raku çš„ä¸€ä¸ª &ldquo;å­é›†&rdquo;ã€‚è™šæ‹Ÿæœºå¯ä»¥æ‰§è¡Œç”¨ NQP ç¼–å†™çš„ä»£ç ã€‚</li>
<li>Rakudo ç¼–è¯‘å™¨æœ¬èº«ï¼Œç”¨ NQP å’Œ Raku ç¼–å†™ã€‚</li>
</ol>
<p>ä¸‹è½½å¹¶ç¼–è¯‘è¿™ä¸‰ä¸ªç»„ä»¶ã€‚æˆ‘åˆ†åˆ«èŠ±äº†ä¸€åˆ†åŠé’Ÿã€åŠåˆ†é’Ÿå’Œä¸¤åˆ†åŠé’Ÿæ‰ç¼–å¥½ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nb">cd</span> ~/dev-rakudo <span class="o">&amp;&amp;</span> git clone git@github.com:MoarVM/MoarVM.git <span class="o">&amp;&amp;</span> <span class="nb">cd</span> MoarVM
perl Configure.pl --prefix ~/dev-rakudo-install <span class="o">&amp;&amp;</span> make -j <span class="m">4</span> <span class="o">&amp;&amp;</span> make install

<span class="nb">cd</span> ~/dev-rakudo <span class="o">&amp;&amp;</span> git clone git@github.com:Raku/nqp.git <span class="o">&amp;&amp;</span> <span class="nb">cd</span> nqp
perl Configure.pl --backend<span class="o">=</span>moar --prefix ~/dev-rakudo-install <span class="o">&amp;&amp;</span> make -j <span class="m">4</span> <span class="o">&amp;&amp;</span> make install

<span class="nb">cd</span> ~/dev-rakudo <span class="o">&amp;&amp;</span> git clone git@github.com:rakudo/rakudo.git <span class="o">&amp;&amp;</span> <span class="nb">cd</span> rakudo
perl Configure.pl --backend<span class="o">=</span>moar --prefix ~/dev-rakudo-install <span class="o">&amp;&amp;</span> make -j <span class="m">4</span> <span class="o">&amp;&amp;</span> make install
</code></pre></div><p>æ³¨æ„å‚æ•°ã€‚<code>--prefix</code> æ˜¾ç¤ºäº† <code>make install</code> å‘½ä»¤åå¯æ‰§è¡Œæ–‡ä»¶çš„å¤åˆ¶ä½ç½®ï¼Œ<code>--backend=moar</code> è¡¨ç¤ºæ­£åœ¨ä½¿ç”¨çš„è™šæ‹Ÿæœºï¼Œè€Œ <code>-j 4</code> åˆ™è¦æ±‚è·¨å¤šçº¿ç¨‹å¹¶è¡ŒåŒ–ï¼ˆä»¥é˜²åŠ å¿«è¿›åº¦ï¼‰ã€‚ç°åœ¨æˆ‘ä»¬å·²ç»å»ºç«‹äº† Rakudo ç¼–è¯‘å™¨ <code>~/dev-rakudo-install/bin/raku</code>ã€‚æˆ‘ä»¬è¿˜éœ€è¦å®˜æ–¹çš„ç¼–è¯‘å™¨æµ‹è¯•å¥—ä»¶ã€‚ä½ åº”è¯¥æŠŠå®ƒå’Œå®ƒçš„ä»£ç ä¸€èµ·æ”¾åœ¨æ–‡ä»¶å¤¹é‡Œã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell"><span class="nb">cd</span> ~/dev-rakudo/rakudo <span class="o">&amp;&amp;</span> git clone https://github.com/Raku/roast.git t/spec
</code></pre></div><p>æˆ‘ä»¬å…ˆè¿›è¡Œæµ‹è¯•ã€‚è¿™ç§æƒ…å†µå¾ˆå¸¸è§ï¼Œæœ‰äº›æµ‹è¯•ç”šè‡³åœ¨æ–°çš„å˜åŒ–ä¹‹å‰å°±å¤±è´¥äº†ã€‚æˆ‘ä»¬éœ€è¦è¾¨åˆ«å‡ºæ¥ï¼Œè¿™æ ·ä»¥åå°±ä¸ä¼šå®³æ€•è¿™äº›å˜åŒ–ç ´åäº†ä¸€äº›ä¸å¿…è¦çš„ä¸œè¥¿ã€‚</p>
<p>è¿™é‡Œå’Œä¸‹é¢æˆ‘å°†åœ¨ <code>~/dev-rakudo/rakudo</code> æ–‡ä»¶å¤¹ä¸­å·¥ä½œï¼Œé™¤éå¦æœ‰è¯´æ˜ã€‚</p>
<pre><code>&gt; make spectest
[...]
Test Summary Report
-------------------
t/spec/S32-str/utf8-c8.t    (Wstat: 65280 Tests: 54 Failed: 0)
  Non-zero exit status: 255
  Parse errors: Bad plan.  You planned 66 tests but ran 54.
Files=1346, Tests=117144, 829 wallclock secs (27.70 usr  6.04 sys + 2638.79 cusr 210.98 csys = 2883.51 CPU)
Result: FAIL
make: *** [m-spectest5] Error 1
</code></pre><p>14åˆ†é’Ÿå†…å…±è¿è¡Œäº†1,346ä¸ªæ–‡ä»¶ä¸­çš„117,144æ¬¡æµ‹è¯•ã€‚ä¸€äº›ä¸utf8ç›¸å…³çš„æµ‹è¯•ç”±äºæŸç§åŸå› å¤±è´¥äº†ï¼Œå…¶ä»–çš„éƒ½èƒ½æ­£å¸¸å·¥ä½œã€‚æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½å»å·¥ä½œäº†!</p>
<h2 id="è®©æˆ‘ä»¬æ¥çœ‹çœ‹é—®é¢˜çš„é™ˆè¿°">è®©æˆ‘ä»¬æ¥çœ‹çœ‹é—®é¢˜çš„é™ˆè¿°</h2>
<p>é—®é¢˜é™ˆè¿°è¯´ï¼ŒæŸä¸ªå…ƒè¿ç®—ç¬¦ <code>R</code> åœ¨ colonpair ä¸Šå‡ºäº†é—®é¢˜ã€‚æˆ‘æ‰“å¼€æ–‡æ¡£ï¼Œæœç´¢ R è¿™ä¸ªè¯ï¼Œä½†ä¸‹æ‹‰åˆ—è¡¨ä¸­æ²¡æœ‰è¿™ä¸ªåå­—çš„å…ƒè¿ç®—ç¬¦ã€‚æˆ‘è¯•ç€è¾“å…¥ metaopï¼Œçœ‹åˆ°çš„æ˜¯åå‘å…ƒæ“ä½œç¬¦(R)ã€‚åŸæ¥ï¼Œå¦‚æœä½ æƒ³æŠŠäºŒå…ƒè¿ç®—çš„æ“ä½œæ•°æŒ‰ç›¸åçš„é¡ºåºå†™å‡ºæ¥ï¼Œä½ å¯ä»¥åœ¨å…¶ç¬¦å·å‰ä½¿ç”¨å‰ç¼€ Rã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="mi">3</span> <span class="ow">R</span><span class="o">-</span> <span class="mi">2</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="c1"># Output: True</span>
</code></pre></div><p>Colonpair æ˜¯å‘½åå¯¹çš„è¯­æ³•ã€‚å®ƒçœ‹èµ·æ¥å°±åƒåå­—å‰é¢æœ‰ä¸€ä¸ªå†’å·ï¼Œå‰é¢æœ‰ä¸€ä¸ªæ‹¬å·ï¼Œæœ‰ä¸€ä¸ªå€¼ã€‚ä¾‹å¦‚ <code>:foo(42)</code> æ˜¯ä¸€ä¸ªåç§°ä¸º <code>foo</code>ã€å€¼ä¸º <code>42</code> çš„å¯¹å„¿ã€‚è¿™ä¸ªè¯­æ³•é€šå¸¸ç”¨äºåœ¨è°ƒç”¨å‡½æ•°æ—¶ï¼Œå‘å‡½æ•°ä¼ é€’ä¸€ä¸ªå‘½åå‚æ•°ä¸­çš„å€¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">sub-with-named-parameter</span><span class="p">(</span><span class="o">:</span><span class="nv">$foo</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$foo</span><span class="p">;</span>
<span class="p">}</span>

<span class="nf">sub-with-named-parameter</span><span class="p">(:</span><span class="s">foo</span><span class="p">(</span><span class="mi">42</span><span class="p">));</span> <span class="c1"># Output: 42</span>
</code></pre></div><p>å¦‚æœä¸€ä¸ªå‡½æ•°å‚æ•°ä¸æ˜¯å‘½åçš„ï¼Œè€Œæ˜¯ä½ç½®çš„ï¼Œé‚£ä¹ˆåœ¨ç”¨å‘½åå¯¹è°ƒç”¨æ—¶ï¼Œå°±ä¼šå‡ºç°ç¼–è¯‘é”™è¯¯ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">sub-without-named-parameter</span><span class="p">(</span><span class="nv">$foo</span><span class="p">)</span> <span class="p">{</span> <span class="c1"># &lt;- æ²¡æœ‰å†’å·</span>
  <span class="nb">say</span> <span class="nv">$foo</span><span class="p">;</span>
<span class="p">}</span>

<span class="nf">sub-without-named-parameter</span><span class="p">(:</span><span class="s">foo</span><span class="p">(</span><span class="mi">42</span><span class="p">));</span> <span class="c1"># Unexpected named argument &#39;foo&#39; passed</span>
</code></pre></div><p>å¦‚æœä½ åœ¨è°ƒç”¨è¿™æ ·çš„å‡½æ•°æ—¶ç”¨æ‹¬å·åŒ…å›´ä¸€ä¸ªå‚æ•°ï¼Œæ•´ä¸ªå‚æ•°å¯¹å°†è¢«ä¼ é€’åˆ°ä½ç½®å‚æ•°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">sub-without-named-parameter</span><span class="p">(</span><span class="nv">$foo</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">say</span> <span class="nv">$foo</span><span class="p">;</span>
<span class="p">}</span>

<span class="nf">sub-without-named-parameter</span><span class="p">((:</span><span class="s">foo</span><span class="p">(</span><span class="mi">42</span><span class="p">)));</span> <span class="c1"># Output: foo =&gt; 42</span>
</code></pre></div><p>åœ¨ Raku ä¸­ï¼Œä½ å¯ä»¥å†™ä¸€ä¸ªå‡½æ•°æ¥æ•è·æ‰€æœ‰ä¼ é€’ç»™å®ƒçš„å‚æ•°å¹¶åˆ†æå®ƒä»¬ã€‚è¿™æ˜¯åœ¨å•ä¸ªå‚æ•° - æ•è·å‰ç”¨ç«–çº¿å®Œæˆçš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">sub-with-capture</span><span class="p">(</span><span class="o">|</span><span class="n">foo</span><span class="p">)</span> <span class="p">{</span> <span class="c1"># &lt;- å‚æ•°æ•è·</span>
  <span class="nb">say</span> <span class="n">foo</span><span class="p">;</span>
<span class="p">}</span>

<span class="nf">sub-with-capture</span><span class="p">(:</span><span class="s">foo</span><span class="p">(</span><span class="mi">42</span><span class="p">));</span>     <span class="c1"># Output: \(:foo(42))</span>
<span class="nf">sub-with-capture</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>           <span class="c1"># Output: \(42)</span>
<span class="nf">sub-with-capture</span><span class="p">(:</span><span class="s">foo</span><span class="p">(</span><span class="mi">3</span> <span class="ow">Z</span><span class="o">-</span> <span class="mi">2</span><span class="p">));</span> <span class="c1"># Output: \(:foo((1,).Seq))</span>
<span class="nf">sub-with-capture</span><span class="p">(:</span><span class="s">foo</span><span class="p">(</span><span class="mi">3</span> <span class="ow">R</span><span class="o">-</span> <span class="mi">2</span><span class="p">));</span> <span class="c1"># Output: \(-1)</span>
</code></pre></div><p>å€’æ•°ç¬¬äºŒè¡Œä½¿ç”¨äº† Z å…ƒæ“ä½œç¬¦ - zip æ“ä½œç¬¦ã€‚å®ƒå°†å·¦å³ä¸¤éƒ¨åˆ†ä½œä¸ºä¸€ä¸ªåˆ—è¡¨ï¼ŒæŒ‰é¡ºåºæ¯æ¬¡ä»å®ƒä»¬ä¸­æŠ½å–ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿›è¡Œæ“ä½œï¼Œä»è€Œå½¢æˆä¸€ä¸ªåºåˆ—ã€‚</p>
<p>åœ¨æœ€åä¸€è¡Œï¼Œåªç”¨äº†æˆ‘ä»¬éœ€è¦çš„ R å…ƒæ“ä½œç¬¦ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªå¯¹ï¼Œè€Œæ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œå®ƒè¢«ä¼ é€’åˆ°å‡½æ•°ä¸­ã€‚æˆ‘ä»¬å¯ä»¥å‡è®¾è¿™æ˜¯å…ƒè¿ç®—ç¬¦å·¥ä½œæ–¹å¼çš„ä¸€äº›ç‰¹æ®Šæ€§ï¼Œä½†ç”¨ Z çš„ä¾‹å­è¡¨æ˜å¹¶éå¦‚æ­¤ã€‚å…¶å®è¿™æ˜¯ä¸€ä¸ª bug - å½“ä¸€ä¸ªå¯¹è¢«ä¼ é€’åˆ°ä¸€ä¸ªä½¿ç”¨ R å…ƒè¿ç®—ç¬¦çš„å‡½æ•°ä¸­æ—¶ï¼Œå®ƒçš„å€¼ä¼šè¢«è½¬æ¢ã€‚</p>
<h2 id="æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–°çš„æµ‹è¯•">æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–°çš„æµ‹è¯•</h2>
<p>ä¸ºäº†ç¡®ä¿æœªæ¥çš„å˜åŒ–èƒ½å¤Ÿä¿®å¤é”™è¯¯çš„è¡Œä¸ºï¼Œæˆ‘ä»¬éœ€è¦å†™ä¸€ä¸ªæ–°çš„æµ‹è¯•ã€‚åœ¨æµ‹è¯•æ–‡ä»¶ä¸­ä¸éš¾æ‰¾åˆ° R å…ƒæ“ä½œç¬¦çš„æµ‹è¯•ï¼ˆ<a href="https://github.com/Raku/roast/blob/fea1d16d993eb851d2935155e0b0d074fa3593bf/S03-metaops/reverse.t">S03-metops/reverse.t</a>ï¼‰ã€‚ä¸‹é¢æˆ‘å°†è¡¥å……ä»¥ä¸‹æµ‹è¯•ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># https://github.com/rakudo/rakudo/issues/1632</span>
<span class="p">{</span>
  <span class="k">sub</span> <span class="nf">subroutine</span><span class="p">(</span><span class="nv">$expected</span><span class="o">,</span> <span class="o">|</span><span class="n">actual</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">is</span> <span class="nc">actual</span><span class="o">.</span><span class="nb">gist</span><span class="o">,</span> <span class="nv">$expected</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">Ğ¡olonpair exists</span><span class="p">&#34;</span>
  <span class="p">}</span>

  <span class="nf">subroutine</span><span class="p">(&#39;</span><span class="s1">\(:foo(-1))</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">:</span><span class="s">foo</span><span class="p">(</span><span class="mi">3</span> <span class="ow">R</span><span class="o">-</span> <span class="mi">2</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div><p>è¯¥æµ‹è¯•æœ‰ä¸€ä¸ªåŠŸèƒ½ï¼Œæœ‰ä¸¤ä¸ªå‚æ•° - æ­£å¸¸å’Œæ•è·ã€‚åœ¨å‡½æ•°ä½“ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å’Œä¼ é€’çš„ Capture çš„å­—ç¬¦ä¸²è¡¨ç¤ºè¿›è¡Œæ¯”è¾ƒã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>make</code> å¯¹æ–°æ„å»ºçš„ç¼–è¯‘å™¨è¿›è¡Œå•ç‹¬æµ‹è¯•ã€‚</p>
<pre><code>&gt; make t/spec/S03-metaops/reverse.t
[...]
ok 69 - [R~]=
not ok 70 - Colonpair exists
# Failed test 'Colonpair exists'
# at t/spec/S03-metaops/reverse.t line 191
# expected: '\(:foo(-1))'
#      got: '\(-1)'
# You planned 69 tests, but ran 70
# You failed 1 test of 70
</code></pre><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œæµ‹è¯•å¤±è´¥äº†ï¼ˆå¦‚é¢„æœŸï¼‰ã€‚è¿˜æœ‰ä¸€ä¸ªå•ç‹¬çš„è¯´æ˜ï¼Œç³»ç»Ÿé¢„è®¡69æ¬¡æµ‹è¯•ï¼Œä½†æ”¶åˆ°70æ¬¡ã€‚è¿™æ˜¯åŸºäº TAP çš„æµ‹è¯•ç³»ç»Ÿçš„ç‰¹ç‚¹ - å¿…é¡»åœ¨æ–‡ä»¶çš„é¡¶éƒ¨ä¿®æ­£ä¼ é€’ç»™ <code>plan</code> å‡½æ•°çš„æ•°å­—ã€‚ç°åœ¨æµ‹è¯•å´©æºƒäº†ï¼Œä½†ç¼–å·æ²¡æœ‰å—åˆ°å½±å“ã€‚ä½ å¯ä»¥å¼€å§‹ä¿®å¤å®ƒã€‚</p>
<h2 id="å‡è§†æ³•">å‡è§†æ³•</h2>
<p>ä¸€å¼€å§‹æˆ‘å¾ˆç›¸ä¿¡ä»»åŠ¡ä¸Šçš„æ ‡ç­¾ - å¦‚æœæ˜¯è§£æçš„è¯ï¼Œä¸€å®šæ˜¯æºç è§£æé˜¶æ®µçš„æŸä¸ªåœ°æ–¹å‡ºç°äº†é—®é¢˜ã€‚ç›®å‰æˆ‘çš„è®¤è¯†å¦‚ä¸‹ï¼š</p>
<ol>
<li>åŸºç¡€è§£æå™¨ä»£ç åœ¨æ–‡ä»¶ <code>rakudo/src/Perl6/Grammar.nqp</code> ä¸­ã€‚</li>
<li>è¿™ä¸ªè§£æå™¨æ˜¯ä» <code>nqp/src/HLL/Grammar.nqp</code> æ–‡ä»¶ä¸­çš„åŸºç¡€è§£æå™¨ç»§æ‰¿çš„ã€‚</li>
<li>å…ƒæ“ä½œç¬¦çš„è§£æå’Œå·¥ä½œæ–¹å¼éƒ½å·®ä¸å¤šï¼Œä½ å¯ä»¥é€šè¿‡ä»”ç»†è§‚å¯Ÿæ¥å‘ç°ä¸åŒä¹‹å¤„ã€‚</li>
</ol>
<p>æˆ‘åœ¨åŸºç¡€è§£æå™¨ä»£ç ä¸­æ‰¾åˆ°äº†å¯¹å…ƒæ“ä½œç¬¦çš„å¼•ç”¨ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">token</span> <span class="nf">infix_prefix_meta_operator:sym</span>&lt;R&gt; <span class="p">{</span><span class="sr">
</span><span class="sr">  </span><span class="p">&lt;</span><span class="nf">sym</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">infixish</span><span class="p">(&#39;</span><span class="s1">R</span><span class="p">&#39;)&gt;</span><span class="sr"> </span><span class="p">{}</span><span class="sr">
</span><span class="sr">  </span><span class="p">&lt;</span><span class="o">.</span><span class="nf">can_meta</span><span class="p">(</span><span class="nv">$&lt;infixish&gt;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">reverse the args of</span><span class="p">&#34;)&gt;</span><span class="sr">
</span><span class="sr">  </span><span class="p">&lt;</span><span class="nv">O</span><span class="o">=.</span><span class="nf">revO</span><span class="p">(</span><span class="nv">$&lt;infixish&gt;</span><span class="p">)&gt;</span><span class="sr">
</span><span class="sr"></span><span class="p">}</span>

<span class="k">token</span> <span class="nf">infix_prefix_meta_operator:sym</span>&lt;Z&gt; <span class="p">{</span><span class="sr">
</span><span class="sr">  </span><span class="p">&lt;</span><span class="nf">sym</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">infixish</span><span class="p">(&#39;</span><span class="s1">Z</span><span class="p">&#39;)&gt;</span><span class="sr"> </span><span class="p">{}</span><span class="sr">
</span><span class="sr">  </span><span class="p">&lt;</span><span class="o">.</span><span class="nf">can_meta</span><span class="p">(</span><span class="nv">$&lt;infixish&gt;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">zip with</span><span class="p">&#34;)&gt;</span><span class="sr">
</span><span class="sr">  </span><span class="p">&lt;</span><span class="sr">O(|</span><span class="nv">%list_infix</span><span class="sr">)</span><span class="p">&gt;</span><span class="sr">
</span><span class="sr"></span><span class="p">}</span>
</code></pre></div><p>è¿™éœ€è¦å¯¹ Raku grammar æœ‰ä¸€å®šçš„äº†è§£ã€‚æ®æˆ‘æ‰€çŸ¥ï¼ŒåŸæ¥è¿™ä¸¤ä¸ªå…ƒè¿ç®—ç¬¦åœ¨è§£æä¸Šå¹¶æ²¡æœ‰æ ¹æœ¬çš„åŒºåˆ«ã€‚ä¸€æ®µæ—¶é—´åï¼Œåœ¨è§£æå™¨çš„æºä»£ç ä¸­æŒ–å¾—å¤Ÿå¤šäº†ï¼Œæˆ‘å¼€å§‹æ€€ç–‘è§£æå·¥ä½œæ˜¯å¦æ­£ç¡®ã€‚è®¤ä¸ºä»£ç  <code>my $r = :foo(3 R- 2); say $r; # Output: foo =&gt; -1</code> æ­£ç¡®å·¥ä½œçš„å»ºè®® - é—®é¢˜æ°æ°å‘ç”Ÿåœ¨è°ƒç”¨å‡½æ•°æ—¶ã€‚æ˜¾ç„¶ï¼Œæˆ‘ç™½ç™½ç›¸ä¿¡äº†ä»»åŠ¡æ ä¸Šçš„æ ‡ç­¾ã€‚</p>
<h2 id="ç¼–è¯‘å™¨å°†å¸®åŠ©æˆ‘ä»¬">ç¼–è¯‘å™¨å°†å¸®åŠ©æˆ‘ä»¬</h2>
<p>é¢‡ä¸ºè¿Ÿé’çš„æˆ‘æƒ³èµ·äº†æˆ‘ä»ä¸€å¼€å§‹å°±åº”è¯¥åšçš„äº‹æƒ…ã€‚Rakudo ç¼–è¯‘å™¨æœ‰ <code>--target</code> è°ƒè¯•å¼€å…³ã€‚å®ƒå–ç¼–è¯‘å™¨é˜¶æ®µçš„åç§°ï¼Œä½ æƒ³å°†å…¶ç»“æœè¾“å‡ºåˆ°æ§åˆ¶å°å¹¶é€€å‡ºã€‚æˆ‘æƒ³çœ‹çœ‹ <code>--target=parse</code>ï¼ˆå› ä¸ºæˆ‘åªçŸ¥é“è¿™ä¸€ä¸ªï¼‰ã€‚</p>
<p>æˆ‘ä» <code>~/dev-rakudo/rakudo</code> æ–‡ä»¶å¤¹ä¸­ä½¿ç”¨ <code>rakumo-m</code>ï¼Œè¿™æ ·æˆ‘å°±ä¸å¿…ç­‰å¾…é€šè¿‡ <code>make install</code> å‘½ä»¤å°†æ‰€éœ€æ–‡ä»¶å¤åˆ¶åˆ° <code>~/dev-rakudo-install</code>ã€‚ç®€å•çš„è„šæœ¬å¯ä»¥è¿™æ ·è¿è¡Œã€‚æ›´å¤æ‚çš„è„šæœ¬å¿…é¡»åœ¨ <code>make install</code> ä¹‹åä» <code>-install</code> ä¸­è¿è¡Œã€‚</p>
<pre><code>&gt; cat ~/test.raku
sub s(|c) { say c }
s(:foo(3 R- 2));
s(:foo(3 Z- 2));

&gt; ./rakudo-m --target=parse ~/test.raku
[...]
- args: (:foo(3 R- 2))
  - semiarglist: :foo(3 R- 2)
    - arglist: 1 matches
      - EXPR: :foo(3 R- 2)
        - colonpair: :foo(3 R- 2)
          - identifier: foo
          - coloncircumfix: (3 R- 2)
            - circumfix: (3 R- 2)
              - semilist: 3 R- 2
                - statement: 1 matches
                  - EXPR: R- 2
[...]
- args: (:foo(3 Z- 2))
  - semiarglist: :foo(3 Z- 2)
    - arglist: 1 matches
      - EXPR: :foo(3 Z- 2)
        - colonpair: :foo(3 Z- 2)
          - identifier: foo
          - coloncircumfix: (3 Z- 2)
            - circumfix: (3 Z- 2)
              - semilist: 3 Z- 2
                - statement: 1 matches
                  - EXPR: Z- 2
[...]
</code></pre><p>ç»“è®ºï¼šR å’Œ Z çš„è§£ææ˜¯ä¸€æ ·çš„ã€‚</p>
<h2 id="è¿™ä¸æ˜¯è§£æ">è¿™ä¸æ˜¯è§£æ</h2>
<p>æ‰€æœ‰è¢«è§£æçš„ä¸œè¥¿éƒ½ä¼šè¢«ä¼ é€’ç»™æ‰€è°“çš„ Actionï¼ŒæŠŠå­—è¯å˜æˆä¸€æ£µè¯­æ³•æ ‘ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼ŒActions ä½äºæ–‡ä»¶ <code>rakudo/src/Perl6/Actions.nqp</code> å’Œ <code>nqp/src/HLL/Actions.nqp</code> ä¸­ã€‚è¿™é‡Œå°±æ¯”è¾ƒå®¹æ˜“ææ¸…æ¥šäº†ï¼Œæ¯•ç«Ÿæ˜¯ä»£ç ï¼Œæ˜¯ grammarã€‚</p>
<p>æˆ‘åœ¨ä¸» Actions ä¸­æ‰¾åˆ°äº†ä»¥ä¸‹ä»£ç ã€‚</p>
<pre><code>[...]
elsif $&lt;infix_prefix_meta_operator&gt; {
[...]
  if    $metasym eq 'R' { $helper := '&amp;METAOP_REVERSE'; $t := nqp::flip($t) if $t; }
  elsif $metasym eq 'X' { $helper := '&amp;METAOP_CROSS'; $t := nqp::uc($t); }
  elsif $metasym eq 'Z' { $helper := '&amp;METAOP_ZIP'; $t := nqp::uc($t); }
  
  my $metapast := QAST::Op.new( :op&lt;call&gt;, :name($helper), WANTED($basepast,'infixish') );
  $metapast.push(QAST::Var.new(:name(baseop_reduce($base&lt;OPER&gt;&lt;O&gt;.made)), :scope&lt;lexical&gt;))
    if $metasym eq 'X' || $metasym eq 'Z';
[...]
</code></pre><p>å®ƒè¯´ï¼Œå¦‚æœåœ¨ä»£ç ä¸­è§£æäº†å…ƒæ“ä½œç¬¦ <code>R</code>ã€<code>Z</code> æˆ– <code>X</code>ï¼Œå°±åº”è¯¥åœ¨è¯­æ³•æ ‘ä¸­æ·»åŠ ä¸€äº› <code>METAOP_</code> å‡½æ•°è°ƒç”¨ã€‚åœ¨ <code>Z</code> å’Œ <code>X</code> çš„æƒ…å†µä¸‹ï¼Œå®ƒä¼šå¤šä¸€ä¸ªå‚æ•°ï¼Œå³æŸç§è¿˜åŸå‡½æ•°ã€‚æ‰€æœ‰è¿™äº›åŠŸèƒ½éƒ½å¯ä»¥åœ¨ <code>rakudo/src/core.c/metaops.pm6</code> ä¸­æ‰¾åˆ°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">METAOP_REVERSE</span><span class="p">(</span>\<span class="n">op</span><span class="p">)</span> <span class="k">is</span> <span class="nc">implementation-detail</span> <span class="p">{</span>
  <span class="k">-&gt;</span> <span class="o">|</span><span class="nb">args</span> <span class="p">{</span> <span class="n">op</span><span class="o">.</span><span class="p">(</span><span class="o">|</span><span class="nb">args</span><span class="o">.</span><span class="nb">reverse</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">METAOP_ZIP</span><span class="p">(</span>\<span class="n">op</span><span class="o">,</span> <span class="nv">&amp;reduce</span><span class="p">)</span> <span class="k">is</span> <span class="nc">implementation-detail</span> <span class="p">{</span>
 <span class="nf">nqp::if</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="nf">prec</span><span class="p">(&#39;</span><span class="s1">thunky</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">starts-with</span><span class="p">(&#39;</span><span class="s1">.</span><span class="p">&#39;)</span><span class="o">,</span>
  <span class="k">-&gt;</span> <span class="o">+</span><span class="n">lol</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$arity</span> <span class="o">=</span> <span class="n">lol</span><span class="o">.</span><span class="nb">elems</span><span class="p">;</span>
    <span class="o">[...]</span>
  <span class="p">}</span><span class="o">,</span>
  <span class="k">-&gt;</span> <span class="o">+</span><span class="n">lol</span> <span class="p">{</span>
    <span class="nb">Seq</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="n">Rakudo::Iterator</span><span class="o">.</span><span class="nf">ZipIterablesOp</span><span class="p">(</span><span class="n">lol</span><span class="o">,</span><span class="n">op</span><span class="p">))</span>
  <span class="p">}</span>
  <span class="p">)</span>
<span class="p">}</span>
</code></pre></div><p>ç»™ä½ ï¼š</p>
<ol>
<li><code>\op</code> æ˜¯ç”±æˆ‘ä»¬çš„å…ƒæ“ä½œç¬¦ï¼Œå³-ï¼Œåœ¨å‰é¢çš„æ“ä½œã€‚</li>
<li>Trait <code>implementation-detail</code> åªæ˜¯è¡¨æ˜è¿™ä¸æ˜¯å…¬å…±ä»£ç ï¼Œæ˜¯ç¼–è¯‘å™¨å®ç°çš„ä¸€éƒ¨åˆ†ã€‚</li>
<li>ç”±äº-æ“ä½œæ²¡æœ‰ç¬¨é‡çš„ç‰¹æ€§ï¼Œæ‰€ä»¥ <code>&amp;reduce</code> å‡½æ•°ä¸ä¼šå‚ä¸è®¡ç®—ï¼Œ<code>Z</code> çš„ç»“æœæ˜¯ <code>Seq.new(...)</code>ã€‚</li>
<li><code>R</code> çš„ç»“æœæ˜¯ä¸€ä¸ªæ“ä½œè°ƒç”¨ - å‚æ•°é¡ºåºç›¸åã€‚</li>
</ol>
<p>è¿™æ—¶æˆ‘æƒ³èµ·è¿˜æœ‰ä¸€ä¸ª - ç›®æ ‡ï¼Œå³æ˜Ÿã€‚å®ƒå°†æ˜¾ç¤ºè¡ŒåŠ¨çš„ç»“æœã€‚</p>
<pre><code>&gt; ./rakudo-m --target=ast ~/test.raku
[...]
- QAST::Op(call &amp;s) &lt;sunk&gt; :statement_id&lt;4&gt; s(:foo(3 R- 2))
  - QAST::Op+{QAST::SpecialArg}(call :named&lt;foo&gt;) &lt;wanted&gt; :statement_id&lt;5&gt; :before_promotion&lt;?&gt; R-
    - QAST::Op(call &amp;METAOP_REVERSE) &lt;wanted&gt; :is_pure&lt;?&gt;
      - QAST::Var(lexical &amp;infix:&lt;-&gt;) &lt;wanted&gt;
    - QAST::Want &lt;wanted&gt; 3
      - QAST::WVal(Int)
      - Ii
      - QAST::IVal(3)  3
    - QAST::Want &lt;wanted&gt; 2
      - QAST::WVal(Int)
      - Ii
      - QAST::IVal(2)  2
[...]
- QAST::Op(call &amp;s) &lt;sunk&gt; :statement_id&lt;7&gt; s(:foo(3 Z- 2))
  - QAST::Op+{QAST::SpecialArg}(:named&lt;foo&gt;) &lt;wanted&gt; :statement_id&lt;8&gt; :before_promotion&lt;?&gt; Z-
    - QAST::Op(call &amp;METAOP_ZIP) &lt;wanted&gt; :is_pure&lt;?&gt;
      - QAST::Var(lexical &amp;infix:&lt;-&gt;) &lt;wanted&gt;
      - QAST::Var(lexical &amp;METAOP_REDUCE_LEFT)
    - QAST::Want &lt;wanted&gt; 3
      - QAST::WVal(Int)
      - Ii
      - QAST::IVal(3)  3
    - QAST::Want &lt;wanted&gt; 2
      - QAST::WVal(Int)
      - Ii
      - QAST::IVal(2)  2
[...]
</code></pre><p>ä¸€å¦‚æ‰€æ–™ã€‚é™¤äº†è°ƒç”¨ä¸åŒçš„ <code>METAOP_</code> å‡½æ•°å¤–ï¼Œæ‰€æœ‰çš„ä¸œè¥¿å‡ ä¹éƒ½æ˜¯ä¸€æ ·çš„ã€‚ä»å®ƒä»¬çš„ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼ŒåŸåˆ™ä¸Šè¿™äº›å‡½æ•°çš„ä¸åŒä¹‹å¤„åœ¨äºè¿”å›å€¼çš„ç±»å‹ - åˆ†åˆ«æ˜¯ <code>Int</code> å’Œ <code>Seq</code>ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒRaku å¯¹ä¸åŒç±»å‹çš„å¯¹è±¡çš„ä¸Šä¸‹æ–‡ç›¸å½“æ•æ„Ÿ&hellip;&hellip;æˆ‘æƒ³ï¼Œå®ƒå…³æ³¨çš„å¯èƒ½æ˜¯è¿”å›å€¼ã€‚æˆ‘è¯•ç€ç”¨ä¸‹é¢çš„æ–¹å¼ä¿®æ”¹ä»£ç ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">METAOP_REVERSE</span><span class="p">(</span>\<span class="n">op</span><span class="p">)</span> <span class="k">is</span> <span class="nc">implementation-detail</span> <span class="p">{</span>
  <span class="k">-&gt;</span> <span class="o">|</span><span class="nb">args</span> <span class="p">{</span> <span class="nb">Seq</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="n">op</span><span class="o">.</span><span class="p">(</span><span class="o">|</span><span class="nb">args</span><span class="o">.</span><span class="nb">reverse</span><span class="p">))</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>ç¼–è¯‘ã€è¿è¡Œã€‚</p>
<pre><code>&gt; make
[...]
Stage start      :   0.000
Stage parse      :  61.026
Stage syntaxcheck:   0.000
Stage ast        :   0.000
Stage optimize   :   7.076
Stage mast       :  14.120
Stage mbc        :   3.941
[...]
&gt; ./rakudo-m ~/test.raku
\(-1)
\(:foo((1,).Seq))
</code></pre><p>ä¸€åˆ‡éƒ½æ²¡æœ‰æ”¹å˜ã€‚æ‰€ä»¥ï¼Œä¸æ˜¯è¿”å›å€¼&hellip;&hellip;æƒ³äº†æƒ³ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆç»“æœåˆæ˜¯ <code>-1</code> è€Œä¸æ˜¯ <code>(-1,).Seq</code>ã€‚è€Œä¸”ï¼Œä»ä»£ç æ¥çœ‹ï¼Œ<code>Seq</code> æ ¹æœ¬å°±æ²¡æœ‰ä¸€ä¸ªåˆé€‚çš„æ„é€ å‡½æ•°ã€‚ä¸‹ä¸€æ¬¡ï¼Œä½œä¸ºä¸€äº›ç–¯ç‹‚çš„äº‹æƒ…ï¼Œæˆ‘å°è¯•è°ƒç”¨ <code>METAOP_REVERSE</code> ç»“æœåªæ˜¯ä¸ºäº†å´©æºƒã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">METAOP_REVERSE</span><span class="p">(</span>\<span class="n">op</span><span class="p">)</span> <span class="k">is</span> <span class="nc">implementation-detail</span> <span class="p">{</span>
  <span class="k">-&gt;</span> <span class="o">|</span><span class="nb">args</span> <span class="p">{</span> <span class="nb">die</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>ç¼–è¯‘ã€è¿è¡Œã€‚</p>
<pre><code>&gt; make
[...]
&gt; ./rakudo-m ~/test.raku
\(-1)
\(:foo((1,).Seq))
</code></pre><p>æ€ä¹ˆä¼šå‘¢ï¼Ÿè¯­æ³•æ ‘ä¸­åŒ…å«äº†å¯¹ <code>METAOP_REVERSE</code> çš„è°ƒç”¨ï¼Œå®ƒçš„ä»£ç åº”è¯¥æ˜¯æŠ˜å çš„ï¼Œä½†è®¡ç®—ä»ç„¶è¿›è¡Œï¼Œæˆ‘ä»¬å¾—åˆ° <code>-1</code>ã€‚</p>
<p>è¿™äº›éƒ½ä¸æ˜¯ã€Šè¡ŒåŠ¨ã€‹ã€‚</p>
<p>è¿™é‡Œæˆ‘çš„ç›®å…‰è½åœ¨ç¼–è¯‘å™¨çš„æ„å»ºæ—¥å¿—ä¸Šã€‚å®ƒæ˜¯ä¸€äº›é˜¶æ®µè¢«åˆ—åœ¨é‚£é‡Œã€‚æˆ‘éšæœºè¯•äº† <code>--target=mast</code>ã€‚</p>
<pre><code>&gt; ./rakudo-m --target=mast ~/test.raku
[...]
MAST::Frame name&lt;s&gt;, cuuid&lt;1&gt;
  Local types: 0&lt;obj&gt;, 1&lt;obj&gt;, 2&lt;obj&gt;, 3&lt;obj&gt;, 4&lt;int&gt;, 5&lt;str&gt;, 6&lt;obj&gt;, 7&lt;obj&gt;, 8&lt;obj&gt;,
  Lexical types: 0&lt;obj&gt;, 1&lt;obj&gt;, 2&lt;obj&gt;, 3&lt;obj&gt;, 4&lt;obj&gt;,
  Lexical names: 0&lt;c&gt;, 1&lt;$Â¢&gt;, 2&lt;$!&gt;, 3&lt;$/&gt;, 4&lt;$*DISPATCHER&gt;,
  Lexical map: $!&lt;2&gt;, c&lt;0&gt;, $*DISPATCHER&lt;4&gt;, $Â¢&lt;1&gt;, $/&lt;3&gt;,
  Outer: name&lt;&lt;unit&gt;&gt;, cuuid&lt;2&gt;
[...]
</code></pre><p>æŸç§ä¸å¯è¯»çš„çŸ©é˜µã€‚æ˜Ÿå·å’Œæ¡…æ†ä¹‹é—´æœ‰ä¸€ä¸ªé˜¶æ®µæ€§çš„ä¼˜åŒ–ã€‚</p>
<pre><code>&gt; ./rakudo-m --target=optimize ~/test.raku
[...]
- QAST::Op(callstatic &amp;s) &lt;sunk&gt; :statement_id&lt;4&gt; s(:foo(3 R- 2))
  - QAST::Op(call &amp;infix:&lt;-&gt;)  :METAOP_opt_result&lt;?&gt;
    - QAST::Want &lt;wanted&gt; 2
      - QAST::WVal(Int)
      - Ii
      - QAST::IVal(2)  2
    - QAST::Want &lt;wanted&gt; 3
      - QAST::WVal(Int)
      - Ii
      - QAST::IVal(3)  3
[...]
- QAST::Op(callstatic &amp;s) &lt;sunk&gt; :statement_id&lt;7&gt; s(:foo(3 Z- 2))
  - QAST::Op+{QAST::SpecialArg}(call :named&lt;foo&gt;) &lt;wanted&gt; :statement_id&lt;8&gt; :before_promotion&lt;?&gt; Z-
    - QAST::Op(callstatic &amp;METAOP_ZIP) &lt;wanted&gt; :is_pure&lt;?&gt;
      - QAST::Var(lexical &amp;infix:&lt;-&gt;) &lt;wanted&gt;
      - QAST::Var(lexical &amp;METAOP_REDUCE_LEFT)
    - QAST::Want &lt;wanted&gt; 3
      - QAST::WVal(Int)
      - Ii
      - QAST::IVal(3)  3
    - QAST::Want &lt;wanted&gt; 2
      - QAST::WVal(Int)
      - Ii
      - QAST::IVal(2)  2
[...]
</code></pre><p>å“ˆï¼Œå°±æ˜¯è¿™æ ·ã€‚åœ¨ä¼˜åŒ–é˜¶æ®µåï¼Œè¡Œå°†å¤±è¸ªã€‚</p>
<ul>
<li><code>QAST::Op+{QAST::SpecialArg}(call :named&lt;foo&gt;) &lt;wanted&gt; :statement_id&lt;5&gt; :before_promotion&lt;?&gt; R-.</code>
å¹¶å°†æ•´ä¸ª <code>METAOP_REVERSE</code> è°ƒç”¨æ›¿æ¢ä¸ºé€šå¸¸çš„æ“ä½œ <code>(&amp;infix:&lt;-&gt;)</code>ã€‚æ‰€ä»¥é—®é¢˜ä¸€å®šåœ¨ä¼˜åŒ–å™¨çš„æŸä¸ªåœ°æ–¹ã€‚</li>
</ul>
<p>åªæœ‰åœ¨ <code>optim_nameless_call</code> æ–¹æ³•ä¸­æ‰ä¼šæåˆ° <code>&amp;METAOP_ASSIGN</code>ï¼Œå…¶ä¸­ <code>QAST::Op+{QAST::SpecialArg}(call :named&lt;foo&gt;)</code>ã€‚æ˜¾ç„¶ï¼Œè¿™ä¸ªæ“ä½œè´Ÿè´£ç”Ÿæˆä¸€ä¸ªå‘½åå¯¹ - å®ƒå·²ç»æœ‰äº†ä¸€ä¸ªåå­—ï¼ˆå‘½åå‚æ•°ï¼‰ï¼Œå®ƒéœ€è¦è®¡ç®—å€¼ã€‚ä»ä¼˜åŒ– <code>_</code> æ— åæ–¹æ³•çš„æ‰§è¡Œè·¯å¾„æ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼Œæˆ‘ä»¬å¯¹æœ€åä¸€ä¸ªå—æ„Ÿå…´è¶£ã€‚</p>
<pre><code>[...]
  elsif self.op_eq_core($metaop, '&amp;METAOP_REVERSE') {
    return NQPMu unless nqp::istype($metaop[0], QAST::Var)
      &amp;&amp; nqp::elems($op) == 3;
    return QAST::Op.new(:op&lt;call&gt;, :name($metaop[0].name),
      $op[2], $op[1]).annotate_self: 'METAOP_opt_result', 1;
  }
[...]
</code></pre><p>è®©æˆ‘æé†’ä½ ï¼Œä¼˜åŒ–å‰çš„æ ‘æ˜¯è¿™æ ·çš„ã€‚</p>
<pre><code>[...]
- QAST::Op(call &amp;s) &lt;sunk&gt; :statement_id&lt;4&gt; s(:foo(3 R- 2))
  - QAST::Op+{QAST::SpecialArg}(call :named&lt;foo&gt;) &lt;wanted&gt; :statement_id&lt;5&gt; :before_promotion&lt;?&gt; R-
    - QAST::Op(call &amp;METAOP_REVERSE) &lt;wanted&gt; :is_pure&lt;?&gt;
      - QAST::Var(lexical &amp;infix:&lt;-&gt;) &lt;wanted&gt;
    - QAST::Want &lt;wanted&gt; 3
    - QAST::Want &lt;wanted&gt; 2
[...]
</code></pre><p>è€Œç²¾ç®€ä¹‹åï¼Œæ˜¯è¿™æ ·çš„ã€‚</p>
<pre><code>[...]
- QAST::Op(callstatic &amp;s) &lt;sunk&gt; :statement_id&lt;4&gt; s(:foo(3 R- 2))
  - QAST::Op(call &amp;infix:&lt;-&gt;)  :METAOP_opt_result&lt;?&gt;
    - QAST::Want &lt;wanted&gt; 2
    - QAST::Want &lt;wanted&gt; 3
[...]
</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¼˜åŒ– <code>_nameless_call</code> åšäº†ä»¥ä¸‹å·¥ä½œã€‚</p>
<p>å¦‚æœæˆ‘ä»¬çš„ <code>QAST::Op+{QAST::SpecialArg}</code> æ“ä½œæ²¡æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œå¦‚æœ <code>METAOP_REVERSE</code> è°ƒç”¨æ²¡æœ‰ä¸€ä¸ªæ­£ç¡®çš„ç±»å‹ï¼Œæˆ‘ä»¬å°±è¿”å›ç©ºã€‚è¿™ä¸æ˜¯æˆ‘ä»¬çš„æƒ…å†µã€‚
å¦åˆ™ï¼Œæˆ‘ä»¬å°†è¿”å›ä¸€ä¸ªæ–°çš„æ“ä½œï¼Œä»£æ›¿æˆ‘ä»¬çš„ <code>QAST::Op+{QAST::SpecialArg}</code> æ“ä½œï¼Œä»¥ç›¸åçš„é¡ºåºè°ƒç”¨ <code>&amp;infix:&lt;-&gt;</code> å‚æ•°ã€‚å°±æ˜¯è¯´ï¼ŒæŠŠç»“æœæ‰“åŒ…æˆä¸€å¯¹å°±æ²¡äº†ã€‚</p>
<p>åœ¨æ‘¸ç´¢äº†ä¸€ä¸‹å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¹¶é˜…è¯»äº† <code>QAST::SpecialArg</code> å’Œ <code>QAST::Node</code> çš„å®ç°åï¼Œæˆ‘æƒ³åˆ°äº†ä¸‹é¢çš„ä»£ç ã€‚</p>
<pre><code>[...]
  elsif self.op_eq_core($metaop, '&amp;METAOP_REVERSE') {
    return NQPMu unless nqp::istype($metaop[0], QAST::Var)
      &amp;&amp; nqp::elems($op) == 3;
    my $opt_result := QAST::Op.new(:op&lt;call&gt;, :name($metaop[0].name),
      $op[2], $op[1]).annotate_self: 'METAOP_opt_result', 1;
    if $op.named { $opt_result.named($op.named) } # æ·»åŠ é€‰é¡¹ named 
    if $op.flat { $opt_result.flat($op.flat) }    # æ·»åŠ é€‰é¡¹ flat
    return $opt_result;
  }
[...]
</code></pre><p>è¿˜æœ‰æœ¨å¤´ã€‚</p>
<pre><code>[...]
- QAST::Op(callstatic &amp;s) &lt;sunk&gt; :statement_id&lt;4&gt; s(:foo(3 R- 2))
  - QAST::Op+{QAST::SpecialArg}(call &amp;infix:&lt;-&gt; :named&lt;foo&gt;)  :METAOP_opt_result&lt;?&gt;
    - QAST::Want &lt;wanted&gt; 2
    - QAST::Want &lt;wanted&gt; 3
[...]
</code></pre><p>å‘½åçš„å‚æ•°è¿”å›åˆ°å®ƒçš„ä½ç½®ã€‚æµ‹è¯•ä¹Ÿå¼€å§‹é€šè¿‡ã€‚</p>
<pre><code>&gt; make t/spec/S03-metaops/reverse.t
[...]
All tests successful.
Files=1, Tests=70,  3 wallclock secs ( 0.03 usr  0.01 sys +  3.61 cusr  0.17 csys =  3.82 CPU)
Result: PASS
</code></pre><p>æˆ‘ä»¬æœ¬å¯ä»¥å°±æ­¤æ‰“ä½ï¼Œä½†è¿™æ˜¯ç¼–è¯‘å™¨ä¼˜åŒ–å™¨çš„ä»£ç ï¼Œå®ƒçš„ç»“æœæ˜¯ä¸€ä¸ªæœ‰ä¸¤ä¸ªæ•´æ•°å‚æ•°çš„æ–¹æ³•è°ƒç”¨ã€‚æˆ‘è®¤ä¸ºè¿™åœ¨æŸç§ç¨‹åº¦ä¸Šæ˜¯æ¬¡ä¼˜çš„ã€‚å¦‚æœæˆ‘ä»¬å°†è¿”å›è¡¨è¾¾å¼æ”¹ä¸ºè¿”å› <code>self.visit_op: $opt_result;</code>ï¼Œå¯¹äº§ç”Ÿçš„éä¼˜åŒ–æ“ä½œè°ƒç”¨ä¼˜åŒ–å™¨ï¼Œé‚£ä¹ˆäº§ç”Ÿçš„æ ‘å°±ä¼šåƒè¿™æ ·ã€‚</p>
<pre><code>[...]
- QAST::Op(callstatic &amp;s) &lt;sunk&gt; :statement_id&lt;4&gt; s(:foo(3 R- 2))
  - QAST::Want+{QAST::SpecialArg}(:named&lt;foo&gt;)
    - QAST::WVal+{QAST::SpecialArg}(Int :named&lt;foo&gt;)
    - QAST::IVal(-1)
[...]
</code></pre><p>ç°åœ¨ä¸€åˆ‡éƒ½å¾ˆç†æƒ³ã€‚</p>
<h2 id="åˆ†äº«æˆæœ">åˆ†äº«æˆæœ</h2>
<p>æˆ‘ä»¬å·²ç»åˆ°äº†ç»ˆç‚¹çº¿ã€‚ç°åœ¨æˆ‘ä»¬åªéœ€è¦åˆ†äº«æˆ‘ä»¬çš„ç»éªŒã€‚</p>
<ol>
<li>é‡è¦çš„æ˜¯ï¼šè¿è¡Œæ‰€æœ‰çš„ <code>make spectest</code> æµ‹è¯•ï¼Œç¡®ä¿æ²¡æœ‰æ–°çš„ä¸œè¥¿è¢«ç ´åã€‚</li>
<li>åœ¨ GitHub ä¸Šä½¿ç”¨ Rakudo ç¼–è¯‘å™¨å’Œæµ‹è¯•åˆ¶ä½œ fork ä»“åº“ã€‚</li>
<li>å°† fork ä»“åº“æ·»åŠ ä¸ºæ–°çš„ git è¿œç¨‹ä»“åº“ã€‚</li>
<li>cd ~/dev-rakudo/rakudo &amp;&amp; git remote add fork <!-- raw HTML omitted -->ã€‚</li>
<li>cd ~/dev-rakudo/t/spec &amp;&amp; git remote add fork <!-- raw HTML omitted -->ã€‚</li>
</ol>
<p>é‡è¦ï¼šç¡®ä¿ä¸¤ä¸ªä»“åº“åœ¨ git ä¸­éƒ½æœ‰æ­£ç¡®çš„ç”¨æˆ·åå’Œç”¨æˆ·é‚®ç®±ã€‚</p>
<p>æäº¤åˆ°ä¸¤ä¸ªç‰ˆæœ¬åº“ï¼Œè¯¦ç»†è¯´æ˜ä½ ä¸ºä»€ä¹ˆåšäº†å“ªäº›æ”¹åŠ¨ï¼Œå¹¶æ·»åŠ å¯¹åŸå§‹é—®é¢˜è·Ÿè¸ªå™¨çš„å¼•ç”¨ã€‚</p>
<p>è¿è¡Œæäº¤ã€‚</p>
<pre><code>cd ~/dev-rakudo/rakudo &amp;&amp; git push fork
cd ~/dev-rakudo/t/spec &amp;&amp; git push fork
</code></pre><p>å‘ä¸¤ä¸ªä»“åº“æå‡ºæ‹‰å–è¯·æ±‚ã€‚åœ¨ä»–ä»¬çš„æè¿°ä¸­ï¼Œæœ€å¥½æ˜¯ç›¸äº’å‚ç…§å’ŒåŸä»»åŠ¡ã€‚</p>
<h2 id="ç»“è®º">ç»“è®º</h2>
<p>å¯¹å¼€æºè½¯ä»¶çš„è´¡çŒ®æ˜¯ï¼š</p>
<ol>
<li>è¶£å‘³æ€§å’Œè¶£å‘³æ€§ã€‚</li>
<li>ç»™ä½ çš„æ„Ÿè§‰æ˜¯ï¼Œä½ æ­£åœ¨åšä¸€äº›æœ‰ç”¨çš„äº‹æƒ…ï¼Œä½ çœŸçš„æ˜¯ã€‚</li>
<li>è®©ä½ è®¤è¯†æ–°çš„æœ‰è¶£å’Œä¸“ä¸šçš„äººï¼ˆä»»ä½•å…³äº Raku çš„é—®é¢˜éƒ½ä¼šåœ¨ <code>#raku IRC</code> é¢‘é“ä¸­å¾—åˆ°å›ç­”ï¼‰ã€‚</li>
<li>è§£å†³éæ ‡å‡†ä»»åŠ¡ï¼Œæ²¡æœ‰æˆªæ­¢æ—¥æœŸçš„å‹åŠ›ï¼Œæ˜¯ä¸€ç§å¾ˆå¥½çš„ä½“éªŒã€‚</li>
</ol>
<p>é€‰æ‹©ä½ è§‰å¾—æœ€èˆ’æœçš„è§’è‰²ç­‰çº§ï¼Œå»åšæ–°çš„ä»»åŠ¡å§!</p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/raku" term="raku" label="Raku" />
                             
                                <category scheme="https://ohmyweekly.github.io/tags/rakulang" term="rakulang" label="Rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[è´ªå©ª Junction çš„å¥‡é—»å¼‚äº‹]]></title>
            <link href="https://ohmyweekly.github.io/notes/2020-10-04-the-strange-case-of-the-greedy-junction/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2020-10-04-reconstructing-raku-junctions/?utm_source=atom_feed" rel="related" type="text/html" title="é‡æ„ Raku çš„ Junction" />
            
                <id>https://ohmyweekly.github.io/notes/2020-10-04-the-strange-case-of-the-greedy-junction/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2020-10-04T00:00:00+08:00</published>
            <updated>2020-10-04T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>The Strange Case of the Greedy Junction</blockquote><h2 id="è´ªå©ª-junction-çš„å¥‡é—»å¼‚äº‹">è´ªå©ª junction çš„å¥‡é—»å¼‚äº‹</h2>
<p>è¯´æ˜ Raku çš„ junction æ˜¯å¦‚ä½•è´ªå©ªçš„è®¾è®¡ï¼Œä»¥åŠä¸€ä¸ªå»ºè®®ã€‚</p>
<p><a href="https://raku.org/">Raku</a> æœ‰ä¸€ä¸ªæ•´æ´çš„åŠŸèƒ½ï¼Œå«åš <a href="https://docs.raku.org/type/Junction">Junction</a>ã€‚åœ¨è¿™ç¯‡çŸ­æ–‡ä¸­ï¼Œæˆ‘æƒ³å¼ºè°ƒä¸€ä¸‹ junction ä¸å‡½æ•°äº¤äº’çš„ä¸€ä¸ªç‰¹æ®Šåæœï¼šå®ƒä»¬æ˜¯è´ªå©ªçš„ï¼Œæˆ‘çš„æ„æ€æ˜¯å®ƒä»¬ä¼šæ— æ„ä¸­æŠŠå‡½æ•°çš„å…¶ä»–å‚æ•°å˜æˆ junctionã€‚ä¸ºäº†è¯´æ˜è¿™ç§è¡Œä¸ºï¼Œæˆ‘å°†ä½¿ç”¨ä¸€ä¸ªé—­åŒ…åˆ›å»ºä¸€ä¸ª <code>pair</code> æ•°æ®ç»“æ„ï¼Œå®ƒå¯ä»¥æ¥å—ä¸¤ä¸ªä¸åŒç±»å‹çš„å€¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">enum</span> <span class="n">RGB</span> <span class="p">&lt;</span><span class="s">R G B</span><span class="p">&gt;;</span>

<span class="c1"># Pair Constructor: the arguments of pair() are captured</span>
<span class="c1"># in a closure that is returned</span>
<span class="k">sub</span> <span class="nb">pair</span><span class="p">(</span>\<span class="nb">x</span><span class="o">,</span> \<span class="n">y</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">sub</span> <span class="p">(</span><span class="nv">&amp;p</span><span class="p">){</span> <span class="nf">p</span><span class="p">(</span><span class="nb">x</span><span class="o">,</span> <span class="n">y</span><span class="p">)</span> <span class="p">}</span> 
<span class="p">}</span>
</code></pre></div><p>æ‰€ä»¥ <code>pair</code> æ¥å—ä¸¤ä¸ªä»»æ„ç±»å‹çš„å‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªä»¥å‡½æ•°ä¸ºå‚æ•°çš„é—­åŒ…ã€‚æˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªå‡½æ•°æ¥è®¿é—®å­˜å‚¨åœ¨ <code>pair</code> ä¸­çš„å€¼ã€‚æˆ‘å°†æŠŠè¿™äº›è®¿é—®(accessor)å‡½æ•°ç§°ä¸º <code>fst</code> å’Œ <code>snd</code>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># Accessors to get the values from the closure</span>
<span class="k">my</span> <span class="k">sub</span> <span class="nf">fst</span> <span class="p">(</span><span class="nv">&amp;p</span><span class="p">)</span> <span class="p">{</span><span class="nf">p</span><span class="p">(</span> <span class="k">sub</span> <span class="p">(</span>\<span class="nb">x</span><span class="o">,</span>\<span class="n">y</span><span class="p">){</span><span class="nb">x</span><span class="p">})}</span>
<span class="k">my</span> <span class="k">sub</span> <span class="nf">snd</span> <span class="p">(</span><span class="nv">&amp;p</span><span class="p">)</span> <span class="p">{</span><span class="nf">p</span><span class="p">(</span> <span class="k">sub</span> <span class="p">(</span>\<span class="nb">x</span><span class="o">,</span>\<span class="n">y</span><span class="p">){</span><span class="n">y</span><span class="p">})}</span>
</code></pre></div><p>åšå®é™…é€‰æ‹©çš„å‡½æ•°æ˜¯ç”± <code>fst</code> å’Œ <code>snd</code> è¿”å›çš„åŒ¿åå­ç¨‹åºï¼Œè¿™çº¯ç²¹æ˜¯ä¸ºäº†è®©æˆ‘å¯ä»¥å°†å®ƒä»¬åº”ç”¨äº <code>pair</code>ï¼Œè€Œä¸æ˜¯å¿…é¡»å°†å®ƒä»¬ä½œä¸ºå‚æ•°ä¼ é€’ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ï¼Œä¸€ä¸ª <code>Int</code> å’Œä¸€ä¸ª <code>RGB</code> çš„ pairã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">\p1</span> <span class="o">=</span> <span class="nb">pair</span> <span class="mi">42</span><span class="o">,</span> <span class="ow">R</span><span class="err">;</span>

<span class="k">if</span> <span class="p">(</span> <span class="mi">42</span> <span class="o">==</span> <span class="n">fst</span> <span class="n">p1</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="n">snd</span> <span class="n">p1</span><span class="p">;</span>	<span class="k">#=</span><span class="p">&gt;</span><span class="sd"> says &#34;R&#34;
</span><span class="sd">}
</span></code></pre></div><p>æ‰€ä»¥æˆ‘ä»¬ç”¨ä¸¤ä¸ªå€¼è°ƒç”¨ <code>pair</code> æ¥åˆ›å»ºä¸€ä¸ª pairï¼Œå¹¶ä½¿ç”¨ <code>fst</code> å’Œ <code>snd</code> æ¥è®¿é—® pair ä¸­çš„å€¼ã€‚è¿™æ˜¯ä¸€ä¸ªä¸å¯å˜çš„æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥ä¸å¯èƒ½è¿›è¡Œæ›´æ–°ã€‚</p>
<p>ç°åœ¨è®©æˆ‘ä»¬ä½¿ç”¨ junction ä½œä¸ºå…¶ä¸­ä¸€ä¸ªå‚æ•°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># Example instance with a &#39;one&#39;-type junction</span>
<span class="k">my</span> <span class="nb">Junction</span> \<span class="n">p1j</span> <span class="o">=</span> <span class="nb">pair</span> <span class="p">(</span><span class="mi">42</span><span class="o">^</span><span class="mi">43</span><span class="p">)</span><span class="o">,</span><span class="ow">R</span><span class="err">;</span>

<span class="k">if</span> <span class="p">(</span> <span class="mi">42</span> <span class="o">==</span> <span class="n">fst</span> <span class="n">p1j</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="n">snd</span> <span class="n">p1j</span><span class="p">;</span> <span class="k">#=</span><span class="p">&gt;</span><span class="sd"> one(R, R)
</span><span class="sd">}
</span></code></pre></div><p>è¿™é‡Œå‘ç”Ÿçš„æƒ…å†µæ˜¯ï¼ŒåŸå§‹å‚æ•° <code>R</code> å·²ç»ä¸å¯é€†è½¬åœ°å˜æˆäº†ä¸è‡ªå·±çš„ junctionï¼Œå°½ç®¡æˆ‘ä»¬ä»æœªæ˜ç¡®åœ°åœ¨ <code>R</code> ä¸Šåˆ›å»ºè¿‡ junctionï¼Œä½†è¿˜æ˜¯å‘ç”Ÿäº†è¿™ç§æƒ…å†µã€‚è¿™æ˜¯å°† junction ç±»å‹åº”ç”¨äºå‡½æ•°çš„ç»“æœï¼Œå®ƒä¸æ˜¯ä¸€ä¸ª bugï¼Œåªæ˜¯ junction è¡Œä¸ºçš„ä¸€ä¸ªå½±å“ã€‚æ›´è¯¦ç»†çš„è§£é‡Šï¼Œè¯·çœ‹æˆ‘çš„æ–‡ç« &quot;<a href="https://gist.github.com/wimvanderbauwhede/19cc1e8d04e9a477f58cfe7288a6172e">é‡æ„ Raku çš„ Junction</a>&quot;ã€‚</p>
<p><a href="https://docs.raku.org/type/Junction">Raku å…³äº junction çš„æ–‡æ¡£</a>ä¸­è¯´ï¼Œä½ ä¸åº”è¯¥çœŸæ­£å°è¯•ä» junction ä¸­è·å–å€¼ã€‚</p>
<p>&ldquo;Junction æ˜¯ç”¨æ¥ä½œä¸ºå¸ƒå°”ä¸Šä¸‹æ–‡ä¸­çš„åŒ¹é…å™¨ï¼Œä¸æ”¯æŒ junction çš„è‡ªçœã€‚å¦‚æœä½ è§‰å¾—æœ‰è‡ªçœ junction çš„å†²åŠ¨ï¼Œè¯·ä½¿ç”¨ Set æˆ–ç›¸å…³ç±»å‹ä»£æ›¿ã€‚&rdquo;</p>
<p>ç„¶è€Œï¼Œæœ‰ä¸€ä¸ª FAQ <a href="https://docs.raku.org/language/faq#index-entry-Junction_(FAQ)">å‹‰å¼ºåœ°å‘Šè¯‰ä½ å¦‚ä½•åš</a>ã€‚FAQ å†æ¬¡è­¦å‘Šä¸è¦è¿™æ ·åšã€‚</p>
<p>&ldquo;å¦‚æœä½ æƒ³ä» junction ä¸­æå–å€¼ï¼ˆç‰¹å¾æ€ï¼‰ï¼Œä½ å¯èƒ½åšé”™äº†ä»€ä¹ˆï¼Œåº”è¯¥ç”¨ Set æ¥ä»£æ›¿ã€‚&rdquo;</p>
<p>ç„¶è€Œï¼Œæ­£å¦‚æˆ‘æ‰€ä¸¾çš„ä¾‹å­æ‰€è¯æ˜çš„é‚£æ ·ï¼Œä» junction ä¸­æ¢å¤å€¼æ˜¯æœ‰æ˜ç¡®çš„ç”¨ä¾‹çš„ã€‚å½“ç„¶ï¼Œä»…ä»…å› ä¸ºå¦ä¸€ä¸ªå€¼æ°å¥½æ˜¯ junctionï¼Œå­˜å‚¨åœ¨ pair ä¸­çš„å…¶ä¸­ä¸€ä¸ªå€¼å°±å˜å¾—ä¸å¯è®¿é—®ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬çš„æœ¬æ„ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘å»ºè®®å¢åŠ ä¸€ä¸ªæŠ˜å (<code>collapse</code>)å‡½æ•°ï¼Œå…è®¸å°†è¿™äº›æ— æ„ä¸­å‡ºç°çš„ junction å€¼æŠ˜å æˆå®ƒä»¬çš„åŸå§‹å€¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="p">(</span> <span class="mi">42</span> <span class="o">==</span> <span class="n">fst</span> <span class="n">p1j</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nf">collapse</span><span class="p">(</span><span class="n">snd</span> <span class="n">p1j</span><span class="p">);</span> <span class="k">#=</span><span class="p">&gt;</span><span class="sd"> says &#39;R&#39;
</span><span class="sd">}
</span></code></pre></div><p>è¯¥å‡½æ•°çš„å®ç°å–è‡ª<a href="https://docs.raku.org/language/faq#index-entry-Junction_(FAQ)">ä¸Šè¿°å¸¸è§é—®é¢˜</a>ï¼Œå¹¶å¢åŠ äº†ä¸€ä¸ªæ£€æŸ¥ï¼Œä»¥ç¡®ä¿ junction ä¸Šçš„æ‰€æœ‰å€¼éƒ½ç›¸åŒã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">collapse</span><span class="p">(</span><span class="nb">Junction</span> \<span class="n">j</span><span class="p">)</span> <span class="p">{</span>    
    <span class="k">my</span> <span class="nv">@vvs</span><span class="p">;</span>
    <span class="k">-&gt;</span> <span class="nb">Any</span> \<span class="k">s</span> <span class="p">{</span><span class="sr"> push </span><span class="nv">@vvs</span><span class="sr">, s </span><span class="p">}</span><span class="o">.</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>    
    <span class="k">my</span> <span class="nv">$v</span> <span class="o">=</span>  <span class="nb">shift</span> <span class="nv">@vvs</span><span class="p">;</span>        
    <span class="k">my</span> <span class="nv">@ts</span> <span class="o">=</span> <span class="nb">grep</span> <span class="p">{</span><span class="o">!</span><span class="p">(</span><span class="nv">$_</span> <span class="o">~~</span> <span class="nv">$v</span><span class="p">)}</span><span class="o">,</span> <span class="nv">@vvs</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">@ts</span><span class="o">.</span><span class="nb">elems</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>  
        <span class="nv">$v</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nb">die</span> <span class="p">&#34;</span><span class="s2">Can&#39;t collapse this Junction: elements are not identical: </span><span class="p">{</span><span class="nv">$v</span><span class="o">,</span><span class="nv">@vvs</span><span class="p">}&#34;;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>å¦‚æœèƒ½æŠŠè¿™ä¸ªåŠŸèƒ½ä½œä¸ºä¸€ä¸ª <code>collapse</code> æ–¹æ³•æ·»åŠ åˆ° <code>Junction</code> ç±»ä¸­å°±æ›´å¥½äº†ã€‚</p>
<p>åŸæ–‡é“¾æ¥: <a href="https://gist.github.com/wimvanderbauwhede/85fb4b88ec53a0b8149e6c05740adcf8">https://gist.github.com/wimvanderbauwhede/85fb4b88ec53a0b8149e6c05740adcf8</a></p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/raku" term="raku" label="Raku" />
                             
                                <category scheme="https://ohmyweekly.github.io/tags/junction" term="junction" label="Junction" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[é‡æ„ Raku çš„ Junction]]></title>
            <link href="https://ohmyweekly.github.io/notes/2020-10-04-reconstructing-raku-junctions/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2020-10-04-the-strange-case-of-the-greedy-junction/?utm_source=atom_feed" rel="related" type="text/html" title="è´ªå©ª Junction çš„å¥‡é—»å¼‚äº‹" />
            
                <id>https://ohmyweekly.github.io/notes/2020-10-04-reconstructing-raku-junctions/</id>
            
            
                    <author>
                        <name>ç„‰çŸ¥éé±¼</name>
                    </author>
            <published>2020-10-04T00:00:00+08:00</published>
            <updated>2020-10-04T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Reconstructing Raku&rsquo;s Junctions</blockquote><h2 id="é‡æ„-raku-çš„-junction">é‡æ„ Raku çš„ Junction</h2>
<p>Raku ä¸­çš„ junction å¾ˆé…·ï¼Œä½†ä¹ä¸€çœ‹å®ƒä»¬å¹¶æ²¡æœ‰éµå¾ªé™æ€ç±»å‹åŒ–çš„è§„åˆ™ã€‚æˆ‘å¯¹å®ƒä»¬çš„å½¢å¼åŒ–ç±»å‹è¯­ä¹‰å¾ˆå¥½å¥‡ï¼Œæ‰€ä»¥æˆ‘ä»åŠŸèƒ½ã€é™æ€ç±»å‹çš„è§’åº¦å¯¹ junction è¿›è¡Œäº†è§£æ„å’Œé‡æ„ã€‚</p>
<h3 id="raku-ä¸­çš„-junction">Raku ä¸­çš„ Junction</h3>
<p><a href="https://docs.raku.org/">Raku</a> æœ‰ä¸€ä¸ªæ•´æ´çš„åŠŸèƒ½å«åš <a href="https://docs.raku.org/type/Junction">Junction</a>ã€‚Junction æ˜¯ä¸€ä¸ªæ— åºçš„å¤åˆå€¼ã€‚å½“ä½¿ç”¨ junction ä»£æ›¿å€¼æ—¶ï¼Œä¼šå¯¹æ¯ä¸ªç»“ç‚¹(junction)å…ƒç´ è¿›è¡Œæ“ä½œï¼Œç»“æœæ˜¯æ‰€æœ‰è¿™äº›æ“ä½œç¬¦çš„è¿”å›å€¼çš„ç»“ç‚¹(junction)ã€‚å½“åœ¨å¸ƒå°”ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ junction æ—¶ï¼Œç»“ç‚¹(junction)ä¼šæŠ˜å æˆä¸€ä¸ªå€¼ã€‚Junction çš„ç±»å‹å¯ä»¥æ˜¯ all(<code>&amp;</code>)ã€any(<code>|</code>)ã€one(<code>^</code>) æˆ– <code>none</code> (ç©ºç»“ç‚¹)ã€‚</p>
<p>ä¾‹å¦‚:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$j</span> <span class="o">=</span> <span class="mi">11</span><span class="o">|</span><span class="mi">22</span><span class="p">;</span> <span class="c1"># short for any(11,22)</span>
<span class="k">if</span> <span class="mi">33</span> <span class="o">==</span> <span class="nv">$j</span> <span class="o">+</span> <span class="mi">11</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">yes</span><span class="p">&#39;;</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="nb">so</span> <span class="mi">3</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">30</span><span class="p">)</span><span class="o">.</span><span class="nb">one</span><span class="p">;</span>         <span class="k">#=</span><span class="p">&gt;</span><span class="sd"> True 
</span><span class="sd">say so (&#34;a&#34; ^ &#34;b&#34; ^ &#34;c&#34;) eq &#34;a&#34;; #=</span> <span class="nb">True</span>
</code></pre></div><p>å‡½æ•° <code>so</code> å¼ºåˆ¶ä½¿ç”¨å¸ƒå°”ä¸Šä¸‹æ–‡ã€‚</p>
<p>Junction æœ‰ <code>Junction</code> ç±»å‹ï¼Œæˆ‘å¾ˆå¥½å¥‡ Junction çš„ç±»å‹è§„åˆ™ï¼Œå› ä¸ºä¹ä¸€çœ‹æœ‰äº›å¥‡æ€ªã€‚æ¯”æ–¹è¯´æˆ‘ä»¬æœ‰ä¸€ä¸ªå‡½æ•° <code>sq</code> ä» <code>Int</code> åˆ° <code>Int</code>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">sq</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$x</span> <span class="k">--&gt;</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$x</span><span class="o">*</span><span class="nv">$x</span> <span class="p">}</span>

<span class="k">my</span> <span class="nb">Int</span> <span class="nv">$res</span> <span class="o">=</span> <span class="nf">sq</span><span class="p">(</span><span class="mi">11</span><span class="p">);</span> <span class="c1"># OK</span>
<span class="nb">say</span> <span class="nv">$res</span><span class="p">;</span> <span class="k">#=</span><span class="p">&gt;</span><span class="sd"> 121
</span></code></pre></div><p>ç°åœ¨è®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç±»å‹ä¸ºä»»ä½• <code>Int</code> å€¼çš„ Junctionã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nb">Junction</span> <span class="nv">$j</span> <span class="o">=</span> <span class="mi">11</span> <span class="o">|</span> <span class="mi">22</span><span class="p">;</span> 
</code></pre></div><p>å½“æˆ‘ä»¬å°† <code>sq</code> åº”ç”¨äº <code>$j</code> æ—¶ï¼Œæˆ‘ä»¬æ²¡æœ‰å¾—åˆ°ä¸€ä¸ªç±»å‹é”™è¯¯ï¼Œå³ä½¿å‡½æ•°çš„ç±»å‹æ˜¯ <code>:(Int --&gt; Int)</code>ï¼ŒJunction çš„ç±»å‹æ˜¯ <code>Junction</code>ã€‚ç›¸åï¼Œæˆ‘ä»¬å¾—åˆ°çš„æ˜¯ä¸€ä¸ªç»“æœçš„ Junctionã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">say</span> <span class="nf">sq</span><span class="p">(</span><span class="nv">$j</span><span class="p">);</span> <span class="k">#=</span><span class="p">&gt;</span><span class="sd"> any(121, 484)
</span></code></pre></div><p>å¦‚æœæˆ‘ä»¬åƒä¹‹å‰ä¸€æ ·å°†å…¶èµ‹å€¼ç»™ä¸€ä¸ªç±»å‹ä¸º <code>Int</code> çš„å˜é‡ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªç±»å‹é”™è¯¯ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nb">Int</span> <span class="nv">$rj</span> <span class="o">=</span> <span class="nf">sq</span><span class="p">(</span><span class="nv">$j</span><span class="p">);</span> <span class="k">#=</span><span class="p">&gt;</span><span class="sd"> Type check failed in assignment to $rj; expected Int but got Junction (any(121, 484))
</span></code></pre></div><p>å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œç°åœ¨è¿”å›å€¼çš„ç±»å‹ä¸º <code>Junction</code>ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nb">Junction</span> <span class="nv">$rj</span> <span class="o">=</span> <span class="nf">sq</span><span class="p">(</span><span class="mi">11</span><span class="o">|</span><span class="mi">22</span><span class="p">);</span> <span class="c1"># OK</span>
</code></pre></div><p>æ‰€ä»¥ï¼ŒJunction ç±»å‹å¯ä»¥ä»£æ›¿ä»»ä½•å…¶ä»–ç±»å‹ï¼Œä½†è¿™æ ·ä¸€æ¥ï¼Œæ“ä½œä¹Ÿå˜æˆäº† Junctionã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼ŒJunction æ˜¯ç”±å…¶ç»„æˆå€¼éšå¼ç±»å‹çš„ï¼Œå°½ç®¡å®ƒä»¬çœ‹èµ·æ¥æ˜¯ä¸é€æ˜çš„ <code>Junction</code> ç±»å‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç”± <code>Str</code> å€¼ç»„æˆçš„ Junctionï¼Œå¹¶è¯•å›¾å°†è¿™ä¸ª Junction çš„å€¼ä¼ é€’åˆ° <code>sq</code> ä¸­ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªç±»å‹é”™è¯¯ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$sj</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">11</span><span class="p">&#39;</span> <span class="o">|</span> <span class="p">&#39;</span><span class="s1">22</span><span class="p">&#39;;</span>
<span class="nb">say</span> <span class="nv">$sj</span><span class="o">.</span><span class="nb">WHAT</span><span class="p">;</span> <span class="k">#=</span><span class="p">&gt;</span><span class="sd">(Junction)
</span><span class="sd">
</span><span class="sd">my Junction $svj = sq($sj); #=</span> <span class="n">Type</span> <span class="n">check</span> <span class="n">failed</span> <span class="nb">in</span> <span class="n">binding</span> <span class="nb">to</span> <span class="nb">parameter</span> <span class="p">&#39;</span><span class="s1">x</span><span class="p">&#39;;</span> <span class="nb">expected</span> <span class="nb">Int</span> <span class="k">but</span> <span class="nb">got</span> <span class="nb">Str</span> <span class="p">(&#34;</span><span class="s2">11</span><span class="p">&#34;)</span>
</code></pre></div><h3 id="junction-ä¸éµå¾ªé™æ€ç±»å‹è§„åˆ™">Junction ä¸éµå¾ªé™æ€ç±»å‹è§„åˆ™</h3>
<p>è™½ç„¶è¿™æ ·åšæ˜¯æœ‰é“ç†çš„(å¦‚æœåŸå§‹å‡½æ•°æœŸæœ›ä½¿ç”¨ <code>Int</code>ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›å®ƒä¸ <code>Str</code> ä¸€èµ·å·¥ä½œ)ï¼Œä½†è¿™ç¡®å®è¿èƒŒäº†é™æ€ç±»å‹åŒ–çš„è§„åˆ™ï¼Œå³ä½¿æ˜¯å­ç±»å‹åŒ–ã€‚å¦‚æœä¸€ä¸ªå‚æ•°çš„ç±»å‹æ˜¯ <code>Int</code>ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ç±»å‹å›¾ä¸­ä½äºå®ƒçš„ä»»ä½•ç±»å‹æ¥ä»£æ›¿ã€‚ä½†æ˜¯ <code>Int</code> å’Œ <code>Junction</code> çš„ç®€åŒ–ç±»å‹å›¾å¦‚ä¸‹ã€‚</p>
<pre><code>Int -&gt; Cool -&gt; Any -&gt; Mu &lt;- Junction
</code></pre>
<p>æ‰€ä»¥ Junction æ°¸è¿œä¸æ˜¯ <code>Any</code> ä»¥ä¸‹ä»»ä½•ä¸œè¥¿çš„å­ç±»å‹ã€‚å› æ­¤ï¼Œå°† Junction æ”¾åœ¨ç±»å‹ä¸º <code>Any</code> æˆ–å…¶å­ç±»å‹çš„æ§½ä¸­åº”è¯¥æ˜¯ä¸€ä¸ªç±»å‹é”™è¯¯ã€‚</p>
<p>æ­¤å¤–ï¼Œç”±äº Junction ç±»å‹æ˜¯ä¸é€æ˜çš„ï¼ˆå³å®ƒä¸æ˜¯ä¸€ä¸ªå‚æ•°åŒ–çš„ç±»å‹ï¼‰ï¼Œå®ƒä¸åº”è¯¥æŒæœ‰ä»»ä½•å…³äº Junction å†…éƒ¨å€¼çš„ç±»å‹çš„ä¿¡æ¯ã€‚ç„¶è€Œå®ƒå´å¯¹è¿™äº›ä¸å¯è§ã€ä¸å¯è®¿é—®çš„å€¼è¿›è¡Œäº†ç±»å‹æ£€æŸ¥ã€‚</p>
<p>é‚£ä¹ˆè¿™é‡Œåˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</p>
<h3 id="ä¸€ä¸ªå·¥ä½œå‡è®¾">ä¸€ä¸ªå·¥ä½œå‡è®¾</h3>
<p>ä¸€ä¸ªå·¥ä½œå‡è®¾æ˜¯ï¼ŒJunction ç±»å‹å¹¶ä¸çœŸæ­£å–ä»£ä»»ä½•å…¶ä»–ç±»å‹ï¼šå®ƒåªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œä½¿å®ƒçœ‹èµ·æ¥å¦‚æ­¤ã€‚</p>
<h3 id="é‡æ„-junction-çš„ç¬¬ä¸€éƒ¨åˆ†ç±»å‹">é‡æ„ Junction çš„ç¬¬ä¸€éƒ¨åˆ†ï¼šç±»å‹</h3>
<p>è®©æˆ‘ä»¬è¯•ç€é‡å»ºè¿™ä¸ªã€‚æˆ‘ä»¬çš„ç›®çš„æ˜¯æƒ³å‡ºä¸€ä¸ªæ•°æ®ç±»å‹å’Œä¸€äº›åŠ¨ä½œï¼Œä»¥å¤åˆ¶è§‚å¯Ÿåˆ°çš„ Raku Junction çš„è¡Œä¸ºã€‚é¦–å…ˆæˆ‘ä»¬è®¨è®ºä¸€ä¸‹ç±»å‹ï¼Œä¸ºäº†æ¸…æ™°èµ·è§ï¼Œä½¿ç”¨ Haskell ç¬¦å·ã€‚ç„¶åæˆ‘ä»‹ç» Raku ä¸­çš„å®ç°ã€‚è¿™ä¸ªå®ç°å°†åƒ Raku çš„åŸç”Ÿ Junction ä¸€æ ·ï¼Œä½†æ²¡æœ‰ç¥å¥‡çš„è¯­æ³•ç³–ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘è¯æ˜äº† Raku çš„ Junction æ¯•ç«Ÿéµå¾ªäº†æ­£ç¡®çš„ç±»å‹è§„åˆ™ã€‚</p>
<h4 id="junction-ç±»å‹">Junction ç±»å‹</h4>
<p>Junction æ˜¯ä¸€ä¸ªç”± Junction ç±»å‹ <code>JType</code> å’Œä¸€ç»„å€¼ç»„æˆçš„æ•°æ®ç»“æ„ã€‚ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘å°†è¿™ä¸ªå€¼é›†é™åˆ¶ä¸ºå•ä¸€ç±»å‹ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å› ä¸ºæ··åˆç±»å‹çš„ Junction å…¶å®æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚æˆ‘ä½¿ç”¨ä¸€ä¸ªåˆ—è¡¨æ¥æ¨¡æ‹Ÿè¿™ä¸ªé›†åˆï¼ŒåŒæ ·æ˜¯ä¸ºäº†æ–¹ä¾¿ã€‚å› ä¸º Junction å¯ä»¥åŒ…å«ä»»ä½•ç±»å‹çš„å€¼ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªå¤šæ€çš„ä»£æ•°æ•°æ®ç±»å‹ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="n">data</span> <span class="n">JType</span> <span class="o">=</span> <span class="n">JAny</span> <span class="o">|</span> <span class="n">JAll</span> <span class="o">|</span> <span class="n">JOne</span> <span class="o">|</span> <span class="n">JNone</span>

<span class="n">data</span> <span class="nb">Junction</span> <span class="n">a</span> <span class="o">=</span> <span class="nb">Junction</span> <span class="n">JType</span> <span class="o">[</span><span class="n">a</span><span class="o">]</span>
</code></pre></div><h4 id="åº”ç”¨ç»“ç‚¹">åº”ç”¨ç»“ç‚¹</h4>
<p>å¯¹ä¸€ä¸ª Junction åšä»»ä½•äº‹æƒ…éƒ½æ„å‘³ç€å¯¹å®ƒåº”ç”¨ä¸€ä¸ªå‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥è€ƒè™‘ä¸‰ç§æƒ…å†µï¼Œæˆ‘ä¸ºæ¯ä¸€ç§æƒ…å†µä»‹ç»ä¸€ä¸ªç‰¹åˆ«å®šåˆ¶çš„æ“ä½œç¬¦ã€‚</p>
<ul>
<li>å°†é Junction å‡½æ•°åº”ç”¨äº Junction è¡¨è¾¾å¼</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">(</span>â€¢ï¿®<span class="p">)</span> <span class="o">::</span> <span class="p">(</span><span class="n">a</span> <span class="k">-&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Junction</span> <span class="n">a</span> <span class="k">-&gt;</span>  <span class="nb">Junction</span> <span class="n">b</span>
</code></pre></div><ul>
<li>å°† Junction å‡½æ•°åº”ç”¨äºé Junction è¡¨è¾¾å¼ã€‚</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">(</span>ï¿®â€¢<span class="p">)</span> <span class="o">::</span>  <span class="nb">Junction</span> <span class="p">(</span><span class="n">b</span> <span class="k">-&gt;</span> <span class="n">c</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">b</span> <span class="k">-&gt;</span> <span class="nb">Junction</span> <span class="n">c</span>
</code></pre></div><ul>
<li>å°† Junction å‡½æ•°åº”ç”¨äº Junction è¡¨è¾¾å¼ï¼Œåˆ›å»ºä¸€ä¸ªåµŒå¥— Junctionã€‚</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="p">(</span>ï¿®ï¿®<span class="p">)</span> <span class="o">::</span>  <span class="nb">Junction</span> <span class="p">(</span><span class="n">b</span> <span class="k">-&gt;</span> <span class="n">c</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Junction</span> <span class="n">b</span> <span class="k">-&gt;</span> <span class="nb">Junction</span> <span class="p">(</span><span class="nb">Junction</span> <span class="n">c</span><span class="p">)</span>
</code></pre></div><p>ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨ Junction a å’Œ a ä¹‹é—´åˆ›å»ºè‡ªå®šä¹‰æ¯”è¾ƒè¿ç®—ç¬¦ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="o">--</span> <span class="ow">and</span> <span class="n">similar</span> <span class="k">for</span> <span class="o">/-,</span> <span class="o">&gt;,</span> <span class="o">&lt;,</span> <span class="p">&lt;</span><span class="s">=,</span><span class="p">&gt;</span><span class="o">=</span>
<span class="p">(</span>ï¿®<span class="o">==</span>â€¢<span class="p">)</span> <span class="o">::</span> <span class="nb">Junction</span> <span class="n">a</span> <span class="k">-&gt;</span> <span class="n">a</span> <span class="k">-&gt;</span> <span class="nb">Bool</span>
</code></pre></div><h4 id="æŠ˜å -junction">æŠ˜å  Junction</h4>
<p>é‚£ä¹ˆæˆ‘ä»¬å°±æœ‰äº† <code>so</code>ï¼Œå¸ƒå°”å¼ºåˆ¶å‡½æ•°ã€‚å®ƒçš„ä½œç”¨æ˜¯å°†ä¸€ä¸ªå¸ƒå°”çš„ Junction æŠ˜å æˆä¸€ä¸ªå¸ƒå°”ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nb">so</span> <span class="o">::</span> <span class="nb">Junction</span> <span class="nb">Bool</span> <span class="k">-&gt;</span> <span class="nb">Bool</span>
</code></pre></div><p>æœ€åæˆ‘ä»¬æœ‰ <code>collapse</code>ï¼Œå®ƒä»ä¸€ä¸ª Junction è¿”å›å€¼ï¼Œå‰ææ˜¯å®ƒæ˜¯ä¸€ä¸ª Junctionï¼Œæ‰€æœ‰å­˜å‚¨çš„å€¼éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="nf">collapse</span> <span class="o">::</span> <span class="p">(</span><span class="n">Show</span> <span class="n">a</span><span class="o">,</span><span class="n">Eq</span> <span class="n">a</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="nb">Junction</span> <span class="n">a</span> <span class="k">-&gt;</span> <span class="n">a</span>
</code></pre></div><p>è¿™ä¼¼ä¹æ˜¯ä¸€ä¸ªå¥‡æ€ªçš„å‡½æ•°ï¼Œä½†ç”±äº Junction çš„è¡Œä¸ºï¼Œå®ƒæ˜¯å¿…è¦çš„ã€‚æ­£å¦‚æˆ‘ä»¬å°†çœ‹åˆ°çš„ï¼Œä¸Šè¿°è¯­ä¹‰æ„å‘³ç€ Junction æ˜¯è´ªå©ªçš„ï¼šå¦‚æœä¸€ä¸ªå‡½æ•°çš„ä¸€ä¸ªå‚æ•°æ˜¯ Junctionï¼Œé‚£ä¹ˆæ‰€æœ‰å…¶ä»–å‚æ•°ä¹Ÿä¼šæˆä¸º Junctionï¼Œä½† Junction ä¸­çš„æ‰€æœ‰å€¼éƒ½æ˜¯ç›¸åŒçš„ã€‚æˆ‘å·²ç»åœ¨&quot;<a href="https://gist.github.com/wimvanderbauwhede/85fb4b88ec53a0b8149e6c05740adcf8">è´ªå©ª Junction çš„å¥‡æ€ªæƒ…å†µ</a>&ldquo;ä¸­è®¨è®ºè¿‡è¿™ä¸ªé—®é¢˜ï¼Œä½†æˆ‘ä»¬ç°åœ¨å¯ä»¥å°†è¿™ç§è¡Œä¸ºå½¢å¼åŒ–ã€‚</p>
<h4 id="é‡æ–°å®¡è§†è´ªå©ª-junction-çš„å¥‡æ€ªæƒ…å†µ">é‡æ–°å®¡è§†è´ªå©ª Junction çš„å¥‡æ€ªæƒ…å†µ</h4>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªä¸¤ä¸ªå‚æ•°çš„å‡½æ•° <code>f :: a -&gt; b -&gt; c</code>ï¼Œæˆ‘ä»¬å¯¹ç¬¬ä¸€ä¸ªå‚æ•°åº”ç”¨ä¸€ä¸ªç»“ç‚¹ <code>j :: Junction</code> a åº”ç”¨åˆ°ç¬¬ä¸€ä¸ªå‚æ•° <code>f â€¢ï¿® j</code> ä¸Šï¼Œé‚£ä¹ˆç»“æœæ˜¯ä¸€ä¸ªéƒ¨åˆ†åº”ç”¨çš„å‡½æ•°ï¼ŒåŒ…è£¹åœ¨ä¸€ä¸ª Junction ä¸Šï¼š<code>fp :: Junction b -&gt; c</code>ã€‚å¦‚æœæˆ‘ä»¬ç°åœ¨æƒ³ç”¨ <code>fp ï¿®â€¢ v</code> å°†è¿™ä¸ªå‡½æ•°åº”ç”¨äºä¸€ä¸ªéç»“ç‚¹çš„å€¼ <code>v :: b</code>ï¼Œé‚£ä¹ˆç»“æœå°±æ˜¯ <code>Junction c</code> ç±»å‹çš„ã€‚</p>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬è€ƒè™‘ç±»å‹ <code>c</code> æ˜¯ <code>forall d . (a -&gt; b -&gt; d) -&gt; d</code> çš„ç‰¹æ®Šæƒ…å†µã€‚æ‰€ä»¥æˆ‘ä»¬æœ‰ <code>Junction</code>(<code>forall d . (a-&gt;b-&gt;d) -&gt; d</code>)ã€‚è¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‡½æ•°å‚æ•°å¹¶è¿”å›è¯¥å‡½æ•°çš„è¿”å›ç±»å‹çš„ä¸œè¥¿ã€‚æˆ‘ä»¬ä½¿ç”¨ <code>forall</code>ï¼Œæ‰€ä»¥ <code>d</code> å¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ï¼Œä½†åœ¨å®è·µä¸­æˆ‘ä»¬å¸Œæœ›å®ƒæ˜¯ <code>a</code> æˆ– <code>b</code>ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬å°†è¿™ä¸ªå‡½æ•°(ç§°å®ƒä¸º <code>p</code>)åº”ç”¨äº <code>fst :: a-&gt;b-&gt;a</code>ï¼Œä½¿ç”¨ <code>p ï¿®â€¢ fst</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¾—åˆ° <code>Junction a</code>ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬å°†å®ƒåº”ç”¨äº <code>snd :: a-&gt;b-&gt;b</code>ï¼Œä½¿ç”¨ <code>p ï¿®â€¢ snd</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¾—åˆ° <code>Junction b</code>ã€‚</p>
<p>è¿™å°±æ˜¯å½¢å¼ä¸ŠåŸºäºç±»å‹çš„åˆ†æï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½ä»ä¸€ä¸ª pair ä¸­è¿”å›ä¸€ä¸ªé Junction çš„å€¼ï¼Œåœ¨&rdquo;<a href="https://gist.github.com/wimvanderbauwhede/85fb4b88ec53a0b8149e6c05740adcf8">è´ªå©ª Junction çš„å¥‡æ€ªæƒ…å†µ</a>&ldquo;ä¸­å·²ç»è§£é‡Šè¿‡ã€‚è€Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬éœ€è¦ <code>collapse</code> å‡½æ•°çš„åŸå› ã€‚</p>
<h4 id="é‡æ„-junction-çš„ç¬¬2éƒ¨åˆ†raku-çš„å®ç°">é‡æ„ Junction çš„ç¬¬2éƒ¨åˆ†ï¼šRaku çš„å®ç°ã€‚</h4>
<p>æˆ‘ä»¬ä»åˆ›å»º Junction ç±»å‹å¼€å§‹ï¼Œä¸ºå››ç§ Junction ç±»å‹ä½¿ç”¨ä¸€ä¸ªæšä¸¾ï¼Œä¸ºå®é™…çš„ Junction æ•°æ®ç±»å‹ä½¿ç”¨ä¸€ä¸ªè§’è‰²ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># The types of Junctions</span>
<span class="k">enum</span> <span class="n">JType</span> <span class="p">&lt;</span><span class="s">JAny  JAll  JOne  JNone </span><span class="p">&gt;;</span>

<span class="c1"># The actual Junction type</span>
<span class="k">role</span> <span class="nb">Junction</span><span class="o">[</span>\<span class="n">jt</span><span class="o">,</span> <span class="nv">@vs</span><span class="o">]</span> <span class="p">{</span>
    <span class="k">has</span> <span class="n">JType</span> <span class="nv">$.junction-type</span><span class="o">=</span><span class="n">jt</span><span class="p">;</span>
    <span class="k">has</span> <span class="nv">@.values</span><span class="o">=</span><span class="nv">@vs</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>æ¥ä¸‹æ¥æ˜¯å››ç§ç±»å‹çš„ Junction çš„æ„é€ å‡½æ•°ï¼ˆä¸‹åˆ’çº¿ï¼Œé¿å…ä¸å†…å»ºå‡½æ•°çš„åç§°å†²çªï¼‰ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">our</span> <span class="k">sub</span> <span class="nf">all_</span><span class="p">(</span><span class="nv">@vs</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Junction</span><span class="o">[</span> <span class="n">JAll</span><span class="o">,</span> <span class="nv">@vs</span><span class="o">].</span><span class="nb">new</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">our</span> <span class="k">sub</span> <span class="nf">any_</span><span class="p">(</span><span class="nv">@vs</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Junction</span><span class="o">[</span> <span class="n">JAny</span><span class="o">,</span> <span class="nv">@vs</span><span class="o">].</span><span class="nb">new</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">our</span> <span class="k">sub</span> <span class="nf">one_</span><span class="p">(</span><span class="nv">@vs</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Junction</span><span class="o">[</span> <span class="n">JOne</span><span class="o">,</span> <span class="nv">@vs</span><span class="o">].</span><span class="nb">new</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">our</span> <span class="k">sub</span> <span class="nf">none_</span><span class="p">(</span><span class="nv">@vs</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">Junction</span><span class="o">[</span> <span class="n">JNone</span><span class="o">,</span> <span class="nv">@vs</span><span class="o">].</span><span class="nb">new</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>å°†ä¸€ä¸ªï¼ˆå•å‚æ•°ï¼‰å‡½æ•°åº”ç”¨äº junction å‚æ•°ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">â—â—‹</span><span class="p">&gt;(</span> <span class="nv">&amp;f</span><span class="o">,</span> \<span class="n">j</span> <span class="p">)</span> <span class="k">is</span> <span class="k">export</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">\jt</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="nf">junction-type</span><span class="p">;</span> 
    <span class="k">my</span> <span class="nv">@vs</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="nb">values</span><span class="p">;</span>
  
    <span class="nb">Junction</span><span class="o">[</span> <span class="n">jt</span><span class="o">,</span> <span class="nb">map</span><span class="p">(</span> <span class="p">{</span><span class="nv">&amp;f</span><span class="p">(</span><span class="nv">$_</span><span class="p">)}</span><span class="o">,</span> <span class="nv">@vs</span><span class="p">)</span><span class="o">].</span><span class="nb">new</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>è¦å°† Junction å†…çš„å‡½æ•°åº”ç”¨äºé Junction çš„å‚æ•°:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">â—‹â—</span><span class="p">&gt;(</span> \<span class="n">jf</span><span class="o">,</span> \<span class="n">v</span> <span class="p">)</span> <span class="k">is</span> <span class="k">export</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">\jt</span><span class="o">=</span><span class="n">jf</span><span class="o">.</span><span class="nf">junction-type</span><span class="p">;</span> 
    <span class="k">my</span> <span class="nv">@fs</span> <span class="o">=</span> <span class="n">jf</span><span class="o">.</span><span class="nb">values</span><span class="p">;</span>

    <span class="nb">Junction</span><span class="o">[</span> <span class="n">jt</span><span class="o">,</span> <span class="nb">map</span><span class="p">(</span> <span class="p">{</span><span class="nv">$_</span><span class="p">(</span> <span class="n">v</span><span class="p">)}</span><span class="o">,</span> <span class="nv">@fs</span><span class="p">)</span><span class="o">].</span><span class="nb">new</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>å°†ä¸€ä¸ªå‡½æ•°åº”ç”¨äºä¸¤ä¸ª junction å‚æ•°ï¼Œç›¸å½“äºå°†ä¸€ä¸ª junction å†…çš„å‡½æ•°åº”ç”¨äºä¸€ä¸ª junctionã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå¤æ‚çš„é—®é¢˜ã€‚Raku å¯¹åµŒå¥—æ–½åŠ äº†ä¸€ä¸ªæ’åºï¼Œå³æ‰€æœ‰çš„åµŒå¥—æ€»æ˜¯å¤–åµŒå¥—ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»æ£€æŸ¥ junction çš„ç±»å‹ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œæˆ‘ä»¬å¿…é¡»äº¤æ¢æ˜ å°„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">â—‹â—‹</span><span class="p">&gt;(</span> \<span class="n">jf</span><span class="o">,</span> \<span class="n">jv</span> <span class="p">)</span> <span class="k">is</span> <span class="k">export</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">\jft</span><span class="o">=</span> <span class="n">jf</span><span class="o">.</span><span class="nf">junction-type</span><span class="p">;</span> 
    <span class="k">my</span> <span class="nv">@fs</span> <span class="o">=</span> <span class="n">jf</span><span class="o">.</span><span class="nb">values</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">\jvt</span> <span class="o">=</span> <span class="n">jv</span><span class="o">.</span><span class="nf">junction-type</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">@vs</span> <span class="o">=</span> <span class="n">jv</span><span class="o">.</span><span class="nb">values</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">jvt</span> <span class="o">==</span> <span class="n">JAll</span> <span class="ow">and</span> <span class="n">jft</span> <span class="o">!=</span> <span class="n">JAll</span><span class="p">)</span> <span class="p">{</span>        
        <span class="nb">Junction</span><span class="o">[</span> <span class="n">jvt</span><span class="o">,</span> <span class="nb">map</span><span class="p">(</span> <span class="k">sub</span> <span class="p">(</span>\<span class="n">v</span><span class="p">){</span><span class="n">jf</span> â—‹â— <span class="n">v</span><span class="p">}</span><span class="o">,</span> <span class="nv">@vs</span><span class="p">)</span><span class="o">].</span><span class="nb">new</span><span class="p">;</span>  
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>        
        <span class="nb">Junction</span><span class="o">[</span> <span class="n">jft</span><span class="o">,</span> <span class="nb">map</span><span class="p">(</span> <span class="k">sub</span> <span class="p">(</span><span class="nv">&amp;f</span><span class="p">){</span> <span class="nv">&amp;f</span> â—â—‹ <span class="n">jv</span><span class="p">}</span><span class="o">,</span> <span class="nv">@fs</span><span class="p">)</span><span class="o">].</span><span class="nb">new</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>ä¸ºäº†å®Œæ•´ï¼Œè¿™é‡Œæ˜¯ <code>â—‹==â—</code> çš„å®šä¹‰ã€‚<code>â—‹!=â—</code>ã€<code>â—‹&gt;â—</code> ç­‰çš„å®šä¹‰æ˜¯ç±»ä¼¼çš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nb">infix</span><span class="o">:</span><span class="p">&lt;</span><span class="s"> â—‹==â— </span><span class="p">&gt;(</span> \<span class="n">j</span><span class="o">,</span> \<span class="n">v</span> <span class="p">)</span> <span class="k">is</span> <span class="k">export</span> <span class="p">{</span>
    <span class="k">sub</span> <span class="p">(</span>\<span class="nb">x</span><span class="p">){</span><span class="nb">x</span><span class="o">==</span><span class="n">v</span><span class="p">}</span> â—â—‹ <span class="n">j</span>
<span class="p">}</span>
</code></pre></div><p>æ¥ä¸‹æ¥æˆ‘ä»¬æœ‰ <code>so</code>ï¼Œå®ƒæŠŠå¸ƒå°”å€¼çš„ junction å˜æˆäº†å¸ƒå°”å€¼ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">our</span> <span class="k">sub</span> <span class="nb">so</span> <span class="p">(</span>\<span class="n">jv</span><span class="p">)</span> <span class="p">{</span> 
    <span class="k">my</span> <span class="nv">@vs</span> <span class="o">=</span> <span class="n">jv</span><span class="o">.</span><span class="nb">values</span><span class="p">;</span>
    <span class="k">given</span> <span class="n">jv</span><span class="o">.</span><span class="nf">junction-type</span> <span class="p">{</span>
        <span class="k">when</span> <span class="n">JAny</span> <span class="p">{</span> <span class="nb">elems</span><span class="p">(</span><span class="nb">grep</span> <span class="p">{</span><span class="nv">$_</span><span class="p">}</span><span class="o">,</span>  <span class="nv">@vs</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">}</span>
        <span class="k">when</span> <span class="n">JAll</span> <span class="p">{</span> <span class="nb">elems</span><span class="p">(</span><span class="nb">grep</span> <span class="p">{</span><span class="o">!</span><span class="nv">$_</span><span class="p">}</span><span class="o">,</span> <span class="nv">@vs</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">}</span>
        <span class="k">when</span> <span class="n">JOne</span> <span class="p">{</span> <span class="nb">elems</span><span class="p">(</span><span class="nb">grep</span> <span class="p">{</span><span class="nv">$_</span><span class="p">}</span><span class="o">,</span>  <span class="nv">@vs</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">}</span>
        <span class="k">when</span> <span class="n">JOne</span> <span class="p">{</span> <span class="nb">elems</span><span class="p">(</span><span class="nb">grep</span> <span class="p">{</span><span class="nv">$_</span><span class="p">}</span><span class="o">,</span>  <span class="nv">@vs</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>æœ€åæˆ‘ä»¬æœ‰ <code>collapse</code>ï¼Œæ­£å¦‚<a href="https://gist.github.com/wimvanderbauwhede/85fb4b88ec53a0b8149e6c05740adcf8">è´ªå©ª Junction çš„æ–‡ç« </a>ä¸­æ‰€å®šä¹‰çš„é‚£æ ·ï¼Œ <code>collapse</code> è¿”å› Junction çš„å€¼ï¼Œåªè¦å®ƒä»¬éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">our</span> <span class="k">sub</span> <span class="nf">collapse</span><span class="p">(</span> \<span class="n">j</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">\jt</span><span class="o">=</span><span class="n">j</span><span class="o">.</span><span class="nf">junction-type</span><span class="p">;</span> 
    <span class="k">my</span> <span class="nv">@vvs</span> <span class="o">=</span> <span class="n">j</span><span class="o">.</span><span class="nb">values</span><span class="p">;</span>
    <span class="k">my</span> <span class="nv">$v</span> <span class="o">=</span>  <span class="nb">shift</span> <span class="nv">@vvs</span><span class="p">;</span>        
    <span class="k">my</span> <span class="nv">@ts</span> <span class="o">=</span> <span class="nb">grep</span> <span class="p">{</span><span class="o">!</span><span class="p">(</span><span class="nv">$_</span> <span class="o">~~</span> <span class="nv">$v</span><span class="p">)}</span><span class="o">,</span> <span class="nv">@vvs</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">@ts</span><span class="o">.</span><span class="nb">elems</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>  
        <span class="nv">$v</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nb">die</span> <span class="p">&#34;</span><span class="s2">Can&#39;t collapse this Junction: elements are not identical: </span><span class="p">{</span><span class="nv">$v</span><span class="o">,</span><span class="nv">@vvs</span><span class="p">}&#34;;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="junction-æ¸…ç†">Junction æ¸…ç†</h3>
<p>ç°åœ¨æˆ‘ä»¬å†æ¥çœ‹çœ‹æˆ‘ä»¬çš„å·¥ä½œå‡è¯´ï¼Œå°† Raku çš„ Junction ä¸Šçš„åŠ¨ä½œè§£é‡Šä¸ºä¸Šè¿°ç±»å‹å’Œæ“ä½œç¬¦çš„è¯­æ³•ç³–ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">sq</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$x</span> <span class="k">--&gt;</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$x</span><span class="o">*</span><span class="nv">$x</span> <span class="p">}</span>
<span class="k">my</span> <span class="nb">Junction</span> <span class="nv">$j</span> <span class="o">=</span> <span class="mi">11</span> <span class="o">|</span> <span class="mi">22</span><span class="p">;</span> 
<span class="k">my</span> <span class="nb">Junction</span> <span class="nv">$rj</span> <span class="o">=</span> <span class="nf">sq</span><span class="p">(</span><span class="nv">$j</span><span class="p">);</span> 
</code></pre></div><p>å»è¯­æ³•å¡˜åè¿™å˜æˆäº†:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nb">Junction</span> <span class="nv">$j</span> <span class="o">=</span> <span class="n">any_</span> <span class="o">[</span><span class="mi">11</span><span class="o">,</span><span class="mi">22</span><span class="o">]</span><span class="p">;</span>
<span class="k">my</span> <span class="nb">Junction</span> <span class="nv">$rj</span> <span class="o">=</span> <span class="nv">&amp;sq</span> â—â—‹ <span class="nv">$j</span><span class="p">;</span>
</code></pre></div><p>ç±»ä¼¼åœ°,</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="p">(</span><span class="nv">$j</span> <span class="o">==</span> <span class="mi">42</span><span class="p">)</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span> 
</code></pre></div><p>å˜æˆäº†:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">if</span> <span class="p">(</span><span class="nb">so</span> <span class="p">(</span><span class="nv">$j</span> â—‹<span class="o">==</span>â— <span class="mi">42</span><span class="p">))</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
</code></pre></div><p>å’Œå…¶ä»–å¸ƒå°”ä¸Šä¸‹æ–‡ç±»ä¼¼ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬ä»”ç»†çœ‹<a href="https://gist.github.com/wimvanderbauwhede/85fb4b88ec53a0b8149e6c05740adcf8">è´ªå©ª Junction æ–‡ç« </a>ä¸­çš„ pair ä¾‹å­ï¼Œé‚£ä¹ˆå°† junction åº”ç”¨åˆ°ä¸€ä¸ªæœ‰å¤šä¸ªå‚æ•°çš„å‡½æ•°ä¸Š:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nb">Junction</span> \<span class="n">p1j</span> <span class="o">=</span> <span class="nb">pair</span> <span class="ow">R</span><span class="o">,</span><span class="err">(42</span><span class="o">^</span><span class="err">43);</span>
</code></pre></div><p>å»è¯­æ³•å¡˜åå˜ä¸º:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nb">Junction</span> \<span class="n">p1j</span> <span class="o">=</span> <span class="nv">&amp;pair</span><span class="o">.</span><span class="nb">assuming</span><span class="p">(</span><span class="ow">R</span><span class="err">)</span> â—â—‹ <span class="n">one_</span> <span class="o">[</span><span class="mi">42</span><span class="o">,</span><span class="mi">43</span><span class="o">]</span><span class="p">;</span>
</code></pre></div><p>æˆ‘ä»¬ä½¿ç”¨ <code>.assuming()</code> æ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦éƒ¨åˆ†åº”ç”¨ã€‚ä¸ç®¡æˆ‘ä»¬æ˜¯å…ˆåº”ç”¨é Junction å‚æ•°è¿˜æ˜¯ Junction å‚æ•°ï¼Œéƒ½æ²¡æœ‰å…³ç³»ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">\p1jr</span> <span class="o">=</span> <span class="p">(</span> <span class="k">sub</span> <span class="p">(</span><span class="nv">$y</span><span class="p">){</span> <span class="nv">&amp;pair</span><span class="o">.</span><span class="nb">assuming</span><span class="p">(</span><span class="o">*,</span><span class="nv">$y</span><span class="p">)</span> <span class="p">}</span> â—â—‹ <span class="n">one_</span> <span class="o">[</span><span class="mi">42</span><span class="o">,</span><span class="mi">43</span><span class="o">]</span> <span class="p">)</span> â—‹â— <span class="ow">R</span><span class="err">;</span>
</code></pre></div><p>æœ€åï¼Œä¸¾ä¸€ä¸ªä¸¤ä¸ªå‚æ•°éƒ½æ˜¯ Junction çš„ä¾‹å­ã€‚ç”±äº <code>â—‹â—‹</code> çš„å®šä¹‰ï¼Œåº”ç”¨çš„é¡ºåºå¹¶ä¸é‡è¦ã€‚</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">m</span><span class="p">(</span>\<span class="nb">x</span><span class="o">,</span>\<span class="n">y</span><span class="p">){</span><span class="nb">x</span><span class="o">*</span><span class="n">y</span><span class="p">}</span>

<span class="k">my</span> <span class="nv">\p4</span> <span class="o">=</span> <span class="p">(</span> <span class="k">sub</span> <span class="p">(</span>\<span class="nb">x</span><span class="p">){</span> <span class="nv">&amp;m</span><span class="o">.</span><span class="nb">assuming</span><span class="p">(</span><span class="nb">x</span><span class="p">)</span> <span class="p">}</span> â—â—‹ <span class="n">any_</span> <span class="o">[</span><span class="mi">11</span><span class="o">,</span><span class="mi">22</span><span class="o">]</span> <span class="p">)</span> â—‹â—‹ <span class="n">all_</span> <span class="o">[</span><span class="mi">33</span><span class="o">,</span><span class="mi">44</span><span class="o">]</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">\p4r</span> <span class="o">=</span> <span class="p">(</span> <span class="k">sub</span> <span class="p">(</span>\<span class="nb">x</span><span class="p">){</span> <span class="nv">&amp;m</span><span class="o">.</span><span class="nb">assuming</span><span class="p">(</span><span class="o">*,</span><span class="nb">x</span><span class="p">)</span> <span class="p">}</span> â—â—‹ <span class="n">all_</span> <span class="o">[</span><span class="mi">33</span><span class="o">,</span><span class="mi">44</span><span class="o">]</span> <span class="p">)</span> â—‹â—‹ <span class="n">any_</span> <span class="o">[</span><span class="mi">11</span><span class="o">,</span><span class="mi">22</span><span class="o">]</span><span class="p">;</span>
</code></pre></div><h3 id="ç»“è®º">ç»“è®º</h3>
<p>ä» Raku çš„ junction çš„ç¥å¥‡ç±»å‹è¡Œä¸ºå®é™…ä¸Šæ˜¯è¯­æ³•ç³–çš„å‡è®¾å‡ºå‘ï¼Œæˆ‘ä½¿ç”¨å¤šæ€ä»£æ•°æ•°æ®ç±»å‹é‡æ„äº† junction ç±»å‹å’Œå®ƒçš„åŠ¨ä½œï¼Œå¹¶è¡¨æ˜ Raku çš„è¡Œä¸ºä½œä¸ºè¯­æ³•ç³–çš„è§£é‡Šå¯¹äºæ‰€æå‡ºçš„å®ç°æ˜¯æˆç«‹çš„ã€‚æ¢å¥è¯è¯´ï¼ŒRaku çš„ Junction ç¡®å®éµå¾ªé™æ€ç±»å‹è§„åˆ™ã€‚</p>
<p>åŸæ–‡é“¾æ¥: <a href="https://gist.github.com/wimvanderbauwhede/19cc1e8d04e9a477f58cfe7288a6172e">https://gist.github.com/wimvanderbauwhede/19cc1e8d04e9a477f58cfe7288a6172e</a></p>
]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/raku" term="raku" label="Raku" />
                             
                                <category scheme="https://ohmyweekly.github.io/tags/junction" term="junction" label="Junction" />
                            
                        
                    
                
            
        </entry>
    
</feed>
