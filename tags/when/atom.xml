<?xml version="1.0" encoding="utf-8"?> 
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-us">
    <generator uri="https://gohugo.io/" version="0.85.0">Hugo</generator><title type="html"><![CDATA[when on 焉知非鱼]]></title>
    
        <subtitle type="html"><![CDATA[rakulang, dartlang, nimlang, golang, rustlang, lang lang no see]]></subtitle>
    
    
    
            <link href="https://ohmyweekly.github.io/tags/when/" rel="alternate" type="text/html" title="HTML" />
            <link href="https://ohmyweekly.github.io/tags/when/index.xml" rel="alternate" type="application/rss+xml" title="RSS" />
            <link href="https://ohmyweekly.github.io/tags/when/atom.xml" rel="self" type="application/atom+xml" title="Atom" />
            <link href="https://ohmyweekly.github.io/tags/when/jf2feed.json" rel="alternate" type="application/jf2feed+json" title="jf2feed" />
    <updated>2021-07-15T22:25:29+08:00</updated>
    
    
    
    
        <id>https://ohmyweekly.github.io/tags/when/</id>
    
        
        <entry>
            <title type="html"><![CDATA[Raku 中的 given/when 模式匹配]]></title>
            <link href="https://ohmyweekly.github.io/notes/2016-02-06-given-when-pattern-match-in-raku/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmyweekly.github.io/notes/2015-03-15-when-and-where/?utm_source=atom_feed" rel="related" type="text/html" title="When and Where" />
            
                <id>https://ohmyweekly.github.io/notes/2016-02-06-given-when-pattern-match-in-raku/</id>
            
            
                    <author>
                        <name>焉知非鱼</name>
                    </author>
            <published>2021-07-11T00:00:00+08:00</published>
            <updated>2021-07-11T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>Given When Pattern Match in Raku</blockquote><h3 id="模式匹配">模式匹配</h3>
<p>匹配单个字符串:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$name</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">twostraws</span><span class="p">&#34;;</span>

<span class="k">given</span> <span class="nv">$name</span> <span class="p">{</span>
    <span class="k">when</span> <span class="p">&#34;</span><span class="s2">bilbo</span><span class="p">&#34;</span>      <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hello, Bilbo Baggins!</span><span class="p">&#34;}</span>
    <span class="k">when</span> <span class="p">&#34;</span><span class="s2">twostraws</span><span class="p">&#34;</span>  <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hello, Paul Hudson!</span><span class="p">&#34;</span>  <span class="p">}</span>
    <span class="k">default</span>           <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">身份验证失败</span><span class="p">&#34;</span>           <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>匹配元组:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$bool1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">my</span> <span class="nv">$bool2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="k">given</span> <span class="p">(</span><span class="nv">$bool1</span><span class="o">,</span> <span class="nv">$bool2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">when</span> <span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">0, 0</span><span class="p">&#34;}</span>
    <span class="k">when</span> <span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">0, 1</span><span class="p">&#34;}</span>
    <span class="k">when</span> <span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">1, 0</span><span class="p">&#34;}</span>
    <span class="k">when</span> <span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">1, 1</span><span class="p">&#34;}</span>
<span class="p">}</span>

<span class="k">given</span> <span class="p">(&#34;</span><span class="s2">15</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">example</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">3.14</span><span class="p">&#34;)</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$_</span><span class="o">.</span><span class="nb">WHAT</span><span class="p">;</span>
    <span class="k">when</span> <span class="p">(</span><span class="nv">$</span><span class="o">,</span> <span class="nv">$</span><span class="o">,</span> <span class="nb">Str</span><span class="p">)</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">I got a String of </span><span class="nv">$_</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">given</span> <span class="p">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">when</span> <span class="p">(</span> <span class="nv">$</span><span class="o">,</span>  <span class="nv">$</span><span class="p">)</span> <span class="p">{</span><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Ok</span><span class="p">&#34;}</span>
<span class="p">}</span>

<span class="k">given</span> <span class="p">(&#34;</span><span class="s2">fly.mp3</span><span class="p">&#34;</span><span class="o">,</span> <span class="mi">34</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">It&#39;s funny</span><span class="p">&#34;)</span> <span class="p">{</span>
    <span class="k">when</span> <span class="p">(/</span><span class="ni">.</span><span class="sr">mp</span><span class="mi">3</span><span class="ni">$</span><span class="p">/</span><span class="o">,</span> <span class="p">/</span><span class="mi">4</span><span class="ni">$</span><span class="p">/</span><span class="o">,</span> <span class="o">*.</span><span class="nb">chars</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Perfact</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">given</span> <span class="mi">5</span> <span class="p">{</span>
    <span class="k">when</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">1..10 contains 5</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="同时检查名字和密码">同时检查名字和密码</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$name</span>     <span class="o">=</span> <span class="p">&#34;</span><span class="s2">twostraws</span><span class="p">&#34;;</span>
<span class="k">my</span> <span class="nv">$password</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;;</span>

<span class="k">given</span> <span class="p">(</span><span class="nv">$name</span><span class="o">,</span> <span class="nv">$password</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">when</span> <span class="p">(&#34;</span><span class="s2">bilbo</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">bagg1n5</span><span class="p">&#34;)</span>      <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hello, Bilbo Baggins!</span><span class="p">&#34;</span> <span class="p">}</span>
    <span class="k">when</span> <span class="p">(&#34;</span><span class="s2">twostraws</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;)</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hello, Paul Hudson!</span><span class="p">&#34;</span>   <span class="p">}</span>
    <span class="k">default</span>                        <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">你是谁?</span><span class="p">&#34;</span>                <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="使用单个元组">使用单个元组</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$authentication</span> <span class="o">=</span> <span class="p">(&#34;</span><span class="s2">twostraws</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;);</span>

<span class="k">given</span> <span class="nv">$authentication</span> <span class="p">{</span>
    <span class="k">when</span> <span class="p">(&#34;</span><span class="s2">bilbo</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">bagg1n5</span><span class="p">&#34;)</span>      <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hello, Bilbo Baggins!</span><span class="p">&#34;</span> <span class="p">}</span>
    <span class="k">when</span> <span class="p">(&#34;</span><span class="s2">twostraws</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;)</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hello, Paul Hudson!</span><span class="p">&#34;</span>   <span class="p">}</span>
    <span class="k">default</span>                        <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">你是谁?</span><span class="p">&#34;</span>                <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="部分匹配">部分匹配</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># 你只关心某些感兴趣的值，不关心其它值，使用 `*` 号或 `$` 来代表 &#34;any value is fine&#34;</span>
<span class="k">my</span> <span class="nv">$authentication</span> <span class="o">=</span> <span class="p">(&#34;</span><span class="s2">twostraws</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">127.0.0.1</span><span class="p">&#34;);</span>

<span class="k">given</span> <span class="nv">$authentication</span> <span class="p">{</span>
    <span class="k">when</span> <span class="p">(&#34;</span><span class="s2">bilbo</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">bagg1n5</span><span class="p">&#34;</span><span class="o">,</span> <span class="o">*</span><span class="p">)</span>      <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hello, Bilbo Baggins!</span><span class="p">&#34;}</span>
    <span class="k">when</span> <span class="p">(&#34;</span><span class="s2">twostraws</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;</span><span class="o">,</span> <span class="nv">$</span><span class="p">)</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hello, Paul Hudson!</span><span class="p">&#34;</span>  <span class="p">}</span>
    <span class="k">default</span>                           <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Who are you?</span><span class="p">&#34;</span>         <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="只匹配元组的一部分">只匹配元组的一部分</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="c1"># 但仍然想知道其它部分是什么</span>
<span class="k">my</span> <span class="nv">$authentication</span> <span class="o">=</span> <span class="p">(&#34;</span><span class="s2">twostraws</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;);</span>

<span class="k">given</span> <span class="nv">$authentication</span> <span class="p">{</span>
    <span class="k">when</span> <span class="p">(&#34;</span><span class="s2">bilbo</span><span class="p">&#34;</span><span class="o">,</span> <span class="o">*</span><span class="p">)</span>     <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hello, Bilbo Baggins!</span><span class="p">&#34;</span> <span class="p">}</span>
    <span class="k">when</span> <span class="p">(&#34;</span><span class="s2">twostraws</span><span class="p">&#34;</span><span class="o">,</span> <span class="o">*</span><span class="p">)</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hello, Paul Hudson: your password was </span><span class="nv">$_</span><span class="s2">!</span><span class="p">&#34;</span> <span class="p">}</span>
    <span class="k">default</span>               <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Who are you?</span><span class="p">&#34;</span>         <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="匹配计算型元组">匹配计算型元组</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">fizzbuzz</span><span class="p">(</span><span class="nb">Int</span> <span class="nv">$number</span><span class="p">)</span> <span class="k">returns</span> <span class="nb">Str</span> <span class="p">{</span>
    <span class="k">given</span> <span class="p">(</span><span class="nv">$number</span> <span class="nv">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="o">,</span> <span class="nv">$number</span> <span class="nv">%</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">when</span> <span class="p">(</span><span class="nb">True</span><span class="o">,</span> <span class="nb">False</span><span class="p">)</span>  <span class="p">{</span> <span class="k">return</span> <span class="p">&#34;</span><span class="s2">Fizz</span><span class="p">&#34;</span>     <span class="p">}</span>
        <span class="k">when</span> <span class="p">(</span><span class="nb">False</span><span class="o">,</span> <span class="nb">True</span><span class="p">)</span>  <span class="p">{</span> <span class="k">return</span> <span class="p">&#34;</span><span class="s2">Buzz</span><span class="p">&#34;</span>     <span class="p">}</span>
        <span class="k">when</span> <span class="p">(</span><span class="nb">True</span><span class="o">,</span> <span class="nb">True</span><span class="p">)</span>   <span class="p">{</span> <span class="k">return</span> <span class="p">&#34;</span><span class="s2">FizzBuzz</span><span class="p">&#34;</span> <span class="p">}</span>
        <span class="k">when</span> <span class="p">(</span><span class="nb">False</span><span class="o">,</span> <span class="nb">False</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$number</span><span class="o">.</span><span class="nb">Str</span><span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nb">say</span> <span class="nf">fizzbuzz</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
</code></pre></div><h3 id="遍历元组">遍历元组</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$twostraws</span> <span class="o">=</span> <span class="p">(&#34;</span><span class="s2">twostraws</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;);</span>
<span class="k">my</span> <span class="nv">$bilbo</span> <span class="o">=</span> <span class="p">(&#34;</span><span class="s2">bilbo</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">bagg1n5</span><span class="p">&#34;);</span>
<span class="k">my</span> <span class="nv">$taylor</span> <span class="o">=</span> <span class="p">(&#34;</span><span class="s2">taylor</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;);</span>
<span class="k">my</span> <span class="nv">@users</span> <span class="o">=</span> <span class="nv">$twostraws</span><span class="o">,</span> <span class="nv">$bilbo</span><span class="o">,</span> <span class="nv">$taylor</span><span class="p">;</span>

<span class="k">for</span> <span class="nv">@users</span> <span class="k">-&gt;</span> <span class="nv">$user</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$user</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><h3 id="使用-when-匹配元组中的指定值">使用 when 匹配元组中的指定值</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$twostraws</span> <span class="o">=</span> <span class="p">(&#34;</span><span class="s2">twostraws</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;);</span>
<span class="k">my</span> <span class="nv">$bilbo</span> <span class="o">=</span> <span class="p">(&#34;</span><span class="s2">bilbo</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">bagg1n5</span><span class="p">&#34;);</span>
<span class="k">my</span> <span class="nv">$taylor</span> <span class="o">=</span> <span class="p">(&#34;</span><span class="s2">taylor</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;);</span>
<span class="k">my</span> <span class="nv">@users</span> <span class="o">=</span> <span class="nv">$twostraws</span><span class="o">,</span> <span class="nv">$bilbo</span><span class="o">,</span> <span class="nv">$taylor</span><span class="p">;</span>

<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">User twostraws has the password fr0st1es</span><span class="p">&#34;</span> <span class="k">when</span> <span class="p">(&#34;</span><span class="s2">twostraws</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;)</span> <span class="k">for</span> <span class="nv">@users</span><span class="p">;</span>

<span class="c1"># 打印秘密为指定值的用户</span>
<span class="nb">say</span> <span class="p">&#34;</span><span class="s2">User </span><span class="nv">$_</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="s2"> has password \&#34;fr0st1es\&#34;</span><span class="p">&#34;</span> <span class="k">when</span> <span class="p">(</span><span class="o">*,</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;)</span> <span class="k">for</span> <span class="nv">@users</span><span class="p">;</span>
</code></pre></div><h3 id="匹配范围">匹配范围</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$age</span> <span class="o">=</span> <span class="mi">36</span><span class="p">;</span>

<span class="k">given</span> <span class="nv">$age</span> <span class="p">{</span>
    <span class="k">when</span> <span class="mi">0</span> <span class="o">..^</span> <span class="mi">18</span>   <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">你有活力有时间，但是没钱</span><span class="p">&#34;</span>  <span class="p">}</span>
    <span class="k">when</span> <span class="mi">18</span> <span class="o">..^</span> <span class="mi">70</span>  <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">你有活力有钱，但是没时间</span><span class="p">&#34;</span>  <span class="p">}</span>
    <span class="k">default</span>         <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">你有时间和金钱，但是没活力</span><span class="p">&#34;}</span>
<span class="p">}</span>
</code></pre></div><h3 id="when-可以配合智能匹配操作符--单独使用">when 可以配合智能匹配操作符 ~~ 单独使用</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$age</span> <span class="o">=</span> <span class="mi">36</span><span class="p">;</span>
<span class="k">when</span> <span class="nv">$age</span> <span class="o">~~</span> <span class="mi">0</span> <span class="o">..^</span> <span class="mi">18</span>  <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">你有活力有时间，但是没钱</span><span class="p">&#34;</span>  <span class="p">}</span>
<span class="k">when</span> <span class="nv">$age</span> <span class="o">~~</span> <span class="mi">18</span> <span class="o">..^</span> <span class="mi">70</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">你有活力有钱，但是没时间</span><span class="p">&#34;</span>  <span class="p">}</span>
<span class="k">default</span>                <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">你有时间和金钱，但是没活力</span><span class="p">&#34;}</span>
</code></pre></div><h3 id="使用-contains-方法">使用 contains 方法</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$age</span> <span class="o">=</span> <span class="mi">36</span><span class="p">;</span>
<span class="k">when</span> <span class="p">(</span><span class="mi">0</span> <span class="o">..^</span> <span class="mi">18</span><span class="p">)</span><span class="o">.</span><span class="nb">contains</span><span class="p">(</span><span class="nv">$age</span><span class="p">)</span>  <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">你有活力有时间，但是没钱</span><span class="p">&#34;</span>  <span class="p">}</span>
<span class="k">when</span> <span class="p">(</span><span class="mi">18</span> <span class="o">..^</span> <span class="mi">70</span><span class="p">)</span><span class="o">.</span><span class="nb">contains</span><span class="p">(</span><span class="nv">$age</span><span class="p">)</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">你有活力有钱，但是没时间</span><span class="p">&#34;</span>  <span class="p">}</span>
<span class="k">default</span>                         <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">你有时间和金钱，但是没活力</span><span class="p">&#34;}</span>
</code></pre></div><h3 id="匹配元组中的范围">匹配元组中的范围</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">$user</span> <span class="o">=</span> <span class="p">(&#34;</span><span class="s2">twostraws</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">fr0st1es</span><span class="p">&#34;</span><span class="o">,</span> <span class="mi">36</span><span class="p">);</span>

<span class="k">given</span> <span class="nv">$user</span> <span class="p">{</span>
    <span class="k">my</span> <span class="nv">$name</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
    <span class="k">when</span> <span class="p">(</span><span class="nv">$name</span><span class="o">,</span> <span class="o">*,</span> <span class="mi">0</span> <span class="o">..^</span> <span class="mi">18</span><span class="p">)</span>  <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$name</span><span class="s2"> 有活力有时间，但是没钱</span><span class="p">&#34;</span>  <span class="p">}</span>
    <span class="k">when</span> <span class="p">(</span><span class="nv">$name</span><span class="o">,</span> <span class="o">*,</span> <span class="mi">18</span> <span class="o">..^</span> <span class="mi">70</span><span class="p">)</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$name</span><span class="s2"> 有活力有钱，但是没时间</span><span class="p">&#34;</span>  <span class="p">}</span>
    <span class="k">when</span> <span class="p">(</span><span class="nv">$name</span><span class="o">,</span> <span class="o">*,</span> <span class="o">*</span><span class="p">)</span>         <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$name</span><span class="s2"> 有时间和金钱,但是没活力</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="枚举">枚举</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">enum</span> <span class="n">WeatherType</span> <span class="p">&lt;</span><span class="s">Cloudy Sunny Windy</span><span class="p">&gt;;</span>
<span class="k">my</span> <span class="nv">$today</span> <span class="o">=</span> <span class="n">WeatherType::Cloudy</span><span class="p">;</span>

<span class="k">given</span> <span class="nv">$today</span> <span class="p">{</span>
    <span class="k">when</span> <span class="n">WeatherType::Cloudy</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">多云</span><span class="p">&#34;</span> <span class="p">}</span>
    <span class="k">when</span> <span class="n">WeatherType::Sunny</span>  <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">晴天</span><span class="p">&#34;</span> <span class="p">}</span>
    <span class="k">when</span> <span class="n">WeatherType::Windy</span>  <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">有风</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># 使用 if 语句</span>
<span class="k">if</span> <span class="nv">$today</span> <span class="o">~~</span> <span class="n">WeatherType::Cloudy</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">多云</span><span class="p">&#34;</span> <span class="p">}</span>
</code></pre></div><h3 id="关联值">关联值</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">enum</span> <span class="n">WeatherType</span>  <span class="p">(</span>
    <span class="s">Cloudy</span> <span class="o">=&gt;</span> <span class="mi">100</span>,
    <span class="s">Sunny</span>  <span class="o">=&gt;</span> <span class="mi">50</span>,
    <span class="s">Windy</span>  <span class="o">=&gt;</span> <span class="mi">30</span>
<span class="p">);</span>

<span class="k">my</span> <span class="nv">$today</span> <span class="o">=</span> <span class="n">WeatherType::Windy</span><span class="p">;</span>
<span class="k">given</span> <span class="nv">$today</span> <span class="p">{</span>
    <span class="k">when</span> <span class="n">WeatherType::Cloudy</span> <span class="p">{</span> <span class="nb">say</span> <span class="mi">20</span><span class="o">*</span><span class="n">Cloudy</span> <span class="p">}</span>
    <span class="k">when</span> <span class="n">WeatherType::Sunny</span>  <span class="p">{</span> <span class="nb">say</span> <span class="mi">10</span><span class="o">*</span><span class="n">Sunny</span>  <span class="p">}</span>
    <span class="k">when</span> <span class="n">WeatherType::Windy</span>  <span class="p">{</span> <span class="nb">say</span> <span class="mi">12</span><span class="o">*</span><span class="n">Windy</span>  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><h3 id="when-从句">when 从句</h3>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">my</span> <span class="nv">@numbers</span> <span class="o">=</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">;</span>
<span class="o">.</span><span class="nb">say</span> <span class="k">when</span> <span class="nv">$_</span> <span class="nv">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">for</span> <span class="nv">@numbers</span><span class="p">;</span>

<span class="k">my</span> <span class="nv">@celebrities</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2">Michael Jackson</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">Taylor Swift</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">MichaelCaine</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">Adele Adkins</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">Michael Jordan</span><span class="p">&#34;;</span>
<span class="o">.</span><span class="nb">say</span> <span class="k">when</span> <span class="o">/^</span><span class="n">Michael</span><span class="o">/</span> <span class="k">for</span> <span class="nv">@celebrities</span><span class="p">;</span>     <span class="c1"># 使用正则表达式</span>
<span class="o">.</span><span class="nb">say</span> <span class="k">when</span> <span class="nv">$_</span><span class="o">.</span><span class="nb">chars</span> <span class="o">&gt;</span> <span class="mi">12</span> <span class="k">for</span> <span class="nv">@celebrities</span><span class="p">;</span>  <span class="c1"># 调用方法</span>
<span class="o">.</span><span class="nb">say</span> <span class="k">when</span> <span class="o">/^</span><span class="n">Michael</span><span class="o">/</span> <span class="ow">and</span> <span class="nv">$_</span><span class="o">.</span><span class="nb">chars</span> <span class="o">&gt;</span><span class="mi">12</span> <span class="k">for</span> <span class="nv">@celebrities</span><span class="p">;</span> <span class="c1"># 复合条件</span>
</code></pre></div><h3 id="proceed">proceed</h3>
<p>given-when 有两个小的改变, 并且这俩改变都是开启新行为的, 而不是限制已存在的行为。</p>
<p>第一个小的改变: when 的开关行为不仅仅是用于 given 块儿中的, 而是可以用在任何&quot;主题化&quot;的块儿中的, 例如 for 循环中或接收 <code>$_</code> 作为参数的子例程中。</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">given</span> <span class="nv">$answer</span> <span class="p">{</span>
    <span class="k">when</span> <span class="p">&#34;</span><span class="s2">Atlantis</span><span class="p">&#34;</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">那是对的</span><span class="p">&#34;</span> <span class="p">}</span>
    <span class="k">default</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">BZZZZZZZZZZZZZ!</span><span class="p">&#34;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="mi">100</span> <span class="p">{</span>
    <span class="k">when</span> <span class="o">*</span> <span class="nv">%%</span> <span class="mi">15</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Fizzbuzz</span><span class="p">&#34;</span> <span class="p">}</span>
    <span class="k">when</span> <span class="o">*</span> <span class="nv">%%</span> <span class="mi">3</span>  <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Fizz</span><span class="p">&#34;</span>     <span class="p">}</span>
    <span class="k">when</span> <span class="o">*</span> <span class="nv">%%</span> <span class="mi">5</span>  <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Buzz</span><span class="p">&#34;</span>     <span class="p">}</span>
    <span class="k">default</span>      <span class="p">{</span> <span class="nb">say</span> <span class="nv">$_</span>         <span class="p">}</span>
<span class="p">}</span>

<span class="k">sub</span> <span class="nf">expand</span><span class="p">(</span><span class="nv">$_</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">when</span> <span class="p">&#34;</span><span class="s2">R</span><span class="p">&#34;</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">红警</span><span class="p">&#34;</span> <span class="p">}</span>
    <span class="k">when</span> <span class="p">&#34;</span><span class="s2">G</span><span class="p">&#34;</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">绿警</span><span class="p">&#34;</span> <span class="p">}</span>
    <span class="k">when</span> <span class="p">&#34;</span><span class="s2">B</span><span class="p">&#34;</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">蓝警</span><span class="p">&#34;</span> <span class="p">}</span>
    <span class="k">default</span>  <span class="p">{</span> <span class="nb">say</span> <span class="nv">$_</span>     <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>但是甚至不接受 <code>$_</code> 作为参数的子例程也得到了它们自己的词法变量 <code>$_</code> 供修改。所以规则就是&quot;现在, 在 <code>$_</code> 中有某些我能启动的好东西吗&quot;。如果我们想要, 我们甚至能自己设置 <code>$_</code>。</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">sub</span> <span class="nf">seek-the-answer</span><span class="p">()</span> <span class="p">{</span>
    <span class="nv">$_</span> <span class="o">=</span> <span class="p">(</span><span class="o">^</span><span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="nb">pick</span><span class="p">;</span>
    <span class="k">when</span> <span class="mi">42</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">The answer</span><span class="p">&#34;</span> <span class="p">}</span>
    <span class="k">default</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">A number</span><span class="p">&#34;</span>   <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>换句话说, 我们已经知道了 <strong>when</strong> 和 <strong>given</strong> 是单独的。Switch 语句逻辑都在 when 语句中。</p>
<p>第二个小改变: 你可以嵌套 <em>when</em> 语句!</p>
<p>我很确信你没有在野外见过这种用法。但它有时候特别有用:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">when</span> <span class="o">*</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="p">{</span>
    <span class="k">when</span> <span class="mi">4</span>  <span class="p">{</span> <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">Four!</span><span class="p">&#39;</span> <span class="p">}</span>
    <span class="k">default</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">huge</span><span class="p">&#39;</span>  <span class="p">}</span>
<span class="p">}</span>

<span class="k">default</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">little</span><span class="p">&#39;</span>
<span class="p">}</span>
</code></pre></div><p>你可能记得, 在 when 块儿中有一个隐式的 <em>succeed</em> 语句在末尾, 这让周围的主题化块退出。(意思是你不必记着手动退出 switch 语句)。如果你想重写 succeed 语句并继续通过 when block, 那么你在 <em>when</em> block 的末尾写上一个显式的 <em>proceed</em> 即可。</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">given</span> <span class="nv">$verse-number</span> <span class="p">{</span>
    <span class="k">when</span> <span class="o">*</span> <span class="o">&gt;=</span> <span class="mi">12</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Twelve drummers drumming</span><span class="p">&#34;;</span> <span class="k">proceed</span> <span class="p">}</span>
    <span class="k">when</span> <span class="o">*</span> <span class="o">&gt;=</span> <span class="mi">11</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Eleven pipers piping</span><span class="p">&#34;;</span> <span class="k">proceed</span>     <span class="p">}</span>
    <span class="c1"># ...</span>
    <span class="k">when</span> <span class="o">*</span> <span class="o">&gt;=</span> <span class="mi">5</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">FIIIIIIVE GOLDEN RINGS!</span><span class="p">&#34;;</span> <span class="k">proceed</span> <span class="p">}</span>
    <span class="k">when</span> <span class="o">*</span> <span class="o">&gt;=</span> <span class="mi">4</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Four calling birds</span><span class="p">&#34;;</span> <span class="k">proceed</span>      <span class="p">}</span>
    <span class="k">when</span> <span class="o">*</span> <span class="o">&gt;=</span> <span class="mi">3</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Three French hens</span><span class="p">&#34;;</span> <span class="k">proceed</span>       <span class="p">}</span>
    <span class="k">when</span> <span class="o">*</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="p">{</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Two turtle doves</span><span class="p">&#34;;</span>
        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">and a partridge in a pear tree</span><span class="p">&#34;;</span>
    <span class="p">}</span>

    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">a partridge in a pear tree</span><span class="p">&#34;;</span>
<span class="p">}</span>
</code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/given" term="given" label="given" />
                             
                                <category scheme="https://ohmyweekly.github.io/tags/when" term="when" label="when" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[When and Where]]></title>
            <link href="https://ohmyweekly.github.io/notes/2015-03-15-when-and-where/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
            
                <id>https://ohmyweekly.github.io/notes/2015-03-15-when-and-where/</id>
            
            
                    <author>
                        <name>焉知非鱼</name>
                    </author>
            <published>2021-07-10T00:00:00+08:00</published>
            <updated>2021-07-10T00:00:00+08:00</updated>
            
            
            <content type="html"><![CDATA[<blockquote>When and Where</blockquote><h2 id="when-可以用在主题化_的语句中">When 可以用在主题化(<code>$_</code>)的语句中</h2>
<p>Raku 里面有个特殊的变量叫 <code>$_</code>, 即主题化变量, the variable in question.</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="p">(&#39;</span><span class="s1">Swift</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">PHP</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Python</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Perl</span><span class="p">&#39;)</span> <span class="k">-&gt;</span> <span class="nv">$item</span>  <span class="p">{</span> 
    <span class="nb">say</span> <span class="nv">$item</span> <span class="k">when</span> <span class="nv">$item</span> <span class="o">~~</span> <span class="p">/</span><span class="ni">^</span><span class="sr">P</span><span class="p">/;</span>
<span class="p">}</span> 
</code></pre></div><p>输出:</p>
<pre><code>PHP
Python
Perl
</code></pre><div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="p">(</span><span class="mi">12</span><span class="o">,</span> <span class="mi">24</span><span class="o">,</span> <span class="mi">56</span><span class="o">,</span> <span class="mi">42</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">.</span><span class="nb">say</span> <span class="k">when</span> <span class="o">*&gt;</span><span class="mi">40</span> 
<span class="p">}</span>
</code></pre></div><p>输出:</p>
<pre><code>56
42
</code></pre><p>而 <em>where</em> 用于对类型进行约束:</p>
<div class="highlight"><pre class="chroma"><code class="language-raku" data-lang="raku"><span class="k">for</span> <span class="p">(&#39;</span><span class="s1">Swift</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">PHP</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Python</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Perl</span><span class="p">&#39;</span><span class="o">,</span> <span class="mi">42</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nv">$item</span> <span class="k">where</span> <span class="nv">$item</span> <span class="o">~~</span> <span class="nb">Str</span> <span class="p">{</span>
    <span class="nb">say</span> <span class="nv">$item</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div><p>输出:</p>
<pre><code>Swift                                                                               
PHP                                                                                 
Python                                                                              
Perl                                                                                    
Constraint type check failed for parameter '$item'       
</code></pre>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmyweekly.github.io/tags/where" term="where" label="where" />
                             
                                <category scheme="https://ohmyweekly.github.io/tags/when" term="when" label="when" />
                            
                        
                    
                
            
        </entry>
    
</feed>
