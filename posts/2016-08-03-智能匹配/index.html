<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">

    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
    
    
    

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5">

    
    <meta name="referrer" content="no-referrer">

    <title>
        
            智能匹配 ❚ 焉知非鱼
        
    </title>

    
    


    
    
    
    

    
    
    
    

    
    
    

    
    
    
    <style>
     
     
     :root {
         --theme-color: #ac4142;
         --theme-color-light: rgba(172, 65, 66, 0.2);
     }
     
     html {
         line-height: 1.5;
     }
    </style>

    
    

    
    
    
    
    <link rel="stylesheet" href="/css/refined.min.7f6d3ee611034e4ebcbc063f1db3bc042fecdc8901afbedad80ff02bae409204.css">
    
    <link rel="preload" href="/css/refined.min.7f6d3ee611034e4ebcbc063f1db3bc042fecdc8901afbedad80ff02bae409204.css" as="style">

    



    
        <style>
         
         /* Background */ .chroma { background-color: #ffffff }
/* Error */ .chroma .err { color: #a61717; background-color: #e3d2d2 }
/* LineTableTD */ .chroma .lntd { vertical-align: top; padding: 0; margin: 0; border: 0; }
/* LineTable */ .chroma .lntable { border-spacing: 0; padding: 0; margin: 0; border: 0; width: auto; overflow: auto; display: block; }
/* LineHighlight */ .chroma .hl { display: block; width: 100%;background-color: #ffffcc }
/* LineNumbersTable */ .chroma .lnt { margin-right: 0.4em; padding: 0 0.4em 0 0.4em; }
/* LineNumbers */ .chroma .ln { margin-right: 0.4em; padding: 0 0.4em 0 0.4em; }
/* Keyword */ .chroma .k { color: #000000; font-weight: bold }
/* KeywordConstant */ .chroma .kc { color: #000000; font-weight: bold }
/* KeywordDeclaration */ .chroma .kd { color: #000000; font-weight: bold }
/* KeywordNamespace */ .chroma .kn { color: #000000; font-weight: bold }
/* KeywordPseudo */ .chroma .kp { color: #000000; font-weight: bold }
/* KeywordReserved */ .chroma .kr { color: #000000; font-weight: bold }
/* KeywordType */ .chroma .kt { color: #445588; font-weight: bold }
/* NameAttribute */ .chroma .na { color: #008080 }
/* NameBuiltin */ .chroma .nb { color: #0086b3 }
/* NameBuiltinPseudo */ .chroma .bp { color: #999999 }
/* NameClass */ .chroma .nc { color: #445588; font-weight: bold }
/* NameConstant */ .chroma .no { color: #008080 }
/* NameDecorator */ .chroma .nd { color: #3c5d5d; font-weight: bold }
/* NameEntity */ .chroma .ni { color: #800080 }
/* NameException */ .chroma .ne { color: #990000; font-weight: bold }
/* NameFunction */ .chroma .nf { color: #990000; font-weight: bold }
/* NameLabel */ .chroma .nl { color: #990000; font-weight: bold }
/* NameNamespace */ .chroma .nn { color: #555555 }
/* NameTag */ .chroma .nt { color: #000080 }
/* NameVariable */ .chroma .nv { color: #008080 }
/* NameVariableClass */ .chroma .vc { color: #008080 }
/* NameVariableGlobal */ .chroma .vg { color: #008080 }
/* NameVariableInstance */ .chroma .vi { color: #008080 }
/* LiteralString */ .chroma .s { color: #dd1144 }
/* LiteralStringAffix */ .chroma .sa { color: #dd1144 }
/* LiteralStringBacktick */ .chroma .sb { color: #dd1144 }
/* LiteralStringChar */ .chroma .sc { color: #dd1144 }
/* LiteralStringDelimiter */ .chroma .dl { color: #dd1144 }
/* LiteralStringDoc */ .chroma .sd { color: #dd1144 }
/* LiteralStringDouble */ .chroma .s2 { color: #dd1144 }
/* LiteralStringEscape */ .chroma .se { color: #dd1144 }
/* LiteralStringHeredoc */ .chroma .sh { color: #dd1144 }
/* LiteralStringInterpol */ .chroma .si { color: #dd1144 }
/* LiteralStringOther */ .chroma .sx { color: #dd1144 }
/* LiteralStringRegex */ .chroma .sr { color: #009926 }
/* LiteralStringSingle */ .chroma .s1 { color: #dd1144 }
/* LiteralStringSymbol */ .chroma .ss { color: #990073 }
/* LiteralNumber */ .chroma .m { color: #009999 }
/* LiteralNumberBin */ .chroma .mb { color: #009999 }
/* LiteralNumberFloat */ .chroma .mf { color: #009999 }
/* LiteralNumberHex */ .chroma .mh { color: #009999 }
/* LiteralNumberInteger */ .chroma .mi { color: #009999 }
/* LiteralNumberIntegerLong */ .chroma .il { color: #009999 }
/* LiteralNumberOct */ .chroma .mo { color: #009999 }
/* Operator */ .chroma .o { color: #000000; font-weight: bold }
/* OperatorWord */ .chroma .ow { color: #000000; font-weight: bold }
/* Comment */ .chroma .c { color: #999988; font-style: italic }
/* CommentHashbang */ .chroma .ch { color: #999988; font-style: italic }
/* CommentMultiline */ .chroma .cm { color: #999988; font-style: italic }
/* CommentSingle */ .chroma .c1 { color: #999988; font-style: italic }
/* CommentSpecial */ .chroma .cs { color: #999999; font-weight: bold; font-style: italic }
/* CommentPreproc */ .chroma .cp { color: #999999; font-weight: bold; font-style: italic }
/* CommentPreprocFile */ .chroma .cpf { color: #999999; font-weight: bold; font-style: italic }
/* GenericDeleted */ .chroma .gd { color: #000000; background-color: #ffdddd }
/* GenericEmph */ .chroma .ge { color: #000000; font-style: italic }
/* GenericError */ .chroma .gr { color: #aa0000 }
/* GenericHeading */ .chroma .gh { color: #999999 }
/* GenericInserted */ .chroma .gi { color: #000000; background-color: #ddffdd }
/* GenericOutput */ .chroma .go { color: #888888 }
/* GenericPrompt */ .chroma .gp { color: #555555 }
/* GenericStrong */ .chroma .gs { font-weight: bold }
/* GenericSubheading */ .chroma .gu { color: #aaaaaa }
/* GenericTraceback */ .chroma .gt { color: #aa0000 }
/* GenericUnderline */ .chroma .gl { text-decoration: underline }
/* TextWhitespace */ .chroma .w { color: #bbbbbb }

         
         /* Overrides on top of the theme and Chroma CSS */
/* Chroma-based lines highlighting in code blocks */
.chroma .hl {
    background-color: #e8e8e8;
    /* Extend highlight up to 100 characters (assuming that the code blocks never have more than 100 characters in a line) */
    min-width: 100ch;
}
/* GenericHeading */ .chroma .gh { color: #999999; font-weight: bold }
/* GenericSubheading */ .chroma .gu { color: #aaaaaa; font-weight: bold }

         
        </style>
    

    

    
    
    

    
    <script src="/js/responsive-nav-orig.min.e2b5f2a956b488f466da513820636134defdc38b90ed566248960593f2bb4ba5.js"></script>
    
    <link rel="preload" href="/js/responsive-nav-orig.min.e2b5f2a956b488f466da513820636134defdc38b90ed566248960593f2bb4ba5.js" as="script">

    
    
    <script defer src="/js/libs/fa/fontawesome-all.min.08916ac0fd078adfb58edc890460e2c8990729aee02bca7586404b56805f5219.js"></script>
    
    <link rel="preload" href="/js/libs/fa/fontawesome-all.min.08916ac0fd078adfb58edc890460e2c8990729aee02bca7586404b56805f5219.js" as="script">

    

    

    
    
    

    
    
<!-- rel="me" links for IndieAuth -->







    
 
<meta property="og:title" content="智能匹配" />
<meta property="og:description"
      content=" " />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ohmycloud.github.io/posts/2016-08-03-%E6%99%BA%E8%83%BD%E5%8C%B9%E9%85%8D/" />


    
        <meta property="article:published_time" content="2016-08-03T00:00:00&#43;00:00"/>
    
    
        <meta property="article:modified_time" content="2016-08-03T00:00:00&#43;00:00"/>
    









    




     <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="智能匹配"/>
<meta name="twitter:description" content=" "/>


    
    
    <link rel="alternate" type="application/jf2post+json" href="https://ohmycloud.github.io/posts/2016-08-03-%E6%99%BA%E8%83%BD%E5%8C%B9%E9%85%8D/jf2post.json" title="Jf2post for 焉知非鱼" />
    
     



    
    
    
        
    


     
        
        <meta name="DC.Creator" content="焉知非鱼"/>
    



    
    
    
    <meta name="hugo-build-date" content="2024-03-01T16:16:06Z"/>
    <meta name="hugo-commit-hash" content="312735366b20d64bd61bff8627f593749f86c964"/>
    <meta name="generator" content="Hugo 0.123.7">
</head>


    
        <body lang="en">
    

        
        <div class="border" id="home"></div>

        <div class="wrapper">   
            
<nav id="nav" class="nav-collapse opened" aria-hidden="false">
    <ul class="navbar">
        <li><a class="" href="/">Home</a></li>
        
            
                <li><a class="" href="https://ohmycloud.github.io/posts/">Posts</a></li>
            
        
            
                <li><a class="" href="https://ohmycloud.github.io/notes/">Notes</a></li>
            
        
        
            <li><a class="" href="https://ohmycloud.github.io/search/">Search</a></li>
        
    </ul>
</nav>

            <div class="container">
                <header class="masthead">
                    <div class="masthead-title no-text-decoration">
                        <a href="/">焉知非鱼</a> <span class="blinking-cursor">❚</span>
                    </div>
                    <div class="masthead-tagline">
                        Wait the light to fall
                    </div>
                </header>

                








<article class="post h-entry posts">
    <header>
        <div class="center">
    <div class="taxo no-text-decoration">
         
            
                <ul class="no-bullets inline categories">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts categorized in ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmycloud.github.io/categories/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
         
            
                <ul class="no-bullets inline tags">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts tagged with ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmycloud.github.io/tags/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
        
    </div>

</div>

        <h1 class="post-title p-name">智能匹配</h1>

        
        <data class="u-url" value="https://ohmycloud.github.io/posts/2016-08-03-%E6%99%BA%E8%83%BD%E5%8C%B9%E9%85%8D/"></data>

        <div class="date-syndication">
            


    
    
    <div class="post-date">
        
        <time datetime="2016-08-03T00:00:00+0000" class="dt-published">Wed Aug 3, 2016</time>
        
        
    </div>


            




        </div>
         



    
    
    
        
    


    
        
        <span class="hide">
            &mdash; <a href="https://ohmycloud.github.io/" class="u-author">焉知非鱼</a>
        </span>
    


    </header>

    <div class="content">
        


        





                       


        <div class="e-content">
            




<h3 id="智能匹配">智能匹配&nbsp;<a class="headline-hash no-text-decoration" href="#智能匹配">#</a> </h3>
<p>智能匹配通常作用在当前”主题”(topic)上, 即作用在 <code>$_</code> 变量上. 在下面的表格中, <code>$_</code> 代表 <code>~~</code> 操作符的左侧, 或者作为 <code>given</code> 的参数,  或者作为其它主题化的参数.  <code>X</code> 代表 <code>~~</code> 操作符右侧要匹配的模式, 或者在 <code>when</code> 后面的模式.(实际上, <code>~~</code> 操作符充当着一个小型的主题; 即, 为了右侧的计算, 它把 <code>$_</code> 绑定到左侧的值上. 使用底层的 <code>.ACCEPTS</code> 形式来避免这种主题化.)</p>
<p>第一节包含了含有享有特权的语法; 如果匹配能通过那些条目之一完成, 那它就会那样做. 这些特别的语法是通过它们的形式而非它们的类型进行分派的. 否则就使用表格中的剩余部分,并且匹配会根据普通的方法分派规则进行分派.  允许优化器(optimizer)假定编译时之后没有定义额外的匹配操作符, 所以, 如果在编译时模式类型就显而易见的, 那么跳转表(jump table)可以被优化. 然而, 这部分表格的语法仍然有点特权的, 跟 <code>~~</code> 操作符一样, 是 Perl 中少有的几个不使用多重分派的操作符之一. 相反, 基于类型的智能匹配会被单个地分派给属于 <code>X</code> 模式对象的底层方法.</p>
<p>换句话说, 智能匹配首先根据模式(pattern)的<code>形式</code>或<code>类型</code>(下面的<code>X</code>)进行<code>分派</code>(dispatch), 然后那个模式自身决定<code>是否</code>和<code>怎样</code>注意主题(<code>$_</code>)的类型. 所以, 下面表格中的第二列就是初始列. 第一列中的 <code>Any</code> 条目标示了模式要么不关心主题的类型,  要么把那个条目作为默认值, 因为上面列出的更具体的类型不匹配.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl">    <span class="nv">$_</span>          <span class="n">X</span>         <span class="n">Type</span> <span class="n">of</span> <span class="n">Match</span> <span class="n">Implied</span>   <span class="n">Match</span> <span class="k">if</span> <span class="p">(</span><span class="n">given</span> <span class="nv">$_</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">======</span>      <span class="o">=====</span>     <span class="o">=====================</span>   <span class="o">===================</span>
</span></span><span class="line"><span class="cl">    <span class="n">Any</span>         <span class="n">True</span>      <span class="o">~~</span> <span class="n">True</span>                 <span class="p">(</span><span class="n">parsewarn</span> <span class="n">on</span> <span class="n">literal</span> <span class="n">token</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Any</span>         <span class="n">False</span>     <span class="o">~~</span> <span class="n">False</span> <span class="n">match</span>          <span class="p">(</span><span class="n">parsewarn</span> <span class="n">on</span> <span class="n">literal</span> <span class="n">token</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Any</span>         <span class="n">Match</span>     <span class="o">~~</span> <span class="n">Successful</span> <span class="n">match</span>     <span class="p">(</span><span class="n">parsewarn</span> <span class="n">on</span> <span class="n">literal</span> <span class="n">token</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Any</span>         <span class="n">Nil</span>       <span class="o">~~</span> <span class="n">Benign</span> <span class="n">failure</span>       <span class="p">(</span><span class="n">parsewarn</span> <span class="n">on</span> <span class="n">literal</span> <span class="n">token</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Any</span>         <span class="n">Failure</span>   <span class="n">Failure</span> <span class="n">type</span> <span class="n">check</span>      <span class="p">(</span><span class="n">okay</span><span class="p">,</span> <span class="n">matches</span> <span class="n">against</span> <span class="n">type</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Any</span>         <span class="o">*</span>         <span class="n">block</span> <span class="n">signature</span> <span class="n">match</span>   <span class="n">block</span> <span class="n">successfully</span> <span class="n">binds</span> <span class="n">to</span> <span class="o">|</span><span class="nv">$_</span>
</span></span><span class="line"><span class="cl">    <span class="n">Any</span>         <span class="n">Callable:</span><span class="p">(</span><span class="nv">$</span><span class="p">)</span>  <span class="n">item</span> <span class="k">sub</span> <span class="nf">truth</span>      <span class="nf">X</span><span class="p">($_)
</span></span></span><span class="line"><span class="cl"><span class="p">                                                  S03-smartmatch/any-callable.t lines 5–14
</span></span></span><span class="line"><span class="cl"><span class="p">    Any         Callable:()   simple closure truth    X() (ignoring $_)
</span></span></span><span class="line"><span class="cl"><span class="p">                                                  S03-smartmatch/any-callable.t lines 15–24
</span></span></span><span class="line"><span class="cl"><span class="p">
</span></span></span><span class="line"><span class="cl"><span class="p">    Any         Bool      simple truth            X (treats Bool value as success/failure)
</span></span></span><span class="line"><span class="cl"><span class="p">                                                  S03-smartmatch/any-bool.t lines 5–23
</span></span></span><span class="line"><span class="cl"><span class="p">
</span></span></span><span class="line"><span class="cl"><span class="p">    Any         List      list truth              X (treats list size as success/failure)
</span></span></span><span class="line"><span class="cl"><span class="p">    Any         Match     match success           X (treats Match value as success)
</span></span></span><span class="line"><span class="cl"><span class="p">    Any         Nil       benign failure          X (treats Nil value as failure)
</span></span></span><span class="line"><span class="cl"><span class="p">    Any         Failure   malign failure          X (passes Failure object through)
</span></span></span><span class="line"><span class="cl"><span class="p">    Any         Numeric   numeric equality        +$_ == X
</span></span></span><span class="line"><span class="cl"><span class="p">    Any         Stringy   string equality         ~$_ eq X
</span></span></span><span class="line"><span class="cl"><span class="p">    Any         Whatever  always matches          True
</span></span></span><span class="line"><span class="cl"><span class="p">    Associative Pair      test hash mapping       $_{</span><span class="n">X</span><span class="o">.</span><span class="n">key</span><span class="p">}</span> <span class="o">~~</span> <span class="n">X</span><span class="o">.</span><span class="n">value</span>
</span></span><span class="line"><span class="cl">    <span class="n">Any</span>         <span class="n">Pair</span>      <span class="n">test</span> <span class="n">object</span> <span class="n">attribute</span>   <span class="p">?</span><span class="o">.</span><span class="s">&#34;{X.key}&#34;</span> <span class="o">===</span> <span class="p">?</span><span class="n">X</span><span class="o">.</span><span class="n">value</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">filetests</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                                  <span class="n">S03</span><span class="o">-</span><span class="n">smartmatch</span><span class="o">/</span><span class="n">any</span><span class="o">-</span><span class="n">pair</span><span class="o">.</span><span class="n">t</span> <span class="n">lines</span> <span class="mi">5</span><span class="err">–</span><span class="mi">35</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Set</span>         <span class="n">Set</span>       <span class="n">identical</span> <span class="n">sets</span>          <span class="nv">$_</span> <span class="o">===</span> <span class="n">X</span>
</span></span><span class="line"><span class="cl">    <span class="n">Any</span>         <span class="n">Setty</span>     <span class="n">force</span> <span class="n">set</span> <span class="n">comparison</span>    <span class="nv">$_</span><span class="o">.</span><span class="n">Set</span> <span class="o">===</span> <span class="n">X</span><span class="o">.</span><span class="n">Set</span>
</span></span><span class="line"><span class="cl">    <span class="n">Bag</span>         <span class="n">Bag</span>       <span class="n">identical</span> <span class="n">bags</span>          <span class="nv">$_</span> <span class="o">===</span> <span class="n">X</span>
</span></span><span class="line"><span class="cl">    <span class="n">Any</span>         <span class="n">Baggy</span>     <span class="n">force</span> <span class="n">bag</span> <span class="n">comparison</span>    <span class="nv">$_</span><span class="o">.</span><span class="n">Bag</span> <span class="o">===</span> <span class="n">X</span><span class="o">.</span><span class="n">Bag</span>
</span></span><span class="line"><span class="cl">    <span class="n">Mix</span>         <span class="n">Mix</span>       <span class="n">identical</span> <span class="n">bags</span>          <span class="nv">$_</span> <span class="o">===</span> <span class="n">X</span>
</span></span><span class="line"><span class="cl">    <span class="n">Any</span>         <span class="n">Mixy</span>      <span class="n">force</span> <span class="n">mix</span> <span class="n">comparison</span>    <span class="nv">$_</span><span class="o">.</span><span class="n">Mix</span> <span class="o">===</span> <span class="n">X</span><span class="o">.</span><span class="n">Mix</span>
</span></span><span class="line"><span class="cl">    <span class="n">Positional</span>  <span class="n">Array</span>     <span class="n">arrays</span> <span class="n">are</span> <span class="n">comparable</span>   <span class="nv">$_</span> <span class="err">«</span><span class="o">===</span><span class="err">»</span> <span class="n">X</span> <span class="p">(</span><span class="n">dwims</span> <span class="o">*</span> <span class="n">wildcards</span><span class="o">!</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                                  <span class="n">S03</span><span class="o">-</span><span class="n">smartmatch</span><span class="o">/</span><span class="n">array</span><span class="o">-</span><span class="n">array</span><span class="o">.</span><span class="n">t</span> <span class="n">lines</span> <span class="mi">5</span><span class="err">–</span><span class="mi">70</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Associative</span> <span class="n">Array</span>     <span class="nb">keys</span><span class="o">/</span><span class="n">list</span> <span class="n">are</span> <span class="n">comparable</span> <span class="o">+</span><span class="n">X</span> <span class="o">==</span> <span class="o">+</span><span class="nv">$_</span> <span class="ow">and</span> <span class="nv">$_</span><span class="p">{</span><span class="n">X</span><span class="o">.</span><span class="n">all</span><span class="p">}:</span><span class="nb">exists</span>
</span></span><span class="line"><span class="cl">    <span class="n">Callable</span>    <span class="n">Positional</span> <span class="n">list</span> <span class="n">vs</span> <span class="n">predicate</span>      <span class="n">so</span> <span class="nv">$_</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Any</span>         <span class="n">Positional</span> <span class="n">lists</span> <span class="n">are</span> <span class="n">comparable</span>   <span class="nv">$_</span><span class="o">[]</span> <span class="err">«</span><span class="o">===</span><span class="err">»</span> <span class="n">X</span><span class="o">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">Hash</span>        <span class="n">Hash</span>      <span class="n">hash</span> <span class="n">mapping</span> <span class="n">equivalent</span> <span class="nv">$_</span> <span class="n">eqv</span> <span class="n">X</span>
</span></span><span class="line"><span class="cl">    <span class="n">Associative</span> <span class="n">Hash</span>      <span class="n">force</span> <span class="n">hash</span> <span class="n">comparison</span>   <span class="nv">$_</span><span class="o">.</span><span class="n">Hash</span> <span class="n">eqv</span> <span class="n">X</span>
</span></span><span class="line"><span class="cl">    <span class="n">Callable</span>    <span class="n">Hash</span>      <span class="n">hash</span> <span class="n">vs</span> <span class="n">predicate</span>       <span class="n">so</span> <span class="nv">$_</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Positional</span>  <span class="n">Hash</span>      <span class="n">attempted</span> <span class="n">any</span><span class="o">/</span><span class="n">all</span>    <span class="n">FAIL</span><span class="p">,</span> <span class="n">point</span> <span class="n">user</span> <span class="n">to</span> <span class="o">[].</span><span class="n">any</span> <span class="ow">and</span> <span class="o">[].</span><span class="n">all</span> <span class="k">for</span> <span class="n">LHS</span>
</span></span><span class="line"><span class="cl">    <span class="n">Pair</span>        <span class="n">Hash</span>      <span class="n">hash</span> <span class="n">does</span> <span class="n">mapping</span>       <span class="n">X</span><span class="p">{</span><span class="o">.</span><span class="n">key</span><span class="p">}</span> <span class="o">~~</span> <span class="o">.</span><span class="n">value</span>
</span></span><span class="line"><span class="cl">    <span class="n">Any</span>         <span class="n">Hash</span>      <span class="n">hash</span> <span class="n">contains</span> <span class="n">object</span>    <span class="n">X</span><span class="p">{</span><span class="nv">$_</span><span class="p">}:</span><span class="nb">exists</span>
</span></span><span class="line"><span class="cl">    <span class="n">Str</span>         <span class="n">Regex</span>     <span class="n">string</span> <span class="n">pattern</span> <span class="n">match</span>    <span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Associative</span> <span class="n">Regex</span>     <span class="n">attempted</span> <span class="nb">reverse</span> <span class="n">dwim</span>  <span class="n">FAIL</span><span class="p">,</span> <span class="n">point</span> <span class="n">user</span> <span class="n">to</span> <span class="n">any</span><span class="sr">/all vs keys/</span><span class="nb">values</span><span class="o">/</span><span class="n">pairs</span>
</span></span><span class="line"><span class="cl">    <span class="n">Positional</span>  <span class="n">Regex</span>     <span class="n">attempted</span> <span class="n">any</span><span class="sr">/all/c</span><span class="n">at</span>   <span class="n">FAIL</span><span class="p">,</span> <span class="n">point</span> <span class="n">user</span> <span class="n">to</span> <span class="n">any</span><span class="sr">/all/c</span><span class="n">at</span><span class="o">/</span><span class="nb">join</span> <span class="k">for</span> <span class="n">LHS</span>
</span></span><span class="line"><span class="cl">    <span class="n">Any</span>         <span class="n">Regex</span>     <span class="n">pattern</span> <span class="n">match</span>           <span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Range</span>       <span class="n">Range</span>     <span class="n">subset</span> <span class="n">range</span>            <span class="o">!</span><span class="nv">$_</span> <span class="ow">or</span> <span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">all</span> <span class="o">~~</span> <span class="n">X</span> <span class="p">(</span><span class="n">mod</span> <span class="o">^</span><span class="s">&#39;s)
</span></span></span><span class="line"><span class="cl"><span class="s">                                                  S03-smartmatch/range-range.t lines 5–29
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">    Any         Range     in real range           X.min &lt;= $_ &lt;= X.max (mod ^&#39;</span><span class="n">s</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                                                  <span class="n">S03</span><span class="o">-</span><span class="n">smartmatch</span><span class="o">/</span><span class="n">disorganized</span><span class="o">.</span><span class="n">t</span> <span class="n">lines</span> <span class="mi">30</span><span class="err">–</span><span class="mi">145</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Any</span>         <span class="n">Range</span>     <span class="n">in</span> <span class="n">stringy</span> <span class="n">range</span>        <span class="n">X</span><span class="o">.</span><span class="n">min</span> <span class="ow">le</span> <span class="nv">$_</span> <span class="ow">le</span> <span class="n">X</span><span class="o">.</span><span class="n">max</span> <span class="p">(</span><span class="n">mod</span> <span class="o">^</span><span class="s">&#39;s)
</span></span></span><span class="line"><span class="cl"><span class="s">    Any         Range     in generic range        [!after] X.min,$_,X.max (etc.)
</span></span></span><span class="line"><span class="cl"><span class="s">    Any         Type      type membership         $_.does(X)
</span></span></span><span class="line"><span class="cl"><span class="s">                                                  S03-smartmatch/any-type.t lines 5–40
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">    Signature   Signature sig compatibility       $_ is a subset of X      ???
</span></span></span><span class="line"><span class="cl"><span class="s">    Callable    Signature sig compatibility       $_.sig is a subset of X  ???
</span></span></span><span class="line"><span class="cl"><span class="s">    Capture     Signature parameters bindable     $_ could bind to X (doesn&#39;</span><span class="n">t</span><span class="o">!</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Any</span>         <span class="n">Signature</span> <span class="n">parameters</span> <span class="n">bindable</span>     <span class="o">|</span><span class="nv">$_</span> <span class="n">could</span> <span class="nb">bind</span> <span class="n">to</span> <span class="n">X</span> <span class="p">(</span><span class="n">doesn</span><span class="err">&#39;</span><span class="n">t</span><span class="o">!</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Signature</span>   <span class="n">Capture</span>   <span class="n">parameters</span> <span class="n">bindable</span>     <span class="n">X</span> <span class="n">could</span> <span class="nb">bind</span> <span class="n">to</span> <span class="nv">$_</span>
</span></span><span class="line"><span class="cl">    <span class="n">Any</span>         <span class="n">Any</span>       <span class="n">scalars</span> <span class="n">are</span> <span class="n">identical</span>   <span class="nv">$_</span> <span class="o">===</span> <span class="n">X</span>
</span></span><span class="line"><span class="cl">                                                   <span class="n">S03</span><span class="o">-</span><span class="n">smartmatch</span><span class="o">/</span><span class="n">any</span><span class="o">-</span><span class="n">any</span><span class="o">.</span><span class="n">t</span> <span class="n">lines</span> <span class="mi">5</span><span class="err">–</span><span class="mi">29</span>
</span></span></code></pre></div><p>如果没有其它模式要求 X, 最后那个 rule 才会被应用.</p>
<p>所有的智能匹配类型都是<code>itemized</code>; <code>~~</code> 和 <code>given/when</code> 都为它们的参数提供了 item (标量) 上下文, 并自动展开任何 junctive 匹配, 以使最终给 <code>.ACCEPTS</code> 的分派看不到任何复数. 所以,上面的 <code>$_</code> 和 <code>X</code> 是能被看作标量的潜在容器对象. (你可以显式地使 <code>~~</code> 亢奋, 在这种情况下, 所有的智能匹配是使用 <code>.ACCEPTS</code> 的基于类型的分派来完成的, 不是前面表格中的基于形式的分派)</p>
<p>基于类型的底层方法分派真正形式是 :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="n">X</span><span class="o">.</span><span class="n">ACCEPTS</span><span class="p">(</span><span class="nv">$_</span><span class="p">)</span>
</span></span></code></pre></div><p>作为单个分派调用, 这仅仅只关注初始化的 X 的类型. <code>ACCEPT</code> 方法接口是通过 <code>Pattern</code> role 来定义的. 任何组成 <code>Pattern</code> role 的类都可以选择提供单个 <code>ACCEPTS</code> 方法来处理一切, 这对用于那些上面说的 Any 中只有一个条目模式类型.</p>
<p>或者在类中,类也能选择提供多个 <code>ACCEPTS</code>  multi-methods, 这些然后会在类中根据 <code>$_</code> 的类型进行重新分派.</p>
<p>智能匹配表格主要用于反应编译时能识别的形式和类型. 为了避免条目的扩展, 表格假设下面的类型会表现的类似:</p>
<table>
<thead>
<tr>
<th style="text-align:left">实际类型</th>
<th style="text-align:left">把条目用作</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Iterator Array</td>
<td style="text-align:left">List</td>
</tr>
<tr>
<td style="text-align:left">使用 Class,Enum,Role,或一般类型绑定的具名值</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">Cat</td>
<td style="text-align:left">Str</td>
</tr>
<tr>
<td style="text-align:left">Int UInt等</td>
<td style="text-align:left">Num</td>
</tr>
<tr>
<td style="text-align:left">BUf</td>
<td style="text-align:left">Str or Array of Int</td>
</tr>
</tbody>
</table>
<p>(注意, 然而, 这些映射可以通过显式的 ACCEPTS 方法的定义进行重写. 如果在编译时, 重定义比智能匹配的分析早, 那么信息对优化器也是可访问的).</p>
<p>一个在 ASCII 范围之外, 包含任何字节或整数的 <code>Buf</code> 类型可能会静静地提升为 <code>Str</code> 类型用于匹配, 只有在它跟 Unicode 的关系被清楚地声明或类型化时. 这种类型信息可能来自输入文件句柄, 或者 <code>Buf</code> role 可能是一个参数类型, 它允许你使用各种编码来实例化 buffers. 在没有这样的类型信息的情况下, 你仍然可以跟 buffer 进行模式匹配, 但是任何把 buffer 当作不是整数序列的尝试都是错误的, 这通常会发生警告.</p>
<p>匹配 Grammar 会把 grammar 当作类型名, 而不是一个 grammar. 你需要使用 <code>.parse</code> 和 <code>.parsefile</code> 方法来调用一个 grammar.</p>
<p>匹配 <code>Signature</code> 不会真的绑定任何变量, 而是测试签名是否能绑定. 要真的绑定到一个签名上, 使用模式  <code>*</code> 来代理绑定到 <code>when</code>语句块上代替. 匹配 <code>*</code> 在 when 里面很特殊 .  随后的 block 是否绑定了主题变量, 所以你可以做有序的签名匹配:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="n">given</span> <span class="nv">$capture</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">when</span> <span class="o">*</span> <span class="o">-&gt;</span> <span class="n">Int</span> <span class="nv">$a</span><span class="p">,</span> <span class="n">Str</span> <span class="nv">$b</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">when</span> <span class="o">*</span> <span class="o">-&gt;</span> <span class="n">Str</span> <span class="nv">$a</span><span class="p">,</span> <span class="n">Int</span> <span class="nv">$b</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">when</span> <span class="o">*</span> <span class="o">-&gt;</span> <span class="nv">$a</span><span class="p">,</span> <span class="nv">$b</span>         <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">when</span> <span class="o">*</span>                   <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></div><p>当多重分派无序的语义不足以定义代码的”主从秩序”时, 这会很有用. 注意, 你可以绑定给一个裸的 block 或 一个箭头 block. 绑定给裸的 block很方便的把主题放在 `$_ 中,所以上面最后那个形式等价于一个 default.(占位符参数也能用于裸 block 形式, 尽管它们的类型不能被那样指定.)</p>
<p>没有给 <code>Any</code> 模式定义模式匹配,  所以,如果你想要一个反转的智能匹配测试, 右边是一个 <code>Any</code>,这时你总是通过显式的调用使用了 <code>$_</code> 作为模式的底层 <code>ACCEPTS</code> 方法来获取它. 例如:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl">    <span class="nv">$_</span>       <span class="n">X</span>    <span class="n">Type</span> <span class="n">of</span> <span class="n">Match</span> <span class="n">Wanted</span>   <span class="n">What</span> <span class="n">to</span> <span class="k">use</span> <span class="nn">on</span> <span class="n">the</span> <span class="n">right</span>
</span></span><span class="line"><span class="cl">    <span class="o">======</span>  <span class="o">===</span>  <span class="o">====================</span>   <span class="o">========================</span>
</span></span><span class="line"><span class="cl">    <span class="n">Callable</span> <span class="n">Any</span>  <span class="n">item</span> <span class="k">sub</span> <span class="nf">truth</span>         <span class="err">.</span><span class="nf">ACCEPTS</span><span class="err">(</span><span class="nf">X</span><span class="err">)</span> <span class="nf">or</span> <span class="err">.(</span><span class="nf">X</span><span class="err">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">Range</span>    <span class="nf">Any</span>  <span class="nf">in</span> <span class="nf">range</span>               <span class="err">.</span><span class="nf">ACCEPTS</span><span class="err">(</span><span class="nf">X</span><span class="err">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">Type</span>     <span class="nf">Any</span>  <span class="nf">type</span> <span class="nf">membership</span>        <span class="err">.</span><span class="nf">ACCEPTS</span><span class="err">(</span><span class="nf">X</span><span class="err">)</span> <span class="nf">or</span> <span class="err">.</span><span class="nf">does</span><span class="err">(</span><span class="nf">X</span><span class="err">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">Regex</span>    <span class="nf">Any</span>  <span class="nf">pattern</span> <span class="nf">match</span>          <span class="err">.</span><span class="nf">ACCEPTS</span><span class="err">(</span><span class="nf">X</span><span class="err">)</span>
</span></span><span class="line"><span class="cl">    <span class="nf">etc</span><span class="err">.</span>
</span></span></code></pre></div><p>同样的技巧会允许你倾向于给混合对象以默认匹配规则, 只要你在 <code>$_</code> 身上以点方法开头:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="n">given</span> <span class="nv">$somethingordered</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">when</span> <span class="o">.</span><span class="nb">values</span><span class="o">.</span><span class="s">&#39;[&lt;=]&#39;</span>     <span class="p">{</span> <span class="n">say</span> <span class="s">&#34;increasing&#34;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">when</span> <span class="o">.</span><span class="nb">values</span><span class="o">.</span><span class="s">&#39;[&gt;=]&#39;</span>     <span class="p">{</span> <span class="n">say</span> <span class="s">&#34;decreasing&#34;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></div><p>必要时, 你可以定义一个宏来得到”反转的 when”:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="k">my</span> <span class="n">macro</span> <span class="n">statement_control:</span><span class="sr">&lt;ACCEPTS&gt;</span> <span class="p">()</span> <span class="p">{</span> <span class="s">&#34;when .ACCEPTS: &#34;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">given</span> <span class="nv">$pattern</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">ACCEPTS</span> <span class="nv">$a</span>      <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">ACCEPTS</span> <span class="nv">$b</span>      <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">ACCEPTS</span> <span class="nv">$c</span>      <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></div><p>各种建议但不推荐使用的智能匹配行为 可以很容易地(并且我们希望更易读)被模仿成下面这样:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl">    <span class="nv">$_</span>      <span class="n">X</span>      <span class="n">Type</span> <span class="n">of</span> <span class="n">Match</span> <span class="n">Wanted</span>   <span class="n">What</span> <span class="n">to</span> <span class="k">use</span> <span class="nn">on</span> <span class="n">the</span> <span class="n">right</span>
</span></span><span class="line"><span class="cl">    <span class="o">======</span>  <span class="o">===</span>    <span class="o">====================</span>   <span class="o">========================</span>
</span></span><span class="line"><span class="cl">    <span class="n">Array</span>   <span class="n">Num</span>    <span class="n">array</span> <span class="n">element</span> <span class="n">truth</span>    <span class="o">.</span><span class="p">[</span><span class="n">X</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">Array</span>   <span class="n">Num</span>    <span class="n">array</span> <span class="n">contains</span> <span class="n">number</span>  <span class="o">*</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="o">*</span>
</span></span><span class="line"><span class="cl">    <span class="n">Array</span>   <span class="n">Str</span>    <span class="n">array</span> <span class="n">contains</span> <span class="n">string</span>  <span class="o">*</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="o">*</span>
</span></span><span class="line"><span class="cl">    <span class="n">Array</span>   <span class="n">Parcel</span> <span class="n">array</span> <span class="n">begins</span> <span class="o">/</span><span class="n">w</span> <span class="n">Parcel</span> <span class="n">X</span><span class="p">,</span><span class="o">*</span>
</span></span><span class="line"><span class="cl">    <span class="n">Array</span>   <span class="n">Parcel</span> <span class="n">array</span> <span class="n">contains</span> <span class="n">Parcel</span>  <span class="o">*</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="o">*</span>
</span></span><span class="line"><span class="cl">    <span class="n">Array</span>   <span class="n">Parcel</span> <span class="n">array</span> <span class="n">ends</span> <span class="n">with</span> <span class="n">Parcel</span> <span class="o">*</span><span class="p">,</span><span class="n">X</span>
</span></span><span class="line"><span class="cl">    <span class="n">Hash</span>    <span class="n">Str</span>    <span class="n">hash</span> <span class="n">element</span> <span class="n">truth</span>     <span class="o">.</span><span class="p">{</span><span class="n">X</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">Hash</span>    <span class="n">Str</span>    <span class="n">hash</span> <span class="n">key</span> <span class="n">existence</span>     <span class="o">.</span><span class="p">{</span><span class="n">X</span><span class="p">}:</span><span class="nb">exists</span>
</span></span><span class="line"><span class="cl">    <span class="n">Hash</span>    <span class="n">Num</span>    <span class="n">hash</span> <span class="n">element</span> <span class="n">truth</span>     <span class="o">.</span><span class="p">{</span><span class="n">X</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">Hash</span>    <span class="n">Num</span>    <span class="n">hash</span> <span class="n">key</span> <span class="n">existence</span>     <span class="o">.</span><span class="p">{</span><span class="n">X</span><span class="p">}:</span><span class="nb">exists</span>
</span></span><span class="line"><span class="cl">    <span class="n">Buf</span>     <span class="n">Int</span>    <span class="n">buffer</span> <span class="n">contains</span> <span class="nb">int</span>    <span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Str</span>     <span class="n">Str</span>    <span class="n">string</span> <span class="n">contains</span> <span class="n">string</span> <span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Array</span>   <span class="n">Scalar</span> <span class="n">array</span> <span class="n">contains</span> <span class="n">item</span>    <span class="o">.</span><span class="n">any</span> <span class="o">===</span> <span class="n">X</span>
</span></span><span class="line"><span class="cl">    <span class="n">Str</span>     <span class="n">Array</span>  <span class="n">array</span> <span class="n">contains</span> <span class="n">string</span>  <span class="n">X</span><span class="o">.</span><span class="n">any</span>
</span></span><span class="line"><span class="cl">    <span class="n">Num</span>     <span class="n">Array</span>  <span class="n">array</span> <span class="n">contains</span> <span class="n">number</span>  <span class="n">X</span><span class="o">.</span><span class="n">any</span>
</span></span><span class="line"><span class="cl">    <span class="n">Scalar</span>  <span class="n">Array</span>  <span class="n">array</span> <span class="n">contains</span> <span class="n">object</span>  <span class="n">X</span><span class="o">.</span><span class="n">any</span>
</span></span><span class="line"><span class="cl">    <span class="n">Hash</span>    <span class="n">Array</span>  <span class="n">hash</span> <span class="n">slice</span> <span class="nb">exists</span>      <span class="o">.</span><span class="p">{</span><span class="n">X</span><span class="o">.</span><span class="n">all</span><span class="p">}:</span><span class="nb">exists</span> <span class="o">.</span><span class="p">{</span><span class="n">X</span><span class="o">.</span><span class="n">any</span><span class="p">}:</span><span class="nb">exists</span>
</span></span><span class="line"><span class="cl">    <span class="n">Set</span>     <span class="n">Set</span>    <span class="n">subset</span> <span class="n">relation</span>        <span class="o">.</span><span class="p">{</span><span class="n">X</span><span class="o">.</span><span class="n">all</span><span class="p">}:</span><span class="nb">exists</span>
</span></span><span class="line"><span class="cl">    <span class="n">Set</span>     <span class="n">Hash</span>   <span class="n">subset</span> <span class="n">relation</span>        <span class="o">.</span><span class="p">{</span><span class="n">X</span><span class="o">.</span><span class="n">all</span><span class="p">}:</span><span class="nb">exists</span>
</span></span><span class="line"><span class="cl">    <span class="n">Any</span>     <span class="n">Set</span>    <span class="n">subset</span> <span class="n">relation</span>        <span class="o">.</span><span class="n">Set</span><span class="o">.</span><span class="p">{</span><span class="n">X</span><span class="o">.</span><span class="n">all</span><span class="p">}:</span><span class="nb">exists</span>
</span></span><span class="line"><span class="cl">    <span class="n">Any</span>     <span class="n">Hash</span>   <span class="n">subset</span> <span class="n">relation</span>        <span class="o">.</span><span class="n">Set</span><span class="o">.</span><span class="p">{</span><span class="n">X</span><span class="o">.</span><span class="n">all</span><span class="p">}:</span><span class="nb">exists</span>
</span></span><span class="line"><span class="cl">    <span class="n">Any</span>     <span class="n">Set</span>    <span class="n">superset</span> <span class="n">relation</span>      <span class="n">X</span><span class="o">.</span><span class="p">{</span><span class="o">.</span><span class="n">all</span><span class="p">}:</span><span class="nb">exists</span>
</span></span><span class="line"><span class="cl">    <span class="n">Any</span>     <span class="n">Hash</span>   <span class="n">superset</span> <span class="n">relation</span>      <span class="n">X</span><span class="o">.</span><span class="p">{</span><span class="o">.</span><span class="n">all</span><span class="p">}:</span><span class="nb">exists</span>
</span></span><span class="line"><span class="cl">    <span class="n">Any</span>     <span class="n">Set</span>    <span class="n">sets</span> <span class="n">intersect</span>         <span class="o">.</span><span class="p">{</span><span class="n">X</span><span class="o">.</span><span class="n">any</span><span class="p">}:</span><span class="nb">exists</span>
</span></span><span class="line"><span class="cl">    <span class="n">Set</span>     <span class="n">Array</span>  <span class="n">subset</span> <span class="n">relation</span>        <span class="n">X</span><span class="p">,</span><span class="o">*</span>          <span class="c1"># (conjectured)</span>
</span></span><span class="line"><span class="cl">    <span class="n">Array</span>   <span class="n">Regex</span>  <span class="n">match</span> <span class="n">array</span> <span class="n">as</span> <span class="n">string</span>  <span class="o">.</span><span class="n">Cat</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>  <span class="n">cat</span><span class="p">(</span><span class="nv">@$_</span><span class="p">)</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</span></span></code></pre></div><p>(注意, <code>.cat</code> 方法和 <code>Cat</code> 类型都强制必须接收单个对象, 不像 <code>cat</code> 函数, cat 函数作为一个列表操作符, 接收一个句法的列表(或multilist ) 并展开它. 然而,所有的这些都返回 <code>Cat</code> 对象.)</p>
<p>布尔表达式能返回布尔值, 例如比较操作符或一元 <code>?</code> 操作符.它们可能显式或隐式地引用 <code>$_</code>. 如果它们一点也没有引用 <code>$_</code>, 那也是 okay 的 — 那种情况下你就使用 switch 结构作为比一串  elsifs 可读性更好的备选分支. 然而, 注意,那意味着你不能这样写:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"> <span class="n">given</span> <span class="nv">$boolean</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">when</span> <span class="n">True</span>  <span class="p">{</span><span class="o">...</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">when</span> <span class="n">False</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></div><p>因为它总是会选择 <code>True</code> 这种情况. 相反, 使用某些像条件上下文的东西在内部使用更好:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"> <span class="n">given</span> <span class="nv">$boolean</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">when</span> <span class="o">.</span><span class="n">Bool</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">when</span> <span class="o">.</span><span class="n">Bool</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span></code></pre></div><p>就像使用 <code>if</code> 语句一样. 在任何情况下, 如果你想使用 <code>~~</code> 或 <code>when</code> 进行智能匹配, 它会依照语法识别 True 或 False, 并提醒你那不会按你期望的那样做. 编译器也允许提醒任何其它不测试 <code>$_</code> 的布尔结构, 在他能检测的范围之内.</p>
<p>同样地, 任何接收一个 Matcher的函数(诸如 grep) 不会接收一个 Bool 类型的参数, 因为那总是标示着编程错误.(可以使用 <code>*</code> 来匹配任何东西, 如果那就是你想要的. 或者使用一个闭包来返回一个常量布尔值)</p>
<p>也要注意 regex 匹配不返回 Bool, 而是返回一个能用作布尔值的 Match 对象(或 Nil). 如果想要, 使用显式的 <code>?</code> 或 <code>so</code> 来强制转为 布尔值. Match 对象代表一个成功的匹配, 并被智能匹配当作与 True 的值相同, 类似地, Nil 代表着失败, 并且不能直接用于智能匹配的右侧. 测试 definedness 来代替或使用 <code>* === Nil</code>.</p>
<p>带有诸如 <code>:g</code>那样的修饰符的正则匹配想返回多个匹配, 使用 <code>List</code>来做 <code>so</code>.就像任何列表一样, 如果有一个或多项, 值就是被计算为真. 如果没有匹配, 返回空列表, 它在布尔上下文中计算为 false.</p>
<p>为了智能匹配, 所有的 <code>Set</code>, <code>Bag</code>, 和<code>Mix</code> 值和对应的散了类型 <code>SetHash</code>, <code>BagHash</code>, 和<code>MixHash</code> 是等价的.即, Hash 容器中键代表唯一对象, 键值代表那些唯一键的重复次数.(当然, Set 能有 0 或 1次重复, 因为保证唯一性). 所以,所有这些 Mixy 类型只比较键, 不比较键值. 使用 <code>eqv</code> 代替, 来测试键和键值的相等性.</p>
<p>Despite the need for an implementation to examine the bounds of a range in order to perform smartmatching, the result of smartmatching two Range objects is not actually defined in terms of bounds, but rather as a subset relationship between two (potentially infinite) sets of values encompassed by the intervals involved, for any orderable type such as real numbers, strings, or versions. The result is defined as true if and only if all potential elements that would be matched by the left range are also matched by the right range. Hence it does not matter to what extent the bounds of a empty range are &ldquo;overspecified&rdquo;. If the left range is empty, it always matches, because there exists no value to falsify it. If the right range is empty, it can match only if the left range is also empty.尽管为了执行智能匹配, 需要一个实现来检查范围的边界,  两个 Range 对象的智能匹配结果实际上没有按照边界定义,而是作为子集关系</p>
<p>The Cat type allows you to have an infinitely extensible string. You can match an array or iterator by feeding it to a Cat, which is essentially a Str interface over an iterator of some sort. Then a Regex can be used against it as if it were an ordinary string. The Regex engine can ask the string if it has more characters, and the string will extend itself if possible from its underlying iterator. (Note that such strings have an indefinite number of characters, so if you use .* in your pattern, or if you ask the string how many characters it has in it, or if you even print the whole string, it may feel compelled to slurp in the rest of the string, which may or may not be expeditious.)</p>
<p>cat 操作符接收一个(潜在惰性的)列表并返回一个 Cat 对象.在字符串上下文中, 这惰性地强制列表中的每一个元素为字符串, 字符串的长度不明. 你可以像这样搜索一个 gather:</p>
<pre tabindex="0"><code> my $lazystr := cat gather for @foo { take .bar }
 $lazystr ~~ /pattern/;
</code></pre><p>Cat 接口允许 regex 使用 <code>&lt;,&gt;</code> 断言来匹配元素的边界, Match 对象提供了一种方式, 能获取元素在列表中的索引和位置. 如果底层的数据结构是一个可变数组, 数组的改变由 Cat 追踪, 以至于元素数字仍然正确. 字符串, 数组,列表,序列,捕获还有树节点都可以是正则匹配的模式, 或由签名匹配饿模式</p>
<p><a href="https://github.com/raku/roast/blob/master/S03-smartmatch/any-callable.t#L5-L14">S03/Smart matching/any-callable.t lines 5–14</a></p>
<pre tabindex="0"><code class="language-per" data-lang="per">use v6;
use Test;
plan 4;

#L&lt;S03/&#34;Smart matching&#34;/Any Callable:($) item sub truth&gt;
{
    sub is_even($x) { $x % 2 == 0 }
    sub is_odd ($x) { $x % 2 == 1 }
    ok 4 ~~ &amp;is_even,    &#39;scalar sub truth (unary)&#39;;
    ok 4 !~~ &amp;is_odd,    &#39;scalar sub truth (unary, negated smart-match)&#39;;
    ok !(3 ~~ &amp;is_even), &#39;scalar sub truth (unary)&#39;;
    ok !(3 !~~ &amp;is_odd), &#39;scalar sub truth (unary, negated smart-match)&#39;;
}
</code></pre><p><a href="https://github.com/raku/roast/blob/master/S03-smartmatch/any-callable.t#L15-L24">S03/Smart matching/any-callable.t lines 15–24</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">v6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">Test</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">plan</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#L&lt;S03/&#34;Smart matching&#34;/Any Callable:() simple closure truth&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">sub</span> <span class="nf">uhuh</span> <span class="p">{</span> <span class="mi">1</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">sub</span> <span class="nf">nuhuh</span> <span class="p">{</span> <span class="n">Mu</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">((</span><span class="n">Mu</span> <span class="o">~~</span> <span class="o">&amp;</span><span class="n">uhuh</span><span class="p">),</span> <span class="s">&#34;scalar sub truth&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">Mu</span> <span class="o">~~</span> <span class="o">&amp;</span><span class="n">nuhuh</span><span class="p">),</span> <span class="s">&#34;negated scalar sub false&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><a href="https://github.com/raku/roast/blob/master/S03-smartmatch/any-bool.t#L5-L23">S03/Smart matching/any-bool.t lines 5–23</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">v6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">Test</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">plan</span> <span class="mi">8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#L&lt;S03/Smart matching/Any Bool simple truth&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">sub</span> <span class="nf">is</span><span class="p">-true() {</span> <span class="n">True</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="k">sub</span> <span class="nf">is</span><span class="p">-false() {</span> <span class="n">False</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span>   <span class="mi">0</span>  <span class="o">~~</span> <span class="n">is</span><span class="o">-</span><span class="n">true</span><span class="p">(),</span>      <span class="s">&#39;~~ non-syntactic True&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span>  <span class="s">&#39;a&#39;</span> <span class="o">~~</span> <span class="n">is</span><span class="o">-</span><span class="n">true</span><span class="p">(),</span>      <span class="s">&#39;~~ non-syntactic True&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">nok</span>  <span class="mi">0</span>  <span class="o">~~</span> <span class="n">is</span><span class="o">-</span><span class="n">false</span><span class="p">(),</span>     <span class="s">&#39;~~ non-syntactic True&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">nok</span> <span class="s">&#39;a&#39;</span> <span class="o">~~</span> <span class="n">is</span><span class="o">-</span><span class="n">false</span><span class="p">(),</span>     <span class="s">&#39;~~ non-syntactic True&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">nok</span>  <span class="mi">0</span>   <span class="o">~~</span> <span class="o">.</span><span class="n">so</span><span class="p">,</span>           <span class="s">&#39;boolean truth&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span>   <span class="s">&#39;a&#39;</span> <span class="o">~~</span> <span class="o">.</span><span class="n">so</span><span class="p">,</span>           <span class="s">&#39;boolean truth&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span>   <span class="mi">0</span>   <span class="o">~~</span> <span class="o">.</span><span class="ow">not</span><span class="p">,</span>          <span class="s">&#39;boolean truth&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">nok</span>  <span class="s">&#39;a&#39;</span> <span class="o">~~</span> <span class="o">.</span><span class="ow">not</span><span class="p">,</span>          <span class="s">&#39;boolean truth&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><a href="https://github.com/raku/roast/blob/master/S03-smartmatch/any-pair.t#L5-L35">S03/Smart matching/any-pair.t lines 5–35</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">v6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">Test</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">plan</span> <span class="mi">8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#L&lt;S03/Smart matching/Any Pair test object attribute&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ?.&#34;{X.key}&#34; === ?X.value</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 意思是:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 在对象上调用名为`X.key` 的方法, 用`?`强制为布尔值</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 并检查是否和 `X.value`的布尔值相同</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">class</span> <span class="nn">SmartmatchTest::</span><span class="n">AttrPair</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">has</span> <span class="nv">$</span><span class="err">.</span><span class="nv">a</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">has</span> <span class="nv">$</span><span class="err">.</span><span class="nv">b</span> <span class="o">=</span> <span class="s">&#39;foo&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">has</span> <span class="nv">$</span><span class="err">.</span><span class="nv">c</span> <span class="o">=</span> <span class="n">Mu</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$o</span> <span class="o">=</span> <span class="nn">SmartmatchTest::</span><span class="n">AttrPair</span><span class="o">.</span><span class="k">new</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span>  <span class="p">(</span><span class="nv">$o</span> <span class="o">~~</span> <span class="p">:</span><span class="n">a</span><span class="p">(</span><span class="mi">4</span><span class="p">)),</span>      <span class="s">&#39;$obj ~~ Pair (Int, +)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span>  <span class="p">(</span><span class="nv">$o</span> <span class="o">~~</span> <span class="p">:</span><span class="n">a</span><span class="p">(</span><span class="mi">2</span><span class="p">)),</span>      <span class="s">&#39;$obj ~~ Pair (Int, +)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="o">!</span><span class="p">(</span><span class="nv">$o</span> <span class="o">~~</span> <span class="p">:</span><span class="n">b</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span>      <span class="s">&#39;$obj ~~ Pair (different types)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span>  <span class="p">(</span><span class="nv">$o</span> <span class="o">~~</span> <span class="p">:</span><span class="n">b</span><span class="sr">&lt;foo&gt;</span><span class="p">),</span>    <span class="s">&#39;$obj ~~ Pair (Str, +)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span>  <span class="p">(</span><span class="nv">$o</span> <span class="o">~~</span> <span class="p">:</span><span class="n">b</span><span class="sr">&lt;ugh&gt;</span><span class="p">),</span>    <span class="s">&#39;$obj ~~ Pair (Str, -)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span>  <span class="p">(</span><span class="nv">$o</span> <span class="o">~~</span> <span class="p">:</span><span class="n">c</span><span class="p">(</span><span class="n">Mu</span><span class="p">)),</span>     <span class="s">&#39;$obj ~~ Pair (Mu, +)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span>  <span class="p">(</span><span class="nv">$o</span> <span class="o">~~</span> <span class="p">:</span><span class="n">c</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span>      <span class="s">&#39;$obj ~~ Pair (0, +)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="o">!</span><span class="p">(</span><span class="nv">$o</span> <span class="o">~~</span> <span class="p">:</span><span class="n">b</span><span class="p">(</span><span class="n">Mu</span><span class="p">)),</span>     <span class="s">&#39;$obj ~~ Pair (Mu, -)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># not explicitly specced, but implied by the spec and decreed</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># by TimToady: non-existing method or attribute dies:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># http://irclog.perlgeek.de/raku/2009-07-06#i_1293199</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><a href="https://github.com/raku/roast/blob/master/S03-smartmatch/array-array.t#L5-L70">S03/Smart matching/array-array.t lines 5–70</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">v6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">Test</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">plan</span> <span class="mi">36</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#L&lt;S03/Smart matching/arrays are comparable&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">(((</span><span class="s">&#34;blah&#34;</span><span class="p">,</span> <span class="s">&#34;blah&#34;</span><span class="p">)</span> <span class="o">~~</span> <span class="p">(</span><span class="s">&#34;blah&#34;</span><span class="p">,</span> <span class="s">&#34;blah&#34;</span><span class="p">)),</span> <span class="s">&#34;qw/blah blah/ .eq&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">(</span><span class="o">!</span><span class="p">(</span>      <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">~~</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>    <span class="p">),</span>    <span class="s">&#34;1 2 !~~ 1 1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">(</span><span class="o">!</span><span class="p">(</span>   <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">~~</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>    <span class="p">),</span>    <span class="s">&#34;1 2 3 !~~ 1 2&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">(</span><span class="o">!</span><span class="p">(</span>      <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">~~</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="p">),</span>    <span class="s">&#34;1 2 !~~ 1 2 3&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">(</span><span class="o">!</span><span class="p">(</span>          <span class="o">[]</span> <span class="o">~~</span> <span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="s">&#34;array smartmatch boundary conditions&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">(</span><span class="o">!</span><span class="p">(</span>         <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">~~</span> <span class="o">[]</span><span class="p">),</span>  <span class="s">&#34;array smartmatch boundary conditions&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">((</span>           <span class="o">[]</span> <span class="o">~~</span> <span class="o">[]</span><span class="p">),</span>  <span class="s">&#34;array smartmatch boundary conditions&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">((</span>          <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">~~</span> <span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="s">&#34;array smartmatch boundary conditions&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">~~</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">),</span>   <span class="s">&#39;array smartmatch dwims * at end&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">~~</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">),</span> <span class="s">&#39;array smartmatch dwims * at end (many *s)&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">~~</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="s">&#39;array smartmatch dwims * at start&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">~~</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="s">&#39;array smartmatch dwims * at start (many *s)&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">~~</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="s">&#39;array smartmatch dwims * 1 elem&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">~~</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="s">&#39;array smartmatch dwims * 1 elem (many *s)&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">~~</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="s">&#39;array smartmatch dwims * many elems&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">~~</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="s">&#39;array smartmatch dwims * many elems (many *s)&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">~~</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="o">*</span><span class="p">),</span> <span class="s">&#39;array smartmatch dwims * at start and end&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">~~</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">),</span> <span class="s">&#39;array smartmatch dwims * at start and end (many *s)&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">~~</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="s">&#39;array smartmatch dwims * can match nothing at start&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">~~</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="s">&#39;array smartmatch dwims * can match nothing at start (many *s)&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">~~</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="s">&#39;array smartmatch dwims * can match nothing in middle&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">~~</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="s">&#39;array smartmatch dwims * can match nothing in middle (many *s)&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">~~</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="o">*</span><span class="p">),</span> <span class="s">&#39;array smartmatch dwims * can match nothing at end&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">~~</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">),</span> <span class="s">&#39;array smartmatch dwims * can match nothing at end (many *s)&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">(</span><span class="o">!</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">~~</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span> <span class="s">&#39;* dwimming does not cause craziness&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">(</span><span class="o">!</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">~~</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="mi">5</span><span class="p">)),</span> <span class="s">&#39;* dwimming does not cause craziness&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">(</span><span class="o">!</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> <span class="o">~~</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="o">*</span><span class="p">)),</span> <span class="s">&#39;* dwimming does not cause craziness&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># now try it with arrays as well</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">@a</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">@b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">@m</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">*</span><span class="p">);</span> <span class="c1"># m as &#34;magic&#34; ;-)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="p">(</span><span class="nv">@a</span> <span class="o">~~</span>  <span class="nv">@a</span><span class="p">),</span> <span class="s">&#39;Basic smartmatching on arrays (positive)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="p">(</span><span class="nv">@a</span> <span class="o">!~~</span> <span class="nv">@b</span><span class="p">),</span> <span class="s">&#39;Basic smartmatching on arrays (negative)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="p">(</span><span class="nv">@b</span> <span class="o">!~~</span> <span class="nv">@a</span><span class="p">),</span> <span class="s">&#39;Basic smartmatching on arrays (negative)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="p">(</span><span class="nv">@a</span> <span class="o">~~</span>  <span class="nv">@m</span><span class="p">),</span> <span class="s">&#39;Whatever dwimminess in arrays&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="p">(</span><span class="nv">@a</span> <span class="o">~~</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="s">&#39;smartmatch Array ~~ List&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">~~</span> <span class="nv">@a</span><span class="p">),</span> <span class="s">&#39;smartmatch List ~~ Array&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">~~</span> <span class="nv">@m</span><span class="p">),</span> <span class="s">&#39;smartmatch List ~~ Array with dwim&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="p">(</span><span class="mi">1</span> <span class="o">~~</span> <span class="o">*</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="p">),</span>     <span class="s">&#39;smartmatch with Array RHS co-erces LHS to list&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span> <span class="o">~~</span> <span class="o">*</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="o">*</span><span class="p">),</span> <span class="s">&#39;smartmatch with Array RHS co-erces LHS to list&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><a href="https://github.com/raku/roast/blob/master/S03-smartmatch/range-range.t#L5-L29">S03/Smart matching/range-range.t lines 5–29</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="p">(</span><span class="mi">2</span><span class="o">..</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="nb">bounds</span>
</span></span><span class="line"><span class="cl"><span class="mi">2</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="p">(</span><span class="mi">2</span><span class="o">..</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="nb">bounds</span><span class="o">.</span><span class="nb">all</span>
</span></span><span class="line"><span class="cl"><span class="nb">all</span><span class="p">(</span><span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="k">my</span> <span class="nv">@a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">8</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">8</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="nv">@a</span><span class="o">.</span><span class="nb">bounds</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">Method</span> <span class="p">&#39;</span><span class="s1">bounds</span><span class="p">&#39;</span> <span class="nb">not</span> <span class="n">found</span> <span class="k">for</span> <span class="nb">invocant</span> <span class="k">of</span> <span class="k">class</span> <span class="nc">&#39;Array&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="p">(</span><span class="mi">2</span><span class="o">..</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="nb">bounds</span><span class="o">.</span><span class="nb">all</span> <span class="o">~~</span> <span class="mi">1</span><span class="o">..</span><span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="nb">all</span><span class="p">(</span><span class="kt">True</span><span class="o">,</span> <span class="kt">True</span><span class="p">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">v6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">Test</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">plan</span> <span class="mi">14</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#L&lt;S03/Smart matching/Range Range subset range&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># .bounds.all ~~ X (mod ^&#39;s)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 意思是:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 检查 .min 和 .max 是否都在 Range X 里面.</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># (though this is only true to a first approximation, as</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># those .min and .max values might be excluded)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ok</span>  <span class="p">(</span><span class="mi">2</span><span class="o">..</span><span class="mi">3</span> <span class="o">~~</span> <span class="mi">1</span><span class="o">..</span><span class="mi">4</span><span class="p">),</span>     <span class="s">&#39;proper inclusion +&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="o">!</span><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">4</span> <span class="o">~~</span> <span class="mi">2</span><span class="o">..</span><span class="mi">3</span><span class="p">),</span>     <span class="s">&#39;proper inclusion -&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span>  <span class="p">(</span><span class="mi">2</span><span class="o">..</span><span class="mi">4</span> <span class="o">~~</span> <span class="mi">1</span><span class="o">..</span><span class="mi">4</span><span class="p">),</span>     <span class="s">&#39;inclusive vs inclusive right end&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span>  <span class="p">(</span><span class="mi">2</span><span class="o">..^</span><span class="mi">4</span> <span class="o">~~</span> <span class="mi">1</span><span class="o">..</span><span class="mi">4</span><span class="p">),</span>    <span class="s">&#39;exclusive vs inclusive right end&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="o">!</span><span class="p">(</span><span class="mi">2</span><span class="o">..</span><span class="mi">4</span> <span class="o">~~</span> <span class="mi">1</span><span class="o">..^</span><span class="mi">4</span><span class="p">),</span>    <span class="s">&#39;inclusive vs exclusive right end&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span>  <span class="p">(</span><span class="mi">2</span><span class="o">..^</span><span class="mi">4</span> <span class="o">~~</span> <span class="mi">1</span><span class="o">..^</span><span class="mi">4</span><span class="p">),</span>   <span class="s">&#39;exclusive vs exclusive right end&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span>  <span class="p">(</span><span class="mi">2</span><span class="o">..</span><span class="mi">3</span> <span class="o">~~</span> <span class="mi">2</span><span class="o">..</span><span class="mi">4</span><span class="p">),</span>     <span class="s">&#39;inclusive vs inclusive left end&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span>  <span class="p">(</span><span class="mi">2</span><span class="o">^..</span><span class="mi">3</span> <span class="o">~~</span> <span class="mi">2</span><span class="o">..</span><span class="mi">4</span><span class="p">),</span>    <span class="s">&#39;exclusive vs inclusive left end&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="o">!</span><span class="p">(</span><span class="mi">2</span><span class="o">..</span><span class="mi">3</span> <span class="o">~~</span> <span class="mi">2</span><span class="o">^..</span><span class="mi">4</span><span class="p">),</span>    <span class="s">&#39;inclusive vs exclusive left end&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span>  <span class="p">(</span><span class="mi">2</span><span class="o">^..</span><span class="mi">3</span> <span class="o">~~</span> <span class="mi">2</span><span class="o">^..</span><span class="mi">4</span><span class="p">),</span>   <span class="s">&#39;exclusive vs exclusive left end&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span>  <span class="p">(</span><span class="mi">2</span><span class="o">..</span><span class="mi">3</span> <span class="o">~~</span> <span class="mi">2</span><span class="o">..</span><span class="mi">3</span><span class="p">),</span>     <span class="s">&#39;inclusive vs inclusive both ends&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span>  <span class="p">(</span><span class="mi">2</span><span class="o">^..^</span><span class="mi">3</span> <span class="o">~~</span> <span class="mi">2</span><span class="o">..</span><span class="mi">3</span><span class="p">),</span>   <span class="s">&#39;exclusive vs inclusive both ends&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="o">!</span><span class="p">(</span><span class="mi">2</span><span class="o">..</span><span class="mi">3</span> <span class="o">~~</span> <span class="mi">2</span><span class="o">^..^</span><span class="mi">3</span><span class="p">),</span>   <span class="s">&#39;inclusive vs exclusive both ends&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span>  <span class="p">(</span><span class="mi">2</span><span class="o">^..^</span><span class="mi">3</span> <span class="o">~~</span> <span class="mi">2</span><span class="o">^..^</span><span class="mi">3</span><span class="p">),</span> <span class="s">&#39;exclusive vs exclusive both ends&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><a href="https://github.com/raku/roast/blob/master/S03-smartmatch/disorganized.t#L30-L145">S03-smartmatch/disorganized.t lines 30–145</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">v6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">Test</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">plan</span> <span class="mi">42</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">=</span><span class="n">begin</span> <span class="n">pod</span>
</span></span><span class="line"><span class="cl"><span class="n">This</span> <span class="n">tests</span> <span class="n">the</span> <span class="n">smartmatch</span> <span class="n">operator</span><span class="p">,</span> <span class="nb">defined</span> <span class="n">in</span> <span class="n">L</span><span class="o">&lt;</span><span class="n">S03</span><span class="o">/</span><span class="s">&#34;Smart matching&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span><span class="n">end</span> <span class="n">pod</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">eval_elsewhere</span><span class="p">($code){</span> <span class="n">EVAL</span><span class="p">(</span><span class="nv">$code</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#L&lt;S03/Smart matching/Any undef undefined not .defined&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">(</span><span class="s">&#34;foo&#34;</span> <span class="o">~~</span> <span class="o">.</span><span class="nb">defined</span><span class="p">,</span> <span class="s">&#34;foo is ~~ .defined&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">nok</span> <span class="s">&#34;foo&#34;</span> <span class="o">!~~</span> <span class="o">.</span><span class="nb">defined</span><span class="p">,</span>   <span class="s">&#39;not foo !~~ .defined&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">nok</span><span class="p">((</span><span class="n">Mu</span> <span class="o">~~</span> <span class="o">.</span><span class="nb">defined</span><span class="p">),</span> <span class="s">&#34;Mu is not .defined&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># TODO:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Set   Set</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Hash  Set</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Any   Set</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Set   Array</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Set   Hash</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Any   Hash</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Regex tests are in spec/S05-*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#L&lt;S03/&#34;Smart matching&#34;/in range&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># more range tests in t/spec/S03-operators/range.t</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">((</span><span class="mi">5</span> <span class="o">~~</span> <span class="mi">1</span> <span class="o">..</span> <span class="mi">10</span><span class="p">),</span> <span class="s">&#34;5 is in 1 .. 10&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="mi">10</span> <span class="o">~~</span> <span class="mi">1</span> <span class="o">..</span> <span class="mi">5</span><span class="p">),</span> <span class="s">&#34;10 is not in 1 .. 5&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="mi">1</span> <span class="o">~~</span> <span class="mi">5</span> <span class="o">..</span> <span class="mi">10</span><span class="p">),</span> <span class="s">&#34;1 is not i n 5 .. 10&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="mi">5</span> <span class="o">~~</span> <span class="mi">5</span> <span class="o">^..^</span> <span class="mi">10</span><span class="p">),</span> <span class="s">&#34;5 is not in 5 .. 10, exclusive&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># TODO:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Signature Signature</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Callable  Signature</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Capture   Signature</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Any       Signature</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Signature Capture  </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># reviewed by moritz on 2009-07-07 up to here.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">=</span><span class="n">begin</span> <span class="n">Explanation</span>
</span></span><span class="line"><span class="cl"><span class="n">You</span> <span class="n">may</span> <span class="n">be</span> <span class="n">wondering</span> <span class="n">what</span> <span class="n">the</span> <span class="n">heck</span> <span class="n">is</span> <span class="n">with</span> <span class="n">all</span> <span class="n">these</span> <span class="n">try</span> <span class="n">blocks</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="n">Prior</span> <span class="n">to</span> <span class="n">r12503</span><span class="p">,</span> <span class="n">this</span> <span class="n">test</span> <span class="n">caused</span> <span class="n">a</span> <span class="n">horrible</span> <span class="n">death</span> <span class="n">of</span> <span class="n">Pugs</span> <span class="n">which</span>
</span></span><span class="line"><span class="cl"><span class="n">magically</span> <span class="n">went</span> <span class="n">away</span> <span class="n">when</span> <span class="n">used</span> <span class="n">inside</span> <span class="n">an</span> <span class="n">EVAL</span><span class="o">.</span>  <span class="n">So</span> <span class="n">the</span> <span class="n">try</span> <span class="n">blocks</span>
</span></span><span class="line"><span class="cl"><span class="n">caught</span> <span class="n">that</span> <span class="k">case</span><span class="o">.</span>
</span></span><span class="line"><span class="cl"><span class="o">=</span><span class="n">end</span> <span class="n">Explanation</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$parsed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">@x</span> <span class="o">=</span> <span class="mi">1</span><span class="o">..</span><span class="mi">20</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$result</span> <span class="o">=</span> <span class="n">all</span><span class="p">(</span><span class="nv">@x</span><span class="p">)</span> <span class="o">~~</span> <span class="p">{</span> <span class="nv">$_</span> <span class="o">&lt;</span> <span class="mi">21</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$parsed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="nv">$parsed</span><span class="p">,</span> <span class="s">&#39;C&lt;all(@x) ~~ { ... }&gt; parses&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="p">?</span><span class="nv">$result</span><span class="p">,</span> <span class="s">&#39;C&lt;all(@x) ~~ { ... } when true for all&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$result</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="n">all</span><span class="p">(</span><span class="nv">@x</span><span class="p">)</span> <span class="o">~~</span> <span class="p">{</span> <span class="nv">$_</span> <span class="o">&lt;</span> <span class="mi">20</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="nv">$result</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s">&#39;C&lt;all(@x) ~~ {...} when true for one&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$result</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="n">all</span><span class="p">(</span><span class="nv">@x</span><span class="p">)</span> <span class="o">~~</span> <span class="p">{</span> <span class="nv">$_</span> <span class="o">&lt;</span> <span class="mi">12</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="nv">$result</span><span class="p">,</span> <span class="s">&#39;C&lt;all(@x) ~~ {...} when true for most&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$result</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="n">all</span><span class="p">(</span><span class="nv">@x</span><span class="p">)</span> <span class="o">~~</span> <span class="p">{</span> <span class="nv">$_</span> <span class="o">&lt;</span> <span class="mi">1</span>  <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="nv">$result</span><span class="p">,</span> <span class="s">&#39;C&lt;all(@x) ~~ {...} when true for one&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># need to test in EVAL() since class definitions happen at compile time,</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ie before the plan is set up.</span>
</span></span><span class="line"><span class="cl"><span class="nb">eval</span><span class="o">-</span><span class="n">lives</span><span class="o">-</span><span class="n">ok</span> <span class="s">&#39;class A { method foo { return &#34;&#34; ~~ * } }; A.new.foo&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="s">&#39;smartmatch in a class lives (RT 62196)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># RT #69762</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="k">sub</span> <span class="p">{}</span> <span class="o">~~</span> <span class="n">Callable</span><span class="p">,</span> <span class="s">&#39;~~ Callable (true)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">nok</span> <span class="mi">68762</span> <span class="o">~~</span> <span class="n">Callable</span><span class="p">,</span> <span class="s">&#39;~~ Callable (false)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="mi">69762</span> <span class="o">!~~</span> <span class="n">Callable</span><span class="p">,</span> <span class="s">&#39;!~~ Callable (true)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">nok</span> <span class="k">sub</span> <span class="p">{}</span> <span class="o">!~~</span> <span class="n">Callable</span><span class="p">,</span> <span class="s">&#39;!~~ Callable (false)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="k">sub</span> <span class="p">{}</span> <span class="o">~~</span> <span class="n">Routine</span><span class="p">,</span> <span class="s">&#39;~~ Routine (true)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">nok</span> <span class="mi">68762</span> <span class="o">~~</span> <span class="n">Routine</span><span class="p">,</span> <span class="s">&#39;~~ Routine (false)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="mi">69762</span> <span class="o">!~~</span> <span class="n">Routine</span><span class="p">,</span> <span class="s">&#39;!~~ Routine (true)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">nok</span> <span class="k">sub</span> <span class="p">{}</span> <span class="o">!~~</span> <span class="n">Routine</span><span class="p">,</span> <span class="s">&#39;!~~ Routine (false)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="k">sub</span> <span class="p">{}</span> <span class="o">~~</span> <span class="n">Sub</span><span class="p">,</span> <span class="s">&#39;~~ Sub (true)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">nok</span> <span class="mi">68762</span> <span class="o">~~</span> <span class="n">Sub</span><span class="p">,</span> <span class="s">&#39;~~ Sub (false)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="mi">69762</span> <span class="o">!~~</span> <span class="n">Sub</span><span class="p">,</span> <span class="s">&#39;!~~ Sub (true)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">nok</span> <span class="k">sub</span> <span class="p">{}</span> <span class="o">!~~</span> <span class="n">Sub</span><span class="p">,</span> <span class="s">&#39;!~~ Sub (false)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="k">sub</span> <span class="p">{}</span> <span class="o">~~</span> <span class="n">Block</span><span class="p">,</span> <span class="s">&#39;~~ Block (true)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">nok</span> <span class="mi">68762</span> <span class="o">~~</span> <span class="n">Block</span><span class="p">,</span> <span class="s">&#39;~~ Block (false)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="mi">69762</span> <span class="o">!~~</span> <span class="n">Block</span><span class="p">,</span> <span class="s">&#39;!~~ Block (true)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">nok</span> <span class="k">sub</span> <span class="p">{}</span> <span class="o">!~~</span> <span class="n">Block</span><span class="p">,</span> <span class="s">&#39;!~~ Block (false)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="k">sub</span> <span class="p">{}</span> <span class="o">~~</span> <span class="n">Code</span><span class="p">,</span> <span class="s">&#39;~~ Code (true)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">nok</span> <span class="mi">68762</span> <span class="o">~~</span> <span class="n">Code</span><span class="p">,</span> <span class="s">&#39;~~ Code (false)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="mi">69762</span> <span class="o">!~~</span> <span class="n">Code</span><span class="p">,</span> <span class="s">&#39;!~~ Code (true)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">nok</span> <span class="k">sub</span> <span class="p">{}</span> <span class="o">!~~</span> <span class="n">Code</span><span class="p">,</span> <span class="s">&#39;!~~ Code (false)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">class</span> <span class="n">RT68762</span> <span class="p">{</span> <span class="k">our</span> <span class="n">method</span> <span class="n">rt68762</span> <span class="p">{}</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="o">&amp;</span><span class="nn">RT68762::</span><span class="n">rt68762</span> <span class="o">~~</span> <span class="n">Method</span><span class="p">,</span> <span class="s">&#39;~~ Method (true)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">nok</span> <span class="mi">68762</span>            <span class="o">~~</span> <span class="n">Method</span><span class="p">,</span> <span class="s">&#39;~~ Method (false)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="mi">69762</span>              <span class="o">!~~</span> <span class="n">Method</span><span class="p">,</span> <span class="s">&#39;!~~ Method (true)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">nok</span> <span class="o">&amp;</span><span class="nn">RT68762::</span><span class="n">rt68762</span> <span class="o">!~~</span> <span class="n">Method</span><span class="p">,</span> <span class="s">&#39;!~~ Method (false)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># RT 72048</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">role</span> <span class="n">RT72048_role</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="n">class</span> <span class="n">RT72048_class</span> <span class="n">does</span> <span class="n">RT72048_role</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="n">RT72048_class</span><span class="o">.</span><span class="k">new</span> <span class="o">~~</span> <span class="n">RT72048_role</span><span class="p">,</span> <span class="s">&#39;class instance matches role&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">nok</span> <span class="n">RT72048_class</span><span class="o">.</span><span class="k">new</span> <span class="o">!~~</span> <span class="n">RT72048_role</span><span class="p">,</span> <span class="s">&#39;class instance !!matches role&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ok</span> <span class="p">(</span><span class="s">&#34;foo&#34;</span> <span class="o">~~</span> <span class="o">*</span><span class="p">)</span> <span class="o">~~</span> <span class="n">WhateverCode</span><span class="p">,</span> <span class="s">&#39;thing ~~ * autoprimes&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">ok</span> <span class="p">(</span><span class="s">&#34;foo&#34;</span> <span class="o">~~</span> <span class="o">*.</span><span class="n">chars</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="o">~~</span> <span class="n">Bool</span><span class="p">,</span> <span class="s">&#39;thing ~~ WhateverCode is a boolean&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">ok</span> <span class="p">?(</span><span class="o">*</span> <span class="o">~~</span> <span class="s">&#34;foo&#34;</span><span class="p">)(</span><span class="s">&#39;foo&#39;</span><span class="p">),</span> <span class="s">&#39;* ~~ &#34;foo&#34; is WhateverCode&#39;</span><span class="p">;</span>
</span></span></code></pre></div><p><a href="https://github.com/raku/roast/blob/master/S03-smartmatch/any-type.t#L5-L40">S03-smartmatch/any-type.t lines 5–40</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="c1">#L&lt;S03/Smart matching/type membership&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">class</span> <span class="n">Dog</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="n">class</span> <span class="n">Cat</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="n">class</span> <span class="n">Chihuahua</span> <span class="n">is</span> <span class="n">Dog</span> <span class="p">{}</span> <span class="c1"># i&#39;m afraid class Pugs will get in the way ;-)</span>
</span></span><span class="line"><span class="cl">    <span class="n">role</span> <span class="n">SomeRole</span> <span class="p">{</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="n">class</span> <span class="n">Something</span> <span class="n">does</span> <span class="n">SomeRole</span> <span class="p">{</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="p">(</span><span class="n">Chihuahua</span> <span class="o">~~</span> <span class="n">Dog</span><span class="p">),</span>      <span class="s">&#34;chihuahua isa dog&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="p">(</span><span class="n">Something</span> <span class="o">~~</span> <span class="n">SomeRole</span><span class="p">),</span> <span class="s">&#39;something does dog&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="o">!</span><span class="p">(</span><span class="n">Chihuahua</span> <span class="o">~~</span> <span class="n">Cat</span><span class="p">),</span>     <span class="s">&#34;chihuahua is not a cat&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># RT #71462</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">is</span> <span class="s">&#39;RT71462&#39;</span> <span class="o">~~</span> <span class="n">Str</span><span class="p">,</span>      <span class="n">True</span><span class="p">,</span>  <span class="s">&#39;~~ Str returns a Bool (1)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">is</span> <span class="mi">5</span>         <span class="o">~~</span> <span class="n">Str</span><span class="p">,</span>      <span class="n">False</span><span class="p">,</span> <span class="s">&#39;~~ Str returns a Bool (2)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">is</span> <span class="s">&#39;RT71462&#39;</span> <span class="o">~~</span> <span class="n">Int</span><span class="p">,</span>      <span class="n">False</span><span class="p">,</span> <span class="s">&#39;~~ Int returns a Bool (1)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">is</span> <span class="mi">5</span>         <span class="o">~~</span> <span class="n">Int</span><span class="p">,</span>      <span class="n">True</span><span class="p">,</span>  <span class="s">&#39;~~ Int returns a Bool (2)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">is</span> <span class="s">&#39;RT71462&#39;</span> <span class="o">~~</span> <span class="n">Set</span><span class="p">,</span>      <span class="n">False</span><span class="p">,</span> <span class="s">&#39;~~ Set returns a Bool (1)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">is</span> <span class="n">set</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">~~</span> <span class="n">Set</span><span class="p">,</span>      <span class="n">True</span><span class="p">,</span>  <span class="s">&#39;~~ Set returns a Bool (2)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">is</span> <span class="s">&#39;RT71462&#39;</span> <span class="o">~~</span> <span class="n">Numeric</span><span class="p">,</span>  <span class="n">False</span><span class="p">,</span> <span class="s">&#39;~~ Numeric returns a Bool (1)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">is</span> <span class="mi">5</span>         <span class="o">~~</span> <span class="n">Numeric</span><span class="p">,</span>  <span class="n">True</span><span class="p">,</span>  <span class="s">&#39;~~ Numeric returns a Bool (2)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">is</span> <span class="o">&amp;</span><span class="n">say</span>      <span class="o">~~</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">True</span><span class="p">,</span>  <span class="s">&#39;~~ Callable returns a Bool (1)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">is</span> <span class="mi">5</span>         <span class="o">~~</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">False</span><span class="p">,</span> <span class="s">&#39;~~ Callable returns a Bool (2)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># RT 76610</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">module</span> <span class="n">M</span> <span class="p">{</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">lives</span><span class="o">-</span><span class="n">ok</span> <span class="p">{</span> <span class="mi">42</span> <span class="o">~~</span> <span class="n">M</span> <span class="p">},</span> <span class="s">&#39;~~ module lives&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="ow">not</span> <span class="vg">$/</span><span class="p">,</span> <span class="s">&#39;42 is not a module&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><a href="https://github.com/raku/roast/blob/master/S03-smartmatch/any-any.t#L5-L29">S03-smartmatch/any-any.t#L5-L29</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl" data-lang="perl"><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">v6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">Test</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">plan</span> <span class="mi">8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#L&lt;S03/Smart matching/Any Any scalars are identical&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">class</span> <span class="nn">Smartmatch::</span><span class="n">ObjTest</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="nn">Smartmatch::</span><span class="n">ObjTest</span><span class="o">.</span><span class="k">new</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$b</span> <span class="o">=</span> <span class="nn">Smartmatch::</span><span class="n">ObjTest</span><span class="o">.</span><span class="k">new</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span>  <span class="p">(</span><span class="nv">$a</span> <span class="o">~~</span>  <span class="nv">$a</span><span class="p">),</span>    <span class="s">&#39;Any ~~  Any (+)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="o">!</span><span class="p">(</span><span class="nv">$a</span> <span class="o">!~~</span> <span class="nv">$a</span><span class="p">),</span>    <span class="s">&#39;Any !~~ Any (-)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span> <span class="o">!</span><span class="p">(</span><span class="nv">$a</span> <span class="o">~~</span>  <span class="nv">$b</span><span class="p">),</span>    <span class="s">&#39;Any ~~  Any (-)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ok</span>  <span class="p">(</span><span class="nv">$a</span> <span class="o">!~~</span> <span class="nv">$b</span><span class="p">),</span>    <span class="s">&#39;Any !~~ Any (+)&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$_</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#39;abc&#39;</span> <span class="o">~~</span> <span class="p">(</span><span class="nv">$x</span> <span class="o">=</span> <span class="nv">$_</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">is</span> <span class="nv">$x</span><span class="p">,</span> <span class="s">&#39;abc&#39;</span><span class="p">,</span> <span class="s">&#39;~~ sets $_ to the LHS&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">is</span> <span class="nv">$_</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="s">&#39;original $_ restored&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#39;defg&#39;</span> <span class="o">!~~</span> <span class="p">(</span><span class="nv">$x</span> <span class="o">=</span> <span class="nv">$_</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">is</span> <span class="nv">$x</span><span class="p">,</span> <span class="s">&#39;defg&#39;</span><span class="p">,</span> <span class="s">&#39;!~~ sets $_ to the LHS&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">is</span> <span class="nv">$_</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="s">&#39;original $_ restored&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#39;defg&#39;</span> <span class="o">!~~</span> <span class="p">(</span><span class="nv">$x</span> <span class="o">=</span> <span class="nv">$_</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div>

        </div>
    </div>
</article>



                <footer>
                    




<div class="no-text-decoration">
    <div class="jump top"><a href="#" title="Top of this page">⮉</a></div>
    <div class="jump bottom"><a href="#bottom" title="Bottom of this page">⮋</a></div>
</div>


 
    
        <div class="hugotoc no-text-decoration">
            <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#智能匹配">智能匹配</a></li>
      </ul>
    </li>
  </ul>
</nav>
            <a href="#" class="back-to-top">Back to top</a>
        </div>
    
    
<script src="/js/libs/jquery/3.3.1/jquery.slim.min.min.22ee3db0c0e99fd0fbce3aee19672bd53d25469daf734bd4c165649f6eaf7d7f.js"></script>

<link rel="preload" href="/js/libs/jquery/3.3.1/jquery.slim.min.min.22ee3db0c0e99fd0fbce3aee19672bd53d25469daf734bd4c165649f6eaf7d7f.js" as="script">

<script type="application/javascript">(function() {
     var $window = $(window);
     if ($window.width() >= 1400) { 
         var $toc = $('#TableOfContents');
         if ($toc.length > 0) {
             function onScroll(){
                 var currentScroll = $window.scrollTop();
                 var h = $('.content h1, .content h2, .content h3, .content h4, .content h5, .content h6, .h-feed h2');
                 var id = "";
                 h.each(function (i, e) {
                     e = $(e);
                     if (e.offset().top - 10 <= currentScroll) {
                         id = e.attr('id');
                     }
                 });
                 var current = $toc.find('a.current');
                 if (current.length == 1 && current.eq(0).attr('href') == '#' + id) return true;

                 current.each(function (i, e) {
                     $(e).removeClass('current').siblings('ul').hide();
                 });
                 $toc.find('a[href="#' + id + '"]').parentsUntil('#TableOfContents').each(function (i, e) {
                     $(e).children('a').addClass('current').siblings('ul').show();
                 });
             }
             $window.on('scroll', onScroll);
             $(document).ready(function() {
                 $toc.find('a').parent('li').find('ul').hide();
                 onScroll();
                 document.getElementsByClassName('hugotoc')[0].style.display = '';
             });}}})();</script>








<div class="backtotop center no-text-decoration">
    <a href="#">back to <span class="top">top</span></a>
</div>


<div class="right">
    <div class="taxo no-text-decoration">
         
            
                <ul class="no-bullets inline categories">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts categorized in ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmycloud.github.io/categories/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
         
            
                <ul class="no-bullets inline tags">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts tagged with ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmycloud.github.io/tags/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
        
    </div>

</div>
<div class="clear-float"></div>



<div class="prev-next-navigator clear-float">
    
        <span class="prev-post left no-text-decoration">
            <a href="https://ohmycloud.github.io/posts/2016-09-25-whatever-star/" class="nobr">« Whatever Star</a>
        </span>
    
    
        <span class="next-post right no-text-decoration">
            <a href="https://ohmycloud.github.io/posts/2016-08-02-raku-types--%E6%88%90%E4%BA%BA%E4%B9%8B%E7%BE%8E/" class="nobr">Raku Types--成人之美 »</a>
        </span>
    
</div>


<a id="bottom"></a>









                       







                    <ul class="no-bullets feed right inline">
    
        
        
    
</ul>
<div class="clear-float"></div>

                </footer>
                <hr />
            </div>               

            <footer> 
                

<ul class="social no-text-decoration">
    
</ul>










 
    
    



<p class="generated no-text-decoration">
    Generated using  <a href="https://gitlab.com/kaushalmodi/hugo-theme-refined"><code class="nobr">hugo-theme-refined</code></a> + <span class="nobr">Hugo <a href="https://github.com/gohugoio/hugo/commit/312735366b20d64bd61bff8627f593749f86c964">0.123.7</a></span>
</p>

<p>
    
</p>




<div class="badges no-text-decoration">
    
    

    
</div>




<script type="application/javascript">var nav=responsiveNav("#nav");</script>




<script defer src="/js/libs/fragmentions/wrapper.min.e8c468c89edc4f5dccaa8c720c6b220b3088a16cd7b1e4a1e3345985788260c9.js"></script>









            </footer>
        </div> 
    </body>
</html>
