<?xml version="1.0" encoding="utf-8"?> 
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en-us">
    <generator uri="https://gohugo.io/" version="0.123.7">Hugo</generator><title type="html"><![CDATA[Posts on 焉知非鱼]]></title>
    
        <subtitle type="html"><![CDATA[Wait the light to fall]]></subtitle>
    
    
    
            <link href="https://ohmycloud.github.io/posts/" rel="alternate" type="text/html" title="html" />
            <link href="https://ohmycloud.github.io/posts/index.xml" rel="alternate" type="application/rss+xml" title="rss" />
            <link href="https://ohmycloud.github.io/posts/atom.xml" rel="self" type="application/atom+xml" title="atom" />
            <link href="https://ohmycloud.github.io/posts/jf2feed.json" rel="alternate" type="application/jf2feed+json" title="jf2feed" />
    <updated>2024-03-02T15:22:47+08:00</updated>
    
    
    
    
        <id>https://ohmycloud.github.io/posts/</id>
    
        
        <entry>
            <title type="html"><![CDATA[提取 ipconfig 命令的部分输出]]></title>
            <link href="https://ohmycloud.github.io/posts/extract-ipconfig/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmycloud.github.io/posts/extract-sections-with-double-percent/?utm_source=atom_feed" rel="related" type="text/html" title="使用 %% 提取文本块儿" />
                <link href="https://ohmycloud.github.io/posts/extract-sections-again/?utm_source=atom_feed" rel="related" type="text/html" title="再用 %% 提取文本块儿" />
                <link href="https://ohmycloud.github.io/posts/extract-sections/?utm_source=atom_feed" rel="related" type="text/html" title="提取文本块儿" />
                <link href="https://ohmycloud.github.io/posts/subparse/?utm_source=atom_feed" rel="related" type="text/html" title="子解析" />
                <link href="https://ohmycloud.github.io/posts/parse-structured-text/?utm_source=atom_feed" rel="related" type="text/html" title="解析结构化文本" />
            
                <id>https://ohmycloud.github.io/posts/extract-ipconfig/</id>
            
            
                    <author>
                        <name>焉知非鱼</name>
                    </author>
            <published>2020-05-19T23:41:33+08:00</published>
            <updated>2020-05-19T23:41:33+08:00</updated>
            
            
            <content type="html"><![CDATA[<h3 id="数据样例">数据样例</h3>
<p>下面这段文本是 <code>IPCONFIG /ALL</code> 命令的输出结果:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">Windows IP 配置
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   主机名  . . . . . . . . . . . . . : Win10-2020QJFDK
</span></span><span class="line"><span class="cl">   主 DNS 后缀 . . . . . . . . . . . : 
</span></span><span class="line"><span class="cl">   节点类型  . . . . . . . . . . . . : 混合
</span></span><span class="line"><span class="cl">   IP 路由已启用 . . . . . . . . . . : 否
</span></span><span class="line"><span class="cl">   WINS 代理已启用 . . . . . . . . . : 否
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">以太网适配器 本地连接* 9:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   媒体状态  . . . . . . . . . . . . : 媒体已断开连接
</span></span><span class="line"><span class="cl">   连接特定的 DNS 后缀 . . . . . . . : 
</span></span><span class="line"><span class="cl">   描述. . . . . . . . . . . . . . . : Sangfor SSL VPN CS Support System VNIC
</span></span><span class="line"><span class="cl">   物理地址. . . . . . . . . . . . . : 00-FF-05-0D-13-A2
</span></span><span class="line"><span class="cl">   DHCP 已启用 . . . . . . . . . . . : 否
</span></span><span class="line"><span class="cl">   自动配置已启用. . . . . . . . . . : 是
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">无线局域网适配器 WLAN:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   媒体状态  . . . . . . . . . . . . : 媒体已断开连接
</span></span><span class="line"><span class="cl">   连接特定的 DNS 后缀 . . . . . . . : 
</span></span><span class="line"><span class="cl">   描述. . . . . . . . . . . . . . . : Realtek RTL8192EU Wireless LAN 802.11n USB 2.0 Network Adapter
</span></span><span class="line"><span class="cl">   物理地址. . . . . . . . . . . . . : 30-B4-9E-40-FF-0C
</span></span><span class="line"><span class="cl">   DHCP 已启用 . . . . . . . . . . . : 是
</span></span><span class="line"><span class="cl">   自动配置已启用. . . . . . . . . . : 是
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">无线局域网适配器 本地连接* 10:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   媒体状态  . . . . . . . . . . . . : 媒体已断开连接
</span></span><span class="line"><span class="cl">   连接特定的 DNS 后缀 . . . . . . . : 
</span></span><span class="line"><span class="cl">   描述. . . . . . . . . . . . . . . : Microsoft Wi-Fi Direct Virtual Adapter
</span></span><span class="line"><span class="cl">   物理地址. . . . . . . . . . . . . : 32-B4-9E-40-FF-0C
</span></span><span class="line"><span class="cl">   DHCP 已启用 . . . . . . . . . . . : 是
</span></span><span class="line"><span class="cl">   自动配置已启用. . . . . . . . . . : 是
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">以太网适配器 以太网:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   连接特定的 DNS 后缀 . . . . . . . : 
</span></span><span class="line"><span class="cl">   描述. . . . . . . . . . . . . . . : Realtek PCIe GBE Family Controller
</span></span><span class="line"><span class="cl">   物理地址. . . . . . . . . . . . . : 54-E1-AD-48-66-22
</span></span><span class="line"><span class="cl">   DHCP 已启用 . . . . . . . . . . . : 否
</span></span><span class="line"><span class="cl">   自动配置已启用. . . . . . . . . . : 是
</span></span><span class="line"><span class="cl">   本地链接 IPv6 地址. . . . . . . . : fe80::4195:49da:a7ec:9e68%6(首选) 
</span></span><span class="line"><span class="cl">   IPv4 地址 . . . . . . . . . . . . : 192.168.0.68(首选) 
</span></span><span class="line"><span class="cl">   子网掩码  . . . . . . . . . . . . : 255.255.255.0
</span></span><span class="line"><span class="cl">   默认网关. . . . . . . . . . . . . : 192.168.0.1
</span></span><span class="line"><span class="cl">   DHCPv6 IAID . . . . . . . . . . . : 324329901
</span></span><span class="line"><span class="cl">   DHCPv6 客户端 DUID  . . . . . . . : 00-01-00-01-26-4E-B2-11-54-E1-AD-48-66-22
</span></span><span class="line"><span class="cl">   DNS 服务器  . . . . . . . . . . . : 61.128.128.68
</span></span><span class="line"><span class="cl">   TCPIP 上的 NetBIOS  . . . . . . . : 已启用
</span></span></code></pre></div><p>分别提取含有&quot;适配器&quot;文字下面的「描述」、「物理地址」、「IP地址」、「子网掩码」、「默认网关」、「DNS 服务器」等信息。某些适配器下面可能实际没有「IP地址」、「子网掩码」、「默认网关」、「DNS 服务器」等，有就提取，没有就略过。</p>
<h3 id="grammar">Grammar</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">unit</span> <span class="k">grammar</span> <span class="nc">IPConfig::Grammar</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">token</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">section</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="nv">%%</span><span class="sr"> </span><span class="se">\n</span><span class="o">*</span><span class="sr"> </span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">token</span> <span class="nf">section</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">&lt;</span><span class="nf">header</span><span class="p">&gt;</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="se">\n</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">&lt;</span><span class="nf">config</span><span class="p">&gt;</span><span class="o">+</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">token</span> <span class="nf">header</span> <span class="p">{</span><span class="sr"> </span><span class="ni">^^</span><span class="sr"> </span><span class="se">\N</span><span class="o">+</span><span class="sr">  </span><span class="se">\n</span><span class="sr">         </span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">token</span> <span class="nf">config</span> <span class="p">{</span><span class="sr"> </span><span class="ni">^^</span><span class="sr"> </span><span class="se">\s</span><span class="o">+</span><span class="sr"> </span><span class="se">\N</span><span class="o">+</span><span class="sr"> </span><span class="ni">$$</span><span class="sr"> </span><span class="se">\n</span><span class="o">*</span><span class="sr">  </span><span class="p">}</span>
</span></span></code></pre></div><h3 id="action">Action</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">unit</span> <span class="k">class</span> <span class="nc">IPConfig::Action</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">method</span> <span class="nf">TOP</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">make</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">section</span><span class="p">&gt;</span><span class="o">».</span><span class="k">made</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">method</span> <span class="nf">section</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$configs</span> <span class="o">=</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">config</span><span class="p">&gt;</span><span class="o">».</span><span class="k">made</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nv">$configs</span><span class="o">.</span><span class="nb">elems</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">make</span> <span class="o">~</span><span class="nv">$/</span><span class="p">&lt;</span><span class="s">header</span><span class="p">&gt;</span>  <span class="o">~</span> <span class="nv">$configs</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;&#39;);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">make</span> <span class="kt">Empty</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">method</span> <span class="nf">header</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">make</span> <span class="o">~</span><span class="nv">$/</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">method</span> <span class="nb">config</span><span class="p">(</span><span class="nv">$/</span> <span class="k">is</span> <span class="nb">copy</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$text</span> <span class="o">=</span> <span class="o">~</span><span class="nv">$/</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nv">$text</span><span class="o">.</span><span class="nb">contains</span><span class="p">(/&#39;</span><span class="s1">描述</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">物理地址</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> IPv</span><span class="p">[</span><span class="mi">4</span><span class="o">|</span><span class="mi">6</span><span class="p">]</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1"> </span><span class="p">&#39;</span><span class="sr"> 地址 </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">子网掩码</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> DNS </span><span class="p">&#39;</span><span class="s1"> </span><span class="p">&#39;</span><span class="sr"> 服务器</span><span class="p">/)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nv">$/</span><span class="o">.</span><span class="k">make</span><span class="p">(</span><span class="o">~</span><span class="nv">$/</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">make</span> <span class="kt">Empty</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="提取脚本">提取脚本</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">use</span> <span class="kt">lib</span> <span class="p">&#39;</span><span class="s1">.</span><span class="p">&#39;;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">IPConfig::Grammar</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">IPConfig::Action</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$ipconfig</span> <span class="o">=</span> <span class="n">IPConfig::Grammar</span><span class="o">.</span><span class="nb">parsefile</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&#34;</span><span class="s2">data/ifconfig.txt</span><span class="p">&#34;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">:</span><span class="s">actions</span><span class="p">(</span><span class="n">IPConfig::Action</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span><span class="o">.</span><span class="k">made</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="kt">Str</span><span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="nv">@$ipconfig</span><span class="p">;</span>
</span></span></code></pre></div><h3 id="输出">输出</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">以太网适配器 本地连接* 9:
</span></span><span class="line"><span class="cl">   描述. . . . . . . . . . . . . . . : Sangfor SSL VPN CS Support System VNIC
</span></span><span class="line"><span class="cl">   物理地址. . . . . . . . . . . . . : 00-FF-05-0D-13-A2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">无线局域网适配器 WLAN:
</span></span><span class="line"><span class="cl">   描述. . . . . . . . . . . . . . . : Realtek RTL8192EU Wireless LAN 802.11n USB 2.0 Network Adapter
</span></span><span class="line"><span class="cl">   物理地址. . . . . . . . . . . . . : 30-B4-9E-40-FF-0C
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">无线局域网适配器 本地连接* 10:
</span></span><span class="line"><span class="cl">   描述. . . . . . . . . . . . . . . : Microsoft Wi-Fi Direct Virtual Adapter
</span></span><span class="line"><span class="cl">   物理地址. . . . . . . . . . . . . : 32-B4-9E-40-FF-0C
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">以太网适配器 以太网:
</span></span><span class="line"><span class="cl">   描述. . . . . . . . . . . . . . . : Realtek PCIe GBE Family Controller
</span></span><span class="line"><span class="cl">   物理地址. . . . . . . . . . . . . : 54-E1-AD-48-66-22
</span></span><span class="line"><span class="cl">   本地链接 IPv6 地址. . . . . . . . : fe80::4195:49da:a7ec:9e68%6(首选) 
</span></span><span class="line"><span class="cl">   IPv4 地址 . . . . . . . . . . . . : 192.168.0.68(首选) 
</span></span><span class="line"><span class="cl">   子网掩码  . . . . . . . . . . . . : 255.255.255.0
</span></span><span class="line"><span class="cl">   默认网关. . . . . . . . . . . . . : 192.168.0.1
</span></span><span class="line"><span class="cl">   DNS 服务器  . . . . . . . . . . . : 61.128.128.68
</span></span></code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[使用 %% 提取文本块儿]]></title>
            <link href="https://ohmycloud.github.io/posts/extract-sections-with-double-percent/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmycloud.github.io/posts/extract-sections-again/?utm_source=atom_feed" rel="related" type="text/html" title="再用 %% 提取文本块儿" />
                <link href="https://ohmycloud.github.io/posts/extract-sections/?utm_source=atom_feed" rel="related" type="text/html" title="提取文本块儿" />
                <link href="https://ohmycloud.github.io/posts/subparse/?utm_source=atom_feed" rel="related" type="text/html" title="子解析" />
                <link href="https://ohmycloud.github.io/posts/parse-structured-text/?utm_source=atom_feed" rel="related" type="text/html" title="解析结构化文本" />
                <link href="https://ohmycloud.github.io/posts/calc-lang/?utm_source=atom_feed" rel="related" type="text/html" title="计算器" />
            
                <id>https://ohmycloud.github.io/posts/extract-sections-with-double-percent/</id>
            
            
                    <author>
                        <name>焉知非鱼</name>
                    </author>
            <published>2020-05-06T14:14:08+08:00</published>
            <updated>2020-05-06T14:14:08+08:00</updated>
            
            
            <content type="html"><![CDATA[<h3 id="数据样例">数据样例</h3>
<p>section.txt 中的本文为样例数据:</p>
<pre tabindex="0"><code>123,456,789
=begin code
999,333,666
145,123,120
=end code
10,20,30
10,10,10
=begin code
567,555,578
678,679,665
710,720,715
=end code
321,654,987
=begin code
312,555
=end code
</code></pre><p>要求把 <code>=begin code</code> 和 <code>=end code</code> 之间的所有数字分别提取出来。</p>
<h3 id="grammar">Grammar</h3>
<p>Grammar 的结构如下, 其中 Section 目录下分别是 Grammar 和 Action 模块, data 目录下是样例数据 section.txt:</p>
<pre tabindex="0"><code>├── Section
│   ├── Actions.pm6
│   └── Grammar.pm6
├── data
│   ├── section.txt
├── extract-section.p6
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">Grammar::Debugger</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">Grammar::Tracer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">unit</span> <span class="k">grammar</span> <span class="nc">Section::Grammar</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">token</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">   </span><span class="ni">^</span><span class="sr">  </span><span class="p">&lt;</span><span class="nf">section</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="nv">%%</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">separator</span><span class="p">&gt;</span><span class="sr"> </span><span class="ni">$</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">token</span> <span class="nf">section</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">&lt;</span><span class="nf">line</span><span class="p">&gt;</span><span class="o">+</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">token</span> <span class="nf">line</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">   </span><span class="ni">^^</span><span class="sr"> </span><span class="p">[</span><span class="se">\d</span><span class="o">+</span><span class="p">]</span><span class="o">+</span><span class="sr"> </span><span class="nv">%%</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">,</span><span class="p">&#39;</span><span class="sr"> </span><span class="ni">$$</span><span class="sr"> </span><span class="se">\n</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">token</span> <span class="nf">separator</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="o">|</span><span class="sr">  </span><span class="ni">^^</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=begin code</span><span class="p">&#39;</span><span class="sr"> </span><span class="ni">$$</span><span class="sr"> </span><span class="se">\n</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="o">|</span><span class="sr">  </span><span class="ni">^^</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=end code</span><span class="p">&#39;</span><span class="sr"> </span><span class="ni">$$</span><span class="sr"> </span><span class="se">\n</span><span class="o">*</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr"></span><span class="p">}</span>
</span></span></code></pre></div><p>其中 <code>Grammar::Debugger</code> 和 <code>Grammar::Tracer</code> 模块用于调试 grammar, 需要放在 grammar 模块的行首:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">Grammar::Debugger</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">Grammar::Tracer</span><span class="p">;</span>
</span></span></code></pre></div><h3 id="action">Action</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">unit</span> <span class="k">class</span> <span class="nc">Section::Actions</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">method</span> <span class="nf">TOP</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="k">make</span> <span class="nv">$/</span><span class="o">.</span><span class="nb">values</span><span class="o">».</span><span class="k">made</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">method</span> <span class="nf">section</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">make</span> <span class="o">~</span><span class="nv">$/</span><span class="o">.</span><span class="nb">trim</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">method</span> <span class="nb">line</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">make</span> <span class="o">~</span><span class="nv">$/</span><span class="o">.</span><span class="nb">trim</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">method</span> <span class="nf">separator</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">make</span> <span class="kt">Empty</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="解析">解析</h3>
<h4 id="不使用-action">不使用 Action</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">use</span> <span class="kt">lib</span> <span class="p">&#39;</span><span class="s1">.</span><span class="p">&#39;;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">Section::Grammar</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$parsed</span> <span class="o">=</span> <span class="n">Section::Grammar</span><span class="o">.</span><span class="nb">parsefile</span><span class="p">(</span><span class="vg">@*ARGS</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">//</span> <span class="p">&#39;</span><span class="s1">data/section.txt</span><span class="p">&#39;);</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="kt">Str</span><span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="nv">$parsed</span><span class="p">&lt;</span><span class="s">section</span><span class="p">&gt;;</span>
</span></span></code></pre></div><h4 id="输出">输出</h4>
<pre tabindex="0"><code>123,456,789

999,333,666
145,123,120

10,20,30
10,10,10

567,555,578
678,679,665
710,720,715

321,654,987

312,555
</code></pre><h4 id="使用-action">使用 Action</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">use</span> <span class="kt">lib</span> <span class="p">&#39;</span><span class="s1">.</span><span class="p">&#39;;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">Section::Grammar</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">Section::Actions</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$parsed</span> <span class="o">=</span> <span class="n">Section::Grammar</span><span class="o">.</span><span class="nb">parsefile</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="vg">@*ARGS</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">//</span> <span class="p">&#39;</span><span class="s1">data/section.txt</span><span class="p">&#39;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">:</span><span class="s">actions</span><span class="p">(</span><span class="n">Section::Actions</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span><span class="o">.</span><span class="k">made</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="kt">Str</span><span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="nv">@$parsed</span><span class="p">;</span>
</span></span></code></pre></div><h4 id="输出-1">输出</h4>
<pre tabindex="0"><code>123,456,789
999,333,666
145,123,120
10,20,30
10,10,10
567,555,578
678,679,665
710,720,715
321,654,987
312,555
</code></pre>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[再用 %% 提取文本块儿]]></title>
            <link href="https://ohmycloud.github.io/posts/extract-sections-again/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmycloud.github.io/posts/extract-sections-with-double-percent/?utm_source=atom_feed" rel="related" type="text/html" title="使用 %% 提取文本块儿" />
                <link href="https://ohmycloud.github.io/posts/extract-sections/?utm_source=atom_feed" rel="related" type="text/html" title="提取文本块儿" />
                <link href="https://ohmycloud.github.io/posts/subparse/?utm_source=atom_feed" rel="related" type="text/html" title="子解析" />
                <link href="https://ohmycloud.github.io/posts/parse-structured-text/?utm_source=atom_feed" rel="related" type="text/html" title="解析结构化文本" />
                <link href="https://ohmycloud.github.io/posts/calc-lang/?utm_source=atom_feed" rel="related" type="text/html" title="计算器" />
            
                <id>https://ohmycloud.github.io/posts/extract-sections-again/</id>
            
            
                    <author>
                        <name>焉知非鱼</name>
                    </author>
            <published>2020-05-06T14:14:08+08:00</published>
            <updated>2020-05-06T14:14:08+08:00</updated>
            
            
            <content type="html"><![CDATA[<h3 id="数据样例">数据样例</h3>
<pre tabindex="0"><code>Here&#39;s some unimportant text.
=begin code
This code block is what we&#39;re after.
We&#39;ll use &#39;ff&#39; to get it.
=end code
More unimportant text.
=begin code
I want this line.
and this line as well.
HaHa.
=end code
More unimport text.
=begin code
Let&#39;s to go home.
=end code
</code></pre><h3 id="grammar">Grammar</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">Grammar::Debugger</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">Grammar::Tracer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">unit</span> <span class="k">grammar</span> <span class="nb">Range</span><span class="o">:</span><span class="p">:</span><span class="s">Grammar</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">token</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">   </span><span class="ni">^</span><span class="sr">  </span><span class="p">&lt;</span><span class="nf">un-important-line</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="nv">%%</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">section</span><span class="p">&gt;</span><span class="sr"> </span><span class="ni">$</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">token</span> <span class="nf">section</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">   </span><span class="p">&lt;</span><span class="nf">begin</span><span class="p">&gt;</span><span class="sr"> </span><span class="o">~</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">end</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">line</span><span class="p">&gt;</span><span class="o">+?</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">token</span> <span class="nf">un-important-line</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="ni">^^</span><span class="sr"> </span><span class="se">\N</span><span class="o">+</span><span class="sr"> </span><span class="o">)&gt;</span><span class="sr"> </span><span class="se">\n</span><span class="o">*</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">token</span> <span class="nf">line</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="ni">^^</span><span class="sr"> </span><span class="se">\N</span><span class="o">+</span><span class="sr"> </span><span class="o">)&gt;</span><span class="sr"> </span><span class="se">\n</span><span class="o">*</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">token</span> <span class="nf">begin</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="ni">^^</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=begin code</span><span class="p">&#39;</span><span class="sr"> </span><span class="ni">$$</span><span class="sr"> </span><span class="se">\n</span><span class="o">*</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">token</span> <span class="nf">end</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="ni">^^</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=end code</span><span class="p">&#39;</span><span class="sr"> </span><span class="ni">$$</span><span class="sr"> </span><span class="se">\n</span><span class="o">*</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr"></span><span class="p">}</span>
</span></span></code></pre></div><h3 id="action">Action</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">unit</span> <span class="k">class</span> <span class="nb">Range</span><span class="o">:</span><span class="p">:</span><span class="s">Actions</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">method</span> <span class="nf">TOP</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="k">make</span> <span class="nv">$/</span><span class="o">.</span><span class="nb">values</span><span class="o">».</span><span class="k">made</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">method</span> <span class="nf">section</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">make</span> <span class="nv">$/</span><span class="p">&lt;</span><span class="s">line</span><span class="p">&gt;</span><span class="o">».</span><span class="k">made</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">method</span> <span class="nb">line</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">make</span> <span class="o">~</span><span class="nv">$/</span><span class="o">.</span><span class="nb">trim</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">method</span> <span class="nf">un-important-line</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">make</span> <span class="kt">Empty</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">method</span> <span class="nf">begin</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">make</span> <span class="kt">Empty</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">method</span> <span class="nb">end</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">make</span> <span class="kt">Empty</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="提取">提取</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env perl6</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="kt">lib</span> <span class="p">&#39;</span><span class="s1">.</span><span class="p">&#39;;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nb">Range</span><span class="o">:</span><span class="p">:</span><span class="s">Grammar</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nb">Range</span><span class="o">:</span><span class="p">:</span><span class="s">Actions</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$parsed</span> <span class="o">=</span> <span class="nb">Range</span><span class="o">:</span><span class="p">:</span><span class="s">Grammar</span><span class="o">.</span><span class="nb">parsefile</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="vg">@*ARGS</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">//</span> <span class="p">&#39;</span><span class="s1">data/flip-flop.txt</span><span class="p">&#39;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">:</span><span class="s">actions</span><span class="p">(</span><span class="nb">Range</span><span class="o">:</span><span class="p">:</span><span class="s">Actions</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span><span class="o">.</span><span class="k">made</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="nv">@$parsed</span> <span class="k">-&gt;</span> <span class="nv">$line</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">say</span> <span class="nv">$line</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span> <span class="nb">x</span> <span class="mi">35</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="输出">输出</h3>
<pre tabindex="0"><code>$[&#34;This code block is what we&#39;re after.&#34;, &#34;We&#39;ll use &#39;ff&#39; to get it.&#34;]
-----------------------------------
$[&#34;I want this line.&#34;, &#34;and this line as well.&#34;, &#34;HaHa.&#34;]
-----------------------------------
$[&#34;Let&#39;s to go home.&#34;]
-----------------------------------
</code></pre>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[提取文本块儿]]></title>
            <link href="https://ohmycloud.github.io/posts/extract-sections/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmycloud.github.io/posts/subparse/?utm_source=atom_feed" rel="related" type="text/html" title="子解析" />
                <link href="https://ohmycloud.github.io/posts/parse-structured-text/?utm_source=atom_feed" rel="related" type="text/html" title="解析结构化文本" />
                <link href="https://ohmycloud.github.io/posts/calc-lang/?utm_source=atom_feed" rel="related" type="text/html" title="计算器" />
                <link href="https://ohmycloud.github.io/posts/parse-json/?utm_source=atom_feed" rel="related" type="text/html" title="解析 JSON" />
                <link href="https://ohmycloud.github.io/posts/parse-csv/?utm_source=atom_feed" rel="related" type="text/html" title="检测 CSV 是否有效" />
            
                <id>https://ohmycloud.github.io/posts/extract-sections/</id>
            
            
                    <author>
                        <name>焉知非鱼</name>
                    </author>
            <published>2020-05-05T22:11:48+08:00</published>
            <updated>2020-05-05T22:11:48+08:00</updated>
            
            
            <content type="html"><![CDATA[<h3 id="数据样例">数据样例</h3>
<pre tabindex="0"><code>Here&#39;s some unimportant text.
=begin code
This code block is what we&#39;re after.
We&#39;ll use &#39;ff&#39; to get it.
=end code
More unimportant text.
=begin code
I want this line.
and this line as well.
HaHa
=end code
More unimport text.
=begin code
Let&#39;s to go home.
=end code
</code></pre><p>要求提取 <code>=begin code</code> 和 <code>=end code</code> 之间的文本块儿。</p>
<h3 id="grammar">Grammar</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">grammar</span> <span class="nc">ExtractSection</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">token</span> <span class="nf">start</span>   <span class="p">{</span><span class="sr"> </span><span class="ni">^^</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=begin code</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\n</span><span class="sr">          </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">token</span> <span class="nf">finish</span>  <span class="p">{</span><span class="sr"> </span><span class="ni">^^</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=end code</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\n</span><span class="sr">            </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">token</span> <span class="nf">line</span>    <span class="p">{</span><span class="sr"> </span><span class="ni">^^</span><span class="sr"> </span><span class="se">\N</span><span class="o">+)&gt;</span><span class="sr"> </span><span class="se">\n</span><span class="sr">                  </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">token</span> <span class="nf">section</span> <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">start</span><span class="p">&gt;</span><span class="sr"> </span><span class="o">~</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">finish</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">line</span><span class="p">&gt;</span><span class="o">+?</span><span class="sr">  </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">token</span> <span class="nf">comment</span> <span class="p">{</span><span class="sr"> </span><span class="ni">^^</span><span class="se">\N</span><span class="o">+</span><span class="sr"> </span><span class="se">\n</span><span class="sr">                     </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">token</span> <span class="nf">TOP</span>     <span class="p">{</span><span class="sr"> </span><span class="p">[&lt;</span><span class="nf">section</span><span class="p">&gt;</span><span class="sr"> </span><span class="o">||</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">comment</span><span class="p">&gt;]</span><span class="o">+</span><span class="sr">    </span><span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="action">Action</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ExtractSectionAction</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">TOP</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span>     <span class="p">{</span> <span class="k">make</span> <span class="nv">@&lt;section&gt;</span><span class="o">».</span><span class="nb">ast</span><span class="o">.</span><span class="kt">List</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">section</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> <span class="k">make</span> <span class="o">~«</span><span class="nv">@&lt;line&gt;</span><span class="o">.</span><span class="kt">List</span>       <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nb">line</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span>    <span class="p">{</span> <span class="k">make</span> <span class="o">~</span><span class="nv">$/</span><span class="o">.</span><span class="nb">trim</span>             <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nb">comment</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> <span class="k">make</span> <span class="kt">Empty</span>                <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="提取">提取</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$em</span> <span class="o">=</span> <span class="n">ExtractSection</span><span class="o">.</span><span class="nb">parse</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$excerpt</span><span class="o">,</span> 
</span></span><span class="line"><span class="cl">    <span class="p">:</span><span class="s">actions</span><span class="p">(</span><span class="n">ExtractSectionAction</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span><span class="o">.</span><span class="nb">ast</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="nv">@$em</span> <span class="k">-&gt;</span> <span class="nv">$line</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">say</span> <span class="nv">$line</span><span class="o">.</span><span class="nb">perl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span> <span class="nb">x</span> <span class="mi">35</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="输出">输出</h3>
<pre tabindex="0"><code>$(&#34;This code block is what we&#39;re after.&#34;, &#34;We&#39;ll use &#39;ff&#39; to get it.&#34;)
-----------------------------------
$(&#34;I want this line.&#34;, &#34;and this line as well.&#34;, &#34;HaHa&#34;)
-----------------------------------
$(&#34;Let&#39;s to go home.&#34;,)
-----------------------------------
</code></pre>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[子解析]]></title>
            <link href="https://ohmycloud.github.io/posts/subparse/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmycloud.github.io/posts/parse-structured-text/?utm_source=atom_feed" rel="related" type="text/html" title="解析结构化文本" />
                <link href="https://ohmycloud.github.io/posts/calc-lang/?utm_source=atom_feed" rel="related" type="text/html" title="计算器" />
                <link href="https://ohmycloud.github.io/posts/parse-json/?utm_source=atom_feed" rel="related" type="text/html" title="解析 JSON" />
                <link href="https://ohmycloud.github.io/posts/parse-csv/?utm_source=atom_feed" rel="related" type="text/html" title="检测 CSV 是否有效" />
                <link href="https://ohmycloud.github.io/posts/card-game-with-action/?utm_source=atom_feed" rel="related" type="text/html" title="解析带 Action 的纸牌游戏" />
            
                <id>https://ohmycloud.github.io/posts/subparse/</id>
            
            
                    <author>
                        <name>焉知非鱼</name>
                    </author>
            <published>2020-05-05T21:51:42+08:00</published>
            <updated>2020-05-05T21:51:42+08:00</updated>
            
            
            <content type="html"><![CDATA[<h3 id="子解析">子解析</h3>
<p>游标不一定要到达字符串的末尾才算成功。也就是说，它不一定要匹配整个字符串。</p>
<p><code>subparse</code> 总是返回一个 <strong>Match</strong> 对象</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">method</span> <span class="nb">subparse</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$target</span><span class="o">,</span> 
</span></span><span class="line"><span class="cl">    <span class="o">:</span><span class="nv">$rule</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">TOP</span><span class="p">&#39;</span><span class="o">,</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">Capture</span><span class="p">()</span> <span class="o">:</span><span class="nv">$args</span> <span class="o">=</span> \<span class="p">()</span><span class="o">,</span>  
</span></span><span class="line"><span class="cl">    <span class="kt">Mu</span> <span class="o">:</span><span class="nv">$actions</span> <span class="o">=</span> <span class="kt">Mu</span><span class="o">,</span> 
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="nv">%opt</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><h3 id="grammar">Grammar</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">grammar</span> <span class="nc">RepeatChar</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">start</span><span class="p">(</span><span class="nv">$character</span><span class="p">)</span> <span class="p">{</span><span class="sr"> </span><span class="nv">$character</span><span class="o">+</span><span class="sr"> </span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="解析">解析</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="nb">say</span> <span class="n">RepeatChar</span><span class="o">.</span><span class="nb">subparse</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&#39;</span><span class="s1">bbbabb</span><span class="p">&#39;</span><span class="o">,</span> 
</span></span><span class="line"><span class="cl">    <span class="p">:</span><span class="s">rule</span><span class="p">(&#39;</span><span class="s1">start</span><span class="p">&#39;)</span><span class="o">,</span> 
</span></span><span class="line"><span class="cl">    <span class="p">:</span><span class="s">args</span><span class="p">(</span>\<span class="p">(&#39;</span><span class="s1">b</span><span class="p">&#39;))</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span><span class="err">;          # ｢bbb｣
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">say RepeatChar.parse(
</span></span></span><span class="line"><span class="cl"><span class="err">    &#39;bbbabb&#39;, 
</span></span></span><span class="line"><span class="cl"><span class="err">    :rule(&#39;start&#39;), 
</span></span></span><span class="line"><span class="cl"><span class="err">    :args(\(&#39;b&#39;))
</span></span></span><span class="line"><span class="cl"><span class="err">);          # Nil
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">say RepeatChar.subparse(
</span></span></span><span class="line"><span class="cl"><span class="err">    &#39;bbbabb&#39;, 
</span></span></span><span class="line"><span class="cl"><span class="err">    :rule(&#39;start&#39;), 
</span></span></span><span class="line"><span class="cl"><span class="err">    :args(\(&#39;a&#39;))
</span></span></span><span class="line"><span class="cl"><span class="err">);          # &lt;failed match&gt;
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">say RepeatChar.subparse(
</span></span></span><span class="line"><span class="cl"><span class="err">    &#39;bbbabb&#39;, 
</span></span></span><span class="line"><span class="cl"><span class="err">    :rule(&#39;start&#39;), 
</span></span></span><span class="line"><span class="cl"><span class="err">    :args(\(&#39;a&#39;)), 
</span></span></span><span class="line"><span class="cl"><span class="err">    :pos(3)
</span></span></span><span class="line"><span class="cl"><span class="err">);          # ｢a｣
</span></span></span></code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[解析结构化文本]]></title>
            <link href="https://ohmycloud.github.io/posts/parse-structured-text/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmycloud.github.io/posts/calc-lang/?utm_source=atom_feed" rel="related" type="text/html" title="计算器" />
                <link href="https://ohmycloud.github.io/posts/parse-json/?utm_source=atom_feed" rel="related" type="text/html" title="解析 JSON" />
                <link href="https://ohmycloud.github.io/posts/parse-csv/?utm_source=atom_feed" rel="related" type="text/html" title="检测 CSV 是否有效" />
                <link href="https://ohmycloud.github.io/posts/card-game-with-action/?utm_source=atom_feed" rel="related" type="text/html" title="解析带 Action 的纸牌游戏" />
                <link href="https://ohmycloud.github.io/posts/card-game/?utm_source=atom_feed" rel="related" type="text/html" title="解析纸牌游戏" />
            
                <id>https://ohmycloud.github.io/posts/parse-structured-text/</id>
            
            
                    <author>
                        <name>焉知非鱼</name>
                    </author>
            <published>2020-05-05T21:46:27+08:00</published>
            <updated>2020-05-05T21:46:27+08:00</updated>
            
            
            <content type="html"><![CDATA[<h3 id="数据样例">数据样例</h3>
<pre tabindex="0"><code>[28/04/2015 12:32] Title1

content line 1
content line 2
content line 3
content line 4
content line 5

[28/04/2015 12:16] Title2

content line 6
content line 7

[27/04/2015 17:30] ​Title3

content line 8
content line 9
content line 10
</code></pre><h3 id="grammar">Grammar</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">grammar</span> <span class="nc">StructedText</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr"> </span><span class="ni">^</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">entry</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="ni">$</span><span class="sr"> </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">entry</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">&lt;</span><span class="nf">head</span><span class="p">&gt;</span><span class="sr"> </span><span class="se">\s</span><span class="o">*</span><span class="sr">   </span><span class="c1"># 每一项有一个标题
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">        </span><span class="p">&lt;</span><span class="nf">line</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="se">\s</span><span class="o">*</span><span class="sr">  </span><span class="c1"># 每个标题下面有很多行
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">head</span>     <span class="p">{</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">[</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">datetime</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">]</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\s</span><span class="o">+</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">title</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">datetime</span> <span class="p">{</span><span class="sr">  </span><span class="p">&lt;</span><span class="nf">filedate</span><span class="p">&gt;</span><span class="sr"> </span><span class="se">\s</span><span class="o">+</span><span class="sr">  </span><span class="p">&lt;</span><span class="nf">filetime</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">filedate</span> <span class="p">{</span><span class="sr"> </span><span class="p">[</span><span class="se">\d</span><span class="o">+</span><span class="p">]</span><span class="o">+</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">/</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">filetime</span> <span class="p">{</span><span class="sr"> </span><span class="p">[</span><span class="se">\d</span><span class="o">+</span><span class="p">]</span><span class="o">+</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">:</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">title</span>    <span class="p">{</span><span class="sr"> </span><span class="se">\N</span><span class="o">+</span><span class="sr">          </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">line</span>  <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">[</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">		    </span><span class="p">&lt;</span><span class="o">!</span><span class="nf">head</span><span class="p">&gt;</span><span class="sr">       </span><span class="c1"># 前面不是 head 标题
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">            </span><span class="ni">.</span><span class="sr">             </span><span class="c1"># 点号匹配换行符
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">        </span><span class="p">]</span><span class="o">+</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="action">Action</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">StructedText::Actions</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nb">line</span>    <span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$/</span><span class="o">.</span><span class="nb">make</span><span class="o">:</span> <span class="o">~</span><span class="nv">$/</span>                            <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">filedate</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$/</span><span class="o">.</span><span class="nb">make</span><span class="o">:</span> <span class="o">~</span><span class="nv">$/</span><span class="o">.</span><span class="nb">subst</span><span class="p">(</span><span class="k">rx</span><span class="p">/&lt;[</span><span class="sr">:/</span><span class="p">]&gt;/</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">:</span><span class="s">g</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nb">head</span>    <span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$/</span><span class="o">.</span><span class="nb">make</span><span class="o">:</span> <span class="o">~</span><span class="nv">$/</span><span class="o">.</span><span class="nb">subst</span><span class="p">(</span><span class="k">rx</span><span class="p">/&lt;[</span><span class="sr">:/</span><span class="p">]&gt;/</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">:</span><span class="s">g</span><span class="p">)</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">entry</span>   <span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> <span class="k">make</span> <span class="nv">$&lt;head&gt;</span><span class="o">.</span><span class="s">ast</span> <span class="o">=&gt;</span> <span class="nv">$&lt;line&gt;</span><span class="o">».</span><span class="k">made</span><span class="p">;</span>      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">TOP</span>     <span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$/</span><span class="o">.</span><span class="nb">make</span><span class="o">:</span> <span class="nv">$&lt;entry&gt;</span><span class="o">».</span><span class="nb">ast</span><span class="p">;</span>                 <span class="p">}</span>    
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="解析">解析</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$actions</span> <span class="o">=</span> <span class="n">StructedText::Actions</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$parsed</span> <span class="o">=</span> <span class="n">StructedText</span><span class="o">.</span><span class="nb">parsefile</span><span class="p">(&#39;</span><span class="s1">sample.txt</span><span class="p">&#39;</span><span class="o">,</span> <span class="o">:</span><span class="nv">$actions</span><span class="p">)</span><span class="o">.</span><span class="k">made</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="nv">$parsed</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nv">@$parsed</span> <span class="k">-&gt;</span> <span class="nv">$e</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">my</span> <span class="nv">$filename</span> <span class="o">=</span> <span class="o">~</span><span class="nv">$e</span><span class="o">.</span><span class="nb">key</span><span class="o">.</span><span class="nb">match</span><span class="p">(/&#39;</span><span class="s1">[</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">&lt;(</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">-</span><span class="p">[</span><span class="se">\</span><span class="sr">[</span><span class="se">\</span><span class="sr">]</span><span class="p">]&gt;</span><span class="o">+</span><span class="sr"> </span><span class="o">)&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">]</span><span class="p">&#39;/)</span>  <span class="o">~</span> <span class="p">&#34;</span><span class="s2">.txt</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">        <span class="k">my</span> <span class="nv">$fh</span> <span class="o">=</span> <span class="nb">open</span> <span class="nv">$filename</span><span class="o">,</span> <span class="p">:</span><span class="s">w</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">        <span class="nv">$fh</span><span class="o">.</span><span class="nb">say</span><span class="o">:</span> <span class="o">~</span><span class="nv">$e</span><span class="o">.</span><span class="nb">key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="nv">$e</span><span class="o">.</span><span class="nb">value</span> <span class="k">-&gt;</span> <span class="nv">$v</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$fh</span><span class="o">.</span><span class="nb">say</span><span class="o">:</span> <span class="nv">$v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$fh</span><span class="o">.</span><span class="nb">close</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">生成文件 </span><span class="nv">$filename</span><span class="s2"> </span><span class="p">&#34;;</span>       
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[计算器]]></title>
            <link href="https://ohmycloud.github.io/posts/calc-lang/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmycloud.github.io/posts/parse-json/?utm_source=atom_feed" rel="related" type="text/html" title="解析 JSON" />
                <link href="https://ohmycloud.github.io/posts/parse-csv/?utm_source=atom_feed" rel="related" type="text/html" title="检测 CSV 是否有效" />
                <link href="https://ohmycloud.github.io/posts/card-game-with-action/?utm_source=atom_feed" rel="related" type="text/html" title="解析带 Action 的纸牌游戏" />
                <link href="https://ohmycloud.github.io/posts/card-game/?utm_source=atom_feed" rel="related" type="text/html" title="解析纸牌游戏" />
                <link href="https://ohmycloud.github.io/posts/alaways-succeed-assertion/?utm_source=atom_feed" rel="related" type="text/html" title="Alaways Succeed Assertion" />
            
                <id>https://ohmycloud.github.io/posts/calc-lang/</id>
            
            
                    <author>
                        <name>焉知非鱼</name>
                    </author>
            <published>2020-05-05T21:27:02+08:00</published>
            <updated>2020-05-05T21:27:02+08:00</updated>
            
            
            <content type="html"><![CDATA[<h3 id="数据样例">数据样例</h3>
<pre tabindex="0"><code>x = 40 + 2;
print x;

y = x - (5/2);
print y;

z = 1 + y * x;
print z;

print 14 - 16/3 + x;
</code></pre><p>目录结构如下:</p>
<pre tabindex="0"><code>.
├── Lang
│   ├── Actions.pm6
│   └── Grammar.pm6
├── data
│   ├── calc.lang
</code></pre><h3 id="grammar">Grammar</h3>
<p><strong>Grammar.pm6</strong> 的内容如下:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">unit</span> <span class="k">grammar</span> <span class="nc">Lang::Grammar</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">rule</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="ni">^</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">statements</span><span class="p">&gt;</span><span class="sr"> </span><span class="ni">$</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">rule</span> <span class="nf">statements</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">&lt;</span><span class="nf">statement</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="nv">%%</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">rule</span> <span class="nf">statement</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">assignment</span><span class="p">&gt;</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">printout</span><span class="p">&gt;</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">rule</span> <span class="nf">assignment</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">&lt;</span><span class="nf">identifier</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">expression</span><span class="p">&gt;</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">rule</span> <span class="nf">printout</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">&#39;</span><span class="s1">print</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">expression</span><span class="p">&gt;</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">rule</span> <span class="nf">expression</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">term</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="nv">%%</span><span class="sr"> </span><span class="nv">$&lt;op&gt;</span><span class="o">=</span><span class="p">([&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="o">|</span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;])</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">group</span><span class="p">&gt;</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">rule</span> <span class="nf">term</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">&lt;</span><span class="nf">factor</span><span class="p">&gt;</span><span class="o">+</span><span class="sr">  </span><span class="nv">%%</span><span class="sr"> </span><span class="nv">$&lt;op&gt;</span><span class="o">=</span><span class="p">([&#39;</span><span class="s1">*</span><span class="p">&#39;</span><span class="o">|</span><span class="p">&#39;</span><span class="s1">/</span><span class="p">&#39;])</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">rule</span> <span class="nf">factor</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">identifier</span><span class="p">&gt;</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">value</span><span class="p">&gt;</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">group</span><span class="p">&gt;</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">rule</span> <span class="nf">group</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">&#39;</span><span class="s1">(</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">expression</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">)</span><span class="p">&#39;</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">token</span> <span class="nf">identifier</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">(&lt;:</span><span class="na">alpha</span><span class="p">&gt;</span><span class="o">+</span><span class="p">)</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">token</span> <span class="nf">value</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">(</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="o">|</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="p">[&#39;</span><span class="s1">.</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="p">]</span><span class="o">?</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">.</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">)</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr"></span><span class="p">}</span>
</span></span></code></pre></div><h3 id="action">Action</h3>
<p><strong>Actions.pm6</strong> 的内容如下:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">unit</span> <span class="k">class</span> <span class="nc">Lang::Actions</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">has</span> <span class="nv">%.var</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">method</span> <span class="nf">assignment</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">%!var</span><span class="p">{</span><span class="nv">$&lt;identifier&gt;</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$&lt;expression&gt;</span><span class="o">.</span><span class="nb">ast</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">method</span> <span class="nf">printout</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">say</span> <span class="nv">$&lt;expression&gt;</span><span class="o">.</span><span class="nb">ast</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">method</span> <span class="nf">expression</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nv">$&lt;group&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$/</span><span class="o">.</span><span class="nb">make</span><span class="o">:</span> <span class="nv">$&lt;group&gt;</span><span class="o">.</span><span class="nb">ast</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">my</span> <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$&lt;term&gt;</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="nb">ast</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nv">$&lt;op&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">my</span> <span class="nv">@ops</span> <span class="o">=</span> <span class="nv">$&lt;op&gt;</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="o">~*</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="k">my</span> <span class="nv">@vals</span> <span class="o">=</span> <span class="nv">$&lt;term&gt;</span><span class="o">[</span><span class="mi">1</span><span class="o">..*].</span><span class="nb">map</span><span class="p">(</span><span class="o">*.</span><span class="nb">ast</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="mi">0</span><span class="o">..</span><span class="nv">@ops</span><span class="o">.</span><span class="nb">elems</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">-&gt;</span> <span class="nv">$c</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="nv">@ops</span><span class="o">[</span><span class="nv">$c</span><span class="o">]</span> <span class="ow">eq</span> <span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nv">$result</span> <span class="o">+=</span> <span class="nv">@vals</span><span class="o">[</span><span class="nv">$c</span><span class="o">]</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nv">$result</span> <span class="o">-=</span> <span class="nv">@vals</span><span class="o">[</span><span class="nv">$c</span><span class="o">]</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nv">$/</span><span class="o">.</span><span class="nb">make</span><span class="o">:</span> <span class="nv">$result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">method</span> <span class="nb">term</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$&lt;factor&gt;</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="nb">ast</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nv">$&lt;op&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">my</span> <span class="nv">@ops</span> <span class="o">=</span> <span class="nv">$&lt;op&gt;</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="o">~*</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">my</span> <span class="nv">@vals</span> <span class="o">=</span> <span class="nv">$&lt;factor&gt;</span><span class="o">[</span><span class="mi">1</span><span class="o">..*].</span><span class="nb">map</span><span class="p">(</span><span class="o">*.</span><span class="nb">ast</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="mi">0</span><span class="o">..</span><span class="nv">@ops</span><span class="o">.</span><span class="nb">elems</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">-&gt;</span> <span class="nv">$c</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="nv">@ops</span><span class="o">[</span><span class="nv">$c</span><span class="o">]</span> <span class="ow">eq</span> <span class="p">&#39;</span><span class="s1">*</span><span class="p">&#39;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$result</span> <span class="o">*=</span> <span class="nv">@vals</span><span class="o">[</span><span class="nv">$c</span><span class="o">]</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$result</span> <span class="o">/=</span> <span class="nv">@vals</span><span class="o">[</span><span class="nv">$c</span><span class="o">]</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nv">$/</span><span class="o">.</span><span class="nb">make</span><span class="o">:</span> <span class="nv">$result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">method</span> <span class="nf">factor</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nv">$&lt;identifier&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$/</span><span class="o">.</span><span class="nb">make</span><span class="o">:</span> <span class="nv">%!var</span><span class="p">{</span><span class="o">~</span><span class="nv">$&lt;identifier&gt;</span><span class="p">}</span> <span class="o">//</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">elsif</span> <span class="nv">$&lt;value&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$/</span><span class="o">.</span><span class="nb">make</span><span class="o">:</span> <span class="nv">$&lt;value&gt;</span><span class="o">.</span><span class="nb">ast</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">elsif</span> <span class="nv">$&lt;group&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$/</span><span class="o">.</span><span class="nb">make</span><span class="o">:</span> <span class="nv">$&lt;group&gt;</span><span class="o">.</span><span class="nb">ast</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">method</span> <span class="nf">group</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$/</span><span class="o">.</span><span class="nb">make</span><span class="o">:</span> <span class="nv">$&lt;expression&gt;</span><span class="o">.</span><span class="nb">ast</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">method</span> <span class="nf">identifier</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$/</span><span class="o">.</span><span class="nb">make</span><span class="o">:</span> <span class="o">~</span><span class="nv">$0</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">method</span> <span class="nb">value</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$/</span><span class="o">.</span><span class="nb">make</span><span class="o">:</span> <span class="o">+</span><span class="nv">$0</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="解析">解析</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">use</span> <span class="kt">lib</span> <span class="p">&#39;</span><span class="s1">.</span><span class="p">&#39;;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">Lang::Grammar</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">use</span> <span class="nn">Lang::Actions</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$parsed</span> <span class="o">=</span> <span class="n">Lang::Grammar</span><span class="o">.</span><span class="nb">parsefile</span><span class="p">(</span><span class="vg">@*ARGS</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">//</span> <span class="p">&#39;</span><span class="s1">data/calc.lang</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">:</span><span class="s">actions</span><span class="p">(</span><span class="n">Lang::Actions</span><span class="o">.</span><span class="nb">new</span><span class="p">()));</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nv">$parsed</span><span class="p">;</span>
</span></span></code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[解析 JSON]]></title>
            <link href="https://ohmycloud.github.io/posts/parse-json/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmycloud.github.io/posts/parse-csv/?utm_source=atom_feed" rel="related" type="text/html" title="检测 CSV 是否有效" />
                <link href="https://ohmycloud.github.io/posts/card-game-with-action/?utm_source=atom_feed" rel="related" type="text/html" title="解析带 Action 的纸牌游戏" />
                <link href="https://ohmycloud.github.io/posts/card-game/?utm_source=atom_feed" rel="related" type="text/html" title="解析纸牌游戏" />
                <link href="https://ohmycloud.github.io/posts/alaways-succeed-assertion/?utm_source=atom_feed" rel="related" type="text/html" title="Alaways Succeed Assertion" />
                <link href="https://ohmycloud.github.io/posts/parse-university/?utm_source=atom_feed" rel="related" type="text/html" title="解析校名" />
            
                <id>https://ohmycloud.github.io/posts/parse-json/</id>
            
            
                    <author>
                        <name>焉知非鱼</name>
                    </author>
            <published>2020-05-05T21:19:56+08:00</published>
            <updated>2020-05-05T21:19:56+08:00</updated>
            
            
            <content type="html"><![CDATA[<h3 id="数据样例">数据样例</h3>
<pre tabindex="0"><code>{
    &#34;country&#34;: &#34;Austria&#34;,
    &#34;cities&#34;: [ &#34;Wien&#34;, &#34;Salzburg&#34;, &#34;Innsbruck&#34; ],
    &#34;population&#34;: 8353243
 }
</code></pre><h3 id="grammar">Grammar</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"> <span class="k">grammar</span> <span class="nc">JSON::Tiny::Grammar</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="k">rule</span> <span class="nf">TOP</span>      <span class="p">{</span><span class="sr"> </span><span class="ni">^</span><span class="p">[</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">object</span><span class="p">&gt;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">array</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">]</span><span class="ni">$</span><span class="sr"> </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">     <span class="k">rule</span> <span class="nf">object</span>   <span class="p">{</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">{</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">~</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">}</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">pairlist</span><span class="p">&gt;</span><span class="sr">     </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">     <span class="k">rule</span> <span class="nf">pairlist</span> <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">pair</span><span class="p">&gt;</span><span class="o">*</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> </span><span class="p">[</span><span class="sr"> </span><span class="se">\</span><span class="sr">, </span><span class="p">]</span><span class="sr">         </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">     <span class="k">rule</span> <span class="nf">pair</span>     <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">string</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">:</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">value</span><span class="p">&gt;</span><span class="sr">     </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">     <span class="k">rule</span> <span class="nf">array</span>    <span class="p">{</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">[</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">~</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">]</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">[</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">value</span><span class="p">&gt;</span><span class="o">*</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> </span><span class="p">[</span><span class="sr"> </span><span class="se">\</span><span class="sr">, </span><span class="p">]</span><span class="sr"> </span><span class="p">]</span><span class="sr"> </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">proto</span> <span class="k">token</span> <span class="nf">value</span> <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">...</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">value</span><span class="p">:</span><span class="na">sym</span><span class="p">&lt;</span><span class="s">number</span><span class="p">&gt;</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="o">?</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">[</span><span class="sr"> </span><span class="mi">0</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;[</span><span class="mi">1</span><span class="o">..</span><span class="mi">9</span><span class="p">]&gt;</span><span class="sr"> </span><span class="p">&lt;[</span><span class="mi">0</span><span class="o">..</span><span class="mi">9</span><span class="p">]&gt;</span><span class="o">*</span><span class="sr"> </span><span class="p">]</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">[</span><span class="sr"> </span><span class="se">\</span><span class="sr">. </span><span class="p">&lt;[</span><span class="mi">0</span><span class="o">..</span><span class="mi">9</span><span class="p">]&gt;</span><span class="o">+</span><span class="sr"> </span><span class="p">]</span><span class="o">?</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">[</span><span class="sr"> </span><span class="p">&lt;[</span><span class="sr">eE</span><span class="p">]&gt;</span><span class="sr"> </span><span class="p">[</span><span class="se">\</span><span class="sr">+</span><span class="o">|</span><span class="se">\</span><span class="sr">-</span><span class="p">]</span><span class="o">?</span><span class="sr"> </span><span class="p">&lt;[</span><span class="mi">0</span><span class="o">..</span><span class="mi">9</span><span class="p">]&gt;</span><span class="o">+</span><span class="sr"> </span><span class="p">]</span><span class="o">?</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">value</span><span class="p">:</span><span class="na">sym</span><span class="p">&lt;</span><span class="s">true</span><span class="p">&gt;</span>   <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">sym</span><span class="p">&gt;</span><span class="sr">    </span><span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">value</span><span class="p">:</span><span class="na">sym</span><span class="p">&lt;</span><span class="s">false</span><span class="p">&gt;</span>  <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">sym</span><span class="p">&gt;</span><span class="sr">    </span><span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">value</span><span class="p">:</span><span class="na">sym</span><span class="p">&lt;</span><span class="s">null</span><span class="p">&gt;</span>   <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">sym</span><span class="p">&gt;</span><span class="sr">    </span><span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">value</span><span class="p">:</span><span class="na">sym</span><span class="p">&lt;</span><span class="s">object</span><span class="p">&gt;</span> <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">object</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">value</span><span class="p">:</span><span class="na">sym</span><span class="p">&lt;</span><span class="s">array</span><span class="p">&gt;</span>  <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">array</span><span class="p">&gt;</span><span class="sr">  </span><span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">value</span><span class="p">:</span><span class="na">sym</span><span class="p">&lt;</span><span class="s">string</span><span class="p">&gt;</span> <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">string</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">string</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="se">\</span><span class="sr">&#34; </span><span class="o">~</span><span class="sr"> </span><span class="se">\</span><span class="sr">&#34; </span><span class="p">[</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">str</span><span class="p">&gt;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="se">\</span><span class="sr">\ </span><span class="p">&lt;</span><span class="nf">str_escape</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">]</span><span class="o">*</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">str</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">[</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">            </span><span class="p">&lt;</span><span class="o">!</span><span class="ow">before</span><span class="sr"> </span><span class="se">\t</span><span class="p">&gt;</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">            </span><span class="p">&lt;</span><span class="o">!</span><span class="ow">before</span><span class="sr"> </span><span class="se">\n</span><span class="p">&gt;</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">            </span><span class="p">&lt;</span><span class="o">!</span><span class="ow">before</span><span class="sr"> </span><span class="se">\</span><span class="sr">\</span><span class="p">&gt;</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">            </span><span class="p">&lt;</span><span class="o">!</span><span class="ow">before</span><span class="sr"> </span><span class="se">\</span><span class="sr">&#34;</span><span class="p">&gt;</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">            </span><span class="ni">.</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">]</span><span class="o">+</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="c1"># &lt;-[&#34;\\\t\n]&gt;+
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">str_escape</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">&lt;[</span><span class="sr">&#34;</span><span class="se">\</span><span class="sr">\/bfnrt</span><span class="p">]&gt;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> u </span><span class="p">&lt;</span><span class="nf">xdigit</span><span class="p">&gt;</span><span class="o">**</span><span class="mi">4</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span></code></pre></div><h3 id="解析">解析</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"> <span class="c1"># test it:</span>
</span></span><span class="line"><span class="cl"> <span class="k">my</span> <span class="nv">$tester</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">{
</span></span></span><span class="line"><span class="cl"><span class="s1">     &#34;country&#34;: &#34;Austria&#34;,
</span></span></span><span class="line"><span class="cl"><span class="s1">     &#34;cities&#34;: [ &#34;Wien&#34;, &#34;Salzburg&#34;, &#34;Innsbruck&#34; ],
</span></span></span><span class="line"><span class="cl"><span class="s1">     &#34;population&#34;: 8353243
</span></span></span><span class="line"><span class="cl"><span class="s1"> }</span><span class="p">&#39;;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="k">if</span> <span class="n">JSON::Tiny::Grammar</span><span class="o">.</span><span class="nb">parse</span><span class="p">(</span><span class="nv">$tester</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">It&#39;s valid JSON</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="c1"># TODO: error reporting</span>
</span></span><span class="line"><span class="cl">     <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Not quite...</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span></code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[检测 CSV 是否有效]]></title>
            <link href="https://ohmycloud.github.io/posts/parse-csv/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmycloud.github.io/posts/card-game-with-action/?utm_source=atom_feed" rel="related" type="text/html" title="解析带 Action 的纸牌游戏" />
                <link href="https://ohmycloud.github.io/posts/card-game/?utm_source=atom_feed" rel="related" type="text/html" title="解析纸牌游戏" />
                <link href="https://ohmycloud.github.io/posts/alaways-succeed-assertion/?utm_source=atom_feed" rel="related" type="text/html" title="Alaways Succeed Assertion" />
                <link href="https://ohmycloud.github.io/posts/parse-university/?utm_source=atom_feed" rel="related" type="text/html" title="解析校名" />
                <link href="https://ohmycloud.github.io/posts/key-value-pairs/?utm_source=atom_feed" rel="related" type="text/html" title="解析键值对儿" />
            
                <id>https://ohmycloud.github.io/posts/parse-csv/</id>
            
            
                    <author>
                        <name>焉知非鱼</name>
                    </author>
            <published>2020-05-05T21:13:45+08:00</published>
            <updated>2020-05-05T21:13:45+08:00</updated>
            
            
            <content type="html"><![CDATA[<h3 id="数据样例">数据样例</h3>
<pre tabindex="0"><code>Year,Make,Model,Length
1997,Ford,E350,2.34
2000,Mercury,Cougar,2.38
</code></pre><h3 id="grammar">Grammar</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">grammar</span> <span class="nc">CSV</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr"> </span><span class="p">[</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">line</span><span class="p">&gt;</span><span class="sr"> </span><span class="se">\n</span><span class="o">?</span><span class="sr"> </span><span class="p">]</span><span class="o">+</span><span class="sr"> </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">line</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="ni">^^</span><span class="sr">            </span><span class="c1"># Beginning of a line
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">        </span><span class="p">&lt;</span><span class="nf">value</span><span class="p">&gt;</span><span class="o">*</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> </span><span class="se">\</span><span class="sr">, </span><span class="c1"># Any number of &lt;value&gt;s with commas in `between` them
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">        </span><span class="ni">$$</span><span class="sr">            </span><span class="c1"># End of a line
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">value</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">[</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">-</span><span class="p">[</span><span class="sr">&#34;,</span><span class="se">\n</span><span class="p">]&gt;</span><span class="sr">     </span><span class="c1"># Anything not a double quote, comma or newline
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">quoted-text</span><span class="p">&gt;</span><span class="sr"> </span><span class="c1"># Or some quoted text
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">        </span><span class="p">]</span><span class="o">*</span><span class="sr">              </span><span class="c1"># Any number of times
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">quoted-text</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="se">\</span><span class="sr">&#34;
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">[</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">-</span><span class="p">[</span><span class="sr">&#34;</span><span class="se">\</span><span class="sr">\</span><span class="p">]&gt;</span><span class="sr"> </span><span class="c1"># Anything not a &#34; or \
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">\&#34;</span><span class="p">&#39;</span><span class="sr">     </span><span class="c1"># Or \&#34;, an escaped quotation mark
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">        </span><span class="p">]</span><span class="o">*</span><span class="sr">         </span><span class="c1"># Any number of times
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">        </span><span class="se">\</span><span class="sr">&#34;
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="解析">解析</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Valid CSV file!</span><span class="p">&#34;</span> <span class="k">if</span> <span class="n">CSV</span><span class="o">.</span><span class="nb">parse</span><span class="p">(</span> <span class="k">q</span><span class="sa">:to</span><span class="p">/EOCSV/ </span><span class="s">);
</span></span></span><span class="line"><span class="cl"><span class="s">    Year,Make,Model,Length
</span></span></span><span class="line"><span class="cl"><span class="s">    1997,Ford,E350,2.34
</span></span></span><span class="line"><span class="cl"><span class="s">    2000,Mercury,Cougar,2.38
</span></span></span><span class="line"><span class="cl"><span class="s">    </span><span class="p">EOCSV</span>
</span></span></code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[解析带 Action 的纸牌游戏]]></title>
            <link href="https://ohmycloud.github.io/posts/card-game-with-action/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmycloud.github.io/posts/card-game/?utm_source=atom_feed" rel="related" type="text/html" title="解析纸牌游戏" />
                <link href="https://ohmycloud.github.io/posts/alaways-succeed-assertion/?utm_source=atom_feed" rel="related" type="text/html" title="Alaways Succeed Assertion" />
                <link href="https://ohmycloud.github.io/posts/parse-university/?utm_source=atom_feed" rel="related" type="text/html" title="解析校名" />
                <link href="https://ohmycloud.github.io/posts/key-value-pairs/?utm_source=atom_feed" rel="related" type="text/html" title="解析键值对儿" />
                <link href="https://ohmycloud.github.io/posts/math-expression/?utm_source=atom_feed" rel="related" type="text/html" title="解析数学表达式" />
            
                <id>https://ohmycloud.github.io/posts/card-game-with-action/</id>
            
            
                    <author>
                        <name>焉知非鱼</name>
                    </author>
            <published>2020-05-05T20:56:13+08:00</published>
            <updated>2020-05-05T20:56:13+08:00</updated>
            
            
            <content type="html"><![CDATA[<h3 id="数据样例">数据样例</h3>
<pre tabindex="0"><code>a♥ a♥ 7♦ 8♣ j♥
a♥ 7♥ 7♦ 8♣ j♥; 10♥ j♥ q♥ k♥ a♦
</code></pre><h3 id="grammar">Grammar</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">grammar</span> <span class="nc">CardGame</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="k">rule</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr"> </span><span class="ni">^</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">deal</span><span class="p">&gt;</span><span class="sr"> </span><span class="ni">$</span><span class="sr"> </span><span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="k">rule</span> <span class="nf">deal</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">       </span><span class="o">:</span><span class="kd">my</span> <span class="vg">%*PLAYED</span> <span class="o">=</span> <span class="p">();</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">       </span><span class="p">&lt;</span><span class="nf">hand</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="k">rule</span> <span class="nf">hand</span> <span class="p">{</span><span class="sr"> </span><span class="p">[</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">card</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">]</span><span class="o">**</span><span class="mi">5</span><span class="sr"> </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">card</span> <span class="p">{&lt;</span><span class="nf">face</span><span class="p">&gt;&lt;</span><span class="nf">suit</span><span class="p">&gt;}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="k">proto</span> <span class="k">token</span> <span class="nf">suit</span> <span class="p">{</span><span class="o">*</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">suit</span><span class="p">:</span><span class="na">sym</span><span class="p">&lt;</span><span class="s">♥</span><span class="p">&gt;</span>  <span class="p">{&lt;</span><span class="nf">sym</span><span class="p">&gt;}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">suit</span><span class="p">:</span><span class="na">sym</span><span class="p">&lt;</span><span class="s">♦</span><span class="p">&gt;</span>  <span class="p">{&lt;</span><span class="nf">sym</span><span class="p">&gt;}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">suit</span><span class="p">:</span><span class="na">sym</span><span class="p">&lt;</span><span class="s">♣</span><span class="p">&gt;</span>  <span class="p">{&lt;</span><span class="nf">sym</span><span class="p">&gt;}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">suit</span><span class="p">:</span><span class="na">sym</span><span class="p">&lt;</span><span class="s">♠</span><span class="p">&gt;</span>  <span class="p">{&lt;</span><span class="nf">sym</span><span class="p">&gt;}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">face</span> <span class="p">{:</span><span class="na">i</span><span class="sr"> </span><span class="p">&lt;[</span><span class="mi">2</span><span class="o">..</span><span class="mi">9</span><span class="p">]&gt;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="mi">10</span><span class="sr"> </span><span class="o">|</span><span class="sr"> j </span><span class="o">|</span><span class="sr"> q </span><span class="o">|</span><span class="sr"> k </span><span class="o">|</span><span class="sr"> a </span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="action">Action</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CardGame::Actions</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">card</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="k">my</span> <span class="nv">$card</span> <span class="o">=</span> <span class="nv">$/</span><span class="o">.</span><span class="nb">lc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">       <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hey, there&#39;s an extra </span><span class="nv">$card</span><span class="p">&#34;</span>
</span></span><span class="line"><span class="cl">           <span class="k">if</span> <span class="vg">%*PLAYED</span><span class="p">{</span><span class="nv">$card</span><span class="p">}</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="解析">解析</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="n">CardGame::Actions</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="n">CardGame</span><span class="o">.</span><span class="nb">parse</span><span class="p">(&#34;</span><span class="s2">a♥ a♥ 7♦ 8♣ j♥</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">:</span><span class="s">actions</span><span class="p">(</span><span class="nv">$a</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="c1"># &#34;Hey there&#39;s an extra a♥&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="n">CardGame</span><span class="o">.</span><span class="nb">parse</span><span class="p">(&#34;</span><span class="s2">a♥ 7♥ 7♦ 8♣ j♥; 10♥ j♥ q♥ k♥ a♦</span><span class="p">&#34;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                   <span class="p">:</span><span class="s">actions</span><span class="p">(</span><span class="nv">$a</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="c1"># &#34;Hey there&#39;s an extra j♥&#34;</span>
</span></span></code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[解析纸牌游戏]]></title>
            <link href="https://ohmycloud.github.io/posts/card-game/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmycloud.github.io/posts/alaways-succeed-assertion/?utm_source=atom_feed" rel="related" type="text/html" title="Alaways Succeed Assertion" />
                <link href="https://ohmycloud.github.io/posts/parse-university/?utm_source=atom_feed" rel="related" type="text/html" title="解析校名" />
                <link href="https://ohmycloud.github.io/posts/key-value-pairs/?utm_source=atom_feed" rel="related" type="text/html" title="解析键值对儿" />
                <link href="https://ohmycloud.github.io/posts/math-expression/?utm_source=atom_feed" rel="related" type="text/html" title="解析数学表达式" />
                <link href="https://ohmycloud.github.io/posts/parse-variable-name/?utm_source=atom_feed" rel="related" type="text/html" title="解析变量名" />
            
                <id>https://ohmycloud.github.io/posts/card-game/</id>
            
            
                    <author>
                        <name>焉知非鱼</name>
                    </author>
            <published>2020-05-05T20:53:19+08:00</published>
            <updated>2020-05-05T20:53:19+08:00</updated>
            
            
            <content type="html"><![CDATA[<h3 id="数据样例">数据样例</h3>
<pre tabindex="0"><code>2♥ 5♥ 7♦ 8♣ 9♠
2♥ a♥ 7♦ 8♣ j♥
</code></pre><h3 id="grammar">Grammar</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">grammar</span> <span class="nc">CardGame</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="k">rule</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr"> </span><span class="ni">^</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">deal</span><span class="p">&gt;</span><span class="sr"> </span><span class="ni">$</span><span class="sr"> </span><span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="k">rule</span> <span class="nf">deal</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">&lt;</span><span class="nf">hand</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="k">rule</span> <span class="nf">hand</span> <span class="p">{</span><span class="sr"> </span><span class="p">[</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">card</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">]</span><span class="o">**</span><span class="mi">5</span><span class="sr"> </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">card</span> <span class="p">{&lt;</span><span class="nf">face</span><span class="p">&gt;&lt;</span><span class="nf">suit</span><span class="p">&gt;}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="k">proto</span> <span class="k">token</span> <span class="nf">suit</span> <span class="p">{</span><span class="o">*</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">suit</span><span class="p">:</span><span class="na">sym</span><span class="p">&lt;</span><span class="s">♥</span><span class="p">&gt;</span>  <span class="p">{&lt;</span><span class="nf">sym</span><span class="p">&gt;}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">suit</span><span class="p">:</span><span class="na">sym</span><span class="p">&lt;</span><span class="s">♦</span><span class="p">&gt;</span>  <span class="p">{&lt;</span><span class="nf">sym</span><span class="p">&gt;}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">suit</span><span class="p">:</span><span class="na">sym</span><span class="p">&lt;</span><span class="s">♣</span><span class="p">&gt;</span>  <span class="p">{&lt;</span><span class="nf">sym</span><span class="p">&gt;}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">suit</span><span class="p">:</span><span class="na">sym</span><span class="p">&lt;</span><span class="s">♠</span><span class="p">&gt;</span>  <span class="p">{&lt;</span><span class="nf">sym</span><span class="p">&gt;}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">face</span> <span class="p">{:</span><span class="na">i</span><span class="sr"> </span><span class="p">&lt;[</span><span class="mi">2</span><span class="o">..</span><span class="mi">9</span><span class="p">]&gt;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="mi">10</span><span class="sr"> </span><span class="o">|</span><span class="sr"> j </span><span class="o">|</span><span class="sr"> q </span><span class="o">|</span><span class="sr"> k </span><span class="o">|</span><span class="sr"> a </span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="解析">解析</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="nb">say</span> <span class="n">CardGame</span><span class="o">.</span><span class="nb">parse</span><span class="p">(&#34;</span><span class="s2">2♥ 5♥ 7♦ 8♣ 9♠</span><span class="p">&#34;);</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="n">CardGame</span><span class="o">.</span><span class="nb">parse</span><span class="p">(&#34;</span><span class="s2">2♥ a♥ 7♦ 8♣ j♥</span><span class="p">&#34;);</span>
</span></span></code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[Alaways Succeed Assertion]]></title>
            <link href="https://ohmycloud.github.io/posts/alaways-succeed-assertion/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmycloud.github.io/posts/parse-university/?utm_source=atom_feed" rel="related" type="text/html" title="解析校名" />
                <link href="https://ohmycloud.github.io/posts/key-value-pairs/?utm_source=atom_feed" rel="related" type="text/html" title="解析键值对儿" />
                <link href="https://ohmycloud.github.io/posts/math-expression/?utm_source=atom_feed" rel="related" type="text/html" title="解析数学表达式" />
                <link href="https://ohmycloud.github.io/posts/parse-variable-name/?utm_source=atom_feed" rel="related" type="text/html" title="解析变量名" />
                <link href="https://ohmycloud.github.io/posts/pair-bracket/?utm_source=atom_feed" rel="related" type="text/html" title="解析括号对儿之间的数据" />
            
                <id>https://ohmycloud.github.io/posts/alaways-succeed-assertion/</id>
            
            
                    <author>
                        <name>焉知非鱼</name>
                    </author>
            <published>2020-05-05T20:40:19+08:00</published>
            <updated>2020-05-05T20:40:19+08:00</updated>
            
            
            <content type="html"><![CDATA[<h3 id="数据样例">数据样例</h3>
<pre tabindex="0"><code>255 435 777
123 456 789
098 764 125
</code></pre><h3 id="grammar">Grammar</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">grammar</span> <span class="nc">Digifier</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">rule</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">[</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">.</span><span class="nf">succ</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">digit</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="p">]</span><span class="o">+</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">succ</span>   <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">?</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">digit</span> <span class="p">{</span><span class="sr"> </span><span class="p">&lt;[</span><span class="mi">0</span><span class="o">..</span><span class="mi">9</span><span class="p">]&gt;</span><span class="sr"> </span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="action">Action</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Devanagari</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="nv">@!numbers</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">digit</span> <span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> <span class="nv">@!numbers</span><span class="o">.</span><span class="nb">tail</span> <span class="o">~=</span> <span class="p">&lt;</span><span class="s">零 一 二 三 四 五 六 七 八 九</span><span class="p">&gt;</span><span class="o">[</span><span class="nv">$/</span><span class="o">]</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nb">succ</span>  <span class="p">(</span><span class="nv">$</span><span class="p">)</span>  <span class="p">{</span> <span class="nv">@!numbers</span><span class="o">.</span><span class="nb">push</span><span class="o">:</span> <span class="p">&#39;&#39;</span>     <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">TOP</span>   <span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> <span class="k">make</span> <span class="nv">@!numbers</span><span class="o">[^</span><span class="p">(</span><span class="o">*-</span><span class="mi">1</span><span class="p">)</span><span class="o">]</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="解析">解析</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="nb">say</span> <span class="n">Digifier</span><span class="o">.</span><span class="nb">parse</span><span class="p">(&#39;</span><span class="s1">255 435 777</span><span class="p">&#39;</span><span class="o">,</span> <span class="s">actions</span> <span class="o">=&gt;</span> <span class="n">Devanagari</span><span class="o">.</span><span class="nb">new</span><span class="p">)</span><span class="o">.</span><span class="k">made</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># OUTPUT: 二五五 四三五 七七七</span>
</span></span></code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[解析校名]]></title>
            <link href="https://ohmycloud.github.io/posts/parse-university/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmycloud.github.io/posts/key-value-pairs/?utm_source=atom_feed" rel="related" type="text/html" title="解析键值对儿" />
                <link href="https://ohmycloud.github.io/posts/math-expression/?utm_source=atom_feed" rel="related" type="text/html" title="解析数学表达式" />
                <link href="https://ohmycloud.github.io/posts/parse-variable-name/?utm_source=atom_feed" rel="related" type="text/html" title="解析变量名" />
                <link href="https://ohmycloud.github.io/posts/pair-bracket/?utm_source=atom_feed" rel="related" type="text/html" title="解析括号对儿之间的数据" />
                <link href="https://ohmycloud.github.io/posts/ini-parser/?utm_source=atom_feed" rel="related" type="text/html" title="解析 INI 文件" />
            
                <id>https://ohmycloud.github.io/posts/parse-university/</id>
            
            
                    <author>
                        <name>焉知非鱼</name>
                    </author>
            <published>2020-05-05T20:31:38+08:00</published>
            <updated>2020-05-05T20:31:38+08:00</updated>
            
            
            <content type="html"><![CDATA[<h3 id="数据样本">数据样本</h3>
<pre tabindex="0"><code>[Wang, Zhiguo; Zhao, Zhiguo] Hangzhou Normal Univ, Ctr Cognit &amp; Brain Disorders, Hangzhou, Zhejiang, Peoples R China; [Wang, Zhiguo; Theeuwes, Jan] Vrije Univ Amsterdam, Dept Cognit Psychol, Amsterdam, Netherlands
</code></pre><h3 id="grammar">Grammar</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">grammar</span> <span class="nc">University</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">TOP</span>             <span class="p">{</span><span class="sr"> </span><span class="ni">^</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">university</span><span class="p">&gt;</span><span class="sr"> </span><span class="ni">$</span><span class="sr">             </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">university</span>      <span class="p">{</span><span class="sr"> </span><span class="p">[</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">bracket</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">info</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">]</span><span class="o">+</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">; </span><span class="p">&#39;</span><span class="sr"> </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">bracket</span>         <span class="p">{</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">[</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">studentname</span><span class="p">&gt;</span><span class="sr">  </span><span class="p">&#39;</span><span class="s1">] </span><span class="p">&#39;</span><span class="sr">      </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">studentname</span>     <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nv">stdname</span><span class="o">=.</span><span class="nf">info</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">; </span><span class="p">&#39;</span><span class="sr">      </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">info</span>            <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">field</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">, </span><span class="p">&#39;</span><span class="sr">              </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">field</span>           <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">-</span><span class="p">[</span><span class="sr">,</span><span class="se">\</span><span class="sr">]</span><span class="se">\</span><span class="sr">[;</span><span class="se">\n</span><span class="p">]&gt;</span><span class="o">+</span><span class="sr">               </span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">grammar</span> <span class="nc">MyUniversity</span>  <span class="k">is</span> <span class="nc">University</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">university</span>      <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">info</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">; </span><span class="p">&#39;</span><span class="sr"> </span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="action">Action</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MyUniversityAction</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="解析">解析</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$parsed</span> <span class="o">=</span> <span class="n">University::Grammar</span><span class="o">.</span><span class="nb">parse</span><span class="p">(</span><span class="nv">$string</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="nv">@</span><span class="p">(</span><span class="nv">$parsed</span><span class="p">&lt;</span><span class="s">university</span><span class="p">&gt;&lt;</span><span class="s">info</span><span class="p">&gt;)</span> <span class="k">-&gt;</span> <span class="nv">$u</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">say</span> <span class="nv">$u</span><span class="p">&lt;</span><span class="s">field</span><span class="p">&gt;</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[解析键值对儿]]></title>
            <link href="https://ohmycloud.github.io/posts/key-value-pairs/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmycloud.github.io/posts/math-expression/?utm_source=atom_feed" rel="related" type="text/html" title="解析数学表达式" />
                <link href="https://ohmycloud.github.io/posts/parse-variable-name/?utm_source=atom_feed" rel="related" type="text/html" title="解析变量名" />
                <link href="https://ohmycloud.github.io/posts/pair-bracket/?utm_source=atom_feed" rel="related" type="text/html" title="解析括号对儿之间的数据" />
                <link href="https://ohmycloud.github.io/posts/ini-parser/?utm_source=atom_feed" rel="related" type="text/html" title="解析 INI 文件" />
                <link href="https://ohmycloud.github.io/posts/station/?utm_source=atom_feed" rel="related" type="text/html" title="解析天气预报数据" />
            
                <id>https://ohmycloud.github.io/posts/key-value-pairs/</id>
            
            
                    <author>
                        <name>焉知非鱼</name>
                    </author>
            <published>2020-05-05T20:17:10+08:00</published>
            <updated>2020-05-05T20:17:10+08:00</updated>
            
            
            <content type="html"><![CDATA[<h3 id="数据样例">数据样例</h3>
<pre tabindex="0"><code>version=6.d
backend=MoarVM
disto=Rakudo Star
</code></pre><h3 id="grammar">Grammar</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">grammar</span> <span class="nc">KeyValuePairs</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">[&lt;</span><span class="nf">pair</span><span class="p">&gt;</span><span class="sr"> </span><span class="se">\v</span><span class="o">+</span><span class="p">]</span><span class="o">*</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">pair</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">&lt;</span><span class="nv">key</span><span class="o">=.</span><span class="nf">identifier</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nv">value</span><span class="o">=.</span><span class="nf">identifier</span><span class="p">&gt;</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">identifier</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="se">\w</span><span class="o">+</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="action">Action</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">KeyValuePairsActions</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nb">pair</span>      <span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$/</span><span class="o">.</span><span class="nb">make</span><span class="o">:</span> <span class="nv">$&lt;key&gt;</span><span class="o">.</span><span class="s">made</span> <span class="o">=&gt;</span> <span class="nv">$&lt;value&gt;</span><span class="o">.</span><span class="k">made</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">identifier</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># subroutine `make` is the same as calling .make on $/</span>
</span></span><span class="line"><span class="cl">        <span class="k">make</span> <span class="o">~</span><span class="nv">$/</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">TOP</span> <span class="p">(</span><span class="nv">$match</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># can use any variable name for parameter, not just $/</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$match</span><span class="o">.</span><span class="nb">make</span><span class="o">:</span> <span class="nv">$match</span><span class="p">&lt;</span><span class="s">pair</span><span class="p">&gt;</span><span class="o">».</span><span class="k">made</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[解析数学表达式]]></title>
            <link href="https://ohmycloud.github.io/posts/math-expression/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmycloud.github.io/posts/parse-variable-name/?utm_source=atom_feed" rel="related" type="text/html" title="解析变量名" />
                <link href="https://ohmycloud.github.io/posts/pair-bracket/?utm_source=atom_feed" rel="related" type="text/html" title="解析括号对儿之间的数据" />
                <link href="https://ohmycloud.github.io/posts/ini-parser/?utm_source=atom_feed" rel="related" type="text/html" title="解析 INI 文件" />
                <link href="https://ohmycloud.github.io/posts/station/?utm_source=atom_feed" rel="related" type="text/html" title="解析天气预报数据" />
                <link href="https://ohmycloud.github.io/posts/trips/?utm_source=atom_feed" rel="related" type="text/html" title="" />
            
                <id>https://ohmycloud.github.io/posts/math-expression/</id>
            
            
                    <author>
                        <name>焉知非鱼</name>
                    </author>
            <published>2020-05-05T20:01:16+08:00</published>
            <updated>2020-05-05T20:01:16+08:00</updated>
            
            
            <content type="html"><![CDATA[<h3 id="数据样例">数据样例</h3>
<pre tabindex="0"><code>3 + 4 - 5
3 * 4 * 5
4 + 5 * (1 + 3)
</code></pre><h3 id="grammar">Grammar</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">grammar</span> <span class="nc">MathExpression</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">TOP</span>    <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">sum</span><span class="p">&gt;</span><span class="sr">              </span><span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="k">rule</span> <span class="nf">sum</span>     <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">product</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr">   </span><span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="k">rule</span> <span class="nf">product</span> <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">term</span><span class="p">&gt;</span><span class="o">+</span><span class="sr">    </span><span class="nv">%</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">*</span><span class="p">&#39;</span><span class="sr">   </span><span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="k">rule</span> <span class="nf">term</span>    <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">number</span><span class="p">&gt;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">group</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="k">rule</span> <span class="nf">group</span>   <span class="p">{</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">(</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">sum</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">)</span><span class="p">&#39;</span><span class="sr">      </span><span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">number</span> <span class="p">{</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="sr">                </span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="action">Action</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">MathEvalAction</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">TOP</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">make</span> <span class="nv">$&lt;sum&gt;</span><span class="o">.</span><span class="k">made</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nb">sum</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">make</span> <span class="o">[+]</span> <span class="nv">$&lt;product&gt;</span><span class="o">».</span><span class="k">made</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">product</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">make</span> <span class="o">[*]</span> <span class="nv">$&lt;term&gt;</span><span class="o">».</span><span class="k">made</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nb">term</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">make</span> <span class="nv">$/</span><span class="o">.</span><span class="nb">values</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="k">made</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">group</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">make</span> <span class="nv">$&lt;sum&gt;</span><span class="o">.</span><span class="k">made</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">number</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">make</span> <span class="nv">$/</span><span class="o">.</span><span class="kt">Int</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="解析">解析</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$match</span> <span class="o">=</span> <span class="n">MathExpression</span><span class="o">.</span><span class="nb">parse</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">&#39;</span><span class="s1">4 + 5 * (1 + 3)</span><span class="p">&#39;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">actions</span> <span class="o">=&gt;</span> <span class="n">MathEvalAction</span><span class="o">.</span><span class="nb">new</span><span class="o">,</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nv">$match</span><span class="o">.</span><span class="k">made</span><span class="p">;</span> <span class="c1"># Output: 24</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nv">$match</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>
</span></span></code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[解析变量名]]></title>
            <link href="https://ohmycloud.github.io/posts/parse-variable-name/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmycloud.github.io/posts/pair-bracket/?utm_source=atom_feed" rel="related" type="text/html" title="解析括号对儿之间的数据" />
                <link href="https://ohmycloud.github.io/posts/ini-parser/?utm_source=atom_feed" rel="related" type="text/html" title="解析 INI 文件" />
                <link href="https://ohmycloud.github.io/posts/station/?utm_source=atom_feed" rel="related" type="text/html" title="解析天气预报数据" />
                <link href="https://ohmycloud.github.io/posts/trips/?utm_source=atom_feed" rel="related" type="text/html" title="" />
                <link href="https://ohmycloud.github.io/notes/save-kafka-offsets-in-spark-structured-streaming/?utm_source=atom_feed" rel="related" type="text/html" title="在 Spark Structured Streaming 中管理 Kafka Offsets" />
            
                <id>https://ohmycloud.github.io/posts/parse-variable-name/</id>
            
            
                    <author>
                        <name>焉知非鱼</name>
                    </author>
            <published>2020-05-05T19:41:58+08:00</published>
            <updated>2020-05-05T19:41:58+08:00</updated>
            
            
            <content type="html"><![CDATA[<h3 id="数据样例">数据样例</h3>
<pre tabindex="0"><code>@array
%hash
$sum
</code></pre><h3 id="grammar">Grammar</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">grammar</span> <span class="nc">VariableNames</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">variable</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">&lt;</span><span class="nf">sigil</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">name</span><span class="p">&gt;</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">sigil</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">&#39;</span><span class="s1">$</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">@</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">&amp;</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">%</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">::</span><span class="p">&#39;</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1"># [ ... ] are non-capturing groups</span>
</span></span><span class="line"><span class="cl">	<span class="k">token</span> <span class="nf">name</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">&lt;</span><span class="nf">identifier</span><span class="p">&gt;</span><span class="sr"> 
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">[</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">::</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">identifier</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">]</span><span class="sr"> </span><span class="o">*</span><span class="sr"> 
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1"># 标识符以字母开头</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">identifier</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">&lt;</span><span class="nf">alpha</span><span class="p">&gt;</span><span class="sr"> </span><span class="se">\w</span><span class="o">+</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h4 id="匹配">匹配</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$match</span> <span class="o">=</span> <span class="n">VariableNames</span><span class="o">.</span><span class="nb">parse</span><span class="p">(&#34;</span><span class="nv">@array</span><span class="p">&#34;</span><span class="o">,</span><span class="p">:</span><span class="s">rule</span><span class="p">(&#39;</span><span class="s1">variable</span><span class="p">&#39;));</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nv">$match</span><span class="p">;</span>
</span></span></code></pre></div><h3 id="继承">继承</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="c1"># we inherit from the original grammar...</span>
</span></span><span class="line"><span class="cl"><span class="k">grammar</span> <span class="nc">VARIABLENAMES</span> <span class="k">is</span> <span class="nc">VariableNames</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># ... and override that parsing rule that we want to change</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">identifier</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="c1"># char classes are &lt;[ ... ]&gt; in Perl 6
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">        </span><span class="p">&lt;[</span><span class="sr">A</span><span class="o">..</span><span class="sr">Z</span><span class="p">]&gt;</span><span class="sr"> </span><span class="p">&lt;[</span><span class="sr">A</span><span class="o">..</span><span class="sr">Z</span><span class="mi">0</span><span class="o">..</span><span class="mi">9</span><span class="sr">_</span><span class="p">]&gt;</span><span class="o">*</span><span class="sr"> 
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h4 id="匹配-1">匹配</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$test</span> <span class="o">=</span> <span class="n">VARIABLENAMES</span><span class="o">.</span><span class="nb">parse</span><span class="p">(&#34;</span><span class="nv">%A_HASH_TABLE</span><span class="p">&#34;</span><span class="o">,</span><span class="p">:</span><span class="s">rule</span><span class="p">(&#39;</span><span class="s1">variable</span><span class="p">&#39;));</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nv">$test</span><span class="p">;</span>
</span></span></code></pre></div><h3 id="继承-1">继承</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">grammar</span> <span class="nc">LackMoney</span> <span class="k">is</span> <span class="nc">VariableNames</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">sigil</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">&#39;</span><span class="s1">¢</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">@</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">&amp;</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">%</span><span class="p">&#39;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">::</span><span class="p">&#39;</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h4 id="匹配-2">匹配</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="c1"># 继承以后, 带¢的变量能够解析, 带$的变量解析不了了</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$money</span> <span class="o">=</span> <span class="n">LackMoney</span><span class="o">.</span><span class="nb">parse</span><span class="p">(&#39;</span><span class="s1">$i_m_not_dollor</span><span class="p">&#39;</span><span class="o">,</span><span class="p">:</span><span class="s">rule</span><span class="p">(&#39;</span><span class="s1">variable</span><span class="p">&#39;));</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nb">so</span> <span class="nv">$money</span><span class="p">;</span> <span class="c1"># false</span>
</span></span></code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[解析括号对儿之间的数据]]></title>
            <link href="https://ohmycloud.github.io/posts/pair-bracket/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmycloud.github.io/posts/ini-parser/?utm_source=atom_feed" rel="related" type="text/html" title="解析 INI 文件" />
                <link href="https://ohmycloud.github.io/posts/station/?utm_source=atom_feed" rel="related" type="text/html" title="解析天气预报数据" />
                <link href="https://ohmycloud.github.io/posts/trips/?utm_source=atom_feed" rel="related" type="text/html" title="" />
                <link href="https://ohmycloud.github.io/notes/save-kafka-offsets-in-spark-structured-streaming/?utm_source=atom_feed" rel="related" type="text/html" title="在 Spark Structured Streaming 中管理 Kafka Offsets" />
                <link href="https://ohmycloud.github.io/notes/parquet-format-not-work-in-spark-structured-streaming/?utm_source=atom_feed" rel="related" type="text/html" title="parquet-format-not-work-in-spark-structured-streaming" />
            
                <id>https://ohmycloud.github.io/posts/pair-bracket/</id>
            
            
                    <author>
                        <name>焉知非鱼</name>
                    </author>
            <published>2020-05-05T19:04:51+08:00</published>
            <updated>2020-05-05T19:04:51+08:00</updated>
            
            
            <content type="html"><![CDATA[<h3 id="数据样本">数据样本</h3>
<pre tabindex="0"><code>[Lue, Fan]
[Lou, Man-Li]
[Tian, Mijie; Zhou, Lin; Zou, Xiao; Zheng, Qiaoji; Luo, Lingling; Jiang, Na; Lin, Dunmin]
</code></pre><h3 id="grrammar">Grrammar</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">grammar</span> <span class="nc">PairBracket</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="ni">^</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">line</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="ni">$</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">line</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="se">\</span><span class="sr">[
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">&lt;</span><span class="nf">student</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">semicolon</span><span class="p">&gt;</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="se">\</span><span class="sr">]
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="se">\n</span><span class="sr">                   </span><span class="c1"># 换行 \n 是最容易被忽略的地方
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">student</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">       </span><span class="p">&lt;</span><span class="nf">myname</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">comma</span><span class="p">&gt;</span><span class="sr">   </span><span class="c1"># 分隔符也可以是一个 subrule
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">myname</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">&lt;[</span><span class="sr">A</span><span class="o">..</span><span class="sr">Za</span><span class="o">..</span><span class="sr">z-</span><span class="p">]&gt;</span><span class="o">+</span><span class="sr">       </span><span class="c1"># 字符类的写法 &lt;[...]&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">comma</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">&#39;</span><span class="s1">,</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\s</span><span class="o">+</span><span class="sr">              </span><span class="c1"># 逗号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">semicolon</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\s</span><span class="o">+</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="action">Action</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">PairBracketAction</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="提取数据">提取数据</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$parse</span> <span class="o">=</span> <span class="n">Lines</span><span class="o">.</span><span class="nb">parsefile</span><span class="p">(&#39;</span><span class="s1">test.txt</span><span class="p">&#39;);</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nv">$parse</span><span class="p">&lt;</span><span class="s">line</span><span class="p">&gt;;</span>
</span></span></code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[解析 INI 文件]]></title>
            <link href="https://ohmycloud.github.io/posts/ini-parser/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmycloud.github.io/posts/station/?utm_source=atom_feed" rel="related" type="text/html" title="解析天气预报数据" />
                <link href="https://ohmycloud.github.io/posts/trips/?utm_source=atom_feed" rel="related" type="text/html" title="" />
                <link href="https://ohmycloud.github.io/notes/save-kafka-offsets-in-spark-structured-streaming/?utm_source=atom_feed" rel="related" type="text/html" title="在 Spark Structured Streaming 中管理 Kafka Offsets" />
                <link href="https://ohmycloud.github.io/notes/parquet-format-not-work-in-spark-structured-streaming/?utm_source=atom_feed" rel="related" type="text/html" title="parquet-format-not-work-in-spark-structured-streaming" />
                <link href="https://ohmycloud.github.io/notes/examples-for-buiding-stateful-streaming-applications-with-apache-flink/?utm_source=atom_feed" rel="related" type="text/html" title="用 Apache Flink 创建带状态的流式应用" />
            
                <id>https://ohmycloud.github.io/posts/ini-parser/</id>
            
            
                    <author>
                        <name>焉知非鱼</name>
                    </author>
            <published>2020-05-05T18:42:52+08:00</published>
            <updated>2020-05-05T18:42:52+08:00</updated>
            
            
            <content type="html"><![CDATA[<h3 id="ini-数据">INI 数据</h3>
<pre tabindex="0"><code>access=user
;; more details of user below
[person]
name=john doe
address=555 Canndy Lane
</code></pre><h3 id="grammar">Grammar</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">grammar</span> <span class="nc">IniFile</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">key</span>     <span class="p">{</span><span class="sr"> </span><span class="se">\w</span><span class="o">+</span><span class="sr"> </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">value</span>   <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">!</span><span class="ow">before</span><span class="sr"> </span><span class="se">\s</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">-</span><span class="p">[</span><span class="se">\n</span><span class="sr">;</span><span class="p">]&gt;</span><span class="o">+</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">!</span><span class="ow">after</span><span class="sr"> </span><span class="se">\s</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">pair</span>    <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">key</span><span class="p">&gt;</span><span class="sr"> </span><span class="se">\h</span><span class="o">*</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\h</span><span class="o">*</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">value</span><span class="p">&gt;</span><span class="sr"> </span><span class="se">\n</span><span class="o">+</span><span class="sr">      </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">header</span>  <span class="p">{</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">[</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">-</span><span class="p">[</span><span class="sr"> </span><span class="se">\</span><span class="sr">[ </span><span class="se">\</span><span class="sr">] </span><span class="se">\n</span><span class="sr"> </span><span class="p">]&gt;</span><span class="o">+</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">]</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\n</span><span class="o">+</span><span class="sr">       </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">comment</span> <span class="p">{</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">;</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\N</span><span class="o">*</span><span class="se">\n</span><span class="o">+</span><span class="sr">                         </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">block</span>   <span class="p">{</span><span class="sr"> </span><span class="p">[&lt;</span><span class="nf">pair</span><span class="p">&gt;</span><span class="sr"> </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">comment</span><span class="p">&gt;]</span><span class="o">*</span><span class="sr">              </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">section</span> <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">header</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">block</span><span class="p">&gt;</span><span class="sr">                   </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">TOP</span>     <span class="p">{</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">block</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">section</span><span class="p">&gt;</span><span class="o">*</span><span class="sr">                 </span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="action">Action</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">IniFile::Action</span>  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nb">key</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span>     <span class="p">{</span> <span class="k">make</span> <span class="nv">$/</span><span class="o">.</span><span class="kt">Str</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nb">value</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span>   <span class="p">{</span> <span class="k">make</span> <span class="nv">$/</span><span class="o">.</span><span class="kt">Str</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">headse</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span>  <span class="p">{</span> <span class="k">make</span> <span class="nv">$/</span><span class="o">.</span><span class="kt">Str</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nb">pair</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span>    <span class="p">{</span> <span class="k">make</span> <span class="nv">$&lt;key&gt;</span><span class="o">.</span><span class="s">made</span> <span class="o">=&gt;</span> <span class="nv">$&lt;value&gt;</span><span class="o">.</span><span class="k">made</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nb">block</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span>   <span class="p">{</span> <span class="k">make</span> <span class="nv">$&lt;pair&gt;</span><span class="o">.</span><span class="nb">map</span><span class="p">({</span> <span class="o">.</span><span class="k">made</span> <span class="p">})</span><span class="o">.</span><span class="nb">hash</span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">section</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> <span class="k">make</span> <span class="nv">$&lt;header&gt;</span><span class="o">.</span><span class="s">made</span> <span class="o">=&gt;</span> <span class="nv">$&lt;block&gt;</span><span class="o">.</span><span class="k">made</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">TOP</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">make</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s">_</span> <span class="o">=&gt;</span> <span class="nv">$&lt;block&gt;</span><span class="o">.</span><span class="k">made</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$&lt;section&gt;</span><span class="o">.</span><span class="nb">map</span><span class="o">:</span> <span class="p">{</span> <span class="o">.</span><span class="k">made</span> <span class="p">}</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="提取信息">提取信息</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">parse-ini</span><span class="p">(</span><span class="kt">Str</span> <span class="nv">$input</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$m</span> <span class="o">=</span> <span class="n">IniFile</span><span class="o">.</span><span class="nb">parse</span><span class="p">(</span> <span class="nv">$input</span><span class="o">,</span> <span class="p">:</span><span class="s">actions</span><span class="p">(</span><span class="n">IniFile::Action</span><span class="p">)</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">unless</span> <span class="nv">$m</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">die</span> <span class="p">&#34;</span><span class="s2">the input is not a valid INI file</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$m</span><span class="o">.</span><span class="k">made</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nb">MAIN</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">say</span> <span class="nf">parse-ini</span><span class="p">(</span><span class="nv">$example</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[解析天气预报数据]]></title>
            <link href="https://ohmycloud.github.io/posts/station/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmycloud.github.io/posts/trips/?utm_source=atom_feed" rel="related" type="text/html" title="" />
                <link href="https://ohmycloud.github.io/notes/save-kafka-offsets-in-spark-structured-streaming/?utm_source=atom_feed" rel="related" type="text/html" title="在 Spark Structured Streaming 中管理 Kafka Offsets" />
                <link href="https://ohmycloud.github.io/notes/parquet-format-not-work-in-spark-structured-streaming/?utm_source=atom_feed" rel="related" type="text/html" title="parquet-format-not-work-in-spark-structured-streaming" />
                <link href="https://ohmycloud.github.io/notes/examples-for-buiding-stateful-streaming-applications-with-apache-flink/?utm_source=atom_feed" rel="related" type="text/html" title="用 Apache Flink 创建带状态的流式应用" />
                <link href="https://ohmycloud.github.io/notes/why-you-might-be-misusing-spark-streaming-api/?utm_source=atom_feed" rel="related" type="text/html" title="为什么你可能会误用 Spark Streaming API" />
            
                <id>https://ohmycloud.github.io/posts/station/</id>
            
            
                    <author>
                        <name>焉知非鱼</name>
                    </author>
            <published>2020-05-05T18:25:43+08:00</published>
            <updated>2020-05-05T18:25:43+08:00</updated>
            
            
            <content type="html"><![CDATA[<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">Name= Jan Mayen 
</span></span><span class="line"><span class="cl">Country= NORWAY 
</span></span><span class="line"><span class="cl">Lat=   70.9 
</span></span><span class="line"><span class="cl">Long=    8.7 
</span></span><span class="line"><span class="cl">Height= 10 
</span></span><span class="line"><span class="cl">Start year= 1921 
</span></span><span class="line"><span class="cl">End year= 2009 
</span></span><span class="line"><span class="cl">Obs: 
</span></span><span class="line"><span class="cl">1921 -4.4 -7.1 -6.8 -4.3 -0.8  2.2  4.7  5.8  2.7 -2.0 -2.1 -4.0  
</span></span><span class="line"><span class="cl">1922 -0.9 -1.7 -6.2 -3.7 -1.6  2.9  4.8  6.3  2.7 -0.2 -3.8 -2.6  
</span></span><span class="line"><span class="cl">2008 -2.8 -2.7 -4.6 -1.8  1.1  3.3  6.1  6.9  5.8  1.2 -3.5 -0.8  
</span></span><span class="line"><span class="cl">2009 -2.3 -5.3 -3.2 -1.6  2.0  2.9  6.7  7.2  3.8  0.6 -0.3 -1.3 
</span></span></code></pre></div><h3 id="grammar">Grammar</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">grammar</span> <span class="nc">StationDataParser</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">TOP</span>          <span class="p">{</span><span class="sr"> </span><span class="ni">^</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">keyval</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">observations</span><span class="p">&gt;</span><span class="sr"> </span><span class="ni">$</span><span class="sr">             </span><span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">keyval</span>       <span class="p">{</span><span class="sr"> </span><span class="nv">$&lt;key&gt;</span><span class="o">=</span><span class="p">[&lt;</span><span class="o">-</span><span class="p">[</span><span class="sr">=</span><span class="p">]&gt;</span><span class="o">+</span><span class="p">]</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\h</span><span class="o">*</span><span class="sr"> </span><span class="nv">$&lt;val&gt;</span><span class="o">=</span><span class="p">[</span><span class="se">\N</span><span class="o">+</span><span class="p">]</span><span class="sr"> </span><span class="se">\n</span><span class="sr"> </span><span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">observations</span> <span class="p">{</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">Obs:</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\h</span><span class="o">*</span><span class="sr"> </span><span class="se">\n</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">observation</span><span class="p">&gt;</span><span class="o">+</span><span class="sr">             </span><span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">observation</span>  <span class="p">{</span><span class="sr"> </span><span class="nv">$&lt;year&gt;</span><span class="o">=</span><span class="p">[</span><span class="se">\d</span><span class="o">+</span><span class="p">]</span><span class="sr"> </span><span class="se">\h</span><span class="o">*</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">temp</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="nv">%%</span><span class="sr"> </span><span class="p">[</span><span class="se">\h</span><span class="o">*</span><span class="p">]</span><span class="sr"> </span><span class="se">\n</span><span class="sr">    </span><span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">temp</span>         <span class="p">{</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="o">?</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="sr"> </span><span class="se">\</span><span class="sr">. </span><span class="se">\d</span><span class="o">+</span><span class="sr">                          </span><span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="stationdata-对象">StationData 对象</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">StationData</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="nv">$.name</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="nv">$.country</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="nv">@.data</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">     
</span></span><span class="line"><span class="cl">    <span class="k">submethod</span> <span class="nb">BUILD</span><span class="p">(</span><span class="o">:</span><span class="nv">%info</span> <span class="p">(:</span><span class="s">Name</span><span class="p">(</span><span class="nv">$!name</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">Country</span><span class="p">(</span><span class="nv">$!country</span><span class="p">)</span><span class="o">,</span> <span class="o">*</span><span class="nv">%</span><span class="p">)</span><span class="o">,</span> <span class="o">:</span><span class="nv">@!data</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="action">Action</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">StationDataActions</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">TOP</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="k">make</span> <span class="n">StationData</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span> 
</span></span><span class="line"><span class="cl">            <span class="s">info</span> <span class="o">=&gt;</span> <span class="nv">$&lt;keyval&gt;</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="o">*.</span><span class="nb">ast</span><span class="p">)</span><span class="o">.</span><span class="nb">hash</span><span class="o">,</span> 
</span></span><span class="line"><span class="cl">            <span class="s">data</span> <span class="o">=&gt;</span> <span class="nv">$&lt;observations&gt;</span><span class="o">.</span><span class="nb">ast</span> 
</span></span><span class="line"><span class="cl">        <span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">keyval</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="k">make</span> <span class="o">~</span><span class="nv">$&lt;key&gt;</span> <span class="o">=&gt;</span> <span class="o">~</span><span class="nv">$&lt;val&gt;</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">observations</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="k">make</span> <span class="nv">$&lt;observation&gt;</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="o">*.</span><span class="nb">ast</span><span class="p">)</span><span class="o">.</span><span class="nb">grep</span><span class="p">(</span><span class="o">*.</span><span class="nb">value</span><span class="o">.</span><span class="nb">none</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">99</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">observation</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="k">make</span> <span class="o">+</span><span class="nv">$&lt;year&gt;</span> <span class="o">=&gt;</span> <span class="nv">$&lt;temp&gt;</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="o">*.</span><span class="kt">Num</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">    <span class="p">}</span> 
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="解析">解析</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="nb">say</span> <span class="n">StationDataParser</span><span class="o">.</span><span class="nb">parse</span><span class="p">(</span> <span class="k">q</span><span class="sa">:to</span><span class="p">/EOCSV/,</span><span class="s"> :actions(StationDataActions) ).ast
</span></span></span></code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
        
        <entry>
            <title type="html"><![CDATA[]]></title>
            <link href="https://ohmycloud.github.io/posts/trips/?utm_source=atom_feed" rel="alternate" type="text/html" />
            
                <link href="https://ohmycloud.github.io/notes/save-kafka-offsets-in-spark-structured-streaming/?utm_source=atom_feed" rel="related" type="text/html" title="在 Spark Structured Streaming 中管理 Kafka Offsets" />
                <link href="https://ohmycloud.github.io/notes/parquet-format-not-work-in-spark-structured-streaming/?utm_source=atom_feed" rel="related" type="text/html" title="parquet-format-not-work-in-spark-structured-streaming" />
                <link href="https://ohmycloud.github.io/notes/examples-for-buiding-stateful-streaming-applications-with-apache-flink/?utm_source=atom_feed" rel="related" type="text/html" title="用 Apache Flink 创建带状态的流式应用" />
                <link href="https://ohmycloud.github.io/notes/why-you-might-be-misusing-spark-streaming-api/?utm_source=atom_feed" rel="related" type="text/html" title="为什么你可能会误用 Spark Streaming API" />
                <link href="https://ohmycloud.github.io/notes/exploring-stateful-streaming-with-apache-spark/?utm_source=atom_feed" rel="related" type="text/html" title="探索 Apache Spark 中的状态流" />
            
                <id>https://ohmycloud.github.io/posts/trips/</id>
            
            
                    <author>
                        <name>焉知非鱼</name>
                    </author>
            <published>2020-05-05T00:00:00+00:00</published>
            <updated>2020-05-05T00:00:00+00:00</updated>
            
            
            <content type="html"><![CDATA[<h3 id="行程数据">行程数据</h3>
<pre tabindex="0"><code>Russia
    Vladivostok : 43.131621,131.923828 : 4
    Ulan Ude : 51.841624,107.608101 : 2
    Saint Petersburg : 59.939977,30.315785 : 10
Norway
    Oslo : 59.914289,10.738739 : 2
    Bergen : 60.388533,5.331856 : 4
Ukraine
    Kiev : 50.456001,30.50384 : 3
Switzerland
    Wengen : 46.608265,7.922065 : 3
    Bern : 46.949076,7.448151 : 1
</code></pre><h3 id="grammar">Grammar</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">grammar</span> <span class="nc">SalesExport</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr"> </span><span class="ni">^</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">country</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="ni">$</span><span class="sr"> }
</span></span></span><span class="line"><span class="cl"><span class="sr">    token country </span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="s">name</span><span class="p">&gt;</span> \<span class="n">n</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="s">destination</span><span class="p">&gt;</span><span class="o">+</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    token destination </span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        \<span class="k">s</span><span class="p">+</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">name</span><span class="p">&gt;</span><span class="sr"> </span><span class="se">\s</span><span class="p">+</span><span class="s2"> &#39;:&#39; \s</span><span class="p">+</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="s">lat=.num</span><span class="p">&gt;</span> <span class="p">&#39;</span><span class="s1">,</span><span class="p">&#39;</span> <span class="p">&lt;</span><span class="s">long=.num</span><span class="p">&gt;</span> \<span class="k">s</span><span class="p">+</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">:</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\s</span><span class="o">+</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">&lt;</span><span class="nv">sales</span><span class="o">=.</span><span class="nf">integer</span><span class="p">&gt;</span><span class="sr"> </span><span class="se">\n</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    }
</span></span></span><span class="line"><span class="cl"><span class="sr">    token name    </span><span class="p">{</span> \<span class="nb">w</span><span class="o">+</span> <span class="o">[</span> \<span class="k">s</span> <span class="p">\</span><span class="sr">w</span><span class="o">+</span><span class="sr"> </span><span class="p">]</span><span class="o">*</span>   <span class="p">}</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    token num     </span><span class="p">{</span> <span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="o">?</span> \<span class="nb">d</span><span class="o">+</span> <span class="o">[</span>\<span class="o">.</span>\<span class="nb">d</span><span class="o">+]?</span> <span class="p">}</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">    token integer </span><span class="p">{</span> <span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="o">?</span> \<span class="nb">d</span><span class="o">+</span>          <span class="p">}</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">}
</span></span></span></code></pre></div><h3 id="action">Action</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SalesExport::Action</span>  <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">method</span> <span class="nf">destination</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span> <span class="k">make</span> <span class="o">~</span><span class="nv">$&lt;dname&gt;</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="nv">$&lt;sales&gt;</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="o">*.</span><span class="kt">Num</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span><span class="o">,</span><span class="nv">$&lt;lat&gt;</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="o">*.</span><span class="kt">Num</span><span class="o">+</span><span class="mi">90</span><span class="p">)</span> <span class="o">]</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">country</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span>     <span class="p">{</span> <span class="k">make</span> <span class="o">~</span><span class="nv">$&lt;cname&gt;</span> <span class="o">=&gt;</span> <span class="nv">$&lt;destination&gt;</span><span class="o">&gt;&gt;.</span><span class="k">made</span>            <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">TOP</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span>         <span class="p">{</span> <span class="k">make</span> <span class="nv">$&lt;country&gt;</span><span class="o">&gt;&gt;.</span><span class="k">made</span>                             <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="提取信息">提取信息</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-perl6" data-lang="perl6"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$actions</span> <span class="o">=</span> <span class="n">SalesExport::Grammar::Actions</span><span class="o">.</span><span class="nb">new</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$grammar_action</span> <span class="o">=</span> <span class="n">SalesExport::Grammar</span><span class="o">.</span><span class="nb">parse</span><span class="p">(</span><span class="nv">$string</span><span class="o">,</span> <span class="p">:</span><span class="s">actions</span><span class="p">(</span><span class="nv">$actions</span><span class="p">))</span><span class="o">.</span><span class="k">made</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#say $grammar_action.Str;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 获取所有国家的名字</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="nv">@$grammar_action</span> <span class="k">-&gt;</span> <span class="nv">$p</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$p</span><span class="o">.</span><span class="nf">key</span><span class="p">()&#34;;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span> <span class="nb">x</span> <span class="mi">45</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 获取所有目的地</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="nv">@$grammar_action</span> <span class="k">-&gt;</span> <span class="nv">$p</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nv">$p</span><span class="o">.</span><span class="nb">value</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="nv">$d</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	    <span class="k">for</span> <span class="nv">@$d</span> <span class="k">-&gt;</span> <span class="nv">$n</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		    <span class="nb">say</span> <span class="nv">$n</span><span class="o">.</span><span class="nb">key</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span> <span class="nb">x</span> <span class="mi">45</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 获取出售的票数</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="nv">@$grammar_action</span> <span class="k">-&gt;</span> <span class="nv">$p</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span> <span class="p">&#34;</span><span class="nv">$p</span><span class="o">.</span><span class="nf">key</span><span class="p">()</span><span class="se">\t</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nv">$p</span><span class="o">.</span><span class="nb">value</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="nv">$d</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	    <span class="k">my</span> <span class="nv">$count</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	    <span class="k">for</span> <span class="nv">@$d</span> <span class="k">-&gt;</span> <span class="nv">$n</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		    <span class="nv">$count</span> <span class="o">+=</span> <span class="nv">$n</span><span class="o">.</span><span class="nb">value</span><span class="p">()</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="nb">say</span> <span class="nv">$count</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span> <span class="nb">x</span> <span class="mi">45</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 获取经度 lat</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="nv">@$grammar_action</span> <span class="k">-&gt;</span> <span class="nv">$p</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nv">$p</span><span class="o">.</span><span class="nb">value</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="nv">$d</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	    <span class="k">for</span> <span class="nv">@$d</span> <span class="k">-&gt;</span> <span class="nv">$n</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		    <span class="nb">say</span> <span class="nv">$n</span><span class="o">.</span><span class="nb">value</span><span class="p">()</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div>]]></content>
            
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/categories/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                 
                    
                         
                        
                            
                             
                                <category scheme="https://ohmycloud.github.io/tags/rakulang" term="rakulang" label="rakulang" />
                            
                        
                    
                
            
        </entry>
    
</feed>
