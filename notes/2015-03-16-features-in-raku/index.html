<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">

    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
    
    
    

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5">

    
    <meta name="referrer" content="no-referrer">

    <title>
        
            Raku 中的特性(二) ❚ 焉知非鱼
        
    </title>

    
    


    
    
    
    

    
    
    
    

    
    
    

    
    
    
    <style>
     
     
     :root {
         --theme-color: #ac4142;
         --theme-color-light: rgba(172, 65, 66, 0.2);
     }
     
     html {
         line-height: 1.5;
     }
    </style>

    
    

    
    
    
    
    <link rel="stylesheet" href="/css/refined.min.7f6d3ee611034e4ebcbc063f1db3bc042fecdc8901afbedad80ff02bae409204.css">
    
    <link rel="preload" href="/css/refined.min.7f6d3ee611034e4ebcbc063f1db3bc042fecdc8901afbedad80ff02bae409204.css" as="style">

    



    
        <style>
         
         /* Background */ .chroma { background-color: #ffffff }
/* Error */ .chroma .err { color: #a61717; background-color: #e3d2d2 }
/* LineTableTD */ .chroma .lntd { vertical-align: top; padding: 0; margin: 0; border: 0; }
/* LineTable */ .chroma .lntable { border-spacing: 0; padding: 0; margin: 0; border: 0; width: auto; overflow: auto; display: block; }
/* LineHighlight */ .chroma .hl { display: block; width: 100%;background-color: #ffffcc }
/* LineNumbersTable */ .chroma .lnt { margin-right: 0.4em; padding: 0 0.4em 0 0.4em; }
/* LineNumbers */ .chroma .ln { margin-right: 0.4em; padding: 0 0.4em 0 0.4em; }
/* Keyword */ .chroma .k { color: #000000; font-weight: bold }
/* KeywordConstant */ .chroma .kc { color: #000000; font-weight: bold }
/* KeywordDeclaration */ .chroma .kd { color: #000000; font-weight: bold }
/* KeywordNamespace */ .chroma .kn { color: #000000; font-weight: bold }
/* KeywordPseudo */ .chroma .kp { color: #000000; font-weight: bold }
/* KeywordReserved */ .chroma .kr { color: #000000; font-weight: bold }
/* KeywordType */ .chroma .kt { color: #445588; font-weight: bold }
/* NameAttribute */ .chroma .na { color: #008080 }
/* NameBuiltin */ .chroma .nb { color: #0086b3 }
/* NameBuiltinPseudo */ .chroma .bp { color: #999999 }
/* NameClass */ .chroma .nc { color: #445588; font-weight: bold }
/* NameConstant */ .chroma .no { color: #008080 }
/* NameDecorator */ .chroma .nd { color: #3c5d5d; font-weight: bold }
/* NameEntity */ .chroma .ni { color: #800080 }
/* NameException */ .chroma .ne { color: #990000; font-weight: bold }
/* NameFunction */ .chroma .nf { color: #990000; font-weight: bold }
/* NameLabel */ .chroma .nl { color: #990000; font-weight: bold }
/* NameNamespace */ .chroma .nn { color: #555555 }
/* NameTag */ .chroma .nt { color: #000080 }
/* NameVariable */ .chroma .nv { color: #008080 }
/* NameVariableClass */ .chroma .vc { color: #008080 }
/* NameVariableGlobal */ .chroma .vg { color: #008080 }
/* NameVariableInstance */ .chroma .vi { color: #008080 }
/* LiteralString */ .chroma .s { color: #dd1144 }
/* LiteralStringAffix */ .chroma .sa { color: #dd1144 }
/* LiteralStringBacktick */ .chroma .sb { color: #dd1144 }
/* LiteralStringChar */ .chroma .sc { color: #dd1144 }
/* LiteralStringDelimiter */ .chroma .dl { color: #dd1144 }
/* LiteralStringDoc */ .chroma .sd { color: #dd1144 }
/* LiteralStringDouble */ .chroma .s2 { color: #dd1144 }
/* LiteralStringEscape */ .chroma .se { color: #dd1144 }
/* LiteralStringHeredoc */ .chroma .sh { color: #dd1144 }
/* LiteralStringInterpol */ .chroma .si { color: #dd1144 }
/* LiteralStringOther */ .chroma .sx { color: #dd1144 }
/* LiteralStringRegex */ .chroma .sr { color: #009926 }
/* LiteralStringSingle */ .chroma .s1 { color: #dd1144 }
/* LiteralStringSymbol */ .chroma .ss { color: #990073 }
/* LiteralNumber */ .chroma .m { color: #009999 }
/* LiteralNumberBin */ .chroma .mb { color: #009999 }
/* LiteralNumberFloat */ .chroma .mf { color: #009999 }
/* LiteralNumberHex */ .chroma .mh { color: #009999 }
/* LiteralNumberInteger */ .chroma .mi { color: #009999 }
/* LiteralNumberIntegerLong */ .chroma .il { color: #009999 }
/* LiteralNumberOct */ .chroma .mo { color: #009999 }
/* Operator */ .chroma .o { color: #000000; font-weight: bold }
/* OperatorWord */ .chroma .ow { color: #000000; font-weight: bold }
/* Comment */ .chroma .c { color: #999988; font-style: italic }
/* CommentHashbang */ .chroma .ch { color: #999988; font-style: italic }
/* CommentMultiline */ .chroma .cm { color: #999988; font-style: italic }
/* CommentSingle */ .chroma .c1 { color: #999988; font-style: italic }
/* CommentSpecial */ .chroma .cs { color: #999999; font-weight: bold; font-style: italic }
/* CommentPreproc */ .chroma .cp { color: #999999; font-weight: bold; font-style: italic }
/* CommentPreprocFile */ .chroma .cpf { color: #999999; font-weight: bold; font-style: italic }
/* GenericDeleted */ .chroma .gd { color: #000000; background-color: #ffdddd }
/* GenericEmph */ .chroma .ge { color: #000000; font-style: italic }
/* GenericError */ .chroma .gr { color: #aa0000 }
/* GenericHeading */ .chroma .gh { color: #999999 }
/* GenericInserted */ .chroma .gi { color: #000000; background-color: #ddffdd }
/* GenericOutput */ .chroma .go { color: #888888 }
/* GenericPrompt */ .chroma .gp { color: #555555 }
/* GenericStrong */ .chroma .gs { font-weight: bold }
/* GenericSubheading */ .chroma .gu { color: #aaaaaa }
/* GenericTraceback */ .chroma .gt { color: #aa0000 }
/* GenericUnderline */ .chroma .gl { text-decoration: underline }
/* TextWhitespace */ .chroma .w { color: #bbbbbb }

         
         /* Overrides on top of the theme and Chroma CSS */
/* Chroma-based lines highlighting in code blocks */
.chroma .hl {
    background-color: #e8e8e8;
    /* Extend highlight up to 100 characters (assuming that the code blocks never have more than 100 characters in a line) */
    min-width: 100ch;
}
/* GenericHeading */ .chroma .gh { color: #999999; font-weight: bold }
/* GenericSubheading */ .chroma .gu { color: #aaaaaa; font-weight: bold }

         
        </style>
    

    

    
    
    

    
    <script src="/js/responsive-nav-orig.min.e2b5f2a956b488f466da513820636134defdc38b90ed566248960593f2bb4ba5.js"></script>
    
    <link rel="preload" href="/js/responsive-nav-orig.min.e2b5f2a956b488f466da513820636134defdc38b90ed566248960593f2bb4ba5.js" as="script">

    
    
    <script defer src="/js/libs/fa/fontawesome-all.min.08916ac0fd078adfb58edc890460e2c8990729aee02bca7586404b56805f5219.js"></script>
    
    <link rel="preload" href="/js/libs/fa/fontawesome-all.min.08916ac0fd078adfb58edc890460e2c8990729aee02bca7586404b56805f5219.js" as="script">

    

    

    
    
    

    
    
<!-- rel="me" links for IndieAuth -->







    
 
<meta property="og:title" content="Raku 中的特性(二)" />
<meta property="og:description"
      content="Features in Raku" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ohmyweekly.github.io/notes/2015-03-16-features-in-raku/" />


    
        <meta property="article:published_time" content="2021-07-10T00:00:00&#43;00:00"/>
    
    
        <meta property="article:modified_time" content="2021-07-10T00:00:00&#43;00:00"/>
    









    




     <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Raku 中的特性(二)"/>
<meta name="twitter:description" content="Features in Raku"/>


    
    
    <link rel="alternate" type="application/jf2post+json" href="https://ohmyweekly.github.io/notes/2015-03-16-features-in-raku/jf2post.json" title="Jf2post for 焉知非鱼" />
    
     



    
    
    
        
    


     
        
        <meta name="DC.Creator" content="焉知非鱼"/>
    



    
    
    
    <meta name="hugo-build-date" content="2024-03-01T16:16:06Z"/>
    <meta name="hugo-commit-hash" content="312735366b20d64bd61bff8627f593749f86c964"/>
    <meta name="generator" content="Hugo 0.123.7">
</head>


    
        <body lang="en">
    

        
        <div class="border" id="home"></div>

        <div class="wrapper">   
            
<nav id="nav" class="nav-collapse opened" aria-hidden="false">
    <ul class="navbar">
        <li><a class="" href="/">Home</a></li>
        
            
                <li><a class="" href="https://ohmyweekly.github.io/posts/">Posts</a></li>
            
        
            
                <li><a class="" href="https://ohmyweekly.github.io/notes/">Notes</a></li>
            
        
        
            <li><a class="" href="https://ohmyweekly.github.io/search/">Search</a></li>
        
    </ul>
</nav>

            <div class="container">
                <header class="masthead">
                    <div class="masthead-title no-text-decoration">
                        <a href="/">焉知非鱼</a> <span class="blinking-cursor">❚</span>
                    </div>
                    <div class="masthead-tagline">
                        Wait the light to fall
                    </div>
                </header>

                








<article class="post h-entry notes">
    <header>
        <div class="center">
    <div class="taxo no-text-decoration">
         
            
                <ul class="no-bullets inline categories">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts categorized in ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/categories/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
         
            
                <ul class="no-bullets inline tags">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts tagged with ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/tags/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
        
    </div>

</div>

        <h1 class="post-title p-name">Raku 中的特性(二)</h1>

        
        <data class="u-url" value="https://ohmyweekly.github.io/notes/2015-03-16-features-in-raku/"></data>

        <div class="date-syndication">
            


    
    
    <div class="post-date">
        
        <time datetime="2021-07-10T00:00:00+0000" class="dt-published">Sat Jul 10, 2021</time>
        
        
    </div>


            




        </div>
         



    
    
    
        
    


    
        
        <span class="hide">
            &mdash; <a href="https://ohmyweekly.github.io/" class="u-author">焉知非鱼</a>
        </span>
    


    </header>

    <div class="content">
        
    <div class="description p-summary">
        
        
        
        
        
            
            
        
        <p>Features in Raku</p>
    </div>



        





                       


        <div class="e-content">
            




<h2 id="set">Set&nbsp;<a class="headline-hash no-text-decoration" href="#set">#</a> </h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$keywords</span> <span class="o">=</span> <span class="nb">set</span> <span class="p">&lt;</span><span class="s">if for unless while</span><span class="p">&gt;;</span> <span class="c1"># create a set</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">has-keyword</span><span class="p">(</span><span class="o">*</span><span class="nv">@words</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nv">@words</span> <span class="k">-&gt;</span> <span class="nv">$word</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 依次检查数组中的元素是否属于集合 $keywords</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kt">True</span> <span class="k">if</span> <span class="nv">$word</span> <span class="ow">(elem)</span> <span class="nv">$keywords</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">False</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="n">has-keyword</span> <span class="p">&#39;</span><span class="s1">not</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">one</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">here</span><span class="p">&#39;;</span>  <span class="c1"># False</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="n">has-keyword</span> <span class="p">&#39;</span><span class="s1">but</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">here</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">for</span><span class="p">&#39;;</span>  <span class="c1"># True</span>
</span></span></code></pre></div><h2 id="series-operator">Series Operator&nbsp;<a class="headline-hash no-text-decoration" href="#series-operator">#</a> </h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">@a</span><span class="o">=</span><span class="p">&lt;</span><span class="s">A G C T</span><span class="p">&gt;;</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$x</span><span class="o">=</span><span class="nv">@a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="mi">1</span> <span class="o">...</span> <span class="o">*</span> <span class="k">-&gt;</span> <span class="nv">$a</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">  <span class="p">((</span> <span class="o">[</span><span class="ow">X</span><span class="o">~]</span> <span class="nv">$x</span> <span class="ow">xx</span> <span class="nv">$a</span> <span class="p">))</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;</span><span class="s1">,</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">last</span> <span class="k">if</span> <span class="nv">$a</span> <span class="o">==</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>倒序的 range:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">for</span> <span class="mi">10</span> <span class="o">...</span> <span class="mi">0</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="nb">say</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="flipplop">flip/plop&nbsp;<a class="headline-hash no-text-decoration" href="#flipplop">#</a> </h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$file</span> <span class="o">=</span> <span class="nb">open</span> <span class="p">&#39;</span><span class="s1">flip_flop.txt</span><span class="p">&#39;;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="nv">$file</span><span class="o">.</span><span class="nb">lines</span> <span class="k">-&gt;</span> <span class="nv">$line</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">say</span> <span class="nv">$line</span> <span class="k">if</span> <span class="o">!</span><span class="p">(</span><span class="nv">$line</span> <span class="o">~~</span> <span class="k">m</span><span class="p">/</span><span class="ni">^</span><span class="se">\</span><span class="sr">;</span><span class="p">/</span> <span class="ow">ff</span> <span class="nv">$line</span> <span class="o">~~</span> <span class="k">m</span><span class="p">/</span><span class="ni">^</span><span class="se">\</span><span class="sr">&#34;</span><span class="p">/);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><code>$line ~~ m/^\;/ ff $line ~~ m/^\&quot;/</code> 过滤掉 <code>;</code> 和 <code>&quot;</code> 之间的内容, 再对它进行取反操作就是过滤后剩下的文本。</p>
<p>flip_flop.txt 内容如下：</p>
<pre tabindex="0"><code>; next is some lines to skip,include this line
fuck fuck fuck
dam dam dam
mie mie mie
&#34; next is subject
There is more than one way to do it
                                -- Larry Wall

We hope Raku is wrote by the hole Socfilia
                                -- Larry Wall
; next is some lines to skip,include this line
fuck fuck fuck
dam dam dam
mie mie mie
&#34; next is subject
programming is hard,Let&#39;s go shopping
                               -- Larry Wall
Ruby is Another Raku
                               -- Larry Wall
</code></pre><p>输出：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">There is more than one way to do it
</span></span><span class="line"><span class="cl">                                -- Larry Wall
</span></span><span class="line"><span class="cl">We hope Raku is wrote by the hole Socfilia
</span></span><span class="line"><span class="cl">                                -- Larry Wall
</span></span><span class="line"><span class="cl">programming is hard,Let&#39;s go shopping
</span></span><span class="line"><span class="cl">                               -- Larry Wall
</span></span><span class="line"><span class="cl">Ruby is Another Raku
</span></span><span class="line"><span class="cl">                               -- Larry Wall
</span></span></code></pre></div><p><code>ff</code> 操作符左右两侧的 <code>^</code> 表示排除:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="mi">20</span> <span class="p">{</span><span class="o">.</span><span class="nb">say</span> <span class="k">if</span> <span class="nv">$_</span><span class="o">==</span><span class="mi">9</span> <span class="ow">ff</span> <span class="nv">$_</span><span class="o">==</span><span class="mi">16</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span> <span class="nb">x</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="mi">20</span> <span class="p">{</span><span class="o">.</span><span class="nb">say</span> <span class="k">if</span> <span class="nv">$_</span><span class="o">==</span><span class="mi">9</span> <span class="ow">^ff</span> <span class="nv">$_</span><span class="o">==</span><span class="mi">16</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span> <span class="nb">x</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="mi">20</span> <span class="p">{</span><span class="o">.</span><span class="nb">say</span> <span class="k">if</span> <span class="nv">$_</span><span class="o">==</span><span class="mi">9</span> <span class="ow">ff^</span> <span class="nv">$_</span><span class="o">==</span><span class="mi">16</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span> <span class="nb">x</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="mi">20</span> <span class="p">{</span><span class="o">.</span><span class="nb">say</span> <span class="k">if</span> <span class="nv">$_</span><span class="o">==</span><span class="mi">9</span> <span class="ow">^ff</span><span class="o">^</span> <span class="nv">$_</span><span class="o">==</span><span class="mi">16</span><span class="p">}</span>
</span></span></code></pre></div><p>输出:</p>
<pre tabindex="0"><code>9
10
11
12
13
14
15
16
----------
10
11
12
13
14
15
16
----------
9
10
11
12
13
14
15
----------
10
11
12
13
14
15
</code></pre><h2 id="grammars">Grammars&nbsp;<a class="headline-hash no-text-decoration" href="#grammars">#</a> </h2>
<p>解析 CSV:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl">﻿<span class="k">grammar</span> <span class="n">CSV</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr"> </span><span class="p">[</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">line</span><span class="p">&gt;</span><span class="sr"> </span><span class="se">\n</span><span class="o">?</span><span class="sr"> </span><span class="p">]</span><span class="o">+</span><span class="sr"> </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">line</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="ni">^^</span><span class="sr">            </span><span class="c1"># Beginning of a line
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">        </span><span class="p">&lt;</span><span class="nf">value</span><span class="p">&gt;</span><span class="o">*</span><span class="sr"> </span><span class="nv">%</span><span class="sr"> </span><span class="se">\</span><span class="sr">, </span><span class="c1"># Any number of &lt;value&gt;s with commas in `between` them
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">        </span><span class="ni">$$</span><span class="sr">            </span><span class="c1"># End of a line
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">value</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">[</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">-</span><span class="p">[</span><span class="sr">&#34;,</span><span class="se">\n</span><span class="p">]&gt;</span><span class="sr">     </span><span class="c1"># Anything not a double quote, comma or newline
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">quoted-text</span><span class="p">&gt;</span><span class="sr"> </span><span class="c1"># Or some quoted text
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">        </span><span class="p">]</span><span class="o">*</span><span class="sr">              </span><span class="c1"># Any number of times
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">quoted-text</span> <span class="p">{</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="se">\</span><span class="sr">&#34;
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="p">[</span><span class="sr">
</span></span></span><span class="line"><span class="cl"><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">&lt;</span><span class="o">-</span><span class="p">[</span><span class="sr">&#34;</span><span class="se">\</span><span class="sr">\</span><span class="p">]&gt;</span><span class="sr"> </span><span class="c1"># Anything not a &#34; or \
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">        </span><span class="o">|</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">\&#34;</span><span class="p">&#39;</span><span class="sr">     </span><span class="c1"># Or \&#34;, an escaped quotation mark
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">        </span><span class="p">]</span><span class="o">*</span><span class="sr">         </span><span class="c1"># Any number of times
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="sr">        </span><span class="se">\</span><span class="sr">&#34;
</span></span></span><span class="line"><span class="cl"><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1"># method parse($str, :$rule = &#39;TOP&#39;, :$actions) returns Match:D</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Valid CSV file!</span><span class="p">&#34;</span> <span class="k">if</span> <span class="n">CSV</span><span class="o">.</span><span class="nb">parse</span><span class="p">(</span> <span class="k">q</span><span class="sa">:to</span><span class="p">/EOCSV/ </span><span class="s">);
</span></span></span><span class="line"><span class="cl"><span class="s">    Year,Make,Model,Length
</span></span></span><span class="line"><span class="cl"><span class="s">    1997,Ford,E350,2.34
</span></span></span><span class="line"><span class="cl"><span class="s">    2000,Mercury,Cougar,2.38
</span></span></span><span class="line"><span class="cl"><span class="s">    </span><span class="p">EOCSV</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="n">CSV</span><span class="o">.</span><span class="nb">parse</span><span class="p">(</span> <span class="k">q</span><span class="sa">:to</span><span class="p">/EOCSV/,</span><span class="s"> &#39;line&#39;, :$actions );
</span></span></span><span class="line"><span class="cl"><span class="s">    Year,Make,Model,Length
</span></span></span><span class="line"><span class="cl"><span class="s">    1997,Ford,E350,2.34
</span></span></span><span class="line"><span class="cl"><span class="s">    2000,Mercury,Cougar,2.38
</span></span></span><span class="line"><span class="cl"><span class="s">    </span><span class="p">EOCSV</span>
</span></span></code></pre></div><p>解析天气数据:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">grammar</span> <span class="nc">StationDataParser</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">TOP</span>          <span class="p">{</span><span class="sr"> </span><span class="ni">^</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">keyval</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">observations</span><span class="p">&gt;</span><span class="sr"> </span><span class="ni">$</span><span class="sr">             </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">keyval</span>       <span class="p">{</span><span class="sr"> </span><span class="nv">$&lt;key&gt;</span><span class="o">=</span><span class="p">[&lt;</span><span class="o">-</span><span class="p">[</span><span class="sr">=</span><span class="p">]&gt;</span><span class="o">+</span><span class="p">]</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">=</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\h</span><span class="o">*</span><span class="sr"> </span><span class="nv">$&lt;val&gt;</span><span class="o">=</span><span class="p">[</span><span class="se">\N</span><span class="o">+</span><span class="p">]</span><span class="sr"> </span><span class="se">\n</span><span class="sr"> </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">observations</span> <span class="p">{</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">Obs:</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\h</span><span class="o">*</span><span class="sr"> </span><span class="se">\n</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">observation</span><span class="p">&gt;</span><span class="o">+</span><span class="sr">             </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">observation</span>  <span class="p">{</span><span class="sr"> </span><span class="nv">$&lt;year&gt;</span><span class="o">=</span><span class="p">[</span><span class="se">\d</span><span class="o">+</span><span class="p">]</span><span class="sr"> </span><span class="se">\h</span><span class="o">*</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">temp</span><span class="p">&gt;</span><span class="o">+</span><span class="sr"> </span><span class="nv">%%</span><span class="sr"> </span><span class="p">[</span><span class="se">\h</span><span class="o">*</span><span class="p">]</span><span class="sr"> </span><span class="se">\n</span><span class="sr">    </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">token</span> <span class="nf">temp</span>         <span class="p">{</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span><span class="o">?</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="sr"> </span><span class="se">\</span><span class="sr">. </span><span class="se">\d</span><span class="o">+</span><span class="sr">                          </span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">StationData</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="nv">$.name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="nv">$.country</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="nv">@.data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">submethod</span> <span class="nb">BUILD</span><span class="p">(</span><span class="o">:</span><span class="nv">%info</span> <span class="p">(:</span><span class="s">Name</span><span class="p">(</span><span class="nv">$!name</span><span class="p">)</span><span class="o">,</span> <span class="p">:</span><span class="s">Country</span><span class="p">(</span><span class="nv">$!country</span><span class="p">)</span><span class="o">,</span> <span class="o">*</span><span class="nv">%</span><span class="p">)</span><span class="o">,</span> <span class="o">:</span><span class="nv">@!data</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">StationDataActions</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">TOP</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">make</span> <span class="n">StationData</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="s">info</span> <span class="o">=&gt;</span> <span class="nv">$&lt;keyval&gt;</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="o">*.</span><span class="nb">ast</span><span class="p">)</span><span class="o">.</span><span class="nb">hash</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">            <span class="s">data</span> <span class="o">=&gt;</span> <span class="nv">$&lt;observations&gt;</span><span class="o">.</span><span class="nb">ast</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">keyval</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">make</span> <span class="o">~</span><span class="nv">$&lt;key&gt;</span> <span class="o">=&gt;</span> <span class="o">~</span><span class="nv">$&lt;val&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">observations</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">make</span> <span class="nv">$&lt;observation&gt;</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="o">*.</span><span class="nb">ast</span><span class="p">)</span><span class="o">.</span><span class="nb">grep</span><span class="p">(</span><span class="o">*.</span><span class="nb">value</span><span class="o">.</span><span class="nb">none</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">99</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">observation</span><span class="p">(</span><span class="nv">$/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">make</span> <span class="o">+</span><span class="nv">$&lt;year&gt;</span> <span class="o">=&gt;</span> <span class="nv">$&lt;temp&gt;</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="o">*.</span><span class="kt">Num</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="n">StationDataParser</span><span class="o">.</span><span class="nb">parse</span><span class="p">(</span> <span class="k">q</span><span class="sa">:to</span><span class="p">/EOCSV/,</span><span class="s"> :actions(StationDataActions)).ast
</span></span></span><span class="line"><span class="cl"><span class="s">Name= Jan Mayen
</span></span></span><span class="line"><span class="cl"><span class="s">Country= NORWAY
</span></span></span><span class="line"><span class="cl"><span class="s">Lat=   70.9
</span></span></span><span class="line"><span class="cl"><span class="s">Long=    8.7
</span></span></span><span class="line"><span class="cl"><span class="s">Height= 10
</span></span></span><span class="line"><span class="cl"><span class="s">Start year= 1921
</span></span></span><span class="line"><span class="cl"><span class="s">End year= 2009
</span></span></span><span class="line"><span class="cl"><span class="s">Obs:
</span></span></span><span class="line"><span class="cl"><span class="s">1921 -4.4 -7.1 -6.8 -4.3 -0.8  2.2  4.7  5.8  2.7 -2.0 -2.1 -4.0  
</span></span></span><span class="line"><span class="cl"><span class="s">1922 -0.9 -1.7 -6.2 -3.7 -1.6  2.9  4.8  6.3  2.7 -0.2 -3.8 -2.6  
</span></span></span><span class="line"><span class="cl"><span class="s">2008 -2.8 -2.7 -4.6 -1.8  1.1  3.3  6.1  6.9  5.8  1.2 -3.5 -0.8  
</span></span></span><span class="line"><span class="cl"><span class="s">2009 -2.3 -5.3 -3.2 -1.6  2.0  2.9  6.7  7.2  3.8  0.6 -0.3 -1.3
</span></span></span><span class="line"><span class="cl"><span class="s"></span><span class="p">EOCSV</span>
</span></span></code></pre></div><h2 id="raku-examples">Raku Examples&nbsp;<a class="headline-hash no-text-decoration" href="#raku-examples">#</a> </h2>
<ul>
<li>1、生成8位随机密码</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">my</span>  <span class="nv">@char_set</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">9</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">z</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">A</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">Z</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">~</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">!</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">@</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">#</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">$</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">%</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">^</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">&amp;</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">*</span><span class="p">&#39;);</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nv">@char_set</span><span class="o">.</span><span class="nb">pick</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#34;&#34;)</span> <span class="c1"># 不重复的8位密码</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nv">@char_set</span><span class="o">.</span><span class="nb">roll</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#34;&#34;)</span> <span class="c1"># 可以重复</span>
</span></span></code></pre></div><ul>
<li>2、打印前5个数字</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="o">[^</span><span class="mi">5</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span> <span class="o">...</span> <span class="o">[^</span><span class="mi">10</span><span class="o">]</span>  <span class="c1"># 这个会无限循环</span>
</span></span></code></pre></div><ul>
<li>
<p>3、排序</p>
</li>
<li>
<p>3.1 按数值排序</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">%hash</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">Perl</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">           <span class="p">&#39;</span><span class="s1">Python</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">           <span class="p">&#39;</span><span class="s1">Go</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">           <span class="p">&#39;</span><span class="s1">CMD</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">20</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">           <span class="p">&#39;</span><span class="s1">Php</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">80</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">           <span class="p">&#39;</span><span class="s1">Java</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">85</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">%hash</span><span class="o">.</span><span class="nb">values</span><span class="o">.</span><span class="nb">sort</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">%hash</span><span class="o">.</span><span class="nb">values</span><span class="o">.</span><span class="nb">sort</span><span class="p">(</span><span class="o">-*</span><span class="p">);</span>
</span></span></code></pre></div><ul>
<li>3.2 按分数排序散列：</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">%hash</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">Perl</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">80</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">         <span class="p">&#39;</span><span class="s1">Python</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">             <span class="p">&#39;</span><span class="s1">Go</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">95</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">&#39;</span><span class="s1">CMD</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">20</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">&#39;</span><span class="s1">Php</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">80</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">           <span class="p">&#39;</span><span class="s1">Java</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="mi">85</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="nv">%hash</span><span class="o">.</span><span class="nb">sort</span><span class="p">({</span><span class="o">-.</span><span class="nb">value</span><span class="p">})</span><span class="o">.</span><span class="nb">hash</span><span class="o">.</span><span class="nb">keys</span> <span class="k">-&gt;</span> <span class="nv">$key</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">say</span> <span class="nv">$key</span><span class="o">,</span> <span class="p">&#34;</span><span class="se">\t</span><span class="p">&#34;</span><span class="o">,</span> <span class="nv">%hash</span><span class="p">{&#34;</span><span class="nv">$key</span><span class="p">&#34;}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>输出:</p>
<pre tabindex="0"><code>Python	100
Go	95
Java	85
Perl	80
Php	80
CMD	20
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="p">(&#39;</span><span class="s1">xx</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">zz</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">classify</span><span class="p">(</span><span class="o">*.</span><span class="nb">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">))&lt;</span><span class="s">z</span><span class="p">&gt;;</span> <span class="c1"># xz yz zz</span>
</span></span></code></pre></div><p>加密：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">rot13</span> <span class="p">{</span> <span class="nv">$^s</span><span class="o">.</span><span class="nb">trans</span><span class="p">(&#39;</span><span class="s1">a..z</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">n..za..m</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">A..Z</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">N..ZA..M</span><span class="p">&#39;)</span> <span class="p">}</span>
</span></span></code></pre></div><ul>
<li>4、求 1! + 2! + 3! + 4! +5! + 6! +7! +8! +9! +10!</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">multi</span> <span class="k">sub</span> <span class="nb">postfix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">!</span><span class="p">&gt;(</span><span class="kt">Int</span> <span class="nv">$x</span><span class="p">){</span> <span class="o">[*]</span> <span class="mi">1</span><span class="o">..</span><span class="nv">$x</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="o">[+]</span> <span class="mi">1</span><span class="o">!,</span><span class="mi">2</span><span class="o">!,</span><span class="mi">3</span><span class="o">!,</span><span class="mi">4</span><span class="o">!,</span><span class="mi">5</span><span class="o">!,</span><span class="mi">6</span><span class="o">!,</span><span class="mi">7</span><span class="o">!,</span><span class="mi">8</span><span class="o">!,</span><span class="mi">9</span><span class="o">!,</span><span class="mi">10</span><span class="o">!</span> <span class="c1"># 4037913</span>
</span></span></code></pre></div><ul>
<li>5、列出对象所有可用的方法</li>
</ul>
<p>使用元对象协议， 即 <code>对象名.^methods</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="o">&gt;</span> <span class="p">&#34;</span><span class="s2">JZY</span><span class="p">&#34;</span><span class="o">.^</span><span class="nb">methods</span>
</span></span></code></pre></div><blockquote>
<p>BUILD Int Num chomp chop substr pred succ match ords lines samecase samespace tr
im-leading trim-trailing trim words encode wordcase trans indent codes path WHIC
H Bool Str Stringy DUMP ACCEPTS Numeric gist perl comb subst split</p>
</blockquote>
<ul>
<li>6、 匿名子例程</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$x</span> <span class="o">=</span> <span class="k">sub</span><span class="p">(</span><span class="nv">$a</span><span class="p">){</span> <span class="nv">$a</span><span class="o">+</span><span class="mi">2</span> <span class="p">};</span><span class="nb">say</span> <span class="nv">$x</span><span class="p">(</span><span class="nv">$_</span><span class="p">)</span> <span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$x</span> <span class="o">=</span> <span class="k">-&gt;</span> <span class="nv">$a</span> <span class="p">{</span> <span class="nv">$a</span><span class="o">+</span><span class="mi">2</span> <span class="p">};</span><span class="nb">say</span> <span class="nv">$x</span><span class="p">(</span><span class="nv">$_</span><span class="p">)</span> <span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="mi">4</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$x</span> <span class="o">=</span> <span class="o">*</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span><span class="nb">say</span> <span class="nv">$x</span><span class="p">(</span><span class="nv">$_</span><span class="p">)</span> <span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="mi">4</span>
</span></span></code></pre></div><ul>
<li>7、字符串翻转与分割</li>
</ul>
<pre tabindex="0"><code>&gt; 1223.flip
3221
&gt; &#39;abcd&#39;.flip
dcba
&gt; 1234.comb
1 2 3 4
&gt; 1234.comb(/./)
1 2 3 4
&gt; &#39;abcd&#39;.comb
a b c d
</code></pre><ul>
<li>8、有这么一个四位数 A，其个位数相加得到 B，将 B 乘以 B 的反转数后得到 A，请求出这个数字。</li>
</ul>
<p>举例， 1458 就符合这个条件，1+4+5+8 ＝ 18， 18 ＊ 81 ＝1458</p>
<p>请找出另一个符合上面条件的四位数。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="p">(</span><span class="o">^</span><span class="mi">37</span><span class="p">)</span><span class="o">.</span><span class="nb">map</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">my</span> <span class="nv">$r</span> <span class="o">=</span> <span class="nv">$_</span> <span class="o">*</span> <span class="o">.</span><span class="nb">flip</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="mi">1000</span> <span class="o">&lt;</span> <span class="nv">$r</span> <span class="ow">and</span> <span class="nv">$_</span> <span class="o">==</span> <span class="o">[+]</span> <span class="nv">$r</span><span class="o">.</span><span class="nb">comb</span> <span class="ow">and</span> <span class="nb">say</span> <span class="nv">$r</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p><code>^37</code> 产生一个范围  0 .. ^37, 就是 0到36之前的数，在表达式中代表 B</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="mi">1000</span><span class="o">..^</span><span class="mi">10000</span> <span class="k">-&gt;</span> <span class="nv">$i</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nv">$b</span><span class="o">=[+]</span> <span class="nv">$i</span><span class="o">.</span><span class="nb">comb</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">say</span> <span class="nv">$i</span> <span class="k">if</span> <span class="nv">$b</span><span class="o">*</span><span class="nv">$b</span><span class="o">.</span><span class="nb">flip</span> <span class="o">==</span> <span class="nv">$i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>输出:</p>
<pre tabindex="0"><code>1458
1729
</code></pre><ul>
<li>9、 大小写转换</li>
</ul>
<pre tabindex="0"><code>&gt; my $word= &#34;I Love Raku&#34;
I Love Raku
&gt; $word.wordcase()
I Love Raku
&gt; my $lowercase = &#34;i love perl 6&#34;
i love perl 6
&gt; $lowercase.wordcase()
I Love Raku
&gt; $word.samecase(&#39;A&#39;)
I LOVE PERL 6
&gt; $word.samecase(&#39;a&#39;)
i love perl 6
&gt; $word.samecase(&#39;a&#39;).wordcase()
I Love Raku
</code></pre><ul>
<li>10、 多行文本</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$string</span> <span class="o">=</span> <span class="k">q</span><span class="sa">:to</span><span class="p">/THE END/;</span><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">Norway
</span></span></span><span class="line"><span class="cl"><span class="s">    Oslo : 59.914289,10.738739 : 2
</span></span></span><span class="line"><span class="cl"><span class="s">    Bergen : 60.388533,5.331856 : 4
</span></span></span><span class="line"><span class="cl"><span class="s">Ukraine
</span></span></span><span class="line"><span class="cl"><span class="s">    Kiev : 50.456001,30.50384 : 3
</span></span></span><span class="line"><span class="cl"><span class="s">Switzerland
</span></span></span><span class="line"><span class="cl"><span class="s">    Wengen : 46.608265,7.922065 : 3
</span></span></span><span class="line"><span class="cl"><span class="s"></span><span class="p">THE END</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nv">$string</span><span class="p">;</span>
</span></span></code></pre></div><ul>
<li>11、 超运算符与子例程</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">@a</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">1 2 3 4</span><span class="p">&gt;;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">by2</span><span class="p">(</span><span class="nv">$n</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="nv">$n</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">power2</span><span class="p">(</span><span class="nv">$n</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$n</span> <span class="o">**</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">@b</span> <span class="o">=</span> <span class="nv">@a</span><span class="o">».&amp;</span><span class="nf">by2</span><span class="o">».&amp;</span><span class="nf">power2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nv">@b</span><span class="p">;</span> <span class="c1"># 4 16 36 64</span>
</span></span></code></pre></div><p>为什么是 <code>&amp;function</code> 呢：</p>
<blockquote>
<p>the name of the by2 function is &amp;by2, just as the name of the foo scalar is $foo and the name of the foo array is @foo</p>
</blockquote>
<ul>
<li>12、 如何在 Raku 中执行外部命令并捕获输出</li>
</ul>
<pre tabindex="0"><code>&gt; my $res = qqx{mkdir 123456}

# 或使用 qx{ }
&gt; my $res = qx{mkdir 112233}
</code></pre><ul>
<li>13、Does Raku support something equivalent to Perl5&rsquo;s <strong>DATA</strong> and <strong>END</strong> sections?</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="n">=foo</span><span class="sd"> This is a Pod block. A single line one. This Pod block&#39;s name is &#39;foo&#39;.
</span></span></span><span class="line"><span class="cl"><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd"></span><span class="k">=begin</span><span class="sd"> </span><span class="k">qux</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">This is another syntax for defining a Pod block.
</span></span></span><span class="line"><span class="cl"><span class="sd">It allows for multi line content.
</span></span></span><span class="line"><span class="cl"><span class="sd">This block&#39;s name is &#39;qux&#39;.
</span></span></span><span class="line"><span class="cl"><span class="sd"></span><span class="k">=end qux</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">=data</span><span class="sd"> A data block -- a Pod block with the name &#39;data&#39;.
</span></span></span><span class="line"><span class="cl"><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd"></span><span class="c1"># Data blocks are P6&#39;s version of P5&#39;s __DATA__.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># But you can have multiple data blocks:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">=begin</span><span class="sd"> </span><span class="k">data</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">Another data block.
</span></span></span><span class="line"><span class="cl"><span class="sd">This time a multi line one.
</span></span></span><span class="line"><span class="cl"><span class="sd"></span><span class="k">=end data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$=pod</span><span class="o">.</span><span class="nb">grep</span><span class="p">(</span><span class="o">*.</span><span class="nb">name</span> <span class="ow">eq</span> <span class="p">&#39;</span><span class="s1">data</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="o">*.</span><span class="nb">contents</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="nb">contents</span><span class="o">.</span><span class="nb">say</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="p">&#39;</span><span class="s1">-</span><span class="p">&#39;</span> <span class="nb">x</span> <span class="mi">45</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="nv">@$=pod</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">.</span><span class="nb">name</span> <span class="ow">eq</span> <span class="p">&#39;</span><span class="s1">data</span><span class="p">&#39;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">say</span> <span class="o">.</span><span class="nb">contents</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="nb">contents</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li>14、生成含有26个英文字母和下划线的 junction</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="nb">any</span><span class="p">(&#39;</span><span class="s1">A</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">Z</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">z</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">_</span><span class="p">&#39;);</span>
</span></span></code></pre></div><ul>
<li>15、判断一个字符是否在某个集合中</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="o">&gt;</span>  <span class="nb">so</span> <span class="nb">any</span><span class="p">(&#39;</span><span class="s1">A</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">Z</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">..</span><span class="p">&#39;</span><span class="s1">z</span><span class="p">&#39;)</span> <span class="o">∈</span> <span class="nb">set</span><span class="p">(&#34;</span><span class="s2">12a34</span><span class="p">&#34;</span><span class="o">.</span><span class="nb">comb</span><span class="p">)</span>
</span></span></code></pre></div><p>&ldquo;12a34&rdquo;.comb 会把字符串分割为单个字符，返回一个字符数组。</p>
<ul>
<li>16、生成 IP 地址范围</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="p">&#34;</span><span class="s2">192.168.10.</span><span class="p">&#34;</span> <span class="p">«</span><span class="s2">~</span><span class="p">»</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="nb">list</span>
</span></span></code></pre></div><ul>
<li>17、 生成 OC 中的测试数组</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="p">&#34;</span><span class="s2">@</span><span class="p">&#34;</span> <span class="p">«</span><span class="s2">~</span><span class="p">»</span> <span class="p">&#39;</span><span class="s1">&#34;Perl</span><span class="p">&#39;</span> <span class="p">«</span><span class="s2">~</span><span class="p">»</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">30</span><span class="p">)</span><span class="o">.</span><span class="nb">list</span> <span class="p">«</span><span class="s2">~</span><span class="p">»</span> <span class="p">&#39;</span><span class="s1">&#34;,</span><span class="p">&#39;</span>
</span></span></code></pre></div><pre><code>@&quot;Perl&quot;1&quot;,
@&quot;Perl&quot;2&quot;,
@&quot;Perl&quot;3&quot;,
@&quot;Perl&quot;4&quot;,
@&quot;Perl&quot;5&quot;,
…
</code></pre>
<ul>
<li>18、我想以 AGCT 4 种字母为基础生成字符串。</li>
</ul>
<p>比如希望长度为1，输出A,G,C,T。</p>
<p>如果长度为2，输出 AA,AG,AC,AT,GA,GG,GC,GT,CA,CG,CC,CT,TA,TG,TC,TT。这样的结果。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="nv">@a</span> <span class="ow">X</span><span class="o">~</span> <span class="p">&#34;&#34;</span>             <span class="c1"># 长度为1</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">@a</span> <span class="ow">X</span><span class="o">~</span> <span class="nv">@a</span><span class="p">)</span>           <span class="c1"># 长度为2</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="nv">@a</span> <span class="ow">X</span><span class="o">~</span> <span class="nv">@a</span><span class="p">)</span> <span class="ow">X</span><span class="o">~</span> <span class="nv">@a</span>     <span class="c1"># 长度为3</span>
</span></span><span class="line"><span class="cl"><span class="nv">@a</span> <span class="ow">X</span><span class="o">~</span> <span class="nv">@a</span> <span class="ow">X</span><span class="o">~</span> <span class="nv">@a</span> <span class="ow">X</span><span class="o">~</span> <span class="nv">@a</span> <span class="c1"># 长度为4</span>
</span></span></code></pre></div><pre tabindex="0"><code>&gt; my @a=&lt;A G C T&gt;
A G C T
&gt; my $x=@a
A G C T
&gt; $x xx 2
A G C T A G C T
&gt; $x xx 3
A G C T A G C T A G C T
&gt; ($x xx 3).WHAT
(List)
&gt; $x.WHAT
(Array)

&gt; ([X~] $x xx 2).join(&#39;,&#39;)
AA,AG,AC,AT,GA,GG,GC,GT,CA,CG,CC,CT,TA,TG,TC,TT
</code></pre><p>惰性操作符：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">@a</span><span class="o">=</span><span class="p">&lt;</span><span class="s">A G C T</span><span class="p">&gt;;</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$x</span><span class="o">=</span><span class="nv">@a</span><span class="p">;</span>  <span class="c1"># 或者使用 $x = @(&#39;A&#39;,&#39;G&#39;,&#39;C&#39;,&#39;T&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="mi">1</span> <span class="o">...^</span> <span class="o">*</span> <span class="k">-&gt;</span> <span class="nv">$a</span> <span class="p">{((</span><span class="o">[</span><span class="ow">X</span><span class="o">~]</span> <span class="nv">$x</span> <span class="ow">xx</span> <span class="nv">$a</span><span class="p">))</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;</span><span class="s1">,</span><span class="p">&#39;)</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span><span class="nb">last</span> <span class="k">if</span> <span class="nv">$a</span><span class="o">==</span><span class="mi">4</span><span class="p">;};</span>
</span></span></code></pre></div><h2 id="best-of-raku">Best Of Raku&nbsp;<a class="headline-hash no-text-decoration" href="#best-of-raku">#</a> </h2>
<ul>
<li>Command Line 命令行</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"> <span class="c1">#               Perl 5                                     Raku</span>
</span></span><span class="line"><span class="cl"> <span class="nb">print</span> <span class="p">&#34;</span><span class="s2">bananas are good</span><span class="se">\n</span><span class="p">&#34;;</span>                     <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">bananas are good</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl"> <span class="nb">print</span> <span class="p">&#34;</span><span class="s2">and I said: </span><span class="nv">$quotes</span><span class="p">{</span>\&#34;<span class="n">me</span>\&#34;<span class="p">}</span><span class="se">\n</span><span class="p">&#34;;</span>          <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">and I said: </span><span class="nv">%quotes</span><span class="p">{&#34;</span><span class="s2">me</span><span class="p">&#34;}</span><span class="s2">.</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl"> <span class="nb">print</span> <span class="p">&#34;</span><span class="s2">and I said: </span><span class="nv">$quotes</span><span class="p">{</span>\&#34;<span class="n">me</span>\&#34;<span class="p">}</span><span class="se">\n</span><span class="p">&#34;;</span>          <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">and I said: </span><span class="nv">%quotes</span><span class="s2">&lt;me&gt;.</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl"> <span class="nb">print</span> <span class="p">&#34;</span><span class="s2">What is ... </span><span class="p">&#34;;</span>                           <span class="nv">$result</span> <span class="o">=</span> <span class="nb">prompt</span> <span class="p">&#34;</span><span class="s2">What is ... </span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl"> <span class="nb">chomp</span><span class="p">(</span><span class="nv">$result</span> <span class="o">=</span> <span class="o">&lt;&gt;</span><span class="p">);</span>
</span></span></code></pre></div><ul>
<li>File IO</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"> <span class="c1">#              Perl 5                                     Raku</span>
</span></span><span class="line"><span class="cl"> <span class="nv">$content</span> <span class="o">=</span> <span class="nb">do</span> <span class="p">{</span> <span class="nb">local</span> <span class="nv">$/</span><span class="p">;</span>                       <span class="nv">$content</span> <span class="o">=</span> <span class="nb">slurp</span> <span class="p">&#34;</span><span class="s2">poetry.txt</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">open</span> <span class="k">my</span> <span class="nv">$FH</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">poetry.txt</span><span class="p">&#34;;</span> <span class="p">&lt;</span><span class="s">$FH</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"> <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">chomp</span><span class="p">(</span><span class="nv">@content</span> <span class="o">=</span> <span class="nb">do</span> <span class="p">{</span>                            <span class="nv">@content</span> <span class="o">=</span> <span class="nb">lines</span> <span class="p">&#34;</span><span class="s2">poetry.txt</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">open</span> <span class="k">my</span> <span class="nv">$FH</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">poetry.txt</span><span class="p">&#34;;</span> <span class="p">&lt;</span><span class="s">$FH</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></div><ul>
<li>Automatic multithreading</li>
</ul>
<p>Applying operations to junctions and arrays is now syntactically compact and readable.
Raku will create threads where appropriate to use multiple processors, cores or hyperthreading for high level language SIMD concurrent processing.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"> <span class="c1">#              Perl 5                                     Raku</span>
</span></span><span class="line"><span class="cl"> <span class="k">my</span> <span class="nv">$sum</span><span class="p">;</span>                                        <span class="k">my</span> <span class="nv">$sum</span> <span class="o">=</span> <span class="o">[+]</span> <span class="nv">@numbers</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="nv">$sum</span> <span class="o">+=</span> <span class="nv">$_</span> <span class="k">for</span> <span class="nv">@numbers</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="k">for</span> <span class="p">(</span><span class="mi">0</span> <span class="o">..</span> <span class="nv">$</span><span class="c1">#factor1) {                          @product = @factor1 &gt;&gt;*&lt;&lt; @factor2;</span>
</span></span><span class="line"><span class="cl">   <span class="nv">$product</span><span class="o">[</span><span class="nv">$</span><span class="o">]</span> <span class="o">=</span> <span class="nv">$factor1</span><span class="o">[</span><span class="nv">$</span><span class="o">]</span> <span class="o">*</span> <span class="nv">$factor2</span><span class="o">[</span><span class="nv">$_</span><span class="o">]</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span></code></pre></div><p>The Perl 5 code is a simplification, of course Raku &ldquo;does the right thing&rdquo; when the arrays have different lengths.</p>
<ul>
<li>比较</li>
</ul>
<p>Here are junctions, then chained comparison operators.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"> <span class="c1">#            Perl 5                                     Raku</span>
</span></span><span class="line"><span class="cl"> <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">or</span> <span class="nv">$a</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">or</span> <span class="nv">$a</span> <span class="o">==</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>        <span class="k">if</span> <span class="nv">$a</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">|</span> <span class="mi">4</span> <span class="o">|</span> <span class="mi">7</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="k">if</span> <span class="p">(</span><span class="mi">4</span> <span class="o">&lt;</span> <span class="nv">$a</span> <span class="ow">and</span> <span class="nv">$a</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">)</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>                   <span class="k">if</span> <span class="mi">4</span> <span class="o">&lt;</span> <span class="nv">$a</span> <span class="o">&lt;</span> <span class="mi">12</span>    <span class="p">{</span><span class="o">...</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="k">if</span> <span class="p">(</span><span class="mi">4</span> <span class="o">&lt;</span> <span class="nv">$a</span> <span class="ow">and</span> <span class="nv">$a</span> <span class="o">&lt;=</span> <span class="mi">12</span><span class="p">)</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>                  <span class="k">if</span> <span class="nv">$a</span> <span class="o">~~</span> <span class="mi">4</span><span class="o">^..</span><span class="mi">12</span>   <span class="p">{</span><span class="o">...</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="nv">$a</span> <span class="o">=</span> <span class="nb">defined</span> <span class="nv">$b</span> <span class="o">?</span> <span class="nv">$b</span> <span class="o">:</span> <span class="nv">$c</span><span class="p">;</span>                      <span class="nv">$a</span> <span class="o">=</span> <span class="nv">$b</span> <span class="o">//</span> <span class="nv">$c</span><span class="p">;</span>
</span></span></code></pre></div><p>The defined-OR operator eases lot of cases where Perl 5 newbies could fall into traps.</p>
<ul>
<li>Case 结构</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl">  <span class="c1">#            Perl 5                                      Raku</span>
</span></span><span class="line"><span class="cl">                                                     <span class="k">given</span> <span class="nv">$a</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"> <span class="k">if</span> <span class="p">(</span><span class="nv">$a</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="nv">$a</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span> <span class="p">}}</span><span class="err">                      when 2 | 5  {...}
</span></span></span><span class="line"><span class="cl"><span class="err"> elsif ($a == 6 or $a == 7 or $a == 8 or $a == 9) {}   when 6 .. 9 {...}
</span></span></span><span class="line"><span class="cl"><span class="err"> elsif ($a =~ /g/) {...}                               when &#39;g&#39;    {...}
</span></span></span><span class="line"><span class="cl"><span class="err"> else {...}                                            default     {...}
</span></span></span><span class="line"><span class="cl"><span class="err">                                                     }
</span></span></span></code></pre></div><p>That new construct (backported to 5.10) is clear to read, very versatile and when used in combination with junctions, becomes even clearer.</p>
<ul>
<li>强大的循环</li>
</ul>
<p>List iteration via for is now much more versatile.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"> <span class="c1">#            Perl 5                                     Raku</span>
</span></span><span class="line"><span class="cl"> <span class="k">for</span> <span class="k">my</span> <span class="nv">$i</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="mi">15</span><span class="p">)</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>                         <span class="k">for</span> <span class="o">^</span><span class="mi">16</span> <span class="k">-&gt;</span> <span class="nv">$i</span>        <span class="p">{</span><span class="o">...</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="k">for</span> <span class="p">(</span><span class="k">my</span> <span class="nv">$i</span><span class="o">=</span><span class="mi">15</span><span class="p">;</span> <span class="nv">$i</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">;</span> <span class="nv">$i-2</span><span class="p">)</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>                <span class="k">for</span> <span class="mi">15</span><span class="o">,*-</span><span class="mi">2</span><span class="o">...</span><span class="mi">1</span> <span class="k">-&gt;</span> <span class="nv">$i</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="k">for</span> <span class="k">my</span> <span class="nv">$key</span> <span class="p">(</span><span class="nb">keys</span> <span class="nv">%hash</span><span class="p">)</span> <span class="p">{</span>                      <span class="k">for</span> <span class="nv">%hash</span><span class="o">.</span><span class="nb">kv</span> <span class="k">-&gt;</span> <span class="nv">$key</span><span class="o">,</span> <span class="nv">$value</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nb">print</span> <span class="p">&#34;</span><span class="nv">$key</span><span class="s2"> =&gt; </span><span class="nv">$hash</span><span class="p">{</span><span class="nv">$key</span><span class="p">}</span><span class="se">\n</span><span class="p">&#34;;</span> <span class="o">...</span>              <span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$key</span><span class="s2"> =&gt; </span><span class="nv">$value</span><span class="p">&#34;;</span> <span class="o">...</span>
</span></span><span class="line"><span class="cl"> <span class="k">for</span> <span class="k">my</span> <span class="nv">$i</span> <span class="p">(</span><span class="mi">0</span><span class="o">..</span><span class="nv">$</span><span class="c1">#a) {                            for zip(@a; @b; @c) -&gt; $a, $b, $c {...}</span>
</span></span><span class="line"><span class="cl">   <span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="nv">@a</span><span class="o">[</span><span class="nv">$i</span><span class="o">]</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="k">my</span> <span class="nv">$b</span> <span class="o">=</span> <span class="nv">@b</span><span class="o">[</span><span class="nv">$i</span><span class="o">]</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="k">my</span> <span class="nv">$c</span> <span class="o">=</span> <span class="nv">@c</span><span class="o">[</span><span class="nv">$i</span><span class="o">]</span><span class="p">;</span> <span class="o">...</span>
</span></span></code></pre></div><ul>
<li>子例程中的具名参数</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"> <span class="c1">#            Perl 5                                     Raku</span>
</span></span><span class="line"><span class="cl"> <span class="k">sub</span> <span class="nf">routine</span> <span class="p">{</span>                                   <span class="k">sub</span> <span class="nf">routine</span> <span class="p">(</span><span class="nv">$a</span><span class="o">,</span> <span class="nv">$b</span><span class="o">,</span> <span class="o">*</span><span class="nv">@rest</span><span class="p">)</span> <span class="p">{</span><span class="o">...</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="k">my</span> <span class="nv">$b</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="k">my</span> <span class="nv">@rest</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span></code></pre></div><ul>
<li>Objects with auto generated new and getters and setters</li>
</ul>
<p>Simple Object creation is now as easy as it gets.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"> <span class="c1">#              Perl 5                                     Raku</span>
</span></span><span class="line"><span class="cl"> <span class="nb">package</span> <span class="nn">Heart::Gold</span><span class="p">;</span>                            <span class="k">class</span> <span class="nc">Heart::Gold</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                                   <span class="k">has</span> <span class="nv">$.speed</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="k">sub</span> <span class="nb">new</span> <span class="p">{</span>                                         <span class="k">method</span> <span class="nf">stop</span> <span class="p">{</span> <span class="nv">$.speed</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="nb">bless</span> <span class="p">{</span><span class="s">speed</span> <span class="o">=&gt;</span> <span class="mi">0</span> <span class="p">}</span><span class="o">,</span> <span class="nb">shift</span><span class="p">;</span>                   <span class="p">}</span>  
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl">                                                 <span class="k">my</span> <span class="n">Heart::Gold</span> <span class="nv">$hg1</span> <span class="o">.=</span> <span class="nb">new</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="k">sub</span> <span class="nf">speed</span> <span class="p">{</span>                                     <span class="nv">$hg1</span><span class="o">.</span><span class="nf">speed</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="k">my</span> <span class="nv">$self</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>                             <span class="k">my</span> <span class="nv">$hg2</span> <span class="o">=</span> <span class="nv">$hg1</span><span class="o">.</span><span class="nb">clone</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="k">my</span> <span class="nv">$speed</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="k">if</span> <span class="p">(</span><span class="nb">defined</span> <span class="nv">$speed</span><span class="p">)</span> <span class="p">{</span> <span class="nv">$self-</span><span class="o">&gt;</span><span class="p">{</span><span class="n">speed</span><span class="p">}</span> <span class="o">=</span> <span class="nv">$speed</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="k">else</span> <span class="p">{</span> <span class="nv">$self-</span><span class="o">&gt;</span><span class="p">{</span><span class="n">speed</span><span class="p">}</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="k">sub</span> <span class="nf">stop</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="k">my</span> <span class="nv">$self</span> <span class="o">=</span> <span class="nb">shift</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="nv">$self-</span><span class="o">&gt;</span><span class="p">{</span><span class="n">speed</span><span class="p">}</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span></code></pre></div><h2 id="raku-variable">Raku Variable&nbsp;<a class="headline-hash no-text-decoration" href="#raku-variable">#</a> </h2>
<ul>
<li>Variable Types</li>
</ul>
<p>Raku (as Perl 5) knows 3 basic types of variables: Scalars (single values), Arrays (ordered and indexed lists of several values) and Hashes (2 column table, with ID and associated value pairs). They can be easily distinguished, because in front of their name is a special character called sigil (latin for sign). It&rsquo;s the $ (similar to S) for Scalars, @ (like an a) for Arrays and a % (kv pair icon) for a Hash. They are now invariant (not changing), which means for instance, an array vaiable starts always with an @, even if you just want a slice of the content.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="nv">$scalar</span>
</span></span><span class="line"><span class="cl"><span class="nv">@array</span>
</span></span><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span>              <span class="c1"># $array[1]   in Perl 5</span>
</span></span><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">]</span>            <span class="c1"># @array[1,2] in Perl 5</span>
</span></span><span class="line"><span class="cl"><span class="nv">%hash</span>
</span></span><span class="line"><span class="cl"><span class="nv">%hash</span><span class="p">{&#39;</span><span class="s1">ba</span><span class="p">&#39;}</span>            <span class="c1"># $hash{&#39;ba&#39;} in Perl 5</span>
</span></span><span class="line"><span class="cl"><span class="nv">%hash</span><span class="p">{&#39;</span><span class="s1">ba</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">da</span><span class="p">&#39;</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">bim</span><span class="p">&#39;}</span> <span class="c1"># @hash{&#39;ba&#39;,&#39;da&#39;,&#39;bim&#39;} in Perl 5</span>
</span></span></code></pre></div><p>The sigils also mark distinct namespaces, meaning: in one lexical scope you can have 3 different variables named $stuff, @stuff and %stuff. These sigils can also be used as an operator to enforce a context in which the following data will be seen.</p>
<p>The fourth namespace is for subroutines and similar, even if you don&rsquo;t usually think of them as variables. It&rsquo;s sigil &amp; is used to refer to subroutines without calling them.</p>
<p>All special namespaces from Perl 5 (often marked with special syntax), like tokens (<strong>PACKAGE</strong>), formats, file or dir handles, or builtins are now regular variables or routines.</p>
<p>Because all variables contain objects, they have methods. In fact, all operators, including square or curly bracket subscripts, are just methods of an object with a fancy name.</p>
<p>The primary sigil can be followed by a secondary sigil, called a twigil, which indicates a special scope for that variable.</p>
<h3 id="scalar">Scalar&nbsp;<a class="headline-hash no-text-decoration" href="#scalar">#</a> </h3>
<p>This type stores one value, usually a reference to something: a value of a data type, a code object, an object or a compound of values like a pair, junction, array, hash or capture. The scalar context is now called item context, hence the scalar instruction from Perl 5 was renamed to item.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="nv">$CHAPTER</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>              <span class="c1"># first comment!</span>
</span></span><span class="line"><span class="cl"><span class="nv">$bin</span> <span class="o">=</span> <span class="mb">0b11</span><span class="p">;</span>               <span class="c1"># same value in binary format</span>
</span></span><span class="line"><span class="cl"><span class="nv">$pi</span> <span class="o">=</span> <span class="mf">3.14159_26535_89793</span><span class="p">;</span> <span class="c1"># the underscores just ease reading</span>
</span></span><span class="line"><span class="cl"><span class="nv">$float</span> <span class="o">=</span> <span class="mf">6.02e-23</span><span class="p">;</span>         <span class="c1"># floating number in scientific notation</span>
</span></span><span class="line"><span class="cl"><span class="nv">$text</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">Welcome all!</span><span class="p">&#39;;</span>    <span class="c1"># single quoted string</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># double quoted string, does eval $pi to it&#39;s content</span>
</span></span><span class="line"><span class="cl"><span class="nv">$text</span> <span class="o">=</span> <span class="p">&#34;</span><span class="s2"> What is </span><span class="nv">$pi</span><span class="s2">?</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$text</span> <span class="o">=</span> <span class="k">q</span><span class="sa">:to</span><span class="p">&#39;EOT&#39;;</span><span class="s">         # heredoc string
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">    handy for multiline text
</span></span></span><span class="line"><span class="cl"><span class="s">    like HTML templates or email
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s"></span><span class="p">EOT</span>
</span></span><span class="line"><span class="cl"><span class="nv">$handle</span> <span class="o">=</span> <span class="nb">open</span> <span class="nv">$file_name</span><span class="p">;</span> <span class="c1"># file handle</span>
</span></span><span class="line"><span class="cl"><span class="c1"># an object from a class with a nested namespace</span>
</span></span><span class="line"><span class="cl"><span class="nv">$object</span> <span class="o">=</span> <span class="n">Class::Name</span><span class="o">.</span><span class="nb">new</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nv">$condition</span> <span class="o">=</span> <span class="mi">3</span><span class="o">|</span><span class="mi">5</span><span class="o">|</span><span class="mi">7</span><span class="p">;</span>                <span class="c1"># a junction, a logical conjunction of values</span>
</span></span><span class="line"><span class="cl"><span class="nv">$arrayref</span> <span class="o">=</span> <span class="o">[</span><span class="mi">0</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">8</span><span class="o">,</span><span class="mi">13</span><span class="o">,</span><span class="mi">21</span><span class="o">]</span><span class="p">;</span> <span class="c1"># an array stored as a single item</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># a hash stored as a single item</span>
</span></span><span class="line"><span class="cl"><span class="nv">$hashref</span> <span class="o">=</span> <span class="p">{&#39;</span><span class="s1">audreyt</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">pugs</span><span class="p">&#39;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">&#39;</span><span class="s1">pm</span><span class="p">&#39;</span>      <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">pct</span><span class="p">&#39;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">&#39;</span><span class="s1">damian</span><span class="p">&#39;</span>  <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">larrys evil henchman</span><span class="p">&#39;};</span>
</span></span><span class="line"><span class="cl"><span class="c1"># pointing to a callable</span>
</span></span><span class="line"><span class="cl"><span class="nv">$coderef</span> <span class="o">=</span> <span class="k">sub</span> <span class="p">{</span> <span class="nf">do_something_completely_diffenent</span><span class="p">(</span><span class="nv">@_</span><span class="p">)</span> <span class="p">};</span>
</span></span></code></pre></div><p>(For info on some of those terms: comment, binary format, the underscores ease reading, scientific notation, single-quoted string, double-quoted string, heredoc string, file handle, class, junction, list of values, hash, callable.)</p>
<p>Unlike Perl 5, references are automatically dereferenced to a fitting context. So you could use these $arrayrefs and $hashrefs similarly to an array or hash, making $ the universal variable prefix, pretty much like in PHP. The primary difference is that $ prefixed lists are not flattened in lists.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">@a</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="nv">$a</span> <span class="p">{</span> <span class="p">}</span>          <span class="c1"># just one iteration</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="nv">@a</span> <span class="p">{</span> <span class="p">}</span>          <span class="c1"># three iterations</span>
</span></span></code></pre></div><h3 id="scalar-methods">Scalar Methods&nbsp;<a class="headline-hash no-text-decoration" href="#scalar-methods">#</a> </h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$chapter</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nb">undefine</span> <span class="nv">$chapter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nb">defined</span> <span class="nv">$a</span><span class="p">;</span> <span class="c1"># false, returns 0</span>
</span></span></code></pre></div><ul>
<li>Array</li>
</ul>
<p>An array is an ordered and indexed list of scalars. If not specified otherwise, they can be changed, expanded and shortened anytime and used as a list, stack, queue and much more. As in Haskell, lists are processed lazily, which means: the compiler looks only at the part it currently needs. This way Raku can handle infinite lists or do computation on lists that have not been computed yet. The lazy command enforces this and the eager command forces all values to be computed.</p>
<p>The list context is forced with a @() operator or list() command. That&rsquo;s not autoflattening like in Perl 5 (automatically convert a List of Lists into one List). If you still want that, say flat(). Or say lol() to explicitly prevent autoflattening.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="nv">@primes</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">11</span><span class="o">,</span><span class="mi">13</span><span class="o">,</span><span class="mi">17</span><span class="o">,</span><span class="mi">19</span><span class="o">,</span><span class="mi">23</span><span class="p">);</span> <span class="c1"># an array gets filled like in Perl 5</span>
</span></span><span class="line"><span class="cl"><span class="nv">@primes</span> <span class="o">=</span>  <span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">11</span><span class="o">,</span><span class="mi">13</span><span class="o">,</span><span class="mi">17</span><span class="o">,</span><span class="mi">19</span><span class="o">,</span><span class="mi">23</span> <span class="p">;</span> <span class="c1"># same thing, since unlike P5 round braces just do group</span>
</span></span><span class="line"><span class="cl"><span class="nv">@primes</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">2 3 5 7 11 13 17 19 23</span><span class="p">&gt;;</span> <span class="c1"># ditto, &lt;&gt; is the new qw()</span>
</span></span><span class="line"><span class="cl"><span class="nv">$primes</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">11</span><span class="o">,</span><span class="mi">13</span><span class="o">,</span><span class="mi">17</span><span class="o">,</span><span class="mi">19</span><span class="o">,</span><span class="mi">23</span><span class="p">);</span> <span class="c1"># same array object just sits in $primes, $primes[0] is 2</span>
</span></span><span class="line"><span class="cl"><span class="nv">$primes</span> <span class="o">=</span> <span class="nb">item</span> <span class="nv">@primes</span><span class="p">;</span>             <span class="c1"># same thing, more explicit</span>
</span></span><span class="line"><span class="cl"><span class="nv">$primes</span> <span class="o">=</span> <span class="mi">2</span><span class="o">,</span><span class="p">;</span>                       <span class="c1"># just 2, first element of the Parcel</span>
</span></span><span class="line"><span class="cl"><span class="nv">@primes</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>                        <span class="c1"># array with one element</span>
</span></span><span class="line"><span class="cl"><span class="nv">@primes</span> <span class="o">=</span> <span class="o">[</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">11</span><span class="o">,</span><span class="mi">13</span><span class="o">,</span><span class="mi">17</span><span class="o">,</span><span class="mi">19</span><span class="o">,</span><span class="mi">23</span><span class="o">]</span><span class="p">;</span> <span class="c1"># array with one element (List of Lists - LoL)</span>
</span></span><span class="line"><span class="cl"><span class="nv">@dev</span>    <span class="o">=</span> <span class="p">{&#39;</span><span class="s1">dan</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">parrot</span><span class="p">&#39;};</span>      <span class="c1"># array with one element (a Hash)</span>
</span></span><span class="line"><span class="cl"><span class="nv">@data</span>   <span class="o">=</span> <span class="o">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="o">],[</span><span class="mi">6</span><span class="o">..</span><span class="mi">10</span><span class="o">],[</span><span class="mi">11</span><span class="o">..</span><span class="mi">15</span><span class="o">]</span><span class="p">;</span>  <span class="c1"># Array of Arrays (LoL)</span>
</span></span><span class="line"><span class="cl"><span class="nv">@list</span>   <span class="o">=</span> <span class="n">lol</span> <span class="nv">@data</span><span class="p">;</span>                <span class="c1"># no change</span>
</span></span><span class="line"><span class="cl"><span class="nv">@list</span>   <span class="o">=</span> <span class="nb">flat</span> <span class="nv">@data</span><span class="p">;</span>               <span class="c1"># returns 1..15</span>
</span></span></code></pre></div><ul>
<li>Array Slices</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="nv">@primes</span>                       <span class="c1"># all values as list</span>
</span></span><span class="line"><span class="cl"><span class="nv">@primes</span><span class="o">.</span><span class="nb">values</span>                <span class="c1"># same thing</span>
</span></span><span class="line"><span class="cl"><span class="nv">@primes</span><span class="o">.</span><span class="nb">keys</span>                  <span class="c1"># list of all indices</span>
</span></span><span class="line"><span class="cl"><span class="p">&#34;</span><span class="nv">@primes</span><span class="s2">[]</span><span class="p">&#34;</span>                   <span class="c1"># insert all values in a string, uses [] to distinguish from mail adresses</span>
</span></span><span class="line"><span class="cl"><span class="nv">$prime</span> <span class="o">=</span> <span class="nv">@primes</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>          <span class="c1"># get the first prime</span>
</span></span><span class="line"><span class="cl"><span class="nv">$prime</span> <span class="o">=</span> <span class="nv">@primes</span><span class="o">[*-</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>        <span class="c1"># get the last one</span>
</span></span><span class="line"><span class="cl"><span class="nv">@some</span> <span class="o">=</span> <span class="nv">@primes</span><span class="o">[</span><span class="mi">2</span><span class="o">..</span><span class="mi">5</span><span class="o">]</span><span class="p">;</span>        <span class="c1"># get several</span>
</span></span><span class="line"><span class="cl"><span class="nv">$cell</span> <span class="o">=</span> <span class="nv">@data</span><span class="o">[</span><span class="mi">1</span><span class="o">][</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span>          <span class="c1"># get 8, third value of second value (list)</span>
</span></span><span class="line"><span class="cl"><span class="nv">$cell</span> <span class="o">=</span> <span class="nv">@data</span><span class="o">[</span><span class="mi">1</span><span class="p">;</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span>           <span class="c1"># same thing, shorten syntax</span>
</span></span><span class="line"><span class="cl"><span class="nv">@numbers</span> <span class="o">=</span> <span class="nv">@data</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>          <span class="c1"># get a copy of the second subarray (6..10)</span>
</span></span><span class="line"><span class="cl"><span class="nv">@copy</span> <span class="o">=</span> <span class="nv">@data</span><span class="p">;</span>                <span class="c1"># shallow copy of the array</span>
</span></span></code></pre></div><ul>
<li>Array Methods</li>
</ul>
<p>Some of the more important things you can do with lists. All the methods can also used like ops in &ldquo;elems @array;&rdquo;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="o">?</span> <span class="nv">@array</span><span class="p">;</span>              <span class="c1"># boolean context, Bool::True if array has any value in it, even if it&#39;s a 0</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span> <span class="nv">@array</span><span class="p">;</span>              <span class="c1"># numeric context, number of elements (like in Perl 5 scalar @a)</span>
</span></span><span class="line"><span class="cl"><span class="o">~</span> <span class="nv">@array</span><span class="p">;</span>              <span class="c1"># string context, you get content of all cells, stringified and joined, same as &#34;@primes[]&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">.</span><span class="nb">elems</span><span class="p">;</span>          <span class="c1"># same as + @array</span>
</span></span><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">.</span><span class="nb">end</span><span class="p">;</span>            <span class="c1"># number of the last element, equal to @array.elems-1</span>
</span></span><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">.</span><span class="nf">cat</span><span class="p">;</span>            <span class="c1"># same ~ @array</span>
</span></span><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;&#39;);</span>       <span class="c1"># also same result, you can put another string as parameter that gets between all values</span>
</span></span><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">.</span><span class="nb">unshift</span><span class="p">;</span>        <span class="c1"># prepend one value to the array</span>
</span></span><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">.</span><span class="nb">shift</span><span class="p">;</span>          <span class="c1"># remove the first value and return it</span>
</span></span><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">.</span><span class="nb">push</span><span class="p">;</span>           <span class="c1"># add one value on the end</span>
</span></span><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">.</span><span class="nb">pop</span><span class="p">;</span>            <span class="c1"># remove one value from the end and return it</span>
</span></span><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">.</span><span class="nb">splice</span><span class="p">(</span><span class="nv">$pos</span><span class="o">,</span><span class="nv">$n</span><span class="p">);</span><span class="c1"># starting at $pos remove $n values and replace them with values that follow those two</span>
</span></span></code></pre></div><ul>
<li>parameters</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">.</span><span class="nb">delete</span><span class="p">(</span><span class="nv">@ind</span><span class="p">);</span>   <span class="c1"># delete all cells with indices in @ind</span>
</span></span><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">.</span><span class="nf">exists</span><span class="p">(</span><span class="nv">@ind</span><span class="p">);</span>   <span class="c1"># Bool::True if all indices of @ind have a value (can be 0 or &#39;&#39;)</span>
</span></span><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">.</span><span class="nb">pick</span><span class="p">(</span><span class="o">[</span><span class="nv">$n</span><span class="o">]</span><span class="p">);</span>     <span class="c1"># return $n (default is 1) randomly selected values, without duplication</span>
</span></span><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">.</span><span class="nb">roll</span><span class="p">(</span><span class="o">[</span><span class="nv">$n</span><span class="o">]</span><span class="p">);</span>     <span class="c1"># return $n (default is 1) randomly selected values, duplication possible (like roll dice)</span>
</span></span><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">.</span><span class="nb">reverse</span><span class="p">;</span>        <span class="c1"># all elements in reversed order</span>
</span></span><span class="line"><span class="cl"><span class="c1"># returns a list where $n times first item is taken to last</span>
</span></span><span class="line"><span class="cl"><span class="c1"># position if $n is positive, if negative the other way around</span>
</span></span><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">.</span><span class="nb">rotate</span><span class="p">(</span><span class="nv">$n</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">.</span><span class="nb">sort</span><span class="p">(</span><span class="nv">$coderef</span><span class="p">);</span> <span class="c1"># returns a list sorted by a user-defined criteria, default is alphanumerical sorting</span>
</span></span><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">.</span><span class="nb">min</span><span class="p">;</span>            <span class="c1"># numerical smallest value of that array</span>
</span></span><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">.</span><span class="nb">max</span><span class="p">;</span>            <span class="c1"># numerical largest value of that array</span>
</span></span><span class="line"><span class="cl"><span class="nv">$a</span><span class="o">,</span><span class="nv">$b</span><span class="o">=</span> <span class="nv">@array</span><span class="o">.</span><span class="nb">minmax</span><span class="p">;</span>  <span class="c1"># both at once, like in .sort,  .min, or .max, a sorting algorithm can be provided</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">.</span><span class="nb">map</span><span class="p">(</span><span class="nv">$coderef</span><span class="p">);</span>  <span class="c1"># high oder map function, runs $coderef with every value as $_ and returns the list or results</span>
</span></span><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">.</span><span class="nb">classify</span><span class="p">(</span><span class="nv">$cr</span><span class="p">);</span>  <span class="c1"># kind of map, but creates a hash, where keys are the results of $cr and values are from @array</span>
</span></span><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">.</span><span class="nb">categorize</span><span class="p">(</span><span class="nv">$cr</span><span class="p">);</span><span class="c1"># kind of classify, but closure can have no (Nil) or several results, so a key can have a list of values</span>
</span></span><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">.</span><span class="nb">grep</span><span class="p">({</span><span class="nv">$_</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">});</span>   <span class="c1"># high order grep, returns only these elements that pass a condition ($cr returns something positive)</span>
</span></span><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">.</span><span class="nb">first</span><span class="p">(</span><span class="nv">$coder</span><span class="p">);</span>  <span class="c1"># kind of grep, return just the first matching value</span>
</span></span><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">.</span><span class="nb">zip</span><span class="p">;</span>            <span class="c1"># join arrays by picking first element left successively from here and then there</span>
</span></span><span class="line"><span class="cl"><span class="n">There</span> <span class="k">is</span> <span class="nc">even</span> <span class="n">a</span> <span class="n">whole</span> <span class="k">class</span> <span class="k">of</span> <span class="nc">metaoperators</span> <span class="n">that</span> <span class="n">work</span> <span class="n">upon</span> <span class="n">lists</span><span class="o">.</span>
</span></span></code></pre></div><ul>
<li>Hash</li>
</ul>
<p>In Raku a Hash is an unordered list of Pairs. A Pair is a single key =&gt; value association and appears in many places of the language syntax. A hash allows lookup of values by key using {} or &lt;&gt; syntax.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="nv">%dev</span> <span class="o">=</span>  <span class="p">&#39;</span><span class="s1">pugs</span><span class="p">&#39;</span><span class="o">=&gt;</span><span class="p">&#39;</span><span class="s1">audreyt</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">pct</span><span class="p">&#39;</span><span class="o">=&gt;</span><span class="p">&#39;</span><span class="s1">pm</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">STD</span><span class="p">&#34;</span><span class="o">=&gt;</span><span class="p">&#39;</span><span class="s1">larry</span><span class="p">&#39;;</span>
</span></span><span class="line"><span class="cl"><span class="nv">%dev</span> <span class="o">=</span> <span class="p">:</span><span class="s">rakudo</span><span class="p">(&#39;</span><span class="s1">jnthn</span><span class="p">&#39;)</span><span class="o">,</span> <span class="p">:</span><span class="s">testsuite</span><span class="p">(&#39;</span><span class="s1">moritz</span><span class="p">&#39;);</span>            <span class="c1"># adverb (pair) syntax works as well</span>
</span></span><span class="line"><span class="cl"><span class="nv">%dev</span> <span class="o">=</span> <span class="p">(&#39;</span><span class="s1">audreyt</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">pugs</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">pm</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">pct</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">larry</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">STD</span><span class="p">&#34;);</span>  <span class="c1"># lists get autoconverted in hash context</span>
</span></span><span class="line"><span class="cl"><span class="nv">%compiler</span> <span class="o">=</span> <span class="s">Parrot</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="s">Rakudo</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">jnthn</span><span class="p">&#39;}</span><span class="o">,</span> <span class="s">SMOP</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="s">Mildew</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">ruoso</span><span class="p">&#39;};</span>       <span class="c1"># hash of hashes (HoH)</span>
</span></span></code></pre></div><ul>
<li>Hash Slices</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="nv">$value</span> <span class="o">=</span> <span class="nv">%dev</span><span class="p">{&#39;</span><span class="s1">key</span><span class="p">&#39;};</span>      <span class="c1"># just give me the value related to that key, like in P5</span>
</span></span><span class="line"><span class="cl"><span class="nv">$value</span> <span class="o">=</span> <span class="nv">%dev</span><span class="p">&lt;</span><span class="s">pm</span><span class="p">&gt;;</span>         <span class="c1"># &lt;&gt; autoquotes like qw() in P5</span>
</span></span><span class="line"><span class="cl"><span class="nv">$value</span> <span class="o">=</span> <span class="nv">%dev</span><span class="p">&lt;&lt;</span><span class="nv">$name</span><span class="p">&gt;&gt;;</span>    <span class="c1"># same thing, just with eval</span>
</span></span><span class="line"><span class="cl"><span class="nv">@values</span> <span class="o">=</span> <span class="nv">%dev</span><span class="p">{&#39;</span><span class="s1">key1</span><span class="p">&#39;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">key2</span><span class="p">&#39;};</span>
</span></span><span class="line"><span class="cl"><span class="nv">@values</span> <span class="o">=</span> <span class="nv">%dev</span><span class="p">&lt;</span><span class="s">key1 key2</span><span class="p">&gt;;</span>
</span></span><span class="line"><span class="cl"><span class="nv">@values</span> <span class="o">=</span> <span class="nv">%dev</span><span class="p">&lt;&lt;</span><span class="s2">key1 key2 </span><span class="nv">$key3</span><span class="p">&gt;&gt;;</span>
</span></span><span class="line"><span class="cl"><span class="nv">%compiler</span><span class="p">&lt;</span><span class="s">Parrot</span><span class="p">&gt;&lt;</span><span class="s">Rakudo</span><span class="p">&gt;;</span> <span class="c1"># value in a HoH, returns &#39;jnthn&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">%compiler</span><span class="p">&lt;</span><span class="s">SMOP</span><span class="p">&gt;;</span>           <span class="c1"># returns the Pair: Mildew =&gt; &#39;ruoso&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">%dev</span>   <span class="p">{&#39;</span><span class="s1">audrey</span><span class="p">&#39;};</span>         <span class="c1"># error, spaces between varname and braces (postcircumfix operator) are no longer allowed</span>
</span></span><span class="line"><span class="cl"><span class="nv">%dev</span>\  <span class="p">{&#39;</span><span class="s1">allison</span><span class="p">&#39;};</span>        <span class="c1"># works, quote the space</span>
</span></span><span class="line"><span class="cl"><span class="nv">%dev</span>   <span class="o">.</span><span class="p">&lt;</span><span class="s">dukeleto</span><span class="p">&gt;;</span>        <span class="c1"># error</span>
</span></span><span class="line"><span class="cl"><span class="nv">%dev</span>\ <span class="o">.</span><span class="p">{&#39;</span><span class="s1">patrick</span><span class="p">&#39;};</span>        <span class="c1"># works too, &#34;long dot style&#34;, because it&#39;s an object in truth</span>
</span></span></code></pre></div><ul>
<li>Hash Methods</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="o">?</span> <span class="nv">%dev</span>                     <span class="c1"># bool context, true if hash has any pairs</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span> <span class="nv">%dev</span>                     <span class="c1"># numeric context, returns number of pairs(keys)</span>
</span></span><span class="line"><span class="cl"><span class="o">~</span> <span class="nv">%dev</span>                     <span class="c1"># string context, nicely formatted 2 column table using \t and \n</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$table</span> <span class="o">=</span> <span class="nv">%dev</span><span class="p">;</span>             <span class="c1"># same as ~ %dev</span>
</span></span><span class="line"><span class="cl"><span class="nv">%dev</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>                  <span class="c1"># stringified, but only $key and $value are separated by \t</span>
</span></span><span class="line"><span class="cl"><span class="nv">@pairs</span> <span class="o">=</span> <span class="nv">%dev</span><span class="p">;</span>             <span class="c1"># list of all containing pairs</span>
</span></span><span class="line"><span class="cl"><span class="nv">%dev</span><span class="o">.</span><span class="nb">pairs</span>                 <span class="c1"># same thing in all context</span>
</span></span><span class="line"><span class="cl"><span class="nv">%dev</span><span class="o">.</span><span class="nb">elems</span>                 <span class="c1"># same as + %dev or + %dev.pairs</span>
</span></span><span class="line"><span class="cl"><span class="nv">%dev</span><span class="o">.</span><span class="nb">keys</span>                  <span class="c1"># returns a list of all keys</span>
</span></span><span class="line"><span class="cl"><span class="nv">%dev</span><span class="o">.</span><span class="nb">values</span>                <span class="c1"># list of all values</span>
</span></span><span class="line"><span class="cl"><span class="nv">%dev</span><span class="o">.</span><span class="nb">kv</span>                    <span class="c1"># flat list with key1, value1, key 2 ...</span>
</span></span><span class="line"><span class="cl"><span class="nv">%dev</span><span class="o">.</span><span class="nb">invert</span>                <span class="c1"># reverse all key =&gt; value relations</span>
</span></span><span class="line"><span class="cl"><span class="nv">%dev</span><span class="o">.</span><span class="nb">push</span> <span class="p">(</span><span class="nv">@pairs</span><span class="p">)</span>         <span class="c1"># inserts a list of pairs, if a key is already present in %dev, both values gets added to an array</span>
</span></span></code></pre></div><ul>
<li>Callable</li>
</ul>
<p>Internally subroutines, methods and alike are variables with the sigil &amp; and stored in a fourth namespace. Unlike Perl 5, all subroutines can be overwritten or augmented with user defined routines. Of course scalars can also contain routines.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="nv">&amp;function</span> <span class="o">=</span> <span class="k">sub</span> <span class="p">{</span> <span class="o">...</span> <span class="p">};</span>         <span class="c1"># store subroutine in callable namespace</span>
</span></span><span class="line"><span class="cl"><span class="nf">function</span><span class="p">();</span>                      <span class="c1"># call/run it</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$coderef</span> <span class="o">=</span> <span class="k">sub</span> <span class="p">{</span> <span class="o">...</span> <span class="p">};</span>          <span class="c1"># store it in a scalar</span>
</span></span><span class="line"><span class="cl"><span class="nv">$coderef</span><span class="p">(</span><span class="nv">$several</span><span class="o">,</span> <span class="nv">$parameter</span><span class="p">);</span>  <span class="c1"># run that code</span>
</span></span></code></pre></div><ul>
<li>Data Types</li>
</ul>
<p>In contrast to variable types (container types) every value has a type too. These are organized internally as classes or roles and can be categorized into 3 piles: the undefined, immutable, and the mutable types.</p>
<p>You can assign one of these types to scalar, array, or hash variables, which enforces the contents to be that type.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">my</span> <span class="kt">Int</span> <span class="nv">$a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="kt">Int</span> <span class="nv">@a</span><span class="p">;</span>  <span class="c1"># array of Int</span>
</span></span></code></pre></div><ul>
<li>Pair</li>
</ul>
<p>Pairs are new and their syntax is used nearly everywhere in the language where there is an association between a name and a value.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="nv">$pair</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">jakub</span><span class="p">&#39;</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">helena</span><span class="p">&#39;;</span>  <span class="c1"># &#34;=&gt;&#34; is the pair constructor</span>
</span></span><span class="line"><span class="cl"><span class="nv">$pair</span> <span class="o">=</span> <span class="p">:</span><span class="s">jakub</span><span class="p">(&#39;</span><span class="s1">helena</span><span class="p">&#39;);</span>     <span class="c1"># same in adverbial notation</span>
</span></span><span class="line"><span class="cl"><span class="nv">$pair</span> <span class="o">=</span> <span class="p">:</span><span class="s">jakub</span><span class="p">&lt;</span><span class="s">helena</span><span class="p">&gt;;</span>       <span class="c1"># same using &lt;&gt;, the new qw()</span>
</span></span><span class="line"><span class="cl"><span class="nv">$pair</span><span class="o">.</span><span class="nb">key</span>                     <span class="c1"># returns &#39;jakub&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$pair</span><span class="o">.</span><span class="nb">value</span>                   <span class="c1"># returns &#39;helena&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$pair</span><span class="o">.</span><span class="nb">isa</span><span class="p">(</span><span class="kt">Pair</span><span class="p">)</span>               <span class="c1"># Bool::True</span>
</span></span></code></pre></div><ul>
<li>Capture</li>
</ul>
<p>Captures are also a new type, which holds the parameters a routine gets. Because Perl now knows both positional and named parameters, it is a mixture of a list and array.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="nv">$cap</span> <span class="o">=</span> \<span class="p">(</span><span class="nv">@a</span><span class="o">,</span><span class="nv">$s</span><span class="o">,</span><span class="nv">%h</span><span class="o">,</span><span class="p">&#39;</span><span class="s1">a</span><span class="p">&#39;</span><span class="o">=&gt;</span><span class="mi">3</span><span class="p">);</span>    <span class="c1"># creating a capture, &#34;\&#34; was free since there are no references anymore</span>
</span></span><span class="line"><span class="cl"><span class="o">|</span><span class="nv">$cap</span>                         <span class="c1"># flatten into argument list (without |, it will pass it as a single value)</span>
</span></span><span class="line"><span class="cl"><span class="o">||</span><span class="nv">$cap</span>                        <span class="c1"># flatten into semicolon list (meant for variadic functions that take list of lists)</span>
</span></span></code></pre></div><p>One important difference between a capture and a compound structure of lists and hashes: While assignments with = will copy the complete content of the named variables, this is not so in the case of a capture. When I change sinthelastexample, thecontentofcap changes too, because when parameters to a routine are variables, they are also interpolated in the moment the routine is called, not when it&rsquo;s defined.</p>
<ul>
<li>
<p>Assignment and Binding</p>
</li>
<li>
<p>Assignment</p>
</li>
</ul>
<p>As rightfully expected, assignments are done with the equal sign. But unlike Perl 5 you always get a copy of the right side data assigned to the left, no matter how nested the data structure was (lists of lists eg). You never get in Raku a reference with =. The only exception may be seen captures.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">@original</span> <span class="o">=</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">],[</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">]</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$copy</span> <span class="o">=</span> <span class="nv">@original</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span> <span class="c1"># $copy points to [1,2]</span>
</span></span><span class="line"><span class="cl"><span class="nv">@original</span><span class="o">[</span><span class="mi">0</span><span class="o">][</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">fresh stuff</span><span class="p">&#39;;</span> <span class="c1"># $copy[0] holds still 1</span>
</span></span></code></pre></div><ul>
<li>Binding</li>
</ul>
<p>Since every variable in Raku is a reference, programmers can use binding to get 2 variables that point to the same memory location.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="nv">$original</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nv">$original</span> <span class="o">:=</span> <span class="nv">$mirror</span><span class="p">;</span>       <span class="c1"># normal binding, done on runtime</span>
</span></span><span class="line"><span class="cl"><span class="nv">$original</span> <span class="o">::=</span> <span class="nv">$mirror</span><span class="p">;</span>      <span class="c1"># same thing, but done during compile time</span>
</span></span><span class="line"><span class="cl"><span class="nv">$original</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nv">$mirror</span><span class="p">;</span>                <span class="c1"># prints 3</span>
</span></span><span class="line"><span class="cl"><span class="nv">$original</span> <span class="o">=:=</span> <span class="nv">$mirror</span>       <span class="c1"># true, because they&#39;re bound together</span>
</span></span><span class="line"><span class="cl"><span class="nv">$original</span> <span class="o">===</span> <span class="nv">$mirror</span>       <span class="c1"># also true, because content and type are equal</span>
</span></span></code></pre></div><ul>
<li>FP oriented</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">balanced</span><span class="p">(</span><span class="nv">$s</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="nb">none</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="o">.[*-</span><span class="mi">1</span><span class="o">]</span> <span class="o">==</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">        <span class="k">given</span> <span class="o">[</span>\<span class="o">+]</span> <span class="p">&#39;</span><span class="se">\</span><span class="s1">\</span><span class="p">&#39;</span> <span class="o">«</span><span class="ow">leg</span><span class="o">«</span> <span class="nv">$s</span><span class="o">.</span><span class="nb">comb</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$n</span> <span class="o">=</span> <span class="nb">prompt</span> <span class="p">&#34;</span><span class="s2">Number of bracket pairs: </span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$s</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">[ ]</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">roll</span><span class="p">(</span><span class="nv">$n</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$s</span><span class="s2"> </span><span class="p">{</span> <span class="nf">balanced</span><span class="p">(</span><span class="nv">$s</span><span class="p">)</span> <span class="o">??</span> <span class="p">&#34;</span><span class="s2">is</span><span class="p">&#34;</span> <span class="o">!!</span> <span class="p">&#34;</span><span class="s2">is not</span><span class="p">&#34;</span> <span class="p">}</span><span class="s2"> well-balanced</span><span class="p">&#34;</span>
</span></span></code></pre></div><ul>
<li>String munging</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">balanced</span><span class="p">(</span><span class="nv">$_</span> <span class="k">is</span> <span class="nb">copy</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">()</span> <span class="k">while</span> <span class="k">s</span><span class="p">:</span><span class="na">g</span><span class="p">/&#39;</span><span class="s1">[]</span><span class="p">&#39;//;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$_</span> <span class="ow">eq</span> <span class="p">&#39;&#39;;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$n</span> <span class="o">=</span> <span class="nb">prompt</span> <span class="p">&#34;</span><span class="s2">Number of bracket pairs: </span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$s</span> <span class="o">=</span> <span class="p">&lt;</span><span class="s">[ ]</span><span class="p">&gt;</span><span class="o">.</span><span class="nb">roll</span><span class="p">(</span><span class="nv">$n</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$s</span><span class="s2"> is</span><span class="p">&#34;</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1"> not</span><span class="p">&#39;</span> <span class="ow">xx</span> <span class="nb">not</span> <span class="nf">balanced</span><span class="p">(</span><span class="nv">$s</span><span class="p">))</span><span class="err">, &#34; well-balanced&#34;;
</span></span></span></code></pre></div><ul>
<li>Parsing with a grammar</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">grammar</span> <span class="nc">BalBrack</span> <span class="p">{</span> <span class="k">token</span> <span class="nf">TOP</span> <span class="p">{</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">[</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">TOP</span><span class="p">&gt;</span><span class="o">*</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">]</span><span class="p">&#39;</span><span class="sr"> </span><span class="p">}</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$n</span> <span class="o">=</span> <span class="nb">prompt</span> <span class="p">&#34;</span><span class="s2">Number of bracket pairs: </span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$s</span> <span class="o">=</span> <span class="p">(&#39;</span><span class="s1">[</span><span class="p">&#39;</span> <span class="ow">xx</span> <span class="nv">$n</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">]</span><span class="p">&#39;</span> <span class="ow">xx</span> <span class="nv">$n</span><span class="p">)</span><span class="o">.</span><span class="nb">pick</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="o">.</span><span class="nb">join</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="p">&#34;</span><span class="nv">$s</span><span class="s2"> </span><span class="p">{</span> <span class="n">BalBrack</span><span class="o">.</span><span class="nb">parse</span><span class="p">(</span><span class="nv">$s</span><span class="p">)</span> <span class="o">??</span> <span class="p">&#34;</span><span class="s2">is</span><span class="p">&#34;</span> <span class="o">!!</span> <span class="p">&#34;</span><span class="s2">is not</span><span class="p">&#34;</span> <span class="p">}</span><span class="s2"> well-balanced</span><span class="p">&#34;;</span>
</span></span></code></pre></div><ul>
<li>凯撒加密</li>
</ul>
<p>实现一个凯撒加密， 编码和解码都要有</p>
<p>key 是一个 1 到 25 之间的整数</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">@alpha</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">A</span><span class="p">&#39;</span> <span class="o">..</span> <span class="p">&#39;</span><span class="s1">Z</span><span class="p">&#39;;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">encrypt</span> <span class="p">(</span> <span class="nv">$key</span> <span class="k">where</span> <span class="mi">1</span><span class="o">..</span><span class="mi">25</span><span class="o">,</span> <span class="nv">$plaintext</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$plaintext</span><span class="o">.</span><span class="nb">trans</span><span class="p">(</span> <span class="nv">@alpha</span> <span class="ow">Z</span><span class="o">=&gt;</span> <span class="nv">@alpha</span><span class="o">.</span><span class="nb">rotate</span><span class="p">(</span><span class="nv">$key</span><span class="p">)</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">decrypt</span> <span class="p">(</span> <span class="nv">$key</span> <span class="k">where</span> <span class="mi">1</span><span class="o">..</span><span class="mi">25</span><span class="o">,</span> <span class="nv">$cyphertext</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$cyphertext</span><span class="o">.</span><span class="nb">trans</span><span class="p">(</span> <span class="nv">@alpha</span><span class="o">.</span><span class="nb">rotate</span><span class="p">(</span><span class="nv">$key</span><span class="p">)</span> <span class="ow">Z</span><span class="o">=&gt;</span> <span class="nv">@alpha</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$original</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">THE FIVE BOXING WIZARDS JUMP QUICKLY</span><span class="p">&#39;;</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$en</span> <span class="o">=</span> <span class="nf">encrypt</span><span class="p">(</span> <span class="mi">13</span><span class="o">,</span> <span class="nv">$original</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$de</span> <span class="o">=</span> <span class="nf">decrypt</span><span class="p">(</span> <span class="mi">13</span><span class="o">,</span> <span class="nv">$en</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="nb">say</span> <span class="k">for</span> <span class="nv">$original</span><span class="o">,</span> <span class="nv">$en</span><span class="o">,</span> <span class="nv">$de</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="p">&#39;</span><span class="s1">OK</span><span class="p">&#39;</span> <span class="k">if</span> <span class="nv">$original</span> <span class="ow">eq</span> <span class="nb">all</span><span class="p">(</span> <span class="nb">map</span> <span class="p">{</span> <span class="o">.&amp;</span><span class="nf">decrypt</span><span class="p">(</span><span class="o">.&amp;</span><span class="nf">encrypt</span><span class="p">(</span><span class="nv">$original</span><span class="p">))</span> <span class="p">}</span><span class="o">,</span> <span class="mi">1</span><span class="o">..</span><span class="mi">25</span> <span class="p">);</span>
</span></span></code></pre></div><pre><code>Output:
THE FIVE BOXING WIZARDS JUMP QUICKLY
GUR SVIR OBKVAT JVMNEQF WHZC DHVPXYL
THE FIVE BOXING WIZARDS JUMP QUICKLY
OK
</code></pre>
<ul>
<li>日期格式化</li>
</ul>
<p>使用 &ldquo;2007-11-10&rdquo; 和 &ldquo;Sunday, November 10, 2007&rdquo; 日期格式显式当前日期:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">use</span> <span class="nb">DateTime</span><span class="o">:</span><span class="p">:</span><span class="s">Utils</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$dt</span> <span class="o">=</span> <span class="kt">DateTime</span><span class="o">.</span><span class="nb">now</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nf">strftime</span><span class="p">(&#39;</span><span class="s1">%Y-%m-%d</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$dt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nf">strftime</span><span class="p">(&#39;</span><span class="s1">%A, %B %d, %Y</span><span class="p">&#39;</span><span class="o">,</span> <span class="nv">$dt</span><span class="p">);</span>
</span></span></code></pre></div><ul>
<li>阶乘</li>
</ul>
<p>n 的阶乘定义为 <code>n*(n-1)*(n-2)…*1</code>, 零的阶乘为1.</p>
<p>定义一个函数返回一个数字的阶乘。</p>
<ul>
<li>使用自定义后缀操作符</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nb">postfix</span><span class="o">:</span><span class="p">&lt;</span><span class="s">!</span><span class="p">&gt;(</span><span class="nv">$n</span> <span class="k">where</span> <span class="nv">$n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">[*]</span> <span class="mi">2</span><span class="o">..</span><span class="nv">$n</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="mi">5</span><span class="o">!</span>
</span></span></code></pre></div><ul>
<li>[*]</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">@a</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="o">[</span>\<span class="o">*]</span> <span class="mi">1</span><span class="o">..*</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nv">@a</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span><span class="p">;</span>
</span></span></code></pre></div><p>标量容器中存储的对象不会在 flattening 上下文中插值，即使那个对象是可迭代的。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">@a</span> <span class="o">=</span> <span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="nv">@a</span> <span class="p">{</span> <span class="o">.</span><span class="nb">say</span> <span class="p">}</span> <span class="c1"># 5次迭代</span>
</span></span></code></pre></div><p>输出:</p>
<pre tabindex="0"><code>1
2
3
4
5
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$s</span> <span class="o">=</span> <span class="nv">@a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="nv">$s</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span> <span class="c1"># 3次迭代</span>
</span></span></code></pre></div><p>输出:</p>
<pre tabindex="0"><code>1
2
3 4 5
</code></pre><p>这里，<code>$s</code> 和 <code>@a</code> 指向同一个数组对象，但是标量容器的出现阻止 <code>$s</code> 被展开到 for 循环中。</p>
<p>.list 和 .flat 方法能被用于还原展开行为：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">for</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="nv">$s</span><span class="o">.</span><span class="nb">list</span> <span class="p">{</span> <span class="o">.</span><span class="nb">say</span> <span class="p">}</span>    <span class="c1"># 5次遍历</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="nv">@</span><span class="p">(</span><span class="nv">$s</span><span class="p">)</span>   <span class="p">{</span> <span class="o">.</span><span class="nb">say</span>  <span class="p">}</span>   <span class="c1"># 5次遍历，@()会强制为列表上下文</span>
</span></span></code></pre></div><p>输出:</p>
<pre tabindex="0"><code>1
2
3
4
5
</code></pre><p>相反，<code>.item</code> 方法和 <code>$()</code> 能用于防止插值：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">@b</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="nv">@a</span><span class="p">;</span>           <span class="c1"># @b 有5个元素</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">@c</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="nv">@a</span><span class="o">.</span><span class="nb">item</span><span class="p">;</span>      <span class="c1"># @c 有3个元素</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">@c</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="nv">$</span><span class="p">(</span><span class="nv">@a</span><span class="p">);</span>        <span class="c1"># 同上</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="o">+</span><span class="nv">@c</span><span class="p">;</span> <span class="c1"># 3</span>
</span></span></code></pre></div><ul>
<li>Feed operators</li>
</ul>
<p>feed 操作符是完全懒惰的，意味着在使用者要求任何元素之前不会执行任何操作。这就是</p>
<pre tabindex="0"><code class="language-rraku" data-lang="rraku">my @a &lt;== grep { ... } &lt;== map { ... } &lt;== grep { ... } &lt;== 1, 2, 3
</code></pre><p>是完全懒惰的。</p>
<ul>
<li>Grammars</li>
</ul>
<p>文法是一种强大的工具, 用于拆解文本,并通常返回数据结构
例如, Raku 是使用 Raku 风格的文法解析和执行的.
对普通 Raku 用户来说,一个更实用的例子就是 JSON::Simple 模块, 这个模块能反序列化任何有效的 JSON 文件, 反序列化代码还写了不到 100 行, 简单,可扩展.</p>
<p>词法允许你组织正则, 就像类允许你组织普通代码的方法一样.</p>
<h2 id="命名正则">命名正则&nbsp;<a class="headline-hash no-text-decoration" href="#命名正则">#</a> </h2>
<p>命名正则有特殊的语法, 与<strong>子例程</strong>的定义类似:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">my</span> <span class="k">regex</span> <span class="nf">number</span> <span class="p">{</span><span class="sr"> </span><span class="se">\d</span><span class="o">+</span><span class="sr"> </span><span class="p">[</span><span class="sr"> </span><span class="se">\</span><span class="sr">. </span><span class="se">\d</span><span class="o">+</span><span class="sr"> </span><span class="p">]</span><span class="o">?</span><span class="sr"> }
</span></span></span></code></pre></div><p>这个例子中, 我们必须使用 <strong>my</strong> 关键词指定这个正则是词法作用域的, 因为 <strong>命名正则</strong> 通常用在 词法中.
给正则命名后有利于在其他地方<code>复用</code>正则:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">32.51</span><span class="p">&#34;</span>    <span class="o">~~</span> <span class="nv">&amp;number</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">15 + 4.5</span><span class="p">&#34;</span> <span class="o">~~</span> <span class="p">/</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">number</span><span class="p">&gt;</span><span class="sr"> </span><span class="se">\s</span><span class="o">*</span><span class="sr"> </span><span class="p">&#39;</span><span class="s1">+</span><span class="p">&#39;</span><span class="sr"> </span><span class="se">\s</span><span class="o">*</span><span class="sr"> </span><span class="p">&lt;</span><span class="nf">number</span><span class="p">&gt;</span><span class="sr"> </span><span class="p">/</span>
</span></span></code></pre></div><p>首先说下, 使用 <code>regex/token/rule</code> 定义了一个正则表达式后怎么去调用它。就像调用一个子例程那样, 使用 <code>&amp;</code> 符号:
<code>&amp;</code> 后面跟正则表达式的名字,  即 <code>&amp;regex_name</code>。</p>
<p>regex 不是命名正则仅有的标识符 &ndash; 实际上, 它用的不多. 大多数时候, 用的最多的是 <code>token</code> 和 <code>rule</code> 标识符. 它们都是<code>不能回溯</code>的, 这意味着正则引擎在匹配失败时不会备份和重试. 这通常是你想要的, 但不是对所有场合都合适:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">my</span> <span class="k">regex</span> <span class="nf">works-but-slow</span> <span class="p">{</span><span class="sr"> </span><span class="ni">.</span><span class="o">+</span><span class="sr"> q </span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="k">token</span> <span class="nf">fails-but-fast</span> <span class="p">{</span><span class="sr"> </span><span class="ni">.</span><span class="o">+</span><span class="sr"> q </span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Tokens 不会沿原路返回, 这让它们更快地失败!</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$s</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">Tokens won</span><span class="se">\</span><span class="s1">&#39;t backtrack, which makes them fail quicker!</span><span class="p">&#39;;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nb">so</span> <span class="nv">$s</span> <span class="o">~~</span> <span class="nv">&amp;works-but-slow</span><span class="p">;</span> <span class="c1"># True</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nb">so</span> <span class="nv">$s</span> <span class="o">~~</span> <span class="nv">&amp;fails-but-fast</span><span class="p">;</span> <span class="c1"># False, the entire string get taken by the .+</span>
</span></span></code></pre></div><p><code>token</code> 和 <code>rule</code> 标识符的不同之处在于 <code>rule</code> 标识符让 <code>Regex</code> 的 <code>:sigspace</code> 起作用了:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">my</span> <span class="k">token</span> <span class="nf">non-space-y</span> <span class="p">{</span><span class="sr"> once upon a time </span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="k">rule</span> <span class="nf">space-y</span>      <span class="p">{</span><span class="sr"> once upon a time </span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="p">&#39;</span><span class="s1">onceuponatime</span><span class="p">&#39;</span>    <span class="o">~~</span> <span class="nv">&amp;non-space-y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="p">&#39;</span><span class="s1">once upon a time</span><span class="p">&#39;</span> <span class="o">~~</span> <span class="nv">&amp;space-y</span><span class="p">;</span>
</span></span></code></pre></div><h2 id="action-classes">Action Classes&nbsp;<a class="headline-hash no-text-decoration" href="#action-classes">#</a> </h2>
<p>实际上, 命名正则甚至能接受额外的参数, 它使用的语法跟子例程参数列表的语法一样.</p>
<p>​写一个程序打印从 1  到 100 的整数，但是对 3 的倍数打印 &ldquo;Fizz&rdquo;, 对 5 的倍数打印 &ldquo;Buzz&rdquo;, 对于即是 3 的倍数，又是 5 的倍数的打印 &ldquo;FizzBuzz&rdquo;.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">for</span> <span class="mi">1</span> <span class="o">..</span> <span class="mi">100</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="nv">$_</span> <span class="nv">%%</span> <span class="p">(</span><span class="mi">3</span> <span class="o">&amp;</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span> <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">FizzBuzz</span><span class="p">&#39;;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="nv">$_</span> <span class="nv">%%</span> <span class="mi">3</span>       <span class="p">{</span> <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">Fizz</span><span class="p">&#39;;</span>     <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">when</span> <span class="nv">$_</span> <span class="nv">%%</span> <span class="mi">5</span>       <span class="p">{</span> <span class="nb">say</span> <span class="p">&#39;</span><span class="s1">Buzz</span><span class="p">&#39;;</span>     <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">default</span>            <span class="p">{</span> <span class="o">.</span><span class="nb">say</span><span class="p">;</span>           <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Or abusing multi subs:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">multi</span> <span class="k">sub</span> <span class="nf">fizzbuzz</span><span class="p">(</span><span class="kt">Int</span> <span class="nv">$</span> <span class="k">where</span> <span class="o">*</span> <span class="nv">%%</span> <span class="mi">15</span><span class="p">)</span> <span class="p">{</span> <span class="p">&#39;</span><span class="s1">FizzBuzz</span><span class="p">&#39;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">multi</span> <span class="k">sub</span> <span class="nf">fizzbuzz</span><span class="p">(</span><span class="kt">Int</span> <span class="nv">$</span> <span class="k">where</span> <span class="o">*</span> <span class="nv">%%</span> <span class="mi">5</span><span class="p">)</span>  <span class="p">{</span> <span class="p">&#39;</span><span class="s1">Buzz</span><span class="p">&#39;</span>     <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">multi</span> <span class="k">sub</span> <span class="nf">fizzbuzz</span><span class="p">(</span><span class="kt">Int</span> <span class="nv">$</span> <span class="k">where</span> <span class="o">*</span> <span class="nv">%%</span> <span class="mi">3</span><span class="p">)</span>  <span class="p">{</span> <span class="p">&#39;</span><span class="s1">Fizz</span><span class="p">&#39;</span>     <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">multi</span> <span class="k">sub</span> <span class="nf">fizzbuzz</span><span class="p">(</span><span class="kt">Int</span> <span class="nv">$number</span> <span class="p">)</span>        <span class="p">{</span> <span class="nv">$number</span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="mi">1</span> <span class="o">..</span> <span class="mi">100</span><span class="p">)</span><span class="o">».</span><span class="nv">&amp;fizzbuzz</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#34;</span><span class="se">\n</span><span class="p">&#34;)</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>
</span></span></code></pre></div><p>Most concisely:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="nb">say</span> <span class="p">&#39;</span><span class="s1">Fizz</span><span class="p">&#39;</span> <span class="nb">x</span> <span class="nv">$_</span> <span class="nv">%%</span> <span class="mi">3</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">Buzz</span><span class="p">&#39;</span> <span class="nb">x</span> <span class="nv">$_</span> <span class="nv">%%</span> <span class="mi">5</span> <span class="o">||</span> <span class="nv">$_</span> <span class="k">for</span> <span class="mi">1</span> <span class="o">..</span> <span class="mi">100</span><span class="p">;</span>
</span></span></code></pre></div><p>And here&rsquo;s an implementation that never checks for divisibility:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="o">.</span><span class="nb">say</span> <span class="k">for</span>
</span></span><span class="line"><span class="cl">    <span class="p">((&#39;&#39;</span> <span class="ow">xx</span> <span class="mi">2</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Fizz</span><span class="p">&#39;)</span> <span class="ow">xx</span> <span class="o">*</span> <span class="ow">Z</span><span class="o">~</span>
</span></span><span class="line"><span class="cl">    <span class="p">(&#39;&#39;</span> <span class="ow">xx</span> <span class="mi">4</span><span class="o">,</span> <span class="p">&#39;</span><span class="s1">Buzz</span><span class="p">&#39;)</span> <span class="ow">xx</span> <span class="o">*</span><span class="p">)</span> <span class="ow">Z</span><span class="o">||</span><span class="err">1</span> <span class="o">..</span> <span class="mi">100</span><span class="p">;</span>
</span></span></code></pre></div>

        </div>
    </div>
</article>



                <footer>
                    




<div class="no-text-decoration">
    <div class="jump top"><a href="#" title="Top of this page">⮉</a></div>
    <div class="jump bottom"><a href="#bottom" title="Bottom of this page">⮋</a></div>
</div>


 
    
        <div class="hugotoc no-text-decoration">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#set">Set</a></li>
    <li><a href="#series-operator">Series Operator</a></li>
    <li><a href="#flipplop">flip/plop</a></li>
    <li><a href="#grammars">Grammars</a></li>
    <li><a href="#raku-examples">Raku Examples</a></li>
    <li><a href="#best-of-raku">Best Of Raku</a></li>
    <li><a href="#raku-variable">Raku Variable</a>
      <ul>
        <li><a href="#scalar">Scalar</a></li>
        <li><a href="#scalar-methods">Scalar Methods</a></li>
      </ul>
    </li>
    <li><a href="#命名正则">命名正则</a></li>
    <li><a href="#action-classes">Action Classes</a></li>
  </ul>
</nav>
            <a href="#" class="back-to-top">Back to top</a>
        </div>
    
    
<script src="/js/libs/jquery/3.3.1/jquery.slim.min.min.22ee3db0c0e99fd0fbce3aee19672bd53d25469daf734bd4c165649f6eaf7d7f.js"></script>

<link rel="preload" href="/js/libs/jquery/3.3.1/jquery.slim.min.min.22ee3db0c0e99fd0fbce3aee19672bd53d25469daf734bd4c165649f6eaf7d7f.js" as="script">

<script type="application/javascript">(function() {
     var $window = $(window);
     if ($window.width() >= 1400) { 
         var $toc = $('#TableOfContents');
         if ($toc.length > 0) {
             function onScroll(){
                 var currentScroll = $window.scrollTop();
                 var h = $('.content h1, .content h2, .content h3, .content h4, .content h5, .content h6, .h-feed h2');
                 var id = "";
                 h.each(function (i, e) {
                     e = $(e);
                     if (e.offset().top - 10 <= currentScroll) {
                         id = e.attr('id');
                     }
                 });
                 var current = $toc.find('a.current');
                 if (current.length == 1 && current.eq(0).attr('href') == '#' + id) return true;

                 current.each(function (i, e) {
                     $(e).removeClass('current').siblings('ul').hide();
                 });
                 $toc.find('a[href="#' + id + '"]').parentsUntil('#TableOfContents').each(function (i, e) {
                     $(e).children('a').addClass('current').siblings('ul').show();
                 });
             }
             $window.on('scroll', onScroll);
             $(document).ready(function() {
                 $toc.find('a').parent('li').find('ul').hide();
                 onScroll();
                 document.getElementsByClassName('hugotoc')[0].style.display = '';
             });}}})();</script>








<div class="backtotop center no-text-decoration">
    <a href="#">back to <span class="top">top</span></a>
</div>


<div class="right">
    <div class="taxo no-text-decoration">
         
            
                <ul class="no-bullets inline categories">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts categorized in ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/categories/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
         
            
                <ul class="no-bullets inline tags">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts tagged with ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/tags/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
        
    </div>

</div>
<div class="clear-float"></div>



<div class="prev-next-navigator clear-float">
    
        <span class="prev-post left no-text-decoration">
            <a href="https://ohmyweekly.github.io/notes/2015-03-23-modules-in-raku/" class="nobr">« Raku 中的模块</a>
        </span>
    
    
        <span class="next-post right no-text-decoration">
            <a href="https://ohmyweekly.github.io/notes/2015-04-15-raku-calendar-2012/" class="nobr">Raku 圣诞月历 2012 »</a>
        </span>
    
</div>


<a id="bottom"></a>









                       







                    <ul class="no-bullets feed right inline">
    
        
        
    
</ul>
<div class="clear-float"></div>

                </footer>
                <hr />
            </div>               

            <footer> 
                

<ul class="social no-text-decoration">
    
</ul>










 
    
    



<p class="generated no-text-decoration">
    Generated using  <a href="https://gitlab.com/kaushalmodi/hugo-theme-refined"><code class="nobr">hugo-theme-refined</code></a> + <span class="nobr">Hugo <a href="https://github.com/gohugoio/hugo/commit/312735366b20d64bd61bff8627f593749f86c964">0.123.7</a></span>
</p>

<p>
    
</p>




<div class="badges no-text-decoration">
    
    

    
</div>




<script type="application/javascript">var nav=responsiveNav("#nav");</script>




<script defer src="/js/libs/fragmentions/wrapper.min.e8c468c89edc4f5dccaa8c720c6b220b3088a16cd7b1e4a1e3345985788260c9.js"></script>









            </footer>
        </div> 
    </body>
</html>
