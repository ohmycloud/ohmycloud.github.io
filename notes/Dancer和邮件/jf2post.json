{"author":{"name":null,"type":"card","url":"https://ohmycloud.github.io/"},"content":{"html":"\u003cp\u003eWeb应用程序经常需要向其用户发送电子邮件，例如收据或密码重置链接。Dancer2 的\u003ca href=\"https://metacpan.org/pod/Dancer2::Plugin::Email\"\u003eEmail\u003c/a\u003e插件通过提供\u003ccode\u003eemail\u003c/code\u003e关键字和健全的默认配置简化了此任务。\u003c/p\u003e\n\u003cp\u003e所以不可避免的“Hello world”示例如下所示：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eemail\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003efrom\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;foo@perl.dance\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eto\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;bar@perl.dance\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003esubject\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;Hello world\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003etext\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;Welcome to the dancefloor!\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e更常见的情况是使用Web应用程序中的模板并将其转换为HTML电子邮件。\u003c/p\u003e\n\u003cp\u003e你不是使用\u003ccode\u003etemplate\u003c/code\u003e关键字将HTML从路由返回到浏览器，而是生成具有特定布局的 HTML，存储在变量中并发送电子邮件。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003epost\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;/welcome\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$html\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etemplate\u003c/span\u003e \u003cspan class=\"nv\"\u003e$template\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$tokens\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003elayout\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;email\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eemail\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003efrom\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;foo@perl.dance\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003eto\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;bar@perl.dance\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003esubject\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;Welcome to the dancefloor!\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003etype\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;html\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003ebody\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$html\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eredirect\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;/home\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"utf-8\"\u003eUTF-8\u003c/h2\u003e\n\u003cp\u003e如果内容和邮件标题可能包含UTF-8字符，请注意对其进行编码。如果你不这样做，它甚至可能在你的电子邮件客户端中看起来很好，但不一定适用于其他客户端。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eemail\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003efrom\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;foo@perl.dance\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eto\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;bar@perl.dance\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003esubject\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eencode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;MIME-Header\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;Über uns\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003etype\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;html\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ebody\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eencode\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;UTF-8\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"s\"\u003e\u0026#39;Die Geschichte unseres Projekts begann mit dem französischen Entwicker Alexis Sukrieh ...\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e        \n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"内嵌图像\"\u003e内嵌图像\u003c/h2\u003e\n\u003cp\u003e你只需发送带有图像链接的电子邮件，但通常电子邮件客户端不会在没有用户交互的情况下加载它们。虽然可以将图像附加到电子邮件并使用自定义HTML标记在电子邮件正文中引用它们：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"n\"\u003eemail\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003efrom\u003c/span\u003e      \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;foo@perl.dance\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003eto\u003c/span\u003e        \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;bar@perl.dance\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003esubject\u003c/span\u003e   \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;Welcome to the dancefloor!\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003ebody\u003c/span\u003e      \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"sx\"\u003eq{\u0026lt;p\u0026gt;Image embedded: \u0026lt;img src=\u0026#34;cid:mycid\u0026#34;/\u0026gt;\u0026lt;/p\u0026gt;}\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003etype\u003c/span\u003e      \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;html\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003eattach\u003c/span\u003e    \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003eId\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;mycid\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ePath\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;/dancefloor/dcr-header-logo.pngpath/to/file\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e}],\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003emultipart\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;related\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"提供纯文本部分\"\u003e提供纯文本部分\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://metacpan.org/pod/HTML::FormatText::WithLinks\"\u003eHTML::FormatText::WithLinks\u003c/a\u003e可以轻松提供 HTML 电子邮件的纯文本版本：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$html\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etemplate\u003c/span\u003e \u003cspan class=\"nv\"\u003e$template\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$tokens\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"n\"\u003elayout\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;email\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$f\u003c/span\u003e    \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nn\"\u003eHTML::FormatText::WithLinks\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$text\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$f\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eparse\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$html\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eemail\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003efrom\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;foo@perl.dance\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eto\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;bar@perl.dance\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003esubject\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;Welcome to the dancefloor!\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ebody\u003c/span\u003e   \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$text\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eattach\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003eData\u003c/span\u003e     \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$html\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003eType\u003c/span\u003e     \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;text/html\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003emultipart\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;alternative\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"配置\"\u003e配置\u003c/h2\u003e\n\u003ch3 id=\"传输\"\u003e传输\u003c/h3\u003e\n\u003cp\u003e在后台，插件使用 \u003ca href=\"https://metacpan.org/pod/Email::Sender\"\u003eEmail::Sender\u003c/a\u003e，因此你可以使用其传输而不是“sendmail”（本地邮件服务器）。\u003c/p\u003e\n\u003cp\u003e这只是调整配置的问题：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eplugins:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"n\"\u003eEmail:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003etransport:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"n\"\u003eSMTP:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003essl:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003ehost:\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;mail.perl.dance\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003eport:\u003c/span\u003e \u003cspan class=\"mi\"\u003e465\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003esasl_username:\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;foo@perl.dance\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003esasl_password:\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;nevairbe\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e在开发过程中，你希望\u003cstrong\u003e阻止\u003c/strong\u003e电子邮件发送给\u003cstrong\u003e真实用户\u003c/strong\u003e。\u003c/p\u003e\n\u003cp\u003e这可以通过\u003ca href=\"https://metacpan.org/pod/Email::Sender::Transport::Redirect\"\u003eRedirect\u003c/a\u003e传输来完成：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eplugins:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"n\"\u003eEmail:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003etransport:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"n\"\u003eSendmail:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003eredirect_address:\u003c/span\u003e \u003cspan class=\"n\"\u003eracke\u003c/span\u003e\u003cspan class=\"nv\"\u003e@perl\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edance\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e所有电子邮件都将发送到特定地址，但添加了原始收件人的额外标题：\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eX-Intercepted-To: \u0026#34;Bar\u0026#34; \u0026lt;bar@perl.dance\u0026gt;\nX-Intercepted-Cc: \u0026#34;Baz\u0026#34; \u0026lt;baz@perl.dance\u0026gt;\n\u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"preseed标题\"\u003ePreseed标题\u003c/h3\u003e\n\u003cp\u003e如果你有标准的电子邮件地址和/或你想要额外的电子邮件headeers，你也可以在配置中指定这些：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eplugins:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"n\"\u003eEmail:\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003esender:\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;2019@perl.dance\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003efrom:\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;Perl Dancer Conference 2019 \u0026lt;2019@perl.dance\u0026gt;\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eX\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eMailer:\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;PerlDance2018 4.0\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"作者\"\u003e作者\u003c/h2\u003e\n\u003cp\u003e本文由racke为2018年的Perl Dancer Advent Calendar编写。\u003c/p\u003e\n","text":"Web应用程序经常需要向其用户发送电子邮件，例如收据或密码重置链接。Dancer2 的Email插件通过提供email关键字和健全的默认配置简化了此任务。\n所以不可避免的“Hello world”示例如下所示：\nemail { from =\u0026gt; \u0026#39;foo@perl.dance\u0026#39;, to =\u0026gt; \u0026#39;bar@perl.dance\u0026#39;, subject =\u0026gt; \u0026#39;Hello world\u0026#39;, text =\u0026gt; \u0026#39;Welcome to the dancefloor!\u0026#39;, }; 更常见的情况是使用Web应用程序中的模板并将其转换为HTML电子邮件。\n你不是使用template关键字将HTML从路由返回到浏览器，而是生成具有特定布局的 HTML，存储在变量中并发送电子邮件。\npost \u0026#39;/welcome\u0026#39; =\u0026gt; { my $html = template $template, $tokens, { layout =\u0026gt; \u0026#39;email\u0026#39; }; email { from =\u0026gt; \u0026#39;foo@perl.dance\u0026#39;, to =\u0026gt; \u0026#39;bar@perl.dance\u0026#39;, subject =\u0026gt; \u0026#39;Welcome to the dancefloor!\u0026#39;, type =\u0026gt; \u0026#39;html\u0026#39;, body =\u0026gt; $html, } redirect \u0026#39;/home\u0026#39;; } UTF-8 如果内容和邮件标题可能包含UTF-8字符，请注意对其进行编码。如果你不这样做，它甚至可能在你的电子邮件客户端中看起来很好，但不一定适用于其他客户端。\nemail { from =\u0026gt; \u0026#39;foo@perl.dance\u0026#39;, to =\u0026gt; \u0026#39;bar@perl.dance\u0026#39;, subject =\u0026gt; encode(\u0026#39;MIME-Header\u0026#39;, \u0026#39;Über uns\u0026#39;), type =\u0026gt; \u0026#39;html\u0026#39;, body =\u0026gt; encode(\u0026#39;UTF-8\u0026#39;, \u0026#39;Die Geschichte unseres Projekts begann mit dem französischen Entwicker Alexis Sukrieh ...\u0026#39;), }; 内嵌图像 你只需发送带有图像链接的电子邮件，但通常电子邮件客户端不会在没有用户交互的情况下加载它们。虽然可以将图像附加到电子邮件并使用自定义HTML标记在电子邮件正文中引用它们：\nemail { from =\u0026gt; \u0026#39;foo@perl.dance\u0026#39;, to =\u0026gt; \u0026#39;bar@perl.dance\u0026#39;, subject =\u0026gt; \u0026#39;Welcome to the dancefloor!\u0026#39;, body =\u0026gt; q{\u0026lt;p\u0026gt;Image embedded: \u0026lt;img src=\u0026#34;cid:mycid\u0026#34;/\u0026gt;\u0026lt;/p\u0026gt;}, type =\u0026gt; \u0026#39;html\u0026#39;, attach =\u0026gt; [ { Id =\u0026gt; \u0026#39;mycid\u0026#39;, Path =\u0026gt; \u0026#39;/dancefloor/dcr-header-logo.pngpath/to/file\u0026#39; }], multipart =\u0026gt; \u0026#39;related\u0026#39; }; 提供纯文本部分 HTML::FormatText::WithLinks可以轻松提供 HTML 电子邮件的纯文本版本：\nmy $html = template $template, $tokens, { layout =\u0026gt; \u0026#39;email\u0026#39; }; my $f = HTML::FormatText::WithLinks-\u0026gt;new; my $text = $f-\u0026gt;parse($html); email { from =\u0026gt; \u0026#39;foo@perl.dance\u0026#39;, to =\u0026gt; \u0026#39;bar@perl.dance\u0026#39;, subject =\u0026gt; \u0026#39;Welcome to the dancefloor!\u0026#39;, body =\u0026gt; $text, attach =\u0026gt; { Data =\u0026gt; $html, Type =\u0026gt; \u0026#34;text/html\u0026#34; }, multipart =\u0026gt; \u0026#39;alternative\u0026#39;, }; 配置 传输 在后台，插件使用 Email::Sender，因此你可以使用其传输而不是“sendmail”（本地邮件服务器）。\n这只是调整配置的问题：\nplugins: Email: transport: SMTP: ssl: 1 host: \u0026#39;mail.perl.dance\u0026#39; port: 465 sasl_username: \u0026#39;foo@perl.dance\u0026#39; sasl_password: \u0026#39;nevairbe\u0026#39; 在开发过程中，你希望阻止电子邮件发送给真实用户。\n这可以通过Redirect传输来完成：\nplugins: Email: transport: Sendmail: redirect_address: racke@perl.dance 所有电子邮件都将发送到特定地址，但添加了原始收件人的额外标题：\nX-Intercepted-To: \u0026#34;Bar\u0026#34; \u0026lt;bar@perl.dance\u0026gt; X-Intercepted-Cc: \u0026#34;Baz\u0026#34; \u0026lt;baz@perl.dance\u0026gt; Preseed标题 如果你有标准的电子邮件地址和/或你想要额外的电子邮件headeers，你也可以在配置中指定这些：\nplugins: Email: sender: \u0026#34;2019@perl.dance\u0026#34; from: \u0026#34;Perl Dancer Conference 2019 \u0026lt;2019@perl.dance\u0026gt;\u0026#34; X-Mailer: \u0026#34;PerlDance2018 4.0\u0026#34; 作者 本文由racke为2018年的Perl Dancer Advent Calendar编写。\n"},"name":"第十七天 - Dancer 和邮件","published":"2018-12-17T20:58:38Z","summary":"Web应用程序经常需要向其用户发送电子邮件，例如收据或密码重置链接。Dancer2 的Email插件通过提供email关键字和健全的默认配置简化了此任务。\n所以不可避免的“Hello world”示例如下所示：\nemail { from =\u0026gt; \u0026#39;foo@perl.dance\u0026#39;, to =\u0026gt; \u0026#39;bar@perl.dance\u0026#39;, subject =\u0026gt; \u0026#39;Hello world\u0026#39;, text =\u0026gt; \u0026#39;Welcome to the dancefloor!\u0026#39;, }; 更常见的情况是使用Web应用程序中的模板并将其转换为HTML电子邮件。\n你不是使用template关键字将HTML从路由返回到浏览器，而是生成具有特定布局的 HTML，存储在变量中并发送电子邮件。\npost \u0026#39;/welcome\u0026#39; =\u0026gt; { my $html = template $template, $tokens, { layout =\u0026gt; \u0026#39;email\u0026#39; }; email { from =\u0026gt; \u0026#39;foo@perl.dance\u0026#39;, to =\u0026gt; \u0026#39;bar@perl.dance\u0026#39;, subject =\u0026gt; \u0026#39;Welcome to the dancefloor!\u0026#39;, type =\u0026gt; \u0026#39;html\u0026#39;, body =\u0026gt; $html, } redirect \u0026#39;/home\u0026#39;; } UTF-8 如果内容和邮件标题可能包含UTF-8字符，请注意对其进行编码。如果你不这样做，它甚至可能在你的电子邮件客户端中看起来很好，但不一定适用于其他客户端。\nemail { from =\u0026gt; \u0026#39;foo@perl.","type":"entry","url":"https://ohmycloud.github.io/notes/dancer%E5%92%8C%E9%82%AE%E4%BB%B6/"}