{"author":{"name":null,"type":"card","url":"http://localhost:1313/"},"content":{"html":"\u003ch1 id=\"use-spark-to-read-and-write-hbase-datahttpsdocsmicrosoftcomen-usazurehdinsighthdinsight-using-spark-query-hbase\"\u003e\u003ca href=\"https://docs.microsoft.com/en-us/azure/hdinsight/hdinsight-using-spark-query-hbase\"\u003eUse Spark to read and write HBase data\u003c/a\u003e\u003c/h1\u003e\n\u003ch2 id=\"启动-hbase\"\u003e启动 hbase\u003c/h2\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003estart-hbase.sh\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"在-hbase-中准备-sample-数据\"\u003e在 HBase 中准备 sample 数据\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e1、运行 HBase shell\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003ehbase shell\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003e2、创建一个含有 \u003ccode\u003ePersonal\u003c/code\u003e 和 \u003ccode\u003eOffice\u003c/code\u003e 列簇的 \u003ccode\u003eContacts\u003c/code\u003e 表\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003ecreate \u0026#39;Contacts\u0026#39;, \u0026#39;Personal\u0026#39;, \u0026#39;Office\u0026#39;\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003e3、加载一些样例数据\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eput \u0026#39;Contacts\u0026#39;, \u0026#39;1000\u0026#39;, \u0026#39;Personal:Name\u0026#39;, \u0026#39;John Dole\u0026#39;\nput \u0026#39;Contacts\u0026#39;, \u0026#39;1000\u0026#39;, \u0026#39;Personal:Phone\u0026#39;, \u0026#39;1-425-000-0001\u0026#39;\nput \u0026#39;Contacts\u0026#39;, \u0026#39;1000\u0026#39;, \u0026#39;Office:Phone\u0026#39;, \u0026#39;1-425-000-0002\u0026#39;\nput \u0026#39;Contacts\u0026#39;, \u0026#39;1000\u0026#39;, \u0026#39;Office:Address\u0026#39;, \u0026#39;1111 San Gabriel Dr.\u0026#39;\nput \u0026#39;Contacts\u0026#39;, \u0026#39;8396\u0026#39;, \u0026#39;Personal:Name\u0026#39;, \u0026#39;Calvin Raji\u0026#39;\nput \u0026#39;Contacts\u0026#39;, \u0026#39;8396\u0026#39;, \u0026#39;Personal:Phone\u0026#39;, \u0026#39;230-555-0191\u0026#39;\nput \u0026#39;Contacts\u0026#39;, \u0026#39;8396\u0026#39;, \u0026#39;Office:Phone\u0026#39;, \u0026#39;230-555-0191\u0026#39;\nput \u0026#39;Contacts\u0026#39;, \u0026#39;8396\u0026#39;, \u0026#39;Office:Address\u0026#39;, \u0026#39;5415 San Gabriel Dr.\u0026#39;\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"运行-spark-shell-引用-spark-hbase-connector\"\u003e运行 Spark Shell 引用 Spark HBase Connector\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-bash\" data-lang=\"bash\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003espark-shell --packages com.hortonworks:shc-core:1.1.1-2.1-s_2.11 --repositories http://repo.hortonworks.com/content/repositories/releases\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e这会下载很多 jar 包, 完成后会进入 spark shell 界面, 继续下面的步骤。\u003c/p\u003e\n\u003ch2 id=\"定义一个-catalog-并查询\"\u003e定义一个 Catalog 并查询\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e1）在你的 Spark Shell 中, 运行下面的 \u003ccode\u003eimport\u003c/code\u003e 语句：\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eorg.apache.spark.sql.\u003c/span\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003e\u003cspan class=\"nc\"\u003eSQLContext\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003e_\u003c/span\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eorg.apache.spark.sql.execution.datasources.hbase._\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eorg.apache.spark.\u003c/span\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003e\u003cspan class=\"nc\"\u003eSparkConf\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eSparkContext\u003c/span\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003espark.sqlContext.implicits._\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e2）给 HBase 表中的 Contacts 表定义一个 catalog\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003ea. 给名为 \u003ccode\u003eContacts\u003c/code\u003e 的 HBase 表定义一个 catalog\nb. 将 rowkey 标识为 \u003ccode\u003ekey\u003c/code\u003e，并将 Spark 中使用的列名映射到 HBase 中使用的列族，列名和列类型\nc. 还必须将 r​​owkey 详细定义为命名列（\u003ccode\u003erowkey\u003c/code\u003e），其具有 \u003ccode\u003erowkey\u003c/code\u003e 的特定列族 \u003ccode\u003ecf\u003c/code\u003e。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"n\"\u003ecatalog\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003es\u0026#34;\u0026#34;\u0026#34;{\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e     |\u0026#34;table\u0026#34;:{\u0026#34;namespace\u0026#34;:\u0026#34;default\u0026#34;, \u0026#34;name\u0026#34;:\u0026#34;Contacts\u0026#34;},\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e     |\u0026#34;rowkey\u0026#34;:\u0026#34;key\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e     |\u0026#34;columns\u0026#34;:{\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e     |\u0026#34;rowkey\u0026#34;:{\u0026#34;cf\u0026#34;:\u0026#34;rowkey\u0026#34;, \u0026#34;col\u0026#34;:\u0026#34;key\u0026#34;, \u0026#34;type\u0026#34;:\u0026#34;string\u0026#34;},\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e     |\u0026#34;officeAddress\u0026#34;:{\u0026#34;cf\u0026#34;:\u0026#34;Office\u0026#34;, \u0026#34;col\u0026#34;:\u0026#34;Address\u0026#34;, \u0026#34;type\u0026#34;:\u0026#34;string\u0026#34;},\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e     |\u0026#34;officePhone\u0026#34;:{\u0026#34;cf\u0026#34;:\u0026#34;Office\u0026#34;, \u0026#34;col\u0026#34;:\u0026#34;Phone\u0026#34;, \u0026#34;type\u0026#34;:\u0026#34;string\u0026#34;},\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e     |\u0026#34;personalName\u0026#34;:{\u0026#34;cf\u0026#34;:\u0026#34;Personal\u0026#34;, \u0026#34;col\u0026#34;:\u0026#34;Name\u0026#34;, \u0026#34;type\u0026#34;:\u0026#34;string\u0026#34;},\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e     |\u0026#34;personalPhone\u0026#34;:{\u0026#34;cf\u0026#34;:\u0026#34;Personal\u0026#34;, \u0026#34;col\u0026#34;:\u0026#34;Phone\u0026#34;, \u0026#34;type\u0026#34;:\u0026#34;string\u0026#34;}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e     |}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e |}\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estripMargin\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e\n\u003col start=\"3\"\u003e\n\u003cli\u003e定义一个方法，在 HBase 中的 \u003ccode\u003eContacts\u003c/code\u003e 表周围提供 \u003ccode\u003eDataFrame\u003c/code\u003e：\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"n\"\u003ewithCatalog\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecat\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDataFrame\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e         \u003cspan class=\"n\"\u003espark\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esqlContext\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e         \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eread\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e         \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoptions\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eMap\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eHBaseTableCatalog\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etableCatalog\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ecat\u003c/span\u003e\u003cspan class=\"o\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e         \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eformat\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;org.apache.spark.sql.execution.datasources.hbase\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e         \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eload\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e     \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e\n\u003col start=\"4\"\u003e\n\u003cli\u003e创建一个 DataFrame 的实例\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003edf\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ewithCatalog\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecatalog\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e5）查询这个 DataFrame\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003edf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshow\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e6）你应该看到两行数据：\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e+------+--------------------+--------------+-------------+--------------+\n|rowkey|       officeAddress|   officePhone| personalName| personalPhone|\n+------+--------------------+--------------+-------------+--------------+\n|  1000|1111 San Gabriel Dr.|1-425-000-0002|    John Dole|1-425-000-0001|\n|  8396|5415 San Gabriel Dr.|  230-555-0191|  Calvin Raji|  230-555-0191|\n+------+--------------------+--------------+-------------+--------------+\n\u003c/code\u003e\u003c/pre\u003e\u003cul\u003e\n\u003cli\u003e7）注册临时表，以便使用 Spark SQL 查询 HBase 表\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003edf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eregisterTempTable\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;contacts\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e8）针对 contacts 表发出 SQL 查询：\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003equery\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003espark\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esqlContext\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esql\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;select personalName, officeAddress from contacts\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003equery\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshow\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e9）你应该看到这样的结果：\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e+-------------+--------------------+\n| personalName|       officeAddress|\n+-------------+--------------------+\n|    John Dole|1111 San Gabriel Dr.|\n|  Calvin Raji|5415 San Gabriel Dr.|\n+-------------+--------------------+\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"插入新数据\"\u003e插入新数据\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e1）要插入新的 Contact 联系人记录，请定义 \u003ccode\u003eContactRecord\u003c/code\u003e 类：\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eContactRecord\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e     \u003cspan class=\"n\"\u003erowkey\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e     \u003cspan class=\"n\"\u003eofficeAddress\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e     \u003cspan class=\"n\"\u003eofficePhone\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e     \u003cspan class=\"n\"\u003epersonalName\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e     \u003cspan class=\"n\"\u003epersonalPhone\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e     \u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e2）创建 \u003ccode\u003eContactRecord\u003c/code\u003e 的实例并将其放在一个数组中：\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003enewContact\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"nc\"\u003eContactRecord\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;16891\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;40 Ellis St.\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;674-555-0110\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;John Jackson\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;230-555-0194\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003enewData\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nc\"\u003eArray\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eContactRecord\u003c/span\u003e\u003cspan class=\"o\"\u003e](\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003enewData\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enewContact\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e3）将新数据数组保存到 HBase：\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003esc\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eparallelize\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enewData\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003etoDF\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewrite\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoptions\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eMap\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eHBaseTableCatalog\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etableCatalog\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003ecatalog\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eHBaseTableCatalog\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enewTable\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;5\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)).\u003c/span\u003e\u003cspan class=\"n\"\u003eformat\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;org.apache.spark.sql.execution.datasources.hbase\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003esave\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e4）检查结果：\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003edf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eshow\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003e\n\u003col start=\"5\"\u003e\n\u003cli\u003e你应该看到这样的输出：\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e+------+--------------------+--------------+------------+--------------+\n|rowkey|       officeAddress|   officePhone|personalName| personalPhone|\n+------+--------------------+--------------+------------+--------------+\n|  1000|1111 San Gabriel Dr.|1-425-000-0002|   John Dole|1-425-000-0001|\n| 16891|        40 Ellis St.|  674-555-0110|John Jackson|  230-555-0194|\n|  8396|5415 San Gabriel Dr.|  230-555-0191| Calvin Raji|  230-555-0191|\n+------+--------------------+--------------+------------+--------------+\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"参考文献\"\u003e参考文献\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/hortonworks-spark/shc\"\u003eApache Spark - Apache HBase Connector\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n","text":"Use Spark to read and write HBase data 启动 hbase start-hbase.sh 在 HBase 中准备 sample 数据 1、运行 HBase shell hbase shell 2、创建一个含有 Personal 和 Office 列簇的 Contacts 表 create \u0026#39;Contacts\u0026#39;, \u0026#39;Personal\u0026#39;, \u0026#39;Office\u0026#39; 3、加载一些样例数据 put \u0026#39;Contacts\u0026#39;, \u0026#39;1000\u0026#39;, \u0026#39;Personal:Name\u0026#39;, \u0026#39;John Dole\u0026#39; put \u0026#39;Contacts\u0026#39;, \u0026#39;1000\u0026#39;, \u0026#39;Personal:Phone\u0026#39;, \u0026#39;1-425-000-0001\u0026#39; put \u0026#39;Contacts\u0026#39;, \u0026#39;1000\u0026#39;, \u0026#39;Office:Phone\u0026#39;, \u0026#39;1-425-000-0002\u0026#39; put \u0026#39;Contacts\u0026#39;, \u0026#39;1000\u0026#39;, \u0026#39;Office:Address\u0026#39;, \u0026#39;1111 San Gabriel Dr.\u0026#39; put \u0026#39;Contacts\u0026#39;, \u0026#39;8396\u0026#39;, \u0026#39;Personal:Name\u0026#39;, \u0026#39;Calvin Raji\u0026#39; put \u0026#39;Contacts\u0026#39;, \u0026#39;8396\u0026#39;, \u0026#39;Personal:Phone\u0026#39;, \u0026#39;230-555-0191\u0026#39; put \u0026#39;Contacts\u0026#39;, \u0026#39;8396\u0026#39;, \u0026#39;Office:Phone\u0026#39;, \u0026#39;230-555-0191\u0026#39; put \u0026#39;Contacts\u0026#39;, \u0026#39;8396\u0026#39;, \u0026#39;Office:Address\u0026#39;, \u0026#39;5415 San Gabriel Dr.\u0026#39; 运行 Spark Shell 引用 Spark HBase Connector spark-shell --packages com.hortonworks:shc-core:1.1.1-2.1-s_2.11 --repositories http://repo.hortonworks.com/content/repositories/releases 这会下载很多 jar 包, 完成后会进入 spark shell 界面, 继续下面的步骤。\n定义一个 Catalog 并查询 1）在你的 Spark Shell 中, 运行下面的 import 语句： import org.apache.spark.sql.{SQLContext, _} import org.apache.spark.sql.execution.datasources.hbase._ import org.apache.spark.{SparkConf, SparkContext} import spark.sqlContext.implicits._ 2）给 HBase 表中的 Contacts 表定义一个 catalog a. 给名为 Contacts 的 HBase 表定义一个 catalog b. 将 rowkey 标识为 key，并将 Spark 中使用的列名映射到 HBase 中使用的列族，列名和列类型 c. 还必须将 r​​owkey 详细定义为命名列（rowkey），其具有 rowkey 的特定列族 cf。\ndef catalog = s\u0026#34;\u0026#34;\u0026#34;{ |\u0026#34;table\u0026#34;:{\u0026#34;namespace\u0026#34;:\u0026#34;default\u0026#34;, \u0026#34;name\u0026#34;:\u0026#34;Contacts\u0026#34;}, |\u0026#34;rowkey\u0026#34;:\u0026#34;key\u0026#34;, |\u0026#34;columns\u0026#34;:{ |\u0026#34;rowkey\u0026#34;:{\u0026#34;cf\u0026#34;:\u0026#34;rowkey\u0026#34;, \u0026#34;col\u0026#34;:\u0026#34;key\u0026#34;, \u0026#34;type\u0026#34;:\u0026#34;string\u0026#34;}, |\u0026#34;officeAddress\u0026#34;:{\u0026#34;cf\u0026#34;:\u0026#34;Office\u0026#34;, \u0026#34;col\u0026#34;:\u0026#34;Address\u0026#34;, \u0026#34;type\u0026#34;:\u0026#34;string\u0026#34;}, |\u0026#34;officePhone\u0026#34;:{\u0026#34;cf\u0026#34;:\u0026#34;Office\u0026#34;, \u0026#34;col\u0026#34;:\u0026#34;Phone\u0026#34;, \u0026#34;type\u0026#34;:\u0026#34;string\u0026#34;}, |\u0026#34;personalName\u0026#34;:{\u0026#34;cf\u0026#34;:\u0026#34;Personal\u0026#34;, \u0026#34;col\u0026#34;:\u0026#34;Name\u0026#34;, \u0026#34;type\u0026#34;:\u0026#34;string\u0026#34;}, |\u0026#34;personalPhone\u0026#34;:{\u0026#34;cf\u0026#34;:\u0026#34;Personal\u0026#34;, \u0026#34;col\u0026#34;:\u0026#34;Phone\u0026#34;, \u0026#34;type\u0026#34;:\u0026#34;string\u0026#34;} |} |}\u0026#34;\u0026#34;\u0026#34;.stripMargin 定义一个方法，在 HBase 中的 Contacts 表周围提供 DataFrame： def withCatalog(cat: String): DataFrame = { spark.sqlContext .read .options(Map(HBaseTableCatalog.tableCatalog-\u0026gt;cat)) .format(\u0026#34;org.apache.spark.sql.execution.datasources.hbase\u0026#34;) .load() } 创建一个 DataFrame 的实例 val df = withCatalog(catalog) 5）查询这个 DataFrame df.show() 6）你应该看到两行数据： +------+--------------------+--------------+-------------+--------------+ |rowkey| officeAddress| officePhone| personalName| personalPhone| +------+--------------------+--------------+-------------+--------------+ | 1000|1111 San Gabriel Dr.|1-425-000-0002| John Dole|1-425-000-0001| | 8396|5415 San Gabriel Dr.| 230-555-0191| Calvin Raji| 230-555-0191| +------+--------------------+--------------+-------------+--------------+ 7）注册临时表，以便使用 Spark SQL 查询 HBase 表 df.registerTempTable(\u0026#34;contacts\u0026#34;) 8）针对 contacts 表发出 SQL 查询： val query = spark.sqlContext.sql(\u0026#34;select personalName, officeAddress from contacts\u0026#34;) query.show() 9）你应该看到这样的结果： +-------------+--------------------+ | personalName| officeAddress| +-------------+--------------------+ | John Dole|1111 San Gabriel Dr.| | Calvin Raji|5415 San Gabriel Dr.| +-------------+--------------------+ 插入新数据 1）要插入新的 Contact 联系人记录，请定义 ContactRecord 类： case class ContactRecord( rowkey: String, officeAddress: String, officePhone: String, personalName: String, personalPhone: String ) 2）创建 ContactRecord 的实例并将其放在一个数组中： val newContact = ContactRecord(\u0026#34;16891\u0026#34;, \u0026#34;40 Ellis St.\u0026#34;, \u0026#34;674-555-0110\u0026#34;, \u0026#34;John Jackson\u0026#34;,\u0026#34;230-555-0194\u0026#34;) var newData = new Array[ContactRecord](1) newData(0) = newContact 3）将新数据数组保存到 HBase： sc.parallelize(newData).toDF.write.options(Map(HBaseTableCatalog.tableCatalog -\u0026gt; catalog,HBaseTableCatalog.newTable -\u0026gt; \u0026#34;5\u0026#34;)).format(\u0026#34;org.apache.spark.sql.execution.datasources.hbase\u0026#34;).save() 4）检查结果： df.show() 你应该看到这样的输出： +------+--------------------+--------------+------------+--------------+ |rowkey| officeAddress| officePhone|personalName| personalPhone| +------+--------------------+--------------+------------+--------------+ | 1000|1111 San Gabriel Dr.|1-425-000-0002| John Dole|1-425-000-0001| | 16891| 40 Ellis St.| 674-555-0110|John Jackson| 230-555-0194| | 8396|5415 San Gabriel Dr.| 230-555-0191| Calvin Raji| 230-555-0191| +------+--------------------+--------------+------------+--------------+ 参考文献 Apache Spark - Apache HBase Connector "},"name":"Use Spark to read and write HBase data","published":"2018-07-25T16:16:21Z","summary":"Use Spark to read and write HBase data 启动 hbase start-hbase.sh 在 HBase 中准备 sample 数据 1、运行 HBase shell hbase shell 2、创建一个含有 Personal 和 Office 列簇的 Contacts 表 create \u0026#39;Contacts\u0026#39;, \u0026#39;Personal\u0026#39;, \u0026#39;Office\u0026#39; 3、加载一些样例数据 put \u0026#39;Contacts\u0026#39;, \u0026#39;1000\u0026#39;, \u0026#39;Personal:Name\u0026#39;, \u0026#39;John Dole\u0026#39; put \u0026#39;Contacts\u0026#39;, \u0026#39;1000\u0026#39;, \u0026#39;Personal:Phone\u0026#39;, \u0026#39;1-425-000-0001\u0026#39; put \u0026#39;Contacts\u0026#39;, \u0026#39;1000\u0026#39;, \u0026#39;Office:Phone\u0026#39;, \u0026#39;1-425-000-0002\u0026#39; put \u0026#39;Contacts\u0026#39;, \u0026#39;1000\u0026#39;, \u0026#39;Office:Address\u0026#39;, \u0026#39;1111 San Gabriel Dr.\u0026#39; put \u0026#39;Contacts\u0026#39;, \u0026#39;8396\u0026#39;, \u0026#39;Personal:Name\u0026#39;, \u0026#39;Calvin Raji\u0026#39; put \u0026#39;Contacts\u0026#39;, \u0026#39;8396\u0026#39;, \u0026#39;Personal:Phone\u0026#39;, \u0026#39;230-555-0191\u0026#39; put \u0026#39;Contacts\u0026#39;, \u0026#39;8396\u0026#39;, \u0026#39;Office:Phone\u0026#39;, \u0026#39;230-555-0191\u0026#39; put \u0026#39;Contacts\u0026#39;, \u0026#39;8396\u0026#39;, \u0026#39;Office:Address\u0026#39;, \u0026#39;5415 San Gabriel Dr.","type":"entry","url":"http://localhost:1313/notes/%E4%BD%BF%E7%94%A8-spark-%E8%AF%BB%E5%86%99-hbase-%E6%95%B0%E6%8D%AE/"}