{"author":{"name":null,"type":"card","url":"https://ohmyweekly.github.io/"},"content":{"html":"\u003cp\u003eWhile programming in Spark Streaming, I\u0026rsquo;d like to send some fake data to socket. although the command \u003ccode\u003enc -lk 9999\u003c/code\u003e is useful, but you have to type the data manually!\u003c/p\u003e\n\u003cp\u003eWith Raku\u0026rsquo;s \u003ccode\u003eIO::Socket::Async\u003c/code\u003e module, I can easily send data to socket continuously.\u003c/p\u003e\n\u003cp\u003eIn the server side, I listen a port on 3333, I will print the current time every second, every 5 seconds, skip the report of time:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$vin\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;LSJA0000000000091\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$last_meter\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# 当前里程数\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ereact\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ewhenever\u003c/span\u003e \u003cspan class=\"nn\"\u003eIO::Socket::\u003c/span\u003e\u003cspan class=\"n\"\u003eAsync\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;0.0.0.0\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3333\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$conn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003ereact\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"n\"\u003eBool:D\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ignore\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003ewhenever\u003c/span\u003e \u003cspan class=\"n\"\u003eSupply\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einterval\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erotor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"nv\"\u003e$ignore\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nv\"\u003e$ignore\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003ewhenever\u003c/span\u003e \u003cspan class=\"n\"\u003eSupply\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einterval\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"k\"\u003enext\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ignore\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"nv\"\u003e$conn\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003esprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\\{\u0026#39;vin\u0026#39;:\u0026#39;%s\u0026#39;,\u0026#39;createTime\u0026#39;:%s,\u0026#39;mileage\u0026#39;:%s}\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$vin\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enow\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eposix\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$last_meter\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003ewhenever\u003c/span\u003e \u003cspan class=\"n\"\u003esignal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSIGINT\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;Done.\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"n\"\u003edone\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eCATCH\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003edefault\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"o\"\u003e.^\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;: \u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;handled in $?LINE\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAwesome, almost less than 30 lines code.\u003c/p\u003e\n\u003cp\u003eIn the client side, I use \u003ccode\u003etelnet 0.0.0.0 3333\u003c/code\u003e, which will output something like this:\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://upload-images.jianshu.io/upload_images/326727-af5e7fb596463cf5.png?imageMogr2/auto-orient/\" alt=\"img\"\u003e\u003c/p\u003e\n\u003cp\u003eOne more thing, I want to save the source data before send to socket port. So i open a file handle in the first whenever block:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$vin\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;LSJA0000000000091\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$last_meter\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# 当前里程数\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ereact\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ewhenever\u003c/span\u003e \u003cspan class=\"nn\"\u003eIO::Socket::\u003c/span\u003e\u003cspan class=\"n\"\u003eAsync\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;0.0.0.0\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e3333\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$conn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$fh\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eopen\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;events.txt\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"n\"\u003ew\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003ereact\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"n\"\u003eBool:D\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ignore\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003ewhenever\u003c/span\u003e \u003cspan class=\"n\"\u003eSupply\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einterval\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erotor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"nv\"\u003e$ignore\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nv\"\u003e$ignore\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003ewhenever\u003c/span\u003e \u003cspan class=\"n\"\u003eSupply\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einterval\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"k\"\u003enext\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ignore\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"nv\"\u003e$fh\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003esprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\\{\u0026#39;vin\u0026#39;:\u0026#39;%s\u0026#39;,\u0026#39;createTime\u0026#39;:%s,\u0026#39;mileage\u0026#39;:%s}\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$vin\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enow\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eposix\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$last_meter\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"nv\"\u003e$conn\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003esprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\\{\u0026#39;vin\u0026#39;:\u0026#39;%s\u0026#39;,\u0026#39;createTime\u0026#39;:%s,\u0026#39;mileage\u0026#39;:%s}\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$vin\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enow\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eposix\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$last_meter\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003ewhenever\u003c/span\u003e \u003cspan class=\"n\"\u003esignal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSIGINT\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;Done.\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"nv\"\u003e$fh\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003eclose\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"n\"\u003edone\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eCATCH\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003edefault\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"o\"\u003e.^\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;: \u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;handled in $?LINE\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003etype \u003cem\u003etelnet 0.0.0.0 3333\u003c/em\u003e in shell, watch the output:\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eTrying 0.0.0.0...\nConnected to 0.0.0.0.\nEscape character is \u0026#39;^]\u0026#39;.\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876852,\u0026#39;mileage\u0026#39;:1}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876853,\u0026#39;mileage\u0026#39;:3}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876854,\u0026#39;mileage\u0026#39;:5}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876855,\u0026#39;mileage\u0026#39;:7}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876856,\u0026#39;mileage\u0026#39;:9}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876867,\u0026#39;mileage\u0026#39;:11}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876868,\u0026#39;mileage\u0026#39;:13}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876869,\u0026#39;mileage\u0026#39;:15}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876870,\u0026#39;mileage\u0026#39;:17}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876871,\u0026#39;mileage\u0026#39;:19}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876882,\u0026#39;mileage\u0026#39;:21}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876883,\u0026#39;mileage\u0026#39;:23}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876884,\u0026#39;mileage\u0026#39;:25}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876885,\u0026#39;mileage\u0026#39;:27}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876886,\u0026#39;mileage\u0026#39;:29}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThe \u003cstrong\u003emileage\u003c/strong\u003e column looks a little weird, so the column in the \u003cem\u003eevents.txt\u003c/em\u003e:\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876852,\u0026#39;mileage\u0026#39;:0}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876853,\u0026#39;mileage\u0026#39;:2}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876854,\u0026#39;mileage\u0026#39;:4}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876855,\u0026#39;mileage\u0026#39;:6}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876856,\u0026#39;mileage\u0026#39;:8}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876867,\u0026#39;mileage\u0026#39;:10}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876868,\u0026#39;mileage\u0026#39;:12}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876869,\u0026#39;mileage\u0026#39;:14}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876870,\u0026#39;mileage\u0026#39;:16}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876871,\u0026#39;mileage\u0026#39;:18}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876882,\u0026#39;mileage\u0026#39;:20}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876883,\u0026#39;mileage\u0026#39;:22}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876884,\u0026#39;mileage\u0026#39;:24}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876885,\u0026#39;mileage\u0026#39;:26}\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876886,\u0026#39;mileage\u0026#39;:28}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003ebecause \u003ccode\u003e$last_meter++\u003c/code\u003e increased twice. I\u0026rsquo;d better use \u003ccode\u003e⚛++\u003c/code\u003e instead.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eRaku Is Writing For Fun, that is, -OFun.\u003c/p\u003e\n\u003c/blockquote\u003e\n","text":"While programming in Spark Streaming, I\u0026rsquo;d like to send some fake data to socket. although the command nc -lk 9999 is useful, but you have to type the data manually!\nWith Raku\u0026rsquo;s IO::Socket::Async module, I can easily send data to socket continuously.\nIn the server side, I listen a port on 3333, I will print the current time every second, every 5 seconds, skip the report of time:\nmy $vin = \u0026#39;LSJA0000000000091\u0026#39;; my $last_meter = 0; # 当前里程数 react { whenever IO::Socket::Async.listen(\u0026#39;0.0.0.0\u0026#39;, 3333) -\u0026gt; $conn { react { my Bool:D $ignore = True; whenever Supply.interval(5).rotor(1, 1 =\u0026gt; 1) { $ignore = !$ignore; } whenever Supply.interval(1) { next if $ignore; $conn.print: sprintf(\u0026#34;\\{\u0026#39;vin\u0026#39;:\u0026#39;%s\u0026#39;,\u0026#39;createTime\u0026#39;:%s,\u0026#39;mileage\u0026#39;:%s}\\n\u0026#34;, $vin, DateTime.now.posix, $last_meter++); } whenever signal(SIGINT) { say \u0026#34;Done.\u0026#34;; done; } } } CATCH { default { say .^name, \u0026#39;: \u0026#39;, .Str; say \u0026#34;handled in $?LINE\u0026#34;; } } } Awesome, almost less than 30 lines code.\nIn the client side, I use telnet 0.0.0.0 3333, which will output something like this:\nOne more thing, I want to save the source data before send to socket port. So i open a file handle in the first whenever block:\nmy $vin = \u0026#39;LSJA0000000000091\u0026#39;; my $last_meter = 0; # 当前里程数 react { whenever IO::Socket::Async.listen(\u0026#39;0.0.0.0\u0026#39;, 3333) -\u0026gt; $conn { my $fh = open \u0026#39;events.txt\u0026#39;, :w; react { my Bool:D $ignore = True; whenever Supply.interval(5).rotor(1, 1 =\u0026gt; 1) { $ignore = !$ignore; } whenever Supply.interval(1) { next if $ignore; $fh.print: sprintf(\u0026#34;\\{\u0026#39;vin\u0026#39;:\u0026#39;%s\u0026#39;,\u0026#39;createTime\u0026#39;:%s,\u0026#39;mileage\u0026#39;:%s}\\n\u0026#34;, $vin, DateTime.now.posix, $last_meter++); $conn.print: sprintf(\u0026#34;\\{\u0026#39;vin\u0026#39;:\u0026#39;%s\u0026#39;,\u0026#39;createTime\u0026#39;:%s,\u0026#39;mileage\u0026#39;:%s}\\n\u0026#34;, $vin, DateTime.now.posix, $last_meter++); } whenever signal(SIGINT) { say \u0026#34;Done.\u0026#34;; $fh.close; done; } } } CATCH { default { say .^name, \u0026#39;: \u0026#39;, .Str; say \u0026#34;handled in $?LINE\u0026#34;; } } } type telnet 0.0.0.0 3333 in shell, watch the output:\nTrying 0.0.0.0... Connected to 0.0.0.0. Escape character is \u0026#39;^]\u0026#39;. {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876852,\u0026#39;mileage\u0026#39;:1} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876853,\u0026#39;mileage\u0026#39;:3} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876854,\u0026#39;mileage\u0026#39;:5} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876855,\u0026#39;mileage\u0026#39;:7} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876856,\u0026#39;mileage\u0026#39;:9} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876867,\u0026#39;mileage\u0026#39;:11} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876868,\u0026#39;mileage\u0026#39;:13} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876869,\u0026#39;mileage\u0026#39;:15} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876870,\u0026#39;mileage\u0026#39;:17} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876871,\u0026#39;mileage\u0026#39;:19} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876882,\u0026#39;mileage\u0026#39;:21} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876883,\u0026#39;mileage\u0026#39;:23} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876884,\u0026#39;mileage\u0026#39;:25} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876885,\u0026#39;mileage\u0026#39;:27} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876886,\u0026#39;mileage\u0026#39;:29} The mileage column looks a little weird, so the column in the events.txt:\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876852,\u0026#39;mileage\u0026#39;:0} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876853,\u0026#39;mileage\u0026#39;:2} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876854,\u0026#39;mileage\u0026#39;:4} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876855,\u0026#39;mileage\u0026#39;:6} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876856,\u0026#39;mileage\u0026#39;:8} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876867,\u0026#39;mileage\u0026#39;:10} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876868,\u0026#39;mileage\u0026#39;:12} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876869,\u0026#39;mileage\u0026#39;:14} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876870,\u0026#39;mileage\u0026#39;:16} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876871,\u0026#39;mileage\u0026#39;:18} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876882,\u0026#39;mileage\u0026#39;:20} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876883,\u0026#39;mileage\u0026#39;:22} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876884,\u0026#39;mileage\u0026#39;:24} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876885,\u0026#39;mileage\u0026#39;:26} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1542876886,\u0026#39;mileage\u0026#39;:28} because $last_meter++ increased twice. I\u0026rsquo;d better use ⚛++ instead.\nRaku Is Writing For Fun, that is, -OFun.\n"},"name":"使用 Raku 发送数据到 Socket","published":"2018-11-18T14:52:06Z","summary":"While programming in Spark Streaming, I\u0026rsquo;d like to send some fake data to socket. although the command nc -lk 9999 is useful, but you have to type the data manually!\nWith Raku\u0026rsquo;s IO::Socket::Async module, I can easily send data to socket continuously.\nIn the server side, I listen a port on 3333, I will print the current time every second, every 5 seconds, skip the report of time:\nmy $vin = \u0026#39;LSJA0000000000091\u0026#39;; my $last_meter = 0; # 当前里程数 react { whenever IO::Socket::Async.","type":"entry","url":"https://ohmyweekly.github.io/notes/send-data-to-socket/"}