{"author":{"name":null,"type":"card","url":"https://ohmyweekly.github.io/"},"content":{"html":"\u003cp\u003e\u003ca href=\"https://mojolicious.org/perldoc/Minion\"\u003eMinion ä½œä¸šé˜Ÿåˆ—\u003c/a\u003eæ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œä½†æœ‰æ—¶æˆ‘éœ€è¦å°†å®ƒç”¨äºé Web é¡¹ç›®ã€‚é‚£ä¹ˆï¼Œå¦‚ä½•åœ¨ä¸éœ€è¦ \u003ca href=\"http://mojolicious.org/\"\u003eMojolicious\u003c/a\u003e Web åº”ç”¨ç¨‹åºçš„æƒ…å†µä¸‹ä½¿ç”¨ Minionï¼Ÿ\u003c/p\u003e\n\u003cp\u003eå¦‚æœæˆ‘æ²¡æœ‰è¶³å¤Ÿå¤§çš„å·¥ä½œéœ€è¦ \u003ca href=\"https://metacpan.org/pod/Beam::Minion\"\u003eBeam::Minion\u003c/a\u003e æä¾›çš„ä»»åŠ¡ç»„ç»‡ï¼Œè™½ç„¶ Minion å¯ä»¥ç”¨ä½œ\u003ca href=\"https://mojolicious.org/perldoc/Minion#SYNOPSIS\"\u003eå®Œå…¨ç‹¬ç«‹çš„åº“\u003c/a\u003eï¼Œä½†æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯æ„å»ºä¸€ä¸ª Mojolicious åº”ç”¨ç¨‹åºã€‚å¹¸è¿çš„æ˜¯ï¼Œä¸€ä¸ª Mojolicious åº”ç”¨ç¨‹åºå¯ä»¥åªæœ‰2è¡Œï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojolicious::Lite\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nn\"\u003eapp\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003estart\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eç°åœ¨ï¼Œå¦‚æœæˆ‘ä»æœªè¿è¡Œè¿‡ web å®ˆæŠ¤è¿›ç¨‹ï¼Œé‚£ä¹ˆè¿™ç»ä¸ä¼šæ˜¯ä¸€ä¸ªç½‘ç«™ã€‚é‚£ä¹ˆï¼Œå¦‚æœæ²¡æœ‰äººä½¿ç”¨ç½‘ç»œæµè§ˆå™¨è®¿é—®å®ƒï¼Œè¿™å¯ä»¥ç§°ä¸º Web åº”ç”¨ç¨‹åºå—ï¼ŸğŸ¤”\u003c/p\u003e\n\u003ch2 id=\"add-minion\"\u003eAdd Minion\u003c/h2\u003e\n\u003cp\u003eè¦ä½¿ç”¨ Minionï¼Œè¯·å°† Minion æ’ä»¶æ·»åŠ åˆ°åº”ç”¨ç¨‹åºã€‚å¯¹äºè¿™ä¸ªä¾‹å­ï¼Œæˆ‘å°†ä½¿ç”¨ \u003ca href=\"https://metacpan.org/pod/Minion::Backend::SQLite\"\u003eSQLite Minion åç«¯\u003c/a\u003eï¼Œè¿™æ ·æˆ‘å°±ä¸éœ€è¦è¿è¡Œå•ç‹¬çš„æ•°æ®åº“è¿›ç¨‹ï¼Œä½†å¦‚æœä½ æœ‰ä¸€ä¸ªæ¥å—è¿œç¨‹è¿æ¥çš„æ•°æ®åº“ï¼ŒMinion å¯ä»¥åœ¨å¤šå°æœºå™¨ä¸Šå·¥ä½œã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eplugin\u003c/span\u003e \u003cspan class=\"n\"\u003eMinion\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eSQLite\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;sqlite:\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e \u003cspan class=\"nn\"\u003eapp\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003ehome\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003echild\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;minion.db\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eåŠ è½½ Minion æ’ä»¶åï¼Œæˆ‘çš„åº”ç”¨ç¨‹åºè·å¾—äº†ä¸€äº›æ–°åŠŸèƒ½ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæˆ‘å¯ä»¥ä½¿ç”¨ \u003ca href=\"https://mojolicious.org/perldoc/Minion#add_task\"\u003eminion.add_task\u003c/a\u003e åŠ©æ‰‹ç¨‹åºæ·»åŠ  Minion ä»»åŠ¡ï¼ˆå¯è¿è¡Œçš„ä»£ç ï¼‰\u003c/li\u003e\n\u003cli\u003eæˆ‘å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼æ’é˜Ÿå·¥ä½œï¼š\n\u003cul\u003e\n\u003cli\u003eä»å‘½ä»¤è¡Œä½¿ç”¨ \u003ca href=\"https://mojolicious.org/perldoc/Minion/Command/minion/job\"\u003eminion job\u003c/a\u003e å‘½ä»¤\u003c/li\u003e\n\u003cli\u003eä»åº”ç”¨ç¨‹åºå†…éƒ¨ä½¿ç”¨ \u003ca href=\"https://mojolicious.org/perldoc/Minion#enqueue1\"\u003eminion.enqueue\u003c/a\u003e åŠ©æ‰‹ç¨‹åº\u003c/li\u003e\n\u003cli\u003eä»ä»»ä½• Perl è„šæœ¬åŠ è½½ Minion å¹¶ä½¿ç”¨ \u003ca href=\"https://mojolicious.org/perldoc/Minion#enqueue1\"\u003eenqueue\u003c/a\u003e æ–¹æ³•\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eæˆ‘å¯ä»¥ä½¿ç”¨ \u003ca href=\"https://mojolicious.org/perldoc/Minion/Command/minion/worker\"\u003eminion worker\u003c/a\u003e å‘½ä»¤è¿è¡Œä¸€ä¸ª Minion workerï¼Œå®ƒå°†æ‰§è¡Œä»»ä½•æ’é˜Ÿçš„ä½œä¸š\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"create-a-task\"\u003eCreate a Task\u003c/h2\u003e\n\u003cp\u003eæˆ‘å°†åˆ›å»ºä¸€ä¸ªåä¸º \u003ccode\u003echeck_url\u003c/code\u003e çš„ä»»åŠ¡æ¥æ£€æŸ¥ä¸‹è½½ URL æ‰€éœ€çš„æ—¶é—´ã€‚ \u003ca href=\"https://perldoc.perl.org/Time/HiRes.html\"\u003eTime::HiRes\u003c/a\u003e æ ¸å¿ƒæ¨¡å—å°†ä¸ºæˆ‘æä¾›é«˜åˆ†è¾¨ç‡æ—¶é—´ã€‚\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"ch\"\u003e#!/usr/bin/env perl\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nn\"\u003ev5\u003c/span\u003e\u003cspan class=\"mf\"\u003e.28\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojolicious::Lite\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nn\"\u003eexperimental\u003c/span\u003e \u003cspan class=\"sx\"\u003eqw( signatures )\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nn\"\u003eTime::HiRes\u003c/span\u003e \u003cspan class=\"sx\"\u003eqw( time )\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eplugin\u003c/span\u003e \u003cspan class=\"n\"\u003eMinion\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eSQLite\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;sqlite:\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e \u003cspan class=\"nn\"\u003eapp\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003ehome\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003echild\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;minion.db\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nn\"\u003eapp\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003eminion\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eadd_task\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003echeck_url\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003esub\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nv\"\u003e$job\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$url\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$start\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003etime\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$tx\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$job\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003eapp\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003eua\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ehead\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nv\"\u003e$url\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$elapsed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003etime\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"nv\"\u003e$start\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$job\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003eapp\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nb\"\u003elog\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003einfo\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nb\"\u003esprintf\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;Fetching %s took %.3f seconds\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$url\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$elapsed\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"c1\"\u003e# If there\u0026#39;s an error loading the web page, fail the job\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nv\"\u003e$tx\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nv\"\u003e$job\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003eapp\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nb\"\u003elog\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"nb\"\u003esprintf\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;Error loading URL (%s): %s (%s)\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"nv\"\u003e$url\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$tx\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e \u003cspan class=\"p\"\u003e}{\u003c/span\u003e\u003cspan class=\"sx\"\u003eqw( code message )\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"nv\"\u003e$job\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003efail\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"nb\"\u003esprintf\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;%s: %s\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e \u003cspan class=\"nv\"\u003e$tx\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eerror\u003c/span\u003e \u003cspan class=\"p\"\u003e}{\u003c/span\u003e\u003cspan class=\"sx\"\u003eqw( code message )\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$job\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003efinish\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nv\"\u003e$elapsed\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nn\"\u003eapp\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003estart\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"enqueuing-jobs\"\u003eEnqueuing Jobs\u003c/h2\u003e\n\u003cp\u003eç°åœ¨æˆ‘æœ‰ä¸€ä¸ªä»»åŠ¡ï¼Œæˆ‘å¯ä»¥æ’é˜Ÿä¸€äº›å·¥ä½œã€‚æˆ‘å¯ä»¥ä½¿ç”¨ \u003ca href=\"https://mojolicious.org/perldoc/Minion/Command/minion/job\"\u003eminion job\u003c/a\u003e å‘½ä»¤æ·»åŠ ä½œä¸šï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ perl myapp.pl minion job -e check_url -a \u003cspan class=\"s1\"\u003e\u0026#39;[\u0026#34;http://mojolicious.org\u0026#34;]\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eæˆ–è€…é€šè¿‡åŠ è½½Minionå¹¶ä½¿ç”¨ \u003ca href=\"https://mojolicious.org/perldoc/Minion#enqueue1\"\u003eenqueue æ–¹æ³•\u003c/a\u003e ä»å¦ä¸€ä¸ª Perl è„šæœ¬å†…éƒ¨ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"ch\"\u003e#!/usr/bin/env perl\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nn\"\u003eMinion\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$minion\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nn\"\u003eMinion\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003eSQLite\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;sqlite:minion.db\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"c1\"\u003e# The same database as the worker\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$minion\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eenqueue\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003echeck_url\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e[\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;http://mojolicious.org\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e],\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"running-a-worker\"\u003eRunning a Worker\u003c/h2\u003e\n\u003cp\u003eæˆ‘å·²ç»æ’é˜Ÿäº†å·¥ä½œï¼Œä½†æ²¡æœ‰å‘ç”Ÿä»»ä½•äº‹æƒ…ï¼Œç›´åˆ°æˆ‘ä½¿ç”¨ \u003ca href=\"https://mojolicious.org/perldoc/Minion/Command/minion/worker\"\u003eminion worker\u003c/a\u003e å‘½ä»¤è¿è¡Œä¸€ä¸ª worker æ‰ä¼šå‘ç”Ÿä»»ä½•äº‹æƒ…ï¼š\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ perl myapp.pl minion worker\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eä¸€æ—¦å·¥äººå¯åŠ¨ï¼Œå®ƒå°†ç«‹å³å¼€å§‹å¤„ç†æˆ‘å‘Šè¯‰å®ƒè¿è¡Œçš„å·¥ä½œã€‚\u003c/p\u003e\n\u003cp\u003eå°±æ˜¯è¿™æ ·ï¼æˆ‘åœ¨æ²¡æœ‰ Mojolicious Web åº”ç”¨ç¨‹åºçš„æƒ…å†µä¸‹ä½¿ç”¨ Minionã€‚æŸ¥çœ‹ \u003ca href=\"https://mojolicious.io/blog/2018/12/10/minion-stands-alone/minion.pl\"\u003eMinion åº”ç”¨ç¨‹åº\u003c/a\u003eçš„æºä»£ç å’Œ \u003ca href=\"https://mojolicious.io/blog/2018/12/10/minion-stands-alone/enqueue.pl\"\u003eenqueue.pl è„šæœ¬\u003c/a\u003eã€‚\u003c/p\u003e\n","text":"Minion ä½œä¸šé˜Ÿåˆ—æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œä½†æœ‰æ—¶æˆ‘éœ€è¦å°†å®ƒç”¨äºé Web é¡¹ç›®ã€‚é‚£ä¹ˆï¼Œå¦‚ä½•åœ¨ä¸éœ€è¦ Mojolicious Web åº”ç”¨ç¨‹åºçš„æƒ…å†µä¸‹ä½¿ç”¨ Minionï¼Ÿ\nå¦‚æœæˆ‘æ²¡æœ‰è¶³å¤Ÿå¤§çš„å·¥ä½œéœ€è¦ Beam::Minion æä¾›çš„ä»»åŠ¡ç»„ç»‡ï¼Œè™½ç„¶ Minion å¯ä»¥ç”¨ä½œå®Œå…¨ç‹¬ç«‹çš„åº“ï¼Œä½†æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯æ„å»ºä¸€ä¸ª Mojolicious åº”ç”¨ç¨‹åºã€‚å¹¸è¿çš„æ˜¯ï¼Œä¸€ä¸ª Mojolicious åº”ç”¨ç¨‹åºå¯ä»¥åªæœ‰2è¡Œï¼š\nuse Mojolicious::Lite; app-\u0026gt;start; ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»æœªè¿è¡Œè¿‡ web å®ˆæŠ¤è¿›ç¨‹ï¼Œé‚£ä¹ˆè¿™ç»ä¸ä¼šæ˜¯ä¸€ä¸ªç½‘ç«™ã€‚é‚£ä¹ˆï¼Œå¦‚æœæ²¡æœ‰äººä½¿ç”¨ç½‘ç»œæµè§ˆå™¨è®¿é—®å®ƒï¼Œè¿™å¯ä»¥ç§°ä¸º Web åº”ç”¨ç¨‹åºå—ï¼ŸğŸ¤”\nAdd Minion è¦ä½¿ç”¨ Minionï¼Œè¯·å°† Minion æ’ä»¶æ·»åŠ åˆ°åº”ç”¨ç¨‹åºã€‚å¯¹äºè¿™ä¸ªä¾‹å­ï¼Œæˆ‘å°†ä½¿ç”¨ SQLite Minion åç«¯ï¼Œè¿™æ ·æˆ‘å°±ä¸éœ€è¦è¿è¡Œå•ç‹¬çš„æ•°æ®åº“è¿›ç¨‹ï¼Œä½†å¦‚æœä½ æœ‰ä¸€ä¸ªæ¥å—è¿œç¨‹è¿æ¥çš„æ•°æ®åº“ï¼ŒMinion å¯ä»¥åœ¨å¤šå°æœºå™¨ä¸Šå·¥ä½œã€‚\nplugin Minion =\u0026gt; { SQLite =\u0026gt; \u0026#39;sqlite:\u0026#39; . app-\u0026gt;home-\u0026gt;child(\u0026#39;minion.db\u0026#39;), }; åŠ è½½ Minion æ’ä»¶åï¼Œæˆ‘çš„åº”ç”¨ç¨‹åºè·å¾—äº†ä¸€äº›æ–°åŠŸèƒ½ï¼š\næˆ‘å¯ä»¥ä½¿ç”¨ minion.add_task åŠ©æ‰‹ç¨‹åºæ·»åŠ  Minion ä»»åŠ¡ï¼ˆå¯è¿è¡Œçš„ä»£ç ï¼‰ æˆ‘å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼æ’é˜Ÿå·¥ä½œï¼š ä»å‘½ä»¤è¡Œä½¿ç”¨ minion job å‘½ä»¤ ä»åº”ç”¨ç¨‹åºå†…éƒ¨ä½¿ç”¨ minion.enqueue åŠ©æ‰‹ç¨‹åº ä»ä»»ä½• Perl è„šæœ¬åŠ è½½ Minion å¹¶ä½¿ç”¨ enqueue æ–¹æ³• æˆ‘å¯ä»¥ä½¿ç”¨ minion worker å‘½ä»¤è¿è¡Œä¸€ä¸ª Minion workerï¼Œå®ƒå°†æ‰§è¡Œä»»ä½•æ’é˜Ÿçš„ä½œä¸š Create a Task æˆ‘å°†åˆ›å»ºä¸€ä¸ªåä¸º check_url çš„ä»»åŠ¡æ¥æ£€æŸ¥ä¸‹è½½ URL æ‰€éœ€çš„æ—¶é—´ã€‚ Time::HiRes æ ¸å¿ƒæ¨¡å—å°†ä¸ºæˆ‘æä¾›é«˜åˆ†è¾¨ç‡æ—¶é—´ã€‚\n#!/usr/bin/env perl use v5.28; use Mojolicious::Lite; use experimental qw( signatures ); use Time::HiRes qw( time ); plugin Minion =\u0026gt; { SQLite =\u0026gt; \u0026#39;sqlite:\u0026#39; . app-\u0026gt;home-\u0026gt;child(\u0026#39;minion.db\u0026#39;), }; app-\u0026gt;minion-\u0026gt;add_task( check_url =\u0026gt; sub( $job, $url ) { my $start = time; my $tx = $job-\u0026gt;app-\u0026gt;ua-\u0026gt;head( $url ); my $elapsed = time - $start; $job-\u0026gt;app-\u0026gt;log-\u0026gt;info( sprintf \u0026#39;Fetching %s took %.3f seconds\u0026#39;, $url, $elapsed ); # If there\u0026#39;s an error loading the web page, fail the job if ( $tx-\u0026gt;error ) { $job-\u0026gt;app-\u0026gt;log-\u0026gt;error( sprintf \u0026#39;Error loading URL (%s): %s (%s)\u0026#39;, $url, @{ $tx-\u0026gt;error }{qw( code message )}, ); return $job-\u0026gt;fail( sprintf \u0026#39;%s: %s\u0026#39;, @{ $tx-\u0026gt;error }{qw( code message )} ); } $job-\u0026gt;finish( $elapsed ); }, ); app-\u0026gt;start; Enqueuing Jobs ç°åœ¨æˆ‘æœ‰ä¸€ä¸ªä»»åŠ¡ï¼Œæˆ‘å¯ä»¥æ’é˜Ÿä¸€äº›å·¥ä½œã€‚æˆ‘å¯ä»¥ä½¿ç”¨ minion job å‘½ä»¤æ·»åŠ ä½œä¸šï¼š\n$ perl myapp.pl minion job -e check_url -a \u0026#39;[\u0026#34;http://mojolicious.org\u0026#34;]\u0026#39; æˆ–è€…é€šè¿‡åŠ è½½Minionå¹¶ä½¿ç”¨ enqueue æ–¹æ³• ä»å¦ä¸€ä¸ª Perl è„šæœ¬å†…éƒ¨ï¼š\n#!/usr/bin/env perl use Minion; my $minion = Minion-\u0026gt;new( SQLite =\u0026gt; \u0026#39;sqlite:minion.db\u0026#39;, # The same database as the worker ); $minion-\u0026gt;enqueue( check_url =\u0026gt; [\u0026#39;http://mojolicious.org\u0026#39;], ); Running a Worker æˆ‘å·²ç»æ’é˜Ÿäº†å·¥ä½œï¼Œä½†æ²¡æœ‰å‘ç”Ÿä»»ä½•äº‹æƒ…ï¼Œç›´åˆ°æˆ‘ä½¿ç”¨ minion worker å‘½ä»¤è¿è¡Œä¸€ä¸ª worker æ‰ä¼šå‘ç”Ÿä»»ä½•äº‹æƒ…ï¼š\n$ perl myapp.pl minion worker ä¸€æ—¦å·¥äººå¯åŠ¨ï¼Œå®ƒå°†ç«‹å³å¼€å§‹å¤„ç†æˆ‘å‘Šè¯‰å®ƒè¿è¡Œçš„å·¥ä½œã€‚\nå°±æ˜¯è¿™æ ·ï¼æˆ‘åœ¨æ²¡æœ‰ Mojolicious Web åº”ç”¨ç¨‹åºçš„æƒ…å†µä¸‹ä½¿ç”¨ Minionã€‚æŸ¥çœ‹ Minion åº”ç”¨ç¨‹åºçš„æºä»£ç å’Œ enqueue.pl è„šæœ¬ã€‚\n"},"name":"ç¬¬åå¤© - Minion Stands Alone","published":"2018-12-10T22:49:38Z","summary":"Minion ä½œä¸šé˜Ÿåˆ—æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œä½†æœ‰æ—¶æˆ‘éœ€è¦å°†å®ƒç”¨äºé Web é¡¹ç›®ã€‚é‚£ä¹ˆï¼Œå¦‚ä½•åœ¨ä¸éœ€è¦ Mojolicious Web åº”ç”¨ç¨‹åºçš„æƒ…å†µä¸‹ä½¿ç”¨ Minionï¼Ÿ\nå¦‚æœæˆ‘æ²¡æœ‰è¶³å¤Ÿå¤§çš„å·¥ä½œéœ€è¦ Beam::Minion æä¾›çš„ä»»åŠ¡ç»„ç»‡ï¼Œè™½ç„¶ Minion å¯ä»¥ç”¨ä½œå®Œå…¨ç‹¬ç«‹çš„åº“ï¼Œä½†æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯æ„å»ºä¸€ä¸ª Mojolicious åº”ç”¨ç¨‹åºã€‚å¹¸è¿çš„æ˜¯ï¼Œä¸€ä¸ª Mojolicious åº”ç”¨ç¨‹åºå¯ä»¥åªæœ‰2è¡Œï¼š\nuse Mojolicious::Lite; app-\u0026gt;start; ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»æœªè¿è¡Œè¿‡ web å®ˆæŠ¤è¿›ç¨‹ï¼Œé‚£ä¹ˆè¿™ç»ä¸ä¼šæ˜¯ä¸€ä¸ªç½‘ç«™ã€‚é‚£ä¹ˆï¼Œå¦‚æœæ²¡æœ‰äººä½¿ç”¨ç½‘ç»œæµè§ˆå™¨è®¿é—®å®ƒï¼Œè¿™å¯ä»¥ç§°ä¸º Web åº”ç”¨ç¨‹åºå—ï¼ŸğŸ¤”\nAdd Minion è¦ä½¿ç”¨ Minionï¼Œè¯·å°† Minion æ’ä»¶æ·»åŠ åˆ°åº”ç”¨ç¨‹åºã€‚å¯¹äºè¿™ä¸ªä¾‹å­ï¼Œæˆ‘å°†ä½¿ç”¨ SQLite Minion åç«¯ï¼Œè¿™æ ·æˆ‘å°±ä¸éœ€è¦è¿è¡Œå•ç‹¬çš„æ•°æ®åº“è¿›ç¨‹ï¼Œä½†å¦‚æœä½ æœ‰ä¸€ä¸ªæ¥å—è¿œç¨‹è¿æ¥çš„æ•°æ®åº“ï¼ŒMinion å¯ä»¥åœ¨å¤šå°æœºå™¨ä¸Šå·¥ä½œã€‚\nplugin Minion =\u0026gt; { SQLite =\u0026gt; \u0026#39;sqlite:\u0026#39; . app-\u0026gt;home-\u0026gt;child(\u0026#39;minion.db\u0026#39;), }; åŠ è½½ Minion æ’ä»¶åï¼Œæˆ‘çš„åº”ç”¨ç¨‹åºè·å¾—äº†ä¸€äº›æ–°åŠŸèƒ½ï¼š\næˆ‘å¯ä»¥ä½¿ç”¨ minion.add_task åŠ©æ‰‹ç¨‹åºæ·»åŠ  Minion ä»»åŠ¡ï¼ˆå¯è¿è¡Œçš„ä»£ç ï¼‰ æˆ‘å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼æ’é˜Ÿå·¥ä½œï¼š ä»å‘½ä»¤è¡Œä½¿ç”¨ minion job å‘½ä»¤ ä»åº”ç”¨ç¨‹åºå†…éƒ¨ä½¿ç”¨ minion.enqueue åŠ©æ‰‹ç¨‹åº ä»ä»»ä½• Perl è„šæœ¬åŠ è½½ Minion å¹¶ä½¿ç”¨ enqueue æ–¹æ³• æˆ‘å¯ä»¥ä½¿ç”¨ minion worker å‘½ä»¤è¿è¡Œä¸€ä¸ª Minion workerï¼Œå®ƒå°†æ‰§è¡Œä»»ä½•æ’é˜Ÿçš„ä½œä¸š Create a Task æˆ‘å°†åˆ›å»ºä¸€ä¸ªåä¸º check_url çš„ä»»åŠ¡æ¥æ£€æŸ¥ä¸‹è½½ URL æ‰€éœ€çš„æ—¶é—´ã€‚ Time::HiRes æ ¸å¿ƒæ¨¡å—å°†ä¸ºæˆ‘æä¾›é«˜åˆ†è¾¨ç‡æ—¶é—´ã€‚","type":"entry","url":"https://ohmyweekly.github.io/notes/minion-stands-alone/"}