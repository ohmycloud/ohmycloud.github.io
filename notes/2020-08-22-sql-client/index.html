<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">

    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
    
    
    

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5">

    
    <meta name="referrer" content="no-referrer">

    <title>
        
            SQL 客户端 ❚ 焉知非鱼
        
    </title>

    
    


    
    
    
    

    
    
    
    

    
    
    

    
    
    
    <style>
     
     
     :root {
         --theme-color: #ac4142;
         --theme-color-light: rgba(172, 65, 66, 0.2);
     }
     
     html {
         line-height: 1.5;
     }
    </style>

    
    

    
    
    
    
    <link rel="stylesheet" href="/css/refined.min.61b1de55623520dab99b70e9e2298001fb97241583a47396e2f10feb789e300d.css">
    
    <link rel="preload" href="/css/refined.min.61b1de55623520dab99b70e9e2298001fb97241583a47396e2f10feb789e300d.css" as="style">

    



    
        <style>
         
         /* Background */ .chroma { background-color: #ffffff }
/* Error */ .chroma .err { color: #a61717; background-color: #e3d2d2 }
/* LineTableTD */ .chroma .lntd { vertical-align: top; padding: 0; margin: 0; border: 0; }
/* LineTable */ .chroma .lntable { border-spacing: 0; padding: 0; margin: 0; border: 0; width: auto; overflow: auto; display: block; }
/* LineHighlight */ .chroma .hl { display: block; width: 100%;background-color: #ffffcc }
/* LineNumbersTable */ .chroma .lnt { margin-right: 0.4em; padding: 0 0.4em 0 0.4em; }
/* LineNumbers */ .chroma .ln { margin-right: 0.4em; padding: 0 0.4em 0 0.4em; }
/* Keyword */ .chroma .k { color: #000000; font-weight: bold }
/* KeywordConstant */ .chroma .kc { color: #000000; font-weight: bold }
/* KeywordDeclaration */ .chroma .kd { color: #000000; font-weight: bold }
/* KeywordNamespace */ .chroma .kn { color: #000000; font-weight: bold }
/* KeywordPseudo */ .chroma .kp { color: #000000; font-weight: bold }
/* KeywordReserved */ .chroma .kr { color: #000000; font-weight: bold }
/* KeywordType */ .chroma .kt { color: #445588; font-weight: bold }
/* NameAttribute */ .chroma .na { color: #008080 }
/* NameBuiltin */ .chroma .nb { color: #0086b3 }
/* NameBuiltinPseudo */ .chroma .bp { color: #999999 }
/* NameClass */ .chroma .nc { color: #445588; font-weight: bold }
/* NameConstant */ .chroma .no { color: #008080 }
/* NameDecorator */ .chroma .nd { color: #3c5d5d; font-weight: bold }
/* NameEntity */ .chroma .ni { color: #800080 }
/* NameException */ .chroma .ne { color: #990000; font-weight: bold }
/* NameFunction */ .chroma .nf { color: #990000; font-weight: bold }
/* NameLabel */ .chroma .nl { color: #990000; font-weight: bold }
/* NameNamespace */ .chroma .nn { color: #555555 }
/* NameTag */ .chroma .nt { color: #000080 }
/* NameVariable */ .chroma .nv { color: #008080 }
/* NameVariableClass */ .chroma .vc { color: #008080 }
/* NameVariableGlobal */ .chroma .vg { color: #008080 }
/* NameVariableInstance */ .chroma .vi { color: #008080 }
/* LiteralString */ .chroma .s { color: #dd1144 }
/* LiteralStringAffix */ .chroma .sa { color: #dd1144 }
/* LiteralStringBacktick */ .chroma .sb { color: #dd1144 }
/* LiteralStringChar */ .chroma .sc { color: #dd1144 }
/* LiteralStringDelimiter */ .chroma .dl { color: #dd1144 }
/* LiteralStringDoc */ .chroma .sd { color: #dd1144 }
/* LiteralStringDouble */ .chroma .s2 { color: #dd1144 }
/* LiteralStringEscape */ .chroma .se { color: #dd1144 }
/* LiteralStringHeredoc */ .chroma .sh { color: #dd1144 }
/* LiteralStringInterpol */ .chroma .si { color: #dd1144 }
/* LiteralStringOther */ .chroma .sx { color: #dd1144 }
/* LiteralStringRegex */ .chroma .sr { color: #009926 }
/* LiteralStringSingle */ .chroma .s1 { color: #dd1144 }
/* LiteralStringSymbol */ .chroma .ss { color: #990073 }
/* LiteralNumber */ .chroma .m { color: #009999 }
/* LiteralNumberBin */ .chroma .mb { color: #009999 }
/* LiteralNumberFloat */ .chroma .mf { color: #009999 }
/* LiteralNumberHex */ .chroma .mh { color: #009999 }
/* LiteralNumberInteger */ .chroma .mi { color: #009999 }
/* LiteralNumberIntegerLong */ .chroma .il { color: #009999 }
/* LiteralNumberOct */ .chroma .mo { color: #009999 }
/* Operator */ .chroma .o { color: #000000; font-weight: bold }
/* OperatorWord */ .chroma .ow { color: #000000; font-weight: bold }
/* Comment */ .chroma .c { color: #999988; font-style: italic }
/* CommentHashbang */ .chroma .ch { color: #999988; font-style: italic }
/* CommentMultiline */ .chroma .cm { color: #999988; font-style: italic }
/* CommentSingle */ .chroma .c1 { color: #999988; font-style: italic }
/* CommentSpecial */ .chroma .cs { color: #999999; font-weight: bold; font-style: italic }
/* CommentPreproc */ .chroma .cp { color: #999999; font-weight: bold; font-style: italic }
/* CommentPreprocFile */ .chroma .cpf { color: #999999; font-weight: bold; font-style: italic }
/* GenericDeleted */ .chroma .gd { color: #000000; background-color: #ffdddd }
/* GenericEmph */ .chroma .ge { color: #000000; font-style: italic }
/* GenericError */ .chroma .gr { color: #aa0000 }
/* GenericHeading */ .chroma .gh { color: #999999 }
/* GenericInserted */ .chroma .gi { color: #000000; background-color: #ddffdd }
/* GenericOutput */ .chroma .go { color: #888888 }
/* GenericPrompt */ .chroma .gp { color: #555555 }
/* GenericStrong */ .chroma .gs { font-weight: bold }
/* GenericSubheading */ .chroma .gu { color: #aaaaaa }
/* GenericTraceback */ .chroma .gt { color: #aa0000 }
/* GenericUnderline */ .chroma .gl { text-decoration: underline }
/* TextWhitespace */ .chroma .w { color: #bbbbbb }

         
         /* Overrides on top of the theme and Chroma CSS */
/* Chroma-based lines highlighting in code blocks */
.chroma .hl {
    background-color: #e8e8e8;
    /* Extend highlight up to 100 characters (assuming that the code blocks never have more than 100 characters in a line) */
    min-width: 100ch;
}
/* GenericHeading */ .chroma .gh { color: #999999; font-weight: bold }
/* GenericSubheading */ .chroma .gu { color: #aaaaaa; font-weight: bold }

         
        </style>
    

    

    
    
    

    
    <script src="/js/responsive-nav-orig.min.355eebd835ac8071d56b337f68ffbbddc0f6487625599895e3e0b0461e791ebb.js"></script>
    
    <link rel="preload" href="/js/responsive-nav-orig.min.355eebd835ac8071d56b337f68ffbbddc0f6487625599895e3e0b0461e791ebb.js" as="script">

    
    
    <script defer src="/js/libs/fa/fontawesome-all.min.78bd3583027f40ce4330d39e1f1df56bda5f4af819aac2d0214ba529918c9e95.js"></script>
    
    <link rel="preload" href="/js/libs/fa/fontawesome-all.min.78bd3583027f40ce4330d39e1f1df56bda5f4af819aac2d0214ba529918c9e95.js" as="script">

    

    

    
    
    

    
    
<!-- rel="me" links for IndieAuth -->







    
 
<meta property="og:title" content="SQL 客户端" />
<meta property="og:description"
      content="SQL Client" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ohmyweekly.github.io/notes/2020-08-22-sql-client/" />


    
        <meta property="article:published_time" content="2020-08-22T00:00:00&#43;08:00"/>
    
    
        <meta property="article:modified_time" content="2020-08-22T00:00:00&#43;08:00"/>
    









    




     <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SQL 客户端"/>
<meta name="twitter:description" content="SQL Client"/>


    
    
    <link rel="alternate" type="application/jf2post+json" href="https://ohmyweekly.github.io/notes/2020-08-22-sql-client/jf2post.json" title="Jf2post for 焉知非鱼" />
    
     



    
    
    
        
    


     
        
        <meta name="DC.Creator" content="焉知非鱼"/>
    



    
    
    
    <meta name="hugo-build-date" content=""/>
    <meta name="hugo-commit-hash" content=""/>
    <meta name="generator" content="Hugo 0.79.0" />
</head>


    
        <body lang="en">
    

        
        <div class="border" id="home"></div>

        <div class="wrapper">   
            
<nav id="nav" class="nav-collapse opened" aria-hidden="false">
    <ul class="navbar">
        <li><a class="" href="/">Home</a></li>
        
            
                <li><a class="" href="https://ohmyweekly.github.io/posts/">Posts</a></li>
            
        
            
                <li><a class="" href="https://ohmyweekly.github.io/notes/">Notes</a></li>
            
        
        
            <li><a class="" href="https://ohmyweekly.github.io/search/">Search</a></li>
        
    </ul>
</nav>

            <div class="container">
                <header class="masthead">
                    <div class="masthead-title no-text-decoration">
                        <a href="/">焉知非鱼</a> <span class="blinking-cursor">❚</span>
                    </div>
                    <div class="masthead-tagline">
                        rakulang, dartlang, nimlang, golang, rustlang, lang lang no see
                    </div>
                </header>

                








<article class="post h-entry notes">
    <header>
        <div class="center">
    <div class="taxo no-text-decoration">
         
            
                <ul class="no-bullets inline categories">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__flink__"
                                
                                
                                title="See all 74 posts categorized in ‘Flink’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/categories/flink/">Flink</a>
                            </li>
                        
                    
                </ul>
            
         
            
                <ul class="no-bullets inline tags">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__flink__"
                                
                                
                                title="See all 93 posts tagged with ‘Flink’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/tags/flink/">Flink</a>
                            </li>
                        
                    
                        
                        
                        
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__table-api-sql__"
                                
                                
                                title="See all 35 posts tagged with ‘Table API &amp; SQL’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/tags/table-api-sql/">Table API &amp; SQL</a>
                            </li>
                        
                    
                </ul>
            
        
    </div>

</div>

        <h1 class="post-title p-name">SQL 客户端</h1>

        
        <data class="u-url" value="https://ohmyweekly.github.io/notes/2020-08-22-sql-client/"></data>

        <div class="date-syndication">
            


    
    
    <div class="post-date">
        
        <time datetime="2020-08-22T00:00:00+0800" class="dt-published">Sat Aug 22, 2020</time>
        
        
    </div>


            




        </div>
         



    
    
    
        
    


    
        
        <span class="hide">
            &mdash; <a href="https://ohmyweekly.github.io" class="u-author">焉知非鱼</a>
        </span>
    


    </header>

    <div class="content">
        
    <div class="description p-summary">
        
        
        
        
        
            
            
        
        <p>SQL Client</p>
    </div>



        





                       


        <div class="e-content">
            




<h2 id="sql-client">SQL Client&nbsp;<a class="headline-hash no-text-decoration" href="#sql-client">#</a> </h2>
<p>Flink 的 Table &amp; SQL API 使得它可以使用 SQL 语言编写的查询，但是这些查询需要嵌入到一个用 Java 或 Scala 编写的表程序中。而且，这些程序在提交给集群之前需要用构建工具打包。这或多或少限制了 Flink 对 Java/Scala 程序员的使用。</p>
<p>SQL Client 旨在提供一种简单的方式来编写、调试和提交表程序到 Flink 集群，而不需要任何一行 Java 或 Scala 代码。SQL Client CLI 允许在命令行上从运行的分布式应用中检索和可视化实时结果。</p>
<p><img src="https://ci.apache.org/projects/flink/flink-docs-release-1.11/fig/sql_client_demo.gif" alt="img"></p>
<h2 id="入门">入门&nbsp;<a class="headline-hash no-text-decoration" href="#入门">#</a> </h2>
<p>本节介绍如何从命令行设置和运行第一个 Flink SQL 程序。</p>
<p>SQL Client 被捆绑在常规的 Flink 发行版中，因此可以开箱即运行。它只需要一个正在运行的 Flink 集群，在那里可以执行表程序。关于设置 Flink 集群的更多信息，请参见<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/ops/deployment/cluster_setup.html">集群和部署</a>部分。如果你只是想试用 SQL Client，也可以使用下面的命令用一个 worker 启动一个本地集群。</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">./bin/start-cluster.sh
</code></pre></div><h3 id="启动-sql-客户端-cli">启动 SQL 客户端 CLI&nbsp;<a class="headline-hash no-text-decoration" href="#启动-sql-客户端-cli">#</a> </h3>
<p>SQL Client 脚本也位于 Flink 的二进制目录中。<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/sqlClient.html#limitations--future">在未来</a>，用户将有两种启动 SQL Client CLI 的可能性，一是通过启动一个嵌入式的独立进程，二是通过连接到一个远程 SQL Client 网关。目前只支持嵌入式模式。你可以通过调用来启动 CLI。</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">./bin/sql-client.sh embedded
</code></pre></div><p>默认情况下，SQL 客户端将从位于 <code>./conf/sql-client-defaults.yaml</code> 的环境文件中读取其配置。有关环境文件结构的更多信息，请参见<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/sqlClient.html#environment-files">配置部分</a>。</p>
<h3 id="运行-sql-查询">运行 SQL 查询&nbsp;<a class="headline-hash no-text-decoration" href="#运行-sql-查询">#</a> </h3>
<p>一旦启动 CLI，您可以使用 HELP 命令列出所有可用的 SQL 语句。为了验证你的设置和集群连接，你可以输入第一个 SQL 查询，然后按回车键执行。</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="s1">&#39;Hello World&#39;</span><span class="p">;</span>
</code></pre></div><p>这个查询不需要表源(table source)，并产生一个单行结果。CLI 将从集群中检索结果，并将其可视化。您可以按Q键关闭结果视图。</p>
<p>CLI 支持三种模式来维护和可视化结果。</p>
<p>table 模式将结果在内存中具体化，并以常规的、分页的表格表示方式将其可视化。可以通过在 CLI 中执行以下命令启用该模式。</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">SET execution.result-mode<span class="o">=</span>table<span class="p">;</span>
</code></pre></div><p><strong>changelog</strong> 模式不将结果具体化，而是将由插入(+)和收回(-)组成的<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/streaming/dynamic_tables.html#continuous-queries">连续查询</a>所产生的结果流可视化。</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">SET execution.result-mode<span class="o">=</span>changelog<span class="p">;</span>
</code></pre></div><p><strong>tableau</strong> 模式更像是传统的方式，将结果以 tableau 的形式直接显示在屏幕上。显示内容会受到查询执行类型(execute.type)的影响。</p>
<div class="highlight"><pre class="chroma"><code class="language-shell" data-lang="shell">SET execution.result-mode<span class="o">=</span>tableau<span class="p">;</span>
</code></pre></div><p>请注意，当您使用此模式进行流式查询时，结果将在控制台中连续打印。如果这个查询的输入数据是有边界的，那么在Flink处理完所有输入数据后，作业就会终止，打印也会自动停止。否则，如果你想终止一个正在运行的查询，在这种情况下只要输入CTRL-C键，作业和打印就会停止。</p>
<p>你可以使用下面的查询来查看所有的结果模式。</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="n">name</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">AS</span> <span class="n">cnt</span> <span class="k">FROM</span> <span class="p">(</span><span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;Bob&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Alice&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Greg&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Bob&#39;</span><span class="p">))</span> <span class="k">AS</span> <span class="n">NameTable</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">name</span><span class="p">;</span>
</code></pre></div><p>这个查询执行一个有界字数的例子。</p>
<p>在 changelog 模式下，可视化的 changelog 应该类似于。</p>
<pre><code>+ Bob, 1
+ Alice, 1
+ Greg, 1
- Bob, 1
+ Bob, 2
</code></pre><p>在 table 模式下，可视化的结果表会持续更新，直到表程序结束。</p>
<pre><code>Bob, 2
Alice, 1
Greg, 1
</code></pre><p>在tableau模式下，如果你在流模式下运行查询，显示的结果将是。</p>
<pre><code>+-----+----------------------+----------------------+
| +/- |                 name |                  cnt |
+-----+----------------------+----------------------+
|   + |                  Bob |                    1 |
|   + |                Alice |                    1 |
|   + |                 Greg |                    1 |
|   - |                  Bob |                    1 |
|   + |                  Bob |                    2 |
+-----+----------------------+----------------------+
Received a total of 5 rows
</code></pre><p>而如果你在批处理模式下运行查询，显示的结果将是。</p>
<pre><code>+-------+-----+
|  name | cnt |
+-------+-----+
| Alice |   1 |
|   Bob |   2 |
|  Greg |   1 |
+-------+-----+
3 rows in set
</code></pre><p>在 SQL 查询的原型设计过程中，所有这些结果模式都是有用的。在所有这些模式中，结果都存储在 SQL 客户端的 Java 堆内存中。为了保持CLI界面的响应性，changelog 模式只显示最新的1000个变化。表模式允许浏览更大的结果，这些结果仅受可用主内存和配置的最大行数（<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/sqlClient.html#configuration">max-table-result-rows</a>）的限制。</p>
<p>注意：在批处理环境中执行的查询，只能使用table或tableau结果模式进行检索。</p>
<p>在定义了一个查询后，可以将其作为一个长期运行的、分离的 Flink 作业提交给集群。为此，需要使用 <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/sqlClient.html#detached-sql-queries">INSERT INTO 语句</a>指定存储结果的目标系统。<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/sqlClient.html#configurations">配置部分</a>解释了如何声明 table source 以读取数据，如何声明 table sink 以写入数据，以及如何配置其他表程序属性。</p>
<h2 id="配置">配置&nbsp;<a class="headline-hash no-text-decoration" href="#配置">#</a> </h2>
<p>SQL Client 可以通过以下可选的CLI命令来启动。这些命令将在后面的段落中详细讨论。</p>
<pre><code>./bin/sql-client.sh embedded --help

Mode &quot;embedded&quot; submits Flink jobs from the local machine.

  Syntax: embedded [OPTIONS]
  &quot;embedded&quot; mode options:
     -d,--defaults &lt;environment file&gt;      The environment properties with which
                                           every new session is initialized.
                                           Properties might be overwritten by
                                           session properties.
     -e,--environment &lt;environment file&gt;   The environment properties to be
                                           imported into the session. It might
                                           overwrite default environment
                                           properties.
     -h,--help                             Show the help message with
                                           descriptions of all options.
     -hist,--history &lt;History file path&gt;   The file which you want to save the
                                           command history into. If not
                                           specified, we will auto-generate one
                                           under your user's home directory.
     -j,--jar &lt;JAR file&gt;                   A JAR file to be imported into the
                                           session. The file might contain
                                           user-defined classes needed for the
                                           execution of statements such as
                                           functions, table sources, or sinks.
                                           Can be used multiple times.
     -l,--library &lt;JAR directory&gt;          A JAR file directory with which every
                                           new session is initialized. The files
                                           might contain user-defined classes
                                           needed for the execution of
                                           statements such as functions, table
                                           sources, or sinks. Can be used
                                           multiple times.
     -pyarch,--pyArchives &lt;arg&gt;            Add python archive files for job. The
                                           archive files will be extracted to
                                           the working directory of python UDF
                                           worker. Currently only zip-format is
                                           supported. For each archive file, a
                                           target directory be specified. If the
                                           target directory name is specified,
                                           the archive file will be extracted to
                                           a name can directory with the
                                           specified name. Otherwise, the
                                           archive file will be extracted to a
                                           directory with the same name of the
                                           archive file. The files uploaded via
                                           this option are accessible via
                                           relative path. '#' could be used as
                                           the separator of the archive file
                                           path and the target directory name.
                                           Comma (',') could be used as the
                                           separator to specify multiple archive
                                           files. This option can be used to
                                           upload the virtual environment, the
                                           data files used in Python UDF (e.g.:
                                           --pyArchives
                                           file:///tmp/py37.zip,file:///tmp/data
                                           .zip#data --pyExecutable
                                           py37.zip/py37/bin/python). The data
                                           files could be accessed in Python
                                           UDF, e.g.: f = open('data/data.txt',
                                           'r').
     -pyexec,--pyExecutable &lt;arg&gt;          Specify the path of the python
                                           interpreter used to execute the
                                           python UDF worker (e.g.:
                                           --pyExecutable
                                           /usr/local/bin/python3). The python
                                           UDF worker depends on Python 3.5+,
                                           Apache Beam (version == 2.19.0), Pip
                                           (version &gt;= 7.1.0) and SetupTools
                                           (version &gt;= 37.0.0). Please ensure
                                           that the specified environment meets
                                           the above requirements.
     -pyfs,--pyFiles &lt;pythonFiles&gt;         Attach custom python files for job.
                                           These files will be added to the
                                           PYTHONPATH of both the local client
                                           and the remote python UDF worker. The
                                           standard python resource file
                                           suffixes such as .py/.egg/.zip or
                                           directory are all supported. Comma
                                           (',') could be used as the separator
                                           to specify multiple files (e.g.:
                                           --pyFiles
                                           file:///tmp/myresource.zip,hdfs:///$n
                                           amenode_address/myresource2.zip).
     -pyreq,--pyRequirements &lt;arg&gt;         Specify a requirements.txt file which
                                           defines the third-party dependencies.
                                           These dependencies will be installed
                                           and added to the PYTHONPATH of the
                                           python UDF worker. A directory which
                                           contains the installation packages of
                                           these dependencies could be specified
                                           optionally. Use '#' as the separator
                                           if the optional parameter exists
                                           (e.g.: --pyRequirements
                                           file:///tmp/requirements.txt#file:///
                                           tmp/cached_dir).
     -s,--session &lt;session identifier&gt;     The identifier for a session.
                                           'default' is the default identifier.
     -u,--update &lt;SQL update statement&gt;    Experimental (for testing only!):
                                           Instructs the SQL Client to
                                           immediately execute the given update
                                           statement after starting up. The
                                           process is shut down after the
                                           statement has been submitted to the
                                           cluster and returns an appropriate
                                           return code. Currently, this feature
                                           is only supported for INSERT INTO
                                           statements that declare the target
                                           sink table.

</code></pre><h3 id="环境文件">环境文件&nbsp;<a class="headline-hash no-text-decoration" href="#环境文件">#</a> </h3>
<p>一个SQL查询需要一个配置环境来执行。所谓的环境文件定义了可用的目录(catalogs)、table source 和 sink、用户定义的函数以及执行和部署所需的其他属性。</p>
<p>每个环境文件都是一个常规的 <a href="http://yaml.org/">YAML 文件</a>。下面是这样一个文件的例子。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="c"># Define tables here such as sources, sinks, views, or temporal tables.</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="nt">tables</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">MyTableSource</span><span class="w">
</span><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">source-table</span><span class="w">
</span><span class="w">    </span><span class="nt">update-mode</span><span class="p">:</span><span class="w"> </span><span class="l">append</span><span class="w">
</span><span class="w">    </span><span class="nt">connector</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">filesystem</span><span class="w">
</span><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/path/to/something.csv&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">format</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">csv</span><span class="w">
</span><span class="w">      </span><span class="nt">fields</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">MyField1</span><span class="w">
</span><span class="w">          </span><span class="nt">data-type</span><span class="p">:</span><span class="w"> </span><span class="l">INT</span><span class="w">
</span><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">MyField2</span><span class="w">
</span><span class="w">          </span><span class="nt">data-type</span><span class="p">:</span><span class="w"> </span><span class="l">VARCHAR</span><span class="w">
</span><span class="w">      </span><span class="nt">line-delimiter</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;\n&#34;</span><span class="w">
</span><span class="w">      </span><span class="nt">comment-prefix</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;#&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">schema</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">MyField1</span><span class="w">
</span><span class="w">        </span><span class="nt">data-type</span><span class="p">:</span><span class="w"> </span><span class="l">INT</span><span class="w">
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">MyField2</span><span class="w">
</span><span class="w">        </span><span class="nt">data-type</span><span class="p">:</span><span class="w"> </span><span class="l">VARCHAR</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">MyCustomView</span><span class="w">
</span><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">view</span><span class="w">
</span><span class="w">    </span><span class="nt">query</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;SELECT MyField2 FROM MyTableSource&#34;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c"># Define user-defined functions here.</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="nt">functions</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">myUDF</span><span class="w">
</span><span class="w">    </span><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l">class</span><span class="w">
</span><span class="w">    </span><span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l">foo.bar.AggregateUDF</span><span class="w">
</span><span class="w">    </span><span class="nt">constructor</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="m">7.6</span><span class="w">
</span><span class="w">      </span>- <span class="kc">false</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c"># Define available catalogs</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="nt">catalogs</span><span class="p">:</span><span class="w">
</span><span class="w">   </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">catalog_1</span><span class="w">
</span><span class="w">     </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">hive</span><span class="w">
</span><span class="w">     </span><span class="nt">property-version</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">     </span><span class="nt">hive-conf-dir</span><span class="p">:</span><span class="w"> </span><span class="l">...</span><span class="w">
</span><span class="w">   </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">catalog_2</span><span class="w">
</span><span class="w">     </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">hive</span><span class="w">
</span><span class="w">     </span><span class="nt">property-version</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">     </span><span class="nt">default-database</span><span class="p">:</span><span class="w"> </span><span class="l">mydb2</span><span class="w">
</span><span class="w">     </span><span class="nt">hive-conf-dir</span><span class="p">:</span><span class="w"> </span><span class="l">...</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c"># Properties that change the fundamental execution behavior of a table program.</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="nt">execution</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">planner: blink                    # optional</span><span class="p">:</span><span class="w"> </span><span class="l">either &#39;blink&#39; (default) or &#39;old&#39;</span><span class="w">
</span><span class="w">  </span><span class="nt">type: streaming                   # required</span><span class="p">:</span><span class="w"> </span><span class="l">execution mode either &#39;batch&#39; or &#39;streaming&#39;</span><span class="w">
</span><span class="w">  </span><span class="nt">result-mode: table                # required</span><span class="p">:</span><span class="w"> </span><span class="l">either &#39;table&#39; or &#39;changelog&#39;</span><span class="w">
</span><span class="w">  </span><span class="nt">max-table-result-rows: 1000000    # optional</span><span class="p">:</span><span class="w"> </span><span class="l">maximum number of maintained rows in</span><span class="w">
</span><span class="w">                                    </span><span class="c">#   &#39;table&#39; mode (1000000 by default, smaller 1 means unlimited)</span><span class="w">
</span><span class="w">  </span><span class="nt">time-characteristic: event-time   # optional</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;processing-time&#39;</span><span class="w"> </span><span class="l">or &#39;event-time&#39; (default)</span><span class="w">
</span><span class="w">  </span><span class="nt">parallelism: 1                    # optional</span><span class="p">:</span><span class="w"> </span><span class="l">Flink&#39;s parallelism (1 by default)</span><span class="w">
</span><span class="w">  </span><span class="nt">periodic-watermarks-interval: 200 # optional</span><span class="p">:</span><span class="w"> </span><span class="l">interval for periodic watermarks (200 ms by default)</span><span class="w">
</span><span class="w">  </span><span class="nt">max-parallelism: 16               # optional</span><span class="p">:</span><span class="w"> </span><span class="l">Flink&#39;s maximum parallelism (128 by default)</span><span class="w">
</span><span class="w">  </span><span class="nt">min-idle-state-retention: 0       # optional</span><span class="p">:</span><span class="w"> </span><span class="l">table program&#39;s minimum idle state time</span><span class="w">
</span><span class="w">  </span><span class="nt">max-idle-state-retention: 0       # optional</span><span class="p">:</span><span class="w"> </span><span class="l">table program&#39;s maximum idle state time</span><span class="w">
</span><span class="w">  </span><span class="nt">current-catalog: catalog_1        # optional</span><span class="p">:</span><span class="w"> </span><span class="l">name of the current catalog of the session (&#39;default_catalog&#39; by default)</span><span class="w">
</span><span class="w">  </span><span class="nt">current-database: mydb1           # optional</span><span class="p">:</span><span class="w"> </span><span class="l">name of the current database of the current catalog</span><span class="w">
</span><span class="w">                                    </span><span class="c">#   (default database of the current catalog by default)</span><span class="w">
</span><span class="w">  </span><span class="nt">restart-strategy:                 # optional</span><span class="p">:</span><span class="w"> </span><span class="l">restart strategy</span><span class="w">
</span><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">fallback                 </span><span class="w"> </span><span class="c">#   &#34;fallback&#34; to global restart strategy by default</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c"># Configuration options for adjusting and tuning table programs.</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c"># A full list of options and their default values can be found</span><span class="w">
</span><span class="w"></span><span class="c"># on the dedicated &#34;Configuration&#34; page.</span><span class="w">
</span><span class="w"></span><span class="nt">configuration</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">table.optimizer.join-reorder-enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">  </span><span class="nt">table.exec.spill-compression.enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">  </span><span class="nt">table.exec.spill-compression.block-size</span><span class="p">:</span><span class="w"> </span><span class="l">128kb</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="c"># Properties that describe the cluster to which table programs are submitted to.</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="nt">deployment</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">response-timeout</span><span class="p">:</span><span class="w"> </span><span class="m">5000</span><span class="w">
</span></code></pre></div><p>这份配置:</p>
<ul>
<li>定义了一个表源 <code>MyTableSource</code> 的环境，该表源从 CSV 文件中读取。</li>
<li>定义了一个视图 <code>MyCustomView</code>，该视图使用 SQL 查询声明了一个虚拟表。</li>
<li>定义了一个用户定义的函数 <code>myUDF</code>，可以使用类名和两个构造函数参数来实例化。</li>
<li>连接两个 Hive 目录，并使用 catalog_1 作为当前目录，mydb1 作为目录的当前数据库。</li>
<li>在流式模式下使用 blink planner，运行具有事件时间特性和并行度为1的语句。</li>
<li>在 table 结果模式下运行探索性查询。</li>
<li>并通过配置选项围绕连接重排序和溢出进行一些 planner 调整。</li>
</ul>
<p>根据使用情况，一个配置可以被分割成多个文件。因此，可以为一般目的创建环境文件（使用 <code>--defaults</code> 创建默认环境文件），也可以为每个会话创建环境文件（使用 <code>--environment</code> 创建会话环境文件）。每一个 CLI 会话都会用默认属性和会话属性来初始化。例如，<code>defaults</code> 环境文件可以指定在每个会话中应该可以查询的所有 table source，而 <code>session</code> 环境文件只声明特定的状态保留时间和并行度。在启动CLI应用程序时，可以同时传递默认环境文件和会话环境文件。如果没有指定默认环境文件，SQL Client 会在 Flink 的配置目录下搜索 <code>./conf/sql-client-defaults.yaml</code>。</p>
<p>注意：在 CLI 会话中设置的属性（例如使用SET命令）具有最高优先权。</p>
<pre><code>CLI commands &gt; session environment file &gt; defaults environment file
</code></pre><h3 id="重启策略">重启策略&nbsp;<a class="headline-hash no-text-decoration" href="#重启策略">#</a> </h3>
<p>重启策略控制 Flink 作业在发生故障时如何重启。与 Flink 集群的<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/restart_strategies.html">全局重启策略</a>类似，可以在环境文件中声明一个更精细的重启配置。</p>
<p>支持以下策略。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">execution</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="c"># falls back to the global strategy defined in flink-conf.yaml</span><span class="w">
</span><span class="w">  </span><span class="nt">restart-strategy</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">fallback</span><span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="c"># job fails directly and no restart is attempted</span><span class="w">
</span><span class="w">  </span><span class="nt">restart-strategy</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">none</span><span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="c"># attempts a given number of times to restart the job</span><span class="w">
</span><span class="w">  </span><span class="nt">restart-strategy</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">fixed-delay</span><span class="w">
</span><span class="w">    </span><span class="nt">attempts: 3      # retries before job is declared as failed (default</span><span class="p">:</span><span class="w"> </span><span class="l">Integer.MAX_VALUE)</span><span class="w">
</span><span class="w">    </span><span class="nt">delay: 10000     # delay in ms between retries (default</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="l">s)</span><span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="c"># attempts as long as the maximum number of failures per time interval is not exceeded</span><span class="w">
</span><span class="w">  </span><span class="nt">restart-strategy</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">failure-rate</span><span class="w">
</span><span class="w">    </span><span class="nt">max-failures-per-interval: 1   # retries in interval until failing (default</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="l">)</span><span class="w">
</span><span class="w">    </span><span class="nt">failure-rate-interval</span><span class="p">:</span><span class="w"> </span><span class="m">60000</span><span class="w">   </span><span class="c"># measuring interval in ms for failure rate</span><span class="w">
</span><span class="w">    </span><span class="nt">delay: 10000                   # delay in ms between retries (default</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="l">s)</span><span class="w">
</span></code></pre></div><h3 id="依赖性">依赖性&nbsp;<a class="headline-hash no-text-decoration" href="#依赖性">#</a> </h3>
<p>SQL Client 不需要使用 Maven 或 SBT 设置一个 Java 项目。相反，你可以将依赖关系作为常规的 JAR 文件传递给集群。你可以单独指定每个 JAR 文件（使用 <code>--jar</code>）或定义整个库目录（使用 <code>--library</code>）。对于连接到外部系统（如 Apache Kafka）的连接器和相应的数据格式（如JSON），Flink 提供了现成的 JAR bundles。这些 JAR 文件可以从 Maven 中央仓库为每个版本下载。</p>
<p>所提供的 SQL JAR 的完整列表和关于如何使用它们的文档可以在<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/connect.html">连接到外部系统页面</a>上找到。</p>
<p>下面的例子显示了一个环境文件，它定义了一个从 Apache Kafka 读取 JSON 数据的 table source。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">tables</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">TaxiRides</span><span class="w">
</span><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">source-table</span><span class="w">
</span><span class="w">    </span><span class="nt">update-mode</span><span class="p">:</span><span class="w"> </span><span class="l">append</span><span class="w">
</span><span class="w">    </span><span class="nt">connector</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">property-version</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">kafka</span><span class="w">
</span><span class="w">      </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;0.11&#34;</span><span class="w">
</span><span class="w">      </span><span class="nt">topic</span><span class="p">:</span><span class="w"> </span><span class="l">TaxiRides</span><span class="w">
</span><span class="w">      </span><span class="nt">startup-mode</span><span class="p">:</span><span class="w"> </span><span class="l">earliest-offset</span><span class="w">
</span><span class="w">      </span><span class="nt">properties</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">bootstrap.servers</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:9092</span><span class="w">
</span><span class="w">        </span><span class="nt">group.id</span><span class="p">:</span><span class="w"> </span><span class="l">testGroup</span><span class="w">
</span><span class="w">    </span><span class="nt">format</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">property-version</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">json</span><span class="w">
</span><span class="w">      </span><span class="nt">schema</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;ROW&lt;rideId LONG, lon FLOAT, lat FLOAT, rideTime TIMESTAMP&gt;&#34;</span><span class="w">
</span><span class="w">    </span><span class="nt">schema</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">rideId</span><span class="w">
</span><span class="w">        </span><span class="nt">data-type</span><span class="p">:</span><span class="w"> </span><span class="l">BIGINT</span><span class="w">
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">lon</span><span class="w">
</span><span class="w">        </span><span class="nt">data-type</span><span class="p">:</span><span class="w"> </span><span class="l">FLOAT</span><span class="w">
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">lat</span><span class="w">
</span><span class="w">        </span><span class="nt">data-type</span><span class="p">:</span><span class="w"> </span><span class="l">FLOAT</span><span class="w">
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">rowTime</span><span class="w">
</span><span class="w">        </span><span class="nt">data-type</span><span class="p">:</span><span class="w"> </span><span class="l">TIMESTAMP(3)</span><span class="w">
</span><span class="w">        </span><span class="nt">rowtime</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">timestamps</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;from-field&#34;</span><span class="w">
</span><span class="w">            </span><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;rideTime&#34;</span><span class="w">
</span><span class="w">          </span><span class="nt">watermarks</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;periodic-bounded&#34;</span><span class="w">
</span><span class="w">            </span><span class="nt">delay</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;60000&#34;</span><span class="w">
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">procTime</span><span class="w">
</span><span class="w">        </span><span class="nt">data-type</span><span class="p">:</span><span class="w"> </span><span class="l">TIMESTAMP(3)</span><span class="w">
</span><span class="w">        </span><span class="nt">proctime</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></code></pre></div><p>由此产生的 <code>TaxiRide</code> 表的模式(schema)包含了 JSON 模式(schema)的大部分字段。此外，它还增加了一个行时间属性 <code>rowTime</code> 和处理时间属性 <code>procTime</code>。</p>
<p><code>connector</code> 和 <code>format</code> 都允许定义一个属性版本（目前是版本1），以便于将来向后兼容。</p>
<h3 id="用户定义的函数">用户定义的函数&nbsp;<a class="headline-hash no-text-decoration" href="#用户定义的函数">#</a> </h3>
<p>SQL Client 允许用户创建自定义的、用户定义的函数，以便在 SQL 查询中使用。目前，这些函数被限制在 Java/Scala 类或 Python  文件中以编程方式定义。</p>
<p>为了提供一个 Java/Scala 用户定义的函数，你需要首先实现和编译一个扩展 ScalarFunction、AggregateFunction 或 TableFunction 的函数类（见<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/functions/udfs.html">用户定义的函数</a>）。然后可以将一个或多个函数打包到 SQL Client 的依赖 JAR 中。</p>
<p>为了提供一个 Python 用户定义函数，你需要编写一个 Python 函数，并用 <code>pyflink.table.udf.udf</code> 或 <code>pyflink.table.udf.udtf</code> 装饰器来装饰它(见 <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/python/user-guide/table/udfs/python_udfs.html">Python UDFs</a>)。然后可以将一个或多个函数放入一个 Python 文件中。Python 文件和相关的依赖关系需要通过环境文件中的配置 (参见 <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/python/user-guide/table/python_config.html">Python 配置</a>) 或命令行选项 (参见<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/ops/cli.html#usage">命令行用法</a>) 来指定。</p>
<p>所有函数在被调用之前必须在环境文件中声明。对于函数列表中的每一项，必须指定</p>
<ul>
<li>注册该函数的名称。</li>
<li>函数的源，使用 <code>from</code> (暂时限制为 class (Java/Scala UDF) 或 python (Python UDF))。</li>
</ul>
<p>Java/Scala UDF 必须指定:</p>
<ul>
<li><code>class</code>，表示函数的完全限定类名和一个可选的实例化构造参数列表。</li>
</ul>
<p>Python 的 UDF 必须指定:</p>
<ul>
<li><code>fully-qualified-name</code>: 表示完全限定的名称，即函数的&quot;[模块名].[对象名]&quot;。</li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">functions</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name: java_udf               # required</span><span class="p">:</span><span class="w"> </span><span class="l">name of the function</span><span class="w">
</span><span class="w">    </span><span class="nt">from: class                  # required</span><span class="p">:</span><span class="w"> </span><span class="l">source of the function</span><span class="w">
</span><span class="w">    </span><span class="nt">class: ...                   # required</span><span class="p">:</span><span class="w"> </span><span class="l">fully qualified class name of the function</span><span class="w">
</span><span class="w">    </span><span class="nt">constructor:                 # optional</span><span class="p">:</span><span class="w"> </span><span class="l">constructor parameters of the function class</span><span class="w">
</span><span class="w">      </span>- <span class="nt">...                      # optional</span><span class="p">:</span><span class="w"> </span><span class="l">a literal parameter with implicit type</span><span class="w">
</span><span class="w">      </span>- <span class="nt">class: ...               # optional</span><span class="p">:</span><span class="w"> </span><span class="l">full class name of the parameter</span><span class="w">
</span><span class="w">        </span><span class="nt">constructor:             # optional</span><span class="p">:</span><span class="w"> </span><span class="l">constructor parameters of the parameter&#39;s class</span><span class="w">
</span><span class="w">          </span>- <span class="nt">type: ...            # optional</span><span class="p">:</span><span class="w"> </span><span class="l">type of the literal parameter</span><span class="w">
</span><span class="w">            </span><span class="nt">value: ...           # optional</span><span class="p">:</span><span class="w"> </span><span class="l">value of the literal parameter</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name: python_udf             # required</span><span class="p">:</span><span class="w"> </span><span class="l">name of the function</span><span class="w">
</span><span class="w">    </span><span class="nt">from: python                 # required</span><span class="p">:</span><span class="w"> </span><span class="l">source of the function </span><span class="w">
</span><span class="w">    </span><span class="nt">fully-qualified-name: ...    # required</span><span class="p">:</span><span class="w"> </span><span class="l">fully qualified class name of the function      </span><span class="w">
</span></code></pre></div><p>对于 Java/Scala UDF，请确保指定参数的顺序和类型严格匹配你的函数类的一个构造函数。</p>
<h3 id="构造函数参数">构造函数参数&nbsp;<a class="headline-hash no-text-decoration" href="#构造函数参数">#</a> </h3>
<p>根据用户定义的函数，在 SQL 语句中使用它之前，可能需要对实现进行参数化。</p>
<p>如前面的例子所示，在声明用户定义函数时，可以通过以下三种方式之一使用构造函数参数来配置类。</p>
<p>一个隐含类型的字面值。SQL Client 会根据字面值本身自动推导出类型。目前，这里只支持 BOOLEAN、INT、DOUBLE 和 VARCHAR 的值。如果自动推导没有达到预期的效果（例如，你需要一个 VARCHAR false），请使用显式类型代替。</p>
<pre><code>- true         # -&gt; BOOLEAN (case sensitive)
- 42           # -&gt; INT
- 1234.222     # -&gt; DOUBLE
- foo          # -&gt; VARCHAR
</code></pre><p>一个具有明确类型的字面值。明确声明参数的 <code>type</code> 和 <code>value</code> 属性，以保证类型安全。</p>
<pre><code>- type: DECIMAL
  value: 11111111111111111
</code></pre><p>下表说明了支持的 Java 参数类型和相应的 SQL 类型字符串。</p>
<table>
<thead>
<tr>
<th style="text-align:left">Java type</th>
<th style="text-align:left">SQL type</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">java.math.BigDecimal</td>
<td style="text-align:left">DECIMAL</td>
</tr>
<tr>
<td style="text-align:left">java.lang.Boolean</td>
<td style="text-align:left">BOOLEAN</td>
</tr>
<tr>
<td style="text-align:left">java.lang.Byte</td>
<td style="text-align:left">TINYINT</td>
</tr>
<tr>
<td style="text-align:left">java.lang.Double</td>
<td style="text-align:left">DOUBLE</td>
</tr>
<tr>
<td style="text-align:left">java.lang.Float</td>
<td style="text-align:left">REAL, FLOAT</td>
</tr>
<tr>
<td style="text-align:left">java.lang.Integer</td>
<td style="text-align:left">INTEGER, INT</td>
</tr>
<tr>
<td style="text-align:left">java.lang.Long</td>
<td style="text-align:left">BIGINT</td>
</tr>
<tr>
<td style="text-align:left">java.lang.Short</td>
<td style="text-align:left">SMALLINT</td>
</tr>
<tr>
<td style="text-align:left">java.lang.String</td>
<td style="text-align:left">VARCHAR</td>
</tr>
</tbody>
</table>
<p>目前还不支持更多的类型（如 TIMESTAMP 或 ARRAY）、原语类型和 null。</p>
<p>一个（嵌套的）类实例。除了字面值，你还可以通过指定 <code>class</code> 和 <code>constructor</code> 函数属性，为构造函数参数创建（嵌套）类实例。这个过程可以递归执行，直到所有的构造参数都用字面值表示。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml">- <span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l">foo.bar.paramClass</span><span class="w">
</span><span class="w">  </span><span class="nt">constructor</span><span class="p">:</span><span class="w">
</span><span class="w">    </span>- <span class="l">StarryName</span><span class="w">
</span><span class="w">    </span>- <span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l">java.lang.Integer</span><span class="w">
</span><span class="w">      </span><span class="nt">constructor</span><span class="p">:</span><span class="w">
</span><span class="w">        </span>- <span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l">java.lang.String</span><span class="w">
</span><span class="w">          </span><span class="nt">constructor</span><span class="p">:</span><span class="w">
</span><span class="w">            </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">VARCHAR</span><span class="w">
</span><span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span></code></pre></div><h3 id="catalogs">Catalogs&nbsp;<a class="headline-hash no-text-decoration" href="#catalogs">#</a> </h3>
<p>Catalogs 可以定义为一组 YAML 属性，在启动 SQL Client 时自动注册到环境中。</p>
<p>用户可以在 SQL CLI 中指定要使用哪个目录(catalog)作为当前目录(catalog)，以及要使用该目录(catalog)的哪个数据库作为当前数据库。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">catalogs</span><span class="p">:</span><span class="w">
</span><span class="w">   </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">catalog_1</span><span class="w">
</span><span class="w">     </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">hive</span><span class="w">
</span><span class="w">     </span><span class="nt">property-version</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">     </span><span class="nt">default-database</span><span class="p">:</span><span class="w"> </span><span class="l">mydb2</span><span class="w">
</span><span class="w">     </span><span class="nt">hive-conf-dir</span><span class="p">:</span><span class="w"> </span><span class="l">&lt;path of Hive conf directory&gt;</span><span class="w">
</span><span class="w">   </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">catalog_2</span><span class="w">
</span><span class="w">     </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">hive</span><span class="w">
</span><span class="w">     </span><span class="nt">property-version</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">     </span><span class="nt">hive-conf-dir</span><span class="p">:</span><span class="w"> </span><span class="l">&lt;path of Hive conf directory&gt;</span><span class="w">
</span><span class="w">
</span><span class="w"></span><span class="nt">execution</span><span class="p">:</span><span class="w">
</span><span class="w">   </span><span class="l">...</span><span class="w">
</span><span class="w">   </span><span class="nt">current-catalog</span><span class="p">:</span><span class="w"> </span><span class="l">catalog_1</span><span class="w">
</span><span class="w">   </span><span class="nt">current-database</span><span class="p">:</span><span class="w"> </span><span class="l">mydb1</span><span class="w">
</span></code></pre></div><p>关于目录的更多信息，请参见<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/catalogs.html">目录</a>。</p>
<h2 id="分离式-sql-查询">分离式 SQL 查询&nbsp;<a class="headline-hash no-text-decoration" href="#分离式-sql-查询">#</a> </h2>
<p>为了定义端到端 SQL 管道，SQL 的 INSERT INTO 语句可以用于向 Flink 集群提交长期运行的、分离的查询。这些查询将其结果产生到外部系统中，而不是 SQL Client。这允许处理更高的并行性和更大的数据量。CLI 本身对提交后的分离查询没有任何控制。</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">MyTableSink</span> <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">MyTableSource</span>
</code></pre></div><p>表接收器 <code>MyTableSink</code> 必须在环境文件中声明。有关支持的外部系统及其配置的更多信息，请参见<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/connect.html">连接页面</a>。下面是一个 Apache Kafka 表接收器的例子。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">tables</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">MyTableSink</span><span class="w">
</span><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">sink-table</span><span class="w">
</span><span class="w">    </span><span class="nt">update-mode</span><span class="p">:</span><span class="w"> </span><span class="l">append</span><span class="w">
</span><span class="w">    </span><span class="nt">connector</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">property-version</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">kafka</span><span class="w">
</span><span class="w">      </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;0.11&#34;</span><span class="w">
</span><span class="w">      </span><span class="nt">topic</span><span class="p">:</span><span class="w"> </span><span class="l">OutputTopic</span><span class="w">
</span><span class="w">      </span><span class="nt">properties</span><span class="p">:</span><span class="w">
</span><span class="w">        </span><span class="nt">bootstrap.servers</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:9092</span><span class="w">
</span><span class="w">        </span><span class="nt">group.id</span><span class="p">:</span><span class="w"> </span><span class="l">testGroup</span><span class="w">
</span><span class="w">    </span><span class="nt">format</span><span class="p">:</span><span class="w">
</span><span class="w">      </span><span class="nt">property-version</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">json</span><span class="w">
</span><span class="w">      </span><span class="nt">derive-schema</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span><span class="nt">schema</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">rideId</span><span class="w">
</span><span class="w">        </span><span class="nt">data-type</span><span class="p">:</span><span class="w"> </span><span class="l">BIGINT</span><span class="w">
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">lon</span><span class="w">
</span><span class="w">        </span><span class="nt">data-type</span><span class="p">:</span><span class="w"> </span><span class="l">FLOAT</span><span class="w">
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">lat</span><span class="w">
</span><span class="w">        </span><span class="nt">data-type</span><span class="p">:</span><span class="w"> </span><span class="l">FLOAT</span><span class="w">
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">rideTime</span><span class="w">
</span><span class="w">        </span><span class="nt">data-type</span><span class="p">:</span><span class="w"> </span><span class="l">TIMESTAMP(3)</span><span class="w">
</span></code></pre></div><p>SQL 客户端确保语句成功提交到集群。一旦提交查询，CLI 将显示有关 Flink 作业的信息。</p>
<pre><code>[INFO] Table update statement has been successfully submitted to the cluster:
Cluster ID: StandaloneClusterId
Job ID: 6f922fe5cba87406ff23ae4a7bb79044
Web interface: http://localhost:8081
</code></pre><p>注意: SQL 客户端在提交后不会跟踪正在运行的 Flink 作业的状态。CLI 进程可以在提交后被关闭，而不影响分离查询。Flink 的<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/restart_strategies.html">重启策略</a>照顾到了容错。可以使用 Flink 的 Web 界面、命令行或 REST API 来取消查询。</p>
<h2 id="sql-视图">SQL 视图&nbsp;<a class="headline-hash no-text-decoration" href="#sql-视图">#</a> </h2>
<p>视图允许从 SQL 查询中定义虚拟表。视图定义会被立即解析和验证。然而，实际的执行发生在提交一般的 INSERT INTO 或 SELECT 语句期间访问视图时。</p>
<p>视图可以在<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/sqlClient.html#environment-files">环境文件</a>中定义，也可以在 CLI 会话中定义。</p>
<p>下面的例子显示了如何在一个文件中定义多个视图。视图是按照它们在环境文件中定义的顺序注册的。支持诸如视图 A 依赖于视图 B 依赖于视图 C 的引用链。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">tables</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">MyTableSource</span><span class="w">
</span><span class="w">    </span><span class="c"># ...</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">MyRestrictedView</span><span class="w">
</span><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">view</span><span class="w">
</span><span class="w">    </span><span class="nt">query</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;SELECT MyField2 FROM MyTableSource&#34;</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">MyComplexView</span><span class="w">
</span><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">view</span><span class="w">
</span><span class="w">    </span><span class="nt">query</span><span class="p">:</span><span class="w"> </span><span class="p">&gt;</span><span class="sd">
</span><span class="sd">      SELECT MyField2 + 42, CAST(MyField1 AS VARCHAR)
</span><span class="sd">      FROM MyTableSource
</span><span class="sd">      WHERE MyField2 &gt; 200</span><span class="w">      
</span></code></pre></div><p>与 table source 和 sink 类似，会话环境文件中定义的视图具有最高优先级。</p>
<p>视图也可以在 CLI 会话中使用 <code>CREATE VIEW</code> 语句创建。</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">VIEW</span> <span class="n">MyNewView</span> <span class="k">AS</span> <span class="k">SELECT</span> <span class="n">MyField2</span> <span class="k">FROM</span> <span class="n">MyTableSource</span><span class="p">;</span>
</code></pre></div><p>在 CLI 会话中创建的视图也可以使用 <code>DROP VIEW</code> 语句再次删除。</p>
<div class="highlight"><pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">DROP</span> <span class="k">VIEW</span> <span class="n">MyNewView</span><span class="p">;</span>
</code></pre></div><p>注意: CLI 中视图的定义仅限于上述语法。在未来的版本中，将支持为视图定义模式或在表名中转义空格。</p>
<h2 id="临时表">临时表&nbsp;<a class="headline-hash no-text-decoration" href="#临时表">#</a> </h2>
<p><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/streaming/temporal_tables.html">临时表</a>允许对变化的历史表进行（参数化的）查看，该表在特定的时间点返回一个表的内容。这对于将一个表与另一个表在特定时间戳的内容连接起来特别有用。更多信息可以在<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/streaming/joins.html#join-with-a-temporal-table">临时表连接</a>页面中找到。</p>
<p>下面的示例展示了如何定义一个临时表 <code>SourceTemporalTable</code>。</p>
<div class="highlight"><pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">tables</span><span class="p">:</span><span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="c"># Define the table source (or view) that contains updates to a temporal table</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">HistorySource</span><span class="w">
</span><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">source-table</span><span class="w">
</span><span class="w">    </span><span class="nt">update-mode</span><span class="p">:</span><span class="w"> </span><span class="l">append</span><span class="w">
</span><span class="w">    </span><span class="nt">connector</span><span class="p">:</span><span class="w"> </span><span class="c"># ...</span><span class="w">
</span><span class="w">    </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="c"># ...</span><span class="w">
</span><span class="w">    </span><span class="nt">schema</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">integerField</span><span class="w">
</span><span class="w">        </span><span class="nt">data-type</span><span class="p">:</span><span class="w"> </span><span class="l">INT</span><span class="w">
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">stringField</span><span class="w">
</span><span class="w">        </span><span class="nt">data-type</span><span class="p">:</span><span class="w"> </span><span class="l">STRING</span><span class="w">
</span><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">rowtimeField</span><span class="w">
</span><span class="w">        </span><span class="nt">data-type</span><span class="p">:</span><span class="w"> </span><span class="l">TIMESTAMP(3)</span><span class="w">
</span><span class="w">        </span><span class="nt">rowtime</span><span class="p">:</span><span class="w">
</span><span class="w">          </span><span class="nt">timestamps</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">from-field</span><span class="w">
</span><span class="w">            </span><span class="nt">from</span><span class="p">:</span><span class="w"> </span><span class="l">rowtimeField</span><span class="w">
</span><span class="w">          </span><span class="nt">watermarks</span><span class="p">:</span><span class="w">
</span><span class="w">            </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">from-source</span><span class="w">
</span><span class="w">
</span><span class="w">  </span><span class="c"># Define a temporal table over the changing history table with time attribute and primary key</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">SourceTemporalTable</span><span class="w">
</span><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">temporal-table</span><span class="w">
</span><span class="w">    </span><span class="nt">history-table</span><span class="p">:</span><span class="w"> </span><span class="l">HistorySource</span><span class="w">
</span><span class="w">    </span><span class="nt">primary-key</span><span class="p">:</span><span class="w"> </span><span class="l">integerField</span><span class="w">
</span><span class="w">    </span><span class="nt">time-attribute</span><span class="p">:</span><span class="w"> </span><span class="l">rowtimeField </span><span class="w"> </span><span class="c"># could also be a proctime field</span><span class="w">
</span></code></pre></div><p>如示例中所示，table source、视图和临时表的定义可以相互混合。它们按照在环境文件中定义的顺序进行注册。例如，一个临时表可以引用一个视图，该视图可以依赖于另一个视图或 table source。</p>
<h2 id="限制和未来">限制和未来&nbsp;<a class="headline-hash no-text-decoration" href="#限制和未来">#</a> </h2>
<p>目前的 SQL Client 只支持嵌入式模式。未来，社区计划通过提供基于 REST 的 SQL Client 网关来扩展其功能，详见 <a href="https://cwiki.apache.org/confluence/display/FLINK/FLIP-24+-+SQL+Client">FLIP-24</a> 和 <a href="https://cwiki.apache.org/confluence/display/FLINK/FLIP-91%3A+Support+SQL+Client+Gateway">FLIP-91</a>。</p>
<p>原文链接: <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/sqlClient.html">https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/sqlClient.html</a></p>


        </div>
    </div>
</article>



                <footer>
                    




<div class="no-text-decoration">
    <div class="jump top"><a href="#" title="Top of this page">⮉</a></div>
    <div class="jump bottom"><a href="#bottom" title="Bottom of this page">⮋</a></div>
</div>


 
    
        <div class="hugotoc no-text-decoration">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#sql-client">SQL Client</a></li>
    <li><a href="#入门">入门</a>
      <ul>
        <li><a href="#启动-sql-客户端-cli">启动 SQL 客户端 CLI</a></li>
        <li><a href="#运行-sql-查询">运行 SQL 查询</a></li>
      </ul>
    </li>
    <li><a href="#配置">配置</a>
      <ul>
        <li><a href="#环境文件">环境文件</a></li>
        <li><a href="#重启策略">重启策略</a></li>
        <li><a href="#依赖性">依赖性</a></li>
        <li><a href="#用户定义的函数">用户定义的函数</a></li>
        <li><a href="#构造函数参数">构造函数参数</a></li>
        <li><a href="#catalogs">Catalogs</a></li>
      </ul>
    </li>
    <li><a href="#分离式-sql-查询">分离式 SQL 查询</a></li>
    <li><a href="#sql-视图">SQL 视图</a></li>
    <li><a href="#临时表">临时表</a></li>
    <li><a href="#限制和未来">限制和未来</a></li>
  </ul>
</nav>
            <a href="#" class="back-to-top">Back to top</a>
        </div>
    
    
<script src="/js/libs/jquery/3.3.1/jquery.slim.min.min.528a9ce56371729e50605653bf72b1e933574cdb97519529bf8fab01b63f9703.js"></script>

<link rel="preload" href="/js/libs/jquery/3.3.1/jquery.slim.min.min.528a9ce56371729e50605653bf72b1e933574cdb97519529bf8fab01b63f9703.js" as="script">

<script type="application/javascript">(function() {
     var $window = $(window);
     if ($window.width() >= 1400) { 
         var $toc = $('#TableOfContents');
         if ($toc.length > 0) {
             function onScroll(){
                 var currentScroll = $window.scrollTop();
                 var h = $('.content h1, .content h2, .content h3, .content h4, .content h5, .content h6, .h-feed h2');
                 var id = "";
                 h.each(function (i, e) {
                     e = $(e);
                     if (e.offset().top - 10 <= currentScroll) {
                         id = e.attr('id');
                     }
                 });
                 var current = $toc.find('a.current');
                 if (current.length == 1 && current.eq(0).attr('href') == '#' + id) return true;

                 current.each(function (i, e) {
                     $(e).removeClass('current').siblings('ul').hide();
                 });
                 $toc.find('a[href="#' + id + '"]').parentsUntil('#TableOfContents').each(function (i, e) {
                     $(e).children('a').addClass('current').siblings('ul').show();
                 });
             }
             $window.on('scroll', onScroll);
             $(document).ready(function() {
                 $toc.find('a').parent('li').find('ul').hide();
                 onScroll();
                 document.getElementsByClassName('hugotoc')[0].style.display = '';
             });}}})();</script>








<div class="backtotop center no-text-decoration">
    <a href="#">back to <span class="top">top</span></a>
</div>


<div class="right">
    <div class="taxo no-text-decoration">
         
            
                <ul class="no-bullets inline categories">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__flink__"
                                
                                
                                title="See all 74 posts categorized in ‘Flink’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/categories/flink/">Flink</a>
                            </li>
                        
                    
                </ul>
            
         
            
                <ul class="no-bullets inline tags">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__flink__"
                                
                                
                                title="See all 93 posts tagged with ‘Flink’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/tags/flink/">Flink</a>
                            </li>
                        
                    
                        
                        
                        
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__table-api-sql__"
                                
                                
                                title="See all 35 posts tagged with ‘Table API &amp; SQL’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/tags/table-api-sql/">Table API &amp; SQL</a>
                            </li>
                        
                    
                </ul>
            
        
    </div>

</div>
<div class="clear-float"></div>



<div class="prev-next-navigator clear-float">
    
        <span class="prev-post left no-text-decoration">
            <a href="https://ohmyweekly.github.io/notes/2020-08-22-sql-overview/" class="nobr">« SQL</a>
        </span>
    
    
        <span class="next-post right no-text-decoration">
            <a href="https://ohmyweekly.github.io/notes/2020-08-22-sql-hints/" class="nobr">SQL 提示 »</a>
        </span>
    
</div>


<a id="bottom"></a>









                       







                    <ul class="no-bullets feed right inline">
    
        
        
    
</ul>
<div class="clear-float"></div>

                </footer>
                <hr />
            </div>               

            <footer> 
                

<ul class="social no-text-decoration">
    
</ul>













<p class="generated no-text-decoration">
    Generated using  <a href="https://gitlab.com/kaushalmodi/hugo-theme-refined"><code class="nobr">hugo-theme-refined</code></a> + <span class="nobr">Hugo 0.79.0</span>
</p>

<p>
    
</p>




<div class="badges no-text-decoration">
    
    

    
</div>




<script type="application/javascript">var nav=responsiveNav("#nav");</script>




<script defer src="/js/libs/fragmentions/wrapper.min.4c511209cd3786314b251d891c8da528b47a972669aa4eea416b64d4be01eee2.js"></script>









            </footer>
        </div> 
    </body>
</html>
