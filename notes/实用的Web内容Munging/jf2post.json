{"author":{"name":null,"type":"card","url":"http://localhost:1313/"},"content":{"html":"\u003cp\u003e\u003cimg src=\"https://mojolicious.io/blog/2018/12/15/practical-web-content-munging/banner.jpg\" alt=\"img\"\u003e\u003c/p\u003e\n\u003cp\u003e继brian d foy \u003ca href=\"https://mojolicious.io/blog/2018/12/05/compound-selectors/\"\u003e从第5天开始使用Mojo::DOM选择器\u003c/a\u003e的精彩文章\u003ca href=\"https://mojolicious.io/blog/2018/12/05/compound-selectors/\"\u003e后\u003c/a\u003e，我认为谈论我最近使用\u003ca href=\"https://mojolicious.org/perldoc/Mojo/UserAgent\"\u003eMojo::UserAgent\u003c/a\u003e和\u003ca href=\"https://mojolicious.org/perldoc/Mojo/DOM\"\u003eMojo::DOM\u003c/a\u003e构建的一些网站迁移脚本会很有趣，以便展示这些模块的一些基本实际用法。我之前从未真正使用过Mojo，但最近我需要迁移一个大约15年没有重新设计的网站，这似乎非常适合我的内容修改需求。在过去，我会使用正则表达式，并且可能花费至少与我编写代码时手动按摩输入或输出到正确形状的时间。Mojo::DOM让我很容易，一个 Mojolicious 初学者，很快就能得到我想要的结果。\u003c/p\u003e\n\u003ch2 id=\"从静态站点到静态站点生成器\"\u003e从静态站点到静态站点生成器\u003c/h2\u003e\n\u003cp\u003e我打算解决的问题是使用曾经在SourceForge.net上托管的旧静态网站，并将其迁移到令人兴奋的新\u0026hellip;嗯\u0026hellip;静态网站。但是，这一次，它将成为静态网站的现代版本。而不是手动编辑HTML并使用自制的页面munging脚本来执行诸如使用正则表达式在内容div顶部插入新闻项目或更改日志条目，我将使用现代静态网站生成器。有几个可供选择，包括用Ruby编写的着名的Jekyll，用Go构建的Hugo，以及在Perl中运行此站点的Statocles。对于我的项目，我选择了\u003ca href=\"https://gohugo.io/\"\u003eHugo\u003c/a\u003e，因为它的速度和成熟度。\u003c/p\u003e\n\u003cp\u003e与大多数现代静态站点生成器一样，Hugo希望内容采用Markdown格式，文件顶部有一些元数据。我想把我们硬梆梆的旧HTML转换成下面的例子，看起来有点像这样：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e---\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003etitle:\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;Frobnitz 3.141593 released\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003edate:\u003c/span\u003e \u003cspan class=\"mi\"\u003e2016\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"mi\"\u003e10\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003edescription:\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;This release includes a fog-flavored bauble of three equal sides, providing the restless...\u0026#34;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ecategories:\u003c/span\u003e \u003cspan class=\"o\"\u003e[]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ealiases:\u003c/span\u003e \u003cspan class=\"o\"\u003e[]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003etoc:\u003c/span\u003e \u003cspan class=\"n\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003edraft:\u003c/span\u003e \u003cspan class=\"n\"\u003efalse\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e---\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eThis\u003c/span\u003e \u003cspan class=\"n\"\u003erelease\u003c/span\u003e \u003cspan class=\"n\"\u003eincludes\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"n\"\u003efog\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003eflavored\u003c/span\u003e \u003cspan class=\"n\"\u003ebauble\u003c/span\u003e \u003cspan class=\"n\"\u003eof\u003c/span\u003e \u003cspan class=\"n\"\u003ethree\u003c/span\u003e \u003cspan class=\"n\"\u003eequal\u003c/span\u003e \u003cspan class=\"n\"\u003esides\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eproviding\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ethe\u003c/span\u003e \u003cspan class=\"n\"\u003erestless\u003c/span\u003e \u003cspan class=\"n\"\u003edigital\u003c/span\u003e \u003cspan class=\"n\"\u003espirits\u003c/span\u003e \u003cspan class=\"n\"\u003ea\u003c/span\u003e \u003cspan class=\"n\"\u003ebrief\u003c/span\u003e \u003cspan class=\"n\"\u003erespite\u003c/span\u003e \u003cspan class=\"n\"\u003efrom\u003c/span\u003e \u003cspan class=\"n\"\u003etheir\u003c/span\u003e \u003cspan class=\"n\"\u003epainful\u003c/span\u003e \u003cspan class=\"n\"\u003eawareness\u003c/span\u003e \u003cspan class=\"n\"\u003eof\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eimpermanence\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eYou\u003c/span\u003e \u003cspan class=\"n\"\u003ecan\u003c/span\u003e \u003cspan class=\"n\"\u003efind\u003c/span\u003e \u003cspan class=\"n\"\u003ethe\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"n\"\u003eversion\u003c/span\u003e \u003cspan class=\"n\"\u003eunder\u003c/span\u003e \u003cspan class=\"n\"\u003ethe\u003c/span\u003e \u003cspan class=\"n\"\u003eusual\u003c/span\u003e \u003cspan class=\"n\"\u003eshadowy\u003c/span\u003e \u003cspan class=\"n\"\u003ebridge\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e所以，首先，我需要获取旧网站。我本可以打扰网站的旧维护者，并获得原始资源，但我决定只是从网上获取它们。一种选择是使用wget或curl; 我们稍后用Mojo::DOM做的事情可以从任何地方使用HTML，包括本地文件。但是，在Perl中完成所有操作似乎更简单。因此，我们将获取页面路径列表，然后对它们进行处理。Mojo::UserAgent努力工作。最简单的示例可能如下所示：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::UserAgent\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$url\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;intro\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ua\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::UserAgent\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$tx\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ua\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;example.tld/$url.html\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e而已！我们刚刚获取了一个网页。您可能想要打印 \u003ccode\u003e$tx\u003c/code\u003e 以查看其中的内容（这就是我所做的，而不是首先阅读文档）。但是，它是一个\u003ca href=\"https://mojolicious.org/perldoc/Mojo/Transaction/HTTP\"\u003eMojo::Transaction::HTTP\u003c/a\u003e对象。我们必须深入了解层次结构，首先查看\u003ccode\u003eres\u003c/code\u003e属性，它是一个\u003ca href=\"https://mojolicious.org/perldoc/Mojo/Message/Response\"\u003eMojo::Message::Response\u003c/a\u003e对象，它有一个\u003ccode\u003ebody\u003c/code\u003e方法：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eprint\u003c/span\u003e \u003cspan class=\"nv\"\u003e$tx\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003eres\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebody\u003c/span\u003e\u003cspan class=\"p\"\u003e();\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e这将显示响应正文及其HTML内容。但是，这并不是很有趣。但是，我们可以通过Mojo响应轻松地完成更多有趣和强大的事情。\u003c/p\u003e\n\u003ch2 id=\"css选择器\"\u003eCSS选择器\u003c/h2\u003e\n\u003cp\u003e该\u003ccode\u003eres\u003c/code\u003e响应对象提供了一个\u003ccode\u003edom\u003c/code\u003e对象，给出了选择使用CSS选择HTML文档的部件的能力。所以，如果我有一个带\u003ccode\u003e#main\u003c/code\u003ediv 的文档，我可以使用以下内容检索该div的内容：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$main\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$tx\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003eres\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003edom\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003efind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;#main\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e当然，如果你熟悉CSS选择器，你知道它可以比那更精确。那么，让我们谈谈具体的事情。就我而言，我有几种不同类型的页面。一个是新闻项目的页面，其中有许多部分明确地描述为人类读者，但它们不在他们自己的div中，或者在HTML解析器可以分辨的情况下分组。它们只是一堆模糊的HTML形状。\u003c/p\u003e\n\u003cp\u003e我想将这些新闻项目分成各自的页面，然后可以按照我喜欢的方式进行聚合，例如将它们放在分页列表中，或者将最新项目包含在首页的div中。网站。\u003c/p\u003e\n\u003cp\u003e这些新闻在旧网站上看起来像这样：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sr\"\u003e\u0026lt;h1\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eLatest\u003c/span\u003e \u003cspan class=\"n\"\u003eNews\u003c/span\u003e\u003cspan class=\"sr\"\u003e\u0026lt;/h1\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sr\"\u003e\u0026lt;h3\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eFrobnitz\u003c/span\u003e \u003cspan class=\"mf\"\u003e4.5\u003c/span\u003e \u003cspan class=\"n\"\u003ereleased\u003c/span\u003e\u003cspan class=\"sr\"\u003e\u0026lt;/h3\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sr\"\u003e\u0026lt;p\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eThis\u003c/span\u003e \u003cspan class=\"n\"\u003erelease\u003c/span\u003e \u003cspan class=\"n\"\u003eimproves\u003c/span\u003e \u003cspan class=\"n\"\u003ecastigation\u003c/span\u003e \u003cspan class=\"n\"\u003eof\u003c/span\u003e \u003cspan class=\"n\"\u003ethe\u003c/span\u003e \u003cspan class=\"n\"\u003ewidely\u003c/span\u003e \u003cspan class=\"n\"\u003eformed\u003c/span\u003e \u003cspan class=\"n\"\u003esonterols\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sr\"\u003e\u0026lt;br\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eCurrent\u003c/span\u003e \u003cspan class=\"n\"\u003eusers\u003c/span\u003e \u003cspan class=\"n\"\u003emay\u003c/span\u003e \u003cspan class=\"n\"\u003eupgrade\u003c/span\u003e \u003cspan class=\"n\"\u003eby\u003c/span\u003e \u003cspan class=\"n\"\u003eapplying\u003c/span\u003e \u003cspan class=\"n\"\u003ecoil\u003c/span\u003e \u003cspan class=\"n\"\u003eoil\u003c/span\u003e \u003cspan class=\"n\"\u003eto\u003c/span\u003e \u003cspan class=\"n\"\u003eapplication\u003c/span\u003e \u003cspan class=\"n\"\u003epoints\u003c/span\u003e \u003cspan class=\"n\"\u003eA\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eC\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eW\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eDF\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eY0\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eIN34\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eRS232\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"ow\"\u003eand\u003c/span\u003e \u003cspan class=\"n\"\u003eFrank\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"k\"\u003ethen\u003c/span\u003e \u003cspan class=\"n\"\u003egently\u003c/span\u003e \u003cspan class=\"n\"\u003einserting\u003c/span\u003e \u003cspan class=\"n\"\u003ethe\u003c/span\u003e \u003cspan class=\"n\"\u003econjubilant\u003c/span\u003e \u003cspan class=\"n\"\u003eapparatus\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003einto\u003c/span\u003e \u003cspan class=\"n\"\u003ethe\u003c/span\u003e \u003cspan class=\"n\"\u003eferulic\u003c/span\u003e \u003cspan class=\"n\"\u003etreeble\u003c/span\u003e \u003cspan class=\"nb\"\u003esocket\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sr\"\u003e\u0026lt;/p\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"n\"\u003eclass\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;post-footer align-right\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003espan\u003c/span\u003e \u003cspan class=\"n\"\u003eclass\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;date\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eDecember\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2018\u003c/span\u003e\u003cspan class=\"sr\"\u003e\u0026lt;/span\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sr\"\u003e\u0026lt;/p\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sr\"\u003e\u0026lt;h3\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eFrobnitz\u003c/span\u003e \u003cspan class=\"mf\"\u003e4.4\u003c/span\u003e \u003cspan class=\"n\"\u003ereleased\u003c/span\u003e\u003cspan class=\"sr\"\u003e\u0026lt;/h3\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sr\"\u003e\u0026lt;p\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eThis\u003c/span\u003e \u003cspan class=\"n\"\u003erelease\u003c/span\u003e \u003cspan class=\"n\"\u003eis\u003c/span\u003e \u003cspan class=\"n\"\u003eeffulgent\u003c/span\u003e \u003cspan class=\"ow\"\u003eand\u003c/span\u003e \u003cspan class=\"n\"\u003ewavering\u003c/span\u003e \u003cspan class=\"n\"\u003egently\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sr\"\u003e\u0026lt;br\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eBecomes\u003c/span\u003e \u003cspan class=\"n\"\u003ebees\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sr\"\u003e\u0026lt;/p\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"n\"\u003eclass\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;post-footer align-right\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e\u0026lt;\u003c/span\u003e\u003cspan class=\"n\"\u003espan\u003c/span\u003e \u003cspan class=\"n\"\u003eclass\u003c/span\u003e\u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;date\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eNovember\u003c/span\u003e \u003cspan class=\"mi\"\u003e30\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e2018\u003c/span\u003e\u003cspan class=\"sr\"\u003e\u0026lt;/span\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"sr\"\u003e\u0026lt;/p\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e请注意，这种结构是常规的，但不能用任何一个div或一个标记来选择。我可以使用选择器\u003ccode\u003eh3\u003c/code\u003e来获取标题，但每个新闻项的文本只是一个段落，我们也想分别获取日期。\u003c/p\u003e\n\u003cp\u003e因此，我想抓住所有标题，标题后面的段落和日期，并将它们全部放入某种数据结构中，这样我就可以将它们吐出自己的页面。\u003c/p\u003e\n\u003cp\u003e让我们从头衔开始吧，因为它会显示一个巧妙的技巧Mojo已经袖手旁观。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$main\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$tx\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003eres\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003edom\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eat\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;#main\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e@headers\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$main\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003efind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;h3\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nb\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;text\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nb\"\u003eeach\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e你看到了吗？\u003ccode\u003efind\u003c/code\u003e这里的方法是返回一个\u003ca href=\"https://mojolicious.org/perldoc/Mojo/Collection\"\u003eMojo::Collection\u003c/a\u003e。“集合”是一种说“列表”的奇特方式，但这些列表有一堆有用的实用方法，类似于在列表上运行的一些核心Perl函数，以及在其中找到的方法\u003ccode\u003eList::Util\u003c/code\u003e。它具有通常的嫌疑人，像\u003ccode\u003ejoin\u003c/code\u003e，\u003ccode\u003egrep\u003c/code\u003e，\u003ccode\u003emap\u003c/code\u003e，和\u003ccode\u003eeach\u003c/code\u003e。因此，收藏品很花哨，它们应该得到一个奇特的名字。在上面，在返回的每个项目上\u003ccode\u003emap\u003c/code\u003e调用方法，并将结果作为列表返回。\u003ccode\u003etext``find``each\u003c/code\u003e\u003c/p\u003e\n\u003cp\u003e在此之后，\u003ccode\u003e@headers\u003c/code\u003e将包含所有标题。我无法用简单的正则表达式来做到这一点（并且，我们可以将所有这些链接起来，包括找到\u003ccode\u003e#main\u003c/code\u003e一行，但我再次重新使用\u003ccode\u003e#main\u003c/code\u003e，所以我将它放入一个变量中）。\u003c/p\u003e\n\u003cp\u003e现在，与正则表达式相关的更棘手的事情就是找到这些标题的后续兄弟。但是，使用Mojo::DOM，我们可以通过几行代码来获取它（可能有一种方法可以用更少的代码来实现它，但这是我在几分钟的实验中提出的）。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e@paras\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$header\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$main\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003efind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;h3\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nb\"\u003eeach\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003epush\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e@paras\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$header\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"k\"\u003enext\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003econtent\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e这将再次选择\u003ccode\u003eh3\u003c/code\u003e元素，并迭代生成的DOM对象集合，将每个对象放入其中\u003ccode\u003e$header\u003c/code\u003e。然后，我们挑选出\u003ccode\u003econtent\u003c/code\u003e的的\u003ccode\u003enext\u003c/code\u003e元素（这在我的情况下，始终是一个段落，有时包含一个或多个\u003ccode\u003ebr\u003c/code\u003e标签），并把它们全部推入\u003ccode\u003e@paras\u003c/code\u003e。\u003c/p\u003e\n\u003cp\u003e所以，现在我们有一个标题数组，以下段落的数组，我们只需要获取日期。这个实际上非常简单，因为HTML模板使用\u003ccode\u003edate\u003c/code\u003e类标记日期。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e@dates\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$main\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003efind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;.date\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nb\"\u003emap\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;text\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nb\"\u003eeach\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e啪！我们完成了。好的，不太好。我们还没有完成这篇文章标题的“重复”部分。我们拥有来自我们糟糕的旧HTML网站的数据，现在让我们用它做点什么。\u003c/p\u003e\n\u003ch2 id=\"munging-the-dates\"\u003eMunging the Dates\u003c/h2\u003e\n\u003cp\u003e如上面的示例Hugo内容项所示，我想在元数据中包含日期。幸运的是，我们有与每个新闻项目相关的日期。不幸的是，它们不符合Hugo期望的格式。我对CPAN进行了一些挖掘，发现了\u003ca href=\"https://metacpan.org/pod/Time::Piece\"\u003eTime::Piece\u003c/a\u003e，它是一个聪明的模块，可以解析和转换大多数常见格式的时间和日期。\u003c/p\u003e\n\u003cp\u003e我需要我的日期看起来像\u003ccode\u003e2017-09-30\u003c/code\u003e，所以我使用了下面的代码（假设这是一个循环，它将每个后续日期放在\u003ccode\u003e@dates\u003c/code\u003e我们上面的数组中\u003ccode\u003e$date\u003c/code\u003e）：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nn\"\u003eTime::Piece\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$tp\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nn\"\u003eTime::Piece\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003estrptime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$date\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;%B %d, %Y\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$fixed\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$tp\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003estrftime\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;%Y-%m-%d\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"munging进入markdown\"\u003eMunging进入Markdown\u003c/h2\u003e\n\u003cp\u003e我还需要转换为Markdown。我已经使用\u003ca href=\"https://metacpan.org/pod/HTML::WikiConverter\"\u003eHTML::WikiConverter\u003c/a\u003e完成任务。\u003c/p\u003e\n\u003cp\u003e在最简单的形式中，我们可以做这样的事情（再次假设我们在一个循环中\u003ccode\u003e$para\u003c/code\u003e从\u003ccode\u003e@paras\u003c/code\u003e每次迭代获取一个值：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nn\"\u003eHTML::WikiConverter\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$wc\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nn\"\u003eHTML::\u003c/span\u003e\u003cspan class=\"n\"\u003eWikiConverter\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edialect\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;Markdown\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$md\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$wc\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ehtml2wiki\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nv\"\u003e$para\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e完成！\u003c/p\u003e\n\u003ch2 id=\"生成元数据\"\u003e生成元数据\u003c/h2\u003e\n\u003cp\u003e正如我们之前看到的，Hugo帖子在Markdown内容之前有元数据，并包含诸如作者信息，发布日期，描述等信息。有些是可选的，但有些是强制性的（我需要日期以便我可以显示最新的新网站首页上的新闻。我需要根据从原始HTML收集的信息自动生成所有这些内容。\u003c/p\u003e\n\u003cp\u003e我将着眼于如何\u003ccode\u003e@entries\u003c/code\u003e构建数据结构，但我会提到它是一个包含上面我们发现的三个数据的哈希数组。如果你想看到坚韧不拔的细节，我还会在最后用真实世界的代码链接到GitHub仓库。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::File\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nn\"\u003eString::Truncate\u003c/span\u003e \u003cspan class=\"sx\"\u003eqw(elide)\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$e\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e@entries\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$desc\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eelide\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$e\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;text\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"mi\"\u003e100\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eat_space\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$md\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026lt;\u0026lt;\u0026#34;\u003c/span\u003e\u003cspan class=\"dl\"\u003eEOF\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e---\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003etitle: \u0026#34;$e-\u0026gt;{\u0026#39;title\u0026#39;}\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003edate: $e-\u0026gt;{\u0026#39;date\u0026#39;}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003edescription: \u0026#34;$desc\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ecategories: []\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003ealiases: []\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003etoc: false\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003edraft: false\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e---\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e$e-\u0026gt;{\u0026#39;text\u0026#39;}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e\u003c/span\u003e\u003cspan class=\"dl\"\u003eEOF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$filename\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003elc\u003c/span\u003e \u003cspan class=\"nv\"\u003e$e\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;title\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nv\"\u003e$filename\u003c/span\u003e \u003cspan class=\"o\"\u003e=~\u003c/span\u003e \u003cspan class=\"sr\"\u003es/\\s/-/g\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nv\"\u003e$filename\u003c/span\u003e \u003cspan class=\"o\"\u003e=~\u003c/span\u003e \u003cspan class=\"sr\"\u003es/[!,()\u0026#39;\u0026#34;\\/]//g\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::File\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;content/news/$filename.md\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003espurt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$md\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e这里有很多内容，我只会简单地解释一下，因为它与Mojo无关。\u003c/p\u003e\n\u003cp\u003e循环的第一行创建描述，通常是摘要或其他。在我的情况下，主站点将显示描述为可点击链接，因此用户将在主页面上获得新闻项目的简短摘要，然后单击它以查看整个项目。我正在使用\u003ca href=\"https://metacpan.org/pod/String::Truncate\"\u003eString::Truncate\u003c/a\u003e模块，该模块有一个\u003ccode\u003eelide\u003c/code\u003e方法将截断字边界上的字符串并添加省略号以指示文本被遗漏。\u003c/p\u003e\n\u003cp\u003e然后，在这里的文档中，我使用from填写所有元数据\u003ccode\u003e$e\u003c/code\u003e，每个元数据只是对散列的引用。然后我们使用\u003ca href=\"https://mojolicious.org/perldoc/Mojo/File\"\u003eMojo::File\u003c/a\u003e的\u003ccode\u003espurt\u003c/code\u003e方法将其写入\u003ca href=\"https://mojolicious.org/perldoc/Mojo/File\"\u003e文件\u003c/a\u003e。而已！当这是在一个包含预期格式的任意数量新闻项的页面循环中完成时，我们得到了一堆不错的新Hugo帖子。\u003c/p\u003e\n\u003cp\u003e为了清晰和简洁（并且因为它是基本的Perl而不是与Mojo相关的），我遗漏了循环并构建了我在生成元数据时使用的数据结构。如果你想在一个地方看到这一切，有一些丑陋的地方来解决破损的日期以及在Markdown中表现不佳的事情（比如表格），你可以看到代码（仍在进行中，但几乎准备好迁移我们胡思乱想的旧网站！）在\u003ca href=\"https://github.com/swelljoe/webmin-com-extractor\"\u003eGitHub上\u003c/a\u003e的\u003ca href=\"https://github.com/swelljoe/webmin-com-extractor\"\u003e存储库中\u003c/a\u003e。我没有做得漂亮，因为它只需要运行一次，但它可以完成这项工作，而且构建起来并不需要太多时间，这要归功于Mojolicious以及CPAN的其他一些模块。\u003c/p\u003e\n","text":"\n继brian d foy 从第5天开始使用Mojo::DOM选择器的精彩文章后，我认为谈论我最近使用Mojo::UserAgent和Mojo::DOM构建的一些网站迁移脚本会很有趣，以便展示这些模块的一些基本实际用法。我之前从未真正使用过Mojo，但最近我需要迁移一个大约15年没有重新设计的网站，这似乎非常适合我的内容修改需求。在过去，我会使用正则表达式，并且可能花费至少与我编写代码时手动按摩输入或输出到正确形状的时间。Mojo::DOM让我很容易，一个 Mojolicious 初学者，很快就能得到我想要的结果。\n从静态站点到静态站点生成器 我打算解决的问题是使用曾经在SourceForge.net上托管的旧静态网站，并将其迁移到令人兴奋的新\u0026hellip;嗯\u0026hellip;静态网站。但是，这一次，它将成为静态网站的现代版本。而不是手动编辑HTML并使用自制的页面munging脚本来执行诸如使用正则表达式在内容div顶部插入新闻项目或更改日志条目，我将使用现代静态网站生成器。有几个可供选择，包括用Ruby编写的着名的Jekyll，用Go构建的Hugo，以及在Perl中运行此站点的Statocles。对于我的项目，我选择了Hugo，因为它的速度和成熟度。\n与大多数现代静态站点生成器一样，Hugo希望内容采用Markdown格式，文件顶部有一些元数据。我想把我们硬梆梆的旧HTML转换成下面的例子，看起来有点像这样：\n--- title: \u0026#34;Frobnitz 3.141593 released\u0026#34; date: 2016-10-10 description: \u0026#34;This release includes a fog-flavored bauble of three equal sides, providing the restless...\u0026#34; categories: [] aliases: [] toc: false draft: false --- This release includes a fog-flavored bauble of three equal sides, providing the restless digital spirits a brief respite from their painful awareness of impermanence. You can find the new version under the usual shadowy bridge. 所以，首先，我需要获取旧网站。我本可以打扰网站的旧维护者，并获得原始资源，但我决定只是从网上获取它们。一种选择是使用wget或curl; 我们稍后用Mojo::DOM做的事情可以从任何地方使用HTML，包括本地文件。但是，在Perl中完成所有操作似乎更简单。因此，我们将获取页面路径列表，然后对它们进行处理。Mojo::UserAgent努力工作。最简单的示例可能如下所示：\nuse Mojo::UserAgent; my $url = \u0026#39;intro\u0026#39;; my $ua = Mojo::UserAgent-\u0026gt;new; my $tx = $ua-\u0026gt;get(\u0026#34;example.tld/$url.html\u0026#34;); 而已！我们刚刚获取了一个网页。您可能想要打印 $tx 以查看其中的内容（这就是我所做的，而不是首先阅读文档）。但是，它是一个Mojo::Transaction::HTTP对象。我们必须深入了解层次结构，首先查看res属性，它是一个Mojo::Message::Response对象，它有一个body方法：\nprint $tx-\u0026gt;res-\u0026gt;body(); 这将显示响应正文及其HTML内容。但是，这并不是很有趣。但是，我们可以通过Mojo响应轻松地完成更多有趣和强大的事情。\nCSS选择器 该res响应对象提供了一个dom对象，给出了选择使用CSS选择HTML文档的部件的能力。所以，如果我有一个带#maindiv 的文档，我可以使用以下内容检索该div的内容：\nmy $main = $tx-\u0026gt;res-\u0026gt;dom-\u0026gt;find(\u0026#34;#main\u0026#34;); 当然，如果你熟悉CSS选择器，你知道它可以比那更精确。那么，让我们谈谈具体的事情。就我而言，我有几种不同类型的页面。一个是新闻项目的页面，其中有许多部分明确地描述为人类读者，但它们不在他们自己的div中，或者在HTML解析器可以分辨的情况下分组。它们只是一堆模糊的HTML形状。\n我想将这些新闻项目分成各自的页面，然后可以按照我喜欢的方式进行聚合，例如将它们放在分页列表中，或者将最新项目包含在首页的div中。网站。\n这些新闻在旧网站上看起来像这样：\n\u0026lt;h1\u0026gt;Latest News\u0026lt;/h1\u0026gt; \u0026lt;h3\u0026gt;Frobnitz 4.5 released\u0026lt;/h3\u0026gt; \u0026lt;p\u0026gt; This release improves castigation of the widely formed sonterols. \u0026lt;br\u0026gt; Current users may upgrade by applying coil oil to application points A, C, W, DF, Y0, IN34, RS232, and Frank, then gently inserting the conjubilant apparatus into the ferulic treeble socket. \u0026lt;/p\u0026gt; \u0026lt;p class=\u0026#34;post-footer align-right\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;date\u0026#34;\u0026gt;December 2, 2018\u0026lt;/span\u0026gt; \u0026lt;/p\u0026gt; \u0026lt;h3\u0026gt;Frobnitz 4.4 released\u0026lt;/h3\u0026gt; \u0026lt;p\u0026gt; This release is effulgent and wavering gently. \u0026lt;br\u0026gt; Becomes bees. \u0026lt;/p\u0026gt; \u0026lt;p class=\u0026#34;post-footer align-right\u0026#34;\u0026gt; \u0026lt;span class=\u0026#34;date\u0026#34;\u0026gt;November 30, 2018\u0026lt;/span\u0026gt; \u0026lt;/p\u0026gt; 请注意，这种结构是常规的，但不能用任何一个div或一个标记来选择。我可以使用选择器h3来获取标题，但每个新闻项的文本只是一个段落，我们也想分别获取日期。\n因此，我想抓住所有标题，标题后面的段落和日期，并将它们全部放入某种数据结构中，这样我就可以将它们吐出自己的页面。\n让我们从头衔开始吧，因为它会显示一个巧妙的技巧Mojo已经袖手旁观。\nmy $main = $tx-\u0026gt;res-\u0026gt;dom-\u0026gt;at(\u0026#39;#main\u0026#39;); my @headers = $main-\u0026gt;find(\u0026#39;h3\u0026#39;)-\u0026gt;map(\u0026#39;text\u0026#39;)-\u0026gt;each; 你看到了吗？find这里的方法是返回一个Mojo::Collection。“集合”是一种说“列表”的奇特方式，但这些列表有一堆有用的实用方法，类似于在列表上运行的一些核心Perl函数，以及在其中找到的方法List::Util。它具有通常的嫌疑人，像join，grep，map，和each。因此，收藏品很花哨，它们应该得到一个奇特的名字。在上面，在返回的每个项目上map调用方法，并将结果作为列表返回。text``find``each\n在此之后，@headers将包含所有标题。我无法用简单的正则表达式来做到这一点（并且，我们可以将所有这些链接起来，包括找到#main一行，但我再次重新使用#main，所以我将它放入一个变量中）。\n现在，与正则表达式相关的更棘手的事情就是找到这些标题的后续兄弟。但是，使用Mojo::DOM，我们可以通过几行代码来获取它（可能有一种方法可以用更少的代码来实现它，但这是我在几分钟的实验中提出的）。\nmy @paras; for my $header ($main-\u0026gt;find(\u0026#39;h3\u0026#39;)-\u0026gt;each) { push (@paras, $header-\u0026gt;next-\u0026gt;content); } 这将再次选择h3元素，并迭代生成的DOM对象集合，将每个对象放入其中$header。然后，我们挑选出content的的next元素（这在我的情况下，始终是一个段落，有时包含一个或多个br标签），并把它们全部推入@paras。\n所以，现在我们有一个标题数组，以下段落的数组，我们只需要获取日期。这个实际上非常简单，因为HTML模板使用date类标记日期。\nmy @dates = $main-\u0026gt;find(\u0026#39;.date\u0026#39;)-\u0026gt;map(\u0026#39;text\u0026#39;)-\u0026gt;each; 啪！我们完成了。好的，不太好。我们还没有完成这篇文章标题的“重复”部分。我们拥有来自我们糟糕的旧HTML网站的数据，现在让我们用它做点什么。\nMunging the Dates 如上面的示例Hugo内容项所示，我想在元数据中包含日期。幸运的是，我们有与每个新闻项目相关的日期。不幸的是，它们不符合Hugo期望的格式。我对CPAN进行了一些挖掘，发现了Time::Piece，它是一个聪明的模块，可以解析和转换大多数常见格式的时间和日期。\n我需要我的日期看起来像2017-09-30，所以我使用了下面的代码（假设这是一个循环，它将每个后续日期放在@dates我们上面的数组中$date）：\nuse Time::Piece; my $tp = Time::Piece-\u0026gt;strptime($date, \u0026#34;%B %d, %Y\u0026#34;); my $fixed = $tp-\u0026gt;strftime(\u0026#34;%Y-%m-%d\u0026#34;); Munging进入Markdown 我还需要转换为Markdown。我已经使用HTML::WikiConverter完成任务。\n在最简单的形式中，我们可以做这样的事情（再次假设我们在一个循环中$para从@paras每次迭代获取一个值：\nuse HTML::WikiConverter; my $wc = new HTML::WikiConverter(dialect =\u0026gt; \u0026#39;Markdown\u0026#39;); my $md = $wc-\u0026gt;html2wiki( $para ); 完成！\n生成元数据 正如我们之前看到的，Hugo帖子在Markdown内容之前有元数据，并包含诸如作者信息，发布日期，描述等信息。有些是可选的，但有些是强制性的（我需要日期以便我可以显示最新的新网站首页上的新闻。我需要根据从原始HTML收集的信息自动生成所有这些内容。\n我将着眼于如何@entries构建数据结构，但我会提到它是一个包含上面我们发现的三个数据的哈希数组。如果你想看到坚韧不拔的细节，我还会在最后用真实世界的代码链接到GitHub仓库。\nuse Mojo::File; use String::Truncate qw(elide); for my $e (@entries) { my $desc = elide($e-\u0026gt;{\u0026#39;text\u0026#39;}, 100, {at_space =\u0026gt; 1}); my $md = \u0026lt;\u0026lt;\u0026#34;EOF\u0026#34;; --- title: \u0026#34;$e-\u0026gt;{\u0026#39;title\u0026#39;}\u0026#34; date: $e-\u0026gt;{\u0026#39;date\u0026#39;} description: \u0026#34;$desc\u0026#34; categories: [] aliases: [] toc: false draft: false --- $e-\u0026gt;{\u0026#39;text\u0026#39;} EOF my $filename = lc $e-\u0026gt;{\u0026#39;title\u0026#39;}; $filename =~ s/\\s/-/g; $filename =~ s/[!,()\u0026#39;\u0026#34;\\/]//g; my $file = Mojo::File-\u0026gt;new(\u0026#34;content/news/$filename.md\u0026#34;); $file-\u0026gt;spurt($md); } 这里有很多内容，我只会简单地解释一下，因为它与Mojo无关。\n循环的第一行创建描述，通常是摘要或其他。在我的情况下，主站点将显示描述为可点击链接，因此用户将在主页面上获得新闻项目的简短摘要，然后单击它以查看整个项目。我正在使用String::Truncate模块，该模块有一个elide方法将截断字边界上的字符串并添加省略号以指示文本被遗漏。\n然后，在这里的文档中，我使用from填写所有元数据$e，每个元数据只是对散列的引用。然后我们使用Mojo::File的spurt方法将其写入文件。而已！当这是在一个包含预期格式的任意数量新闻项的页面循环中完成时，我们得到了一堆不错的新Hugo帖子。\n为了清晰和简洁（并且因为它是基本的Perl而不是与Mojo相关的），我遗漏了循环并构建了我在生成元数据时使用的数据结构。如果你想在一个地方看到这一切，有一些丑陋的地方来解决破损的日期以及在Markdown中表现不佳的事情（比如表格），你可以看到代码（仍在进行中，但几乎准备好迁移我们胡思乱想的旧网站！）在GitHub上的存储库中。我没有做得漂亮，因为它只需要运行一次，但它可以完成这项工作，而且构建起来并不需要太多时间，这要归功于Mojolicious以及CPAN的其他一些模块。\n"},"name":"第十五天 - 实用的Web内容Munging","published":"2018-12-15T17:15:05Z","summary":"Mojo","type":"entry","url":"http://localhost:1313/notes/%E5%AE%9E%E7%94%A8%E7%9A%84web%E5%86%85%E5%AE%B9munging/"}