{"author":{"name":null,"type":"card","url":"http://localhost:1313/"},"content":{"html":"\u003ch2 id=\"使用-structured-spark-streaming-进行行程划分\"\u003e使用 Structured Spark Streaming 进行行程划分\u003c/h2\u003e\n\u003cp\u003e我们有一辆车, 车上的传感器每隔 1 秒发出一条 JSON 格式的数据。每条数据包含 3 个字段：\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003efield\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003edescription\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003etype\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003eunit\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003evin\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e车辆唯一标识\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eString\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e辆\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003ecreateTime\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e信号发生时间\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eLong\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e毫秒\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003emileage\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e当前里程数\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eInt\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e千米\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e下面一段样本数据:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-json\" data-lang=\"json\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667565,\u0026#39;mileage\u0026#39;:0\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667566,\u0026#39;mileage\u0026#39;:1\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667567,\u0026#39;mileage\u0026#39;:2\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667568,\u0026#39;mileage\u0026#39;:3\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667569,\u0026#39;mileage\u0026#39;:4\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667570,\u0026#39;mileage\u0026#39;:5\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667571,\u0026#39;mileage\u0026#39;:6\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667572,\u0026#39;mileage\u0026#39;:7\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667573,\u0026#39;mileage\u0026#39;:8\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667574,\u0026#39;mileage\u0026#39;:9\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667575,\u0026#39;mileage\u0026#39;:10\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667576,\u0026#39;mileage\u0026#39;:11\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667577,\u0026#39;mileage\u0026#39;:12\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667578,\u0026#39;mileage\u0026#39;:13\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667579,\u0026#39;mileage\u0026#39;:14\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667580,\u0026#39;mileage\u0026#39;:15\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667581,\u0026#39;mileage\u0026#39;:16\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667582,\u0026#39;mileage\u0026#39;:17\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667583,\u0026#39;mileage\u0026#39;:18\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667584,\u0026#39;mileage\u0026#39;:19\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667585,\u0026#39;mileage\u0026#39;:20\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667586,\u0026#39;mileage\u0026#39;:21\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667587,\u0026#39;mileage\u0026#39;:22\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667588,\u0026#39;mileage\u0026#39;:23\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667589,\u0026#39;mileage\u0026#39;:24\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667590,\u0026#39;mileage\u0026#39;:25\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667591,\u0026#39;mileage\u0026#39;:26\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667592,\u0026#39;mileage\u0026#39;:27\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667593,\u0026#39;mileage\u0026#39;:28\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667594,\u0026#39;mileage\u0026#39;:29\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667595,\u0026#39;mileage\u0026#39;:30\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667596,\u0026#39;mileage\u0026#39;:31\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667597,\u0026#39;mileage\u0026#39;:32\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667598,\u0026#39;mileage\u0026#39;:33\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667599,\u0026#39;mileage\u0026#39;:34\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667600,\u0026#39;mileage\u0026#39;:35\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667601,\u0026#39;mileage\u0026#39;:36\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667602,\u0026#39;mileage\u0026#39;:37\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667603,\u0026#39;mileage\u0026#39;:38\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667604,\u0026#39;mileage\u0026#39;:39\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667605,\u0026#39;mileage\u0026#39;:40\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667606,\u0026#39;mileage\u0026#39;:41\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667607,\u0026#39;mileage\u0026#39;:42\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667608,\u0026#39;mileage\u0026#39;:43\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667609,\u0026#39;mileage\u0026#39;:44\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667610,\u0026#39;mileage\u0026#39;:45\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667611,\u0026#39;mileage\u0026#39;:46\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667612,\u0026#39;mileage\u0026#39;:47\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667613,\u0026#39;mileage\u0026#39;:48\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667614,\u0026#39;mileage\u0026#39;:49\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667615,\u0026#39;mileage\u0026#39;:50\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667616,\u0026#39;mileage\u0026#39;:51\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667617,\u0026#39;mileage\u0026#39;:52\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667618,\u0026#39;mileage\u0026#39;:53\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667619,\u0026#39;mileage\u0026#39;:54\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667620,\u0026#39;mileage\u0026#39;:55\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667621,\u0026#39;mileage\u0026#39;:56\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667622,\u0026#39;mileage\u0026#39;:57\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667623,\u0026#39;mileage\u0026#39;:58\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667624,\u0026#39;mileage\u0026#39;:59\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667745,\u0026#39;mileage\u0026#39;:60\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667746,\u0026#39;mileage\u0026#39;:61\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667747,\u0026#39;mileage\u0026#39;:62\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667748,\u0026#39;mileage\u0026#39;:63\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667749,\u0026#39;mileage\u0026#39;:64\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667750,\u0026#39;mileage\u0026#39;:65\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667751,\u0026#39;mileage\u0026#39;:66\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667752,\u0026#39;mileage\u0026#39;:67\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667753,\u0026#39;mileage\u0026#39;:68\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667754,\u0026#39;mileage\u0026#39;:69\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667755,\u0026#39;mileage\u0026#39;:70\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667756,\u0026#39;mileage\u0026#39;:71\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667757,\u0026#39;mileage\u0026#39;:72\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667758,\u0026#39;mileage\u0026#39;:73\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667759,\u0026#39;mileage\u0026#39;:74\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667760,\u0026#39;mileage\u0026#39;:75\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667761,\u0026#39;mileage\u0026#39;:76\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667762,\u0026#39;mileage\u0026#39;:77\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667763,\u0026#39;mileage\u0026#39;:78\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667764,\u0026#39;mileage\u0026#39;:79\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667765,\u0026#39;mileage\u0026#39;:80\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667766,\u0026#39;mileage\u0026#39;:81\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667767,\u0026#39;mileage\u0026#39;:82\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667768,\u0026#39;mileage\u0026#39;:83\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667769,\u0026#39;mileage\u0026#39;:84\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e开车的时候, 从一个地方到另一个地方, 会有很多\u003cstrong\u003e行程\u003c/strong\u003e。\u003c/p\u003e\n\u003cp\u003e行程是一段一段的, 比如你开车送外卖, 每次停车后都要花 5 分钟把外卖送到客户手里, 你一上午送了 3 份外卖, 那么就产生了 3 个行程。每个行程之间的时间之差至少为 5 分钟,  如果 15 分钟你还没送到, 你就得主动打电话给客户说, 对不起, 我到你楼下了, 我先点”已送达“哈。\u003c/p\u003e\n\u003cp\u003e我们今天的任务就是根据传感器发送的数据划分行程。其实就是对这些数据进行分组, 同一个行程的分为一组。划分行程只需要考虑如下 3 种情况：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e（一）行程超时\u003c/li\u003e\n\u003cli\u003e（二）行程正常结束\u003c/li\u003e\n\u003cli\u003e（三）行程正在进行中\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e第一个，行程超时，开始了一个行程，但是结束行程的条件一直不满足，时间到了，这个行程还没有结束，这个时候直接返回这个行程。\u003cbr\u003e\n第二个，行程正常结束，就是俩个信号的 \u003cstrong\u003ecreateTime\u003c/strong\u003e 之差大于 5 分钟, 也就是说，自上一条信号发送之后，已经有 5 分钟没有接收到新的数据了，那么就结束上一个行程，并开始下一个行程。\u003cbr\u003e\n第三个，行程正在进行中，俩个信号的 \u003cstrong\u003ecreateTime\u003c/strong\u003e 之差小于 5 分钟，则认为行程还在继续，只需更新行程状态即可。\u003c/p\u003e\n\u003cp\u003e上面是用 \u003ca href=\"https://raku.org\"\u003eRaku\u003c/a\u003e 模拟的数据, 每隔 1 秒 发送一条数据, 每隔 1 分钟”睡眠“一次, 睡眠的时候不发送数据:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# send-data-to-socket.pl6\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003esub\u003c/span\u003e \u003cspan class=\"nf\"\u003eMAIN\u003c/span\u003e\u003cspan class=\"p\"\u003e(Str :$host = \u0026#39;0.0.0.0\u0026#39;, Int :$port = 3333) {\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$vin\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;LSJA0000000000091\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$last_meter\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003ereact\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003ewhenever\u003c/span\u003e \u003cspan class=\"nn\"\u003eIO::Socket::\u003c/span\u003e\u003cspan class=\"n\"\u003eAsync\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nb\"\u003elisten\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$host\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$port\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e \u003cspan class=\"nv\"\u003e$conn\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003ereact\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"n\"\u003eBool:D\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ignore\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eTrue\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"n\"\u003ewhenever\u003c/span\u003e \u003cspan class=\"n\"\u003eSupply\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einterval\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e60\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erotor\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"nv\"\u003e$ignore\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e!\u003c/span\u003e\u003cspan class=\"nv\"\u003e$ignore\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"n\"\u003ewhenever\u003c/span\u003e \u003cspan class=\"n\"\u003eSupply\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003einterval\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"k\"\u003enext\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nv\"\u003e$ignore\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"k\"\u003eprint\u003c/span\u003e \u003cspan class=\"nb\"\u003esprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\\{\u0026#39;vin\u0026#39;:\u0026#39;%s\u0026#39;,\u0026#39;createTime\u0026#39;:%s,\u0026#39;mileage\u0026#39;:%s}\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$vin\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enow\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eposix\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$last_meter\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"nv\"\u003e$conn\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"k\"\u003eprint\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"nb\"\u003esprintf\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\\{\u0026#39;vin\u0026#39;:\u0026#39;%s\u0026#39;,\u0026#39;createTime\u0026#39;:%s,\u0026#39;mileage\u0026#39;:%s}\\n\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$vin\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eDateTime\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003enow\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eposix\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$last_meter\u003c/span\u003e\u003cspan class=\"o\"\u003e++\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"n\"\u003ewhenever\u003c/span\u003e \u003cspan class=\"n\"\u003esignal\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eSIGINT\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;Done.\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"n\"\u003edone\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003eCATCH\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003edefault\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"o\"\u003e.^\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;: \u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eStr\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;handled in $?LINE\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e以下是使用 Structured Spark Streaming 实现的行程划分:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003epackage\u003c/span\u003e \u003cspan class=\"nn\"\u003eohmysummer\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003ecom.alibaba.fastjson.JSON\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eohmysummer.conf.SocketConfiguration\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eohmysummer.model.SourceData\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eorg.apache.spark.sql._\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eorg.apache.spark.sql.streaming.\u003c/span\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003e\u003cspan class=\"nc\"\u003eGroupState\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eGroupStateTimeout\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eOutputMode\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eTrigger\u003c/span\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eorg.apache.spark.streaming.Duration\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  * 使用 Structured Streaming 进行行程划分\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  * 问题：一个 sourceData 里面, 某 vin 会有俩个或俩个以上的行程吗？\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  * 超时时间为 15 分钟, 超时则返回 TripUpdate, 并将 status 置为 2\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  * 俩条数据之间的 createTime 之差如果大于 5 分钟, 则结束上一个行程, 并开始下一个行程\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  * 数据每 5 秒一个微批，可知一个微批里面, 某 vin 不会出现俩个以上的行程!\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  *\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  * 我们测试当然不用等那么久, ProcessingTime 即微批时间我们设置为 1s\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  * 俩条数据之间的 createTime 之差如果大于 1 分钟, 则结束上一个行程, 并开始下一个新的行程\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  * 超时时间设置为 3 分钟\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eobject\u003c/span\u003e \u003cspan class=\"nc\"\u003eSubTrip\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"n\"\u003emain\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eargs\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eArray\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e])\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eUnit\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003esocketConf\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nc\"\u003eSocketConfiguration\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003ehost\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esocketConf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ehost\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003eport\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esocketConf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eport\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003espark\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eSparkSession\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nc\"\u003eSparkSession\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ebuilder\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emaster\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;local[2]\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eappName\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Stateful Structured Streaming\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetOrCreate\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003espark\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esparkContext\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esetLogLevel\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;WARN\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003espark.implicits._\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003eds\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDataset\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003espark\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ereadStream\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eformat\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;socket\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoption\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;host\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ehost\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoption\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;port\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eport\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eload\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eas\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003eevents\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eds\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"n\"\u003eline\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e       \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"nc\"\u003eJSON\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eparseObject\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eline\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003evin\u003c/span\u003e        \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetString\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;vin\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003ecreateTime\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetLong\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;createTime\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003emileage\u003c/span\u003e    \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetLong\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;mileage\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"c1\"\u003e// 将每行数据转换为 SourceData 数据源\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e      \u003cspan class=\"nc\"\u003eSourceData\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evin\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ecreateTime\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003emileage\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003etripIdleTimeout\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDuration\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nc\"\u003eDuration\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e60\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e1000\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// 状态闲置时长，超时时间 3 分钟\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003etripDuration\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDuration\u003c/span\u003e    \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nc\"\u003eDuration\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e60\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e1000\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// 两个行程间隔时长，1 分钟\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003efinish\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eevents\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egroupByKey\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eevent\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003eevent\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003evin\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emapGroupsWithState\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eTripInfo\u003c/span\u003e, \u003cspan class=\"kt\"\u003eTripUpdate\u003c/span\u003e\u003cspan class=\"o\"\u003e](\u003c/span\u003e\u003cspan class=\"nc\"\u003eGroupStateTimeout\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nc\"\u003eProcessingTimeTimeout\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003evin\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003esource\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eIterator\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eSourceData\u003c/span\u003e\u003cspan class=\"o\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eGroupState\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eTripInfo\u003c/span\u003e\u003cspan class=\"o\"\u003e])\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u0026gt;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ehasTimedOut\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026amp;\u0026amp;\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eexists\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 超时\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e          \u003cspan class=\"nc\"\u003eTripUpdate\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003evin\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripStartTime\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripEndTime\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estartMileage\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eendMileage\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripDuration\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripDistance\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003etripStatus\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 超时结束的行程\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e          \u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          \u003cspan class=\"c1\"\u003e// Iterator 消费一次就没有了, 下面多次用到 source 源数据, 所以要转成 Seq,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e          \u003cspan class=\"c1\"\u003e// 否则第二个使用 source 的函数接受到的 data 就是空的了, 会报错\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e          \u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esource\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etoSeq\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003elastTrip\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003egetLastState\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 获取该车旧的行程状态\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          \u003cspan class=\"c1\"\u003e// 更新行程信息\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e          \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eexists\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esetTimeoutDuration\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etripIdleTimeout\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emilliseconds\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003elastTripInfo\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 获取旧的行程的状态\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"c1\"\u003e// 找到第一个 1 分钟未上传数据的点\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e            \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e\u003cspan class=\"o\"\u003e{\u003c/span\u003e \u003cspan class=\"k\"\u003e_\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecreateTime\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e1000L\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003elastTrip\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripEndTime\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e1000L\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003etripDuration\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emilliseconds\u003c/span\u003e \u003cspan class=\"o\"\u003e}.\u003c/span\u003e\u003cspan class=\"n\"\u003eforeach\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eprintln\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003e_\u003c/span\u003e\u003cspan class=\"o\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003eguard\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eOption\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eSourceData\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efind\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003e_\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecreateTime\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e1000L\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003elastTrip\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripEndTime\u003c/span\u003e \u003cspan class=\"o\"\u003e*\u003c/span\u003e \u003cspan class=\"mi\"\u003e1000L\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003etripDuration\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emilliseconds\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003eguard\u003c/span\u003e \u003cspan class=\"k\"\u003ematch\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"nc\"\u003eSome\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ed\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 划分行程\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e                \u003cspan class=\"n\"\u003eprintln\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;开始划分新的行程了： \u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripStartTime\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estartMileage\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripEndTime\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eendMileage\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"n\"\u003einitState\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 初始化一个新的行程\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e                \u003cspan class=\"n\"\u003eprintln\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;初始化新的行程后： \u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripStartTime\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estartMileage\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripEndTime\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eendMileage\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"n\"\u003eprintln\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;lastTripInfo: \u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elastTripInfo\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripStartTime\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elastTripInfo\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripEndTime\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"nc\"\u003eTripUpdate\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                  \u003cspan class=\"n\"\u003evin\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                  \u003cspan class=\"n\"\u003etripStartTime\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elastTripInfo\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripStartTime\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                  \u003cspan class=\"n\"\u003etripEndTime\u003c/span\u003e   \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elastTripInfo\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripEndTime\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                  \u003cspan class=\"n\"\u003estartMileage\u003c/span\u003e  \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elastTripInfo\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estartMileage\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                  \u003cspan class=\"n\"\u003eendMileage\u003c/span\u003e    \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elastTripInfo\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eendMileage\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                  \u003cspan class=\"n\"\u003etripDuration\u003c/span\u003e  \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elastTripInfo\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripDuration\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                  \u003cspan class=\"n\"\u003etripDistance\u003c/span\u003e  \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003elastTripInfo\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripDistance\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                  \u003cspan class=\"n\"\u003etripStatus\u003c/span\u003e    \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 正常结束的行程\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e                \u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"k\"\u003e_\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003eupdatedTripInfo\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003egetUpdateState\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eupdate\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eupdatedTripInfo\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"nc\"\u003eTripUpdate\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                  \u003cspan class=\"n\"\u003evin\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                  \u003cspan class=\"n\"\u003etripStartTime\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripStartTime\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                  \u003cspan class=\"n\"\u003etripEndTime\u003c/span\u003e   \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripEndTime\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                  \u003cspan class=\"n\"\u003estartMileage\u003c/span\u003e  \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estartMileage\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                  \u003cspan class=\"n\"\u003eendMileage\u003c/span\u003e    \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eendMileage\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                  \u003cspan class=\"n\"\u003etripDuration\u003c/span\u003e  \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripDuration\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                  \u003cspan class=\"n\"\u003etripDistance\u003c/span\u003e  \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripDistance\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                  \u003cspan class=\"n\"\u003etripStatus\u003c/span\u003e    \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e2\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 正常进行中的行程\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e                \u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          \u003cspan class=\"o\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e \u003cspan class=\"c1\"\u003e// state 不存在, 则为第一次新进来的数据, 那么初始化一个初始状态\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e            \u003cspan class=\"n\"\u003einitState\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edata\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003eprintln\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;initState: \u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripStartTime\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estartMileage\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripEndTime\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eendMileage\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003eprintln\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;current State: \u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripStartTime\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estartMileage\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripEndTime\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eendMileage\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003eupdatedTripInfo\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"nc\"\u003eTripInfo\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripStartTime\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripEndTime\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estartMileage\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eendMileage\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eupdate\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eupdatedTripInfo\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"nc\"\u003eTripUpdate\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"n\"\u003evin\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"n\"\u003etripStartTime\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripStartTime\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"n\"\u003etripEndTime\u003c/span\u003e   \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripEndTime\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"n\"\u003estartMileage\u003c/span\u003e  \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estartMileage\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"n\"\u003eendMileage\u003c/span\u003e    \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eendMileage\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"n\"\u003etripDuration\u003c/span\u003e  \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripDuration\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"n\"\u003etripDistance\u003c/span\u003e  \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripDistance\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"n\"\u003etripStatus\u003c/span\u003e    \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 初始的行程\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e            \u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003efinish\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewriteStream\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoutputMode\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eOutputMode\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nc\"\u003eUpdate\u003c/span\u003e\u003cspan class=\"o\"\u003e())\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etrigger\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eTrigger\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nc\"\u003eProcessingTime\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;1 seconds\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eformat\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;console\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoption\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;truncate\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;false\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estart\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eawaitTermination\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"cm\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e    * @param sourceData 新的源数据序列\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e    * @param state 旧的状态\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e    * @return\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e    */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"n\"\u003egetUpdateState\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esourceData\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eSeq\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eSourceData\u003c/span\u003e\u003cspan class=\"o\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eGroupState\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eTripInfo\u003c/span\u003e\u003cspan class=\"o\"\u003e])\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTripInfo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etripStartTime\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etripEndTime\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003estartMileage\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eendMileage\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003etripStartTime\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etripStartTime\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003estartMileage\u003c/span\u003e  \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estartMileage\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003etripEndTime\u003c/span\u003e   \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esourceData\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003e_\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecreateTime\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003emax\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 更新 tripEndTime\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \u003cspan class=\"n\"\u003eendMileage\u003c/span\u003e    \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esourceData\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003e_\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emileage\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003emax\u003c/span\u003e    \u003cspan class=\"c1\"\u003e// 更新 endMileage\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nc\"\u003eTripInfo\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"n\"\u003etripStartTime\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"n\"\u003etripEndTime\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"n\"\u003estartMileage\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"n\"\u003eendMileage\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"cm\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e    * 获取上一个行程的状态\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e    * @param sourceData 新摄入的源数据序列\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e    * @param state 内存中上一个行程的状态\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e    * @return 刷新后的行程信息\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e    */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"n\"\u003egetLastState\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esourceData\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eSeq\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eSourceData\u003c/span\u003e\u003cspan class=\"o\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eGroupState\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eTripInfo\u003c/span\u003e\u003cspan class=\"o\"\u003e])\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eTripInfo\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eexists\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eget\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e}\u003c/span\u003e \u003cspan class=\"k\"\u003eelse\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 如果状态不存在, 则 sourceData 是新的源数据\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003etripStartTime\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esourceData\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003e_\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecreateTime\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003emin\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003estartMileage\u003c/span\u003e  \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esourceData\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003e_\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emileage\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003emin\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nc\"\u003eTripInfo\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003etripStartTime\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003etripEndTime\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etripStartTime\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"c1\"\u003e// 将新的源数据序列中的 createTime 最小值作为行程开始时间\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e        \u003cspan class=\"n\"\u003estartMileage\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003eendMileage\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estartMileage\u003c/span\u003e    \u003cspan class=\"c1\"\u003e// 将新的源数据序列中的 mileage 最小值作为行程开始里程\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e      \u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"cm\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e    * 初始化下一个行程\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e    * @param sourceData 新的源数据序列\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e    * @param state 内存中的旧的 state\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e    */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"n\"\u003einitState\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esourceData\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eSeq\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eSourceData\u003c/span\u003e\u003cspan class=\"o\"\u003e],\u003c/span\u003e \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eGroupState\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eTripInfo\u003c/span\u003e\u003cspan class=\"o\"\u003e])\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eUnit\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003etripStartTime\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esourceData\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003e_\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecreateTime\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003emin\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003estartMileage\u003c/span\u003e  \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003esourceData\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emap\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"k\"\u003e_\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emileage\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003emin\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003einitTripInfo\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"nc\"\u003eTripInfo\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"n\"\u003etripStartTime\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"n\"\u003etripEndTime\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etripStartTime\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"n\"\u003estartMileage\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"n\"\u003eendMileage\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003estartMileage\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003estate\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eupdate\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003einitTripInfo\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  * 行程信息\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  * @param tripStartTime 行程开始时间\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  * @param tripEndTime   行程结束时间\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  * @param startMileage  开始里程数\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  * @param endMileage    结束里程数\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTripInfo\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etripStartTime\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etripEndTime\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e   \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003estartMileage\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e  \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eendMileage\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e    \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"n\"\u003etripDuration\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003etripEndTime\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003etripStartTime\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"n\"\u003etripDistance\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eendMileage\u003c/span\u003e  \u003cspan class=\"o\"\u003e-\u003c/span\u003e \u003cspan class=\"n\"\u003estartMileage\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  * 更新后的行程\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  * @param vin           车架号\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  * @param tripStartTime 行程开始时间\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  * @param tripEndTime   行程结束时间\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  * @param startMileage  开始里程数\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  * @param endMileage    结束里程数\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  * @param tripDuration  行驶时长\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  * @param tripDistance  行驶距离\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  * @param tripStatus    行程状态\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eTripUpdate\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003evin\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e               \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etripStartTime\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etripEndTime\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e   \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003estartMileage\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e  \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003eendMileage\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e    \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etripDuration\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e  \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etripDistance\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e  \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003evar\u003c/span\u003e \u003cspan class=\"n\"\u003etripStatus\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e    \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003cstrong\u003eSourceData\u003c/strong\u003e 是一个 case class:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e/**\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  * 数据源\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  * @param vin        车架号\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  * @param createTime 信号发生时间\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  * @param mileage    当前里程\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cm\"\u003e  */\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eSourceData\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   \u003cspan class=\"n\"\u003evin\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e        \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   \u003cspan class=\"n\"\u003ecreateTime\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e   \u003cspan class=\"n\"\u003emileage\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e    \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e和\u003ca href=\"https://ohmycloud.github.io/2018/11/18/Send-Data-To-Socket/\"\u003e之前\u003c/a\u003e一样, 先执行：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003eraku send-data-to-socket.pl6\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e再启动该 structured spark streaming 程序:\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e#!/bin/sh\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"cp\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003espark-submit \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --class ohmysummer.SubTrip \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --master local\u003cspan class=\"o\"\u003e[\u003c/span\u003e2\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --deploy-mode client \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --driver-memory 2g \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --driver-cores \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --executor-memory 2g \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --executor-cores \u003cspan class=\"m\"\u003e2\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  --num-executors \u003cspan class=\"m\"\u003e4\u003c/span\u003e \u003cspan class=\"se\"\u003e\\\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"se\"\u003e\u003c/span\u003e  target/socket-structured-streaming-1.0-SNAPSHOT.jar\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e打印的日志如下:\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e2019-01-05 14:11:45 WARN  ProcessingTimeExecutor:66 - Current batch is falling behind. The trigger interval is 1000 milliseconds, but spent 1676 milliseconds\n61000\n(开始划分新的行程了： ,1546668643,179,1546668702,238)\n(初始化新的行程后： ,1546668823,239,1546668823,239)\n(lastTripInfo: ,1546668643,1546668702)\n-------------------------------------------\nBatch: 112\n-------------------------------------------\n+-----------------+-------------+-----------+------------+----------+------------+------------+----------+\n|vin              |tripStartTime|tripEndTime|startMileage|endMileage|tripDuration|tripDistance|tripStatus|\n+-----------------+-------------+-----------+------------+----------+------------+------------+----------+\n|LSJA0000000000091|1546668643   |1546668702 |179         |238       |59          |59          |1         |\n+-----------------+-------------+-----------+------------+----------+------------+------------+----------+\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e源代码在\u003ca href=\"https://github.com/ohmycloud/sub_trip_with_structured_spark_streaming\"\u003e这里\u003c/a\u003e。\u003c/p\u003e\n\u003cp\u003e下次再见，新年快乐！\u003c/p\u003e\n","text":"使用 Structured Spark Streaming 进行行程划分 我们有一辆车, 车上的传感器每隔 1 秒发出一条 JSON 格式的数据。每条数据包含 3 个字段：\nfield description type unit vin 车辆唯一标识 String 辆 createTime 信号发生时间 Long 毫秒 mileage 当前里程数 Int 千米 下面一段样本数据:\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667565,\u0026#39;mileage\u0026#39;:0} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667566,\u0026#39;mileage\u0026#39;:1} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667567,\u0026#39;mileage\u0026#39;:2} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667568,\u0026#39;mileage\u0026#39;:3} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667569,\u0026#39;mileage\u0026#39;:4} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667570,\u0026#39;mileage\u0026#39;:5} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667571,\u0026#39;mileage\u0026#39;:6} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667572,\u0026#39;mileage\u0026#39;:7} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667573,\u0026#39;mileage\u0026#39;:8} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667574,\u0026#39;mileage\u0026#39;:9} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667575,\u0026#39;mileage\u0026#39;:10} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667576,\u0026#39;mileage\u0026#39;:11} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667577,\u0026#39;mileage\u0026#39;:12} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667578,\u0026#39;mileage\u0026#39;:13} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667579,\u0026#39;mileage\u0026#39;:14} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667580,\u0026#39;mileage\u0026#39;:15} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667581,\u0026#39;mileage\u0026#39;:16} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667582,\u0026#39;mileage\u0026#39;:17} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667583,\u0026#39;mileage\u0026#39;:18} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667584,\u0026#39;mileage\u0026#39;:19} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667585,\u0026#39;mileage\u0026#39;:20} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667586,\u0026#39;mileage\u0026#39;:21} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667587,\u0026#39;mileage\u0026#39;:22} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667588,\u0026#39;mileage\u0026#39;:23} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667589,\u0026#39;mileage\u0026#39;:24} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667590,\u0026#39;mileage\u0026#39;:25} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667591,\u0026#39;mileage\u0026#39;:26} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667592,\u0026#39;mileage\u0026#39;:27} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667593,\u0026#39;mileage\u0026#39;:28} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667594,\u0026#39;mileage\u0026#39;:29} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667595,\u0026#39;mileage\u0026#39;:30} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667596,\u0026#39;mileage\u0026#39;:31} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667597,\u0026#39;mileage\u0026#39;:32} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667598,\u0026#39;mileage\u0026#39;:33} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667599,\u0026#39;mileage\u0026#39;:34} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667600,\u0026#39;mileage\u0026#39;:35} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667601,\u0026#39;mileage\u0026#39;:36} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667602,\u0026#39;mileage\u0026#39;:37} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667603,\u0026#39;mileage\u0026#39;:38} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667604,\u0026#39;mileage\u0026#39;:39} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667605,\u0026#39;mileage\u0026#39;:40} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667606,\u0026#39;mileage\u0026#39;:41} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667607,\u0026#39;mileage\u0026#39;:42} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667608,\u0026#39;mileage\u0026#39;:43} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667609,\u0026#39;mileage\u0026#39;:44} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667610,\u0026#39;mileage\u0026#39;:45} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667611,\u0026#39;mileage\u0026#39;:46} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667612,\u0026#39;mileage\u0026#39;:47} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667613,\u0026#39;mileage\u0026#39;:48} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667614,\u0026#39;mileage\u0026#39;:49} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667615,\u0026#39;mileage\u0026#39;:50} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667616,\u0026#39;mileage\u0026#39;:51} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667617,\u0026#39;mileage\u0026#39;:52} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667618,\u0026#39;mileage\u0026#39;:53} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667619,\u0026#39;mileage\u0026#39;:54} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667620,\u0026#39;mileage\u0026#39;:55} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667621,\u0026#39;mileage\u0026#39;:56} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667622,\u0026#39;mileage\u0026#39;:57} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667623,\u0026#39;mileage\u0026#39;:58} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667624,\u0026#39;mileage\u0026#39;:59} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667745,\u0026#39;mileage\u0026#39;:60} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667746,\u0026#39;mileage\u0026#39;:61} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667747,\u0026#39;mileage\u0026#39;:62} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667748,\u0026#39;mileage\u0026#39;:63} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667749,\u0026#39;mileage\u0026#39;:64} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667750,\u0026#39;mileage\u0026#39;:65} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667751,\u0026#39;mileage\u0026#39;:66} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667752,\u0026#39;mileage\u0026#39;:67} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667753,\u0026#39;mileage\u0026#39;:68} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667754,\u0026#39;mileage\u0026#39;:69} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667755,\u0026#39;mileage\u0026#39;:70} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667756,\u0026#39;mileage\u0026#39;:71} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667757,\u0026#39;mileage\u0026#39;:72} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667758,\u0026#39;mileage\u0026#39;:73} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667759,\u0026#39;mileage\u0026#39;:74} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667760,\u0026#39;mileage\u0026#39;:75} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667761,\u0026#39;mileage\u0026#39;:76} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667762,\u0026#39;mileage\u0026#39;:77} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667763,\u0026#39;mileage\u0026#39;:78} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667764,\u0026#39;mileage\u0026#39;:79} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667765,\u0026#39;mileage\u0026#39;:80} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667766,\u0026#39;mileage\u0026#39;:81} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667767,\u0026#39;mileage\u0026#39;:82} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667768,\u0026#39;mileage\u0026#39;:83} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667769,\u0026#39;mileage\u0026#39;:84} 开车的时候, 从一个地方到另一个地方, 会有很多行程。\n行程是一段一段的, 比如你开车送外卖, 每次停车后都要花 5 分钟把外卖送到客户手里, 你一上午送了 3 份外卖, 那么就产生了 3 个行程。每个行程之间的时间之差至少为 5 分钟, 如果 15 分钟你还没送到, 你就得主动打电话给客户说, 对不起, 我到你楼下了, 我先点”已送达“哈。\n我们今天的任务就是根据传感器发送的数据划分行程。其实就是对这些数据进行分组, 同一个行程的分为一组。划分行程只需要考虑如下 3 种情况：\n（一）行程超时 （二）行程正常结束 （三）行程正在进行中 第一个，行程超时，开始了一个行程，但是结束行程的条件一直不满足，时间到了，这个行程还没有结束，这个时候直接返回这个行程。\n第二个，行程正常结束，就是俩个信号的 createTime 之差大于 5 分钟, 也就是说，自上一条信号发送之后，已经有 5 分钟没有接收到新的数据了，那么就结束上一个行程，并开始下一个行程。\n第三个，行程正在进行中，俩个信号的 createTime 之差小于 5 分钟，则认为行程还在继续，只需更新行程状态即可。\n上面是用 Raku 模拟的数据, 每隔 1 秒 发送一条数据, 每隔 1 分钟”睡眠“一次, 睡眠的时候不发送数据:\n# send-data-to-socket.pl6 sub MAIN(Str :$host = \u0026#39;0.0.0.0\u0026#39;, Int :$port = 3333) { my $vin = \u0026#39;LSJA0000000000091\u0026#39;; my $last_meter = 0; react { whenever IO::Socket::Async.listen($host, $port) -\u0026gt; $conn { react { my Bool:D $ignore = True; whenever Supply.interval(60).rotor(1, 1 =\u0026gt; 1) { $ignore = !$ignore; } whenever Supply.interval(1) { next if $ignore; print sprintf(\u0026#34;\\{\u0026#39;vin\u0026#39;:\u0026#39;%s\u0026#39;,\u0026#39;createTime\u0026#39;:%s,\u0026#39;mileage\u0026#39;:%s}\\n\u0026#34;, $vin, DateTime.now.posix, $last_meter); $conn.print: sprintf(\u0026#34;\\{\u0026#39;vin\u0026#39;:\u0026#39;%s\u0026#39;,\u0026#39;createTime\u0026#39;:%s,\u0026#39;mileage\u0026#39;:%s}\\n\u0026#34;, $vin, DateTime.now.posix, $last_meter++); } whenever signal(SIGINT) { say \u0026#34;Done.\u0026#34;; done; } } } CATCH { default { say .^name, \u0026#39;: \u0026#39;, .Str; say \u0026#34;handled in $?LINE\u0026#34;; } } } } 以下是使用 Structured Spark Streaming 实现的行程划分:\npackage ohmysummer import com.alibaba.fastjson.JSON import ohmysummer.conf.SocketConfiguration import ohmysummer.model.SourceData import org.apache.spark.sql._ import org.apache.spark.sql.streaming.{GroupState, GroupStateTimeout, OutputMode, Trigger} import org.apache.spark.streaming.Duration /** * 使用 Structured Streaming 进行行程划分 * 问题：一个 sourceData 里面, 某 vin 会有俩个或俩个以上的行程吗？ * 超时时间为 15 分钟, 超时则返回 TripUpdate, 并将 status 置为 2 * 俩条数据之间的 createTime 之差如果大于 5 分钟, 则结束上一个行程, 并开始下一个行程 * 数据每 5 秒一个微批，可知一个微批里面, 某 vin 不会出现俩个以上的行程! * * 我们测试当然不用等那么久, ProcessingTime 即微批时间我们设置为 1s * 俩条数据之间的 createTime 之差如果大于 1 分钟, 则结束上一个行程, 并开始下一个新的行程 * 超时时间设置为 3 分钟 */ object SubTrip { def main(args: Array[String]): Unit = { val socketConf = new SocketConfiguration val host = socketConf.host val port = socketConf.port val spark: SparkSession = SparkSession.builder .master(\u0026#34;local[2]\u0026#34;) .appName(\u0026#34;Stateful Structured Streaming\u0026#34;) .getOrCreate() spark.sparkContext.setLogLevel(\u0026#34;WARN\u0026#34;) import spark.implicits._ val ds: Dataset[String] = spark.readStream .format(\u0026#34;socket\u0026#34;) .option(\u0026#34;host\u0026#34;, host) .option(\u0026#34;port\u0026#34;, port) .load() .as[String] val events = ds.map { case line =\u0026gt; val data = JSON.parseObject(line) val vin = data.getString(\u0026#34;vin\u0026#34;) val createTime = data.getLong(\u0026#34;createTime\u0026#34;) val mileage = data.getLong(\u0026#34;mileage\u0026#34;) // 将每行数据转换为 SourceData 数据源 SourceData(vin, createTime, mileage) } val tripIdleTimeout: Duration = Duration(3 * 60 * 1000) // 状态闲置时长，超时时间 3 分钟 val tripDuration: Duration = Duration(1 * 60 * 1000) // 两个行程间隔时长，1 分钟 val finish = events .groupByKey(event =\u0026gt; event.vin) .mapGroupsWithState[TripInfo, TripUpdate](GroupStateTimeout.ProcessingTimeTimeout) { case (vin: String, source: Iterator[SourceData], state: GroupState[TripInfo]) =\u0026gt; if (state.hasTimedOut \u0026amp;\u0026amp; state.exists) { // 超时 TripUpdate( vin, state.get.tripStartTime, state.get.tripEndTime, state.get.startMileage, state.get.endMileage, state.get.tripDuration, state.get.tripDistance, tripStatus = 0 // 超时结束的行程 ) } else { // Iterator 消费一次就没有了, 下面多次用到 source 源数据, 所以要转成 Seq, // 否则第二个使用 source 的函数接受到的 data 就是空的了, 会报错 val data = source.toSeq var lastTrip = getLastState(data, state) // 获取该车旧的行程状态 // 更新行程信息 if (state.exists) { state.setTimeoutDuration(tripIdleTimeout.milliseconds) val lastTripInfo = state.get // 获取旧的行程的状态 // 找到第一个 1 分钟未上传数据的点 data.map{ _.createTime * 1000L - lastTrip.tripEndTime * 1000L - tripDuration.milliseconds }.foreach(println(_)) val guard: Option[SourceData] = data.find(_.createTime * 1000L - lastTrip.tripEndTime * 1000L - tripDuration.milliseconds \u0026gt; 0) guard match { case Some(d) =\u0026gt; { // 划分行程 println(\u0026#34;开始划分新的行程了： \u0026#34;, state.get.tripStartTime, state.get.startMileage, state.get.tripEndTime, state.get.endMileage) initState(data, state) // 初始化一个新的行程 println(\u0026#34;初始化新的行程后： \u0026#34;, state.get.tripStartTime, state.get.startMileage, state.get.tripEndTime, state.get.endMileage) println(\u0026#34;lastTripInfo: \u0026#34;, lastTripInfo.tripStartTime, lastTripInfo.tripEndTime) TripUpdate( vin, tripStartTime = lastTripInfo.tripStartTime, tripEndTime = lastTripInfo.tripEndTime, startMileage = lastTripInfo.startMileage, endMileage = lastTripInfo.endMileage, tripDuration = lastTripInfo.tripDuration, tripDistance = lastTripInfo.tripDistance, tripStatus = 1 // 正常结束的行程 ) } case _ =\u0026gt; { val updatedTripInfo = getUpdateState(data, state) state.update(updatedTripInfo) TripUpdate( vin, tripStartTime = state.get.tripStartTime, tripEndTime = state.get.tripEndTime, startMileage = state.get.startMileage, endMileage = state.get.endMileage, tripDuration = state.get.tripDuration, tripDistance = state.get.tripDistance, tripStatus = 2 // 正常进行中的行程 ) } } } else { // state 不存在, 则为第一次新进来的数据, 那么初始化一个初始状态 initState(data, state) println(\u0026#34;initState: \u0026#34;, state.get.tripStartTime, state.get.startMileage, state.get.tripEndTime, state.get.endMileage) println(\u0026#34;current State: \u0026#34;, state.get.tripStartTime, state.get.startMileage, state.get.tripEndTime, state.get.endMileage) val updatedTripInfo = TripInfo( state.get.tripStartTime, state.get.tripEndTime, state.get.startMileage, state.get.endMileage ) state.update(updatedTripInfo) TripUpdate( vin, tripStartTime = state.get.tripStartTime, tripEndTime = state.get.tripEndTime, startMileage = state.get.startMileage, endMileage = state.get.endMileage, tripDuration = state.get.tripDuration, tripDistance = state.get.tripDistance, tripStatus = 0 // 初始的行程 ) } } } finish.writeStream .outputMode(OutputMode.Update()) .trigger(Trigger.ProcessingTime(\u0026#34;1 seconds\u0026#34;)) .format(\u0026#34;console\u0026#34;) .option(\u0026#34;truncate\u0026#34;, \u0026#34;false\u0026#34;) .start() .awaitTermination() } /** * @param sourceData 新的源数据序列 * @param state 旧的状态 * @return */ def getUpdateState(sourceData: Seq[SourceData], state: GroupState[TripInfo]): TripInfo = { var tripStartTime: Long = 0 var tripEndTime: Long = 0 var startMileage: Long = 0 var endMileage: Long = 0 tripStartTime = state.get.tripStartTime startMileage = state.get.startMileage tripEndTime = sourceData.map(_.createTime).max // 更新 tripEndTime endMileage = sourceData.map(_.mileage).max // 更新 endMileage TripInfo( tripStartTime, tripEndTime, startMileage, endMileage ) } /** * 获取上一个行程的状态 * @param sourceData 新摄入的源数据序列 * @param state 内存中上一个行程的状态 * @return 刷新后的行程信息 */ def getLastState(sourceData: Seq[SourceData], state: GroupState[TripInfo]): TripInfo = { if (state.exists) { state.get } else { // 如果状态不存在, 则 sourceData 是新的源数据 val tripStartTime = sourceData.map(_.createTime).min val startMileage = sourceData.map(_.mileage).min TripInfo( tripStartTime, tripEndTime = tripStartTime, // 将新的源数据序列中的 createTime 最小值作为行程开始时间 startMileage, endMileage = startMileage // 将新的源数据序列中的 mileage 最小值作为行程开始里程 ) } } /** * 初始化下一个行程 * @param sourceData 新的源数据序列 * @param state 内存中的旧的 state */ def initState(sourceData: Seq[SourceData], state: GroupState[TripInfo]): Unit = { val tripStartTime = sourceData.map(_.createTime).min val startMileage = sourceData.map(_.mileage).min val initTripInfo = TripInfo( tripStartTime, tripEndTime = tripStartTime, startMileage, endMileage = startMileage ) state.update(initTripInfo) } } /** * 行程信息 * @param tripStartTime 行程开始时间 * @param tripEndTime 行程结束时间 * @param startMileage 开始里程数 * @param endMileage 结束里程数 */ case class TripInfo( var tripStartTime: Long, var tripEndTime: Long, var startMileage: Long, var endMileage: Long ) { def tripDuration: Long = tripEndTime - tripStartTime def tripDistance: Long = endMileage - startMileage } /** * 更新后的行程 * @param vin 车架号 * @param tripStartTime 行程开始时间 * @param tripEndTime 行程结束时间 * @param startMileage 开始里程数 * @param endMileage 结束里程数 * @param tripDuration 行驶时长 * @param tripDistance 行驶距离 * @param tripStatus 行程状态 */ case class TripUpdate( vin: String, var tripStartTime: Long, var tripEndTime: Long, var startMileage: Long, var endMileage: Long, var tripDuration: Long, var tripDistance: Long, var tripStatus: Int ) SourceData 是一个 case class:\n/** * 数据源 * @param vin 车架号 * @param createTime 信号发生时间 * @param mileage 当前里程 */ case class SourceData ( vin: String, createTime: Long, mileage: Long ) 和之前一样, 先执行：\nraku send-data-to-socket.pl6 再启动该 structured spark streaming 程序:\n#!/bin/sh spark-submit \\ --class ohmysummer.SubTrip \\ --master local[2] \\ --deploy-mode client \\ --driver-memory 2g \\ --driver-cores 2 \\ --executor-memory 2g \\ --executor-cores 2 \\ --num-executors 4 \\ target/socket-structured-streaming-1.0-SNAPSHOT.jar 打印的日志如下:\n2019-01-05 14:11:45 WARN ProcessingTimeExecutor:66 - Current batch is falling behind. The trigger interval is 1000 milliseconds, but spent 1676 milliseconds 61000 (开始划分新的行程了： ,1546668643,179,1546668702,238) (初始化新的行程后： ,1546668823,239,1546668823,239) (lastTripInfo: ,1546668643,1546668702) ------------------------------------------- Batch: 112 ------------------------------------------- +-----------------+-------------+-----------+------------+----------+------------+------------+----------+ |vin |tripStartTime|tripEndTime|startMileage|endMileage|tripDuration|tripDistance|tripStatus| +-----------------+-------------+-----------+------------+----------+------------+------------+----------+ |LSJA0000000000091|1546668643 |1546668702 |179 |238 |59 |59 |1 | +-----------------+-------------+-----------+------------+----------+------------+------------+----------+ 源代码在这里。\n下次再见，新年快乐！\n"},"name":"使用 Spark Structured Streaming 进行行程划分","published":"2019-01-05T14:15:31Z","summary":"使用 Structured Spark Streaming 进行行程划分 我们有一辆车, 车上的传感器每隔 1 秒发出一条 JSON 格式的数据。每条数据包含 3 个字段：\nfield description type unit vin 车辆唯一标识 String 辆 createTime 信号发生时间 Long 毫秒 mileage 当前里程数 Int 千米 下面一段样本数据:\n{\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667565,\u0026#39;mileage\u0026#39;:0} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667566,\u0026#39;mileage\u0026#39;:1} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667567,\u0026#39;mileage\u0026#39;:2} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667568,\u0026#39;mileage\u0026#39;:3} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667569,\u0026#39;mileage\u0026#39;:4} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667570,\u0026#39;mileage\u0026#39;:5} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667571,\u0026#39;mileage\u0026#39;:6} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667572,\u0026#39;mileage\u0026#39;:7} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667573,\u0026#39;mileage\u0026#39;:8} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667574,\u0026#39;mileage\u0026#39;:9} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667575,\u0026#39;mileage\u0026#39;:10} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667576,\u0026#39;mileage\u0026#39;:11} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667577,\u0026#39;mileage\u0026#39;:12} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667578,\u0026#39;mileage\u0026#39;:13} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667579,\u0026#39;mileage\u0026#39;:14} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667580,\u0026#39;mileage\u0026#39;:15} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667581,\u0026#39;mileage\u0026#39;:16} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667582,\u0026#39;mileage\u0026#39;:17} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667583,\u0026#39;mileage\u0026#39;:18} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667584,\u0026#39;mileage\u0026#39;:19} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667585,\u0026#39;mileage\u0026#39;:20} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667586,\u0026#39;mileage\u0026#39;:21} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667587,\u0026#39;mileage\u0026#39;:22} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667588,\u0026#39;mileage\u0026#39;:23} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667589,\u0026#39;mileage\u0026#39;:24} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667590,\u0026#39;mileage\u0026#39;:25} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667591,\u0026#39;mileage\u0026#39;:26} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667592,\u0026#39;mileage\u0026#39;:27} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667593,\u0026#39;mileage\u0026#39;:28} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667594,\u0026#39;mileage\u0026#39;:29} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667595,\u0026#39;mileage\u0026#39;:30} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667596,\u0026#39;mileage\u0026#39;:31} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667597,\u0026#39;mileage\u0026#39;:32} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667598,\u0026#39;mileage\u0026#39;:33} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667599,\u0026#39;mileage\u0026#39;:34} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667600,\u0026#39;mileage\u0026#39;:35} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667601,\u0026#39;mileage\u0026#39;:36} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667602,\u0026#39;mileage\u0026#39;:37} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667603,\u0026#39;mileage\u0026#39;:38} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667604,\u0026#39;mileage\u0026#39;:39} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667605,\u0026#39;mileage\u0026#39;:40} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667606,\u0026#39;mileage\u0026#39;:41} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667607,\u0026#39;mileage\u0026#39;:42} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667608,\u0026#39;mileage\u0026#39;:43} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667609,\u0026#39;mileage\u0026#39;:44} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667610,\u0026#39;mileage\u0026#39;:45} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667611,\u0026#39;mileage\u0026#39;:46} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667612,\u0026#39;mileage\u0026#39;:47} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667613,\u0026#39;mileage\u0026#39;:48} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667614,\u0026#39;mileage\u0026#39;:49} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667615,\u0026#39;mileage\u0026#39;:50} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667616,\u0026#39;mileage\u0026#39;:51} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667617,\u0026#39;mileage\u0026#39;:52} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667618,\u0026#39;mileage\u0026#39;:53} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667619,\u0026#39;mileage\u0026#39;:54} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667620,\u0026#39;mileage\u0026#39;:55} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667621,\u0026#39;mileage\u0026#39;:56} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667622,\u0026#39;mileage\u0026#39;:57} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667623,\u0026#39;mileage\u0026#39;:58} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667624,\u0026#39;mileage\u0026#39;:59} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667745,\u0026#39;mileage\u0026#39;:60} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667746,\u0026#39;mileage\u0026#39;:61} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667747,\u0026#39;mileage\u0026#39;:62} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667748,\u0026#39;mileage\u0026#39;:63} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667749,\u0026#39;mileage\u0026#39;:64} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667750,\u0026#39;mileage\u0026#39;:65} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667751,\u0026#39;mileage\u0026#39;:66} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667752,\u0026#39;mileage\u0026#39;:67} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667753,\u0026#39;mileage\u0026#39;:68} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667754,\u0026#39;mileage\u0026#39;:69} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667755,\u0026#39;mileage\u0026#39;:70} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667756,\u0026#39;mileage\u0026#39;:71} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667757,\u0026#39;mileage\u0026#39;:72} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667758,\u0026#39;mileage\u0026#39;:73} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667759,\u0026#39;mileage\u0026#39;:74} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667760,\u0026#39;mileage\u0026#39;:75} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667761,\u0026#39;mileage\u0026#39;:76} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667762,\u0026#39;mileage\u0026#39;:77} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667763,\u0026#39;mileage\u0026#39;:78} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667764,\u0026#39;mileage\u0026#39;:79} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667765,\u0026#39;mileage\u0026#39;:80} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667766,\u0026#39;mileage\u0026#39;:81} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667767,\u0026#39;mileage\u0026#39;:82} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667768,\u0026#39;mileage\u0026#39;:83} {\u0026#39;vin\u0026#39;:\u0026#39;LSJA0000000000091\u0026#39;,\u0026#39;createTime\u0026#39;:1546667769,\u0026#39;mileage\u0026#39;:84} 开车的时候, 从一个地方到另一个地方, 会有很多行程。","type":"entry","url":"http://localhost:1313/notes/sub-trip-with-structured-spark-streaming/"}