<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">

    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
    
    
    

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5">

    
    <meta name="referrer" content="no-referrer">

    <title>
        
            使用 Raku 进行峰值修剪 ❚ 焉知非鱼
        
    </title>

    
    


    
    
    
    

    
    
    
    

    
    
    

    
    
    
    <style>
     
     
     :root {
         --theme-color: #ac4142;
         --theme-color-light: rgba(172, 65, 66, 0.2);
     }
     
     html {
         line-height: 1.5;
     }
    </style>

    
    

    
    
    
    
    <link rel="stylesheet" href="/css/refined.min.7f6d3ee611034e4ebcbc063f1db3bc042fecdc8901afbedad80ff02bae409204.css">
    
    <link rel="preload" href="/css/refined.min.7f6d3ee611034e4ebcbc063f1db3bc042fecdc8901afbedad80ff02bae409204.css" as="style">

    



    
        <style>
         
         /* Background */ .chroma { background-color: #ffffff }
/* Error */ .chroma .err { color: #a61717; background-color: #e3d2d2 }
/* LineTableTD */ .chroma .lntd { vertical-align: top; padding: 0; margin: 0; border: 0; }
/* LineTable */ .chroma .lntable { border-spacing: 0; padding: 0; margin: 0; border: 0; width: auto; overflow: auto; display: block; }
/* LineHighlight */ .chroma .hl { display: block; width: 100%;background-color: #ffffcc }
/* LineNumbersTable */ .chroma .lnt { margin-right: 0.4em; padding: 0 0.4em 0 0.4em; }
/* LineNumbers */ .chroma .ln { margin-right: 0.4em; padding: 0 0.4em 0 0.4em; }
/* Keyword */ .chroma .k { color: #000000; font-weight: bold }
/* KeywordConstant */ .chroma .kc { color: #000000; font-weight: bold }
/* KeywordDeclaration */ .chroma .kd { color: #000000; font-weight: bold }
/* KeywordNamespace */ .chroma .kn { color: #000000; font-weight: bold }
/* KeywordPseudo */ .chroma .kp { color: #000000; font-weight: bold }
/* KeywordReserved */ .chroma .kr { color: #000000; font-weight: bold }
/* KeywordType */ .chroma .kt { color: #445588; font-weight: bold }
/* NameAttribute */ .chroma .na { color: #008080 }
/* NameBuiltin */ .chroma .nb { color: #0086b3 }
/* NameBuiltinPseudo */ .chroma .bp { color: #999999 }
/* NameClass */ .chroma .nc { color: #445588; font-weight: bold }
/* NameConstant */ .chroma .no { color: #008080 }
/* NameDecorator */ .chroma .nd { color: #3c5d5d; font-weight: bold }
/* NameEntity */ .chroma .ni { color: #800080 }
/* NameException */ .chroma .ne { color: #990000; font-weight: bold }
/* NameFunction */ .chroma .nf { color: #990000; font-weight: bold }
/* NameLabel */ .chroma .nl { color: #990000; font-weight: bold }
/* NameNamespace */ .chroma .nn { color: #555555 }
/* NameTag */ .chroma .nt { color: #000080 }
/* NameVariable */ .chroma .nv { color: #008080 }
/* NameVariableClass */ .chroma .vc { color: #008080 }
/* NameVariableGlobal */ .chroma .vg { color: #008080 }
/* NameVariableInstance */ .chroma .vi { color: #008080 }
/* LiteralString */ .chroma .s { color: #dd1144 }
/* LiteralStringAffix */ .chroma .sa { color: #dd1144 }
/* LiteralStringBacktick */ .chroma .sb { color: #dd1144 }
/* LiteralStringChar */ .chroma .sc { color: #dd1144 }
/* LiteralStringDelimiter */ .chroma .dl { color: #dd1144 }
/* LiteralStringDoc */ .chroma .sd { color: #dd1144 }
/* LiteralStringDouble */ .chroma .s2 { color: #dd1144 }
/* LiteralStringEscape */ .chroma .se { color: #dd1144 }
/* LiteralStringHeredoc */ .chroma .sh { color: #dd1144 }
/* LiteralStringInterpol */ .chroma .si { color: #dd1144 }
/* LiteralStringOther */ .chroma .sx { color: #dd1144 }
/* LiteralStringRegex */ .chroma .sr { color: #009926 }
/* LiteralStringSingle */ .chroma .s1 { color: #dd1144 }
/* LiteralStringSymbol */ .chroma .ss { color: #990073 }
/* LiteralNumber */ .chroma .m { color: #009999 }
/* LiteralNumberBin */ .chroma .mb { color: #009999 }
/* LiteralNumberFloat */ .chroma .mf { color: #009999 }
/* LiteralNumberHex */ .chroma .mh { color: #009999 }
/* LiteralNumberInteger */ .chroma .mi { color: #009999 }
/* LiteralNumberIntegerLong */ .chroma .il { color: #009999 }
/* LiteralNumberOct */ .chroma .mo { color: #009999 }
/* Operator */ .chroma .o { color: #000000; font-weight: bold }
/* OperatorWord */ .chroma .ow { color: #000000; font-weight: bold }
/* Comment */ .chroma .c { color: #999988; font-style: italic }
/* CommentHashbang */ .chroma .ch { color: #999988; font-style: italic }
/* CommentMultiline */ .chroma .cm { color: #999988; font-style: italic }
/* CommentSingle */ .chroma .c1 { color: #999988; font-style: italic }
/* CommentSpecial */ .chroma .cs { color: #999999; font-weight: bold; font-style: italic }
/* CommentPreproc */ .chroma .cp { color: #999999; font-weight: bold; font-style: italic }
/* CommentPreprocFile */ .chroma .cpf { color: #999999; font-weight: bold; font-style: italic }
/* GenericDeleted */ .chroma .gd { color: #000000; background-color: #ffdddd }
/* GenericEmph */ .chroma .ge { color: #000000; font-style: italic }
/* GenericError */ .chroma .gr { color: #aa0000 }
/* GenericHeading */ .chroma .gh { color: #999999 }
/* GenericInserted */ .chroma .gi { color: #000000; background-color: #ddffdd }
/* GenericOutput */ .chroma .go { color: #888888 }
/* GenericPrompt */ .chroma .gp { color: #555555 }
/* GenericStrong */ .chroma .gs { font-weight: bold }
/* GenericSubheading */ .chroma .gu { color: #aaaaaa }
/* GenericTraceback */ .chroma .gt { color: #aa0000 }
/* GenericUnderline */ .chroma .gl { text-decoration: underline }
/* TextWhitespace */ .chroma .w { color: #bbbbbb }

         
         /* Overrides on top of the theme and Chroma CSS */
/* Chroma-based lines highlighting in code blocks */
.chroma .hl {
    background-color: #e8e8e8;
    /* Extend highlight up to 100 characters (assuming that the code blocks never have more than 100 characters in a line) */
    min-width: 100ch;
}
/* GenericHeading */ .chroma .gh { color: #999999; font-weight: bold }
/* GenericSubheading */ .chroma .gu { color: #aaaaaa; font-weight: bold }

         
        </style>
    

    

    
    
    

    
    <script src="/js/responsive-nav-orig.min.e2b5f2a956b488f466da513820636134defdc38b90ed566248960593f2bb4ba5.js"></script>
    
    <link rel="preload" href="/js/responsive-nav-orig.min.e2b5f2a956b488f466da513820636134defdc38b90ed566248960593f2bb4ba5.js" as="script">

    
    
    <script defer src="/js/libs/fa/fontawesome-all.min.08916ac0fd078adfb58edc890460e2c8990729aee02bca7586404b56805f5219.js"></script>
    
    <link rel="preload" href="/js/libs/fa/fontawesome-all.min.08916ac0fd078adfb58edc890460e2c8990729aee02bca7586404b56805f5219.js" as="script">

    

    

    
    
    

    
    
<!-- rel="me" links for IndieAuth -->







    
 
<meta property="og:title" content="使用 Raku 进行峰值修剪" />
<meta property="og:description"
      content=" " />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ohmyweekly.github.io/notes/2020-08-03-peaked-trim-with-raku-and-perl/" />


    
        <meta property="article:published_time" content="2020-08-02T23:15:37&#43;08:00"/>
    
    
        <meta property="article:modified_time" content="2020-08-02T23:15:37&#43;08:00"/>
    









    




     <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="使用 Raku 进行峰值修剪"/>
<meta name="twitter:description" content=" "/>


    
    
    <link rel="alternate" type="application/jf2post+json" href="https://ohmyweekly.github.io/notes/2020-08-03-peaked-trim-with-raku-and-perl/jf2post.json" title="Jf2post for 焉知非鱼" />
    
     



    
    
    
        
    


     
        
        <meta name="DC.Creator" content="焉知非鱼"/>
    



    
    
    
    <meta name="hugo-build-date" content="2024-03-01T16:16:06Z"/>
    <meta name="hugo-commit-hash" content="312735366b20d64bd61bff8627f593749f86c964"/>
    <meta name="generator" content="Hugo 0.123.7">
</head>


    
        <body lang="en">
    

        
        <div class="border" id="home"></div>

        <div class="wrapper">   
            
<nav id="nav" class="nav-collapse opened" aria-hidden="false">
    <ul class="navbar">
        <li><a class="" href="/">Home</a></li>
        
            
                <li><a class="" href="https://ohmyweekly.github.io/posts/">Posts</a></li>
            
        
            
                <li><a class="" href="https://ohmyweekly.github.io/notes/">Notes</a></li>
            
        
        
            <li><a class="" href="https://ohmyweekly.github.io/search/">Search</a></li>
        
    </ul>
</nav>

            <div class="container">
                <header class="masthead">
                    <div class="masthead-title no-text-decoration">
                        <a href="/">焉知非鱼</a> <span class="blinking-cursor">❚</span>
                    </div>
                    <div class="masthead-tagline">
                        rakulang, dartlang, nimlang, golang, rustlang, lang lang no see
                    </div>
                </header>

                








<article class="post h-entry notes">
    <header>
        <div class="center">
    <div class="taxo no-text-decoration">
         
            
                <ul class="no-bullets inline categories">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts categorized in ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/categories/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
         
            
                <ul class="no-bullets inline tags">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts tagged with ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/tags/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
        
    </div>

</div>

        <h1 class="post-title p-name">使用 Raku 进行峰值修剪</h1>

        
        <data class="u-url" value="https://ohmyweekly.github.io/notes/2020-08-03-peaked-trim-with-raku-and-perl/"></data>

        <div class="date-syndication">
            


    
    
    <div class="post-date">
        
        <time datetime="2020-08-02T23:15:37+0800" class="dt-published">Sun Aug 2, 2020</time>
        
        
    </div>


            




        </div>
         



    
    
    
        
    


    
        
        <span class="hide">
            &mdash; <a href="https://ohmyweekly.github.io/" class="u-author">焉知非鱼</a>
        </span>
    


    </header>

    <div class="content">
        


        





                       


        <div class="e-content">
            




<p>这是我对 <a href="https://perlweeklychallenge.org/blog/perl-weekly-challenge-071/">Perl 每周挑战 #071</a> 的回应。</p>
<h1 id="challenge-0711-峰值元素">Challenge #071.1: 峰值元素</h1>
<pre tabindex="0"><code>给出正整数 `$N (&gt;1)`。

写一个脚本来创建一个大小为 `$N` 的数组，其随机元素在1到50之间。

如果找到的话，最后应该打印出数组中的峰值元素。

如果一个数组中的元素比它的邻元素大，则称为峰值。

例子 1
Array: [ 18, 45, 38, 25, 10, 7, 21, 6, 28, 48 ]
Peak: [ 48, 45, 21 ]

例子 2
Array: [ 47, 11, 32, 8, 1, 9, 39, 14, 36, 23 ]
Peak: [ 47, 32, 39, 36 ]
</code></pre><p>第一部分是处理输入(<code>$N</code>)，并生成一个随机数组。其实挑战赛并没有说数组中的值应该是整数，但我们可以从例子中推断出这一点。</p>
<p>文件: peak-element-if (部分)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="ch">#! /usr/bin/env raku</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">subset</span> <span class="nc">VeryPosInt</span> <span class="k">of</span> <span class="kt">Int</span> <span class="k">where</span> <span class="o">*</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">;</span>               <span class="c1"># [1]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">unit</span> <span class="k">sub</span> <span class="nb">MAIN</span> <span class="p">(</span><span class="n">VeryPosInt</span> <span class="nv">$N</span><span class="o">,</span> <span class="o">:</span><span class="nv">$v</span><span class="o">,</span> <span class="o">:</span><span class="nv">$verbose</span> <span class="o">=</span> <span class="nv">$v</span><span class="p">);</span>  <span class="c1"># [2]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">@array</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="nb">roll</span><span class="p">(</span><span class="nv">$N</span><span class="p">);</span>                        <span class="c1"># [3]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">: Values: </span><span class="nv">@array</span><span class="s2">[]</span><span class="p">&#34;</span> <span class="k">if</span> <span class="nv">$verbose</span><span class="p">;</span>                <span class="c1"># [4]</span>
</span></span></code></pre></div><p>[1] 我们使用自定义类型(用 <code>subset</code> 设置)来保证 <code>$N</code> 是一个整数，值为2或更高。</p>
<p>[2] 注意 «&ndash;verbose» 和 «&ndash;v» 的快捷方式。</p>
<p>[3] 从数组 <code>(1..50)</code> 中随机选一个值(用 <code>roll</code>)，<code>$N</code> 次。</p>
<p>[4] Verbose 模式在这里很方便，以显示我们做对了。</p>
<p>这里不要使用 <code>pick</code>，因为它明确地避免了重复。我们确实希望在数组中出现重复的情况。</p>
<p>关于 <code>subset</code> 的更多信息，见 <a href="https://docs.raku.org/language/typesystem#index-entry-subset-subset">https://docs.raku.org/language/typesystem#index-entry-subset-subset</a>。</p>
<p>参见 <code>https://docs.raku.org/routine/roll 了解更多关于 </code>roll` 的信息。</p>
<p>参见 <code>https://docs.raku.org/routine/pick 了解更多关于 </code>pick` 的信息。</p>
<p>选择要保留的值很简单，将每个值与左边的值和右边的值进行比较。但是第一个和最后一个值怎么办呢？</p>
<p>开始和结束的值需要特别注意，因为它们没有两个邻居。我们可以解决这个问题，从第二个元素开始，一直到最后一个元素为止，然后再进行比较。</p>
<p>文件: peak-element-if (剩余部分)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">@peak</span><span class="p">;</span>                     <span class="c1"># [5]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="o">^</span><span class="nv">$N-</span><span class="o">&gt;</span> <span class="nv">$index</span>              <span class="c1"># [6]</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nv">$index</span> <span class="o">==</span> <span class="mi">0</span>              <span class="c1"># [7]</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">: Checking at index </span><span class="nv">$index:</span><span class="s2"> (value: </span><span class="nv">@array</span><span class="s2">[</span><span class="nv">$index</span><span class="s2">], \
</span></span></span><span class="line"><span class="cl"><span class="s2">      right:</span><span class="nv">@array</span><span class="s2">[</span><span class="nv">$index</span><span class="s2">+1])</span><span class="p">&#34;</span> <span class="k">if</span> <span class="nv">$verbose</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">@peak</span><span class="o">.</span><span class="nb">push</span><span class="o">:</span> <span class="nv">@array</span><span class="o">[</span><span class="nv">$index</span><span class="o">]</span> <span class="k">if</span> <span class="nv">@array</span><span class="o">[</span><span class="nv">$index</span><span class="o">]</span> <span class="o">&gt;</span> <span class="nv">@array</span><span class="o">[</span><span class="nv">$index</span><span class="o">+</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">elsif</span> <span class="nv">$index</span> <span class="o">&lt;=</span> <span class="nv">$N</span> <span class="o">-</span><span class="mi">2</span>       <span class="c1"># [8]</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">: Checking at index </span><span class="nv">$index:</span><span class="s2"> (left:</span><span class="nv">@array</span><span class="s2">[</span><span class="nv">$index-1</span><span class="s2">], \
</span></span></span><span class="line"><span class="cl"><span class="s2">      value: </span><span class="nv">@array</span><span class="s2">[</span><span class="nv">$index</span><span class="s2">], right:</span><span class="nv">@array</span><span class="s2">[</span><span class="nv">$index</span><span class="s2">+1])</span><span class="p">&#34;</span> <span class="k">if</span> <span class="nv">$verbose</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">@peak</span><span class="o">.</span><span class="nb">push</span><span class="o">:</span> <span class="nv">@array</span><span class="o">[</span><span class="nv">$index</span><span class="o">]</span> <span class="k">if</span> <span class="nv">@array</span><span class="o">[</span><span class="nv">$index</span><span class="o">]</span> <span class="o">&gt;</span> <span class="nv">@array</span><span class="o">[</span><span class="nv">$index-1</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">      <span class="o">&amp;&amp;</span> <span class="nv">@array</span><span class="o">[</span><span class="nv">$index</span><span class="o">]</span> <span class="o">&gt;</span> <span class="nv">@array</span><span class="o">[</span><span class="nv">$index</span><span class="o">+</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span> <span class="c1"># if $index == $N -2   # [9]</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">: Checking at index </span><span class="nv">$index:</span><span class="s2"> (left:</span><span class="nv">@array</span><span class="s2">[</span><span class="nv">$index-1</span><span class="s2">], \
</span></span></span><span class="line"><span class="cl"><span class="s2">      value: </span><span class="nv">@array</span><span class="s2">[</span><span class="nv">$index</span><span class="s2">])</span><span class="p">&#34;</span> <span class="k">if</span> <span class="nv">$verbose</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">@peak</span><span class="o">.</span><span class="nb">push</span><span class="o">:</span> <span class="nv">@array</span><span class="o">[</span><span class="nv">$index</span><span class="o">]</span> <span class="k">if</span> <span class="nv">@array</span><span class="o">[</span><span class="nv">$index</span><span class="o">]</span> <span class="o">&gt;</span> <span class="nv">@array</span><span class="o">[</span><span class="nv">$index-1</span><span class="o">]</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">[ </span><span class="p">&#34;</span><span class="o">,</span> <span class="nv">@peak</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#34;</span><span class="s2">, </span><span class="p">&#34;)</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2"> ]</span><span class="p">&#34;;</span>
</span></span></code></pre></div><p>[5] 我们将在这里收集峰值元素。</p>
<p>[6] 对于随机数组中的每一个元素。</p>
<p>[7] 特例第一。</p>
<p>[8] 中间（有两个邻居的地方）。</p>
<p>[9] 最后一个。</p>
<p>列表中第一个元素的索引（偏移量）为 0，所以左手边第一个有邻居的元素索引为 1。</p>
<p>列表中的元素数为 <code>$N</code>。最后一个元素的索引为 <code>$N -1</code>。最后一个在右手边有邻居的元素的索引为 <code>$N -2</code>。</p>
<p>运行它:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ ./peak-element-if <span class="m">4</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>  <span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ ./peak-element-if <span class="m">10</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span> 36, <span class="m">29</span> <span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ ./peak-element-if <span class="m">10</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span> 44, 47, <span class="m">47</span> <span class="o">]</span>
</span></span></code></pre></div><p>用 verbose 模式运行它，可以看到发生了什么。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ ./peak-element-if -v <span class="m">2</span>
</span></span><span class="line"><span class="cl">: Values: <span class="m">49</span> <span class="m">29</span>
</span></span><span class="line"><span class="cl">: Checking at position 1: <span class="o">(</span>left:-1, value: 49, right:29<span class="o">)</span>
</span></span><span class="line"><span class="cl">: Checking at position 2: <span class="o">(</span>left:49, value: 29, right:-1<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span> <span class="m">49</span> <span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ ./peak-element-if -v <span class="m">4</span>
</span></span><span class="line"><span class="cl">: Values: <span class="m">17</span> <span class="m">23</span> <span class="m">21</span> <span class="m">4</span>
</span></span><span class="line"><span class="cl">: Checking at position 1: <span class="o">(</span>left:-1, value: 17, right:23<span class="o">)</span>
</span></span><span class="line"><span class="cl">: Checking at position 2: <span class="o">(</span>left:17, value: 23, right:21<span class="o">)</span>
</span></span><span class="line"><span class="cl">: Checking at position 3: <span class="o">(</span>left:23, value: 21, right:4<span class="o">)</span>
</span></span><span class="line"><span class="cl">: Checking at position 4: <span class="o">(</span>left:21, value: 4, right:-1<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span> <span class="m">23</span> <span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ ./peak-element-if -v <span class="m">4</span>
</span></span><span class="line"><span class="cl">: Values: <span class="m">49</span> <span class="m">20</span> <span class="m">17</span> <span class="m">30</span>
</span></span><span class="line"><span class="cl">: Checking at position 1: <span class="o">(</span>left:-1, value: 49, right:20<span class="o">)</span>
</span></span><span class="line"><span class="cl">: Checking at position 2: <span class="o">(</span>left:49, value: 20, right:17<span class="o">)</span>
</span></span><span class="line"><span class="cl">: Checking at position 3: <span class="o">(</span>left:20, value: 17, right:30<span class="o">)</span>
</span></span><span class="line"><span class="cl">: Checking at position 4: <span class="o">(</span>left:17, value: 30, right:-1<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span> 49, <span class="m">30</span> <span class="o">]</span>
</span></span></code></pre></div><p>看起来不错。</p>
<p>我们可以去掉那些 <code>if</code>，稍加注意。</p>
<p>文件: peak-element</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="ch">#! /usr/bin/env raku</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">subset</span> <span class="nc">VeryPosInt</span> <span class="k">of</span> <span class="kt">Int</span> <span class="k">where</span> <span class="o">*</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">unit</span> <span class="k">sub</span> <span class="nb">MAIN</span> <span class="p">(</span><span class="n">VeryPosInt</span> <span class="nv">$N</span><span class="o">,</span> <span class="o">:</span><span class="nv">$v</span><span class="o">,</span> <span class="o">:</span><span class="nv">$verbose</span> <span class="o">=</span> <span class="nv">$v</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">@array</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="nb">roll</span><span class="p">(</span><span class="nv">$N</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">: Values: </span><span class="nv">@array</span><span class="s2">[]</span><span class="p">&#34;</span> <span class="k">if</span> <span class="nv">$verbose</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">.</span><span class="nb">push</span><span class="o">:</span>    <span class="o">-</span><span class="mi">1</span><span class="p">;</span>     <span class="c1"># [1]</span>
</span></span><span class="line"><span class="cl"><span class="nv">@array</span><span class="o">.</span><span class="nb">unshift</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>     <span class="c1"># [1]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">@peak</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="mi">1</span> <span class="o">..</span> <span class="nv">$N</span>  <span class="k">-&gt;</span> <span class="nv">$index</span>  <span class="c1"># [2]</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">: Checking at position </span><span class="nv">$index:</span><span class="s2"> (left:</span><span class="nv">@array</span><span class="s2">[</span><span class="nv">$index-1</span><span class="s2">], \
</span></span></span><span class="line"><span class="cl"><span class="s2">    value: </span><span class="nv">@array</span><span class="s2">[</span><span class="nv">$index</span><span class="s2">], right:</span><span class="nv">@array</span><span class="s2">[</span><span class="nv">$index</span><span class="s2">+1])</span><span class="p">&#34;</span> <span class="k">if</span> <span class="nv">$verbose</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nv">@peak</span><span class="o">.</span><span class="nb">push</span><span class="o">:</span> <span class="nv">@array</span><span class="o">[</span><span class="nv">$index</span><span class="o">]</span> <span class="k">if</span> <span class="nv">@array</span><span class="o">[</span><span class="nv">$index</span><span class="o">]</span> <span class="o">&gt;</span> <span class="nv">@array</span><span class="o">[</span><span class="nv">$index-1</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">    <span class="o">&amp;&amp;</span> <span class="nv">@array</span><span class="o">[</span><span class="nv">$index</span><span class="o">]</span> <span class="o">&gt;</span> <span class="nv">@array</span><span class="o">[</span><span class="nv">$index</span><span class="o">+</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">[ </span><span class="p">&#34;</span><span class="o">,</span> <span class="nv">@peak</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#34;</span><span class="s2">, </span><span class="p">&#34;)</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2"> ]</span><span class="p">&#34;;</span>
</span></span></code></pre></div><p>[1] 在数组两端增加一个新的值（<code>push</code> 在末尾增加，<code>unshift</code> 在开头增加-在原值的前面）。</p>
<p>[2] 注意修改后的索引限制。</p>
<p>请注意，我稍微改变了 verbose 输出。现在不显示索引(从0开始)，而是显示位置(从1开始)。这简化了代码。</p>
<p>运行它显示它和以前的版本一样好用。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ ./peak-element -v <span class="m">2</span>
</span></span><span class="line"><span class="cl">: Values: <span class="m">46</span> <span class="m">17</span>
</span></span><span class="line"><span class="cl">: Checking at position 1: <span class="o">(</span>left:-1, value: 46, right:17<span class="o">)</span>
</span></span><span class="line"><span class="cl">: Checking at position 2: <span class="o">(</span>left:46, value: 17, right:-1<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span> <span class="m">46</span> <span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">./peak-element -v <span class="m">4</span>
</span></span><span class="line"><span class="cl">: Values: <span class="m">38</span> <span class="m">26</span> <span class="m">31</span> <span class="m">22</span>
</span></span><span class="line"><span class="cl">: Checking at position 1: <span class="o">(</span>left:-1, value: 38, right:26<span class="o">)</span>
</span></span><span class="line"><span class="cl">: Checking at position 2: <span class="o">(</span>left:38, value: 26, right:31<span class="o">)</span>
</span></span><span class="line"><span class="cl">: Checking at position 3: <span class="o">(</span>left:26, value: 31, right:22<span class="o">)</span>
</span></span><span class="line"><span class="cl">: Checking at position 4: <span class="o">(</span>left:31, value: 22, right:-1<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span> 38, <span class="m">31</span> <span class="o">]</span>
</span></span></code></pre></div><p>请注意，verbose 模式现在显示的是 <code>-1</code> 值。如果你觉得麻烦的话，可以很容易地删除这些值。(我不觉得烦。)</p>
<h1 id="挑战-0712修剪链表">挑战 #071.2：修剪链表</h1>
<p>给出一个单链接列表和一个正整数$N（&gt;0）。</p>
<p>编写一个脚本，从链接列表的末尾删除第N个节点，并打印链接列表。</p>
<p>如果$N大于链接列表的大小，则删除列表的第一个节点。</p>
<p>注意：请使用纯链接列表实现。</p>
<p>例子:</p>
<pre tabindex="0"><code>Given Linked List: 1 -&gt; 2 -&gt; 3 -&gt; 4 -&gt; 5
when $N = 1
Output: 1 -&gt; 2 -&gt; 3 -&gt; 4
when $N = 2
Output: 1 -&gt; 2 -&gt; 3 -&gt; 5
when $N = 3
Output: 1 -&gt; 2 -&gt; 4 -&gt; 5
when $N = 4
Output: 1 -&gt; 3 -&gt; 4 -&gt; 5
when $N = 5
Output: 2 -&gt; 3 -&gt; 4 -&gt; 5
when $N = 6
Output: 2 -&gt; 3 -&gt; 4 -&gt; 5
</code></pre><p>First a non-working version using a class and methods only:</p>
<p>File: tll-class-wrong</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="ch">#! /usr/bin/env raku</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">subset</span> <span class="nc">PosInt</span> <span class="k">of</span> <span class="kt">Int</span> <span class="k">where</span> <span class="o">*</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">unit</span> <span class="k">sub</span> <span class="nb">MAIN</span> <span class="p">(</span><span class="n">PosInt</span> <span class="nv">$N</span><span class="o">,</span> <span class="o">:</span><span class="nv">$v</span><span class="o">,</span> <span class="o">:</span><span class="nv">$verbose</span> <span class="o">=</span> <span class="o">:</span><span class="nv">$v</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">LinkedElement</span>          <span class="c1"># [1]</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">has</span> <span class="nv">$.value</span><span class="p">;</span>               <span class="c1"># [2]</span>
</span></span><span class="line"><span class="cl">  <span class="k">has</span> <span class="nv">$.next</span> <span class="k">is</span> <span class="k">rw</span><span class="p">;</span>          <span class="c1"># [3]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">method</span> <span class="n">print-list</span>          <span class="c1"># [4]</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span> <span class="nb">self</span><span class="o">.</span><span class="nb">value</span><span class="p">;</span>        <span class="c1"># [4a]</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">self</span><span class="o">.</span><span class="nb">next</span>             <span class="c1"># [4b]</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nb">print</span> <span class="p">&#34;</span><span class="s2"> -&gt; </span><span class="p">&#34;;</span>          <span class="c1"># [4c]</span>
</span></span><span class="line"><span class="cl">      <span class="nb">self</span><span class="o">.</span><span class="nb">next</span><span class="o">.</span><span class="nf">print-list</span><span class="p">;</span>  <span class="c1"># [4d]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>                     <span class="c1"># [4e]</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nb">print</span> <span class="p">&#34;</span><span class="se">\n</span><span class="p">&#34;;</span>            <span class="c1"># [4f]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">method</span> <span class="n">list-length</span>         <span class="c1"># [5]</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$length</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$current</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="nb">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="nv">$current</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nv">$current</span> <span class="o">=</span> <span class="nv">$current</span><span class="o">.</span><span class="nb">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nv">$length</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$length</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">method</span> <span class="nf">remove-from-end</span><span class="p">(</span><span class="nv">$from-the-end</span><span class="p">)</span> <span class="c1"># [6]</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$length</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="nf">list-length</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nv">$length</span> <span class="o">==</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="nb">die</span> <span class="p">&#34;</span><span class="s2">[]</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">elsif</span> <span class="nv">$from-the-end</span> <span class="o">&gt;</span> <span class="nv">$length</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nb">self</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="nb">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">my</span> <span class="nv">$current</span> <span class="o">=</span> <span class="nb">self</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">for</span> <span class="mi">1</span> <span class="o">..</span> <span class="p">(</span><span class="nv">$length</span> <span class="o">-</span> <span class="nv">$from-the-end</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$current</span> <span class="o">=</span> <span class="nv">$current</span><span class="o">.</span><span class="nb">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">      <span class="nv">$current</span><span class="o">.</span><span class="nb">next</span> <span class="o">=</span> <span class="nv">$current</span><span class="o">.</span><span class="nb">next</span><span class="o">.</span><span class="nb">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$length</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="nb">pick</span><span class="p">;</span>     <span class="c1"># [7]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$head</span><span class="p">;</span>                      <span class="c1"># [8]</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$current</span><span class="p">;</span>                   <span class="c1"># [9]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="nv">$length</span> <span class="k">-&gt;</span> <span class="nv">$value</span>       <span class="c1"># [10]</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">my</span> <span class="nv">$new</span> <span class="o">=</span> <span class="n">LinkedElement</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">value</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">);</span> <span class="c1"># [10a]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nv">$current</span>                  <span class="c1"># [12]</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$current</span><span class="o">.</span><span class="nb">next</span> <span class="o">=</span> <span class="nv">$new</span><span class="p">;</span>      <span class="c1"># [12a]</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$current</span> <span class="o">=</span> <span class="nv">$current</span><span class="o">.</span><span class="nb">next</span><span class="p">;</span>  <span class="c1"># [12b]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span> <span class="c1"># Initially             # [11]</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$head</span> <span class="o">=</span> <span class="nv">$new</span><span class="p">;</span>              <span class="c1"># [11a]</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$current</span> <span class="o">=</span> <span class="nv">$head</span><span class="p">;</span>          <span class="c1"># [11b]</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$head</span><span class="o">.</span><span class="nf">print-list</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Length: </span><span class="p">&#34;</span><span class="o">,</span> <span class="nv">$head</span><span class="o">.</span><span class="nf">list-length</span> <span class="k">if</span> <span class="nv">$verbose</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$head</span><span class="o">.</span><span class="nf">remove-from-end</span><span class="p">(</span><span class="nv">$N</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$head</span><span class="o">.</span><span class="nf">print-list</span><span class="p">;</span>
</span></span></code></pre></div><p>[1] A class for an element in the list,</p>
<p>[2] with a value (shown as consecutive integers in the challenge), so that we can see what is going on after deleting something.</p>
<p>[3] A pointer to the next value. We have only links in one direction, as specified in the challenge. Note the is rw so that we can change the value after we have created the object. This makes it possible to generate objects from the first one, and then add new ones on to the end until we have the full length.</p>
<p>[4] We need a way of printing the list. This recursive method does just that. It starts by printing the value of the current element [4a], then if it has a neighbour [4b], print the required arrow [4c] and invoke itself on that neighbour [4d]. If not, end the output with a newline and we are done.</p>
<p>[5] We are asked to remove an element counted from the end. This is easier to do if we know the length, so this method does just that. It follows the list, counting the elements as it goes along, and returns that length. We need this method, as the length is not known to the list itself.</p>
<p>[6] Remove the element. First get the length. If the requested element is before the first one (or the first one), remove that. (Except that it fails, as we&rsquo;ll see below.) If it somewhere inside the list, we count along to the right position, and deletes the node.</p>
<p>[7] The length of the array is a random value, between 1 and 50, just to make it more exciting. And unpredictable.</p>
<p>[8] Pointer to the first node in the linked list.</p>
<p>[9] The current pointer, used when we generate the list.</p>
<p>[10] Loop through the values to add to the linked list, and generate the objects [10a].</p>
<p>[11] If this is the first element we generate, set the head and current variables.</p>
<p>[12] If not, add it as the next element of the current pointer, and set the current pointer to this new element, ready for the next iteration.</p>
<p>Let us try:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">./tll-class-wrong <span class="m">16</span>
</span></span><span class="line"><span class="cl"><span class="m">1</span> -&gt; <span class="m">2</span> -&gt; <span class="m">3</span> -&gt; <span class="m">4</span> -&gt; <span class="m">5</span> -&gt; <span class="m">6</span> -&gt; <span class="m">7</span> -&gt; <span class="m">8</span> -&gt; <span class="m">9</span> -&gt; <span class="m">10</span> -&gt; <span class="m">11</span> -&gt; <span class="m">12</span> -&gt; <span class="m">13</span> -&gt; <span class="m">14</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -&gt; <span class="m">15</span> -&gt; <span class="m">16</span> -&gt; <span class="m">17</span> -&gt; <span class="m">18</span> -&gt; <span class="m">19</span> -&gt; <span class="m">20</span> -&gt; <span class="m">21</span> -&gt; <span class="m">22</span>
</span></span><span class="line"><span class="cl">Length: <span class="m">22</span>
</span></span><span class="line"><span class="cl"><span class="m">1</span> -&gt; <span class="m">2</span> -&gt; <span class="m">3</span> -&gt; <span class="m">4</span> -&gt; <span class="m">5</span> -&gt; <span class="m">6</span> -&gt; <span class="m">8</span> -&gt; <span class="m">9</span> -&gt; <span class="m">10</span> -&gt; <span class="m">11</span> -&gt; <span class="m">12</span> -&gt; <span class="m">13</span> -&gt; <span class="m">14</span> -&gt; <span class="m">15</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -&gt; <span class="m">16</span> -&gt; <span class="m">17</span> -&gt; <span class="m">18</span> -&gt; <span class="m">19</span> -&gt; <span class="m">20</span> -&gt; <span class="m">21</span> -&gt; <span class="m">22</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ ./tll-class-wrong <span class="m">99</span>
</span></span><span class="line"><span class="cl"><span class="m">1</span> -&gt; <span class="m">2</span> -&gt; <span class="m">3</span> -&gt; <span class="m">4</span>
</span></span><span class="line"><span class="cl">Length: <span class="m">4</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Cannot modify an immutable LinkedElement <span class="o">(</span>LinkedElement.new<span class="o">(</span>va...<span class="o">)</span>
</span></span><span class="line"><span class="cl">  in method remove-from-end at ./tll-class-wrong line <span class="m">50</span>
</span></span><span class="line"><span class="cl">  in sub MAIN at ./tll-class-wrong line <span class="m">93</span>
</span></span><span class="line"><span class="cl">  in block &lt;unit&gt; at ./tll-class-wrong line <span class="m">3</span>
</span></span></code></pre></div><p>The problem is that self is a pointer to the current element. And it is read only, so we cannot change it. As we just tried to do..</p>
<p>We can fix this by trickery:</p>
<p>File: tll-class</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="ch">#! /usr/bin/env raku</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">subset</span> <span class="nc">PosInt</span> <span class="k">of</span> <span class="kt">Int</span> <span class="k">where</span> <span class="o">*</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">unit</span> <span class="k">sub</span> <span class="nb">MAIN</span> <span class="p">(</span><span class="n">PosInt</span> <span class="nv">$N</span><span class="o">,</span> <span class="o">:</span><span class="nv">$v</span><span class="o">,</span> <span class="o">:</span><span class="nv">$verbose</span> <span class="o">=</span> <span class="o">:</span><span class="nv">$v</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">LinkedElement</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">has</span> <span class="nv">$.value</span> <span class="k">is</span> <span class="k">rw</span><span class="p">;</span> <span class="c1"># [2]</span>
</span></span><span class="line"><span class="cl">  <span class="k">has</span> <span class="nv">$.next</span>  <span class="k">is</span> <span class="k">rw</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">method</span> <span class="nf">print-list</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span> <span class="nb">self</span><span class="o">.</span><span class="nb">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">self</span><span class="o">.</span><span class="nb">next</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nb">print</span> <span class="p">&#34;</span><span class="s2"> -&gt; </span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">      <span class="nb">self</span><span class="o">.</span><span class="nb">next</span><span class="o">.</span><span class="nf">print-list</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nb">print</span> <span class="p">&#34;</span><span class="se">\n</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">method</span> <span class="nf">list-length</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$length</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$current</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="nb">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="nv">$current</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nv">$current</span> <span class="o">=</span> <span class="nv">$current</span><span class="o">.</span><span class="nb">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nv">$length</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$length</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">method</span> <span class="nf">remove-from-end</span><span class="p">(</span><span class="nv">$from-the-end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$length</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="nf">list-length</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nv">$length</span> <span class="o">==</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">       <span class="nb">die</span> <span class="p">&#34;</span><span class="s2">[]</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">elsif</span> <span class="nv">$from-the-end</span> <span class="o">&gt;</span> <span class="nv">$length</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nb">self</span><span class="o">.</span><span class="nb">value</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="nb">next</span><span class="o">.</span><span class="nb">value</span><span class="p">;</span>  <span class="c1"># [1]</span>
</span></span><span class="line"><span class="cl">      <span class="nb">self</span><span class="o">.</span><span class="nb">next</span>  <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="nb">next</span><span class="o">.</span><span class="nb">next</span><span class="p">;</span>   <span class="c1"># [1]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">my</span> <span class="nv">$current</span> <span class="o">=</span> <span class="nb">self</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">for</span> <span class="mi">1</span> <span class="o">..</span> <span class="p">(</span><span class="nv">$length</span> <span class="o">-</span> <span class="nv">$from-the-end</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$current</span> <span class="o">=</span> <span class="nv">$current</span><span class="o">.</span><span class="nb">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">      <span class="nv">$current</span><span class="o">.</span><span class="nb">next</span> <span class="o">=</span> <span class="nv">$current</span><span class="o">.</span><span class="nb">next</span><span class="o">.</span><span class="nb">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$length</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="nb">pick</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$head</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$current</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="nv">$length</span> <span class="k">-&gt;</span> <span class="nv">$value</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">my</span> <span class="nv">$new</span> <span class="o">=</span> <span class="n">LinkedElement</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">value</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nv">$current</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$current</span><span class="o">.</span><span class="nb">next</span> <span class="o">=</span> <span class="nv">$new</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$current</span> <span class="o">=</span> <span class="nv">$current</span><span class="o">.</span><span class="nb">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span> <span class="c1"># Initially</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$head</span> <span class="o">=</span> <span class="nv">$new</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$current</span> <span class="o">=</span> <span class="nv">$head</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$head</span><span class="o">.</span><span class="nf">print-list</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Length: </span><span class="p">&#34;</span><span class="o">,</span> <span class="nv">$head</span><span class="o">.</span><span class="nf">list-length</span> <span class="k">if</span> <span class="nv">$verbose</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$head</span><span class="o">.</span><span class="nf">remove-from-end</span><span class="p">(</span><span class="nv">$N</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$head</span><span class="o">.</span><span class="nf">print-list</span><span class="p">;</span>
</span></span></code></pre></div><p>[1] We cannot change self itself (pun intended), but we can change the object attributes. Which we do; let the head take over the second elements value, and remove that from the list.</p>
<p>[2] We have to make the value changeable (with is rw) for this to work.</p>
<p>We are messing around with the value of the first object in the linked list, and that is cheating. It works, but that does not change the fact that it is cheating.</p>
<p>Replacing the offending method with a procedure solves the problem. But it does not look very nice, and the object encapsulation has gone.</p>
<p>File: tll-hybrid</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="ch">#! /usr/bin/env raku</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">subset</span> <span class="nc">PosInt</span> <span class="k">of</span> <span class="kt">Int</span> <span class="k">where</span> <span class="o">*</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">unit</span> <span class="k">sub</span> <span class="nb">MAIN</span> <span class="p">(</span><span class="n">PosInt</span> <span class="nv">$N</span><span class="o">,</span> <span class="o">:</span><span class="nv">$v</span><span class="o">,</span> <span class="o">:</span><span class="nv">$verbose</span> <span class="o">=</span> <span class="o">:</span><span class="nv">$v</span><span class="o">,</span> <span class="o">:</span><span class="nv">$limit</span> <span class="o">=</span> <span class="mi">50</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">LinkedElement</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">has</span> <span class="nv">$.value</span> <span class="k">is</span> <span class="k">rw</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">has</span> <span class="nv">$.next</span>  <span class="k">is</span> <span class="k">rw</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">method</span> <span class="nf">print-list</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span> <span class="nb">self</span><span class="o">.</span><span class="nb">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">self</span><span class="o">.</span><span class="nb">next</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nb">print</span> <span class="p">&#34;</span><span class="s2"> -&gt; </span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">      <span class="nb">self</span><span class="o">.</span><span class="nb">next</span><span class="o">.</span><span class="nf">print-list</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nb">print</span> <span class="p">&#34;</span><span class="se">\n</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">method</span> <span class="nf">list-length</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$length</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$current</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="nb">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="nv">$current</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nv">$current</span> <span class="o">=</span> <span class="nv">$current</span><span class="o">.</span><span class="nb">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nv">$length</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nv">$length</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$length</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="nv">$limit</span><span class="p">)</span><span class="o">.</span><span class="nb">pick</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$head</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$current</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="nv">$length</span> <span class="k">-&gt;</span> <span class="nv">$value</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">my</span> <span class="nv">$new</span> <span class="o">=</span> <span class="n">LinkedElement</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">value</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nv">$current</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$current</span><span class="o">.</span><span class="nb">next</span> <span class="o">=</span> <span class="nv">$new</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$current</span> <span class="o">=</span> <span class="nv">$current</span><span class="o">.</span><span class="nb">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span> <span class="c1"># Initially</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$head</span> <span class="o">=</span> <span class="nv">$new</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$current</span> <span class="o">=</span> <span class="nv">$head</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nv">$head</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$head</span><span class="o">.</span><span class="nf">print-list</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Length: </span><span class="p">&#34;</span><span class="o">,</span> <span class="nv">$head</span><span class="o">.</span><span class="nf">list-length</span> <span class="k">if</span> <span class="nv">$verbose</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">remove-element</span><span class="p">(</span><span class="nv">$head</span><span class="o">,</span> <span class="nv">$N</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$head</span>                       <span class="c1"># [1]</span>
</span></span><span class="line"><span class="cl">  <span class="o">??</span> <span class="nv">$head</span><span class="o">.</span><span class="nf">print-list</span>
</span></span><span class="line"><span class="cl">  <span class="o">!!</span> <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">[]</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">remove-element</span> <span class="p">(</span><span class="nv">$list</span> <span class="k">is</span> <span class="k">rw</span><span class="o">,</span> <span class="nv">$from-the-end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">my</span> <span class="nv">$length</span> <span class="o">=</span> <span class="nv">$list</span><span class="o">.</span><span class="nf">list-length</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nv">$from-the-end</span> <span class="o">&gt;</span> <span class="nv">$length</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$list</span> <span class="o">=</span> <span class="nv">$list</span><span class="o">.</span><span class="nb">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$current</span> <span class="o">=</span> <span class="nv">$list</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="mi">1</span> <span class="o">..</span> <span class="p">(</span><span class="nv">$length</span> <span class="o">-</span> <span class="nv">$from-the-end</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nv">$current</span> <span class="o">=</span> <span class="nv">$current</span><span class="o">.</span><span class="nb">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nv">$current</span><span class="o">.</span><span class="nb">next</span> <span class="o">=</span> <span class="nv">$current</span><span class="o">.</span><span class="nb">next</span><span class="o">.</span><span class="nb">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>[1] An alternate way of handling an empty list.</p>
<p>It is possible to call the procedure with an alternate «method look-alike syntax», with a dot and and ampersand (.&amp;), if that makes you happier:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="c1"># remove-element($head, $N);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$head</span><span class="o">.&amp;</span><span class="nf">remove-element</span><span class="p">(</span><span class="nv">$N</span><span class="p">);</span>
</span></span></code></pre></div><p>See docs.raku.org/language/operators#methodop_.&amp; for more information about the special procedure invocation syntax .&amp;.</p>
<p>Here is a version where all the methods have been replaced by procedures:</p>
<p>File: tll-proc</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="ch">#! /usr/bin/env raku</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">subset</span> <span class="nc">PosInt</span> <span class="k">of</span> <span class="kt">Int</span> <span class="k">where</span> <span class="o">*</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">unit</span> <span class="k">sub</span> <span class="nb">MAIN</span> <span class="p">(</span><span class="n">PosInt</span> <span class="nv">$N</span><span class="o">,</span> <span class="o">:</span><span class="nv">$v</span><span class="o">,</span> <span class="o">:</span><span class="nv">$verbose</span> <span class="o">=</span> <span class="o">:</span><span class="nv">$v</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">LinkedElement</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">has</span> <span class="nv">$.value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">has</span> <span class="nv">$.next</span> <span class="k">is</span> <span class="k">rw</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$length</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="nb">pick</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$head</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$current</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="nv">$length</span> <span class="k">-&gt;</span> <span class="nv">$value</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">my</span> <span class="nv">$new</span> <span class="o">=</span> <span class="n">LinkedElement</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">value</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nv">$current</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$current</span><span class="o">.</span><span class="nb">next</span> <span class="o">=</span> <span class="nv">$new</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$current</span> <span class="o">=</span> <span class="nv">$current</span><span class="o">.</span><span class="nb">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span> <span class="c1"># Initially</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$head</span> <span class="o">=</span> <span class="nv">$new</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$current</span> <span class="o">=</span> <span class="nv">$head</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nv">$head</span><span class="o">.</span><span class="nb">raku</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">print-list</span><span class="p">(</span><span class="nv">$head</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">print-list</span> <span class="p">(</span><span class="nv">$list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">print</span> <span class="nv">$list</span><span class="o">.</span><span class="nb">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nv">$list</span><span class="o">.</span><span class="nb">next</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span> <span class="p">&#34;</span><span class="s2"> -&gt; </span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">    <span class="nf">print-list</span><span class="p">(</span><span class="nv">$list</span><span class="o">.</span><span class="nb">next</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span> <span class="p">&#34;</span><span class="se">\n</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">get-list-length</span> <span class="p">(</span><span class="nv">$list</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span> <span class="k">unless</span> <span class="nv">$list</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">my</span> <span class="nv">$length</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nv">$current</span> <span class="o">=</span> <span class="nv">$list</span><span class="o">.</span><span class="nb">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span><span class="nv">$current</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$current</span> <span class="o">=</span> <span class="nv">$current</span><span class="o">.</span><span class="nb">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$length</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nv">$length</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Length: </span><span class="p">&#34;</span><span class="o">,</span> <span class="nf">get-list-length</span><span class="p">(</span><span class="nv">$head</span><span class="p">)</span> <span class="k">if</span> <span class="nv">$verbose</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">remove-element</span><span class="p">(</span><span class="nv">$head</span><span class="o">,</span> <span class="nv">$N</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">print-list</span><span class="p">(</span><span class="nv">$head</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">remove-element</span> <span class="p">(</span><span class="nv">$list</span> <span class="k">is</span> <span class="k">rw</span><span class="o">,</span> <span class="nv">$from-the-end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">my</span> <span class="nv">$length</span> <span class="o">=</span> <span class="nf">get-list-length</span><span class="p">(</span><span class="nv">$list</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nv">$from-the-end</span> <span class="o">&gt;</span> <span class="nv">$length</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$list</span> <span class="o">=</span> <span class="nv">$list</span><span class="o">.</span><span class="nb">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$current</span> <span class="o">=</span> <span class="nv">$list</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="mi">1</span> <span class="o">..</span> <span class="p">(</span><span class="nv">$length</span> <span class="o">-</span> <span class="nv">$from-the-end</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nv">$current</span> <span class="o">=</span> <span class="nv">$current</span><span class="o">.</span><span class="nb">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nv">$current</span><span class="o">.</span><span class="nb">next</span> <span class="o">=</span> <span class="nv">$current</span><span class="o">.</span><span class="nb">next</span><span class="o">.</span><span class="nb">next</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Say goodbye to object encapsulation. We could make the code more robust by adding type constraints on the procedure arguments. E.g.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="c1"># sub print-list ($list)</span>
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nf">print-list</span> <span class="p">(</span><span class="n">LinkedElement</span> <span class="nv">$list</span><span class="p">)</span>
</span></span></code></pre></div><p>But using methods in(side) the class is much better.</p>


        </div>
    </div>
</article>



                <footer>
                    




<div class="no-text-decoration">
    <div class="jump top"><a href="#" title="Top of this page">⮉</a></div>
    <div class="jump bottom"><a href="#bottom" title="Bottom of this page">⮋</a></div>
</div>


 
    
        <div class="hugotoc no-text-decoration">
            <nav id="TableOfContents"></nav>
            <a href="#" class="back-to-top">Back to top</a>
        </div>
    
    
<script src="/js/libs/jquery/3.3.1/jquery.slim.min.min.22ee3db0c0e99fd0fbce3aee19672bd53d25469daf734bd4c165649f6eaf7d7f.js"></script>

<link rel="preload" href="/js/libs/jquery/3.3.1/jquery.slim.min.min.22ee3db0c0e99fd0fbce3aee19672bd53d25469daf734bd4c165649f6eaf7d7f.js" as="script">

<script type="application/javascript">(function() {
     var $window = $(window);
     if ($window.width() >= 1400) { 
         var $toc = $('#TableOfContents');
         if ($toc.length > 0) {
             function onScroll(){
                 var currentScroll = $window.scrollTop();
                 var h = $('.content h1, .content h2, .content h3, .content h4, .content h5, .content h6, .h-feed h2');
                 var id = "";
                 h.each(function (i, e) {
                     e = $(e);
                     if (e.offset().top - 10 <= currentScroll) {
                         id = e.attr('id');
                     }
                 });
                 var current = $toc.find('a.current');
                 if (current.length == 1 && current.eq(0).attr('href') == '#' + id) return true;

                 current.each(function (i, e) {
                     $(e).removeClass('current').siblings('ul').hide();
                 });
                 $toc.find('a[href="#' + id + '"]').parentsUntil('#TableOfContents').each(function (i, e) {
                     $(e).children('a').addClass('current').siblings('ul').show();
                 });
             }
             $window.on('scroll', onScroll);
             $(document).ready(function() {
                 $toc.find('a').parent('li').find('ul').hide();
                 onScroll();
                 document.getElementsByClassName('hugotoc')[0].style.display = '';
             });}}})();</script>








<div class="backtotop center no-text-decoration">
    <a href="#">back to <span class="top">top</span></a>
</div>


<div class="right">
    <div class="taxo no-text-decoration">
         
            
                <ul class="no-bullets inline categories">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts categorized in ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/categories/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
         
            
                <ul class="no-bullets inline tags">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts tagged with ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/tags/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
        
    </div>

</div>
<div class="clear-float"></div>



<div class="prev-next-navigator clear-float">
    
        <span class="prev-post left no-text-decoration">
            <a href="https://ohmyweekly.github.io/notes/2020-08-03-failed-to-find-dependencies-sqlite-from-native/" class="nobr">« Failed to find dependencies: sqlite:from&lt;native&gt;</a>
        </span>
    
    
        <span class="next-post right no-text-decoration">
            <a href="https://ohmyweekly.github.io/notes/2020-08-03-rfc145-brace-matching/" class="nobr">括号的匹配 »</a>
        </span>
    
</div>


<a id="bottom"></a>









                       







                    <ul class="no-bullets feed right inline">
    
        
        
    
</ul>
<div class="clear-float"></div>

                </footer>
                <hr />
            </div>               

            <footer> 
                

<ul class="social no-text-decoration">
    
</ul>










 
    
    



<p class="generated no-text-decoration">
    Generated using  <a href="https://gitlab.com/kaushalmodi/hugo-theme-refined"><code class="nobr">hugo-theme-refined</code></a> + <span class="nobr">Hugo <a href="https://github.com/gohugoio/hugo/commit/312735366b20d64bd61bff8627f593749f86c964">0.123.7</a></span>
</p>

<p>
    
</p>




<div class="badges no-text-decoration">
    
    

    
</div>




<script type="application/javascript">var nav=responsiveNav("#nav");</script>




<script defer src="/js/libs/fragmentions/wrapper.min.e8c468c89edc4f5dccaa8c720c6b220b3088a16cd7b1e4a1e3345985788260c9.js"></script>









            </footer>
        </div> 
    </body>
</html>
