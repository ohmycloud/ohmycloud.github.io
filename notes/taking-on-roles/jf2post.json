{"author":{"name":null,"type":"card","url":"https://ohmycloud.github.io/"},"content":{"html":"\u003cp\u003e\u003cimg src=\"https://mojolicious.io/blog/2018/12/13/taking-on-roles/banner.jpg\" alt=\"img\"\u003e\u003c/p\u003e\n\u003cp\u003e在我之前的 Advent 文章中，我创建了\u003ca href=\"https://mojolicious.io/blog/2018/12/03/higher-order-promises/\"\u003e高阶 promise\u003c/a\u003e并向您展示了如何使用它们。我没有告诉你它们如何工作的魔力。现在我将从另一个方向开发另一个例子。\u003c/p\u003e\n\u003cp\u003e有时候我希望 \u003ca href=\"https://mojolicious.org/perldoc/Mojo/File\"\u003eMojo::File\u003c/a\u003e 的行为有点不同。我经常有一个路径，我想只将基本名称与不同的目录结合起来。我最终为两者制作 \u003ccode\u003eMojo::File\u003c/code\u003e 对象，然后使用目录对象来获得我想要的东西：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::File\u003c/span\u003e \u003cspan class=\"sx\"\u003eqw(path)\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$path\u003c/span\u003e     \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::File\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;/Users/brian/bin/interesting.txt\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$dir\u003c/span\u003e      \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::File\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;/usr/local/bin\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$new_path\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$dir\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003echild\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nv\"\u003e$path\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebasename\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"nv\"\u003e$new_path\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# /usr/local/bin/interesting.txt\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e那很烦人。我不喜欢它需要这么多步骤。我想要一些方法。我宁愿能够像这样编写它，我从有趣的文件开始并继续处理它而不是切换到其他对象：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::File\u003c/span\u003e \u003cspan class=\"sx\"\u003eqw(path)\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$new_path\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::File\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;/Users/brian/bin/interesting.txt\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003erebase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;/usr/local/bin\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e   \u003cspan class=\"c1\"\u003e# this isn\u0026#39;t a method\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"nv\"\u003e$new_path\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e  \u003cspan class=\"c1\"\u003e# /usr/local/bin/interesting.txt\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e我可以通过各种 Perl 技巧通过\u003ca href=\"https://mojolicious.org/perldoc/Mojo/Util#monkey_patch\"\u003e猴子补丁\u003c/a\u003e或子类化将此方法添加到 \u003ccode\u003eMojo::File\u003c/code\u003e。但是，像往常一样，Mojolicious 期待我的愿望并提供一种方法来做到这一点。我可以添加一个角色，\u003c/p\u003e\n\u003cp\u003e当我跳进它时，你可以自己阅读角色。首先，我创建一个代表我的角色的类。我定义了我想要的方法。我使用我想要影响的包的名称，添加 \u003ccode\u003e::Role::\u003c/code\u003e，然后我想使用的名称;它的小写并不重要。 \u003ccode\u003eMojo::Base\u003c/code\u003e 设置了当我导入 \u003ccode\u003e-role\u003c/code\u003e 时所需的一切：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003epackage\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::File::Role::rebase\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::Base\u003c/span\u003e \u003cspan class=\"sx\"\u003eqw(-role -signatures)\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003esub\u003c/span\u003e \u003cspan class=\"nf\"\u003erebase\u003c/span\u003e \u003cspan class=\"p\"\u003e($file, $dir) {\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nv\"\u003e$dir\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebasename\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e我在我想要影响的类上使用 \u003ccode\u003ewith_roles\u003c/code\u003e 来应用我的新功能。因为我使用命名约定通过在它前面加上目标类（\u003ccode\u003eMojo::File\u003c/code\u003e），然后是 \u003ccode\u003e::Role::\u003c/code\u003e，然后是我想要的短名称。当我应用这个时，我可以省去大部分包裹名称，并使用前面加号的短名称：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$file_class\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::File\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewith_roles\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;+rebase\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e或者我可以输入完整的包名：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$file_class\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::File\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewith_roles\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s\"\u003e\u0026#39;Mojo::File::Role::rebase\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e如果我没有遵循命名约定，我需要使用它：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$file_class\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::File\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewith_roles\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"s\"\u003e\u0026#39;I::Totally::Rejected::The::Convention::rebase\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e\u003ccode\u003e$file_class\u003c/code\u003e 是具有新类名的字符串。在那个课程的后面有一些多重继承魔法，你会更乐意忽略它。我不需要使用裸字类名来调用类方法;标量变量中的字符串也可以正常工作。现在我可以使用我的 \u003ccode\u003erebase\u003c/code\u003e：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"nv\"\u003e$file_class\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;/Users/brian/bin/interesting.txt\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003erebase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;/usr/local/bin/\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e这比我之前做的要干净得多，我喜欢它的流动方式。但是，如果我从其他东西获得已经创建的 \u003ca href=\"https://mojolicious.org/perldoc/Mojo/File\"\u003eMojo::File\u003c/a\u003e 对象怎么办？我也可以应用 ad hoc 角色：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003epath\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;/Users/brian/bin/interesting.txt\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewith_roles\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;+rebase\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003erebase\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;/usr/local/bin/\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e我可以走得更远我添加到我的角色的任何方法都成为该类的一部分。我经常想要获取文件的摘要，虽然 \u003ca href=\"https://mojolicious.org/perldoc/Mojo/Util\"\u003eMojo::Util\u003c/a\u003e 通过一些便利功能使这更容易，但我想要更方便。我为我的角色添加了几种方法来为我做啜食：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::File\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003epackage\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::File::Role::MyUtils\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::Base\u003c/span\u003e \u003cspan class=\"sx\"\u003eqw(-role -signatures)\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::Util\u003c/span\u003e \u003cspan class=\"sx\"\u003eqw(md5_sum sha1_sum)\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003esub\u003c/span\u003e \u003cspan class=\"nf\"\u003erebase\u003c/span\u003e \u003cspan class=\"p\"\u003e($file, $dir) {\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nv\"\u003e$dir\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ebasename\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003esub\u003c/span\u003e \u003cspan class=\"nf\"\u003emd5\u003c/span\u003e \u003cspan class=\"p\"\u003e($file) {\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003emd5_sum\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eslurp\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003esub\u003c/span\u003e \u003cspan class=\"nf\"\u003esha1\u003c/span\u003e \u003cspan class=\"p\"\u003e($file) {\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003esha1_sum\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eslurp\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::File\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003ewith_roles\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;+MyUtils\u0026#39;\u003c/span\u003e \u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nb\"\u003eshift\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003esha1\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003emd5\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e您可以在 Joel Berger 的 2017 Mojolicious Advent Calendar 条目第13天：\u003ca href=\"https://mojolicious.io/blog/2017/12/13/day-13-more-about-roles/\"\u003e更多关于角色\u003c/a\u003e中阅读更多关于角色的信息。奇怪的是那也是在第13天，虽然我不认为乔尔或我是否足够聪明来计划。\u003c/p\u003e\n","text":"\n在我之前的 Advent 文章中，我创建了高阶 promise并向您展示了如何使用它们。我没有告诉你它们如何工作的魔力。现在我将从另一个方向开发另一个例子。\n有时候我希望 Mojo::File 的行为有点不同。我经常有一个路径，我想只将基本名称与不同的目录结合起来。我最终为两者制作 Mojo::File 对象，然后使用目录对象来获得我想要的东西：\nuse Mojo::File qw(path); my $path = Mojo::File-\u0026gt;new( \u0026#39;/Users/brian/bin/interesting.txt\u0026#39; ); my $dir = Mojo::File-\u0026gt;new( \u0026#39;/usr/local/bin\u0026#39; ); my $new_path = $dir-\u0026gt;child( $path-\u0026gt;basename ); say $new_path; # /usr/local/bin/interesting.txt 那很烦人。我不喜欢它需要这么多步骤。我想要一些方法。我宁愿能够像这样编写它，我从有趣的文件开始并继续处理它而不是切换到其他对象：\nuse Mojo::File qw(path); my $new_path = Mojo::File -\u0026gt;new( \u0026#39;/Users/brian/bin/interesting.txt\u0026#39; ) -\u0026gt;rebase( \u0026#39;/usr/local/bin\u0026#39; ); # this isn\u0026#39;t a method say $new_path; # /usr/local/bin/interesting.txt 我可以通过各种 Perl 技巧通过猴子补丁或子类化将此方法添加到 Mojo::File。但是，像往常一样，Mojolicious 期待我的愿望并提供一种方法来做到这一点。我可以添加一个角色，\n当我跳进它时，你可以自己阅读角色。首先，我创建一个代表我的角色的类。我定义了我想要的方法。我使用我想要影响的包的名称，添加 ::Role::，然后我想使用的名称;它的小写并不重要。 Mojo::Base 设置了当我导入 -role 时所需的一切：\npackage Mojo::File::Role::rebase { use Mojo::Base qw(-role -signatures); sub rebase ($file, $dir) { $file-\u0026gt;new( $dir, $file-\u0026gt;basename ) } } 我在我想要影响的类上使用 with_roles 来应用我的新功能。因为我使用命名约定通过在它前面加上目标类（Mojo::File），然后是 ::Role::，然后是我想要的短名称。当我应用这个时，我可以省去大部分包裹名称，并使用前面加号的短名称：\nmy $file_class = Mojo::File-\u0026gt;with_roles( \u0026#39;+rebase\u0026#39; ); 或者我可以输入完整的包名：\nmy $file_class = Mojo::File-\u0026gt;with_roles( \u0026#39;Mojo::File::Role::rebase\u0026#39; ); 如果我没有遵循命名约定，我需要使用它：\nmy $file_class = Mojo::File-\u0026gt;with_roles( \u0026#39;I::Totally::Rejected::The::Convention::rebase\u0026#39; ); $file_class 是具有新类名的字符串。在那个课程的后面有一些多重继承魔法，你会更乐意忽略它。我不需要使用裸字类名来调用类方法;标量变量中的字符串也可以正常工作。现在我可以使用我的 rebase：\nsay $file_class -\u0026gt;new( \u0026#39;/Users/brian/bin/interesting.txt\u0026#39; ) -\u0026gt;rebase( \u0026#39;/usr/local/bin/\u0026#39; ); 这比我之前做的要干净得多，我喜欢它的流动方式。但是，如果我从其他东西获得已经创建的 Mojo::File 对象怎么办？我也可以应用 ad hoc 角色：\nmy $file = path( \u0026#39;/Users/brian/bin/interesting.txt\u0026#39; ); say $file -\u0026gt;with_roles( \u0026#39;+rebase\u0026#39; ) -\u0026gt;rebase( \u0026#39;/usr/local/bin/\u0026#39; ); 我可以走得更远我添加到我的角色的任何方法都成为该类的一部分。我经常想要获取文件的摘要，虽然 Mojo::Util 通过一些便利功能使这更容易，但我想要更方便。我为我的角色添加了几种方法来为我做啜食：\nuse Mojo::File; package Mojo::File::Role::MyUtils { use Mojo::Base qw(-role -signatures); use Mojo::Util qw(md5_sum sha1_sum); sub rebase ($file, $dir) { $file-\u0026gt;new( $dir, $file-\u0026gt;basename ) } sub md5 ($file) { md5_sum( $file-\u0026gt;slurp ) } sub sha1 ($file) { sha1_sum( $file-\u0026gt;slurp ) } } my $file = Mojo::File -\u0026gt;with_roles( \u0026#39;+MyUtils\u0026#39; ) -\u0026gt;new(shift); say $file-\u0026gt;sha1; say $file-\u0026gt;md5; 您可以在 Joel Berger 的 2017 Mojolicious Advent Calendar 条目第13天：更多关于角色中阅读更多关于角色的信息。奇怪的是那也是在第13天，虽然我不认为乔尔或我是否足够聪明来计划。\n"},"name":"第十三天 - 承担角色","published":"2018-12-13T12:25:53Z","summary":"在我之前的 Advent 文章中，我创建了高阶 promise并向您展示了如何使用它们。我没有告诉你它们如何工作的魔力。现在我将从另一个方向开发另一个例子。\n有时候我希望 Mojo::File 的行为有点不同。我经常有一个路径，我想只将基本名称与不同的目录结合起来。我最终为两者制作 Mojo::File 对象，然后使用目录对象来获得我想要的东西：\nuse Mojo::File qw(path); my $path = Mojo::File-\u0026gt;new( \u0026#39;/Users/brian/bin/interesting.txt\u0026#39; ); my $dir = Mojo::File-\u0026gt;new( \u0026#39;/usr/local/bin\u0026#39; ); my $new_path = $dir-\u0026gt;child( $path-\u0026gt;basename ); say $new_path; # /usr/local/bin/interesting.txt 那很烦人。我不喜欢它需要这么多步骤。我想要一些方法。我宁愿能够像这样编写它，我从有趣的文件开始并继续处理它而不是切换到其他对象：\nuse Mojo::File qw(path); my $new_path = Mojo::File -\u0026gt;new( \u0026#39;/Users/brian/bin/interesting.txt\u0026#39; ) -\u0026gt;rebase( \u0026#39;/usr/local/bin\u0026#39; ); # this isn\u0026#39;t a method say $new_path; # /usr/local/bin/interesting.txt 我可以通过各种 Perl 技巧通过猴子补丁或子类化将此方法添加到 Mojo::File。但是，像往常一样，Mojolicious 期待我的愿望并提供一种方法来做到这一点。我可以添加一个角色，\n当我跳进它时，你可以自己阅读角色。首先，我创建一个代表我的角色的类。我定义了我想要的方法。我使用我想要影响的包的名称，添加 ::Role::，然后我想使用的名称;它的小写并不重要。 Mojo::Base 设置了当我导入 -role 时所需的一切：\npackage Mojo::File::Role::rebase { use Mojo::Base qw(-role -signatures); sub rebase ($file, $dir) { $file-\u0026gt;new( $dir, $file-\u0026gt;basename ) } } 我在我想要影响的类上使用 with_roles 来应用我的新功能。因为我使用命名约定通过在它前面加上目标类（Mojo::File），然后是 ::Role::，然后是我想要的短名称。当我应用这个时，我可以省去大部分包裹名称，并使用前面加号的短名称：","type":"entry","url":"https://ohmycloud.github.io/notes/taking-on-roles/"}