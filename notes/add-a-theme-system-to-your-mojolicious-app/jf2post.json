{"author":{"name":null,"type":"card","url":"https://ohmycloud.github.io/"},"content":{"html":"\u003cp\u003e\u003cimg src=\"https://mojolicious.io/blog/2018/12/09/add-a-theme-system-to-your-mojolicious-app/banner.jpg\" alt=\"img\"\u003e\u003c/p\u003e\n\u003cp\u003e你写了一个很棒的Mojolicious应用程序，人们使用它。奇妙！但是用户可能想要修改应用程序的主题：更改徽标，使用其他CSS框架，这类事情。\u003c/p\u003e\n\u003cp\u003e修改Mojolicious应用程序的主题非常简单：在公共和模板中添加，修改或删除内容。但是所有这些直接修改可能无法在更新应用程序时继续存在：它们只会被新版本的文件删除。\u003c/p\u003e\n\u003cp\u003e让我们看看我们如何提供一种在Mojolicious应用程序中拥有主题系统的方法，该方法允许用户在没有痛苦的情况下拥有自定义主题，并且没有丢失更新的风险。\u003c/p\u003e\n\u003ch2 id=\"一个新的应用程序\"\u003e一个新的应用程序\u003c/h2\u003e\n\u003cp\u003e当您使用mojo生成MyApplication创建新的Mojolicious应用程序时，这些是将提供文件及其默认内容的默认目录：\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e$ tree public templates\npublic\n└── index.html\ntemplates\n├── example\n│   └── welcome.html.ep\n└── layouts\n    └── default.html.ep\n\n2 directories, 3 files\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003epublic是存储静态文件的地方，而templates是存储模板的地方。\u003c/p\u003e\n\u003cp\u003e这些路径在$ app-\u0026gt; static-\u0026gt; paths和$ app-\u0026gt; renderer-\u0026gt; paths中的Mojolicious应用程序中注册。幸运的是，这两个对象是数组引用，因此我们可以向它们添加或删除目录。\u003c/p\u003e\n\u003cp\u003e当提供静态文件时，我们的应用程序在$ app-\u0026gt; static-\u0026gt; paths数组的第一个目录中搜索该文件，如果找不到它，则搜索下一个目录，依此类推。模板渲染也是如此。\u003c/p\u003e\n\u003ch2 id=\"让我们改变路由\"\u003e让我们改变路由\u003c/h2\u003e\n\u003cp\u003e我们可以将公共模板和模板默认目录保存在应用程序目录的根目录下，但我喜欢在一个名为themes的目录中重新组合所有与主题相关的东西并调用我的默认主题\u0026hellip;好吧，默认。\u003c/p\u003e\n\u003cp\u003e创建新目录并在其中移动默认主题目录：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ mkdir -p themes/default\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e$ mv public templates themes/default\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e然后，我们需要更改应用程序中的路径。在 \u003ccode\u003elib/MyApplication.pm\u003c/code\u003e 中添加：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Replace the default paths\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$self\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003erenderer\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003epaths\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"nv\"\u003e$self\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003ehome\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003erel_file\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;themes/default/templates\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)]);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$self\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003estatic\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003epaths\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"nv\"\u003e$self\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003ehome\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003erel_file\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;themes/default/public\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)]);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"添加使用其他主题的方法\"\u003e添加使用其他主题的方法\u003c/h2\u003e\n\u003cp\u003e如前所述，Mojolicious在已注册路径的第一个目录中搜索静态文件或模板，如果找不到文件或模板则转到下一个。\u003c/p\u003e\n\u003cp\u003e因此，我们需要在默认主题路径之前添加新主题路径。\u003c/p\u003e\n\u003cp\u003e假设我们创建了一个圣诞主题，其中文件位于主题/圣诞节/公共内容中，哪些模板位于主题/圣诞节/模板中。\u003c/p\u003e\n\u003cp\u003e我们要添加到代码中的代码段变为：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Replace the default paths\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$self\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003erenderer\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003epaths\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"nv\"\u003e$self\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003ehome\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003erel_file\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;themes/default/templates\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)]);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$self\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003estatic\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003epaths\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"nv\"\u003e$self\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003ehome\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003erel_file\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;themes/default/public\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)]);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Put the new theme first\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eunshift\u003c/span\u003e \u003cspan class=\"nv\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nv\"\u003e$self\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003erenderer\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003epaths\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"nv\"\u003e$self\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003ehome\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003erel_file\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;themes/christmas/templates\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nb\"\u003eunshift\u003c/span\u003e \u003cspan class=\"nv\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nv\"\u003e$self\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003estatic\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003epaths\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e   \u003cspan class=\"nv\"\u003e$self\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003ehome\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003erel_file\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;themes/christmas/public\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e通过这种方式，我们可以重载默认文件。\u003c/p\u003e\n\u003cp\u003e您不必修改默认主题的每个文件以具有新主题：只需在新主题目录中复制要重载的文件，然后使用它而不是默认主题目录。\u003c/p\u003e\n\u003cp\u003e假设你的默认主题中有一个background.png文件：\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e$ cd themes/default\n$ tree public templates\npublic\n├── background.png\n└── index.html\ntemplates\n├── example\n│   └── welcome.html.ep\n└── layouts\n    └── default.html.ep\n\n2 directories, 4 files\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e为了超载它，你只需要这个：\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e$ cd themes/christmas\n$ tree public templates\npublic\n└── background.png\ntemplates\n\n0 directories, 1 files\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"使用-mojoliciouspluginconfig-插件\"\u003e使用 Mojolicious::Plugin::Config 插件\u003c/h2\u003e\n\u003cp\u003e\u003ca href=\"https://mojolicious.org/perldoc/Mojolicious/Plugin/Config\"\u003eMojolicious::Plugin::Config\u003c/a\u003e自带Mojolicious，是让用户配置应用程序的好方法。为什么不用它让他们选择他们想要的主题？在我们的示例中，该设置将毫不奇怪地命名为主题。\u003c/p\u003e\n\u003cp\u003e首先，使用插件：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Mojolicious\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$config\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$app\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eplugin\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;Config\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"n\"\u003edefault\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"n\"\u003etheme\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;default\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e请注意，我在插件的配置中添加了默认值。它确保即使用户没有选择主题，我们也会为所选主题设置正确的值。\u003c/p\u003e\n\u003cp\u003e现在，我们只需在代码中使用该配置设置：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Replace the default paths\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$self\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003erenderer\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003epaths\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"nv\"\u003e$self\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003ehome\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003erel_file\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;themes/default/templates\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)]);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$self\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003estatic\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003epaths\u003c/span\u003e\u003cspan class=\"p\"\u003e([\u003c/span\u003e\u003cspan class=\"nv\"\u003e$self\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003ehome\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003erel_file\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;themes/default/public\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)]);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e# Do we use a different theme?\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$config\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003etheme\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"ow\"\u003ene\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;default\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e# Put the new theme first\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$theme\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$self\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003ehome\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003erel_file\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;themes/\u0026#39;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nv\"\u003e$config\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003etheme\u003c/span\u003e\u003cspan class=\"p\"\u003e});\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eunshift\u003c/span\u003e \u003cspan class=\"nv\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nv\"\u003e$self\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003erenderer\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003epaths\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e \u003cspan class=\"nv\"\u003e$theme\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;/templates\u0026#39;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ed\u003c/span\u003e \u003cspan class=\"nv\"\u003e$theme\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;/templates\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nb\"\u003eunshift\u003c/span\u003e \u003cspan class=\"nv\"\u003e@\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nv\"\u003e$self\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nn\"\u003estatic\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003epaths\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e   \u003cspan class=\"nv\"\u003e$theme\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;/public\u0026#39;\u003c/span\u003e    \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ed\u003c/span\u003e \u003cspan class=\"nv\"\u003e$theme\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;/public\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e请注意 \u003ccode\u003eif -d $theme.'/templates'\u003c/code\u003e：如果使用主题名称中的拼写错误并且如果您只需要其中一个，则可以避免在主题目录中创建 \u003ccode\u003etemplates\u003c/code\u003e 和 \u003ccode\u003epublic\u003c/code\u003e，从而防止出现问题。\u003c/p\u003e\n\u003ch2 id=\"结论\"\u003e结论\u003c/h2\u003e\n\u003cp\u003e您现在正在应用程序中提供主题系统。用户现在可以改变它的样式而不用担心丢失对更新的更改（尽管他们需要检查他们所做的更改，以防默认主题发生很大变化）。\u003c/p\u003e\n\u003cp\u003e您甚至可以自己提供不同的主题，就像我为我的 \u003ca href=\"https://framagit.org/fiat-tux/hat-softwares/lstu\"\u003eURL 缩短应用程序\u003c/a\u003e Lstu 所做的那样.🙂\u003c/p\u003e\n","text":"\n你写了一个很棒的Mojolicious应用程序，人们使用它。奇妙！但是用户可能想要修改应用程序的主题：更改徽标，使用其他CSS框架，这类事情。\n修改Mojolicious应用程序的主题非常简单：在公共和模板中添加，修改或删除内容。但是所有这些直接修改可能无法在更新应用程序时继续存在：它们只会被新版本的文件删除。\n让我们看看我们如何提供一种在Mojolicious应用程序中拥有主题系统的方法，该方法允许用户在没有痛苦的情况下拥有自定义主题，并且没有丢失更新的风险。\n一个新的应用程序 当您使用mojo生成MyApplication创建新的Mojolicious应用程序时，这些是将提供文件及其默认内容的默认目录：\n$ tree public templates public └── index.html templates ├── example │ └── welcome.html.ep └── layouts └── default.html.ep 2 directories, 3 files public是存储静态文件的地方，而templates是存储模板的地方。\n这些路径在$ app-\u0026gt; static-\u0026gt; paths和$ app-\u0026gt; renderer-\u0026gt; paths中的Mojolicious应用程序中注册。幸运的是，这两个对象是数组引用，因此我们可以向它们添加或删除目录。\n当提供静态文件时，我们的应用程序在$ app-\u0026gt; static-\u0026gt; paths数组的第一个目录中搜索该文件，如果找不到它，则搜索下一个目录，依此类推。模板渲染也是如此。\n让我们改变路由 我们可以将公共模板和模板默认目录保存在应用程序目录的根目录下，但我喜欢在一个名为themes的目录中重新组合所有与主题相关的东西并调用我的默认主题\u0026hellip;好吧，默认。\n创建新目录并在其中移动默认主题目录：\n$ mkdir -p themes/default $ mv public templates themes/default 然后，我们需要更改应用程序中的路径。在 lib/MyApplication.pm 中添加：\n# Replace the default paths $self-\u0026gt;renderer-\u0026gt;paths([$self-\u0026gt;home-\u0026gt;rel_file(\u0026#39;themes/default/templates\u0026#39;)]); $self-\u0026gt;static-\u0026gt;paths([$self-\u0026gt;home-\u0026gt;rel_file(\u0026#39;themes/default/public\u0026#39;)]); 添加使用其他主题的方法 如前所述，Mojolicious在已注册路径的第一个目录中搜索静态文件或模板，如果找不到文件或模板则转到下一个。\n因此，我们需要在默认主题路径之前添加新主题路径。\n假设我们创建了一个圣诞主题，其中文件位于主题/圣诞节/公共内容中，哪些模板位于主题/圣诞节/模板中。\n我们要添加到代码中的代码段变为：\n# Replace the default paths $self-\u0026gt;renderer-\u0026gt;paths([$self-\u0026gt;home-\u0026gt;rel_file(\u0026#39;themes/default/templates\u0026#39;)]); $self-\u0026gt;static-\u0026gt;paths([$self-\u0026gt;home-\u0026gt;rel_file(\u0026#39;themes/default/public\u0026#39;)]); # Put the new theme first unshift @{$self-\u0026gt;renderer-\u0026gt;paths}, $self-\u0026gt;home-\u0026gt;rel_file(\u0026#39;themes/christmas/templates\u0026#39;); unshift @{$self-\u0026gt;static-\u0026gt;paths}, $self-\u0026gt;home-\u0026gt;rel_file(\u0026#39;themes/christmas/public\u0026#39;); 通过这种方式，我们可以重载默认文件。\n您不必修改默认主题的每个文件以具有新主题：只需在新主题目录中复制要重载的文件，然后使用它而不是默认主题目录。\n假设你的默认主题中有一个background.png文件：\n$ cd themes/default $ tree public templates public ├── background.png └── index.html templates ├── example │ └── welcome.html.ep └── layouts └── default.html.ep 2 directories, 4 files 为了超载它，你只需要这个：\n$ cd themes/christmas $ tree public templates public └── background.png templates 0 directories, 1 files 使用 Mojolicious::Plugin::Config 插件 Mojolicious::Plugin::Config自带Mojolicious，是让用户配置应用程序的好方法。为什么不用它让他们选择他们想要的主题？在我们的示例中，该设置将毫不奇怪地命名为主题。\n首先，使用插件：\n# Mojolicious my $config = $app-\u0026gt;plugin(\u0026#39;Config\u0026#39; =\u0026gt; { default =\u0026gt; { theme =\u0026gt; \u0026#39;default\u0026#39; } }); 请注意，我在插件的配置中添加了默认值。它确保即使用户没有选择主题，我们也会为所选主题设置正确的值。\n现在，我们只需在代码中使用该配置设置：\n# Replace the default paths $self-\u0026gt;renderer-\u0026gt;paths([$self-\u0026gt;home-\u0026gt;rel_file(\u0026#39;themes/default/templates\u0026#39;)]); $self-\u0026gt;static-\u0026gt;paths([$self-\u0026gt;home-\u0026gt;rel_file(\u0026#39;themes/default/public\u0026#39;)]); # Do we use a different theme? if ($config-\u0026gt;{theme} ne \u0026#39;default\u0026#39;) { # Put the new theme first my $theme = $self-\u0026gt;home-\u0026gt;rel_file(\u0026#39;themes/\u0026#39;.$config-\u0026gt;{theme}); unshift @{$self-\u0026gt;renderer-\u0026gt;paths}, $theme.\u0026#39;/templates\u0026#39; if -d $theme.\u0026#39;/templates\u0026#39;; unshift @{$self-\u0026gt;static-\u0026gt;paths}, $theme.\u0026#39;/public\u0026#39; if -d $theme.\u0026#39;/public\u0026#39;; } 请注意 if -d $theme.'/templates'：如果使用主题名称中的拼写错误并且如果您只需要其中一个，则可以避免在主题目录中创建 templates 和 public，从而防止出现问题。\n结论 您现在正在应用程序中提供主题系统。用户现在可以改变它的样式而不用担心丢失对更新的更改（尽管他们需要检查他们所做的更改，以防默认主题发生很大变化）。\n您甚至可以自己提供不同的主题，就像我为我的 URL 缩短应用程序 Lstu 所做的那样.🙂\n"},"name":"第九天 - 为你的 Mojolicious 应用添加主题系统","published":"2018-12-09T22:40:29Z","summary":"你写了一个很棒的Mojolicious应用程序，人们使用它。奇妙！但是用户可能想要修改应用程序的主题：更改徽标，使用其他CSS框架，这类事情。\n修改Mojolicious应用程序的主题非常简单：在公共和模板中添加，修改或删除内容。但是所有这些直接修改可能无法在更新应用程序时继续存在：它们只会被新版本的文件删除。\n让我们看看我们如何提供一种在Mojolicious应用程序中拥有主题系统的方法，该方法允许用户在没有痛苦的情况下拥有自定义主题，并且没有丢失更新的风险。\n一个新的应用程序 当您使用mojo生成MyApplication创建新的Mojolicious应用程序时，这些是将提供文件及其默认内容的默认目录：\n$ tree public templates public └── index.html templates ├── example │ └── welcome.html.ep └── layouts └── default.html.ep 2 directories, 3 files public是存储静态文件的地方，而templates是存储模板的地方。\n这些路径在$ app-\u0026gt; static-\u0026gt; paths和$ app-\u0026gt; renderer-\u0026gt; paths中的Mojolicious应用程序中注册。幸运的是，这两个对象是数组引用，因此我们可以向它们添加或删除目录。\n当提供静态文件时，我们的应用程序在$ app-\u0026gt; static-\u0026gt; paths数组的第一个目录中搜索该文件，如果找不到它，则搜索下一个目录，依此类推。模板渲染也是如此。\n让我们改变路由 我们可以将公共模板和模板默认目录保存在应用程序目录的根目录下，但我喜欢在一个名为themes的目录中重新组合所有与主题相关的东西并调用我的默认主题\u0026hellip;好吧，默认。\n创建新目录并在其中移动默认主题目录：\n$ mkdir -p themes/default $ mv public templates themes/default 然后，我们需要更改应用程序中的路径。在 lib/MyApplication.pm 中添加：\n# Replace the default paths $self-\u0026gt;renderer-\u0026gt;paths([$self-\u0026gt;home-\u0026gt;rel_file(\u0026#39;themes/default/templates\u0026#39;)]); $self-\u0026gt;static-\u0026gt;paths([$self-\u0026gt;home-\u0026gt;rel_file(\u0026#39;themes/default/public\u0026#39;)]); 添加使用其他主题的方法 如前所述，Mojolicious在已注册路径的第一个目录中搜索静态文件或模板，如果找不到文件或模板则转到下一个。\n因此，我们需要在默认主题路径之前添加新主题路径。\n假设我们创建了一个圣诞主题，其中文件位于主题/圣诞节/公共内容中，哪些模板位于主题/圣诞节/模板中。\n我们要添加到代码中的代码段变为：\n# Replace the default paths $self-\u0026gt;renderer-\u0026gt;paths([$self-\u0026gt;home-\u0026gt;rel_file(\u0026#39;themes/default/templates\u0026#39;)]); $self-\u0026gt;static-\u0026gt;paths([$self-\u0026gt;home-\u0026gt;rel_file(\u0026#39;themes/default/public\u0026#39;)]); # Put the new theme first unshift @{$self-\u0026gt;renderer-\u0026gt;paths}, $self-\u0026gt;home-\u0026gt;rel_file(\u0026#39;themes/christmas/templates\u0026#39;); unshift @{$self-\u0026gt;static-\u0026gt;paths}, $self-\u0026gt;home-\u0026gt;rel_file(\u0026#39;themes/christmas/public\u0026#39;); 通过这种方式，我们可以重载默认文件。","type":"entry","url":"https://ohmycloud.github.io/notes/add-a-theme-system-to-your-mojolicious-app/"}