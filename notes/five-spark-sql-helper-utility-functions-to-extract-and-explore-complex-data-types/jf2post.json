{"author":{"name":null,"type":"card","url":"http://localhost:1313/"},"content":{"html":"\u003cp\u003e\u003ca href=\"https://docs.databricks.com/_static/notebooks/complex-nested-structured.html\"\u003ehttps://docs.databricks.com/_static/notebooks/complex-nested-structured.html\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e虽然\u003ca href=\"https://databricks.com/blog/2017/02/23/working-complex-data-formats-structured-streaming-apache-spark-2-1.html\"\u003e这个深入的博客列出并解释了处理和处理复杂数据类型和格式的概念和动机\u003c/a\u003e，但这个笔记本示例通过几个具体示例检查了如何将它们应用于您在使用中可能遇到的数据类型案例。这个简短的笔记本教程展示了一些方法，您可以在其中探索和使用许多新的帮助程序 Spark SQL 实用程序函数和 API 作为\u003ccode\u003eorg.apache.spark.sql.functions\u003c/code\u003e 包的一部分。特别是，它们在执行 Streaming ETL 时派上用场，其中数据是具有复杂和嵌套结构的 JSON 对象：嵌入为 JSON 的 Map 和 Structs：\u003c/p\u003e\n\u003cp\u003e_ get_json_object()\u003cbr\u003e\n_ from_json()\u003cbr\u003e\n_ to_json()\u003cbr\u003e\n_ explode()\u003cbr\u003e\n_ selectExpr()\u003c/p\u003e\n\u003cp\u003e本简短教程的内容是使用 Spark SQL 实用程序函数对嵌套 JSON 结构进行切片和切块的无数方法。\u003c/p\u003e\n\u003cp\u003e让我们创建一个带有属性和值的简单 JSON 模式，而不使用任何嵌套结构。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eorg.apache.spark.sql.types._\u003c/span\u003e                         \u003cspan class=\"c1\"\u003e// include the Spark Types to define our schema\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eorg.apache.spark.sql.functions._\u003c/span\u003e                     \u003cspan class=\"c1\"\u003e// include the Spark helper functions\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003ejsonSchema\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructType\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;battery_level\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eLongType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;c02_level\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eLongType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;cca3\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;cn\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;device_id\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eLongType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;device_type\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;signal\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eLongType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;ip\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;temp\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eLongType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;timestamp\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eTimestampType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eorg.apache.spark.sql.types._\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eorg.apache.spark.sql.functions._\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ejsonSchema\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eorg.apache.spark.sql.\u003c/span\u003e\u003cspan class=\"k\"\u003etype\u003c/span\u003e\u003cspan class=\"kt\"\u003es.StructType\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructType\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebattery_level\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eLongType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ec02_level\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eLongType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecca3\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecn\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edevice_id\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eLongType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edevice_type\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esignal\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eLongType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eip\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etemp\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eLongType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etimestamp\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eTimestampType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e使用上面的模式，创建一个表示为 Scala case 类的 Dataset，并生成与之关联的一些 JSON 数据。很可能，这个 JSON 也可能是从 Kafka 主题读取的设备事件流。请注意，case 类有两个字段：integer（作为设备ID）和 string（作为表示设备事件的 JSON 字符串）。\u003c/p\u003e\n\u003ch2 id=\"从上面的-schema-创建-dataset\"\u003e从上面的 schema 创建 Dataset\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// define a case class\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDeviceData\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eInt\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edevice\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// create some sample data\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003eeventsDS\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"nc\"\u003eSeq\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 0, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;68.161.225.1\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 25, \u0026#34;signal\u0026#34;: 23, \u0026#34;battery_level\u0026#34;: 8, \u0026#34;c02_level\u0026#34;: 917, \u0026#34;timestamp\u0026#34; :1475600496 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 1, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-igauge\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;213.161.254.1\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;NOR\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;Norway\u0026#34;, \u0026#34;temp\u0026#34;: 30, \u0026#34;signal\u0026#34;: 18, \u0026#34;battery_level\u0026#34;: 6, \u0026#34;c02_level\u0026#34;: 1413, \u0026#34;timestamp\u0026#34; :1475600498 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 2, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;88.36.5.1\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;ITA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;Italy\u0026#34;, \u0026#34;temp\u0026#34;: 18, \u0026#34;signal\u0026#34;: 25, \u0026#34;battery_level\u0026#34;: 5, \u0026#34;c02_level\u0026#34;: 1372, \u0026#34;timestamp\u0026#34; :1475600500 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 3, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-inest\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;66.39.173.154\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 47, \u0026#34;signal\u0026#34;: 12, \u0026#34;battery_level\u0026#34;: 1, \u0026#34;c02_level\u0026#34;: 1447, \u0026#34;timestamp\u0026#34; :1475600502 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 4, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;203.82.41.9\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;PHL\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;Philippines\u0026#34;, \u0026#34;temp\u0026#34;: 29, \u0026#34;signal\u0026#34;: 11, \u0026#34;battery_level\u0026#34;: 0, \u0026#34;c02_level\u0026#34;: 983, \u0026#34;timestamp\u0026#34; :1475600504 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 5, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-istick\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;204.116.105.67\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 50, \u0026#34;signal\u0026#34;: 16, \u0026#34;battery_level\u0026#34;: 8, \u0026#34;c02_level\u0026#34;: 1574, \u0026#34;timestamp\u0026#34; :1475600506 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 6, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;220.173.179.1\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;CHN\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;China\u0026#34;, \u0026#34;temp\u0026#34;: 21, \u0026#34;signal\u0026#34;: 18, \u0026#34;battery_level\u0026#34;: 9, \u0026#34;c02_level\u0026#34;: 1249, \u0026#34;timestamp\u0026#34; :1475600508 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 7, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;118.23.68.227\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;JPN\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;Japan\u0026#34;, \u0026#34;temp\u0026#34;: 27, \u0026#34;signal\u0026#34;: 15, \u0026#34;battery_level\u0026#34;: 0, \u0026#34;c02_level\u0026#34;: 1531, \u0026#34;timestamp\u0026#34; :1475600512 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e \u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34; {\u0026#34;device_id\u0026#34;: 8, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-inest\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;208.109.163.218\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 40, \u0026#34;signal\u0026#34;: 16, \u0026#34;battery_level\u0026#34;: 9, \u0026#34;c02_level\u0026#34;: 1208, \u0026#34;timestamp\u0026#34; :1475600514 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e9\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 9, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;88.213.191.34\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;ITA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;Italy\u0026#34;, \u0026#34;temp\u0026#34;: 19, \u0026#34;signal\u0026#34;: 11, \u0026#34;battery_level\u0026#34;: 0, \u0026#34;c02_level\u0026#34;: 1171, \u0026#34;timestamp\u0026#34; :1475600516 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 10, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-igauge\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;68.28.91.22\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 32, \u0026#34;signal\u0026#34;: 26, \u0026#34;battery_level\u0026#34;: 7, \u0026#34;c02_level\u0026#34;: 886, \u0026#34;timestamp\u0026#34; :1475600518 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e11\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 11, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;59.144.114.250\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;IND\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;India\u0026#34;, \u0026#34;temp\u0026#34;: 46, \u0026#34;signal\u0026#34;: 25, \u0026#34;battery_level\u0026#34;: 4, \u0026#34;c02_level\u0026#34;: 863, \u0026#34;timestamp\u0026#34; :1475600520 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e12\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 12, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-igauge\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;193.156.90.200\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;NOR\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;Norway\u0026#34;, \u0026#34;temp\u0026#34;: 18, \u0026#34;signal\u0026#34;: 26, \u0026#34;battery_level\u0026#34;: 8, \u0026#34;c02_level\u0026#34;: 1220, \u0026#34;timestamp\u0026#34; :1475600522 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e13\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 13, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;67.185.72.1\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 34, \u0026#34;signal\u0026#34;: 20, \u0026#34;battery_level\u0026#34;: 8, \u0026#34;c02_level\u0026#34;: 1504, \u0026#34;timestamp\u0026#34; :1475600524 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e14\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 14, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-inest\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;68.85.85.106\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 39, \u0026#34;signal\u0026#34;: 17, \u0026#34;battery_level\u0026#34;: 8, \u0026#34;c02_level\u0026#34;: 831, \u0026#34;timestamp\u0026#34; :1475600526 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e15\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 15, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;161.188.212.254\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 27, \u0026#34;signal\u0026#34;: 26, \u0026#34;battery_level\u0026#34;: 5, \u0026#34;c02_level\u0026#34;: 1378, \u0026#34;timestamp\u0026#34; :1475600528 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e16\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 16, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-igauge\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;221.3.128.242\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;CHN\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;China\u0026#34;, \u0026#34;temp\u0026#34;: 10, \u0026#34;signal\u0026#34;: 24, \u0026#34;battery_level\u0026#34;: 6, \u0026#34;c02_level\u0026#34;: 1423, \u0026#34;timestamp\u0026#34; :1475600530 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e17\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 17, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;64.124.180.215\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 38, \u0026#34;signal\u0026#34;: 17, \u0026#34;battery_level\u0026#34;: 9, \u0026#34;c02_level\u0026#34;: 1304, \u0026#34;timestamp\u0026#34; :1475600532 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e18\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 18, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-igauge\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;66.153.162.66\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 26, \u0026#34;signal\u0026#34;: 10, \u0026#34;battery_level\u0026#34;: 0, \u0026#34;c02_level\u0026#34;: 902, \u0026#34;timestamp\u0026#34; :1475600534 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e19\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 19, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;193.200.142.254\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;AUT\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;Austria\u0026#34;, \u0026#34;temp\u0026#34;: 32, \u0026#34;signal\u0026#34;: 27, \u0026#34;battery_level\u0026#34;: 5, \u0026#34;c02_level\u0026#34;: 1282, \u0026#34;timestamp\u0026#34; :1475600536 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)).\u003c/span\u003e\u003cspan class=\"n\"\u003etoDF\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;device\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eas\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eDeviceData\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003edefined\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDeviceData\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eeventsDS\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eorg.apache.spark.sql.Dataset\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eDeviceData\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eid:\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e, \u003cspan class=\"kt\"\u003edevice:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e我们的 Dataset 是 Scala case 类的集合，当显示为 DataFrame 时，有两列 (id, string)\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003edisplay(eventsDS)\n\u003c/code\u003e\u003c/pre\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003eid\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003edevice\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 0, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;68.161.225.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 25, \u0026ldquo;signal\u0026rdquo;: 23, \u0026ldquo;battery_level\u0026rdquo;: 8, \u0026ldquo;c02_level\u0026rdquo;: 917, \u0026ldquo;timestamp\u0026rdquo; :1475600496 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e1\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 1, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-igauge\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;213.161.254.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;NOR\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Norway\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 30, \u0026ldquo;signal\u0026rdquo;: 18, \u0026ldquo;battery_level\u0026rdquo;: 6, \u0026ldquo;c02_level\u0026rdquo;: 1413, \u0026ldquo;timestamp\u0026rdquo; :1475600498 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e2\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 2, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;88.36.5.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;ITA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Italy\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 18, \u0026ldquo;signal\u0026rdquo;: 25, \u0026ldquo;battery_level\u0026rdquo;: 5, \u0026ldquo;c02_level\u0026rdquo;: 1372, \u0026ldquo;timestamp\u0026rdquo; :1475600500 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e3\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 3, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-inest\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;66.39.173.154\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 47, \u0026ldquo;signal\u0026rdquo;: 12, \u0026ldquo;battery_level\u0026rdquo;: 1, \u0026ldquo;c02_level\u0026rdquo;: 1447, \u0026ldquo;timestamp\u0026rdquo; :1475600502 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e4\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 4, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;203.82.41.9\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;PHL\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Philippines\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 29, \u0026ldquo;signal\u0026rdquo;: 11, \u0026ldquo;battery_level\u0026rdquo;: 0, \u0026ldquo;c02_level\u0026rdquo;: 983, \u0026ldquo;timestamp\u0026rdquo; :1475600504 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e5\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 5, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-istick\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;204.116.105.67\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 50, \u0026ldquo;signal\u0026rdquo;: 16, \u0026ldquo;battery_level\u0026rdquo;: 8, \u0026ldquo;c02_level\u0026rdquo;: 1574, \u0026ldquo;timestamp\u0026rdquo; :1475600506 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e6\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 6, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;220.173.179.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;CHN\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;China\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 21, \u0026ldquo;signal\u0026rdquo;: 18, \u0026ldquo;battery_level\u0026rdquo;: 9, \u0026ldquo;c02_level\u0026rdquo;: 1249, \u0026ldquo;timestamp\u0026rdquo; :1475600508 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e7\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 7, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;118.23.68.227\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;JPN\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Japan\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 27, \u0026ldquo;signal\u0026rdquo;: 15, \u0026ldquo;battery_level\u0026rdquo;: 0, \u0026ldquo;c02_level\u0026rdquo;: 1531, \u0026ldquo;timestamp\u0026rdquo; :1475600512 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e8\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 8, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-inest\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;208.109.163.218\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 40, \u0026ldquo;signal\u0026rdquo;: 16, \u0026ldquo;battery_level\u0026rdquo;: 9, \u0026ldquo;c02_level\u0026rdquo;: 1208, \u0026ldquo;timestamp\u0026rdquo; :1475600514 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e9\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 9, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;88.213.191.34\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;ITA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Italy\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 19, \u0026ldquo;signal\u0026rdquo;: 11, \u0026ldquo;battery_level\u0026rdquo;: 0, \u0026ldquo;c02_level\u0026rdquo;: 1171, \u0026ldquo;timestamp\u0026rdquo; :1475600516 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e10\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 10, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-igauge\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;68.28.91.22\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 32, \u0026ldquo;signal\u0026rdquo;: 26, \u0026ldquo;battery_level\u0026rdquo;: 7, \u0026ldquo;c02_level\u0026rdquo;: 886, \u0026ldquo;timestamp\u0026rdquo; :1475600518 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e11\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 11, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;59.144.114.250\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;IND\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;India\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 46, \u0026ldquo;signal\u0026rdquo;: 25, \u0026ldquo;battery_level\u0026rdquo;: 4, \u0026ldquo;c02_level\u0026rdquo;: 863, \u0026ldquo;timestamp\u0026rdquo; :1475600520 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e12\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 12, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-igauge\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;193.156.90.200\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;NOR\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Norway\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 18, \u0026ldquo;signal\u0026rdquo;: 26, \u0026ldquo;battery_level\u0026rdquo;: 8, \u0026ldquo;c02_level\u0026rdquo;: 1220, \u0026ldquo;timestamp\u0026rdquo; :1475600522 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e13\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 13, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;67.185.72.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 34, \u0026ldquo;signal\u0026rdquo;: 20, \u0026ldquo;battery_level\u0026rdquo;: 8, \u0026ldquo;c02_level\u0026rdquo;: 1504, \u0026ldquo;timestamp\u0026rdquo; :1475600524 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e14\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 14, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-inest\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;68.85.85.106\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 39, \u0026ldquo;signal\u0026rdquo;: 17, \u0026ldquo;battery_level\u0026rdquo;: 8, \u0026ldquo;c02_level\u0026rdquo;: 831, \u0026ldquo;timestamp\u0026rdquo; :1475600526 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e15\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 15, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;161.188.212.254\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 27, \u0026ldquo;signal\u0026rdquo;: 26, \u0026ldquo;battery_level\u0026rdquo;: 5, \u0026ldquo;c02_level\u0026rdquo;: 1378, \u0026ldquo;timestamp\u0026rdquo; :1475600528 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e16\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 16, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-igauge\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;221.3.128.242\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;CHN\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;China\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 10, \u0026ldquo;signal\u0026rdquo;: 24, \u0026ldquo;battery_level\u0026rdquo;: 6, \u0026ldquo;c02_level\u0026rdquo;: 1423, \u0026ldquo;timestamp\u0026rdquo; :1475600530 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e17\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 17, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;64.124.180.215\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 38, \u0026ldquo;signal\u0026rdquo;: 17, \u0026ldquo;battery_level\u0026rdquo;: 9, \u0026ldquo;c02_level\u0026rdquo;: 1304, \u0026ldquo;timestamp\u0026rdquo; :1475600532 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e18\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 18, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-igauge\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;66.153.162.66\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 26, \u0026ldquo;signal\u0026rdquo;: 10, \u0026ldquo;battery_level\u0026rdquo;: 0, \u0026ldquo;c02_level\u0026rdquo;: 902, \u0026ldquo;timestamp\u0026rdquo; :1475600534 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e19\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 19, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;193.200.142.254\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;AUT\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Austria\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 32, \u0026ldquo;signal\u0026rdquo;: 27, \u0026ldquo;battery_level\u0026rdquo;: 5, \u0026ldquo;c02_level\u0026rdquo;: 1282, \u0026ldquo;timestamp\u0026rdquo; :1475600536 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e打印 schema 将测试为两列，类型为 \u003ccode\u003einteger\u003c/code\u003e 和 \u003ccode\u003estring\u003c/code\u003e，反映了 Scala case 类。\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eeventsDS.printSchema\nroot\n |-- id: integer (nullable = false)\n |-- device: string (nullable = true)\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"如何使用-get_json_object\"\u003e如何使用 get_json_object()\u003c/h2\u003e\n\u003cp\u003e此方法基于指定的 JSON 路径从 JSON 字符串中提取 JSON 对象，并返回 JSON 字符串作为提取的 JSON 对象。以上面 Dataset 的小例子为例，我们希望从中提取构成 JSON 对象字符串的数据值部分。假设您只想提取 id，device_type，ip 和 CCA3 代码。这是使用 \u003ccode\u003eget_json_object()\u003c/code\u003e 快速完成的方法。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003eeventsFromJSONDF\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"nc\"\u003eSeq\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e0\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 0, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;68.161.225.1\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 25, \u0026#34;signal\u0026#34;: 23, \u0026#34;battery_level\u0026#34;: 8, \u0026#34;c02_level\u0026#34;: 917, \u0026#34;timestamp\u0026#34; :1475600496 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e1\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 1, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-igauge\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;213.161.254.1\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;NOR\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;Norway\u0026#34;, \u0026#34;temp\u0026#34;: 30, \u0026#34;signal\u0026#34;: 18, \u0026#34;battery_level\u0026#34;: 6, \u0026#34;c02_level\u0026#34;: 1413, \u0026#34;timestamp\u0026#34; :1475600498 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e2\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 2, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;88.36.5.1\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;ITA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;Italy\u0026#34;, \u0026#34;temp\u0026#34;: 18, \u0026#34;signal\u0026#34;: 25, \u0026#34;battery_level\u0026#34;: 5, \u0026#34;c02_level\u0026#34;: 1372, \u0026#34;timestamp\u0026#34; :1475600500 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e3\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 3, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-inest\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;66.39.173.154\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 47, \u0026#34;signal\u0026#34;: 12, \u0026#34;battery_level\u0026#34;: 1, \u0026#34;c02_level\u0026#34;: 1447, \u0026#34;timestamp\u0026#34; :1475600502 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e4\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 4, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;203.82.41.9\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;PHL\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;Philippines\u0026#34;, \u0026#34;temp\u0026#34;: 29, \u0026#34;signal\u0026#34;: 11, \u0026#34;battery_level\u0026#34;: 0, \u0026#34;c02_level\u0026#34;: 983, \u0026#34;timestamp\u0026#34; :1475600504 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 5, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-istick\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;204.116.105.67\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 50, \u0026#34;signal\u0026#34;: 16, \u0026#34;battery_level\u0026#34;: 8, \u0026#34;c02_level\u0026#34;: 1574, \u0026#34;timestamp\u0026#34; :1475600506 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e6\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 6, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;220.173.179.1\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;CHN\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;China\u0026#34;, \u0026#34;temp\u0026#34;: 21, \u0026#34;signal\u0026#34;: 18, \u0026#34;battery_level\u0026#34;: 9, \u0026#34;c02_level\u0026#34;: 1249, \u0026#34;timestamp\u0026#34; :1475600508 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e7\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 7, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;118.23.68.227\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;JPN\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;Japan\u0026#34;, \u0026#34;temp\u0026#34;: 27, \u0026#34;signal\u0026#34;: 15, \u0026#34;battery_level\u0026#34;: 0, \u0026#34;c02_level\u0026#34;: 1531, \u0026#34;timestamp\u0026#34; :1475600512 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e8\u003c/span\u003e \u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34; {\u0026#34;device_id\u0026#34;: 8, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-inest\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;208.109.163.218\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 40, \u0026#34;signal\u0026#34;: 16, \u0026#34;battery_level\u0026#34;: 9, \u0026#34;c02_level\u0026#34;: 1208, \u0026#34;timestamp\u0026#34; :1475600514 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"mi\"\u003e9\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 9, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;88.213.191.34\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;ITA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;Italy\u0026#34;, \u0026#34;temp\u0026#34;: 19, \u0026#34;signal\u0026#34;: 11, \u0026#34;battery_level\u0026#34;: 0, \u0026#34;c02_level\u0026#34;: 1171, \u0026#34;timestamp\u0026#34; :1475600516 }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)).\u003c/span\u003e\u003cspan class=\"n\"\u003etoDF\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;json\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eeventsFromJSONDF\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eorg.apache.spark.sql.DataFrame\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eid:\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e, \u003cspan class=\"kt\"\u003ejson:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003edisplay(eventsFromJSONDF)\n\u003c/code\u003e\u003c/pre\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003eid\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003ejson\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 0, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;68.161.225.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 25, \u0026ldquo;signal\u0026rdquo;: 23, \u0026ldquo;battery_level\u0026rdquo;: 8, \u0026ldquo;c02_level\u0026rdquo;: 917, \u0026ldquo;timestamp\u0026rdquo; :1475600496 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e1\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 1, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-igauge\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;213.161.254.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;NOR\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Norway\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 30, \u0026ldquo;signal\u0026rdquo;: 18, \u0026ldquo;battery_level\u0026rdquo;: 6, \u0026ldquo;c02_level\u0026rdquo;: 1413, \u0026ldquo;timestamp\u0026rdquo; :1475600498 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e2\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 2, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;88.36.5.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;ITA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Italy\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 18, \u0026ldquo;signal\u0026rdquo;: 25, \u0026ldquo;battery_level\u0026rdquo;: 5, \u0026ldquo;c02_level\u0026rdquo;: 1372, \u0026ldquo;timestamp\u0026rdquo; :1475600500 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e3\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 3, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-inest\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;66.39.173.154\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 47, \u0026ldquo;signal\u0026rdquo;: 12, \u0026ldquo;battery_level\u0026rdquo;: 1, \u0026ldquo;c02_level\u0026rdquo;: 1447, \u0026ldquo;timestamp\u0026rdquo; :1475600502 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e4\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 4, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;203.82.41.9\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;PHL\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Philippines\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 29, \u0026ldquo;signal\u0026rdquo;: 11, \u0026ldquo;battery_level\u0026rdquo;: 0, \u0026ldquo;c02_level\u0026rdquo;: 983, \u0026ldquo;timestamp\u0026rdquo; :1475600504 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e5\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 5, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-istick\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;204.116.105.67\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 50, \u0026ldquo;signal\u0026rdquo;: 16, \u0026ldquo;battery_level\u0026rdquo;: 8, \u0026ldquo;c02_level\u0026rdquo;: 1574, \u0026ldquo;timestamp\u0026rdquo; :1475600506 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e6\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 6, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;220.173.179.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;CHN\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;China\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 21, \u0026ldquo;signal\u0026rdquo;: 18, \u0026ldquo;battery_level\u0026rdquo;: 9, \u0026ldquo;c02_level\u0026rdquo;: 1249, \u0026ldquo;timestamp\u0026rdquo; :1475600508 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e7\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 7, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;118.23.68.227\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;JPN\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Japan\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 27, \u0026ldquo;signal\u0026rdquo;: 15, \u0026ldquo;battery_level\u0026rdquo;: 0, \u0026ldquo;c02_level\u0026rdquo;: 1531, \u0026ldquo;timestamp\u0026rdquo; :1475600512 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e8\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 8, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-inest\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;208.109.163.218\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 40, \u0026ldquo;signal\u0026rdquo;: 16, \u0026ldquo;battery_level\u0026rdquo;: 9, \u0026ldquo;c02_level\u0026rdquo;: 1208, \u0026ldquo;timestamp\u0026rdquo; :1475600514 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e9\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 9, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;88.213.191.34\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;ITA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Italy\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 19, \u0026ldquo;signal\u0026rdquo;: 11, \u0026ldquo;battery_level\u0026rdquo;: 0, \u0026ldquo;c02_level\u0026rdquo;: 1171, \u0026ldquo;timestamp\u0026rdquo; :1475600516 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003ejsDF\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eeventsFromJSONDF\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eselect\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eget_json_object\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;json\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;$.device_type\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003ealias\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;device_type\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                          \u003cspan class=\"n\"\u003eget_json_object\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;json\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;$.ip\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003ealias\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;ip\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                         \u003cspan class=\"n\"\u003eget_json_object\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;json\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;$.cca3\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003ealias\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;cca3\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ejsDF\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eorg.apache.spark.sql.DataFrame\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eid:\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e, \u003cspan class=\"kt\"\u003edevice_type:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"kt\"\u003e...\u003c/span\u003e \u003cspan class=\"err\"\u003e2\u003c/span\u003e \u003cspan class=\"kt\"\u003emore\u003c/span\u003e \u003cspan class=\"kt\"\u003efields\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003edisplay(jsDF)\n\u003c/code\u003e\u003c/pre\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003eid\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003edevice_type\u003c/th\u003e\n\u003cth style=\"text-align:center\"\u003eip\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003ecca3\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003esensor-ipad\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e68.161.225.1\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eUSA\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e1\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003esensor-igauge\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e213.161.254.1\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eNOR\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e2\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003esensor-ipad\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e88.36.5.1\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eITA\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e3\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003esensor-inest\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e66.39.173.154\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eUSA\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e4\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003esensor-ipad\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e203.82.41.9\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003ePHL\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e5\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003esensor-istick\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e204.116.105.67\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eUSA\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e6\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003esensor-ipad\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e220.173.179.1\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eCHN\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e7\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003esensor-ipad\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e118.23.68.227\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eJPN\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e8\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003esensor-inest\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e208.109.163.218\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eUSA\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e9\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003esensor-ipad\u003c/td\u003e\n\u003ctd style=\"text-align:center\"\u003e88.213.191.34\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eITA\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"如何使用-from_json\"\u003e如何使用 from_json()\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003eget_json_object()\u003c/code\u003e 的变体，此函数使用 schema 提取单个列。在 \u003ccode\u003eselect()\u003c/code\u003e Dataset API 调用中使用 \u003ca href=\"https://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.sql.functions$\"\u003efrom_json()\u003c/a\u003e 辅助函数，我可以将数据的属性和值从 JSON 字符串提取或解码为 DataFrame 作为列，由 schema 指定。在使用 schema 时，我将此 JSON 中所有关联的属性和值归为一类，以表示为实体设备。因此，您不仅可以使用 \u003ccode\u003edevice.attribute\u003c/code\u003e 来检索其各自的值，还可以使用 \u003ccode\u003e*\u003c/code\u003e 表示法检索所有值。\u003c/p\u003e\n\u003cp\u003e在下面的例子中：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e使用上面的 schema 从 JSON 字符串中提取属性和值，并将它们表示为单个列作为 \u003ccode\u003edevices\u003c/code\u003e 的一部分\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eselect()\u003c/code\u003e 所有列\u003c/li\u003e\n\u003cli\u003e使用 \u003ccode\u003e.\u003c/code\u003e 记号过滤所需的属性\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e将 JSON 字符串中的数据提取到其各自的 DataFrame 列后，您可以应用 DataFrame/Dataset API 调用来选择，过滤和后续显示，令您满意。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003edevicesDF\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eeventsDS\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eselect\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efrom_json\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;device\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ejsonSchema\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eas\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;devices\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eselect\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;devices.*\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003efilter\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;devices.temp\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e10\u003c/span\u003e \u003cspan class=\"n\"\u003eand\u003c/span\u003e \u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;devices.signal\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e\u0026gt;\u003c/span\u003e \u003cspan class=\"mi\"\u003e15\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003edevicesDF\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eorg.apache.spark.sql.Dataset\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eorg.apache.spark.sql.Row\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003ebattery_level:\u003c/span\u003e \u003cspan class=\"kt\"\u003ebigint\u003c/span\u003e, \u003cspan class=\"kt\"\u003ec02_level:\u003c/span\u003e \u003cspan class=\"kt\"\u003ebigint\u003c/span\u003e \u003cspan class=\"kt\"\u003e...\u003c/span\u003e \u003cspan class=\"err\"\u003e8\u003c/span\u003e \u003cspan class=\"kt\"\u003emore\u003c/span\u003e \u003cspan class=\"kt\"\u003efields\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003edisplay(devicesDF)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003etodo\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003edevicesUSDF\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edevicesDF\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eselect\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;*\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003ewhere\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;cca3\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e===\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;USA\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003eorderBy\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;signal\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edesc\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;temp\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edesc\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003edevicesUSDF\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eorg.apache.spark.sql.Dataset\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eorg.apache.spark.sql.Row\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003ebattery_level:\u003c/span\u003e \u003cspan class=\"kt\"\u003ebigint\u003c/span\u003e, \u003cspan class=\"kt\"\u003ec02_level:\u003c/span\u003e \u003cspan class=\"kt\"\u003ebigint\u003c/span\u003e \u003cspan class=\"kt\"\u003e...\u003c/span\u003e \u003cspan class=\"err\"\u003e8\u003c/span\u003e \u003cspan class=\"kt\"\u003emore\u003c/span\u003e \u003cspan class=\"kt\"\u003efields\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003edisplay(devicesUSDF)\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"如何使用-to_json\"\u003e如何使用 to_json()\u003c/h2\u003e\n\u003cp\u003e现在，让我们反过来：您可以使用 \u003ccode\u003eto_json()\u003c/code\u003e 将我们过滤的设备转换或编码为 JSON 字符串。也就是说，将 JSON 结构转换为字符串。结果可以重新发布到例如 Kafka 或作为 parquet 文件保存在磁盘上。要了解如何写入 Kafka 和其他接收器，请阅读\u003ca href=\"https://databricks.com/blog/2017/04/04/real-time-end-to-end-integration-with-apache-kafka-in-apache-sparks-structured-streaming.html\"\u003e此博客\u003c/a\u003e和我们关于\u003ca href=\"https://databricks.com/blog/2017/01/19/real-time-streaming-etl-structured-streaming-apache-spark-2-1.html\"\u003e结构化流博客\u003c/a\u003e的系列。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003estringJsonDF\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eeventsDS\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eselect\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eto_json\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estruct\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;*\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e))).\u003c/span\u003e\u003cspan class=\"n\"\u003etoDF\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;devices\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003estringJsonDF\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eorg.apache.spark.sql.DataFrame\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003edevices:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003edisplay(stringJsonDF)\n\u003c/code\u003e\u003c/pre\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003edevices\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;id\u0026rdquo;:0,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 0, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-ipad\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;68.161.225.1\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;USA\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;United States\u0026quot;, \u0026quot;temp\u0026quot;: 25, \u0026quot;signal\u0026quot;: 23, \u0026quot;battery_level\u0026quot;: 8, \u0026quot;c02_level\u0026quot;: 917, \u0026quot;timestamp\u0026quot; :1475600496 }\u0026quot;}\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;id\u0026rdquo;:1,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 1, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-igauge\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;213.161.254.1\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;NOR\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;Norway\u0026quot;, \u0026quot;temp\u0026quot;: 30, \u0026quot;signal\u0026quot;: 18, \u0026quot;battery_level\u0026quot;: 6, \u0026quot;c02_level\u0026quot;: 1413, \u0026quot;timestamp\u0026quot; :1475600498 }\u0026quot;}\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;id\u0026rdquo;:2,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 2, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-ipad\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;88.36.5.1\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;ITA\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;Italy\u0026quot;, \u0026quot;temp\u0026quot;: 18, \u0026quot;signal\u0026quot;: 25, \u0026quot;battery_level\u0026quot;: 5, \u0026quot;c02_level\u0026quot;: 1372, \u0026quot;timestamp\u0026quot; :1475600500 }\u0026quot;}\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;id\u0026rdquo;:3,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 3, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-inest\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;66.39.173.154\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;USA\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;United States\u0026quot;, \u0026quot;temp\u0026quot;: 47, \u0026quot;signal\u0026quot;: 12, \u0026quot;battery_level\u0026quot;: 1, \u0026quot;c02_level\u0026quot;: 1447, \u0026quot;timestamp\u0026quot; :1475600502 }\u0026quot;}\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;id\u0026rdquo;:4,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 4, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-ipad\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;203.82.41.9\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;PHL\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;Philippines\u0026quot;, \u0026quot;temp\u0026quot;: 29, \u0026quot;signal\u0026quot;: 11, \u0026quot;battery_level\u0026quot;: 0, \u0026quot;c02_level\u0026quot;: 983, \u0026quot;timestamp\u0026quot; :1475600504 }\u0026quot;}\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;id\u0026rdquo;:5,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 5, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-istick\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;204.116.105.67\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;USA\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;United States\u0026quot;, \u0026quot;temp\u0026quot;: 50, \u0026quot;signal\u0026quot;: 16, \u0026quot;battery_level\u0026quot;: 8, \u0026quot;c02_level\u0026quot;: 1574, \u0026quot;timestamp\u0026quot; :1475600506 }\u0026quot;}\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;id\u0026rdquo;:6,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 6, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-ipad\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;220.173.179.1\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;CHN\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;China\u0026quot;, \u0026quot;temp\u0026quot;: 21, \u0026quot;signal\u0026quot;: 18, \u0026quot;battery_level\u0026quot;: 9, \u0026quot;c02_level\u0026quot;: 1249, \u0026quot;timestamp\u0026quot; :1475600508 }\u0026quot;}\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;id\u0026rdquo;:7,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 7, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-ipad\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;118.23.68.227\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;JPN\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;Japan\u0026quot;, \u0026quot;temp\u0026quot;: 27, \u0026quot;signal\u0026quot;: 15, \u0026quot;battery_level\u0026quot;: 0, \u0026quot;c02_level\u0026quot;: 1531, \u0026quot;timestamp\u0026quot; :1475600512 }\u0026quot;}\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;id\u0026rdquo;:8,\u0026ldquo;device\u0026rdquo;:\u0026quot; {\u0026quot;device_id\u0026quot;: 8, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-inest\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;208.109.163.218\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;USA\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;United States\u0026quot;, \u0026quot;temp\u0026quot;: 40, \u0026quot;signal\u0026quot;: 16, \u0026quot;battery_level\u0026quot;: 9, \u0026quot;c02_level\u0026quot;: 1208, \u0026quot;timestamp\u0026quot; :1475600514 }\u0026quot;}\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;id\u0026rdquo;:9,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 9, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-ipad\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;88.213.191.34\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;ITA\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;Italy\u0026quot;, \u0026quot;temp\u0026quot;: 19, \u0026quot;signal\u0026quot;: 11, \u0026quot;battery_level\u0026quot;: 0, \u0026quot;c02_level\u0026quot;: 1171, \u0026quot;timestamp\u0026quot; :1475600516 }\u0026quot;}\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;id\u0026rdquo;:10,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 10, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-igauge\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;68.28.91.22\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;USA\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;United States\u0026quot;, \u0026quot;temp\u0026quot;: 32, \u0026quot;signal\u0026quot;: 26, \u0026quot;battery_level\u0026quot;: 7, \u0026quot;c02_level\u0026quot;: 886, \u0026quot;timestamp\u0026quot; :1475600518 }\u0026quot;}\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;id\u0026rdquo;:11,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 11, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-ipad\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;59.144.114.250\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;IND\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;India\u0026quot;, \u0026quot;temp\u0026quot;: 46, \u0026quot;signal\u0026quot;: 25, \u0026quot;battery_level\u0026quot;: 4, \u0026quot;c02_level\u0026quot;: 863, \u0026quot;timestamp\u0026quot; :1475600520 }\u0026quot;}\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;id\u0026rdquo;:12,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 12, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-igauge\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;193.156.90.200\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;NOR\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;Norway\u0026quot;, \u0026quot;temp\u0026quot;: 18, \u0026quot;signal\u0026quot;: 26, \u0026quot;battery_level\u0026quot;: 8, \u0026quot;c02_level\u0026quot;: 1220, \u0026quot;timestamp\u0026quot; :1475600522 }\u0026quot;}\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;id\u0026rdquo;:13,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 13, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-ipad\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;67.185.72.1\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;USA\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;United States\u0026quot;, \u0026quot;temp\u0026quot;: 34, \u0026quot;signal\u0026quot;: 20, \u0026quot;battery_level\u0026quot;: 8, \u0026quot;c02_level\u0026quot;: 1504, \u0026quot;timestamp\u0026quot; :1475600524 }\u0026quot;}\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;id\u0026rdquo;:14,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 14, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-inest\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;68.85.85.106\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;USA\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;United States\u0026quot;, \u0026quot;temp\u0026quot;: 39, \u0026quot;signal\u0026quot;: 17, \u0026quot;battery_level\u0026quot;: 8, \u0026quot;c02_level\u0026quot;: 831, \u0026quot;timestamp\u0026quot; :1475600526 }\u0026quot;}\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;id\u0026rdquo;:15,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 15, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-ipad\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;161.188.212.254\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;USA\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;United States\u0026quot;, \u0026quot;temp\u0026quot;: 27, \u0026quot;signal\u0026quot;: 26, \u0026quot;battery_level\u0026quot;: 5, \u0026quot;c02_level\u0026quot;: 1378, \u0026quot;timestamp\u0026quot; :1475600528 }\u0026quot;}\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;id\u0026rdquo;:16,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 16, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-igauge\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;221.3.128.242\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;CHN\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;China\u0026quot;, \u0026quot;temp\u0026quot;: 10, \u0026quot;signal\u0026quot;: 24, \u0026quot;battery_level\u0026quot;: 6, \u0026quot;c02_level\u0026quot;: 1423, \u0026quot;timestamp\u0026quot; :1475600530 }\u0026quot;}\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;id\u0026rdquo;:17,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 17, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-ipad\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;64.124.180.215\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;USA\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;United States\u0026quot;, \u0026quot;temp\u0026quot;: 38, \u0026quot;signal\u0026quot;: 17, \u0026quot;battery_level\u0026quot;: 9, \u0026quot;c02_level\u0026quot;: 1304, \u0026quot;timestamp\u0026quot; :1475600532 }\u0026quot;}\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;id\u0026rdquo;:18,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 18, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-igauge\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;66.153.162.66\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;USA\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;United States\u0026quot;, \u0026quot;temp\u0026quot;: 26, \u0026quot;signal\u0026quot;: 10, \u0026quot;battery_level\u0026quot;: 0, \u0026quot;c02_level\u0026quot;: 902, \u0026quot;timestamp\u0026quot; :1475600534 }\u0026quot;}\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;id\u0026rdquo;:19,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 19, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-ipad\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;193.200.142.254\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;AUT\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;Austria\u0026quot;, \u0026quot;temp\u0026quot;: 32, \u0026quot;signal\u0026quot;: 27, \u0026quot;battery_level\u0026quot;: 5, \u0026quot;c02_level\u0026quot;: 1282, \u0026quot;timestamp\u0026quot; :1475600536 }\u0026quot;}\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e假设你有一个在指定端口运行的 Kafka 集群和相应的主题，让我们写一下 Kafka 主题。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003estringJsonDF\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewrite\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eformat\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;kafka\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoption\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;kafka.bootstrap.servers\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;your_host_name:9092\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoption\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;topic\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;iot-devices\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esave\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eorg\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eapache\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003espark\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esql\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nc\"\u003eAnalysisException\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eRequired\u003c/span\u003e \u003cspan class=\"kt\"\u003eattribute\u003c/span\u003e \u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"kt\"\u003evalue\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e \u003cspan class=\"kt\"\u003enot\u003c/span\u003e \u003cspan class=\"kt\"\u003efound\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"如何使用-selectexpr\"\u003e如何使用 selectExpr()\u003c/h2\u003e\n\u003cp\u003e将列转换或编码为 JSON 对象作为字符串的另一种方法是使用 \u003ccode\u003eselectExpr()\u003c/code\u003e 实用程序函数。例如，我可以将 DataFrame 的 “device” 列从上面转换为 JSON 字符串\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003estringsDF\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eeventsDS\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eselectExpr\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;CAST(id AS INT)\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;CAST(device AS STRING)\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003estringsDF\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eorg.apache.spark.sql.DataFrame\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eid:\u003c/span\u003e \u003cspan class=\"kt\"\u003eint\u003c/span\u003e, \u003cspan class=\"kt\"\u003edevice:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003estringsDF.printSchema\nroot\n |-- id: integer (nullable = false)\n |-- device: string (nullable = true)\n\u003c/code\u003e\u003c/pre\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003edisplay(stringsDF)\n\u003c/code\u003e\u003c/pre\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003eid\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003edevice\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e0\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 0, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;68.161.225.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 25, \u0026ldquo;signal\u0026rdquo;: 23, \u0026ldquo;battery_level\u0026rdquo;: 8, \u0026ldquo;c02_level\u0026rdquo;: 917, \u0026ldquo;timestamp\u0026rdquo; :1475600496 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e1\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 1, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-igauge\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;213.161.254.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;NOR\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Norway\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 30, \u0026ldquo;signal\u0026rdquo;: 18, \u0026ldquo;battery_level\u0026rdquo;: 6, \u0026ldquo;c02_level\u0026rdquo;: 1413, \u0026ldquo;timestamp\u0026rdquo; :1475600498 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e2\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 2, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;88.36.5.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;ITA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Italy\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 18, \u0026ldquo;signal\u0026rdquo;: 25, \u0026ldquo;battery_level\u0026rdquo;: 5, \u0026ldquo;c02_level\u0026rdquo;: 1372, \u0026ldquo;timestamp\u0026rdquo; :1475600500 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e3\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 3, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-inest\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;66.39.173.154\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 47, \u0026ldquo;signal\u0026rdquo;: 12, \u0026ldquo;battery_level\u0026rdquo;: 1, \u0026ldquo;c02_level\u0026rdquo;: 1447, \u0026ldquo;timestamp\u0026rdquo; :1475600502 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e4\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 4, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;203.82.41.9\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;PHL\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Philippines\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 29, \u0026ldquo;signal\u0026rdquo;: 11, \u0026ldquo;battery_level\u0026rdquo;: 0, \u0026ldquo;c02_level\u0026rdquo;: 983, \u0026ldquo;timestamp\u0026rdquo; :1475600504 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e5\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 5, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-istick\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;204.116.105.67\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 50, \u0026ldquo;signal\u0026rdquo;: 16, \u0026ldquo;battery_level\u0026rdquo;: 8, \u0026ldquo;c02_level\u0026rdquo;: 1574, \u0026ldquo;timestamp\u0026rdquo; :1475600506 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e6\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 6, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;220.173.179.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;CHN\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;China\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 21, \u0026ldquo;signal\u0026rdquo;: 18, \u0026ldquo;battery_level\u0026rdquo;: 9, \u0026ldquo;c02_level\u0026rdquo;: 1249, \u0026ldquo;timestamp\u0026rdquo; :1475600508 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e7\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 7, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;118.23.68.227\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;JPN\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Japan\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 27, \u0026ldquo;signal\u0026rdquo;: 15, \u0026ldquo;battery_level\u0026rdquo;: 0, \u0026ldquo;c02_level\u0026rdquo;: 1531, \u0026ldquo;timestamp\u0026rdquo; :1475600512 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e8\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 8, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-inest\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;208.109.163.218\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 40, \u0026ldquo;signal\u0026rdquo;: 16, \u0026ldquo;battery_level\u0026rdquo;: 9, \u0026ldquo;c02_level\u0026rdquo;: 1208, \u0026ldquo;timestamp\u0026rdquo; :1475600514 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e9\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 9, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;88.213.191.34\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;ITA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Italy\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 19, \u0026ldquo;signal\u0026rdquo;: 11, \u0026ldquo;battery_level\u0026rdquo;: 0, \u0026ldquo;c02_level\u0026rdquo;: 1171, \u0026ldquo;timestamp\u0026rdquo; :1475600516 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e10\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 10, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-igauge\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;68.28.91.22\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 32, \u0026ldquo;signal\u0026rdquo;: 26, \u0026ldquo;battery_level\u0026rdquo;: 7, \u0026ldquo;c02_level\u0026rdquo;: 886, \u0026ldquo;timestamp\u0026rdquo; :1475600518 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e11\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 11, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;59.144.114.250\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;IND\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;India\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 46, \u0026ldquo;signal\u0026rdquo;: 25, \u0026ldquo;battery_level\u0026rdquo;: 4, \u0026ldquo;c02_level\u0026rdquo;: 863, \u0026ldquo;timestamp\u0026rdquo; :1475600520 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e12\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 12, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-igauge\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;193.156.90.200\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;NOR\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Norway\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 18, \u0026ldquo;signal\u0026rdquo;: 26, \u0026ldquo;battery_level\u0026rdquo;: 8, \u0026ldquo;c02_level\u0026rdquo;: 1220, \u0026ldquo;timestamp\u0026rdquo; :1475600522 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e13\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 13, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;67.185.72.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 34, \u0026ldquo;signal\u0026rdquo;: 20, \u0026ldquo;battery_level\u0026rdquo;: 8, \u0026ldquo;c02_level\u0026rdquo;: 1504, \u0026ldquo;timestamp\u0026rdquo; :1475600524 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e14\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 14, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-inest\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;68.85.85.106\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 39, \u0026ldquo;signal\u0026rdquo;: 17, \u0026ldquo;battery_level\u0026rdquo;: 8, \u0026ldquo;c02_level\u0026rdquo;: 831, \u0026ldquo;timestamp\u0026rdquo; :1475600526 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e15\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 15, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;161.188.212.254\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 27, \u0026ldquo;signal\u0026rdquo;: 26, \u0026ldquo;battery_level\u0026rdquo;: 5, \u0026ldquo;c02_level\u0026rdquo;: 1378, \u0026ldquo;timestamp\u0026rdquo; :1475600528 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e16\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 16, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-igauge\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;221.3.128.242\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;CHN\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;China\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 10, \u0026ldquo;signal\u0026rdquo;: 24, \u0026ldquo;battery_level\u0026rdquo;: 6, \u0026ldquo;c02_level\u0026rdquo;: 1423, \u0026ldquo;timestamp\u0026rdquo; :1475600530 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e17\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 17, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;64.124.180.215\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 38, \u0026ldquo;signal\u0026rdquo;: 17, \u0026ldquo;battery_level\u0026rdquo;: 9, \u0026ldquo;c02_level\u0026rdquo;: 1304, \u0026ldquo;timestamp\u0026rdquo; :1475600532 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e18\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 18, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-igauge\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;66.153.162.66\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 26, \u0026ldquo;signal\u0026rdquo;: 10, \u0026ldquo;battery_level\u0026rdquo;: 0, \u0026ldquo;c02_level\u0026rdquo;: 902, \u0026ldquo;timestamp\u0026rdquo; :1475600534 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e19\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;: 19, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;193.200.142.254\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;AUT\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Austria\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 32, \u0026ldquo;signal\u0026rdquo;: 27, \u0026ldquo;battery_level\u0026rdquo;: 5, \u0026ldquo;c02_level\u0026rdquo;: 1282, \u0026ldquo;timestamp\u0026rdquo; :1475600536 }\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003ccode\u003eselectExpr()\u003c/code\u003e 的另一个用途是它的功能，正如函数名所示，它将表达式作为参数并将它们转换为相应的列。例如，假设我想表达c02水平和温度比。\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003edisplay(devicesDF.selectExpr(\u0026#34;c02_level\u0026#34;, \u0026#34;round(c02_level/temp) as ratio_c02_temperature\u0026#34;).orderBy($\u0026#34;ratio_c02_temperature\u0026#34; desc))\n\u003c/code\u003e\u003c/pre\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003ec02_level\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003eratio_c02_temperature\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e1372\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e76\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e1220\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e68\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e1249\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e59\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e1378\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e51\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e1413\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e47\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e1504\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e44\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e1282\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e40\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e917\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e37\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e1304\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e34\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e1574\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e31\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e1208\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e30\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e886\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e28\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e831\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e21\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e863\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e19\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e上述查询可以像在 DataFrame API 中一样在 Spark SQL 中轻松表达。 \u003ccode\u003eselectExpr()\u003c/code\u003e 的强大之处在于处理或处理数值。让我们尝试创建一个临时视图并表达相同的查询，除了这次我们使用 SQL。\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003edevicesDF.createOrReplaceTempView(\u0026#34;devicesDFT\u0026#34;)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e请注意，\u003cstrong\u003ecmd 42\u003c/strong\u003e 的输出与 \u003cstrong\u003ecmd\u003c/strong\u003e 38 没有区别。两者都使用相同的 Spark SQL 引擎的 Catalyst 并生成等效的底层紧凑代码。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-sql\" data-lang=\"sql\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e%\u003c/span\u003e\u003cspan class=\"k\"\u003esql\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eselect\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003ec02_level\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\u003cspan class=\"w\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"n\"\u003eround\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ec02_level\u003c/span\u003e\u003cspan class=\"o\"\u003e/\u003c/span\u003e\u003cspan class=\"n\"\u003etemp\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eas\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eratio_c02_temperature\u003c/span\u003e\u003cspan class=\"w\"\u003e \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"k\"\u003efrom\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003edevicesDFT\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"w\"\u003e        \u003c/span\u003e\u003cspan class=\"k\"\u003eorder\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003eby\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"n\"\u003eratio_c02_temperature\u003c/span\u003e\u003cspan class=\"w\"\u003e \u003c/span\u003e\u003cspan class=\"k\"\u003edesc\u003c/span\u003e\u003cspan class=\"w\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003ec02_level\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003eratio_c02_temperature\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e1372\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e76\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e1220\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e68\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e1249\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e59\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e1378\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e51\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e1413\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e47\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e1504\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e44\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e1282\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e40\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e917\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e37\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e1304\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e34\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e1574\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e31\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e1208\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e30\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e886\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e28\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e831\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e21\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e863\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e19\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cblockquote\u003e\n\u003cp\u003e要验证所有字符串转换是否保留在上面的 DataFrame \u003ccode\u003estringJsonDF\u003c/code\u003e 中，让我们将其保存为 blob 存储为 Parquet。\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003estringJsonDF\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewrite\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003emode\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;overwrite\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eformat\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;parquet\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esave\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;/tmp/iot\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e检查是否所有文件都已写入。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-shell\" data-lang=\"shell\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e%fs ls /tmp/iot\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003epath\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003ename\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003esize\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003edbfs:/tmp/iot/_SUCCESS\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e_SUCCESS\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e0\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003edbfs:/tmp/iot/part-00000-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,part-00000-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,1567\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003edbfs:/tmp/iot/part-00001-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,part-00001-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,1598\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003edbfs:/tmp/iot/part-00002-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,part-00002-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,1576\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003edbfs:/tmp/iot/part-00003-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,part-00003-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,1602\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003edbfs:/tmp/iot/part-00004-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,part-00004-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,1574\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003edbfs:/tmp/iot/part-00005-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,part-00005-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,1618\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003edbfs:/tmp/iot/part-00006-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,part-00006-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,1589\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003edbfs:/tmp/iot/part-00007-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,part-00007-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,1624\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003ctd\u003e\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e现在让我们验证保存设备是什么，因为从上面编码的每个字符串都是实际的字符串。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003eparquetDF\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003espark\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eread\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eparquet\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;/tmp/iot\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eparquetDF\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eorg.apache.spark.sql.DataFrame\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003edevices:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e让我们检查一下模式，以确保所写的内容与读取的内容没有什么不同，即JSON字符串。\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eparquetDF.printSchema\nroot\n |-- devices: string (nullable = true)\n\u003c/code\u003e\u003c/pre\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003edevices\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:17,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 17, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-ipad\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;64.124.180.215\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;USA\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;United States\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 38, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 17, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 9, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1304, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600532 }\u0026quot;\u0026quot;}\u0026quot;\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:18,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 18, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-igauge\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;66.153.162.66\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;USA\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;United States\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 26, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 10, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 0, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 902, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600534 }\u0026quot;\u0026quot;}\u0026quot;\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:19,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 19, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-ipad\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;193.200.142.254\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;AUT\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;Austria\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 32, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 27, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 5, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1282, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600536 }\u0026quot;\u0026quot;}\u0026quot;\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:12,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 12, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-igauge\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;193.156.90.200\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;NOR\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;Norway\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 18, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 26, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 8, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1220, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600522 }\u0026quot;\u0026quot;}\u0026quot;\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:13,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 13, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-ipad\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;67.185.72.1\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;USA\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;United States\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 34, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 20, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 8, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1504, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600524 }\u0026quot;\u0026quot;}\u0026quot;\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:14,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 14, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-inest\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;68.85.85.106\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;USA\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;United States\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 39, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 17, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 8, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 831, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600526 }\u0026quot;\u0026quot;}\u0026quot;\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:7,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 7, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-ipad\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;118.23.68.227\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;JPN\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;Japan\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 27, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 15, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 0, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1531, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600512 }\u0026quot;\u0026quot;}\u0026quot;\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:8,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo; {\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 8, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-inest\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;208.109.163.218\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;USA\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;United States\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 40, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 16, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 9, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1208, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600514 }\u0026quot;\u0026quot;}\u0026quot;\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:9,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 9, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-ipad\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;88.213.191.34\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;ITA\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;Italy\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 19, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 11, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 0, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1171, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600516 }\u0026quot;\u0026quot;}\u0026quot;\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:2,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 2, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-ipad\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;88.36.5.1\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;ITA\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;Italy\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 18, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 25, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 5, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1372, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600500 }\u0026quot;\u0026quot;}\u0026quot;\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:3,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 3, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-inest\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;66.39.173.154\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;USA\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;United States\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 47, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 12, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 1, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1447, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600502 }\u0026quot;\u0026quot;}\u0026quot;\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:4,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 4, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-ipad\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;203.82.41.9\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;PHL\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;Philippines\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 29, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 11, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 0, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 983, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600504 }\u0026quot;\u0026quot;}\u0026quot;\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:15,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 15, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-ipad\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;161.188.212.254\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;USA\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;United States\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 27, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 26, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 5, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1378, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600528 }\u0026quot;\u0026quot;}\u0026quot;\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:16,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 16, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-igauge\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;221.3.128.242\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;CHN\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;China\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 10, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 24, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 6, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1423, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600530 }\u0026quot;\u0026quot;}\u0026quot;\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:5,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 5, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-istick\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;204.116.105.67\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;USA\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;United States\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 50, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 16, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 8, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1574, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600506 }\u0026quot;\u0026quot;}\u0026quot;\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:6,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 6, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-ipad\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;220.173.179.1\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;CHN\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;China\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 21, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 18, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 9, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1249, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600508 }\u0026quot;\u0026quot;}\u0026quot;\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:10,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 10, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-igauge\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;68.28.91.22\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;USA\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;United States\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 32, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 26, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 7, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 886, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600518 }\u0026quot;\u0026quot;}\u0026quot;\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:11,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 11, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-ipad\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;59.144.114.250\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;IND\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;India\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 46, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 25, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 4, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 863, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600520 }\u0026quot;\u0026quot;}\u0026quot;\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:0,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 0, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-ipad\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;68.161.225.1\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;USA\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;United States\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 25, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 23, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 8, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 917, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600496 }\u0026quot;\u0026quot;}\u0026quot;\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:1,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 1, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-igauge\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;213.161.254.1\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;NOR\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;Norway\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 30, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 18, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 6, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1413, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600498 }\u0026quot;\u0026quot;}\u0026quot;\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e到目前为止，本教程已探索了使用 \u003ccode\u003eget_json_object()\u003c/code\u003e，\u003ccode\u003efrom_json()\u003c/code\u003e，\u003ccode\u003eto_json()\u003c/code\u003e，\u003ccode\u003eselectExpr()\u003c/code\u003e 和 \u003ccode\u003eexplode()\u003c/code\u003e 辅助函数处理不太复杂的 JSON 对象的方法。\u003c/p\u003e\n\u003cp\u003e让我们将焦点转向更嵌套的结构，并检查应用于复杂 JSON 的这些相同 API 如何简单。\u003c/p\u003e\n\u003ch2 id=\"嵌套结构\"\u003e嵌套结构\u003c/h2\u003e\n\u003cp\u003e假设您的 JSON 嵌套结构可能包含 Maps 以及嵌套 JSON，这并不是不合理的。为了说明，我们使用由复杂和嵌套数据类型组成的单个字符串，包括 Map。在现实生活中，这可能是设备事件的读数，具有危险的二氧化碳排放水平或高温读数，需要网络运营中心（NOC）通知某些立即行动。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eorg.apache.spark.sql.types._\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003eschema\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructType\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;dc_id\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e                               \u003cspan class=\"c1\"\u003e// data center where data was posted to Kafka cluster\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e  \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;source\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e                                          \u003cspan class=\"c1\"\u003e// info about the source of alarm\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \u003cspan class=\"nc\"\u003eMapType\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e                                              \u003cspan class=\"c1\"\u003e// define this as a Map(Key-\u0026gt;value)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e      \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructType\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;description\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;ip\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eLongType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;temp\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eLongType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;c02_level\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eLongType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;geo\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e         \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructType\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;lat\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eDoubleType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;long\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eDoubleType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eorg.apache.spark.sql.types._\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eschema\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eorg.apache.spark.sql.\u003c/span\u003e\u003cspan class=\"k\"\u003etype\u003c/span\u003e\u003cspan class=\"kt\"\u003es.StructType\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructType\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edc_id\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esource\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eMapType\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStructType\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edescription\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eip\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eLongType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etemp\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eLongType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ec02_level\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eLongType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003egeo\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStructType\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elat\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eDoubleType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elong\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eDoubleType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e)),\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e)),\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e让我们创建一个复杂数据类型的复杂 JSON。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e//create a single entry with id and its complex and nested data types\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003edataDS\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"nc\"\u003eSeq\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e{\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e\u0026#34;dc_id\u0026#34;: \u0026#34;dc-101\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e\u0026#34;source\u0026#34;: {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    \u0026#34;sensor-igauge\u0026#34;: {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026#34;id\u0026#34;: 10,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026#34;ip\u0026#34;: \u0026#34;68.28.91.22\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026#34;description\u0026#34;: \u0026#34;Sensor attached to the container ceilings\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026#34;temp\u0026#34;:35,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026#34;c02_level\u0026#34;: 1475,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026#34;geo\u0026#34;: {\u0026#34;lat\u0026#34;:38.00, \u0026#34;long\u0026#34;:97.00}                        \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    },\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    \u0026#34;sensor-ipad\u0026#34;: {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026#34;id\u0026#34;: 13,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026#34;ip\u0026#34;: \u0026#34;67.185.72.1\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026#34;description\u0026#34;: \u0026#34;Sensor ipad attached to carbon cylinders\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026#34;temp\u0026#34;: 34,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026#34;c02_level\u0026#34;: 1370,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026#34;geo\u0026#34;: {\u0026#34;lat\u0026#34;:47.41, \u0026#34;long\u0026#34;:-122.00}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    },\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    \u0026#34;sensor-inest\u0026#34;: {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026#34;id\u0026#34;: 8,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026#34;ip\u0026#34;: \u0026#34;208.109.163.218\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026#34;description\u0026#34;: \u0026#34;Sensor attached to the factory ceilings\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026#34;temp\u0026#34;: 40,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026#34;c02_level\u0026#34;: 1346,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026#34;geo\u0026#34;: {\u0026#34;lat\u0026#34;:33.61, \u0026#34;long\u0026#34;:-111.89}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    },\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    \u0026#34;sensor-istick\u0026#34;: {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026#34;id\u0026#34;: 5,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026#34;ip\u0026#34;: \u0026#34;204.116.105.67\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026#34;description\u0026#34;: \u0026#34;Sensor embedded in exhaust pipes in the ceilings\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026#34;temp\u0026#34;: 40,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026#34;c02_level\u0026#34;: 1574,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e      \u0026#34;geo\u0026#34;: {\u0026#34;lat\u0026#34;:35.93, \u0026#34;long\u0026#34;:-85.46}\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    }\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e  }\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e}\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003etoDS\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// should only be one item\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003edataDS\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ecount\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003edataDS\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eorg.apache.spark.sql.Dataset\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003evalue:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eres15\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-json\" data-lang=\"json\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026#34;dc_id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;dc-101\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nt\"\u003e\u0026#34;source\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026#34;sensor-igauge\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e10\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026#34;ip\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;68.28.91.22\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026#34;description\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Sensor attached to the container ceilings\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026#34;temp\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mi\"\u003e35\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026#34;c02_level\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1475\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026#34;geo\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026#34;lat\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mf\"\u003e38.00\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nt\"\u003e\u0026#34;long\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mf\"\u003e97.00\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e                        \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026#34;sensor-ipad\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e13\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026#34;ip\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;67.185.72.1\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026#34;description\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Sensor ipad attached to carbon cylinders\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026#34;temp\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e34\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026#34;c02_level\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1370\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026#34;geo\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026#34;lat\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mf\"\u003e47.41\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nt\"\u003e\u0026#34;long\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mf\"\u003e-122.00\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026#34;sensor-inest\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e8\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026#34;ip\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;208.109.163.218\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026#34;description\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Sensor attached to the factory ceilings\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026#34;temp\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e40\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026#34;c02_level\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1346\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026#34;geo\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026#34;lat\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mf\"\u003e33.61\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nt\"\u003e\u0026#34;long\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mf\"\u003e-111.89\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e},\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nt\"\u003e\u0026#34;sensor-istick\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e5\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026#34;ip\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;204.116.105.67\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026#34;description\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"s2\"\u003e\u0026#34;Sensor embedded in exhaust pipes in the ceilings\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026#34;temp\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e40\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026#34;c02_level\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"mi\"\u003e1574\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"nt\"\u003e\u0026#34;geo\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"nt\"\u003e\u0026#34;lat\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mf\"\u003e35.93\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nt\"\u003e\u0026#34;long\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e:\u003c/span\u003e\u003cspan class=\"mf\"\u003e-85.46\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e我们来处理吧。请注意，我们有嵌套结构 \u003ccode\u003egeo\u003c/code\u003e。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003edf\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003espark\u003c/span\u003e                  \u003cspan class=\"c1\"\u003e// spark session \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eread\u003c/span\u003e                           \u003cspan class=\"c1\"\u003e// get DataFrameReader\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eschema\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eschema\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e                 \u003cspan class=\"c1\"\u003e// use the defined schema above and read format as JSON\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ejson\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edataDS\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erdd\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e               \u003cspan class=\"c1\"\u003e// RDD[String]\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003edf\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eorg.apache.spark.sql.DataFrame\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003edc_id:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e, \u003cspan class=\"kt\"\u003esource:\u003c/span\u003e \u003cspan class=\"kt\"\u003emap\u0026lt;string\u003c/span\u003e,\u003cspan class=\"kt\"\u003estruct\u0026lt;description:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003eip:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003eid:bigint\u003c/span\u003e,\u003cspan class=\"kt\"\u003etemp:bigint\u003c/span\u003e,\u003cspan class=\"kt\"\u003ec02_level:bigint\u003c/span\u003e,\u003cspan class=\"kt\"\u003egeo:struct\u0026lt;lat:double\u003c/span\u003e,\u003cspan class=\"kt\"\u003elong:double\u0026gt;\u0026gt;\u0026gt;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e我们来看看它的嵌套和复杂 schema。\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003edf.printSchema\nroot\n |-- dc_id: string (nullable = true)\n |-- source: map (nullable = true)\n |    |-- key: string\n |    |-- value: struct (valueContainsNull = true)\n |    |    |-- description: string (nullable = true)\n |    |    |-- ip: string (nullable = true)\n |    |    |-- id: long (nullable = true)\n |    |    |-- temp: long (nullable = true)\n |    |    |-- c02_level: long (nullable = true)\n |    |    |-- geo: struct (nullable = true)\n |    |    |    |-- lat: double (nullable = true)\n |    |    |    |-- long: double (nullable = true)\n\u003c/code\u003e\u003c/pre\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003edc_id, source\ndc-101,{\u0026#34;sensor-igauge\u0026#34;:{\u0026#34;description\u0026#34;:\u0026#34;Sensor attached to the container ceilings\u0026#34;,\u0026#34;ip\u0026#34;:\u0026#34;68.28.91.22\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;10\u0026#34;,\u0026#34;temp\u0026#34;:\u0026#34;35\u0026#34;,\u0026#34;c02_level\u0026#34;:\u0026#34;1475\u0026#34;,\u0026#34;geo\u0026#34;:{\u0026#34;lat\u0026#34;:38,\u0026#34;long\u0026#34;:97}},\u0026#34;sensor-ipad\u0026#34;:{\u0026#34;description\u0026#34;:\u0026#34;Sensor ipad attached to carbon cylinders\u0026#34;,\u0026#34;ip\u0026#34;:\u0026#34;67.185.72.1\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;13\u0026#34;,\u0026#34;temp\u0026#34;:\u0026#34;34\u0026#34;,\u0026#34;c02_level\u0026#34;:\u0026#34;1370\u0026#34;,\u0026#34;geo\u0026#34;:{\u0026#34;lat\u0026#34;:47.41,\u0026#34;long\u0026#34;:-122}},\u0026#34;sensor-inest\u0026#34;:{\u0026#34;description\u0026#34;:\u0026#34;Sensor attached to the factory ceilings\u0026#34;,\u0026#34;ip\u0026#34;:\u0026#34;208.109.163.218\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;8\u0026#34;,\u0026#34;temp\u0026#34;:\u0026#34;40\u0026#34;,\u0026#34;c02_level\u0026#34;:\u0026#34;1346\u0026#34;,\u0026#34;geo\u0026#34;:{\u0026#34;lat\u0026#34;:33.61,\u0026#34;long\u0026#34;:-111.89}},\u0026#34;sensor-istick\u0026#34;:{\u0026#34;description\u0026#34;:\u0026#34;Sensor embedded in exhaust pipes in the ceilings\u0026#34;,\u0026#34;ip\u0026#34;:\u0026#34;204.116.105.67\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;5\u0026#34;,\u0026#34;temp\u0026#34;:\u0026#34;40\u0026#34;,\u0026#34;c02_level\u0026#34;:\u0026#34;1574\u0026#34;,\u0026#34;geo\u0026#34;:{\u0026#34;lat\u0026#34;:35.93,\u0026#34;long\u0026#34;:-85.46}}}\n\u003c/code\u003e\u003c/pre\u003e\u003ch2 id=\"如何使用-explode\"\u003e如何使用 explode()\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003eexplode()\u003c/code\u003e 函数用于显示如何提取嵌套结构。另外，当我们从复杂的 JSON 结构中提取属性和值时，我们看到它与 \u003ccode\u003eto_json()\u003c/code\u003e 和 \u003ccode\u003efrom_json()\u003c/code\u003e 函数一起工作时会有更多的亮点。所以偶尔，你会想要使用 \u003ccode\u003eexplode()\u003c/code\u003e，以及 \u003ccode\u003eto_json()\u003c/code\u003e 和 \u003ccode\u003efrom_json()\u003c/code\u003e 函数。这是我们做的一个案例。\n\u003ccode\u003eexplode()\u003c/code\u003e 函数为给定 map 列中的每个元素创建一个新行。在这种情况下，map 列是 \u003ccode\u003esource\u003c/code\u003e。请注意，对于 map 中的每个键值，您都有一个相应的行，在本例中为四个。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// select from DataFrame with a single entry, and explode its column source, which is Map, with nested structure.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003eexplodedDF\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003edf\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eselect\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;dc_id\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eexplode\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;source\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003edisplay\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eexplodedDF\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003edc_id\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003ekey\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003evalue\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003edc-101\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003esensor-igauge\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;description\u0026rdquo;:\u0026ldquo;Sensor attached to the container ceilings\u0026rdquo;,\u0026ldquo;ip\u0026rdquo;:\u0026ldquo;68.28.91.22\u0026rdquo;,\u0026ldquo;id\u0026rdquo;:\u0026ldquo;10\u0026rdquo;,\u0026ldquo;temp\u0026rdquo;:\u0026ldquo;35\u0026rdquo;,\u0026ldquo;c02_level\u0026rdquo;:\u0026ldquo;1475\u0026rdquo;,\u0026ldquo;geo\u0026rdquo;:{\u0026ldquo;lat\u0026rdquo;:38,\u0026ldquo;long\u0026rdquo;:97}}\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003edc-101\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003esensor-ipad\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;description\u0026rdquo;:\u0026ldquo;Sensor ipad attached to carbon cylinders\u0026rdquo;,\u0026ldquo;ip\u0026rdquo;:\u0026ldquo;67.185.72.1\u0026rdquo;,\u0026ldquo;id\u0026rdquo;:\u0026ldquo;13\u0026rdquo;,\u0026ldquo;temp\u0026rdquo;:\u0026ldquo;34\u0026rdquo;,\u0026ldquo;c02_level\u0026rdquo;:\u0026ldquo;1370\u0026rdquo;,\u0026ldquo;geo\u0026rdquo;:{\u0026ldquo;lat\u0026rdquo;:47.41,\u0026ldquo;long\u0026rdquo;:-122}}\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003edc-101\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003esensor-inest\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;description\u0026rdquo;:\u0026ldquo;Sensor attached to the factory ceilings\u0026rdquo;,\u0026ldquo;ip\u0026rdquo;:\u0026ldquo;208.109.163.218\u0026rdquo;,\u0026ldquo;id\u0026rdquo;:\u0026ldquo;8\u0026rdquo;,\u0026ldquo;temp\u0026rdquo;:\u0026ldquo;40\u0026rdquo;,\u0026ldquo;c02_level\u0026rdquo;:\u0026ldquo;1346\u0026rdquo;,\u0026ldquo;geo\u0026rdquo;:{\u0026ldquo;lat\u0026rdquo;:33.61,\u0026ldquo;long\u0026rdquo;:-111.89}}\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003edc-101\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003esensor-istick\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;description\u0026rdquo;:\u0026ldquo;Sensor embedded in exhaust pipes in the ceilings\u0026rdquo;,\u0026ldquo;ip\u0026rdquo;:\u0026ldquo;204.116.105.67\u0026rdquo;,\u0026ldquo;id\u0026rdquo;:\u0026ldquo;5\u0026rdquo;,\u0026ldquo;temp\u0026rdquo;:\u0026ldquo;40\u0026rdquo;,\u0026ldquo;c02_level\u0026rdquo;:\u0026ldquo;1574\u0026rdquo;,\u0026ldquo;geo\u0026rdquo;:{\u0026ldquo;lat\u0026rdquo;:35.93,\u0026ldquo;long\u0026rdquo;:-85.46}}\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e查看架构时，请注意现在已扩展 \u003ccode\u003esource\u003c/code\u003e。\u003c/p\u003e\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eexplodedDF.printSchema\nroot\n |-- dc_id: string (nullable = true)\n |-- key: string (nullable = false)\n |-- value: struct (nullable = true)\n |    |-- description: string (nullable = true)\n |    |-- ip: string (nullable = true)\n |    |-- id: long (nullable = true)\n |    |-- temp: long (nullable = true)\n |    |-- c02_level: long (nullable = true)\n |    |-- geo: struct (nullable = true)\n |    |    |-- lat: double (nullable = true)\n |    |    |-- long: double (nullable = true)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e与复杂数据类型聚合的单个字符串，包括 Map。这可能是需要网络运营中心（NOC）注意行动的记录，因为温度和二氧化碳水平都是惊人的。\u003c/p\u003e\n\u003cp\u003e让我们使用 Map 访问我们的爆炸数据中的数据。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e//case class to denote our desired Scala object\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDeviceAlert\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edcId\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edeviceType\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e\u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003eip\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e\u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edeviceId\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e\u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003etemp\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e\u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ec02_level\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eLong\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elat\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003elon\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDouble\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e//access all values using getItem() method on value, by providing the \u0026#34;key,\u0026#34; which is attribute in our JSON object.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003enotifydevicesDS\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eexplodedDF\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eselect\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e \u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;dc_id\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003eas\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;dcId\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                        \u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;key\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003eas\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;deviceType\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                        \u0026#39;value\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;ip\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eas\u003c/span\u003e \u0026#39;ip\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                        \u0026#39;value\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eas\u003c/span\u003e \u0026#39;deviceId\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                        \u0026#39;value\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;c02_level\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eas\u003c/span\u003e \u0026#39;c02_level\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                        \u0026#39;value\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;temp\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eas\u003c/span\u003e \u0026#39;temp\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                        \u0026#39;value\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;geo\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;lat\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eas\u003c/span\u003e \u0026#39;lat\u003cspan class=\"o\"\u003e,\u003c/span\u003e                \u003cspan class=\"c1\"\u003e//note embedded level requires yet another level of fetching.\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e                        \u0026#39;value\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;geo\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;long\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e \u003cspan class=\"n\"\u003eas\u003c/span\u003e \u0026#39;lon\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                        \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eas\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eDeviceAlert\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e  \u003cspan class=\"c1\"\u003e// return as a Dataset\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"n\"\u003edefined\u003c/span\u003e \u003cspan class=\"k\"\u003eclass\u003c/span\u003e \u003cspan class=\"nc\"\u003eDeviceAlert\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003enotifydevicesDS\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eorg.apache.spark.sql.Dataset\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eDeviceAlert\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003edcId:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e, \u003cspan class=\"kt\"\u003edeviceType:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"kt\"\u003e...\u003c/span\u003e \u003cspan class=\"err\"\u003e6\u003c/span\u003e \u003cspan class=\"kt\"\u003emore\u003c/span\u003e \u003cspan class=\"kt\"\u003efields\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003enotifydevicesDS.printSchema\nroot\n |-- dcId: string (nullable = true)\n |-- deviceType: string (nullable = false)\n |-- ip: string (nullable = true)\n |-- deviceId: long (nullable = true)\n |-- c02_level: long (nullable = true)\n |-- temp: long (nullable = true)\n |-- lat: double (nullable = true)\n |-- lon: double (nullable = true)\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e假设作为 ETL 的一部分，您需要根据某些警报条件通知或发送警报。一种方法是在迭代过滤数据集上编写用户功能并发送单独的通知。在其他情况下，您可以将消息作为附加选项发送到 Kafka 主题。\n将嵌套的 JSON 分解为简单的 case 类之后，我们就可以向 NOC 发送警报以进行操作。在这方面是使用 \u003ccode\u003eforeach()\u003c/code\u003e DataFrame方法。但要做到这一点，我们需要一个高级功能;给定一个 case 类，它可以提取其警报属性来发出警报。虽然这个简单的示例写入 stdout，但在实际场景中，您需要通过 SNMP 或 HTTP POST 或某些 API 向 PagerAlert 发送警报。\u003c/p\u003e\n\u003ch2 id=\"警报通知功能\"\u003e警报通知功能\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// define a Scala Notification Object\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eobject\u003c/span\u003e \u003cspan class=\"nc\"\u003eDeviceNOCAlerts\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"n\"\u003esendTwilio\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eUnit\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e//TODO: fill as necessary\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \u003cspan class=\"n\"\u003eprintln\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;Twilio:\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"n\"\u003esendSNMP\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eUnit\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e//TODO: fill as necessary\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e    \u003cspan class=\"n\"\u003eprintln\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;SNMP:\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"n\"\u003esendKafka\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eUnit\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"c1\"\u003e//TODO: fill as necessary\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e     \u003cspan class=\"n\"\u003eprintln\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;KAFKA:\u0026#34;\u003c/span\u003e \u003cspan class=\"o\"\u003e+\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003edef\u003c/span\u003e \u003cspan class=\"n\"\u003elogAlerts\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elog\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003ejava.io.PrintStream\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nc\"\u003eConsole\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eout\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edeviceAlert\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDeviceAlert\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ealert\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enotify\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eString\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;twilio\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eUnit\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003emessage\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;[***ALERT***: %s; data_center: %s, device_name: %s, temperature: %d; device_id: %d ; ip: %s ; c02: %d]\u0026#34;\u003c/span\u003e \u003cspan class=\"n\"\u003eformat\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ealert\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edeviceAlert\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edcId\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edeviceAlert\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeviceType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"n\"\u003edeviceAlert\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003etemp\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edeviceAlert\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003edeviceId\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edeviceAlert\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eip\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003edeviceAlert\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ec02_level\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e                                                                                                                                                                                                                                                            \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"c1\"\u003e//default log to Stderr/Stdout\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e  \u003cspan class=\"n\"\u003elog\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eprintln\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"c1\"\u003e// use an appropriate notification method\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e  \u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003enotifyFunc\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enotify\u003c/span\u003e \u003cspan class=\"k\"\u003ematch\u003c/span\u003e \u003cspan class=\"o\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;twilio\u0026#34;\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nc\"\u003eDeviceNOCAlerts\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esendTwilio\u003c/span\u003e \u003cspan class=\"k\"\u003e_\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;snmp\u0026#34;\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nc\"\u003eDeviceNOCAlerts\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esendSNMP\u003c/span\u003e \u003cspan class=\"k\"\u003e_\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"k\"\u003ecase\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;kafka\u0026#34;\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"nc\"\u003eDeviceNOCAlerts\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esendKafka\u003c/span\u003e \u003cspan class=\"k\"\u003e_\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"c1\"\u003e//send the appropriate alert\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e  \u003cspan class=\"n\"\u003enotifyFunc\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003emessage\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"o\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003edefined\u003c/span\u003e \u003cspan class=\"k\"\u003eobject\u003c/span\u003e \u003cspan class=\"nc\"\u003eDeviceNOCAlerts\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003elogAlerts\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"kt\"\u003elog:\u003c/span\u003e \u003cspan class=\"kt\"\u003ejava.io.PrintStream\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"kt\"\u003edeviceAlert:\u003c/span\u003e \u003cspan class=\"kt\"\u003eDeviceAlert\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ealert\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003enotify\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\u003cspan class=\"nc\"\u003eUnit\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"迭代警报设备并采取行动\"\u003e迭代警报设备并采取行动\u003c/h2\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003enotifydevicesDS\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eforeach\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ed\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"n\"\u003elogAlerts\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eConsole\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eerr\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"n\"\u003ed\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;ACTION NEED! HIGH TEPERATURE AND C02 LEVLES\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;kafka\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e要查看消息的记录位置，请转到“\u003cstrong\u003e集群\u003c/strong\u003e” - \u0026gt;“\u003cstrong\u003eSpark\u003c/strong\u003e” - \u0026gt;“\u003cstrong\u003e日志\u003c/strong\u003e”。\u003c/p\u003e\n\u003ch2 id=\"将警报作为-json-发送到-apache-kafka-主题\"\u003e将警报作为 JSON 发送到 Apache Kafka 主题\u003c/h2\u003e\n\u003cp\u003e如果您想将这些设备的警报写入 Kafka 主题，监视订阅者正在等待事件采取行动，该怎么办？\u003c/p\u003e\n\u003cp\u003e这是一个关于 Kafka 主题的 nofity 监听器的简单方法：“device_alerts”。要进一步阅读如何使用 Apache Kafka 详细介绍 Structured Streaming，请阅读我们关于 Structure Streaming 的博客系列的第3部分。\n注意：请参阅上面我们探讨的 \u003ccode\u003eselectExpr()\u003c/code\u003e 函数的另一种用法。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003edeviceAlertQuery\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enotifydevicesDS\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                       \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eselectExpr\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;CAST(dcId AS STRING) AS key\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;to_json(struct(*)) AS value\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                       \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ewriteStream\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                       \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eformat\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;kafka\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                       \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoption\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;kafka.bootstrap.servers\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;host1:port1,host2:port2\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                       \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eoption\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;toipic\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;device_alerts\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                       \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003estart\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                       \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eorg\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eapache\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003espark\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003esql\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"nc\"\u003eAnalysisException\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eUndefined\u003c/span\u003e \u003cspan class=\"kt\"\u003efunction:\u003c/span\u003e \u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"kt\"\u003eto_json\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"kt\"\u003e.\u003c/span\u003e \u003cspan class=\"kt\"\u003eThis\u003c/span\u003e \u003cspan class=\"kt\"\u003efunction\u003c/span\u003e \u003cspan class=\"kt\"\u003eis\u003c/span\u003e \u003cspan class=\"kt\"\u003eneither\u003c/span\u003e \u003cspan class=\"kt\"\u003ea\u003c/span\u003e \u003cspan class=\"kt\"\u003eregistered\u003c/span\u003e \u003cspan class=\"kt\"\u003etemporary\u003c/span\u003e \u003cspan class=\"kt\"\u003efunction\u003c/span\u003e \u003cspan class=\"kt\"\u003enor\u003c/span\u003e \u003cspan class=\"kt\"\u003ea\u003c/span\u003e \u003cspan class=\"kt\"\u003epermanent\u003c/span\u003e \u003cspan class=\"kt\"\u003efunction\u003c/span\u003e \u003cspan class=\"kt\"\u003eregistered\u003c/span\u003e \u003cspan class=\"kt\"\u003ein\u003c/span\u003e \u003cspan class=\"kt\"\u003ethe\u003c/span\u003e \u003cspan class=\"kt\"\u003edatabase\u003c/span\u003e \u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"kt\"\u003edefault\u003c/span\u003e\u003cspan class=\"err\"\u003e\u0026#39;\u003c/span\u003e\u003cspan class=\"kt\"\u003e.\u003c/span\u003e\u003cspan class=\"o\"\u003e;\u003c/span\u003e \u003cspan class=\"n\"\u003eline\u003c/span\u003e \u003cspan class=\"mi\"\u003e1\u003c/span\u003e \u003cspan class=\"n\"\u003epos\u003c/span\u003e \u003cspan class=\"mi\"\u003e0\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"嵌套的设备数据\"\u003e嵌套的设备数据\u003c/h2\u003e\n\u003cp\u003e让我们看看 Nest 的读数中另一个复杂的现实数据。 Nest 设备向其收集器发出许多 JSON 事件。该收集器可以位于附近的数据中心，邻域中央数据收集器或聚合器，或者它可以是安装在家中的设备，其定期将设备读数发送到通过安全的互联网连接连接的中央数据中心。对于幻觉，我已经限制了一些属性，但它仍然显示了如何处理复杂数据 - 以及提取相关属性。\u003c/p\u003e\n\u003cp\u003e让我们先定义它复杂的模式。仔细观察，您会发现它与我们上面定义的模式没有什么不同，除了它不是一个  map 而是三个 map：恒温器，摄像头和烟雾警报器。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eorg.apache.spark.sql.types._\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e// a bit longish, nested, and convuloted JSON schema :)\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003enestSchema2\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructType\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e      \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;devices\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e        \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructType\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e          \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;thermostats\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eMapType\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e            \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructType\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;device_id\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;locale\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;software_version\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;structure_id\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;where_name\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;last_connection\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;is_online\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eBooleanType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;can_cool\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eBooleanType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;can_heat\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eBooleanType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;is_using_emergency_heat\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eBooleanType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;has_fan\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eBooleanType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;fan_timer_active\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eBooleanType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;fan_timer_timeout\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;temperature_scale\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;target_temperature_f\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eDoubleType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;target_temperature_high_f\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eDoubleType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;target_temperature_low_f\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eDoubleType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;eco_temperature_high_f\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eDoubleType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;eco_temperature_low_f\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eDoubleType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;away_temperature_high_f\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eDoubleType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;away_temperature_low_f\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eDoubleType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;hvac_mode\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;humidity\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eLongType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;hvac_state\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;is_locked\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;locked_temp_min_f\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eDoubleType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e              \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;locked_temp_max_f\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eDoubleType\u003c/span\u003e\u003cspan class=\"o\"\u003e)))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e           \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;smoke_co_alarms\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eMapType\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e             \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructType\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e             \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;device_id\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e             \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;locale\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e             \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;software_version\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e             \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;structure_id\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e             \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;where_name\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e             \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;last_connection\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e             \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;is_online\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eBooleanType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e             \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;battery_health\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e             \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;co_alarm_state\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e             \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;smoke_alarm_state\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e             \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;is_manual_test_active\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eBooleanType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e             \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;last_manual_test_time\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e             \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;ui_color_state\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e           \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;cameras\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eMapType\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e               \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructType\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;device_id\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;software_version\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;structure_id\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;where_name\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;is_online\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eBooleanType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;is_streaming\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eBooleanType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;is_audio_input_enabled\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eBooleanType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;last_is_online_change\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;is_video_history_enabled\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eBooleanType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;web_url\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;app_url\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;is_public_share_enabled\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eBooleanType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;activity_zones\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                  \u003cspan class=\"k\"\u003enew\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructType\u003c/span\u003e\u003cspan class=\"o\"\u003e()\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                    \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eLongType\u003c/span\u003e\u003cspan class=\"o\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eadd\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;last_event\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e))))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eimport\u003c/span\u003e \u003cspan class=\"nn\"\u003eorg.apache.spark.sql.types._\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003enestSchema2\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eorg.apache.spark.sql.\u003c/span\u003e\u003cspan class=\"k\"\u003etype\u003c/span\u003e\u003cspan class=\"kt\"\u003es.StructType\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructType\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edevices\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStructType\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ethermostats\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eMapType\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStructType\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edevice_id\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elocale\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esoftware_version\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estructure_id\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewhere_name\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elast_connection\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eis_online\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eBooleanType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecan_cool\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eBooleanType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecan_heat\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eBooleanType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eis_using_emergency_heat\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eBooleanType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehas_fan\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eBooleanType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efan_timer_active\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eBooleanType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003efan_timer_timeout\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etemperature_scale\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etarget_temperature_f\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eDoubleType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etarget_temperature_high_f\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eDoubleType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003etarget_temperature_low_f\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eDoubleType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eeco_temperature_high_f\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eDoubleType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eeco_temperature_low_f\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eDoubleType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eaway_temperature_high_f\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eDoubleType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eaway_temperature_low_f\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eDoubleType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehvac_mode\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehumidity\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eLongType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ehvac_state\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eis_locked\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elocked_temp_min_f\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eDoubleType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elocked_temp_max_f\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eDoubleType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e)),\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esmoke_co_alarms\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eMapType\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStructType\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edevice_id\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elocale\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esoftware_version\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estructure_id\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewhere_name\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elast_connection\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eis_online\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eBooleanType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ebattery_health\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eco_alarm_state\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esmoke_alarm_state\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eis_manual_test_active\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eBooleanType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elast_manual_test_time\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eui_color_state\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e)),\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecameras\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eMapType\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStructType\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003edevice_id\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003esoftware_version\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estructure_id\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ewhere_name\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eis_online\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eBooleanType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eis_streaming\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eBooleanType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eis_audio_input_enabled\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eBooleanType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elast_is_online_change\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eis_video_history_enabled\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eBooleanType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eweb_url\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eapp_url\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eis_public_share_enabled\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eBooleanType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eactivity_zones\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStructType\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ename\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eid\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eLongType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e)),\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \u003cspan class=\"nc\"\u003eStructField\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003elast_event\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"nc\"\u003eStringType\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e)),\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e)),\u003c/span\u003e\u003cspan class=\"kc\"\u003etrue\u003c/span\u003e\u003cspan class=\"o\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e通过创建一个简单的数据集，您可以使用所有数据集方法来执行 ETL，使用上面的实用程序函数：\u003ccode\u003efrom_json()\u003c/code\u003e，\u003ccode\u003eto_json()\u003c/code\u003e，\u003ccode\u003eexplode()\u003c/code\u003e 和 \u003ccode\u003eselectExpr()\u003c/code\u003e。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003enestDataDS2\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"nc\"\u003eSeq\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;\u0026#34;\u0026#34;{\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e    \u0026#34;devices\u0026#34;: {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e       \u0026#34;thermostats\u0026#34;: {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e          \u0026#34;peyiJNo0IldT2YlIVtYaGQ\u0026#34;: {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;device_id\u0026#34;: \u0026#34;peyiJNo0IldT2YlIVtYaGQ\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;locale\u0026#34;: \u0026#34;en-US\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;software_version\u0026#34;: \u0026#34;4.0\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;structure_id\u0026#34;: \u0026#34;VqFabWH21nwVyd4RWgJgNb292wa7hG_dUwo2i2SG7j3-BOLY0BA4sw\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;where_name\u0026#34;: \u0026#34;Hallway Upstairs\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;last_connection\u0026#34;: \u0026#34;2016-10-31T23:59:59.000Z\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;is_online\u0026#34;: true,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;can_cool\u0026#34;: true,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;can_heat\u0026#34;: true,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;is_using_emergency_heat\u0026#34;: true,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;has_fan\u0026#34;: true,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;fan_timer_active\u0026#34;: true,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;fan_timer_timeout\u0026#34;: \u0026#34;2016-10-31T23:59:59.000Z\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;temperature_scale\u0026#34;: \u0026#34;F\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;target_temperature_f\u0026#34;: 72,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;target_temperature_high_f\u0026#34;: 80,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;target_temperature_low_f\u0026#34;: 65,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;eco_temperature_high_f\u0026#34;: 80,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;eco_temperature_low_f\u0026#34;: 65,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;away_temperature_high_f\u0026#34;: 80,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;away_temperature_low_f\u0026#34;: 65,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;hvac_mode\u0026#34;: \u0026#34;heat\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;humidity\u0026#34;: 40,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;hvac_state\u0026#34;: \u0026#34;heating\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;is_locked\u0026#34;: true,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;locked_temp_min_f\u0026#34;: 65,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;locked_temp_max_f\u0026#34;: 80\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            }\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e          },\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e          \u0026#34;smoke_co_alarms\u0026#34;: {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;RTMTKxsQTCxzVcsySOHPxKoF4OyCifrs\u0026#34;: {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e              \u0026#34;device_id\u0026#34;: \u0026#34;RTMTKxsQTCxzVcsySOHPxKoF4OyCifrs\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e              \u0026#34;locale\u0026#34;: \u0026#34;en-US\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e              \u0026#34;software_version\u0026#34;: \u0026#34;1.01\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e              \u0026#34;structure_id\u0026#34;: \u0026#34;VqFabWH21nwVyd4RWgJgNb292wa7hG_dUwo2i2SG7j3-BOLY0BA4sw\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e              \u0026#34;where_name\u0026#34;: \u0026#34;Jane\u0026#39;s Room\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e              \u0026#34;last_connection\u0026#34;: \u0026#34;2016-10-31T23:59:59.000Z\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e              \u0026#34;is_online\u0026#34;: true,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e              \u0026#34;battery_health\u0026#34;: \u0026#34;ok\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e              \u0026#34;co_alarm_state\u0026#34;: \u0026#34;ok\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e              \u0026#34;smoke_alarm_state\u0026#34;: \u0026#34;ok\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e              \u0026#34;is_manual_test_active\u0026#34;: true,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e              \u0026#34;last_manual_test_time\u0026#34;: \u0026#34;2016-10-31T23:59:59.000Z\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e              \u0026#34;ui_color_state\u0026#34;: \u0026#34;gray\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e              }\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            },\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e         \u0026#34;cameras\u0026#34;: {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e          \u0026#34;awJo6rH0IldT2YlIVtYaGQ\u0026#34;: {\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;device_id\u0026#34;: \u0026#34;awJo6rH\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;software_version\u0026#34;: \u0026#34;4.0\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;structure_id\u0026#34;: \u0026#34;VqFabWH21nwVyd4RWgJgNb292wa7hG_dUwo2i2SG7j3-BOLY0BA4sw\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;where_name\u0026#34;: \u0026#34;Foyer\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;is_online\u0026#34;: true,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;is_streaming\u0026#34;: true,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;is_audio_input_enabled\u0026#34;: true,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;last_is_online_change\u0026#34;: \u0026#34;2016-12-29T18:42:00.000Z\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;is_video_history_enabled\u0026#34;: true,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;web_url\u0026#34;: \u0026#34;https://home.nest.com/cameras/device_id?auth=access_token\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;app_url\u0026#34;: \u0026#34;nestmobile://cameras/device_id?auth=access_token\u0026#34;,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;is_public_share_enabled\u0026#34;: true,\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;activity_zones\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;Walkway\u0026#34;, \u0026#34;id\u0026#34;: 244083 },\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            \u0026#34;last_event\u0026#34;: \u0026#34;2016-10-31T23:59:59.000Z\u0026#34;\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e            }\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e          }\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e        }\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"s\"\u003e       }\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003etoDS\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003enestDataDS2\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eorg.apache.spark.sql.Dataset\u003c/span\u003e\u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eString\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003evalue:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e让我们从这个单一的嵌套结构创建一个 DataFrame，并使用上述所有实用程序函数来处理和提取相关属性\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003enestDF2\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003espark\u003c/span\u003e                            \u003cspan class=\"c1\"\u003e// spark session \n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e            \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eread\u003c/span\u003e                             \u003cspan class=\"c1\"\u003e//  get DataFrameReader\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e            \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eschema\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enestSchema2\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e             \u003cspan class=\"c1\"\u003e//  use the defined schema above and read format as JSON\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e            \u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ejson\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003enestDataDS2\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003erdd\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003enestDF2\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eorg.apache.spark.sql.DataFrame\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003edevices:\u003c/span\u003e \u003cspan class=\"kt\"\u003estruct\u0026lt;thermostats:\u003c/span\u003e \u003cspan class=\"kt\"\u003emap\u0026lt;string\u003c/span\u003e,\u003cspan class=\"kt\"\u003estruct\u0026lt;device_id:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003elocale:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003esoftware_version:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003estructure_id:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003ewhere_name:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003elast_connection:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003eis_online:boolean\u003c/span\u003e,\u003cspan class=\"kt\"\u003ecan_cool:boolean\u003c/span\u003e,\u003cspan class=\"kt\"\u003ecan_heat:boolean\u003c/span\u003e,\u003cspan class=\"kt\"\u003eis_using_emergency_heat:boolean\u003c/span\u003e,\u003cspan class=\"kt\"\u003ehas_fan:boolean\u003c/span\u003e,\u003cspan class=\"kt\"\u003efan_timer_active:boolean\u003c/span\u003e,\u003cspan class=\"kt\"\u003efan_timer_timeout:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003etemperature_scale:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003etarget_temperature_f:double\u003c/span\u003e,\u003cspan class=\"kt\"\u003etarget_temperature_high_f:double\u003c/span\u003e,\u003cspan class=\"kt\"\u003etarget_temperature_low_f:double\u003c/span\u003e,\u003cspan class=\"kt\"\u003eeco_temperature_high_f:double\u003c/span\u003e,\u003cspan class=\"kt\"\u003eeco_temperature_low_f:double\u003c/span\u003e,\u003cspan class=\"kt\"\u003eaway_temperature_high_f:double\u003c/span\u003e,\u003cspan class=\"kt\"\u003eaway_temperature_low_f:double\u003c/span\u003e,\u003cspan class=\"kt\"\u003ehvac_mode:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003ehumidity:bigint\u003c/span\u003e,\u003cspan class=\"kt\"\u003ehvac_state:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003e...\u003c/span\u003e \u003cspan class=\"err\"\u003e3\u003c/span\u003e \u003cspan class=\"kt\"\u003emore\u003c/span\u003e \u003cspan class=\"kt\"\u003efields\u0026gt;\u0026gt;\u003c/span\u003e, \u003cspan class=\"kt\"\u003esmoke_co_alarms:\u003c/span\u003e \u003cspan class=\"kt\"\u003emap\u0026lt;string\u003c/span\u003e,\u003cspan class=\"kt\"\u003estruct\u0026lt;device_id:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003elocale:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003esoftware_version:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003estructure_id:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003ewhere_name:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003elast_connection:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003eis_online:boolean\u003c/span\u003e,\u003cspan class=\"kt\"\u003ebattery_health:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003eco_alarm_state:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003esmoke_alarm_state:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003eis_manual_test_active:boolean\u003c/span\u003e,\u003cspan class=\"kt\"\u003elast_manual_test_time:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003eui_color_state:string\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003e...\u003c/span\u003e \u003cspan class=\"err\"\u003e1\u003c/span\u003e \u003cspan class=\"kt\"\u003emore\u003c/span\u003e \u003cspan class=\"kt\"\u003efield\u0026gt;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003e{\u0026#34;thermostats\u0026#34;:{\u0026#34;peyiJNo0IldT2YlIVtYaGQ\u0026#34;:{\u0026#34;device_id\u0026#34;:\u0026#34;peyiJNo0IldT2YlIVtYaGQ\u0026#34;,\u0026#34;locale\u0026#34;:\u0026#34;en-US\u0026#34;,\u0026#34;software_version\u0026#34;:\u0026#34;4.0\u0026#34;,\u0026#34;structure_id\u0026#34;:\u0026#34;VqFabWH21nwVyd4RWgJgNb292wa7hG_dUwo2i2SG7j3-BOLY0BA4sw\u0026#34;,\u0026#34;where_name\u0026#34;:\u0026#34;Hallway Upstairs\u0026#34;,\u0026#34;last_connection\u0026#34;:\u0026#34;2016-10-31T23:59:59.000Z\u0026#34;,\u0026#34;is_online\u0026#34;:true,\u0026#34;can_cool\u0026#34;:true,\u0026#34;can_heat\u0026#34;:true,\u0026#34;is_using_emergency_heat\u0026#34;:true,\u0026#34;has_fan\u0026#34;:true,\u0026#34;fan_timer_active\u0026#34;:true,\u0026#34;fan_timer_timeout\u0026#34;:\u0026#34;2016-10-31T23:59:59.000Z\u0026#34;,\u0026#34;temperature_scale\u0026#34;:\u0026#34;F\u0026#34;,\u0026#34;target_temperature_f\u0026#34;:72,\u0026#34;target_temperature_high_f\u0026#34;:80,\u0026#34;target_temperature_low_f\u0026#34;:65,\u0026#34;eco_temperature_high_f\u0026#34;:80,\u0026#34;eco_temperature_low_f\u0026#34;:65,\u0026#34;away_temperature_high_f\u0026#34;:80,\u0026#34;away_temperature_low_f\u0026#34;:65,\u0026#34;hvac_mode\u0026#34;:\u0026#34;heat\u0026#34;,\u0026#34;humidity\u0026#34;:\u0026#34;40\u0026#34;,\u0026#34;hvac_state\u0026#34;:\u0026#34;heating\u0026#34;,\u0026#34;is_locked\u0026#34;:\u0026#34;true\u0026#34;,\u0026#34;locked_temp_min_f\u0026#34;:65,\u0026#34;locked_temp_max_f\u0026#34;:80}},\u0026#34;smoke_co_alarms\u0026#34;:{\u0026#34;RTMTKxsQTCxzVcsySOHPxKoF4OyCifrs\u0026#34;:{\u0026#34;device_id\u0026#34;:\u0026#34;RTMTKxsQTCxzVcsySOHPxKoF4OyCifrs\u0026#34;,\u0026#34;locale\u0026#34;:\u0026#34;en-US\u0026#34;,\u0026#34;software_version\u0026#34;:\u0026#34;1.01\u0026#34;,\u0026#34;structure_id\u0026#34;:\u0026#34;VqFabWH21nwVyd4RWgJgNb292wa7hG_dUwo2i2SG7j3-BOLY0BA4sw\u0026#34;,\u0026#34;where_name\u0026#34;:\u0026#34;Jane\u0026#39;s Room\u0026#34;,\u0026#34;last_connection\u0026#34;:\u0026#34;2016-10-31T23:59:59.000Z\u0026#34;,\u0026#34;is_online\u0026#34;:true,\u0026#34;battery_health\u0026#34;:\u0026#34;ok\u0026#34;,\u0026#34;co_alarm_state\u0026#34;:\u0026#34;ok\u0026#34;,\u0026#34;smoke_alarm_state\u0026#34;:\u0026#34;ok\u0026#34;,\u0026#34;is_manual_test_active\u0026#34;:true,\u0026#34;last_manual_test_time\u0026#34;:\u0026#34;2016-10-31T23:59:59.000Z\u0026#34;,\u0026#34;ui_color_state\u0026#34;:\u0026#34;gray\u0026#34;}},\u0026#34;cameras\u0026#34;:{\u0026#34;awJo6rH0IldT2YlIVtYaGQ\u0026#34;:{\u0026#34;device_id\u0026#34;:\u0026#34;awJo6rH\u0026#34;,\u0026#34;software_version\u0026#34;:\u0026#34;4.0\u0026#34;,\u0026#34;structure_id\u0026#34;:\u0026#34;VqFabWH21nwVyd4RWgJgNb292wa7hG_dUwo2i2SG7j3-BOLY0BA4sw\u0026#34;,\u0026#34;where_name\u0026#34;:\u0026#34;Foyer\u0026#34;,\u0026#34;is_online\u0026#34;:true,\u0026#34;is_streaming\u0026#34;:true,\u0026#34;is_audio_input_enabled\u0026#34;:true,\u0026#34;last_is_online_change\u0026#34;:\u0026#34;2016-12-29T18:42:00.000Z\u0026#34;,\u0026#34;is_video_history_enabled\u0026#34;:true,\u0026#34;web_url\u0026#34;:\u0026#34;https://home.nest.com/cameras/device_id?auth=access_token\u0026#34;,\u0026#34;app_url\u0026#34;:\u0026#34;nestmobile://cameras/device_id?auth=access_token\u0026#34;,\u0026#34;is_public_share_enabled\u0026#34;:true,\u0026#34;activity_zones\u0026#34;:{\u0026#34;name\u0026#34;:\u0026#34;Walkway\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;244083\u0026#34;},\u0026#34;last_event\u0026#34;:\u0026#34;2016-10-31T23:59:59.000Z\u0026#34;}}}\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e如上所述将上面的整个 JSON 对象转换为 JSON 字符串。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003estringJsonDF\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enestDF2\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eselect\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eto_json\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003estruct\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;*\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e))).\u003c/span\u003e\u003cspan class=\"n\"\u003etoDF\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;nestDevice\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003estringJsonDF\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eorg.apache.spark.sql.DataFrame\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003enestDevice:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003estringJsonDF.printSchema\nroot\n |-- nestDevice: string (nullable = true)\n\u003c/code\u003e\u003c/pre\u003e\u003cpre tabindex=\"0\"\u003e\u003ccode\u003edisplay(stringJsonDF)\n{\u0026#34;devices\u0026#34;:{\u0026#34;thermostats\u0026#34;:{\u0026#34;peyiJNo0IldT2YlIVtYaGQ\u0026#34;:{\u0026#34;device_id\u0026#34;:\u0026#34;peyiJNo0IldT2YlIVtYaGQ\u0026#34;,\u0026#34;locale\u0026#34;:\u0026#34;en-US\u0026#34;,\u0026#34;software_version\u0026#34;:\u0026#34;4.0\u0026#34;,\u0026#34;structure_id\u0026#34;:\u0026#34;VqFabWH21nwVyd4RWgJgNb292wa7hG_dUwo2i2SG7j3-BOLY0BA4sw\u0026#34;,\u0026#34;where_name\u0026#34;:\u0026#34;Hallway Upstairs\u0026#34;,\u0026#34;last_connection\u0026#34;:\u0026#34;2016-10-31T23:59:59.000Z\u0026#34;,\u0026#34;is_online\u0026#34;:true,\u0026#34;can_cool\u0026#34;:true,\u0026#34;can_heat\u0026#34;:true,\u0026#34;is_using_emergency_heat\u0026#34;:true,\u0026#34;has_fan\u0026#34;:true,\u0026#34;fan_timer_active\u0026#34;:true,\u0026#34;fan_timer_timeout\u0026#34;:\u0026#34;2016-10-31T23:59:59.000Z\u0026#34;,\u0026#34;temperature_scale\u0026#34;:\u0026#34;F\u0026#34;,\u0026#34;target_temperature_f\u0026#34;:72.0,\u0026#34;target_temperature_high_f\u0026#34;:80.0,\u0026#34;target_temperature_low_f\u0026#34;:65.0,\u0026#34;eco_temperature_high_f\u0026#34;:80.0,\u0026#34;eco_temperature_low_f\u0026#34;:65.0,\u0026#34;away_temperature_high_f\u0026#34;:80.0,\u0026#34;away_temperature_low_f\u0026#34;:65.0,\u0026#34;hvac_mode\u0026#34;:\u0026#34;heat\u0026#34;,\u0026#34;humidity\u0026#34;:40,\u0026#34;hvac_state\u0026#34;:\u0026#34;heating\u0026#34;,\u0026#34;is_locked\u0026#34;:\u0026#34;true\u0026#34;,\u0026#34;locked_temp_min_f\u0026#34;:65.0,\u0026#34;locked_temp_max_f\u0026#34;:80.0}},\u0026#34;smoke_co_alarms\u0026#34;:{\u0026#34;RTMTKxsQTCxzVcsySOHPxKoF4OyCifrs\u0026#34;:{\u0026#34;device_id\u0026#34;:\u0026#34;RTMTKxsQTCxzVcsySOHPxKoF4OyCifrs\u0026#34;,\u0026#34;locale\u0026#34;:\u0026#34;en-US\u0026#34;,\u0026#34;software_version\u0026#34;:\u0026#34;1.01\u0026#34;,\u0026#34;structure_id\u0026#34;:\u0026#34;VqFabWH21nwVyd4RWgJgNb292wa7...\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e给定具有三个映射的嵌套 JSON 对象，您可以获取单个映射作为 columnn，然后使用 \u003ccode\u003eexplode()\u003c/code\u003e 访问它的属性。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003emapColumnsDF\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003enestDF2\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eselect\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;devices\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;smoke_co_alarms\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003ealias\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;smoke_alarms\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                  \u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;devices\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;cameras\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003ealias\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;cameras\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                  \u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;devices\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;thermostats\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003ealias\u003c/span\u003e \u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;thermostats\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003emapColumnsDF\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eorg.apache.spark.sql.DataFrame\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003esmoke_alarms:\u003c/span\u003e \u003cspan class=\"kt\"\u003emap\u0026lt;string\u003c/span\u003e,\u003cspan class=\"kt\"\u003estruct\u0026lt;device_id:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003elocale:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003esoftware_version:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003estructure_id:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003ewhere_name:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003elast_connection:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003eis_online:boolean\u003c/span\u003e,\u003cspan class=\"kt\"\u003ebattery_health:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003eco_alarm_state:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003esmoke_alarm_state:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003eis_manual_test_active:boolean\u003c/span\u003e,\u003cspan class=\"kt\"\u003elast_manual_test_time:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003eui_color_state:string\u0026gt;\u0026gt;\u003c/span\u003e, \u003cspan class=\"kt\"\u003ecameras:\u003c/span\u003e \u003cspan class=\"kt\"\u003emap\u0026lt;string\u003c/span\u003e,\u003cspan class=\"kt\"\u003estruct\u0026lt;device_id:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003esoftware_version:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003estructure_id:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003ewhere_name:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003eis_online:boolean\u003c/span\u003e,\u003cspan class=\"kt\"\u003eis_streaming:boolean\u003c/span\u003e,\u003cspan class=\"kt\"\u003eis_audio_input_enabled:boolean\u003c/span\u003e,\u003cspan class=\"kt\"\u003elast_is_online_change:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003eis_video_history_enabled:boolean\u003c/span\u003e,\u003cspan class=\"kt\"\u003eweb_url:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003eapp_url:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003eis_public_share_enabled:boolean\u003c/span\u003e,\u003cspan class=\"kt\"\u003eactivity_zones:struct\u0026lt;name:string\u003c/span\u003e,\u003cspan class=\"kt\"\u003eid:bigint\u0026gt;\u003c/span\u003e,\u003cspan class=\"kt\"\u003elast_event:string\u0026gt;\u0026gt;\u003c/span\u003e \u003cspan class=\"kt\"\u003e...\u003c/span\u003e \u003cspan class=\"err\"\u003e1\u003c/span\u003e \u003cspan class=\"kt\"\u003emore\u003c/span\u003e \u003cspan class=\"kt\"\u003efield\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003esmoke_alarms\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003ecameras\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003ethermostats\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;RTMTKxsQTCxzVcsySOHPxKoF4OyCifrs\u0026rdquo;:{\u0026ldquo;device_id\u0026rdquo;:\u0026ldquo;RTMTKxsQTCxzVcsySOHPxKoF4OyCifrs\u0026rdquo;,\u0026ldquo;locale\u0026rdquo;:\u0026ldquo;en-US\u0026rdquo;,\u0026ldquo;software_version\u0026rdquo;:\u0026ldquo;1.01\u0026rdquo;,\u0026ldquo;structure_id\u0026rdquo;:\u0026ldquo;VqFabWH21nwVyd4RWgJgNb292wa7hG_dUwo2i2SG7j3-BOLY0BA4sw\u0026rdquo;,\u0026ldquo;where_name\u0026rdquo;:\u0026ldquo;Jane\u0026rsquo;s Room\u0026rdquo;,\u0026ldquo;last_connection\u0026rdquo;:\u0026ldquo;2016-10-31T23:59:59.000Z\u0026rdquo;,\u0026ldquo;is_online\u0026rdquo;:true,\u0026ldquo;battery_health\u0026rdquo;:\u0026ldquo;ok\u0026rdquo;,\u0026ldquo;co_alarm_state\u0026rdquo;:\u0026ldquo;ok\u0026rdquo;,\u0026ldquo;smoke_alarm_state\u0026rdquo;:\u0026ldquo;ok\u0026rdquo;,\u0026ldquo;is_manual_test_active\u0026rdquo;:true,\u0026ldquo;last_manual_test_time\u0026rdquo;:\u0026ldquo;2016-10-31T23:59:59.000Z\u0026rdquo;,\u0026ldquo;ui_color_state\u0026rdquo;:\u0026ldquo;gray\u0026rdquo;}}\u0026quot;\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e\u0026ldquo;{\u0026ldquo;awJo6rH0IldT2YlIVtYaGQ\u0026rdquo;:{\u0026ldquo;device_id\u0026rdquo;:\u0026ldquo;awJo6rH\u0026rdquo;,\u0026ldquo;software_version\u0026rdquo;:\u0026ldquo;4.0\u0026rdquo;,\u0026ldquo;structure_id\u0026rdquo;:\u0026ldquo;VqFabWH21nwVyd4RWgJgNb292wa7hG_dUwo2i2SG7j3-BOLY0BA4sw\u0026rdquo;,\u0026ldquo;where_name\u0026rdquo;:\u0026ldquo;Foyer\u0026rdquo;,\u0026ldquo;is_online\u0026rdquo;:true,\u0026ldquo;is_streaming\u0026rdquo;:true,\u0026ldquo;is_audio_input_enabled\u0026rdquo;:true,\u0026ldquo;last_is_online_change\u0026rdquo;:\u0026ldquo;2016-12-29T18:42:00.000Z\u0026rdquo;,\u0026ldquo;is_video_history_enabled\u0026rdquo;:true,\u0026ldquo;web_url\u0026rdquo;:\u0026ldquo;\u003ca href=\"https://home.nest.com/cameras/device_id?auth=access_token%22,%22app_url%22:%22nestmobile://cameras/device_id?auth=access_token%22,%22is_public_share_enabled%22:true,%22activity_zones%22:%7B%22name%22:%22Walkway%22,%22id%22:%22244083%22%7D,%22last_event%22:%222016-10-31T23:59:59.000Z%22%7D%7D%22\"\u003ehttps://home.nest.com/cameras/device_id?auth=access_token\u0026quot;,\u0026quot;app_url\u0026quot;:\u0026quot;nestmobile://cameras/device_id?auth=access_token\u0026quot;,\u0026quot;is_public_share_enabled\u0026quot;:true,\u0026quot;activity_zones\u0026quot;:{\u0026quot;name\u0026quot;:\u0026quot;Walkway\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;244083\u0026quot;},\u0026quot;last_event\u0026quot;:\u0026quot;2016-10-31T23:59:59.000Z\u0026quot;}}\u0026quot;\u003c/a\u003e\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e\u0026ldquo;{\u0026ldquo;peyiJNo0IldT2YlIVtYaGQ\u0026rdquo;:{\u0026ldquo;device_id\u0026rdquo;:\u0026ldquo;peyiJNo0IldT2YlIVtYaGQ\u0026rdquo;,\u0026ldquo;locale\u0026rdquo;:\u0026ldquo;en-US\u0026rdquo;,\u0026ldquo;software_version\u0026rdquo;:\u0026ldquo;4.0\u0026rdquo;,\u0026ldquo;structure_id\u0026rdquo;:\u0026ldquo;VqFabWH21nwVyd4RWgJgNb292wa7hG_dUwo2i2SG7j3-BOLY0BA4sw\u0026rdquo;,\u0026ldquo;where_name\u0026rdquo;:\u0026ldquo;Hallway Upstairs\u0026rdquo;,\u0026ldquo;last_connection\u0026rdquo;:\u0026ldquo;2016-10-31T23:59:59.000Z\u0026rdquo;,\u0026ldquo;is_online\u0026rdquo;:true,\u0026ldquo;can_cool\u0026rdquo;:true,\u0026ldquo;can_heat\u0026rdquo;:true,\u0026ldquo;is_using_emergency_heat\u0026rdquo;:true,\u0026ldquo;has_fan\u0026rdquo;:true,\u0026ldquo;fan_timer_active\u0026rdquo;:true,\u0026ldquo;fan_timer_timeout\u0026rdquo;:\u0026ldquo;2016-10-31T23:59:59.000Z\u0026rdquo;,\u0026ldquo;temperature_scale\u0026rdquo;:\u0026ldquo;F\u0026rdquo;,\u0026ldquo;target_temperature_f\u0026rdquo;:72,\u0026ldquo;target_temperature_high_f\u0026rdquo;:80,\u0026ldquo;target_temperature_low_f\u0026rdquo;:65,\u0026ldquo;eco_temperature_high_f\u0026rdquo;:80,\u0026ldquo;eco_temperature_low_f\u0026rdquo;:65,\u0026ldquo;away_temperature_high_f\u0026rdquo;:80,\u0026ldquo;away_temperature_low_f\u0026rdquo;:65,\u0026ldquo;hvac_mode\u0026rdquo;:\u0026ldquo;heat\u0026rdquo;,\u0026ldquo;humidity\u0026rdquo;:\u0026ldquo;40\u0026rdquo;,\u0026ldquo;hvac_state\u0026rdquo;:\u0026ldquo;heating\u0026rdquo;,\u0026ldquo;is_locked\u0026rdquo;:\u0026ldquo;true\u0026rdquo;,\u0026ldquo;locked_temp_min_f\u0026rdquo;:65,\u0026ldquo;locked_temp_max_f\u0026rdquo;:80}}\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003eexplodedThermostatsDF\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emapColumnsDF\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eselect\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eexplode\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;thermostats\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003eexplodedCamerasDF\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003emapColumnsDF\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eselect\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eexplode\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;cameras\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e//or you could use the original nestDF2 and use the devices.X notation\n\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"c1\"\u003e\u003c/span\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003eexplodedSmokedAlarmsDF\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e  \u003cspan class=\"n\"\u003enestDF2\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eselect\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003eexplode\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;devices.smoke_co_alarms\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eexplodedThermostatsDF\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eorg.apache.spark.sql.DataFrame\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003ekey:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e, \u003cspan class=\"kt\"\u003evalue:\u003c/span\u003e \u003cspan class=\"kt\"\u003estruct\u0026lt;device_id:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e, \u003cspan class=\"kt\"\u003elocale:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"kt\"\u003e...\u003c/span\u003e \u003cspan class=\"err\"\u003e25\u003c/span\u003e \u003cspan class=\"kt\"\u003emore\u003c/span\u003e \u003cspan class=\"kt\"\u003efields\u0026gt;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eexplodedCamerasDF\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eorg.apache.spark.sql.DataFrame\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003ekey:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e, \u003cspan class=\"kt\"\u003evalue:\u003c/span\u003e \u003cspan class=\"kt\"\u003estruct\u0026lt;device_id:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e, \u003cspan class=\"kt\"\u003esoftware_version:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"kt\"\u003e...\u003c/span\u003e \u003cspan class=\"err\"\u003e12\u003c/span\u003e \u003cspan class=\"kt\"\u003emore\u003c/span\u003e \u003cspan class=\"kt\"\u003efields\u0026gt;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003eexplodedSmokedAlarmsDF\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eorg.apache.spark.sql.DataFrame\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003ekey:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e, \u003cspan class=\"kt\"\u003evalue:\u003c/span\u003e \u003cspan class=\"kt\"\u003estruct\u0026lt;device_id:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e, \u003cspan class=\"kt\"\u003elocale:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"kt\"\u003e...\u003c/span\u003e \u003cspan class=\"err\"\u003e11\u003c/span\u003e \u003cspan class=\"kt\"\u003emore\u003c/span\u003e \u003cspan class=\"kt\"\u003efields\u0026gt;\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003ekey\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003evalue\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003epeyiJNo0IldT2YlIVtYaGQ\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e{\u0026ldquo;device_id\u0026rdquo;:\u0026ldquo;peyiJNo0IldT2YlIVtYaGQ\u0026rdquo;,\u0026ldquo;locale\u0026rdquo;:\u0026ldquo;en-US\u0026rdquo;,\u0026ldquo;software_version\u0026rdquo;:\u0026ldquo;4.0\u0026rdquo;,\u0026ldquo;structure_id\u0026rdquo;:\u0026ldquo;VqFabWH21nwVyd4RWgJgNb292wa7hG_dUwo2i2SG7j3-BOLY0BA4sw\u0026rdquo;,\u0026ldquo;where_name\u0026rdquo;:\u0026ldquo;Hallway Upstairs\u0026rdquo;,\u0026ldquo;last_connection\u0026rdquo;:\u0026ldquo;2016-10-31T23:59:59.000Z\u0026rdquo;,\u0026ldquo;is_online\u0026rdquo;:true,\u0026ldquo;can_cool\u0026rdquo;:true,\u0026ldquo;can_heat\u0026rdquo;:true,\u0026ldquo;is_using_emergency_heat\u0026rdquo;:true,\u0026ldquo;has_fan\u0026rdquo;:true,\u0026ldquo;fan_timer_active\u0026rdquo;:true,\u0026ldquo;fan_timer_timeout\u0026rdquo;:\u0026ldquo;2016-10-31T23:59:59.000Z\u0026rdquo;,\u0026ldquo;temperature_scale\u0026rdquo;:\u0026ldquo;F\u0026rdquo;,\u0026ldquo;target_temperature_f\u0026rdquo;:72,\u0026ldquo;target_temperature_high_f\u0026rdquo;:80,\u0026ldquo;target_temperature_low_f\u0026rdquo;:65,\u0026ldquo;eco_temperature_high_f\u0026rdquo;:80,\u0026ldquo;eco_temperature_low_f\u0026rdquo;:65,\u0026ldquo;away_temperature_high_f\u0026rdquo;:80,\u0026ldquo;away_temperature_low_f\u0026rdquo;:65,\u0026ldquo;hvac_mode\u0026rdquo;:\u0026ldquo;heat\u0026rdquo;,\u0026ldquo;humidity\u0026rdquo;:\u0026ldquo;40\u0026rdquo;,\u0026ldquo;hvac_state\u0026rdquo;:\u0026ldquo;heating\u0026rdquo;,\u0026ldquo;is_locked\u0026rdquo;:\u0026ldquo;true\u0026rdquo;,\u0026ldquo;locked_temp_min_f\u0026rdquo;:65,\u0026ldquo;locked_temp_max_f\u0026rdquo;:80}\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e要从 map 中提取特定的单个字段，可以使用 \u003ccode\u003egetItem()\u003c/code\u003e 方法。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003ethermostateDF\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eexplodedThermostatsDF\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eselect\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;value\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;device_id\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003ealias\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;device_id\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                                 \u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;value\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;locale\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003ealias\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;locale\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                                 \u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;value\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;where_name\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003ealias\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;location\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                                 \u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;value\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;last_connection\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003ealias\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;last_connected\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                                 \u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;value\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;humidity\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003ealias\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;humidity\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                                 \u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;value\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;target_temperature_f\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003ealias\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;target_temperature_f\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                                 \u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;value\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;hvac_mode\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003ealias\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;mode\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                                 \u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;value\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;software_version\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003ealias\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;version\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003ecameraDF\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eexplodedCamerasDF\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eselect\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;value\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;device_id\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003ealias\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;device_id\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                        \u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;value\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;where_name\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003ealias\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;location\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                        \u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;value\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;software_version\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003ealias\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;version\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                        \u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;value\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;activity_zones\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003ealias\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;name\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                        \u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;value\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;activity_zones\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003ealias\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;id\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                         \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003esmokedAlarmsDF\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003eexplodedSmokedAlarmsDF\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003eselect\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;value\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;device_id\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003ealias\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;device_id\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                                   \u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;value\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;where_name\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003ealias\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;location\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                                   \u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;value\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;software_version\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003ealias\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;version\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                                   \u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;value\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;last_connection\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003ealias\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;last_connected\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e),\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                                   \u003cspan class=\"n\"\u003e$\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;value\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003egetItem\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;battery_health\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e).\u003c/span\u003e\u003cspan class=\"n\"\u003ealias\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#34;battery_health\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e))\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                                  \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e                                        \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ethermostateDF\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eorg.apache.spark.sql.DataFrame\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003edevice_id:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e, \u003cspan class=\"kt\"\u003elocale:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"kt\"\u003e...\u003c/span\u003e \u003cspan class=\"err\"\u003e6\u003c/span\u003e \u003cspan class=\"kt\"\u003emore\u003c/span\u003e \u003cspan class=\"kt\"\u003efields\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ecameraDF\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eorg.apache.spark.sql.DataFrame\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003edevice_id:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e, \u003cspan class=\"kt\"\u003elocation:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"kt\"\u003e...\u003c/span\u003e \u003cspan class=\"err\"\u003e3\u003c/span\u003e \u003cspan class=\"kt\"\u003emore\u003c/span\u003e \u003cspan class=\"kt\"\u003efields\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003esmokedAlarmsDF\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eorg.apache.spark.sql.DataFrame\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003edevice_id:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e, \u003cspan class=\"kt\"\u003elocation:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"kt\"\u003e...\u003c/span\u003e \u003cspan class=\"err\"\u003e3\u003c/span\u003e \u003cspan class=\"kt\"\u003emore\u003c/span\u003e \u003cspan class=\"kt\"\u003efields\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cul\u003e\n\u003cli\u003edisplay(thermostateDF)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003edevice_id\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003elocale\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003elocation\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003elast_connected\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003ehumidity\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003etarget_temperature_f\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003emode\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003eversion\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003epeyiJNo0IldT2YlIVtYaGQ\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003een-US\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eHallway Upstairs\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e2016-10-31T23:59:59.000Z\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e40\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e72\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eheat\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e4.0\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cul\u003e\n\u003cli\u003edisplay(cameraDF)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003edevice_id\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003elocation\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003eversion\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003ename\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003eid\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eawJo6rH\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eFoyer\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e4.0\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eWalkway\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e244083\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cul\u003e\n\u003cli\u003edisplay(smokedAlarmsDF)\u003c/li\u003e\n\u003c/ul\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003edevice_id\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003elocation\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003eversion\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003elast_connected\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003ebattery_health\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003eRTMTKxsQTCxzVcsySOHPxKoF4OyCifrs\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eJane\u0026rsquo;s Room\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e1.01\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e2016-10-31T23:59:59.000Z\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eok\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e让我们在列版本上 join 两个 DataFrame。\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003edisplay(joineDFs)\u003c/li\u003e\n\u003c/ul\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-scala\" data-lang=\"scala\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003eval\u003c/span\u003e \u003cspan class=\"n\"\u003ejoineDFs\u003c/span\u003e \u003cspan class=\"k\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003ethermostateDF\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003ejoin\u003c/span\u003e\u003cspan class=\"o\"\u003e(\u003c/span\u003e\u003cspan class=\"n\"\u003ecameraDF\u003c/span\u003e\u003cspan class=\"o\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;version\u0026#34;\u003c/span\u003e\u003cspan class=\"o\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003ejoineDFs\u003c/span\u003e\u003cspan class=\"k\"\u003e:\u003c/span\u003e \u003cspan class=\"kt\"\u003eorg.apache.spark.sql.DataFrame\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"o\"\u003e[\u003c/span\u003e\u003cspan class=\"kt\"\u003eversion:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e, \u003cspan class=\"kt\"\u003edevice_id:\u003c/span\u003e \u003cspan class=\"kt\"\u003estring\u003c/span\u003e \u003cspan class=\"kt\"\u003e...\u003c/span\u003e \u003cspan class=\"err\"\u003e10\u003c/span\u003e \u003cspan class=\"kt\"\u003emore\u003c/span\u003e \u003cspan class=\"kt\"\u003efields\u003c/span\u003e\u003cspan class=\"o\"\u003e]\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003eversion\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003edevice_id\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003elocale\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003elocation\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003elast_connected\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003ehumidity\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003etarget_temperature_f\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003emode\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003edevice_id\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003elocation\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003ename\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003eid\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e4.0\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003epeyiJNo0IldT2YlIVtYaGQ\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003een-US\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eHallway Upstairs\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e2016-10-31T23:59:59.000Z\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e40\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e72\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eheat\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eawJo6rH\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eFoyer\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eWalkway\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003e244083\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003ch2 id=\"总结\"\u003e总结\u003c/h2\u003e\n\u003cp\u003e这个简短教程的重点是演示如何轻松使用实用程序函数从复杂的嵌套结构中提取 JSON 属性。一旦您将所需的值展开或展平或解析到相应的数据框或数据集中，您就可以像使用相应的 API 一样轻松地提取和查询它们，就像使用任何DataFrame 或 Dataset 一样。查看我们的\u003ca href=\"https://databricks.com/blog/2017/04/26/processing-data-in-apache-kafka-with-structured-streaming-in-apache-spark-2-2.html\"\u003e结构化流体系列第3部分\u003c/a\u003e，其中展示了如何从 Apache Kafka 读取 Nest 设备日志并对其进行一些 ETL。\u003c/p\u003e\n","text":"https://docs.databricks.com/_static/notebooks/complex-nested-structured.html\n虽然这个深入的博客列出并解释了处理和处理复杂数据类型和格式的概念和动机，但这个笔记本示例通过几个具体示例检查了如何将它们应用于您在使用中可能遇到的数据类型案例。这个简短的笔记本教程展示了一些方法，您可以在其中探索和使用许多新的帮助程序 Spark SQL 实用程序函数和 API 作为org.apache.spark.sql.functions 包的一部分。特别是，它们在执行 Streaming ETL 时派上用场，其中数据是具有复杂和嵌套结构的 JSON 对象：嵌入为 JSON 的 Map 和 Structs：\n_ get_json_object()\n_ from_json()\n_ to_json()\n_ explode()\n_ selectExpr()\n本简短教程的内容是使用 Spark SQL 实用程序函数对嵌套 JSON 结构进行切片和切块的无数方法。\n让我们创建一个带有属性和值的简单 JSON 模式，而不使用任何嵌套结构。\nimport org.apache.spark.sql.types._ // include the Spark Types to define our schema import org.apache.spark.sql.functions._ // include the Spark helper functions val jsonSchema = new StructType() .add(\u0026#34;battery_level\u0026#34;, LongType) .add(\u0026#34;c02_level\u0026#34;, LongType) .add(\u0026#34;cca3\u0026#34;,StringType) .add(\u0026#34;cn\u0026#34;, StringType) .add(\u0026#34;device_id\u0026#34;, LongType) .add(\u0026#34;device_type\u0026#34;, StringType) .add(\u0026#34;signal\u0026#34;, LongType) .add(\u0026#34;ip\u0026#34;, StringType) .add(\u0026#34;temp\u0026#34;, LongType) .add(\u0026#34;timestamp\u0026#34;, TimestampType) import org.apache.spark.sql.types._ import org.apache.spark.sql.functions._ jsonSchema: org.apache.spark.sql.types.StructType = StructType(StructField(battery_level,LongType,true), StructField(c02_level,LongType,true), StructField(cca3,StringType,true), StructField(cn,StringType,true), StructField(device_id,LongType,true), StructField(device_type,StringType,true), StructField(signal,LongType,true), StructField(ip,StringType,true), StructField(temp,LongType,true), StructField(timestamp,TimestampType,true)) 使用上面的模式，创建一个表示为 Scala case 类的 Dataset，并生成与之关联的一些 JSON 数据。很可能，这个 JSON 也可能是从 Kafka 主题读取的设备事件流。请注意，case 类有两个字段：integer（作为设备ID）和 string（作为表示设备事件的 JSON 字符串）。\n从上面的 schema 创建 Dataset // define a case class case class DeviceData (id: Int, device: String) // create some sample data val eventsDS = Seq ( (0, \u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 0, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;68.161.225.1\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 25, \u0026#34;signal\u0026#34;: 23, \u0026#34;battery_level\u0026#34;: 8, \u0026#34;c02_level\u0026#34;: 917, \u0026#34;timestamp\u0026#34; :1475600496 }\u0026#34;\u0026#34;\u0026#34;), (1, \u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 1, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-igauge\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;213.161.254.1\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;NOR\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;Norway\u0026#34;, \u0026#34;temp\u0026#34;: 30, \u0026#34;signal\u0026#34;: 18, \u0026#34;battery_level\u0026#34;: 6, \u0026#34;c02_level\u0026#34;: 1413, \u0026#34;timestamp\u0026#34; :1475600498 }\u0026#34;\u0026#34;\u0026#34;), (2, \u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 2, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;88.36.5.1\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;ITA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;Italy\u0026#34;, \u0026#34;temp\u0026#34;: 18, \u0026#34;signal\u0026#34;: 25, \u0026#34;battery_level\u0026#34;: 5, \u0026#34;c02_level\u0026#34;: 1372, \u0026#34;timestamp\u0026#34; :1475600500 }\u0026#34;\u0026#34;\u0026#34;), (3, \u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 3, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-inest\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;66.39.173.154\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 47, \u0026#34;signal\u0026#34;: 12, \u0026#34;battery_level\u0026#34;: 1, \u0026#34;c02_level\u0026#34;: 1447, \u0026#34;timestamp\u0026#34; :1475600502 }\u0026#34;\u0026#34;\u0026#34;), (4, \u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 4, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;203.82.41.9\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;PHL\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;Philippines\u0026#34;, \u0026#34;temp\u0026#34;: 29, \u0026#34;signal\u0026#34;: 11, \u0026#34;battery_level\u0026#34;: 0, \u0026#34;c02_level\u0026#34;: 983, \u0026#34;timestamp\u0026#34; :1475600504 }\u0026#34;\u0026#34;\u0026#34;), (5, \u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 5, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-istick\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;204.116.105.67\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 50, \u0026#34;signal\u0026#34;: 16, \u0026#34;battery_level\u0026#34;: 8, \u0026#34;c02_level\u0026#34;: 1574, \u0026#34;timestamp\u0026#34; :1475600506 }\u0026#34;\u0026#34;\u0026#34;), (6, \u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 6, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;220.173.179.1\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;CHN\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;China\u0026#34;, \u0026#34;temp\u0026#34;: 21, \u0026#34;signal\u0026#34;: 18, \u0026#34;battery_level\u0026#34;: 9, \u0026#34;c02_level\u0026#34;: 1249, \u0026#34;timestamp\u0026#34; :1475600508 }\u0026#34;\u0026#34;\u0026#34;), (7, \u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 7, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;118.23.68.227\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;JPN\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;Japan\u0026#34;, \u0026#34;temp\u0026#34;: 27, \u0026#34;signal\u0026#34;: 15, \u0026#34;battery_level\u0026#34;: 0, \u0026#34;c02_level\u0026#34;: 1531, \u0026#34;timestamp\u0026#34; :1475600512 }\u0026#34;\u0026#34;\u0026#34;), (8 ,\u0026#34;\u0026#34;\u0026#34; {\u0026#34;device_id\u0026#34;: 8, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-inest\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;208.109.163.218\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 40, \u0026#34;signal\u0026#34;: 16, \u0026#34;battery_level\u0026#34;: 9, \u0026#34;c02_level\u0026#34;: 1208, \u0026#34;timestamp\u0026#34; :1475600514 }\u0026#34;\u0026#34;\u0026#34;), (9,\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 9, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;88.213.191.34\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;ITA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;Italy\u0026#34;, \u0026#34;temp\u0026#34;: 19, \u0026#34;signal\u0026#34;: 11, \u0026#34;battery_level\u0026#34;: 0, \u0026#34;c02_level\u0026#34;: 1171, \u0026#34;timestamp\u0026#34; :1475600516 }\u0026#34;\u0026#34;\u0026#34;), (10,\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 10, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-igauge\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;68.28.91.22\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 32, \u0026#34;signal\u0026#34;: 26, \u0026#34;battery_level\u0026#34;: 7, \u0026#34;c02_level\u0026#34;: 886, \u0026#34;timestamp\u0026#34; :1475600518 }\u0026#34;\u0026#34;\u0026#34;), (11,\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 11, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;59.144.114.250\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;IND\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;India\u0026#34;, \u0026#34;temp\u0026#34;: 46, \u0026#34;signal\u0026#34;: 25, \u0026#34;battery_level\u0026#34;: 4, \u0026#34;c02_level\u0026#34;: 863, \u0026#34;timestamp\u0026#34; :1475600520 }\u0026#34;\u0026#34;\u0026#34;), (12, \u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 12, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-igauge\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;193.156.90.200\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;NOR\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;Norway\u0026#34;, \u0026#34;temp\u0026#34;: 18, \u0026#34;signal\u0026#34;: 26, \u0026#34;battery_level\u0026#34;: 8, \u0026#34;c02_level\u0026#34;: 1220, \u0026#34;timestamp\u0026#34; :1475600522 }\u0026#34;\u0026#34;\u0026#34;), (13, \u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 13, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;67.185.72.1\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 34, \u0026#34;signal\u0026#34;: 20, \u0026#34;battery_level\u0026#34;: 8, \u0026#34;c02_level\u0026#34;: 1504, \u0026#34;timestamp\u0026#34; :1475600524 }\u0026#34;\u0026#34;\u0026#34;), (14, \u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 14, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-inest\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;68.85.85.106\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 39, \u0026#34;signal\u0026#34;: 17, \u0026#34;battery_level\u0026#34;: 8, \u0026#34;c02_level\u0026#34;: 831, \u0026#34;timestamp\u0026#34; :1475600526 }\u0026#34;\u0026#34;\u0026#34;), (15, \u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 15, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;161.188.212.254\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 27, \u0026#34;signal\u0026#34;: 26, \u0026#34;battery_level\u0026#34;: 5, \u0026#34;c02_level\u0026#34;: 1378, \u0026#34;timestamp\u0026#34; :1475600528 }\u0026#34;\u0026#34;\u0026#34;), (16, \u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 16, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-igauge\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;221.3.128.242\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;CHN\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;China\u0026#34;, \u0026#34;temp\u0026#34;: 10, \u0026#34;signal\u0026#34;: 24, \u0026#34;battery_level\u0026#34;: 6, \u0026#34;c02_level\u0026#34;: 1423, \u0026#34;timestamp\u0026#34; :1475600530 }\u0026#34;\u0026#34;\u0026#34;), (17, \u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 17, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;64.124.180.215\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 38, \u0026#34;signal\u0026#34;: 17, \u0026#34;battery_level\u0026#34;: 9, \u0026#34;c02_level\u0026#34;: 1304, \u0026#34;timestamp\u0026#34; :1475600532 }\u0026#34;\u0026#34;\u0026#34;), (18, \u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 18, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-igauge\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;66.153.162.66\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 26, \u0026#34;signal\u0026#34;: 10, \u0026#34;battery_level\u0026#34;: 0, \u0026#34;c02_level\u0026#34;: 902, \u0026#34;timestamp\u0026#34; :1475600534 }\u0026#34;\u0026#34;\u0026#34;), (19, \u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 19, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;193.200.142.254\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;AUT\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;Austria\u0026#34;, \u0026#34;temp\u0026#34;: 32, \u0026#34;signal\u0026#34;: 27, \u0026#34;battery_level\u0026#34;: 5, \u0026#34;c02_level\u0026#34;: 1282, \u0026#34;timestamp\u0026#34; :1475600536 }\u0026#34;\u0026#34;\u0026#34;)).toDF(\u0026#34;id\u0026#34;, \u0026#34;device\u0026#34;).as[DeviceData] defined class DeviceData eventsDS: org.apache.spark.sql.Dataset[DeviceData] = [id: int, device: string] 我们的 Dataset 是 Scala case 类的集合，当显示为 DataFrame 时，有两列 (id, string)\ndisplay(eventsDS) id device 0 {\u0026ldquo;device_id\u0026rdquo;: 0, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;68.161.225.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 25, \u0026ldquo;signal\u0026rdquo;: 23, \u0026ldquo;battery_level\u0026rdquo;: 8, \u0026ldquo;c02_level\u0026rdquo;: 917, \u0026ldquo;timestamp\u0026rdquo; :1475600496 } 1 {\u0026ldquo;device_id\u0026rdquo;: 1, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-igauge\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;213.161.254.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;NOR\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Norway\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 30, \u0026ldquo;signal\u0026rdquo;: 18, \u0026ldquo;battery_level\u0026rdquo;: 6, \u0026ldquo;c02_level\u0026rdquo;: 1413, \u0026ldquo;timestamp\u0026rdquo; :1475600498 } 2 {\u0026ldquo;device_id\u0026rdquo;: 2, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;88.36.5.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;ITA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Italy\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 18, \u0026ldquo;signal\u0026rdquo;: 25, \u0026ldquo;battery_level\u0026rdquo;: 5, \u0026ldquo;c02_level\u0026rdquo;: 1372, \u0026ldquo;timestamp\u0026rdquo; :1475600500 } 3 {\u0026ldquo;device_id\u0026rdquo;: 3, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-inest\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;66.39.173.154\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 47, \u0026ldquo;signal\u0026rdquo;: 12, \u0026ldquo;battery_level\u0026rdquo;: 1, \u0026ldquo;c02_level\u0026rdquo;: 1447, \u0026ldquo;timestamp\u0026rdquo; :1475600502 } 4 {\u0026ldquo;device_id\u0026rdquo;: 4, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;203.82.41.9\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;PHL\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Philippines\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 29, \u0026ldquo;signal\u0026rdquo;: 11, \u0026ldquo;battery_level\u0026rdquo;: 0, \u0026ldquo;c02_level\u0026rdquo;: 983, \u0026ldquo;timestamp\u0026rdquo; :1475600504 } 5 {\u0026ldquo;device_id\u0026rdquo;: 5, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-istick\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;204.116.105.67\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 50, \u0026ldquo;signal\u0026rdquo;: 16, \u0026ldquo;battery_level\u0026rdquo;: 8, \u0026ldquo;c02_level\u0026rdquo;: 1574, \u0026ldquo;timestamp\u0026rdquo; :1475600506 } 6 {\u0026ldquo;device_id\u0026rdquo;: 6, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;220.173.179.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;CHN\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;China\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 21, \u0026ldquo;signal\u0026rdquo;: 18, \u0026ldquo;battery_level\u0026rdquo;: 9, \u0026ldquo;c02_level\u0026rdquo;: 1249, \u0026ldquo;timestamp\u0026rdquo; :1475600508 } 7 {\u0026ldquo;device_id\u0026rdquo;: 7, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;118.23.68.227\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;JPN\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Japan\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 27, \u0026ldquo;signal\u0026rdquo;: 15, \u0026ldquo;battery_level\u0026rdquo;: 0, \u0026ldquo;c02_level\u0026rdquo;: 1531, \u0026ldquo;timestamp\u0026rdquo; :1475600512 } 8 {\u0026ldquo;device_id\u0026rdquo;: 8, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-inest\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;208.109.163.218\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 40, \u0026ldquo;signal\u0026rdquo;: 16, \u0026ldquo;battery_level\u0026rdquo;: 9, \u0026ldquo;c02_level\u0026rdquo;: 1208, \u0026ldquo;timestamp\u0026rdquo; :1475600514 } 9 {\u0026ldquo;device_id\u0026rdquo;: 9, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;88.213.191.34\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;ITA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Italy\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 19, \u0026ldquo;signal\u0026rdquo;: 11, \u0026ldquo;battery_level\u0026rdquo;: 0, \u0026ldquo;c02_level\u0026rdquo;: 1171, \u0026ldquo;timestamp\u0026rdquo; :1475600516 } 10 {\u0026ldquo;device_id\u0026rdquo;: 10, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-igauge\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;68.28.91.22\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 32, \u0026ldquo;signal\u0026rdquo;: 26, \u0026ldquo;battery_level\u0026rdquo;: 7, \u0026ldquo;c02_level\u0026rdquo;: 886, \u0026ldquo;timestamp\u0026rdquo; :1475600518 } 11 {\u0026ldquo;device_id\u0026rdquo;: 11, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;59.144.114.250\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;IND\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;India\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 46, \u0026ldquo;signal\u0026rdquo;: 25, \u0026ldquo;battery_level\u0026rdquo;: 4, \u0026ldquo;c02_level\u0026rdquo;: 863, \u0026ldquo;timestamp\u0026rdquo; :1475600520 } 12 {\u0026ldquo;device_id\u0026rdquo;: 12, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-igauge\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;193.156.90.200\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;NOR\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Norway\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 18, \u0026ldquo;signal\u0026rdquo;: 26, \u0026ldquo;battery_level\u0026rdquo;: 8, \u0026ldquo;c02_level\u0026rdquo;: 1220, \u0026ldquo;timestamp\u0026rdquo; :1475600522 } 13 {\u0026ldquo;device_id\u0026rdquo;: 13, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;67.185.72.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 34, \u0026ldquo;signal\u0026rdquo;: 20, \u0026ldquo;battery_level\u0026rdquo;: 8, \u0026ldquo;c02_level\u0026rdquo;: 1504, \u0026ldquo;timestamp\u0026rdquo; :1475600524 } 14 {\u0026ldquo;device_id\u0026rdquo;: 14, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-inest\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;68.85.85.106\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 39, \u0026ldquo;signal\u0026rdquo;: 17, \u0026ldquo;battery_level\u0026rdquo;: 8, \u0026ldquo;c02_level\u0026rdquo;: 831, \u0026ldquo;timestamp\u0026rdquo; :1475600526 } 15 {\u0026ldquo;device_id\u0026rdquo;: 15, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;161.188.212.254\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 27, \u0026ldquo;signal\u0026rdquo;: 26, \u0026ldquo;battery_level\u0026rdquo;: 5, \u0026ldquo;c02_level\u0026rdquo;: 1378, \u0026ldquo;timestamp\u0026rdquo; :1475600528 } 16 {\u0026ldquo;device_id\u0026rdquo;: 16, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-igauge\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;221.3.128.242\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;CHN\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;China\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 10, \u0026ldquo;signal\u0026rdquo;: 24, \u0026ldquo;battery_level\u0026rdquo;: 6, \u0026ldquo;c02_level\u0026rdquo;: 1423, \u0026ldquo;timestamp\u0026rdquo; :1475600530 } 17 {\u0026ldquo;device_id\u0026rdquo;: 17, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;64.124.180.215\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 38, \u0026ldquo;signal\u0026rdquo;: 17, \u0026ldquo;battery_level\u0026rdquo;: 9, \u0026ldquo;c02_level\u0026rdquo;: 1304, \u0026ldquo;timestamp\u0026rdquo; :1475600532 } 18 {\u0026ldquo;device_id\u0026rdquo;: 18, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-igauge\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;66.153.162.66\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 26, \u0026ldquo;signal\u0026rdquo;: 10, \u0026ldquo;battery_level\u0026rdquo;: 0, \u0026ldquo;c02_level\u0026rdquo;: 902, \u0026ldquo;timestamp\u0026rdquo; :1475600534 } 19 {\u0026ldquo;device_id\u0026rdquo;: 19, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;193.200.142.254\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;AUT\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Austria\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 32, \u0026ldquo;signal\u0026rdquo;: 27, \u0026ldquo;battery_level\u0026rdquo;: 5, \u0026ldquo;c02_level\u0026rdquo;: 1282, \u0026ldquo;timestamp\u0026rdquo; :1475600536 } 打印 schema 将测试为两列，类型为 integer 和 string，反映了 Scala case 类。\neventsDS.printSchema root |-- id: integer (nullable = false) |-- device: string (nullable = true) 如何使用 get_json_object() 此方法基于指定的 JSON 路径从 JSON 字符串中提取 JSON 对象，并返回 JSON 字符串作为提取的 JSON 对象。以上面 Dataset 的小例子为例，我们希望从中提取构成 JSON 对象字符串的数据值部分。假设您只想提取 id，device_type，ip 和 CCA3 代码。这是使用 get_json_object() 快速完成的方法。\nval eventsFromJSONDF = Seq ( (0, \u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 0, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;68.161.225.1\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 25, \u0026#34;signal\u0026#34;: 23, \u0026#34;battery_level\u0026#34;: 8, \u0026#34;c02_level\u0026#34;: 917, \u0026#34;timestamp\u0026#34; :1475600496 }\u0026#34;\u0026#34;\u0026#34;), (1, \u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 1, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-igauge\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;213.161.254.1\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;NOR\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;Norway\u0026#34;, \u0026#34;temp\u0026#34;: 30, \u0026#34;signal\u0026#34;: 18, \u0026#34;battery_level\u0026#34;: 6, \u0026#34;c02_level\u0026#34;: 1413, \u0026#34;timestamp\u0026#34; :1475600498 }\u0026#34;\u0026#34;\u0026#34;), (2, \u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 2, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;88.36.5.1\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;ITA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;Italy\u0026#34;, \u0026#34;temp\u0026#34;: 18, \u0026#34;signal\u0026#34;: 25, \u0026#34;battery_level\u0026#34;: 5, \u0026#34;c02_level\u0026#34;: 1372, \u0026#34;timestamp\u0026#34; :1475600500 }\u0026#34;\u0026#34;\u0026#34;), (3, \u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 3, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-inest\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;66.39.173.154\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 47, \u0026#34;signal\u0026#34;: 12, \u0026#34;battery_level\u0026#34;: 1, \u0026#34;c02_level\u0026#34;: 1447, \u0026#34;timestamp\u0026#34; :1475600502 }\u0026#34;\u0026#34;\u0026#34;), (4, \u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 4, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;203.82.41.9\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;PHL\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;Philippines\u0026#34;, \u0026#34;temp\u0026#34;: 29, \u0026#34;signal\u0026#34;: 11, \u0026#34;battery_level\u0026#34;: 0, \u0026#34;c02_level\u0026#34;: 983, \u0026#34;timestamp\u0026#34; :1475600504 }\u0026#34;\u0026#34;\u0026#34;), (5, \u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 5, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-istick\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;204.116.105.67\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 50, \u0026#34;signal\u0026#34;: 16, \u0026#34;battery_level\u0026#34;: 8, \u0026#34;c02_level\u0026#34;: 1574, \u0026#34;timestamp\u0026#34; :1475600506 }\u0026#34;\u0026#34;\u0026#34;), (6, \u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 6, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;220.173.179.1\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;CHN\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;China\u0026#34;, \u0026#34;temp\u0026#34;: 21, \u0026#34;signal\u0026#34;: 18, \u0026#34;battery_level\u0026#34;: 9, \u0026#34;c02_level\u0026#34;: 1249, \u0026#34;timestamp\u0026#34; :1475600508 }\u0026#34;\u0026#34;\u0026#34;), (7, \u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 7, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;118.23.68.227\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;JPN\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;Japan\u0026#34;, \u0026#34;temp\u0026#34;: 27, \u0026#34;signal\u0026#34;: 15, \u0026#34;battery_level\u0026#34;: 0, \u0026#34;c02_level\u0026#34;: 1531, \u0026#34;timestamp\u0026#34; :1475600512 }\u0026#34;\u0026#34;\u0026#34;), (8 ,\u0026#34;\u0026#34;\u0026#34; {\u0026#34;device_id\u0026#34;: 8, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-inest\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;208.109.163.218\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;USA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;United States\u0026#34;, \u0026#34;temp\u0026#34;: 40, \u0026#34;signal\u0026#34;: 16, \u0026#34;battery_level\u0026#34;: 9, \u0026#34;c02_level\u0026#34;: 1208, \u0026#34;timestamp\u0026#34; :1475600514 }\u0026#34;\u0026#34;\u0026#34;), (9,\u0026#34;\u0026#34;\u0026#34;{\u0026#34;device_id\u0026#34;: 9, \u0026#34;device_type\u0026#34;: \u0026#34;sensor-ipad\u0026#34;, \u0026#34;ip\u0026#34;: \u0026#34;88.213.191.34\u0026#34;, \u0026#34;cca3\u0026#34;: \u0026#34;ITA\u0026#34;, \u0026#34;cn\u0026#34;: \u0026#34;Italy\u0026#34;, \u0026#34;temp\u0026#34;: 19, \u0026#34;signal\u0026#34;: 11, \u0026#34;battery_level\u0026#34;: 0, \u0026#34;c02_level\u0026#34;: 1171, \u0026#34;timestamp\u0026#34; :1475600516 }\u0026#34;\u0026#34;\u0026#34;)).toDF(\u0026#34;id\u0026#34;, \u0026#34;json\u0026#34;) eventsFromJSONDF: org.apache.spark.sql.DataFrame = [id: int, json: string] display(eventsFromJSONDF) id json 0 {\u0026ldquo;device_id\u0026rdquo;: 0, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;68.161.225.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 25, \u0026ldquo;signal\u0026rdquo;: 23, \u0026ldquo;battery_level\u0026rdquo;: 8, \u0026ldquo;c02_level\u0026rdquo;: 917, \u0026ldquo;timestamp\u0026rdquo; :1475600496 } 1 {\u0026ldquo;device_id\u0026rdquo;: 1, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-igauge\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;213.161.254.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;NOR\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Norway\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 30, \u0026ldquo;signal\u0026rdquo;: 18, \u0026ldquo;battery_level\u0026rdquo;: 6, \u0026ldquo;c02_level\u0026rdquo;: 1413, \u0026ldquo;timestamp\u0026rdquo; :1475600498 } 2 {\u0026ldquo;device_id\u0026rdquo;: 2, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;88.36.5.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;ITA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Italy\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 18, \u0026ldquo;signal\u0026rdquo;: 25, \u0026ldquo;battery_level\u0026rdquo;: 5, \u0026ldquo;c02_level\u0026rdquo;: 1372, \u0026ldquo;timestamp\u0026rdquo; :1475600500 } 3 {\u0026ldquo;device_id\u0026rdquo;: 3, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-inest\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;66.39.173.154\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 47, \u0026ldquo;signal\u0026rdquo;: 12, \u0026ldquo;battery_level\u0026rdquo;: 1, \u0026ldquo;c02_level\u0026rdquo;: 1447, \u0026ldquo;timestamp\u0026rdquo; :1475600502 } 4 {\u0026ldquo;device_id\u0026rdquo;: 4, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;203.82.41.9\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;PHL\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Philippines\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 29, \u0026ldquo;signal\u0026rdquo;: 11, \u0026ldquo;battery_level\u0026rdquo;: 0, \u0026ldquo;c02_level\u0026rdquo;: 983, \u0026ldquo;timestamp\u0026rdquo; :1475600504 } 5 {\u0026ldquo;device_id\u0026rdquo;: 5, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-istick\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;204.116.105.67\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 50, \u0026ldquo;signal\u0026rdquo;: 16, \u0026ldquo;battery_level\u0026rdquo;: 8, \u0026ldquo;c02_level\u0026rdquo;: 1574, \u0026ldquo;timestamp\u0026rdquo; :1475600506 } 6 {\u0026ldquo;device_id\u0026rdquo;: 6, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;220.173.179.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;CHN\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;China\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 21, \u0026ldquo;signal\u0026rdquo;: 18, \u0026ldquo;battery_level\u0026rdquo;: 9, \u0026ldquo;c02_level\u0026rdquo;: 1249, \u0026ldquo;timestamp\u0026rdquo; :1475600508 } 7 {\u0026ldquo;device_id\u0026rdquo;: 7, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;118.23.68.227\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;JPN\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Japan\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 27, \u0026ldquo;signal\u0026rdquo;: 15, \u0026ldquo;battery_level\u0026rdquo;: 0, \u0026ldquo;c02_level\u0026rdquo;: 1531, \u0026ldquo;timestamp\u0026rdquo; :1475600512 } 8 {\u0026ldquo;device_id\u0026rdquo;: 8, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-inest\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;208.109.163.218\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 40, \u0026ldquo;signal\u0026rdquo;: 16, \u0026ldquo;battery_level\u0026rdquo;: 9, \u0026ldquo;c02_level\u0026rdquo;: 1208, \u0026ldquo;timestamp\u0026rdquo; :1475600514 } 9 {\u0026ldquo;device_id\u0026rdquo;: 9, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;88.213.191.34\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;ITA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Italy\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 19, \u0026ldquo;signal\u0026rdquo;: 11, \u0026ldquo;battery_level\u0026rdquo;: 0, \u0026ldquo;c02_level\u0026rdquo;: 1171, \u0026ldquo;timestamp\u0026rdquo; :1475600516 } val jsDF = eventsFromJSONDF.select($\u0026#34;id\u0026#34;, get_json_object($\u0026#34;json\u0026#34;, \u0026#34;$.device_type\u0026#34;).alias(\u0026#34;device_type\u0026#34;), get_json_object($\u0026#34;json\u0026#34;, \u0026#34;$.ip\u0026#34;).alias(\u0026#34;ip\u0026#34;), get_json_object($\u0026#34;json\u0026#34;, \u0026#34;$.cca3\u0026#34;).alias(\u0026#34;cca3\u0026#34;)) jsDF: org.apache.spark.sql.DataFrame = [id: int, device_type: string ... 2 more fields] display(jsDF) id device_type ip cca3 0 sensor-ipad 68.161.225.1 USA 1 sensor-igauge 213.161.254.1 NOR 2 sensor-ipad 88.36.5.1 ITA 3 sensor-inest 66.39.173.154 USA 4 sensor-ipad 203.82.41.9 PHL 5 sensor-istick 204.116.105.67 USA 6 sensor-ipad 220.173.179.1 CHN 7 sensor-ipad 118.23.68.227 JPN 8 sensor-inest 208.109.163.218 USA 9 sensor-ipad 88.213.191.34 ITA 如何使用 from_json() get_json_object() 的变体，此函数使用 schema 提取单个列。在 select() Dataset API 调用中使用 from_json() 辅助函数，我可以将数据的属性和值从 JSON 字符串提取或解码为 DataFrame 作为列，由 schema 指定。在使用 schema 时，我将此 JSON 中所有关联的属性和值归为一类，以表示为实体设备。因此，您不仅可以使用 device.attribute 来检索其各自的值，还可以使用 * 表示法检索所有值。\n在下面的例子中：\n使用上面的 schema 从 JSON 字符串中提取属性和值，并将它们表示为单个列作为 devices 的一部分 select() 所有列 使用 . 记号过滤所需的属性 将 JSON 字符串中的数据提取到其各自的 DataFrame 列后，您可以应用 DataFrame/Dataset API 调用来选择，过滤和后续显示，令您满意。\nval devicesDF = eventsDS.select(from_json($\u0026#34;device\u0026#34;, jsonSchema) as \u0026#34;devices\u0026#34;) .select($\u0026#34;devices.*\u0026#34;) .filter($\u0026#34;devices.temp\u0026#34; \u0026gt; 10 and $\u0026#34;devices.signal\u0026#34; \u0026gt; 15) devicesDF: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [battery_level: bigint, c02_level: bigint ... 8 more fields] display(devicesDF) todo\nval devicesUSDF = devicesDF.select($\u0026#34;*\u0026#34;).where($\u0026#34;cca3\u0026#34; === \u0026#34;USA\u0026#34;).orderBy($\u0026#34;signal\u0026#34;.desc, $\u0026#34;temp\u0026#34;.desc) devicesUSDF: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [battery_level: bigint, c02_level: bigint ... 8 more fields] display(devicesUSDF) 如何使用 to_json() 现在，让我们反过来：您可以使用 to_json() 将我们过滤的设备转换或编码为 JSON 字符串。也就是说，将 JSON 结构转换为字符串。结果可以重新发布到例如 Kafka 或作为 parquet 文件保存在磁盘上。要了解如何写入 Kafka 和其他接收器，请阅读此博客和我们关于结构化流博客的系列。\nval stringJsonDF = eventsDS.select(to_json(struct($\u0026#34;*\u0026#34;))).toDF(\u0026#34;devices\u0026#34;) stringJsonDF: org.apache.spark.sql.DataFrame = [devices: string] display(stringJsonDF) devices {\u0026ldquo;id\u0026rdquo;:0,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 0, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-ipad\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;68.161.225.1\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;USA\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;United States\u0026quot;, \u0026quot;temp\u0026quot;: 25, \u0026quot;signal\u0026quot;: 23, \u0026quot;battery_level\u0026quot;: 8, \u0026quot;c02_level\u0026quot;: 917, \u0026quot;timestamp\u0026quot; :1475600496 }\u0026quot;} {\u0026ldquo;id\u0026rdquo;:1,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 1, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-igauge\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;213.161.254.1\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;NOR\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;Norway\u0026quot;, \u0026quot;temp\u0026quot;: 30, \u0026quot;signal\u0026quot;: 18, \u0026quot;battery_level\u0026quot;: 6, \u0026quot;c02_level\u0026quot;: 1413, \u0026quot;timestamp\u0026quot; :1475600498 }\u0026quot;} {\u0026ldquo;id\u0026rdquo;:2,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 2, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-ipad\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;88.36.5.1\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;ITA\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;Italy\u0026quot;, \u0026quot;temp\u0026quot;: 18, \u0026quot;signal\u0026quot;: 25, \u0026quot;battery_level\u0026quot;: 5, \u0026quot;c02_level\u0026quot;: 1372, \u0026quot;timestamp\u0026quot; :1475600500 }\u0026quot;} {\u0026ldquo;id\u0026rdquo;:3,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 3, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-inest\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;66.39.173.154\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;USA\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;United States\u0026quot;, \u0026quot;temp\u0026quot;: 47, \u0026quot;signal\u0026quot;: 12, \u0026quot;battery_level\u0026quot;: 1, \u0026quot;c02_level\u0026quot;: 1447, \u0026quot;timestamp\u0026quot; :1475600502 }\u0026quot;} {\u0026ldquo;id\u0026rdquo;:4,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 4, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-ipad\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;203.82.41.9\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;PHL\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;Philippines\u0026quot;, \u0026quot;temp\u0026quot;: 29, \u0026quot;signal\u0026quot;: 11, \u0026quot;battery_level\u0026quot;: 0, \u0026quot;c02_level\u0026quot;: 983, \u0026quot;timestamp\u0026quot; :1475600504 }\u0026quot;} {\u0026ldquo;id\u0026rdquo;:5,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 5, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-istick\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;204.116.105.67\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;USA\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;United States\u0026quot;, \u0026quot;temp\u0026quot;: 50, \u0026quot;signal\u0026quot;: 16, \u0026quot;battery_level\u0026quot;: 8, \u0026quot;c02_level\u0026quot;: 1574, \u0026quot;timestamp\u0026quot; :1475600506 }\u0026quot;} {\u0026ldquo;id\u0026rdquo;:6,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 6, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-ipad\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;220.173.179.1\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;CHN\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;China\u0026quot;, \u0026quot;temp\u0026quot;: 21, \u0026quot;signal\u0026quot;: 18, \u0026quot;battery_level\u0026quot;: 9, \u0026quot;c02_level\u0026quot;: 1249, \u0026quot;timestamp\u0026quot; :1475600508 }\u0026quot;} {\u0026ldquo;id\u0026rdquo;:7,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 7, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-ipad\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;118.23.68.227\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;JPN\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;Japan\u0026quot;, \u0026quot;temp\u0026quot;: 27, \u0026quot;signal\u0026quot;: 15, \u0026quot;battery_level\u0026quot;: 0, \u0026quot;c02_level\u0026quot;: 1531, \u0026quot;timestamp\u0026quot; :1475600512 }\u0026quot;} {\u0026ldquo;id\u0026rdquo;:8,\u0026ldquo;device\u0026rdquo;:\u0026quot; {\u0026quot;device_id\u0026quot;: 8, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-inest\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;208.109.163.218\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;USA\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;United States\u0026quot;, \u0026quot;temp\u0026quot;: 40, \u0026quot;signal\u0026quot;: 16, \u0026quot;battery_level\u0026quot;: 9, \u0026quot;c02_level\u0026quot;: 1208, \u0026quot;timestamp\u0026quot; :1475600514 }\u0026quot;} {\u0026ldquo;id\u0026rdquo;:9,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 9, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-ipad\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;88.213.191.34\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;ITA\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;Italy\u0026quot;, \u0026quot;temp\u0026quot;: 19, \u0026quot;signal\u0026quot;: 11, \u0026quot;battery_level\u0026quot;: 0, \u0026quot;c02_level\u0026quot;: 1171, \u0026quot;timestamp\u0026quot; :1475600516 }\u0026quot;} {\u0026ldquo;id\u0026rdquo;:10,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 10, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-igauge\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;68.28.91.22\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;USA\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;United States\u0026quot;, \u0026quot;temp\u0026quot;: 32, \u0026quot;signal\u0026quot;: 26, \u0026quot;battery_level\u0026quot;: 7, \u0026quot;c02_level\u0026quot;: 886, \u0026quot;timestamp\u0026quot; :1475600518 }\u0026quot;} {\u0026ldquo;id\u0026rdquo;:11,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 11, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-ipad\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;59.144.114.250\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;IND\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;India\u0026quot;, \u0026quot;temp\u0026quot;: 46, \u0026quot;signal\u0026quot;: 25, \u0026quot;battery_level\u0026quot;: 4, \u0026quot;c02_level\u0026quot;: 863, \u0026quot;timestamp\u0026quot; :1475600520 }\u0026quot;} {\u0026ldquo;id\u0026rdquo;:12,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 12, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-igauge\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;193.156.90.200\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;NOR\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;Norway\u0026quot;, \u0026quot;temp\u0026quot;: 18, \u0026quot;signal\u0026quot;: 26, \u0026quot;battery_level\u0026quot;: 8, \u0026quot;c02_level\u0026quot;: 1220, \u0026quot;timestamp\u0026quot; :1475600522 }\u0026quot;} {\u0026ldquo;id\u0026rdquo;:13,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 13, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-ipad\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;67.185.72.1\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;USA\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;United States\u0026quot;, \u0026quot;temp\u0026quot;: 34, \u0026quot;signal\u0026quot;: 20, \u0026quot;battery_level\u0026quot;: 8, \u0026quot;c02_level\u0026quot;: 1504, \u0026quot;timestamp\u0026quot; :1475600524 }\u0026quot;} {\u0026ldquo;id\u0026rdquo;:14,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 14, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-inest\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;68.85.85.106\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;USA\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;United States\u0026quot;, \u0026quot;temp\u0026quot;: 39, \u0026quot;signal\u0026quot;: 17, \u0026quot;battery_level\u0026quot;: 8, \u0026quot;c02_level\u0026quot;: 831, \u0026quot;timestamp\u0026quot; :1475600526 }\u0026quot;} {\u0026ldquo;id\u0026rdquo;:15,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 15, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-ipad\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;161.188.212.254\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;USA\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;United States\u0026quot;, \u0026quot;temp\u0026quot;: 27, \u0026quot;signal\u0026quot;: 26, \u0026quot;battery_level\u0026quot;: 5, \u0026quot;c02_level\u0026quot;: 1378, \u0026quot;timestamp\u0026quot; :1475600528 }\u0026quot;} {\u0026ldquo;id\u0026rdquo;:16,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 16, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-igauge\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;221.3.128.242\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;CHN\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;China\u0026quot;, \u0026quot;temp\u0026quot;: 10, \u0026quot;signal\u0026quot;: 24, \u0026quot;battery_level\u0026quot;: 6, \u0026quot;c02_level\u0026quot;: 1423, \u0026quot;timestamp\u0026quot; :1475600530 }\u0026quot;} {\u0026ldquo;id\u0026rdquo;:17,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 17, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-ipad\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;64.124.180.215\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;USA\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;United States\u0026quot;, \u0026quot;temp\u0026quot;: 38, \u0026quot;signal\u0026quot;: 17, \u0026quot;battery_level\u0026quot;: 9, \u0026quot;c02_level\u0026quot;: 1304, \u0026quot;timestamp\u0026quot; :1475600532 }\u0026quot;} {\u0026ldquo;id\u0026rdquo;:18,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 18, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-igauge\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;66.153.162.66\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;USA\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;United States\u0026quot;, \u0026quot;temp\u0026quot;: 26, \u0026quot;signal\u0026quot;: 10, \u0026quot;battery_level\u0026quot;: 0, \u0026quot;c02_level\u0026quot;: 902, \u0026quot;timestamp\u0026quot; :1475600534 }\u0026quot;} {\u0026ldquo;id\u0026rdquo;:19,\u0026ldquo;device\u0026rdquo;:\u0026quot;{\u0026quot;device_id\u0026quot;: 19, \u0026quot;device_type\u0026quot;: \u0026quot;sensor-ipad\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;193.200.142.254\u0026quot;, \u0026quot;cca3\u0026quot;: \u0026quot;AUT\u0026quot;, \u0026quot;cn\u0026quot;: \u0026quot;Austria\u0026quot;, \u0026quot;temp\u0026quot;: 32, \u0026quot;signal\u0026quot;: 27, \u0026quot;battery_level\u0026quot;: 5, \u0026quot;c02_level\u0026quot;: 1282, \u0026quot;timestamp\u0026quot; :1475600536 }\u0026quot;} 假设你有一个在指定端口运行的 Kafka 集群和相应的主题，让我们写一下 Kafka 主题。\nstringJsonDF.write .format(\u0026#34;kafka\u0026#34;) .option(\u0026#34;kafka.bootstrap.servers\u0026#34;, \u0026#34;your_host_name:9092\u0026#34;) .option(\u0026#34;topic\u0026#34;, \u0026#34;iot-devices\u0026#34;) .save() org.apache.spark.sql.AnalysisException: Required attribute \u0026#39;value\u0026#39; not found; 如何使用 selectExpr() 将列转换或编码为 JSON 对象作为字符串的另一种方法是使用 selectExpr() 实用程序函数。例如，我可以将 DataFrame 的 “device” 列从上面转换为 JSON 字符串\nval stringsDF = eventsDS.selectExpr(\u0026#34;CAST(id AS INT)\u0026#34;, \u0026#34;CAST(device AS STRING)\u0026#34;) stringsDF: org.apache.spark.sql.DataFrame = [id: int, device: string] stringsDF.printSchema root |-- id: integer (nullable = false) |-- device: string (nullable = true) display(stringsDF) id device 0 {\u0026ldquo;device_id\u0026rdquo;: 0, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;68.161.225.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 25, \u0026ldquo;signal\u0026rdquo;: 23, \u0026ldquo;battery_level\u0026rdquo;: 8, \u0026ldquo;c02_level\u0026rdquo;: 917, \u0026ldquo;timestamp\u0026rdquo; :1475600496 } 1 {\u0026ldquo;device_id\u0026rdquo;: 1, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-igauge\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;213.161.254.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;NOR\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Norway\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 30, \u0026ldquo;signal\u0026rdquo;: 18, \u0026ldquo;battery_level\u0026rdquo;: 6, \u0026ldquo;c02_level\u0026rdquo;: 1413, \u0026ldquo;timestamp\u0026rdquo; :1475600498 } 2 {\u0026ldquo;device_id\u0026rdquo;: 2, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;88.36.5.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;ITA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Italy\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 18, \u0026ldquo;signal\u0026rdquo;: 25, \u0026ldquo;battery_level\u0026rdquo;: 5, \u0026ldquo;c02_level\u0026rdquo;: 1372, \u0026ldquo;timestamp\u0026rdquo; :1475600500 } 3 {\u0026ldquo;device_id\u0026rdquo;: 3, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-inest\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;66.39.173.154\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 47, \u0026ldquo;signal\u0026rdquo;: 12, \u0026ldquo;battery_level\u0026rdquo;: 1, \u0026ldquo;c02_level\u0026rdquo;: 1447, \u0026ldquo;timestamp\u0026rdquo; :1475600502 } 4 {\u0026ldquo;device_id\u0026rdquo;: 4, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;203.82.41.9\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;PHL\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Philippines\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 29, \u0026ldquo;signal\u0026rdquo;: 11, \u0026ldquo;battery_level\u0026rdquo;: 0, \u0026ldquo;c02_level\u0026rdquo;: 983, \u0026ldquo;timestamp\u0026rdquo; :1475600504 } 5 {\u0026ldquo;device_id\u0026rdquo;: 5, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-istick\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;204.116.105.67\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 50, \u0026ldquo;signal\u0026rdquo;: 16, \u0026ldquo;battery_level\u0026rdquo;: 8, \u0026ldquo;c02_level\u0026rdquo;: 1574, \u0026ldquo;timestamp\u0026rdquo; :1475600506 } 6 {\u0026ldquo;device_id\u0026rdquo;: 6, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;220.173.179.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;CHN\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;China\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 21, \u0026ldquo;signal\u0026rdquo;: 18, \u0026ldquo;battery_level\u0026rdquo;: 9, \u0026ldquo;c02_level\u0026rdquo;: 1249, \u0026ldquo;timestamp\u0026rdquo; :1475600508 } 7 {\u0026ldquo;device_id\u0026rdquo;: 7, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;118.23.68.227\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;JPN\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Japan\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 27, \u0026ldquo;signal\u0026rdquo;: 15, \u0026ldquo;battery_level\u0026rdquo;: 0, \u0026ldquo;c02_level\u0026rdquo;: 1531, \u0026ldquo;timestamp\u0026rdquo; :1475600512 } 8 {\u0026ldquo;device_id\u0026rdquo;: 8, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-inest\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;208.109.163.218\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 40, \u0026ldquo;signal\u0026rdquo;: 16, \u0026ldquo;battery_level\u0026rdquo;: 9, \u0026ldquo;c02_level\u0026rdquo;: 1208, \u0026ldquo;timestamp\u0026rdquo; :1475600514 } 9 {\u0026ldquo;device_id\u0026rdquo;: 9, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;88.213.191.34\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;ITA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Italy\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 19, \u0026ldquo;signal\u0026rdquo;: 11, \u0026ldquo;battery_level\u0026rdquo;: 0, \u0026ldquo;c02_level\u0026rdquo;: 1171, \u0026ldquo;timestamp\u0026rdquo; :1475600516 } 10 {\u0026ldquo;device_id\u0026rdquo;: 10, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-igauge\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;68.28.91.22\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 32, \u0026ldquo;signal\u0026rdquo;: 26, \u0026ldquo;battery_level\u0026rdquo;: 7, \u0026ldquo;c02_level\u0026rdquo;: 886, \u0026ldquo;timestamp\u0026rdquo; :1475600518 } 11 {\u0026ldquo;device_id\u0026rdquo;: 11, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;59.144.114.250\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;IND\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;India\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 46, \u0026ldquo;signal\u0026rdquo;: 25, \u0026ldquo;battery_level\u0026rdquo;: 4, \u0026ldquo;c02_level\u0026rdquo;: 863, \u0026ldquo;timestamp\u0026rdquo; :1475600520 } 12 {\u0026ldquo;device_id\u0026rdquo;: 12, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-igauge\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;193.156.90.200\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;NOR\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Norway\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 18, \u0026ldquo;signal\u0026rdquo;: 26, \u0026ldquo;battery_level\u0026rdquo;: 8, \u0026ldquo;c02_level\u0026rdquo;: 1220, \u0026ldquo;timestamp\u0026rdquo; :1475600522 } 13 {\u0026ldquo;device_id\u0026rdquo;: 13, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;67.185.72.1\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 34, \u0026ldquo;signal\u0026rdquo;: 20, \u0026ldquo;battery_level\u0026rdquo;: 8, \u0026ldquo;c02_level\u0026rdquo;: 1504, \u0026ldquo;timestamp\u0026rdquo; :1475600524 } 14 {\u0026ldquo;device_id\u0026rdquo;: 14, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-inest\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;68.85.85.106\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 39, \u0026ldquo;signal\u0026rdquo;: 17, \u0026ldquo;battery_level\u0026rdquo;: 8, \u0026ldquo;c02_level\u0026rdquo;: 831, \u0026ldquo;timestamp\u0026rdquo; :1475600526 } 15 {\u0026ldquo;device_id\u0026rdquo;: 15, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;161.188.212.254\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 27, \u0026ldquo;signal\u0026rdquo;: 26, \u0026ldquo;battery_level\u0026rdquo;: 5, \u0026ldquo;c02_level\u0026rdquo;: 1378, \u0026ldquo;timestamp\u0026rdquo; :1475600528 } 16 {\u0026ldquo;device_id\u0026rdquo;: 16, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-igauge\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;221.3.128.242\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;CHN\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;China\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 10, \u0026ldquo;signal\u0026rdquo;: 24, \u0026ldquo;battery_level\u0026rdquo;: 6, \u0026ldquo;c02_level\u0026rdquo;: 1423, \u0026ldquo;timestamp\u0026rdquo; :1475600530 } 17 {\u0026ldquo;device_id\u0026rdquo;: 17, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;64.124.180.215\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 38, \u0026ldquo;signal\u0026rdquo;: 17, \u0026ldquo;battery_level\u0026rdquo;: 9, \u0026ldquo;c02_level\u0026rdquo;: 1304, \u0026ldquo;timestamp\u0026rdquo; :1475600532 } 18 {\u0026ldquo;device_id\u0026rdquo;: 18, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-igauge\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;66.153.162.66\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;USA\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;United States\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 26, \u0026ldquo;signal\u0026rdquo;: 10, \u0026ldquo;battery_level\u0026rdquo;: 0, \u0026ldquo;c02_level\u0026rdquo;: 902, \u0026ldquo;timestamp\u0026rdquo; :1475600534 } 19 {\u0026ldquo;device_id\u0026rdquo;: 19, \u0026ldquo;device_type\u0026rdquo;: \u0026ldquo;sensor-ipad\u0026rdquo;, \u0026ldquo;ip\u0026rdquo;: \u0026ldquo;193.200.142.254\u0026rdquo;, \u0026ldquo;cca3\u0026rdquo;: \u0026ldquo;AUT\u0026rdquo;, \u0026ldquo;cn\u0026rdquo;: \u0026ldquo;Austria\u0026rdquo;, \u0026ldquo;temp\u0026rdquo;: 32, \u0026ldquo;signal\u0026rdquo;: 27, \u0026ldquo;battery_level\u0026rdquo;: 5, \u0026ldquo;c02_level\u0026rdquo;: 1282, \u0026ldquo;timestamp\u0026rdquo; :1475600536 } selectExpr() 的另一个用途是它的功能，正如函数名所示，它将表达式作为参数并将它们转换为相应的列。例如，假设我想表达c02水平和温度比。\ndisplay(devicesDF.selectExpr(\u0026#34;c02_level\u0026#34;, \u0026#34;round(c02_level/temp) as ratio_c02_temperature\u0026#34;).orderBy($\u0026#34;ratio_c02_temperature\u0026#34; desc)) c02_level ratio_c02_temperature 1372 76 1220 68 1249 59 1378 51 1413 47 1504 44 1282 40 917 37 1304 34 1574 31 1208 30 886 28 831 21 863 19 上述查询可以像在 DataFrame API 中一样在 Spark SQL 中轻松表达。 selectExpr() 的强大之处在于处理或处理数值。让我们尝试创建一个临时视图并表达相同的查询，除了这次我们使用 SQL。\ndevicesDF.createOrReplaceTempView(\u0026#34;devicesDFT\u0026#34;) 请注意，cmd 42 的输出与 cmd 38 没有区别。两者都使用相同的 Spark SQL 引擎的 Catalyst 并生成等效的底层紧凑代码。\n%sql select c02_level, round(c02_level/temp) as ratio_c02_temperature from devicesDFT order by ratio_c02_temperature desc c02_level ratio_c02_temperature 1372 76 1220 68 1249 59 1378 51 1413 47 1504 44 1282 40 917 37 1304 34 1574 31 1208 30 886 28 831 21 863 19 要验证所有字符串转换是否保留在上面的 DataFrame stringJsonDF 中，让我们将其保存为 blob 存储为 Parquet。\nstringJsonDF .write .mode(\u0026#34;overwrite\u0026#34;) .format(\u0026#34;parquet\u0026#34;) .save(\u0026#34;/tmp/iot\u0026#34;) 检查是否所有文件都已写入。\n%fs ls /tmp/iot path name size dbfs:/tmp/iot/_SUCCESS _SUCCESS 0 dbfs:/tmp/iot/part-00000-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,part-00000-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,1567 dbfs:/tmp/iot/part-00001-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,part-00001-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,1598 dbfs:/tmp/iot/part-00002-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,part-00002-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,1576 dbfs:/tmp/iot/part-00003-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,part-00003-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,1602 dbfs:/tmp/iot/part-00004-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,part-00004-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,1574 dbfs:/tmp/iot/part-00005-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,part-00005-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,1618 dbfs:/tmp/iot/part-00006-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,part-00006-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,1589 dbfs:/tmp/iot/part-00007-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,part-00007-5ad82ac7-eea2-4439-9635-0dac9279a742.gz.parquet,1624 现在让我们验证保存设备是什么，因为从上面编码的每个字符串都是实际的字符串。\nval parquetDF = spark.read.parquet(\u0026#34;/tmp/iot\u0026#34;) parquetDF: org.apache.spark.sql.DataFrame = [devices: string] 让我们检查一下模式，以确保所写的内容与读取的内容没有什么不同，即JSON字符串。\nparquetDF.printSchema root |-- devices: string (nullable = true) devices \u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:17,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 17, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-ipad\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;64.124.180.215\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;USA\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;United States\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 38, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 17, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 9, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1304, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600532 }\u0026quot;\u0026quot;}\u0026quot; \u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:18,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 18, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-igauge\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;66.153.162.66\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;USA\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;United States\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 26, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 10, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 0, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 902, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600534 }\u0026quot;\u0026quot;}\u0026quot; \u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:19,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 19, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-ipad\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;193.200.142.254\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;AUT\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;Austria\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 32, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 27, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 5, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1282, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600536 }\u0026quot;\u0026quot;}\u0026quot; \u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:12,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 12, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-igauge\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;193.156.90.200\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;NOR\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;Norway\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 18, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 26, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 8, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1220, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600522 }\u0026quot;\u0026quot;}\u0026quot; \u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:13,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 13, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-ipad\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;67.185.72.1\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;USA\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;United States\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 34, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 20, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 8, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1504, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600524 }\u0026quot;\u0026quot;}\u0026quot; \u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:14,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 14, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-inest\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;68.85.85.106\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;USA\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;United States\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 39, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 17, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 8, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 831, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600526 }\u0026quot;\u0026quot;}\u0026quot; \u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:7,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 7, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-ipad\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;118.23.68.227\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;JPN\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;Japan\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 27, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 15, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 0, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1531, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600512 }\u0026quot;\u0026quot;}\u0026quot; \u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:8,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo; {\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 8, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-inest\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;208.109.163.218\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;USA\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;United States\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 40, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 16, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 9, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1208, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600514 }\u0026quot;\u0026quot;}\u0026quot; \u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:9,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 9, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-ipad\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;88.213.191.34\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;ITA\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;Italy\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 19, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 11, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 0, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1171, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600516 }\u0026quot;\u0026quot;}\u0026quot; \u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:2,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 2, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-ipad\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;88.36.5.1\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;ITA\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;Italy\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 18, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 25, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 5, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1372, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600500 }\u0026quot;\u0026quot;}\u0026quot; \u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:3,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 3, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-inest\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;66.39.173.154\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;USA\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;United States\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 47, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 12, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 1, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1447, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600502 }\u0026quot;\u0026quot;}\u0026quot; \u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:4,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 4, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-ipad\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;203.82.41.9\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;PHL\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;Philippines\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 29, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 11, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 0, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 983, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600504 }\u0026quot;\u0026quot;}\u0026quot; \u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:15,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 15, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-ipad\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;161.188.212.254\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;USA\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;United States\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 27, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 26, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 5, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1378, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600528 }\u0026quot;\u0026quot;}\u0026quot; \u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:16,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 16, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-igauge\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;221.3.128.242\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;CHN\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;China\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 10, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 24, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 6, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1423, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600530 }\u0026quot;\u0026quot;}\u0026quot; \u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:5,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 5, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-istick\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;204.116.105.67\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;USA\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;United States\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 50, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 16, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 8, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1574, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600506 }\u0026quot;\u0026quot;}\u0026quot; \u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:6,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 6, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-ipad\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;220.173.179.1\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;CHN\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;China\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 21, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 18, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 9, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1249, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600508 }\u0026quot;\u0026quot;}\u0026quot; \u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:10,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 10, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-igauge\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;68.28.91.22\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;USA\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;United States\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 32, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 26, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 7, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 886, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600518 }\u0026quot;\u0026quot;}\u0026quot; \u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:11,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 11, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-ipad\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;59.144.114.250\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;IND\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;India\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 46, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 25, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 4, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 863, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600520 }\u0026quot;\u0026quot;}\u0026quot; \u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:0,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 0, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-ipad\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;68.161.225.1\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;USA\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;United States\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 25, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 23, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 8, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 917, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600496 }\u0026quot;\u0026quot;}\u0026quot; \u0026ldquo;{\u0026ldquo;\u0026ldquo;id\u0026rdquo;\u0026quot;:1,\u0026ldquo;\u0026ldquo;device\u0026rdquo;\u0026rdquo;:\u0026rdquo;\u0026rdquo;{\u0026quot;\u0026ldquo;device_id\u0026quot;\u0026rdquo;: 1, \u0026quot;\u0026ldquo;device_type\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;sensor-igauge\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;ip\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;213.161.254.1\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cca3\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;NOR\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;cn\u0026quot;\u0026rdquo;: \u0026quot;\u0026ldquo;Norway\u0026quot;\u0026rdquo;, \u0026quot;\u0026ldquo;temp\u0026quot;\u0026rdquo;: 30, \u0026quot;\u0026ldquo;signal\u0026quot;\u0026rdquo;: 18, \u0026quot;\u0026ldquo;battery_level\u0026quot;\u0026rdquo;: 6, \u0026quot;\u0026ldquo;c02_level\u0026quot;\u0026rdquo;: 1413, \u0026quot;\u0026ldquo;timestamp\u0026quot;\u0026rdquo; :1475600498 }\u0026quot;\u0026quot;}\u0026quot; 到目前为止，本教程已探索了使用 get_json_object()，from_json()，to_json()，selectExpr() 和 explode() 辅助函数处理不太复杂的 JSON 对象的方法。\n让我们将焦点转向更嵌套的结构，并检查应用于复杂 JSON 的这些相同 API 如何简单。\n嵌套结构 假设您的 JSON 嵌套结构可能包含 Maps 以及嵌套 JSON，这并不是不合理的。为了说明，我们使用由复杂和嵌套数据类型组成的单个字符串，包括 Map。在现实生活中，这可能是设备事件的读数，具有危险的二氧化碳排放水平或高温读数，需要网络运营中心（NOC）通知某些立即行动。\nimport org.apache.spark.sql.types._ val schema = new StructType() .add(\u0026#34;dc_id\u0026#34;, StringType) // data center where data was posted to Kafka cluster .add(\u0026#34;source\u0026#34;, // info about the source of alarm MapType( // define this as a Map(Key-\u0026gt;value) StringType, new StructType() .add(\u0026#34;description\u0026#34;, StringType) .add(\u0026#34;ip\u0026#34;, StringType) .add(\u0026#34;id\u0026#34;, LongType) .add(\u0026#34;temp\u0026#34;, LongType) .add(\u0026#34;c02_level\u0026#34;, LongType) .add(\u0026#34;geo\u0026#34;, new StructType() .add(\u0026#34;lat\u0026#34;, DoubleType) .add(\u0026#34;long\u0026#34;, DoubleType) ) ) ) import org.apache.spark.sql.types._ schema: org.apache.spark.sql.types.StructType = StructType(StructField(dc_id,StringType,true), StructField(source,MapType(StringType,StructType(StructField(description,StringType,true), StructField(ip,StringType,true), StructField(id,LongType,true), StructField(temp,LongType,true), StructField(c02_level,LongType,true), StructField(geo,StructType(StructField(lat,DoubleType,true), StructField(long,DoubleType,true)),true)),true),true)) 让我们创建一个复杂数据类型的复杂 JSON。\n//create a single entry with id and its complex and nested data types val dataDS = Seq(\u0026#34;\u0026#34;\u0026#34; { \u0026#34;dc_id\u0026#34;: \u0026#34;dc-101\u0026#34;, \u0026#34;source\u0026#34;: { \u0026#34;sensor-igauge\u0026#34;: { \u0026#34;id\u0026#34;: 10, \u0026#34;ip\u0026#34;: \u0026#34;68.28.91.22\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;Sensor attached to the container ceilings\u0026#34;, \u0026#34;temp\u0026#34;:35, \u0026#34;c02_level\u0026#34;: 1475, \u0026#34;geo\u0026#34;: {\u0026#34;lat\u0026#34;:38.00, \u0026#34;long\u0026#34;:97.00} }, \u0026#34;sensor-ipad\u0026#34;: { \u0026#34;id\u0026#34;: 13, \u0026#34;ip\u0026#34;: \u0026#34;67.185.72.1\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;Sensor ipad attached to carbon cylinders\u0026#34;, \u0026#34;temp\u0026#34;: 34, \u0026#34;c02_level\u0026#34;: 1370, \u0026#34;geo\u0026#34;: {\u0026#34;lat\u0026#34;:47.41, \u0026#34;long\u0026#34;:-122.00} }, \u0026#34;sensor-inest\u0026#34;: { \u0026#34;id\u0026#34;: 8, \u0026#34;ip\u0026#34;: \u0026#34;208.109.163.218\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;Sensor attached to the factory ceilings\u0026#34;, \u0026#34;temp\u0026#34;: 40, \u0026#34;c02_level\u0026#34;: 1346, \u0026#34;geo\u0026#34;: {\u0026#34;lat\u0026#34;:33.61, \u0026#34;long\u0026#34;:-111.89} }, \u0026#34;sensor-istick\u0026#34;: { \u0026#34;id\u0026#34;: 5, \u0026#34;ip\u0026#34;: \u0026#34;204.116.105.67\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;Sensor embedded in exhaust pipes in the ceilings\u0026#34;, \u0026#34;temp\u0026#34;: 40, \u0026#34;c02_level\u0026#34;: 1574, \u0026#34;geo\u0026#34;: {\u0026#34;lat\u0026#34;:35.93, \u0026#34;long\u0026#34;:-85.46} } } }\u0026#34;\u0026#34;\u0026#34;).toDS() // should only be one item dataDS.count() dataDS: org.apache.spark.sql.Dataset[String] = [value: string] res15: Long = 1 { \u0026#34;dc_id\u0026#34;: \u0026#34;dc-101\u0026#34;, \u0026#34;source\u0026#34;: { \u0026#34;sensor-igauge\u0026#34;: { \u0026#34;id\u0026#34;: 10, \u0026#34;ip\u0026#34;: \u0026#34;68.28.91.22\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;Sensor attached to the container ceilings\u0026#34;, \u0026#34;temp\u0026#34;:35, \u0026#34;c02_level\u0026#34;: 1475, \u0026#34;geo\u0026#34;: {\u0026#34;lat\u0026#34;:38.00, \u0026#34;long\u0026#34;:97.00} }, \u0026#34;sensor-ipad\u0026#34;: { \u0026#34;id\u0026#34;: 13, \u0026#34;ip\u0026#34;: \u0026#34;67.185.72.1\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;Sensor ipad attached to carbon cylinders\u0026#34;, \u0026#34;temp\u0026#34;: 34, \u0026#34;c02_level\u0026#34;: 1370, \u0026#34;geo\u0026#34;: {\u0026#34;lat\u0026#34;:47.41, \u0026#34;long\u0026#34;:-122.00} }, \u0026#34;sensor-inest\u0026#34;: { \u0026#34;id\u0026#34;: 8, \u0026#34;ip\u0026#34;: \u0026#34;208.109.163.218\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;Sensor attached to the factory ceilings\u0026#34;, \u0026#34;temp\u0026#34;: 40, \u0026#34;c02_level\u0026#34;: 1346, \u0026#34;geo\u0026#34;: {\u0026#34;lat\u0026#34;:33.61, \u0026#34;long\u0026#34;:-111.89} }, \u0026#34;sensor-istick\u0026#34;: { \u0026#34;id\u0026#34;: 5, \u0026#34;ip\u0026#34;: \u0026#34;204.116.105.67\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;Sensor embedded in exhaust pipes in the ceilings\u0026#34;, \u0026#34;temp\u0026#34;: 40, \u0026#34;c02_level\u0026#34;: 1574, \u0026#34;geo\u0026#34;: {\u0026#34;lat\u0026#34;:35.93, \u0026#34;long\u0026#34;:-85.46} } } } 我们来处理吧。请注意，我们有嵌套结构 geo。\nval df = spark // spark session .read // get DataFrameReader .schema(schema) // use the defined schema above and read format as JSON .json(dataDS.rdd) // RDD[String] df: org.apache.spark.sql.DataFrame = [dc_id: string, source: map\u0026lt;string,struct\u0026lt;description:string,ip:string,id:bigint,temp:bigint,c02_level:bigint,geo:struct\u0026lt;lat:double,long:double\u0026gt;\u0026gt;\u0026gt;] 我们来看看它的嵌套和复杂 schema。\ndf.printSchema root |-- dc_id: string (nullable = true) |-- source: map (nullable = true) | |-- key: string | |-- value: struct (valueContainsNull = true) | | |-- description: string (nullable = true) | | |-- ip: string (nullable = true) | | |-- id: long (nullable = true) | | |-- temp: long (nullable = true) | | |-- c02_level: long (nullable = true) | | |-- geo: struct (nullable = true) | | | |-- lat: double (nullable = true) | | | |-- long: double (nullable = true) dc_id, source dc-101,{\u0026#34;sensor-igauge\u0026#34;:{\u0026#34;description\u0026#34;:\u0026#34;Sensor attached to the container ceilings\u0026#34;,\u0026#34;ip\u0026#34;:\u0026#34;68.28.91.22\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;10\u0026#34;,\u0026#34;temp\u0026#34;:\u0026#34;35\u0026#34;,\u0026#34;c02_level\u0026#34;:\u0026#34;1475\u0026#34;,\u0026#34;geo\u0026#34;:{\u0026#34;lat\u0026#34;:38,\u0026#34;long\u0026#34;:97}},\u0026#34;sensor-ipad\u0026#34;:{\u0026#34;description\u0026#34;:\u0026#34;Sensor ipad attached to carbon cylinders\u0026#34;,\u0026#34;ip\u0026#34;:\u0026#34;67.185.72.1\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;13\u0026#34;,\u0026#34;temp\u0026#34;:\u0026#34;34\u0026#34;,\u0026#34;c02_level\u0026#34;:\u0026#34;1370\u0026#34;,\u0026#34;geo\u0026#34;:{\u0026#34;lat\u0026#34;:47.41,\u0026#34;long\u0026#34;:-122}},\u0026#34;sensor-inest\u0026#34;:{\u0026#34;description\u0026#34;:\u0026#34;Sensor attached to the factory ceilings\u0026#34;,\u0026#34;ip\u0026#34;:\u0026#34;208.109.163.218\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;8\u0026#34;,\u0026#34;temp\u0026#34;:\u0026#34;40\u0026#34;,\u0026#34;c02_level\u0026#34;:\u0026#34;1346\u0026#34;,\u0026#34;geo\u0026#34;:{\u0026#34;lat\u0026#34;:33.61,\u0026#34;long\u0026#34;:-111.89}},\u0026#34;sensor-istick\u0026#34;:{\u0026#34;description\u0026#34;:\u0026#34;Sensor embedded in exhaust pipes in the ceilings\u0026#34;,\u0026#34;ip\u0026#34;:\u0026#34;204.116.105.67\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;5\u0026#34;,\u0026#34;temp\u0026#34;:\u0026#34;40\u0026#34;,\u0026#34;c02_level\u0026#34;:\u0026#34;1574\u0026#34;,\u0026#34;geo\u0026#34;:{\u0026#34;lat\u0026#34;:35.93,\u0026#34;long\u0026#34;:-85.46}}} 如何使用 explode() explode() 函数用于显示如何提取嵌套结构。另外，当我们从复杂的 JSON 结构中提取属性和值时，我们看到它与 to_json() 和 from_json() 函数一起工作时会有更多的亮点。所以偶尔，你会想要使用 explode()，以及 to_json() 和 from_json() 函数。这是我们做的一个案例。 explode() 函数为给定 map 列中的每个元素创建一个新行。在这种情况下，map 列是 source。请注意，对于 map 中的每个键值，您都有一个相应的行，在本例中为四个。\n// select from DataFrame with a single entry, and explode its column source, which is Map, with nested structure. val explodedDF = df.select($\u0026#34;dc_id\u0026#34;, explode($\u0026#34;source\u0026#34;)) display(explodedDF) dc_id key value dc-101 sensor-igauge {\u0026ldquo;description\u0026rdquo;:\u0026ldquo;Sensor attached to the container ceilings\u0026rdquo;,\u0026ldquo;ip\u0026rdquo;:\u0026ldquo;68.28.91.22\u0026rdquo;,\u0026ldquo;id\u0026rdquo;:\u0026ldquo;10\u0026rdquo;,\u0026ldquo;temp\u0026rdquo;:\u0026ldquo;35\u0026rdquo;,\u0026ldquo;c02_level\u0026rdquo;:\u0026ldquo;1475\u0026rdquo;,\u0026ldquo;geo\u0026rdquo;:{\u0026ldquo;lat\u0026rdquo;:38,\u0026ldquo;long\u0026rdquo;:97}} dc-101 sensor-ipad {\u0026ldquo;description\u0026rdquo;:\u0026ldquo;Sensor ipad attached to carbon cylinders\u0026rdquo;,\u0026ldquo;ip\u0026rdquo;:\u0026ldquo;67.185.72.1\u0026rdquo;,\u0026ldquo;id\u0026rdquo;:\u0026ldquo;13\u0026rdquo;,\u0026ldquo;temp\u0026rdquo;:\u0026ldquo;34\u0026rdquo;,\u0026ldquo;c02_level\u0026rdquo;:\u0026ldquo;1370\u0026rdquo;,\u0026ldquo;geo\u0026rdquo;:{\u0026ldquo;lat\u0026rdquo;:47.41,\u0026ldquo;long\u0026rdquo;:-122}} dc-101 sensor-inest {\u0026ldquo;description\u0026rdquo;:\u0026ldquo;Sensor attached to the factory ceilings\u0026rdquo;,\u0026ldquo;ip\u0026rdquo;:\u0026ldquo;208.109.163.218\u0026rdquo;,\u0026ldquo;id\u0026rdquo;:\u0026ldquo;8\u0026rdquo;,\u0026ldquo;temp\u0026rdquo;:\u0026ldquo;40\u0026rdquo;,\u0026ldquo;c02_level\u0026rdquo;:\u0026ldquo;1346\u0026rdquo;,\u0026ldquo;geo\u0026rdquo;:{\u0026ldquo;lat\u0026rdquo;:33.61,\u0026ldquo;long\u0026rdquo;:-111.89}} dc-101 sensor-istick {\u0026ldquo;description\u0026rdquo;:\u0026ldquo;Sensor embedded in exhaust pipes in the ceilings\u0026rdquo;,\u0026ldquo;ip\u0026rdquo;:\u0026ldquo;204.116.105.67\u0026rdquo;,\u0026ldquo;id\u0026rdquo;:\u0026ldquo;5\u0026rdquo;,\u0026ldquo;temp\u0026rdquo;:\u0026ldquo;40\u0026rdquo;,\u0026ldquo;c02_level\u0026rdquo;:\u0026ldquo;1574\u0026rdquo;,\u0026ldquo;geo\u0026rdquo;:{\u0026ldquo;lat\u0026rdquo;:35.93,\u0026ldquo;long\u0026rdquo;:-85.46}} 查看架构时，请注意现在已扩展 source。\nexplodedDF.printSchema root |-- dc_id: string (nullable = true) |-- key: string (nullable = false) |-- value: struct (nullable = true) | |-- description: string (nullable = true) | |-- ip: string (nullable = true) | |-- id: long (nullable = true) | |-- temp: long (nullable = true) | |-- c02_level: long (nullable = true) | |-- geo: struct (nullable = true) | | |-- lat: double (nullable = true) | | |-- long: double (nullable = true) 与复杂数据类型聚合的单个字符串，包括 Map。这可能是需要网络运营中心（NOC）注意行动的记录，因为温度和二氧化碳水平都是惊人的。\n让我们使用 Map 访问我们的爆炸数据中的数据。\n//case class to denote our desired Scala object case class DeviceAlert(dcId: String, deviceType:String, ip:String, deviceId:Long, temp:Long, c02_level: Long, lat: Double, lon: Double) //access all values using getItem() method on value, by providing the \u0026#34;key,\u0026#34; which is attribute in our JSON object. val notifydevicesDS = explodedDF.select( $\u0026#34;dc_id\u0026#34; as \u0026#34;dcId\u0026#34;, $\u0026#34;key\u0026#34; as \u0026#34;deviceType\u0026#34;, \u0026#39;value.getItem(\u0026#34;ip\u0026#34;) as \u0026#39;ip, \u0026#39;value.getItem(\u0026#34;id\u0026#34;) as \u0026#39;deviceId, \u0026#39;value.getItem(\u0026#34;c02_level\u0026#34;) as \u0026#39;c02_level, \u0026#39;value.getItem(\u0026#34;temp\u0026#34;) as \u0026#39;temp, \u0026#39;value.getItem(\u0026#34;geo\u0026#34;).getItem(\u0026#34;lat\u0026#34;) as \u0026#39;lat, //note embedded level requires yet another level of fetching. \u0026#39;value.getItem(\u0026#34;geo\u0026#34;).getItem(\u0026#34;long\u0026#34;) as \u0026#39;lon) .as[DeviceAlert] // return as a Dataset defined class DeviceAlert notifydevicesDS: org.apache.spark.sql.Dataset[DeviceAlert] = [dcId: string, deviceType: string ... 6 more fields] notifydevicesDS.printSchema root |-- dcId: string (nullable = true) |-- deviceType: string (nullable = false) |-- ip: string (nullable = true) |-- deviceId: long (nullable = true) |-- c02_level: long (nullable = true) |-- temp: long (nullable = true) |-- lat: double (nullable = true) |-- lon: double (nullable = true) 假设作为 ETL 的一部分，您需要根据某些警报条件通知或发送警报。一种方法是在迭代过滤数据集上编写用户功能并发送单独的通知。在其他情况下，您可以将消息作为附加选项发送到 Kafka 主题。 将嵌套的 JSON 分解为简单的 case 类之后，我们就可以向 NOC 发送警报以进行操作。在这方面是使用 foreach() DataFrame方法。但要做到这一点，我们需要一个高级功能;给定一个 case 类，它可以提取其警报属性来发出警报。虽然这个简单的示例写入 stdout，但在实际场景中，您需要通过 SNMP 或 HTTP POST 或某些 API 向 PagerAlert 发送警报。\n警报通知功能 // define a Scala Notification Object object DeviceNOCAlerts { def sendTwilio(message: String): Unit = { //TODO: fill as necessary println(\u0026#34;Twilio:\u0026#34; + message) } def sendSNMP(message: String): Unit = { //TODO: fill as necessary println(\u0026#34;SNMP:\u0026#34; + message) } def sendKafka(message: String): Unit = { //TODO: fill as necessary println(\u0026#34;KAFKA:\u0026#34; + message) } } def logAlerts(log: java.io.PrintStream = Console.out, deviceAlert: DeviceAlert, alert: String, notify: String =\u0026#34;twilio\u0026#34;): Unit = { val message = \u0026#34;[***ALERT***: %s; data_center: %s, device_name: %s, temperature: %d; device_id: %d ; ip: %s ; c02: %d]\u0026#34; format(alert, deviceAlert.dcId, deviceAlert.deviceType,deviceAlert.temp, deviceAlert.deviceId, deviceAlert.ip, deviceAlert.c02_level) //default log to Stderr/Stdout log.println(message) // use an appropriate notification method val notifyFunc = notify match { case \u0026#34;twilio\u0026#34; =\u0026gt; DeviceNOCAlerts.sendTwilio _ case \u0026#34;snmp\u0026#34; =\u0026gt; DeviceNOCAlerts.sendSNMP _ case \u0026#34;kafka\u0026#34; =\u0026gt; DeviceNOCAlerts.sendKafka _ } //send the appropriate alert notifyFunc(message) } defined object DeviceNOCAlerts logAlerts: (log: java.io.PrintStream, deviceAlert: DeviceAlert, alert: String, notify: String)Unit 迭代警报设备并采取行动 notifydevicesDS.foreach(d =\u0026gt; logAlerts(Console.err, d, \u0026#34;ACTION NEED! HIGH TEPERATURE AND C02 LEVLES\u0026#34;, \u0026#34;kafka\u0026#34;)) 要查看消息的记录位置，请转到“集群” - \u0026gt;“Spark” - \u0026gt;“日志”。\n将警报作为 JSON 发送到 Apache Kafka 主题 如果您想将这些设备的警报写入 Kafka 主题，监视订阅者正在等待事件采取行动，该怎么办？\n这是一个关于 Kafka 主题的 nofity 监听器的简单方法：“device_alerts”。要进一步阅读如何使用 Apache Kafka 详细介绍 Structured Streaming，请阅读我们关于 Structure Streaming 的博客系列的第3部分。 注意：请参阅上面我们探讨的 selectExpr() 函数的另一种用法。\nval deviceAlertQuery = notifydevicesDS .selectExpr(\u0026#34;CAST(dcId AS STRING) AS key\u0026#34;, \u0026#34;to_json(struct(*)) AS value\u0026#34;) .writeStream .format(\u0026#34;kafka\u0026#34;) .option(\u0026#34;kafka.bootstrap.servers\u0026#34;, \u0026#34;host1:port1,host2:port2\u0026#34;) .option(\u0026#34;toipic\u0026#34;, \u0026#34;device_alerts\u0026#34;) .start() org.apache.spark.sql.AnalysisException: Undefined function: \u0026#39;to_json\u0026#39;. This function is neither a registered temporary function nor a permanent function registered in the database \u0026#39;default\u0026#39;.; line 1 pos 0 嵌套的设备数据 让我们看看 Nest 的读数中另一个复杂的现实数据。 Nest 设备向其收集器发出许多 JSON 事件。该收集器可以位于附近的数据中心，邻域中央数据收集器或聚合器，或者它可以是安装在家中的设备，其定期将设备读数发送到通过安全的互联网连接连接的中央数据中心。对于幻觉，我已经限制了一些属性，但它仍然显示了如何处理复杂数据 - 以及提取相关属性。\n让我们先定义它复杂的模式。仔细观察，您会发现它与我们上面定义的模式没有什么不同，除了它不是一个 map 而是三个 map：恒温器，摄像头和烟雾警报器。\nimport org.apache.spark.sql.types._ // a bit longish, nested, and convuloted JSON schema :) val nestSchema2 = new StructType() .add(\u0026#34;devices\u0026#34;, new StructType() .add(\u0026#34;thermostats\u0026#34;, MapType(StringType, new StructType() .add(\u0026#34;device_id\u0026#34;, StringType) .add(\u0026#34;locale\u0026#34;, StringType) .add(\u0026#34;software_version\u0026#34;, StringType) .add(\u0026#34;structure_id\u0026#34;, StringType) .add(\u0026#34;where_name\u0026#34;, StringType) .add(\u0026#34;last_connection\u0026#34;, StringType) .add(\u0026#34;is_online\u0026#34;, BooleanType) .add(\u0026#34;can_cool\u0026#34;, BooleanType) .add(\u0026#34;can_heat\u0026#34;, BooleanType) .add(\u0026#34;is_using_emergency_heat\u0026#34;, BooleanType) .add(\u0026#34;has_fan\u0026#34;, BooleanType) .add(\u0026#34;fan_timer_active\u0026#34;, BooleanType) .add(\u0026#34;fan_timer_timeout\u0026#34;, StringType) .add(\u0026#34;temperature_scale\u0026#34;, StringType) .add(\u0026#34;target_temperature_f\u0026#34;, DoubleType) .add(\u0026#34;target_temperature_high_f\u0026#34;, DoubleType) .add(\u0026#34;target_temperature_low_f\u0026#34;, DoubleType) .add(\u0026#34;eco_temperature_high_f\u0026#34;, DoubleType) .add(\u0026#34;eco_temperature_low_f\u0026#34;, DoubleType) .add(\u0026#34;away_temperature_high_f\u0026#34;, DoubleType) .add(\u0026#34;away_temperature_low_f\u0026#34;, DoubleType) .add(\u0026#34;hvac_mode\u0026#34;, StringType) .add(\u0026#34;humidity\u0026#34;, LongType) .add(\u0026#34;hvac_state\u0026#34;, StringType) .add(\u0026#34;is_locked\u0026#34;, StringType) .add(\u0026#34;locked_temp_min_f\u0026#34;, DoubleType) .add(\u0026#34;locked_temp_max_f\u0026#34;, DoubleType))) .add(\u0026#34;smoke_co_alarms\u0026#34;, MapType(StringType, new StructType() .add(\u0026#34;device_id\u0026#34;, StringType) .add(\u0026#34;locale\u0026#34;, StringType) .add(\u0026#34;software_version\u0026#34;, StringType) .add(\u0026#34;structure_id\u0026#34;, StringType) .add(\u0026#34;where_name\u0026#34;, StringType) .add(\u0026#34;last_connection\u0026#34;, StringType) .add(\u0026#34;is_online\u0026#34;, BooleanType) .add(\u0026#34;battery_health\u0026#34;, StringType) .add(\u0026#34;co_alarm_state\u0026#34;, StringType) .add(\u0026#34;smoke_alarm_state\u0026#34;, StringType) .add(\u0026#34;is_manual_test_active\u0026#34;, BooleanType) .add(\u0026#34;last_manual_test_time\u0026#34;, StringType) .add(\u0026#34;ui_color_state\u0026#34;, StringType))) .add(\u0026#34;cameras\u0026#34;, MapType(StringType, new StructType() .add(\u0026#34;device_id\u0026#34;, StringType) .add(\u0026#34;software_version\u0026#34;, StringType) .add(\u0026#34;structure_id\u0026#34;, StringType) .add(\u0026#34;where_name\u0026#34;, StringType) .add(\u0026#34;is_online\u0026#34;, BooleanType) .add(\u0026#34;is_streaming\u0026#34;, BooleanType) .add(\u0026#34;is_audio_input_enabled\u0026#34;, BooleanType) .add(\u0026#34;last_is_online_change\u0026#34;, StringType) .add(\u0026#34;is_video_history_enabled\u0026#34;, BooleanType) .add(\u0026#34;web_url\u0026#34;, StringType) .add(\u0026#34;app_url\u0026#34;, StringType) .add(\u0026#34;is_public_share_enabled\u0026#34;, BooleanType) .add(\u0026#34;activity_zones\u0026#34;, new StructType() .add(\u0026#34;name\u0026#34;, StringType) .add(\u0026#34;id\u0026#34;, LongType)) .add(\u0026#34;last_event\u0026#34;, StringType)))) import org.apache.spark.sql.types._ nestSchema2: org.apache.spark.sql.types.StructType = StructType(StructField(devices,StructType(StructField(thermostats,MapType(StringType,StructType(StructField(device_id,StringType,true), StructField(locale,StringType,true), StructField(software_version,StringType,true), StructField(structure_id,StringType,true), StructField(where_name,StringType,true), StructField(last_connection,StringType,true), StructField(is_online,BooleanType,true), StructField(can_cool,BooleanType,true), StructField(can_heat,BooleanType,true), StructField(is_using_emergency_heat,BooleanType,true), StructField(has_fan,BooleanType,true), StructField(fan_timer_active,BooleanType,true), StructField(fan_timer_timeout,StringType,true), StructField(temperature_scale,StringType,true), StructField(target_temperature_f,DoubleType,true), StructField(target_temperature_high_f,DoubleType,true), StructField(target_temperature_low_f,DoubleType,true), StructField(eco_temperature_high_f,DoubleType,true), StructField(eco_temperature_low_f,DoubleType,true), StructField(away_temperature_high_f,DoubleType,true), StructField(away_temperature_low_f,DoubleType,true), StructField(hvac_mode,StringType,true), StructField(humidity,LongType,true), StructField(hvac_state,StringType,true), StructField(is_locked,StringType,true), StructField(locked_temp_min_f,DoubleType,true), StructField(locked_temp_max_f,DoubleType,true)),true),true), StructField(smoke_co_alarms,MapType(StringType,StructType(StructField(device_id,StringType,true), StructField(locale,StringType,true), StructField(software_version,StringType,true), StructField(structure_id,StringType,true), StructField(where_name,StringType,true), StructField(last_connection,StringType,true), StructField(is_online,BooleanType,true), StructField(battery_health,StringType,true), StructField(co_alarm_state,StringType,true), StructField(smoke_alarm_state,StringType,true), StructField(is_manual_test_active,BooleanType,true), StructField(last_manual_test_time,StringType,true), StructField(ui_color_state,StringType,true)),true),true), StructField(cameras,MapType(StringType,StructType(StructField(device_id,StringType,true), StructField(software_version,StringType,true), StructField(structure_id,StringType,true), StructField(where_name,StringType,true), StructField(is_online,BooleanType,true), StructField(is_streaming,BooleanType,true), StructField(is_audio_input_enabled,BooleanType,true), StructField(last_is_online_change,StringType,true), StructField(is_video_history_enabled,BooleanType,true), StructField(web_url,StringType,true), StructField(app_url,StringType,true), StructField(is_public_share_enabled,BooleanType,true), StructField(activity_zones,StructType(StructField(name,StringType,true), StructField(id,LongType,true)),true), StructField(last_event,StringType,true)),true),true)),true)) 通过创建一个简单的数据集，您可以使用所有数据集方法来执行 ETL，使用上面的实用程序函数：from_json()，to_json()，explode() 和 selectExpr()。\nval nestDataDS2 = Seq(\u0026#34;\u0026#34;\u0026#34;{ \u0026#34;devices\u0026#34;: { \u0026#34;thermostats\u0026#34;: { \u0026#34;peyiJNo0IldT2YlIVtYaGQ\u0026#34;: { \u0026#34;device_id\u0026#34;: \u0026#34;peyiJNo0IldT2YlIVtYaGQ\u0026#34;, \u0026#34;locale\u0026#34;: \u0026#34;en-US\u0026#34;, \u0026#34;software_version\u0026#34;: \u0026#34;4.0\u0026#34;, \u0026#34;structure_id\u0026#34;: \u0026#34;VqFabWH21nwVyd4RWgJgNb292wa7hG_dUwo2i2SG7j3-BOLY0BA4sw\u0026#34;, \u0026#34;where_name\u0026#34;: \u0026#34;Hallway Upstairs\u0026#34;, \u0026#34;last_connection\u0026#34;: \u0026#34;2016-10-31T23:59:59.000Z\u0026#34;, \u0026#34;is_online\u0026#34;: true, \u0026#34;can_cool\u0026#34;: true, \u0026#34;can_heat\u0026#34;: true, \u0026#34;is_using_emergency_heat\u0026#34;: true, \u0026#34;has_fan\u0026#34;: true, \u0026#34;fan_timer_active\u0026#34;: true, \u0026#34;fan_timer_timeout\u0026#34;: \u0026#34;2016-10-31T23:59:59.000Z\u0026#34;, \u0026#34;temperature_scale\u0026#34;: \u0026#34;F\u0026#34;, \u0026#34;target_temperature_f\u0026#34;: 72, \u0026#34;target_temperature_high_f\u0026#34;: 80, \u0026#34;target_temperature_low_f\u0026#34;: 65, \u0026#34;eco_temperature_high_f\u0026#34;: 80, \u0026#34;eco_temperature_low_f\u0026#34;: 65, \u0026#34;away_temperature_high_f\u0026#34;: 80, \u0026#34;away_temperature_low_f\u0026#34;: 65, \u0026#34;hvac_mode\u0026#34;: \u0026#34;heat\u0026#34;, \u0026#34;humidity\u0026#34;: 40, \u0026#34;hvac_state\u0026#34;: \u0026#34;heating\u0026#34;, \u0026#34;is_locked\u0026#34;: true, \u0026#34;locked_temp_min_f\u0026#34;: 65, \u0026#34;locked_temp_max_f\u0026#34;: 80 } }, \u0026#34;smoke_co_alarms\u0026#34;: { \u0026#34;RTMTKxsQTCxzVcsySOHPxKoF4OyCifrs\u0026#34;: { \u0026#34;device_id\u0026#34;: \u0026#34;RTMTKxsQTCxzVcsySOHPxKoF4OyCifrs\u0026#34;, \u0026#34;locale\u0026#34;: \u0026#34;en-US\u0026#34;, \u0026#34;software_version\u0026#34;: \u0026#34;1.01\u0026#34;, \u0026#34;structure_id\u0026#34;: \u0026#34;VqFabWH21nwVyd4RWgJgNb292wa7hG_dUwo2i2SG7j3-BOLY0BA4sw\u0026#34;, \u0026#34;where_name\u0026#34;: \u0026#34;Jane\u0026#39;s Room\u0026#34;, \u0026#34;last_connection\u0026#34;: \u0026#34;2016-10-31T23:59:59.000Z\u0026#34;, \u0026#34;is_online\u0026#34;: true, \u0026#34;battery_health\u0026#34;: \u0026#34;ok\u0026#34;, \u0026#34;co_alarm_state\u0026#34;: \u0026#34;ok\u0026#34;, \u0026#34;smoke_alarm_state\u0026#34;: \u0026#34;ok\u0026#34;, \u0026#34;is_manual_test_active\u0026#34;: true, \u0026#34;last_manual_test_time\u0026#34;: \u0026#34;2016-10-31T23:59:59.000Z\u0026#34;, \u0026#34;ui_color_state\u0026#34;: \u0026#34;gray\u0026#34; } }, \u0026#34;cameras\u0026#34;: { \u0026#34;awJo6rH0IldT2YlIVtYaGQ\u0026#34;: { \u0026#34;device_id\u0026#34;: \u0026#34;awJo6rH\u0026#34;, \u0026#34;software_version\u0026#34;: \u0026#34;4.0\u0026#34;, \u0026#34;structure_id\u0026#34;: \u0026#34;VqFabWH21nwVyd4RWgJgNb292wa7hG_dUwo2i2SG7j3-BOLY0BA4sw\u0026#34;, \u0026#34;where_name\u0026#34;: \u0026#34;Foyer\u0026#34;, \u0026#34;is_online\u0026#34;: true, \u0026#34;is_streaming\u0026#34;: true, \u0026#34;is_audio_input_enabled\u0026#34;: true, \u0026#34;last_is_online_change\u0026#34;: \u0026#34;2016-12-29T18:42:00.000Z\u0026#34;, \u0026#34;is_video_history_enabled\u0026#34;: true, \u0026#34;web_url\u0026#34;: \u0026#34;https://home.nest.com/cameras/device_id?auth=access_token\u0026#34;, \u0026#34;app_url\u0026#34;: \u0026#34;nestmobile://cameras/device_id?auth=access_token\u0026#34;, \u0026#34;is_public_share_enabled\u0026#34;: true, \u0026#34;activity_zones\u0026#34;: { \u0026#34;name\u0026#34;: \u0026#34;Walkway\u0026#34;, \u0026#34;id\u0026#34;: 244083 }, \u0026#34;last_event\u0026#34;: \u0026#34;2016-10-31T23:59:59.000Z\u0026#34; } } } }\u0026#34;\u0026#34;\u0026#34;).toDS nestDataDS2: org.apache.spark.sql.Dataset[String] = [value: string] 让我们从这个单一的嵌套结构创建一个 DataFrame，并使用上述所有实用程序函数来处理和提取相关属性\nval nestDF2 = spark // spark session .read // get DataFrameReader .schema(nestSchema2) // use the defined schema above and read format as JSON .json(nestDataDS2.rdd) nestDF2: org.apache.spark.sql.DataFrame = [devices: struct\u0026lt;thermostats: map\u0026lt;string,struct\u0026lt;device_id:string,locale:string,software_version:string,structure_id:string,where_name:string,last_connection:string,is_online:boolean,can_cool:boolean,can_heat:boolean,is_using_emergency_heat:boolean,has_fan:boolean,fan_timer_active:boolean,fan_timer_timeout:string,temperature_scale:string,target_temperature_f:double,target_temperature_high_f:double,target_temperature_low_f:double,eco_temperature_high_f:double,eco_temperature_low_f:double,away_temperature_high_f:double,away_temperature_low_f:double,hvac_mode:string,humidity:bigint,hvac_state:string,... 3 more fields\u0026gt;\u0026gt;, smoke_co_alarms: map\u0026lt;string,struct\u0026lt;device_id:string,locale:string,software_version:string,structure_id:string,where_name:string,last_connection:string,is_online:boolean,battery_health:string,co_alarm_state:string,smoke_alarm_state:string,is_manual_test_active:boolean,last_manual_test_time:string,ui_color_state:string\u0026gt;\u0026gt; ... 1 more field\u0026gt;] {\u0026#34;thermostats\u0026#34;:{\u0026#34;peyiJNo0IldT2YlIVtYaGQ\u0026#34;:{\u0026#34;device_id\u0026#34;:\u0026#34;peyiJNo0IldT2YlIVtYaGQ\u0026#34;,\u0026#34;locale\u0026#34;:\u0026#34;en-US\u0026#34;,\u0026#34;software_version\u0026#34;:\u0026#34;4.0\u0026#34;,\u0026#34;structure_id\u0026#34;:\u0026#34;VqFabWH21nwVyd4RWgJgNb292wa7hG_dUwo2i2SG7j3-BOLY0BA4sw\u0026#34;,\u0026#34;where_name\u0026#34;:\u0026#34;Hallway Upstairs\u0026#34;,\u0026#34;last_connection\u0026#34;:\u0026#34;2016-10-31T23:59:59.000Z\u0026#34;,\u0026#34;is_online\u0026#34;:true,\u0026#34;can_cool\u0026#34;:true,\u0026#34;can_heat\u0026#34;:true,\u0026#34;is_using_emergency_heat\u0026#34;:true,\u0026#34;has_fan\u0026#34;:true,\u0026#34;fan_timer_active\u0026#34;:true,\u0026#34;fan_timer_timeout\u0026#34;:\u0026#34;2016-10-31T23:59:59.000Z\u0026#34;,\u0026#34;temperature_scale\u0026#34;:\u0026#34;F\u0026#34;,\u0026#34;target_temperature_f\u0026#34;:72,\u0026#34;target_temperature_high_f\u0026#34;:80,\u0026#34;target_temperature_low_f\u0026#34;:65,\u0026#34;eco_temperature_high_f\u0026#34;:80,\u0026#34;eco_temperature_low_f\u0026#34;:65,\u0026#34;away_temperature_high_f\u0026#34;:80,\u0026#34;away_temperature_low_f\u0026#34;:65,\u0026#34;hvac_mode\u0026#34;:\u0026#34;heat\u0026#34;,\u0026#34;humidity\u0026#34;:\u0026#34;40\u0026#34;,\u0026#34;hvac_state\u0026#34;:\u0026#34;heating\u0026#34;,\u0026#34;is_locked\u0026#34;:\u0026#34;true\u0026#34;,\u0026#34;locked_temp_min_f\u0026#34;:65,\u0026#34;locked_temp_max_f\u0026#34;:80}},\u0026#34;smoke_co_alarms\u0026#34;:{\u0026#34;RTMTKxsQTCxzVcsySOHPxKoF4OyCifrs\u0026#34;:{\u0026#34;device_id\u0026#34;:\u0026#34;RTMTKxsQTCxzVcsySOHPxKoF4OyCifrs\u0026#34;,\u0026#34;locale\u0026#34;:\u0026#34;en-US\u0026#34;,\u0026#34;software_version\u0026#34;:\u0026#34;1.01\u0026#34;,\u0026#34;structure_id\u0026#34;:\u0026#34;VqFabWH21nwVyd4RWgJgNb292wa7hG_dUwo2i2SG7j3-BOLY0BA4sw\u0026#34;,\u0026#34;where_name\u0026#34;:\u0026#34;Jane\u0026#39;s Room\u0026#34;,\u0026#34;last_connection\u0026#34;:\u0026#34;2016-10-31T23:59:59.000Z\u0026#34;,\u0026#34;is_online\u0026#34;:true,\u0026#34;battery_health\u0026#34;:\u0026#34;ok\u0026#34;,\u0026#34;co_alarm_state\u0026#34;:\u0026#34;ok\u0026#34;,\u0026#34;smoke_alarm_state\u0026#34;:\u0026#34;ok\u0026#34;,\u0026#34;is_manual_test_active\u0026#34;:true,\u0026#34;last_manual_test_time\u0026#34;:\u0026#34;2016-10-31T23:59:59.000Z\u0026#34;,\u0026#34;ui_color_state\u0026#34;:\u0026#34;gray\u0026#34;}},\u0026#34;cameras\u0026#34;:{\u0026#34;awJo6rH0IldT2YlIVtYaGQ\u0026#34;:{\u0026#34;device_id\u0026#34;:\u0026#34;awJo6rH\u0026#34;,\u0026#34;software_version\u0026#34;:\u0026#34;4.0\u0026#34;,\u0026#34;structure_id\u0026#34;:\u0026#34;VqFabWH21nwVyd4RWgJgNb292wa7hG_dUwo2i2SG7j3-BOLY0BA4sw\u0026#34;,\u0026#34;where_name\u0026#34;:\u0026#34;Foyer\u0026#34;,\u0026#34;is_online\u0026#34;:true,\u0026#34;is_streaming\u0026#34;:true,\u0026#34;is_audio_input_enabled\u0026#34;:true,\u0026#34;last_is_online_change\u0026#34;:\u0026#34;2016-12-29T18:42:00.000Z\u0026#34;,\u0026#34;is_video_history_enabled\u0026#34;:true,\u0026#34;web_url\u0026#34;:\u0026#34;https://home.nest.com/cameras/device_id?auth=access_token\u0026#34;,\u0026#34;app_url\u0026#34;:\u0026#34;nestmobile://cameras/device_id?auth=access_token\u0026#34;,\u0026#34;is_public_share_enabled\u0026#34;:true,\u0026#34;activity_zones\u0026#34;:{\u0026#34;name\u0026#34;:\u0026#34;Walkway\u0026#34;,\u0026#34;id\u0026#34;:\u0026#34;244083\u0026#34;},\u0026#34;last_event\u0026#34;:\u0026#34;2016-10-31T23:59:59.000Z\u0026#34;}}} 如上所述将上面的整个 JSON 对象转换为 JSON 字符串。\nval stringJsonDF = nestDF2.select(to_json(struct($\u0026#34;*\u0026#34;))).toDF(\u0026#34;nestDevice\u0026#34;) stringJsonDF: org.apache.spark.sql.DataFrame = [nestDevice: string] stringJsonDF.printSchema root |-- nestDevice: string (nullable = true) display(stringJsonDF) {\u0026#34;devices\u0026#34;:{\u0026#34;thermostats\u0026#34;:{\u0026#34;peyiJNo0IldT2YlIVtYaGQ\u0026#34;:{\u0026#34;device_id\u0026#34;:\u0026#34;peyiJNo0IldT2YlIVtYaGQ\u0026#34;,\u0026#34;locale\u0026#34;:\u0026#34;en-US\u0026#34;,\u0026#34;software_version\u0026#34;:\u0026#34;4.0\u0026#34;,\u0026#34;structure_id\u0026#34;:\u0026#34;VqFabWH21nwVyd4RWgJgNb292wa7hG_dUwo2i2SG7j3-BOLY0BA4sw\u0026#34;,\u0026#34;where_name\u0026#34;:\u0026#34;Hallway Upstairs\u0026#34;,\u0026#34;last_connection\u0026#34;:\u0026#34;2016-10-31T23:59:59.000Z\u0026#34;,\u0026#34;is_online\u0026#34;:true,\u0026#34;can_cool\u0026#34;:true,\u0026#34;can_heat\u0026#34;:true,\u0026#34;is_using_emergency_heat\u0026#34;:true,\u0026#34;has_fan\u0026#34;:true,\u0026#34;fan_timer_active\u0026#34;:true,\u0026#34;fan_timer_timeout\u0026#34;:\u0026#34;2016-10-31T23:59:59.000Z\u0026#34;,\u0026#34;temperature_scale\u0026#34;:\u0026#34;F\u0026#34;,\u0026#34;target_temperature_f\u0026#34;:72.0,\u0026#34;target_temperature_high_f\u0026#34;:80.0,\u0026#34;target_temperature_low_f\u0026#34;:65.0,\u0026#34;eco_temperature_high_f\u0026#34;:80.0,\u0026#34;eco_temperature_low_f\u0026#34;:65.0,\u0026#34;away_temperature_high_f\u0026#34;:80.0,\u0026#34;away_temperature_low_f\u0026#34;:65.0,\u0026#34;hvac_mode\u0026#34;:\u0026#34;heat\u0026#34;,\u0026#34;humidity\u0026#34;:40,\u0026#34;hvac_state\u0026#34;:\u0026#34;heating\u0026#34;,\u0026#34;is_locked\u0026#34;:\u0026#34;true\u0026#34;,\u0026#34;locked_temp_min_f\u0026#34;:65.0,\u0026#34;locked_temp_max_f\u0026#34;:80.0}},\u0026#34;smoke_co_alarms\u0026#34;:{\u0026#34;RTMTKxsQTCxzVcsySOHPxKoF4OyCifrs\u0026#34;:{\u0026#34;device_id\u0026#34;:\u0026#34;RTMTKxsQTCxzVcsySOHPxKoF4OyCifrs\u0026#34;,\u0026#34;locale\u0026#34;:\u0026#34;en-US\u0026#34;,\u0026#34;software_version\u0026#34;:\u0026#34;1.01\u0026#34;,\u0026#34;structure_id\u0026#34;:\u0026#34;VqFabWH21nwVyd4RWgJgNb292wa7... 给定具有三个映射的嵌套 JSON 对象，您可以获取单个映射作为 columnn，然后使用 explode() 访问它的属性。\nval mapColumnsDF = nestDF2.select($\u0026#34;devices\u0026#34;.getItem(\u0026#34;smoke_co_alarms\u0026#34;).alias (\u0026#34;smoke_alarms\u0026#34;), $\u0026#34;devices\u0026#34;.getItem(\u0026#34;cameras\u0026#34;).alias (\u0026#34;cameras\u0026#34;), $\u0026#34;devices\u0026#34;.getItem(\u0026#34;thermostats\u0026#34;).alias (\u0026#34;thermostats\u0026#34;)) mapColumnsDF: org.apache.spark.sql.DataFrame = [smoke_alarms: map\u0026lt;string,struct\u0026lt;device_id:string,locale:string,software_version:string,structure_id:string,where_name:string,last_connection:string,is_online:boolean,battery_health:string,co_alarm_state:string,smoke_alarm_state:string,is_manual_test_active:boolean,last_manual_test_time:string,ui_color_state:string\u0026gt;\u0026gt;, cameras: map\u0026lt;string,struct\u0026lt;device_id:string,software_version:string,structure_id:string,where_name:string,is_online:boolean,is_streaming:boolean,is_audio_input_enabled:boolean,last_is_online_change:string,is_video_history_enabled:boolean,web_url:string,app_url:string,is_public_share_enabled:boolean,activity_zones:struct\u0026lt;name:string,id:bigint\u0026gt;,last_event:string\u0026gt;\u0026gt; ... 1 more field] smoke_alarms cameras thermostats {\u0026ldquo;RTMTKxsQTCxzVcsySOHPxKoF4OyCifrs\u0026rdquo;:{\u0026ldquo;device_id\u0026rdquo;:\u0026ldquo;RTMTKxsQTCxzVcsySOHPxKoF4OyCifrs\u0026rdquo;,\u0026ldquo;locale\u0026rdquo;:\u0026ldquo;en-US\u0026rdquo;,\u0026ldquo;software_version\u0026rdquo;:\u0026ldquo;1.01\u0026rdquo;,\u0026ldquo;structure_id\u0026rdquo;:\u0026ldquo;VqFabWH21nwVyd4RWgJgNb292wa7hG_dUwo2i2SG7j3-BOLY0BA4sw\u0026rdquo;,\u0026ldquo;where_name\u0026rdquo;:\u0026ldquo;Jane\u0026rsquo;s Room\u0026rdquo;,\u0026ldquo;last_connection\u0026rdquo;:\u0026ldquo;2016-10-31T23:59:59.000Z\u0026rdquo;,\u0026ldquo;is_online\u0026rdquo;:true,\u0026ldquo;battery_health\u0026rdquo;:\u0026ldquo;ok\u0026rdquo;,\u0026ldquo;co_alarm_state\u0026rdquo;:\u0026ldquo;ok\u0026rdquo;,\u0026ldquo;smoke_alarm_state\u0026rdquo;:\u0026ldquo;ok\u0026rdquo;,\u0026ldquo;is_manual_test_active\u0026rdquo;:true,\u0026ldquo;last_manual_test_time\u0026rdquo;:\u0026ldquo;2016-10-31T23:59:59.000Z\u0026rdquo;,\u0026ldquo;ui_color_state\u0026rdquo;:\u0026ldquo;gray\u0026rdquo;}}\u0026quot; \u0026ldquo;{\u0026ldquo;awJo6rH0IldT2YlIVtYaGQ\u0026rdquo;:{\u0026ldquo;device_id\u0026rdquo;:\u0026ldquo;awJo6rH\u0026rdquo;,\u0026ldquo;software_version\u0026rdquo;:\u0026ldquo;4.0\u0026rdquo;,\u0026ldquo;structure_id\u0026rdquo;:\u0026ldquo;VqFabWH21nwVyd4RWgJgNb292wa7hG_dUwo2i2SG7j3-BOLY0BA4sw\u0026rdquo;,\u0026ldquo;where_name\u0026rdquo;:\u0026ldquo;Foyer\u0026rdquo;,\u0026ldquo;is_online\u0026rdquo;:true,\u0026ldquo;is_streaming\u0026rdquo;:true,\u0026ldquo;is_audio_input_enabled\u0026rdquo;:true,\u0026ldquo;last_is_online_change\u0026rdquo;:\u0026ldquo;2016-12-29T18:42:00.000Z\u0026rdquo;,\u0026ldquo;is_video_history_enabled\u0026rdquo;:true,\u0026ldquo;web_url\u0026rdquo;:\u0026ldquo;https://home.nest.com/cameras/device_id?auth=access_token\u0026quot;,\u0026quot;app_url\u0026quot;:\u0026quot;nestmobile://cameras/device_id?auth=access_token\u0026quot;,\u0026quot;is_public_share_enabled\u0026quot;:true,\u0026quot;activity_zones\u0026quot;:{\u0026quot;name\u0026quot;:\u0026quot;Walkway\u0026quot;,\u0026quot;id\u0026quot;:\u0026quot;244083\u0026quot;},\u0026quot;last_event\u0026quot;:\u0026quot;2016-10-31T23:59:59.000Z\u0026quot;}}\u0026quot; \u0026ldquo;{\u0026ldquo;peyiJNo0IldT2YlIVtYaGQ\u0026rdquo;:{\u0026ldquo;device_id\u0026rdquo;:\u0026ldquo;peyiJNo0IldT2YlIVtYaGQ\u0026rdquo;,\u0026ldquo;locale\u0026rdquo;:\u0026ldquo;en-US\u0026rdquo;,\u0026ldquo;software_version\u0026rdquo;:\u0026ldquo;4.0\u0026rdquo;,\u0026ldquo;structure_id\u0026rdquo;:\u0026ldquo;VqFabWH21nwVyd4RWgJgNb292wa7hG_dUwo2i2SG7j3-BOLY0BA4sw\u0026rdquo;,\u0026ldquo;where_name\u0026rdquo;:\u0026ldquo;Hallway Upstairs\u0026rdquo;,\u0026ldquo;last_connection\u0026rdquo;:\u0026ldquo;2016-10-31T23:59:59.000Z\u0026rdquo;,\u0026ldquo;is_online\u0026rdquo;:true,\u0026ldquo;can_cool\u0026rdquo;:true,\u0026ldquo;can_heat\u0026rdquo;:true,\u0026ldquo;is_using_emergency_heat\u0026rdquo;:true,\u0026ldquo;has_fan\u0026rdquo;:true,\u0026ldquo;fan_timer_active\u0026rdquo;:true,\u0026ldquo;fan_timer_timeout\u0026rdquo;:\u0026ldquo;2016-10-31T23:59:59.000Z\u0026rdquo;,\u0026ldquo;temperature_scale\u0026rdquo;:\u0026ldquo;F\u0026rdquo;,\u0026ldquo;target_temperature_f\u0026rdquo;:72,\u0026ldquo;target_temperature_high_f\u0026rdquo;:80,\u0026ldquo;target_temperature_low_f\u0026rdquo;:65,\u0026ldquo;eco_temperature_high_f\u0026rdquo;:80,\u0026ldquo;eco_temperature_low_f\u0026rdquo;:65,\u0026ldquo;away_temperature_high_f\u0026rdquo;:80,\u0026ldquo;away_temperature_low_f\u0026rdquo;:65,\u0026ldquo;hvac_mode\u0026rdquo;:\u0026ldquo;heat\u0026rdquo;,\u0026ldquo;humidity\u0026rdquo;:\u0026ldquo;40\u0026rdquo;,\u0026ldquo;hvac_state\u0026rdquo;:\u0026ldquo;heating\u0026rdquo;,\u0026ldquo;is_locked\u0026rdquo;:\u0026ldquo;true\u0026rdquo;,\u0026ldquo;locked_temp_min_f\u0026rdquo;:65,\u0026ldquo;locked_temp_max_f\u0026rdquo;:80}} val explodedThermostatsDF = mapColumnsDF.select(explode($\u0026#34;thermostats\u0026#34;)) val explodedCamerasDF = mapColumnsDF.select(explode($\u0026#34;cameras\u0026#34;)) //or you could use the original nestDF2 and use the devices.X notation val explodedSmokedAlarmsDF = nestDF2.select(explode($\u0026#34;devices.smoke_co_alarms\u0026#34;)) explodedThermostatsDF: org.apache.spark.sql.DataFrame = [key: string, value: struct\u0026lt;device_id: string, locale: string ... 25 more fields\u0026gt;] explodedCamerasDF: org.apache.spark.sql.DataFrame = [key: string, value: struct\u0026lt;device_id: string, software_version: string ... 12 more fields\u0026gt;] explodedSmokedAlarmsDF: org.apache.spark.sql.DataFrame = [key: string, value: struct\u0026lt;device_id: string, locale: string ... 11 more fields\u0026gt;] key value peyiJNo0IldT2YlIVtYaGQ {\u0026ldquo;device_id\u0026rdquo;:\u0026ldquo;peyiJNo0IldT2YlIVtYaGQ\u0026rdquo;,\u0026ldquo;locale\u0026rdquo;:\u0026ldquo;en-US\u0026rdquo;,\u0026ldquo;software_version\u0026rdquo;:\u0026ldquo;4.0\u0026rdquo;,\u0026ldquo;structure_id\u0026rdquo;:\u0026ldquo;VqFabWH21nwVyd4RWgJgNb292wa7hG_dUwo2i2SG7j3-BOLY0BA4sw\u0026rdquo;,\u0026ldquo;where_name\u0026rdquo;:\u0026ldquo;Hallway Upstairs\u0026rdquo;,\u0026ldquo;last_connection\u0026rdquo;:\u0026ldquo;2016-10-31T23:59:59.000Z\u0026rdquo;,\u0026ldquo;is_online\u0026rdquo;:true,\u0026ldquo;can_cool\u0026rdquo;:true,\u0026ldquo;can_heat\u0026rdquo;:true,\u0026ldquo;is_using_emergency_heat\u0026rdquo;:true,\u0026ldquo;has_fan\u0026rdquo;:true,\u0026ldquo;fan_timer_active\u0026rdquo;:true,\u0026ldquo;fan_timer_timeout\u0026rdquo;:\u0026ldquo;2016-10-31T23:59:59.000Z\u0026rdquo;,\u0026ldquo;temperature_scale\u0026rdquo;:\u0026ldquo;F\u0026rdquo;,\u0026ldquo;target_temperature_f\u0026rdquo;:72,\u0026ldquo;target_temperature_high_f\u0026rdquo;:80,\u0026ldquo;target_temperature_low_f\u0026rdquo;:65,\u0026ldquo;eco_temperature_high_f\u0026rdquo;:80,\u0026ldquo;eco_temperature_low_f\u0026rdquo;:65,\u0026ldquo;away_temperature_high_f\u0026rdquo;:80,\u0026ldquo;away_temperature_low_f\u0026rdquo;:65,\u0026ldquo;hvac_mode\u0026rdquo;:\u0026ldquo;heat\u0026rdquo;,\u0026ldquo;humidity\u0026rdquo;:\u0026ldquo;40\u0026rdquo;,\u0026ldquo;hvac_state\u0026rdquo;:\u0026ldquo;heating\u0026rdquo;,\u0026ldquo;is_locked\u0026rdquo;:\u0026ldquo;true\u0026rdquo;,\u0026ldquo;locked_temp_min_f\u0026rdquo;:65,\u0026ldquo;locked_temp_max_f\u0026rdquo;:80} 要从 map 中提取特定的单个字段，可以使用 getItem() 方法。\nval thermostateDF = explodedThermostatsDF.select($\u0026#34;value\u0026#34;.getItem(\u0026#34;device_id\u0026#34;).alias(\u0026#34;device_id\u0026#34;), $\u0026#34;value\u0026#34;.getItem(\u0026#34;locale\u0026#34;).alias(\u0026#34;locale\u0026#34;), $\u0026#34;value\u0026#34;.getItem(\u0026#34;where_name\u0026#34;).alias(\u0026#34;location\u0026#34;), $\u0026#34;value\u0026#34;.getItem(\u0026#34;last_connection\u0026#34;).alias(\u0026#34;last_connected\u0026#34;), $\u0026#34;value\u0026#34;.getItem(\u0026#34;humidity\u0026#34;).alias(\u0026#34;humidity\u0026#34;), $\u0026#34;value\u0026#34;.getItem(\u0026#34;target_temperature_f\u0026#34;).alias(\u0026#34;target_temperature_f\u0026#34;), $\u0026#34;value\u0026#34;.getItem(\u0026#34;hvac_mode\u0026#34;).alias(\u0026#34;mode\u0026#34;), $\u0026#34;value\u0026#34;.getItem(\u0026#34;software_version\u0026#34;).alias(\u0026#34;version\u0026#34;)) val cameraDF = explodedCamerasDF.select($\u0026#34;value\u0026#34;.getItem(\u0026#34;device_id\u0026#34;).alias(\u0026#34;device_id\u0026#34;), $\u0026#34;value\u0026#34;.getItem(\u0026#34;where_name\u0026#34;).alias(\u0026#34;location\u0026#34;), $\u0026#34;value\u0026#34;.getItem(\u0026#34;software_version\u0026#34;).alias(\u0026#34;version\u0026#34;), $\u0026#34;value\u0026#34;.getItem(\u0026#34;activity_zones\u0026#34;).getItem(\u0026#34;name\u0026#34;).alias(\u0026#34;name\u0026#34;), $\u0026#34;value\u0026#34;.getItem(\u0026#34;activity_zones\u0026#34;).getItem(\u0026#34;id\u0026#34;).alias(\u0026#34;id\u0026#34;)) val smokedAlarmsDF = explodedSmokedAlarmsDF.select($\u0026#34;value\u0026#34;.getItem(\u0026#34;device_id\u0026#34;).alias(\u0026#34;device_id\u0026#34;), $\u0026#34;value\u0026#34;.getItem(\u0026#34;where_name\u0026#34;).alias(\u0026#34;location\u0026#34;), $\u0026#34;value\u0026#34;.getItem(\u0026#34;software_version\u0026#34;).alias(\u0026#34;version\u0026#34;), $\u0026#34;value\u0026#34;.getItem(\u0026#34;last_connection\u0026#34;).alias(\u0026#34;last_connected\u0026#34;), $\u0026#34;value\u0026#34;.getItem(\u0026#34;battery_health\u0026#34;).alias(\u0026#34;battery_health\u0026#34;)) thermostateDF: org.apache.spark.sql.DataFrame = [device_id: string, locale: string ... 6 more fields] cameraDF: org.apache.spark.sql.DataFrame = [device_id: string, location: string ... 3 more fields] smokedAlarmsDF: org.apache.spark.sql.DataFrame = [device_id: string, location: string ... 3 more fields] display(thermostateDF) device_id locale location last_connected humidity target_temperature_f mode version peyiJNo0IldT2YlIVtYaGQ en-US Hallway Upstairs 2016-10-31T23:59:59.000Z 40 72 heat 4.0 display(cameraDF) device_id location version name id awJo6rH Foyer 4.0 Walkway 244083 display(smokedAlarmsDF) device_id location version last_connected battery_health RTMTKxsQTCxzVcsySOHPxKoF4OyCifrs Jane\u0026rsquo;s Room 1.01 2016-10-31T23:59:59.000Z ok 让我们在列版本上 join 两个 DataFrame。\ndisplay(joineDFs) val joineDFs = thermostateDF.join(cameraDF, \u0026#34;version\u0026#34;) joineDFs: org.apache.spark.sql.DataFrame = [version: string, device_id: string ... 10 more fields] version device_id locale location last_connected humidity target_temperature_f mode device_id location name id 4.0 peyiJNo0IldT2YlIVtYaGQ en-US Hallway Upstairs 2016-10-31T23:59:59.000Z 40 72 heat awJo6rH Foyer Walkway 244083 总结 这个简短教程的重点是演示如何轻松使用实用程序函数从复杂的嵌套结构中提取 JSON 属性。一旦您将所需的值展开或展平或解析到相应的数据框或数据集中，您就可以像使用相应的 API 一样轻松地提取和查询它们，就像使用任何DataFrame 或 Dataset 一样。查看我们的结构化流体系列第3部分，其中展示了如何从 Apache Kafka 读取 Nest 设备日志并对其进行一些 ETL。\n"},"name":"五个用于提取和探索复杂数据类型的 Spark SQL Helper 实用程序函数","published":"2018-12-12T11:26:52Z","summary":"https://docs.databricks.com/_static/notebooks/complex-nested-structured.html\n虽然这个深入的博客列出并解释了处理和处理复杂数据类型和格式的概念和动机，但这个笔记本示例通过几个具体示例检查了如何将它们应用于您在使用中可能遇到的数据类型案例。这个简短的笔记本教程展示了一些方法，您可以在其中探索和使用许多新的帮助程序 Spark SQL 实用程序函数和 API 作为org.apache.spark.sql.functions 包的一部分。特别是，它们在执行 Streaming ETL 时派上用场，其中数据是具有复杂和嵌套结构的 JSON 对象：嵌入为 JSON 的 Map 和 Structs：\n_ get_json_object()\n_ from_json()\n_ to_json()\n_ explode()\n_ selectExpr()\n本简短教程的内容是使用 Spark SQL 实用程序函数对嵌套 JSON 结构进行切片和切块的无数方法。\n让我们创建一个带有属性和值的简单 JSON 模式，而不使用任何嵌套结构。\nimport org.apache.spark.sql.types._ // include the Spark Types to define our schema import org.apache.spark.sql.functions._ // include the Spark helper functions val jsonSchema = new StructType() .add(\u0026#34;battery_level\u0026#34;, LongType) .add(\u0026#34;c02_level\u0026#34;, LongType) .add(\u0026#34;cca3\u0026#34;,StringType) .add(\u0026#34;cn\u0026#34;, StringType) .add(\u0026#34;device_id\u0026#34;, LongType) .","type":"entry","url":"http://localhost:1313/notes/five-spark-sql-helper-utility-functions-to-extract-and-explore-complex-data-types/"}