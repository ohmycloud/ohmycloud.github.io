{"author":{"name":null,"type":"card","url":"https://ohmycloud.github.io/"},"content":{"html":"\u003cp\u003e\u003cimg src=\"https://mojolicious.io/blog/2018/12/14/a-practical-example-of-mojo-dom/banner.png\" alt=\"img\"\u003e\u003c/p\u003e\n\u003cp\u003e随着最新版本的Mojolicious，Mojo::DOM获得了很多力量，我很兴奋尝试，但没有时间。最近，我在实际工作中遇到了一个问题（在工程，采购和施工，或简称EPC），我在很短的时间内用Mojo::DOM（和Mojolicious的其他部分）解决了 - 包括学习如何使用Mojo::DOM，我以前从未做过。\u003c/p\u003e\n\u003ch2 id=\"任务---简单但乏味\"\u003e任务 - 简单，但乏味\u003c/h2\u003e\n\u003cp\u003e3D模型和绘图是很棒的工具，但实际上并不是那么完美。建筑公差就是它们的原因，我们公司非常依赖激光扫描，我们在那里进入项目现场并创建一个竣工条件的点云。这会生成数百个需要花费数小时才能处理的文件 - 最近的一个项目有超过30亿个人点。这些对于我们所做的每个项目的工程，建模和构造都至关重要。\u003c/p\u003e\n\u003cp\u003e问题是当我们的3D建模软件（Tekla Structures）处理点云时，它会将每个文件名从人类可读的东西（例如Pipe Rack Area1）更改为散列，如2e9d52829f973c5b98f60935d8a9fa2b。当一个项目可能有几十个区域时，这不是非常用户友好，而您实际上只想一次加载一个或两个（平均面积为15gb！）。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://mojolicious.io/blog/2018/12/14/a-practical-example-of-mojo-dom/pointcloud1.jpg\" alt=\"img\"\u003e\u003c/p\u003e\n\u003cp\u003e点云提供的关键信息太难或太昂贵，无法直接建模\u003c/p\u003e\n\u003cp\u003e幸运的是，Tekla使用了许多任何人都可以编辑的标准文件格式 - 包括使用XML来描述它已处理的每个点云。当然，我可以手工编辑它们来更改名称，但是每次扫描和每个项目都必须这样做 - 这不是一个好的解决方案。\u003c/p\u003e\n\u003cp\u003e方便的是，XML文件包含哈希名称和原始文件名 - 所以我知道我可以使用Mojo::DOM来解析XML并将点云重命名为人类可读。这个简单的任务就是Mojolicious如何用相对较短的代码完成大量工作的完美例子。结果如下：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"ch\"\u003e#!/usr/bin/perl\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::Base\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ebase\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::Util\u003c/span\u003e \u003cspan class=\"sx\"\u003eqw(getopt)\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::File\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::DOM\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003egetopt\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;p|path=s\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e\\\u003c/span\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$path\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003esub\u003c/span\u003e \u003cspan class=\"nf\"\u003emain\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"c1\"\u003e# look in xml elements for laserscans that have hashes for names\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::File\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;pointclouds.xml\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$dom\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::DOM\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eslurp\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"c1\"\u003e# if \u0026#39;Hash\u0026#39; is populated, rename_files(); otherwise ignore\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$e\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$dom\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003efind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;PointCloudData\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nb\"\u003eeach\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e    \u003cspan class=\"nv\"\u003e$e\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eFolder\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erename_files\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$e\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"ow\"\u003eand\u003c/span\u003e \u003cspan class=\"nv\"\u003e$e\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eHash\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nv\"\u003e$e\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eHash\u003c/span\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"c1\"\u003e# save xml file so we don\u0026#39;t try to rename the pointclouds again\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003espurt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$dom\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003esub\u003c/span\u003e \u003cspan class=\"nf\"\u003erename_files\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"c1\"\u003e# rename pointcloud folder and database file\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$e\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nb\"\u003eshift\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$newname\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$e\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eFolder\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e=~\u003c/span\u003e \u003cspan class=\"sr\"\u003es/$e-\u0026gt;{Hash}/$e-\u0026gt;{Name}/\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"n\"\u003esay\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#34;renaming: $e-\u0026gt;{Folder} to:\\n$newname\u0026#34;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003erename\u003c/span\u003e \u003cspan class=\"nv\"\u003e$e\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eFolder\u003c/span\u003e\u003cspan class=\"p\"\u003e},\u003c/span\u003e       \u003cspan class=\"nv\"\u003e$newname\u003c/span\u003e       \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"nb\"\u003edie\u003c/span\u003e \u003cspan class=\"vg\"\u003e$!\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nb\"\u003erename\u003c/span\u003e \u003cspan class=\"nv\"\u003e$e\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eFolder\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;.db\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"nv\"\u003e$newname\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;.db\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"nb\"\u003edie\u003c/span\u003e \u003cspan class=\"vg\"\u003e$!\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"k\"\u003ereturn\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$newname\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003emain\u003c/span\u003e\u003cspan class=\"p\"\u003e()\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nv\"\u003e$path\u003c/span\u003e \u003cspan class=\"o\"\u003e||\u003c/span\u003e \u003cspan class=\"nb\"\u003edie\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;Please enter a path to the example files.\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"不是-web-应用程序\"\u003e不是 Web 应用程序\u003c/h2\u003e\n\u003cp\u003e并非每次使用Mojolicious都必须是一个完整的应用程序 - 它的一部分可以像任何其他Perl模块一样使用。对于一个简单的脚本，它可以更快地达到您的实际目的。我现在一直使用以下行，即使我没有构建一个完整的Mojolicious应用程序。 Mojo::Base使我免于输入额外的锅炉板并启用严格，警告和我经常想要使用的其他好东西。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003euse\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::Base\u003c/span\u003e \u003cspan class=\"o\"\u003e-\u003c/span\u003e\u003cspan class=\"n\"\u003ebase\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"mojoutil----只是为了好玩\"\u003eMojo::Util  - 只是为了好玩\u003c/h2\u003e\n\u003cp\u003e我的实用程序的生产版本实际上加载了一个假的Mojolicious $app，以便我可以使用Mojolicious::Plugin::Config在myapp.conf中找到点云文件，但在这个版本中我使用Mojo::Util来获取点云文件路径，带有命令行选项\u0026ndash;p。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"n\"\u003egetopt\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;p|path=s\u0026#39;\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u0026gt;\u003c/span\u003e \u003cspan class=\"o\"\u003e\\\u003c/span\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$path\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e要在示例文件上运行我的实用程序，必须先将pointclouds.xml中Folder的内容更改为保存它们的位置。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$\u003c/span\u003e \u003cspan class=\"nv\"\u003eperl\u003c/span\u003e \u003cspan class=\"n\"\u003etekla_utility\u003c/span\u003e\u003cspan class=\"o\"\u003e.\u003c/span\u003e\u003cspan class=\"n\"\u003epl\u003c/span\u003e \u003cspan class=\"o\"\u003e--\u003c/span\u003e\u003cspan class=\"n\"\u003ep\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;path to example files\u0026#39;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"mojofile----永远不要再手动编写文件代码\"\u003eMojo::File  - 永远不要再手动编写文件代码！\u003c/h2\u003e\n\u003cp\u003eMojo::File使得读取pointclouds.xml所以我可以用Mojo::DOM简单解析它：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$file\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::File\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$path\u003c/span\u003e\u003cspan class=\"p\"\u003e,\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;pointclouds.xml\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$dom\u003c/span\u003e  \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nn\"\u003eMojo::DOM\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"k\"\u003enew\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003eslurp\u003c/span\u003e\u003cspan class=\"p\"\u003e);\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e在过去的糟糕时期，每次我想读取文件时，我可能会手写15行（可怕的）代码。\u003c/p\u003e\n\u003ch2 id=\"mojodom----它不能做什么\"\u003eMojo::DOM  - 它不能做什么？\u003c/h2\u003e\n\u003cp\u003e当然，Mojo::DOM可以轻松地在XML中找到正确的值 - 它还可以处理HTML和CSS选择器。基本上，我只是遍历PointCloudData的内容，它包含Tekla处理的每个点云的Folder，Hash和Name键：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003efor\u003c/span\u003e \u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$e\u003c/span\u003e \u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$dom\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003efind\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"s\"\u003e\u0026#39;PointCloudData\u0026#39;\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"nb\"\u003eeach\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"p\"\u003e{\u003c/span\u003e \n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e  \u003cspan class=\"nv\"\u003e$e\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eFolder\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"n\"\u003erename_files\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$e\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e \u003cspan class=\"ow\"\u003eand\u003c/span\u003e \u003cspan class=\"nv\"\u003e$e\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eHash\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"s\"\u003e\u0026#39;\u0026#39;\u003c/span\u003e \u003cspan class=\"k\"\u003eif\u003c/span\u003e \u003cspan class=\"nv\"\u003e$e\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eHash\u003c/span\u003e\u003cspan class=\"p\"\u003e};\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e如果填充了Hash，我只运行rename_files，如果是，我将其清空，所以我不会再尝试重命名它们。 rename_files是关于我自己编写的唯一Perl代码 - 几乎所有其他内容都是从优秀的Mojolicious文档中直接复制和粘贴的！\u003c/p\u003e\n\u003cp\u003e替换在$newname中存储所需的文件和文件夹名称（非破坏性修饰符/ r允许我在不更改原始文件的情况下处理$e的副本）。然后我只需重命名点云文件夹和* .db文件（其中包含实际的点云数据）。\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"k\"\u003emy\u003c/span\u003e \u003cspan class=\"nv\"\u003e$newname\u003c/span\u003e \u003cspan class=\"o\"\u003e=\u003c/span\u003e \u003cspan class=\"nv\"\u003e$e\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"p\"\u003e{\u003c/span\u003e\u003cspan class=\"n\"\u003eFolder\u003c/span\u003e\u003cspan class=\"p\"\u003e}\u003c/span\u003e \u003cspan class=\"o\"\u003e=~\u003c/span\u003e \u003cspan class=\"sr\"\u003es/$e-\u0026gt;{Hash}/$e-\u0026gt;{Name}/\u003c/span\u003e\u003cspan class=\"n\"\u003er\u003c/span\u003e\u003cspan class=\"p\"\u003e;\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e当我完成重命名点云时，我使用Mojo::File将$dom的内容保存回pointclouds.xml一行：\u003c/p\u003e\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" class=\"chroma\"\u003e\u003ccode class=\"language-perl\" data-lang=\"perl\"\u003e\u003cspan class=\"line\"\u003e\u003cspan class=\"cl\"\u003e\u003cspan class=\"nv\"\u003e$file\u003c/span\u003e\u003cspan class=\"o\"\u003e-\u0026gt;\u003c/span\u003e\u003cspan class=\"n\"\u003espurt\u003c/span\u003e\u003cspan class=\"p\"\u003e(\u003c/span\u003e\u003cspan class=\"nv\"\u003e$dom\u003c/span\u003e\u003cspan class=\"p\"\u003e)\u003c/span\u003e\n\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003e好的一点是，当我在循环中更改$e  - \u0026gt; {Folder}和$e  -\u0026gt; {Hash}的内容时，将其保存回来只是起作用 - 我不需要过多考虑XML结构所有。有趣的是，保存$dom可以实现密钥，但Tekla似乎没有注意到。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://mojolicious.io/blog/2018/12/14/a-practical-example-of-mojo-dom/pointcloud2.jpg\" alt=\"img\"\u003e\u003c/p\u003e\n\u003cp\u003e注意点云的粒状性质 - 因为它们只是没有区域的点，越接近，它看起来就越粗糙\u003c/p\u003e\n\u003ch2 id=\"适用于所有技能水平\"\u003e适用于所有技能水平\u003c/h2\u003e\n\u003cp\u003e这只是我在日常工作中如何使用Mojolicious的一个例子。有时候，现有软件不能做你想做的事情，或者用一种无用的格式 - 可以用Mojolicious提供的许多工具解决的问题。你甚至不必是一个真正的程序员（我不是），或者根本不在软件行业工作。\u003c/p\u003e\n\u003cp\u003e我的下一个项目想法是重建我为Material Take Offs（MTO）编写的报告工具，以便与我们的工程师喜爱的Tekla一起使用我们的旧建模软件 - 我相信我会继续发现Mojolicious的良好用途。未来。\u003c/p\u003e\n","text":"\n随着最新版本的Mojolicious，Mojo::DOM获得了很多力量，我很兴奋尝试，但没有时间。最近，我在实际工作中遇到了一个问题（在工程，采购和施工，或简称EPC），我在很短的时间内用Mojo::DOM（和Mojolicious的其他部分）解决了 - 包括学习如何使用Mojo::DOM，我以前从未做过。\n任务 - 简单，但乏味 3D模型和绘图是很棒的工具，但实际上并不是那么完美。建筑公差就是它们的原因，我们公司非常依赖激光扫描，我们在那里进入项目现场并创建一个竣工条件的点云。这会生成数百个需要花费数小时才能处理的文件 - 最近的一个项目有超过30亿个人点。这些对于我们所做的每个项目的工程，建模和构造都至关重要。\n问题是当我们的3D建模软件（Tekla Structures）处理点云时，它会将每个文件名从人类可读的东西（例如Pipe Rack Area1）更改为散列，如2e9d52829f973c5b98f60935d8a9fa2b。当一个项目可能有几十个区域时，这不是非常用户友好，而您实际上只想一次加载一个或两个（平均面积为15gb！）。\n点云提供的关键信息太难或太昂贵，无法直接建模\n幸运的是，Tekla使用了许多任何人都可以编辑的标准文件格式 - 包括使用XML来描述它已处理的每个点云。当然，我可以手工编辑它们来更改名称，但是每次扫描和每个项目都必须这样做 - 这不是一个好的解决方案。\n方便的是，XML文件包含哈希名称和原始文件名 - 所以我知道我可以使用Mojo::DOM来解析XML并将点云重命名为人类可读。这个简单的任务就是Mojolicious如何用相对较短的代码完成大量工作的完美例子。结果如下：\n#!/usr/bin/perl use Mojo::Base -base; use Mojo::Util qw(getopt); use Mojo::File; use Mojo::DOM; getopt \u0026#39;p|path=s\u0026#39; =\u0026gt; \\my $path; sub main { # look in xml elements for laserscans that have hashes for names my $file = Mojo::File-\u0026gt;new($path, \u0026#39;pointclouds.xml\u0026#39;); my $dom = Mojo::DOM-\u0026gt;new($file-\u0026gt;slurp); # if \u0026#39;Hash\u0026#39; is populated, rename_files(); otherwise ignore for my $e ($dom-\u0026gt;find(\u0026#39;PointCloudData\u0026#39;)-\u0026gt;each) { $e-\u0026gt;{Folder} = rename_files($e) and $e-\u0026gt;{Hash} = \u0026#39;\u0026#39; if $e-\u0026gt;{Hash}; } # save xml file so we don\u0026#39;t try to rename the pointclouds again $file-\u0026gt;spurt($dom); } sub rename_files { # rename pointcloud folder and database file my $e = shift; my $newname = $e-\u0026gt;{Folder} =~ s/$e-\u0026gt;{Hash}/$e-\u0026gt;{Name}/r; say \u0026#34;renaming: $e-\u0026gt;{Folder} to:\\n$newname\u0026#34;; rename $e-\u0026gt;{Folder}, $newname || die $!; rename $e-\u0026gt;{Folder}.\u0026#39;.db\u0026#39;, $newname.\u0026#39;.db\u0026#39; || die $!; return ($newname); } main() if $path || die \u0026#39;Please enter a path to the example files.\u0026#39;; 不是 Web 应用程序 并非每次使用Mojolicious都必须是一个完整的应用程序 - 它的一部分可以像任何其他Perl模块一样使用。对于一个简单的脚本，它可以更快地达到您的实际目的。我现在一直使用以下行，即使我没有构建一个完整的Mojolicious应用程序。 Mojo::Base使我免于输入额外的锅炉板并启用严格，警告和我经常想要使用的其他好东西。\nuse Mojo::Base -base; Mojo::Util - 只是为了好玩 我的实用程序的生产版本实际上加载了一个假的Mojolicious $app，以便我可以使用Mojolicious::Plugin::Config在myapp.conf中找到点云文件，但在这个版本中我使用Mojo::Util来获取点云文件路径，带有命令行选项\u0026ndash;p。\ngetopt \u0026#39;p|path=s\u0026#39; =\u0026gt; \\my $path; 要在示例文件上运行我的实用程序，必须先将pointclouds.xml中Folder的内容更改为保存它们的位置。\n$ perl tekla_utility.pl --p \u0026#39;path to example files\u0026#39; Mojo::File - 永远不要再手动编写文件代码！ Mojo::File使得读取pointclouds.xml所以我可以用Mojo::DOM简单解析它：\nmy $file = Mojo::File-\u0026gt;new($path, \u0026#39;pointclouds.xml\u0026#39;); my $dom = Mojo::DOM-\u0026gt;new($file-\u0026gt;slurp); 在过去的糟糕时期，每次我想读取文件时，我可能会手写15行（可怕的）代码。\nMojo::DOM - 它不能做什么？ 当然，Mojo::DOM可以轻松地在XML中找到正确的值 - 它还可以处理HTML和CSS选择器。基本上，我只是遍历PointCloudData的内容，它包含Tekla处理的每个点云的Folder，Hash和Name键：\nfor my $e ($dom-\u0026gt;find(\u0026#39;PointCloudData\u0026#39;)-\u0026gt;each) { $e-\u0026gt;{Folder} = rename_files($e) and $e-\u0026gt;{Hash} = \u0026#39;\u0026#39; if $e-\u0026gt;{Hash}; } 如果填充了Hash，我只运行rename_files，如果是，我将其清空，所以我不会再尝试重命名它们。 rename_files是关于我自己编写的唯一Perl代码 - 几乎所有其他内容都是从优秀的Mojolicious文档中直接复制和粘贴的！\n替换在$newname中存储所需的文件和文件夹名称（非破坏性修饰符/ r允许我在不更改原始文件的情况下处理$e的副本）。然后我只需重命名点云文件夹和* .db文件（其中包含实际的点云数据）。\nmy $newname = $e-\u0026gt;{Folder} =~ s/$e-\u0026gt;{Hash}/$e-\u0026gt;{Name}/r; 当我完成重命名点云时，我使用Mojo::File将$dom的内容保存回pointclouds.xml一行：\n$file-\u0026gt;spurt($dom) 好的一点是，当我在循环中更改$e - \u0026gt; {Folder}和$e -\u0026gt; {Hash}的内容时，将其保存回来只是起作用 - 我不需要过多考虑XML结构所有。有趣的是，保存$dom可以实现密钥，但Tekla似乎没有注意到。\n注意点云的粒状性质 - 因为它们只是没有区域的点，越接近，它看起来就越粗糙\n适用于所有技能水平 这只是我在日常工作中如何使用Mojolicious的一个例子。有时候，现有软件不能做你想做的事情，或者用一种无用的格式 - 可以用Mojolicious提供的许多工具解决的问题。你甚至不必是一个真正的程序员（我不是），或者根本不在软件行业工作。\n我的下一个项目想法是重建我为Material Take Offs（MTO）编写的报告工具，以便与我们的工程师喜爱的Tekla一起使用我们的旧建模软件 - 我相信我会继续发现Mojolicious的良好用途。未来。\n"},"name":"第十四天 - Mojo::DOM 实例","published":"2018-12-14T12:30:57Z","summary":"随着最新版本的Mojolicious，Mojo::DOM获得了很多力量，我很兴奋尝试，但没有时间。最近，我在实际工作中遇到了一个问题（在工程，采购和施工，或简称EPC），我在很短的时间内用Mojo::DOM（和Mojolicious的其他部分）解决了 - 包括学习如何使用Mojo::DOM，我以前从未做过。\n任务 - 简单，但乏味 3D模型和绘图是很棒的工具，但实际上并不是那么完美。建筑公差就是它们的原因，我们公司非常依赖激光扫描，我们在那里进入项目现场并创建一个竣工条件的点云。这会生成数百个需要花费数小时才能处理的文件 - 最近的一个项目有超过30亿个人点。这些对于我们所做的每个项目的工程，建模和构造都至关重要。\n问题是当我们的3D建模软件（Tekla Structures）处理点云时，它会将每个文件名从人类可读的东西（例如Pipe Rack Area1）更改为散列，如2e9d52829f973c5b98f60935d8a9fa2b。当一个项目可能有几十个区域时，这不是非常用户友好，而您实际上只想一次加载一个或两个（平均面积为15gb！）。\n点云提供的关键信息太难或太昂贵，无法直接建模\n幸运的是，Tekla使用了许多任何人都可以编辑的标准文件格式 - 包括使用XML来描述它已处理的每个点云。当然，我可以手工编辑它们来更改名称，但是每次扫描和每个项目都必须这样做 - 这不是一个好的解决方案。\n方便的是，XML文件包含哈希名称和原始文件名 - 所以我知道我可以使用Mojo::DOM来解析XML并将点云重命名为人类可读。这个简单的任务就是Mojolicious如何用相对较短的代码完成大量工作的完美例子。结果如下：\n#!/usr/bin/perl use Mojo::Base -base; use Mojo::Util qw(getopt); use Mojo::File; use Mojo::DOM; getopt \u0026#39;p|path=s\u0026#39; =\u0026gt; \\my $path; sub main { # look in xml elements for laserscans that have hashes for names my $file = Mojo::File-\u0026gt;new($path, \u0026#39;pointclouds.xml\u0026#39;); my $dom = Mojo::DOM-\u0026gt;new($file-\u0026gt;slurp); # if \u0026#39;Hash\u0026#39; is populated, rename_files(); otherwise ignore for my $e ($dom-\u0026gt;find(\u0026#39;PointCloudData\u0026#39;)-\u0026gt;each) { $e-\u0026gt;{Folder} = rename_files($e) and $e-\u0026gt;{Hash} = \u0026#39;\u0026#39; if $e-\u0026gt;{Hash}; } # save xml file so we don\u0026#39;t try to rename the pointclouds again $file-\u0026gt;spurt($dom); } sub rename_files { # rename pointcloud folder and database file my $e = shift; my $newname = $e-\u0026gt;{Folder} =~ s/$e-\u0026gt;{Hash}/$e-\u0026gt;{Name}/r; say \u0026#34;renaming: $e-\u0026gt;{Folder} to:\\n$newname\u0026#34;; rename $e-\u0026gt;{Folder}, $newname || die $!","type":"entry","url":"https://ohmycloud.github.io/notes/a-practical-example-of-mojo-dom/"}