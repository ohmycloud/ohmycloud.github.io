<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">

    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
    
    
    

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5">

    
    <meta name="referrer" content="no-referrer">

    <title>
        
            Raku 面向对象简单入门 ❚ 焉知非鱼
        
    </title>

    
    


    
    
    
    

    
    
    
    

    
    
    

    
    
    
    <style>
     
     
     :root {
         --theme-color: #ac4142;
         --theme-color-light: rgba(172, 65, 66, 0.2);
     }
     
     html {
         line-height: 1.5;
     }
    </style>

    
    

    
    
    
    
    <link rel="stylesheet" href="/css/refined.min.7f6d3ee611034e4ebcbc063f1db3bc042fecdc8901afbedad80ff02bae409204.css">
    
    <link rel="preload" href="/css/refined.min.7f6d3ee611034e4ebcbc063f1db3bc042fecdc8901afbedad80ff02bae409204.css" as="style">

    



    
        <style>
         
         /* Background */ .chroma { background-color: #ffffff }
/* Error */ .chroma .err { color: #a61717; background-color: #e3d2d2 }
/* LineTableTD */ .chroma .lntd { vertical-align: top; padding: 0; margin: 0; border: 0; }
/* LineTable */ .chroma .lntable { border-spacing: 0; padding: 0; margin: 0; border: 0; width: auto; overflow: auto; display: block; }
/* LineHighlight */ .chroma .hl { display: block; width: 100%;background-color: #ffffcc }
/* LineNumbersTable */ .chroma .lnt { margin-right: 0.4em; padding: 0 0.4em 0 0.4em; }
/* LineNumbers */ .chroma .ln { margin-right: 0.4em; padding: 0 0.4em 0 0.4em; }
/* Keyword */ .chroma .k { color: #000000; font-weight: bold }
/* KeywordConstant */ .chroma .kc { color: #000000; font-weight: bold }
/* KeywordDeclaration */ .chroma .kd { color: #000000; font-weight: bold }
/* KeywordNamespace */ .chroma .kn { color: #000000; font-weight: bold }
/* KeywordPseudo */ .chroma .kp { color: #000000; font-weight: bold }
/* KeywordReserved */ .chroma .kr { color: #000000; font-weight: bold }
/* KeywordType */ .chroma .kt { color: #445588; font-weight: bold }
/* NameAttribute */ .chroma .na { color: #008080 }
/* NameBuiltin */ .chroma .nb { color: #0086b3 }
/* NameBuiltinPseudo */ .chroma .bp { color: #999999 }
/* NameClass */ .chroma .nc { color: #445588; font-weight: bold }
/* NameConstant */ .chroma .no { color: #008080 }
/* NameDecorator */ .chroma .nd { color: #3c5d5d; font-weight: bold }
/* NameEntity */ .chroma .ni { color: #800080 }
/* NameException */ .chroma .ne { color: #990000; font-weight: bold }
/* NameFunction */ .chroma .nf { color: #990000; font-weight: bold }
/* NameLabel */ .chroma .nl { color: #990000; font-weight: bold }
/* NameNamespace */ .chroma .nn { color: #555555 }
/* NameTag */ .chroma .nt { color: #000080 }
/* NameVariable */ .chroma .nv { color: #008080 }
/* NameVariableClass */ .chroma .vc { color: #008080 }
/* NameVariableGlobal */ .chroma .vg { color: #008080 }
/* NameVariableInstance */ .chroma .vi { color: #008080 }
/* LiteralString */ .chroma .s { color: #dd1144 }
/* LiteralStringAffix */ .chroma .sa { color: #dd1144 }
/* LiteralStringBacktick */ .chroma .sb { color: #dd1144 }
/* LiteralStringChar */ .chroma .sc { color: #dd1144 }
/* LiteralStringDelimiter */ .chroma .dl { color: #dd1144 }
/* LiteralStringDoc */ .chroma .sd { color: #dd1144 }
/* LiteralStringDouble */ .chroma .s2 { color: #dd1144 }
/* LiteralStringEscape */ .chroma .se { color: #dd1144 }
/* LiteralStringHeredoc */ .chroma .sh { color: #dd1144 }
/* LiteralStringInterpol */ .chroma .si { color: #dd1144 }
/* LiteralStringOther */ .chroma .sx { color: #dd1144 }
/* LiteralStringRegex */ .chroma .sr { color: #009926 }
/* LiteralStringSingle */ .chroma .s1 { color: #dd1144 }
/* LiteralStringSymbol */ .chroma .ss { color: #990073 }
/* LiteralNumber */ .chroma .m { color: #009999 }
/* LiteralNumberBin */ .chroma .mb { color: #009999 }
/* LiteralNumberFloat */ .chroma .mf { color: #009999 }
/* LiteralNumberHex */ .chroma .mh { color: #009999 }
/* LiteralNumberInteger */ .chroma .mi { color: #009999 }
/* LiteralNumberIntegerLong */ .chroma .il { color: #009999 }
/* LiteralNumberOct */ .chroma .mo { color: #009999 }
/* Operator */ .chroma .o { color: #000000; font-weight: bold }
/* OperatorWord */ .chroma .ow { color: #000000; font-weight: bold }
/* Comment */ .chroma .c { color: #999988; font-style: italic }
/* CommentHashbang */ .chroma .ch { color: #999988; font-style: italic }
/* CommentMultiline */ .chroma .cm { color: #999988; font-style: italic }
/* CommentSingle */ .chroma .c1 { color: #999988; font-style: italic }
/* CommentSpecial */ .chroma .cs { color: #999999; font-weight: bold; font-style: italic }
/* CommentPreproc */ .chroma .cp { color: #999999; font-weight: bold; font-style: italic }
/* CommentPreprocFile */ .chroma .cpf { color: #999999; font-weight: bold; font-style: italic }
/* GenericDeleted */ .chroma .gd { color: #000000; background-color: #ffdddd }
/* GenericEmph */ .chroma .ge { color: #000000; font-style: italic }
/* GenericError */ .chroma .gr { color: #aa0000 }
/* GenericHeading */ .chroma .gh { color: #999999 }
/* GenericInserted */ .chroma .gi { color: #000000; background-color: #ddffdd }
/* GenericOutput */ .chroma .go { color: #888888 }
/* GenericPrompt */ .chroma .gp { color: #555555 }
/* GenericStrong */ .chroma .gs { font-weight: bold }
/* GenericSubheading */ .chroma .gu { color: #aaaaaa }
/* GenericTraceback */ .chroma .gt { color: #aa0000 }
/* GenericUnderline */ .chroma .gl { text-decoration: underline }
/* TextWhitespace */ .chroma .w { color: #bbbbbb }

         
         /* Overrides on top of the theme and Chroma CSS */
/* Chroma-based lines highlighting in code blocks */
.chroma .hl {
    background-color: #e8e8e8;
    /* Extend highlight up to 100 characters (assuming that the code blocks never have more than 100 characters in a line) */
    min-width: 100ch;
}
/* GenericHeading */ .chroma .gh { color: #999999; font-weight: bold }
/* GenericSubheading */ .chroma .gu { color: #aaaaaa; font-weight: bold }

         
        </style>
    

    

    
    
    

    
    <script src="/js/responsive-nav-orig.min.e2b5f2a956b488f466da513820636134defdc38b90ed566248960593f2bb4ba5.js"></script>
    
    <link rel="preload" href="/js/responsive-nav-orig.min.e2b5f2a956b488f466da513820636134defdc38b90ed566248960593f2bb4ba5.js" as="script">

    
    
    <script defer src="/js/libs/fa/fontawesome-all.min.08916ac0fd078adfb58edc890460e2c8990729aee02bca7586404b56805f5219.js"></script>
    
    <link rel="preload" href="/js/libs/fa/fontawesome-all.min.08916ac0fd078adfb58edc890460e2c8990729aee02bca7586404b56805f5219.js" as="script">

    

    

    
    
    

    
    
<!-- rel="me" links for IndieAuth -->







    
 
<meta property="og:title" content="Raku 面向对象简单入门" />
<meta property="og:description"
      content=" " />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/1/2018-10-03-a-naive-introduction-to-object-orientation-in-perl-6/" />


    
        <meta property="article:published_time" content="2018-10-03T21:13:31&#43;08:00"/>
    
    
        <meta property="article:modified_time" content="2018-10-03T21:13:31&#43;08:00"/>
    









    




     <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Raku 面向对象简单入门"/>
<meta name="twitter:description" content=" "/>


    
    
    <link rel="alternate" type="application/jf2post+json" href="http://localhost:1313/1/2018-10-03-a-naive-introduction-to-object-orientation-in-perl-6/jf2post.json" title="Jf2post for 焉知非鱼" />
    
     



    
    
    
        
    


     
        
        <meta name="DC.Creator" content="焉知非鱼"/>
    



    
    
    
    <meta name="hugo-build-date" content="2024-03-01T16:16:06Z"/>
    <meta name="hugo-commit-hash" content="312735366b20d64bd61bff8627f593749f86c964"/>
    <meta name="generator" content="Hugo 0.123.7">
</head>


    
        <body lang="en">
    

        
        <div class="border" id="home"></div>

        <div class="wrapper">   
            
<nav id="nav" class="nav-collapse opened" aria-hidden="false">
    <ul class="navbar">
        <li><a class="" href="/">Home</a></li>
        
            
                <li><a class="" href="http://localhost:1313/posts/">Posts</a></li>
            
        
            
                <li><a class="" href="http://localhost:1313/notes/">Notes</a></li>
            
        
            
                <li><a class="" href="http://localhost:1313/raku/">Raku</a></li>
            
        
        
            <li><a class="" href="http://localhost:1313/search/">Search</a></li>
        
    </ul>
</nav>

            <div class="container">
                <header class="masthead">
                    <div class="masthead-title no-text-decoration">
                        <a href="/">焉知非鱼</a> <span class="blinking-cursor">❚</span>
                    </div>
                    <div class="masthead-tagline">
                        Wait the light to fall
                    </div>
                </header>

                








<article class="post h-entry 1">
    <header>
        <div class="center">
    <div class="taxo no-text-decoration">
         
            
                <ul class="no-bullets inline categories">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts categorized in ‘rakulang’"
                                
                            >
                                <a class="p-category" href="http://localhost:1313/categories/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
         
            
                <ul class="no-bullets inline tags">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts tagged with ‘rakulang’"
                                
                            >
                                <a class="p-category" href="http://localhost:1313/tags/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
        
    </div>

</div>

        <h1 class="post-title p-name">Raku 面向对象简单入门</h1>

        
        <data class="u-url" value="http://localhost:1313/1/2018-10-03-a-naive-introduction-to-object-orientation-in-perl-6/"></data>

        <div class="date-syndication">
            


    
    
    <div class="post-date">
        
        <time datetime="2018-10-03T21:13:31+0800" class="dt-published">Wed Oct 3, 2018</time>
        
        
    </div>


            




        </div>
         



    
    
    
        
    


    
        
        <span class="hide">
            &mdash; <a href="http://localhost:1313/" class="u-author">焉知非鱼</a>
        </span>
    


    </header>

    <div class="content">
        


        





                       


        <div class="e-content">
            




<h1 id="序言">序言</h1>
<h2 id="介绍">介绍&nbsp;<a class="headline-hash no-text-decoration" href="#介绍">#</a> </h2>
<p>本教程最多只关注 Raku 中的面向对象编程(OOP)的基本知识。因此，对语句/表达式、变量、条件、循环、子例程(函数)等有一个基本的了解是很重要的，如果不在 Raku 中，至少在另一种编程语言中是这样的。此外，您至少应该对类、属性和方法有一般的了解。作为对 Raku 的介绍，我强烈推荐 <a href="https://rakuintro.com/">Raku introduction</a>。下一步是 Raku 文档。</p>
<p>确保你已经设置好了 Raku 编译器。如果你还没有设置好，请看<a href="https://raku.org/getting-started/">这里</a>。
从这里开始，你可能会厌倦代词“我们”，但它的使用是经过深思熟虑的。这是一个教程，希望你能跟上。所以，是的，我们在一起工作，你应该做好准备。顺便说一下，本教程是冗长的，这是故意的，但也是手把手教程的副产品。</p>
<h2 id="问题陈述">问题陈述&nbsp;<a class="headline-hash no-text-decoration" href="#问题陈述">#</a> </h2>
<p>我们将从现实生活中的问题开始，并尝试以面向对象的方式对其进行建模。问题陈述如下:
在她的数学101课程中，一位教授记录了三个作业(2个作业和1个考试)的分数，按照学生交作业的顺序:</p>
<pre><code>Bill Jones:1:35
Sara Tims:2:45
Sara Tims:1:39
Bill Jones:1:42
Bill Jones:E1:72
</code></pre>
<p>在一个名为 MATH-101 的简单文本文件中。您可以假设有更多的学生，而这只是数据文件的一个代表性块。在这个文件中，每行记录学生的姓名、作业编号(作业编号为1,2，第一次考试为E1)和学生获得的原始分数。
教授使用另一个扩展名为 .std 的文件存储她课程的学生名单:</p>
<pre><code>Bill Jones
Ana Smith
Sara Tims
Frank Horza
</code></pre>
<p>除了 MATH-101，这位教授还教其他课程，并设计了一个扩展名为 .cfg 的配置文件来存储给定课程的配置格式。她这样做的目的是在她的其他课程中也使用它。配置文件格式指定了作业的类型、作业编号、作业的总分以及作业对最终课程成绩的贡献。她的数学101课程的 .cfg 文件如下:</p>
<pre><code>Homework:1:50:25
Homework:2:50:25
Exam:1:75:50
</code></pre>
<p>您的任务是创建一个名为 report.p6 的程序。该程序生成一个报告，其中列出了班级中每个学生的姓名、每次作业的分数和最终成绩。该程序应该假设具有扩展名 .cgf 和 .std 的文件在执行该程序的目录中可用。另一方面，包含学生成绩的文件必须通过命令行传递给程序。为了简单起见，您可以假设每个文件都是根据课程命名的。对于她的数学101课程，教授会有以下的文件: MATH-101, MATH-101.std 和 MATH-101.cfg，还有脚本 report.p6。</p>
<h2 id="分析">分析&nbsp;<a class="headline-hash no-text-decoration" href="#分析">#</a> </h2>
<p>如果我们看问题陈述，我们可以把所有的东西分成三类:课程，学生和作业。就目前而言，每个类别都可以被视为具有状态和行为的类。我们将从最简单的类别，作业类别，到最一般的类别，课程类别。为了做到这一点，我们首先学习 Raku 中类的定义。</p>
<h1 id="raku-类">Raku 类</h1>
<h2 id="类定义">类定义&nbsp;<a class="headline-hash no-text-decoration" href="#类定义">#</a> </h2>
<p>在 Raku 中，类是用 class 关键字定义的，通常后面跟着类名（通常以首字母大写形式）。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Name-of-class</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="属性定义">属性定义&nbsp;<a class="headline-hash no-text-decoration" href="#属性定义">#</a> </h2>
<p>所有的 Raku 属性默认都是私有的，这意味着它们只能在类中访问。属性是使用 <code>has</code> 关键字和 <code>!</code> twigil 定义的。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Name-of-class</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="nv">$!attribute-name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>属性也可以使用 <code>.</code> twigil。这个 twigil 声明，应该生成一个以属性命名的只读访问器方法:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Name-of-class</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="nv">$.attribute-name</span><span class="p">;</span> <span class="c1"># $!attribute-name + attribute-name()</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>这等价于:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Name-of-class</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="nv">$!attribute-name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">attribute-name</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$!attribute-name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>生成的访问器方法是只读的，因为属性默认是只读的(从类的外部)。为了允许通过访问器方法修改属性，必须向属性添加 <code>is rw</code> 特质。其他特质也可以用于属性。有关特质的更多信息，请参阅文档。</p>
<h1 id="作业类">作业类</h1>
<p>让我们从详细描述 <code>Assignment</code> 类所需的属性开始:</p>
<ul>
<li><code>type</code>——作业的类型(作业或考试)。</li>
<li><code>number</code>——作业编号(1,2等)。</li>
<li><code>score</code>——这个作业的分数。</li>
<li><code>raw</code>——给定作业的最大点数。</li>
<li><code>contrib</code>——作业对最终成绩的贡献。</li>
<li><code>adjusted-score</code>——基于 <code>score</code>，<code>raw</code> 和 <code>contrib</code> 属性的格式化的分数。</li>
<li><code>config</code>——一个包含课程配置文件的散列。</li>
</ul>
<p>关于 <code>config</code> 哈希，每个赋值的信息将存储在一个数组中，这个数组将根据每个赋值(作业或考试)在数组中的赋值号进行索引。由于没有零赋值，这个槽将用于存储已处理的赋值总数。MATH-101.cfg 的 <code>config</code> 散列是这样的:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="nv">%</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">Homework</span> <span class="o">=&gt;</span> <span class="o">[</span> <span class="p">{</span><span class="s">total</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">}</span><span class="o">,</span> <span class="p">(</span><span class="mi">50</span><span class="o">,</span> <span class="mi">25</span><span class="p">)</span><span class="o">,</span> <span class="p">(</span><span class="mi">50</span><span class="o">,</span> <span class="mi">25</span><span class="p">)</span> <span class="o">],</span>
</span></span><span class="line"><span class="cl">    <span class="s">Exam</span> <span class="o">=&gt;</span> <span class="o">[</span> <span class="p">{</span><span class="s">total</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">}</span><span class="o">,</span> <span class="p">(</span><span class="mi">75</span><span class="o">,</span> <span class="mi">50</span><span class="p">)</span> <span class="o">],</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span></code></pre></div><p>这导致了下面的类:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Assignment</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># attributes with a read-only accessor</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="nv">$.type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="nv">$.number</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="nv">$.score</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="nv">%.config</span><span class="p">;</span>   <span class="c1"># given that a hash is used, the $ (scalar) is replaced</span>
</span></span><span class="line"><span class="cl">                    <span class="c1"># with a % (hash).</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># private attributes hence the ! twigil.</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="nv">$!raw</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="nv">$!contrib</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="nv">$!adjusted-score</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>为了创建 <code>Assignment</code> 类的实例并初始化它，我们将命名参数传递给 Raku 提供的默认的 <code>new</code> 构造函数方法，并由所有类继承:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="c1"># create a new instance object and initialize its attributes. </span>
</span></span><span class="line"><span class="cl"><span class="c1"># The new constructor is called on Assignment, the type object of </span>
</span></span><span class="line"><span class="cl"><span class="c1"># the class Assignment.</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$assign01</span> <span class="o">=</span> <span class="n">Assignment</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">type</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">Homework</span><span class="p">&#39;</span><span class="o">,</span> <span class="c1"># named argument </span>
</span></span><span class="line"><span class="cl">    <span class="p">:</span><span class="s">number</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">,</span>         <span class="c1"># Alternate colon-pair syntax for named arguments</span>
</span></span><span class="line"><span class="cl">    <span class="p">:</span><span class="s">score</span><span class="p">(</span><span class="mi">45</span><span class="p">)</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">:</span><span class="s">config</span><span class="p">(</span><span class="nv">%</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s">Homework</span> <span class="o">=&gt;</span> <span class="o">[</span> <span class="p">{</span><span class="s">total</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">}</span><span class="o">,</span> <span class="p">(</span><span class="mi">50</span><span class="o">,</span> <span class="mi">25</span><span class="p">)</span><span class="o">,</span> <span class="p">(</span><span class="mi">50</span><span class="o">,</span> <span class="mi">25</span><span class="p">)</span> <span class="o">],</span>
</span></span><span class="line"><span class="cl">        <span class="s">Exam</span> <span class="o">=&gt;</span> <span class="o">[</span> <span class="p">{</span><span class="s">total</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">}</span><span class="o">,</span> <span class="p">(</span><span class="mi">75</span><span class="o">,</span> <span class="mi">50</span><span class="p">)</span> <span class="o">]</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span><span class="o">,</span>
</span></span><span class="line"><span class="cl"> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># accessing the instance object&#39;s attributes </span>
</span></span><span class="line"><span class="cl"><span class="c1"># through their accessor method:</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nv">$assign01</span><span class="o">.</span><span class="nb">type</span><span class="p">();</span>     <span class="c1"># OUTPUT: &#39;Homework&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nv">$assign01</span><span class="o">.</span><span class="nf">number</span><span class="p">();</span>   <span class="c1"># OUTPUT: 2</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nv">$assign01</span><span class="o">.</span><span class="nf">score</span><span class="p">();</span>    <span class="c1"># OUTPUT: 45</span>
</span></span></code></pre></div><blockquote>
<p><strong>注意</strong>: 如果属性是用 <code>!</code> twigil 定义的，那么不能使用 <code>new</code> 构造函数方法来初始化它。正如前面提到的，这是由于属性是私有的，这意味着它不能从类外部访问，甚至不能通过<code>new</code> 构造函数访问。但是，这个默认行为可以用 <code>BUILD</code> 子方法重写。有关 <code>BUILD</code> 子方法的更多信息，请参阅<a href="https://docs.raku.org/language/objects#Object_Construction">文档</a>。</p>
</blockquote>
<p>我们已经知道赋值的类型总是字符串，数字总是整数，调整后的分数是 rational 等等，所以我们也可以相应地键入属性:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Assignment</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="kt">Str</span> <span class="nv">$.type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="kt">Int</span> <span class="nv">$.number</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="nv">$.score</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="nv">%.config</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="nv">$!raw</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="nv">$!contrib</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="kt">Rat</span> <span class="nv">$!adjusted-score</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>有关类型的更多信息，请参阅<a href="https://docs.raku.org/language/typesystem">文档</a>。
<code>Assignment</code> 类的行为在很大程度上取决于每个学生的数据，但我们对 <code>Student</code> 类的结构还一无所知。出于这个原因，我们将继续学习 <code>Student</code> 类，稍后再回到这个话题。</p>
<h1 id="student-类">Student 类</h1>
<p>与 <code>Assignment</code> 类类似，让我们从详细描述 <code>Assignment</code> 类将具有的属性开始:</p>
<ul>
<li><code>name</code>——表示学生名字的字符串。</li>
<li><code>assign-num</code>——作业的数量(一个整数)。</li>
<li><code>assignments</code>——我们希望将作业分成不同的类型(作业或考试)，所以我们将使用哈希。每个键将指向它们各自的赋值对象的数组。</li>
<li><code>config</code>——在 <code>Assignment</code> 类中描述的课程的配置文件。</li>
</ul>
<p>这导致了下面的类:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Student</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="kt">Str</span> <span class="nv">$.name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="kt">Int</span> <span class="nv">$!assign-num</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="nv">%!assignments</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="nv">%.config</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>我们应该能够将作业附加到 <code>Student</code> 类的一个实例中，并从中获得作业、考试等等。这些行为表示类的行为，并通过使用方法来实现。</p>
<h2 id="公共和私有方法">公共和私有方法&nbsp;<a class="headline-hash no-text-decoration" href="#公共和私有方法">#</a> </h2>
<p>正如在 <a href="https://rakuintro.com/#_methods">Raku 介绍</a>中所述，“方法是对象的子例程，就像子例程一样，它们是打包一组功能的方法，它们接受参数，具有签名，可以定义为 <code>multi</code>。”</p>
<p>Raku 方法是使用 <code>method</code> 关键字定义的，它是在 invocant 上使用点(<code>.</code>)调用的。默认情况下，所有方法都是公共的。但是，方法可以通过在名称前面加上感叹号(<code>!</code>)来定义为私有的。在这种情况下，使用感叹号而不是点来调用它们。</p>
<p>有了这些知识，我们现在将向 <code>Student</code> 类添加一个 <code>add-assignment</code> 方法。这个方法需要作业的编号(1、2、3等，或者E1、E2等)和收到的分数。不会提供作业的类别，但我们可以使用编号来确定:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Student</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># same attributes as before.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">add-assignment</span><span class="p">(</span> <span class="nv">$number</span> <span class="k">is</span> <span class="nb">copy</span><span class="o">,</span> <span class="nv">$score</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">my</span> <span class="nv">$type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">       
</span></span><span class="line"><span class="cl">        <span class="c1"># determine the assignment type.</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nv">$number</span> <span class="o">~~</span> <span class="k">s</span><span class="p">/</span><span class="ni">^</span><span class="sr">E</span><span class="p">//</span> <span class="p">{</span>   <span class="c1"># do replacement in place</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$type</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">Exam</span><span class="p">&#39;;</span>      <span class="c1"># to obtain the exam&#39;s number.</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$type</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">Homework</span><span class="p">&#39;;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">        <span class="c1"># coerce assignment number to an integer.</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$number</span> <span class="o">.=</span> <span class="kt">Int</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># create an Assignment object from available information.</span>
</span></span><span class="line"><span class="cl">        <span class="k">my</span> <span class="nv">$assign-obj</span> <span class="o">=</span> <span class="n">Assignment</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="s">type</span>   <span class="o">=&gt;</span> <span class="nv">$type</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">            <span class="s">number</span> <span class="o">=&gt;</span> <span class="nv">$number</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">            <span class="s">score</span>  <span class="o">=&gt;</span> <span class="nv">$score</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">            <span class="s">config</span> <span class="o">=&gt;</span> <span class="nv">%!config</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">        <span class="c1"># add assignment into its type indexed by its number.</span>
</span></span><span class="line"><span class="cl">        <span class="nv">%!assignments</span><span class="p">{</span><span class="nv">$type</span><span class="p">}</span><span class="o">[</span><span class="nv">$number</span><span class="o">]</span> <span class="o">=</span> <span class="nv">$assign-obj</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">        <span class="c1"># increment number of assignments by 1.</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$!assign-num</span><span class="o">++</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>为了展示私有方法的创建，我们将在 <code>add-assignment</code> 方法中把创建 <code>Assignment</code> 对象外包给一个名为 <code>create-assignment</code> 的私有方法，该方法返回一个 <code>Assignment</code> 对象:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Student</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># same as before</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># notice the ! twigil before the method&#39;s name.</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">!create-assignment</span><span class="p">(</span> <span class="kt">Str</span> <span class="nv">$type</span><span class="o">,</span> <span class="kt">Int</span> <span class="nv">$number</span><span class="o">,</span> <span class="nv">$score</span> <span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Assignment</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="s">type</span>   <span class="o">=&gt;</span> <span class="nv">$type</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">            <span class="s">number</span> <span class="o">=&gt;</span> <span class="nv">$number</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">            <span class="s">score</span>  <span class="o">=&gt;</span> <span class="nv">$score</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">            <span class="s">config</span> <span class="o">=&gt;</span> <span class="nv">%!config</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">add-assignment</span><span class="p">(</span> <span class="nv">$number</span> <span class="k">is</span> <span class="nb">copy</span><span class="o">,</span> <span class="nv">$score</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># same code as before.</span>
</span></span><span class="line"><span class="cl">  		        
</span></span><span class="line"><span class="cl">        <span class="c1"># create an Assignment object with this information.</span>
</span></span><span class="line"><span class="cl">        <span class="k">my</span> <span class="nv">$assign-obj</span> <span class="o">=</span> <span class="nb">self</span><span class="o">!</span><span class="nf">create-assignment</span><span class="p">(</span><span class="nv">$type</span><span class="o">,</span> <span class="nv">$number</span><span class="o">,</span> <span class="nv">$score</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># same code as before.</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">       
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span></code></pre></div><p>正如您可能已经注意到的，<code>self</code> 关键字用于调用 <code>add-assignment</code> 方法中的 <code>create-assignment</code> 方法。<code>self</code> 是绑定到 invocant 的特殊变量，在方法内部可用。此变量可用于调用程序上的进一步方法。其内部方法调用如下:</p>
<ul>
<li>
<p><code>self!method($arg)</code> 用于私有方法。</p>
</li>
<li>
<p><code>self.method($arg)</code> 用于公共方法。 <code>$.method($arg)</code> 是它的快捷形式。注意，方法参数(位置和命名)的冒号语法只支持在使用 <code>self</code> 时调用方法，而不支持快捷形式。所以:</p>
</li>
<li>
<p>self.method: arg1, arg2&hellip; is supported.</p>
</li>
<li>
<p>$.method: arg1, arg2&hellip; is not supported.</p>
</li>
</ul>
<p>方法的签名总是传递 <code>self</code> 作为它的第一个参数。但是，我们可以通过提供第一个参数和一个冒号来为方法指定一个显式调用者。此参数将充当方法的调用方，并允许方法引用显式调用的对象。
例如:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Person</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="nv">$.name</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">John</span><span class="p">&#39;;</span>    <span class="c1"># attributes can be set to default values.</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># here self refers to the object, albeit implicitly.</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">introduce</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hi, my name&#39;s </span><span class="p">&#34;</span><span class="o">,</span> <span class="nb">self</span><span class="o">.</span><span class="nb">name</span><span class="p">()</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">!</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#                     ^^^^^^^^^^^ calling method on self</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># here $person explicitly refers to the object.</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">alt-introduce</span><span class="p">(</span> <span class="nv">$person:</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Hi, my name&#39;s </span><span class="p">&#34;</span><span class="o">,</span> <span class="nv">$person</span><span class="o">.</span><span class="nb">name</span><span class="p">()</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">!</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#                     ^^^^^^^^^^^^^^ calling method on $person</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Person</span><span class="o">.</span><span class="nb">new</span><span class="o">.</span><span class="nf">introduce</span><span class="p">();</span>      <span class="c1"># OUTPUT: Hi, my name&#39;s John!</span>
</span></span><span class="line"><span class="cl"><span class="n">Person</span><span class="o">.</span><span class="nb">new</span><span class="o">.</span><span class="nf">alt-introduce</span><span class="p">();</span>  <span class="c1"># OUTPUT: Hi, my name&#39;s John!</span>
</span></span></code></pre></div><h2 id="tweak-子方法">TWEAK 子方法&nbsp;<a class="headline-hash no-text-decoration" href="#tweak-子方法">#</a> </h2>
<p>我们回到 <code>Assignment</code> 类。目前，类的使用者可以在创建 <code>Assignment</code> 对象时传递他们想要的任何东西。出于这个原因，我们可能想检查作业类型和作业编号是否已知。我们可能要做的另一件事是修改 <code>raw</code> 属性和 <code>contrib</code> 属性，它们的值依赖于来自配置文件的数据。同样的情况也适用于 <code> adjusted-score</code> 属性，其值取决于 <code>raw</code> 属性、<code>contrib</code> 属性和 <code>score</code> 属性。</p>
<p>Raku 提供了一种通过 <code>TWEAK</code> 子方法检查对象构造后的内容或修改属性的简单方法。简单地说，子方法是不被子类继承的方法。查看<a href="https://docs.raku.org/language/objects#Object_construction">文档</a>以获得关于 <code>TWEAK</code> 子方法的更多信息。
让我们在 <code>Assignment</code> 类中添加 <code>TWEAK</code> 子方法:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Assignment</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># same attributes as before.</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1"># use submethod keyword, instead of method.</span>
</span></span><span class="line"><span class="cl">    <span class="k">submethod</span> <span class="nb">TWEAK</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># assignment type is either &#39;Homework&#39; or &#39;Exam&#39;.</span>
</span></span><span class="line"><span class="cl">        <span class="k">unless</span> <span class="nv">$!type</span> <span class="ow">eq</span> <span class="p">&#39;</span><span class="s1">Homework</span><span class="p">&#39;</span> <span class="o">|</span> <span class="p">&#39;</span><span class="s1">Exam</span><span class="p">&#39;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nb">die</span> <span class="p">&#34;</span><span class="s2">unknown assignment type: </span><span class="nv">$!type</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># check if provided assignment type is known.</span>
</span></span><span class="line"><span class="cl">        <span class="k">unless</span> <span class="nv">%!config</span><span class="p">{</span><span class="nv">$!type</span><span class="p">}</span><span class="o">[</span><span class="nv">$!number</span><span class="o">]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nb">die</span> <span class="p">&#34;</span><span class="s2">unrecognized </span><span class="nv">$!type</span><span class="s2"> number: </span><span class="nv">$!number</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># update raw and contrib value from configuration data.</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nv">$!raw</span><span class="o">,</span> <span class="nv">$!contrib</span><span class="p">)</span> <span class="o">=</span> <span class="nv">%!config</span><span class="p">{</span><span class="nv">$!type</span><span class="p">}</span><span class="o">[</span><span class="nv">$!number</span><span class="o">]</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># calculate the value of the adjusted score (rounded to two </span>
</span></span><span class="line"><span class="cl">        <span class="c1"># decimal places).</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$!adjusted-score</span> <span class="o">=</span> <span class="nb">sprintf</span> <span class="p">&#34;</span><span class="nv">%.2f</span><span class="p">&#34;</span><span class="o">,</span> <span class="nv">$!score</span> <span class="o">/</span> <span class="p">(</span><span class="nv">$!raw</span><span class="o">/</span><span class="nv">$!contrib</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># update type with assignment number. This will be useful </span>
</span></span><span class="line"><span class="cl">        <span class="c1"># when printing the report for a specific assignment.</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$!type</span> <span class="o">=</span> <span class="nv">$!type</span> <span class="ow">eq</span> <span class="p">&#39;</span><span class="s1">Homework</span><span class="p">&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="o">??</span> <span class="p">&#34;</span><span class="s2">Homework </span><span class="nv">$!number</span><span class="p">&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="o">!!</span> <span class="p">&#34;</span><span class="s2">Exam </span><span class="nv">$!number</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="完成-assignment-和-student-类">完成 ASSIGNMENT 和 STUDENT 类&nbsp;<a class="headline-hash no-text-decoration" href="#完成-assignment-和-student-类">#</a> </h2>
<h2 id="assignment-类">ASSIGNMENT 类&nbsp;<a class="headline-hash no-text-decoration" href="#assignment-类">#</a> </h2>
<p>我们想为特定的作业打印一个报告，因此我们将添加一个 <code>formatted-score</code> 方法，它将返回调整后的分数，并将一个 <code>print-report</code> 方法返回给 <code>Assignment</code> 类。<code>print-report</code> 方法应打印以下格式的作业报告:</p>
<pre tabindex="0"><code>type number: Raw = score/raw : Adjusted = adjusted-score/contrib-final
</code></pre><p>例子:</p>
<pre tabindex="0"><code>Homework 1: Raw = 42/50 : Adjusted = 8.40/10
Exam 1: Raw = 70/75 : Adjusted = 8.40/10
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Assignment</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># same code as before</span>
</span></span><span class="line"><span class="cl">   
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">formatted-score</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">$!adjusted-score</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">print-report</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span> <span class="p">&#34;</span><span class="nv">$!type:</span><span class="s2"> raw = </span><span class="nv">$!score</span><span class="s2">/</span><span class="nv">$!raw</span><span class="s2"> : </span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Adjusted = </span><span class="nv">$!adjusted-score</span><span class="s2">/contrib</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="student-类-1">STUDENT 类&nbsp;<a class="headline-hash no-text-decoration" href="#student-类-1">#</a> </h2>
<p>现在，我们将添加 <code>get-home-works</code> 和 <code>get-exams</code> 方法，这些方法将返回 <code>Assignment</code> 对象列表。我们还将为打印学生报告添加 <code>print-report</code> 方法。此方法应以下列格式打印学生报告:</p>
<pre tabindex="0"><code>student:
    type number: Raw = score/raw : Adjusted = adjusted-score/100 
    ...
    Final Course Grade: final-total/100
</code></pre><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Student</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># same code as before</span>
</span></span><span class="line"><span class="cl">   
</span></span><span class="line"><span class="cl">    <span class="c1"># we use the grep() function to discard possibly empty </span>
</span></span><span class="line"><span class="cl">    <span class="c1"># elements in either array.</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">get-homeworks</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">%!assignments</span><span class="p">&lt;</span><span class="s">Homework</span><span class="p">&gt;</span><span class="o">[</span><span class="mi">1</span><span class="o">..*].</span><span class="nb">grep</span><span class="o">:</span> <span class="p">{</span> <span class="nv">$_</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">get-exams</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">%!assignments</span><span class="p">&lt;</span><span class="s">Exam</span><span class="p">&gt;</span><span class="o">[</span><span class="mi">1</span><span class="o">..*].</span><span class="nb">grep</span><span class="o">:</span> <span class="p">{</span> <span class="nv">$_</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">print-report</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">say</span> <span class="nv">$!name</span><span class="o">,</span> <span class="p">&#34;</span><span class="s2">: </span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># print message and return if student&#39;s doesn&#39;t have</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># neither assignment type</span>
</span></span><span class="line"><span class="cl">        <span class="k">unless</span> <span class="nb">self</span><span class="o">.</span><span class="nf">get-homeworks</span><span class="p">()</span> <span class="o">||</span> <span class="nb">self</span><span class="o">.</span><span class="nf">get-exams</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nb">say</span> <span class="p">&#34;</span><span class="se">\t</span><span class="s2">No records for this student.</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">my</span> <span class="p">(</span><span class="nv">$final-total</span><span class="o">,</span> <span class="nv">$a_count</span><span class="o">,</span> <span class="nv">$e_count</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Loop over student&#39;s assignments (either Homework or Exam),</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># print assignment&#39;s report and update final total.</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="nb">self</span><span class="o">.</span><span class="nf">get-homeworks</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="nv">$homework</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span> <span class="p">&#34;</span><span class="se">\t</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$homework</span><span class="o">.</span><span class="nf">print-report</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$final-total</span> <span class="o">+=</span> <span class="nv">$homework</span><span class="o">.</span><span class="nf">formatted-score</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$a_count</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="nb">self</span><span class="o">.</span><span class="nf">get-exams</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="nv">$exam</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span> <span class="p">&#34;</span><span class="se">\t</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$exam</span><span class="o">.</span><span class="nf">print-report</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$final-total</span> <span class="o">+=</span> <span class="nv">$exam</span><span class="o">.</span><span class="nf">formatted-score</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$e_count</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># check if number of homeworks and exams in config file</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># matches student&#39;s record of returned homeworks and taken exams.</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">%!config</span><span class="p">&lt;</span><span class="s">Homework</span><span class="p">&gt;</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">&lt;</span><span class="s">total</span><span class="p">&gt;</span> <span class="o">==</span> <span class="nv">$a_count</span> <span class="ow">and</span>
</span></span><span class="line"><span class="cl">            <span class="nv">%!config</span><span class="p">&lt;</span><span class="s">Exam</span><span class="p">&gt;</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">&lt;</span><span class="s">total</span><span class="p">&gt;</span>   <span class="o">==</span> <span class="nv">$e_count</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nb">say</span> <span class="p">&#34;</span><span class="se">\t</span><span class="s2">Final Course Grade: </span><span class="nv">$final-total</span><span class="s2">/100</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nb">say</span> <span class="p">&#34;</span><span class="se">\t</span><span class="s2">* Incomplete Record *</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># print newline after student&#39;s report.</span>
</span></span><span class="line"><span class="cl">        <span class="p">&#34;&#34;</span><span class="o">.</span><span class="nb">say</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h1 id="course-类">Course 类</h1>
<p><code>Course</code> 类有以下属性:</p>
<p><code>course</code>——表示课程名称的字符串。
<code>students</code>——学生和 <code>Students</code> 对象的哈希。
<code>number</code>——这个课程的学生人数。</p>
<p>这是带有其属性的类:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Course</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="kt">Str</span> <span class="nv">$.course</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="kt">Int</span> <span class="nv">$.number</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="nv">%!students</span> <span class="k">of</span> <span class="nc">Student</span><span class="p">;</span> <span class="c1"># specifying the type of the hash&#39;s values.</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>关于方法，我们需要以下几点:</p>
<ul>
<li><code>configure-course</code>——使用当前目录中的 <code>.cfg</code>(配置)和 <code>.std</code> (学生列表)文件来配置课程。</li>
<li><code>student</code>——接受一个学生的名字，并返回一个 <code>Student</code> 对象，前提是它存在。在该类的内部使用所以定义为私有的。</li>
<li><code>get-roster</code>——返回学生名字的排序列表。</li>
<li><code>add-student-record</code>——接受一个学生记录(例如，<code>Bill Jones:1:45</code>)，为那个学生查找 <code>Student</code> 对象并添加一个作业。</li>
<li><code>print-report</code>——打印整个类的报告。</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Course</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># same code as before</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">configure-course</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># read content of configuration file. We are to assume that </span>
</span></span><span class="line"><span class="cl">        <span class="c1"># it has the same name as the course with &#39;.cfg&#39; extension.</span>
</span></span><span class="line"><span class="cl">        <span class="k">my</span> <span class="nv">$course_file</span> <span class="o">=</span> <span class="nv">$!course</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">.cfg</span><span class="p">&#39;;</span>
</span></span><span class="line"><span class="cl">        <span class="k">my</span> <span class="nv">$course_data</span> <span class="o">=</span> <span class="nv">$course_file</span><span class="o">.</span><span class="kt">IO</span><span class="o">.</span><span class="nb">slurp</span> <span class="o">||</span> 
</span></span><span class="line"><span class="cl">                          <span class="nb">die</span> <span class="p">&#34;</span><span class="s2">cannot open </span><span class="nv">$course_file</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># extract the data from file and store it into the </span>
</span></span><span class="line"><span class="cl">        <span class="c1"># configuration hash. The structure of the configuration</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># file was discussed in the &#39;The Assignment class&#39; section.</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">my</span> <span class="nv">%cfg</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="nv">$course_data</span><span class="o">.</span><span class="nb">lines</span> <span class="k">-&gt;</span> <span class="nv">$datum</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">my</span> <span class="p">(</span><span class="nv">$type</span><span class="o">,</span> <span class="nv">@data</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$datum</span><span class="o">.</span><span class="nb">split</span><span class="p">(&#39;</span><span class="s1">:</span><span class="p">&#39;);</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Example: type = &#39;Homework&#39;, data = (1, 50, 25)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="nv">%cfg</span><span class="p">{</span><span class="nv">$type</span><span class="p">}</span><span class="o">[</span> <span class="nv">@data</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">]</span> <span class="o">=</span> <span class="nv">@data</span><span class="o">[</span><span class="mi">1</span><span class="o">..*]</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nv">%cfg</span><span class="p">{</span><span class="nv">$type</span><span class="p">}</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">&lt;</span><span class="s">total</span><span class="p">&gt;</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># read student list file which has the same name as the course.</span>
</span></span><span class="line"><span class="cl">        <span class="k">my</span> <span class="nv">$stud_file</span> <span class="o">=</span> <span class="nv">$!course</span> <span class="o">~</span> <span class="p">&#39;</span><span class="s1">.std</span><span class="p">&#39;;</span>
</span></span><span class="line"><span class="cl">        <span class="k">my</span> <span class="nv">$stud_data</span> <span class="o">=</span> <span class="nv">$stud_file</span><span class="o">.</span><span class="kt">IO</span><span class="o">.</span><span class="nb">slurp</span> <span class="o">||</span> <span class="nb">die</span> <span class="p">&#34;</span><span class="s2">cannot open </span><span class="nv">$stud_file</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">       
</span></span><span class="line"><span class="cl">        <span class="c1"># Loop over the student list and create a Student object for </span>
</span></span><span class="line"><span class="cl">        <span class="c1"># each student and populate the hash of students and Student objects.</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="nv">$stud_data</span><span class="o">.</span><span class="nb">lines</span> <span class="k">-&gt;</span> <span class="nv">$student</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">%!students</span><span class="p">{</span> <span class="nv">$student</span><span class="o">.</span><span class="nb">trim</span> <span class="p">}</span> <span class="o">=</span> <span class="n">Student</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span> 
</span></span><span class="line"><span class="cl">                <span class="s">name</span>   <span class="o">=&gt;</span> <span class="nv">$student</span><span class="o">.</span><span class="nb">trim</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">                <span class="s">config</span> <span class="o">=&gt;</span> <span class="nv">%cfg</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$!number</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># return Student object if it exists.</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">!student</span><span class="p">(</span> <span class="kt">Str</span> <span class="nv">$stud-name</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">%!students</span><span class="p">{</span><span class="nv">$stud-name</span><span class="p">}</span> <span class="o">||</span> <span class="kt">Nil</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># order student names by last name and return list.</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">get-roster</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">%!students</span><span class="o">.</span><span class="nb">keys</span>                         <span class="c1"># student names list</span>
</span></span><span class="line"><span class="cl">            <span class="o">==&gt;</span> <span class="nb">map</span> <span class="p">({</span> <span class="p">(</span> <span class="nv">$_</span><span class="o">,</span> <span class="nv">$_</span><span class="o">.</span><span class="nb">words</span> <span class="p">)</span><span class="o">.</span><span class="nb">flat</span> <span class="p">})</span> <span class="c1"># (full name, first, last)</span>
</span></span><span class="line"><span class="cl">            <span class="o">==&gt;</span> <span class="nb">sort</span> <span class="p">({</span> <span class="nv">$^a</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="ow">cmp</span> <span class="nv">$^b</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span> <span class="p">})</span>    <span class="c1"># sort list by last names</span>
</span></span><span class="line"><span class="cl">            <span class="o">==&gt;</span> <span class="nb">map</span> <span class="p">({</span> <span class="nv">$_</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="p">})</span>                 <span class="c1"># get name from sorted list</span>
</span></span><span class="line"><span class="cl">            <span class="o">==&gt;</span> <span class="k">my</span> <span class="nv">@list</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nv">@list</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># add record to Student object.</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">add-student-record</span><span class="p">(</span> <span class="nv">@record</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">my</span> <span class="p">(</span><span class="nv">$name</span><span class="o">,</span> <span class="nv">@remaining</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@record</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">        <span class="c1"># get Student object and add assignment to it.</span>
</span></span><span class="line"><span class="cl">        <span class="k">my</span> <span class="nv">$student</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="nf">student</span><span class="p">(</span><span class="nv">$name</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">my</span> <span class="p">(</span><span class="nv">$num</span><span class="o">,</span> <span class="nv">$score</span><span class="p">)</span> <span class="o">=</span> <span class="nv">@remaining</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$student</span><span class="o">.</span><span class="nf">add-assignment</span><span class="p">(</span><span class="nv">$num</span><span class="o">,</span> <span class="nv">$score</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># print report for all students in the course.</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">print-report</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">say</span> <span class="p">&#34;</span><span class="s2">Class report: course = </span><span class="nv">$!course</span><span class="s2">, students = </span><span class="nv">$!number</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># loop over sorted students list and print each student&#39;s report.</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="nb">self</span><span class="o">.</span><span class="nf">get-roster</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="nv">$name</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nb">self</span><span class="o">!</span><span class="nf">student</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span><span class="o">.</span><span class="nf">print-report</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h2 id="自定义构造函数">自定义构造函数&nbsp;<a class="headline-hash no-text-decoration" href="#自定义构造函数">#</a> </h2>
<p>我们希望使用反映所创建内容的构造函数方法，而不是使用 <code>new</code> 构造函数从特定的类创建对象。例如，<code>Course</code> 类的 <code>create-course</code> 构造函数。我们还希望使用位置参数，而不是在 <code>new</code> 构造函数中使用命名参数。在 Raku 中创建构造函数相当容易;只需要创建一个方法并返回 <em>blessed</em> 后的参数:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Course</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># same code as before</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">create-course</span><span class="p">(</span> <span class="nv">$course</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">self</span><span class="o">.</span><span class="nb">bless</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="s">course</span> <span class="o">=&gt;</span> <span class="nv">$course</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># same code as before</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># In addition to:</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$class01</span> <span class="o">=</span> <span class="n">Course</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span> <span class="s">course</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">GEO-102</span><span class="p">&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># We can also create a Course instance like this now:</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$class02</span> <span class="o">=</span> <span class="n">Course</span><span class="o">.</span><span class="nf">create-course</span><span class="p">(</span> <span class="p">&#39;</span><span class="s1">Math-101</span><span class="p">&#39;</span> <span class="p">);</span>
</span></span></code></pre></div><p>我们不只是写 <code>return self.bless($course)</code>，因为 <code>bless</code> 方法需要一组命名参数来为每个属性提供初始值。正如前面提到的，私有属性实际上是私有的，因此对于用<code>!</code> twigil 定义的属性这还不够。为此，必须使用 <code>BUILD</code> 子方法，<code>bless</code> 方法调用这个全新的对象。有关 <code>BUILD</code> 子方法的更多信息，请参阅<a href="https://docs.raku.org/language/objects#Submethods">子方法</a>和<a href="https://docs.raku.org/language/classtut#Constructors">构造函数</a>。</p>
<h2 id="实例和类属性">实例和类属性&nbsp;<a class="headline-hash no-text-decoration" href="#实例和类属性">#</a> </h2>
<p>我们已经讨论了实例属性，只是没有将它们标识为实例属性。<strong>实例属性</strong>是一个类的特定实例所拥有的属性，这意味着同一个类的两个不同的对象实例是不同的。例如，前几节中的实例 <code>$class01</code> 和 <code>$class02</code> 都具有相同的实例属性(<code>course</code>、<code>number</code> 等)，但是值不同。在 Raku 中，任何用关键字 <code>has</code> 声明的属性都是一个实例属性。</p>
<p>另一方面，<strong>类属性</strong>是属于类本身而不是它的对象的属性。与实例属性不同，类属性由类的所有实例共享。</p>
<p>在 Raku 中，类属性是使用关键字 <code>my</code> 或 <code>our</code>(而不是 <code>has</code>)来声明的，这取决于作用域(例如，<code>my $class-var;</code>)。与实例属性类似，用 <code>.</code> twigil 生成一个访问器方法(例如，<code>my $.class-var;</code>)的类属性。有关类属性的更多信息，请参阅<a href="https://docs.raku.org/language/classtut#Static_fields?">文档</a>。</p>
<p>我们还没有看到类属性，但是我们现在要创建一个。例如，我们想知道我们实例化的课程的数量。为此，我们可以在 <code>Course</code> 类中创建一个类属性，它跟踪实例化的 <code>Course</code> 对象的数量。</p>
<p>每当创建新对象时这个类属性必须更新，因此我们必须修改默认的 <code>new</code> 和 <code>create-course</code> 构造函数:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Course</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">    <span class="c1"># other attributes.</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="kt">Int</span> <span class="nv">$.course-count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1"># class attribute with read-only accessor</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">create-course</span><span class="p">(</span> <span class="nv">$course</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$.course-count</span><span class="o">++</span><span class="p">;</span>      <span class="c1"># updating the class attribute.</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">self</span><span class="o">.</span><span class="nb">bless</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="s">course</span> <span class="o">=&gt;</span> <span class="nv">$course</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># we still want to pass named parameters to the new </span>
</span></span><span class="line"><span class="cl">    <span class="c1"># hence the &#39;:&#39; before the parameter.</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nb">new</span><span class="p">(</span> <span class="o">:</span><span class="nv">$course</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$.course-count</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">self</span><span class="o">.</span><span class="nb">bless</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="s">course</span> <span class="o">=&gt;</span> <span class="nv">$course</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># same code as before</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="mi">1</span><span class="o">..</span><span class="mi">5</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Course</span><span class="o">.</span><span class="nf">create-course</span><span class="p">(&#39;</span><span class="s1">PHYS-110</span><span class="p">&#39;);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Course</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">course</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">BIO-112</span><span class="p">&#39;);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># accessing the class attribute&#39;s value by calling </span>
</span></span><span class="line"><span class="cl"><span class="c1"># its accessor method on the class itself.</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="n">Course</span><span class="o">.</span><span class="nf">course-count</span><span class="p">();</span>  <span class="c1"># OUTPUT: 10</span>
</span></span></code></pre></div><h2 id="实例方法和类方法">实例方法和类方法&nbsp;<a class="headline-hash no-text-decoration" href="#实例方法和类方法">#</a> </h2>
<p><strong>实例方法</strong>需要在其上调用对象实例。它通常以 <code>$object.instance-method()</code> 的形式表示。例如，<code>print-report()</code> 是 <code>Course</code> 类的一个实例方法，需要调用该类的一个实例(例如，<code>$class.print-report()</code>)。</p>
<p>另一方面，<strong>类方法</strong>作为一个整体属于类，因此它不需要类的实例。它通常用 <code>class.class-method()</code> 表示。例如，<code>new</code> 构造函数是直接在类上调用的类方法，而不是类的实例。</p>
<p>前面我们提到，显式调用者可以传递给方法。除了显式地引用对象外，方法签名中提供的调用者还允许通过使用类型约束将方法定义为实例方法或类方法。特殊变量 <code>::?CLASS</code> 可用于在编译时提供类名，并结合 <code>:U</code> (如 <code>::?CLASS:U</code>)用于类方法，或 <code>:D</code>(如 <code>::?CLASS:D</code>)用于实例方法。顺便说一下，在 Raku 行话中，<code>:U</code> 和 <code>:D</code> 被称为 <em>smileys</em>。</p>
<p><code>create-course</code> 方法打算仅作为类方法使用，但是，到目前为止，没有任何东西阻止它在实例中使用。为了避免这种情况，我们可以在 invocant 上使用带有 <code>:U</code> 类型修饰符的特殊变量 <code>?::CLASS</code>，这会导致方法主动拒绝对实例的调用，并且只允许通过type 对象进行调用。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Course</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># other attributes </span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">create-course</span><span class="p">(</span> <span class="vg">::?CLASS:U</span><span class="o">:</span> <span class="nv">$course</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$.course-count</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">self</span><span class="o">.</span><span class="nb">bless</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="s">course</span> <span class="o">=&gt;</span> <span class="nv">$course</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nb">new</span><span class="p">(</span> <span class="vg">::?CLASS:U</span><span class="o">:</span> <span class="o">:</span><span class="nv">$course</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$.course-count</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">self</span><span class="o">.</span><span class="nb">bless</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="s">course</span> <span class="o">=&gt;</span> <span class="nv">$course</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># same code as before</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Invocations on the Course class works as expected.</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$math</span> <span class="o">=</span> <span class="n">Course</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">name</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">MATH-302</span><span class="p">&#39;);</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$phys</span> <span class="o">=</span> <span class="n">Course</span><span class="o">.</span><span class="nf">create-course</span><span class="p">(&#39;</span><span class="s1">LING-202</span><span class="p">&#39;);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Invocations on Course instances fail.</span>
</span></span><span class="line"><span class="cl"><span class="nv">$math</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span><span class="s">name</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">MATH-302</span><span class="p">&#39;);</span>   <span class="c1"># OUTPUT: Invocant of method &#39;new&#39; must be </span>
</span></span><span class="line"><span class="cl">                                 <span class="c1"># a type object of type &#39;Course&#39;, not an </span>
</span></span><span class="line"><span class="cl">                                 <span class="c1"># object instance of type &#39;Course&#39;.  Did you</span>
</span></span><span class="line"><span class="cl">                                 <span class="c1"># forget a &#39;multi&#39;?</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$phys</span><span class="o">.</span><span class="nf">create-course</span><span class="p">(&#39;</span><span class="s1">LING-202</span><span class="p">&#39;);</span> <span class="c1"># OUTPUT: Type check failed in binding to </span>
</span></span><span class="line"><span class="cl">                                 <span class="c1"># parameter &#39;$course&#39;; expected Course but </span>
</span></span><span class="line"><span class="cl">                                 <span class="c1"># got Str (&#34;Phys-302&#34;)</span>
</span></span></code></pre></div><h2 id="使用-course-类">使用 COURSE 类&nbsp;<a class="headline-hash no-text-decoration" href="#使用-course-类">#</a> </h2>
<p>假设我们有 <code>MATH-101.cfg</code>(课程设置)，<code>MATH-101.std</code>(学生名单)和 <code>MATH-101</code>(学生记录)有了问题陈述中提供的信息，我们可以使用 <code>Course</code> 类(与 <code>Student</code> 和 <code>Assignment</code> 在同一个文件中)，如下:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="c1"># For now, we&#39;ll specify the course name manually.</span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$class</span> <span class="o">=</span> <span class="n">Course</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span> <span class="s">course</span> <span class="o">=&gt;</span> <span class="p">&#39;</span><span class="s1">MATH-101</span><span class="p">&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl"><span class="c1"># set up the course. Remember that the script assumes </span>
</span></span><span class="line"><span class="cl"><span class="c1"># &#39;MATH-101.cfg&#39; and &#39;MATH-101.std&#39; are in the current directory.</span>
</span></span><span class="line"><span class="cl"><span class="nv">$class</span><span class="o">.</span><span class="nf">configure-course</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># filename of student record. </span>
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$data</span> <span class="o">=</span> <span class="p">&#39;</span><span class="s1">MATH-101</span><span class="p">&#39;;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># loop over each line of student record and feed it to</span>
</span></span><span class="line"><span class="cl"><span class="c1"># the corresponding student.</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="nv">$data</span><span class="o">.</span><span class="kt">IO</span><span class="o">.</span><span class="nb">lines</span> <span class="k">-&gt;</span> <span class="nv">$line</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$class</span><span class="o">.</span><span class="nf">add-student-record</span><span class="p">(</span> <span class="nv">$line</span><span class="o">.</span><span class="nb">split</span><span class="p">(&#39;</span><span class="s1">:</span><span class="p">&#39;)</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># print course report.</span>
</span></span><span class="line"><span class="cl"><span class="nv">$class</span><span class="o">.</span><span class="nf">print-report</span><span class="p">();</span>
</span></span></code></pre></div><p>运行该程序之后，它打印出：</p>
<pre tabindex="0"><code>Class report: course = MATH-101, students = 4
Frank Horza: 
	No records for this student.
Bill Jones: 
	Homework 1: Raw = 35/50 : Adjusted = 17.50/25
	Homework 2: Raw = 42/50 : Adjusted = 21.00/25
	Exam 1: Raw = 72/75 : Adjusted = 48.00/50
	Final Course Grade: 86.5/100

Anne Smith: 
	No records for this student.
Sara Tims: 
	Homework 1: Raw = 39/50 : Adjusted = 19.50/25
	Homework 2: Raw = 45/50 : Adjusted = 22.50/25
	* Incomplete Record *
</code></pre><h2 id="完成程序">完成程序&nbsp;<a class="headline-hash no-text-decoration" href="#完成程序">#</a> </h2>
<p>您可能注意到，在创建 <code>Course</code> 实例之后，我们必须调用 <code>configure-course</code>。每次创建一个 <code>Course</code> 实例后都要这样做，这样我们就可以添加一个 <code>TWEAK</code> 方法来执行这个任务:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Course</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># same code as before</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">submethod</span> <span class="nb">TWEAK</span><span class="p">(</span><span class="nv">$course:</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    	<span class="c1"># set up course after object creation</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$course</span><span class="o">.</span><span class="nf">configure-course</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># same code as before</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>问题陈述说明程序应该通过命令行接收学生的成绩。Raku 使命令行参数解析非常容易，我们只需要定义一个 <code>MAIN</code> 子例程来获取一个位置参数，即以包含学生成绩的课程命名的文件。要了解关于 <code>MAIN</code> 子例程的更多信息，请阅读<a href="https://uzluisf.gitlab.io/posts/command-line-raku/">本文</a>或<a href="https://docs.raku.org/language/functions#sub_MAIN">参考文档</a>。</p>
<p>让我们创建一个 <code>report.p6</code> 文件，其中也存储了 <code>Assignment</code>, <code>Student</code> 和 <code>Course</code> 类:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="k">use</span> <span class="k">v</span><span class="mi">6</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># assume the Assignment, Student, and Course class are here.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">sub</span> <span class="nb">MAIN</span><span class="p">(</span> <span class="nv">$course</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># CLI arguments are stored in @*ARGS. We take the first one. </span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$class</span> <span class="o">=</span> <span class="n">Course</span><span class="o">.</span><span class="nf">create-course</span><span class="p">(</span> <span class="vg">@*ARGS</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="nv">$course</span><span class="o">.</span><span class="kt">IO</span><span class="o">.</span><span class="nb">lines</span> <span class="k">-&gt;</span> <span class="nv">$line</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$class</span><span class="o">.</span><span class="nf">add-student-record</span><span class="p">(</span> <span class="nv">$line</span><span class="o">.</span><span class="nb">split</span><span class="p">(&#39;</span><span class="s1">:</span><span class="p">&#39;)</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">    <span class="c1"># printing the class report.</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$class</span><span class="o">.</span><span class="nf">print-report</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>假设这样:</p>
<pre tabindex="0"><code>$ ls
MATH-101  MATH-101.cfg  MATH-101.std  report.p6
</code></pre><p>然后:</p>
<pre tabindex="0"><code>$ raku report.p6 MATH-101
</code></pre><p>应该打印出报告。</p>
<h1 id="继承">继承</h1>
<p>我们已经完成了问题陈述所提出的任务，但是我们将在这里讨论的主题在OOP范例中非常重要。<code>Student</code> 类有一个属性，用于存储学生已经注册的课程。现在，让我们假设我们想为兼职学生创建一个 <code>PTStudent</code> 类，它限制了一个学生可以注册的课程数量。考虑到兼职学生肯定是学生，我们可能会被诱使将 <code>Student</code> 类中的代码复制到 <code>PTStudent</code> 中，然后添加必要的约束。虽然技术上很好，但是代码的重复被认为是次优的、容易出错的和概念上有缺陷的工作。相反，我们可以使用一种称为<strong>继承</strong>的机制。</p>
<p>简单地说，继承允许从现有类派生一个新类(带有修改)。这意味着您不必创建完整的新类来复制现有类的部分。在这个过程中，继承的类是<strong>父类</strong>的<strong>孩子</strong>(或子类)。</p>
<p>在 Raku 中，<code>is</code> 关键字定义了继承。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="c1"># Assume Student is defined here.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">PTStudent</span> <span class="k">is</span> <span class="nc">Student</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># new attributes particular to PTStudent.</span>
</span></span><span class="line"><span class="cl">    <span class="k">has</span> <span class="nv">@.courses</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="nv">$.course-limit</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># new method too.</span>
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">add-course</span><span class="p">(</span> <span class="nv">$course</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nv">@.courses</span> <span class="o">==</span> <span class="nv">$.course-limit</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nb">die</span> <span class="p">&#34;</span><span class="s2">Number of courses exceeds limit of </span><span class="nv">$.course-limit</span><span class="s2">.</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="nb">push</span> <span class="nv">@.courses</span><span class="o">,</span> <span class="nv">$course</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$student2</span> <span class="o">=</span> <span class="n">PTStudent</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">name</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">Tim Polaz</span><span class="p">&#34;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">config</span> <span class="o">=&gt;</span> <span class="nv">%</span><span class="p">()</span><span class="o">,</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$student2</span><span class="o">.</span><span class="nf">add-course</span><span class="p">(</span> <span class="p">&#39;</span><span class="s1">BIO-101</span><span class="p">&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$student2</span><span class="o">.</span><span class="nf">add-course</span><span class="p">(</span> <span class="p">&#39;</span><span class="s1">GEO-101</span><span class="p">&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$student2</span><span class="o">.</span><span class="nf">add-course</span><span class="p">(</span> <span class="p">&#39;</span><span class="s1">PHY-102</span><span class="p">&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$student2</span><span class="o">.</span><span class="nf">courses</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;</span><span class="s1"> </span><span class="p">&#39;);</span>       <span class="c1"># OUTPUT: &#39;BIO-101 GEO-101 PHY-102&#39;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"><span class="nv">$student2</span><span class="o">.</span><span class="nf">add-course</span><span class="p">(</span> <span class="p">&#39;</span><span class="s1">ENG-220</span><span class="p">&#39;</span> <span class="p">);</span> <span class="c1"># (error) OUTPUT: Number of courses exceeds </span>
</span></span><span class="line"><span class="cl">                                   <span class="c1"># limit of 3.</span>
</span></span></code></pre></div><p><code>PTStudent</code> 类继承了其父类 <code>Student</code> 的属性和方法。除此之外，我们还为它添加了两个新属性和一个新方法。</p>
<p>如果我们愿意，我们可以重新定义从 <code>Student</code> 类继承的方法。这个概念被称为<strong>覆盖</strong>，它允许为父类和子类提供每个类的通用方法实现。</p>
<p>除了单继承之外，Raku 中还可以有多重继承(一次从多个类继承)。查看<a href="https://docs.raku.org/language/classtut#Multiple_inheritance">文档</a>以获得关于它的更多信息。</p>
<h1 id="角色">角色</h1>
<p>与类类似，角色携带状态和行为。然而，与类不同，角色是用来描述对象行为的特定组件的。在 Raku 中，角色是用 <code>role</code> 关键字定义的，并使用 <code>does</code> 特质(与用于继承的 <code>is</code> 相反)应用于类或对象。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="c1"># Assume Student is defined here</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">role</span> <span class="nc">course-limitation</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">has</span> <span class="nv">@.courses</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">my</span> <span class="kt">Int</span> <span class="nv">$.course-limit</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   
</span></span><span class="line"><span class="cl">    <span class="k">method</span> <span class="nf">add-course</span><span class="p">(</span> <span class="nv">$course</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nv">@.courses</span> <span class="o">==</span> <span class="nv">$.course-limit</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nb">die</span> <span class="p">&#34;</span><span class="s2">Number of courses exceeds limit of </span><span class="nv">$.course-limit</span><span class="s2">.</span><span class="p">&#34;;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nv">@.courses</span><span class="o">.</span><span class="nb">push</span><span class="p">(</span><span class="nv">$course</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># inheriting from the Student class and applying role.</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">PTStudent</span> <span class="k">is</span> <span class="nc">Student</span> <span class="k">does</span> <span class="nc">course-limitation</span> <span class="p">{</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">my</span> <span class="nv">$student2</span> <span class="o">=</span> <span class="n">PTStudent</span><span class="o">.</span><span class="nb">new</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s">name</span> <span class="o">=&gt;</span> <span class="p">&#34;</span><span class="s2">Tim Polaz</span><span class="p">&#34;</span><span class="o">,</span>
</span></span><span class="line"><span class="cl">    <span class="s">config</span> <span class="o">=&gt;</span> <span class="nv">%</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">$student2</span><span class="o">.</span><span class="nf">add-course</span><span class="p">(</span> <span class="p">&#39;</span><span class="s1">MATH-101</span><span class="p">&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$student2</span><span class="o">.</span><span class="nf">add-course</span><span class="p">(</span> <span class="p">&#39;</span><span class="s1">GEO-101</span><span class="p">&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nv">$student2</span><span class="o">.</span><span class="nf">add-course</span><span class="p">(</span> <span class="p">&#39;</span><span class="s1">PHY-102</span><span class="p">&#39;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nv">$student2</span><span class="o">.</span><span class="nf">courses</span><span class="o">.</span><span class="nb">join</span><span class="p">(&#39;</span><span class="s1"> </span><span class="p">&#39;);</span>   <span class="c1"># OUTPUT: &#39;MATH-101 GEO-101 PHY-102&#39;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl"><span class="nv">$student2</span><span class="o">.</span><span class="nf">add-course</span><span class="p">(</span> <span class="p">&#39;</span><span class="s1">ENG-220</span><span class="p">&#39;</span> <span class="p">);</span> <span class="c1"># (error) OUTPUT: Number of courses exceeds </span>
</span></span><span class="line"><span class="cl">                                   <span class="c1"># limit of 3.</span>
</span></span></code></pre></div><p>我们已经演示了角色是如何工作的，但这并没有展示它们的完整画面。例如，就像多重继承一样，角色可以在一个类中多次实现(例如，<code>class Name does role1 does role2 does ...</code>)。但是，与多重继承不同的是，如果多个角色的应用程序出现冲突，则会抛出编译时错误。对于多重继承，冲突不会被认为是错误，而是会在运行时解决。</p>
<p>简而言之，角色可以被认为是继承的另一种选择; 程序员不是通过子类化来扩展类层次结构，而是使用为类的行为提供补充行为的角色来组成类。</p>
<h1 id="内省">内省</h1>
<p><strong>内省</strong> 是一个对象能够收集关于自身和其他对象的信息的过程，如类型、方法、属性等。</p>
<p>在 Raku 中，内省可以通过以下结构得到促进:</p>
<ul>
<li><code>.WHAT</code>——返回与对象关联的类型对象。</li>
<li><code>.perl</code>——返回一个字符串，该字符串可以作为 Raku 代码执行。</li>
<li><code>.^name</code>——返回类名。</li>
<li><code>^attributes</code>——返回对象的所有属性。</li>
<li><code>^methods</code>——返回可以在该对象上调用的所有方法。</li>
<li><code>^parents</code>——返回对象的父类。</li>
<li><code>~~</code> 是智能匹配操作符。如果对象是由正在进行比较的类或其任何它的继承类创建的，则计算为 <code>True</code>。</li>
</ul>
<p><code>.^</code> 语法是元方法调用。使用这种语法而不是单个点表示对其元类的方法调用，元类是管理所有类的属性的类。事实上, <code>obj.^meth</code> 相当于<code>obj.HOW.meth(obj)</code>, 其中 <code>meth</code> 是一个特定的方法。</p>
<p>使用上一节中的对象 <code>$student2</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-raku" data-lang="raku"><span class="line"><span class="cl"><span class="nb">say</span> <span class="nv">$student2</span><span class="o">.</span><span class="nb">WHAT</span><span class="p">;</span>         <span class="c1"># OUTPUT: (PTStudent)</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nv">$student2</span><span class="o">.</span><span class="nb">perl</span><span class="p">;</span>         <span class="c1"># OUTPUT: PTStudent.new(name =&gt; &#34;Tim Polaz&#34;, </span>
</span></span><span class="line"><span class="cl">                            <span class="c1">#         config =&gt; {}, courses =&gt; [])</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nv">$student2</span><span class="o">.^</span><span class="nb">name</span><span class="p">;</span>        <span class="c1"># OUTPUT: PTStudent</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nv">$student2</span><span class="o">.^</span><span class="nb">attributes</span><span class="p">;</span>  <span class="c1"># OUTPUT: (Str $!name Associative %!config Mu </span>
</span></span><span class="line"><span class="cl">                            <span class="c1">#          $!assig-num Associative %!assignments</span>
</span></span><span class="line"><span class="cl">                            <span class="c1">#          Positional @!courses)</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nv">$student2</span><span class="o">.^</span><span class="nb">methods</span><span class="p">;</span>     <span class="c1"># OUTPUT: (course-limit add-course name </span>
</span></span><span class="line"><span class="cl">                            <span class="c1">#          add-assignment courses config get-exams</span>
</span></span><span class="line"><span class="cl">                            <span class="c1">#          print-report get-homeworks BUILDALL)</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nv">$student2</span><span class="o">.^</span><span class="nb">parents</span><span class="p">;</span>     <span class="c1"># OUTPUT: ((Student))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nv">$student2</span> <span class="o">~~</span> <span class="n">PTStudent</span><span class="p">;</span> <span class="c1"># True</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nv">$student2</span> <span class="o">~~</span> <span class="n">Student</span><span class="p">;</span>   <span class="c1"># True</span>
</span></span><span class="line"><span class="cl"><span class="nb">say</span> <span class="nv">$student2</span> <span class="o">~~</span> <span class="kt">Str</span><span class="p">;</span>       <span class="c1"># False</span>
</span></span></code></pre></div><p>如您所见，通过内省，您可以从类的实例中学到很多东西。</p>
<p>内省并不仅限于程序员定义的类。内省是 Raku 的核心，它是一个非常有用的工具，可以帮助您了解内置类型，并从整体上了解该语言。</p>
<h1 id="结论">结论</h1>
<p>在这篇文章中，我们学习了如何定义类、私有和公共属性以及私有和公共方法。我们还学习了如何创建自定义构造函数，并将其调用限制在类或类的实例中。此外，我们还简要讨论了如何通过继承和 Raku 中的角色来促进代码重用。最后，我们讨论了内省的过程，以及如何以最简单的形式学习对象。</p>
<p>关于 <code>report.p6</code>，我们局限于问题陈述，但是程序的用户可以从额外的功能中获益。例如，可以修改程序，为单个学生提供交互式查询，以便学生从命令行查找。此外，该程序可以读取多个课程，然后查询它们，检索并打印一个特定学生的记录。</p>
<p>下面我链接了我们在这里创建的程序和实现前面提到的额外功能的程序。希望这整个教程是有益的和有用的。</p>
<p>链接:</p>
<ul>
<li>整个 report.p6</li>
<li><code>report.p6</code> 有额外的功能。我还添加了一个简单的函数来给课程名称上色，以便更好地将它们与其他文本区分开来。对于一些课程文件，输出结果如下:</li>
</ul>
<p><img src="https://i.imgur.com/3BVTxB0.jpg" alt="img"></p>
<h1 id="资源">资源</h1>
<ul>
<li>Raku Introduction</li>
<li>Raku Documentation
<ul>
<li>Classes and objects</li>
<li>Object orientation</li>
</ul>
</li>
<li>Raku Advent Calendar
<ul>
<li>The humble type object</li>
<li>Classes, attributes, methods and more</li>
<li>Introspection</li>
</ul>
</li>
<li>Basic OO in Raku (slides)</li>
<li>Let’s build an object</li>
<li>Think Raku</li>
<li>The problem statement was an adaptation from a section titled Grades: an object example in the book Elements of Programming with Perl by Andrew L. Johnson.</li>
</ul>


        </div>
    </div>
</article>



                <footer>
                    




<div class="no-text-decoration">
    <div class="jump top"><a href="#" title="Top of this page">⮉</a></div>
    <div class="jump bottom"><a href="#bottom" title="Bottom of this page">⮋</a></div>
</div>


 
    
        <div class="hugotoc no-text-decoration">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#介绍">介绍</a></li>
    <li><a href="#问题陈述">问题陈述</a></li>
    <li><a href="#分析">分析</a></li>
  </ul>

  <ul>
    <li><a href="#类定义">类定义</a></li>
    <li><a href="#属性定义">属性定义</a></li>
  </ul>

  <ul>
    <li><a href="#公共和私有方法">公共和私有方法</a></li>
    <li><a href="#tweak-子方法">TWEAK 子方法</a></li>
    <li><a href="#完成-assignment-和-student-类">完成 ASSIGNMENT 和 STUDENT 类</a></li>
    <li><a href="#assignment-类">ASSIGNMENT 类</a></li>
    <li><a href="#student-类-1">STUDENT 类</a></li>
  </ul>

  <ul>
    <li><a href="#自定义构造函数">自定义构造函数</a></li>
    <li><a href="#实例和类属性">实例和类属性</a></li>
    <li><a href="#实例方法和类方法">实例方法和类方法</a></li>
    <li><a href="#使用-course-类">使用 COURSE 类</a></li>
    <li><a href="#完成程序">完成程序</a></li>
  </ul>
</nav>
            <a href="#" class="back-to-top">Back to top</a>
        </div>
    
    
<script src="/js/libs/jquery/3.3.1/jquery.slim.min.min.22ee3db0c0e99fd0fbce3aee19672bd53d25469daf734bd4c165649f6eaf7d7f.js"></script>

<link rel="preload" href="/js/libs/jquery/3.3.1/jquery.slim.min.min.22ee3db0c0e99fd0fbce3aee19672bd53d25469daf734bd4c165649f6eaf7d7f.js" as="script">

<script type="application/javascript">(function() {
     var $window = $(window);
     if ($window.width() >= 1400) { 
         var $toc = $('#TableOfContents');
         if ($toc.length > 0) {
             function onScroll(){
                 var currentScroll = $window.scrollTop();
                 var h = $('.content h1, .content h2, .content h3, .content h4, .content h5, .content h6, .h-feed h2');
                 var id = "";
                 h.each(function (i, e) {
                     e = $(e);
                     if (e.offset().top - 10 <= currentScroll) {
                         id = e.attr('id');
                     }
                 });
                 var current = $toc.find('a.current');
                 if (current.length == 1 && current.eq(0).attr('href') == '#' + id) return true;

                 current.each(function (i, e) {
                     $(e).removeClass('current').siblings('ul').hide();
                 });
                 $toc.find('a[href="#' + id + '"]').parentsUntil('#TableOfContents').each(function (i, e) {
                     $(e).children('a').addClass('current').siblings('ul').show();
                 });
             }
             $window.on('scroll', onScroll);
             $(document).ready(function() {
                 $toc.find('a').parent('li').find('ul').hide();
                 onScroll();
                 document.getElementsByClassName('hugotoc')[0].style.display = '';
             });}}})();</script>








<div class="backtotop center no-text-decoration">
    <a href="#">back to <span class="top">top</span></a>
</div>


<div class="right">
    <div class="taxo no-text-decoration">
         
            
                <ul class="no-bullets inline categories">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts categorized in ‘rakulang’"
                                
                            >
                                <a class="p-category" href="http://localhost:1313/categories/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
         
            
                <ul class="no-bullets inline tags">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts tagged with ‘rakulang’"
                                
                            >
                                <a class="p-category" href="http://localhost:1313/tags/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
        
    </div>

</div>
<div class="clear-float"></div>



<div class="prev-next-navigator clear-float">
    
        <span class="prev-post left no-text-decoration">
            <a href="http://localhost:1313/posts/2018-10-04-perl-6-code-in-rmarkdown/" class="nobr">« Rmarkdown 中的 Raku 代码</a>
        </span>
    
    
        <span class="next-post right no-text-decoration">
            <a href="http://localhost:1313/posts/2018-10-03-a-naive-introduction-to-object-orientation-in-perl-6/" class="nobr">Raku 面向对象简单入门 »</a>
        </span>
    
</div>


<a id="bottom"></a>









                       







                    <ul class="no-bullets feed right inline">
    
        
        
    
</ul>
<div class="clear-float"></div>

                </footer>
                <hr />
            </div>               

            <footer> 
                

<ul class="social no-text-decoration">
    
</ul>










 
    
    



<p class="generated no-text-decoration">
    Generated using  <a href="https://gitlab.com/kaushalmodi/hugo-theme-refined"><code class="nobr">hugo-theme-refined</code></a> + <span class="nobr">Hugo <a href="https://github.com/gohugoio/hugo/commit/312735366b20d64bd61bff8627f593749f86c964">0.123.7</a></span>
</p>

<p>
    
</p>




<div class="badges no-text-decoration">
    
    

    
</div>




<script type="application/javascript">var nav=responsiveNav("#nav");</script>




<script defer src="/js/libs/fragmentions/wrapper.min.e8c468c89edc4f5dccaa8c720c6b220b3088a16cd7b1e4a1e3345985788260c9.js"></script>









            </footer>
        </div> 
    </body>
</html>
