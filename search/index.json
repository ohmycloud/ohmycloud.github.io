[{"categories":["rakulang"],"contents":"Raku Types: æˆäººä¹‹ç¾ åœ¨æˆ‘çš„ç¬¬ä¸€æ¬¡å¤§å­¦ç¼–ç¨‹è¯­è¨€è¯¾ä¸­, æˆ‘è¢«å‘ŠçŸ¥ Pascal è¯­è¨€åœ¨å…¶å®ƒç±»å‹ä¹‹å¤–è¿˜æ‹¥æœ‰ Integerã€Boolen å’Œ Stirng ç±»å‹ã€‚æˆ‘çŸ¥é“äº†ç±»å‹æœ¬æ¥å°±è¯¥å­˜åœ¨å› ä¸ºè®¡ç®—æœºå¾ˆç¬¨ã€‚å½“æˆ‘åœ¨ C è¯­è¨€ä¸­æ¶‰çŒçš„æ—¶å€™, æˆ‘å­¦åˆ°äº†æ›´å¤šæœ‰å…³ intã€ char å’Œå…¶å®ƒåƒåœ¨æš–å’Œçš„åœ°æ–¹é‡Œåœ°å¯„ç”Ÿè™«, è¿˜æœ‰æˆ‘è¯¾æ¡Œåº•ä¸‹å—¡å—¡çš„é‡‘å±ç›’çš„å£°éŸ³ã€‚\nPerl 5 æ²¡æœ‰ç±»å‹, å®ƒç»™æˆ‘çš„æ„Ÿè§‰å°±åƒéª‘ç€è‡ªè¡Œè½¦æ— æ‹˜æ— æŸçš„è¿½é£å°‘å¹´, æ²¿ç€æ–œå¡è€Œä¸‹ã€‚ä¸ä¹…ä¹‹åæˆ‘ä¸€é—¨å¿ƒæ€é’»åˆ°è®¡ç®—æœºç¡¬ä»¶çš„ç¼éš™ä¸­ã€‚æˆ‘æ‹¥æœ‰æ•°æ®å¹¶ä¸”æˆ‘èƒ½ç”¨å®ƒåšä»»ä½•æˆ‘æƒ³åšçš„äº‹, åªè¦æˆ‘å¾—åˆ°çš„ä¸æ˜¯é”™è¯¯çš„æ•°æ®ã€‚å½“æˆ‘æå®šçš„æ—¶å€™, æˆ‘ä»è‡ªè¡Œè½¦ä¸Šæ‰äº†ä¸‹æ¥å¹¶åˆ®ç ´äº†æˆ‘çš„è†ç›–ã€‚\næœ‰äº† Raku, é±¼å’Œç†ŠæŒå¯ä»¥å…¼å¾—ã€‚ä½ å¯ä»¥ä½¿ç”¨ç±»å‹æ¥é¿å…å®ƒä»¬ã€‚ä½ å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªå¹¿åŸŸçš„ç±»å‹æ¥æ¥æ”¶å¾ˆå¤šç§ç±»çš„å€¼æˆ–çª„ç±»å‹ã€‚å¹¶ä¸”ä½ å¯ä»¥äº«å—ä»£è¡¨æœºå™¨æ™ºåŠ›çš„ç±»å‹çš„é€Ÿåº¦, æˆ–è€…ä½ å¯ä»¥äº«å—ä½ è‡ªå®šä¹‰çš„ä»£è¡¨ä½ è‡ªå·±æ„å¿—çš„ç±»å‹çš„ç²¾åº¦, ç±»å‹ä¸ºäººç±»è€Œç”Ÿã€‚\næ¸è¿›ç±»å‹ my $a = \u0026#34;whatever\u0026#34;; my Str $b = \u0026#34;strings only\u0026#34;; my Str:D $c = \u0026#34;defined strings only\u0026#34;; my int $d = 14; # native int sub foo ($x) { $x + 2 } sub bar (Int:D $x) returns Int { $x + 2 } Raku æ‹¥æœ‰æ¸è¿›ç±»å‹, è¿™æ„å‘³ç€ä½ è¦ä¹ˆå¯ä»¥ä½¿ç”¨å®ƒä»¬, è¦ä¹ˆé¿å…ä½¿ç”¨å®ƒä»¬ã€‚æ‰€ä»¥ç©¶ç«Ÿä¸ºä»€ä¹ˆè¦æ‰“æ‰°å®ƒä»¬å‘¢ï¼Ÿ\né¦–å…ˆ, ç±»å‹çº¦æŸäº†ä½ çš„å˜é‡ä¸­èƒ½åŒ…å«çš„, ä½ çš„æ–¹æ³•æˆ–å­ä¾‹ç¨‹æ¥å—çš„æˆ–è¿”å›çš„å€¼çš„èŒƒå›´ã€‚è¿™ä¸ªå‡½æ•°å³ä½œä¸ºæ•°æ®æ ¡éªŒåˆä½œä¸ºå®‰å…¨ç½‘ä»¥è¿‡æ»¤æ‰ä¸æ­£ç¡®ä»£ç æ‰€ç”Ÿæˆçš„åƒåœ¾æ•°æ®ã€‚\nè¿˜æœ‰, å½“ä½¿ç”¨åŸç”Ÿçš„, æœºå™¨æ„å¿—çš„ç±»å‹çš„æ—¶å€™, ä½ å¯ä»¥è·å¾—æ›´å¥½åœ°æ€§èƒ½å¹¶å‡å°‘å†…å­˜ä½¿ç”¨, å‡å¦‚å®ƒä»¬å¯¹äºä½ å¾—æ•°æ®æ¥è¯´æ˜¯åˆé€‚çš„å·¥å…·çš„è¯ã€‚\nå†…ç½®ç±»å‹ æœ‰ä¸€ä¸ªåå‰¯å…¶å®çš„è‡ªåŠ©å¼çš„ Raku ä¸­å¾—å†…ç½®ç±»å‹ã€‚å¦‚æœä½ çš„å­ä¾‹ç¨‹åªå¯¹æ•´æ•°æœ‰æ„ä¹‰, é‚£ä¹ˆä¸ºä½ çš„å‚æ•°ä½¿ç”¨ Int ç±»å‹ã€‚å¦‚æœè´Ÿæ•°æ²¡æœ‰æ„ä¹‰, é‚£ä¹ˆä½¿ç”¨ UInt - ä¸€ä¸ªæ— ç¬¦å·çš„ Int æ¥è¿›ä¸€æ­¥é™åˆ¶å€¼çš„èŒƒå›´ã€‚å¦ä¸€æ–¹é¢, å¦‚æœä½ æƒ³å¤„ç†ä¸€ä¸ªè¾ƒå¹¿çš„èŒƒå›´, é‚£ä¹ˆ Numeric ç±»å‹å¯èƒ½æ›´åˆé€‚ã€‚\nå¦‚æœä½ æƒ³ä¸€æ¢ç©¶ç«Ÿ, Raku ä¹Ÿæä¾›äº†ä¸€ç³»åˆ—çš„æ˜ å°„åˆ°ä½ å¸¸å¸¸è§åˆ°çš„, ä¾‹å¦‚ C è¯­è¨€ä¸­çš„åŸç”Ÿç±»å‹ã€‚ä½¿ç”¨è¿™äº›åŸç”Ÿç±»å‹å¯èƒ½ä¼šæä¾›æ€§èƒ½æå‡æˆ–å†…å­˜ä½¿ç”¨çš„å‡å°‘ã€‚å¯ç”¨çš„åŸç”Ÿç±»å‹æœ‰ï¼šint, int8, int16, int32, int64, uint, uint8, uint16, uint32, uint64, num, num32, num64ã€‚ç±»å‹åå­—ä¸­çš„æ•°å­—è¡¨ç¤ºå¯å¾—çš„å­—èŠ‚, ä¸å«æ•°å­—çš„ç±»å‹æ˜¯å¹³å°æ— å…³çš„ã€‚\nè¯¸å¦‚ int1, int2 å’Œ int4 çš„å­å­—èŠ‚ç±»å‹ä¹Ÿè®¡åˆ’åœ¨æœªæ¥å®ç°ã€‚\nç¬‘è„¸ç¬¦å· multi foo (Int:U $x) { \u0026#39;Y U NO define $x?\u0026#39; } multi foo (Int:D $x) { \u0026#34;The Square of $xis {$xÂ²}\u0026#34; } my Int $x; say foo $x; $x = 42; say foo $x; # OUTPUT: # Y U NO define $x? # The square of 42 is 1764 ç¬‘è„¸ç¬¦å·æ˜¯è¿½åŠ åœ¨ç±»å‹ååé¢çš„ :Uã€:D æˆ– :_ã€‚åœ¨ä½ æ²¡æœ‰æŒ‡å®šç¬‘è„¸ç¬¦å·çš„æ—¶å€™, :_ æ˜¯ä½ è·å¾—çš„é»˜è®¤ç¬‘è„¸ç¬¦å·ã€‚:U åªæŒ‡å®šæœªå®šä¹‰(undefined)å€¼, è€Œ :D åªæŒ‡å®šå®šä¹‰(defined)å€¼ã€‚\né€šè¿‡åœ¨è°ƒç”¨è€…èº«ä¸Šä½¿ç”¨ä¸¤ä¸ªå¸¦æœ‰ :U å’Œ :D çš„ multis, æˆ‘ä»¬èƒ½çŸ¥é“æ–¹æ³•æ˜¯åœ¨ç±»ä¸Šè°ƒç”¨çš„è¿˜æ˜¯åœ¨å®ä¾‹ä¸Šè°ƒç”¨çš„ã€‚å¦‚æœä½ åœ¨æ ¸åŠ¨åŠ›è£…ç½®ä¸Šå·¥ä½œ, ç¡®ä¿ä½ çš„é²æ£’æ’å…¥å­ä¾‹ç¨‹ç»å¯¹ä¸ä¼šæ’å…¥ä»»ä½•æœªå®šä¹‰çš„é‡ä¹Ÿæ˜¯ä¸€ä»¶å¥½äº‹æƒ…, æˆ‘æƒ³ã€‚\nSubsetsï¼šå®šåˆ¶çš„ç±»å‹ å†…ç½®çš„ç±»å‹å¾ˆé…·, ä½†æ˜¯ç¨‹åºå‘˜å·¥ä½œçš„å¤§éƒ¨åˆ†æ•°æ®æ²¡æœ‰ç²¾ç¡®åœ°åŒ¹é…ã€‚è¿™å°±æ˜¯ Raku subsets è¿›åœºçš„æ—¶å€™äº†ã€‚\nsubset Prime of Int where *.is-prime; my Prime $x = 3; $x = 11; # works $x = 4; # å¤±è´¥, ç±»å‹ä¸åŒ¹é…ã€‚ ä½¿ç”¨ subset å…³é”®å­—, æˆ‘ä»¬å°±åœ°åˆ›å»ºäº†ä¸€ä¸ªå«åš Prime çš„ç±»å‹ã€‚å®ƒæ˜¯ Int ç±»å‹çš„ä¸€ä¸ªå­é›†(subset), æ‰€ä»¥ä»»ä½•é Int æ•°ä¸åŒ¹é…è¿™ä¸ªç±»å‹ã€‚æˆ‘ä»¬è¿˜ä½¿ç”¨ where å…³é”®å­—æŒ‡å®šäº†ä¸€ä¸ªé¢å¤–çš„çº¦æŸï¼›é‚£ä¸ªçº¦æŸæ˜¯åœ¨ç»™å®šå€¼èº«ä¸Šè°ƒç”¨çš„ .is-prime æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ª true å€¼ã€‚\nä½¿ç”¨é‚£ä¸ªå•è¡Œä»£ç , æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç‰¹å®šçš„ç±»å‹å¹¶å¯ä»¥åƒå†…ç½®ç±»å‹é‚£æ ·ä½¿ç”¨å®ƒï¼æˆ‘ä»¬ä¸ä»…å¯ä»¥ç”¨å®ƒæ¥æŒ‡å®šå˜é‡çš„ç±»å‹ã€å­ä¾‹ç¨‹/æ–¹æ³•çš„å‚æ•°ç±»å‹å’Œè¿”å›å€¼ç±»å‹, æˆ‘ä»¬è¿˜èƒ½ä½¿ç”¨æ™ºèƒ½åŒ¹é…æ“ä½œç¬¦æ¥æµ‹è¯•ä»»æ„å€¼, å°±åƒæˆ‘ä»¬åœ¨å†…ç½®ç±»å‹ä¸­åšå¾—é‚£æ ·ï¼š\nsubset Prime of Int where *.is-prime; say \u0026#34;It is an Int\u0026#34; if \u0026#39;foo\u0026#39; ~~ Int; # false, it\u0026#39;s a Str say \u0026#34;It\u0026#39;s a prime\u0026#34; if 31337 ~~ Prime; # true, it\u0026#39;s a prime number å¦‚æœä½ çš„ç±»å‹æ˜¯ä¸€æ¬¡æ€§çš„ä¸œè¥¿, ä½ åªæƒ³æŠŠå®ƒåº”ç”¨åˆ°å•ä¸ªå˜é‡ä¸Šå‘¢ï¼Ÿä½ ä¸€ç‚¹ä¹Ÿä¸å¿…å•ç‹¬å£°æ˜ä¸€ä¸ª subsetï¼å°±åœ¨å˜é‡åé¢ä½¿ç”¨ where å…³é”®å­—å¥½äº†, ä½ å¾ˆå¥½çš„ï¼š\nmulti is-a-prime ( Int $ where *.is-prime --\u0026gt; \u0026#39;Yup\u0026#39; ) {} multi is-a-prime ( Any --\u0026gt; \u0026#39;Nope\u0026#39;) {} say is-a-prime 3; # Yup say is-a-prime 4; # Nope say is-a-prime \u0026#39;foo\u0026#39;; # Nope ä¸Šé¢çš„ç­¾åä¸­çš„ --\u0026gt; æ˜¯è¡¨ç¤ºè¿”å›å€¼ç±»å‹çš„å¦å¤–ä¸€ç§æ–¹å¼, æˆ–è€…åœ¨è¿™ç§æƒ…å†µä¸‹, æ˜¯ä¸€ç§å…·ä½“çš„è¿”å›å€¼ã€‚æ‰€ä»¥æˆ‘ä»¬æ‹¥æœ‰äº†ä¸¤ä¸ªå«æœ‰ä¸åŒç­¾åçš„ multiesã€‚ç¬¬ä¸€ä¸ªæ¥æ”¶ä¸€ä¸ª Int ç±»å‹çš„è´¨æ•°, ç¬¬äºŒä¸ªæ¥å—å‰©ä¸‹çš„ä»»ä½•ä¸œè¥¿ã€‚æˆ‘ä»¬çš„ multies å‡½æ•°ä½“ä¸­æ²¡æœ‰ä»»ä½•ä»£ç , å°±å†™äº†ä¸€ä¸ªå­ä¾‹ç¨‹å‘Šè¯‰ä½ ä¸€ä¸ªæ•°å­—æ˜¯å¦æ˜¯è´¨æ•°ï¼\næ‰“åŒ…é‡ç”¨ ç›®å‰ä¸ºæ­¢æˆ‘ä»¬å­¦åˆ°çš„å¾ˆé…·, ä½†æ˜¯é…·ä¸æ˜¯ awesomeï¼ä½ å¯èƒ½ä¼šå¾ˆé¢‘ç¹åœ°ä½¿ç”¨æŸäº›ä½ è‡ªå®šä¹‰çš„ç±»å‹ã€‚åœ¨å‚é‡Œé¢å·¥ä½œ, äº§å“å·è‡³å¤šæœ‰20ä¸ªå­—ç¬¦, ä»¥æŸç§æ ¼å¼ï¼Ÿéå¸¸å¥½ï¼æˆ‘ä»¬ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªå­ç±»å‹ï¼š\nsubset ProductNumber of Str where { .chars \u0026lt;=20 and m/^\\d**3\u0026lt;[-#]\u0026gt;/ }; my ProductNumber $num = \u0026#39;333-FOOBAR\u0026#39;; è¿™å¥½æäº†, ä½†æ˜¯æˆ‘ä»¬ä¸æƒ³åœ¨æ‰€æœ‰çš„åœ°æ–¹éƒ½é‡å¤è¿™ä¸ª subsetã€‚æˆ‘ä»¬æ¥æŠŠå®ƒæ¨åˆ°ä¸€ä¸ªå•ç‹¬çš„æ¨¡å—ä¸­ã€‚æˆ‘ä¼šåˆ›å»º /opt/local/Raku/Company/Types.pm6 å› ä¸º /opt/local/Raku æ˜¯åŒ…å«åœ¨æˆ‘ä¸ºè¿™ä¸ªè™šæ„çš„å‚æ‰€å†™çš„æ‰€æœ‰ apps ä¸­çš„æ¨¡å—æœç´¢è·¯å¾„ä¸­çš„è·¯å¾„ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­, æˆ‘ä¼šæœ‰ä¸‹é¢çš„ä»£ç ï¼š\nunit module Company::Types; my package EXPORT::DEFAULT { subset ProductNumber of Str where { .chars \u0026lt;=20 and m/^\\d**3\u0026lt;[-#]\u0026gt;/ }; } æˆ‘ä»¬ç»™æˆ‘ä»¬çš„æ¨¡å—èµ·äº†ä¸€ä¸ªåå­—å¹¶é»˜è®¤å¯¼å‡ºæˆ‘ä»¬å¯çˆ±çš„ subsetsã€‚æˆ‘ä»¬çš„ä»£ç çœ‹èµ·æ¥æ€ä¹ˆæ ·äº†ï¼Ÿå®ƒçœ‹èµ·æ¥é…·æ¯™äº† - ä¸, ç­‰ç­‰, AWESOME - è¿™ä¸€æ¬¡ï¼š\nuse Company::Types; my ProductNumber $num1 = \u0026#39;333-FOOBAR\u0026#39;; # succeeds my ProductNumber $num2 = \u0026#39;meow\u0026#39;; # fails è¿™æ ·, æˆ‘ä»¬ä½¿ç”¨å•ä¸ª use è¯­å¥æ‰©å±•äº† Raku ä»¥ä¸ºæˆ‘ä»¬æä¾›å®šåˆ¶çš„ç±»å‹, å®ƒç²¾ç¡®åœ°åŒ¹é…äº†æˆ‘ä»¬æƒ³è¦çš„æ•°æ®æˆä¸ºä»€ä¹ˆæ ·å­ã€‚\nAwesome Error Messages for Subsets å¦‚æœä½ å°è¯•è¿‡æ‰€æœ‰è¿™äº›ä¾‹å­, ä½ å¯èƒ½æ³¨æ„åˆ°ä¸€ç‚¹å°ç‘•ç–µã€‚ä½ å¾—åˆ°çš„é”™è¯¯ä¿¡æ¯ä¸å¤Ÿç»™åŠ›ï¼\nType check failed in assignment to $num2; expected Company::Types::EXPORT::DEFAULT::ProductNumber but got Str (\u0026quot;meow\u0026quot;) in block \u0026lt;unit\u0026gt; at test.p6 line 3 å½“ç»™ä½ æ˜¯ä½ çš„ç›®æ ‡çš„æ—¶å€™, ä½ è‚¯å®šæœ‰æå‡é‚£äº›ä¿¡æ¯çš„æ–¹æ³•ã€‚å†æ¬¡æ‰“å¼€æˆ‘ä»¬çš„ Company::Types æ–‡ä»¶, å¹¶æ‰©å±•æˆ‘ä»¬çš„ ProductNumber çš„ where ä»å¥ä»¥åŒ…æ‹¬ç»™åŠ›çš„é”™è¯¯ä¿¡æ¯ï¼š\nsubset ProductNumber of Str where { .chars \u0026lt;= 20 and m/^\\d**3\u0026lt;[-#]\u0026gt;/ or warn \u0026#39;ProductNumber type expects a string at most 20 chars long\u0026#39; ~ \u0026#39;with the first 4 characters in the format of \\d\\d\\d[-|#]\u0026#39; } ç°åœ¨, åœ¨ä¸œè¥¿ä¸åŒ¹é…æˆ‘ä»¬çš„ç±»å‹çš„æ—¶å€™, ä¿¡æ¯ä¼šåœ¨ Type æ£€æŸ¥ä¿¡æ¯å’Œæ ˆè¿½è¸ªä¹‹å‰è¢«åŒ…æ‹¬è¿›æ¥, ä¸ºæˆ‘ä»¬æä¾›æ‰€æœŸæœ›çš„ä¸œè¥¿çš„æ›´å¤šä¿¡æ¯ã€‚ å¦‚æœä½ æƒ³, è¿™å„¿ä½ ä¹Ÿå¯ä»¥è°ƒç”¨ fail ä»£æ›¿ warn, è¿™æ—¶ Type check\u0026hellip; ä¿¡æ¯ä¸ä¼šè¢«æ‰“å°å‡ºæ¥, ç»™ä½ æ›´å¤šæ§åˆ¶ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2016-08-02-raku-types/","tags":["subset"],"title":"Raku Types"},{"categories":["rakulang"],"contents":"Raku ä¸­çš„æ¢³å­! åœ¨ Perl 5 ä¸­, æˆ‘å¾ˆæ„Ÿæ¿€æœ‰è¿™æ ·ä¸¤ä¸ªä¾¿åˆ©çš„ç»“æ„:\nmy @things = $text =~/thing/g; my %things = $text =~/(key)...(value)/g; ä½ æ‹¿å‡ºä¸€å°æ®µå¯ä»¥é¢„è§çš„æ–‡æœ¬, å¹¶ç»™å®ƒä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼, å¼å¼, ä½ å¾—åˆ°äº†ä¸€ä¸ªåˆ—è¡¨å’Œæ•£åˆ—, åƒå˜é­”æœ¯ä¸€èˆ¬ï¼æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ Raku ä¸­ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼, ä½†æ˜¯ comb æ›´é€‚åˆåšè¿™ä¸ªå·¥ä½œã€‚\næœ´ç´ çš„å­—ç¬¦ ä½ å¯ä»¥æŠŠ comb ç”¨ä½œå­ä¾‹ç¨‹æˆ–æ–¹æ³•ã€‚åœ¨å®ƒçš„æœ€åŸºæœ¬çš„å½¢å¼ä¸­, comb ä¼šæŠŠå­—ç¬¦ä¸²åˆ†è§£ä¸ºå­—ç¬¦:\n\u0026#39;foobar moobar é§±é§é“bar\u0026#39;.comb.join(\u0026#39;|\u0026#39;).say; \u0026#39;foobar moobar é§±é§é“bar\u0026#39;.comb(6).join(\u0026#39;|\u0026#39;).say; # OUTPUT: # f|o|o|b|a|r| |m|o|o|b|a|r| |é§±|é§|é“|b|a|r # foobar| mooba|r é§±é§é“b|ar ä¸é€‚ç”¨ä»»ä½•å‚æ•°çš„ comb ä½ ä¼šå¾—åˆ°å„ä¸ªå•ç‹¬çš„å­—ç¬¦ã€‚ç»™ comb æä¾›ä¸€ä¸ªæ•´æ•° $n, é‚£ä¹ˆä½ ä¼šå¾—åˆ°é•¿åº¦è‡³å¤šä¸º $n ä¸ªå­—ç¬¦çš„ä¸€ä¸ªåˆ—è¡¨, å¹¶ä¸”å¦‚æœæ²¡æœ‰å‰©ä¸‹çš„å­—ç¬¦ä¸å¤Ÿçš„è¯, è¿™ä¸ªåˆ—è¡¨ä¼šæ¥æ”¶è¾ƒçŸ­çš„è¿™ä¸ªå­—ç¬¦ä¸²ã€‚è¿™ä¸ªæ–¹æ³•æ¯”ä½¿ç”¨æ­£åˆ™è¡¨å¿«äº† 30 å€ã€‚\nLimits ä½ ä¹Ÿå¯ä»¥ä¸º comb æä¾›ç¬¬äºŒä¸ªæ•´æ•°å‚æ•°, å³ limit, æ¥æ ‡ç¤ºæ¯ä¸ªåˆ—è¡¨ä¸­æœ€å¤šå«æœ‰ limit ä¸ªå…ƒç´ :\n\u0026#39;foobar moobar é§±é§é“bar\u0026#39;.comb(1, 5).join(\u0026#39;|\u0026#39;).say; \u0026#39;foobar moobar é§±é§é“bar\u0026#39;.comb(6, 2).join(\u0026#39;|\u0026#39;).say; # OUTPUT: # f|o|o|b|a # foobar| mooba è¿™é€‚ç”¨äºä½¿ç”¨ comb æ–¹æ³•/å‡½æ•°çš„æ‰€æœ‰å½¢å¼, è€Œä¸ä»…ä»…æ˜¯ä¸Šé¢å±•ç¤ºçš„é‚£æ ·ã€‚\nè®¡æ•° comb ä¹Ÿæ¥æ”¶æ™®é€šçš„ Str ä½œä¸ºå‚æ•°, è¿”å›ä¸€ä¸ªåŒ…å«é‚£ä¸ªå­—ç¬¦ä¸²çš„åŒ¹é…çš„åˆ—è¡¨ã€‚æ‰€ä»¥è¿™åœ¨è®¡ç®—å­å­—ç¬¦ä¸²åœ¨å­—ç¬¦ä¸²ä¸­å‡ºç°çš„æ¬¡æ•°æ—¶å¾ˆæœ‰ç”¨ã€‚\n\u0026#39;The ğŸˆ ran after a ğŸ, but the ğŸ ran away\u0026#39;.comb(\u0026#39;ğŸˆ\u0026#39;).Int.say; \u0026#39;The ğŸˆ ran after a ğŸ, but the ğŸ ran away\u0026#39;.comb(\u0026#39;ran\u0026#39;).Int.say; # OUTPUT: # 1 # 2 ç®€å•çš„åŒ¹é… comb çš„å‚æ•°ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼, æ•´ä¸ªåŒ¹é…ä¼šä½œä¸ºä¸€ä¸ªæ ‡é‡è¢«è¿”å›ï¼š\nfoobar moobar é§±é§é“bar\u0026#39;.comb(/\u0026lt;[a..z]\u0026gt;+\u0026#39;bar\u0026#39;/).join(\u0026#39;|\u0026#39;).say; # OUTPUT: # foobar|moobar é™åˆ¶æ‰€åŒ¹é…çš„ä¸œè¥¿ ä½ å¯ä»¥ä½¿ç”¨ç¯è§†æ–­è¨€æˆ–è€…æ›´ç®€å•çš„ \u0026lt;( å’Œ )\u0026gt; æ­£åˆ™è¡¨è¾¾å¼æ•è·è®°å·:\n\u0026#39;moo=meow ping=pong\u0026#39;.comb(/\\w+\u0026#39;=\u0026#39;\u0026lt;(\\w**4/).join(\u0026#39;|\u0026#39;).say; # values \u0026#39;moo=meow ping=pong\u0026#39;.comb(/\\w+)\u0026gt;\u0026#39;=\u0026#39;\\w**4/).join(\u0026#39;|\u0026#39;).say; # keys # OUTPUT: # meow|pong # moo|ping ä½ å¯ä»¥ä½¿ç”¨ \u0026lt;( å’Œ )\u0026gt; ä¸¤è€…ä¹‹ä¸€æˆ–ä¸¤è€…éƒ½ä½¿ç”¨ã€‚\u0026lt;( ä»åŒ¹é…ä¸­æ’é™¤ä»»ä½•å®ƒä¹‹å‰çš„ä¸œè¥¿, è€Œ )\u0026gt; ä¼šæ’é™¤ä¹‹åçš„ä»»ä½•ä¸œè¥¿ã€‚å³ /'foo' \u0026lt;('bar')\u0026gt; 'ber'/ ä¼šåŒ¹é…åŒ…å« foobarber çš„ä¸œè¥¿, ä½†æ˜¯ä» comb ä¸­è¿”å›çš„ä¸œè¥¿åªä¼šæœ‰ barã€‚\nå¤šä¸ªæ•è· æ€ä¹ˆæ ·å¾—å‡º Perl 5 é‚£æ ·çš„é”®/å€¼å¯¹å„¿å‘¢ï¼Ÿ\nmy %things = \u0026#39;moo=meow ping=pong\u0026#39;.comb(/(\\w+)\u0026#39;=\u0026#39;(\\w+)/, :match)Â».SlipÂ».Str; say %things; # OUTPUT: # moo =\u0026gt; meow, ping =\u0026gt; pong åœ†æ‹¬å·ç”¨äºæ•è·ã€‚:match å‚æ•°ä½¿ comb è¿”å›ä¸€ä¸ª Match å¯¹è±¡çš„åˆ—è¡¨, è€Œéè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ã€‚ä¸‹ä¸€æ­¥, æˆ‘ä»¬ä½¿ç”¨ä¸¤ä¸ª hyper è¿ç®—ç¬¦æŠŠ Matches è½¬æ¢ä¸º Slips, è¿™ä¼šç»™æˆ‘ä»¬ä¸€ä¸ªæ•è·çš„åˆ—è¡¨, ä½†æ˜¯å®ƒä»¬ä»æ—§æ˜¯ Match å¯¹è±¡, è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜è¦æŠŠå®ƒä»¬è½¬æ¢ä¸º Str çš„åŸå› ã€‚\næˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å…·åæ•è·ä½¿ä»£ç æ›´æ¸…æ™°ï¼š\nmy %things = \u0026#39;moo=meow ping=pong\u0026#39; .comb(/$\u0026lt;key\u0026gt;=\\w+\u0026#39;=\u0026#39;$\u0026lt;value\u0026gt;=\\w+/, :match) .map({ .\u0026lt;key\u0026gt; =\u0026gt; .\u0026lt;value\u0026gt;.Str }); say %things; # OUTPUT: # moo =\u0026gt; meow, ping =\u0026gt; pong ä½ è¿˜å¯ä»¥æŠŠä¸Šé¢çš„ä»£ç å†™æˆè¿™æ ·ï¼š\nmy %things = (\u0026#39;moo=meow ping=pong\u0026#39; ~~ m:g/(\\w+)\u0026#39;=\u0026#39;(\\w+)/)Â».SlipÂ».Str; say %things; # OUTPUT: # moo =\u0026gt; meow, ping =\u0026gt; pong ç»“è®º æŠŠ comb å’Œ rotor ç»“åˆèµ·æ¥ç”¨ä¼šå¾ˆå¼ºå¤§ã€‚\nè¯„è®º ä»£æ›¿ä½¿ç”¨å¸¦æœ‰ :match å‚æ•°çš„ .comb, ä½ æœ€å¥½å°±ä½¿ç”¨ .match æ–¹æ³•å¥½äº†:\n\u0026#39;moo=meow ping=pong\u0026#39;.match(/(\\w+)\u0026#39;=\u0026#39;(\\w+)/, :g) ","permalink":"https://ohmyweekly.github.io/notes/2016-06-07-07-comb-in-raku/","tags":["comb"],"title":"Raku ä¸­çš„æ¢³å­"},{"categories":["rakulang"],"contents":"roundrobin çš„å®šä¹‰ä¸º:\nmulti roundrobin(List:D: --\u0026gt; Seq) ç”¨æ³•:\nroundrobin LISTS Round-Robin Merge Two Lists of Different Length roundrobin å¾ˆåƒ zipã€‚ä¸åŒä¹‹å¤„æ˜¯, roundrobin ä¸ä¼šåœ¨ç”¨å…‰å…ƒç´ çš„åˆ—è¡¨ä¸Šåœæ­¢è€Œæ˜¯ä»…ä»…è·³è¿‡ä»»ä½•æœªå®šä¹‰çš„å€¼ï¼š\nmy @a = 1; my @b = 1..2; my @c = 1..3; for flat roundrobin(@a, @b, @c) -\u0026gt; $x { $x.say; # 1,1,1,2,2,3 } å®ƒåªæ˜¯è·³è¿‡äº†æœªå®šçš„å€¼, ç›´åˆ°æœ€é•¿çš„é‚£ä¸ªåˆ—è¡¨çš„å…ƒç´ ç”¨å®Œã€‚\nmy @list1 = \u0026#39;a\u0026#39; .. \u0026#39;h\u0026#39;; my @list2 = \u0026lt;x y\u0026gt;; say flat roundrobin @list1, @list2; # a x b y c d e f g h roundrobin è¿”å›çš„æ˜¯ä¸€åˆ— Seq, æ‰€ä»¥ä½¿ç”¨ flat è¿›è¡Œå±•å¼€ã€‚\nmy @list1 = \u0026#39;a\u0026#39; .. \u0026#39;h\u0026#39;; my @list2 = \u0026lt;x y\u0026gt;; my $n = 3; say flat roundrobin @list1.rotor($n - 1, :partial), @list2; # OUTPUT: Â«a b x c d y e f g hÂ» .rotor æ–¹æ³•æŠŠä¸€ä¸ªåˆ—è¡¨åˆ†è§£ä¸ºå­åˆ—è¡¨ã€‚\näº¤å‰ä¸¤ä¸ªå­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦ #Given: u = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' l = 'abcdefghijklmnopqrstuvwxyz' #Wanted: 'AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz' æ–¹æ³•ä¸€:\nsay join \u0026#39;\u0026#39;, (u.comb Z l.comb); æ–¹æ³•äºŒ:\nsay [~] (u.comb Z l.comb); æ–¹æ³•ä¸‰:\nsay [~] flat (u.comb Z l.comb); ","permalink":"https://ohmyweekly.github.io/notes/2016-06-07-18-roundrobin/","tags":["roundrobin"],"title":"roundrobin"},{"categories":["rakulang"],"contents":"æœ‰ä¸€æ®µç»“æ„åŒ–çš„æ–‡æœ¬, å†™ä¸€ä¸ª Grammar æ¥è§£æå®ƒï¼š\nname = Animal Facts author = jnthn [cat] desc = The smartest and cutest cuteness = 100000 [dugong] desc = The cow of the sea cuteness = -10 [magpie] desc = crow; raven; rook; jackdaw; chough; magpie; jay cuteness = 99 æ¯ä¸€æ®µéƒ½æ˜¯ä¸€ä¸ªç« èŠ‚, æœ‰çš„ç« èŠ‚æ²¡æœ‰ [cat] è¿™æ ·çš„æ ‡é¢˜, è¦æ±‚ Grammar ç”Ÿæˆä¸€ä¸ªæ•£åˆ—, æ•£åˆ—çš„é”®æ˜¯æ–¹æ‹¬å·ä¸­çš„å•è¯, å¦‚æœæ²¡æœ‰å°±é»˜è®¤ä¸º _, æ•£åˆ—çš„å€¼æ˜¯ä¸€ä¸ªæ•£åˆ—çš„æ•°ç»„, æ•°ç»„é‡Œé¢çš„æ¯ä¸ªæ•£åˆ—çš„é”®ä¸ºç­‰å·å·¦è¾¹çš„å•è¯, é”®å€¼ä¸ºç­‰å·å³è¾¹çš„å­—ç¬¦ã€‚\ngrammar INIFile::Grammar { token TOP {^\u0026lt;entries\u0026gt;# æ¡ç›® \u0026lt;section\u0026gt;+# ç« èŠ‚ $} token section {\u0026#39;[\u0026#39;~\u0026#39;]\u0026#39;\u0026lt;key\u0026gt;\\n\u0026lt;entries\u0026gt;# æ¯ä¸ªç« èŠ‚å«æœ‰å¤šä¸ªæ¡ç›® entry } token entries {[|\u0026lt;entry\u0026gt;\\n|\\n# entry å¯ä»¥ä¸ºç©º ]+} token entry {\u0026lt;key\u0026gt;\\h*\u0026#39;=\u0026#39;\\h*\u0026lt;value\u0026gt;} token key {\\w+} token value {\\N+} } class INIFileActions { method entries($/) { my %entries; for $\u0026lt;entry\u0026gt; -\u0026gt; $e { %entries{$e\u0026lt;key\u0026gt;} := ~$e\u0026lt;value\u0026gt;; } make %entries; } method TOP($/) { my %result; %result\u0026lt;_\u0026gt; := $\u0026lt;entries\u0026gt;.ast; for $\u0026lt;section\u0026gt; -\u0026gt; $sec { %result{$sec\u0026lt;key\u0026gt;} := $sec\u0026lt;entries\u0026gt;.ast; } make %result; } } my $m := INIFile::Grammar.parse(Q{name = Animal Facts author = jnthn [cat] desc = The smartest and cutest cuteness = 100000 [dugong] desc = The cow of the sea cuteness = -10 [magpie] desc = crow; raven; rook; jackdaw; chough; magpie; jay cuteness = 99 }, :actions(INIFileActions)); my %sections := $m.ast; for %sections -\u0026gt; $sec { say(\u0026#34;ç« èŠ‚: {$sec.key}\u0026#34;); for $sec.value -\u0026gt; $entry { say(\u0026#34;{$entry.key}: {$entry.value}\u0026#34;); } } make æ˜¯ä¸€ä¸ªå‡½æ•°, æ¥æ”¶å•ä¸ªå‚æ•°, make çš„ä½œç”¨æ˜¯, å¯¹äºæ¯ä¸€ä¸ª method ä¸­å¯¹åº”çš„ $_ , å­˜å‚¨ç”Ÿæˆçš„æŠ½è±¡è¯­æ³•æ ‘(AST)(ç‰‡æ®µ)åˆ° $/ ä¸­ã€‚.ast ç”¨äºä»å·²ä¿å­˜çš„ AST æŠ½è±¡è¯­æ³•æ ‘ä¸­æ£€ç´¢æå– AST (ç‰‡æ®µ), Â» ç›¸å½“äºä¸€ä¸ªå¾ªç¯, å³æ£€ç´¢æ¯ä¸€ä¸ª $\u0026lt;entry\u0026gt; ä¹‹ç±»çš„è¯­æ³•æ ‘ã€‚\ngrammar INIFile::Grammar { token TOP {^\u0026lt;section\u0026gt;+# ç« èŠ‚ $} token section {[\u0026#39;[\u0026#39;~\u0026#39;]\u0026#39;\u0026lt;key\u0026gt;\\n]?# [key] è¿™ä¸€è¡Œæ˜¯å¯é€‰çš„ \u0026lt;entries\u0026gt;# æ¯ä¸ªç« èŠ‚å«æœ‰å¤šä¸ªæ¡ç›® entry } token entries {[|\u0026lt;entry\u0026gt;\\n|\\n# entry å¯ä»¥ä¸ºç©º ]+} token entry {\u0026lt;key\u0026gt;\\h*\u0026#39;=\u0026#39;\\h*\u0026lt;value\u0026gt;} token key {\\w+} token value {\\N+} } class INIFileActions { method key ($/) { $/.make: ~$/ } method value ($/) { $/.make: ~$/ } method entry ($/) { $/.make: $\u0026lt;key\u0026gt;.ast =\u0026gt; $\u0026lt;value\u0026gt;.ast } method entries($/) { $/.make: $\u0026lt;entry\u0026gt;Â».ast } method section($/) { $/.make: $\u0026lt;key\u0026gt;.ast // \u0026#39;_\u0026#39; =\u0026gt; $\u0026lt;entries\u0026gt;.ast } # å¦‚æœ key ä¸å­˜åœ¨å°±é»˜è®¤ä¸º `_` method TOP($/) { $/.make: $\u0026lt;section\u0026gt;Â».ast; # ç­‰ä»·äº $/.make($\u0026lt;section\u0026gt;Â».ast); # \u0026#39;-\u0026#39; =\u0026gt; $\u0026lt;entries\u0026gt;.ast # \u0026#39;_\u0026#39; æ²¡æœ‰ ast æ–¹æ³• } } my $m = INIFile::Grammar.parse(Q{name = Animal Facts author = jnthn [cat] desc = The smartest and cutest cuteness = 100000 [dugong] desc = The cow of the sea cuteness = -10 [magpie] desc = crow; raven; rook; jackdaw; chough; magpie; jay cuteness = 99 }, :actions(INIFileActions)).ast; for @$m -\u0026gt; $sec { say(\u0026#34;ç« èŠ‚: {$sec.key}\u0026#34;); for $sec.value -\u0026gt; $entry { say(\u0026#34;{$entry.key}: {$entry.value}\u0026#34;); } } Grammar çš„è§£ææ˜¯ä»ä¸Šè‡³ä¸‹çš„, ä» top-level (TOP) å¼€å§‹, åˆ°åˆ†æ”¯(branch)ã€‚Actions ä¸­çš„æ–¹æ³•æ˜¯éšç€è§£æè€Œæ‰§è¡Œçš„, ä½†æ˜¯æŠ½è±¡è¯­æ³•æ ‘(AST) çš„å­˜å‚¨å’Œæ£€ç´¢æ˜¯è‡ªä¸‹è€Œä¸Šçš„, åªæœ‰åº•éƒ¨çš„å­˜å‚¨å®Œäº†, å…¶ä¸Šå±‚éƒ¨åˆ†æ‰å¯ä»¥ä½¿ç”¨ .ast æˆ– .made æ–¹æ³•è¿›è¡Œæ£€ç´¢, æ£€ç´¢åˆ°ä¹‹åå„è‡ªè¿›è¡Œå¤„ç†åå†æ¬¡å­˜å‚¨, ä»¥ä¾›å®ƒçš„ä¸Šå±‚éƒ¨åˆ†ä½¿ç”¨, ä»¥æ­¤ç±»æ¨ã€‚\næ³¨æ„, ç¬¬ä¸€æ®µä»£ç ä¸­ $m å­˜å‚¨çš„æ­»æ•£åˆ—, è€Œç¬¬äºŒæ®µä»£ç ä¸­, $m å­˜å‚¨çš„æ˜¯æ•°ç»„! è¿™è¯´æ˜å¯ä»¥è¿”å›æ•£åˆ—å’Œæ•°ç»„ä¸¤ç§å½¢å¼ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2016-05-12-actions-and-ast-in-raku/","tags":["actions","ast"],"title":"Actions å’ŒæŠ½è±¡è¯­æ³•æ ‘"},{"categories":["rakulang"],"contents":"Subscripts é€šè¿‡ç´¢å¼•æˆ–é”®è®¿é—®æ•°æ®ç»“æ„ä¸­çš„å…ƒç´ ã€‚\né€šå¸¸, äººä»¬éœ€è¦å¼•ç”¨é›†åˆæˆ–æ•°æ®ç»“æ„ä¸­çš„ä¸€ä¸ªç‰¹å®šçš„å…ƒç´ (æˆ–ç‰¹å®šçš„å…ƒç´ åˆ‡ç‰‡)ã€‚ä»æ•°å­¦æ ‡è®°æ³•ä¸­å·å­¦åˆ°çš„, å‘é‡ v çš„ç»„æˆéƒ¨åˆ†ç”¨ vâ‚, vâ‚‚, vâ‚ƒ æ¥å¼•ç”¨, åœ¨ Raku ä¸­è¿™ä¸ªæ¦‚å¿µå«åš â€œä¸‹æ ‡â€ (æˆ–â€œç´¢å¼•â€)ã€‚\nBasics Raku æä¾›äº†ä¸¤ä¸ªé€šç”¨çš„ä¸‹æ ‡æ¥å£ï¼š\n    elements are identified by interface name supported by     [ ] zero-based indices Positional Array, List, Buf, Match, \u0026hellip;   { } string or object keys Associative Hash, Bag, Mix, Match, \u0026hellip;     Positional ä¸‹æ ‡ (é€šè¿‡ postcircumfix  é€šè¿‡å…ƒç´ åœ¨æœ‰åºé›†åˆä¸­çš„ä½ç½®æ¥å¯»å€å…ƒç´ ã€‚)ç´¢å¼• 0 å¼•ç”¨ç¬¬ä¸€ä¸ªå…ƒç´ , ç´¢å¼• 1 å¼•ç”¨ç¬¬äºŒä¸ªå…ƒç´ , ä»¥æ­¤ç±»æ¨ï¼š  my @chores = \u0026#34;buy groceries\u0026#34;, \u0026#34;feed dog\u0026#34;, \u0026#34;wash car\u0026#34;; say @chores[0]; # buy groceries say @chores[1]; # feed dog say @chores[2]; # wash car  Associative ä¸‹æ ‡ (é€šè¿‡ postcircumfix { }), ä¸è¦æ±‚é›†åˆä»¥ä»»ä½•ç‰¹å®šçš„é¡ºåºä¿å­˜å…ƒç´  - ç›¸å, å®ƒä½¿ç”¨ä¸€ä¸ªå”¯ä¸€çš„é”®æ¥å¯»å€æ¯ä¸ªå€¼ã€‚é”®çš„ç§ç±»å–å†³äºä½¿ç”¨çš„é›†åˆï¼š ä¸¾ä¸ªä¾‹å­, ä¸€ä¸ªæ ‡å‡†çš„æ•£åˆ— ä½¿ç”¨å­—ç¬¦ä¸²ä½œä¸ºé”®, è€Œä¸€ä¸ª Mix èƒ½ä½¿ç”¨ä»»æ„çš„å¯¹è±¡ä½œä¸ºé”®, ç­‰ç­‰:  my %grade = Zoe =\u0026gt; \u0026#34;C\u0026#34;, Ben =\u0026gt; \u0026#34;B+\u0026#34;; say %grade{\u0026#34;Zoe\u0026#34;}; # C say %grade{\u0026#34;Ben\u0026#34;}; # B+ my $stats = ( Date.today =\u0026gt; 4.18, Date.new(2015, 4, 5) =\u0026gt; 17.253 ).Mix; say $stats{ Date.new(2015, 4, 5) }; # 17.253 ç›¸å¯¹äºä¼ é€’å•ä¸ª-å•è¯å­—ç¬¦ä¸²é”®ç»™ { }, ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥å°–æ‹¬å·å¼•èµ·å•è¯çš„ç»“æ„, å°±åƒå®ƒä»¬æ˜¯åç¼€æ“ä½œç¬¦ä¸€æ ·ï¼š\nsay %grade\u0026lt;Zoe\u0026gt;; # C say %grade\u0026lt;Ben\u0026gt;; # B+ è¿™å®é™…ä¸Šä»…ä»…æ˜¯åœ¨ç¼–è¯‘æ—¶è¢«è½¬æ¢ä¸ºå¯¹åº” { } å½¢å¼çš„è¯­æ³•ç³–ï¼š\n%hash\u0026lt;foo bar\u0026gt;; # same as %hash{ \u0026lt;foo bar\u0026gt; } %hashÂ«foo $varÂ»; # same as %hash{ Â«foo $varÂ» } %hash\u0026lt;\u0026lt;foo $var\u0026gt;\u0026gt;; # same as %hash{ \u0026lt;\u0026lt;foo $var\u0026gt;\u0026gt; } ä¸‹æ ‡èƒ½åº”ç”¨åˆ°èƒ½è¿”å›å¯ä¸‹æ ‡åŒ–å¯¹è±¡çš„ä»»ä½•è¡¨è¾¾å¼ä¸Š, è€Œä¸ä»…ä»…åº”ç”¨åˆ°å˜é‡ä¸Šï¼š\nsay \u0026#34;__Hello__\u0026#34;.match(/__(.*)__/)[0]; # ï½¢Helloï½£ say \u0026#34;__Hello__\u0026#34;.match(/__(.*)__/).[0]; # same, in method notation Positional å’Œ associative ä¸‹æ ‡å¹¶ä¸äº’ç›¸æ’æ–¥ - ä¸¾ä¸ªä¾‹å­, Match å¯¹è±¡ä¸¤ä¸ªéƒ½æ”¯æŒ(æ¯ä¸ªè®¿é—®ä¸åŒçš„æ•°æ®é›†)ã€‚è¿˜æœ‰, ä¸ºäº†è®©åˆ—è¡¨å¤„ç†æ›´æ–¹ä¾¿, ç±» Any ä¸ºä½ç½®ä¸‹æ ‡æä¾›äº†å¤‡ç”¨çš„å®ç°, è¿™ä¼šæŠŠè°ƒç”¨è€…çœ‹ä½œå«æœ‰ä¸€ä¸ªå…ƒç´ çš„åˆ—è¡¨ã€‚(ä½†æ˜¯å¯¹äºå…³ç³»ä¸‹æ ‡, æ²¡æœ‰è¿™æ ·çš„å¤‡ç”¨å®ç°, æ‰€ä»¥ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸, å½“ä¸‹æ ‡è¢«åº”ç”¨åˆ°æ²¡æœ‰å®ç°æ”¯æŒçš„å¯¹è±¡ä¸Šæ—¶ã€‚)\nsay 42[0]; # 42 say 42\u0026lt;foo\u0026gt;; # ERROR: postcircumfix { } not defined for type Int Nonexistent elements å½“é€šè¿‡ä¸‹æ ‡å¯»å€ä¸€ä¸ªä¸å­˜åœ¨çš„å…ƒç´ æ‰€å‘ç”Ÿçš„äº‹æƒ…å–å†³äºæ­£åœ¨ä½¿ç”¨çš„é›†åˆç±»å‹ã€‚æ ‡å‡†çš„ Array å’Œ Hash é›†åˆè¿”å›å®ƒä»¬çš„value type constraint çš„ç±»å‹å¯¹è±¡(è¿™é»˜è®¤æ˜¯ Any)ã€‚\nmy @array1; say @array1[10]; # (Any) my Int @array2; say @array2[10]; # (Int) my %hash1; say %hash1\u0026lt;foo\u0026gt;; # (Any) my Int %hash2; say %hash2\u0026lt;foo\u0026gt;; # (Int) ç„¶è€Œ, å…¶å®ƒç±»å‹çš„é›†åˆå¯èƒ½åœ¨å¯»å€ä¸å­˜åœ¨çš„å…ƒç´ çš„ä¸‹æ ‡æ—¶ååº”ä¹Ÿä¸ç”¨ï¼š\nsay (0, 10, 20)[3]; # Nil say bag(\u0026lt;a a b b b\u0026gt;)\u0026lt;c\u0026gt;; # 0 ä¸ºäº†åœ¨ä¸‹æ ‡æ“ä½œä¸­é»˜é»˜åœ°è·³è¿‡ä¸å­˜åœ¨çš„å…ƒç´ , æŸ¥çœ‹ #Truncating slices å’Œ #:v å‰¯è¯ã€‚\nFrom the end Positional ç´¢å¼•æ˜¯ä»é›†åˆçš„å¼€å¤´è®¡æ•°çš„, ä½†æ˜¯ä¹Ÿæœ‰ä¸€ç§æ ‡è®°æ³•ç”¨äº, é€šè¿‡ç›¸å¯¹äºæœ«å°¾çš„ä½ç½®æ¥å¯»å€å…ƒç´ ï¼š*-1 å¼•ç”¨æœ€åä¸€ä¸ªå…ƒç´ , *-2 å¼•ç”¨å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ , ä»¥æ­¤ç±»æ¨ã€‚\nmy @alphabet = \u0026#39;A\u0026#39; .. \u0026#39;Z\u0026#39;; say @alphabet[*-1]; # Z say @alphabet[*-2]; # Y say @alphabet[*-3]; # X æ³¨æ„ï¼šæ˜Ÿå·å¾ˆé‡è¦ã€‚åœ¨ Raku ä¸­, å¦‚æœåƒåœ¨å¾ˆå¤šå…¶å®ƒç¼–ç¨‹è¯­è¨€ä¸­é‚£æ ·ä¼ é€’ä¸€ä¸ªè£¸çš„è´Ÿæ•´æ•°(ä¾‹å¦‚ @alphabet[-1]), ä¼šæŠ›å‡ºé”™è¯¯ã€‚\nè¿™é‡Œå®é™…å‘ç”Ÿçš„æ˜¯, *-1 é‚£æ ·çš„è¡¨è¾¾å¼é€šè¿‡ Whatever æŸ¯é‡ŒåŒ–å£°æ˜äº†ä¸€ä¸ªä»£ç å¯¹è±¡ - [ ] ä¼šæŠŠä»£ç å¯¹è±¡ä½œä¸ºç´¢å¼•, é€šè¿‡é›†åˆçš„é•¿åº¦ä½œä¸ºå‚æ•°æ¥è°ƒç”¨å®ƒå¹¶ä½¿ç”¨ç»“æœå€¼ä½œä¸ºå®é™…çš„ç´¢å¼•ã€‚æ¢å¥è¯è¯´, @alphabet[*-1] å˜æˆäº† @alphabet[@alphabet.elems - 1]ã€‚\nè¿™æ„å‘³ç€ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•ä¾èµ–äºé›†åˆå°ºå¯¸çš„è¡¨è¾¾å¼ï¼š\nsay @array[* div 2]; # é€‰æ‹©æœ€ä¸­é—´çš„é‚£ä¸ªå…ƒç´  say @array[$i % *]; # wrap around a given index (\u0026#34;æ¨¡è¿ç®—\u0026#34;) say @array[ -\u0026gt; $size { $i % $size } ]; # same as previous Slices å½“éœ€è¦è®¿é—®é›†åˆä¸­çš„å¤šä¸ªå…ƒç´ æ—¶, æœ‰ä¸€ä¸ªå¿«æ·æ–¹å¼ç”¨äºå¤„ç†å¤šä¸ªå•ç‹¬çš„ä¸‹æ ‡æ“ä½œï¼šä»…ä»…åœ¨ä¸‹æ ‡ä¸­æŒ‡å®šä¸€ä¸ªç´¢å¼•/é”®çš„åˆ—è¡¨, æ¥å–å›ä¸€ä¸ªå…ƒç´ çš„åˆ—è¡¨ - ä¹Ÿè¢«å«åš\u0026quot;åˆ‡ç‰‡\u0026quot; - ä»¥ç›¸åŒçš„é¡ºåºã€‚\nå¯¹äº positional åˆ‡ç‰‡, ä½ å¯ä»¥æ··åˆæ™®é€šåˆ‡ç‰‡å’Œ from-the-end åˆ‡ç‰‡ï¼š\nmy @alphabet = \u0026#39;a\u0026#39; .. \u0026#39;z\u0026#39;; dd @alphabet[15, 4, *-9, 11]; # (\u0026#34;p\u0026#34;, \u0026#34;e\u0026#34;, \u0026#34;r\u0026#34;, \u0026#34;l\u0026#34;) å¯¹äº associative åˆ‡ç‰‡, å°–æ‹¬å·å½¢å¼çš„åˆ‡ç‰‡é€šå¸¸ä¼šå¾ˆæ–¹ä¾¿ï¼š\nmy %color = kiwi =\u0026gt; \u0026#34;green\u0026#34;, banana =\u0026gt; \u0026#34;yellow\u0026#34;, cherry =\u0026gt; \u0026#34;red\u0026#34;; dd %color{\u0026#34;cherry\u0026#34;, \u0026#34;kiwi\u0026#34;}; # (\u0026#34;red\u0026#34;, \u0026#34;green\u0026#34;) dd %color\u0026lt;cherry kiwi\u0026gt;; # (\u0026#34;red\u0026#34;, \u0026#34;green\u0026#34;) dd %color{*}; # (\u0026#34;green\u0026#34;, \u0026#34;red\u0026#34;, \u0026#34;yellow\u0026#34;) è¦çŸ¥é“åˆ‡ç‰‡æ˜¯ç”±ä¼ å…¥ (one dimension of)ä¸‹æ ‡çš„ç±»å‹æ§åˆ¶çš„, è€Œéå®ƒçš„é•¿åº¦ï¼š\n   subscript result     any Positional object not covered below normal slice   a Range or infinite sequence truncating slice (only for positional subscripts)   * (Whatever-star) full slice (as if all keys/indices were specified)   any other object single-element access rather than a slice   empty Zen slice    æ‰€ä»¥, å³ä½¿ä¸€ä¸ªå•ä¸ªå…ƒç´ çš„åˆ—è¡¨ä¹Ÿä¼šè¿”å›ä¸€ä¸ªåˆ‡ç‰‡, è€Œä¸€ä¸ªè£¸çš„æ ‡é‡å€¼ä¸ä¼šï¼š\ndd @alphabet[2,]; # (\u0026#34;c\u0026#34;,) dd @alphabet[2]; # \u0026#34;c\u0026#34; (å°–æ‹¬å·å½¢å¼çš„ associative ä¸‹æ ‡ä¹Ÿæ²¡æœ‰é—®é¢˜, å› ä¸º word quoting åœ¨å•ä¸ªå•è¯çš„æƒ…å†µä¸‹å¾ˆæ–¹ä¾¿çš„è¿”å›ä¸€ä¸ª Strã€‚\nå¯¹äºæ™®é€šçš„åˆ‡ç‰‡, ä¸‹æ ‡çš„å†…å®¹ (the current dimension of) åœ¨å®ƒçš„å…ƒç´ è¢«è§£é‡Šä¸ºç´¢å¼•/é”®ä¹‹å‰ä¼šè¢«å±•å¹³(flattened)ï¼š\ndd @alphabet[0, (1..2, (3,)))]; # (\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;, \u0026#34;d\u0026#34;) Truncating slices é€šå¸¸, åœ¨åˆ‡ç‰‡ä¸‹æ ‡ä¸­å¼•ç”¨ä¸å­˜åœ¨çš„å…ƒç´ ä¼šè®©è¾“å‡ºåˆ—è¡¨åŒ…å«æœªå®šä¹‰çš„å€¼ã€‚ç„¶è€Œ, å¦‚æœä¼ é€’ç»™ä½ç½®ä¸‹æ ‡çš„å¯¹è±¡æ˜¯ä¸€ä¸ª Range æˆ–ä½¿ç”¨åºåˆ—æ“ä½œç¬¦æ„å»ºçš„æ— é™åºåˆ—, å®ƒä¼šè¢«è‡ªåŠ¨æˆªæ–­åˆ°é›†åˆçš„å®é™…å°ºå¯¸ï¼š\nmy @letters = \u0026lt;a b c d e f\u0026gt;; dd @letters[3, 4, 5, 6, 7]; # (\u0026#34;d\u0026#34;, \u0026#34;e\u0026#34;, \u0026#34;f\u0026#34;, Any, Any) dd @letters[3 .. 7]; # (\u0026#34;d\u0026#34;, \u0026#34;e\u0026#34;, \u0026#34;f\u0026#34;) From-the-end ç´¢å¼•è¢«å…è®¸ä½œä¸ºèŒƒå›´çš„ç«¯ç‚¹, ä»£è¡¨æ— é™çš„èŒƒå›´å’Œåºåˆ—ï¼š\nsay @array[*-3 .. *]; # select the last three elements say @array[0, 2, 4 ... *]; # select all elements with even indices å¦‚æœä½ ä¸æƒ³æŠŠä½ çš„åˆ‡ç‰‡æŒ‡å®šä¸º range/sequence ä½†ä»æ—§æƒ³é»˜é»˜åœ°è·³è¿‡ä¸å­˜åœ¨çš„å…ƒç´ , ä½ å¯ä»¥ä½¿ç”¨ #:v å‰¯è¯ã€‚\nZen slices å¦‚æœä½ å†™çš„ä¸‹æ ‡æ²¡æœ‰æŒ‡å®šä»»ä½•ç´¢å¼•/é”®, é‚£å®ƒå°±ä¼šè¿”å›è¢«è„šæ³¨çš„å¯¹è±¡è‡ªèº«ã€‚å› ä¸ºå®ƒæ˜¯ç©ºçš„ä½†æ˜¯è¿”å›äº†å…¨éƒ¨ä¸œè¥¿, è¿™å°±æ˜¯æ‰€è°“çš„ \u0026ldquo;Zen slice\u0026rdquo;ã€‚\nè¿™å’Œä¼ é€’ä¸€ä¸ª Whatever-star, è¿˜æœ‰ä¼ é€’ä¸€ä¸ªç©ºçš„åˆ—è¡¨éƒ½ä¸åŒ(å®ƒè¿”å›ä¸€ä¸ªç©ºçš„åˆ‡ç‰‡)ï¼š\nmy %bag := (\u0026#34;orange\u0026#34; =\u0026gt; 1, \u0026#34;apple\u0026#34; =\u0026gt; 3).Bag; dd %bag\u0026lt;\u0026gt;; # (\u0026#34;orange\u0026#34;=\u0026gt;1,\u0026#34;apple\u0026#34;=\u0026gt;3).Bag dd %bag{}; # (\u0026#34;orange\u0026#34;=\u0026gt;1,\u0026#34;apple\u0026#34;=\u0026gt;3).Bag dd %bag{*}; # (1, 3) dd %bag{()}; # () è¿™é€šå¸¸è¢«ç”¨äºæŠŠæ•´ä¸ªæ•°ç»„/æ•£åˆ—æ’å€¼åˆ°å­—ç¬¦ä¸²ä¸­ï¼š\nmy @words = \u0026#34;cruel\u0026#34;, \u0026#34;world\u0026#34;; say \u0026#34;Hello, @words[]!\u0026#34; # Hello, cruel world! Autovivification ä¸‹æ ‡å‚ä¸ \u0026ldquo;autovivification\u0026rdquo;, è¿™æ˜¯ä¸€ç§æ•°ç»„å’Œæ•£åˆ—åœ¨éœ€è¦æ—¶ä¼šè‡ªåŠ¨å­˜åœ¨çš„å¤„ç†, ä»¥è‡³äºä½ æ²¡æœ‰å¿…è¦åœ¨æ¯ä¸€å±‚çº§é¢„å£°æ˜é›†åˆçš„ç±»å‹æ¥æ„å»ºåµŒå¥—çš„æ•°æ®ç»“æ„ï¼š\nmy $beatles; $beatles{\u0026#34;White Album\u0026#34;}[0] = \u0026#34;Back in the U.S.S.R.\u0026#34;; # autovivification! say $beatles.perl; # {\u0026#34;White Album\u0026#34; =\u0026gt; [\u0026#34;Back in the U.S.S.R.\u0026#34;]} $beatles ä»æœªå®šä¹‰å¼€å§‹, ä½†æ˜¯å®ƒå˜æˆäº†ä¸€ä¸ª Hash å¯¹è±¡, å› ä¸ºå®ƒåœ¨èµ‹å€¼æ—¶ç”¨ { } æ ‡æ³¨äº†ã€‚ç±»ä¼¼åœ°, $beatles{\u0026quot;White Albumâ€} å˜æˆä¸€ä¸ª Array å¯¹è±¡, å› ä¸ºå®ƒåœ¨èµ‹å€¼æ—¶ç”¨ [ ] æ ‡æ³¨äº†ã€‚\næ³¨æ„ä¸‹æ ‡æœ¬èº«ä¸ä¼šå¼•èµ· autovivification, å®ƒåªå‘ç”Ÿåœ¨ä¸‹æ ‡é“¾çš„ç»“æœè¢«èµ‹å€¼æ—¶(æˆ–å˜åŒ–æ—¶)ã€‚\nBinding ä¸‹æ ‡è¡¨è¾¾å¼ä¹Ÿå¯ä»¥ç”¨åœ¨ç»‘å®šè¯­å¥çš„å·¦ä¾§ã€‚å¦‚æœè¢«æ ‡æ³¨çš„é›†åˆçš„ç±»å‹æ”¯æŒ, è¿™ä¼šä½¿ç”¨æŒ‡å®šçš„å®¹å™¨æ›¿æ¢é›†åˆé‡Œçš„æ’æ§½çš„å€¼:\nå†…ç½®çš„ Array å’Œ Hash ç±»å‹æ”¯æŒè¿™ç§ç»‘å®š, ä¸ºäº†å…è®¸æ„å»ºå¤æ‚çš„è”åŠ¨çš„æ•°æ®ç»“æ„ï¼š\nmy @a = 10, 11, 12, 13; my $x = 1; @a[2] := $x; # binding! (@a[2] and $x refer to the same container now.) $x++; @a[2]++; dd @a; # [10, 11, 3, 13]\u0026lt;\u0026gt; dd $x; # 3 æŸ¥çœ‹ #method BIND-POS å’Œ #method BIND-KEY äº†è§£åº•å±‚æœºåˆ¶.\nAdverbs ä¸‹æ ‡æ“ä½œçš„è¿”å›å€¼å’Œå¯èƒ½å­˜åœ¨çš„å‰¯ä½œç”¨èƒ½å¤Ÿä½¿ç”¨å‰¯è¯æ¥æ§åˆ¶ã€‚\nè¦çŸ¥é“å‰¯è¯æ“ä½œç¬¦çš„ä¼˜å…ˆçº§ç›¸å¯¹å®½æ¾, è¿™å¯èƒ½éœ€è¦ä½ åœ¨åˆæˆè¡¨è¾¾å¼ä¸­æ·»åŠ æ‹¬å·ï¼š\nif $foo || %hash\u0026lt;key\u0026gt;:exists { ... }; # WRONG, tries to adverb the || op if $foo || (%hash\u0026lt;key\u0026gt;:exists) { ... }; # correct æ”¯æŒçš„å‰¯è¯æœ‰:\n:exists è¿”å›è¯·æ±‚çš„å…ƒç´ æ˜¯å¦å­˜åœ¨, è€Œä¸æ˜¯è¿”å›å…ƒç´ å®é™…çš„å€¼ã€‚è¿™èƒ½å¤Ÿç”¨äºåŒºåˆ«æœªå®šä¹‰å€¼çš„å…ƒç´ å’Œä¸€ç‚¹å„¿ä¹Ÿä¸å±äºé›†åˆéƒ¨åˆ†çš„å…ƒç´ ï¼š\nmy @foo = Any, 10; dd @foo[0].defined; # False dd @foo[0]:exists; # True dd @foo[2]:exists; # False dd @foo[0, 2]:exists; # (True, False) my %fruit = apple =\u0026gt; Any, orange =\u0026gt; 10; dd %fruit\u0026lt;apple\u0026gt;.defined; # False dd %fruit\u0026lt;apple\u0026gt;:exists; # True dd %fruit\u0026lt;banana\u0026gt;:exists; # False dd %fruit\u0026lt;apple banana\u0026gt;:exists; # (True, False) ä¹Ÿå¯ä»¥å¯¹å‰¯è¯å–åæ¥æµ‹è¯•ä¸å­˜åœ¨ï¼š\ndd %fruit\u0026lt;apple banana\u0026gt;:!exists; # (False, True) è¦æ£€æŸ¥åˆ‡ç‰‡çš„æ‰€æœ‰å…ƒç´ æ˜¯å¦å­˜åœ¨, ä½¿ç”¨ all junction:\nif all %fruit\u0026lt;apple orange banana\u0026gt;:exists { ... } :exists å¯ä»¥å’Œ :delete è¿˜æœ‰ :p/:kv å‰¯è¯ç»„åˆ - è¿™æ—¶è¡¨è¾¾å¼çš„è¡Œä¸ºå°±ç”±é‚£äº›å‰¯è¯å†³å®š, é™¤äº†ä½¿ç”¨è¡¨æ˜å…ƒç´ å­˜åœ¨çš„å¯¹åº” Bool å€¼æ›¿æ¢è¿”å›çš„å…ƒç´ å€¼ä¹‹å¤–ã€‚\næŸ¥çœ‹ method EXISTS-POS å’Œ method EXISTS-KEY \u0008äº†è§£åº•å±‚æœºåˆ¶.\n:delete ä»é›†åˆä¸­åˆ é™¤å…ƒç´ , é™¤äº†è¿”å›å®ƒä»¬çš„å€¼ä»¥å¤–ã€‚\nmy @tens = 0, 10, 20, 30; dd @tens[3]:delete; # 30 dd @tens; # [0, 10, 20]\u0026lt;\u0026gt; my %fruit = apple =\u0026gt; 5, orange =\u0026gt; 10, banana =\u0026gt; 4, peach =\u0026gt; 17; dd %fruit\u0026lt;apple\u0026gt;:delete; # 5 dd %fruit\u0026lt;peach orange\u0026gt;:delete; # (17, 10) dd %fruit; # {banana =\u0026gt; 4}\u0026lt;\u0026gt; ä½¿ç”¨å¦å®šå½¢å¼çš„å‰¯è¯, å…ƒç´ å®é™…ä¸Šä¸ä¼šè¢«åˆ é™¤ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥ä¼ é€’ä¸€ä¸ªæ ‡è®°, è®©å®ƒå˜æˆæœ‰æ¡ä»¶çš„åˆ é™¤ï¼š\ndd %fruit\u0026lt;apple\u0026gt; :delete($flag); # deletes the element only if $flag is # true, but always returns the value. èƒ½å’Œ :exists è¿˜æœ‰ :p/:kv/:k/:v å‰¯è¯ç»„åˆ - è¿™æ—¶è¿”å›å€¼ç”±é‚£äº›å‰¯è¯å†³å®š, ä½†æ˜¯åŒæ—¶å…ƒç´ ä¹Ÿä¼šè¢«åˆ é™¤ã€‚\næŸ¥çœ‹ method DELETE-POS and method DELETE-KEY äº†è§£åº•å±‚æœºåˆ¶.\n:p ä»¥ Pair çš„å½¢å¼, è¿”å›å…ƒç´ çš„ç´¢å¼•/é”®å’Œå…ƒç´ å€¼, å¹¶é»˜é»˜è·³è¿‡ä¸å­˜åœ¨çš„å…ƒç´ ï¼š\nmy @tens = 0, 10, 20, 30; dd @tens[1]:p; # 1 =\u0026gt; 10 dd @tens[0, 4, 2]:p; # (0 =\u0026gt; 0, 2 =\u0026gt; 20) my %month = Jan =\u0026gt; 1, Feb =\u0026gt; 2, Mar =\u0026gt; 3; dd %month\u0026lt;Feb\u0026gt;:p; # \u0026#34;Feb\u0026#34; =\u0026gt; 2 dd %month\u0026lt;Jan Foo Mar\u0026gt;:p; # (\u0026#34;Jan\u0026#34; =\u0026gt; 1, \u0026#34;Mar\u0026#34; =\u0026gt; 3) å¦‚æœä½ ä¸æƒ³è·³è¿‡ä¸å­˜åœ¨çš„å…ƒç´ , ä½¿ç”¨å¦å®šå½¢å¼:\ndd %month\u0026lt;Jan Foo Mar\u0026gt;:!p; # (\u0026#34;Jan\u0026#34; =\u0026gt; 1, \u0026#34;Foo\u0026#34; =\u0026gt; Any, \u0026#34;Mar\u0026#34; =\u0026gt; 3) èƒ½å’Œ :exists è¿˜æœ‰ :delete ç»„åˆã€‚\nä¹Ÿå¯ä»¥æŸ¥çœ‹ pairs å­ä¾‹ç¨‹.\n:kv ä»¥åˆ—è¡¨çš„å½¢å¼è¿”å›å…ƒç´ çš„ç´¢å¼•/é”®å’Œå€¼, å¹¶é»˜é»˜åœ°è·³è¿‡ä¸å­˜åœ¨çš„å…ƒç´ ã€‚å½“ä½œç”¨åœ¨åˆ‡ç‰‡ä¸Šæ—¶, è¿”å›å€¼æ˜¯ä¸€ä¸ªå±•å¹³çš„é”®å’Œå€¼äº¤å‰ç€çš„å•ä¸ªåˆ—è¡¨ï¼š\nmy @tens = 0, 10, 20, 30; dd @tens[1]:kv; # (1, 10) dd @tens[0, 4, 2]:kv; # (0, 0, 2, 20) my %month = Jan =\u0026gt; 1, Feb =\u0026gt; 2, Mar =\u0026gt; 3; dd %month\u0026lt;Feb\u0026gt;:kv; # (\u0026#34;Feb\u0026#34;, 2) dd %month\u0026lt;Jan Foo Mar\u0026gt;:kv; # (\u0026#34;Jan\u0026#34;, 1, \u0026#34;Mar\u0026#34;, 3) å¦‚æœä½ ä¸æƒ³è·³è¿‡ä¸å­˜åœ¨çš„å…ƒç´ , ä½¿ç”¨å¦å®šå½¢å¼:\ndd %month\u0026lt;Jan Foo Mar\u0026gt;:!kv; # (\u0026#34;Jan\u0026#34;, 1, \u0026#34;Foo\u0026#34;, Any, \u0026#34;Mar\u0026#34;, 3) è¿™ä¸ªå‰¯è¯ä¸€èˆ¬ç”¨äºéå†åˆ‡ç‰‡ï¼š\nfor %month\u0026lt;Feb Mar\u0026gt;:kv -\u0026gt; $month, $i { say \u0026#34;$monthhad {Date.new(2015, $i, 1).days-in-month}days in 2015\u0026#34; } èƒ½å’Œ :exists è¿˜æœ‰ :delete ç»„åˆã€‚\nä¹Ÿå¯ä»¥æŸ¥çœ‹ kv å­ä¾‹ç¨‹.\n:k åªè¿”å›å…ƒç´ çš„ç´¢å¼•/é”®, è€Œä¸æ˜¯å®ƒä»¬çš„å€¼, å¹¶é»˜é»˜åœ°è·³è¿‡ä¸å­˜åœ¨çš„å…ƒç´ ï¼š\nmy @tens = 0, 10, 20, 30; dd @tens[1]:k; # 1 dd @tens[0, 4, 2]:k; # (0, 2) my %month = Jan =\u0026gt; 1, Feb =\u0026gt; 2, Mar =\u0026gt; 3; dd %month\u0026lt;Feb\u0026gt;:k; # \u0026#34;Feb\u0026#34; dd %month\u0026lt;Jan Foo Mar\u0026gt;:k; # (\u0026#34;Jan\u0026#34;, \u0026#34;Mar\u0026#34;) å¦‚æœä½ ä¸æƒ³è·³è¿‡ä¸å­˜åœ¨çš„å…ƒç´ , ä½¿ç”¨å¦å®šå½¢å¼:\ndd %month\u0026lt;Jan Foo Mar\u0026gt;:!k; # (\u0026#34;Jan\u0026#34;, \u0026#34;Foo\u0026#34;, \u0026#34;Mar\u0026#34;) è¿˜å¯ä»¥æŸ¥çœ‹ keys å­ä¾‹ç¨‹.\n:v è¿”å›å…ƒç´ çš„è£¸å€¼(ä¸æ˜¯æœ‰å¯èƒ½è¿”å›ä¸€ä¸ªå¯å˜å€¼å®¹å™¨), å¹¶é»˜é»˜è·³è¿‡ä¸å­˜åœ¨çš„å…ƒç´ ï¼š\nmy @tens = 0, 10, 20, 30; dd @tens[1]:v; # 10 dd @tens[0, 4, 2]:v; # (0, 20) @tens[3] = 31; # OK @tens[3]:v = 31; # ERROR, cannot assign to immutable integer value my %month = Jan =\u0026gt; 1, Feb =\u0026gt; 2, Mar =\u0026gt; 3; dd %month\u0026lt;Feb\u0026gt;:v; # 2 dd %month\u0026lt;Jan Foo Mar\u0026gt;:v; # (1, 3) å¦‚æœä½ ä¸æƒ³è·³è¿‡ä¸å­˜åœ¨çš„å…ƒç´ , ä½¿ç”¨å¦å®šå½¢å¼:\ndd %month\u0026lt;Jan Foo Mar\u0026gt;:!v; # (1, Any, 3) è¿˜å¯ä»¥æŸ¥çœ‹ values å­ä¾‹ç¨‹.\nCustom types è¿™é¡µæè¿°çš„ä¸‹æ ‡æ¥å£å¹¶ä¸æ„å‘³ç€å’Œ Raku çš„å†…ç½®é›†åˆç±»å‹ç›¸æ’æ–¥ - ä½ å¯ä»¥(å¹¶ä¸”åº”è¯¥)ä¸ºä»»ä½•æƒ³é€šè¿‡ç´¢å¼•æˆ–é”®æä¾›æ•°æ®è®¿é—®çš„è‡ªå®šä¹‰ç±»å‹é‡ç”¨å®ƒä»¬ã€‚\nä½ ä¸å¿…æ‰‹åŠ¨é‡è½½ postcircumfix [ ] \u0008å’Œ postcircumfix { } æ“ä½œç¬¦å¹¶é‡æ–°å®ç°å®ƒä»¬æ‰€æœ‰çš„æˆæ³•, ä¸ºäº†å®ç°å®ƒ, ç›¸å, ä½ å¯ä»¥ä¾èµ–è¿™ä¸ªäº‹å®, åœ¨å¹•å, å®ƒä»¬çš„æ ‡å‡†å®ç°åˆ†æ´¾ç»™äº†ä¸€ä¸ªå®šä¹‰è‰¯å¥½çš„åº•å±‚æ–¹æ³•é›†ã€‚ä¾‹å¦‚ï¼š\n   å½“ä½ è¿™æ ·å†™ è¿™ä¼šåœ¨å¹•åè°ƒç”¨å¦‚ä¸‹åº•å±‚æ–¹æ³•     %foo %foo.AT-KEY(\u0026ldquo;aa\u0026rdquo;)   %foo:delete %foo.DELETE-KEY(\u0026ldquo;aa\u0026rdquo;)   @foo[3,4,5] @foo.AT-POS(3), @foo.AT-POS(4), @foo.AT-POS(5)   @foo[*-1] @foo.AT-POS(@foo.elems - 1)    æ‰€ä»¥, ä¸ºäº†è®©ä½ çš„ä¸‹æ ‡å·¥ä½œ, ä½ åªéœ€è¦ä¸ºä½ çš„è‡ªå®šä¹‰ç±»å‹å®ç°æˆ–å§”æ‰˜é‚£äº›åº•å±‚æ–¹æ³•(ä¸‹é¢æè¿°è¯¦æƒ…)ã€‚\nå¦‚æœä½ è¿™æ ·åšäº†, ä½ è¿˜åº”è¯¥è®©ä½ çš„ç±»å‹å„è‡ªéµå®ˆ Positional æˆ– Associative role\nCustom type example è®¾æƒ³ä¸€ä¸‹ HTTP::Header ç±»å‹, å°½ç®¡å®ƒä½œä¸ºä¸€ä¸ªæœ‰ç‰¹å®šè¡Œä¸ºçš„è‡ªå®šä¹‰ç±», å´èƒ½åƒæ•£åˆ—é‚£æ ·ç´¢å¼•ï¼š\nmy $request = HTTP::Request.new(GET =\u0026gt; \u0026#34;raku.org\u0026#34;); say $request.header.WHAT; # (HTTP::Header) $request.header\u0026lt;Accept\u0026gt; = \u0026#34;text/plain\u0026#34;; $request.header{\u0026#39;Accept-\u0026#39; X~ \u0026lt;Charset Encoding Language\u0026gt;} = \u0026lt;utf-8 gzip en\u0026gt;; $request.header.push(\u0026#39;Accept-Language\u0026#39; =\u0026gt; \u0026#34;fr\u0026#34;); # like .push on a Hash say $request.header\u0026lt;Accept-Language\u0026gt;.perl; # [\u0026#34;en\u0026#34;, \u0026#34;fr\u0026#34;] my $rawheader = $request.header.Str; # stringify according to HTTP spec å®ç°è¿™ä¸ªç±»çš„æœ€ç®€å•çš„æ–¹æ³•æ˜¯, ç»™å®ƒä¸€ä¸ª Hash ç±»å‹çš„å±æ€§, å¹¶æŠŠæ‰€æœ‰çš„ä¸‹æ ‡å’Œè¿­ä»£ç›¸å…³åŠŸèƒ½æ€§å§”æ‰˜ç»™é‚£ä¸ªå±æ€§ã€‚(ä½¿ç”¨ä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹çº¦æŸæ¥ç¡®ä¿ä½¿ç”¨è€…ä¸ä¼šåœ¨é‡Œé¢æ’å…¥ä»»ä½•ä¸åˆæ³•çš„å€¼)ï¼š\nclass HTTP::Header does Associative is Iterable { subset StrOrArrayOfStr where Str | ( Array \u0026amp; {.all ~~ Str} ); has %!fields of StrOrArrayOfStr handles \u0026lt;AT-KEY EXISTS-KEY DELETE-KEY push iterator list kv keys values\u0026gt;; method Str { #`[not shown, for brevity] } } ç„¶è€Œ, HTTP header å­—æ®µåè¢«è®¤ä¸ºæ˜¯å¤§å°å†™æ— å…³çš„(æ›´åå¥½é©¼å³°æ³•)ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æŠŠ *-key å’Œ push æ–¹æ³•æ‹¿åˆ° handles åˆ—è¡¨çš„å¤–é¢æ¥å®¹çº³å®ƒ, å¹¶åƒè¿™æ ·å„è‡ªå®ç°å®ƒä»¬ï¼š\nmethod AT-KEY ($key) is rw { %!fields{normalize-key $key} } method EXISTS-KEY ($key) { %!fields{normalize-key $key}:exists } method DELETE-KEY ($key) { %!fields{normalize-key $key}:delete } method push (*@_) { #`[not shown, for brevity] } sub normalize-key ($key) { $key.subst(/\\w+/, *.tc, :g) } æ³¨æ„ä¸‹æ ‡ %!fields è¿”å›ä¸€ä¸ªé€‚å½“çš„ rw å®¹å™¨, è€Œæˆ‘ä»¬çš„ AT-KEY èƒ½å¤Ÿç®€å•åœ°ä¼ é€’ã€‚\nç„¶è€Œ, æˆ‘ä»¬å¯èƒ½å€¾å‘äºå°‘ä¸€ç‚¹å¯¹ç”¨æˆ·è¾“å…¥çš„é™åˆ¶, ç›¸åæˆ‘ä»¬è‡ªå·±å…³å¿ƒå­—æ®µå€¼çš„æ¶ˆæ¯’ã€‚é‚£ç§æƒ…å†µä¸‹, æˆ‘ä»¬å¯ä»¥ç§»é™¤ %!fields ä¸Šçš„ StrOrArrayOfStr ç±»å‹çº¦æŸ, å¹¶åœ¨èµ‹å€¼æ—¶ä½¿ç”¨è¿”å›è‡ªå®šä¹‰çš„å…³å¿ƒæ¶ˆæ¯’å€¼çš„ Proxy å®¹å™¨æ¥æ›¿æ¢æˆ‘ä»¬çš„ AT-KEY å®ç°ï¼š\nmulti method AT-KEY (::?CLASS:D: $key) is rw { my $element := %!fields{normalize-key $key}; Proxy.new( FETCH =\u0026gt; method () { $element }, STORE =\u0026gt; method ($value) { $element = do given $valueÂ».split(/\u0026#39;,\u0026#39;\\s+/).flat { when 1 { .[0] } # a single value is stored as a string default { .Array } # multiple values are stored as an array } } ); } æ³¨æ„æŠŠæ–¹æ³•å£°æ˜ä¸º multi å¹¶æŠŠå®ƒé™åˆ¶ä¸º :D (defined invocants) ç¡®ä¿æœªå®šä¹‰æƒ…å†µè¢«ä¼ é€’ç»™ç”± Any æä¾›çš„é»˜è®¤å®ç°ã€‚\nMethods to implement for positional subscripting ä¸ºäº†é€šè¿‡ postcircumfix [ ] è®©åŸºäºç´¢å¼•çš„ä¸‹æ ‡åœ¨ä½ çš„è‡ªå®šä¹‰ç±»å‹ä¸­å·¥ä½œ, ä½ åº”è¯¥è‡³å°‘å®ç°ä¸‹é¢çš„ elems, AT-POS å’Œ EXISTS-POS- è¿˜æœ‰å…¶å®ƒå¯é€‰é¡¹ã€‚\nelems æ–¹æ³• multi method elems (::?CLASS:D:) é¢„æœŸè¿”å›ä¸€ä¸ªæ•°å­—, ç”¨äºè¡¨æ˜å¯¹è±¡ä¸­æœ‰å¤šå°‘ä¸ªå¯æ ‡æ³¨çš„å…ƒç´ ã€‚å¯èƒ½è¢«ç”¨æˆ·ç›´æ¥è°ƒç”¨, å¹¶ä¸”å½“ä»æœ«å°¾ç´¢å¼•å…ƒç´ çš„æ—¶å€™, è¿˜ä¼šè¢« postcircumfix [ ] è°ƒç”¨, å°±åƒ @foo[*-1] ä¸­é‚£æ ·ã€‚\nå¦‚æœæ²¡æœ‰å®ç°è¿™ä¸ªæ–¹æ³•, ä½ çš„ç±»å‹ä¼šä» Any ç»§æ‰¿é»˜è®¤çš„å®ç°, å¯¹å®šä¹‰è¿‡çš„è°ƒç”¨è€…è¿™æ€»æ˜¯è¿”å› 1 - è¿™æœ€ä¸å¯èƒ½æ˜¯ä½ æƒ³è¦çš„ã€‚æ‰€ä»¥, å¦‚æœä¸èƒ½ä»ä½ çš„ä½ç½®ç±»å‹çŸ¥æ™“å…ƒç´ çš„ä¸ªæ•°, é‚£å°±æ·»åŠ ä¸€ä¸ª fails æˆ– dies å®ç°, ä»¥é¿å…æ²‰é»˜åœ°åšäº†é”™äº‹ã€‚\nAT-POS æ–¹æ³• multi method AT-POS (::?CLASS:D: $index) æœŸæœ›è¿”å› $index ä½ç½®å¤„çš„å…ƒç´ ã€‚è¿™å°±æ˜¯ postcircumfix [ ] é€šå¸¸è°ƒç”¨çš„æ–¹æ³•ã€‚ å¦‚æœä½ æƒ³è®©å…ƒç´ å¯å˜(åƒå®ƒä»¬ç”¨äº Array ç±»å‹é‚£æ ·), ä½ å°±å¿…é¡»ç¡®ä¿ä»¥ item å®¹å™¨çš„å½¢å¼è¿”å›å®ƒ, å¹¶åœ¨è¢«èµ‹å€¼æ—¶æ›´æ–°å®ƒã€‚(è®°å¾—ä½¿ç”¨ return-rw æˆ– rw å­ä¾‹ç¨‹ trait ä»¥ä½¿å®ƒå·¥ä½œã€‚)\nEXISTS-POS æ–¹æ³• multi method EXISTS-POS (::?CLASS:D: $index) è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ä»¥è¡¨æ˜åœ¨ $index ä½ç½®å¤„æ˜¯å¦æœ‰å…ƒç´ ã€‚è¿™å°±æ˜¯å¼•ç”¨ @foo[42]:exists æ—¶, postcircumfix [ ] æ‰€è°ƒç”¨çš„æ–¹æ³•ã€‚\nå…ƒç´ \u0026quot;å­˜åœ¨\u0026quot;æ„å‘³ç€ä»€ä¹ˆ, å–å†³äºä½ çš„ç±»å‹ã€‚\nå¦‚æœä½ æ²¡æœ‰å®ç°å®ƒ, ä½ çš„ç±»å‹ä¼šä» Any é‚£å„¿ç»§æ‰¿é»˜è®¤çš„å®ç°, å¯¹äºç´¢å¼• 0 å®ƒä¼šè¿”å› True, å¯¹äº å…¶å®ƒç´¢å¼•å®ƒä¼šè¿”å› false - è¿™å¯èƒ½ä¸æ˜¯ä½ æƒ³è¦çš„ã€‚æ‰€ä»¥å¦‚æœä½ çš„ç±»å‹ä¸èƒ½åšå…ƒç´ å­˜åœ¨æ£€æµ‹, é‚£å°±æ·»åŠ ä¸€ä¸ª fails æˆ– die å®ç°, ä»¥é¿å…é™é»˜åœ°åšé”™äº‹æƒ…ã€‚\nDELETE-POS æ–¹æ³• multi method DELETE-POS (::?CLASS:D: $index) åˆ é™¤ $index å¤„çš„å…ƒç´ , å¹¶è¿”å›å®ƒæ‰€åˆ é™¤çš„è¿™ä¸ªå…ƒç´ ã€‚è¿™å°±æ˜¯å¼•ç”¨ @foo[42]:delete æ—¶, postcircumfix [ ] æ‰€è°ƒç”¨çš„æ–¹æ³•ã€‚\n\u0026ldquo;åˆ é™¤\u0026quot;å…ƒç´ çš„æ„æ€æ˜¯ä»€ä¹ˆ, å–å†³äºä½ çš„ç±»å‹ã€‚\nå®ç°è¿™ä¸ªæ–¹æ³•æ˜¯å¯é€‰çš„; å¦‚æœä½ æ²¡æœ‰å®ç°å®ƒ, é‚£ä¹ˆç”¨æˆ·å°è¯•ä»è¿™ç§ç±»å‹çš„å¯¹è±¡ä¸­åˆ é™¤å…ƒç´ ä¼šå¾—åˆ°ä¸€ä¸ªåˆé€‚çš„é”™è¯¯ä¿¡æ¯ã€‚\nASSIGN-POS æ–¹æ³• multi method ASSIGN-POS (::?CLASS:D: $index, $new) æŠŠ $index ä½ç½®å¤„çš„å…ƒç´ è®¾ç½®ä¸º $new å€¼ã€‚å®ç°è¿™ä¸ªæ–¹æ³•å®Œå…¨æ˜¯å¯é€‰çš„; å¦‚æœä½ æ²¡æœ‰å®ç°è¿™ä¸ªæ–¹æ³•, é‚£ä¹ˆä¼šä½¿ç”¨ self.AT-POS($index) = $new ä»£æ›¿, å¦‚æœä½ ç¡®å®å®ç°äº†è¯¥æ–¹æ³•, é‚£ä¹ˆç¡®ä¿å®ƒæ‹¥æœ‰ç›¸åŒçš„æ•ˆæœã€‚\nè¿™æ„å‘³ç€ opt-in æ€§èƒ½ä¼˜åŒ–, ä»¥è‡³äºç®€å•çš„è¯¸å¦‚ @numbers[5] = \u0026quot;five\u0026quot; çš„èµ‹å€¼èƒ½åœ¨ä¸è°ƒç”¨ AT-POS(è¿™å¿…é¡»åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªæ½œåœ¨çš„æ˜‚è´µçš„å®¹å™¨å¯¹è±¡) æ–¹æ³•æ—¶æ“ä½œã€‚\næ³¨æ„, å®ç° ASSIGN-POS ä¸èƒ½è§£é™¤è®© AT-POS å˜æˆä¸€ä¸ª rw æ–¹æ³•, å› ä¸ºè¯¸å¦‚ @numbers[5]++ çš„ä¸å¤ªé‡è¦çš„èµ‹å€¼/ä¿®æ”¹ä»æ—§ä¼šä½¿ç”¨ AT-POSã€‚\nBIND-POS æ–¹æ³• multi method BIND-POS (::?CLASS:D: $index, \\new) æŠŠå€¼æˆ–å®¹å™¨ new ç»‘å®šç»™ä½ç½® $index å¤„çš„æ’æ§½ä¸Š, æ›¿æ¢é‚£å„¿èƒ½æ‰¾åˆ°çš„ä»»ä½•å®¹å™¨ã€‚è¿™æ˜¯å½“ä½ è¿™æ ·å†™çš„æ—¶å€™æ‰€è°ƒç”¨çš„ä¸œè¥¿:\nmy $x = 10; @numbers[5] := $x; ä¸€èˆ¬çš„æ•°ç»„ç±»æ”¯æŒè¿™ä»¥å…è®¸åˆ›å»ºå¤æ‚çš„é“¾æ¥æ•°æ®ç»“æ„, ä½†æ˜¯å¯¹äºæ›´ç‰¹å®šé¢†åŸŸç±»å‹å®ƒå¯èƒ½æ²¡æœ‰æ„ä¹‰, æ‰€ä»¥ä¸å¼ºæ±‚å»å®ç°å®ƒã€‚å¦‚æœä½ æ²¡æœ‰å®ç°è¯¥æ–¹æ³•, ç”¨æˆ·ä¼šè·å¾—ä¸€ä¸ªåˆé€‚çš„é”™è¯¯ä¿¡æ¯, å½“å®ƒä»¬å°è¯•ç»‘å®šåˆ°è¿™ç§ç±»å‹çš„å¯¹è±¡çš„ä¸€ä¸ªä½ç½®æ’æ§½ä¸Šæ—¶ã€‚\nMethods to implement for associative subscripting ä¸ºäº†é€šè¿‡ postcircumfix { } è®©åŸºäºé”®çš„ä¸‹æ ‡èƒ½å¤Ÿå·¥ä½œäºä½ çš„è‡ªå®šä¹‰ç±»å‹ä¸­, ä½ åº”è¯¥è‡³å°‘å®ç° AT-KEY å’Œ EXISTS-KEY - è¿˜æœ‰å¯é€‰åœ°å®ç°ä¸‹é¢çš„æ–¹æ³•ã€‚\nAT-KEY æ–¹æ³• multi method AT-KEY (::?CLASS:D: $key) è¿”å›å’Œ $key ç›¸å…³è”çš„å…ƒç´ ã€‚è¿™æ­£æ˜¯ postcircumfix { } é€šå¸¸æ‰€è°ƒç”¨çš„æ–¹æ³•ã€‚\nå¦‚æœä½ æƒ³è®©å…ƒç´ å¯å˜(å°±åƒå®ƒä»¬æ˜¯ä¸ºäº†å†…ç½®çš„ Hash ç±»å‹), ä½ å¿…é¡»ç¡®ä¿ä»¥ item å®¹å™¨çš„å½¢å¼è¿”å›å®ƒ, å¹¶åœ¨è¢«èµ‹å€¼æ—¶æ›´æ–°å®ƒã€‚(è®°å¾—ä½¿ç”¨ return-rw æˆ– is rw å­ä¾‹ç¨‹ trait ä»¥ä½¿å…¶æœ‰æ•ˆ; æŸ¥çœ‹ä¾‹å­ã€‚)\nå¦ä¸€æ–¹é¢, å¦‚æœä½ æƒ³è®©ä½ çš„é›†åˆåªè¯», è¯·ç›´æ¥è¿”å›éå®¹å™¨å€¼ã€‚\nEXISTS-KEY æ–¹æ³• multi method EXISTS-KEY (::?CLASS:D: $key) è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ä»¥è¡¨æ˜å’Œ $key ç›¸å…³è”çš„å…ƒç´ æ˜¯å¦å­˜åœ¨ã€‚è¿™å°±æ˜¯å¼•ç”¨ %foo\u0026lt;aa\u0026gt;:exists æ—¶, postcircumfix { } æ‰€è°ƒç”¨çš„æ–¹æ³•ã€‚\nå…ƒç´ \u0026quot;å­˜åœ¨\u0026quot;æ„å‘³ç€ä»€ä¹ˆ, å–å†³äºä½ çš„ç±»å‹ã€‚\nå¦‚æœä½ æ²¡æœ‰å®ç°å®ƒ, ä½ çš„ç±»å‹ä¼šä» Any é‚£å„¿ç»§æ‰¿é»˜è®¤çš„å®ç°, è¿™é€šå¸¸è¿”å› False - è¿™å¯èƒ½ä¸æ˜¯ä½ æƒ³è¦çš„ã€‚æ‰€ä»¥å¦‚æœä½ çš„ç±»å‹ä¸èƒ½åšå…ƒç´ å­˜åœ¨æ£€æµ‹, é‚£å°±æ·»åŠ ä¸€ä¸ª fails æˆ– die å®ç°, ä»¥é¿å…é™é»˜åœ°åšé”™äº‹æƒ…\nDELETE-KEY æ–¹æ³• multi method DELETE-KEY (::?CLASS:D: $key) åˆ é™¤å’Œ $key ç›¸å…³è”çš„å…ƒç´ , å¹¶è¿”å›å®ƒæ‰€åˆ é™¤çš„è¿™ä¸ªå…ƒç´ ã€‚è¿™å°±æ˜¯å¼•ç”¨ %foo\u0026lt;aa\u0026gt;:delete æ—¶, postcircumfix { } æ‰€è°ƒç”¨çš„æ–¹æ³•ã€‚\n\u0026ldquo;åˆ é™¤\u0026quot;å…ƒç´ çš„æ„æ€æ˜¯ä»€ä¹ˆ, å–å†³äºä½ çš„ç±»å‹ - å°½ç®¡å®ƒé€šå¸¸è®© EXISTS-KEY å› ä¸ºé‚£ä¸ªé”®å˜ä¸º Falseã€‚\nå®ç°è¿™ä¸ªæ–¹æ³•æ˜¯å¯é€‰çš„; å¦‚æœä½ æ²¡æœ‰å®ç°å®ƒ, é‚£ä¹ˆç”¨æˆ·å°è¯•ä»è¿™ç§ç±»å‹çš„å¯¹è±¡ä¸­åˆ é™¤å…ƒç´ ä¼šå¾—åˆ°ä¸€ä¸ªåˆé€‚çš„é”™è¯¯ä¿¡æ¯ã€‚\nASSIGN-KEY æ–¹æ³• multi method ASSIGN-KEY (::?CLASS:D: $key, $new) æŠŠå’Œ $key ç›¸å…³è”çš„å…ƒç´ è®¾ç½®ä¸º $new å€¼ã€‚å®ç°è¿™ä¸ªæ–¹æ³•å®Œå…¨æ˜¯å¯é€‰çš„; å¦‚æœä½ æ²¡æœ‰å®ç°è¿™ä¸ªæ–¹æ³•, é‚£ä¹ˆä¼šä½¿ç”¨ self.AT-KEY($key) = $new ä»£æ›¿, å¦‚æœä½ ç¡®å®å®ç°äº†è¯¥æ–¹æ³•, é‚£ä¹ˆç¡®ä¿å®ƒæ‹¥æœ‰ç›¸åŒçš„æ•ˆæœã€‚\nè¿™æ„å‘³ç€ opt-in æ€§èƒ½ä¼˜åŒ–, ä»¥è‡³äºç®€å•çš„è¯¸å¦‚ %age\u0026lt;Claire\u0026gt; = 29 çš„èµ‹å€¼èƒ½åœ¨ä¸è°ƒç”¨ AT-KEY(è¿™å¿…é¡»åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªæ½œåœ¨çš„æ˜‚è´µçš„å®¹å™¨å¯¹è±¡) æ–¹æ³•æ—¶æ“ä½œã€‚\næ³¨æ„, å®ç° ASSIGN-KEY ä¸èƒ½è§£é™¤è®© AT-KEY å˜æˆä¸€ä¸ª rw æ–¹æ³•, å› ä¸ºè¯¸å¦‚ %age\u0026lt;Claire\u0026gt;++ çš„ä¸å¤ªé‡è¦çš„èµ‹å€¼/ä¿®æ”¹ ä»æ—§ä¼šä½¿ç”¨ AT-KEYã€‚\nBIND-KEY æ–¹æ³• multi method BIND-KEY (::?CLASS:D: $key, \\new) æŠŠå€¼æˆ–å®¹å™¨ new ç»‘å®šç»™è·Ÿ $key ç›¸å…³è”çš„æ’æ§½ä¸Š, æ›¿æ¢é‚£å„¿èƒ½æ‰¾åˆ°çš„ä»»ä½•å®¹å™¨ã€‚è¿™æ˜¯å½“ä½ è¿™æ ·å†™çš„æ—¶å€™æ‰€è°ƒç”¨çš„ä¸œè¥¿:\nmy $x = 10; %age\u0026lt;Claire\u0026gt; := $x; ä¸€èˆ¬çš„æ•£åˆ—ç±»æ”¯æŒè¿™ä»¥å…è®¸åˆ›å»ºå¤æ‚çš„é“¾æ¥æ•°æ®ç»“æ„, ä½†æ˜¯å¯¹äºæ›´ç‰¹å®šé¢†åŸŸç±»å‹å®ƒå¯èƒ½æ²¡æœ‰æ„ä¹‰, æ‰€ä»¥ä¸å¼ºæ±‚å»å®ç°å®ƒã€‚å¦‚æœä½ æ²¡æœ‰å®ç°è¯¥æ–¹æ³•, ç”¨æˆ·ä¼šè·å¾—ä¸€ä¸ªåˆé€‚çš„é”™è¯¯ä¿¡æ¯, å½“å®ƒä»¬å°è¯•ç»‘å®šåˆ°è¿™ç§ç±»å‹çš„å¯¹è±¡çš„ä¸€ä¸ªä½ç½®æ’æ§½ä¸Šæ—¶ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2016-06-01-accessing-data-structure-elements-by-index-or-key/","tags":["subscripts"],"title":"Raku ä¸­çš„ Subscripts"},{"categories":["rakulang"],"contents":"é—®é¢˜æè¿° å°è©¹å¦®æ‹¿ç€ 5 ç¾å…ƒå»è¶…å¸‚ä¹°ä¸œè¥¿, ä¸ºæ–°æ¬æ¥çš„é‚»å±…ä¹°æ°´æœç¯®ç¤¼ç‰©ã€‚å› ä¸ºå¥¹æ˜¯ä¸ªå‹¤å¥‹å¹¶ç¼ºä¹æƒ³è±¡åŠ›çš„å­©çº¸, å¥¹æ‰“ç®—æ­£å¥½èŠ± 5 ç¾å…ƒ, ä¸å¤šä¹Ÿä¸å°‘ã€‚\näº‹å®ä¸Šè¶…å¸‚é‡Œæ°´æœçš„ä»·æ ¼å¹¶éæ•´æ•°, æ­£å¥½èŠ±å…‰ 5 ç¾å…ƒå¹¶ä¸å®¹æ˜“ã€‚ - ä½†æ˜¯è©¹å¦®å·²ç»å‡†å¤‡å¥½äº†ã€‚å¥¹ä»èƒŒåŒ…é‡Œæ‹¿å‡ºä¸Šç½‘æœ¬, è¾“å…¥å¥¹çœ‹åˆ°è¿‡çš„æ°´æœçš„å•ä»·, å¹¶ä¸”å¼€å¯äº†ä¸€ä¸ªç¨‹åºä¸ºå¥¹æ”¶é›† â€” å°±æ˜¯è¿™æ ·, 5 ç¾å…ƒèƒ½ä¹°çš„æ°´æœçš„ç»„åˆå°±å‡ºç°åœ¨å±å¹•ä¸Šã€‚\næŒ‘æˆ˜: ç”¨ä½ é€‰æ‹©çš„è¯­è¨€å±•ç¤ºè©¹å¦®çš„ç¨‹åºæ˜¯ä»€ä¹ˆæ ·å­ã€‚\n ç›®æ ‡å°±æ˜¯ 500 ç¾åˆ† (ç­‰äº 5 ç¾å…ƒ) è§£å†³æ–¹æ³•å¯ä»¥åŒ…å«å¤šç§åŒç±»å‹çš„æ°´æœ - å‡è®¾å®ƒä»¬æ•°é‡æ²¡æœ‰é™åˆ¶ è§£å†³æ–¹æ³•æ²¡æœ‰å¿…è¦åŒ…å«æ‰€æœ‰æ°´æœç±»å‹ å¯¹ç»™å®šçš„è¾“å…¥æ£€æµ‹æ‰€æœ‰å¯èƒ½çš„æ–¹æ³•  è¾“å…¥æè¿° æ¯è¡Œä¸€ç§æ°´æœ â€” è§„å®šäº†æ°´æœçš„åå­—(ä¸å«ç©ºæ ¼çš„å•è¯)å’Œæ°´æœçš„å•ä»·(å•ä½ä¸ºç¾åˆ†, æ•´æ•°)\nè¾“å‡ºæè¿° æ¯ä¸ªè§£å†³æ–¹æ³•ä¸€è¡Œ â€” ç”¨ä»¥é€—å·åˆ†å‰²çš„æ•°é‡+åå­—å¯¹å„¿, æè¿°äº†é‚£ç§ç±»å‹è¦ä¹°çš„æ°´æœæ•°ã€‚\nä¸è¦åˆ—å‡ºæ•°é‡ä¸º 0 çš„æ°´æœã€‚å¦‚æœä¸ºå¤æ•°å°±ç»™åå­—åŠ  sã€‚\nè¾“å…¥æ ·æœ¬ banana 32 kiwi 41 mango 97 papaya 254 pineapple 399 è¾“å‡ºæ ·æœ¬ 6 kiwis, 1 papaya 7 bananas, 2 kiwis, 2 mangos æœ‰æŒ‘æˆ˜çš„è¾“å…¥ apple 59 banana 32 coconut 155 grapefruit 128 jackfruit 1100 kiwi 41 lemon 70 mango 97 orange 73 papaya 254 pear 37 pineapple 399 watermelon 500 æ³¨æ„, è¿™ç§è¾“å…¥æœ‰ 180 ç§è§£å†³æ–¹æ³•ã€‚\nmy (@names, @prices) := ($_Â»[0], $_Â»[1]Â».Int given linesÂ».words); for find-coefficients(500, @prices) -\u0026gt; @quantities { say (@names Z @quantities) .map(-\u0026gt; [$name, $qty] { \u0026#34;$qty$name\u0026#34;~(\u0026#34;s\u0026#34; if $qty \u0026gt; 1) if $qty }) .join(\u0026#34;, \u0026#34;); } sub find-coefficients ($goal, @terms) { gather { my @coefficients; loop (my $i = 0; $i \u0026lt; @terms; @coefficients[$i]++) { given [+](@coefficients Z* @terms) \u0026lt;=\u0026gt; $goal { when Less { $i = 0 } when More { @coefficients[$i] = 0; $i++ } when Same { take @coefficients.values } } } } } åœ¨å¾ªç¯çš„æ¯ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œæ•°ç»„ @coefficients è¢«\u0026quot;å¢ä¸€\u0026quot;ï¼Œå°±åƒå®ƒçš„å…ƒç´ æ˜¯ä¸€ä¸ªæ•°å­—çš„ä½æ•°ä¸€æ · - ä½†ä¸æ˜¯ä¸€ä¸ªæœ‰å›ºå®šåŸºæ•°çš„æ•°å­—ï¼šç›¸åï¼Œåªè¦è¶…è¿‡äº†æœç´¢æ¡ä»¶ï¼ˆsum \u0026gt; goalï¼‰ï¼Œå®ƒå°±ä¼šæº¢å‡º\u0026quot;æ•°å­—\u0026quot;ã€‚\nåŒæ ·çš„äº‹æƒ…ä¹Ÿå¯ä»¥ç”¨é€’å½’çš„æ–¹å¼æ›´ä¼˜é›…åœ°å®Œæˆã€‚å¯¹äºé‚£äº›ä¸å–œæ¬¢å¤©çœŸçš„æš´åŠ›è§£å†³æ–¹æ³•çš„äººæ¥è¯´ï¼Œè¿™ä¸ªæŒ‘æˆ˜ä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªå°è¯•ä¸€äº›åŠ¨æ€ç¼–ç¨‹æŠ€æœ¯çš„å¥½æœºä¼šã€‚\nmy @fruits = linesÂ».split(\u0026#34;\u0026#34;).sort(-*[1]); my @names = @fruitsÂ»[0]; my @prices = @fruitsÂ»[1]Â».Int; for find-coefficients(500, @prices) -\u0026gt; @quantities { say (@names Z @quantities) .map(-\u0026gt; [$name, $qty] { \u0026#34;$qty$name\u0026#34;~(\u0026#34;s\u0026#34; if $qty \u0026gt; 1) if $qty }) .join(\u0026#34;, \u0026#34;); } sub find-coefficients ($goal, @terms) { gather { my @initial = 0 xx @terms; my %partials = (0 =\u0026gt; [@initial,]); my @todo = (@initial,); my %seen-partials := SetHash.new; my %seen-solutions := SetHash.new; while @todo { my @current := @todo.shift; my $sum = [+] @current Z* @terms; next if $sum \u0026gt; $goal; %partials{$sum}.push: @current; # Find solutions by adding known partials to the current partial for %partials{$goal - $sum}[*] -\u0026gt; @known { .take if !%seen-solutions{~$_}++ given list @current Z+ @known; } # Schedule additional iterations if $sum \u0026lt;= $goal div 2 { for @terms.keys { my @next = @current; @next[$_]++; @todo.push: @next if !%seen-partials{~@next}++; } } } } } æ³¨æ„:\n å¯¹äºæŒ‘æˆ˜çš„è¾“å…¥(è§£ç©ºé—´=1,127,153,664)ï¼Œå®ƒåªéœ€è¦ 4296 æ¬¡è¿­ä»£ï¼Œè€Œæ¯æ¬¡è¿­ä»£éƒ½è¦èŠ±è´¹å‡ æ¬¡å“ˆå¸ŒæŸ¥è¯¢ã€‚  ","permalink":"https://ohmyweekly.github.io/notes/2016-04-12-janes-fruit/","tags":["gather"],"title":"ä¹°æ°´æœ"},{"categories":["rakulang"],"contents":"åˆ—è¡¨è§£æ åˆ—è¡¨è§£æå³ List Comprehensionsã€‚\nç”Ÿæˆ 1x1, 2x2, 3x3, ..., 10x10 çš„åˆ—è¡¨ï¼š\n($_**2 for 1..10); for è¯­å¥å‰é¢è¿˜å¯ä»¥æ·»åŠ  if ä¿®é¥°ç¬¦ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä»…ç­›é€‰å‡ºå¶æ•°çš„å¹³æ–¹ï¼š\n($_**2 if !($_ % 2) for 1..10); ($_**2 if $_ % 2 == 1 for 1..10) # åŒä¸Š ç»„åˆå¤šä¸ª if æ¡ä»¶:\nmy @list = ($_ if $_ %2 == 1 \u0026amp;\u0026amp; $_ \u0026gt; 2 for 1..6 ); # [3 5]  è¿˜å¯ä»¥ç”Ÿæˆå…¨æ’åˆ—ï¼š\n($_ for \u0026#34;ABC\u0026#34;.comb X~ \u0026#34;XYZ\u0026#34;.comb); # (\u0026#34;AX\u0026#34;, \u0026#34;AY\u0026#34;, \u0026#34;AZ\u0026#34;, \u0026#34;BX\u0026#34;, \u0026#34;BY\u0026#34;, \u0026#34;BZ\u0026#34;, \u0026#34;CX\u0026#34;, \u0026#34;CY\u0026#34;, \u0026#34;CZ\u0026#34;) my @a = (1,3,4); my @b = (2,4,6); my @list = (@a X @b); # è¿™å„¿ä¹Ÿå¯ä»¥ç”¨åœ†æ‹¬å·, ä¹Ÿå¯ä»¥ä¸ç”¨ # [(1 2) (1 4) (1 6) (3 2) (3 4) (3 6) (4 2) (4 4) (4 6)] \u0026gt; ($_ when /7$/ for 1..99) (7 17 27 37 47 57 67 77 87 97) å¤§å°å†™è½¬æ¢ï¼š\nmy @a = \u0026lt;Hello World IBM Apple\u0026gt;; (.lc for @a); # hello world ibm apple åˆ é™¤å­—ç¬¦ä¸²æœ«å°¾çš„ç©ºç™½ï¼š\nmy @freshfruit = \u0026#39;banana\u0026#39;, \u0026#39;loganberry \u0026#39;, \u0026#39;passion fruit \u0026#39;; (.trim for @freshfruit); # \u0026#34;banana\u0026#34; \u0026#34;loganberry\u0026#34; \u0026#34;passion fruit\u0026#34; å‘é‡è¿ç®—ï¼š\nmy @vec = 2,4,6; (3*$_ for @vec); # 6 12 18 (3*$_ if $_ \u0026gt; 3 for @vec); # 12 18 (3*$_ if $_ \u0026lt; 2 for @vec); # () åµŒå¥—æ•°ç»„ï¼š\nmy @vec = 2,4,6; ([$_, $_**2].perl for @vec); # [2, 4] [4, 16] [6, 36] ([$_, $_**2].WHAT for @vec); # (Array) (Array) (Array) å¤šä¸ªåˆ—è¡¨ä¹‹é—´çš„åˆ—è¡¨è§£æ:\nmy @vec1 = 2,4,6; my @vec2 = 4,3,-9; ($_ for @vec1 X* @vec2); # 8 6 -18 16 12 -36 24 18 -54 ($_ for @vec1 X+ @vec2); # 5 -7 8 7 -5 10 9 -3 ($_ for @vec1 Z* @vec2); # 8 12 -54 ($_ for @vec1 \u0026gt;\u0026gt;*\u0026lt;\u0026lt; @vec2); # 8 12 -54 ä½¿ç”¨åˆ—è¡¨è§£æå¤„ç†çŸ©é˜µ:\n\u0026gt; my @a = ([1,2,3], [4,5,6], [7,8,9]); \u0026gt; @a[0] # 1 2 3 \u0026gt; @a[0][1] # 2 \u0026gt; @a[0][2] # 3 \u0026gt; ($_[1] for @a) # 2 5 8 \u0026gt; ($_[2] for @a) # 3 6 9 \u0026gt; ($_[2]-1 for @a) # 2 5 8 \u0026gt; (@a[$_][$_] for 0..2) # 1 5 9 çŸ©é˜µè½¬ç½®:\nsub transpose (@m) { @m[0].keys.map: {[ @mÂ»[$_] ]}; } my @a = [\u0026lt;a b c d e \u0026gt;], [\u0026lt;f g h i j \u0026gt;], [\u0026lt;k l m n o \u0026gt;], [\u0026lt;p q r s t \u0026gt;]; (.say for @a.\u0026amp;transpose); a f k p b g l q c h m r d i n s e j o t ä¸€ä¸¢ä¸¢è§£é‡Šï¼š@m[0].keys è·å– column index, æ ¹æ®è·å–åˆ°çš„åˆ—ç´¢å¼•, ä½¿ç”¨è¶…è¿ç®—ç¬¦ Â» éå†æ•°ç»„ä¸­å¯¹åº”åˆ—ç´¢å¼•ä½ç½®çš„å…ƒç´ ã€‚æ³¨æ„ [] å®é™…ä¸Šæ˜¯åç¼€æ“ä½œç¬¦, åŸæ¥ä½¿ç”¨ Â».[] çš„è¯­æ³•æ˜¯é”™è¯¯çš„ã€‚\nä½¿ç”¨ gather è¿›è¡Œåˆ—è¡¨è§£æï¼š\nmy @s = gather { for ^100 { take 2 * $_ if $_ ** 2 \u0026gt; 3 } }; # 1åˆ°20ä¹‹é—´å“ªäº›æ•°å­—ç»„æˆç›´è§’ï¼Ÿ my $n = 20; my @a = gather for 1..$n -\u0026gt; $x { for $x..$n -\u0026gt; $y { for $y..$n -\u0026gt; $z { take $x,$y,$z if $x*$x + $y*$y == $z*$z; } } }; say \u0026#34;@a[]\u0026#34;; # 3 4 5 5 12 13 6 8 10 8 15 17 9 12 15 12 16 20Â  ","permalink":"https://ohmyweekly.github.io/notes/2016-05-11-list-comprehensions/","tags":["List Comprehensions"],"title":"åˆ—è¡¨è§£æ"},{"categories":["rakulang"],"contents":"Raku ä¸­çš„åŠ¨æ€å˜é‡\n$*ARGFILES  $*ARGFILES Magic command-line input handle.\n argfiles.raku\n$*ARGFILES.raku.say; # IO::Handle.new(:path(Any),:chomp) # æŒ‰è¡Œè¯»å– for $*ARGFILES.lines -\u0026gt; $line { say \u0026#34;$line\u0026#34;; } # ä¸€æ¬¡æ€§è¯»å– # say $*ARGFILES.slurp; USAGE\n$ raku argfiles.raku file1 file2 file3 ...  class IO::Handle - Raku Documentation Input/Output - Raku Documentation Rakuæ–‡ä»¶æ“ä½œ - Qiita  @*ARGS  @*ARGS - Arguments from the command line. å‘½ä»¤è¡Œä¸­çš„å‚æ•°ã€‚\n agrs.raku\nsay @*ARGS.WAHT; # (Array) say @*ARGS; # [a b c d e] say @*ARGS.raku; # [\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;, \u0026#34;d\u0026#34;, \u0026#34;e\u0026#34;] USAGE\n$ raku args.raku a b c d e  class Array - Raku Documentation  $*IN  $*IN - æ ‡å‡†è¾“å…¥æ–‡ä»¶å¥æŸ„, ç­‰åŒäº stdin\n in.raku\nsay $*IN.raku; # IO::Handle.new(:path(IO::Special.new(what \u0026#34;\u0026lt;STDIN\u0026gt;\u0026#34;)),:chomp) say $*IN.path; # IO::Special.new(what \u0026#34;\u0026lt;STDIN\u0026gt;\u0026#34;) say $*IN.chomp; # True for $*IN.lines -\u0026gt; $line { say \u0026#34;$line\u0026#34;; } USAGE\n$ raku in.raku äººåŠ› ... $ cat somefile.txt | raku in.raku $*OUT  $*OUT - æ ‡å‡†è¾“å‡ºæ–‡ä»¶å¥æŸ„, ç­‰åŒäº stdout\n out.raku\nsay $*OUT.raku; # IO::Handle.new(:path(IO::Special.new(what \u0026#34;\u0026lt;STDOUT\u0026gt;\u0026#34;)),:chomp) say $*OUT.path; # IO::Special.new(what \u0026#34;\u0026lt;STDOUT\u0026gt;\u0026#34;) say $*OUT.chomp; # True $*OUT.say( q:to/æ–°å¹´å¿«ä¹/ ); ç¥ä½ æ–°å¹´å¿«ä¹ 2016.01.23 è®©æˆ‘å†è¯´ä¸€æ¬¡ æ–°å¹´å¿«ä¹ # é€šå¸¸æˆ‘ä»¬ä¼šåœ¨æ‰“å°æ—¶çœç•¥ $*OUT # say \u0026#34;å“ˆåˆ©è·¯äºš\u0026#34;; æœ€åä¸€æ®µä»£ç ä¸­ // ä¸­é—´çš„å­—ç¬¦æ˜¯åˆ†å‰²ç¬¦ã€‚è¿™æ‰“å°å‡º:\nç¥ä½ æ–°å¹´å¿«ä¹ 2016.01.23 è®©æˆ‘å†è¯´ä¸€æ¬¡ USAGE\n$ raku out.raku $ raku out.raku \u0026gt; result.txt  role IO - Raku Documentation  $*ERR  $*ERR - æ ‡å‡†é”™è¯¯æ–‡ä»¶å¥æŸ„, ç­‰åŒäº stderr\n err.raku\nsay $*ERR.raku; # IO::Handle.new(:path(IO::Special.new(what \u0026#34;\u0026lt;STDERR\u0026gt;\u0026#34;)),:chomp) say $*ERR.path; # IO::Special.new(what \u0026#34;\u0026lt;STDERR\u0026gt;\u0026#34;) say $*ERR.chomp; # True $*ERR.say(\u0026#34;æˆ‘é”™äº†\u0026#34;); # å¹³æ—¶å¯ä»¥ä½¿ç”¨ note # note \u0026#34;å‰æ–¹é«˜èƒ½é¢„è­¦\u0026#34;; USAGE\n$ raku err.raku \u0026gt; /dev/null æˆ‘é”™äº† $*REPO  $*REPO A variable holding information about modules installed/loaded\n repo.raku\nsay $*REPO; say $*REPO.raku; say $*REPO.id; say $*REPO.path-spec; say $*REPO.loaded; say $*REPO.repo-chain; $*TZ  $*TZ The system\u0026rsquo;s local timezone.\n tz.raku\nsay $*TZ; # 32400 say $*TZ.raku; # 32400 say $*TZ.WHAT; # (Int) $*CWD  $*CWD The Current Working Directory.\n cwd.raku\nsay $*CWD; # \u0026#34;/Users/kujira\u0026#34;.IO say $*CWD.path; # /Users/kujira say $*CWD.raku; # \u0026#34;/Users/kujira\u0026#34;.IO(:SPEC(IO::Spec::Unix),:CWD(\u0026#34;/Users/kujira\u0026#34;)) $*KERNEL  $*KERNEL Which kernel am I compiled for?\n kernel.raku\nsay $*KERNEL; # darwin (15.2.0) say $*KERNEL.release; # Darwin Kernel Version 15.2.0: Fri Nov 13 19:56:56 PST 2015; root:xnu-3248.20.55~2/RELEASE_X86_64 say $*KERNEL.name; # darwin say $*KERNEL.auth; # unknown say $*KERNEL.version; # v15.2.0 say $*KERNEL.signature; # (Blob) say $*KERNEL.desc; # (Str) say $*KERNEL.raku; # Kernel.new(release Str, name \u0026#34;darwin\u0026#34;, auth \u0026#34;unknown\u0026#34;, version Version.new(\u0026#39;15.2.0\u0026#39;), signature Blob, desc Str) say $*KERNEL.WHAT; # (Kernel) $*DISTRO  $*DISTRO Which OS distribution am I compiling under?\n distro.raku\nsay $*DISTRO; # macosx (10.11.2) say $*DISTRO.name; # macosx say $*DISTRO.is-win; # False say $*DISTRO.version; # v11.4 say $*DISTRO.path-sep; # : say $*DISTRO.auth; # Apple Computer, Inc. say $*DISTRO.desc; # unknown say $*DISTRO.release; # 20F71 say $*DISTRO.signature; # (Blob) say $*DISTRO.gist; # macosx (11.4) say $*DISTRO.Str; # macosx say $*DISTRO.raku; # Distro.new(release \u0026#34;20F71\u0026#34;, path-sep \u0026#34;:\u0026#34;, name \u0026#34;macos\u0026#34;, auth \u0026#34;Apple Inc.\u0026#34;, version v11.4, signature Blob, desc \u0026#34;unknown\u0026#34;)  Raku ã§ windows ã‹ã©ã†ã‹åˆ¤å®šã—ãŸã„ - tokuhirom\u0026rsquo;s blog DISTRO.t  $*VM  $*VM Which virtual machine am I compiling under?\n vm.raku\nsay $*VM; # moar (2021.06) say $*VM.config; say $*VM.raku; $*RAKU  $*RAKU Which Raku am I compiled for?\n perl.raku\nsay $*RAKU; # Raku (6.d) say $*RAKU.compiler; # rakudo (2021.06) say $*RAKU.raku; # Raku.new(compiler Compiler.new(id \u0026#34;24F69C23F0D9F44910DEB9B097353B0DD30C7E96\u0026#34;, release \u0026#34;\u0026#34;, codename \u0026#34;\u0026#34;, name \u0026#34;rakudo\u0026#34;, auth \u0026#34;The Perl Foundation\u0026#34;, version v2021.06, signature Blob, desc Str), name \u0026#34;Raku\u0026#34;, auth \u0026#34;The Perl Foundation\u0026#34;, version v6.d, signature Blob, desc Str) $*PID  $*PID Process ID of the current process.\n pid.raku\nsay $*PID; # 35480 say $*PID.raku; # 35480 say $*PID.WHAT; # (Int) $*PROGRAM-NAME  $*PROGRAM-NAME Path to the current executable as it was entered on the command line, or C\u0026lt;-e\u0026gt; if perl was invoked with the -e flag.\n program-name.raku\nsay $*PROGRAM-NAME; say $*PROGRAM-NAME.raku; say $*PROGRAM-NAME.IO.basename; $*PROGRAM  $*PROGRAM Location (in the form of an CIO::PathÂ object) of the Perl program being executed.\n program.raku\nsay $*PROGRAM; # \u0026#34;/Users/kujira/program.raku\u0026#34;.IO say $*PROGRAM.Str; # program.raku say $*PROGRAM.raku; # \u0026#34;program.raku\u0026#34;.IO(:SPEC(IO::Spec::Unix),:CWD(\u0026#34;/Users/kujira\u0026#34;)) say $*PROGRAM.SPEC; # (Unix) say $*PROGRAM.CWD; # /Users/kujira say $*PROGRAM.WHAT; # (Path) $*EXECUTABLE  $*EXECUTABLE Absolute path of the perl executable that is currently running.\n executable.raku\nsay $*EXECUTABLE; # \u0026#34;/usr/local/bin/raku\u0026#34;.IO say $*EXECUTABLE.Str; # /usr/local/bin/raku say $*EXECUTABLE.basename; # raku say $*EXECUTABLE.WHAT; # (Path) say $*EXECUTABLE.raku; # \u0026#34;/usr/local/bin/raku\u0026#34;.IO(:SPEC(IO::Spec::Unix)) say $*EXECUTABLE.SPEC; # (Unix) $*EXECUTABLE-NAME  $*EXECUTABLE-NAME The name of the perl executable that is currently running. (e.g. raku-p, raku-m, Niecza.exe) Favor $*EXECUTABLE because it is not guaranteed that the perl executable is in PATH.\n executable-name.raku\nsay $*EXECUTABLE-NAME; # raku say $*EXECUTABLE-NAME.WHAT; # (Str) $*USER  $*USER The user that is running the program. It is an object that evaluates to \u0026ldquo;username (uid)\u0026rdquo;. It will evaluate to the username only if treated as a string and the numeric user id if treated as a number.\n user.raku\nsay $*USER; # kujira (801) say +$*USER; # 801 say ~$*USER; # kujira say $*USER.raku; # IdName.new $*GROUP  $*GROUP The primary group of the user who is running the program. It is an object that evaluates to \u0026ldquo;groupname (gid)\u0026rdquo;. It will evaluate to the groupname only if treated as a string and the numeric group id if treated as a number.\n group.raku\nsay $*GROUP; # whale (0) say ~$*GROUP; # whale say +$*GROUP; # 0 say $*GROUP.raku; # IdName.new $*HOME  $*HOME An LIO::PathÂ object representing the \u0026ldquo;home directory\u0026rdquo; of the user that is running the program. If the \u0026ldquo;home directory\u0026rdquo; cannot be determined it will be L\n home.raku\nsay $*HOME; # \u0026#34;/Users/kujira\u0026#34;.IO say $*HOME.CWD; # /Users/kujira say $*HOME.SPEC; # (Unix) say $*HOME.WHAT; # (Path) say $*HOME.raku; # \u0026#34;/Users/kujira\u0026#34;.IO(:SPEC(IO::Spec::Unix),:CWD(\u0026#34;/Users/kujira\u0026#34;))  class IO::Path - Raku Documentation  $*SPEC  $*SPEC The appropriate IO::SpecÂ sub-class for the platform that the program is running on.\n spec.raku\nsay $*SPEC; # (Unix) say $*SPEC.raku; # IO::Spec::Unix say $*SPEC.path; # (/usr/local/Cellar/rakudo-star/2015.12/share/raku/site/bin /usr/local/sbin /usr/local/bin /usr/bin /bin /usr/sbin /sbin) say $*SPEC.tmpdir; # \u0026#34;/var/folders/9v/wr31l2zj78x1nw58jgljq_9w0000gn/T\u0026#34;.IO say $*SPEC.dir-sep; # / say $*SPEC.curdir; # . say $*SPEC.updir; # .. say $*SPEC.curupdir; # none(., ..) say $*SPEC.rootdir; # / say $*SPEC.devnull; # /dev/null  class IO::Spec - Raku Documentation class IO::Spec::QNX - Raku Documentation class IO::Spec::Unix - Raku Documentation class IO::Spec::Win32 - Raku Documentation class IO::Spec::Cygwin - Raku Documentation  http://qiita.com/B73W56H84/items/18053bf37de8bb2bb808#%E5%8F%82%E8%80%83%E3%81%A8%E6%B3%A8%E9%87%88\n","permalink":"https://ohmyweekly.github.io/notes/2016-02-29-dynamic-variables-in-raku/","tags":["dynamic variable"],"title":"Raku ä¸­çš„åŠ¨æ€å˜é‡"},{"categories":["rakulang"],"contents":"åŒ¿å å­ä¾‹ç¨‹ã€æ–¹æ³•æˆ–å­æ–¹æ³•ï¼Œå½“å®ƒä»¬ä¸èƒ½é€šè¿‡åå­—è°ƒç”¨æ—¶ï¼Œå°±è¢«ç§°ä¸ºåŒ¿åçš„\n# named subroutine sub double($x) { 2 * $x }; # åŒ¿åå­ä¾‹ç¨‹,å­˜å‚¨åœ¨ä¸€ä¸ªå…·åçš„æ ‡é‡é‡Œ my $double = sub ($x) { 2 * $x }; æ³¨æ„ï¼ŒåŒ¿åå­ä¾‹ç¨‹ä»ç„¶å¯ä»¥æœ‰åå­—\n# ä½¿ç”¨ anon å…³é”®å­—ä½¿å­ä¾‹ç¨‹åŒ¿å my $s = anon sub triple($x) { 3 * $x } say $s.name; # triple å‰¯è¯ é€šå¸¸, å‰¯è¯æ˜¯å‡½æ•°çš„å‘½åå‚æ•°. ä¹Ÿæœ‰ä¸€äº›å…¶å®ƒç‰¹æ®Šè¯­æ³•å½¢å¼å…è®¸å‰¯è¯å‡ºç°åœ¨æŸäº›åˆé€‚çš„åœ°æ–¹:\nq:w\u0026#34;foo bar # \u0026#34;:w\u0026#34; is a Quotelike form modifier adverb m:g/a|b|c/ # \u0026#34;:g\u0026#34; is also 4 +\u0026gt; 5 :rotate # \u0026#34;:rotate\u0026#34; is an operator adverb @h{3}:exists # \u0026#34;:exists\u0026#34; is also, but is known as a subscript adverb å‰¯è¯é€šå¸¸ä½¿ç”¨å†’å·å¯¹å„¿æ ‡è®°æ¥è¡¨ç¤º, å› ä¸ºè¿™ä¸ªåŸå› , å†’å·å¯¹å„¿æ ‡è®°æ³•ä¹Ÿä»¥å‰¯è¯å¯¹å„¿å½¢å¼è‘—ç§°:\n:a(4) # Same as \u0026#34;a\u0026#34; =\u0026gt; 4 Autothreading Autothreading æ˜¯è¿™æ ·çš„: å¦‚æœä½ ä¼ é€’ä¸€ä¸ª junction ç»™å­ä¾‹ç¨‹, è¯¥å­ä¾‹ç¨‹æœŸæœ›çš„å‚æ•°ç±»å‹ä¸º Any æˆ–å®ƒçš„å­ç±»å‹ã€‚é‚£ä¹ˆè¿™ä¸ªå­ä¾‹ç¨‹è°ƒç”¨ä¼šè¢«æ‰§è¡Œå¤šæ¬¡, æ¯æ¬¡ä½¿ç”¨ä¸€ä¸ªä¸åŒçš„ junction çŠ¶æ€. è¿™äº›è°ƒç”¨çš„ç»“æœè¢«ç»„åˆæˆä¸€ä¸ªè·ŸåŸ junction åŒç±»å‹çš„ junctionã€‚\nsub f($x) { 2 * $x }; if f(1|2|3) == 4 { say \u0026#39;success\u0026#39;; } è¿™é‡Œ f() æ˜¯å«æœ‰ä¸€ä¸ªå‚æ•°çš„å­ä¾‹ç¨‹ï¼Œç„¶è€Œå› ä¸ºå®ƒæ²¡æœ‰æ˜¾å¼çš„ç±»å‹å£°æ˜ï¼Œå®ƒå°±è¢«éšå¼çš„å£°æ˜ä¸º Any å‹ã€‚ Junction å‚æ•°ä½¿ f(1|2|3) è°ƒç”¨åœ¨å†…éƒ¨ä½œä¸º f(1)|f(2)|f(3) æ‰§è¡Œ, è€Œç»“æœæ˜¯è·ŸåŸ junction åŒç±»å‹çš„ junction, å³ 2|4|6ã€‚è¿™ç§æŠŠä¸€ä¸ª Junction åˆ†æˆå¯¹å¤šæ¬¡å‡½æ•°è°ƒç”¨çš„å¤„ç†å°±å«åš autothreadingã€‚\nColon Pair å’Œ Colon List å†’å·å¯¹å„¿æ˜¯ç”¨äºåˆ›å»ºæˆ– Pair å¯¹è±¡çš„ä¾¿æ·è¯­æ³•. ä¸¤ç§æœ€å¸¸è§çš„å½¢å¼æ˜¯:\n:a(4) # Same as \u0026#34;a\u0026#34; =\u0026gt; 4, same as Pair.new(:key\u0026lt;a\u0026gt;,:value(5)) :a\u0026lt;4\u0026gt; # Same as \u0026#34;a\u0026#34; =\u0026gt; \u0026#34;4\u0026#34;, same as Pair.new(:key\u0026lt;a\u0026gt;,:value\u0026lt;5\u0026gt;) è¿™ä¹Ÿæ˜¯äººä»¬ç†ŸçŸ¥çš„å‰¯è¯å¯¹å„¿å½¢å¼ã€‚æ³¨æ„, å½“å†’å·åé¢æ‹¬å·å‰é¢çš„éƒ¨åˆ†ä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„æ ‡è¯†ç¬¦çš„æ—¶å€™, ä¼šåº”ç”¨å…¶å®ƒè¯­ä¹‰, ä¸æ˜¯æ‰€æœ‰çš„å‰¯è¯å¯¹å„¿éƒ½åˆ›å»º Pair å¯¹è±¡ã€‚ å¦å¤–ä¸¤ä¸ªå¸¸è§çš„å½¢å¼æ˜¯:\n:a # Same as :a(True) :!a # Same as :a(False) ä¸€ä¸ª colon åˆ—è¡¨æ˜¯ä¸€ä¸ªä»…åŒ…å«å†’å·å¯¹å„¿çš„åˆ—è¡¨, ä¸éœ€è¦é€—å·, ç”šè‡³ä¸éœ€è¦ç©ºæ ¼:\n:a(4):c:!d:c # Same as a =\u0026gt; 4, c =\u0026gt; True, d =\u0026gt; False, c =\u0026gt; True Constraint çº¦æŸæ˜¯ç»™å‚æ•°æˆ– subset ç±»å‹æ·»åŠ çš„é™åˆ¶ã€‚é€šè¿‡å•è¯ where å¼•å…¥çº¦æŸ. åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­, çº¦æŸç”¨äºç¡®ä¿, å½“è°ƒç”¨ä¸€ä¸ªåä¸º abbreviate çš„å­ä¾‹ç¨‹, å…¶å‚æ•°ä¸ºä¸€ä¸ªé•¿åº¦å°äº 10 ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²æ—¶,ä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯:\nsub abbreviate (Str $thing where { .chars \u0026gt;= 10 }) { ... } ä¸Šä¾‹ä¸­çš„ Str ä¹Ÿæ˜¯ä¸€ä¸ªçº¦æŸ, ä½†æ˜¯ç»å¸¸ä½œä¸º\u0026quot;ç±»å‹çº¦æŸ\u0026quot;.\nInstance ç±»çš„å®ä¾‹åœ¨å…¶å®ƒç¼–ç¨‹è¯­è¨€ä¸­ä¹Ÿå«å¯¹è±¡. å¯¹è±¡å­˜å‚¨å±æ€§, é€šå¸¸æ˜¯ new æ–¹æ³•è°ƒç”¨çš„è¿”å›å€¼, æˆ–è€…æ˜¯å¯¹è±¡å­—é¢é‡. å¤§éƒ¨åˆ†ç±»å‹çš„å®ä¾‹è¢«å®šä¹‰ä¸º True, ä¾‹å¦‚ defined($instance) ä¸º Trueã€‚\nmy Str $str = \u0026#34;hello\u0026#34;; ## è¿™ä½¿ç”¨å†…å»ºç±»å‹,ä¾‹å¦‚ Str if defined($str) { say \u0026#34;Oh, yeah. I\u0026#39;m defined.\u0026#34;; } else { say \u0026#34;No. Something off? \u0026#34;; } ## if you wanted objects... class A { # nothing here for now. } my $an_instance = A.new; say $an_instance.defined.perl;# defined($an_instance) works too. ç±»æ‹¥æœ‰æ–¹æ³•å’Œå±æ€§çš„æ‰€æœ‰è“å›¾, è€Œç±»çš„å®ä¾‹æŠŠè“å›¾å¸¦åˆ°çœŸå®ä¸–ç•Œä¸­ã€‚\nInvocant åœ¨ Raku ä¸­è°ƒç”¨æ–¹æ³•çš„å¯¹è±¡å«åšè°ƒç”¨è€…. åœ¨æ–¹æ³•ä¸­å®ƒå°±æ˜¯ self å¼•ç”¨çš„ä¸œè¥¿.\nsay \u0026#39;str\u0026#39;.uc; # \u0026#39;str\u0026#39; æ˜¯ æ–¹æ³• uc çš„è°ƒç”¨è€… Literal å­—é¢é‡æ˜¯ä¸€å—ç›´æ¥ä»£è¡¨å¯¹è±¡çš„ä»£ç , é€šå¸¸æŒ‡å‘å¯¹è±¡è‡ªèº«.\nmy $x = 2; # the 2 is a literal say $x; # $x is not a literal, but a variable lvalue lvalue æˆ–è€…å·¦å€¼æ˜¯èƒ½å‡ºç°åœ¨èµ‹å€¼æ“ä½œç¬¦å·¦ä¾§çš„ä»»ä½•ä¸œè¥¿; å…¸å‹çš„å·¦å€¼æœ‰å˜é‡, ç§æœ‰å±æ€§å’Œ is rw å±æ€§, å˜é‡åˆ—è¡¨å’Œå·¦å€¼å­ä¾‹ç¨‹ã€‚\nå·¦å€¼çš„ä¾‹å­:\n   Declaration lvalue Comments     my $x; $x    my ($a, $b); ($a, $b)    has $!attribute; $!attribute Only inside classes   has $.attrib is rw; $.attrib    sub a is rw { $x }; a()     ä¸æ˜¯å·¦å€¼çš„ä¾‹å­:\n3 # literals constant x = 3; # constants has $.attrib; # attributes; you can only assign to $!attrib sub f { }; f(); # \u0026#34;normal\u0026#34; subs are not writable sub f($x) { $x = 3 }; # error - parameters are read-only by default Mainline mainline æ˜¯ç¨‹åºä¸­ä¸å±äºä»»ä½• block çš„ç¨‹åºæ–‡æœ¬.\nsub f { # not in mainline, in sub f } f(); # in mainline again Slurpy å­ä¾‹ç¨‹æˆ–æ–¹æ³•ä¸­çš„å½¢å‚å¦‚æœèƒ½æ¥æ”¶ä»»æ„æ•°é‡çš„å‚æ•°, é‚£è¿™ä¸ªå½¢å‚å°±ä¼šè¢«è®¤ä¸ºæ˜¯ slurpy çš„ã€‚å®ƒç”±å‚æ•°åå­—å‰é¢çš„æ˜Ÿå·æ ‡å‡ºã€‚\nsub sum (*@numbers) { return [+] @numbers; } Type Object ç±»å‹å¯¹è±¡æ˜¯ä¸€ä¸ªä»£è¡¨ç±» /role/package/grammar/enum çš„å¯¹è±¡ã€‚å®ƒé€šå¸¸å’Œç±»å‹åç›¸åŒã€‚\nclass A { }; say A; # A is the type object my $x = A.new(); # same here my $x = class { method greet() { say \u0026#34;hi\u0026#34;; } } # $x now holds a type object returned from the # anonymous class definition ","permalink":"https://ohmyweekly.github.io/notes/2016-03-26-terms-in-raku/","tags":["term"],"title":"Raku ä¸­çš„æœ¯è¯­"},{"categories":["rakulang"],"contents":"ç­¾åä¹Ÿæ˜¯å¯¹è±¡ class Signature {} ç­¾åæ˜¯ä»£ç å¯¹è±¡å‚æ•°åˆ—è¡¨çš„é™æ€æè¿°ã€‚å³, ç­¾åæè¿°äº†ä½ éœ€è¦ä»€ä¹ˆå‚æ•°å’Œå¤šå°‘å‚æ•°ä¼ é€’ç»™ä»£ç æˆ–å‡½æ•°ä»¥è°ƒç”¨å®ƒä»¬ã€‚\nä¼ é€’å‚æ•°ç»™ç­¾åæŠŠåŒ…å«åœ¨ Capture ä¸­çš„å‚æ•°ç»‘å®šåˆ°äº†ç­¾åä¸Šã€‚\n\u0026gt; sub a($a, $b) {}; \u0026gt; \u0026amp;a.signature.perl.say :($a, $b) \u0026gt; my $b = -\u0026gt; $a, $b {}; \u0026gt; $b.signature.perl.say :($a, $b) ç­¾åæ˜¯ä¸€ä¸ªå¯¹è±¡, å°±åƒ Raku ä¸­çš„ä»»ä½•å…¶å®ƒä¸œè¥¿ä¸€æ ·ã€‚ ä»»ä½• Callable ç±»å‹ä¸­éƒ½æœ‰ç­¾å, å¹¶ä¸”å®ƒèƒ½ä½¿ç”¨ .signature æ–¹æ³•è·å–åˆ°ã€‚\nclass Signature { ... } ç­¾åå­—é¢é‡ ç­¾åå‡ºç°åœ¨å­ä¾‹ç¨‹å’Œæ–¹æ³•ååé¢çš„åœ†æ‹¬å·ä¸­, å¯¹äº blocks ç­¾åå‡ºç°åœ¨ -\u0026gt; æˆ– \u0026lt;-\u0026gt; ç®­å¤´åé¢, æˆ–è€…ä½œä¸ºå˜é‡å£°æ˜ç¬¦(ä¾‹å¦‚ my )çš„è¾“å…¥, æˆ–è€…ä»¥å†’å·å¼€å¤´ä½œä¸ºå•ç‹¬çš„é¡¹ã€‚\nsub f($x) { } # ^^^^ sub f çš„ç­¾å method x() { } # ^^ æ–¹æ³• x çš„ç­¾å my $s = sub (*@a) { } # ^^^^^ åŒ¿åå‡½æ•°çš„ç­¾å for \u0026lt;a b c\u0026gt; -\u0026gt; $x { } # ^^ Block çš„ç­¾å my ($a, @b) = 5, (6,7,8); # ^^^^^^^^ å˜é‡å£°æ˜ç¬¦çš„ç­¾å my $sig = :($a, $b); # ^^^^^^^^ ç‹¬ç«‹çš„ç­¾åå¯¹è±¡ ç­¾åå­—é¢é‡å¯ä»¥ç”¨äºå®šä¹‰å›è°ƒæˆ–é—­åŒ…çš„ç­¾åã€‚\nsub f(\u0026amp;c:(Int)) {} sub will-work(Int) {} sub won\u0026#39;t-work(Str){} f(\u0026amp;will-work); f(\u0026amp;won\u0026#39;t-work); CATCH { default { put .^name, \u0026#39;: \u0026#39;, .Str } }; # OUTPUT: Â«X::TypeCheck::Binding::Parameter: Constraint type check failed in binding to parameter \u0026#39;\u0026amp;c\u0026#39;â¤Â» f(-\u0026gt; Int { \u0026#39;this works too\u0026#39; } ); æ”¯æŒç­¾åå’Œåˆ—è¡¨(List)é—´çš„æ™ºèƒ½åŒ¹é…ã€‚\nmy $sig = :(Int $i, Str $s); say (10, \u0026#39;answer\u0026#39;) ~~ $sig; # OUTPUT: Â«Trueâ¤Â»  my $sub = sub ( Str $s, Int $i ) { return $s xx $i }; say $sub.signature ~~ :( Str, Int ); # OUTPUT: Â«Trueâ¤Â»  given $sig { when :(Str, Int) { say \u0026#39;mismatch\u0026#39; } when :($, $) { say \u0026#39;match\u0026#39; } default { say \u0026#39;no match\u0026#39; } } # OUTPUT: Â«matchâ¤Â»  å®ƒåŒ¹é…ç¬¬äºŒä¸ª when ä»å¥, å› ä¸º :($, $) è¡¨ç¤ºå¸¦æœ‰ä¸¤ä¸ªæ ‡é‡, åŒ¿åå‚æ•°çš„ Signature, å®ƒæ˜¯ $sig çš„æ›´ä¸€ç‰ˆç‰ˆæœ¬ã€‚\nå½“å’Œæ•£åˆ—æ™ºèƒ½åŒ¹é…æ—¶, ç­¾åè¢«è®¤ä¸ºç”±æ•£åˆ—çš„é”®ç»„æˆã€‚\nmy %h = left =\u0026gt; 1, right =\u0026gt; 2; say %h ~~ :(:$left, :$right); # OUTPUT # True å‚æ•°åˆ†éš”ç¬¦ ç­¾åç”±é€—å·åˆ†å‰²çš„ 0 ä¸ªæˆ–å¤šä¸ªå½¢å¼å‚æ•°ç»„æˆã€‚\nmy $sig = :($a, @b, %c) sub add ($a, $b) { $a + $b } ä½œä¸ºä¸€ä¸ªä¾‹å¤–, ç­¾åä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„åé¢å¯ä»¥è·Ÿç€ä¸€ä¸ªå†’å·è€Œéé€—å·æ¥æ ‡è®°æ–¹æ³•çš„è°ƒç”¨è€…ã€‚è°ƒç”¨è€…æ˜¯ç”¨æ¥è°ƒç”¨æ–¹æ³•çš„å¯¹è±¡, å…¶é€šå¸¸ç»‘å®šåˆ° selfã€‚ é€šè¿‡åœ¨ç­¾åä¸­æŒ‡å®šè°ƒç”¨è€…, ä½ å¯ä»¥æ›´æ”¹å®ƒç»‘å®šåˆ°çš„å˜é‡åç§°ã€‚\nmethod ($a: @b, %c){} # ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è°ƒç”¨è€… class Foo { method whoami ($me:) { \u0026#34;Well I\u0026#39;m class $me.^name(), of course!\u0026#34; } } say Foo.whoami; # Well I\u0026#39;m class Foo, of course! ç±»å‹çº¦æŸ å‚æ•°å¯ä»¥å¯é€‰åœ°æ‹¥æœ‰ä¸€ä¸ªç±»å‹çº¦æŸ(é»˜è®¤ä¸º Any)ã€‚è¿™äº›èƒ½ç”¨äºé™åˆ¶å‡½æ•°å…è®¸çš„è¾“å…¥ã€‚\nmy $sig = :(Int $a, Str $b) sub divisors (Int $n) { $_ if $n %% $_ for 1..$n } divisors 2.5; # !!! Calling \u0026#39;divisors\u0026#39; will never work with argument types (Rat) # ===SORRY!=== Error while compiling:  # Calling divisors(Rat) will never work with declared signature (Int $n)  åŒ¿åå‚æ•°ä¹Ÿè¡Œ, å¦‚æœå‚æ•°åªéœ€è¦å®ƒçš„ç±»å‹çº¦æŸçš„è¯ã€‚\nmy $sig = :($, @, %a) # ä¸¤ä¸ªåŒ¿åå‚æ•°å’Œä¸€ä¸ª \u0026#34;æ­£å¸¸çš„(æœ‰åå­—çš„)\u0026#34;å‚æ•° $sig = :(Int, Positional) # åªæœ‰ç±»å‹ä¹Ÿè¡Œ(ä¸¤ä¸ªå‚æ•°) sub baz (Str) {\u0026#34;Got passed a Str\u0026#34;} ç±»å‹çº¦æŸä¹Ÿå¯ä»¥æ˜¯ç±»å‹æ•è·(type captures)ã€‚\né™¤äº†è¿™äº›åä¹‰ä¸Šçš„ç±»å‹ä¹‹å¤–, é¢å¤–çš„çº¦æŸå¯ä»¥ä»¥ä»£ç å—çš„å½¢å¼åŠ åˆ°å‚æ•°ä¸Š, ä»£ç å—å¿…é¡»è¿”å›ä¸€ä¸ªçœŸå€¼ä»¥é€šè¿‡ç±»å‹æ£€æµ‹ã€‚\nsub f(Real $x where { $x \u0026gt; 0 }, Real $y where { $y \u0026gt;= $x }) { } where å­å¥ä¸­çš„ä»£ç æœ‰ä¸€äº›é™åˆ¶ï¼šä»»ä½•ä¼šäº§ç”Ÿå‰¯ä½œç”¨çš„ä¸œè¥¿ï¼ˆä¾‹å¦‚, æ‰“å°è¾“å‡º, ä»è¿­ä»£å™¨ä¸­æ‹‰å–æˆ–é€’å¢çŠ¶æ€å˜é‡ï¼‰éƒ½ä¸å—æ”¯æŒ, å¦‚æœä½¿ç”¨äº†, å¯èƒ½ä¼šäº§ç”Ÿä»¤äººæƒŠè®¶çš„ç»“æœã€‚æ­¤å¤–, åœ¨æŸäº›å®ç°ä¸­, where å­å¥çš„ä»£ç å¯èƒ½ä¼šé’ˆå¯¹å•ä¸ªç±»å‹æ£€æŸ¥è¿è¡Œå¤šæ¬¡ã€‚\nwhere å­å¥ä¸éœ€è¦æ˜¯ä»£ç å—, where å­å¥å³ä¾§çš„ä»»ä½•å†…å®¹éƒ½å°†ç”¨äºå’Œå‚æ•°æ™ºèƒ½åŒ¹é…ã€‚æ‰€ä»¥ä½ ä¹Ÿå¯ä»¥å†™ï¼š\nmulti factorial(Int $ where 0) { 1 } multi factorial(Int $x) { $x * factorial($x - 1) } ç¬¬ä¸€ä¸ªè¿˜èƒ½ç®€åŒ–ä¸º:\nmulti factorial(0) { 1 } ä½ å¯ä»¥ç›´æ¥æŠŠå­—é¢é‡ç”¨ä½œç±»å‹å¹¶æŠŠå€¼çº¦æŸåˆ°åŒ¿åå‚æ•°ä¸Šã€‚\næç¤ºï¼šæ³¨æ„ä¸è¦åœ¨ä½ æœ‰å‡ ä¸ªæ¡ä»¶æ—¶ä¸å°å¿ƒç¦»å¼€åŒºå—ï¼š\n-\u0026gt; $y where .so \u0026amp;\u0026amp; .name {}( sub one {} ); # WRONG!!  -\u0026gt; $y where { .so \u0026amp;\u0026amp; .name } {}( sub two {} ); # OK!  -\u0026gt; $y where .so \u0026amp; .name.so {}( sub three {} ); # Also good  ç¬¬ä¸€ä¸ªç‰ˆæœ¬æ˜¯é”™è¯¯çš„, ä¼šå‘å‡ºä¸€ä¸ªå…³äº sub å¯¹è±¡å¼ºåˆ¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²çš„è­¦å‘Šã€‚åŸå› æ˜¯è¡¨è¾¾å¼ç›¸å½“äº ($y ~~ ($y.so \u0026amp;\u0026amp; $y.name)); é‚£å°±æ˜¯â€œè°ƒç”¨ .so, å¦‚æœå®ƒä¸º True, è°ƒç”¨ .name; å¦‚æœè¿™ä¹Ÿæ˜¯ True, åˆ™ä½¿ç”¨å®ƒçš„å€¼è¿›è¡Œsmartmatching \u0026hellip;â€ã€‚è¿™æ˜¯ (.so \u0026amp;\u0026amp; .name) çš„ç»“æœå°†è¢«æ™ºèƒ½åŒ¹é…, ä½†æˆ‘ä»¬è¦æ£€æŸ¥ .so å’Œ .name æ˜¯å¦ä¸ºçœŸå€¼ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ˜ç¡®çš„ Block æˆ–è€… Junction æ˜¯æ­£ç¡®çš„ç‰ˆæœ¬ã€‚\nåœ¨ç­¾åä¸­ä¸æ˜¯å­ç­¾å(sub-signature)çš„ä¸€éƒ¨åˆ†çš„æ‰€æœ‰å…ˆå‰çš„å‚æ•°éƒ½å¯ä»¥åœ¨å‚æ•°åé¢çš„ where ä»å¥ä¸­è®¿é—®ã€‚ å› æ­¤, æœ€åä¸€ä¸ªå‚æ•°çš„ where ä»å¥å¯ä»¥è®¿é—®ä¸æ˜¯å­ç­¾åä¸€éƒ¨åˆ†çš„ç­¾åçš„æ‰€æœ‰å‚æ•°ã€‚ å¯¹äºå­ç­¾å, æŠŠ where ä»å¥æ”¾åœ¨å­ç­¾åä¸­ã€‚\nsub foo($a, $b where * == $a ** 2) { say \u0026#34;$bis a square of $a\u0026#34; } foo 2, 4; # OUTPUT: Â«4 is a square of 2â¤Â»Â»  # foo 2, 3;  # OUTPUT: Â«Constraint type check failed in binding to parameter \u0026#39;$b\u0026#39;â€¦Â»  sub one-of-them(:$a, :$b, :$c where { $a.defined ^^ $b.defined ^^ $c.defined }) { $a // $b // $c }; say one-of-them(c=\u0026gt;42); # OUTPUTÂ«42â¤Â» çº¦æŸå¯é€‰å‚æ•° å¯é€‰å‚æ•°ä¹Ÿå¯ä»¥æ‹¥æœ‰çº¦æŸã€‚ä»»ä½•å‚æ•° where ä»å¥éƒ½å°†è¢«æ‰§è¡Œ, å³ä½¿å®ƒæ˜¯å¯é€‰çš„, è€Œä¸”ä¸æ˜¯ç”±è°ƒç”¨è€…æä¾›ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹, æ‚¨å¯èƒ½å¿…é¡»é˜²æ­¢ where ä»å¥ä¸­çš„æœªå®šä¹‰å€¼ã€‚\nsub f(Int $a, UInt $i? where { !$i.defined or $i \u0026gt; 5 } ) { ... } çº¦æŸåå™¬å‚æ•° åå™¬å‚æ•°ä¸èƒ½æ‹¥æœ‰ç±»å‹çº¦æŸã€‚ä¸€ä¸ª where ä»å¥è¿åŒä¸€ä¸ª Junctionå¯ä»¥è¾¾åˆ°åŒæ ·çš„é‚£ä¸ªæ•ˆæœã€‚\nsub f(*@a where { $_.all ~~ Int }) { say @a }; f(42); f(\u0026lt;a\u0026gt;); # OUTPUTÂ«[42] Constraint type check failed for parameter \u0026#39;@a\u0026#39; in sub f at ...Â» çº¦æŸå®šä¹‰å€¼å’Œæœªå®šä¹‰å€¼ é€šå¸¸, ç±»å‹çº¦æŸåªæ£€æŸ¥ä¼ é€’çš„å€¼æ˜¯å¦æ˜¯æ­£ç¡®çš„ç±»å‹ã€‚\nsub limit-lines (Str $s, Int $limit) { my @lines = $s.lines; @lines[0 ..^ min @lines.elems, $limit].join(\u0026#34;\\n\u0026#34;) } say (limit-lines \u0026#34;a \\n b \\n c \\n d \\n\u0026#34;, 3).perl; # \u0026#34;a \\n b \\n c \u0026#34; say limit-lines Str, 3; # Uh-oh. Dies with \u0026#34;Cannot call \u0026#39;lines\u0026#39;;\u0026#34; CATCH { default { put .^name, \u0026#39;: \u0026#39;, .Str } }; # OUTPUT: Â«X::Multi::NoMatch: Cannot resolve caller lines(Str: ); none of these signatures match: # (Cool:D $: |c is raw) # (Str:D $: :$count!, *%_) # (Str:D $: $limit, *%_) # (Str:D $: *%_)Â» say limit-lines \u0026#34;a \\n b\u0026#34;, Int # Always returns the max number of lines è¿™æ ·çš„æƒ…å†µ, æˆ‘ä»¬å…¶å®åªæƒ³å¤„ç†å®šä¹‰äº†çš„å­—ç¬¦ä¸²ã€‚è¦è¿™æ ·åš, æˆ‘ä»¬ä½¿ç”¨ :D ç±»å‹çº¦æŸã€‚\nsub limit-lines (Str:D $s, Int $limit) { ... } say limit-lines Str, 3; CATCH { default { put .^name, .Str } }; # OUTPUTÂ«X::AdHocParameter \u0026#39;$s\u0026#39; requires an instance of type Str, but a # type object was passed. Did you forget a .new?Â» # Dies with \u0026#34;å‚æ•° \u0026#39;$s\u0026#39; éœ€è¦ä¸€ä¸ªå®ä¾‹, ä½†æ˜¯å‡½æ•° limit-lines ä¸­å´ä¼ é€’äº†ä¸€ä¸ªç±»å‹å¯¹è±¡ã€‚ å¦‚æœä¼ é€’ä¸€ä¸ªè¯¸å¦‚ Str è¿™æ ·çš„ç±»å‹å¯¹è±¡è¿›å», é‚£ä¹ˆå°±ä¼šæŠ¥é”™ã€‚è¿™æ ·çš„å¤±è´¥æ–¹å¼æ¯”ä»¥å‰æ›´å¥½äº†, å› ä¸ºå¤±è´¥çš„åŸå› æ›´æ¸…æ™°äº†ã€‚\nä¹Ÿæœ‰å¯èƒ½æœªå®šä¹‰çš„ç±»å‹æ˜¯å­ä¾‹ç¨‹å”¯ä¸€æœ‰æ„ä¹‰çš„æ¥æ”¶å€¼ã€‚è¿™å¯ä»¥ä½¿ç”¨ :U ç±»å‹çº¦æŸæ¥çº¦æŸå®ƒã€‚ä¾‹å¦‚, æˆ‘ä»¬å¯ä»¥æŠŠ \u0026amp;limit-lines è½¬æ¢æˆ multi å‡½æ•°ä»¥ä½¿ç”¨ :U çº¦æŸã€‚\nmulti limit-lines (Str $s, Int:D $limit) { my @lines = $s.lines; @lines[0 ..^ min @lines.elems, $limit].join(\u0026#34;\\n\u0026#34;); } multi limit-lines (Str $s, Int:U $) {$s} # å¦‚æœä¼ é€’ç»™æˆ‘ä¸€ä¸ªæœªå®šä¹‰çš„ç±»å‹å¯¹è±¡, å°±è¿”å›æ•´ä¸ªå­—ç¬¦ä¸² say limit-lines \u0026#34;a \\n b \\n c\u0026#34;, Int; # \u0026#34;a \\n b \\n c\u0026#34; ä¸ºäº†æ˜¾å¼åœ°æ ‡ç¤ºå¸¸è§„çš„è¡Œä¸º, å¯ä»¥ä½¿ç”¨ :_, ä½†è¿™ä¸æ˜¯å¿…é¡»çš„ã€‚ :(Num:_ $) å’Œ :(Num $) ç›¸åŒã€‚\nçº¦æŸ Callables çš„ç­¾å è¦åŸºäº blockå’Œå­ä¾‹ç¨‹çš„ç­¾åçº¦æŸ block å’Œå­ä¾‹ç¨‹å¼•ç”¨, å‚æ•°åè¦å†™åœ¨ç­¾åçš„åé¢ã€‚\nsub f(\u0026amp;c:(Int, Str)) { say c(10, \u0026#39;ten\u0026#39;) }; sub g(Int $i, Str $s) { $s ~ $i }; f(\u0026amp;g); # OUTPUT: ten10 çº¦æŸè¿”å›ç±»å‹ --\u0026gt; æ ‡è®°åé¢è·Ÿç€ä¸€ä¸ªç±»å‹ä¼šå¼ºåˆ¶åœ¨å­ä¾‹ç¨‹æ‰§è¡ŒæˆåŠŸæ—¶è¿›è¡Œç±»å‹æ£€æµ‹ã€‚è¿”å›ç±»å‹ç®­å¤´å¿…é¡»æ”¾åœ¨å‚æ•°åˆ—è¡¨çš„åé¢ã€‚è·Ÿåœ¨ç­¾åå£°æ˜åé¢çš„ returns å…³é”®å­—æœ‰åŒæ ·çš„åŠŸèƒ½ã€‚Nil åœ¨ç±»å‹æ£€æµ‹ä¸­è¢«è®¤ä¸ºæ˜¯å®šä¹‰äº†çš„ã€‚è¿™å…è®¸æ²¿ç€è°ƒç”¨é“¾è¿”å›å’Œä¼ é€’ Failureã€‚\nsub (--\u0026gt; Int) { my Int $i; $i}; sub (--\u0026gt; Int:D) { 1 }; sub () returns Int { 1 }; sub foo(--\u0026gt; Int) { 1 }; sub foo() returns Int { 1 }; # åŒä¸Š sub does-not-work(--\u0026gt; Int) { \u0026#34;\u0026#34; }; # throws X::TypeCheck::Return å¦‚æœç±»å‹çº¦æŸæ˜¯ä¸€ä¸ªå¸¸é‡è¡¨è¾¾å¼, é‚£ä¹ˆå®ƒè¢«ç”¨äºå­ä¾‹ç¨‹çš„è¿”å›å€¼ã€‚é‚£ä¸ªå­ä¾‹ç¨‹ä¸­çš„ä»»ä½• return è¯­å¥å¿…é¡»æ˜¯ä¸å«å‚æ•°çš„ã€‚\nsub foo(--\u0026gt; 123) { return } Nil å’Œ Failure æ€»æ˜¯è¢«å…è®¸ä½œä¸ºè¿”å›ç±»å‹, ä¸ç®¡ç±»å‹çº¦æŸæ˜¯ä»€ä¹ˆã€‚\nsub foo(--\u0026gt; Int) { Nil }; say foo.perl; # Nil ä¸æ”¯æŒç±»å‹æ•è·å’Œå¼ºåˆ¶ç±»å‹ã€‚\nå¼ºåˆ¶ç±»å‹ è¦æ¥å—ä¸€ä¸ªç±»å‹ä½†æ˜¯å¼ºåˆ¶å®ƒè‡ªåŠ¨åœ°è½¬ä¸ºå¦ä¸€ç§ç±»å‹, ä½¿ç”¨æ¥å—çš„ç±»å‹ä½œä¸ºç›®æ ‡ç±»å‹çš„å‚æ•°ã€‚å¦‚æœæ¥å—çš„ç±»å‹æ˜¯ Any, é‚£ä¹ˆå®ƒå¯ä»¥è¢«çœç•¥ã€‚\nsub f(Int(Str) $want-int, Str() $want-str) { say $want-int.WHAT, $want-str.WHAT } f \u0026#39;10\u0026#39;, 10; # OUTPUT # (Int)(Str) åå™¬å‚æ•°(æˆ–é•¿åº¦å¯å˜å‚æ•°) æ•°ç»„æˆ–æ•£åˆ—å‚æ•°å¯ä»¥é€šè¿‡å‰ç½®ä¸€ä¸ªæ˜Ÿå·(s)è¢«æ ‡è®°ä¸ºåå™¬å‚æ•°, è¿™æ„å‘³ç€å®ƒå¯ä»¥è¢«ç»‘å®šç»™ä»»æ„æ•°é‡çš„å‚æ•°(0 ä¸ªæˆ– å¤šä¸ª)ã€‚\nå®ƒä»¬è¢«å«åšåå™¬å‚æ•°, å› ä¸ºå®ƒä»¬åå®Œå‡½æ•°ä¸­çš„ä»»ä½•å‰©ä½™å‚æ•°, å°±åƒæœ‰äº›äººååƒé¢æ¡é‚£æ ·ã€‚\n$ = :($a, @b) # æ­£å¥½ä¸¤ä¸ªå‚æ•°, è€Œç¬¬äºŒä¸ªå‚æ•°å¿…é¡»æ˜¯ Positional çš„ $ = :($a, *@b) # è‡³å°‘ä¸€ä¸ªå‚æ•°, @b åå™¬å®Œä»»ä½•å‰©ä½™çš„å‚æ•° $ = :(*%h) # æ²¡æœ‰ä½ç½®å‚æ•°, é™¤äº†ä»»æ„æ•°é‡çš„å…·åå‚æ•° sub one-arg (@) { } sub slurpy (*@) { } one-arg (5, 6, 7); # ok, same as one-arg((5, 6, 7)) slurpy (5, 6, 7); # ok slurpy 5, 6, 7 ; # ok # one-arg(5, 6, 7) ; # X::TypeCheck::Argument # one-arg 5, 6, 7 ; # X::TypeCheck::Argument sub named-names (*%named-args) { %named-args.keys }; say named-names :foo(42) :bar\u0026lt;baz\u0026gt;; # foo bar æ³¨æ„ä½ç½®å‚æ•°ä¸å…è®¸å‡ºç°åœ¨åå™¬å‚æ•°çš„åé¢ã€‚\n:(*@args, $last); CATCH { when X::Parameter::WrongOrder { put .^name, \u0026#39;: \u0026#39;, .Str } } # OUTPUTÂ«X::Parameter::WrongOrder: ä¸èƒ½æŠŠå¿…è¦å‚æ•°æ”¾åœ¨å¯å˜é•¿åº¦å‚æ•°çš„åé¢Â» å¸¦æœ‰ä¸€ä¸ªæ˜Ÿå·çš„åå™¬å‚æ•°ä¼šé€šè¿‡æ¶ˆèä¸€å±‚æˆ–å¤šå±‚è£¸çš„å¯è¿­ä»£å¯¹è±¡æ¥å±•å¹³å‚æ•°ã€‚å¸¦æœ‰ä¸¤ä¸ªæ˜Ÿå·çš„åå™¬å‚æ•°ä¸ä¼šå±•å¹³å‚æ•°ï¼š\nsub a(*@a) { @a.join(\u0026#34;|\u0026#34;).say }; sub b(**@b) { @b.join(\u0026#34;|\u0026#34;).say }; a(1,[1,2],([3,4],5)); # 1|1|2|3|4|5 b(1,[1,2],([3,4],5)); # 1|1 2|3 4 5 é€šå¸¸, åå™¬å‚æ•°ä¼šåˆ›å»ºä¸€ä¸ªæ•°ç»„, ä¸ºæ¯ä¸ª argument åˆ›å»ºä¸€ä¸ªæ ‡é‡å®¹å™¨, å¹¶ä¸”æŠŠæ¯ä¸ªå‚æ•°çš„å€¼èµ‹å€¼ç»™é‚£äº›æ ‡é‡ã€‚å¦‚æœåœ¨è¯¥è¿‡ç¨‹ä¸­åŸå‚æ•°ä¹Ÿæœ‰ä¸€ä¸ªä¸­é—´çš„æ ‡é‡åˆ†é‡, é‚£ä¹ˆå®ƒåœ¨è°ƒç”¨å‡½æ•°ä¸­æ˜¯è®¿é—®ä¸åˆ°çš„ã€‚\nåå™¬å‚æ•°åœ¨å’ŒæŸäº› traits and modifiers ç»„åˆä½¿ç”¨æ—¶ä¼šæœ‰ç‰¹æ®Šè¡Œä¸º, åƒä¸‹é¢æè¿°çš„é‚£æ ·ã€‚\nSingle Argument Rule Slurpy å•ä¸€å‚æ•°è§„åˆ™å…è®¸æ ¹æ®ä¸Šä¸‹æ–‡å¤„ç†å­ç¨‹åºã€for-loop å’Œåˆ—è¡¨æ„é€ å‡½æ•°çš„å‚æ•°ã€‚è®¸å¤šä½ç½®ç±»å‹çš„æ–¹æ³•å¯ä»¥åƒå¤„ç†åˆ—è¡¨æˆ–å‚æ•°ä¸€æ ·å¤„ç†å•ä¸ªå‚æ•°ã€‚åœ¨ Signature ä¸­ä½¿ç”¨ +@ ä½œä¸ºæ ‡å¿—, æä¾›äº†è¯­æ³•ç³–, ä½¿è¿™é¡¹å·¥ä½œæ›´å®¹æ˜“ä¸€äº›ã€‚ä»»ä½•éä½ç½®ç±»å‹çš„å•ä¸€å‚æ•°éƒ½ä¼šè¢«æå‡ä¸ºä¸€ä¸ªå…·æœ‰å•ä¸€é¡¹çš„åˆ—è¡¨ã€‚\nsub f(+@a){ dd @a }; f(1); # OUTPUTÂ«[1]â¤Â» f(1, 2, 3); # OUTPUTÂ«[1, 2, 3]â¤Â» my @b = \u0026lt;a b c\u0026gt;; f @b; # OUTPUTÂ«[\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;]â¤Â» ç±»å‹æ•è· ç±»å‹æ•è·å…è®¸æŠŠç±»å‹çº¦æŸçš„è¯´æ˜æ¨è¿Ÿåˆ°å‡½æ•°è¢«è°ƒç”¨æ—¶ã€‚å®ƒä»¬å…è®¸ç­¾åå’Œå‡½æ•°ä½“ä¸­çš„ç±»å‹éƒ½å¯ä»¥å¼•ç”¨ã€‚\nsub f(::T $p1, T $p2, ::C) { # $p1 å’Œ $p2 çš„ç±»å‹éƒ½ä¸º T, ä½†æ˜¯æˆ‘ä»¬è¿˜ä¸çŸ¥é“å…·ä½“ç±»å‹æ˜¯ä»€ä¹ˆ # C å°†ä¼šä¿å­˜ä¸€ä¸ªæºäºç±»å‹å¯¹è±¡æˆ–å€¼çš„ç±»å‹ my C $closure = $p1 / $p2; return sub (T $p1) { $closure * $p1; } } # ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ Int ç±»å‹, æ‰€ä»¥ç¬¬äºŒä¸ªå‚æ•°ä¹Ÿæ˜¯ # æˆ‘ä»¬ä»è°ƒç”¨ç”¨äº \u0026amp;f ä¸­çš„æ“ä½œç¬¦å¯¼å‡ºç¬¬ä¸‰ä¸ªç±»å‹ my \u0026amp;s = f(10,2, Int.new / Int.new); say s(2); # 10 / 2 * 2 == 10 Positional vs. Named å‚æ•°å¯ä»¥æ˜¯è·Ÿä½ç½®æœ‰å…³çš„æˆ–è€…æ˜¯å…·åçš„ã€‚æ‰€æœ‰çš„å‚æ•°éƒ½æ˜¯ positional çš„, é™¤äº†åå™¬å‹æ•£åˆ—å‚æ•°å’Œæœ‰å‰ç½®å†’å·æ ‡è®°çš„å‚æ•°:\n$ = :($a) # ä½ç½®å‚æ•° $ = :(:$a) # åå­—ä¸º a çš„å…·åå‚æ•° $ = :(*@a) # åå™¬å‹ä½ç½®å‚æ•° $ = :(*%h) # åå™¬å‹å…·åå‚æ•° åœ¨è°ƒç”¨è€…è¿™è¾¹, ä½ç½®å‚æ•°çš„ä¼ é€’é¡ºåºå’Œå®ƒä»¬å£°æ˜é¡ºåºç›¸åŒã€‚\nsub pos($x, $y) { \u0026#34;x = $xy = $y\u0026#34; }; pos(4, 5); # x = 4 y = 5 å¯¹äºå…·åå®å‚å’Œå…·åå½¢å‚, åªç”¨åå­—ç”¨äºå°†å®å‚æ˜ å°„åˆ°å½¢å‚ä¸Šã€‚\nsub named(:$x, :$y) { \u0026#34;x=$xy=$y\u0026#34; } named( y =\u0026gt; 5, x =\u0026gt; 4); å…·åå‚æ•°ä¹Ÿå¯ä»¥å’Œå˜é‡çš„åå­—ä¸åŒ:\nsub named(:official($private)) { \u0026#34;å…¬åŠ¡\u0026#34; if $private } named :official; åˆ«åä¹Ÿæ˜¯é‚£æ ·åšçš„:\nsub ( :color(:colour($c)) ) { } # \u0026#39;color\u0026#39; å’Œ \u0026#39;colour\u0026#39; éƒ½å¯ä»¥ sub ( :color(:$colour) ) { } # same API for the caller å¸¦æœ‰å…·åå‚æ•°çš„å‡½æ•°å¯ä»¥è¢«åŠ¨æ€åœ°è°ƒç”¨, ä½¿ç”¨ |éå…³è”åŒ–ä¸€ä¸ª Pair æ¥æŠŠå®ƒè½¬æ¢ä¸ºä¸€ä¸ªå…·åå‚æ•°ã€‚\nmulti f(:$named) { note \u0026amp;?ROUTINE.signature }; multi f(:$also-named) { note \u0026amp;?ROUTINE.signature }; for \u0026#39;named\u0026#39;, \u0026#39;also-named\u0026#39; -\u0026gt; $n { f(|($n =\u0026gt; rand)) # Â«(:$named)â¤(:$also-named)â¤Â» } my $pair = :named(1); f |$pair; # Â«(:$named)â¤Â» åŒæ ·çš„è¯­æ³•ä¹Ÿå¯ä»¥ç”¨äºå°†æ•£åˆ—è½¬æ¢ä¸ºå…·åå‚æ•°ï¼š\nmy %pairs = also-named =\u0026gt; 4; sub f(|c) {}; f |%pairs; # (:$also-named) å¯é€‰å‚æ•°å’Œå¼ºåˆ¶å‚æ•° Positional å‚æ•°é»˜è®¤æ˜¯å¼ºåˆ¶çš„, ä¹Ÿå¯ä»¥ç”¨é»˜è®¤å€¼æˆ–ç»“å°¾çš„é—®å·ä½¿å‚æ•°æˆä¸ºå¯é€‰çš„:\n$ = :(Str $id) # å¿…è¦å‚æ•° required parameter $ = :($base = 10) # å¯é€‰å‚æ•°, é»˜è®¤ä¸º 10 $ = :(Int $x?) # å¯é€‰å‚æ•°, é»˜è®¤ä¸º Int ç±»å‹çš„å¯¹è±¡ å…·åå‚æ•°é»˜è®¤æ˜¯å¯é€‰çš„, å¯ä»¥é€šè¿‡åœ¨å‚æ•°æœ«å°¾åŠ ä¸Šä¸€ä¸ªæ„Ÿå¹å·ä½¿å®ƒå˜æˆå¼ºåˆ¶å‚æ•°:\n$ = :(:%config) # å¯é€‰å‚æ•° $ = :(:$debug = False) # å¯é€‰å‚æ•°, é»˜è®¤ä¸º False $ = :(:$name!) # åä¸º name çš„å¼ºåˆ¶å…·åå‚æ•° é»˜è®¤å€¼å¯ä»¥ä¾é ä¹‹å‰çš„å‚æ•°, å¹¶ä¸”æ¯æ¬¡è°ƒç”¨éƒ½ä¼šè¢«é‡æ–°è®¡ç®—ã€‚\n$ = :($goal, $accuracy = $goal / 100); $ = :(:$excludes = [\u0026#39;.\u0026#39;, \u0026#39;..\u0026#39;]); # a new Array for every call è§£æ„å‚æ•° å‚æ•°åé¢å¯ä»¥è·Ÿç€ä¸€ä¸ªç”±æ‹¬å·æ‹¬èµ·æ¥çš„ sub-signature, å­ç­¾åä¼šè§£æ„ç»™å®šçš„å‚æ•°ã€‚åˆ—è¡¨è§£æ„æˆå®ƒçš„å…ƒç´ :\nsub first (@array ($first, *@rest)) { $first } æˆ–:\nsub first ([$first, *@]) { $first } è€Œæ•£åˆ—è§£æ„æˆå®ƒçš„é”®å€¼å¯¹å„¿(pairs):\nsub all-dimensions (% (:length(:$x), :width(:$y), :depth(:$z))) { $x andthen $y andthen $z andthen True } andthen è¿”å›ç¬¬ä¸€ä¸ªæœªå®šä¹‰çš„å€¼, å¦åˆ™è¿”å›æœ€åä¸€ä¸ªå…ƒç´ ã€‚çŸ­è·¯æ“ä½œç¬¦ã€‚andthen å·¦ä¾§çš„ç»“æœè¢«ç»‘å®šç»™ $_ ç”¨äºå³ä¾§, æˆ–è€…ä½œä¸ºå‚æ•°ä¼ é€’, å¦‚æœå³ä¾§æ˜¯ä¸€ä¸ª block æˆ– pointy block çš„è¯ã€‚\nä¸€èˆ¬åœ°, å¯¹è±¡æ ¹æ®å®ƒçš„å±æ€§è§£æ„ã€‚é€šç”¨çš„æƒ¯ç”¨æ³•æ˜¯åœ¨ for å¾ªç¯ä¸­è§£åŒ…ä¸€ä¸ª Pair çš„é”®å’Œå€¼:\nfor \u0026lt;Peter Paul Merry\u0026gt;.pairs -\u0026gt; (:key($index), :value($guest)) { ... } ä½†æ˜¯, å°†å¯¹è±¡è§£åŒ…ä¸ºå±æ€§åªæ˜¯é»˜è®¤è¡Œä¸ºã€‚è¦ä½¿å¯¹è±¡ä»¥ä¸åŒæ–¹å¼è§£æ„, è¯·æ›´æ”¹å…¶ Capture æ–¹æ³•ã€‚\nå­ç­¾å è¦åŒ¹é…å¤åˆå‚æ•°, è¯·åœ¨åœ†æ‹¬å·ä¸­çš„å‚æ•°ååé¢ä½¿ç”¨å­ç­¾åã€‚\nsub foo(|c(Int, Str)){ put \u0026#34;called with {c.perl}\u0026#34; } foo(42, \u0026#34;answer\u0026#34;); # OUTPUTÂ«called with \\(42, \u0026#34;answer\u0026#34;)Â» é•¿åå­— ä¸ºäº†åœ¨å¤šé‡åˆ†æ´¾ä¸­æ’é™¤ç‰¹å®šå‚æ•°, ä½¿ç”¨ä¸€ä¸ªåŒåˆ†å·æ¥åˆ†å‰²å®ƒä»¬ã€‚\nmulti sub f(Int $i, Str $s;; :$b) { dd $i, $s, $b }; f(10, \u0026#39;answer\u0026#39;); # OUTPUTÂ«10 \u0026#34;answer\u0026#34;Any $b = AnyÂ» æ•è·å‚æ•° åœ¨å‚æ•°å‰å‰ç½®ä¸€ä¸ªå‚ç›´çš„ | ä¼šè®©å‚æ•°å˜ä¸º Capture, å¹¶ä½¿ç”¨å®Œæ‰€æœ‰å‰©ä¸‹çš„ä½ç½®å‚æ•°å’Œå…·åå‚æ•°ã€‚\nè¿™å¸¸ç”¨åœ¨ proto å®šä¹‰ä¸­( åƒ proto foo (|) {*} ) æ¥æ ‡ç¤ºä¾‹ç¨‹çš„ multi å®šä¹‰å¯ä»¥æ‹¥æœ‰ä»»ä½•ç±»å‹çº¦æŸã€‚\nå¦‚æœç»‘å®šåˆ°å˜é‡å‚æ•°, åˆ™å¯ä»¥ä½¿ç”¨ slip è¿ç®—ç¬¦ | ä½œä¸ºæ•´ä½“è½¬å‘ã€‚\nsub a(Int $i, Str $s) { say $i.WHAT, $s.WHAT } sub b(|c) { say c.WHAT; a(|c) } b(42, \u0026#34;answer\u0026#34;); # OUTPUTÂ«(Capture)â¤(Int)(Str)â¤Â» å‚æ•°ç‰¹æ€§å’Œä¿®é¥°ç¬¦ é»˜è®¤åœ°, å½¢å¼å‚æ•°è¢«ç»‘å®šåˆ°å®ƒä»¬çš„å®å‚ä¸Šå¹¶ä¸”è¢«æ ‡è®°ä¸ºåªè¯»ã€‚ä½ å¯ä»¥ä½¿ç”¨ traits ç‰¹æ€§æ›´æ”¹å‚æ•°çš„åªè¯»ç‰¹æ€§ã€‚\nis copyç‰¹æ€§è®©å‚æ•°è¢«å¤åˆ¶, å¹¶å…è®¸åœ¨å­ä¾‹ç¨‹å†…éƒ¨ä¿®æ”¹å‚æ•°çš„å€¼ã€‚\nsub count-up ($x is copy) { $x = Inf if $x ~~ Whatever; .say for 1..$x; } is rw ç‰¹æ€§è®©å‚æ•°åªç»‘å®šåˆ°å˜é‡ä¸Š(æˆ–å…¶å®ƒå¯å†™çš„å®¹å™¨)ã€‚ èµ‹å€¼ç»™å‚æ•°ä¼šæ”¹å˜è°ƒç”¨ä¸€ä¾§çš„å˜é‡çš„å€¼ã€‚\nsub swap($x is rw, $y is rw) { ($x, $y) = ($y, $x); } å¯¹äºåå™¬å‚æ•°, is rw ç”±è¯­è¨€è®¾è®¡è€…ä¿ç•™åšå°†æ¥ä¹‹ç”¨\næ–¹æ³• params æ–¹æ³• method params(Signature:D:) returns Positional è¿”å› Parameter å¯¹è±¡åˆ—è¡¨ä»¥ç»„æˆç­¾åã€‚\narity æ–¹æ³• method arity(Signature:D:) returns Int:D è¿”å›æ‰€å¿…é¡»çš„æœ€å°æ•°é‡çš„æ»¡è¶³ç­¾åçš„ä½ç½®å‚æ•°\ncount æ–¹æ³• method count(Signature:D:) returns Real:D è¿”å›èƒ½è¢«ç»‘å®šç»™ç­¾åçš„æœ€å¤§æ•°é‡çš„ä½ç½®å‚æ•°ã€‚å¦‚æœæœ‰åå™¬ä½ç½®å‚æ•°åˆ™è¿”å› Infã€‚\nreturns æ–¹æ³• ç­¾åè¿”å›çš„ä»»æ„çº¦æŸæ˜¯:\n:($a, $b --\u0026gt; Int).returns # Int ACCEPTS æ–¹æ³• multi method ACCEPTS(Signature:D: Capture $topic) multi method ACCEPTS(Signature:D: @topic) multi method ACCEPTS(Signature:D: %topic) multi method ACCEPTS(Signature:D: Signature $topic) å‰ä¸‰ä¸ªæ–¹æ³•ä¼šçœ‹å‚èƒ½å¦ç»‘å®šç»™ capture, ä¾‹å¦‚, å¦‚æœå¸¦æœ‰é‚£ä¸ª Signature çš„å‡½æ•°èƒ½ä½¿ç”¨ $topic è°ƒç”¨:\n(1,2, :foo) ~~ :($a, $b, :foo($bar)) # true \u0026lt;a b c d\u0026gt; ~~ :(Int $a) # False æœ€åä¸€ä¸ªä¼šä¸ºçœŸå¦‚æœ $topic èƒ½æ¥æ”¶çš„ä»»ä½•ä¸œè¥¿ä¹Ÿèƒ½è¢« Signature æ¥æ”¶ã€‚\n:($a, $b) ~~ :($foo, $bar, $baz?) # True :(Int $n) ~~ :(Str) # False ","permalink":"https://ohmyweekly.github.io/notes/2016-04-12-signature-in-raku/","tags":["signature"],"title":"Raku ä¸­çš„ç­¾å"},{"categories":["rakulang"],"contents":"ç”¨ç±»æ¥æ’åºæ•°ç»„ æœ‰å¤šåˆ—æ•°æ®, åºå·, å­¦æ ¡, è¯¾ç¨‹â€¦ å¹´ä»½è¿™å‡ åˆ—ã€‚è¦å¦‚æœå­¦æ ¡å’Œè¯¾ç¨‹ç›¸åŒå°±æ ¹æ®å¹´ä»½å€’åºæ’åˆ—ã€‚\nå…ˆæŒ‰å­¦æ ¡æ’åº, å†æŒ‰è¯¾ç¨‹æ’åº, ç„¶åæŒ‰å¹´ä»½å€’åºæ’åºã€‚\næˆ‘å®šä¹‰ä¸€ä¸ªç±»æ¥è¿›è¡Œå¤šåˆ—æ•°æ®çš„æ’åº, å¾ˆæ–¹ä¾¿ï¼š\nclass Course { has Int $.numb; has Str $.univ; has Str $.dis; has Int $.paper; has Int $.cited; has Int $.year; } my @headers = \u0026lt;numb univ dis paper cited year\u0026gt;; my @courses; for $=finish.lines -\u0026gt; $line { next if $line ~~ /^num/; my @words = $line.words; @words[0, 3,4,5] = @words[0,3,4,5]Â».Int; my %h = @headers Z=\u0026gt; @words; my $course = Course.new(|%h); @courses.push($course); } my @sorted = @courses.sort(*.univ).sort(*.dis).sort(-*.year); for @sorted { say join \u0026#34;\u0026#34;, .numb, .univ, .dis, .paper, .cited, .year; } =finishnum\tuniv\tdis\tpaper\tcited\tyear 1\tBeijing\tPhysics\t193\t4555\t2005 2\tBeijing\tPhysics\t197\t2799\t2006 3\tBeijing\tPhysics\t240\t2664\t2007 4\tBeijing\tPhysics\t200\t3191\t2008 5\tBeijing\tPhysics\t268\t2668\t2009 6\tBeijing\tPhysics\t249\t2300\t2010 7\tBeijing\tPhysics\t262\t2080\t2011 8\tBeijing\tPhysics\t230\t2371\t2012 9\tBeijing\tPhysics\t309\t1367\t2013 10\tBeijing\tPhysics\t284\t615\t2014 11\tBeijing\tChemistry\t143\t1650\t2005 12\tBeijing\tChemistry\t149\t2379\t2006 13\tBeijing\tChemistry\t190\t2566\t2007 14\tBeijing\tChemistry\t147\t1888\t2008 15\tBeijing\tChemistry\t184\t2146\t2009 16\tBeijing\tChemistry\t214\t2568\t2010 17\tBeijing\tChemistry\t238\t2874\t2011 18\tBeijing\tChemistry\t265\t2097\t2012 19\tBeijing\tChemistry\t251\t1303\t2013 20\tBeijing\tChemistry\t241\t656\t2014 æ–æ³¢æ‹‰å¥‘æ•°åˆ—ï¼ˆFibonacci Sequenceï¼‰  analytic  sub fibonacci (Int $n where 0..* --\u0026gt; Int) { constant phi = (1 + sqrt 5) / 2; return round( phi**($n+1) / sqrt 5); } for 0..1000 -\u0026gt; $i { say $i.fmt(\u0026#39;%3d\u0026#39;), \u0026#39;: \u0026#39;, fibonacci($i); } è¿™ç§æ–¹æ³•è®¡ç®—å‰1000ä¸ªæ–æ³¢æ‹‰å¥‘æ•°å¤§çº¦ä¸º0.746sï¼ˆ2015.7.Rakudo, ä»¥ä¸‹éƒ½æ˜¯ï¼‰ã€‚\n è¿­ä»£  sub fibonacci (Int $n) { state @sequence = 1,1; while @sequence.elems \u0026lt;= $n { @sequence.push( @sequence[*-2] + @sequence[*-1] ); } return @sequence[$n]; } for 0..1000 -\u0026gt; $i { say $i.fmt(\u0026#39;%3d\u0026#39;), \u0026#39;: \u0026#39;, fibonacci($i); } è¿™ç§éå†æ³•å¤§æ¦‚éœ€è¦ 1 ç§’å¤šã€‚\n é€’å½’  sub fibonacci (Int $n where 0..*) { if $n == 0 | 1 { return 1; } else { return fibonacci($n-1) + fibonacci($n-2); } } for 0..1000 -\u0026gt; $i { say $i.fmt(\u0026#39;%3d\u0026#39;), \u0026#39;: \u0026#39;, fibonacci($i); } æ¯”è¾ƒæ…¢ã€‚ç¬¬ 20 ä¸ªä¹‹åè¶Šæ¥è¶Šæ…¢ã€‚\n é€’å½’ - è¶…è¿ç®—ç¬¦  sub fibonacci (Int $n where 0..*) { if $n == 0 | 1 { return 1; } else { return [+] ($n-1, $n-2)Â».\u0026amp;fibonacci; } } for 0..1000 -\u0026gt; $i { say $i.fmt(\u0026#39;%3d\u0026#39;), \u0026#39;: \u0026#39;, fibonacci($i); } å’Œä¸Šé¢å·®ä¸å¤šã€‚\n é€’å½’ - map  sub fibonacci (Int $n where 0..*) { if $n == 0 | 1 { return 1; } else { return [+] map \u0026amp;fibonacci, ($n-1, $n-2); } } for 0..1000 -\u0026gt; $i { say $i.fmt(\u0026#39;%3d\u0026#39;), \u0026#39;: \u0026#39;, fibonacci($i); } åŒä¸Šã€‚\n é€’å½’ - multi  multi fibonacci (0) { 1 } multi fibonacci (1) { 1 } multi fibonacci (Int $n --\u0026gt; Int) { return fibonacci($n-1) + fibonacci($n-2); } for 0..1000 -\u0026gt; $i { say $i.fmt(\u0026#39;%3d\u0026#39;), \u0026#39;: \u0026#39;, fibonacci($i); } æ¯”ä¸Šä¸€ä¸ªç¨å¿«ã€‚\n é€’å½’ - multi_cached  multi fibonacci (0) { 1 } multi fibonacci (1) { 1 } my %cached; multi fibonacci (Int $n --\u0026gt; Int) { return %cached{$n} //= fibonacci($n-1) + fibonacci($n-2); } for 0..1000 -\u0026gt; $i { say $i.fmt(\u0026#39;%3d\u0026#39;), \u0026#39;: \u0026#39;, fibonacci($i); } èŠ±è´¹ 0.849s æ‰§è¡Œå®Œæ¯•ã€‚\n é€’å½’ - multi_cached_state  multi fibonacci (0) { 1 } multi fibonacci (1) { 1 } multi fibonacci (Int $n --\u0026gt; Int) { state %cached; return %cached{$n} //= fibonacci($n-1) + fibonacci($n-2); } for 0..1000 -\u0026gt; $i { say $i.fmt(\u0026#39;%3d\u0026#39;), \u0026#39;: \u0026#39;, fibonacci($i); } èŠ±è´¹äº† 0.885sã€‚\n é€’å½’ - multi_cached_trait  multi fibonacci (0) { 1 } multi fibonacci (1) { 1 } multi fibonacci (Int $n --\u0026gt; Int) is cached { fibonacci($n-1) + fibonacci($n-2); } for 0..1000 -\u0026gt; $i { say $i.fmt(\u0026#39;%3d\u0026#39;), \u0026#39;: \u0026#39;, fibonacci($i); } ç›®å‰æŠ¥é”™ã€‚\n åºåˆ—  sub fibonacci (Int $n) { constant @sequence := 1, 1, *+* ... *; return @sequence[$n]; } for 0..1000 -\u0026gt; $i { say $i.fmt(\u0026#39;%3d\u0026#39;), \u0026#39;: \u0026#39;, fibonacci($i); } èŠ±è´¹äº† 1.6s å¤šã€‚ å…¶ä¸­ := æ˜¯æƒ°æ€§èµ‹å€¼ã€‚æŒ‰éœ€æ±‚å€¼ã€‚\n åºåˆ— - inline  sub fibonacci (Int $n) { (1, 1, *+* ... *)[$n]; } for 0..1000 -\u0026gt; $i { say $i.fmt(\u0026#39;%3d\u0026#39;), \u0026#39;: \u0026#39;, fibonacci($i); } èŠ±è´¹äº† 133.808sã€‚\næ’åº  bogosort  #! /usr/bin/env raku sub bogosort ( *@list ) { until [!after] @list { @list .= pick(*); } return @list; } #my @data = 6, 7, 2, 1, 8, 9, 2; my @data = \u0026lt;p e r l s i x \u0026gt;; say \u0026#39;input = \u0026#39; ~ @data; say \u0026#39;output = \u0026#39; ~ bogosort @data; è¾“å‡ºï¼š\ninput = p e r l s i x output = e i l p r s x [Finished in 1.326s]  mergesort  #! /usr/bin/env raku sub merge (@a, @b) { gather while @a \u0026amp;\u0026amp; @b { if @a[0] before @b[0] { take @a.shift } else { take @b.shift } }, @a, @b; } sub mergesort ( *@list ) { return @list if @list.elems \u0026lt;= 1; my $middle = @list.elems div 2; my @left = mergesort @list[ 0 ..^ $middle ]; my @right = mergesort @list[ $middle .. * ]; return merge(@left, @right); } # my @data = 6, 7, 2, 1, 8, 9, 5, 3, 4; my @data = \u0026lt;p e r l s i x \u0026gt;; say \u0026#34;input = { @data }\u0026#34;; say \u0026#34;output = { mergesort(@data) }\u0026#34;; è¾“å‡ºï¼š\ninput = p e r l s i x output = e i l p r s x [Finished in 0.337s]  mergesort_functional  #! /usr/bin/env raku multi merge ([], @ys) { @ys } multi merge (@xs, []) { @xs } multi merge ([$x, *@xs], [$y, *@ys]) { $x before $y ?? ($x, merge @xs, [$y, @ys]) !! ($y, merge [$x, @xs], @ys) } multi mergesort ( [] ) { [] } multi mergesort ([$x]) { [$x] } multi mergesort (@xs) { merge mergesort( @xs[0 ..^ @xs.elems div 2] ), mergesort( @xs[@xs.elems div 2 .. * ] ) } my @data = 6, 7, 2, 1, 8, 9, 5, 3, 4; #my @data = \u0026lt; p e r l s i x \u0026gt;; say \u0026#34;input = { @data }\u0026#34;; say \u0026#34;output = { mergesort(@data) }\u0026#34;; è¾“å‡ºï¼š\ninput = 6 7 2 1 8 9 5 3 4 output = 1 2 3 4 5 6 7 8 9 [Finished in 0.373s]  mergesort_functional_given  #! /usr/bin/env raku multi merge ([], @ys) { @ys } multi merge (@xs, []) { @xs } multi merge ([$x, *@xs], [$y, *@ys]) { $x before $y ?? ($x, merge @xs, [$y, @ys]) !! ($y, merge [$x, @xs], @ys) } multi mergesort ( [] ) { [] } multi mergesort ([$x]) { [$x] } multi mergesort (@xs) { given @xs.elems div 2 -\u0026gt; $middle { merge mergesort( @xs[ 0 ..^ $middle ] ), mergesort( @xs[ $middle .. * ] ) } } my @data = 6, 7, 2, 1, 8, 9, 5, 3, 4; #my @data = \u0026lt; p e r l s i x \u0026gt;; say \u0026#34;input = { @data }\u0026#34;; say \u0026#34;output = { mergesort(@data) }\u0026#34;; è¾“å‡ºï¼š\ninput = 6 7 2 1 8 9 5 3 4 output = 1 2 3 4 5 6 7 8 9 [Finished in 0.375s]  mergesort_functional_interleaved  #! /usr/bin/env raku multi merge ([], @ys) { @ys } multi merge (@xs, []) { @xs } multi merge ([$x, *@xs], [$y, *@ys]) { $x before $y ?? ($x, merge @xs, [$y, @ys]) !! ($y, merge [$x, @xs], @ys) } multi mergesort ( [] ) { [] } multi mergesort ([$x]) { [$x] } multi mergesort (@xs) { merge mergesort( @xs[0,2...*] ), mergesort( @xs[1,3...*] ) } my @data = 6, 7, 2, 1, 8, 9, 5, 3, 4; #my @data = \u0026lt; p e r l s i x \u0026gt;; say \u0026#34;input = { @data }\u0026#34;; say \u0026#34;output = { mergesort(@data) }\u0026#34;; è¾“å‡ºï¼š\ninput = 6 7 2 1 8 9 5 3 4 output = 1 2 3 4 5 6 7 8 9 [Finished in 0.34s]  quicksort  #! /usr/bin/env raku sub quicksort( *@list ) { return @list if @list.elems \u0026lt; 2; my $pivot = @list.shift; # my $pivot = @list.=pick(*).shift; my (@before, @after); for @list -\u0026gt; $elem { if $elem before $pivot { @before.push($elem); } else { @after.push($elem); } } return quicksort(@before), $pivot, quicksort(@after); } #my @data = 6, 7, 2, 1, 8, 9, 5, 3, 4; my @data = \u0026lt;p e r l s i x \u0026gt;; say \u0026#34;input = { @data }\u0026#34;; say \u0026#34;output = { quicksort(@data) }\u0026#34;; è¾“å‡ºï¼š\ninput = p e r l s i x output = e i l p r s x [Finished in 0.246s]  quicksort_classify  #! /usr/bin/env raku multi quicksort( [] ) { }; multi quicksort( Mu ) { }; multi quicksort( [$x] ) { $x }; multi quicksort( [$pivot, *@xs] ) { given @xs.classify:{ $^elem before $pivot ?? \u0026#39;pre\u0026#39; !! \u0026#39;post\u0026#39;} { quicksort( .\u0026lt;pre\u0026gt; ), $pivot, quicksort( .\u0026lt;post\u0026gt; ); } } #my @data = 6, 7, 2, 1, 8, 9, 5, 3, 4; my @data = \u0026lt;p e r l s i x \u0026gt;; say \u0026#34;input = { @data }\u0026#34;; say \u0026#34;output = { quicksort(@data) }\u0026#34;; è¾“å‡ºï¼š\ninput = p e r l s i x output = e i l p r s x [Finished in 0.303s]  quicksort_functional  #! /usr/bin/env raku multi quicksort( [] ) { }; multi quicksort( [$x] ) { $x }; multi quicksort( [$pivot, *@xs] ) { quicksort(@xs.grep: * before $pivot), $pivot, quicksort(@xs.grep: * !before $pivot); } #my @data = 6, 7, 2, 1, 8, 9, 5, 3, 4; my @data = \u0026lt;p e r l s i x \u0026gt;; say \u0026#34;input = { @data }\u0026#34;; say \u0026#34;output = { quicksort(@data) }\u0026#34;; è¾“å‡º:\ninput = p e r l s i x output = e i l p r s x [Finished in 0.27s] pm æ¨¡å— é¦–å…ˆæŠŠè‡ªå®šä¹‰çš„ Bank.pm æ¨¡å—å¤åˆ¶åˆ° Raku çš„ lib ç›®å½•ä¸‹ï¼š\ncp Bank.pm ~/.rakudobrew/moar-nom/install/share/raku/site/lib Bank.pm\n#! /usr/bin/raku class Ident { subset Pattern of Str where / \\d**3 \u0026#39;-\u0026#39; \\d**3 \u0026#39;-\u0026#39; \\d**3 /; has Str $.name = \u0026#39;????\u0026#39;; has Str $.ID where Pattern = \u0026#39;000-000-000\u0026#39;; } role Taxable [:$THRESHOLD = 100_000] { constant GENERAL_TAX_RATE = 0.01; has %.tax_record; method tax_credits {...} method calculate_tax () { my $tax_payable = ($.balance min $THRESHOLD) * GENERAL_TAX_RATE - $.tax_credits; %!tax_record{now} = $tax_payable; return $tax_payable; } } class Account does Taxable { subset ID of Str where / \u0026lt;alpha\u0026gt;**4 \u0026lt;digit\u0026gt;**5 /; state ID $next_account_ID = \u0026#39;AAAA00001\u0026#39;; has Str $.name = die \u0026#39;Must provide account name\u0026#39;; has Numeric $.balance = 0; has ID $.ID = $next_account_ID++; method deposit(Numeric $amount where *\u0026gt;0) { $!balance += $amount; } method withdraw(Numeric $amount where *\u0026gt;0) { fail \u0026#34;Insufficient funds to withdraw $amount\u0026#34; if $.balance \u0026lt; $amount; $!balance -= $amount; } method description () { \u0026#34;$.ID($.name): balance=$.balance\u0026#34;; } method tax_credits { 0 } } class Bank { has Ident $!ident handles\u0026lt;name ID \u0026gt;; has Account %!accounts; submethod BUILD (|args) { $!ident .= new(|args); } method add_account(Account $account) { %!accounts{$account.ID} = $account; } method close_account(Str $ID) { return %!accounts{$ID} :delete // fail \u0026#34;No such account\u0026#34;; } multi method get_account(Account::ID $ID) { return %!accounts{$ID} // fail \u0026#34;No such account\u0026#34;; } multi method get_account(Any $name) { # return %!accounts.values.grep({.name ~~ $name}); self.for_each_account({.take if .name ~~ $name}); } method for_each_account (\u0026amp;action_on) { gather for %!accounts.values -\u0026gt; $account is rw { action_on($account); } } method collect_taxes () { self.for_each_account: { my $tax = .calculate_tax(); .withdraw($tax); take .ID =\u0026gt; $tax; } } method report () { say \u0026#34;[ {self.ID}[{self.name}] ]\u0026#34;; # Or: say \u0026#34;[ $.ID [$.name] ]\u0026#34;; self.for_each_account(*.description.say); say \u0026#39;\u0026#39;; } } class Account::Corporate is Account does Taxable[THRESHOLD =\u0026gt; 1_000_000] { has Str $.company_ID; method tax_credits { 5_000 } method description () { callsame() ~ \u0026#34;[$.company_ID]\u0026#34;; } } è¯¥æ¨¡å—çš„åŠŸèƒ½æ˜¯è®¡ç®—é“¶è¡Œå­˜æ¬¾æ±‡ç‡ç­‰ã€‚ä¸‹é¢ä½¿ç”¨è¿™ä¸ªæ¨¡å—ï¼š\n demo  #! /usr/bin/env raku use Bank; my Bank $bank .= new(:ID(\u0026#39;123-456-789\u0026#39;)); $bank.add_account: Account.new(:name(\u0026#39;Leslie Grace\u0026#39;) ); $bank.add_account: Account.new(:name(\u0026#39;Dana McKenna\u0026#39;), :balance(10_000)); $bank.add_account: Account.new(:name(\u0026#39;AstroDynamic\u0026#39;), :balance( 2e7)); $bank.add_account: Account.new(:name(\u0026#39;Jan van Quod\u0026#39;), :balance( 9_999)); $bank.add_account: Account.new(:name(\u0026#39;OmniCorp LLC\u0026#39;), :balance( 1e6)); $bank.report; $bank.get_account(\u0026#39;AAAA00003\u0026#39;).deposit(100); $bank.get_account(\u0026#39;Jan van Quod\u0026#39;)Â».deposit(2); $bank.get_account(/D.na/)Â».deposit(2); #$bank.get_account(*)Â».deposit(99); $bank.report; given $bank.close_account(\u0026#39;AAAA00005\u0026#39;) { say \u0026#34;Closed $^account.perl()\\n\u0026#34;; $bank.report; } $bank.close_account(\u0026#39;ZZZZ99999\u0026#39;); $bank.get_account(\u0026#39;AAAA00001\u0026#39;).withdraw(1001); $bank.report; è¾“å‡ºï¼š\n[ 123-456-789 [????] ] AAAA00004 (Jan van Quod): balance=9999 AAAA00001 (Leslie Grace): balance=0 AAAA00005 (OmniCorp LLC): balance=1000000 AAAA00002 (Dana McKenna): balance=10000 AAAA00003 (AstroDynamic): balance=20000000 [ 123-456-789 [????] ] AAAA00004 (Jan van Quod): balance=10001 AAAA00001 (Leslie Grace): balance=0 AAAA00005 (OmniCorp LLC): balance=1000000 AAAA00002 (Dana McKenna): balance=10002 AAAA00003 (AstroDynamic): balance=20000102 Closed Account.new(name =\u0026gt; \u0026quot;OmniCorp LLC\u0026quot;, balance =\u0026gt; 1000000e0, ID =\u0026gt; \u0026quot;AAAA00005\u0026quot;, tax_record =\u0026gt; {}\u0026lt;\u0026gt;) [ 123-456-789 [????] ] AAAA00004 (Jan van Quod): balance=10001 AAAA00001 (Leslie Grace): balance=0 AAAA00002 (Dana McKenna): balance=10002 AAAA00003 (AstroDynamic): balance=20000102 No such account in method close_account at ~/.rakudobrew/moar-nom/install/share/raku/site/lib/Bank.pm:67 Actually thrown at: in block \u0026lt;unit\u0026gt; at ~/04.bank_demo.pl:26 [Finished in 0.768s]  demo_inheritance  #! /usr/bin/env raku sub show ($text) { say \u0026#39;\u0026#39;; say (\u0026#39;____/ \u0026#39; ~ $text ~ \u0026#39;\\_________________________________________________\u0026#39;).substr(0,50); } use Bank; my Bank $bank .= new(:ID(\u0026#39;123-456-789\u0026#39;), :name(\u0026#39;Bank of Evil\u0026#39;)); $bank.add_account: Account.new(:name(\u0026#39;Leslie Grace\u0026#39;), :balance( 1_000)); $bank.add_account: Account.new(:name(\u0026#39;Dana McKenna\u0026#39;), :balance(10_000)); $bank.add_account: Account.new(:name(\u0026#39;Jan van Quod\u0026#39;), :balance( 9_999)); $bank.add_account: Account::Corporate.new(:name(\u0026#39;AstroDynamic\u0026#39;), :balance(2e7) :company_ID(\u0026#39;ASDY\u0026#39;)); $bank.add_account: Account::Corporate.new(:name(\u0026#39;OmniCorp LLC\u0026#39;), :balance(1e6) :company_ID(\u0026#39;OMNI\u0026#39;)); show \u0026#39;Status\u0026#39;; $bank.report; show \u0026#39;Taxes collected\u0026#39;; .say for $bank.collect_taxes(); show \u0026#39;Status\u0026#39;; $bank.report; $bank.collect_taxes(); show \u0026#39;Tax records\u0026#39;; $bank.for_each_account({ say .name, \u0026#39;: \u0026#39;, .tax_record }); show \u0026#39;Culling acounts\u0026#39;; given $bank { .for_each_account: { .close_account($^account.ID).say if $^account.balance \u0026lt; 10_000; } } show \u0026#39;Status\u0026#39;; $bank.report; è¾“å‡ºï¼š\n____/ Status \\____________________________________ [ 123-456-789 [Bank of Evil] ] AAAA00004 (AstroDynamic): balance=20000000 [ASDY] AAAA00001 (Leslie Grace): balance=1000 AAAA00005 (OmniCorp LLC): balance=1000000 [OMNI] AAAA00002 (Dana McKenna): balance=10000 AAAA00003 (Jan van Quod): balance=9999 ____/ Taxes collected \\___________________________ AAAA00004 =\u0026gt; 5000 AAAA00001 =\u0026gt; 10 AAAA00005 =\u0026gt; 5000 AAAA00002 =\u0026gt; 100 AAAA00003 =\u0026gt; 99.99 ____/ Status \\____________________________________ [ 123-456-789 [Bank of Evil] ] AAAA00004 (AstroDynamic): balance=19995000 [ASDY] AAAA00001 (Leslie Grace): balance=990 AAAA00005 (OmniCorp LLC): balance=995000 [OMNI] AAAA00002 (Dana McKenna): balance=9900 AAAA00003 (Jan van Quod): balance=9899.01 ____/ Tax records \\_______________________________ AstroDynamic: Instant:1440413601.447466 =\u0026gt; 5000, Instant:1440413601.463112 =\u0026gt; 5000 Leslie Grace: Instant:1440413601.450753 =\u0026gt; 10, Instant:1440413601.465823 =\u0026gt; 9.9 OmniCorp LLC: Instant:1440413601.452933 =\u0026gt; 5000, Instant:1440413601.468346 =\u0026gt; 4950 Dana McKenna: Instant:1440413601.454860 =\u0026gt; 100, Instant:1440413601.470238 =\u0026gt; 99 Jan van Quod: Instant:1440413601.457399 =\u0026gt; 99.99, Instant:1440413601.471551 =\u0026gt; 98.9901 ____/ Culling acounts \\___________________________ Account.new(name =\u0026gt; \u0026quot;Leslie Grace\u0026quot;, balance =\u0026gt; 980.1, ID =\u0026gt; \u0026quot;AAAA00001\u0026quot;, tax_record =\u0026gt; {\u0026quot;Instant:1440413601.450753\u0026quot; =\u0026gt; 10.0, \u0026quot;Instant:1440413601.465823\u0026quot; =\u0026gt; 9.9}\u0026lt;\u0026gt;) Account.new(name =\u0026gt; \u0026quot;Dana McKenna\u0026quot;, balance =\u0026gt; 9801.0, ID =\u0026gt; \u0026quot;AAAA00002\u0026quot;, tax_record =\u0026gt; {\u0026quot;Instant:1440413601.454860\u0026quot; =\u0026gt; 100.0, \u0026quot;Instant:1440413601.470238\u0026quot; =\u0026gt; 99.0}\u0026lt;\u0026gt;) Account.new(name =\u0026gt; \u0026quot;Jan van Quod\u0026quot;, balance =\u0026gt; 9800.0199, ID =\u0026gt; \u0026quot;AAAA00003\u0026quot;, tax_record =\u0026gt; {\u0026quot;Instant:1440413601.457399\u0026quot; =\u0026gt; 99.99, \u0026quot;Instant:1440413601.471551\u0026quot; =\u0026gt; 98.9901}\u0026lt;\u0026gt;) ____/ Status \\____________________________________ [ 123-456-789 [Bank of Evil] ] AAAA00004 (AstroDynamic): balance=19990000 [ASDY] AAAA00005 (OmniCorp LLC): balance=990050 [OMNI] [Finished in 0.817s]  demo_unary_dot  #! /usr/bin/env raku use Bank; my Bank $bank .= new(:ID(\u0026#39;123-456-789\u0026#39;)); given $bank { .add_account: Account.new(:name(\u0026#39;Leslie Grace\u0026#39;), :balance( 1_000)); .add_account: Account.new(:name(\u0026#39;Dana McKenna\u0026#39;), :balance(10_000)); .add_account: Account.new(:name(\u0026#39;AstroDynamic\u0026#39;), :balance( 2e7)); .add_account: Account.new(:name(\u0026#39;Jan van Quod\u0026#39;), :balance( 9_999)); .add_account: Account.new(:name(\u0026#39;OmniCorp LLC\u0026#39;), :balance( 1e6)); .report; .get_account(\u0026#39;AAAA00003\u0026#39;).deposit(100); .report; say .close_account(\u0026#39;AAAA00005\u0026#39;); .report; .get_account(\u0026#39;AAAA00001\u0026#39;).withdraw(1001); .report; } è¾“å‡ºï¼š\n[ 123-456-789 [????] ] AAAA00004 (Jan van Quod): balance=9999 AAAA00001 (Leslie Grace): balance=1000 AAAA00005 (OmniCorp LLC): balance=1000000 AAAA00002 (Dana McKenna): balance=10000 AAAA00003 (AstroDynamic): balance=20000000 [ 123-456-789 [????] ] AAAA00004 (Jan van Quod): balance=9999 AAAA00001 (Leslie Grace): balance=1000 AAAA00005 (OmniCorp LLC): balance=1000000 AAAA00002 (Dana McKenna): balance=10000 AAAA00003 (AstroDynamic): balance=20000100 Account.new(name =\u0026gt; \u0026quot;OmniCorp LLC\u0026quot;, balance =\u0026gt; 1000000e0, ID =\u0026gt; \u0026quot;AAAA00005\u0026quot;, tax_record =\u0026gt; {}\u0026lt;\u0026gt;) [ 123-456-789 [????] ] AAAA00004 (Jan van Quod): balance=9999 AAAA00001 (Leslie Grace): balance=1000 AAAA00002 (Dana McKenna): balance=10000 AAAA00003 (AstroDynamic): balance=20000100 Insufficient funds to withdraw 1001 in method withdraw at ~/.rakudobrew/moar-nom/install/share/raku/site/lib/Bank.pm:43 in block \u0026lt;unit\u0026gt; at ~04.bank_demo_unary_dot.pl:22 [Finished in 0.738s] LZW LZW ç®—æ³•:\n demo  #! /usr/bin/env raku sub compress(Str $uncompressed --\u0026gt; List) { # Build a look-up table of encoded representations # (each ASCII char represented by its equivalent codepoint) my %code_for = map { $^ASCII.chr =\u0026gt; $^ASCII }, ^256; # Loop and collect each encoding... gather { # Track which characters we\u0026#39;ve seen but not yet encoded my $already_seen = \u0026#34;\u0026#34;; # Walk through each single character... for $uncompressed.comb -\u0026gt; $next_char { # Now we\u0026#39;ve seen that next character as well my $now_seen = $already_seen ~ $next_char; # If new char sequence is known, keep looking if %code_for{$now_seen}:exists { $already_seen = $now_seen; } # Otherwise, we have an unknown sequence of chars else { # Emit encoding for what we\u0026#39;ve previously seen take %code_for{$already_seen}; # Add encoding for new unknown sequence to table %code_for{$now_seen} = %code_for.elems; # Restart the current sequence from this char $already_seen = $next_char; } } # Emit the encoding for the final sequence (if any) take %code_for{$already_seen} if $already_seen ne \u0026#34;\u0026#34;; } } # Convert to codepoints... my @codes = compress(\u0026#39;To be or not to be. That be the question, matey!\u0026#39;); say @codes; separator; # Emit as characters... say @codesÂ».chr; separator; # Convert to a binary sequence... my $bits_per_code = @codes.max.log(2).ceiling(); my $format = \u0026#39;%0\u0026#39; ~ $bits_per_code ~ \u0026#39;b\u0026#39;; my $bits = @codesÂ».fmt($format).join; say $bits; separator; say $bits.comb(/.**1..7/).map({:2($^bitpattern).chr}).join; separator; sub separator { say \u0026#39;_\u0026#39; x 50 } è¾“å‡ºï¼š\n84 111 32 98 101 32 111 114 32 110 111 116 32 116 257 259 46 32 84 104 97 267 259 268 104 260 113 117 101 115 116 105 111 110 44 32 109 276 101 121 33 __________________________________________________ T o b e o r n o t t Ä Äƒ . T h a Ä‹ Äƒ ÄŒ h Ä„ q u e s t i o n , m Ä” e y ! __________________________________________________ 001010100001101111000100000001100010001100101000100000001101111001110010000100000001101110001101111001110100000100000001110100100000001100000011000101110000100000001010100001101000001100001100001011100000011100001100001101000100000100001110001001110101001100101001110011001110100001101001001101111001101110000101100000100000001101101100010100001100101001111001000100001 __________________________________________________ \u0015\u0006x@1\u000cQo\u001cB\u0001\\7NAt@0\u0018\\\u0010 C aBp\u001c\u00184 CDu\u0019'\u0019h4Ms8,\u0006l(2O\u0011\u0001 __________________________________________________ [Finished in 0.429s]  LZW_functional  #! /usr/bin/env raku # To compress a string... sub compress(Str $uncompressed) { # Encode the character list via a dictionary, from the start encode( $uncompressed.comb, code =\u0026gt; hash(map {$^ASCII.chr =\u0026gt; $^ASCII}, ^256), seen =\u0026gt; \u0026#34;\u0026#34; ) } # Encode an empty list where nothing already seen as nothing multi encode([], :%code, :$seen where \u0026#34;\u0026#34;) {} # Encode an empty list where something already seen by look-up multi encode([], :%code, :$seen) { %code{$seen} } # Encode an list of one or more uncompressed characters... multi encode([$next, *@uncompressed], :%code, :$seen) { # If [already-seen plus next char] is a known sequence... %code{ $seen~$next }:exists # Then encode all of that together ?? encode(@uncompressed, :%code, seen =\u0026gt; $seen~$next) # Else emit encoding for the already-seen sequence !! ( %code{$seen}, # Plus the encoding for the rest of the string... encode( @uncompressed, # Add encoding for new sequence to table code =\u0026gt; %( %code, $seen~$next =\u0026gt; %code.elems ), # Continue encoding from next character seen =\u0026gt; $next ) ) } # Convert to codepoints... my @codes = compress(\u0026#39;To be or not to be. That be the question, matey!\u0026#39;); say @codes; separator; # Emit as characters... say @codesÂ».chr; separator; # Convert to a binary sequence... my $bits_per_code = @codes.max.log(2).ceiling(); my $format = \u0026#39;%0\u0026#39; ~ $bits_per_code ~ \u0026#39;b\u0026#39;; my $bits = @codesÂ».fmt($format).join; say $bits; separator; say $bits.comb(/.**1..7/).map({:2($^bitpattern).chr}).join; separator; sub separator { say \u0026#39;_\u0026#39; x 50 } è¾“å‡ºï¼š\n84 111 32 98 101 32 111 114 32 110 111 116 32 116 257 259 46 32 84 104 97 267 259 268 104 260 113 117 101 115 116 105 111 110 44 32 109 276 101 121 33 __________________________________________________ T o b e o r n o t t Ä Äƒ . T h a Ä‹ Äƒ ÄŒ h Ä„ q u e s t i o n , m Ä” e y ! __________________________________________________ 001010100001101111000100000001100010001100101000100000001101111001110010000100000001101110001101111001110100000100000001110100100000001100000011000101110000100000001010100001101000001100001100001011100000011100001100001101000100000100001110001001110101001100101001110011001110100001101001001101111001101110000101100000100000001101101100010100001100101001111001000100001 __________________________________________________ \u0015\u0006x@1\u000cQo\u001cB\u0001\\7NAt@0\u0018\\\u0010 C aBp\u001c\u00184 CDu\u0019'\u0019h4Ms8,\u0006l(2O\u0011\u0001 __________________________________________________ [Finished in 0.658s]  validation_concurrent  #! /usr/bin/env raku my @records = ( { :Name\u0026lt;Damian Conway\u0026gt;, :Age(42), :ID(\u0026#39;00012345\u0026#39;) }, { :Name\u0026lt;Leslie Duvall\u0026gt;, :Age(29), :ID(\u0026#39;668\u0026#39;) }, { :Name\u0026lt;Sam Georgious\u0026gt;, :Age(-2), :ID(\u0026#39;00000007\u0026#39;) }, ); sub normalize_data (Hash $record) { $record\u0026lt;Name\u0026gt; .= subst(/\u0026lt;lower\u0026gt;/,{$\u0026lt;lower\u0026gt;.uc}, :g); $record\u0026lt;Age\u0026gt; max= 18; $record\u0026lt;ID\u0026gt; .= fmt(\u0026#39;%08d\u0026#39;); } sub report ($outcome) { say \u0026#34;\\tInvalid record ($outcome)\u0026#34;; } sub invalid_name ($rec) { \u0026#34;Bad name: $rec\u0026#34; if $rec\u0026lt;Name\u0026gt; !~~ /\\S/; } sub invalid_age ($rec) { \u0026#34;Bad age: $rec\u0026#34; if $rec\u0026lt;Age\u0026gt; \u0026lt; 18; } sub invalid_ID ($rec) { \u0026#34;Bad ID: $rec\u0026#34; if $rec\u0026lt;ID\u0026gt; !~~ /^\\d**8$/; } say \u0026#39;Validating...\u0026#39;; my @invalidations = ( @recordsÂ».\u0026amp;invalid_name, @recordsÂ».\u0026amp;invalid_age, @recordsÂ».\u0026amp;invalid_ID, ); @invalidationsÂ».\u0026amp;report; say \u0026#39;Normalizing...\u0026#39;; @recordsÂ».\u0026amp;normalize_data; say \u0026#39;Revalidating...\u0026#39;; @invalidations = ( @recordsÂ».\u0026amp;invalid_name, @recordsÂ».\u0026amp;invalid_age, @recordsÂ».\u0026amp;invalid_ID, ); @invalidationsÂ».\u0026amp;report; è¾“å‡ºï¼š\nValidating... postcircumfix:\u0026lt;{ }\u0026gt; not defined for type Str  validation_imperative  #! /usr/bin/env raku my @records = ( { :Name\u0026lt;Damian Conway\u0026gt;, :Age(42), :ID(\u0026#39;00012345\u0026#39;) }, { :Name\u0026lt;Leslie Duvall\u0026gt;, :Age(29), :ID(\u0026#39;668\u0026#39;) }, { :Name\u0026lt;Sam Georgious\u0026gt;, :Age(-2), :ID(\u0026#39;00000007\u0026#39;) }, ); sub normalize_data (Hash $record) { $record\u0026lt;Name\u0026gt; .= subst(/\u0026lt;lower\u0026gt;/,{$\u0026lt;lower\u0026gt;.uc}, :g); $record\u0026lt;Age\u0026gt; max= 18; $record\u0026lt;ID\u0026gt; .= fmt(\u0026#39;%08d\u0026#39;); } sub report ($outcome) { say \u0026#34;\\tInvalid record ($outcome)\u0026#34;; } sub invalid_name ($rec) { \u0026#34;Bad name: $rec\u0026#34; if $rec\u0026lt;Name\u0026gt; !~~ /\\S/; } sub invalid_age ($rec) { \u0026#34;Bad age: $rec\u0026#34; if $rec\u0026lt;Age\u0026gt; \u0026lt; 18; } sub invalid_ID ($rec) { \u0026#34;Bad ID: $rec\u0026#34; if $rec\u0026lt;ID\u0026gt; !~~ /^\\d**8$/; } say \u0026#39;Validating...\u0026#39;; my @invalidations = gather for @records -\u0026gt; $record { take invalid_name($record); take invalid_age($record); take invalid_ID($record); } for @invalidations -\u0026gt; $errmsg { report( $errmsg ); } say \u0026#39;Normalizing...\u0026#39;; for @records -\u0026gt; $record { normalize_data($record); } say \u0026#39;Revalidating...\u0026#39;; @invalidations = gather for @records -\u0026gt; $record { take invalid_name($record); take invalid_age($record); take invalid_ID($record); } for @invalidations -\u0026gt; $errmsg { report( $errmsg ); } è¾“å‡ºï¼š\nValidating... Invalid record (Bad ID: Name\tLeslie Duvall Age\t29 ID\t668) Invalid record (Bad age: Name\tSam Georgious Age\t-2 ID\t00000007) Normalizing... Revalidating...  validation_junctions  #! /usr/bin/env raku my @records = ( { :Name\u0026lt;Damian Conway\u0026gt;, :Age(42), :ID(\u0026#39;00012345\u0026#39;) }, { :Name\u0026lt;Leslie Duvall\u0026gt;, :Age(29), :ID(\u0026#39;668\u0026#39;) }, { :Name\u0026lt;Sam Georgious\u0026gt;, :Age(-2), :ID(\u0026#39;00000007\u0026#39;) }, ); sub normalize_data (Hash $record) { $record\u0026lt;Name\u0026gt; .= subst(/\u0026lt;lower\u0026gt;/,{$\u0026lt;lower\u0026gt;.uc}, :g); $record\u0026lt;Age\u0026gt; max= 18; $record\u0026lt;ID\u0026gt; .= fmt(\u0026#39;%08d\u0026#39;); } sub report ($outcome) { say \u0026#34;\\tInvalid record ($outcome)\u0026#34;; } sub invalid_name ($rec) { \u0026#34;Bad name: $rec\u0026#34; if $rec\u0026lt;Name\u0026gt; !~~ /\\S/; } sub invalid_age ($rec) { \u0026#34;Bad age: $rec\u0026#34; if $rec\u0026lt;Age\u0026gt; \u0026lt; 18; } sub invalid_ID ($rec) { \u0026#34;Bad ID: $rec\u0026#34; if $rec\u0026lt;ID\u0026gt; !~~ /^\\d**8$/; } my $invalid_record = \u0026amp;invalid_name | \u0026amp;invalid_age | \u0026amp;invalid_ID; say \u0026#39;Validating...\u0026#39;; report( $invalid_record(all @records) ); say \u0026#39;Normalizing...\u0026#39;; normalize_data(all @records); say \u0026#39;Revalidating...\u0026#39;; report( $invalid_record(all @records) ); è¾“å‡ºï¼š\nValidating... Invalid record (Bad ID: Name\tLeslie Duvall Age\t29 ID\t668) Invalid record (Bad age: Name\tSam Georgious Age\t-2 ID\t00000007) Normalizing... Revalidating...  prime_demo  #! /usr/bin/env raku sub is_prime(Int $n) { return $n % all(2..$n.sqrt+1); } for 1..1001 -\u0026gt; $n { say \u0026#34;$nis prime\u0026#34; if is_prime($n); } è¾“å‡ºï¼š\n1 is prime 3 is prime 5 is prime 7 is prime 11 is prime ... 991 is prime 997 is prime  ç»Ÿè®¡  #! /usr/bin/env raku my @values = (1, 1, 3, 4, 4, 4, 4, 5, 5, 5, 7, 7, 12, 12, 1, 7, 7, 99); say \u0026#39;mean (a) = \u0026#39;, mean_a(@values); say \u0026#39;mean (g) = \u0026#39;, mean_g(@values); say \u0026#39;mode = \u0026#39;, mode(@values); say \u0026#39;median = \u0026#39;, median(@values); sub mean_a (*@list) { ([+] @list) / @list.elems; } sub mean_g (*@list) { ([*] @list) ** (1/@list.elems); } sub mode (*@list) { given @list.Bag { .pairs.grep({$^elem.value == .values.max})Â».key; } } sub median (*@list) { given @list.sort { .elems %% 2 ?? mean_a( .[*/2-1, */2] ) !! .[*/2]; } } è¾“å‡ºï¼š\nmean (a) = 10.444444 mean (g) = 4.95872541158849 mode = 7 4 median = 5  stats_hybird  #! /usr/bin/env raku my @values = (1, 1, 3, 4, 4, 4, 4, 5, 5, 5, 7, 7, 12, 12, 1, 7, 7, 99); say \u0026#39;mean (a) = \u0026#39;, mean_a(@values); say \u0026#39;mean (g) = \u0026#39;, mean_g(@values); say \u0026#39;mode = \u0026#39;, mode(@values); say \u0026#39;median = \u0026#39;, median(@values); sub mean_a (*@list) { my $sum = [+] @list; return $sum / @list.elems; } sub mean_g (*@list) { my $product = [*] @list; return $product ** (1/@list.elems) } sub mode (*@list) { my $frequencies = @list.Bag; my $list_elems = $frequencies.pairs; my $max_freq = $frequencies.values.max; my @max_vals = $list_elems.grep({.value == $max_freq}); return @max_valsÂ».key; } sub median (*@list) { my @sorted = @list.sort; return @sorted.elems %% 2 ?? mean_a(@sorted.[*/2, */2-1]) !! @sorted.[*/2] } è¾“å‡ºï¼š\nmean (a) = 10.444444 mean (g) = 4.95872541158849 mode = 7 4 median = 5  stats_imperative  #! /usr/bin/env raku my @values = (1, 1, 3, 4, 4, 4, 4, 5, 5, 5, 7, 7, 12, 12, 1, 7, 7, 99); say \u0026#39;mean (a) = \u0026#39;, mean_a(@values); say \u0026#39;mean (g) = \u0026#39;, mean_g(@values); say \u0026#39;mode = \u0026#39;, mode(@values); say \u0026#39;median = \u0026#39;, median(@values); sub mean_a (*@list) { my $sum; for @list -\u0026gt; $elem { $sum += $elem; } return $sum / @list.elems; } sub mean_g (*@list) { my $product; for @list -\u0026gt; $elem { $product *= $elem; } return $product ** (1/@list.elems); } sub mode (*@list) { my %counts; %counts{$_}++ for @list; my $max = %counts.values.max; return %counts.grep({ .value == $max })Â».key; } sub median (*@list) { @list.=sort(); return @list.elems %% 2 ?? mean_a( @list[*/2, */2-1] ) !! @list[*/2]; } è¾“å‡ºï¼š\nmean (a) = 10.444444 mean (g) = 4.95872541158849 mode = 4 7 median = 5  stats_mode_func  #! /usr/bin/env raku my @values = (1, 1, 3, 4, 4, 4, 4, 5, 5, 5, 7, 7, 12, 12, 1, 7, 7, 99); say \u0026#39;mean (a) = \u0026#39;, mean_a(@values); say \u0026#39;mean (g) = \u0026#39;, mean_g(@values); say \u0026#39;mode = \u0026#39;, mode(@values); say \u0026#39;median = \u0026#39;, median(@values); sub mean_a (*@list) { sub sum { [+] @list } return sum() / @list.elems; } sub mean_g (*@list) { sub product { [*] @list } return product() ** (1/@list.elems) } sub mode (*@list) { sub frequencies { @list.Bag } sub list_elems { frequencies.pairs } sub max_freq { frequencies.values.max } sub max_vals { list_elems.grep: {.value == max_freq} } return max_valsÂ».keys; } sub median (*@list) { sub sorted { @list.sort } return sorted.elems %% 2 ?? mean_a(sorted.[*/2, */2-1]) !! sorted.[*/2] } è¾“å‡ºï¼š\nmean (a) = 10.444444 mean (g) = 4.95872541158849 mode = 7 4 median = 5  stats_OO  #! /usr/bin/env raku class StatList is List { method mean_a () { sub sum { [+] self } return sum() / self.elems; } method mean_g () { sub product { [*] self } return product() ** (1/self.elems) } method median () { sub sorted { self.sort } return sorted.elems %% 2 ?? StatList.new(sorted.[*/2, */2-1]).mean_a() !! sorted.[*/2]; } method mode () { sub frequencies { self.Bag } sub list_elems { frequencies.pairs } sub max_freq { frequencies.values.max } sub max_vals { list_elems.grep: {.value == max_freq} } return max_valsÂ».keys; } } my $list = StatList.new(1,3,5,8,8,11); say $list.mean_a; say $list.mean_g; say $list.median; say $list.mode; è¾“å‡ºï¼š\n6 4.68393277169202 13 8  ä»¥ä¸Šæ‰€æœ‰æ–‡ä»¶éƒ½å¯ä»¥åœ¨è¿™å„¿ ä¸‹è½½åˆ° - a Raku introductory tutorial by Damian Conway\n ","permalink":"https://ohmyweekly.github.io/notes/2016-02-14-raku-examples/","tags":["example"],"title":"Raku ä»£ç ç¤ºä¾‹"},{"categories":["rakulang"],"contents":"åœ¨ grammar ä¸­, æœ‰ä¸¤ä¸ª regex çš„å˜ä½“, rule å’Œ tokenã€‚rule é»˜è®¤ä¸ä¼šå›æº¯ã€‚rule ä¸ token çš„ä¸€ä¸ªé‡è¦åŒºåˆ«å°±æ˜¯, rule è¿™æ ·çš„æ­£åˆ™é‡‡å–äº† :sigspace ä¿®é¥°ç¬¦ã€‚ rule å®é™…ä¸Šæ˜¯\nregex :ratchet :sigspace { ... } çš„ç®€å†™ã€‚ratchet è¿™ä¸ªå•è¯çš„æ„æ€æ˜¯: (é˜²å€’è½¬çš„)æ£˜é½¿, æ„æ€å®ƒæ˜¯ä¸èƒ½å›æº¯çš„! è€Œ :sigspace è¡¨æ˜æ­£åˆ™ä¸­çš„ç©ºç™½æ˜¯æœ‰æ„ä¹‰çš„, è€Œ token å®é™…ä¸Šæ˜¯\nregex :ratchet { ... } çš„ç®€å†™ã€‚æ‰€ä»¥åœ¨ token ä¸­, è‹¥ä¸æ˜¯æ˜¾å¼åœ°å†™ä¸Š \\sã€\\hã€\\n ç­‰ç©ºç™½ç¬¦å·, å…¶å®ƒæƒ…å†µä¸‹å°±å¥½åƒç©ºç™½éšèº«äº†ä¸€æ ·, è™½ç„¶ä½ å†™äº†, ä½†æ˜¯ç¼–è¯‘å™¨å´è§†è€Œä¸è§ã€‚\ngrammar Token::Rule::Difference { # ä¸‹é¢ä¸‰è€…ç­‰ä»· # rule TOP { [\\w+]+ % \u0026#39; \u0026#39; | [\\d+]+ % \u0026#39; \u0026#39; } ç­‰ä»·äº # rule TOP { | [\\w+]+ % \u0026#39; \u0026#39; | [\\d+]+ % \u0026#39; \u0026#39; } ç­‰ä»·äº rule TOP {|[\\w+]+%\u0026#39;\u0026#39;|[\\d+]+%\u0026#39;\u0026#39;} } # $=finish.lines ä¸­çš„æ¯ä¸€è¡Œæœ«å°¾éƒ½æ²¡æœ‰æ¢è¡Œç¬¦ for $=finish.lines -\u0026gt; $line { print($line); say Token::Rule::Difference.parse($line) } =finishtoken takes whitespace invisible unless with sigspace rule is a token without sigspace 2015 12 25 2016 01 07 è¯´æ˜åœ¨ rule ä¸­, | å·¦å³ä¸¤è¾¹çš„ç©ºæ ¼ä¼šè¢«å¿½ç•¥, è¿™é€šå¸¸æ˜¯ä¸ºäº†ä½¿æ ¼å¼å¯¹é½, çœ‹èµ·æ¥ä¸ä¹±ã€‚å¦å¤– rule ä¸­, å¼€å¤´å’Œæœ«å°¾çš„ç©ºç™½ä¹Ÿä¼šè¢«å¿½ç•¥ã€‚\nå¦‚æœæ¯ä¸€è¡Œéƒ½å¸¦æœ‰æ¢è¡Œç¬¦å‘¢ï¼Ÿ\nuse Grammar::Debugger; grammar Token::Rule::Difference { # token TOP { ^ [\u0026lt;line\u0026gt;\\n]+ $ } # token line { # | [\\w+]+ % \u0026#39; \u0026#39; # | [\\d+]+ % \u0026#39; \u0026#39; # } # ç­‰ä»·äº rule TOP {^\u0026lt;wrap\u0026gt;+$} token wrap {\u0026lt;line\u0026gt;} rule line {[\\w+]+%\u0026#39;\u0026#39;|[\\d+]+%\u0026lt;[-\\s:]\u0026gt;} } my $str=q:to/EOF/; token takes whitespace invisible unless with sigspace rule is a token without sigspace 2015-12-25 12:23 2016-01-07 13:45 EOF my $parse = Token::Rule::Difference.parse($str); say $parse; token vs. rule  When we use rule in place of token, any whitespace after anatom is turned into a non-capturing call to ws\n è¿™å¥è¯æ˜¯è¯´, åœ¨ rule ä¸­, ä»»ä½•è·Ÿåœ¨åŸå­(atom)åé¢çš„ç©ºç™½ä¼šå˜æˆéæ•è·çš„ ws è°ƒç”¨, å³ \u0026lt;.ws\u0026gt;,\nrule entry {\u0026lt;key\u0026gt;\u0026#39;=\u0026#39;\u0026lt;value\u0026gt;} ç­‰ä»·äº:\ntoken entry {\u0026lt;key\u0026gt;\u0026lt;.ws\u0026gt;\u0026#39;=\u0026#39;\u0026lt;.ws\u0026gt;\u0026lt;value\u0026gt;\u0026lt;.ws\u0026gt;} # . æŠ‘åˆ¶äº†æ•è· åœ¨ grammar ä¸­, æˆ‘ä»¬ç»§æ‰¿äº†é»˜è®¤çš„ ws, ä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥æä¾›è‡ªå·±çš„ ws:\ntoken ws {\\h*} # åŒ¹é…æ°´å¹³ç©ºç™½, ä¸åŒ…æ‹¬æ¢è¡Œ rule ä¸­ç©ºç™½çš„ä½¿ç”¨:\nmy $str = \u0026#34;Swift is hard to learn\u0026#34;; my token word {\\w+} my rule line {\u0026lt;word\u0026gt;+%[\u0026#39;,\u0026#39;]} $str ~~ m:g/\u0026lt;line\u0026gt;/; é€—å·é™„è¿‘çš„æ–¹æ‹¬å·ä¿è¯äº† \u0026lt;.ws\u0026gt; è°ƒç”¨äº§ç”Ÿçš„ç©ºç™½ä½œä¸ºåˆ†å‰²ç¬¦çš„ä¸€éƒ¨åˆ†ã€‚è¿™åˆ©ç”¨äº† \u0026lt;.ws\u0026gt; çš„ä¸€ä¸ªç‰¹ç‚¹ï¼š\nåœ¨ä¸¤ä¸ª \\w ä¹‹é—´è§£é‡Šä¸º \\s+, å…¶å®ƒåœ°æ–¹è§£é‡Šä¸º \\s*ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2016-03-11-difference-between-rules-and-tokens/","tags":["token","rule"],"title":"token å’Œ rule çš„åŒºåˆ«"},{"categories":["rakulang"],"contents":"Multi ç¨‹åºç›¸å½“æ•´æ´, ä½†å¯¹äºæˆ‘æ¥è¯´ä¼¼ä¹å¹¶ä¸å®Œæ•´ã€‚ä¸€äº›èƒŒæ™¯ â€” äººä»¬å¯ä»¥è¿™æ ·è®¡ç®—é˜¶ä¹˜:\nmulti fac(0) { 1 } multi fac(Int $n where 1..Inf) { $n * fac( $n-1 ) } say fac(4); # 24 ç°åœ¨å‡è®¾æˆ‘ä»¬è¦æŠŠæˆ‘ä»¬çš„é€’å½’ multi-sub ä½œä¸ºä¸€ä¸ªå›è°ƒä¼ é€’ä¼šæ€æ ·å‘¢ï¼Ÿ\ngiven \u0026amp;fac -\u0026gt; $some_fun { say \u0026#34;some_fun(4)=\u0026#34;, $some_fun(4) } ç°åœ¨\u0026hellip; å®šä¹‰ä¸€ä¸ªåŒ¿åçš„ multi-sub æ€ä¹ˆæ ·ï¼Ÿ\nmy $anon_fac = do { multi hidden_fac(0) { 1 } multi hidden_fac(Int $n where 1..Inf) { $n * fac( $n - 1 ) } \u0026amp;hidden_fac }; say $anon_fac(4); # 24 è¿™ä¹Ÿä¼šæœ‰ä½œç”¨, ä½†æ˜¯æœ‰ç‚¹ hack çš„å‘³é“, å¹¶ä¸”æˆ‘ä»¬çš„ multi-sub å¹¶ä¸æ˜¯çœŸæ­£çš„åŒ¿åã€‚å®ƒä»…ä»…æ˜¯è¢«éšè—äº†ã€‚çœŸæ­£åŒ¿åçš„å¯¹è±¡ä¸ä¼šåœ¨ä»»ä½•ä½œç”¨åŸŸä¸­å®‰è£…, è€Œåœ¨è¿™ä¸ªä¾‹å­ä¸­, \u0026ldquo;hidden_fac\u0026rdquo; è¢«å®‰è£…åœ¨ \u0026ldquo;do\u0026rdquo; block ä¸­çš„æœ¬åœ°ä½œç”¨åŸŸä¸­ã€‚\nRakuè¯´æ˜ä¹¦æ²¡æœ‰æ’é™¤åŒ¿åçš„ multi ç¨‹åº, è€Œä¸”äº‹å®ä¸Š\nmy $anon_fac = anon multi sub(0) { 1 } ä¼šæŠ¥ä¸€ä¸ªé”™è¯¯:\n Cannot use \u0026lsquo;anon\u0026rsquo; with individual multi candidates. Please declare an anon-scoped proto instead\n ä¸èƒ½å¯¹å•ç‹¬çš„ multi å€™é€‰è€…ä½¿ç”¨ anonã€‚è¯·å£°æ˜ä¸€ä¸ª anon-scoped çš„ proto ä»£æ›¿ã€‚\nè®©æˆ‘ä»¬å›åˆ°åŸå…ˆé‚£ä¸ªä»¥ \u0026ldquo;multi fac(0) { 1 }\u0026rdquo; å¼€å§‹çš„ä¾‹å­ã€‚å½“ç¼–è¯‘å™¨çœ‹åˆ°å®ƒ, å°±ä¼šåœ¨åŒä¸€ä¸ªä½œç”¨åŸŸä¸­ä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª\u0026quot;proto fac\u0026quot; ä½œä¸º multi å®šä¹‰ã€‚proto çš„ä½œç”¨å°±åƒä¸€ä¸ªåˆ†å‘å™¨(dispatcher) â€” ä»æ¦‚å¿µä¸Šè®², å½“æˆ‘ä»¬è°ƒç”¨ fac(4) çš„æ—¶å€™, æˆ‘ä»¬è®© proto fac ä¸ºæˆ‘ä»¬ä» multi facs ä¸­æŒ‘é€‰ä¸€ä¸ªå‡ºæ¥ä»¥è°ƒç”¨ã€‚\næˆ‘ä»¬å¯ä»¥æå‰æ˜¾å¼åœ°å®šä¹‰ä¸€ä¸ª proto, è€Œä¸”æˆ‘ä»¬ç”šè‡³èƒ½é€šè¿‡æŒ‡å®šå®ƒçš„æ‰€æœ‰ç¨‹åºéƒ½éœ€è¦ Int ç±»å‹çš„å‚æ•°æ¥å¯¹é»˜è®¤çš„ \u0026ldquo;proto\u0026rdquo; åŠ ä»¥æ”¹è‰¯ã€‚\nproto fac_with_proto(Int) { * } multi fac_with_proto(0) { 1 } multi fac_with_proto(Int $n where 1..Inf) { $n * fac( $n - 1 ) } say fac_with_proto(4); # 24 å› æ­¤, anon muiti sub æŠ›å‡ºçš„é”™è¯¯ â€” Please declare an anon-scoped proto instead â€” æ­£æ˜¯å‘Šè¯‰æˆ‘ä»¬ \u0026ldquo;æ²¡æœ‰è¦å®‰è£…åˆ°çš„ä½œç”¨åŸŸ, æˆ‘ä¸èƒ½ä¸ºä½ è·å–ä¸€ä¸ª protoã€‚ ä½¿ç”¨ä½ è‡ªå·±çš„ anon proto, å¹¶æŠŠè¿™ä¸ªç¨‹åºé™„åŠ ç»™å®ƒ\u0026rdquo;ã€‚\nå¥½çš„, èŠ±è´è¶, æ„Ÿè°¢ä½ çš„æé†’! æˆ‘è¯•è¯•\u0026hellip;\nmy $fac_proto = anon proto uninstalled-fac(Int) { * }; say $fac_proto.name; # uninstalled-fac å¥½æäº†! ç°åœ¨æ‰€æœ‰æˆ‘ä»¬è¦åšçš„å°±æ˜¯ç»™é‚£ä¸ª proto æ·»åŠ  multisã€‚\n$fac_proto æ˜¯ä¸€ä¸ª Sub å¯¹è±¡, å®ƒæœ‰æ–¹æ³•æ¥å‘Šè¯‰ä½ å€™é€‰è€…, ä½†æ˜¯æ²¡æœ‰åŠæ³•è®¾ç½®(set) å€™é€‰è€…ã€‚å¹¶ä¸”æˆ‘æ‰¾ä¸åˆ°ä»»ä½•æ–¹å¼åœ¨åˆ›å»ºæ—¶ä¼ é€’ä¸€ä¸ªå€™é€‰è€…åˆ—è¡¨ã€‚\né€‚å½“çš„ä¿®è¡¥  ä»€ä¹ˆä¼šè®© proto/multi å¹²å‡€å¹¶ä¸”æ­£äº¤æ˜¯ä¸€ç§æ–¹å¼å»\n åœ¨ç¼–è¯‘æ—¶æŒ‡å®šå€™é€‰è€… åœ¨è¿è¡Œæ—¶æ·»åŠ å€™é€‰è€…  è¿™æœ‰ç‚¹åƒ\nmy $future_fac = Proto( :dispatch( sub (Int) {*} ), :candidates( [sub (0) {1}] ), :mutable ); $future_fac.candidates.push( sub (Int $n where 1..Inf) { $n * fac( $n-1 ) } ); $future_fac(4); # 24 æˆ‘å‡å®šäº†ä¸€ä¸ª Sub çš„å­ç±» Proto ä»¥æ­éœ² multi ç¨‹åºçš„å†…éƒ¨å·¥ä½œåŸç†ã€‚è¿™ä¸ªæ„é€ å‡½æ•°ä¼šå…è®¸å®šä¹‰ä»»ä½• proto å£°æ˜ç¬¦æ‰€åšçš„: ç­¾å \u0026amp; é»˜è®¤ç¨‹åºå’Œåå­—ã€‚ è¿˜æœ‰, å®ƒä¼šå…è®¸åœ¨åˆå§‹çš„å€™é€‰è€…åˆ—è¡¨ä¸­ä¼ é€’ä¸€ä¸ªå±æ€§ã€‚\næœ€å, é‚£ä¸ªå¯¹è±¡è‡ªèº«ä¼šè®©å€™é€‰è€…æ–¹æ³•è¿”å›ä¸€ä¸ªæ•°ç»„, è€Œä¸æ˜¯ä¸€ä¸ªä¸å¯å˜åˆ—è¡¨, å¦‚æœ Proto æ˜¯ä½¿ç”¨ mutable å±æ€§åˆ›å»ºçš„è¯ã€‚ä¸æŒ‡å®š mutable å°†æ„å‘³ç€æ‰€æœ‰çš„ multis éœ€è¦åœ¨ç¼–è¯‘æ—¶æ·»åŠ , è€Œä¸å…è®¸åœ¨è¿è¡Œæ—¶æ·»åŠ ã€‚\nhttp://blogs.perl.org/users/yary/2016/02/apropos-proto-perl6c-multi-thoughts.html\n","permalink":"https://ohmyweekly.github.io/notes/2016-02-11-multi-thoughts/","tags":["proto"],"title":"æ­£ç¡®åœ°ä½¿ç”¨ proto"},{"categories":["rakulang"],"contents":"##Â A Mutable Grammar For Raku\nRules Rules å°±åƒ perl5çš„ regexes, å¹¶ä¸”æ›´å¥½ã€‚å®ƒä»¬åƒå­ä¾‹ç¨‹å’Œæ–¹æ³•é‚£æ ·ç”³æ˜, å¹¶ä¸”è¿˜èƒ½è°ƒç”¨å…¶å®ƒ rules\nä¸‹é¢æ˜¯ä¸€ä¸ªè§£æ Raku åŸºæœ¬å˜é‡åçš„ä¾‹å­ï¼š\ngrammar Raku { # token alpha æ˜¯ä¸€ä¸ªé¢„å®šä¹‰å¥½çš„ rule token identifier {\u0026lt;alpha\u0026gt;\\w+} # åŒ¹é…ä¸€ä¸ªå…¨é™å®šåæ ‡è¯†ç¬¦ # [ ... ] æ˜¯éæ•è·ç»„ token name {\u0026lt;identifier\u0026gt;[\u0026#39;::\u0026#39;\u0026lt;identifier\u0026gt;]*} # .. | .. æ˜¯åˆ†æ”¯. æœ€é•¿åŒ¹é…èƒœå‡º. token sigil {\u0026#39;$\u0026#39;|\u0026#39;@\u0026#39;|\u0026#39;\u0026amp;\u0026#39;|\u0026#39;%\u0026#39;|\u0026#39;::\u0026#39;} # \u0026lt;rule\u0026gt; è°ƒç”¨å‘½å rule, éšå¼åœ°é”šå®šåœ¨å½“å‰ä½ç½® token variable {\u0026lt;sigil\u0026gt;\u0026lt;name\u0026gt;} }Â Grammars Grammar è·Ÿç±»å¾ˆåƒ, å«æœ‰ rules è€Œä¸æ˜¯ methodsã€‚Grammars æ˜¯ rules çš„é›†åˆå¹¶æ”¯æŒç»§æ‰¿ã€‚\nå¦‚æœè¦æ±‚ Raku ä¸­å˜é‡çš„åå­—å¿…é¡»å¤§å†™ï¼š\n# æˆ‘ä»¬ç»§æ‰¿åŸæ¥é‚£ä¸ª grammar grammar PERL6 is Raku { # ... é‡å†™æˆ‘ä»¬æƒ³æ”¹å˜çš„è§£æè§„åˆ™ token identifier {# Raku ä¸­çš„å­—ç¬¦ç±»ç°åœ¨å†™ä½œ \u0026lt;[ ... ]\u0026gt; \u0026lt;[A..Z]\u0026gt;\u0026lt;[A..Z0..9_]\u0026gt;*} } ç°åœ¨æˆ‘ä»¬åªéœ€å‘Šè¯‰ç¼–è¯‘å™¨ä½¿ç”¨ PERL6 è¿™ä¸ª grammar è€Œéé»˜è®¤ grammar ã€‚è¿˜è®°å¾—ç±»ä¸­çš„æ–¹æ³•è°ƒç”¨é¡ºåºå—ï¼Ÿ å…ˆä»æœ¬ç±»å¼€å§‹, æ²¿ç€ç»§æ‰¿æ ‘ä»ä¸‹è€Œä¸Šåˆ°çˆ¶ç±»ã€‚Grammar ä¸ä¹‹ç±»ä¼¼ã€‚\nç„¶è€Œæœ‰ä¸€ä¸ªç¼ºé™·ã€‚å‡è®¾ä½ æƒ³æ›´æ”¹ä¸€ä¸ªç¬¦å·, ä¾‹å¦‚æŠŠ $Â æ›´æ”¹ ä¸º Â¢ï¼ˆå› ä¸ºä½ æ²¡æœ‰è¶³å¤Ÿçš„ $$$ æ¥ä¹°ä¸‹æ‰€æœ‰çš„å˜é‡, ä¸æ˜¯å—ï¼Ÿï¼‰çœ‹èµ·æ¥å¾ˆç®€å•ï¼š\ngrammar LowBudgetRaku is Raku { # token å°±åƒç±»ä¸­çš„æ–¹æ³•ä¸€æ ·, ç»§æ‰¿åå¯ä»¥ä¿®æ”¹ token sigil {\u0026#39;Â¢\u0026#39;|\u0026#39;@\u0026#39;|\u0026#39;\u0026amp;\u0026#39;|\u0026#39;%\u0026#39;|\u0026#39;::\u0026#39;} } æ–°çš„ grammar è§£æå·¥ä½œçš„å¾ˆå¥½, ä½†æ˜¯é‚£ä¹‹åçš„æ‰€æœ‰ä¸œè¥¿è‚¯å®šä¼šå¤±è´¥ã€‚å½“ç¼–è¯‘å™¨åœ¨è§£ææ ‘é‡Œçœ‹è§ sigil åŒ¹é…æ—¶, å®ƒå¾—æ‰¾å‡ºåˆ°åº•æ˜¯å“ªä¸€ä¸ª - è¿™æ„å‘³ç€å®ƒå¿…é¡»è¦æ£€æŸ¥åŒ¹é…æ–‡æœ¬çš„å­—é¢å€¼, è€Œå®ƒå¹¶ä¸çŸ¥é“æ€ä¹ˆå¤„ç† Â¢ã€‚\næ‰€ä»¥, æˆ‘ä»¬éœ€è¦æ›´å¤šçš„æŠ€èƒ½\u0026hellip;\nProto Regexes Â proto regex æ˜¯ä¸€å¥—æœ‰ç€ç›¸åŒåå­—çš„ regexes/rules, å½“å‰çš„Â Raku grammarÂ ä½¿ç”¨è¿™ä¸ªç»“æ„ï¼š\nproto token sigil {*} # ... token sigil:sym\u0026lt;$\u0026gt; {\u0026lt;sym\u0026gt;} token sigil:sym\u0026lt;@\u0026gt; {\u0026lt;sym\u0026gt;} token sigil:sym\u0026lt;%\u0026gt; {\u0026lt;sym\u0026gt;} token sigil:sym\u0026lt;\u0026amp;\u0026gt; {\u0026lt;sym\u0026gt;} token sigil:sym\u0026lt;::\u0026gt; {\u0026lt;sym\u0026gt;} è¿™åˆ›å»ºäº†ä¸€ä¸ªå«åš sigilÂ çš„ç»„(proto), ç»„é‡Œé¢æœ‰ä½¿ç”¨ symÂ æ ‡è¯†ç¬¦å‚æ•°åŒ–çš„ 5 ä¸ªè§„åˆ™(rules)ï¼ˆå®ƒä»¬å±äºè¿™ä¸ªç»„å› ä¸ºå®ƒä»¬è·Ÿç»„çš„åå­—ç›¸åŒï¼‰ã€‚ ç¬¬ä¸€ä¸ªæŠŠ symÂ è®¾ç½®ä¸ºÂ $Â ç„¶ååŒ¹é…è¿™ä¸ªç¬¦å·(ä½¿ç”¨\u0026lt;sym\u0026gt;). ç¬¬äºŒä¸ªåŒ¹é… @ ç­‰ç­‰ã€‚ç°åœ¨å¦‚æœè°ƒç”¨è§„åˆ™ \u0026lt;sigil\u0026gt;, ä½ ä¼šå¾—åˆ°ä¸€ä¸ªå«æœ‰ä¸Šè¿°æ‰€æœ‰ 5 ä¸ªè§„åˆ™çš„åˆ—è¡¨, åˆ—è¡¨å…ƒç´ ä¹‹é—´æ˜¯æˆ–çš„å…³ç³»ã€‚æ‰€ä»¥å®ƒä¾ç„¶è·Ÿæ­£åˆ™ '$' | '@' | '%' | '\u0026amp;' | '::'Â åŒ¹é…ç›¸åŒçš„ä¸œè¥¿, ä½†æ˜¯æ›´å®¹æ˜“æ‰©å±•ã€‚\nå¦‚æœä½ æƒ³æ·»åŠ ä¸€ä¸ªæ–°çš„ç¬¦å·, Grammar ä¸­å”¯ä¸€è¦ä¿®æ”¹çš„å°±æ˜¯æ·»åŠ å¦å¤–ä¸€ä¸ª sigil è§„åˆ™ï¼šÂ grammar SigilRichP6 is Raku { token sigil:sym\u0026lt;Ä§\u0026gt; {\u0026lt;sym\u0026gt;} # ç‰©ç†å­¦å®¶ä¼šå¾ˆçˆ±ä½  } å›åˆ°åŸæ¥é‚£ä¸ªä¾‹å­, ä½ å¯ä»¥é‡å†™å·²å­˜åœ¨çš„è§„åˆ™ï¼š\ngrammar LowBudgetRaku is Raku { token sigil:sym\u0026lt;$\u0026gt; {\u0026#39;Â¢\u0026#39;} } ç°åœ¨è¿™ä¸ª grammar ä¸ºæ ‡é‡ä½¿ç”¨äº†ä¸€ä¸ªä¸åŒçš„ç¬¦å·, ä½†æ˜¯å®ƒå’ŒåŸæ¥çš„ grammar æœ‰ç€ç›¸åŒçš„è§„åˆ™å’Œç›¸åŒçš„å‚æ•°(sigil:sym\u0026lt;$\u0026gt;), ç¼–è¯‘å™¨ä»ç„¶çŸ¥é“æ€ä¹ˆå¤„ç†å®ƒã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2015-11-16-a-mutable-grammar-for-raku/","tags":["grammar"],"title":"A Mutable Grammar for Raku"},{"categories":["rakulang"],"contents":"comb - æ“ä½œå­—ç¬¦ä¸²çš„åˆ©å™¨\ncomb å­ä¾‹ç¨‹ comb å­ä¾‹ç¨‹çš„å®šä¹‰ä¸ºï¼š\nmulti sub comb(Regex $matcher, Str(Cool) $input, $limit = *) returns List:D multi method comb(Regex $matcher, $limit = *) returns List:D ç”¨æ³•ï¼š\ncomb /PATTERN/, STRING, LIMIT? # å­ä¾‹ç¨‹å½¢å¼ STRING.comb(/PATTERN/, LIMIT?) # æ–¹æ³•å½¢å¼ è¿”å›è°ƒç”¨è€…ï¼ˆæ–¹æ³•å½¢å¼ï¼‰çš„æ‰€æœ‰ï¼ˆæˆ–è€…è‡³å¤š $limit ä¸ªï¼Œå¦‚æœæä¾›äº†çš„è¯ï¼‰åŒ¹é…ï¼Œæˆ–è€…è¿”å›ç¬¬äºŒä¸ªå‚æ•°ï¼ˆsub å½¢å¼ï¼‰ä¸ Regex ç›¸åŒ¹é…çš„å­—ç¬¦ä¸²åˆ—è¡¨ã€‚\nsay \u0026#34;6 or 12\u0026#34;.comb(/\\d+/).join(\u0026#34;, \u0026#34;); # 6, 12 Str ç±»ä¸­çš„ comb multi sub comb(Str:D $matcher, Str:D $input, $limit = Inf) multi sub comb(Regex:D $matcher, Str:D $input, $limit = Inf, Bool :$match) multi sub comb(Int:D $size, Str:D $input, $limit = Inf) multi method comb(Str:D $input:) multi method comb(Str:D $input: Str:D $matcher, $limit = Inf) multi method comb(Str:D $input: Regex:D $matcher, $limit = Inf, Bool :$match) multi method comb(Str:D $input: Int:D $size, $limit = Inf) åœ¨ $input ä¸­æœç´¢ $matcher å¹¶è¿”å›æ‰€æœ‰åŒ¹é…ï¼ˆé»˜è®¤æ˜¯ Strï¼Œæˆ–è€…æ˜¯ Match å¯¹è±¡ï¼Œå¦‚æœ $match ä¸ºçœŸçš„è¯ï¼‰çš„ä¸€ä¸ªåˆ—è¡¨ã€‚$limit è¡¨ç¤ºè‡³å¤šè¿”å› $limit ä¸ªåŒ¹é…ã€‚\nå¦‚æœæ²¡æœ‰æä¾› $matcher(åŒ¹é…å™¨)ï¼Œ é‚£ä¹ˆä¼šè¿”å›å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰å­—ç¬¦çš„åˆ—è¡¨ã€‚ç­‰ä»·äºä½¿ç”¨äº† $matcher = rx/./ã€‚\nä¾‹å­ï¼š\ncomb(/\\w/, \u0026#34;a;b;c\u0026#34;).perl; # (\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;).list comb(/\\N/, \u0026#34;a;b;c\u0026#34;).perl; # (\u0026#34;a\u0026#34;, \u0026#34;;\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;;\u0026#34;, \u0026#34;c\u0026#34;).list comb(/\\w/, \u0026#34;a;b;c\u0026#34;, 2).perl; # (\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;).list comb(/\\w\\;\\w/, \u0026#34;a;b;c\u0026#34;, 2).perl; # (\u0026#34;a;b\u0026#34;,).list \u0026#34;123abc456def\u0026#34;.comb(3) # (123 abc 456 def) \u0026#34;123abc456def\u0026#34;.comb(3,2); # (123 abc) å¦‚æœåŒ¹é…å™¨ï¼ˆmatcherï¼‰æ˜¯ä¸€ä¸ªæ•´æ•°å€¼ï¼Œé‚£ä¹ˆå®ƒè¢«è®¤ä¸ºå’Œ /. ** matcher/ ç±»ä¼¼ï¼Œä½†æ˜¯è¿™ä¸ªå¿«äº† 30 å€ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2016-02-03-comb-in-raku/","tags":["comb"],"title":"comb - æ“ä½œå­—ç¬¦ä¸²çš„åˆ©å™¨"},{"categories":["rakulang"],"contents":"ä½ æ˜¯ä¸€ä¸ªåˆšæˆç«‹çš„å°å…¬å¸é‡Œçš„ä¸€åè½¯ä»¶å·¥ç¨‹å¸ˆ, æœ‰å¤©æ™šä¸Šä½ æ”¶åˆ°äº†ä¸€å°æ¥è‡ª CEO çš„ç”µå­é‚®ä»¶:\n äº²çˆ±çš„å·¥ç¨‹å¸ˆ,\nâ€‹ å¥½æ–°é—»ï¼çœ‹èµ·æ¥æˆ‘ä»¬çš„ç½‘ç«™è¶Šæ¥è¶Šå—æ¬¢è¿ã€‚æˆ‘ä»¬è¦å˜çš„æœ‰é’±äº†! æ¯ç§’é’Ÿæœ‰æˆåƒä¸Šä¸‡çš„äººåœ¨åŒæ—¶è®¿é—®æˆ‘ä»¬çš„ç½‘ç«™, è€Œä¸”è¿˜åœ¨å¿«é€Ÿå¢é•¿ã€‚\næˆ‘ä»¬å¿…é¡»ç«‹å³è¯†åˆ«å‡ºè°çš„é€šä¿¡é‡æœ€å¤§ã€‚å¹¸è¿çš„æ˜¯æˆ‘çš„æœ‹å‹ç»™æˆ‘å‘é€äº†ä¸€ä»½å·¨å¤§çš„ IP åœ°å€å’Œåå­—çš„åˆ—è¡¨ã€‚å¾ˆé…·ä¸æ˜¯å—ï¼Ÿä½ èƒ½å†™ä¸€æ®µç¨‹åºæ¥æ”¶æˆ‘ä»¬å¤§é‡çš„è®¿é—®è€…, æŠŠå®ƒå’Œåœ°å€/åå­—åˆ—è¡¨ç›¸æ¯”, å¹¶åˆ›å»ºä¸€äº›ç»Ÿè®¡å—ï¼Ÿæˆ‘çš„æ„æ€æ˜¯, ç”Ÿæˆä¸€ä¸ªå›½å®¶çš„åå­—åˆ—è¡¨ã€‚\nåšå¥½äº†çš„è¯æˆ‘ç»™ä½ ä»¬å¼€ä¸ªæŠ«è¨èšä¼šã€‚\n  é‚®ä»¶çš„é™„ä»¶æ–‡ä»¶åŒ…å«äº†ä¸€ä¸ª IP åœ°å€å’Œåå­—çš„åˆ—è¡¨ã€‚å†™ä¸€ä¸ªç¨‹åºæ¥ç»Ÿè®¡ä¸‹æœ‰å¤šå°‘ IP è®¿é—®äº†ä½ çš„ç½‘ç«™ã€‚\n è¾“å…¥æè¿° è¾“å…¥æ¥è‡ªä¸¤éƒ¨åˆ†ã€‚ç¬¬ä¸€ä¸ªæ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶, åŒ…å« IP åœ°å€èŒƒå›´ã€‚æ¯è¡Œä¸€é¡¹,ä½¿ç”¨ä¸¤ä¸ªç©ºæ ¼åˆ†å‰² IP å’Œåå­—ã€‚\nç¬¬äºŒä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ª IP åœ°å€çš„åˆ—è¡¨, æ¯è¡Œä¸€ä¸ª, å®ƒä»¬æ˜¯å¿…é¡»è¢«æŸ¥è¯¢çš„IPã€‚\nIP è¾“å…¥æ ·æœ¬ è¾“å…¥æ˜¯æœ‰åŒ…å«ä¸¤ä¸ª IP åœ°å€å’Œä¸€ä¸ªè·Ÿ IP èŒƒå›´å…³è”çš„åå­—çš„å¤§é‡è¡Œç»„æˆã€‚\n123.45.17.8 123.45.123.45 University of Vestige 123.50.1.1 123.50.10.1 National Center for Pointlessness 188.0.0.3 200.0.0.250 Mayo Tarkington 200.0.0.251 200.0.0.255 Daubs Haywire Committee 200.0.1.1 200.255.255.255 Geopolitical Encyclopedia 222.222.222.222 233.233.233.233 SAP Rostov 250.1.2.3 250.4.5.6 Shavian Refillable Committee 123.45.100.0 123.60.32.1 United Adverbs 190.0.0.1 201.1.1.1 Shavian Refillable Committee 238.0.0.1 254.1.2.3 National Center for Pointlessness æ³¨æ„: è¿™äº› IP èŒƒå›´ä¸èƒ½ä¿è¯æ˜¯ IPv4 \u0026ldquo;å­ç½‘\u0026rdquo;ã€‚è¿™æ„å‘³ç€å®ƒä»¬å¯èƒ½ä¸èƒ½ç²¾ç¡®åœ°ç”±åŸºäºå‰ç¼€çš„ CIDR å—æ¥è¡¨ç¤ºã€‚\nèŒƒå›´å¯ä»¥é‡å ã€‚å¯èƒ½å¤šä½™2å±‚æ·±ã€‚\nå¯å¯æœ‰å¤šä¸ªèŒƒå›´å…³è”åŒä¸€ä¸ªåå­—ã€‚\næŸ¥è¯¢è¾“å…¥æ ·æœ¬ 250.1.3.4 123.50.1.20 189.133.73.57 123.50.1.21 250.1.2.4 123.50.1.21 250.1.3.100 250.1.3.5 188.0.0.5 123.50.1.100 123.50.2.34 123.50.1.100 123.51.100.52 127.0.0.1 123.50.1.22 123.50.1.21 188.0.0.5 123.45.101.100 123.45.31.52 230.230.230.230 è¾“å‡ºæ ¼å¼åŒ– å€’åºè¾“å‡ºè®¿é—®æ¬¡æ•°ã€‚\n8 - National Center for Pointlessness 4 - Shavian Refillable Committee 3 - Mayo Tarkington 2 - University of Vestige 1 - SAP Rostov 1 - United Adverbs 1 - \u0026lt;unknown\u0026gt; è§£é‡Š è¿™å„¿æ˜¯ä¸€ä¸ªè¾“å…¥ IP å’Œå®ƒçš„åå­—çš„æ˜ å°„:\nNational Center for Pointlessness 123.50.1.20 123.50.1.21 123.50.1.22 123.50.1.21 123.50.1.21 123.50.1.100 123.50.1.100 123.50.2.34 Shavian Refillable Committee 250.1.2.4 250.1.3.4 250.1.3.5 250.1.3.100 Mayo Tarkington 188.0.0.5 188.0.0.5 189.133.73.57 University of Vestige 123.45.101.100 123.45.31.52 SAP Rostov 230.230.230.230 United Adverbs 123.51.100.52 \u0026lt;unknown\u0026gt; 127.0.0.1 smls çš„è§£å†³æ–¹æ³•:\nsub ip-to-number ($ip) { do given $ip.split(\u0026#39;.\u0026#39;) { .[0] +\u0026lt; 24 + .[1] +\u0026lt; 16 + .[2] +\u0026lt; 8 + .[3] +\u0026lt; 0 } } class IntervalTree { has $.min; has $.max; has $!center = ($!min + $!max) div 2; has @!intervals; has IntervalTree $!left; has IntervalTree $!right; method new ($min, $max) { self.bless(:$min, :$max) } method insert (|c ($start, $end, $name)) { if $end \u0026lt; $!center and $!min \u0026lt; $!center - 1 { ($!left //= self.new($!min, $!center)).insert(|c) } elsif $start \u0026gt; $!center and $!max \u0026gt; $!center { ($!right //= self.new($!center, $!max)).insert(|c) } else { @!intervals.push: [$start, $end, $name, $end-$start] } } method prepare { @!intervals.=sort(*[3]); $!left .prepare if $!left; $!right.prepare if $!right; } method lookup ($n) { my $best = ($n \u0026lt; $!center ?? ($!left .lookup($n) if $!left) !! ($!right.lookup($n) if $!right)); $best ?? @!intervals.first({ return $best if .[3] \u0026gt; $best[3]; .[0] \u0026lt;= $n \u0026lt;= .[1] }) // $best !! @!intervals.first({ .[0] \u0026lt;= $n \u0026lt;= .[1] }) } } sub MAIN ($ip-file, $query-file) { my $index = IntervalTree.new(0, ip-to-number \u0026#39;255.255.255.255\u0026#39;); for $ip-file.IO.lines { my ($start, $end, $name) = .split(\u0026#39;\u0026#39;, 3); $index.insert(ip-to-number($start), ip-to-number($end), $name); } $index.prepare; for $query-file.IO.lines -\u0026gt; $ip { my $name = $index.lookup(ip-to-number $ip)[2]; say \u0026#34;$ip{$name // \u0026#39;\u0026lt;unknown\u0026gt;\u0026#39;}\u0026#34;; } } ","permalink":"https://ohmyweekly.github.io/notes/2015-11-20-guess-who/","tags":["rakulang"],"title":"Guess Who"},{"categories":["rakulang"],"contents":"my class List is Iterable does Positional { .. } List ä»¥åºåˆ—åŒ–çš„æ–¹å¼å­˜å‚¨ itemså¹¶ä¸”æ½œåœ¨æ˜¯æƒ°æ€§çš„ã€‚\né»˜è®¤åˆ—è¡¨å’Œæ•°ç»„çš„ç´¢å¼•ä» 0 å¼€å§‹ã€‚\nä½ å¯ä»¥ç»™åˆ—è¡¨ä¸­çš„å…ƒç´ èµ‹å€¼å¦‚æœå®ƒä»¬æ˜¯å®¹å™¨çš„è¯ã€‚ä½¿ç”¨æ•°ç»„ä»¥ä½¿åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ å­˜å‚¨åœ¨å®¹å™¨ä¸­ã€‚\nItemsã€Flattening å’Œ Sigils åœ¨ Raku ä¸­, æŠŠ List èµ‹å€¼ç»™ä¸€ä¸ªæ ‡é‡å˜é‡ä¸ä¼šä¸¢å¤±ä¿¡æ¯ã€‚ä¸åŒä¹‹å¤„åœ¨äºè¿­ä»£é€šå¸¸ä¼šæŠŠæ ‡é‡ä¸­çš„åˆ—è¡¨å½“ä½œå•ä¸ªå…ƒç´ ã€‚\nmy @a = 1, 2, 3; for @a { } # ä¸‰æ¬¡è¿­ä»£ my $s = @a; for $s { } # ä¸€æ¬¡è¿­ä»£ for @a.item { } # ä¸€æ¬¡è¿­ä»£ for $s.list { } # ä¸‰æ¬¡è¿­ä»£ Lists é€šå¸¸ä¼šæ’å€¼(å±•å¼€)é™¤éå®ƒä»¬é€šè¿‡ä¸€ä¸ª item(scalar)å®¹å™¨è®¿é—®:\nmy @a = 1, 2, 3; my @flat = @a, @a; # two elements my @nested = @a.item, @a.item; # two elements .item é€šå¸¸èƒ½è¢«å†™ä¸º $( ... ), è€Œåœ¨æ•°ç»„å˜é‡ä¸Šç”šè‡³å†™ä¸º $@aã€‚\nMethods elems multi sub elems($list) returns Int:D multi method elems(List:D:) returns Int:D è¿”å›åˆ—è¡¨ä¸­å…ƒç´ çš„ä¸ªæ•°ã€‚\nend multi sub end($list) returns Int:D multi method end(List:D:) returns Int:D è¿”å›åˆ—è¡¨ä¸­æœ€åä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•\nkeys multi sub keys($list) returns List:D multi method keys(List:D:) returns List:D è¿”å›ä¸€ä¸ªç´¢å¼•åˆ—è¡¨( ä¾‹å¦‚ 0..(@list.elems-1) )\nvalues multi sub values($list) returns List:D multi method values(List:D:) returns List:D è¿”å›åˆ—è¡¨çš„ä¸€ä»½æ‹·è´ã€‚\nkv multi sub kv($list) returns List:D multi method kv(List:D:) returns List:D è¿”å›ç´¢å¼•å’Œå€¼çš„äº¤æ›¿çš„åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼š\n\u0026lt;a b c\u0026gt;.kv è¿”å›:\n0, \u0026#39;a\u0026#39;, 1, \u0026#39;b\u0026#39;, 2, \u0026#39;c\u0026#39; pairs multi sub pairs($list) returns List:D multi method pairs(List:D:) returns List:D è¿”å›ä¸€ä¸ª pairs çš„åˆ—è¡¨, ä½¿ç”¨ç´¢å¼•ä½œä¸ºé”®, åˆ—è¡¨å€¼ä½œä¸ºé”®å€¼ã€‚\n\u0026lt;a b c\u0026gt;.pairs # 0 =\u0026gt; \u0026#39;a\u0026#39;, 1 =\u0026gt; \u0026#39;b\u0026#39;, 2 =\u0026gt; \u0026#39;c\u0026#39; join multi sub join($separator, *@list) returns Str:D multi method join(List:D: $separator) returns Str:D æŠŠåˆ—è¡¨ä¸­å…ƒç´ å½“ä½œå­—ç¬¦ä¸², åœ¨å…ƒç´ ä¹‹é—´æ’å…¥ $separator å¹¶æŠŠæ‰€æœ‰ä¸œè¥¿è¿æ¥æˆå•ä¸ªå­—ç¬¦ä¸²ã€‚\nä¾‹å¦‚:\njoin \u0026#39;, \u0026#39;, \u0026lt;a b c\u0026gt;; # \u0026#39;a, b, c\u0026#39; map multi sub map(\u0026amp;code, *@elems) returns List:D multi method map(List:D: \u0026amp;code) returns List:D å¯¹æ¯ä¸ªå…ƒç´ è°ƒç”¨ \u0026amp;code å¹¶ä¸”æŠŠå€¼æ”¶é›†åˆ°å¦å¤–ä¸€ä¸ªåˆ—è¡¨ä¸­å¹¶è¿”å›å®ƒã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯æƒ°æ€§çš„ã€‚\u0026amp;codeåªåœ¨è¿”å›å€¼è¢«è®¿é—®çš„æ—¶å€™è°ƒç”¨ã€‚\nä¾‹å­:\n(\u0026#39;hello\u0026#39;, 1, 22/7, 42, \u0026#39;world\u0026#39;).map: { .WHAT.raku }; # Str Int Rat Int Str map *.Str.chars, \u0026#39;hello\u0026#39;, 1, 22/7, 42, \u0026#39;world\u0026#39;; # 5 1 8 2 5 grep multi sub grep(Mu $matcher, *@elems) returns List:D multi method grep(List:D: Mu $matcher) returns List:D è¿”å›ä¸€ä¸ªä½¿ç”¨ $matcher æ™ºèƒ½åŒ¹é…çš„æƒ°æ€§åˆ—è¡¨ã€‚å…ƒç´ æ˜¯ä»¥å‡ºç°åœ¨åŸåˆ—è¡¨ä¸­çš„é¡ºåºè¿”å›çš„ã€‚\nä¾‹å­:\n(\u0026#39;hello\u0026#39;, 1, 22/7, 42, \u0026#39;world\u0026#39;).grep: Int; # 1 42 grep { .Str.chars \u0026gt; 3 }, \u0026#39;hello\u0026#39;, 1, 22/7, 42, \u0026#39;world\u0026#39;; # hello 3.142857 world first multi sub first(Mu $matcher, *@elems) multi method first(List:D: Mu $matcher) è¿”å›åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªåŒ¹é… $matcher çš„å…ƒç´ , å½“æ²¡æœ‰åŒ¹é…å€¼æ—¶, å¤±è´¥ã€‚\nä¾‹å­:\nsay (1, 22/7, 42).first: * \u0026gt; 5; # 42 say $f = (\u0026#39;hello\u0026#39;, 1, 22/7, 42, \u0026#39;world\u0026#39;).first: Complex; (\u0026#39;hello\u0026#39;, 1, 22/7, 42, \u0026#39;world\u0026#39;,1+2i).first: Complex; # 1+2i say $f.raku; # Failure.new(exception =\u0026gt; X::AdHoc.new(payload =\u0026gt; \u0026#34;No values matched\u0026#34;)) classify multi sub classify(\u0026amp;mapper, *@values) returns Hash:D multi method classify(List:D: \u0026amp;mapper) returns Hash:D æ ¹æ®æ˜ å°„å™¨æŠŠä¸€åˆ—å€¼è½¬æ¢æˆä»£è¡¨é‚£äº›å€¼çš„ç±»åˆ«çš„æ•£åˆ—; æ•£åˆ—çš„æ¯ä¸ªé”®ä»£è¡¨ç€å°†è¦å½’å…¥åˆ—è¡¨çš„ä¸€ä¸ªæˆ–å¤šä¸ªå€¼çš„ç±»åˆ«ã€‚æ¯”å¦‚å­—ç¬¦ä¸ªæ•°, å…ƒç´ å¤šå°‘, é”®å€¼å°±æ˜¯æ ¹æ® mapper å¾—åˆ°çš„è¿™ä¸ªç±»åˆ«ä¸‹çš„å…ƒç´ , å®ƒæ¥è‡ªäºåŸå§‹åˆ—è¡¨ï¼š\nä¾‹å­ï¼š\nsay classify { $_ %% 2 ?? \u0026#39;even\u0026#39; !! \u0026#39;odd\u0026#39; }, (1, 7, 6, 3, 2); # (\u0026#34;odd\u0026#34; =\u0026gt; [1, 7, 3], \u0026#34;even\u0026#34; =\u0026gt; [6, 2]).hash; say (\u0026#39;hello\u0026#39;, 1, 22/7, 42, \u0026#39;world\u0026#39;).classify: { .Str.chars }; # (\u0026#34;5\u0026#34; =\u0026gt; [\u0026#34;hello\u0026#34;, \u0026#34;world\u0026#34;], \u0026#34;1\u0026#34; =\u0026gt; [1], \u0026#34;8\u0026#34; =\u0026gt; [22/7], \u0026#34;2\u0026#34; =\u0026gt; [42]).hash Bool multi method Bool(List:D:) returns Bool:D å¦‚æœåˆ—è¡¨è‡³å°‘å«æœ‰ä¸€ä¸ªå…ƒç´ åˆ™è¿”å› True, å¦‚æœåˆ—è¡¨ä¸ºç©ºåˆ™è¿”å› Falseã€‚\nStr multi method Str(List:D:) returns Str:D å­—ç¬¦ä¸²åŒ–åˆ—è¡¨ä¸­çš„å…ƒç´ å¹¶ä½¿ç”¨ç©ºæ ¼æŠŠè¿™äº›å…ƒç´ è¿æ¥èµ·æ¥ã€‚( å’Œ .join(' ') ä¸€æ ·)ã€‚\nInt multi method Int(List:D:) return Int:D è¿”å›åˆ—è¡¨ä¸­å…ƒç´ çš„æ•°é‡(å’Œ .elems ä¸€æ ·)\npick multi sub pick($count, *@list) returns List:D multi method pick(List:D: $count = 1) ä»è°ƒç”¨è€…èº«ä¸Šéšæœºè¿”å› $count ä¸ªä¸é‡å¤çš„å…ƒç´ ã€‚ å¦‚æœ * ä½œä¸º $count ä¼ é€’è¿›æ¥æˆ– $count å¤§äºæˆ–ç­‰äºåˆ—è¡¨çš„å¤§å°, é‚£ä¹ˆå°±ä»¥éšæœºåºåˆ—çš„æ–¹å¼è¿”å›åˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚\nä¾‹å­:\nsay \u0026lt;a b c d e\u0026gt;.pick; # b say \u0026lt;a b c d e\u0026gt;.pick: 3; # c a e say \u0026lt;a b c d e\u0026gt;.pick: *; # e d a b c roll multi sub roll($count, *@list) returns List:D multi method roll(List:D: $count = 1) è¿”å›ä¸€ä¸ª $count ä¸ªå…ƒç´ çš„æƒ°æ€§åˆ—è¡¨, æ¯ä¸ªå…ƒç´ éƒ½ä»åˆ—è¡¨ä¸­éšæœºé€‰æ‹©ã€‚æ¯ä¸ªéšæœºé€‰æ‹©éƒ½æ˜¯ç‹¬ç«‹çš„.\nå¦‚æœç»™ $count ä¼ é€’äº† * å·, åˆ™è¿”å›ä¸€ä¸ªæƒ°æ€§çš„, ä»åŸåˆ—è¡¨ä¸­éšæœºé€‰å–å…ƒç´ çš„æ— é™åˆ—è¡¨ã€‚\nsay \u0026lt;a b c d e\u0026gt;.roll; # b say \u0026lt;a b c d e\u0026gt;.roll: 3; # c c e say roll 8, \u0026lt;a b c d e\u0026gt;; # b a e d a e b c my $random_digits := (^10).roll(*);1; say $random_digits[^15]; # 3 8 7 6 0 1 3 2 0 8 8 5 8 0 5 eager multi method eager(List:D:) returns List:D æ€¥åˆ‡åœ°è®¡ç®—åˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ , å¹¶è¿”å›è°ƒç”¨è€…ã€‚å¦‚æœåˆ—è¡¨æ ‡ç¤ºå®ƒæ˜¯ \u0026ldquo;konw inifinite\u0026rdquo; çš„, æ€¥åˆ‡æ±‚å€¼å¯ä»¥åœæ­¢åœ¨æ¢æµ‹åˆ°çš„æ— é™çš„ç‚¹ä¸Šã€‚\nreverse multi sub reverse(*@list ) returns List:D multi method reverse(List:D:) returns List:D ä»¥ç›¸åçš„é¡ºåºè¿”å›ä¸€ä¸ªå«æœ‰ç›¸åŒå…ƒç´ çš„åˆ—è¡¨ã€‚ æ³¨æ„ reverse æ€»æ˜¯æŒ‡åè½¬åˆ—è¡¨ä¸­çš„å…ƒç´ , å¦‚æœä½ æƒ³åè½¬å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦, é‚£ä¹ˆä½¿ç”¨ flipã€‚\nsay \u0026lt;hello world!\u0026gt;.reverse # world! hello say reverse ^10 # 9 8 7 6 5 4 3 2 1 0 rotate multi sub rotate(@list, Int:D $n = 1) returns List:D multi method rotate(List:D: Int:D $n = 1) returns List:D ä»¥ $n ä¸ªå…ƒç´ æ—‹è½¬åˆ—è¡¨, è¿™æŠŠåŸåˆ—è¡¨åˆ†æˆä¸¤éƒ¨åˆ†, æ—‹è½¬ä¸­å¿ƒå°±æ˜¯åœ¨è¿™ä¸¤éƒ¨åˆ†ä¹‹é—´:\n\u0026lt;a b c d e\u0026gt;.rotate(2); # \u0026lt;c d e a b\u0026gt; \u0026lt;a b c d e\u0026gt;.rotate(-1); # \u0026lt;e a b c d\u0026gt; sort multi sub sort(*@elems) returns List:D multi sub sort(\u0026amp;by, *@elems) returns List:D multi method sort(List:D:) returns List:D multi method sort(List:D:, \u0026amp;by) returns List:D åˆ—è¡¨æ’åº, æœ€å°çš„å…ƒç´ é¦–å…ˆã€‚é»˜è®¤ä½¿ç”¨ infix:\u0026lt;cmp\u0026gt; æ’åºåˆ—è¡¨ä¸­çš„å…ƒç´ ã€‚\nå¦‚æœæä¾›äº† \u0026amp;by, é‚£ä¹ˆå®ƒæ¥æ”¶ä¸¤ä¸ªå‚æ•°, å®ƒç”±åˆ—è¡¨å…ƒç´ å¯¹å„¿è°ƒç”¨, å¹¶ä¸”åº”è¯¥è¿”å› Order::Increase, Order::Same æˆ– Order::Decreaseã€‚\nå¦‚æœ \u0026amp;by åªæ¥å—ä¸€ä¸ªå‚æ•°, é‚£ä¹ˆåˆ—è¡¨å…ƒç´ æ˜¯é€šè¿‡ by($a) cmp by($b) æ¥æ’åºçš„ã€‚\u0026amp;by çš„è¿”å›å€¼è¢«ç¼“å­˜èµ·æ¥, ä»¥ä½¿æ¯ä¸ªåˆ—è¡¨å…ƒç´ åªè°ƒç”¨ä¸€æ¬¡ \u0026amp;byã€‚\nsay (3, -4, 7, -1, 2, 0).sort; # -4 -1 0 2 3 7 say (3, -4, 7, -1, 2, 0).sort: *.abs; # 0 -1 2 3 -4 7 say (3, -4, 7, -1, 2, 0).sort: { $^b leg $^a }; # 7 3 2 0 -4 -1 reduce multi sub reduce(\u0026amp;with, *@elems) multi method reduce(List:D: \u0026amp;with) æŠŠ \u0026amp;with åº”ç”¨åˆ°åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªå€¼ä¸Š, ç„¶åæŠŠ \u0026amp;with åº”ç”¨åˆ°é‚£ä¸ªè®¡ç®—çš„ç»“æœå€¼å’Œç¬¬ä¸‰ä¸ªå€¼ä¸Š, ä»¥æ­¤ç±»æ¨ã€‚æŒ‰ç…§é‚£ç§æ–¹å¼ç”Ÿæˆå•ä¸ªé¡¹ã€‚\næ³¨æ„ reduce æ˜¯ä¸€ä¸ªéšå¼çš„å¾ªç¯ã€‚\nsay (1, 2, 3).reduce: * - *; # -4 splice multi sub splice(@list, $start, $elems?, *@replacement) returns List:D multi method splice(List:D: $start, $elems?, *@replacement) returns List:D ä»åˆ—è¡¨ä¸­åˆ é™¤ä» $start ç´¢å¼•å¼€å§‹çš„ $elems ä¸ªå…ƒç´ , è¿”å›åˆ é™¤çš„å…ƒç´ å¹¶ç”¨ @replacement æ¥ä»£æ›¿å®ƒã€‚å¦‚æœçœç•¥äº† $elems, æ‰€æœ‰ä» $index å¼€å§‹çš„å…ƒç´ éƒ½è¢«åˆ é™¤ã€‚\nmy @foo = \u0026lt;a b c d e f g\u0026gt;; say @foo.splice(2, 3, \u0026lt;M N O P\u0026gt;); # c d e say @foo; # a b M N O P f g pop multi sub pop(List:D ) multi method pop(List:D:) ä»åˆ—è¡¨ä¸­ç§»é™¤å¹¶è¿”å›æœ€åä¸€é¡¹ã€‚å¦‚æœåˆ—è¡¨ä¸ºç©ºåˆ™å¤±è´¥ã€‚\n\u0026gt; my @foo = \u0026lt;a b\u0026gt;; \u0026gt; @foo.pop; # b \u0026gt; pop @foo # a \u0026gt; pop @foo # Element popped from empty list push multi sub push(List:D, *@values) returns List:D multi method push(List:D: *@values) returns List:D æŠŠ @values æ·»åŠ åˆ°åˆ—è¡¨çš„æœ«å°¾, å¹¶è¿”å›ä¿®æ”¹åçš„åˆ—è¡¨ã€‚ å¦‚æœåˆ—è¡¨æ˜¯æ— é™åˆ—è¡¨åˆ™å¤±è´¥ã€‚\nmy @foo = \u0026lt;a b c\u0026gt;; @foo.push: 1, 3 ... 11; say @foo; # a b c 1 3 5 7 9 11 shift multi sub shift(List:D ) multi method shift(List:D:) ä»åˆ—è¡¨ä¸­ç§»é™¤å¹¶è¿”å›ç¬¬ä¸€é¡¹å…ƒç´ ã€‚å¦‚æœåˆ—è¡¨ä¸ºç©ºåˆ™å¤±è´¥ã€‚\nmy @foo = \u0026lt;a b\u0026gt;; say @foo.shift; # a say @foo.shift; # b say @foo.shift; # Element shifted from empty list unshift multi sub unshift(List:D, *@values) returns List:D multi method unshift(List:D: *@values) returns List:D æ·»åŠ  @values åˆ°åˆ—è¡¨çš„å¼€å¤´, å¹¶è¿”å›ä¿®æ”¹åçš„åˆ—è¡¨ã€‚å¦‚æœåˆ—è¡¨æ˜¯æ— é™åˆ—è¡¨åˆ™å¤±è´¥ã€‚\nmy @foo = \u0026lt;a b c\u0026gt;; @foo.unshift: 1, 3 ... 11; say @foo; # 1 3 5 7 9 11 a b c combinations multi method combinations (List:D: Int:D $of) returns List:D multi method combinations (List:D: Range:D $of = 0..*) returns List:D multi sub combinations ($n, $k) returns List:D Int å˜ä½“è¿”å›è°ƒç”¨è€…åˆ—è¡¨æ‰€æœ‰çš„ $of-combinations ç»„åˆã€‚ä¾‹å¦‚:\nsay .join(\u0026#39;|\u0026#39;) for \u0026lt;a b c\u0026gt;.combinations(2); æ‰“å°\na|b a|c b|c å› ä¸º \u0026lsquo;a\u0026rsquo;, \u0026lsquo;b\u0026rsquo;, \u0026lsquo;c\u0026rsquo; çš„æ‰€æœ‰ 2-combinations æ˜¯ [\u0026lsquo;a\u0026rsquo;, \u0026lsquo;b\u0026rsquo;], [\u0026lsquo;a\u0026rsquo;, \u0026lsquo;c\u0026rsquo;], [\u0026lsquo;b\u0026rsquo;, \u0026lsquo;c\u0026rsquo;].\nRange å˜ä½“æŠŠæ‰€æœ‰å•ç‹¬çš„ç»„åˆç»„åˆåˆ°å•ä¸ªåˆ—è¡¨ä¸­, æ‰€ä»¥:\nsay .join(\u0026#39;|\u0026#39;) for \u0026lt;a b c\u0026gt;.combinations(2..3); æ‰“å°ï¼š\na|b a|c b|c a|b|c å› ä¸ºé‚£æ˜¯ä¸€ä¸ªæ‰€æœ‰ 2-å’Œ3-combinations ç»„åˆçš„åˆ—è¡¨ã€‚\nå­ä¾‹ç¨‹ combinations($n, $k) ç­‰ä»·äº (^$n).combinations($k), æ‰€ä»¥ï¼š\n.say for combinations(4, 2) æ‰“å°ï¼š\n0 1 0 2 0 3 1 2 1 3 2 3 permutations multi method permutations(List:D:) returns List:D multi sub permutations($n) returns List:D è¿”å›åˆ—è¡¨æ‰€æœ‰å¯èƒ½çš„ç»„åˆä½œä¸ºæ•°ç»„çš„åˆ—è¡¨ã€‚æ‰€ä»¥:\nsay .join(\u0026#39;|\u0026#39;) for \u0026lt;a b c\u0026gt;.permutations æ‰“å°ï¼š\na|b|c a|c|b b|a|c b|c|a c|a|b c|b|a permutations æŠŠæ‰€æœ‰åˆ—è¡¨å…ƒç´ å½“ä½œå¯åŒºåˆ«çš„, æ‰€ä»¥ (1, 1, 2).permutations ä»æ—§è¿”å› 6 ä¸ªå…ƒç´ çš„åˆ—è¡¨, å³ä½¿åªæœ‰ 3 ä¸ªä¸åŒçš„æ’åˆ—ã€‚\npermutations($n) ç­‰ä»·äº (^$n).permutations, æ‰€ä»¥:\n.say for permutations 3; æ‰“å°ï¼š\n1 2 3 1 3 2 2 1 3 2 3 1 3 1 2 3 2 1 ","permalink":"https://ohmyweekly.github.io/notes/2015-06-10-list-in-raku/","tags":["rakulang"],"title":"List in Raku"},{"categories":["rakulang"],"contents":"æ”¶é›† Raku æ–¹é¢çš„åšæ–‡å¦‚ä¸‹:\n Raku çš„ Grammar å­¦ä¹ æ€»ç»“ Raku çš„æ­£åˆ™è¡¨è¾¾å¼ Raku çš„æ­£åˆ™è¡¨è¾¾å¼ Perl 6 çš„åˆ—è¡¨ Raku çš„å­—ç¬¦ä¸² Raku URB è§£æ Raku æ ¼å¼åŒ–å¸®åŠ©ä¿¡æ¯ Raku è§£å†³ 24 Game Raku ç¥çš„90äº¿åå­—æ•´æ•°ç‰ˆ Raku è®¡ç®—çŸ©é˜µå æ¯” Raku 24æ¸¸æˆ Raku temporary Raku æ‹¬å·åŒ¹é… Raku ä¸Šä¼ æ–‡ä»¶ è¯‘ Raku Object Orientation è¯‘ Native Calling Interface è¯‘ Raku 5to6-nutshell Raku æ‹¬å·çš„åŒ¹é… ç¥çš„90äº¿åå­—æ•´æ•°ç‰ˆ Raku æ­£åˆ™æ›¿æ¢ Raku ç´¯åŠ å™¨å·¥å‚ Raku IEEE754 Raku usbip è‡ªåŠ¨ bind Raku 5to6-perlfunc Raku GetOption Raku Search Binary-Tree node Raku Getopt::Kinoko  ","permalink":"https://ohmyweekly.github.io/notes/2016-01-01-raku-blogs/","tags":["blog"],"title":"Raku Blogs"},{"categories":["rakulang"],"contents":"Grammars Grammars - ä¸€ç»„å…·å regexes ç»„æˆæ­£å¼çš„ grammar\nGrammars æ˜¯ä¸€ä¸ªå¾ˆå¼ºå¤§çš„å·¥å…·ç”¨äºææ„æ–‡æœ¬å¹¶é€šå¸¸è¿”å›æ•°æ®ç»“æ„ã€‚\nä¾‹å¦‚, Raku æ˜¯ä½¿ç”¨ Raku é£æ ¼ grammar è§£æå¹¶æ‰§è¡Œçš„ã€‚\nå¯¹æ™®é€š Raku ä½¿ç”¨è€…æ›´å®ç”¨çš„ä¸€ä¸ªä¾‹å­æ˜¯ JSON::Tinyæ¨¡å—, å®ƒèƒ½ååºåˆ—åŒ–ä»»ä½•åˆæ³•çš„ JSON æ–‡ä»¶, è€Œååºåˆ—ä»£ç åªæœ‰ä¸åˆ° 100 è¡Œ, è¿˜èƒ½æ‰©å±•ã€‚\nGrammars å…è®¸ä½ æŠŠ regexes ç»„ç»‡åˆ°ä¸€å—å„¿, å°±åƒç±»(class) ä¸­ç»„ç»‡æ–¹æ³•é‚£æ ·ã€‚\nå…·åæ­£åˆ™ (Named Regexes) ã€€grammars çš„ä¸»è¦ç»„æˆéƒ¨åˆ†æ˜¯ regexesã€‚ è€Œ Raku çš„ regexesè¯­æ³•ä¸åœ¨è¯¥æ–‡æ¡£çš„è®¨è®ºèŒƒå›´, å…·åæ­£åˆ™(named regexes) æœ‰å®ƒè‡ªå·±çš„ç‰¹æ®Šè¯­æ³•, è¿™è·Ÿå­ä¾‹ç¨‹(subroutine) çš„å®šä¹‰å¾ˆåƒ:\nmy regex number {\\d+[\\.\\d+]?} # æ™®é€š regex ä¸­ç©ºæ ¼è¢«å¿½ç•¥, [] æ˜¯éæ•è·ç»„ ä¸Šé¢çš„ä»£ç ä½¿ç”¨ my å…³é”®å­—æŒ‡å®šäº†æœ¬åœ°ä½œç”¨åŸŸçš„ regex, å› ä¸ºå…·åæ­£åˆ™(named regexes) é€šå¸¸ç”¨åœ¨ grammars é‡Œé¢ã€‚\næ­£åˆ™æœ‰åå­—äº†å°±æ–¹ä¾¿æˆ‘ä»¬åœ¨ä»»ä½•åœ°æ–¹é‡ç”¨é‚£ä¸ªæ­£åˆ™äº†:\nsay \u0026#34;32.51\u0026#34; ~~ \u0026amp;number; say \u0026#34;15 + 4.5\u0026#34; ~~ /\\s*\u0026#39;+\u0026#39;\\s*/ \u0026amp;number # my regex number { \\d+ [ \\. \\d+ ]? }  ä¸ºä»€ä¹ˆç”¨ \u0026amp;number, å¯¹æ¯”å…·åå­ä¾‹ç¨‹ä½ å°±çŸ¥é“äº†:\n\u0026gt; sub number { say \u0026#34;i am a subroutine\u0026#34; } # å…·åå­ä¾‹ç¨‹ \u0026gt; \u0026amp;number # sub number () { #`(Sub|140651249646256) ... } \u0026amp;number å°±æ˜¯ç›´æ¥å¼•ç”¨äº†å…·åçš„ regex æˆ– å­ä¾‹ç¨‹ã€‚è€Œåœ¨ / / æˆ– grammars é‡Œé¢, å¼•ç”¨ä¸€ä¸ªå…·åæ­£åˆ™çš„è¯­æ³•ä¹Ÿå¾ˆç‰¹æ®Š, å°±æ˜¯ç»™åå­—åŒ…è£¹ä¸Š \u0026lt; \u0026gt;ã€‚\u0026lt;\u0026gt; å°±åƒå¼•å·é‚£æ ·, å½“ç”¨å®ƒå¼•èµ·æŸä¸ªå…·åæ­£åˆ™å, å¼•ç”¨è¿™ä¸ª \u0026lt;\u0026gt; å°±ä¼šæŠŠè¯¥å…·åæ­£åˆ™æ’å…¥(å¸¦å…¥)åˆ°æ•´ä¸ªæ­£åˆ™ä¹‹ä¸­, å°±åƒå­—ç¬¦ä¸²æ’å€¼é‚£æ ·ï¼š\n# å…·åæ­£åˆ™çš„å£°æ˜ my regex number {\\d+[\\.\\d+]?} my token ident {\\w+} my rule alpha {\u0026lt;[A..Za..z]\u0026gt;} # 1.0 é€šè¿‡ \u0026amp; æ¥å¼•ç”¨ say so \u0026#34;12.34\u0026#34; ~~ \u0026amp;number; # true # 2.0 åœ¨æ­£åˆ™æ„é€  // é‡Œä½¿ç”¨ say so \u0026#34;12.88 + 0.12\u0026#34; ~~ /\\s*\u0026#39;+\u0026#39;\\s*/; # true # say so \u0026#34;12.88 + 0.12\u0026#34; ~~ / \\s* \u0026#39;+\u0026#39; \\s* /; # wrong, method \u0026#39;number\u0026#39; not found for invocant of class \u0026#39;Cursor\u0026#39; # 3.0 åœ¨ grammar é‡Œé¢ä½¿ç”¨ grammar EquationParse { # è¿™é‡Œä¹Ÿä¸èƒ½ç»™ number èµ·åˆ«å, é™¤é number æ˜¯åœ¨ grammar å†…éƒ¨å£°æ˜çš„ token TOP {\\s*\u0026#39;+\u0026#39;\\s*\\s*\u0026#39;=\u0026#39;\\s*} } # ç­‰å¼è§£æ my $expr=EquationParse.parse(\u0026#34;12.88 + 0.12 = 13.00\u0026#34;); say $expr; å£°æ˜å…·åæ­£åˆ™ä¸æ˜¯åªæœ‰ä¸€ä¸ª regex å£°æ˜ç¬¦, å®é™…ä¸Š , regex å£°æ˜ç¬¦ç”¨çš„æœ€å°‘, å¤§å¤šæ•°æ—¶å€™, éƒ½æ˜¯ä½¿ç”¨ token æˆ– rule å£°æ˜ç¬¦ã€‚token å’Œ rule è¿™ä¸¤ä¸ªéƒ½æ˜¯ ratcheing (æ£˜è½®)çš„, è¿™æ„å‘³ç€å¦‚æœåŒ¹é…å¤±è´¥, é‚£ä¹ˆåŒ¹é…å¼•æ“å°±ä¸ä¼šå›å¹¶å°è¯•åŒ¹é…äº†ã€‚è¿™é€šå¸¸ä¼šæ˜¯ä½ æƒ³è¦çš„, ä½†ä¸é€‚ç”¨äºæ‰€æœ‰æƒ…å†µ:\n æ£˜è½®ç”¨äºå•å‘é©±åŠ¨, é˜²æ­¢é€†è½¬ã€‚\n my regex works-but-slow {.+q } # å¯èƒ½ä¼šå›æº¯ my token fails-but-fast {.+q } # ä¸å›æº¯ my $s = \u0026#39;Tokens and rules won\\\u0026#39;t backtrack, which makes them fail quicker!\u0026#39;; say so $s ~~ \u0026amp;works-but-slow; # True say so $s ~~ \u0026amp;fails-but-fast; # False, .+ å¾—åˆ°äº†æ•´ä¸ªå­—ç¬¦ä¸²ä½†ä¸å›æº¯ token å’Œ rule çš„å”¯ä¸€åŒºåˆ«å°±æ˜¯ rule å£°æ˜ç¬¦ä¼šè®©æ­£åˆ™ä¸­çš„ :sigspace ä¿®é¥°ç¬¦èµ·æ•ˆ:\nmy token non-space-y {\u0026#39;once\u0026#39;\u0026#39;upon\u0026#39;\u0026#39;a\u0026#39;\u0026#39;time\u0026#39;} my rule space-y {\u0026#39;once\u0026#39;\u0026#39;upon\u0026#39;\u0026#39;a\u0026#39;\u0026#39;time\u0026#39;} say \u0026#39;onceuponatime\u0026#39; ~~ \u0026amp;non-space-y; say \u0026#39;once upon a time\u0026#39; ~~ \u0026amp;space-y; åˆ›å»º Grammar ã€€å½“ä½¿ç”¨ grammar å…³é”®å­—è€Œé class å…³é”®å­—å£°æ˜æ¥å£°æ˜ä¸€ä¸ªç±»æ—¶, ä¼šè‡ªåŠ¨å¾—åˆ°ä»¥ Grammar çš„çˆ¶ç±»ã€‚Grammars åº”è¯¥åªç”¨äºè§£ææ–‡æœ¬; å¦‚æœä½ æƒ³æå–å¤æ‚çš„æ•°æ®, æ¨è action objectå’Œ grammar ä¸€å—ä½¿ç”¨ã€‚\nProto regexes Grammars ç”± rulesï¼Œtoken å’Œ regexes ç»„æˆ; ä»–ä»¬å®é™…ä¸Šæ˜¯æ–¹æ³•ï¼Œå› ä¸º grammars æ˜¯ç±»ã€‚è¿™äº›æ–¹æ³•å¯ä»¥å…±äº«ä¸€ä¸ªå…±åŒçš„åç§°å’ŒåŠŸèƒ½ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ protoã€‚\nå¦‚æœä½ æœ‰å¾ˆå¤šå¤‡é€‰åˆ†æ”¯(alternations), é‚£ä¹ˆç”Ÿæˆå¯è¯»æ€§å¥½çš„ä»£ç æˆ–å­ç±»åŒ–(subclass)ä½ çš„ grammar å¯èƒ½ä¼šå˜å¾—å¾ˆå›°éš¾ã€‚åœ¨ä¸‹é¢çš„ Actions ç±»ä¸­, TOP æ–¹æ³•ä¸­çš„ä¸‰å…ƒæ“ä½œç¬¦å¹¶ä¸ç†æƒ³, å¹¶ä¸”å½“æˆ‘ä»¬æ·»åŠ çš„æ“ä½œè¶Šå¤š, å®ƒå°±å˜å¾—è¶Šç³Ÿç³•:\ngrammar Calculator { token TOP {[\u0026lt;add\u0026gt;|\u0026lt;sub\u0026gt;]} rule add {\u0026lt;num\u0026gt;\u0026#39;+\u0026#39;\u0026lt;num\u0026gt;} rule sub {\u0026lt;num\u0026gt;\u0026#39;-\u0026#39;\u0026lt;num\u0026gt;} token num {\\d+} } class Calculations { method TOP ($/) { make $\u0026lt;add\u0026gt; ?? $\u0026lt;add\u0026gt;.made !! $\u0026lt;sub\u0026gt;.made; } method add ($/) { make [+] $\u0026lt;num\u0026gt;; } method sub ($/) { make [-] $\u0026lt;num\u0026gt;; } } say Calculator.parse(\u0026#39;2 + 3\u0026#39;, actions =\u0026gt; Calculations).made; # OUTPUT: # 5 ä¸ºäº†è®©äº‹æƒ…å˜å¾—æ›´å¥½, æˆ‘ä»¬å¯ä»¥åœ¨ tokens èº«ä¸Šä½¿ç”¨çœ‹èµ·æ¥åƒ :sym\u0026lt;...\u0026gt; é‚£æ ·çš„å‰¯è¯æ¥ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŸå‹(protoregexes):\ngrammar Calculator { token TOP {\u0026lt;calc-op\u0026gt;} proto rule calc-op {*} rule calc-op:sym\u0026lt;add\u0026gt; {\u0026lt;num\u0026gt;\u0026#39;+\u0026#39;\u0026lt;num\u0026gt;} rule calc-op:sym\u0026lt;sub\u0026gt; {\u0026lt;num\u0026gt;\u0026#39;-\u0026#39;\u0026lt;num\u0026gt;} token num {\\d+} } class Calculations { method TOP ($/) { make $\u0026lt;calc-op\u0026gt;.made; } method calc-op:sym\u0026lt;add\u0026gt; ($/) { make [+] $\u0026lt;num\u0026gt;; } method calc-op:sym\u0026lt;sub\u0026gt; ($/) { make [-] $\u0026lt;num\u0026gt;; } } say Calculator.parse(\u0026#39;2 + 3\u0026#39;, actions =\u0026gt; Calculations).made; # OUTPUT: # 5 åœ¨è¿™ä¸ª grammar ä¸­, å¤‡é€‰åˆ†æ”¯(alternation)å·²ç»è¢« \u0026lt;calc-op\u0026gt; æ›¿æ¢æ‰äº†, å®ƒå®è´¨ä¸Šæ˜¯æˆ‘ä»¬å°†è¦åˆ›å»ºçš„ä¸€ç»„å€¼çš„åå­—ã€‚æˆ‘ä»¬é€šè¿‡ä½¿ç”¨ proto rule calc-op å®šä¹‰äº†ä¸€ä¸ª rule åŸå‹ç±»å‹(prototype) æ¥è¾¾æˆã€‚æˆ‘ä»¬ä¹‹å‰çš„æ¯ä¸€ä¸ªå¤‡é€‰åˆ†æ”¯å·²ç»è¢«æ–°çš„ rule calc-op æ›¿æ¢æ‰äº†å¹¶ä¸”å¤‡é€‰åˆ†æ”¯çš„åå­—è¢«é™„åŠ ä¸Šäº† :sym\u0026lt;\u0026gt; å‰¯è¯ã€‚\nåœ¨ actions ç±»ä¸­, æˆ‘ä»¬ç°åœ¨æ‘†è„±äº†ä¸‰ç›®æ“ä½œç¬¦, ä»…ä»…åªåœ¨ $\u0026lt;calc-op\u0026gt; åŒ¹é…å¯¹è±¡ä¸Šæ¥æ”¶ .made å€¼ã€‚å¹¶ä¸”å•ç‹¬å¤‡é€‰åˆ†æ”¯çš„ actions ç°åœ¨å’Œ grammar éµå®ˆç›¸åŒçš„å‘½åæ¨¡å¼: method calc-op:sym\u0026lt;add\u0026gt; å’Œ method calc-op:sym\u0026lt;sub\u0026gt;ã€‚\nå½“ä½ å­ç±»åŒ–(subclass)é‚£ä¸ª grammar å’Œ actions ç±»çš„æ—¶å€™æ‰èƒ½çœ‹åˆ°è¿™ä¸ªæ–¹æ³•çš„çœŸæ­£é­…åŠ›ã€‚å‡è®¾æˆ‘ä»¬æƒ³ä¸º calculator å¢åŠ ä¸€ä¸ªä¹˜æ³•åŠŸèƒ½:\ngrammar BetterCalculator is Calculator { rule calc-op:sym\u0026lt;mult\u0026gt; {\u0026lt;num\u0026gt;\u0026#39;*\u0026#39;\u0026lt;num\u0026gt;} } class BetterCalculations is Calculations { method calc-op:sym\u0026lt;mult\u0026gt; ($/) { make [*] $\u0026lt;num\u0026gt; } } say BetterCalculator.parse(\u0026#39;2 * 3\u0026#39;, actions =\u0026gt; BetterCalculations).made; # OUTPUT: # 6 æ‰€æœ‰æˆ‘ä»¬éœ€è¦æ·»åŠ çš„å°±æ˜¯ä¸º calc-op ç»„æ·»åŠ é¢å¤–çš„ rule å’Œ action, æ„Ÿè°¢æ­£åˆ™è¡¨è¾¾å¼åŸå‹(protoregexes), æ‰€æœ‰çš„ä¸œè¥¿éƒ½èƒ½æ­£å¸¸å·¥ä½œã€‚\nç‰¹æ®Šçš„ Tokens TOP grammar Foo { token TOP {\\d+} } TOP token æ˜¯é»˜è®¤çš„ç¬¬ä¸€ä¸ªå°è¯•å»åŒ¹é…çš„ token , å½“è§£æä¸€ä¸ª grammar çš„æ—¶å€™ - é‚£é¢—æ ‘çš„æ ¹ã€‚æ³¨æ„å¦‚æœä½ æ­£ä½¿ç”¨ .parse æ–¹æ³•è¿›è¡Œè§£æ, é‚£ä¹ˆ token TOP è¢«è‡ªåŠ¨åœ°é”šå®šåˆ°å­—ç¬¦ä¸²çš„å¼€å¤´å’Œç»“å°¾(å†çœ‹çœ‹ .subparse)ã€‚\nä½¿ç”¨ rule TOP æˆ– regex TOP ä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ã€‚\nåœ¨ .parseã€.subparse æˆ– .parsefile Grammar æ–¹æ³•ä¸­ä½¿ç”¨ :rule å‘½åå‚æ•°å¯ä»¥é€‰æ‹©ä¸€ä¸ªä¸åŒçš„ token æ¥è¿›è¡Œé¦–æ¬¡åŒ¹é…ã€‚\nws å½“ä½¿ç”¨ rule è€Œé token æ—¶, åŸå­(atom)åé¢çš„ä»»ä½•ç©ºç™½(whitespace)è¢«è½¬æ¢ä¸ºä¸€ä¸ªå¯¹ ws çš„éæ•è·è°ƒç”¨ã€‚å³:\nrule entry {\u0026lt;key\u0026gt;\u0026#39;=\u0026#39;\u0026lt;value\u0026gt;} ç­‰ä»·äº:\ntoken entry {\u0026lt;key\u0026gt;\u0026lt;.ws\u0026gt;\u0026#39;=\u0026#39;\u0026lt;.ws\u0026gt;\u0026lt;value\u0026gt;\u0026lt;.ws\u0026gt;} # . = non-capturing é»˜è®¤çš„ ws åŒ¹é…\u0026quot;ç©ºç™½\u0026quot;(whitespace), ä¾‹å¦‚ç©ºæ ¼åºåˆ—(ä¸ç®¡ä»€ä¹ˆç±»å‹)ã€æ¢è¡Œç¬¦ã€unspacesã€æˆ– heredocsã€‚\næä¾›ä½ è‡ªå·±çš„ ws token æ˜¯æå¥½çš„:\ngrammar Foo { rule TOP {\\d\\d} }.parse: \u0026#34;4 \\n\\n 5\u0026#34;; # Succeeds grammar Bar { rule TOP {\\d\\d} token ws {\\h*} }.parse: \u0026#34;4 \\n\\n 5\u0026#34;; # Fails ä¸Šé¢çš„ä¾‹å­ä¸­, åœ¨ Bar Gramamr ä¸­é‡å†™äº†è‡ªå·±çš„ ws, åªåŒ¹é…æ°´å¹³ç©ºç™½ç¬¦, æ‰€ä»¥ \\n\\n åŒ¹é…å¤±è´¥ã€‚\nsym \u0026lt;sym\u0026gt; token å¯ä»¥åœ¨åŸå‹æ­£åˆ™è¡¨è¾¾å¼(proto regex) ä¸­ä½¿ç”¨ï¼Œä»¥åŒ¹é…é‚£ä¸ªç‰¹å®šæ­£åˆ™è¡¨è¾¾å¼çš„ :sym å‰¯è¯çš„å­—ç¬¦ä¸²å€¼ï¼š\ngrammar Foo { token TOP {\u0026lt;letter\u0026gt;+} proto token letter {*}token letter:sym\u0026lt;P\u0026gt;{ \u0026lt;sym\u0026gt; }token letter:sym\u0026lt;e\u0026gt;{ \u0026lt;sym\u0026gt; }token letter:sym\u0026lt;r\u0026gt;{ \u0026lt;sym\u0026gt; }token letter:sym\u0026lt;l\u0026gt;{ \u0026lt;sym\u0026gt; }token letter:sym\u0026lt;*\u0026gt;{ . }}.parse(\u0026#34;I â™¥ Perl\u0026#34;, actions =\u0026gt;class { method TOP($/) { make $\u0026lt;letter\u0026gt;.grep(*.\u0026lt;sym\u0026gt;).join }}).made.say; # OUTPUT: Â«Perlâ¤Â» å½“ä½ å·²ç»å°†åŸå‹æ­£åˆ™è¡¨è¾¾å¼ä¸è¦åŒ¹é…çš„å­—ç¬¦ä¸²åŒºåˆ†å¼€æ¥æ—¶ï¼Œè¿™å¾ˆæ–¹ä¾¿ï¼Œå› ä¸ºä½¿ç”¨ \u0026lt;sym\u0026gt; token å¯é˜²æ­¢é‡å¤è¿™äº›å­—ç¬¦ä¸²ã€‚\næ€»æ˜¯æˆåŠŸæ–­è¨€ \u0026lt;?\u0026gt; is the always succeed assertion(æ€»æ˜¯åŒ¹é…æˆåŠŸ). å½“å®ƒç”¨ä½œ grammar ä¸­çš„ token æ—¶, å®ƒå¯ä»¥è¢«ç”¨äºè§¦å‘ä¸€ä¸ª Action ç±»æ–¹æ³•ã€‚åœ¨ä¸‹é¢çš„ grammar ä¸­, æˆ‘ä»¬æŸ¥æ‰¾é˜¿æ‹‰ä¼¯æ•°å­—å¹¶ä¸”ä½¿ç”¨ always succeed assertion å®šä¹‰ä¸€ä¸ª succ tokenã€‚\nåœ¨ action ç±»ä¸­, æˆ‘ä»¬ä½¿ç”¨å¯¹ succ æ–¹æ³•çš„è°ƒç”¨æ¥è®¾ç½®(åœ¨è¿™ä¸ªä¾‹å­ä¸­, æˆ‘ä»¬åœ¨ @!numbers ä¸­å‡†å¤‡äº†ä¸€ä¸ªæ–°å…ƒç´ )ã€‚åœ¨ digit æ–¹æ³•ä¸­, æˆ‘ä»¬æŠŠé˜¿æ‹‰ä¼¯æ•°å­—è½¬æ¢ä¸ºæ¢µæ–‡æ•°å­—å¹¶ä¸”æŠŠå®ƒæ·»åŠ åˆ° @!numbers æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ ä¸­ã€‚å¤šäºäº† succ, æœ€åä¸€ä¸ªå…ƒç´ æ€»æ˜¯å½“å‰æ­£è¢«è§£æçš„ digit æ•°å­—çš„æ•°ã€‚\ngrammar Digifier { rule TOP {[\u0026lt;.succ\u0026gt;\u0026lt;digit\u0026gt;+]+} token succ { \u0026lt;?\u0026gt; }token digit { \u0026lt;[0..9]\u0026gt; }} class Devanagari { has @!numbers; method digit ($/) { @!numbers[*-1] ~= $/.ord.\u0026amp;[+](2358).chr }method succ ($){ @!numbers.push: \u0026#39;\u0026#39; }method TOP ($/){ make @!numbers[^(*-1)] }} say Digifier.parse(\u0026#39;255 435 777\u0026#39;, actions =\u0026gt;Devanagari.new).made; # OUTPUT: # (à¥¨à¥«à¥« à¥ªà¥©à¥« à¥­à¥­à¥­) Grammar ä¸­çš„æ–¹æ³• åœ¨ grammar ä¸­ä½¿ç”¨ method ä»£æ›¿ rule æˆ– token ä¹Ÿæ˜¯å¯ä»¥çš„, åªè¦å®ƒä»¬è¿”å›ä¸€ä¸ª Cursor ç±»å‹:\ngrammar DigitMatcher { method TOP (:$full-unicode) { $full-unicode ?? self.num-full !! self.num-basic; } token num-full {\\d+} token num-basic {\u0026lt;[0..9]\u0026gt;+} } ä¸Šé¢çš„ grammar ä¼šæ ¹æ® parse æ–¹æ³•æä¾›çš„å‚æ•°å°è¯•ä¸åŒçš„åŒ¹é…:\nsay +DigitMatcher.subparse: \u0026#39;12à¥­à¥§à¥­à¥¯à¥¦à¥¯\u0026#39;, args =\u0026gt; \\(:full-unicode); # OUTPUT: # 12717909 say +DigitMatcher.subparse: \u0026#39;12à¥­à¥§à¥­à¥¯à¥¦à¥¯\u0026#39;, args =\u0026gt; \\(:!full-unicode); # OUTPUT: # 12 Action Object ã€€ä¸€ä¸ªæˆåŠŸçš„ grammar åŒ¹é…ä¼šç»™ä½ ä¸€æ£µåŒ¹é…å¯¹è±¡(Match objects)çš„è§£ææ ‘, åŒ¹é…æ ‘(match tree)åˆ°è¾¾çš„è¶Šæ·±, åˆ™ grammar ä¸­çš„åˆ†æ”¯è¶Šå¤š, é‚£ä¹ˆåœ¨åŒ¹é…æ ‘ä¸­èˆªè¡Œä»¥è·å–ä½ çœŸæ­£æ„Ÿå…´è¶£çš„ä¸œè¥¿å°±å˜çš„è¶Šæ¥è¶Šå›°éš¾ã€‚\nä¸ºäº†é¿å…ä½ åœ¨åŒ¹é…æ ‘(match tree)ä¸­è¿·å¤±, ä½ å¯ä»¥æä¾›ä¸€ä¸ª action objectã€‚grammar ä¸­æ¯æ¬¡è§£ææˆåŠŸä¸€ä¸ªå…·åè§„åˆ™(named rule)ä¹‹å, å®ƒå°±ä¼šå°è¯•è°ƒç”¨ä¸€ä¸ªå’Œè¯¥ grammar rule åŒåçš„æ–¹æ³•, å¹¶ä¼ é€’ç»™è¿™ä¸ªæ–¹æ³•ä¸€ä¸ªMatch å¯¹è±¡ä½œä¸ºä½ç½®å‚æ•°ã€‚å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„åŒåæ–¹æ³•, å°±è·³è¿‡ã€‚\nè¿™å„¿æœ‰ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜ grammar å’Œ actionï¼š\ngrammar TestGrammar { token TOP {^\\d+$} } class TestActions { method TOP($/) { $/.make(2 + $/); # ç­‰ä»·äº $/.make: 2 + $/ } } my $actions = TestActions.new; # åˆ›å»º Action å®ä¾‹ my $match = TestGrammar.parse(\u0026#39;40\u0026#39;, :$actions); say $match; # ï½¢40ï½£ say $match.made; # 42 TestActions çš„ä¸€ä¸ªå®ä¾‹å˜é‡ä½œä¸ºå…·åå‚æ•° actions è¢«ä¼ é€’ç»™ parse è°ƒç”¨, ç„¶åå½“ token TOP åŒ¹é…æˆåŠŸä¹‹å, å°±ä¼šè‡ªåŠ¨è°ƒç”¨æ–¹æ³• TOP, å¹¶ä¼ é€’åŒ¹é…å¯¹è±¡(match object) ä½œä¸ºæ–¹æ³•çš„å‚æ•°ã€‚\nä¸ºäº†è®©å‚æ•°æ˜¯åŒ¹é…å¯¹è±¡æ›´æ¸…æ¥š, ä¸Šé¢çš„ä¾‹å­ä½¿ç”¨ $/ ä½œä¸º action æ–¹æ³•çš„å‚æ•°å, å°½ç®¡é‚£ä»…ä»…æ˜¯ä¸€ä¸ªæ–¹ä¾¿çš„çº¦å®š, è·Ÿå†…åœ¨æ— å…³ã€‚$match ä¹Ÿå¯ä»¥ã€‚(å°½ç®¡ä½¿ç”¨ $/ å¯ä»¥æä¾›æŠŠ $ ä½œä¸º $/ çš„ç¼©å†™çš„ä¼˜åŠ¿ã€‚)\nä¸‹é¢æ˜¯ä¸€ä¸ªæ›´æœ‰è¯´æœåŠ›çš„ä¾‹å­:\ngrammar KeyValuePairs { token TOP {[\u0026lt;pair\u0026gt;\\n+]*} token ws {\\h*} rule pair { \u0026lt;key=.identifier\u0026gt; \u0026#39;=\u0026#39; \u0026lt;value=.identifier\u0026gt; }token identifier { \\w+ }} class KeyValuePairsActions { method pair ($/) { $/.make: $\u0026lt;key\u0026gt;.made =\u0026gt; $\u0026lt;value\u0026gt;.made }method identifier($/) { # å­ä¾‹ç¨‹ `make` å’Œåœ¨ $/ ä¸Šè°ƒç”¨ .make ç›¸åŒ make ~$/ } method TOP ($match) { # TOP æ–¹æ³•çš„å‚æ•°å¯ä»¥ä½¿ç”¨ä»»æ„å˜é‡å, è€Œä¸ä»…ä»…æ˜¯ $/ $match.make: $match\u0026lt;pair\u0026gt;Â».made } } my $res = KeyValuePairs.parse(q:to/EOI/,:actions(KeyValuePairsActions)).made; second=b hits=42 perl=6 EOI for @$res -\u0026gt; $p { say \u0026#34;Key: $p.key()\\tValue: $p.value()\u0026#34;; } è¿™ä¼šè¾“å‡º:\nKey: second Value: b Key: hits Value: 42 Key: perl Value: 6 pair è¿™ä¸ª rule, è§£æä¸€å¯¹ç”±ç­‰å·åˆ†å‰²çš„ pair, å¹¶ä¸”ç»™ identifier è¿™ä¸ª token å„è‡ªèµ·äº†åˆ«åã€‚å¯¹åº”çš„ action æ–¹æ³•æ„å»ºäº†ä¸€ä¸ª Pair å¯¹è±¡, å¹¶ä½¿ç”¨å­åŒ¹é…å¯¹è±¡(sub match objects)çš„ .made å±æ€§ã€‚è¿™ä¹Ÿæš´éœ²äº†ä¸€ä¸ªäº‹å®: submatches çš„ action æ–¹æ³•åœ¨é‚£äº›è°ƒç”¨æ­£åˆ™/å¤–éƒ¨æ­£åˆ™ä¹‹å‰å°±è¢«è°ƒç”¨ã€‚æ‰€ä»¥ action æ–¹æ³•æ˜¯æŒ‰åç»­è°ƒç”¨çš„ã€‚\nåä¸º TOP çš„ action æ–¹æ³•ä»…ä»…æŠŠç”± pair è¿™ä¸ª rule çš„å¤šé‡åŒ¹é…ç»„æˆçš„æ‰€æœ‰å¯¹è±¡æ”¶é›†åˆ°ä¸€å—, ç„¶åä»¥ä¸€ä¸ªåˆ—è¡¨çš„æ–¹å¼è¿”å›ã€‚\næ³¨æ„ KeyValuePairsActions æ˜¯ä½œä¸ºä¸€ä¸ªç±»å‹å¯¹è±¡(type object)ä¼ é€’ç»™æ–¹æ³• parseçš„, è¿™æ˜¯å› ä¸º action æ–¹æ³•ä¸­æ²¡æœ‰ä¸€ä¸ªä½¿ç”¨å±æ€§(å±æ€§åªèƒ½é€šè¿‡å®ä¾‹æ¥è®¿é—®)ã€‚\nå…¶å®ƒæƒ…å†µä¸‹, action æ–¹æ³•å¯èƒ½ä¼šåœ¨å±æ€§ä¸­ä¿å­˜çŠ¶æ€ã€‚ é‚£ä¹ˆè¿™å½“ç„¶éœ€è¦ä½ ä¼ é€’ä¸€ä¸ªå®ä¾‹ç»™ parse æ–¹æ³•ã€‚\næ³¨æ„, token ws æœ‰ç‚¹ç‰¹æ®Š: å½“ :sigspace å¼€å¯çš„æ—¶å€™(å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨ ruleçš„æ—¶å€™), æˆ‘ä»¬è¦†å†™çš„ ws ä¼šæ›¿æ¢æŸäº›ç©ºç™½åºåˆ—ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ rule pair ä¸­ç­‰å·ä¸¤è¾¹çš„ç©ºæ ¼è§£ææ²¡æœ‰é—®é¢˜å¹¶ä¸”é—­åˆ } ä¹‹å‰çš„ç©ºç™½ä¸ä¼šç‹¼åè™å’½åœ°åƒä¸‹æ¢è¡Œç¬¦, å› ä¸ºæ¢è¡Œç¬¦åœ¨ TOP token å·²ç»å ä½ç½®äº†, å¹¶ä¸” token ä¸ä¼šå›æº¯ã€‚\n# ws çš„å†…ç½®å®šä¹‰ /\u0026lt;.ws\u0026gt;/ # match \u0026#34;whitespace\u0026#34;: # \\s+ if it\u0026#39;s between two \\w characters, # \\s* otherwise my token ws {\\h*} # é‡å†™ ws è¿™ä¸ªå†…ç½®çš„ token \u0026gt;say so \u0026#34;\\n\u0026#34; ~~ \u0026amp;ws # True æ‰€ä»¥ \u0026lt;.ws\u0026gt; å†…ç½®çš„å®šä¹‰æ˜¯ï¼šå¦‚æœç©ºç™½åœ¨ä¸¤ä¸ª \\w å•è¯å­—ç¬¦ä¹‹é—´, åˆ™æ„æ€ä¸º \\s+, å¦åˆ™ä¸º \\s*ã€‚ æˆ‘ä»¬å¯ä»¥é‡å†™ ws å…³äºç©ºç™½çš„å®šä¹‰, é‡æ–°å®šä¹‰æˆ‘ä»¬éœ€è¦çš„ç©ºç™½ã€‚æ¯”å¦‚æŠŠ ws å®šä¹‰ä¸º { \\h* } å°±æ˜¯æ‰€æœ‰æ°´å¹³ç©ºç™½ç¬¦, ç”šè‡³å¯ä»¥å°†ws å®šä¹‰ä¸ºéç©ºç™½å­—ç¬¦ã€‚ä¾‹å¦‚: token ws { 'x' }\n","permalink":"https://ohmyweekly.github.io/notes/2016-02-05-raku-grammars/","tags":["grammar"],"title":"Raku Grammars"},{"categories":["rakulang"],"contents":":my $foo çš„ä½œç”¨åŸŸå’Œç”¨é€” åœ¨ regexã€token æˆ– rule ä¸­, å®šä¹‰åƒä¸‹é¢è¿™æ ·çš„å˜é‡æ˜¯å¯èƒ½çš„:\ntoken directive {:my $foo = \u0026#34;in command\u0026#34;;\u0026lt;command\u0026gt;\u0026lt;subject\u0026gt;\u0026lt;value\u0026gt;?} åœ¨ä¸­æåˆ°äº†ä¸€ç‚¹æœ‰å…³è¯¥å˜é‡çš„ä¸œè¥¿, æˆ‘å¼•ç”¨è¿‡æ¥:\n ä»»ä½• grammar regex å®é™…ä¸Šæ˜¯ä¸€ç§æ–¹æ³•, å¹¶ä¸”ä½ å¯ä»¥åœ¨è¿™æ ·ä¸€ä¸ªå­ä¾‹ç¨‹ä¸­ä½¿ç”¨ä¸€ä¸ªå†’å·è·Ÿç€ä»»ä½•ä½œç”¨åŸŸå£°æ˜ç¬¦æ¥å£°æ˜ä¸€ä¸ªå˜é‡, è¿™äº›å£°æ˜ç¬¦åŒ…æ‹¬ my, our, state å’Œ constant (ä½œä¸ºç±»ä¼¼çš„å£°æ˜ç¬¦, temp å’Œ let ä¹Ÿèƒ½è¢«è¯†åˆ«). å•ä¸ªè¯­å¥(ç›´åˆ°ç»“å°¾çš„åˆ†å·æˆ–è¡Œæœ«å°¾çš„é—­æ‹¬å·ä¸ºæ­¢) è¢«è§£æä¸ºæ™®é€šçš„ Raku ä»£ç :\n token prove-nondeterministic-parsing {:my $threshold = rand;\u0026#39;maybe\u0026#39;\\s+\u0026lt;it($threshold)\u0026gt;} æœ‰è°èƒ½è§£é‡Šä¸‹è¿™æ®µä»£ç çš„åº”ç”¨åœºæ™¯å—ï¼Ÿ\nwhat scope does :my $foo; have? :my $foo åœ¨å®ƒæ‰€å‡ºç°çš„ rule/token/regex ä¸­æ‹¥æœ‰è¯æ³•ä½œç”¨åŸŸ(lexical scope)ã€‚ä½ æ‰€å¾—åˆ°çš„ä½œç”¨åŸŸè¦ä¹ˆå¾ˆå¤§è¦ä¹ˆå¾ˆå°:\ngrammar g { regex r1 {{ my $foo; ...}# `$foo` åœ¨è¯¥ block çš„ç»“å°¾è¶…å‡ºä½œç”¨åŸŸã€‚ ...{ say $foo; }# `$foo` ä¸åœ¨ä½œç”¨åŸŸä¸­ã€‚ } } grammar i { my $foo; regex r1 {...} # åœ¨ `r1` å†…éƒ¨, `$foo` è¢«è¯†åˆ«å‡ºã€‚ ... regex r999 {...} # ä½†æ˜¯åœ¨ r999 ä¸­ä¹Ÿæ˜¯ã€‚ } å®ƒçš„ç”¨é€”? ä½¿ç”¨ :my $foo; å½¢å¼çš„å˜é‡å£°æ˜ä»¥åœ¨ rule/token/regex ä¸­å£°æ˜æœ¬åœ°ä½œç”¨åŸŸçš„å˜é‡, å¦‚æœæ²¡æœ‰è¿›ä¸€æ­¥çš„å£°æ˜, é‚£ä¹ˆè¿™äº›å˜é‡èƒ½åœ¨ rule/token/regex ä¸­çš„ä»»ä½•åœ°æ–¹é€šè¿‡æ‰€å£°æ˜çš„åå­—æ¥å¼•ç”¨ã€‚ä¸¾ä¸ªä¾‹å­, ä½ å¯ä»¥çœ‹çœ‹ Rakudo çš„ Grammar.nqp æºä»£ç ä¸­çš„ token babble ä¸­å£°æ˜çš„ @extra_tweaks å˜é‡çš„ç”¨æ³•ã€‚\nä½¿ç”¨ :my $*foo; å½¢å¼çš„å˜é‡å£°æ˜æ¥å£°æ˜åŠ¨æ€çš„è¯æ³•å˜é‡ã€‚åŠ¨æ€å˜é‡èƒ½å¤Ÿ, åœ¨æ²¡æœ‰è¿›ä¸€æ­¥å£°æ˜çš„æƒ…å†µä¸‹, åœ¨é—­åˆè¯æ³•ä½œç”¨åŸŸå’Œé—­åˆåŠ¨æ€ä½œç”¨åŸŸä¸­é€šè¿‡å®ƒä»¬å£°æ˜çš„åå­—æ¥å¼•ç”¨ã€‚ä½œä¸ºè¯´æ˜, è¯·æŸ¥çœ‹ the declaration of @*nibbles in Rakudo\u0026rsquo;s Grammar module å’Œ its use in Rakudo\u0026rsquo;s Actions module ã€‚\nä¸€èˆ¬çš„ä½¿ç”¨åœºæ™¯ åœ¨ regular expressions ä¸­ä¸€èˆ¬ä¸ä½¿ç”¨ :â€¦ é£æ ¼çš„å£°æ˜ã€‚:...; ç»“æ„é€šå¸¸ç”¨åœ¨ç‰¹åˆ«å¤æ‚å’Œåºå¤§çš„ grammars ä¸­ã€‚å¯¹äºè¿™äº›ä½¿ç”¨åœºæ™¯, ä¾é  Raku çš„æ­£åˆ™è¡¨è¾¾å¼å’Œé—­åŒ…çš„ä¸€è‡´æ€§æ˜¯åˆé€‚çš„ã€‚æ­£æ˜¯è¿™ä½¿å¾— rule/token/regex çº§åˆ«çš„ :...; å˜é‡å£°æ˜å˜å¾—æ­£å½“ã€‚\nRegexes å’Œ closures çš„ä¸€è‡´æ€§ å¾ˆå¤š grammars éƒ½æ˜¯ä¸Šä¸‹æ–‡æœ‰å…³çš„.\nRaku ä½¿ regexes å’Œ closures ç»Ÿä¸€äº†:\nsay Regex.^mro; (Regex) (Method) (Routine) (Block) (Code) ... mro æ˜¯æ–¹æ³•è§£æé¡ºåº, è¿™è¶³ä»¥è¯´æ˜ regex å®é™…ä¸Šæ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„æ–¹æ³•(å°±åƒæ–¹æ³•æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„å­ä¾‹ç¨‹ä¸€æ ·)ã€‚\nRaku: is there a phaser that runs only when you fall out of a loop? #!/usr/bin/env raku ROLL: for 1..10 -\u0026gt; $r { given (1..6).roll { when 6 { say \u0026#34;Roll $r:you win!\u0026#34;; last ROLL; } default { say \u0026#34;Roll $r:sorry...\u0026#34;; } } LAST { say \u0026#34;You either won or lost - this runs either way\u0026#34;; } } æ›´ä¼˜é›…çš„å†™æ³•:\nconstant N = 5; for flat (1..6).roll xx * Z 1..N -\u0026gt; $_, $n { print \u0026#34;roll $n:$_\u0026#34;; when 6 { put \u0026#34;(won)\u0026#34;; last; } default { put \u0026#34;(lost)\u0026#34;; } LAST { print \u0026#34;result: \u0026#34;; when 6 { put \u0026#34;winner :)\u0026#34; } default { put \u0026#34;loser :(\u0026#34; } } } æ€ä¹ˆä»å‘½ä»¤è¡Œä¼ é€’ä¸€ä¸ªå¤æ•°ç»™ sub MAIN? #!/usr/bin/env raku sub MAIN($x) { say \u0026#34;$xsquared is { $x*$x }\u0026#34;; } æˆ‘è¦åœ¨å‘½ä»¤è¡Œä¸­ä¼ é€’ä¸€ä¸ªå¤æ•°ç»™ MAIN:\n % ./square i  Cannot convert string to number: base-10 number must begin with valid digits or '.' in 'âi' (indicated by â) in sub MAIN at ./square line 7 in block \u0026lt;unit\u0026gt; at ./square line 5 Actually thrown at: in sub MAIN at ./square line 7 in block \u0026lt;unit\u0026gt; at ./square line 5 å½“æˆ‘æŠŠè„šæœ¬å˜ä¸º:\n#!/usr/bin/env raku sub MAIN(Complex $x) { say \u0026#34;$xsquared is { $x*$x }\u0026#34;; } å®ƒç«Ÿç„¶å½»åº•ç½¢å·¥äº†:\n% ./square i Usage: square \u0026lt;x\u0026gt; % ./square 1 Usage: square \u0026lt;x\u0026gt; ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ Coercive type declaration (å¼ºåˆ¶ç±»å‹å£°æ˜), ä» Str åˆ° Complex:\nsub MAIN(Complex(Str) $x) { say \u0026#34;$xçš„å¹³æ–¹ä¸º { $x * $x }\u0026#34;; } é‚£ä¹ˆ:\n% ./squared.pl 1 1+0i çš„å¹³æ–¹ä¸º 1+0i % ./squared.pl 1+2i 1+2i çš„å¹³æ–¹ä¸º -3+4i ä½†æ˜¯:\n$ ./test.pl6 2 Usage: ./test.p6 \u0026lt;x\u0026gt; æ‰€ä»¥ä½ çœŸæ­£éœ€è¦çš„æ˜¯æŠŠå…¶å®ƒ Numeric ç±»å‹å¼ºè½¬ä¸º Complex ç±»å‹:\n#!/usr/bin/env raku sub MAIN ( Complex(Real) $x ) { say \u0026#34;$xsquared is { $x*$x }\u0026#34;; } æˆ‘ä½¿ç”¨ Real è€Œé Numeric, å› ä¸º Complex å·²ç»æ¶µç›–äº†å…¶å®ƒçš„äº†ã€‚\nBlessing a Hash into an object ä¸ºä»€ä¹ˆæˆ‘å†™çš„è¿™æ®µä»£ç ä¸å¯¹å‘¢ï¼Ÿ\nclass WordCount { has %!words; # Tried with both . and ! method new($string) { my %words; my @sentence = split(/\\s+/, $string); for @sentence -\u0026gt; $word { %words{$word}++; } return self.bless(:%words); } method sayCounts() { my @keys = keys(%!words); for @keys -\u0026gt; $key { say $key ~ \u0026#34;\u0026#34; ~ %!words{$key}; } } } sub MAIN { my $sentence = \u0026#34;the boy jumped over the dog\u0026#34;; my $wordCount = WordCount.new($sentence); $wordCount.sayCounts(); } Raku-ify:\nclass WordCount { has Int %.words is default(0); method new($string) { my Int %words; for $string.split(/\\s+/) -\u0026gt; $word { %words{$word}++; } self.bless(:%words) } method gist { %.words.map({.value ~ \u0026#34;\u0026#34; ~ .key}).join(\u0026#34;\\n\u0026#34;) } } my $word-count = WordCount.new(\u0026#39;the boy jumped over the dog\u0026#39;); say $word-count; æ•£åˆ—ä¸­çš„æ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ª Pair:\nmy %w = a =\u0026gt; 1; %w.map({ say $_.^name }) # OUTPUTÂ«Pairâ¤Â» æ‰€ä»¥:\n%.words.map({.value ~ \u0026#34;\u0026#34; ~ .key}).join(\u0026#34;\\n\u0026#34;) ç­‰ä»·äº:\n%.words.kv.map( -\u0026gt; $word, $count { \u0026#34;$word$count\u0026#34; } ).join(\u0026#34;\\n\u0026#34;) ä½ è¿˜å¯ä»¥ä½¿ç”¨ sub-signature(å­ç­¾å)æ¥è§£æ„ .map æä¾›çš„ Pairï¼š\n%.words.map( -\u0026gt; (:key($word), :value($count)) { \u0026#34;$word$count\u0026#34; } ).join(\u0026#34;\\n\u0026#34;) å­—ç¬¦ä¸²å¤„ç†  å°†æ¯è¡Œä»ç¬¬äºŒåˆ—åˆ°æœ€åä¸€åˆ—æ•°å€¼ä¸º0çš„ä¸”æ•°ç›®å¤šäº6ä¸ªçš„è¡Œåˆ é™¤\n æ•°æ®ï¼š\nOG004240: 1 3 1 1 9 0 4 5 1 1 6 1 2 OG004241: 1 2 1 4 7 2 1 3 1 2 9 1 1 OG004242: 1 2 1 2 4 1 3 9 2 2 4 2 2 OG004243: 0 4 1 2 9 2 4 5 1 2 3 1 1 OG004244: 0 2 1 3 8 3 3 2 2 3 4 2 2 OG004245: 0 3 1 2 7 3 3 0 3 2 7 2 2 OG004246: 0 0 2 0 1 15 0 15 0 0 1 0 1 my @lines = \u0026#34;a.txt\u0026#34;.IO.lines; for @lines -\u0026gt; $line { my @words = $line.split(/\\s+/); say $line unless @words[1..*].grep(* eq 0).elems \u0026gt; 6; } ä½¿ç”¨ rakudoc -f Str.split æŸ¥çœ‹ split çš„å¸®åŠ©æ–‡æ¡£ã€‚\nåˆå¹¶ç›¸åŒè¡Œï¼š\næ–‡ä»¶ä¸€ï¼š\n1###ENSMMUP00000017866###-###27582-27683 1###ENSMMUP00000017866###-###27508-27576 1###ENSMMUP00000017866###-###27290-27503 1###ENSMMUP00000040736###-###199515-200498 1###ENSMMUP00000040736###-###198582-198818 1###ENSMMUP00000030409###+###395728-395934 1###ENSMMUP00000030409###+###403004-403148 æƒ³åˆå¹¶ç›¸åŒçš„ï¼Œç”Ÿæˆæ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š\n1###ENSMMUP00000017866###-###27582-27683 27508-27576 27290-27503 1###ENSMMUP00000040736###-###199515-200498 198582-198818 1###ENSMMUP00000030409###+###395728-395934 403004-403148 ä¸€ç§æ–¹æ³•å¦‚ä¸‹ï¼š\nmy @lines = \u0026#34;a.txt\u0026#34;.IO.lines; my %hash; for @lines -\u0026gt; $line { $line.match(/^(.*?)(\\d+\u0026#39;-\u0026#39;\\d+)/); %hash{$0} ~= $1 ~ \u0026#34;\u0026#34;; } for %hash.kv -\u0026gt; $key, $value { say $key, $value; } å¦‚ä¸‹æ•°æ®ï¼Œæƒ³å»æ‰ç¬¬3åˆ—é‡å¤çš„è¡Œä¸”ä¿ç•™çš„è¡Œè¦ä½¿ç¬¬å››åˆ—æœ€å°, åŸå§‹æ•°æ®ï¼š\n326 0.00 0.00 ( 0 ) 63 0.00 2.43 ( 0.0082 ) 64 0.00 2.43 ( 0.0082 ) 120 0.00 2.43 ( 0 ) 340 0.00 4.03 ( 0 ) 99 0.00 9.14 ( 0.0229 ) 441 0.00 9.14 ( 0.0232 ) 142 0.00 10.77 ( 0.0569 ) 292 0.00 10.77 ( 0.0393 ) 266 0.00 10.77 ( 0.0233 ) æƒ³è¦çš„ç»“æœï¼š\n326 0.00 0.00 ( 0 ) 120 0.00 2.43 ( 0 ) 340 0.00 4.03 ( 0 ) 99 0.00 9.14 ( 0.0229 ) 266 0.00 10.77 ( 0.0233 ) ä¸€ç§æ–¹æ³•å¦‚ä¸‹ï¼š\nmy @lines = \u0026#34;a.txt\u0026#34;.IO.lines; my %hash; for @lines -\u0026gt; $line { $line.match(/(\\d+\\.\\d+)\\s+\\(\\s+(\\S+)/); %hash{$0} ~= $1 ~ \u0026#34;\u0026#34;; } for @lines -\u0026gt; $line { $line.match(/(\\d+\\.\\d+)\\s+\\(\\s+(\\S+)/); for %hash.kv -\u0026gt; $key, $value { say $line if $0 ~~ $key \u0026amp;\u0026amp; $1 ~~ $value.words.min; } } æœ‰ gene.txt å’Œ in.txt ä¸¤ä¸ªæ–‡ä»¶, æ–‡ä»¶å†…å®¹å¦‚ä¸‹:\ngene.txt:ï¼ˆ2000å¤šè¡Œ)\nchr1 ABCA4 94458582 94586799 chr1 ACADM 76190031 76229363 chr16 BBS2 56518258 56554008 chr17 G6PC 41052813 41066450 chr17 GAA 78078244 78093271 in.txt:(5ä¸‡å¤šè¡Œ)\n1 94505603 rs368951547 C T NA NA 1 94505604 rs61750126 A C 0.02066 NA 1 94505611 rs137853898 G A NA not-provided 1 94505620 rs370967816 T A NA NA 1 94505621 rs149503495 T C NA NA 1 94505627 rs374610040 A G NA NA 22 18901263 rs377148163 C A NA NA 22 18901290 rs381848 G A 0.07989 NA 22 18901322 rs62232347 C A NA NA 22 18901326 rs201353896 TCC T 0.05005 NA 22 18901327 rs10537001 CCT C 0.0528 NA 16 18901326 rs201353896 TCC T 0.05005 NA 17 18901327 rs10537001 CCT C 0.0528 NA gene.txt å’Œ in.txt çš„ç¬¬ä¸€åˆ—çš„æ•°å­—éƒ¨åˆ†ç›¸åŒï¼Œå¹¶ä¸” In çš„ç¬¬äºŒåˆ—åœ¨gene çš„ä¸‰å››åˆ—èŒƒå›´ä¹‹é—´ï¼Œå°±è¾“å‡º in.txt ä¸­çš„é‚£ä¸€è¡Œã€‚\nè§£å†³æ–¹æ³•ï¼š\nmy @lines = \u0026#34;a.txt\u0026#34;.IO.lines; my @inlines = \u0026#34;in.txt\u0026#34;.IO.lines; my %hash; for @lines -\u0026gt; $line { $line.match(/^chr(\\d+)\\s+(\\w+)\\s+(\\d+)\\s+(\\d+)/); %hash{$0~$1~$2~$3} = $0 ~ \u0026#34;\u0026#34; ~ $2 ~ \u0026#34;\u0026#34; ~ $3; } for @inlines -\u0026gt; $line { $line.match(/^(\\d+)\\s+(\\d+)/); for %hash.values -\u0026gt; $value { say $line if $0 ~~ $value.words[0] \u0026amp;\u0026amp; $1 \u0026lt;= $value.words[1].Num \u0026amp;\u0026amp; $1 \u0026lt;= $value.words[2].Num; } } ä¾‹å¦‚æˆ‘ç°åœ¨æ•°ç»„ä¸­çš„å€¼æ˜¯ @project = ('NX11','NX12','NX13â€™)ã€‚\nå¦å¤–ä¸€ä¸ªæ•°ç»„æ˜¯ @get = ('ss','ssfd','NX12','sed','NX11â€™)ã€‚\nç°åœ¨æŠŠç¬¬ä¸€ä¸ªæ•°ç»„ä¸­å‡ºç°è¿‡çš„å€¼ï¼Œå¦‚æœç¬¬äºŒä¸ªæ•°ç»„ä¸­ä¹Ÿæœ‰çš„è¯åˆ é™¤æ‰ï¼Œç„¶åä¿ç•™ç¬¬äºŒä¸ªæ•°ç»„å‰©ä¸‹çš„å€¼ã€‚\nä½¿ç”¨å·®é›†ï¼š\n@get (-) @project æœ‰å¦‚ä¸‹æ•°æ®ï¼š\nPL -0.00 5.50 PL -0.25 3.50 PL -0.50 0.00 PL -0.75 4.50 -0.25 -0.00 1.00 -0.25 -0.25 4.50 -0.25 -0.50 1.00 -0.75 -0.75 1.00 -0.75 -1.00 0.00 -1.00 -0.25 3.50 -1.00 -0.50 0.00 -1.00 -1.25 3.40 -1.00 -1.75 4.00 å°†ç¬¬ä¸€åˆ—å€¼ç›¸åŒçš„è¡Œåˆå¹¶ï¼Œ åˆ†ä½¿åˆå¹¶ç¬¬äºŒåˆ—å’Œç¬¬ä¸‰åˆ—ï¼š\nç»“æœå¦‚ä¸‹ï¼š\nPL -0.00 -0.25 -0.50 -0.75 PL 5.50 3.50 0.00 4.50 ... é¢å‘å¯¹è±¡ Fluent interface (æµæ¥å£)\nåœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œä¸€ä¸ªæµæ¥å£ï¼ˆfluent Interfaceï¼‰æ˜¯æŒ‡å®ç°ä¸€ç§å®ç°é¢å‘å¯¹è±¡çš„èƒ½æé«˜ä»£ç å¯è¯»æ€§çš„APIçš„æ–¹æ³•ã€‚ åœ¨ Raku ä¸­æœ‰å¾ˆå¤šç§æ–¹æ³•, ä½†æ˜¯æœ€ç®€å•çš„ä¸€ç§æ˜¯å£°æ˜å±æ€§ä¸ºå¯è¯»å†™å¹¶ä½¿ç”¨ given å…³é”®å­—ã€‚ç±»å‹æ³¨é‡Šæ˜¯å¯é€‰çš„ã€‚\nclass Employee { subset Salary of Real where * \u0026gt; 0; subset NonEmptyString of Str where * ~~ /\\S/; # è‡³å°‘ä¸€ä¸ªéç©ºç™½ç¬¦å· has NonEmptyString $.name is rw; has NonEmptyString $.surname is rw; has Salary $.salary is rw; method gist { return qq:to[END];Name: $.nameSurname: $.surnameSalary: $.salaryEND } } my $employee = Employee.new(); given $employee { .name = \u0026#39;Sally\u0026#39;; .surname = \u0026#39;Ride\u0026#39;; .salary = 200; } say $employee; # Output: # Name: Sally # Surname: Ride # Salary: 200  åœ¨ Raku ä¸­æ€æ ·æ£€æŸ¥æ–‡ä»¶çš„æ—¶é—´æˆ³å±æ€§  åœ¨ Raku ä¸­æ€æ ·æ£€æŸ¥æ–‡ä»¶çš„æ—¶é—´æˆ³å±æ€§ï¼Ÿ åœ¨ Perl 5 ä¸­æ˜¯ä½¿ç”¨æ–‡ä»¶æµ‹è¯•æ“ä½œç¬¦ file test operators , åœ¨ Raku ä¸­æ˜¯ä½¿ç”¨æ¥è‡ªäº IO::FileTestableÂ role çš„æ–¹æ³• (e.g.Â .modified,Â .accessedÂ andÂ .changed) ã€‚\nä¾‹å¦‚:\nmy $filename = \u0026#34;sample.txt\u0026#34;; my $seconds_since_epoch = $filename.IO.accessed; my $readable_timestamp = DateTime.new($filename.IO.accessed); say \u0026#34;File \u0026#39;$filename\u0026#39;was last accessed at \u0026#39;$readable_timestamp\u0026#39;, which is {$seconds_since_epoch.Num}seconds since the epoch\u0026#34;; 2ã€æˆ‘æ­£å°è¯•ç”ŸæˆåŒ…å« 10 ä¸ªéšæœºéšæœºåºåˆ—çš„ FASTQ æ–‡ä»¶ï¼Œåºåˆ—ç”±éšæœºå“è´¨åˆ†æ•°æ„æˆã€‚æˆ‘åŸæ¥æ˜¯ä½¿ç”¨ä¸‹é¢çš„ä»£ç ï¼Œå®ƒå·¥ä½œè‰¯å¥½:\nmy @seq = (rand_fa_seq() for ^10); my @qual = (rand_qual() for ^10); @seq.raku.say; @qual.raku.say; sub rand_fa_seq { return join(\u0026#34;\u0026#34;, roll(20,\u0026#34;ACGT\u0026#34;.comb)); } sub rand_qual { return join(\u0026#34;\u0026#34;, roll(20,\u0026#34;EFGHIJ\u0026#34;.comb)) } ç­‰ä»·äºï¼š\nsub rand-fa-seq($n = 20) { \u0026lt;A C G T\u0026gt;.roll($n).join } sub rand-qual($n = 20) { \u0026lt;E F G H I J\u0026gt;.roll($n).join } my @seq = rand-fa-seq() xx 10; my @qual = rand-qual() xx 10; 3ã€åœ¨ Raku ä¸­ä½¿ç”¨ \u0026ldquo;åˆ—è¡¨è§£æ\u0026rdquo; ç”Ÿæˆéå¹³æ–¹æ•°åˆ—è¡¨\nåœ¨ Raku ä¸­æˆ‘æ€æ ·ä½¿ç”¨ \u0026ldquo;åˆ—è¡¨è§£æ\u0026rdquo; åˆ›å»ºä¸€ç»„éå¹³æ–¹æ•°? æˆ‘åœ¨ Rosetta CodeÂ é‚£å„¿çœ‹åˆ°äº†å¦‚ä½•æ‰“å°ä¸€ç»„éå¹³æ–¹æ•°çš„ä»£ç ï¼š\nsub nth_term (Int $n) { $n + round sqrt $n } say nth_term $_ for 1 .. 22; ç›®å‰ä¸ºæ­¢æˆ‘çœ‹åˆ°çš„æœ€æ¥è¿‘çš„ä¸œè¥¿æ˜¯ä½¿ç”¨ for å…³é”®å­—ã€‚ ä½†æ˜¯å› ä¸ºè¿™å®é™…ä¸Šä»…ä»…æ˜¯ä¸€ä¸ªå†…è”ï¼ˆinlineï¼‰å¾ªç¯ï¼Œæˆ‘è®¤ä¸ºè¿™ä»æŠ€æœ¯ä¸Šæ¥è®²å¹¶ä¸æ˜¯åˆ—è¡¨è§£æï¼Œå°½ç®¡å®ƒçœ‹èµ·æ¥ç›¸ä¼¼ï¼š\nmy @y = ($_**2 + 1 for 1 .. 10); ä½†æ˜¯ï¼Œæˆ‘çœŸæ­£æƒ³çŸ¥é“æ˜¯å¦æœ‰ä¸€ç§ â€œåˆ—è¡¨è§£æ â€œ çš„æ–¹æ³•æ¥åˆ›å»ºå¯åœ¨æ•°å­¦ä¸Šæè¿°çš„è¯¸å¦‚éå¹³æ–¹æ•°çš„åˆ—è¡¨ã€‚è¿™å„¿æœ‰ä¸€ä¸ªæˆ‘ç”¨æ¥åˆ›å»ºä¸€ç»„éå¹³æ–¹æ•°çš„æ–¹æ³•ï¼ˆç›´åˆ° 30ï¼‰ï¼š\nmy @non_squares = grep {sqrt($_) != floor(sqrt($_))}, 1 .. 30; æˆ‘æ€æ ·ç”¨åˆ—è¡¨è§£ææ¥å®ç°å®ƒå‘¢ï¼Ÿ\nå®é™…ä¸Šï¼Œ ä½ çš„ä¾‹å­ my @y = ($_**2 + 1 for 1 .. 10);Â æ˜¯ Raku æ–¹å¼å†™æˆçš„åˆ—è¡¨è§£æã€‚ä½ è¿˜å¯ä»¥æ·»åŠ ä¸€ä¸ªæ¡ä»¶æµ‹è¯•ï¼Œ å°±åƒÂ Raku design document S04 ä¸­å»ºè®®çš„é‚£æ ·ï¼š\n ä¸ºäº†è½»æ¾åœ°ä¹¦å†™åˆ—è¡¨è§£æï¼Œ å¾ªç¯è¯­å¥ä¿®é¥°ç¬¦å…è®¸åŒ…å«å•ä¸ªæ¡ä»¶è¯­å¥ä¿®é¥°ç¬¦ï¼š\n sub odd(Int $n) {return $n % 2} @evens = ($_ * 2 if .\u0026amp;odd for 0..100); è¿™ä¸ªå°±æ˜¯æ€æ ·å†™ä¸€ä¸ª Raku åˆ—è¡¨è§£æçš„éå¹³æ–¹æ•°ï¼ˆç›´åˆ° 30ï¼‰ï¼š\nmy @non_squares = ($_ if .sqrt != .sqrt.Int for 1 .. 30); ä¸€ä¸¢ä¸¢è§£é‡Šï¼šåœ¨æ¯æ¬¡ for å¾ªç¯è¿­ä»£ä¸­ï¼Œ ä» 1 åˆ° 30 è¿™ä¸ªèŒƒå›´ä¸­çš„å½“å‰æ•°å­—ä¼šè¢«èµ‹å€¼ç»™é»˜è®¤å˜é‡ $_ï¼ˆç­‰ä»·äº itï¼‰ã€‚æ²¡æœ‰è°ƒç”¨è€…çš„æ–¹æ³•è°ƒç”¨ä¼šé»˜è®¤åœ¨ â€œit\u0026quot; èº«ä¸Šè°ƒç”¨ï¼ˆä¾‹å¦‚ .sqrt ç­‰ä»·äº $_.sqrtï¼‰ã€‚ æ‰€ä»¥ï¼Œå¯¹äº 1åˆ°30ä¸­çš„æ¯ä¸€ä¸ªæ•°å­—ï¼Œå®ƒçš„å¹³æ–¹æ ¹è¢«æ£€æŸ¥ä»¥æŸ¥çœ‹å®ƒæ˜¯å¦æœ‰éæ•´æ•°å¹³æ–¹æ ¹ã€‚ å¦‚æœæ˜¯çœŸï¼Œ é‚£å®ƒå°±è¢«åŒ…å«åœ¨åˆ—è¡¨ä¸­ã€‚\n4ã€Raku ä¸­çš„ Print å‡½æ•°å’Œå†’å·\næˆ‘æƒ³çŸ¥é“åœ¨ Raku ä¸­å†’å·ä¸æ–¹æ³•å’Œå‡½æ•°è°ƒç”¨æœ‰ä»€ä¹ˆå…³ç³»ã€‚\næˆ‘åœ¨Â Raku spec test (S32-io)Â ä¸­çœ‹åˆ°äº†è¿™ä¸ª(æˆ‘æ·»åŠ äº†æ³¨é‡Š):\n$fh.print: \u0026#34;0123456789A\u0026#34;; # prints \u0026#39;0123456789A\u0026#39; to the file æ®æˆ‘æ‰€çŸ¥ï¼Œè¿™ç­‰ä»·äºï¼š\n$fh.print(\u0026#34;0123456789A\u0026#34;); # prints \u0026#39;0123456789A\u0026#39; to the file è¿™ä¸¤ç§æ–¹å¼çœ‹èµ·æ¥éƒ½æ¥æ”¶å¤šä¸ªå‚æ•°è€Œä¸”å±•å¹³åˆ—è¡¨ä¹Ÿæ²¡é—®é¢˜ï¼š\n$fh.print: \u0026#34;012\u0026#34;, \u0026#34;345\u0026#34;, \u0026#34;6789A\u0026#34;; # prints \u0026#39;0123456789A\u0026#39; to the file $fh.print(\u0026#34;012\u0026#34;, \u0026#34;345\u0026#34;, \u0026#34;6789A\u0026#34;); # prints \u0026#39;0123456789A\u0026#39; to the file my @a = \u0026lt;012 345 6789A\u0026gt;; $fh.print(@a); # prints \u0026#39;0123456789A\u0026#39; to the file $fh.print: @a; # prints \u0026#39;0123456789A\u0026#39; to the file å­˜åœ¨è¿™ä¸¤ç§è¯­æ³•ä¸€å®šæœ‰æŸç§åŸå› ã€‚ ä½¿ç”¨è¿™ç§æˆ–å¦ä¸€ç§è¯­æ³•æœ‰æŸç§ç†ç”±å—ï¼Ÿ\næˆ‘è¿˜æ³¨æ„åˆ°ï¼Œå½“ä½œä¸ºæ–¹æ³•ä½¿ç”¨æ—¶ï¼Œ æˆ‘ä»¬ä¸å¾—ä¸ä½¿ç”¨å¸¦æœ‰ : æˆ– ()çš„ printï¼š\n$fh.print(@a); # Works $fh.print: @a; # Works! $fh.print @a; # ERROR! å½“ä½¿ç”¨å¸¦å†’å·çš„ print å‡½æ•°æ—¶ï¼Œè¿˜æœ‰ä¸€äº›æœ‰æ„æ€çš„è¡Œä¸ºã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹, ï¼š å’Œ () ä¸ç­‰ä»·ï¼š\nprint @a; # Prints \u0026#39;0123456789A\u0026#39; (no newline, just like Perl 5) print(@a); # Ditto print: @a; # Prints \u0026#39;012 345 6789A\u0026#39; followed by a newline (at least in REPL) print @a, @a; # Error (Two terms in a row) print: @a, @a; # Prints \u0026#39;012 345 6789A 012 345 6789A\u0026#39; followed by a newline (in REPL) ç„¶åæˆ‘å°è¯•åœ¨è„šæœ¬æ–‡ä»¶ä¸­ä½¿ç”¨printã€‚è¿™å¯¹äºæ‰“å°åˆ°æ ‡å‡†è¾“å‡ºæœ‰æ•ˆï¼š\nprint @a; ç„¶è€Œï¼Œ è¿™ä¸ä¼šæ‰“å°åˆ°æ ‡å‡†è¾“å‡ºï¼š\nprint: @a, @a; ä½†æ˜¯æ–¹æ³•ç‰ˆæœ¬çš„å·¥ä½œè‰¯å¥½ï¼š\n$fh.print: @a, @a; # Prints \u0026#39;0123456789A0123456789A\u0026#39; to the file æˆ‘æ„Ÿè§‰æˆ‘å·²ç»ç†è§£äº†è¿™ä¸ªï¼Œ ä½†æ˜¯ä¸èƒ½ç”¨è¯­è¨€è¡¨è¾¾å‡ºæ¥ã€‚æœ‰äººå¯ä»¥è§£é‡Šä¸‹ä½¿ç”¨ print çš„è¿™äº›å˜åŒ–å—ã€‚ è¿˜æœ‰ï¼Œ è¿™äº›è¡Œä¸ºä¼šå› ä¸º Great List Refactor è€Œæ”¹å˜å—ï¼Ÿ\nAnswerï¼š\nä½¿ç”¨å†’å·ä»£æ›¿åœ†æ‹¬å·çš„ä¸€ä¸ªä¸»è¦åŸå› æ˜¯é€šè¿‡ç§»é™¤ä¸€ç»„åœ†æ‹¬å·ï¼Œå®ƒèƒ½ä½¿ä»£ç æ›´æ¸…æ™°ã€‚åœ¨å…¶å®ƒæ–¹é¢å®ƒä»¬çœŸçš„ä¸€æ ·ã€‚\nå½“ä½ ä½¿ç”¨ print: @a ï¼Œ é‚£ä½ çœŸæ­£åœ¨åšçš„å°±æ˜¯åœ¨è¡Œä¸Šæ”¾ç½®ä¸€ä¸ªæ ‡ç­¾ï¼Œ å¹¶è®© @a è½è¿›å»ï¼ˆfall-throughï¼‰ã€‚è¿™åœ¨ REPL ä¸­ä¼šè°ƒç”¨å¸¦æœ‰å€¼çš„ say æ–¹æ³•ã€‚\nå¦‚æœä½ æ²¡æœ‰åœ¨æ–¹æ³•è°ƒç”¨ä¸­ä½¿ç”¨æ‹¬å·æˆ–å†’å·ï¼Œï¼Œ é‚£ä¹ˆæ–¹æ³•ä¼šä»¥æ— å‚æ•°æ–¹å¼è°ƒç”¨ã€‚\nä½ å¯ä»¥äº¤æ¢æ–¹æ³•çš„é¡ºåºï¼Œè¿˜æœ‰è°ƒç”¨è€…ï¼Œå¦‚æœä½ ä½¿ç”¨å†’å·çš„è¯ã€‚\nsay $*ERR: \u0026#39;hello world\u0026#39;; # $*ERR.say(\u0026#39;hello world\u0026#39;)    æˆ‘åˆšåˆšç¡®è®¤äº†ï¼Œ å°±åƒä½ è¯´çš„ï¼ŒÂ print: @a å°±æ˜¯ label: @a, labelÂ å¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿.Â â€“Â Christopher BottomsÂ Jun 26 at 14:12       æ¢å¥è¯è¯´ï¼Œå†’å·èƒ½ä»£æ›¿æ–¹æ³•è°ƒç”¨çš„åœ†æ‹¬å·ï¼Œä½†ä¸èƒ½ä»£æ›¿å­ä¾‹ç¨‹è°ƒç”¨ã€‚Â â€“Â Christopher BottomsÂ Jun 26 at 14:12    5ã€æ’åºæ•£åˆ—é”®å€¼å¯¹å„¿\nmy %hash = two =\u0026gt; 2, three =\u0026gt; 3, one =\u0026gt; 1, ; for %hash.sort(*.key)Â».kv -\u0026gt; ($key, $value) { say \u0026#34;\u0026#39;$key\u0026#39;=\u0026gt; \u0026#39;$value\u0026#39;\u0026#34;; } Â %hash.sort({.key})Â».kvÂ å’Œä¸Šé¢çš„ sort ç­‰ä»·å—?\nä¸ºä»€ä¹ˆè¿™ä¸ª sort æ²¡æœ‰ hyperÂ Â»Â æç¤ºå°±ä¸ä¼šå·¥ä½œ?\nè¿™ä¸ª sortæ–¹æ³•è¿”å›ä¸€ä¸ª Pairs çš„åˆ—è¡¨ã€‚\nå› ä¸ºåœ¨åˆ—è¡¨èº«ä¸Šè°ƒç”¨ .kv ä¼šè¿”å›ä¸€ä¸ªç´¢å¼•, Pair åˆ—è¡¨, è¿™ä¸æ˜¯ä½ æƒ³è¦çš„; ä½ ä¸èƒ½å•å•åœ¨åˆ—è¡¨èº«ä¸Šè°ƒç”¨ .kv ã€‚æ‰€ä»¥ä½ å¿…é¡»é€šè¿‡åœ¨æ¯ä¸ª Pair èº«ä¸Šè°ƒç”¨ .kv æ–¹æ³•åˆ†åˆ«ä»åˆ—è¡¨ä¸­çš„ Pair ä¸­å–å‡ºé”®å’Œå€¼, è¿™æ­£æ˜¯ Â».kv æ‰€åšçš„ã€‚\nä½ è¿˜å¯ä»¥ä½¿ç”¨ .map(*.kv) ä»£æ›¿ã€‚\nÂ».kv è¯­æ³•å…è®¸æŠŠå·¥ä½œå±•å¼€åˆ°å¤šä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œ, å¦‚æœé‚£æ ·åšæœ‰æ„ä¹‰çš„è¯ã€‚\n(å½“å‰çš„ Rakudoä»…ä»¥åŠéšæœºçš„é¡ºåºå·¥ï¼Œ ä»¥é˜²æ­¢äººä»¬é”™è¯¯åœ°ä½¿ç”¨è¯¥ç‰¹æ€§ )\né€šè¿‡åœ¨ç­¾åä¸­ä½¿ç”¨å‰¯è¯ä»¥æå–å±æ€§ï¼Œ è¿™æ˜¯å¦ä¸€ç§ loop å†™æ³•ï¼š\nfor %hash.sort -\u0026gt; (:$key, :$value) { say \u0026#34;\u0026#39;$key\u0026#39;=\u0026gt; \u0026#39;$value\u0026#39;\u0026#34;; } for %hash.sort -\u0026gt; $pair (:$key, :$value) { say $pair; say $key === $pair.key and $value === $pair.value; # Trueâ¤ } # :$key is short for :key($key) for %hash.sort -\u0026gt; (:key($k), :value($v)) { say \u0026#34;\u0026#39;$k\u0026#39;=\u0026gt; \u0026#39;$v\u0026#39;\u0026#34;; } è¿™å¯¹å…¶å®ƒæ²¡æœ‰æ–¹æ³•åˆ›å»ºä¸€ç»„å®ƒä»¬å…¬ç”¨å±æ€§çš„å¯¹è±¡æœ‰ç”¨ï¼š\nclass C { has $.a; has $.b; has $.c; has $!private-value } my $c = 5; my $obj = C.new(:a\u0026lt;A\u0026gt;,:b(1),:$c); given $obj -\u0026gt; ( :$a, :b($b), :$c) ) { say \u0026#34;$a$b$c\u0026#34;; # A 1 5 } # ignore $.a by using an unnamed scalar given $obj -\u0026gt; ( :a($), :$b, :$c ) { ... } # places any unspecified public attributes in %others given $obj -\u0026gt; ( :$a, :$b, *%others ) { .say for keys %others; # câ¤ } # å¿½ç•¥ä»»ä½•æœªæŒ‡å®šçš„å±æ€§ # useful to allow subclasses to add more attributes # æˆ–ä»…ä»…ä¸¢å¼ƒæ‰ä»»ä½•ä½ ä¸å…³å¿ƒçš„å€¼ given $obj -\u0026gt; ( :$a, :$b, *% ) { ... } # å¤±è´¥ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å¤„ç†å…¬ç”¨çš„ c å±æ€§ # in the sub-signature given $obj -\u0026gt; ( :$a, :$b ) { ... } å…³äºç­¾åèƒ½åšä»€ä¹ˆï¼Œé‚£åªæ˜¯å¼€å§‹ã€‚\næ‰€æœ‰ä¸‹é¢çš„ï¼Œåœ¨å­ä¾‹ç¨‹å’Œæ–¹æ³•ç­¾åä¸­éƒ½æ˜¯è¢«å…è®¸çš„ï¼Œéå¼ºåˆ¶æ€§çš„ï¼Œ å¯¹äºè¿™ä¸ªä¾‹å­æ€ä¼¤åŠ›è¿‡å¤§ã€‚è¿™åœ¨ multi subs å’Œ multi methods ä¸­å¯¹äºé™åˆ¶å¯èƒ½çš„å€™é€‰è€…çœŸçš„å¾ˆæœ‰ç”¨ã€‚\nfor \u0026#39;one\u0026#39; =\u0026gt; 1, 1/3 -\u0026gt; # Type is an alias to the object type ::Type Any $_ # Any is the default type requirement # the public attributes of the object ( ::A-Type Any :key( :numerator( $a ) ), ::B-Type Any :value( :denominator( $b ) ) where $b \u0026gt;= 1, ) { my Type $obj = $_; # new variable declared as having the same type my A-Type $new-a = $a; my B-Type $new-b = $b; # could have used $_.^name or .^name instead of Type.^name # so you don\u0026#39;t actually have to add the alias to the signature # to get the name of the arguments type say Type.^name, \u0026#39;\u0026#39;, $_; say \u0026#39;\u0026#39;, A-Type.^name, \u0026#39;\u0026#39;, $a; say \u0026#39;\u0026#39;, B-Type.^name, \u0026#39;\u0026#39;, $b; } Pair one =\u0026gt; 1 Str one Int 1 Rat 0.333333 Int 1 Int 3 è‡³äºä½¿ç”¨Â .sort({.key}), æ©, é‚£ä»æ ¹æœ¬ä¸Šæ¥è¯´æ˜¯åŒä¸€ä¸ªä¸œè¥¿, å› ä¸º sortÂ åœ¨é‚£å„¿æ¥å—ä»»ä½• CallableÂ æˆ‘è¦æŒ‡å‡º, ä½ ç”šè‡³ä¸éœ€è¦ä¸º sortÂ æä¾›å‚æ•°, å› ä¸ºå®ƒé»˜è®¤æ¯”ä½ ç»™å®ƒçš„ä¸œè¥¿æ™ºèƒ½ã€‚\nRaku æœ‰å¾ˆå¤šåˆ›å»ºå’Œè®¿é—® CallableÂ ä¸œè¥¿çš„æ–¹å¼ã€‚æ‰€ä»¥ä»»ä½•ä¸‹é¢ä¸€ç§éƒ½å¯ä»¥å·¥ä½œï¼š\n*.key { .key } # { $_.key } -\u0026gt; $_ { .key } # basically what the previous line turns into { $^placeholder-var.key } sub ($_) { .key } \u0026amp;a-subroutine-reference # you would have to create the subroutine though è¿˜æœ‰ï¼Œ å› ä¸ºæ‰€æœ‰æ™®é€šçš„æ“ä½œç¬¦å®é™…ä¸Šéƒ½æ˜¯å­ä¾‹ç¨‹ï¼Œä½ å¯ä»¥åœ¨éœ€è¦ Callable çš„å…¶å®ƒåœ°æ–¹ä½¿ç”¨å®ƒä»¬ï¼š\n\u0026amp;infix:\u0026lt;+\u0026gt; # the subroutines responsible for the numeric addition operator \u0026amp;[+] # ditto \u0026amp;prefix:\u0026lt;++\u0026gt; \u0026amp;postfix:\u0026lt;++\u0026gt; # etc  å’Œ ( ) çš„åŒºåˆ«  # æ— æ³•æ­£å¸¸æ’åº my @s = [2443,5,33, 90, -9, 2, 764]; say @s.sort; # 2443 5 33 90 -9 2 764 say @s.WHAT; # (Array) say @s.raku; # [[2443, 5, 33, 90, -9, 2, 764]]\u0026lt;\u0026gt; # æ­£å¸¸æ’åº my $array = [2443,5,33, 90, -9, 2, 764]; say $array.sort; # -9 2 5 33 90 764 2443 say $array.WHAT; # (Array) say $array.raku; # [2443, 5, 33, 90, -9, 2, 764] my @s = (2443,5,33,90,-9,2,764); say @s.sort; # -9 2 5 33 90 764 2443 say $array.WHAT; # (Array) say @s.raku; # [2443, 5, 33, 90, -9, 2, 764]\u0026lt;\u0026gt; å¯è§, ä½¿ç”¨ [ ] å’Œ ( ) åˆ›å»ºæ•°ç»„æ˜¯ä¸ä¸€æ ·çš„.\nmy @s = [2443, 5, 33, 90, -9, 2, 764]; è¿™åˆ›å»ºäº†ä¸€ä¸ªæ•°ç»„, å¹¶æŠŠè¯¥æ•°ç»„èµ‹å€¼ç»™ @s[0], æ‰€ä»¥ @s åªæœ‰ä¸€ä¸ªå…ƒç´ , æ‰€ä»¥å¯¹ @s è¿›è¡Œæ’åºæ˜¯æ²¡æœ‰æ„ä¹‰çš„. ç„¶è€Œä½ å¯ä»¥ä½¿ç”¨:\n@s[0].sort.say æ¥å®ç°ä½ è¦æ±‚çš„æ’åºã€‚\n How do I chain to an inline block in Raku?  æˆ‘æƒ³ä¿®æ”¹ä¸€ä¸ªæ•°ç»„(æˆ‘åœ¨è¿™ä¸ªä¾‹å­ä¸­ä½¿ç”¨äº† splice, ä½†æ˜¯å®ƒä¹Ÿå¯èƒ½æ˜¯ä¿®æ”¹æ•°ç»„çš„ä»»ä½•æ“ä½œ)å¹¶è¿”å›ä¿®æ”¹åçš„æ•°ç»„ - å’Œ slice ä¸ä¸€æ ·, slice è¿”å›çš„æ˜¯ä»æ•°ç»„ä¸­æŠ å‡ºçš„é¡¹ã€‚æˆ‘å¯ä»¥å¾ˆå®¹æ˜“åœ°é€šè¿‡åœ¨æ•°ç»„ä¸­å­˜å‚¨ä¸€ä¸ª block æ¥åšåˆ°, å°±åƒä¸‹é¢è¿™æ ·:\nmy $1 = -\u0026gt; $a { splice($a,1,3,[1,2,3]); $a }; say (^6).map( { $_ \u0026lt; 4 ?? 0 !! $_ } ).Array; # [0 0 0 0 4 5] say (^6).map( { $_ \u0026lt; 4 ?? 0 !! $_ } ).Array.$1; # [0 1 2 3 4 5] æˆ‘æ€ä¹ˆæŠŠç”± $1 ä»£è¡¨çš„ block å†…è”åˆ°å•ä¸ªè¡¨è¾¾å¼ä¸­å‘¢ï¼Ÿ ä¸‹é¢çš„è§£å†³æ–¹æ³•ä¸æ­£ç¡®:\nsay (^6).map( { $_ \u0026lt; 4 ?? 0 !! $_ } ).Array.(-\u0026gt; $a { splice($a,1,3,[1,2,3]); $a }) Invocant requires a type object of type Array, but an object instance was passed. Did you forget a \u0026#39;multi\u0026#39;? è§£å†³æ–¹æ³•æ˜¯æ·»åŠ ä¸€ä¸ª \u0026amp; ç¬¦å·:\nsay (^6).map( { $_ \u0026lt; 4 ?? 0 !! $_ } ).Array.\u0026amp;(-\u0026gt; $a { splice($a,1,3,[1,2,3]); $a }) # è¾“å‡º [0 1 2 3 4 5]  Getting a positional slice using a Range variable as a subscript  my @numbers = \u0026lt;4 8 16 16 23 42\u0026gt;; .say for @numbers[0..2]; # this works # 4 # 8 # 15 # but this doesn\u0026#39;t my $range = 0..2; .say for @numbers[$range]; # 16 æœ€åçš„é‚£ä¸ªä¸‹æ ‡çœ‹èµ·æ¥å¥½åƒæŠŠ $range è§£é‡Šä¸º range ä¸­å…ƒç´ çš„ä¸ªæ•°(3)ã€‚æ€ä¹ˆå›äº‹?\nè§£å†³æ–¹æ³•\nä½¿ç”¨ @numbers[|$range] æŠŠ range å¯¹è±¡å±•å¹³åˆ°åˆ—è¡¨ä¸­ã€‚æˆ–è€…åœ¨ Range å¯¹è±¡ä¸Šä½¿ç”¨ç»‘å®šæ¥ä¼ é€’å®ƒä»¬ã€‚\n# On Fri Jul 2016, gfldex wrote: my @numbers = \u0026lt;4 8 15 16 23 42\u0026gt;; my $range = 0..2; .say for @numbers[$range]; # OUTPUTÂ«16Â» # expected: # OUTPUTÂ«4\\n 8\\n 15Â» # è¿™æ˜¯å¯¹çš„, å¹¶ä¸”è¿˜è·Ÿ \u0026#34;Scalar container implies item\u0026#34; è§„åˆ™æœ‰å…³. # Changing it would break things like the second evaluation here: my @x = 1..10; my @y := 1..3; @x[@y] # (2 3 4) @x[item @y] # 4 # æ³¨æ„åœ¨ç­¾åä¸­ range å¯ä»¥è¢«ç»‘å®šç»™ @y, è€Œç‰¹æ®Šçš„ Range å¯ä»¥ç”Ÿæˆä¸€ä¸ªåƒ @x[$(@arr-param)] çš„è¡¨è¾¾å¼ # è¿™åœ¨å®ƒçš„è¯­ä¹‰ä¸­æ˜¯ä¸å¯é¢„æœŸçš„ã€‚ # åŒæ ·, ç»‘å®šç»™ $range ä¹Ÿèƒ½æä¾›é¢„æœŸçš„ç»“æœ my @numbers = \u0026lt;4 8 15 16 23 42\u0026gt;; my $range := 0..2; .say for @numbers[$range]; # OUTPUTÂ«4â¤8â¤15â¤Â» # è¿™ä¹Ÿæ˜¯é¢„æœŸçš„ç»“æœ, å› ä¸ºä½¿ç”¨ç»‘å®šå°±æ²¡æœ‰æ ‡é‡å®¹å™¨æ¥å¼ºåˆ¶è¢«å½“æˆä¸€ä¸ª item äº†ã€‚ # So, all here is working as designed. æˆ–è€…ï¼š\n.say for @numbers[@($range)] # 4 # 8 # 15 ç»‘å®šåˆ°æ ‡é‡å®¹å™¨çš„ç¬¦å·è¾“å‡ºä¸€ä¸ªä¸œè¥¿, å¯ä»¥è¾¾åˆ°ä½ æƒ³è¦çš„é€‰æ‹©åŒ…å«ï¼š\nå‰ç½®ä¸€ä¸ª @ ç¬¦å·æ¥å¾—åˆ°å•ä¸ªä¸œè¥¿çš„å¤æ•°å½¢å¼ï¼šnumbers[@$range]; æˆ–è€…ä»¥ä¸åŒçš„å½¢å¼æ¥å£°æ˜ ragne å˜é‡, ä»¥ä½¿å®ƒç›´æ¥å·¥ä½œã€‚ å¯¹äºåè€…, è€ƒè™‘ä¸‹é¢çš„å½¢å¼:\n# Bind the symbol `numbers` to the value 1..10: my \\numbers = [0,1,2,3,4,5,6,7,8,9,10]; # Bind the symbol `rangeA` to the value 1..10: my \\rangeA := 1..10; # Bind the symbol `rangeB` to the value 1..10: my \\rangeB = 1..10; # Bind the symbol `$rangeC` to the value 1..10: my $rangeC := 1..10; # Bind the symbol `$rangeD` to a Scalar container # and then store the value 1..10 in it:` my $rangeD = 1..10; # Bind the symbol `@rangeE` to the value 1..10: my @rangeE := 1..10; # Bind the symbol `@rangeF` to an Array container and then # store 1 thru 10 in the Scalar containers 1 thru 10 inside the Array my @rangeF = 1..10; say numbers[rangeA]; # (1 2 3 4 5 6 7 8 9 10) say numbers[rangeB]; # (1 2 3 4 5 6 7 8 9 10) say numbers[$rangeC]; # (1 2 3 4 5 6 7 8 9 10) say numbers[$rangeD]; # 10 say numbers[@rangeE]; # (1 2 3 4 5 6 7 8 9 10) say numbers[@rangeF]; # (1 2 3 4 5 6 7 8 9 10) ç»‘å®šåˆ°æ ‡é‡å®¹å™¨($rangeD)ä¸Šçš„ç¬¦å·æ€»æ˜¯äº§ç”Ÿå•ä¸ªå€¼ã€‚åœ¨ [...] ä¸‹æ ‡ä¸­å•ä¸ªå€¼å¿…é¡»æ˜¯æ•°å­—ã€‚ å¯¹äº range, è¢«å½“ä½œå•ä¸ªæ•°å­—æ—¶, äº§ç”Ÿçš„æ˜¯ range çš„é•¿åº¦ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2015-08-22-raku-weekly-notes/","tags":["notes"],"title":"Raku Weekly Notes"},{"categories":["rakulang"],"contents":"æ¨¡å¼åŒ¹é… åŒ¹é…å•ä¸ªå­—ç¬¦ä¸²:\nmy $name = \u0026#34;twostraws\u0026#34;; given $name { when \u0026#34;bilbo\u0026#34; { say \u0026#34;Hello, Bilbo Baggins!\u0026#34;} when \u0026#34;twostraws\u0026#34; { say \u0026#34;Hello, Paul Hudson!\u0026#34; } default { say \u0026#34;èº«ä»½éªŒè¯å¤±è´¥\u0026#34; } } åŒ¹é…å…ƒç»„:\nmy $bool1 = 1; my $bool2 = 0; given ($bool1, $bool2) { when (0, 0) {say \u0026#34;0, 0\u0026#34;} when (0, 1) {say \u0026#34;0, 1\u0026#34;} when (1, 0) {say \u0026#34;1, 0\u0026#34;} when (1, 1) {say \u0026#34;1, 1\u0026#34;} } given (\u0026#34;15\u0026#34;, \u0026#34;example\u0026#34;, \u0026#34;3.14\u0026#34;) { say $_.WHAT; when ($, $, Str) { say \u0026#34;I got a String of $_[2]\u0026#34; } } given (4, 5) { when ( $, $) {say \u0026#34;Ok\u0026#34;} } given (\u0026#34;fly.mp3\u0026#34;, 34, \u0026#34;It\u0026#39;s funny\u0026#34;) { when (/.mp3$/, /4$/, *.chars \u0026gt; 4) { say \u0026#34;Perfact\u0026#34; } } given 5 { when 1..10 { say \u0026#34;1..10 contains 5\u0026#34; } } åŒæ—¶æ£€æŸ¥åå­—å’Œå¯†ç  my $name = \u0026#34;twostraws\u0026#34;; my $password = \u0026#34;fr0st1es\u0026#34;; given ($name, $password) { when (\u0026#34;bilbo\u0026#34;, \u0026#34;bagg1n5\u0026#34;) { say \u0026#34;Hello, Bilbo Baggins!\u0026#34; } when (\u0026#34;twostraws\u0026#34;, \u0026#34;fr0st1es\u0026#34;) { say \u0026#34;Hello, Paul Hudson!\u0026#34; } default { say \u0026#34;ä½ æ˜¯è°?\u0026#34; } } ä½¿ç”¨å•ä¸ªå…ƒç»„ my $authentication = (\u0026#34;twostraws\u0026#34;, \u0026#34;fr0st1es\u0026#34;); given $authentication { when (\u0026#34;bilbo\u0026#34;, \u0026#34;bagg1n5\u0026#34;) { say \u0026#34;Hello, Bilbo Baggins!\u0026#34; } when (\u0026#34;twostraws\u0026#34;, \u0026#34;fr0st1es\u0026#34;) { say \u0026#34;Hello, Paul Hudson!\u0026#34; } default { say \u0026#34;ä½ æ˜¯è°?\u0026#34; } } éƒ¨åˆ†åŒ¹é… # ä½ åªå…³å¿ƒæŸäº›æ„Ÿå…´è¶£çš„å€¼ï¼Œä¸å…³å¿ƒå…¶å®ƒå€¼ï¼Œä½¿ç”¨ `*` å·æˆ– `$` æ¥ä»£è¡¨ \u0026#34;any value is fine\u0026#34; my $authentication = (\u0026#34;twostraws\u0026#34;, \u0026#34;fr0st1es\u0026#34;, \u0026#34;127.0.0.1\u0026#34;); given $authentication { when (\u0026#34;bilbo\u0026#34;, \u0026#34;bagg1n5\u0026#34;, *) { say \u0026#34;Hello, Bilbo Baggins!\u0026#34;} when (\u0026#34;twostraws\u0026#34;, \u0026#34;fr0st1es\u0026#34;, $) { say \u0026#34;Hello, Paul Hudson!\u0026#34; } default { say \u0026#34;Who are you?\u0026#34; } } åªåŒ¹é…å…ƒç»„çš„ä¸€éƒ¨åˆ† # ä½†ä»ç„¶æƒ³çŸ¥é“å…¶å®ƒéƒ¨åˆ†æ˜¯ä»€ä¹ˆ my $authentication = (\u0026#34;twostraws\u0026#34;, \u0026#34;fr0st1es\u0026#34;); given $authentication { when (\u0026#34;bilbo\u0026#34;, *) { say \u0026#34;Hello, Bilbo Baggins!\u0026#34; } when (\u0026#34;twostraws\u0026#34;, *) { say \u0026#34;Hello, Paul Hudson: your password was $_!\u0026#34; } default { say \u0026#34;Who are you?\u0026#34; } } åŒ¹é…è®¡ç®—å‹å…ƒç»„ sub fizzbuzz(Int $number) returns Str { given ($number % 3 == 0, $number % 5 == 0) { when (True, False) { return \u0026#34;Fizz\u0026#34; } when (False, True) { return \u0026#34;Buzz\u0026#34; } when (True, True) { return \u0026#34;FizzBuzz\u0026#34; } when (False, False) { return $number.Str} } } say fizzbuzz(15); éå†å…ƒç»„ my $twostraws = (\u0026#34;twostraws\u0026#34;, \u0026#34;fr0st1es\u0026#34;); my $bilbo = (\u0026#34;bilbo\u0026#34;, \u0026#34;bagg1n5\u0026#34;); my $taylor = (\u0026#34;taylor\u0026#34;, \u0026#34;fr0st1es\u0026#34;); my @users = $twostraws, $bilbo, $taylor; for @users -\u0026gt; $user { say $user[0]; } ä½¿ç”¨ when åŒ¹é…å…ƒç»„ä¸­çš„æŒ‡å®šå€¼ my $twostraws = (\u0026#34;twostraws\u0026#34;, \u0026#34;fr0st1es\u0026#34;); my $bilbo = (\u0026#34;bilbo\u0026#34;, \u0026#34;bagg1n5\u0026#34;); my $taylor = (\u0026#34;taylor\u0026#34;, \u0026#34;fr0st1es\u0026#34;); my @users = $twostraws, $bilbo, $taylor; say \u0026#34;User twostraws has the password fr0st1es\u0026#34; when (\u0026#34;twostraws\u0026#34;, \u0026#34;fr0st1es\u0026#34;) for @users; # æ‰“å°ç§˜å¯†ä¸ºæŒ‡å®šå€¼çš„ç”¨æˆ· say \u0026#34;User $_[0]has password \\\u0026#34;fr0st1es\\\u0026#34;\u0026#34; when (*, \u0026#34;fr0st1es\u0026#34;) for @users; åŒ¹é…èŒƒå›´ my $age = 36; given $age { when 0 ..^ 18 { say \u0026#34;ä½ æœ‰æ´»åŠ›æœ‰æ—¶é—´ï¼Œä½†æ˜¯æ²¡é’±\u0026#34; } when 18 ..^ 70 { say \u0026#34;ä½ æœ‰æ´»åŠ›æœ‰é’±ï¼Œä½†æ˜¯æ²¡æ—¶é—´\u0026#34; } default { say \u0026#34;ä½ æœ‰æ—¶é—´å’Œé‡‘é’±ï¼Œä½†æ˜¯æ²¡æ´»åŠ›\u0026#34;} } when å¯ä»¥é…åˆæ™ºèƒ½åŒ¹é…æ“ä½œç¬¦ ~~ å•ç‹¬ä½¿ç”¨ my $age = 36; when $age ~~ 0 ..^ 18 { say \u0026#34;ä½ æœ‰æ´»åŠ›æœ‰æ—¶é—´ï¼Œä½†æ˜¯æ²¡é’±\u0026#34; } when $age ~~ 18 ..^ 70 { say \u0026#34;ä½ æœ‰æ´»åŠ›æœ‰é’±ï¼Œä½†æ˜¯æ²¡æ—¶é—´\u0026#34; } default { say \u0026#34;ä½ æœ‰æ—¶é—´å’Œé‡‘é’±ï¼Œä½†æ˜¯æ²¡æ´»åŠ›\u0026#34;} ä½¿ç”¨ contains æ–¹æ³• my $age = 36; when (0 ..^ 18).contains($age) { say \u0026#34;ä½ æœ‰æ´»åŠ›æœ‰æ—¶é—´ï¼Œä½†æ˜¯æ²¡é’±\u0026#34; } when (18 ..^ 70).contains($age) { say \u0026#34;ä½ æœ‰æ´»åŠ›æœ‰é’±ï¼Œä½†æ˜¯æ²¡æ—¶é—´\u0026#34; } default { say \u0026#34;ä½ æœ‰æ—¶é—´å’Œé‡‘é’±ï¼Œä½†æ˜¯æ²¡æ´»åŠ›\u0026#34;} åŒ¹é…å…ƒç»„ä¸­çš„èŒƒå›´ my $user = (\u0026#34;twostraws\u0026#34;, \u0026#34;fr0st1es\u0026#34;, 36); given $user { my $name = $user[0]; when ($name, *, 0 ..^ 18) { say \u0026#34;$nameæœ‰æ´»åŠ›æœ‰æ—¶é—´ï¼Œä½†æ˜¯æ²¡é’±\u0026#34; } when ($name, *, 18 ..^ 70) { say \u0026#34;$nameæœ‰æ´»åŠ›æœ‰é’±ï¼Œä½†æ˜¯æ²¡æ—¶é—´\u0026#34; } when ($name, *, *) { say \u0026#34;$nameæœ‰æ—¶é—´å’Œé‡‘é’±,ä½†æ˜¯æ²¡æ´»åŠ›\u0026#34; } } æšä¸¾ enum WeatherType \u0026lt;Cloudy Sunny Windy\u0026gt;; my $today = WeatherType::Cloudy; given $today { when WeatherType::Cloudy { say \u0026#34;å¤šäº‘\u0026#34; } when WeatherType::Sunny { say \u0026#34;æ™´å¤©\u0026#34; } when WeatherType::Windy { say \u0026#34;æœ‰é£\u0026#34; } } # ä½¿ç”¨ if è¯­å¥ if $today ~~ WeatherType::Cloudy { say \u0026#34;å¤šäº‘\u0026#34; } å…³è”å€¼ enum WeatherType ( Cloudy =\u0026gt; 100, Sunny =\u0026gt; 50, Windy =\u0026gt; 30 ); my $today = WeatherType::Windy; given $today { when WeatherType::Cloudy { say 20*Cloudy } when WeatherType::Sunny { say 10*Sunny } when WeatherType::Windy { say 12*Windy } } when ä»å¥ my @numbers = 1..10; .say when $_ % 2 == 1 for @numbers; my @celebrities = \u0026#34;Michael Jackson\u0026#34;, \u0026#34;Taylor Swift\u0026#34;, \u0026#34;MichaelCaine\u0026#34;, \u0026#34;Adele Adkins\u0026#34;, \u0026#34;Michael Jordan\u0026#34;; .say when /^Michael/ for @celebrities; # ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ .say when $_.chars \u0026gt; 12 for @celebrities; # è°ƒç”¨æ–¹æ³• .say when /^Michael/ and $_.chars \u0026gt;12 for @celebrities; # å¤åˆæ¡ä»¶ proceed given-when æœ‰ä¸¤ä¸ªå°çš„æ”¹å˜, å¹¶ä¸”è¿™ä¿©æ”¹å˜éƒ½æ˜¯å¼€å¯æ–°è¡Œä¸ºçš„, è€Œä¸æ˜¯é™åˆ¶å·²å­˜åœ¨çš„è¡Œä¸ºã€‚\nç¬¬ä¸€ä¸ªå°çš„æ”¹å˜: when çš„å¼€å…³è¡Œä¸ºä¸ä»…ä»…æ˜¯ç”¨äº given å—å„¿ä¸­çš„, è€Œæ˜¯å¯ä»¥ç”¨åœ¨ä»»ä½•\u0026quot;ä¸»é¢˜åŒ–\u0026quot;çš„å—å„¿ä¸­çš„, ä¾‹å¦‚ for å¾ªç¯ä¸­æˆ–æ¥æ”¶ $_ ä½œä¸ºå‚æ•°çš„å­ä¾‹ç¨‹ä¸­ã€‚\ngiven $answer { when \u0026#34;Atlantis\u0026#34; { say \u0026#34;é‚£æ˜¯å¯¹çš„\u0026#34; } default { say \u0026#34;BZZZZZZZZZZZZZ!\u0026#34; } } for 1..100 { when * %% 15 { say \u0026#34;Fizzbuzz\u0026#34; } when * %% 3 { say \u0026#34;Fizz\u0026#34; } when * %% 5 { say \u0026#34;Buzz\u0026#34; } default { say $_ } } sub expand($_) { when \u0026#34;R\u0026#34; { say \u0026#34;çº¢è­¦\u0026#34; } when \u0026#34;G\u0026#34; { say \u0026#34;ç»¿è­¦\u0026#34; } when \u0026#34;B\u0026#34; { say \u0026#34;è“è­¦\u0026#34; } default { say $_ } } ä½†æ˜¯ç”šè‡³ä¸æ¥å— $_ ä½œä¸ºå‚æ•°çš„å­ä¾‹ç¨‹ä¹Ÿå¾—åˆ°äº†å®ƒä»¬è‡ªå·±çš„è¯æ³•å˜é‡ $_ ä¾›ä¿®æ”¹ã€‚æ‰€ä»¥è§„åˆ™å°±æ˜¯\u0026quot;ç°åœ¨, åœ¨ $_ ä¸­æœ‰æŸäº›æˆ‘èƒ½å¯åŠ¨çš„å¥½ä¸œè¥¿å—\u0026quot;ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦, æˆ‘ä»¬ç”šè‡³èƒ½è‡ªå·±è®¾ç½® $_ã€‚\nsub seek-the-answer() { $_ = (^100).pick; when 42 { say \u0026#34;The answer\u0026#34; } default { say \u0026#34;A number\u0026#34; } } æ¢å¥è¯è¯´, æˆ‘ä»¬å·²ç»çŸ¥é“äº† when å’Œ given æ˜¯å•ç‹¬çš„ã€‚Switch è¯­å¥é€»è¾‘éƒ½åœ¨ when è¯­å¥ä¸­ã€‚\nç¬¬äºŒä¸ªå°æ”¹å˜: ä½ å¯ä»¥åµŒå¥— when è¯­å¥!\næˆ‘å¾ˆç¡®ä¿¡ä½ æ²¡æœ‰åœ¨é‡å¤–è§è¿‡è¿™ç§ç”¨æ³•ã€‚ä½†å®ƒæœ‰æ—¶å€™ç‰¹åˆ«æœ‰ç”¨:\nwhen * \u0026gt; 2 { when 4 { say \u0026#39;Four!\u0026#39; } default { say \u0026#39;huge\u0026#39; } } default { say \u0026#39;little\u0026#39; } ä½ å¯èƒ½è®°å¾—, åœ¨ when å—å„¿ä¸­æœ‰ä¸€ä¸ªéšå¼çš„ succeed è¯­å¥åœ¨æœ«å°¾, è¿™è®©å‘¨å›´çš„ä¸»é¢˜åŒ–å—é€€å‡ºã€‚(æ„æ€æ˜¯ä½ ä¸å¿…è®°ç€æ‰‹åŠ¨é€€å‡º switch è¯­å¥)ã€‚å¦‚æœä½ æƒ³é‡å†™ succeed è¯­å¥å¹¶ç»§ç»­é€šè¿‡ when block, é‚£ä¹ˆä½ åœ¨ when block çš„æœ«å°¾å†™ä¸Šä¸€ä¸ªæ˜¾å¼çš„ proceed å³å¯ã€‚\ngiven $verse-number { when * \u0026gt;= 12 { say \u0026#34;Twelve drummers drumming\u0026#34;; proceed } when * \u0026gt;= 11 { say \u0026#34;Eleven pipers piping\u0026#34;; proceed } # ... when * \u0026gt;= 5 { say \u0026#34;FIIIIIIVE GOLDEN RINGS!\u0026#34;; proceed } when * \u0026gt;= 4 { say \u0026#34;Four calling birds\u0026#34;; proceed } when * \u0026gt;= 3 { say \u0026#34;Three French hens\u0026#34;; proceed } when * \u0026gt;= 2 { say \u0026#34;Two turtle doves\u0026#34;; say \u0026#34;and a partridge in a pear tree\u0026#34;; } say \u0026#34;a partridge in a pear tree\u0026#34;; } ","permalink":"https://ohmyweekly.github.io/notes/2016-02-06-given-when-pattern-match-in-raku/","tags":["given","when"],"title":"Raku ä¸­çš„ given/when æ¨¡å¼åŒ¹é…"},{"categories":["rakulang"],"contents":"æ–‡ä»¶å­˜åœ¨ã€æ–‡ä»¶çš„æ—¶é—´æˆ³ã€æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ç­‰ç­‰\næ‰¹é‡æ’å…¥æ–‡æœ¬ my @filenames = dir \u0026#39;.\u0026#39;, test =\u0026gt; any(/\\.md$/, /\\.markdown/); for @filenames -\u0026gt; $filePath { my $path = $filePath.path(); $path ~~ s/.md//; $path ~~ s/.markdown//; my $date = DateTime.new(now); my $head = qq:heredoc \u0026#39;EOT\u0026#39;;title: $path.IO.basename()date: $datetags: Raku categories: Raku --- \u0026lt;blockquote class=\u0026#34;blockquote-center\u0026#34;\u0026gt;è¿™åŸå¸‚æœ‰å¤ªå¤šé£æ™¯éƒ½åœ¨æé†’é‚£è¿‡å»ï¼\u0026lt;/blockquote\u0026gt; [TOC] EOT my @content = slurp $filePath; spurt($filePath.path, \u0026#34;$head\\n@content[]\u0026#34;); } åœ¨å½“å‰ç›®å½•ä¸­æŸ¥æ‰¾æ‰€æœ‰ä»¥ .md (.markdown)ç»“å°¾çš„æ–‡ä»¶ï¼ˆå³markdownæ–‡ä»¶ï¼‰, å¹¶åœ¨æ–‡ä»¶æœ€å‰é¢æ’å…¥ä¸€æ®µæ–‡æœ¬ï¼Œ å½¢å¦‚ï¼š\ntitle: Raku date: 2015-08-20T23:19:13Z tags: Raku categories: Raku --- \u0026lt;blockquote class=\u0026#34;blockquote-center\u0026#34;\u0026gt;æˆ‘ç«™åœ¨å¤©æ¡¥ä¸Šå¿µä½ , æœ‰ç‚¹ç‹¼ç‹ˆ\u0026lt;/blockquote\u0026gt; ç±» IO::Path æä¾›äº† basename, path, parts, ç­‰æ–¹æ³•ä¾›ä½¿ç”¨, å…·ä½“ç”¨æ³•è¯·çœ‹æ–‡æ¡£:\nrakudoc IO::Path ä¸€äº›ä¾‹å­ï¼š\nsay IO::Path.new(\u0026#34;/etc/passwd\u0026#34;).basename; # passwd say IO::Path.new(\u0026#34;docs/README.pod\u0026#34;).extension; # pod say IO::Path.new(\u0026#34;/etc/passwd\u0026#34;).dirname; # /etc say IO::Path::Win32.new(\u0026#34;C:\\\\Windows\\\\registry.ini\u0026#34;).volume; # C: say IO::Path.new(\u0026#34;/etc/passwd\u0026#34;).parts.perl # (\u0026#34;dirname\u0026#34; =\u0026gt; \u0026#34;/etc\u0026#34;, \u0026#34;volume\u0026#34; =\u0026gt; \u0026#34;\u0026#34;, \u0026#34;basename\u0026#34; =\u0026gt; \u0026#34;passwd\u0026#34;).hash ä¾‹å­:\n# To iterate over the contents of the current directory: for dir() -\u0026gt; $file { say $file; } # As before, but include even \u0026#39;.\u0026#39; and \u0026#39;..\u0026#39; which are filtered out by # the default :test matcher: for dir(test =\u0026gt; *) -\u0026gt; $file { say $file; } # To get the names of all .jpg and .jpeg files in ~/Downloads: my @jpegs = \u0026#34;%*ENV\u0026lt;HOME\u0026gt;/Downloads\u0026#34;.IO.dir(test =\u0026gt; /:i\u0026#39;.\u0026#39;jpe?g $/)Â».Str; # An example program that lists all files and directories recursively: sub MAIN($dir = \u0026#39;.\u0026#39;) { my @todo = $dir.IO; while @todo { for @todo.pop.dir -\u0026gt; $path { say $path.Str; @todo.push: $path if $path.d; } } } æ–‡ä»¶æµ‹è¯•æ“ä½œç¬¦ # If you have a string - a path to something in the filesystem: if \u0026#34;path/to/file\u0026#34;.IO ~~ :e { say \u0026#39;file exists\u0026#39;; } my $file = \u0026#34;path/to/file\u0026#34;; if $file.IO ~~ :e { say \u0026#39;file exists\u0026#39;; } # Instead of the colonpair syntax, you can use method calls too: if \u0026#39;path/to/file\u0026#39;.IO.e { say \u0026#39;file exists\u0026#39;; } # If you already have an IO object in $file, either by creating one yourself, or # by getting it from another subroutine, such as dir, you can write this: my $file = \u0026#34;path/to/file\u0026#34;.IO; if $file ~~ :e { say \u0026#39;file exists\u0026#39;; } æ–‡ä»¶æ—¶é—´æˆ³ say \u0026#34;path/to/file\u0026#34;.IO.modified; # e.g. Instant:1424089165 say DateTime.new(\u0026#34;path/to/file\u0026#34;.IO.modified); # e.g. 2015-02-16T12:18:50Z my $modification_instant = \u0026#34;path/to/file\u0026#34;.IO.modified; my $modification_time = DateTime.new($modification_instant); say $modification_time; # e.g. 2015-02-16T12:18:50Z say \u0026#34;path/to/file\u0026#34;.IO.accessed; # e.g. Instant:1424353577 say DateTime.new(\u0026#34;path/to/file\u0026#34;.IO.accessed); # e.g. 2015-02-19T13:45:42Z my $access_instant = \u0026#34;path/to/file\u0026#34;.IO.accessed; my $access_time = DateTime.new($access_instant); say $access_time; # e.g. 2015-02-19T13:45:42Z say \u0026#34;path/to/file\u0026#34;.IO.changed; # e.g. Instant:1424089165 say DateTime.new(\u0026#34;path/to/file\u0026#34;.IO.changed); # e.g. 2015-02-16T12:18:50Z my $change_instant = \u0026#34;path/to/file\u0026#34;.IO.changed; my $change_time = DateTime.new($chnge_instant); say $change_time; # e.g. 2015-02-16T12:18:50Z ","permalink":"https://ohmyweekly.github.io/notes/2015-10-11-io-in-raku/","tags":["io"],"title":"Raku ä¸­çš„ IO æ“ä½œ"},{"categories":["rakulang"],"contents":" Raku ä¸­çš„ .polymod æ–¹æ³• - æŠŠæ•°å­—åˆ†è§£æˆåˆ†æ¯\n å‘½å .polymod æ–¹æ³•æ¥å—å‡ ä¸ªé™¤æ•°å¹¶æŠŠå®ƒçš„è°ƒç”¨è€…åˆ†è§£æˆä¸€ä»½ä¸€ä»½çš„:\nmy $seconds = 1 * 60*60*24 # days + 3 * 60*60 # hours + 4 * 60 # minutes + 5; # seconds say $seconds.polymod: 60, 60; say $seconds.polymod: 60, 60, 24; # OUTPUT: # (5 4 27) # (5 4 3 1) è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬ä½œä¸ºå‚æ•°ä¼ é€’çš„é™¤æ•°æ˜¯å’Œæ—¶é—´ç›¸å…³çš„: 60(æ¯åˆ†é’Ÿæœ‰å¤šå°‘ç§’)ï¼Œ 60(æ¯å°æ—¶æœ‰å¤šå°‘åˆ†é’Ÿ)ï¼Œå’Œ24(æ¯å¤©æœ‰å¤šå°‘å°æ—¶)ã€‚ä»æœ€å°çš„å•ä½å¼€å§‹ï¼Œ æˆ‘ä»¬ä¸€ç›´å‰è¿›åˆ°æœ€å¤§çš„å•ä½ã€‚\nè¾“å‡ºå’Œè¾“å…¥çš„é™¤æ•°æ˜¯ç›¸åŒ¹é…çš„ - ä»æœ€å°çš„å•ä½åˆ°æœ€å¤§çš„å•ä½ï¼š 5 ç§’ï¼Œ4 åˆ†é’Ÿï¼Œ3 å°æ—¶å’Œ 1 å¤©ã€‚\næ‰‹å·¥åˆ¶ä½œ ä¸ä½¿ç”¨ .polymod è€Œä½¿ç”¨ä¸€ä¸ªå¾ªç¯æ¥å±•ç¤ºæ€ä¹ˆä¹‹å‰çš„è®¡ç®—:\nmy $seconds = 2 * 60*60*24 # days + 3 * 60*60 # hours + 4 * 60 # minutes + 5; # seconds my @pieces; for 60, 60, 24 -\u0026gt; $divisor { @pieces.push: $seconds mod $divisor; $seconds div= $divisor } @pieces.push: $seconds; say @pieces; # OUTPUT: # [5 4 3 2] è¶…è¶Šæ— é™ å½“é™¤æ•°æ˜¯ä»¥æƒ°æ€§åˆ—è¡¨çš„å½¢å¼ä¼ é€’ç»™ .polymod æ–¹æ³•æ—¶ï¼Œå®ƒä¼šä¸€ç›´è¿è¡Œç›´åˆ°ä½™æ•°ä¸ºé›¶å¹¶ä¸ä¼šéå†æ•´ä¸ªåˆ—è¡¨:\nsay 120.polymod: 10Â¹, 10Â², 10Â³, 10â´, 10âµ; say 120.polymod: lazy 10Â¹, 10Â², 10Â³, 10â´, 10âµ; say 120.polymod: 10Â¹, 10Â², 10Â³ â€¦ âˆ; # OUTPUT: # (0 12 0 0 0 0) # (0 12) # (0 12) åœ¨ç¬¬ä¸€ä¸ªè°ƒç”¨ä¸­ï¼Œ æˆ‘ä»¬è®©ä¸€ç³»åˆ—æ•°å­—æŒ‰ 10 çš„å¹‚å¢é•¿ã€‚è¯¥è°ƒç”¨çš„è¾“å‡ºåŒ…å«äº† 4 ä¸ªå°¾éƒ¨çš„é›¶ï¼Œå› ä¸º .polymod æ–¹æ³•è®¡ç®—äº†æ¯ä¸ªé™¤æ•°ã€‚åœ¨ç¬¬äºŒä¸ªè°ƒç”¨ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ lazy å…³é”®å­—æ˜¾å¼åœ°åˆ›å»ºäº†ä¸€ä¸ªæƒ°æ€§åˆ—è¡¨ï¼Œ è€Œç°åœ¨æˆ‘ä»¬åœ¨è¿”å›çš„åˆ—è¡¨ä¸­åªæœ‰ 2 ä¸ªæ¡ç›®ã€‚\nç¬¬ä¸€ä¸ªé™¤æ•°(10)ç»“æœä½™æ•°ä¸º 0ï¼Œè¿™æ˜¯è¿”å›åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªæ¡ç›®ï¼Œå¯¹äºä¸‹ä¸€ä¸ªé™¤æ•°ï¼Œæ•´é™¤æŠŠæˆ‘ä»¬çš„ 120 å˜æˆäº† 12ã€‚12 é™¤ä»¥ 100 çš„ä½™æ•°ä¸º 12ï¼Œ å®ƒæ˜¯è¿”å›åˆ—è¡¨ä¸­çš„ç¬¬äºŒä¸ªæ¡ç›®ã€‚ ç°åœ¨ï¼Œ 12 æ•´é™¤ 100 ä¸º 0ï¼Œ å®ƒç»ˆæ­¢äº† .polymod çš„æ‰§è¡Œå¹¶ç»™äº†æˆ‘ä»¬ä¸¤ä¸ª æ¡ç›®çš„ç»“æœã€‚\nåœ¨æœ€åä¸€ä¸ªè°ƒç”¨ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†çœç•¥å·ï¼Œå®ƒæ˜¯ä¸€ä¸ªåºåˆ—æ“ä½œç¬¦ï¼Œç”¨æ¥åˆ›å»ºä¸€ç³»åˆ—æŒ‰ 10 çš„å¹‚å¢é•¿çš„æ•°å­—ï¼Œä½†æ˜¯è¿™ä¸€æ¬¡åºåˆ—æ˜¯æ— é™çš„ã€‚å› ä¸ºå®ƒæ˜¯æƒ°æ€§çš„ï¼Œç»“æœå†ä¸€æ¬¡åªæœ‰ 2 ä¸ªå…ƒç´ ã€‚\nZip It, Lock It, Put It In The Pocket å•ç‹¬çš„æ•°å­—å¾ˆå¥½ä½†æ˜¯å¯¹äºå®ƒä»¬æ‰€ä»£è¡¨çš„å•ä½ä¸å¤Ÿå…·æœ‰æè¿°æ€§ã€‚æˆ‘ä»¬æ¥ä½¿ç”¨ Zip å…ƒæ“ä½œç¬¦:\nmy @units = \u0026lt;ng Î¼g mg g kg\u0026gt;; my @pieces = 42_666_555_444_333.polymod: 10Â³ xx âˆ; say @pieces Z~ @units; # OUTPUT: # (333ng 444Î¼g 555mg 666g 42kg) å¿«é€Ÿå‘½å å¯¹äºè¢«è°ƒç”¨è€…å’Œé™¤æ•°ï¼Œä½ ä¸ä»…ä»…é™äºä½¿ç”¨ Intsï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶å®ƒç±»å‹çš„æ•°å­—ã€‚\nsay â…”.polymod: â…“; say 5.Rat.polymod: .3, .2; say 3.Rat.polymod: â…”, â…“; # OUTPUT: # (0 2) # (0.2 0 80) # (0.333333 0 12) say 5.Num.polymod: .3, .2; say 3.Num.polymod: â…”, â…“; # OUTPUT: # (0.2 0.199999999999999 79) # (0.333333333333333 2.22044604925031e-16 12) ä½¿ç”¨ Number::Denominate æ¨¡å— use Number::Denominate; my $seconds = 1 * 60*60*24 # days + 3 * 60*60 # hours + 4 * 60 # minutes + 5; # seconds say denominate $seconds; say denominate $seconds, :set\u0026lt;weight\u0026gt;; # OUTPUT: # 1 day, 3 hours, 4 minutes, and 5 seconds # 97 kilograms and 445 grams ä½ è¿˜å¯ä»¥å®šä¹‰è‡ªå·±çš„å•ä½:\nsay denominate 449, :units( foo =\u0026gt; 3, \u0026lt;bar boors\u0026gt; =\u0026gt; 32, \u0026#39;ber\u0026#39; ); # OUTPUT: # 4 foos, 2 boors, and 1 ber http://raku.party/post/Raku-.polymod-break-up-a-number-into-denominations\n","permalink":"https://ohmyweekly.github.io/notes/2015-09-17-polymod-method-in-raku/","tags":["polymod"],"title":"Raku ä¸­çš„ polymod æ–¹æ³•"},{"categories":["rakulang"],"contents":"proto proto æ„æ€ä¸ºåŸå‹ã€‚proto ä»å½¢å¼ä¸Šå£°æ˜äº† multi å€™é€‰è€…ä¹‹é—´çš„å…±æ€§ã€‚ proto å……å½“ä½œèƒ½æ£€æŸ¥ä½†ä¸ä¼šä¿®æ”¹å‚æ•°çš„åŒ…è£¹ã€‚çœ‹çœ‹è¿™ä¸ªåŸºæœ¬çš„ä¾‹å­:\nproto congratulate(Str $reason, Str $name, |) {*} multi congratulate($reason, $name) { say \u0026#34;Hooray for your $reason, $name\u0026#34;; } multi congratulate($reason, $name, Int $rank) { say \u0026#34;Hooray for your $reason, $name-- you got rank $rank!\u0026#34;; } congratulate(\u0026#39;being a cool number\u0026#39;, \u0026#39;Fred\u0026#39;); # OK congratulate(\u0026#39;being a cool number\u0026#39;, \u0026#39;Fred\u0026#39;, 42); # OK congratulate(\u0026#39;being a cool number\u0026#39;, 42); # Proto match error æ‰€æœ‰çš„ multi congratulate ä¼šéµå®ˆåŸºæœ¬çš„ç­¾å, è¿™ä¸ªç­¾åä¸­æœ‰ä¸¤ä¸ªå­—ç¬¦ä¸²å‚æ•°, åé¢è·Ÿç€å¯é€‰çš„æ›´å¤šçš„å‚æ•°ã€‚ | æ˜¯ä¸€ä¸ªæœªå‘½åçš„ Capture å½¢å‚, è¿™å…è®¸ multi æ¥æ”¶é¢å¤–çš„å‚æ•°ã€‚ç¬¬ä¸‰ä¸ª congratulate è°ƒç”¨åœ¨ç¼–è¯‘æ—¶å¤±è´¥, å› ä¸ºç¬¬ä¸€è¡Œçš„ proto çš„ç­¾åå˜æˆäº†æ‰€æœ‰ä¸‰ä¸ª multi congratulate çš„å…±åŒç­¾å, è€Œ 42 ä¸åŒ¹é… Strã€‚\nsay \u0026amp;congratulate.signature #-\u0026gt; (Str $reason, Str $name, | is raw) ä½ å¯ä»¥ç»™ proto ä¸€ä¸ªå‡½æ•°ä½“, å¹¶ä¸”åœ¨ä½ æƒ³æ‰§è¡Œ dispatch çš„åœ°æ–¹æ”¾ä¸Šä¸€ä¸ª {*}ã€‚\n# attempts to notify someone -- returns False if unsuccessful proto notify(Str $user,Str $msg) { my \\hour = DateTime.now.hour; if hour \u0026gt; 8 or hour \u0026lt; 22 { return {*}; } else { # we can\u0026#39;t notify someone when they might be sleeping return False; } } {*} æ€»æ˜¯åˆ†æ´¾ç»™å¸¦æœ‰å‚æ•°çš„å€™é€‰è€…ã€‚é»˜è®¤å‚æ•°å’Œç±»å‹å¼ºåˆ¶è½¬æ¢ä¼šèµ·ä½œç”¨å•ä¸ä¼šä¼ é€’ã€‚\nproto mistake-proto(Str() $str, Int $number = 42) {*} multi mistake-proto($str,$number) { say $str.WHAT } mistake-proto(7,42); #-\u0026gt; (Int) -- coercions not passed on mistake-proto(\u0026#39;test\u0026#39;); #!\u0026gt; fails -- defaults not passed on ","permalink":"https://ohmyweekly.github.io/notes/2015-10-06-proto-in-raku/","tags":["proto"],"title":"Raku ä¸­çš„ proto"},{"categories":["rakulang"],"contents":" Composition and mix-ins Sigils Typed data structures Traits  æ‰€ä»¥åˆ°åº•ä»€ä¹ˆæ˜¯ role å‘¢ï¼Ÿ role æ˜¯é›¶ä¸ªæˆ–å¤šä¸ªæ–¹æ³•å’Œå±æ€§çš„é›†åˆã€‚\nrole ä¸åƒ classï¼Œå®ƒä¸èƒ½è¢«å®ä¾‹åŒ–ï¼ˆå¦‚æœä½ å°è¯•äº†ï¼Œä¼šç”Ÿæˆä¸€ä¸ª classï¼‰ã€‚Raku ä¸­ Classes æ˜¯å¯å˜çš„ï¼Œè€Œ roles æ˜¯ä¸å¯å˜çš„ã€‚\nç”³æ˜ Roles å°±åƒç”³æ˜ Class ä¸€æ · ä½¿ç”¨å…³é”®å­— role æ¥å¼•å…¥ role, åœ¨ role ä¸­å£°æ˜å±æ€§å’Œæ–¹æ³•å°±åƒåœ¨ Raku çš„ç±»ä¸­å£°æ˜å±æ€§å’Œæ–¹æ³•é‚£æ ·ã€‚\nrole DebugLog { has @.log_lines; has $.log_size is rw = 100; method log_message($message) { @!log_lines.shift if @!log_lines.elems \u0026gt;= $!log_size; @!log_lines.push($message); } } Role Composition  ä½¿ç”¨ does trait å°† role ç»„åˆåˆ° Class ä¸­ï¼š  class WebCrawler does DebugLog { ... }  è¿™ä¼šæŠŠæ–¹æ³•å’Œå±æ€§æ·»åŠ åˆ° class WebCrawler é‡Œé¢å»ã€‚ ç»“æœå°±åƒå®ƒä»¬èµ·åˆè¢«å†™åˆ° class ä¸­ä¸€æ ·ã€‚  Mix-ins  å…è®¸ role çš„åŠŸèƒ½è¢«æ·»åŠ åˆ°æ¯ä¸ªå¯¹è±¡çš„æ ¹ä¸Š ä¸å½±å“å…¶å®ƒçš„ç±»å®ä¾‹ role ä¸­çš„æ–¹æ³•æ€»æ˜¯è¦†ç›–å¯¹è±¡ä¸­å·²ç»å­˜åœ¨çš„æ–¹æ³•  Mix-ins Example  å‡è®¾æˆ‘ä»¬æƒ³è·Ÿè¸ªæŸä¸ªå¯¹è±¡å‘ç”Ÿäº†ä»€ä¹ˆ Mix in the DebugLog role  $acount does DebugLog;  ç„¶å, æˆ‘ä»¬å¯ä»¥è¾“å‡ºè¢«ç™»è®°çš„è¡Œ  $account.log_linesÂ».say;  ç°åœ¨æˆ‘ä»¬åªéœ€ç»™ log_message æ–¹æ³•æ·»åŠ è°ƒç”¨ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ .? æ“ä½œç¬¦, è¿™ä¼šè°ƒç”¨æŸä¸ªæ–¹æ³•, å¦‚æœæ–¹æ³•å­˜åœ¨çš„è¯  class Account { method change_password($new) { self.?log_message( \u0026#34;changing password to $new\u0026#34;; ) ... } } Sigil = æ¥å£åå®š  åœ¨ Raku ä¸­, ç¬¦å·è¡¨æ˜æ¥å£åå®š è¿™ä¸ªæ¥å£åå®šç”± role å®šä¹‰ ä½ å¯ä»¥åªæŠŠä¸œè¥¿æ”¾åœ¨å¸¦æœ‰ç¬¦å·çš„å˜é‡ä¸­, å¦‚æœè¯¥å˜é‡éµå®ˆ(does)äº†è¦æ±‚çš„ role çš„è¯ ä¾‹å¤–: å¸¦æœ‰ $ çš„å˜é‡å¯ä»¥å­˜å‚¨ä»»ä½•ä¸œè¥¿(å¦‚æœæ²¡æœ‰ä½¿ç”¨ç±»å‹çº¦æŸçš„è¯)  @ = Positional  @ ç¬¦å·è¡¨æ˜å®ƒæ˜¯ä¸€ä¸ª Positional role ä¿è¯ä¼šæœ‰ä¸€ä¸ªæ–¹æ³•åç¯ç¼€è®©ä½ èƒ½è°ƒç”¨ This is that gets called when you do an index positionally into something  say @fact[1]; say @fact.postcircumfix:\u0026lt;[ ]\u0026gt;(1);  æ³¨æ„: ä¼˜åŒ–å™¨(å¦‚æœæœ‰çš„è¯)å¯èƒ½å‘å‡ºæ›´è½»é‡çº§çš„ä¸œè¥¿  % = Associative  % è¡¨æ˜å®ƒæ˜¯ä¸€ä¸ªå…³è”å‹(Associative)çš„ role è¦æœ‰ä¸€ä¸ªæ–¹æ³•åç¯ç¼€ postcircumfix:\u0026lt;{}\u0026gt; è®©ä½ è°ƒç”¨ This is that gets called when you do an index associatively into something  say %price\u0026lt;Cheese\u0026gt;; say %price.postcircumfix:\u0026lt;{ }\u0026gt;(\u0026#39;Cheese\u0026#39;); \u0026amp; = Callable  \u0026amp; è¡¨æ˜å®ƒæ˜¯ä¸€ä¸ª Callable çš„ role ä¸œè¥¿è¦èƒ½è¢«è°ƒç”¨ è¿™ä¸ª role è¢«è¯¸å¦‚ Blockã€Subã€Methodä¹‹ç±»çš„ä¸œè¥¿éµå®ˆ è¦æ±‚å®ç°åç¯ç¼€ postcircumfix:\u0026lt;()\u0026gt;  ä½¿ç”¨å¸¦æœ‰ block çš„ class å…³é”®å­—å¼•å…¥ä¸€ä¸ªç±»ï¼š\nclass Puppy { ... } \u0001æˆ–ä½¿ç”¨\nclass Puppy; ... 1; æŠŠç±»ç›¸å…³çš„ä¸œè¥¿å•ç‹¬å†™è¿›ä¸€ä¸ªæ–‡ä»¶\nRole ä¹Ÿå¯ä»¥è¢«åˆå§‹åŒ– role BarChart { has Int @.bar-values; has $.b is rw; method plot { say @.bar-values; } } my $chart = BarChart.new(bar-values =\u0026gt; [1,2,3], b =\u0026gt; \u0026#34;Camelia\u0026#34;); say $chart.b; say $chart.bar-values; $chart.b = \u0026#34;Rakudo\u0026#34;; say $chart.b; say BarChart.^methods; å¦‚æœä½ åˆå§‹åŒ–äº† role, é‚£ä¹ˆå®ƒå°±å˜ä¸ºç±»äº†ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2015-07-15-roles-in-raku/","tags":["role"],"title":"Raku ä¸­çš„ Role"},{"categories":["rakulang"],"contents":"Raku: S/// æ“ä½œç¬¦ By Zoffix Znet\næ¥è‡ª Perl 5 èƒŒæ™¯çš„æˆ‘, ç¬¬ä¸€æ¬¡ä½¿ç”¨ Raku çš„éç ´åæ€§æ›¿æ¢æ“ä½œç¬¦ S/// çš„ç»å†å°±åƒä¸‹é¢è¿™æ ·:\nè¿›å±•ä¼šæ›´å¥½çš„ã€‚æˆ‘ä¸ä½†ä¼šæ”¹å–„é”™è¯¯ä¿¡æ¯, è€Œä¸”ä¼šè§£é‡Šå½“å‰çš„æ‰€æœ‰äº‹æƒ…ã€‚\næ™ºèƒ½åŒ¹é… æˆ‘æœ‰é—®é¢˜çš„åŸå› æ˜¯å› ä¸º, çœ‹åˆ°å¤–å½¢ç›¸ä¼¼çš„æ“ä½œç¬¦, æˆ‘å°±ç®€å•åœ°æŠŠ Perl 5 ä¸­çš„ç»‘å®šæ“ä½œç¬¦(=~)è½¬æ¢ä¸º Raku ä¸­çš„æ™ºèƒ½åŒ¹é…æ“ä½œç¬¦(~~) è¿˜æœŸæœ›å®ƒèƒ½æ­£å¸¸å·¥ä½œã€‚äº‹å®ä¸Šæˆ‘æ˜¯å¼‚æƒ³å¤©å¼€ã€‚S/// æ“ä½œç¬¦æ²¡æœ‰æ–‡æ¡£, å¹¶ä¸”ç»“åˆä»¤äººå›°æƒ‘çš„(é‚£ä¸ªæ—¶å€™)è­¦å‘Šä¿¡æ¯, è¿™å°±æ˜¯æˆ‘ç—›è‹¦çš„æ ¹æºï¼š\nmy $orig = \u0026#39;meowmix\u0026#39;; my $new = $orig ~~ S/me/c/; say $new; # OUTPUT warning: # Smartmatch with S/// can never succeed è¿™ä¸ªä¸‘é™‹çš„è­¦å‘Šè¯´è¿™å„¿çš„ ~~ æ“ä½œç¬¦æ˜¯ä¸ªé”™è¯¯çš„é€‰æ‹©å¹¶ä¸”ç¡®å®å¦‚æ­¤ã€‚~~ æ“ä½œç¬¦ä¸æ˜¯ Perl 5 çš„ =~ æ“ä½œç¬¦çš„ç­‰ä»·ç‰©ã€‚~~ æ™ºèƒ½æ“ä½œç¬¦æŠŠå®ƒå·¦è¾¹çš„ä¸œè¥¿èµ·äº†ä¸ªå«åš $_ çš„åˆ«å, ç„¶å ~~ è®¡ç®—å®ƒå³ä¾§çš„ä¸œè¥¿, ç„¶ååœ¨å³ä¾§è¿™ä¸ªä¸œè¥¿èº«ä¸Šè°ƒç”¨ .ACCEPTS($_) æ–¹æ³•ã€‚è¿™å°±æ˜¯æ‰€æœ‰çš„é­”æ³•ã€‚\næ‰€ä»¥ä¸Šé¢çš„ä¾‹å­å®é™…ä¸Šå‘ç”Ÿäº†:\n æˆ‘ä»¬åˆ°è¾¾ S/// çš„æ—¶å€™, $orig è¢«èµ·äº†ä¸ªå«åš $_ çš„åˆ«åã€‚ S/// éç ´åæ€§åœ°åœ¨ $_ èº«ä¸Šæ‰§è¡Œäº†æ›¿æ¢å¹¶è¿”å›é‚£ä¸ªç»“æœå­—ç¬¦ä¸²ã€‚è¿™æ˜¯æ™ºèƒ½åŒ¹é…å°†è¦æ“ä½œçš„ä¸œè¥¿ã€‚ æ™ºèƒ½åŒ¹é…, æŒ‰ç…§ Str ä¸ Str ç›¸åŒ¹é…çš„è§„åˆ™, ä¼šæ ¹æ®æ›¿æ¢æ˜¯å¦å‘ç”Ÿæ¥ç»™å‡º True æˆ– Falseï¼ˆä»¤äººå›°æƒ‘çš„æ˜¯, True æ„å‘³ç€æ²¡å‘ç”Ÿï¼‰  ç»“æœä¸€è·¯ä¸‹æ¥, æˆ‘ä»¬å¹¶æ²¡æœ‰å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ï¼šæ›¿æ¢è¿‡çš„å­—ç¬¦ä¸²ã€‚\nä½¿ç”¨ Given æ—¢ç„¶æˆ‘ä»¬çŸ¥é“äº† S/// æ€»æ˜¯ä½œç”¨åœ¨ $_ ä¸Šå¹¶ä¸”è¿”å›æ›¿æ¢åçš„ç»“æœ, å¾ˆå®¹æ˜“å°±æƒ³åˆ°å‡ ç§æ–¹æ³•æŠŠ $_ è®¾ç½®ä¸ºæˆ‘ä»¬åŸæ¥çš„å­—ç¬¦ä¸²å¹¶æŠŠ S/// çš„è¿”å›å€¼æ”¶é›†å›æ¥, æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªä¾‹å­ï¼š\nmy $orig = \u0026#39;meowmix\u0026#39;; my $new = S/me/c/ given $orig; say $orig; say $new; my @orig = \u0026lt;meow cow sow vow\u0026gt;; my @new = do for @orig { S/\\w+\u0026lt;?before\u0026#39;ow\u0026#39;\u0026gt;/w/ }; say @orig; say @new; # OUTPUT: # meowmix # cowmix # [meow cow sow vow] # [wow wow wow wow] ç¬¬ä¸€ä¸ªä½œç”¨åœ¨å•ä¸ªå€¼ä¸Šã€‚æˆ‘ä»¬ä½¿ç”¨åç½®å½¢å¼çš„ given å—å„¿, è¿™è®©æˆ‘ä»¬é¿å…äº†èŠ±æ‹¬å·ï¼ˆä½ å¯ä»¥ä½¿ç”¨ with ä»£æ›¿ given å¾—åˆ°åŒæ ·çš„ç»“æœï¼‰ã€‚given $orig ä¼šç»™ $orig èµ·ä¸ªå«åš $_ çš„åˆ«åã€‚ä»è¾“å‡ºæ¥çœ‹, åŸå­—ç¬¦ä¸²æ²¡æœ‰è¢«æ›´æ”¹ã€‚\nç¬¬äºŒä¸ªä¾‹å­ä½œç”¨åœ¨æ•°ç»„ä¸­çš„ä¸€å †å­—ç¬¦ä¸²èº«ä¸Šå¹¶ä¸”æˆ‘ä»¬ä½¿ç”¨ do å…³é”®å­—æ¥æ‰§è¡Œå¸¸è§„çš„ for å¾ªç¯(é‚£ç§æƒ…å†µä¸‹, å®ƒæŠŠå¾ªç¯å˜é‡åˆ«åç»™ $_ äº†)å¹¶æŠŠç»“æœèµ‹å€¼ç»™ @new æ•°ç»„ã€‚å†æ¬¡, è¾“å‡ºæ˜¾ç¤ºåŸæ¥çš„æ•°ç»„å¹¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜ã€‚\nå‰¯è¯ S/// æ“ä½œç¬¦ - å°±åƒ s/// æ“ä½œç¬¦å’ŒæŸäº›æ–¹æ³•ä¸€æ · - å…è®¸ä½ ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼å‰¯è¯ï¼š\ngiven \u0026#39;LÃ¶rem Ipsum Dolor Sit Amet\u0026#39; { say S:g /m/g/; # LÃ¶reg Ipsug Dolor Sit Aget say S:i /l/b/; # bÃ¶rem Ipsum Dolor Sit Amet say S:ii /l/b/; # BÃ¶rem Ipsum Dolor Sit Amet say S:mm /o/u/; # LÃ¼rem Ipsum Dolor Sit Amet say S:nth(2) /m /g/; # LÃ¶rem Ipsug Dolor Sit Amet say S:x(2) /m /g/; # LÃ¶reg Ipsug Dolor Sit Amet say S:ss/Ipsum Dolor/Gipsum\\nColor/; # LÃ¶rem Gipsum Color Sit Amet say S:g:ii:nth(2) /m/g/; # LÃ¶rem Ipsug Dolor Sit Amet } å¦‚ä½ æ‰€è§, å®ƒä»¬ä»¥ :foo çš„å½¢å¼æ·»åŠ åœ¨æ“ä½œç¬¦ S è¿™ä¸ªéƒ¨ä»¶çš„åé¢ã€‚ä½ å¯ä»¥å¤§å¤§æ–¹æ–¹åœ°ä½¿ç”¨ç©ºç™½ç¬¦å·å¹¶ä¸”å‡ ä¸ªå‰¯è¯å¯ä»¥åŒæ—¶ä½¿ç”¨ã€‚ä¸‹é¢æ˜¯å®ƒä»¬çš„æ„ä¹‰ï¼š\n :g â€”(é•¿å½¢å¼ï¼š:global)å…¨å±€åŒ¹é…ï¼šæ›¿æ¢æ‰æ‰€æœ‰çš„å‡ºç° :i â€”ä¸åŒºåˆ†å¤§å°å†™çš„åŒ¹é… :ii â€”(é•¿å½¢å¼ï¼š :samecase) ä¿ç•™å¤§å°å†™ï¼šä¸ç®¡ç”¨ä½œæ›¿æ¢å­—æ¯çš„å¤§å°å†™, ä½¿ç”¨åŸæ¥è¢«æ›¿æ¢çš„å­—æ¯çš„å¤§å°å†™ :mm â€”(é•¿å½¢å¼ï¼š:samemark) ä¿ç•™é‡éŸ³ç¬¦å·ï¼šåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, å­—æ¯ o ä¸Šçš„åˆ†éŸ³ç¬¦å·è¢«ä¿ç•™å¹¶è¢«åº”ç”¨åˆ°æ›¿æ¢å­—æ¯ u ä¸Š :nth(n) â€”åªæ›¿æ¢ç¬¬ n æ¬¡å‡ºç°çš„ :x(n) â€”è‡³å¤šæ›¿æ¢ n æ¬¡ï¼ˆåŠ©è®°ç¬¦: \u0026lsquo;x\u0026rsquo; ä½œä¸ºåŠæ—¶ï¼‰ :ss â€”(é•¿å½¢å¼ï¼šsamespace)ä¿ç•™ç©ºç™½ç±»å‹ï¼šç©ºç™½å­—ç¬¦çš„ç±»å‹è¢«ä¿ç•™, è€Œä¸ç®¡æ›¿æ¢å­—ç¬¦ä¸²ä¸­ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆç©ºç™½å­—ç¬¦ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, æˆ‘ä»¬ä½¿ç”¨æ¢è¡Œä½œä¸ºæ›¿æ¢, ä½†æ˜¯åŸæ¥çš„ç©ºç™½è¢«ä¿ç•™äº†ã€‚  æ–¹æ³•å½¢å¼ S/// æ“ä½œç¬¦å¾ˆå¥½, ä½†æ˜¯æœ‰æ—¶å€™æœ‰ç‚¹ç¬¨æ‹™ã€‚ä¸è¦å®³æ€•, Raku æä¾›äº† .subst æ–¹æ³•èƒ½æ»¡è¶³ä½ æ‰€æœ‰çš„æ›¿æ¢éœ€æ±‚å¹¶ä¸”æ¶ˆé™¤ä½ å¯¹ .subst/.substr çš„å›°æƒ‘ã€‚ä¸‹é¢æ¥çœ‹ä¾‹å­ï¼š\nsay \u0026#39;meowmix\u0026#39;.subst: \u0026#39;me\u0026#39;, \u0026#39;c\u0026#39;; say \u0026#39;meowmix\u0026#39;.subst: /m./, \u0026#39;c\u0026#39;; # OUTPUT: # cowmix # cowmix è¿™ä¸ªæ–¹æ³•è¦ä¹ˆæ¥æ”¶ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼è¦ä¹ˆæ¥æ”¶ä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ä¸²ä½œä¸ºå®ƒçš„ç¬¬ä¸€ä¸ªä½ç½®å‚æ•°, å®ƒæ˜¯è¦åœ¨è°ƒç”¨è€…é‡Œé¢(\u0026ldquo;meowmix\u0026rdquo;)æŸ¥æ‰¾çš„ä¸œè¥¿ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ›¿æ¢å­—ç¬¦ä¸²ã€‚\né€šè¿‡ç®€å•åœ°æŠŠå®ƒä»¬åˆ—ä¸ºå…·å Bool å‚æ•°, ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å‰¯è¯ã€‚åœ¨ S/// å½¢å¼ä¸­, å‰¯è¯ :ss å’Œ :ii åˆ†åˆ«è¡¨æ˜ :s(ä½¿ç©ºç™½æœ‰æ„ä¹‰) çš„å‡ºç°å’Œ :i(ä¸åŒºåˆ†å¤§å°å†™çš„åŒ¹é…) çš„å‡ºç°ã€‚åœ¨æ–¹æ³•å½¢å¼ä¸­, ä½ å¿…é¡»æŠŠè¿™äº›å‰¯è¯åº”ç”¨åˆ°æ­£åˆ™è¡¨è¾¾å¼è‡ªèº«èº«ä¸Šï¼š\ngiven \u0026#39;Lorem Ipsum Dolor Sit Amet\u0026#39; { say .subst: /:il/, \u0026#39;b\u0026#39;, :ii; say .subst: /:sIpsum Dolor/, \u0026#34;Gipsum\\nColor\u0026#34;, :ss; } # OUTPUT: # Borem Ipsum Dolor Sit Amet # Lorem Gipsum Color Sit Amet æ–¹æ³•å½¢å¼çš„æ•è· æ•è·å¯¹äºæ›¿æ¢æ“ä½œæ¥è¯´ä¸é™Œç”Ÿ, æ‰€ä»¥æˆ‘ä»¬æ¥å°è¯•æ•è·ä¸‹æ–¹æ³•è°ƒç”¨å½¢å¼çš„æ›¿æ¢ï¼š\nsay \u0026#39;meowmix\u0026#39;.subst: /me (.+)/, \u0026#34;c$0\u0026#34;; # OUTPUT: # Use of Nil in string context in block \u0026lt;unit\u0026gt; at test.p6 line 1 # c ä¸æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ã€‚æˆ‘ä»¬çš„æ›¿æ¢å­—ç¬¦ä¸²æ„å»ºåœ¨è¾¾åˆ° .subst æ–¹æ³•ä¹‹å‰, å¹¶ä¸”é‡Œé¢çš„ $0 å˜é‡å®é™…ä¸ŠæŒ‡å‘ä»»ä½•è¿™ä¸ªæ–¹æ³•è°ƒç”¨ä¹‹å‰çš„ä¸œè¥¿, è€Œä¸æ˜¯ .subst æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„æ•è·ã€‚æ‰€ä»¥æˆ‘ä»¬æ€ä¹ˆæ¥ä¿®æ­£å®ƒå‘¢ï¼Ÿ\n.subst æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ä¹Ÿå¯ä»¥æ¥å—ä¸€ä¸ª Callableã€‚åœ¨å®ƒé‡Œé¢, ä½ å¯ä»¥ä½¿ç”¨ $0, $1, ... $n å˜é‡, ç›´åˆ°ä½ æƒ³è¦çš„ç¼–å·, å¹¶ä»æ•è·ä¸­å¾—åˆ°æ­£ç¡®çš„å€¼ï¼š\nsay \u0026#39;meowmix\u0026#39;.subst: /me (.+)/, -\u0026gt; { \u0026#34;c$0\u0026#34; }; # OUTPUT: # cowmix è¿™é‡Œ, æˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„ Callable ä½¿ç”¨äº†å°–å·å—å„¿, ä½†æ˜¯ WhateverCode å’Œå­ä¾‹ç¨‹ä¹Ÿæœ‰æ•ˆã€‚æ¯æ¬¡æ›¿æ¢éƒ½ä¼šè°ƒç”¨è¿™ä¸ª Callable, å¹¶ä¸”æŠŠ Match å¯¹è±¡ä½œä¸ºç¬¬ä¸€ä¸ªä½ç½®å‚æ•°ä¼ é€’ç»™ Callable, å¦‚æœä½ éœ€è¦è®¿é—®å®ƒçš„è¯ã€‚\nç»“è®º S/// æ“ä½œç¬¦åœ¨ Raku ä¸­æ˜¯ s/// æ“ä½œç¬¦çš„æˆ˜å‹, å®ƒä¸æ˜¯ä¿®æ”¹åŸæ¥çš„å­—ç¬¦ä¸², è€Œæ˜¯æ‹·è´åŸæ¥çš„å­—ç¬¦ä¸², ä¿®æ”¹, ç„¶åè¿”å›ä¿®æ”¹è¿‡çš„ç‰ˆæœ¬ã€‚è¿™ä¸ªæ“ä½œç¬¦çš„ä½¿ç”¨æ–¹å¼è·Ÿ Perl 5 ä¸­çš„éç ´åæ€§æ›¿æ¢æ“ä½œç¬¦çš„ä½¿ç”¨æ–¹å¼ä¸åŒã€‚ä½œä¸ºå¤‡é€‰, æ–¹æ³•ç‰ˆæœ¬çš„ .subst ä¹Ÿèƒ½ä½¿ç”¨ã€‚ æ–¹æ³•å½¢å¼å’Œæ“ä½œç¬¦å½¢å¼çš„æ›¿æ¢éƒ½èƒ½æ¥æ”¶ä¸€ç»„å‰¯è¯ä»¥ä¿®æ”¹å®ƒä»¬çš„è¡Œä¸º, æ¥æ»¡è¶³ä½ çš„éœ€æ±‚ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2016-01-28-the-s-operator-in-raku/","tags":["rakulang"],"title":"Raku ä¸­çš„ S/// æ“ä½œç¬¦"},{"categories":["rakulang"],"contents":"æè¿° æœ‰ 7 å—æ¿å­æ”¾åœ¨ä¸€ä¸ª\u0026quot;è¢‹å­\u0026quot;ä¸­, éšæœºä»è¢‹å­ä¸­ç§»é™¤ä¸€ä¸ªæ¿å­å±•ç¤ºåˆ°ç©å®¶é¢å‰ç›´åˆ°è¢‹å­å˜ç©ºã€‚å½“è¢‹å­å˜ç©ºæ—¶, å®ƒä¼šè¢«é‡æ–°è£…å¡«, å¦‚æœéœ€è¦é¢å¤–çš„æ¿å­, åˆ™é‡å¤å‰é¢é‚£ä¸ªè¿‡ç¨‹ã€‚\nè¾“å‡º ä½¿ç”¨éšæœº bag ç³»ç»Ÿéšæœºè¾“å‡º 50 å—æ¿å­ã€‚\næ¿å­å¦‚ä¸‹:\n O I S Z L J T  è¾“å‡ºæ ·æœ¬  LJOZISTTLOSZIJOSTJZILLTZISJOOJSIZLTZISOJTLIOJLTSZO OTJZSILILTZJOSOSIZTJLITZOJLSLZISTOJZTSIOJLZOSILJTS ITJLZOSILJZSOTTJLOSIZIOLTZSJOLSJZITOZTLJISTLSZOIJO  åœ¨ Raku ä¸­æˆ‘ä¼šè¿™æ ·å†™ (smls):\nsay (|\u0026lt;O I S Z L J T\u0026gt;.pick(*) xx *).[^50].join; æ³¨æ„:\n | æ“ä½œç¬¦æŠŠæ¯æ¬¡è¿­ä»£çš„é¡¹å±•å¼€è¿›å¤–éƒ¨çš„åˆ—è¡¨ä¸­, ä»¥ä½¿ä½ ä¸å¿…åœ¨ç»“æœä¸Šæ˜¾å¼åœ°è°ƒç”¨ .flat æ–¹æ³• ä½¿ç”¨ \u0026lt; \u0026gt; å­—ç¬¦ä¸²åˆ—è¡¨å­—é¢é‡çœ‹èµ·æ¥æ¯”åœ¨å­—ç¬¦ä¸²å­—é¢é‡ä¸Šä½¿ç”¨ .comb æ–¹æ³•æ›´åˆé€‚ xx æ“ä½œç¬¦æ¯æ¬¡éƒ½ä¼šé‡æ–°è®¡ç®—å®ƒå·¦ä¾§çš„è¡¨è¾¾å¼  ","permalink":"https://ohmyweekly.github.io/notes/2015-05-19-an-example-of-slip/","tags":["slip"],"title":"Raku ä¸­çš„ Slip"},{"categories":["rakulang"],"contents":"ä¸€ä¸ªè£¸çš„ :Dã€:Uã€:T æˆ– :_ æ˜¯é™åˆ¶é»˜è®¤ç±»å‹ä¸ºå®šä¹‰ã€æœªå®šä¹‰ã€ç±»å‹å¯¹è±¡æˆ–ä»»ä½•å¯¹è±¡çš„ç±»å‹çº¦æŸã€‚æ‰€ä»¥:\nclass Con { method man(:U: :D $x) } å…¶ç­¾åç­‰ä»·äº (Con:U: Any:D $x)ã€‚\nCon:U æ˜¯è°ƒç”¨è€…, åœ¨è°ƒç”¨è€…åé¢åŠ ä¸Šä¸€ä¸ªå†’å·ã€‚è¦æ ‡è®°ä¸€ä¸ªæ˜¾å¼çš„è°ƒç”¨è€…, åœ¨å®ƒåé¢æ”¾ä¸Šä¸€ä¸ªå†’å·å°±å¥½äº†:\nmethod doit ($x: $a, $b, $c) { ... } Abstract vs Concrete types ã€€å¯¹äºä»»ä½•æœ‰åå­—çš„ç±»å‹, æŸäº›å…¶å®ƒå­é›†ç±»å‹å¯ä»¥è‡ªåŠ¨åœ°é€šè¿‡åœ¨ç±»å‹çš„åå­—åé¢è¿½åŠ ä¸€ä¸ªåˆé€‚çš„çŠ¶è¯­æ¥æ´¾ç”Ÿå‡ºæ¥ï¼š\nInt:_ å…è®¸å®šä¹‰æˆ–æœªå®šçš„ Int å€¼ Int:D åªå…è®¸æœ‰å®šä¹‰çš„(å¼ºåˆ¶çš„)Int å€¼ Int:U åªå…è®¸æœªå®šä¹‰å€¼(æŠ½è±¡æˆ–å¤±è´¥)Int å€¼ Int:T å…è®¸Intåªä½œä¸ºç±»å‹å¯¹è±¡ å³, å®ƒä»¬çš„æ„æ€æœ‰ç‚¹åƒ:\nInt:D Int:_ where DEFINITE($_) Int:U Int:_ where not(DEFINITE($_)) Int:T Int:U where none(Failure) where DEFINITE æ˜¯ä¸€ä¸ªå¸ƒå°”å®, å®ƒè¯´æ­£å¤„ç†çš„å¯¹è±¡æ˜¯å¦æœ‰ä¸€ä¸ªåˆæ³•çš„å¼ºåˆ¶è¡¨ç¤ºã€‚(æŸ¥çœ‹ä¸‹é¢çš„è‡ªçœ) .\nåœ¨ Raku ä¸­, Int é€šå¸¸å‡å®šæ„ä¸º Int:_, é™¤äº†è°ƒç”¨è€…, å…¶ä¸­é»˜è®¤ä¸º Int:Dã€‚ï¼ˆé»˜è®¤çš„ new æ–¹æ³•æœ‰ä¸€ä¸ªåŸå‹, å®ƒçš„è°ƒç”¨è€…æ˜¯ :T, æ‰€ä»¥æ‰€æœ‰çš„ new æ–¹æ³•éƒ½é»˜è®¤å…è®¸ç±»å‹å¯¹è±¡ã€‚ï¼‰\nè¿™äº›é»˜è®¤å¯ä»¥é€šè¿‡å„ç§ç¼–è¯‘æŒ‡ä»¤åœ¨è¯æ³•ä½œç”¨åŸŸä¸­æ›´æ”¹ã€‚\nuse parameters :D; ä¼šè®©éè°ƒç”¨è€…çš„å‚æ•°é»˜è®¤ä¸º :Dã€‚\nä½œä¸ºå¯¹æ¯”,\nuse variables :D; ä¼šå¯¹ç”¨äºå˜é‡å£°æ˜ä¸­çš„ç±»å‹åšåŒæ ·çš„äº‹æƒ…ã€‚ åœ¨è¿™æ ·çš„è¯æ³•ä½œç”¨åŸŸä¸­, ä½ å¯ä»¥ä½¿ç”¨ :_ å½¢å¼å›åˆ°æ ‡å‡†çš„è¡Œä¸ºã€‚ç‰¹åˆ«åœ°, å› ä¸ºè°ƒç”¨è€…é»˜è®¤ä¸ºå®šä¹‰çš„:\nuse invocant :_; ä¼šè®©è°ƒç”¨è€…å…è®¸ä»»ä½•ç±»å‹çš„æœ‰å®šä¹‰çš„å’Œæœªå®šä¹‰çš„è°ƒç”¨è€…ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2015-11-05-smile-type-in-raku/","tags":["smile"],"title":"Raku ä¸­çš„ Smile ç±»å‹"},{"categories":["rakulang"],"contents":"Raku ä¸­çš„ . å’Œ ! twigil æ˜¯ä»€ä¹ˆï¼Ÿ . twigil çš„æ„æ€æ˜¯\u0026quot;è¿™æ˜¯ç±»å…¬ç”¨çš„\u0026quot;, ! twigil çš„æ„æ€æ˜¯â€œè¿™æ˜¯ç±»ç§æœ‰çš„â€, åªèƒ½ç”¨åœ¨ç±»çš„å†…éƒ¨ã€‚\nclass ScoreKeeper { has @.options; has %!player-points; } æ™®é€šçš„ç¬¦å·è¡¨æ˜äº†è¯æ³•ä½œç”¨åŸŸæˆ–åŒ…ä½œç”¨åŸŸ, ä½†æ˜¯ twigils å°±åƒæ˜¯ sigils çš„å…„å¼Ÿ, è¡¨æ˜äº†ä¸åŒçš„ä½œç”¨åŸŸ, å®ƒå½±å“äº†å˜é‡çš„ä½œç”¨åŸŸã€‚. å’Œ ! æ˜¯äºŒçº§ sigilsã€‚\nå±æ€§å­˜åœ¨äºæ¯ä¸ªç±»çš„å®ä¾‹ä¸­, åœ¨ç±»çš„å†…éƒ¨, å¯ä»¥ç›´æ¥ä½¿ç”¨ ! è®¿é—®åˆ°å®ä¾‹çš„å±æ€§:\nclass Point { has $.x; has $.y; method Str() { \u0026#34;($!x, $!y)\u0026#34; } } é‚£ä¹ˆ . twigil å’Œ ! twigil ä¹‹é—´æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­:\nclass Point { has $.x; has $.y; method Str() { # æ³¨æ„è¿™æ¬¡æˆ‘ä»¬ä½¿ç”¨ . è€Œé ! \u0026#34;\\$.x ç­‰ä»·äº self.x()\u0026#34;.say if $.x == self.x(); \u0026#34;\\$.y ç­‰ä»·äº self.y()\u0026#34;.say if $.y == self.y(); } method print() { say self.x(); # è°ƒç”¨å®ä¾‹çš„åä¸º x çš„æ–¹æ³• say self.y(); # è°ƒç”¨å®ä¾‹çš„åä¸º y çš„æ–¹æ³• } } my $point = Point.new(x =\u0026gt; 10, y =\u0026gt; 20); $point.Str; $point.print; ä¼šè¾“å‡º:\n$.x ç­‰ä»·äº self.x() $.y ç­‰ä»·äº self.y() 10 20 æ³¨æ„åˆ°, å±æ€§è¢«å£°æ˜ä¸º $.x å’Œ $.y, ä½†æ˜¯åœ¨ç±»çš„å†…éƒ¨ä»æ—§èƒ½é€šè¿‡ $!x å’Œ $!y æ¥è®¿é—®å±æ€§ã€‚è¿™æ˜¯å› ä¸ºåœ¨ Raku ä¸­æ‰€æœ‰çš„å±æ€§éƒ½æ˜¯ç§æœ‰çš„å¹¶ä¸”åœ¨ç±»ä¸­å¯ä»¥é€šè¿‡ $!attribute-name ç›´æ¥è®¿é—®è¿™äº›å±æ€§ã€‚Raku å¯ä»¥ä¸ºä½ è‡ªåŠ¨ç”Ÿæˆå­˜å–æ–¹æ³•ã€‚\nå…¬å…±å±æ€§æ‹¥æœ‰ . twigil, ç§æœ‰å±æ€§æ‹¥æœ‰ ! twigilã€‚\nhas $.x å°±æ˜¯ç§æœ‰å±æ€§ has $!x åŠ ä¸Šä¸€ä¸ªgetteræ–¹æ³•, å³ method x() { ... }ã€‚\nhas $.x is rw å°±æ˜¯ç§æœ‰å±æ€§ has $!x åŠ ä¸Šä¸€ä¸ªgetter/setteræ–¹æ³•ã€‚\n. twigil å°±æ˜¯è°ƒç”¨äº†ä¸å±æ€§åŒåçš„æ–¹æ³• class SaySomething { method a() { say \u0026#34;a\u0026#34;; } method b() { $.a; } method c() { self.a(); } # è¿™è¯æ˜äº† $.a çš„ . twigil åšäº†ä¸€æ¬¡éšå¼çš„å®ä¾‹æ–¹æ³•è°ƒç”¨ã€‚ } SaySomething.b; # æ‰“å° \u0026#34;a\u0026#34; SaySomething.c; # æ‰“å° \u0026#34;a\u0026#34; . twigil ä¸­è‡ªåŠ¨ç”Ÿæˆçš„æ–¹æ³•å¯ä»¥è¢«å­ç±»é‡å†™ class Point { has $.x; has $.y; } class Circle is Point { has $!radius; # é‡å†™çˆ¶ç±»ä¸­çš„ x() æ–¹æ³•å’Œ y() æ–¹æ³• method x() { \u0026#34;I am x point in a Circle\u0026#34;; } method y() { \u0026#34;I am y point in a Circle\u0026#34;; } } my $circle = Circle.new(radius =\u0026gt; 10); $circle.x().say; # I am x point in a Circle $circle.y.say; # I am y point in a Circle å¦‚æœä¸æƒ³å­ç±»é‡å†™çˆ¶ç±»ä¸­çš„æ–¹æ³•, é‚£ä¹ˆåœ¨çˆ¶ç±»ä¸­å£°æ˜å±æ€§çš„æ—¶å€™, ä½¿ç”¨ ! twigil æ›¿ä»£ . twigilã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2015-12-11-twigils-in-raku/","tags":["rakulang"],"title":"Raku ä¸­çš„ twigil"},{"categories":["rakulang"],"contents":"ç©ºæ ¼æœ€å°‘åŒ– åœ¨æ•°ç»„æˆ–æ•£åˆ—çš„å¼€æ‹¬å·(å³ä¸‹æ ‡å·¦è¾¹çš„é‚£ä¸ªæ‹¬å·)ä¹‹å‰ä¸å…è®¸æœ‰ç©ºæ ¼, å‚æ•°åˆ—è¡¨çš„åœ†å¼€æ‹¬å·å‰é¢ä¹Ÿæ˜¯ä¸èƒ½æœ‰ç©ºæ ¼çš„ã€‚å³:\n@deadbeef[$x] # okay %monsters{\u0026#39;cookie\u0026#39;} # okay saymewant(\u0026#39;cookie\u0026#39;) # okay @a [$b] # WRONG %people {\u0026#39;john\u0026#39;} # WRONG mewant (\u0026#39;cookie\u0026#39;) # WRONG è¿™ç§é™åˆ¶çš„çš„å‡ ä¸ªå‰¯ä½œç”¨ä¹‹ä¸€å°±æ˜¯æ¡ä»¶æ§åˆ¶ç»“æ„çš„å‘¨å›´ä¸å†éœ€è¦åœ†æ‹¬å·äº†:\nif $value eq $target { print \u0026#34;Bullseye!\u0026#34;; } while $i \u0026lt; 10 { $i++ } ç„¶è€Œ, æ˜¾å¼çš„ä½¿ç”¨ unspace è¯­æ³•ä»ç„¶èƒ½å¤Ÿè®©ä½ å¯¹é½ä¸‹æ ‡å’Œåç¼€æ“ä½œç¬¦:\n%squirrels{\u0026#39;fluffy\u0026#39;} = Squirrel.new; %monsters.{\u0026#39;cookie\u0026#39;} = Monster.new; %beatles\\.{\u0026#39;ringo\u0026#39;} = Beatle.new; %people\\ .{\u0026#39;john\u0026#39;} = Person.new; unspace æœ‰äº›è¯­è¨€ä¾‹å¦‚ C å…è®¸ä½ è½¬ä¹‰ä¸€ä¸ªæ¢è¡Œç¬¦ä½¿è¡Œè”åˆèµ·æ¥. å…¶å®ƒè¯­è¨€(ä¾‹å¦‚æ­£åˆ™è¡¨è¾¾å¼)å› ä¸ºå„ç§å„æ ·çš„åŸå› , å…è®¸ä½ ä½¿ç”¨åæ–œçº¿è½¬ä¹‰ä¸€ä¸ªç©ºç™½ç¬¦ã€‚Raku æŠŠè¿™ç§è®°æ³•æ¨å¹¿åˆ°ä»»ä½•ç§ç±»çš„ç©ºç™½ä¸Šã€‚é€šè¿‡åœ¨ç©ºç™½å¤„å‰ç½®ä¸€ä¸ª \\, ä»»ä½•ç›¸é‚»çš„ç©ºç™½(åŒ…æ‹¬æ³¨é‡Š)éƒ½ä¼šåœ¨è§£æå™¨é¢å‰éšèº«ã€‚è¿™å°±æ˜¯é¼é¼å¤§åçš„ç©ºç™½éšèº«(â€œunspaceâ€)ã€‚\nåœ¨ Raku ä¸­, unspace èƒ½å¤ŸæŠ‘åˆ¶ä»»æ„çš„å‡ ç§ç©ºç™½é™„å±ç‰©ã€‚ä¾‹å¦‚, å› ä¸º Raku è¦æ±‚åè¯å’Œåç¼€æ“ä½œç¬¦ä¹‹é—´ä¸èƒ½å‡ºç°ç©ºç™½, æ‰€ä»¥ä½¿ç”¨ unspace è®©ä½ å¯ä»¥æŠŠåç¼€æ“ä½œç¬¦è´´çº¿å¯¹é½:\n%hash\\ {$key} @array\\ [$ix] $subref\\($arg) ä¸Šé¢çš„æœ€åä¸€ç§å½¢å¼ä½œä¸ºä¸€ç§é€€åŒ–äº†çš„ unspace, å³åæ–œçº¿åé¢ç›´æ¥è·Ÿç€åç¼€ã€‚æ³¨æ„, åæ–œçº¿å‰é¢ä¸å…è®¸æœ‰ç©ºç™½, æ‰€ä»¥:\n$subref \\($arg) æ˜¯è¯­æ³•é”™è¯¯(two terms in a row)ã€‚è€Œ:\nfoo \\($arg) ä¼šè¢«è§£æä¸ºå¸¦æœ‰ Capture å‚æ•°çš„åˆ—è¡¨æ“ä½œ:\nfoo(\\($arg)) ç„¶è€Œ, å…¶å®ƒå½¢å¼çš„ unspace å¯èƒ½è¢«æœ‰æ•ˆåœ°æ”¾åœ¨ç©ºç™½ä¹‹å‰.\nå…¶å®ƒåç¼€æ“ä½œç¬¦ä¹Ÿå¯èƒ½ä½¿ç”¨ unspace:\n$number\\ ++; $number\\ --; 1+3\\ i; $object\\ .say(); $object\\#`{ your ad here }.say å¦å¤–ä¸€ç§\u0026quot;ä½ çœ‹ä¸è§è¿™ç©ºç™½\u0026quot;çš„æ­£å¸¸ç”¨æ³•æ˜¯, åœ¨ä¸‹ä¸€è¡Œæ”¾ä¸Šä¸€ä¸ªç‚¹è¯­æ³•å½¢å¼çš„åç¼€:\n $object\\ # comment .say $object\\#`[ comment ].say $object\\ .say ä½†æ˜¯ unspace ä¸»è¦æ˜¯å…³äºè¯­è¨€æ‰©å±•çš„: å®ƒè®©ä½ åœ¨æ¢è¡Œå¯èƒ½ä¼šä½¿è§£æå™¨å›°æƒ‘çš„åœ°æ–¹, è®©è¡Œåœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½èƒ½ç»§ç»­, ä¸ç®¡ä½ å½“å‰å®‰è£…çš„æ˜¯ä»€ä¹ˆè§£æå™¨ã€‚(é™¤é, å½“ç„¶, ä½ è‡ªå·±è¦†å†™äº† unspace è§„åˆ™\u0026hellip;)\nå°½ç®¡æˆ‘ä»¬è¯´, unspace è®©ç©ºç™½åœ¨è§£æå™¨é¢å‰éšèº«äº†, ä½†æ˜¯å®ƒå¹¶ä¸èƒ½ä½¿ç©ºç™½åœ¨è¯æ³•åˆ†æç¨‹åºé¢å‰éšèº«ã€‚ç»“æœå°±æ˜¯, åœ¨ token ä¸­ç¦æ­¢äº† unspaceã€‚æ­¤å¤–, å¦‚æœ unspace åŒ…å«ä¸€è¡Œæˆ–å¤šè¡Œ, å®ƒä»¬çš„è¡Œæ•°ä»ç„¶ä¼šè¢«è®¡ç®—åœ¨å†…ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2015-09-18-unspace-in-raku/","tags":["unspace"],"title":"Raku ä¸­çš„ unspace"},{"categories":["rakulang"],"contents":"è‡ªçœå’Œ Raku çš„å¯¹è±¡ç³»ç»Ÿ Raku æ˜¯æ„å»ºåœ¨å…ƒå¯¹è±¡å±‚ä¸Šé¢çš„ã€‚é‚£æ„å‘³ç€æœ‰äº›å¯¹è±¡(å…ƒå¯¹è±¡)æ§åˆ¶ç€å„ç§é¢å‘å¯¹è±¡ç»“æ„(ä¾‹å¦‚ç±»ã€rolesã€æ–¹æ³•ã€å±æ€§ã€æšä¸¾â€¦)æ€æ ·å»è¡¨ç°ã€‚\nè¦æ„Ÿå—ç±»çš„å…ƒå¯¹è±¡, è¿™å„¿æœ‰ä¸€ä¸ªåŒæ ·çš„ä¾‹å­å‡ºç°2æ¬¡: ä¸€æ¬¡ä¸€ç§ Rakuä¸­çš„æ™®é€šå£°æ˜, ä¸€æ¬¡é€šè¿‡å…ƒæ¨¡å‹æ¥è¡¨è¾¾:\nclass A { method x() { say 42 } } A.x(); # 42 å¯¹åº”äº:\nconstant A := Metamodel::ClassHOW.new_type( name =\u0026gt; \u0026#39;A\u0026#39; ); # class A { A.^add_method(\u0026#39;x\u0026#39;, my method x(A:) { say 42 }); # method x() .. . A.^compose; # } A.x(); # 42 (é™¤äº†å£°æ˜å½¢å¼çš„è¿è¡Œåœ¨ç¼–è¯‘æ—¶, åé¢è¿™ç§å½¢å¼ä¸æ˜¯)\nå¯¹è±¡åé¢çš„å…ƒå¯¹è±¡èƒ½ä½¿ç”¨ $obj.HOW è·å–, è¿™å„¿çš„ HOW ä»£è¡¨ç€ Higher Order Workings(æˆ–è€… HOW the *%@$ does this work?)ã€‚\nè¿™å„¿, å¸¦æœ‰ .^ çš„è°ƒç”¨æ˜¯å…ƒå¯¹è±¡çš„è°ƒç”¨, æ‰€ä»¥ A.^compose æ˜¯ A.HOW.compose(A) çš„ç®€å†™ã€‚è°ƒç”¨è€…ä¹Ÿè¢«ä¼ é€’åˆ°å‚æ•°åˆ—è¡¨ä¸­, ä»¥ä½¿å®ƒèƒ½å¤Ÿæ”¯æŒåŸå‹ç±»å‹é£æ ¼çš„ç±»å‹ç³»ç»Ÿ, é‚£å„¿åªæœ‰ä¸€ä¸ªå…ƒå¯¹è±¡ã€‚\nå°±åƒä¸Šé¢çš„ä¾‹å­å±•ç¤ºçš„é‚£æ ·, æ‰€æœ‰çš„é¢å‘å¯¹è±¡ç‰¹æ€§å¯¹ä½¿ç”¨è€…éƒ½æ˜¯å¯è·å¾—çš„, è€Œä¸ä»…ä»…æ˜¯ç¼–è¯‘å™¨ã€‚å®é™…ä¸Šç¼–è¯‘å™¨å°±æ˜¯ä½¿ç”¨å…ƒå¯¹è±¡çš„è¿™æ ·çš„è°ƒç”¨çš„ã€‚\nå…ƒå¯¹è±¡(MetaObjects) è¿™äº›æ˜¯å†…çœçš„å®, ç±»ä¼¼äºæ–¹æ³•è°ƒç”¨ã€‚\nå…ƒå¯¹è±¡é€šå¸¸ä»¥ ALLCAPS(å…¨å¤§å†™)å‘½å, å¹¶ä¸”é¿å…ä½¿ç”¨ä½ è‡ªå·±çš„å¸¦æœ‰å…¨å¤§å†™åå­—çš„æ–¹æ³•è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå¥½çš„é£æ ¼ã€‚è¿™ä¼šé¿å…å’Œå¯èƒ½å‡ºç°åœ¨æœªæ¥ç‰ˆæœ¬ä¸­çš„ä»»ä½•å…ƒå¯¹è±¡å‘ç”Ÿå†²çªã€‚æ³¨æ„, å¦‚æœä½ å¿…é¡»ä½¿ç”¨å¸¦æœ‰å…¨å¤§å†™åå­—çš„æ–¹æ³•çš„è¯, æŠŠä½ çš„è¿™ä¸ªæ–¹æ³•åå­—ç”¨å¼•å·å¼•èµ·æ¥æ¥é—´æ¥å®‰å…¨åœ°è°ƒç”¨:\n#| THIS IS A CLASS FOR SHOUTING THINGS class MY-CLASSES-ARE-ALL-CAPS { method WHY { \u0026#34;I DON\u0026#39;T KNOW\u0026#34; } } my $c = MY-CLASSES-ARE-ALL-CAPS.new; say $c.WHY # \u0026#34;THIS IS A CLASS FOR SHOUTING THINGS\u0026#34;? æ˜¾ç¤ºè¿™ï¼Ÿä½ åœ¨é€—æˆ‘! say $c.\u0026#34;WHY\u0026#34;() # \u0026#34;I DON\u0026#39;T KNOW\u0026#34; WHAT ç±»å‹çš„ç±»å‹å¯¹è±¡ã€‚ä¾‹å¦‚ 42.WHAT è¿”å› Int ç±»å‹å¯¹è±¡ã€‚\nWHICH å¯¹è±¡çš„åŒä¸€å€¼ã€‚è¿™èƒ½ç”¨äºå“ˆå¸Œå’ŒåŒä¸€æ¯”è¾ƒ, å¹¶ä¸”è¿™æ˜¯ === ä¸­ç¼€æ“ä½œç¬¦çš„å®ç°æ–¹å¼ã€‚\n\u0026gt; \u0026quot;a\u0026quot;.WHICH Str|a WHO æ”¯æŒå¯¹è±¡çš„åŒ…\n\u0026gt; \u0026quot;a\u0026quot;.WHO Str WHERE å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚æ³¨æ„è¿™åœ¨ç§»åŠ¨çš„/ç´§å‡‘çš„åƒåœ¾å›æ”¶å®ç°ä¸­æ˜¯ä¸ç¨³å®šçš„ã€‚ åœ¨ç¨³å®šçš„åŒä¸€æŒ‡ç¤ºå™¨ä¸­ä½¿ç”¨ WHEREã€‚\nHOW å…ƒç±»å¯¹è±¡(the metaclass object)ï¼šâ€œHigher Order Workingsâ€ã€‚\nWHY é™„åŠ çš„ Pod å€¼ã€‚\nDEFINITE å¯¹è±¡æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„å¼ºåˆ¶è¡¨ç°ã€‚\nå¯¹äºå®ä¾‹è¿”å› True, å¯¹äºç±»å‹å¯¹è±¡è¿”å› Falseã€‚\n\u0026gt; 42.DEFINITE True \u0026gt; Int.DEFINITE False VAR è¿”å›åº•å±‚çš„ Scalar å¯¹è±¡, å¦‚æœæœ‰çš„è¯ã€‚\nå…ƒå¯¹è±¡ç³»ç»Ÿçš„ç»“æ„ å¯¹äºæ¯ä¸ªç±»å‹å£°æ˜ç¬¦å…³é”®å­—, ä¾‹å¦‚ classã€role ã€enumã€moduleã€packageã€grammar æˆ– subset, å°±æœ‰ä¸€ä¸ªç‹¬ç«‹çš„å…ƒç±»åœ¨ Matamodel:: å‘½åç©ºé—´ä¸­ã€‚(Rakudo åœ¨ Raku::Metamodel:: å‘½åç©ºé—´ä¸­å®ç°äº†å®ƒä»¬, ç„¶åæŠŠ Raku::Metamodel æ˜ å°„åˆ° Metamodel)ã€‚\nè¿™äº›å…ƒç±»(meta classes)ä¸­çš„å¾ˆå¤šéƒ½å…±äº«å…¬å…±çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ rolesã€grammars å’Œ classes(ç±»)éƒ½èƒ½åŒ…æ‹¬æ–¹æ³•å’Œå±æ€§, è¿˜èƒ½éµå®ˆ rolesã€‚è¿™ä¸ªå…±äº«çš„åŠŸèƒ½æ˜¯åœ¨ roles ä¸­å®ç°çš„, å®ƒè¢«ç»„åˆè¿›åˆé€‚çš„å…ƒç±»ä¸­ã€‚ä¾‹å¦‚ role Metamodel::RoleContainerå®ç°äº†ç±»å‹èƒ½å¤„ç† roles å’Œ Metamodel::ClassHOW çš„åŠŸèƒ½, å®ƒæ˜¯åœ¨ class å…³é”®å­—åé¢çš„å…ƒç±», éµå®ˆäº†è¿™ä¸ª roleã€‚\nBootstrapping concerns ä½ å¯èƒ½æƒ³çŸ¥é“ä¸ºä»€ä¹ˆ Metamodel::ClassHOW å¯ä»¥æ˜¯ä¸€ä¸ªç±», å½“æŒ‰ç…§ Metamodel::ClassHOW ä½œä¸ºä¸€ä¸ªç±»è¢«å®šä¹‰æ—¶, æˆ–è€… roles è´Ÿè´£ role å¤„ç†çš„æ€ä¹ˆèƒ½æ˜¯ rolesã€‚ç­”æ¡ˆæ˜¯é€šè¿‡é­”æ³•ã€‚\nå¼€ç©ç¬‘å•¦ã€‚è‡ªä¸¾æ˜¯ç‰¹åˆ«å®ç°çš„ã€‚Rakudo ä½¿ç”¨è¯­è¨€çš„å¯¹è±¡ç³»ç»Ÿæ¥å®ç°è‡ªä¸¾, å®ƒæ°å¥½(å‡ ä¹)å°±æ˜¯ Raku çš„ä¸€ä¸ªå­é›†: NQP, Not Quite Perlã€‚ NQP æœ‰åŸå§‹çš„, class-like å«åš konwhow çš„æ€§è´¨, å®ƒç”¨äºè‡ªä¸¾å®ƒè‡ªå·±çš„ç±»å’Œ roles å®ç°ã€‚konwhow å»ºç«‹åœ¨NQP æä¾›çš„è™šæ‹Ÿæœºçš„åŸå§‹åŸºç¡€ä¸Šã€‚\nå› ä¸ºå…ƒå¯¹è±¡æ˜¯æ ¹æ®ä½çº§(low-level)ç±»å‹å¼•å¯¼çš„, è‡ªçœæœ‰æ—¶èƒ½è¿”å›ä½çº§(low-level)ç±»å‹è€Œéä½ æœŸæœ›çš„é‚£ä¸ªç±»å‹, ä¾‹å¦‚è¿”å›ä¸€ä¸ª NQP-level çš„å­ä¾‹ç¨‹è€Œéæ™®é€šçš„ Routine å¯¹è±¡, æˆ–è¿”å›ä¸€ä¸ªå¼•å¯¼çš„å±æ€§è€ŒéAttributeã€‚\nç»„åˆå’Œé™æ€æ¨ç† åœ¨ Rakuä¸­, ç±»å‹æ˜¯åœ¨è§£ææ—¶è¢«æ„é€ çš„, æ‰€ä»¥åœ¨å¼€å§‹, å®ƒå¿…é¡»æ˜¯å¯å˜çš„ã€‚ç„¶è€Œ, å¦‚æœæ‰€æœ‰ç±»å‹ä¸€ç›´æ˜¯å¯å˜çš„, é‚£ä¹ˆå…³äºç±»å‹çš„æ‰€æœ‰æ¨æ–­ä¼šåœ¨ä»»ä½•ç±»å‹çš„ä¿®æ”¹æ—¶å˜å¾—æ— æ•ˆã€‚ä¾‹å¦‚çˆ¶ç±»çš„åˆ—è¡¨å› æ­¤ç±»å‹æ£€æµ‹çš„ç»“æœèƒ½åœ¨é‚£ä¸ªæ—¶å€™æ”¹å˜ã€‚\næ‰€ä»¥ä¸ºäº†è·å¾—è¿™ä¸¤ä¸ªä¸–ç•Œä¸­æœ€å¥½çš„ä¸œè¥¿, å½“ç±»å‹ä»å¯å˜è½¬ä¸ºä¸å¯å˜æ—¶æ˜¯å¥½æ—¶æœºã€‚è¿™å°±å«åšç»„åˆ, å¹¶ä¸”å¯¹äºä»å¥æ³•æ„æˆä¸Šå£°æ˜çš„ç±»å‹, å®ƒå‘ç”Ÿåœ¨ç±»å‹å£°æ˜è¢«å®Œå…¨è§£ææ—¶(æ‰€ä»¥æ€»æ˜¯åœ¨é—­åˆèŠ±æ‹¬å·è¢«è§£ææ—¶)ã€‚\nå¦‚æœä½ é€šè¿‡å…ƒå¯¹è±¡ç³»ç»Ÿç›´æ¥åˆ›å»ºç±»å‹, ä½ å¿…é¡»è¦åœ¨å®ƒä»¬èº«ä¸Šè°ƒç”¨ .^compose, åœ¨å®ƒä»¬å˜å¾—å®Œå…¨èµ·ä½œç”¨ä¹‹å‰ã€‚\nå¾ˆå¤šå…ƒç±»ä¹Ÿä½¿ç”¨ç»„åˆæ—¶æ¥è®¡ç®—ä¸€äº›è¯¸å¦‚æ–¹æ³•è§£æé¡ºåºè¿™æ ·çš„å±æ€§, å‘å¸ƒä¸€ä¸ªæ–¹æ³•ç¼“å­˜, å’Œå…¶å®ƒæ¸…æ‰«ä»»åŠ¡ã€‚åœ¨å®ƒä»¬è¢«ç»„åˆä¹‹åå¹²é¢„ç±»å‹æœ‰æ—¶æ˜¯å¯èƒ½çš„, ä½†é€šå¸¸æ˜¯é€ æˆç¾éš¾çš„å› ç´ ã€‚ ä¸è¦é‚£æ ·åšã€‚\nèƒ½åŠ›å’Œè´£ä»» å…ƒå¯¹è±¡åè®®æä¾›äº†å¾ˆå¤šå¸¸è§„ Raku ä»£ç æ•…æ„é™åˆ¶äº†çš„èƒ½åŠ›, ä¾‹å¦‚è°ƒç”¨ç±»ä¸­ä¸ä¿¡ä»»ä½ çš„ç§æœ‰æ–¹æ³•, çª¥æ¢ç§æœ‰å±æ€§, å’Œå…¶å®ƒé€šå¸¸ä¸èƒ½å®Œæˆçš„ä¸œè¥¿ã€‚\nå¸¸è§„çš„ Raku ä»£ç æœ‰å¾ˆå¤šå°±åœ°çš„å®‰å…¨æ£€æµ‹; å…ƒæ¨¡å‹ä¸­ä¸æ˜¯è¿™æ ·ï¼Œå®ƒé è¿‘åº•å±‚çš„è™šæ‹Ÿæœº, è¿åå’Œè™šæ‹Ÿæœºçš„çº¦å®šå¯ä»¥å¯¼è‡´æ‰€æœ‰å¥‡æ€ªçš„è¡Œä¸º, è€Œåœ¨æ­£å¸¸ä»£ç ä¸­, æ˜¾è€Œæ˜“è§çš„ä¼šæ˜¯ bugsã€‚\næ‰€ä»¥, åœ¨å†™å…ƒç±»å‹çš„æ—¶å€™è¦æ ¼å¤–å°å¿ƒå’Œæ€è€ƒã€‚\nèƒ½åŠ›ã€ä¾¿åˆ©å’Œé™·é˜± å…ƒå¯¹è±¡åè®®è¢«è®¾è®¡çš„å¼ºå¤§åˆ°å®ç° Raku çš„å¯¹è±¡ç³»ç»Ÿã€‚è¿™ç§èƒ½åŠ›é—´æˆ–èŠ±è´¹äº†ä¾¿åˆ©çš„ä»£ä»·ã€‚\nä¾‹å¦‚, å½“ä½ å†™äº† my $x = 42 å¹¶åœ¨ $xä¸Šè°ƒç”¨æ–¹æ³•æ—¶, å¤§éƒ¨åˆ†æ–¹æ³•ä¼šåœ¨æ•´æ•° 42 ä¸Šèµ·ä½œç”¨, è€Œä¸æ˜¯åœ¨å­˜å‚¨ 42 çš„æ ‡é‡å®¹å™¨ä¸Šã€‚è¿™æ˜¯ Rakuä¸­è®¾ç«‹çš„ä¸€å—ä¾¿åˆ©ã€‚å…ƒå¯¹è±¡åè®®ä¸­çš„å¤§éƒ¨åˆ†ä¸èƒ½æä¾›è‡ªåŠ¨å¿½ç•¥æ ‡é‡å®¹å™¨çš„ä¾¿åˆ©æ€§, å› ä¸ºå®ƒä»¬ä¹Ÿç”¨äºå®ç°é‚£äº›æ ‡é‡å®¹å™¨ã€‚ æ‰€ä»¥, å¦‚æœä½ å†™äº† my $t = MyType; ... $t.^compose, é‚£ä¹ˆä½ æ­£ç»„åˆé‚£ä¸ª $ å˜é‡è¡¨æ˜çš„æ ‡é‡, è€Œä¸æ˜¯ MyTypeã€‚\nç»“æœå°±æ˜¯ä½ éœ€è¦å¾ˆè¯¦å°½çš„ç†è§£ Raku çš„åº•å±‚ä»¥é¿å…é™·é˜±, å½“ä½¿ç”¨ MOP æ—¶, å¹¶ä¸”ä¸èƒ½æœŸæœ›å¾—åˆ°å’Œæ™®é€š Raku ä»£ç æä¾›çš„ \u0026ldquo;do what I mean\u0026rdquo; çš„ä¾¿åˆ©ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2015-07-16-metaobject-in-raku/","tags":["meta object"],"title":"Raku ä¸­çš„å…ƒå¯¹è±¡"},{"categories":["rakulang"],"contents":"Raku å•è¡Œç¨‹åº è¿™æœ¬ä¹¦åœ¨è¿›è¡Œä¹‹ä¸­ã€‚æˆ‘å¸Œæœ›ä½ èƒ½è§‰å¾—å®ƒæœ‰è¶£ï¼Œç”šè‡³å¯èƒ½æœ‰ç”¨ï¼å¦‚æœä½ æƒ³è´¡çŒ®åé¦ˆçš„è¯ï¼Œé‚£ä¹ˆå¾ˆæ¬¢è¿æé—®é¢˜è¿˜æœ‰æ–°çš„æˆ–æœ‰æå‡çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚\nä½œè€… æˆ´ç»´æ³•ç‘å°” PerlTricks.com\nç‰ˆæœ¬ ç‰ˆæœ¬ 0.01\nè®¸å¯ FreeBSD\nè´¡çŒ®è€…  Alexander Moquin Bruce Gray Carl MÃ¤sak David H. Adler FROGGS Helmut Wollmersdorfer japhb Larry Wall Matt Oates Moritz Lenz Mouq Salve J Nilsen Sam S Skids timotimo  è‡´è°¢ å¯å‘äº Peteris Krumins çš„ Perl 5 example æ–‡ä»¶ã€‚ä»–é€å­—é€å¥åœ°å†™äº†ä¸€æœ¬å…³äº Perl 5 å•è¡Œ çš„ä¹¦ã€‚\nircä¸Šæœ‰å¾ˆå¥½åœ° folksã€‚\nå†…å®¹  ä»‹ç» æ•™ç¨‹ æ–‡ä»¶é—´è· è¡Œå· è®¡ç®— åˆ›å»ºå­—ç¬¦ä¸²å’Œåˆ›å»ºæ•°ç»„ æ–‡æœ¬è½¬æ¢å’Œæ›¿æ¢ æ–‡æœ¬åˆ†æ é€‰æ‹©æ€§çš„è¡Œæ‰“å° ä½¿ç”¨ç®¡é“è½¬æ¢æ•°æ®(è¿›è¡Œä¸­) WWW(è¿›è¡Œä¸­) è½¬æ¢åˆ° Windows  ä»‹ç» æŠŠ Perl å’Œå…¶å®ƒè¯­è¨€åŒºåˆ«å¼€çš„ä¸€ä»¶äº‹æƒ…æ˜¯åœ¨å•è¡Œä»£ç ä¸­å†™å°ç¨‹åºçš„èƒ½åŠ›ï¼Œå³äººä»¬æ‰€ç†ŸçŸ¥çš„\u0026quot;å•è¡Œ\u0026quot;ã€‚åœ¨ç»ˆç«¯é‡Œç›´æ¥é”®å…¥ä¸€ä¸ªç¨‹åºæ¯”å†™ä¸€ä¸ªåºŸå¼ƒçš„è„šæœ¬å¾€å¾€æ›´å¿«ã€‚å¹¶ä¸”å•è¡Œç¨‹åºä¹Ÿå¾ˆå¼ºå¤§ï¼›å®ƒä»¬æ˜¯ç¾½ç¿¼ä¸°æ»¡çš„ç¨‹åºï¼Œèƒ½å¤ŸåŠ è½½å¤–éƒ¨åº“ï¼Œä½†æ˜¯ä¹Ÿèƒ½é›†æˆåˆ°ç»ˆç«¯ä¸­ã€‚ä½ å¯ä»¥åœ¨å•è¡Œç¨‹åºä¸­è¾“å…¥æˆ–è¾“å‡ºæ•°æ®ã€‚\nåƒ Perl 5 ä¸€æ ·ï¼Œ Rakuæ”¯æŒå•è¡Œç¨‹åºã€‚è¿˜æœ‰å°±åƒ Raku åˆ°å¤„æ¸…ç†ç€ Perl 5 çš„æ¯’ç˜¤ä¸€æ ·ï¼ŒRaku çš„å•è¡Œè¯­æ³•ä¹Ÿæ›´å¥½äº†ã€‚å®ƒæ‹¥æœ‰æ›´å°‘çš„ç‰¹æ®Šå˜é‡å’Œé€‰é¡¹å› æ­¤æ›´å®¹æ˜“è®°å¿†ã€‚è¿™æœ¬ä¹¦æä¾›äº†å¾ˆå¤šæœ‰ç”¨çš„ Raku å•è¡Œä¾‹å­ï¼Œä»æ‰¾å‡ºæ–‡ä»¶ä¸­å¾—é‡å¤è¡Œåˆ°è¿è¡Œä¸€ä¸ª web æœåŠ¡å™¨ï¼Œå®ƒå‡ ä¹èƒ½åšæ‰€æœ‰äº‹æƒ…ã€‚å°½ç®¡ Raku æ‹¥æœ‰æ›´å°‘çš„ç‰¹æ®Šå˜é‡ï¼Œä½†æ˜¯ç”±äºå®ƒé«˜çº§çš„é¢å‘å¯¹è±¡çš„è¯­æ³•ï¼ŒRaku ä¸­çš„å¤§éƒ¨åˆ†å•è¡Œç¨‹åºæ¯”ç­‰ä»·çš„ Perl 5 å•è¡Œç¨‹åºæ›´çŸ­ã€‚\nè¿™æœ¬ä¹¦å¯ä»¥ä»¥å¤šç§æ–¹å¼é˜…è¯»ã€‚å¦‚æœä½ æ˜¯å•è¡Œç¨‹åºçš„æ–°æ‰‹ï¼Œä»æ•™ç¨‹å¼€å§‹ã€‚å®ƒå¸¦é¢†ä½ æŒæ¡å•è¡Œç¨‹åºçš„æ ¸å¿ƒæ¦‚å¿µï¼›ä¸è¦æ‹…å¿ƒï¼Œä¸€æ—¦ä½ ç†è§£äº†å®ƒä¼šå¾ˆå®¹æ˜“ã€‚å¦‚æœä½ ç²¾é€š Perlï¼ŒBashï¼Œæˆ– Sed/Awkï¼Œä½ å¯ä»¥ç«‹é©¬å¼€å§‹å·¥ä½œã€‚éšæ„è·³è¿‡å’Œæµè§ˆä½ æ‰€æ„Ÿå…´è¶£çš„ä¸œè¥¿ã€‚å¦‚æœæœ‰äº›ä»£ç ä½ ä¸ç†è§£ï¼Œé‚£ä¹ˆåœ¨ç»ˆç«¯ä¸­è¯•è¯•ï¼è¿™ä¸ªä»“åº“ä¸­åŒ…å«çš„æ— å¤„ä¸åœ¨çš„æ–‡ä»¶æ˜¯ example.txtï¼Œå®ƒä¼šåœ¨å¾ˆå¤šå•è¡Œç¨‹åºä¸­ç”¨åˆ°ã€‚\nä½¿ç”¨å•è¡Œç¼–ç¨‹ä»…ä»…æ˜¯ Raku æ“…é•¿çš„ä¸€ä¸ªèŒƒä¾‹ã€‚è¿™æ ·çš„ä»£ç å°è€Œç¾ï¼Œä½†æ˜¯åŒæ—¶ä½ æ­£å­¦ä¹ çš„æ˜¯ä¸€ç§ç”Ÿäº§åŠ›æŠ€èƒ½ï¼Œè®°ä½ä½ æ­£åœ¨å­¦çš„æ˜¯ä¸€ç§æ–°çš„ç¼–ç¨‹è¯­è¨€ã€‚æ£€æŸ¥ raku.org ç½‘ç«™è·å–å®˜æ–¹æ–‡æ¡£ã€‚\næ•™ç¨‹ è¦å¼€å§‹å•è¡Œç¨‹åºï¼Œæ‰€æœ‰ä½ è¦æŒæ¡çš„æ˜¯ -e é€‰é¡¹ã€‚è¿™å‘Šè¯‰ Perl æŠŠå®ƒåé¢æ‰€è·Ÿçš„ä¸œè¥¿ä½œä¸ºä¸€ä¸ªç¨‹åºå»æ‰§è¡Œã€‚ä¾‹å¦‚ï¼š\nraku -e \u0026#39;say \u0026#34;Hello, World!\u0026#34;\u0026#39; æˆ‘ä»¬æ¥ä¸€æ­¥æ­¥å‰–æè¿™æ®µä»£ç ã€‚ raku å¼•ç”¨äº† Raku ç¨‹åºï¼Œ -e å‘Šè¯‰ Raku å»æ‰§è¡Œï¼Œè€Œ 'say \u0026quot;Hello, World!\u0026quot;'æ˜¯è¦æ‰§è¡Œçš„ç¨‹åºã€‚æ¯ä¸ªç¨‹åºéƒ½å¿…é¡»è¢«åŒ…å›´åœ¨å•å¼•å·ä¸­ï¼ˆé™¤äº†åœ¨ Windows ä¸Šï¼ŒæŸ¥çœ‹ è½¬æ¢åˆ° Windowsï¼‰ã€‚è¦è¿è¡Œå•è¡Œç¨‹åºï¼Œå°±æŠŠå®ƒé”®å…¥åˆ°ç»ˆç«¯ä¸­å¥½äº†ï¼š\n\u0026gt; raku -e 'say \u0026quot;Hello, World!\u0026quot;' Hello, World! å¦‚æœä½ æƒ³åŠ è½½ä¸€ä¸ªæ–‡ä»¶ï¼Œå°±æŠŠæ–‡ä»¶è·¯å¾„æ·»åŠ åˆ°ç¨‹åºä»£ç çš„åé¢ï¼š\nraku -e \u0026#39;for (lines) {say $_}\u0026#39; /path/to/file.txt è¿™ä¸ªç¨‹åºæ‰“å°å‡ºäº† path/to/file.txt çš„æ¯ä¸€è¡Œã€‚ä½ å¯èƒ½çŸ¥é“ $_ æ˜¯é»˜è®¤å˜é‡ï¼Œå®ƒåœ¨è¿™å„¿æ˜¯æŒ‡æ­£è¢«å¾ªç¯çš„å½“å‰è¡Œã€‚lines æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå½“ä½ ä¼ é€’ä¸€ä¸ªæ–‡ä»¶è·¯å¾„ç»™å•è¡Œç¨‹åºçš„æ—¶å€™ä¼šè‡ªåŠ¨ä¸ºä½ åˆ›å»ºè¿™ä¸ªåˆ—è¡¨ã€‚ç°åœ¨æˆ‘ä»¬æ¥é‡å†™é‚£ä¸ªå•è¡Œç¨‹åºï¼Œä¸€æ­¥ä¸€æ­¥ã€‚å®ƒä»¬éƒ½æ˜¯ç­‰ä»·çš„ï¼š\nraku -e \u0026#39;for (lines) { say $_ }\u0026#39; /path/to/file.txt raku -e \u0026#39;for (lines) { $_.say }\u0026#39; /path/to/file.txt raku -e \u0026#39;for (lines) { .say }\u0026#39; /path/to/file.txt raku -e \u0026#39;.say for (lines)\u0026#39; /path/to/file.txt raku -e \u0026#39;.say for lines\u0026#39; /path/to/file.txt å°±åƒ $_ æ˜¯é»˜è®¤å˜é‡ä¸€æ ·ï¼Œåœ¨é»˜è®¤å˜é‡èº«ä¸Šè°ƒç”¨çš„æ–¹æ³•å¯ä»¥çœç•¥æ‰å˜é‡å¼•ç”¨ã€‚å®ƒä»¬å˜æˆäº†é»˜è®¤æ–¹æ³•ã€‚æ‰€ä»¥ $_.say å˜æˆ .sayã€‚å›æŠ¥ç»™å†™å•è¡Œç¨‹åºçš„äººçš„ä¸œè¥¿æ˜¯ - æ›´å°‘çš„é”®å…¥ï¼\n-n é€‰é¡¹æ”¹å˜äº†ç¨‹åºçš„è¡Œä¸ºï¼šå®ƒä¸ºæ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œæ‰§è¡Œä¸€æ¬¡ä»£ç ã€‚æ‰€ä»¥ï¼Œå¤§å†™å¹¶æ‰“å° path/to/file.txt çš„æ¯ä¸€è¡Œä½ ä¼šé”®å…¥ï¼š\nraku -ne \u0026#39;.uc.say\u0026#39; /path/to/file.txt -p é€‰é¡¹å°±åƒ -n, é™¤äº†å®ƒä¼šè‡ªåŠ¨æ‰“å° $_ ä¹‹å¤–ã€‚æ‰€ä»¥å¤§å†™æ–‡ä»¶ä¸­çš„æ‰€æœ‰è¡Œçš„å¦å¤–ä¸€ç§æ–¹æ³•æ˜¯ï¼š\nraku -pe \u0026#39;$_ = .uc\u0026#39; /path/to/file.txt æˆ–è€…ä¸¤ä¸ªåšåŒæ ·äº‹æƒ…çš„æ›´çŸ­çš„ç‰ˆæœ¬ï¼š\nraku -pe \u0026#39;.=uc\u0026#39; /path/to/file.txt raku -pe .=uc /path/to/file.txt åœ¨ç¬¬äºŒä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å®Œå…¨ç§»é™¤å‘¨å›´çš„å•å¼•å·ã€‚è¿™ç§åœºæ™¯å¾ˆå°‘é‡åˆ°ï¼Œä½†æ˜¯å¦‚æœä½ çš„å•è¡Œç¨‹åºä¸­æ²¡æœ‰ç©ºæ ¼å¹¶ä¸”æ²¡æœ‰ç¬¦å·æˆ–å¼•å·ï¼Œé‚£ä¹ˆä½ é€šå¸¸å¯ä»¥ç§»é™¤å¤–éƒ¨çš„å¼•å·ã€‚\n-n å’Œ -p é€‰é¡¹çœŸçš„å¾ˆæœ‰ç”¨ã€‚æœ¬ä¹¦ä¸­ä¹Ÿæœ‰å¾ˆå¤šä½¿ç”¨å®ƒä»¬çš„å•è¡Œä¾‹å­ã€‚\næœ€åä¸€ä»¶ä½ è¦çŸ¥é“çš„äº‹æƒ…æ˜¯æ€ä¹ˆåŠ è½½æ¨¡å—ã€‚ -M å¼€å…³ä»£è¡¨ç€åŠ è½½æ¨¡å—ï¼š\nraku -M URI::Encode -e \u0026#39;say encode_uri(\u0026#34;example.com/10 ways to crush it with Raku\u0026#34;)\u0026#39; -M URI::Encode åŠ è½½äº† URI::Encode æ¨¡å—ï¼Œå®ƒå¯¼å…¥äº† encode_uri å­ä¾‹ç¨‹ã€‚ ä½ å¯ä»¥å¤šæ¬¡ä½¿ç”¨ -M æ¥åŠ è½½å¤šä¸ªæ¨¡å—ï¼š\nraku -M URI::Encode -M URI -e \u0026#39;\u0026lt;your code here\u0026gt;\u0026#39; å¦‚æœä½ æœ‰ä¸€ä¸ªè¿˜æ²¡æœ‰å®‰è£…çš„æœ¬åœ°æ¨¡å—å‘¢ï¼Ÿ ç®€å•ï¼Œ ä»…ä»…ä¼ é€’ä¸€ä¸ª -I å¼€å…³æ¥åŒ…å«é‚£ä¸ªç›®å½•å¥½äº†ï¼š\nraku -I lib -M URI::Encode -e \u0026#39;\u0026lt;your code here\u0026gt;\u0026#39; ç°åœ¨ Raku ä¼šåœ¨ lib ç›®å½•ä¸­æœç´¢ URI::Encode æ¨¡å—ï¼Œå’Œæ ‡å‡†çš„å®‰è£…ä½ç½®ä¸€æ ·ã€‚\nè¦æŸ¥çœ‹ Raku å‘½ä»¤è¡Œå¼€å…³æœ‰å“ªäº›ï¼Œ ä½¿ç”¨ -h é€‰é¡¹æŸ¥çœ‹å¸®åŠ©ï¼š\nraku -h è¿™æ‰“å°å¯è·å¾—çš„ä¸é”™çš„ç»Ÿè®¡ã€‚\næ–‡ä»¶é—´è· Double space a file\nraku -pe \u0026#39;$_ ~= \u0026#34;\\n\u0026#34;\u0026#39; example.txt N-space a file (ä¾‹å¦‚. 4å€ç©ºç™½)\nraku -pe \u0026#39;$_ ~= \u0026#34;\\n\u0026#34; x 4\u0026#39; example.txt åœ¨æ¯ä¸€è¡Œå‰é¢æ·»åŠ ä¸€ä¸ªç©ºè¡Œï¼š\nraku -pe \u0026#39;say \u0026#34;\u0026#34;\u0026#39; example.txt ç§»é™¤æ‰€æœ‰ç©ºè¡Œï¼š\nraku -ne \u0026#39;.say if /\\S/\u0026#39; example.txt raku -ne \u0026#39;.say if .chars\u0026#39; example.txt ç§»é™¤æ‰€æœ‰çš„è¿ç»­ç©ºç™½è¡Œï¼Œåªä¿ç•™ä¸€è¡Œï¼š\nraku -e \u0026#39;$*ARGFILES.slurp.subst(/\\n+/, \u0026#34;\\n\\n\u0026#34;, :g).say\u0026#39; example.txt è¡Œå· ç»™æ–‡ä»¶ä¸­çš„æ‰€æœ‰è¡Œç¼–å·ï¼š\nraku -ne \u0026#39;say \u0026#34;{++$} $_\u0026#34;\u0026#39; example.txt raku -ne \u0026#39;say $*ARGFILES.ins ~ \u0026#34; $_ \u0026#34;\u0026#39; example.txt åªç»™æ–‡ä»¶ä¸­å¾—éç©ºè¡Œç¼–å·ï¼š\nraku -pe \u0026#39;$_ = \u0026#34;{++$} $_\u0026#34; if /\\S/\u0026#39; example.txt ç»™æ‰€æœ‰è¡Œç¼–å·ä½†æ˜¯åªæ‰“å°éç©ºè¡Œï¼š\nraku -pe \u0026#39;$_ = $*ARGFILES.ins ~ \u0026#34; $_ \u0026#34; if /\\S/\u0026#39; example.txt æ‰“å°æ–‡ä»¶ä¸­è¡Œæ•°çš„æ€»æ•°ï¼š\nraku -e \u0026#39;say lines.elems\u0026#39; example.txt raku -e \u0026#39;say lines.Int\u0026#39; example.txt raku -e \u0026#39;lines.Int.say\u0026#39; example.txt æ‰“å°å‡ºæ–‡ä»¶ä¸­éç©ºè¡Œçš„æ€»æ•°ï¼š\nraku -e \u0026#39;lines.grep(/\\S/.elems.say)\u0026#39; example.txt æ‰“å°æ–‡ä»¶ä¸­ç©ºè¡Œçš„æ•°é‡ï¼š\nraku -e \u0026#39;lines.grep(/^\\s*$/).elems.say\u0026#39; example.txt è®¡ç®— æ£€æŸ¥ä¸€ä¸ªæ•°æ˜¯å¦æ˜¯è´¨æ•°ï¼š\nraku -e \u0026#39;say \u0026#34;7 is prime\u0026#34; if 7.is-prime\u0026#39; æ‰“å°ä¸€è¡Œä¸­æ‰€æœ‰å­—æ®µçš„å’Œï¼š\nraku -ne \u0026#39;say [+] .split(\u0026#34;\\t\u0026#34;)\u0026#39; æ‰“å°æ‰€æœ‰è¡Œçš„æ‰€æœ‰å­—æ®µçš„å’Œï¼š\nraku -e \u0026#39;say [+] lines.split(\u0026#34;\\t\u0026#34;)\u0026#39; æ‰“ä¹±è¡Œä¸­çš„æ‰€æœ‰å­—æ®µï¼š\nraku -ne \u0026#39;.split(\u0026#34;\\t\u0026#34;).pick(*).join(\u0026#34;\\t\u0026#34;).say\u0026#39; æ‰¾å‡ºä¸€è¡Œä¸­æœ€å°çš„å…ƒç´ ï¼š\nraku -ne \u0026#39;.split(\u0026#34;\\t\u0026#34;).min.say\u0026#39; æ‰¾å‡ºæ‰€æœ‰è¡Œçš„æœ€å°çš„å…ƒç´ ï¼š\nraku -e \u0026#39;lines.split(\u0026#34;\\t\u0026#34;).min.say\u0026#39; æ‰¾å‡ºä¸€è¡Œä¸­æœ€å¤§çš„å…ƒç´ ï¼š\nraku -ne \u0026#39;.split(\u0026#34;\\t\u0026#34;).max.say\u0026#39; æ‰¾å‡ºæ‰€æœ‰è¡Œçš„æœ€å¤§çš„å…ƒç´ ï¼š\nraku -e \u0026#39;lines.split(\u0026#34;\\t\u0026#34;).max.say\u0026#39; æ‰¾å‡ºä¸€è¡Œä¸­å¾—æ•°å€¼åŒ–æœ€å°å…ƒç´ ï¼š\nraku -ne \u0026#39;.split(\u0026#34;\\t\u0026#34;)Â».Numeric.min.say\u0026#39; æ‰¾å‡ºä¸€è¡Œä¸­å¾—æ•°å€¼åŒ–æœ€å¤§å…ƒç´ ï¼š\nraku -ne \u0026#39;.split(\u0026#34;\\t\u0026#34;)Â».Numeric.max.say\u0026#39; ä½¿ç”¨å­—æ®µçš„ç»å¯¹å€¼æ›¿æ¢æ¯ä¸ªå­—æ®µï¼š\nraku -ne \u0026#39;.split(\u0026#34;\\t\u0026#34;).map(*.abs).join(\u0026#34;\\t\u0026#34;)\u0026#39; æ‰¾å‡ºæ¯è¡Œä¸­å­—ç¬¦çš„æ€»æ•°ï¼š\nraku -ne \u0026#39;.chars.say\u0026#39; example.txt æ‰¾å‡ºæ¯è¡Œä¸­å•è¯çš„æ€»æ•°ï¼š\nraku -ne \u0026#39;.words.elems.say\u0026#39; example.txt æ‰¾å‡ºæ¯è¡Œä¸­ç”±é€—å·åˆ†éš”çš„å…ƒç´ çš„æ€»æ•°ï¼š\nraku -ne \u0026#39;.split(\u0026#34;,\u0026#34;).elems.say\u0026#39; example.txt æ‰¾å‡ºæ‰€æœ‰è¡Œçš„å­—æ®µï¼ˆå•è¯ï¼‰çš„æ€»æ•°ï¼š\nraku -e \u0026#39;say lines.split(\u0026#34;\\t\u0026#34;).elems\u0026#39; example.txt # fields raku -e \u0026#39;say lines.words.elems\u0026#39; example.txt # words æ‰“å°åŒ¹é…æŸä¸ªæ¨¡å¼çš„å­—æ®µçš„æ€»æ•°ï¼š\nraku -e \u0026#39;say lines.split(\u0026#34;\\t\u0026#34;).comb(/pattern/).elems\u0026#39; example.txt # fields raku -e \u0026#39;say lines.words.comb(/pattern/).elems\u0026#39; example.txt # words æ‰“å°åŒ¹é…æŸä¸ªæ¨¡å¼çš„è¡Œçš„æ€»æ•°ï¼š\nraku -e \u0026#39;say lines.grep(/in/.elems)\u0026#39; example.txt æ‰“å°æ•°å­— PI åˆ° n ä½å°æ•°ç‚¹(ä¾‹å¦‚. 10ä½)ï¼š\nraku -e \u0026#39;say pi.fmt(\u0026#34;%.10f\u0026#34;);\u0026#39; æ‰“å°æ•°å­— PI åˆ° 15 ä½å°æ•°ç‚¹ï¼š\nraku -e \u0026#39;say Ï€\u0026#39; æ‰“å°æ•°å­— E åˆ° n ä½å°æ•°ç‚¹(ä¾‹å¦‚. 10ä½)ï¼š\nraku -e \u0026#39;say e.fmt(\u0026#34;%.10f\u0026#34;);\u0026#39; æ‰“å°æ•°å­— E åˆ° 15 ä½å°æ•°ç‚¹ï¼š\nraku -e \u0026#39;say e\u0026#39; æ‰“å° UNIX æ—¶é—´ (seconds since Jan 1, 1970, 00:00:00 UTC)\nraku -e \u0026#39;say time\u0026#39; æ‰“å° GMT (æ ¼æ—å¨æ²»æ ‡å‡†æ—¶é—´)å’Œåœ°æ–¹è®¡ç®—æœºæ—¶é—´ï¼š\nraku -MDateTime::TimeZone -e \u0026#39;say to-timezone(\u0026#34;GMT\u0026#34;,DateTime.now)\u0026#39; raku -e \u0026#39;say DateTime.now\u0026#39; ä»¥ H:M:S æ ¼å¼æ‰“å°å½“åœ°è®¡ç®—æœºæ—¶é—´ï¼š\nraku -e \u0026#39;say DateTime.now.map({$_.hour, $_.minute, $_.second.round}).join(\u0026#34;:\u0026#34;)\u0026#39; æ‰“å°æ˜¨å¤©çš„æ—¥æœŸï¼š\nraku -e \u0026#39;say DateTime.now.earlier(:1day)\u0026#39; æ‰“å°æ—¥æœŸï¼š 14 ä¸ªæœˆ, 9 å¤©ï¼Œå’Œ 7 ç§’ä¹‹å‰\nraku -e \u0026#39;say DateTime.now.earlier(:14months).earlier(:9days).earlier(:7seconds)\u0026#39; åœ¨æ ‡å‡†è¾“å‡ºå‰åŠ ä¸Šæ—¶é—´æˆ³ï¼ˆGMTï¼Œåœ°æ–¹æ—¶é—´ï¼‰ï¼š\ntail -f logfile | raku -MDateTime::TimeZone -ne \u0026#39;say to-timezone(\u0026#34;GMT\u0026#34;,DateTime.now) ~ \u0026#34;\\t$_\u0026#34;\u0026#39; tail -f logfile | raku -ne \u0026#39;say DateTime.now ~ \u0026#34;\\t$_\u0026#34;\u0026#39; è®¡ç®— 5 çš„é˜¶ä¹˜ï¼š\nraku -e \u0026#39;say [*] 1..5\u0026#39; è®¡ç®—æœ€å¤§å…¬çº¦æ•°ï¼š\nraku -e \u0026#39;say [gcd] @list_of_numbers\u0026#39; ä½¿ç”¨æ¬§å‡ é‡Œå¾—ç®—æ³•è®¡ç®—æ•°å­— 20 å’Œ 35 çš„æœ€å¤§å…¬çº¦æ•°ï¼š\nraku -e \u0026#39;say (20, 35, *%* ... 0)[*-2]\u0026#39; è®¡ç®— 20 å’Œ 35 çš„æœ€å°å…¬å€æ•°ï¼š\nraku -e \u0026#39;say 20 lcm 35\u0026#39; ä½¿ç”¨æ¬§å‡ é‡Œå¾—ç®—æ³•: n*m/gcd(n,m) è®¡ç®—æ•°å­— 20 å’Œ 35 çš„æœ€å°å…¬å€æ•°ï¼š\nraku -e \u0026#39;say 20 * 35 / (20 gcd 35)\u0026#39; ç”Ÿæˆ 10 ä¸ª 5 åˆ° 15ï¼ˆä¸åŒ…æ‹¬ 15ï¼‰ä¹‹é—´çš„éšæœºæ•°ï¼š\nraku -e \u0026#39;.say for (5..^15).roll(10)\u0026#39; æ‰¾å‡ºå¹¶æ‰“å°åˆ—è¡¨çš„å…¨æ’åˆ—ï¼š\nraku -e \u0026#39;say .join for [1..5].permutations\u0026#39; ç”Ÿæˆå¹‚é›†\nraku -e \u0026#39;.say for \u0026lt;1 2 3\u0026gt;.combinations\u0026#39; æŠŠ IP åœ°å€è½¬æ¢ä¸ºæ— ç¬¦å·æ•´æ•°ï¼š\nraku -e \u0026#39;say :256[\u0026#34;127.0.0.1\u0026#34;.comb(/\\d+/)]\u0026#39; raku -e \u0026#39;say +\u0026#34;:256[{q/127.0.0.1/.subst(:g,/\\./,q/,/)}]\u0026#34;\u0026#39; raku -e \u0026#39;say Buf.new(+Â«\u0026#34;127.0.0.1\u0026#34;.split(\u0026#34;.\u0026#34;)).unpack(\u0026#34;N\u0026#34;)\u0026#39; æŠŠæ— ç¬¦å·æ•´æ•°è½¬æ¢ä¸º IP åœ°å€ï¼š\nraku -e \u0026#39;say join \u0026#34;.\u0026#34;, @(pack \u0026#34;N\u0026#34;, 2130706433)\u0026#39; raku -e \u0026#39;say join \u0026#34;.\u0026#34;, map { ((2130706433+\u0026gt;(8*$_))+\u0026amp;0xFF) }, (3...0)\u0026#39; åˆ›å»ºå­—ç¬¦ä¸²å’Œåˆ›å»ºæ•°ç»„ ç”Ÿæˆå¹¶æ‰“å°å­—æ¯è¡¨ï¼š\nraku -e \u0026#39;.say for \u0026#34;a\u0026#34;..\u0026#34;z\u0026#34;\u0026#39; ç”Ÿæˆå¹¶æ‰“å°æ‰€æœ‰ä» \u0026ldquo;a\u0026rdquo; åˆ° \u0026ldquo;zz\u0026rdquo; çš„å­—ç¬¦ä¸²ï¼š\nraku -e \u0026#39;.say for \u0026#34;a\u0026#34;..\u0026#34;zz\u0026#34;\u0026#39; æŠŠæ•´æ•°è½¬æ¢ä¸ºåå…­è¿›åˆ¶ï¼š\nraku -e \u0026#39;say 255.base(16)\u0026#39; raku -e \u0026#39;say sprintf(\u0026#34;%x\u0026#34;, 255)\u0026#39; æŠŠæ•´æ•°æ‰“å°ä¸ºåå…­è¿›åˆ¶è½¬æ¢è¡¨ï¼š\nraku -e \u0026#39;say sprintf(\u0026#34;%3i =\u0026gt; %2x\u0026#34;, $_, $_) for 0..255\u0026#39; æŠŠæ•´æ•°ç¼–ç ä¸ºç™¾åˆ†æ•°ï¼š\nraku -e \u0026#39;say sprintf(\u0026#34;%%%x\u0026#34;, 255)\u0026#39; ç”Ÿæˆä¸€ä¸ªéšæœºçš„ 10 ä¸ª a-z å­—ç¬¦é•¿åº¦çš„å­—ç¬¦ä¸²ï¼š\nraku -e \u0026#39;print roll 10, \u0026#34;a\u0026#34;..\u0026#34;z\u0026#34;\u0026#39; raku -e \u0026#39;print roll \u0026#34;a\u0026#34;..\u0026#34;z\u0026#34;: 10\u0026#39; ç”Ÿæˆä¸€ä¸ªéšæœºçš„ 15 ä¸ª ASCII å­—ç¬¦é•¿åº¦çš„å¯†ç ï¼š\nraku -e \u0026#39;print roll 15, \u0026#34;0\u0026#34;..\u0026#34;z\u0026#34;\u0026#39; raku -e \u0026#39;print roll \u0026#34;0\u0026#34;..\u0026#34;z\u0026#34;: 15\u0026#39; åˆ›å»ºä¸€ä¸ªæŒ‡å®šé•¿åº¦çš„å­—ç¬¦ä¸²ï¼š\nraku -e \u0026#39;print \u0026#34;a\u0026#34; x 50\u0026#39; ç”Ÿæˆå¹¶æ‰“å°ä» 1 åˆ° 100 æ•°å­—ä¸ºå¶æ•°çš„æ•°ç»„ï¼š\nraku -e \u0026#39;(1..100).grep(* %% 2).say\u0026#39; æ‰¾å‡ºå­—ç¬¦ä¸²çš„é•¿åº¦ï¼š\nraku -e \u0026#39;\u0026#34;storm in a teacup\u0026#34;.chars.say\u0026#39; æ‰¾å‡ºæ•°ç»„çš„å…ƒç´ ä¸ªæ•°ï¼š\nraku -e \u0026#39;my @letters = \u0026#34;a\u0026#34;..\u0026#34;z\u0026#34;; @letters.Int.say\u0026#39; æ–‡æœ¬è½¬æ¢å’Œæ›¿æ¢ å¯¹æ–‡ä»¶è¿›è¡Œ ROT 13 åŠ å¯†ï¼š\nraku -pe \u0026#39;tr/A..Za..z/N..ZA..Mn..za..m/\u0026#39; example.txt å¯¹å­—ç¬¦ä¸²è¿›è¡Œ Base64 ç¼–ç ï¼š\nraku -MMIME::Base64 -ne \u0026#39;print MIME::Base64.encode-str($_)\u0026#39; example.txt å¯¹å­—ç¬¦ä¸²è¿›è¡Œ Base64 è§£ç ï¼š\nraku -MMIME::Base64 -ne \u0026#39;print MIME::Base64.decode-str($_)\u0026#39; base64.txt å¯¹å­—ç¬¦ä¸²è¿›è¡Œ URL è½¬ä¹‰ï¼š\nraku -MURI::Encode -le \u0026#39;say uri_encode($string)\u0026#39; URL-unescape a string\nraku -MURI::Encode -le \u0026#39;say uri_decode($string)\u0026#39; HTML-encode a string\nraku -MHTML::Entity -e \u0026#39;print encode-entities($string)\u0026#39; HTML-decode a string\nraku -MHTML::Entity -e \u0026#39;print decode-entities($string)\u0026#39; æŠŠæ‰€æœ‰æ–‡æœ¬è½¬æ¢ä¸ºå¤§å†™ï¼š\nraku -pe \u0026#39;.=uc\u0026#39; example.txt raku -ne \u0026#39;say .uc\u0026#39; example.txt æŠŠæ‰€æœ‰æ–‡æœ¬è½¬æ¢ä¸ºå°å†™ï¼š\nraku -pe \u0026#39;.=lc\u0026#39; example.txt raku -ne \u0026#39;say .lc\u0026#39; example.txt åªæŠŠæ¯è¡Œçš„ç¬¬ä¸€ä¸ªå•è¯è½¬æ¢ä¸ºå¤§å†™ï¼š\nraku -ne \u0026#39;say s/(\\w+){}/{$0.uc}/\u0026#39; example.txt é¢ å€’å­—æ¯çš„å¤§å°å†™ï¼š\nraku -pe \u0026#39;tr/a..zA..Z/A..Za..z/\u0026#39; example.txt raku -ne \u0026#39;say tr/a..zA..Z/A..Za..z/.after\u0026#39; example.txt å¯¹æ¯è¡Œè¿›è¡Œé©¼å³°å¼å¤§å°å†™ï¼š\nraku -ne \u0026#39;say .wordcase\u0026#39; example.txt åœ¨æ¯è¡Œçš„å¼€å¤´å»æ‰å‰ç½®ç©ºç™½ï¼ˆç©ºæ ¼ã€tabsï¼‰ï¼š\nraku -ne \u0026#39;say .trim-leading\u0026#39; example.txt ä»æ¯è¡Œçš„æœ«å°¾å»æ‰ç»“å°¾çš„ç©ºç™½ï¼ˆç©ºæ ¼ã€tabsï¼‰ï¼š\nraku -ne \u0026#39;say .trim-trailing\u0026#39; example.txt ä»æ¯è¡Œä¸­å»é™¤è¡Œé¦–å’Œè¡Œå°¾çš„ç©ºç™½ï¼š\nraku -ne \u0026#39;say .trim\u0026#39; example.txt æŠŠ UNIX æ¢è¡Œç¬¦è½¬æ¢ä¸º DOS/Windows æ¢è¡Œç¬¦ï¼š\nraku -ne \u0026#39;print .subst(/\\n/, \u0026#34;\\r\\n\u0026#34;)\u0026#39; example.txt æŠŠ DOS/Windows æ¢è¡Œç¬¦è½¬æ¢ä¸º UNIX æ¢è¡Œç¬¦ï¼š\nraku -ne \u0026#39;print .subst(/\\r\\n/, \u0026#34;\\n\u0026#34;)\u0026#39; example.txt æŠŠæ¯è¡Œä¸­æ‰€æœ‰çš„ \u0026ldquo;ut\u0026rdquo; å®ä½“ç”¨ \u0026ldquo;foo\u0026rdquo; æ›¿æ¢æ‰ï¼š\nraku -pe \u0026#39;s:g/ut/foo/\u0026#39; example.txt æŠŠåŒ…å« \u0026ldquo;lorem\u0026rdquo; çš„æ¯è¡Œä¸­æ‰€æœ‰çš„ \u0026ldquo;ut\u0026rdquo; å®ä½“ç”¨ \u0026ldquo;foo\u0026rdquo; æ›¿æ¢æ‰ï¼š\nraku -pe \u0026#39;s:g/ut/foo/ if /Lorem/\u0026#39; example.txt æŠŠæ–‡ä»¶è½¬æ¢ä¸º JSON æ ¼å¼ï¼š\nraku -M JSON::Tiny -e \u0026#39;say to-json(lines)\u0026#39; example.txt ä»æ–‡ä»¶çš„æ¯ä¸€è¡Œä¸­éšæœºæŒ‘é€‰ 5 ä¸ªå•è¯ï¼š\nraku -ne \u0026#39;say .words.pick(5)\u0026#39; example.txt æ–‡æœ¬åˆ†æ Print n-grams of a string\nraku -e \u0026#39;my $n=2; say \u0026#34;banana\u0026#34;.comb.rotor($n,$n-1).map({[~] @$_})\u0026#39; æ‰“å°å”¯ä¸€çš„ n-grams ```bash raku -e \u0026#39;my $n=2; say \u0026#34;banana\u0026#34;.comb.rotor($n,$n-1).map({[~] @$_}).Set.sort\u0026#39; æ‰“å° n-grams çš„å‡ºç°æ¬¡æ•°ï¼š\nraku -e \u0026#39;my $n=2; say \u0026#34;banana\u0026#34;.comb.rotor($n,$n-1).map({[~] @$_}).Bag.sort.join(\u0026#34;\\n\u0026#34;)\u0026#39; æ‰“å°å•è¯çš„å‡ºç°æ¬¡æ•°(1-grams)ï¼š\nraku -e \u0026#39;say lines[0].words.map({[~] @$_}).Bag.sort.join(\u0026#34;\\n\u0026#34;)\u0026#39; example.txt åŸºäºä¸€ç»„ 1-grams æ‰“å° Dice ç›¸ä¼¼ç³»æ•°ï¼š\nraku -e \u0026#39;my $a=\u0026#34;banana\u0026#34;.comb;my $b=\u0026#34;anna\u0026#34;.comb;say ($a (\u0026amp;) $b)/($a.Set + $b.Set)\u0026#39; åŸºäº 1-grams æ‰“å°å¡å¾—æ°ç›¸ä¼¼ç³»æ•°ï¼š\nraku -e \u0026#39;my $a=\u0026#34;banana\u0026#34;.comb;my $b=\u0026#34;anna\u0026#34;.comb;say ($a (\u0026amp;) $b) / ($a (|) $b)\u0026#39; åŸºäº 1-grams æ‰“å°é‡å ç³»æ•°ï¼š\nraku -e \u0026#39;my $a=\u0026#34;banana\u0026#34;.comb;my $b=\u0026#34;anna\u0026#34;.comb;say ($a (\u0026amp;) $b)/($a.Set.elems,$b.Set.elems).min\u0026#39; åŸºäº 1-grams æ‰“å°ç±»ä¼¼çš„ä½™å¼¦ï¼š\nraku -e \u0026#39;my $a=\u0026#34;banana\u0026#34;.comb;my $b=\u0026#34;anna\u0026#34;.comb;say ($a (\u0026amp;) $b)/($a.Set.elems.sqrt*$b.Set.elems.sqrt)\u0026#39; # ä¸Šé¢çš„å‘½ä»¤æç¤º Seq å·²ç»è¢«æ¶ˆè´¹ raku -e \u0026#39;my $a=\u0026#34;banana\u0026#34;.comb;my $b=\u0026#34;anna\u0026#34;.comb;say ($a.cache (\u0026amp;) $b.cache)/($a.cache.Set.elems.sqrt*$b.cache.Set.elems.sqrt)\u0026#39; åˆ›å»ºå­—ç¬¦ä¸²ä¸­å­—ç¬¦çš„ç´¢å¼•å¹¶æ‰“å°å‡ºæ¥ï¼š\nraku -e \u0026#39;say {}.push: %(\u0026#34;banana\u0026#34;.comb.pairs).invert\u0026#39; åˆ›å»ºä¸€è¡Œä¸­å•è¯çš„æ‰€ä»¥å¹¶æ‰“å°å‡ºæ¥ï¼š\nraku -e \u0026#39;({}.push: %(lines[0].words.pairs).invert).sort.join(\u0026#34;\\n\u0026#34;).say\u0026#39; example.txt é€‰æ‹©æ€§çš„è¡Œæ‰“å° æ‰“å°æ–‡ä»¶çš„ç¬¬ä¸€è¡Œï¼ˆæ¨¡ä»¿ head -1ï¼‰ï¼š\nraku -ne \u0026#39;.say;exit\u0026#39; example.txt raku -e \u0026#39;lines[0].say\u0026#39; example.txt raku -e \u0026#39;lines.shift.say\u0026#39; example.txt æ‰“å°æ–‡ä»¶çš„å‰ 10 è¡Œï¼ˆæ¨¡ä»¿ head -10ï¼‰\nraku -pe \u0026#39;exit if ++$ \u0026gt; 10\u0026#39; example.txt raku -ne \u0026#39;.say if ++$ \u0026lt; 11\u0026#39; example.txt æ‰“å°æ–‡ä»¶çš„æœ€åä¸€è¡Œï¼ˆæ¨¡ä»¿ tail -1ï¼‰ï¼š\nraku -e \u0026#39;lines.pop.say\u0026#39; example.txt æ‰“å°æ–‡ä»¶çš„æœ€å 5 è¡Œï¼ˆæ¨¡ä»¿ tail -5ï¼‰ï¼š\nraku -e \u0026#39;.say for lines[*-5..*]\u0026#39; example.txt åªæ‰“å°åŒ…å«å…ƒéŸ³çš„è¡Œï¼š\nraku -ne \u0026#39;/\u0026lt;[aeiou]\u0026gt;/ \u0026amp;\u0026amp; .print\u0026#39; example.txt æ‰“å°åŒ…å«æ‰€æœ‰å…ƒéŸ³çš„è¡Œï¼š\nraku -ne \u0026#39;.say if .comb (\u0026gt;=) \u0026lt;a e i o u\u0026gt;\u0026#39; example.txt raku -ne \u0026#39;.say if .comb âŠ‡ \u0026lt;a e i o u\u0026gt;\u0026#39; example.txt æ‰“å°å­—ç¬¦æ•°å¤§äºæˆ–ç­‰äº 80 çš„è¡Œï¼š\nraku -ne \u0026#39;.print if .chars \u0026gt;= 80\u0026#39; example.txt raku -ne \u0026#39;.chars \u0026gt;= 80 \u0026amp;\u0026amp; .print\u0026#39; example.txt åªæ‰“å°ç¬¬äºŒè¡Œï¼š\nraku -ne \u0026#39;.print if ++$ == 2\u0026#39; example.txt æ‰“å°é™¤äº†ç¬¬äºŒè¡Œçš„æ‰€æœ‰è¡Œï¼š\nraku -pe \u0026#39;next if ++$ == 2\u0026#39; example.txt æ‰“å°ç¬¬ä¸€è¡Œåˆ°ç¬¬ä¸‰è¡Œä¹‹é—´çš„æ‰€æœ‰è¡Œï¼š\nraku -ne \u0026#39;.print if (1..3).any == ++$\u0026#39; example.txt æ‰“å°ä¸¤ä¸ªæ­£åˆ™è¡¨è¾¾å¼ä¹‹é—´ï¼ˆåŒ…å«åŒ¹é…é‚£ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„è¡Œï¼‰çš„æ‰€æœ‰è¡Œï¼š\nraku -ne \u0026#39;.print if /^Lorem/../laborum\\.$/\u0026#39; example.txt æ‰“å°æœ€é•¿çš„è¡Œçš„é•¿åº¦ï¼š\nraku -e \u0026#39;say lines.max.chars\u0026#39; example.txt raku -ne \u0026#39;state $l=0; $l = .chars if .chars \u0026gt; $l;END { $l.say }\u0026#39; example.txt æ‰“å°é•¿åº¦æœ€é•¿çš„è¡Œï¼š\nraku -e \u0026#39;say lines.max\u0026#39; example.txt raku -e \u0026#39;my $l=\u0026#34;\u0026#34;; for (lines) {$l = $_ if .chars \u0026gt; $l.chars};END { $l.say }\u0026#39; example.txt æ‰“å°åŒ…å«æ•°å­—çš„æ‰€æœ‰è¡Œï¼š\nraku -ne \u0026#39;.say if /\\d/\u0026#39; example.txt raku -e \u0026#39;.say for lines.grep(/\\d/)\u0026#39; example.txt raku -ne \u0026#39;/\\d/ \u0026amp;\u0026amp; .say\u0026#39; example.txt raku -pe \u0026#39;next if ! $_.match(/\\d/)\u0026#39; example.txt æ‰“å°åªåŒ…å«æ•°å­—çš„æ‰€æœ‰è¡Œï¼š\nraku -ne \u0026#39;.say if /^\\d+$/\u0026#39; example.txt raku -e \u0026#39;.say for lines.grep(/^\\d+$/)\u0026#39; example.txt raku -ne \u0026#39;/^\\d+$/ \u0026amp;\u0026amp; .say\u0026#39; example.txt raku -pe \u0026#39;next if ! $_.match(/^\\d+$/)\u0026#39; example.txt æ‰“å°æ¯ä¸ªå¥‡æ•°è¡Œï¼š\nraku -ne \u0026#39;.say if ++$ % 2\u0026#39; example.txt æ‰“å°æ¯ä¸ªå¶æ•°è¡Œï¼š\nraku -ne \u0026#39;.say if ! (++$ % 2)\u0026#39; example.txt æ‰“å°æ‰€æœ‰é‡å¤çš„è¡Œï¼š\nraku -ne \u0026#39;state %l;.say if ++%l{$_}==2\u0026#39; example.txt æ‰“å°å”¯ä¸€çš„è¡Œï¼š\nraku -ne \u0026#39;state %l;.say if ++%l{$_}==1\u0026#39; example.txt æ‰“å°æ¯ä¸€è¡Œä¸­çš„ç¬¬ä¸€ä¸ªå­—æ®µï¼ˆå•è¯ï¼‰ï¼ˆæ¨¡ä»¿ cut -f 1 -d ' \u0026lsquo;ï¼‰\nraku -ne \u0026#39;.words[0].say\u0026#39; example.txt ä½¿ç”¨ç®¡é“è½¬æ¢æ•°æ® Rakuç¨‹åºç›´æ¥é›†æˆåˆ°äº†å‘½ä»¤è¡Œä¸­ã€‚ä½ å¯ä»¥ä½¿ç”¨ | ç®¡é“ç¬¦å·ä»å•è¡Œç¨‹åºä¸­è¾“å‡ºæ•°æ®å’Œè¾“å…¥æ•°æ®åˆ°å•è¡Œç¨‹åºä¸­ã€‚ä¸ºäº† ä»ç®¡é“ä¸­è¾“å…¥æ•°æ®ï¼Œ Raku è‡ªåŠ¨åœ°æŠŠ STDIN è®¾ç½®ä¸º $*INã€‚å°±åƒå¯¹æ–‡ä»¶é‚£æ ·ï¼Œä»ç®¡é“è¾“å…¥çš„æ•°æ®åœ¨å•è¡Œä¸­ä¹Ÿèƒ½ä½¿ç”¨ -n æ¥è¿›è¡Œå¾ªç¯è¿­ä»£ã€‚ä»å•è¡Œç¨‹åºä¸­è¾“å‡ºæ•°æ®å°±ä½¿ç”¨ print æˆ– say å¥½äº†ã€‚\nåœ¨å½“å‰ç›®å½•ä¸­å¯¹æ‰€æœ‰æ–‡ä»¶è¿›è¡Œ JSON ç¼–ç ï¼š\nls | raku -M JSON::Tiny -e \u0026#39;say to-json(lines)\u0026#39; æ‰“å°æ–‡ä»¶ä¸­çš„å¤§çº¦ 5% çš„éšæœºæ ·æœ¬è¡Œï¼š\nraku -ne \u0026#39;.say if 1.rand \u0026lt;= 0.05\u0026#39; /usr/share/dict/words é¢œè‰²è½¬æ¢ï¼Œ ä» HTML åˆ° RGB\necho \u0026#34;#ffff00\u0026#34; | raku -ne \u0026#39;.comb(/\\w\\w/).map({:16($_)}).say\u0026#39; é¢œè‰²è½¬æ¢ï¼Œ ä» RGB åˆ° HTML\necho \u0026#34;#ffff00\u0026#34; | raku -ne \u0026#39;.comb(/\\w\\w/).map({:16($_)}).say\u0026#39; WWW ä¸‹è½½ä¸€ä¸ªé¡µé¢ï¼š\nraku -M HTTP::UserAgent -e \u0026#39;say HTTP::UserAgent.new.get(\u0026#34;google.com\u0026#34;).content\u0026#39; ä¸‹è½½ä¸€ä¸ªé¡µé¢å¹¶å‰¥ç¦» HTMLï¼š\nwget -O - \u0026#34;http://raku.org\u0026#34; | raku -ne \u0026#39;s:g/\\\u0026lt;.+?\\\u0026gt;//.say\u0026#39; ä¸‹è½½ä¸€ä¸ªé¡µé¢å¹¶å‰¥ç¦»å¹¶è§£ç  HTMLï¼š\nwget -O - \u0026#34;http://raku.org\u0026#34; | raku -MHTML::Strip -ne \u0026#39;strip_html($_).say\u0026#39; å¼€å¯ä¸€ä¸ªç®€å•åœ° web æœåŠ¡å™¨ï¼š\nraku -M HTTP::Server::Simple -e \u0026#39;HTTP::Server::Simple.new.run\u0026#39; è½¬æ¢åˆ° Windows ä¸€æ—¦ä½ çŸ¥é“äº†é‡Œé¢çš„é—¨é“ä¹‹åé‚£ä¹ˆåœ¨ Windows ä¸Šè¿è¡Œå•è¡Œç¨‹åºå°±æ˜¯å°è‰ä¸€ç¢Ÿã€‚å•è¡Œç¨‹åºæ—¢å¯ä»¥åœ¨ cmd.exe ä¸­è¿è¡Œï¼Œåˆå¯ä»¥åœ¨ Powershell ä¸­è¿è¡Œã€‚ä¸»è¦çš„è§„åˆ™æ˜¯ï¼šç”¨åŒå¼•å·æ›¿æ¢æ‰å¤–éƒ¨çš„å•å¼•å·ï¼Œåœ¨å•è¡Œç¨‹åºçš„å†…éƒ¨ä½¿ç”¨æ’å€¼å¼•ç”¨æ“ä½œç¬¦ qq// æ¥æŠŠå­—ç¬¦ä¸²æ‹¬èµ·æ¥ã€‚å¯¹äºéæ’å€¼çš„å¼•èµ·ï¼Œä½ å¯ä»¥ä½¿ç”¨å•å¼•å·ã€‚æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªä¾‹å­ã€‚\nè¿™å„¿æœ‰ä¸€ä¸ªæ‰“å°æ—¶é—´çš„å•è¡Œç¨‹åºï¼š\nraku -e \u0026#39;say DateTime.now\u0026#39; è¦åœ¨ Windows ä¸Šè¿è¡Œï¼Œæˆ‘ä»¬ä»…ä»…ç”¨åŒå¼•å·æ›¿æ¢æ‰å•å¼•å·å¥½äº†ï¼š\nraku -e \u0026#34;say DateTime.now\u0026#34; è¿™ä¸ªå•è¡Œç¨‹åºç»™æ–‡ä»¶ä¸­æ¯ä¸€è¡Œæ·»åŠ äº†ä¸€ä¸ªæ¢è¡Œç¬¦ï¼Œä½¿ç”¨äº†æ’å€¼å­—ç¬¦ä¸²ï¼š\nraku -pe \u0026#39;$_ ~= \u0026#34;\\n\u0026#34;\u0026#39; example.txt åœ¨ Windows ä¸Šè¿™åº”è¯¥å†™ä¸ºï¼š\nraku -pe \u0026#34;$_~= qq/\\n/\u0026#34; example.txt è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æƒ³å¯¹æ¢è¡Œç¬¦è¿›è¡Œæ’å€¼ï¼Œå¹¶ä¸”ä¸ä¸ºè¯¥è¡Œå­—é¢åœ°æ·»åŠ åæ–œçº¿å’Œå­—ç¬¦\u0026quot;n\u0026quot;ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»ä½¿ç”¨ qqã€‚ä½†æ˜¯ä½ é€šå¸¸ä¹Ÿå¯ä»¥åƒè¿™æ ·åœ¨å•è¡Œç¨‹åºä¸­ä½¿ç”¨å•å¼•å·ï¼š\nraku -e \u0026#39;say \u0026#34;Hello, World!\u0026#34;\u0026#39; åœ¨ Windows ä¸Šè¿™åº”è¯¥å†™ä¸ºï¼š\nraku -e \u0026#34;say \u0026#39;hello, World!\u0026#39;\u0026#34; ç®€å•åœ°è¾“å‡ºé‡å®šå‘å·¥ä½œèµ·æ¥åƒåŸºäº Unix ç³»ç»Ÿé‚£æ ·ã€‚ è¿™ä¸ªå•è¡Œç¨‹åºä½¿ç”¨ \u0026gt; æŠŠ ASCII å­—ç¬¦ç´¢å¼•è¡¨æ‰“å°åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼š\nraku -e \u0026#34;say .chr ~ \u0026#39; \u0026#39; ~ $_for 0..255\u0026#34; \u0026gt; ascii_codes.txt åœ¨ä½¿ç”¨ \u0026gt; çš„æ—¶å€™ï¼Œå¦‚æœæ–‡ä»¶ä¸å­˜åœ¨å°±ä¼šåˆ›å»ºä¸€ä¸ªã€‚å¦‚æœæ–‡ä»¶ç¡®å®å­˜åœ¨ï¼Œå®ƒä¼šè¢«é‡å†™ã€‚ä½ å¯èƒ½æ›´æƒ³è¿½åŠ åˆ°æ–‡ä»¶ï¼Œä½¿ç”¨ \u0026gt;\u0026gt; ä»£æ›¿ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2015-08-25-one-liners-in-raku/","tags":["oneliner"],"title":"Raku ä¸­çš„å•è¡Œç¨‹åº"},{"categories":["rakulang"],"contents":"å˜é‡åä»¥ä¸€ä¸ªå«åšé­”ç¬¦ sigil çš„ç‰¹æ®Šå­—ç¬¦å¼€å¤´, åé¢è·Ÿç€ä¸€ä¸ªå¯é€‰çš„ç¬¬äºŒä¸ªå«åš twigil çš„ç‰¹æ®Šå­—ç¬¦, ç„¶åæ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦.\nSigils    ç¬¦å· ç±»å‹çº¦æŸ é»˜è®¤ç±»å‹ Flattens Assignment     $ Mu (no type constraint) Any No item   \u0026amp; Callable Callable No item   @ Positional Array Yes list   % Associative Hash Yes list    ä¾‹å­:\nmy $square = 9 ** 2; my @array = 1, 2, 3; # Array variable with three elements my %hash = London =\u0026gt; \u0026#39;UK\u0026#39;, Berlin =\u0026gt; \u0026#39;Germany\u0026#39;; é»˜è®¤ç±»å‹å¯ä»¥ä½¿ç”¨ is å…³é”®å­—è®¾ç½®ã€‚\nclass FailHash is Hash { has Bool $!final = False; multi method AT-KEY ( ::?CLASS:D: Str:D \\key ){ fail X::OutOfRange.new(:what(\u0026#34;Hash key\u0026#34;), :got(key), :range(self.keys)) if $!final \u0026amp;\u0026amp; !self.EXISTS-KEY(key); callsame } method finalize() { $!final = True } } my %h is FailHash = oranges =\u0026gt; \u0026#34;round\u0026#34;, bananas =\u0026gt; \u0026#34;bendy\u0026#34;; say %h\u0026lt;oranges\u0026gt;; # OUTPUT Â«roundâ¤Â» %h.finalize; say %h\u0026lt;cherry\u0026gt;; CATCH { default { put .^name, \u0026#39;: \u0026#39;, .Str } } # OUTPUT Â«X::OutOfRange: Hash key out of range. Is: cherry, should be in (oranges bananas)Â» ä¸å¸¦ç¬¦å·çš„å˜é‡ä¹Ÿæ˜¯å¯è¡Œçš„, æŸ¥çœ‹ æ— ç¬¦å·å˜é‡.\né¡¹å’Œåˆ—è¡¨èµ‹å€¼ æœ‰ä¸¤ç§ç±»å‹çš„èµ‹å€¼, item èµ‹å€¼å’Œ list èµ‹å€¼ã€‚ä¸¤è€…éƒ½ä½¿ç”¨ = å·æ“ä½œç¬¦ã€‚æ ¹æ® = å·å·¦è¾¹çš„è¯­æ³•æ¥åŒºåˆ« = æ˜¯ item èµ‹å€¼è¿˜æ˜¯ list èµ‹å€¼ã€‚\nItem èµ‹å€¼æŠŠç­‰å·å³ä¾§çš„å€¼æ”¾åˆ°å·¦ä¾§çš„å˜é‡(å®¹å™¨)ä¸­ã€‚\nä¾‹å¦‚, æ•°ç»„å˜é‡(@ç¬¦å·)åœ¨åˆ—è¡¨èµ‹å€¼æ—¶æ¸…ç©ºæ•°ç»„è‡ªèº«, ç„¶åæŠŠç­‰å·å³ä¾§çš„å€¼éƒ½æ”¾è¿›æ•°ç»„è‡ªèº«ä¸­. è·Ÿ Item èµ‹å€¼ç›¸æ¯”, è¿™æ„å‘³ç€ç­‰å·å·¦ä¾§çš„å˜é‡ç±»å‹å§‹ç»ˆæ˜¯ Array, ä¸ç®¡å³ä¾§æ˜¯ä»€ä¹ˆç±»å‹ã€‚\nèµ‹å€¼ç±»å‹(item æˆ– list)å–å†³äºå½“å‰è¡¨è¾¾å¼æˆ–å£°æ˜ç¬¦çœ‹åˆ°çš„ç¬¬ä¸€ä¸ªä¸Šä¸‹æ–‡:\nmy $foo = 5; # item assignment say $foo.perl; # 5 my @bar = 7, 9; # list assignment say @bar.WHAT; # Array say @bar.perl; # [7, 9] (my $baz) = 11, 13; # list assignment say $baz.WHAT; # Parcel say $baz.perl; # (11, 13) å› æ­¤, åŒ…å«åœ¨åˆ—è¡¨èµ‹å€¼ä¸­çš„èµ‹å€¼è¡Œä¸ºä¾èµ–äºè¡¨è¾¾å¼æˆ–åŒ…å«è¡¨è¾¾å¼çš„å£°æ˜ç¬¦ã€‚ ä¾‹å¦‚, å¦‚æœå†…éƒ¨èµ‹å€¼æ˜¯ä¸€ä¸ªå£°æ˜ç¬¦(ä¾‹å¦‚ my), å°±ä½¿ç”¨ item èµ‹å€¼, å®ƒæ¯”é€—å·å’Œåˆ—è¡¨èµ‹å€¼çš„ä¼˜å…ˆçº§æ›´é«˜:\nmy @array; @array = my $num = 42, \u0026#34;str\u0026#34;; # item assignment: uses declarator say @array.perl; # [42, \u0026#34;str\u0026#34;] (an Array) say $num.perl; # 42 (a Num) ç±»ä¼¼åœ°, å¦‚æœå†…éƒ¨èµ‹å€¼æ˜¯ä¸€ä¸ªç”¨äºå£°æ˜ç¬¦åˆå§‹åŒ–çš„è¡¨è¾¾å¼, åˆ™å†…éƒ¨è¡¨è¾¾å¼çš„ä¸Šä¸‹æ–‡å†³å®šèµ‹å€¼çš„ç±»å‹:\nmy $num; my @array = $num = 42, \u0026#34;str\u0026#34;; # item assignment: uses expression say @array.perl; # [42, \u0026#34;str\u0026#34;] (an Array) say $num.perl; # 42 (a Num) my ( @foo, $bar ); @foo = ($bar) = 42, \u0026#34;str\u0026#34;; # list assignment: uses parens say @foo.perl; # [42, \u0026#34;str\u0026#34;] (an Array) say $bar.perl; # $(42, \u0026#34;str\u0026#34;) (a Parcel) ç„¶è€Œ, å¦‚æœå†…éƒ¨èµ‹å€¼æ—¢ä¸æ˜¯å£°æ˜ç¬¦åˆä¸æ˜¯è¡¨è¾¾å¼, è€Œæ˜¯æ›´å¤§çš„è¡¨è¾¾å¼çš„ä¸€éƒ¨åˆ†, æ›´å¤§çš„è¡¨è¾¾å¼çš„ä¸Šä¸‹æ–‡å†³å®šèµ‹å€¼çš„ç±»å‹:\nmy ( @array, $num ); @array = $num = 42, \u0026#34;str\u0026#34;; # list assignment say @array.perl; # [42, \u0026#34;str\u0026#34;] (an Array) say $num.perl; # [42, \u0026#34;str\u0026#34;] (an Array) è¿™æ˜¯å› ä¸ºæ•´ä¸ªè¡¨è¾¾å¼æ˜¯ @array = $num = 42, \u0026quot;str\u0026quot;, è€Œ $num = 42 ä¸æ˜¯å•ç‹¬çš„è¡¨è¾¾å¼ã€‚\næŸ¥çœ‹æ“ä½œç¬¦è·å–å…³äºä¼˜å…ˆçº§çš„æ›´å¤šè¯¦æƒ…ã€‚\næ— ç¬¦å·å˜é‡ åœ¨ Raku ä¸­åˆ›å»ºä¸å¸¦ç¬¦å·çš„å˜é‡ä¹Ÿæ˜¯å¯èƒ½çš„:\nmy \\degrees = pi / 180; my \\Î¸ = 15 * degrees; ç„¶è€Œ, è¿™äº›æ— ç¬¦å·å˜é‡å¹¶ä¸åˆ›å»ºå®¹å™¨. é‚£æ„å‘³ç€ä¸Šé¢çš„ degrees å’Œ Î¸ å®é™…ä¸Šç›´æ¥ä»£è¡¨ Numsã€‚ ä¸ºäº†è¯´æ˜, æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ— ç¬¦å·å˜é‡åå†èµ‹å€¼:\nÎ¸ = 3; # Dies with the error \u0026#34;Cannot modify an immutable Num\u0026#34; æ— ç¬¦å·å˜é‡ä¸å¼ºåˆ¶ä¸Šä¸‹æ–‡, æ‰€ä»¥å®ƒä»¬å¯è¢«ç”¨äºåŸæ ·åœ°ä¼ é€’æŸäº›ä¸œè¥¿:\nsub logged(\u0026amp;f, |args) { say(\u0026#39;Calling \u0026#39; ~ \u0026amp;f.name ~ \u0026#39;with arguments \u0026#39; ~ args.perl); my \\result = f(|args); # ^^^^^^^ not enforcing any context here say(\u0026amp;f.name ~ \u0026#39;returned \u0026#39; ~ result.perl); return |result; } Twigils Twigils å½±å“å˜é‡çš„ä½œç”¨åŸŸã€‚è¯·è®°ä½ twigils å¯¹åŸºæœ¬çš„é­”ç¬¦æ’å€¼æ²¡æœ‰å½±å“ï¼Œé‚£å°±æ˜¯ï¼Œå¦‚æœ $a å†…æ’ï¼Œ$^a, $*a, $=a, $?a, $.a, ç­‰ç­‰ä¹Ÿä¼šå†…æ’. å®ƒä»…ä»…å–å†³äº $ã€‚\n   Twigil Scope     * åŠ¨æ€çš„   ! å±æ€§(ç±»æˆå‘˜)   ? ç¼–è¯‘æ—¶å˜é‡   . æ–¹æ³•(å¹¶éçœŸæ­£çš„å˜é‡)   \u0026lt; åŒ¹é…å¯¹è±¡ç´¢å¼•(å¹¶éçœŸæ­£çš„å˜é‡)   ^ è‡ªæˆ‘å£°æ˜çš„å½¢å¼ä½ç½®å‚æ•°   : è‡ªæˆ‘å£°æ˜çš„å½¢å¼å‘½åå‚æ•°   = Pod å˜é‡   ~ å­è¯­è¨€    * Twigil åŠ¨æ€å˜é‡é€šè¿‡ caller æŸ¥æ‰¾, ä¸æ˜¯é€šè¿‡å¤–éƒ¨ä½œç”¨åŸŸã€‚ä¾‹å¦‚:\nmy $lexical = 1; my $*dynamic1 = 10; my $*dynamic2 = 100; sub say-all() { say \u0026#34;$lexical, $*dynamic1, $*dynamic2\u0026#34;; } # prints 1, 10, 100 say-all(); { my $lexical = 2; my $*dynamic1 = 11; $*dynamic2 = 101; # æ³¨æ„,è¿™å„¿æ²¡æœ‰ä½¿ç”¨ my æ¥å£°æ˜ # prints 1, 11, 101 say-all(); } # prints 1, 10, 101 say-all(); ç¬¬ä¸€æ¬¡è°ƒç”¨ \u0026amp;say-all æ—¶, å°±åƒä½ æœŸæœ›çš„ä¸€æ ·, å®ƒæ‰“å° \u0026ldquo;1, 10, 100\u0026rdquo;ã€‚å¯æ˜¯ç¬¬äºŒæ¬¡å®ƒæ‰“å° \u0026ldquo;1, 11, 101\u0026rdquo;ã€‚ è¿™æ˜¯å› ä¸º $lexical ä¸æ˜¯åœ¨è°ƒç”¨è€…çš„ä½œç”¨åŸŸå†…è¢«æŸ¥æ‰¾, è€Œæ˜¯åœ¨ \u0026amp;say-all è¢«å®šä¹‰çš„ä½œç”¨åŸŸé‡Œè¢«æŸ¥æ‰¾çš„ã€‚è¿™ä¸¤ä¸ªåŠ¨æ€ä½œç”¨åŸŸå˜é‡åœ¨è°ƒç”¨è€…çš„ä½œç”¨åŸŸå†…è¢«æŸ¥æ‰¾, æ‰€ä»¥å€¼ä¸º 11 å’Œ 101ã€‚ç¬¬ä¸‰æ¬¡è°ƒç”¨ \u0026amp;say-all å, $*dynamic1 ä¸å†æ˜¯ 11 äº†ã€‚ä½†æ˜¯ $*dynamic2 ä»ç„¶æ˜¯ 101ã€‚è¿™æºäºæˆ‘ä»¬åœ¨å—ä¸­å£°æ˜äº†ä¸€ä¸ªæ–°çš„åŠ¨æ€å˜é‡ $*dynamic1 çš„äº‹å®å¹¶ä¸”æ²¡æœ‰åƒæˆ‘ä»¬å¯¹å¾… $*dynamic2 é‚£æ ·æŠŠå€¼èµ‹å€¼ç»™æ—§çš„å˜é‡ã€‚\nåŠ¨æ€å˜é‡ä¸å…¶ä»–å˜é‡ç±»å‹åœ¨å¼•ç”¨ä¸€ä¸ªæœªå£°æ˜çš„åŠ¨æ€å˜é‡ä¸Šä¸åŒçš„æ˜¯å‰è€…ä¸æ˜¯ä¸€ä¸ªç¼–è¯‘æ—¶é”™è¯¯ï¼Œè€Œæ˜¯è¿è¡Œæ—¶ failureï¼Œè¿™æ ·ä¸€ä¸ªåŠ¨æ€å˜é‡å¯ä»¥åœ¨æœªå®šä¹‰æ—¶ä½¿ç”¨åªè¦åœ¨æŠŠå®ƒç”¨ä½œä»»ä½•å…¶å®ƒä¸œè¥¿çš„æ—¶å€™æ£€æŸ¥å®ƒæ˜¯å¦å®šä¹‰è¿‡:\nsub foo() { $*FOO // \u0026#39;foo\u0026#39;; } say foo; # -\u0026gt; \u0026#39;foo\u0026#39; my $*FOO = \u0026#39;bar\u0026#39;; say foo; # -\u0026gt; \u0026#39;bar\u0026#39; ! Twigil å±æ€§æ˜¯å˜é‡, å­˜åœ¨äºæ¯ä¸ªç±»çš„å®ä¾‹ä¸­. é€šè¿‡ ! ç¬¦å·å®ƒä»¬å¯ä»¥ä»ç±»çš„é‡Œé¢ç›´æ¥è¢«è®¿é—®åˆ°:\nclass Point { has $.x; has $.y; method Str() { \u0026#34;($!x, $!y)\u0026#34; } } æ³¨æ„å±æ€§æ˜¯æ€æ ·è¢«å£°æ˜ä¸º $.x å’Œ $.y çš„, ä½†æ˜¯ä»ç„¶èƒ½å¤Ÿé€šè¿‡ $!x å’Œ $!y è®¿é—®åˆ°å±æ€§. è¿™æ˜¯å› ä¸º åœ¨ Raku ä¸­, æ‰€æœ‰çš„å±æ€§éƒ½æ˜¯ç§æœ‰çš„, å¹¶ä¸”åœ¨ç±»ä¸­èƒ½ä½¿ç”¨ $!attribute-name ç›´æ¥è®¿é—®è¿™äº›å±æ€§. Raku èƒ½è‡ªåŠ¨ä¸ºä½ ç”Ÿæˆè®¿é—®æ–¹æ³•. å…³äºå¯¹è±¡ã€ç±»å’Œå®ƒä»¬çš„å±æ€§å’Œæ–¹æ³•çš„è¯¦æƒ…, è¯·æŸ¥çœ‹é¢å‘å¯¹è±¡.\n? Twigil ç¼–è¯‘æ—¶\u0026quot;å¸¸é‡\u0026quot;, å¯é€šè¿‡ ? twigil è®¿é—®. ç¼–è¯‘å™¨å¯¹å®ƒä»¬å¾ˆç†Ÿæ‚‰, å¹¶ä¸”ç¼–è¯‘åä¸èƒ½è¢«ä¿®æ”¹. å¸¸ç”¨çš„ä¸€ä¸ªä¾‹å­å¦‚ä¸‹:\nsay \u0026#34;$?FILE:$?LINE\u0026#34;; # prints \u0026#34;hello.pl: 23\u0026#34; if this is the 23 line of a # file named \u0026#34;hello.pl\u0026#34;. å…³äºè¿™äº›ç‰¹æ®Šå˜é‡çš„åˆ—è¡¨è¯·æŸ¥çœ‹ç¼–è¯‘æ—¶å˜é‡ã€‚\nå°½ç®¡ä¸èƒ½åœ¨è¿è¡Œæ—¶æ”¹å˜å®ƒä»¬, ç”¨æˆ·å¯ä»¥(é‡æ–°)å®šä¹‰è¿™ç§å¸¸é‡.\nconstant $?TABSTOP = 4; # this causes leading tabs in a heredoc or in a POD # block\u0026#39;s virtual margin to be counted as 4 spaces. . Twigil . twigil çœŸçš„ä¸æ˜¯ç”¨äºå˜é‡çš„. å®é™…ä¸Š, çœ‹ä¸‹é¢çš„ä»£ç :\nclass Point { has $.x; has $.y; method Str() { \u0026#34;($.x, $.y)\u0026#34; # æ³¨æ„æˆ‘ä»¬è¿™æ¬¡ä½¿ç”¨ . è€Œä¸æ˜¯ ! } } å¯¹ self(è‡ªèº«)è°ƒç”¨äº†æ–¹æ³• x å’Œæ–¹æ³• y, è¿™æ˜¯è‡ªåŠ¨ä¸ºä½ ç”Ÿæˆçš„, å› ä¸ºåœ¨ä½ å£°æ˜ä½ çš„å±æ€§çš„æ—¶å€™, ä½ ä½¿ç”¨çš„æ˜¯ . twigil ã€‚ æ³¨æ„, å­ç±»å¯èƒ½ä¼šè¦†ç›–é‚£äº›æ–¹æ³•. å¦‚æœä½ ä¸æƒ³è¿™ä¸ªå‘ç”Ÿ, è¯·ä½¿ç”¨ $!x å’Œ $!y ä»£æ›¿ã€‚\n. twigil åªæ˜¯è°ƒç”¨äº†ä¸€ä¸ªæ–¹æ³•ä¹Ÿè¡¨æ˜ä¸‹é¢æ˜¯å¯èƒ½çš„\nclass SaySomething { method a() { say \u0026#34;a\u0026#34;; } method b() { $.a; } } SaySomething.b; # prints \u0026#34;a\u0026#34; å…³äºå¯¹è±¡ã€ç±»å’Œå®ƒä»¬çš„å±æ€§å’Œæ–¹æ³•çš„è¯¦æƒ…, è¯·æŸ¥çœ‹é¢å‘å¯¹è±¡.\n\u0026lt; Twigil \u0026lt; twigil æ˜¯ $/\u0026lt;...\u0026gt; çš„åˆ«å, å…¶ä¸­, $/ æ˜¯åŒ¹é…å˜é‡ã€‚å…³äºåŒ¹é…å˜é‡çš„æ›´å¤šè¯¦æƒ…è¯·æŸ¥çœ‹ $/å˜é‡å’Œç±»å‹åŒ¹é…\n^ Twigil ^ twigil ä¸º block å— æˆ– å­ä¾‹ç¨‹ å£°æ˜äº†ä¸€ä¸ªå½¢å¼ä½ç½®å‚æ•°. å½¢å¦‚ $^variable çš„å˜é‡æ˜¯ä¸€ç§å ä½å˜é‡. å®ƒä»¬å¯ç”¨åœ¨è£¸ä»£ç å—ä¸­æ¥å£°æ˜ä»£ç å—çš„å½¢å¼å‚æ•°ã€‚çœ‹ä¸‹é¢ä»£ç ä¸­çš„å—:\nfor ^4 { say \u0026#34;$^secondsfollows $^first\u0026#34;; } å®ƒæ‰“å°å‡º:\n1 follows 0 3 follows 2 æœ‰ä¸¤ä¸ªå½¢å¼å‚æ•°ï¼Œå°±æ˜¯ $first å’Œ $second. æ³¨æ„, å°½ç®¡ $^second åœ¨ä»£ç ä¸­å‡ºç°çš„æ¯” $^first æ—©, $^first ä¾ç„¶æ˜¯ä»£ç å—ä¸­çš„ç¬¬ä¸€ä¸ªå½¢å¼å‚æ•°. è¿™æ˜¯å› ä¸ºå ä½ç¬¦å˜é‡æ˜¯ä»¥ Unicode é¡ºåºæ’åºçš„ã€‚\nå­ä¾‹ç¨‹ä¹Ÿèƒ½ä½¿ç”¨å ä½ç¬¦å˜é‡, ä½†æ˜¯åªæœ‰åœ¨å­ä¾‹ç¨‹æ²¡æœ‰æ˜¾å¼çš„å‚æ•°åˆ—è¡¨æ—¶æ‰è¡Œ. è¿™å¯¹æ™®é€šçš„å—ä¹Ÿé€‚ç”¨\nsub say-it { say $^a; } # valid sub say-it() { say $^a; } # invalid { say $^a; } # valid -\u0026gt; $x, $y, $x { say $^a; } # éæ³•, å·²ç»æœ‰å‚æ•°åˆ—è¡¨ $x,$y,$x äº† å ä½ç¬¦å˜é‡è¯­æ³•ä¸Šä¸èƒ½æœ‰ç±»å‹é™åˆ¶. ä¹Ÿæ³¨æ„, ä¹Ÿä¸èƒ½ä½¿ç”¨å•ä¸ªå¤§å†™å­—æ¯çš„å ä½ç¬¦å˜é‡, å¦‚ $^A\n: Twigil : twigil ä¸ºå—æˆ–å­ä¾‹ç¨‹å£°æ˜äº†ä¸€ä¸ªå½¢å¼å‘½åå‚æ•°ã€‚ä½¿ç”¨è¿™ç§å½¢å¼å£°æ˜çš„å˜é‡ä¹Ÿæ˜¯å ä½ç¬¦å˜é‡çš„ä¸€ç§ç±»å‹ã€‚å› æ­¤é€‚ç”¨äºä½¿ç”¨ ^ twigil å£°æ˜çš„å˜é‡çš„ä¸œè¥¿åœ¨è¿™å„¿ä¹Ÿé€‚ç”¨(é™¤äº†å®ƒä»¬ä¸æ˜¯ä½ç½®çš„ä»¥å¤–, å› æ­¤æ²¡æœ‰ä½¿ç”¨ Unicode é¡ºåºæ’åº)ã€‚æ‰€ä»¥è¿™ä¸ª:\nsay { $:add ?? $^a + $^b !! $^a - $^b }( 4, 5 ) :!add # OUTPUT: # -1 æŸ¥çœ‹ ^è·å–å…³äºå ä½ç¬¦å˜é‡çš„æ›´å¤šç»†èŠ‚ã€‚\n= Twigil = twigil ç”¨äºè®¿é—® Pod å˜é‡ã€‚å½“å‰æ–‡ä»¶ä¸­çš„æ¯ä¸ª Pod å—éƒ½èƒ½é€šè¿‡ä¸€ä¸ª Pod å¯¹è±¡è®¿é—®åˆ°, ä¾‹å¦‚ $=data, $=SYNOPSIS æˆ– =UserBlock, å³ï¼šä¸€ä¸ªå’Œæƒ³è¦çš„å—åŒåçš„å˜é‡åŠ ä¸Šä¸€ä¸ª = twigilã€‚\n=beginFoo... =end Foo #after that, $=Foo gives you all Foo-Pod-blocks æ‚¨å¯ä»¥é€šè¿‡ $=podè®¿é—® Pod æ ‘ï¼Œå®ƒåŒ…å«æ‰€æœ‰ä½œä¸ºåˆ†çº§æ•°æ®ç»“æ„çš„Podç»“æ„ã€‚\nè¯·æ³¨æ„ï¼Œæ‰€æœ‰è¿™äº› $=someBlockName éƒ½æ”¯æŒä½ç½®å’Œå…³è”è§’è‰²ã€‚\n~ Twigil æ³¨æ„: Slangsï¼ˆä¿šè¯­ï¼‰åœ¨ Rakudo ä¸­è¿˜æ²¡æœ‰è¢«å®ç°ã€‚ NYI = Not Yet Implementedã€‚\n~ twigil æ˜¯æŒ‡å­è¯­è¨€ï¼ˆç§°ä¸ºä¿šè¯­ï¼‰ã€‚ä¸‹é¢æ˜¯æœ‰ç”¨çš„ï¼š\n   å˜é‡å è¯´ æ˜     $~MAIN the current main language (e.g. Perl statements)   $~Quote the current root of quoting language   $~Quasi the current root of quasiquoting language   $~Regex the current root of regex language   $~Trans the current root of transliteration language   $~P5Regex the current root of the Perl 5 regex language    ä½ åœ¨ä½ å½“å‰çš„è¯æ³•ä½œç”¨åŸŸä¸­æ‰©å……è¿™äº›è¯­è¨€ã€‚\nuse MONKEY-TYPING; augment slang Regex { # derive from $~Regex and then modify $~Regex token backslash:std\u0026lt;\\Y\u0026gt; {YY }; } å˜é‡å£°æ˜ç¬¦å’Œä½œç”¨åŸŸ é€šå¸¸, ä½¿ç”¨ my å…³é”®å­—åˆ›å»ºä¸€ä¸ªæ–°çš„å˜é‡å°±è¶³å¤Ÿäº†:\nmy $amazing-variable = \u0026#34;World\u0026#34;; say \u0026#34;Hello $amazing-variable!\u0026#34;; # Hello World! ç„¶è€Œ, æœ‰å¾ˆå¤šå£°æ˜ç¬¦èƒ½åœ¨ Twigils çš„èƒ½åŠ›ä¹‹å¤–æ”¹å˜ä½œç”¨åŸŸçš„ç»†èŠ‚ã€‚\n   å£°æ˜ç¬¦ ä½œç”¨     my ä½œä¸ºè¯æ³•ä½œç”¨åŸŸåå­—çš„å¼€å¤´   our ä½œä¸ºåŒ…ä½œç”¨åŸŸåå­—çš„å¼€å¤´   has ä½œä¸ºå±æ€§åçš„å¼€å¤´   anon ä½œä¸ºç§æœ‰åå­—çš„å¼€å¤´   state ä½œä¸ºè¯æ³•ä½œç”¨åŸŸä½†æ˜¯æŒä¹…åå­—çš„å¼€å¤´   augment ç»™å·²å­˜åœ¨çš„åå­—æ·»åŠ å®šä¹‰   supersede æ›¿æ¢å·²å­˜åœ¨åå­—çš„å®šä¹‰    è¿˜æœ‰ä¸¤ä¸ªç±»ä¼¼äºå£°æ˜ç¬¦çš„å‰ç¼€, ä½†æ˜¯ä½œç”¨äºé¢„å®šä¹‰å˜é‡:\n   å‰ç¼€ ä½œç”¨     temp åœ¨ä½œç”¨åŸŸçš„æœ€åæ¢å¤å˜é‡çš„å€¼   let å¦‚æœ block æˆåŠŸé€€å‡ºå°±æ¢å¤å˜é‡çš„å€¼    my å£°æ˜ç¬¦ ä½¿ç”¨ my å£°æ˜ä¸€ä¸ªå˜é‡ç»™å˜é‡ä¸€ä¸ªè¯æ³•ä½œç”¨åŸŸ. è¿™æ„å‘³ç€å˜é‡åªåœ¨å½“å‰å—ä¸­å­˜åœ¨.ä¾‹å¦‚:\n{ my $foo = \u0026#34;bar\u0026#34;; say $foo; # -\u0026gt; \u0026#34;bar\u0026#34; } say $foo; # !!! \u0026#34;Variable \u0026#39;$foo\u0026#39; is not declared\u0026#34; å®ƒæŠ›å‡ºå¼‚å¸¸,å› ä¸ºåªè¦æˆ‘ä»¬åœ¨åŒä¸€ä¸ªä½œç”¨åŸŸå†… $foo æ‰è¢«å®šä¹‰. æ­¤å¤–, è¯æ³•ä½œç”¨åŸŸæ„å‘³ç€å˜é‡èƒ½åœ¨æ–°çš„ä½œç”¨åŸŸå†…è¢«ä¸´æ—¶åœ°é‡æ–°å®šä¹‰:\nmy $location = \u0026#34;outside\u0026#34;; sub outer-location { # Not redefined: say $location; } outer-location; # -\u0026gt; \u0026#34;outside\u0026#34; sub in-building { my $location = \u0026#34;inside\u0026#34;; say $location; } in-building; # -\u0026gt; \u0026#34;inside\u0026#34; outer-location; # -\u0026gt; \u0026#34;outside\u0026#34; å¦‚æœå˜é‡è¢«é‡æ–°å®šä¹‰äº†, ä»»ä½•å¼•ç”¨å¤–éƒ¨å˜é‡çš„ä»£ç ä¼šç»§ç»­å¼•ç”¨å¤–éƒ¨å˜é‡. æ‰€ä»¥, åœ¨è¿™å„¿, \u0026amp;outer-location ä»ç„¶æ‰“å°å¤–éƒ¨çš„ $location:\nsub new-location { my $location = \u0026#34;nowhere\u0026#34; outer-location; } new-location; # -\u0026gt; \u0026#34;outside\u0026#34; ä¸ºäº†è®© new-location() èƒ½æ‰“å° nowwhere, éœ€è¦ä½¿ç”¨ * twigil è®© $location å˜ä¸ºåŠ¨æ€å˜é‡. å¯¹äºå­ä¾‹ç¨‹æ¥è¯´, my æ˜¯é»˜è®¤ä½œç”¨åŸŸ, æ‰€ä»¥ my sub x( ) { } å’Œ sub x( ) { } æ˜¯ä¸€æ ·çš„.\nour å£°æ˜ç¬¦ our è·Ÿ my çš„ä½œç”¨ç±»ä¼¼, é™¤äº†æŠŠåˆ«åå¼•å…¥åˆ°ç¬¦å·è¡¨ä¹‹å¤–:\nmodule M { our $Var; # $Var available here } # Available as $M::Var here. å£°æ˜ä¸€ç»„å˜é‡ å£°æ˜ç¬¦ my å’Œ our æ¥æ”¶ä¸€ç»„æ‰©åœ¨åœ†æ‹¬å·ä¸­çš„å˜é‡ä½œä¸ºå‚æ•°æ¥ä¸€æ¬¡æ€§å£°æ˜å¤šä¸ªå˜é‡ã€‚\nmy (@a, $s, %h); è¿™å¯ä»¥å’Œè§£æ„èµ‹å€¼ç»“åˆä½¿ç”¨ã€‚ä»»ä½•å¯¹è¿™æ ·ä¸€ä¸ªåˆ—è¡¨çš„èµ‹å€¼ä¼šå–å¾—å·¦ä¾§åˆ—è¡¨ä¸­æä¾›çš„å…ƒç´ æ•°é‡å¹¶ä¸”ä»å³ä¾§åˆ—è¡¨ä¸­æŠŠå¯¹åº”çš„å€¼èµ‹å€¼ç»™å®ƒä»¬ã€‚æ²¡æœ‰å¾—åˆ°èµ‹å€¼çš„å…ƒç´ ä¼šæ ¹æ®å˜é‡çš„ç±»å‹å¾—åˆ°ä¸€ä¸ªæœªå®šä¹‰å€¼ã€‚\nmy (Str $a, Str $b, Int $c) = \u0026lt;a b\u0026gt;; say [$a, $b, $c].perl; # OUTPUTÂ«[\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, Int]â¤Â» è¦æŠŠåˆ—è¡¨è§£æ„åˆ°ä¸€ä¸ªå•ä¸ªçš„å€¼ä¸­, é€šè¿‡ä½¿ç”¨ ($var,) åˆ›å»ºä¸€ä¸ªå¸¦æœ‰ä¸€ä¸ªå€¼çš„åˆ—è¡¨å­—é¢å€¼ã€‚å½“ä½¿ç”¨äº†ä¸€ä¸ªå˜é‡å£°æ˜ç¬¦æ—¶åªåœ¨å•ä¸ªå˜é‡å‘¨å›´æä¾›ä¸€ä¸ªåœ†æ‹¬å·å°±è¶³å¤Ÿäº†ã€‚\nsub f { 1,2,3 }; my ($a) = f; say $a.perl; # OUTPUTÂ«1â¤Â» è¦è·³è¿‡åˆ—è¡¨ä¸­çš„å…ƒç´ , ä½¿ç”¨åŒ¿åçŠ¶æ€å˜é‡ $ã€‚\nmy ($,$a,$,%h) = (\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;, [1,2,3], {:1th}); say [$a, %h].perl; # OUTPUTÂ«[\u0026#34;b\u0026#34;, {:th(1)}]â¤Â» has å£°æ˜ç¬¦ has ä½œç”¨åœ¨ç±»çš„å®ä¾‹æˆ– role çš„å±æ€§ä¸Š, è¿˜æœ‰ç±»æˆ– roles çš„æ–¹æ³•ä¸Šã€‚has éšå¼ä½œç”¨äºæ–¹æ³•ä¸Š, æ‰€ä»¥ has method x() {} å’Œ method x() {} åšå¾—æ˜¯ç›¸åŒçš„äº‹æƒ…ã€‚\næŸ¥çœ‹é¢å‘å¯¹è±¡è·å–æ›´å¤šæ–‡æ¡£å’Œä¾‹å­ã€‚\nhas method x( ) { } ç­‰ä»·äº:\nmethod x( ) { } anon å£°æ˜ç¬¦ anon å£°æ˜ç¬¦é˜»æ­¢ç¬¦å·æœ¬å®‰è£…åœ¨è¯æ³•ä½œç”¨åŸŸå†…, è¿˜æœ‰æ–¹æ³•è¡¨ä¸­, å’Œå…¶å®ƒä»»ä½•åœ°æ–¹. ä¾‹å¦‚, ä½ å¯ä»¥ä½¿ç”¨ anon å£°æ˜ä¸€ä¸ªçŸ¥é“è‡ªå·±åå­—çš„å­ä¾‹ç¨‹, ä½†æ˜¯ä»ç„¶ä¸ä¼šè¢«å®‰è£…åˆ°ä½œç”¨åŸŸå†…:\nmy %operations = half =\u0026gt; anon sub half($x) { $x / 2 }, square =\u0026gt; anon sub square($x) { $x * $x }, ; say %operations\u0026lt;square\u0026gt;.name; # square say %operations\u0026lt;square\u0026gt;(8); # 64 state å£°æ˜ç¬¦ state å£°æ˜è¯æ³•ä½œç”¨åŸŸå˜é‡, å°±åƒ my é‚£æ ·ã€‚ç„¶è€Œ, åˆå§‹åŒ–åªå‘ç”Ÿä¸€æ¬¡, å°±åœ¨æ­£å¸¸æ‰§è¡Œæµä¸­ç¬¬ä¸€æ¬¡é‡è§åˆå§‹åŒ–çš„æ—¶å€™ã€‚å› æ­¤, state å˜é‡ä¼šåœ¨é—­åˆå—æˆ– ç¨‹åºçš„å¤šæ¬¡æ‰§è¡Œä¹‹é—´ä¿ç•™å®ƒä»¬çš„å€¼ã€‚\nå› æ­¤, ä¸‹é¢è¿™ä¸ªå­ä¾‹ç¨‹:\nsub a { state @x; state $l = \u0026#39;A\u0026#39;; @x.push($l++); }; say a for 1..6; ä¼šæŒç»­å¢åŠ  $l å¹¶åœ¨æ¯æ¬¡è¢«è°ƒç”¨æ—¶æŠŠå®ƒè¿½åŠ åˆ° @x ä¸­, æ‰€ä»¥å®ƒä¼šæ‰“å°å‡º:\n[A] [A B] [A B C] [A B C D] [A B C D E] [A B C D E F] This works per \u0026ldquo;clone\u0026rdquo; of the containing code object, as in this example:\n({ state $i = 1; $i++.say; } xx 3).map: {$_(), $_()}; # says 1 then 2 thrice æ³¨æ„ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„è§£æ„, å½“åŒä¸€ä¸ª block çš„åŒä¸€ä¸ªå…‹éš†è¿è¡Œåœ¨å¤šä¸ªçº¿ç¨‹ä¸­æ—¶ã€‚è¦çŸ¥é“æ–¹æ³•åªæœ‰æ¯ä¸ªç±»ä¸€ä¸ªå…‹éš†ï¼Œè€Œä¸æ˜¯æ¯ä¸ªå¯¹è±¡ã€‚\nè‡³äº myï¼Œå£°æ˜å¤šä¸ªçŠ¶æ€å˜é‡å¿…é¡»æ”¾ç½®åœ¨åœ†æ‹¬å·ä¸­, è€Œå£°æ˜ä¸€ä¸ªå•ä¸€å˜é‡ï¼Œåœ†æ‹¬å·å¯ä»¥çœç•¥ã€‚\nè¯·æ³¨æ„ï¼Œè®¸å¤šæ“ä½œç¬¦éƒ½ä¼´éšç€éšå¼ç»‘å®šï¼Œä»€ä¹ˆä¼šå¯¼è‡´è¶…è·ä½œç”¨ã€‚ä½¿ç”¨ .clone æˆ–å¼ºè¿«åˆ›å»ºä¸€ä¸ªå¯ä»¥ç»‘å®šçš„æ–°å®¹å™¨ã€‚\nmy @a; sub f() { state $i; $i++; @a.push: \u0026#34;k$i\u0026#34; =\u0026gt; $i # \u0026lt;-- .clone goes here }; f for 1..3; dd @a; # Â«Array $var = $[:k1(3), :k2(3), :k3(3)]Â» æ‰€æœ‰çš„çŠ¶æ€å˜é‡éƒ½æ˜¯çº¿ç¨‹é—´å…±äº«çš„ã€‚è¿™ä¸ªç»“æœå¯èƒ½æ˜¯ä½ ä¸å¸Œæœ›å¾—åˆ°çš„æˆ–å±é™©çš„ã€‚\nsub code(){ state $i = 0; say ++$i; $i }; await start { loop { last if code() \u0026gt;= 5 } }, start { loop { last if code() \u0026gt;= 5 } }; # OUTPUTÂ«1â¤2â¤3â¤4â¤4â¤3â¤5â¤Â» # OUTPUTÂ«2â¤1â¤3â¤4â¤5â¤Â» # many other more or less odd variations can be produced $ å˜é‡ å’Œæ˜¾å¼åœ°å£°æ˜å‘½åçŠ¶æ€å˜é‡ä¸€æ ·, $ èƒ½å¤Ÿç”¨ä½œä¸å¸¦æ˜¾å¼çŠ¶æ€å£°æ˜çš„åŒ¿åçŠ¶æ€å˜é‡ã€‚\nsay \u0026#34;1-a 2-b 3-c\u0026#34;.subst(:g, /\\d/, {\u0026lt;one two three\u0026gt;[$++]}); # OUTPUTÂ«one-a two-b three-câ¤Â» æ›´è¿›ä¸€æ­¥, çŠ¶æ€å˜é‡ä¸éœ€è¦å­˜åœ¨äºå­ä¾‹ç¨‹ä¸­ã€‚ä½ å¯ä»¥, ä¸¾ä¸ªä¾‹å­, åœ¨å•è¡Œç¨‹åºä¸­ä½¿ç”¨ $ åœ¨æ–‡ä»¶ä¸­ç¼–å·è¡Œå·ã€‚\nraku -ne \u0026#39;say ++$ ~ \u0026#34; $_\u0026#34;\u0026#39; example.txt å®é™…ä¸Šè¯æ³•èŒƒå›´å†…æ¯ä¸ªå¯¹ $ çš„å¼•ç”¨éƒ½æ˜¯æ˜¯ä¸€ä¸ªå•ç‹¬çš„å˜é‡ã€‚\nraku -e \u0026#39;{ say ++$; say $++ } for ^5\u0026#39; # OUTPUTÂ«1â¤0â¤2â¤1â¤3â¤2â¤4â¤3â¤5â¤4â¤Â» å¦‚æœåœ¨ä½œç”¨åŸŸå†…ä½ éœ€è¦å¤šæ¬¡å¼•ç”¨ $ çš„å€¼, é‚£ä¹ˆå®ƒåº”è¯¥è¢«æ‹·è´åˆ°ä¸€ä¸ªæ–°çš„å˜é‡ä¸­ã€‚\nsub foo() { given ++$ { when 1 { say \u0026#34;one\u0026#34;; } when 2 { say \u0026#34;two\u0026#34;; } when 3 { say \u0026#34;three\u0026#34;; } default { say \u0026#34;many\u0026#34;; } } } foo() for ^3; # OUTPUTÂ«oneâ¤twoâ¤threeâ¤Â» @ å˜é‡ å’Œ $ å˜é‡ç±»ä¼¼, ä¹Ÿæœ‰ä¸€ä¸ªä½ç½®åŒ¿åçŠ¶æ€å˜é‡ @ã€‚\nsub foo($x) { say (@).push($x); } foo($_) for ^3; # OUTPUT: # [0] # [0 1] # [0 1 2] è¿™é‡Œçš„ @ æ˜¯ç”¨åœ†æ‹¬å·æ‹¬èµ·æ¥äº†ä»¥å’Œåä¸º @.push çš„ç±»æˆå‘˜å˜é‡æ¶ˆé™¤æ­§ä¹‰ã€‚ç´¢å¼•è®¿é—®å¹¶ä¸éœ€è¦è¿™ç§æ­§ä¹‰ï¼Œä½†ä½ éœ€è¦æ‹·è´è¿™ä¸ªå€¼ï¼Œä»¥ä¾¿ç”¨å®ƒåšä»»ä½•æœ‰ç”¨çš„äº‹æƒ…ã€‚\nsub foo($x) { my $v = @; $v[$x] = $x; say $v; } foo($_) for ^3; # OUTPUT: # [0] # [0 1] # [0 1 2] å°±å’Œ $ ä¸€æ ·, ä½œç”¨åŸŸä¸­çš„æ¯æ¬¡æåŠ @ å°±å¼•å…¥äº†ä¸€ä¸ªæ–°çš„åŒ¿åæ•°ç»„ã€‚\n% å˜é‡ æœ€å, è¿˜æœ‰ä¸€ä¸ªå…³è”åŒ¿åçŠ¶æ€å˜é‡ %ã€‚\nsub foo($x) { say (%).push($x =\u0026gt; $x); } foo($_) for ^3; # OUTPUT: # 0 =\u0026gt; 0 # 0 =\u0026gt; 0, 1 =\u0026gt; 1 # 0 =\u0026gt; 0, 1 =\u0026gt; 1, 2 =\u0026gt; 2 å…³äºæ­§ä¹‰çš„åŒæ ·è­¦å‘Šé€‚ç”¨ã€‚æ­£å¦‚ä½ å¯èƒ½æœŸæœ›ï¼Œç´¢å¼•è®¿é—®ä¹Ÿæœ‰å¯èƒ½ï¼ˆä½¿ç”¨å¤åˆ¶ä»¥ä½¿ä¹‹æœ‰ç”¨ï¼‰ã€‚\nsub foo($x) { my $v = %; $v{$x} = $x; say $v; } foo($_) for ^3; # OUTPUT: # 0 =\u0026gt; 0 # 0 =\u0026gt; 0, 1 =\u0026gt; 1 # 0 =\u0026gt; 0, 1 =\u0026gt; 1, 2 =\u0026gt; 2 å°±åƒå…¶å®ƒçš„åŒ¿åçŠ¶æ€å˜é‡ä¸€æ ·, åœ¨ç»™å®šä½œç”¨åŸŸä¸­æ¯æ¬¡æåŠ % æœ€ç»ˆéƒ½ä¼šå¼•å…¥ä¸€ä¸ªå•ç‹¬çš„å˜é‡ã€‚\naugment å£°æ˜ç¬¦ ä½¿ç”¨ augment, ä½ å¯ä»¥ç»™å·²ç»å­˜åœ¨çš„ç±»æˆ– grammars å¢åŠ å±æ€§å’Œæ–¹æ³•.\nå› ä¸ºç±»é€šå¸¸ä½¿ç”¨ our ä½œç”¨åŸŸ, å› æ­¤æ˜¯å…¨å±€çš„, è¿™æ„å‘³ç€ä¿®æ”¹å…¨å±€çŠ¶æ€, è¿™æ˜¯å¼ºçƒˆä¸é¼“åŠ±çš„, å¯¹äºå¤§éƒ¨åˆ†æƒ…å†µ, æœ‰æ›´å¥½çš„æ–¹æ³•.\n# don\u0026#39;t do this use MONKEY-TYPING; augment class Int { method is-answer { self == 42 } } say 42.is-answer; # True temp å‰ç¼€ åƒ my ä¸€æ ·, temp åœ¨ä½œç”¨åŸŸçš„æœ«å°¾æ¢å¤æ—§çš„å˜é‡å€¼. ç„¶è€Œ, temp ä¸åˆ›å»ºæ–°çš„å˜é‡.\nmy $in = 0; # temp will \u0026#34;entangle\u0026#34; the global variable with the call stack # that keeps the calls at the bottom in order. sub f(*@c) { (temp $in)++; \u0026#34;\u0026lt;f\u0026gt;\\n\u0026#34; ~ @c\u0026gt;\u0026gt;.indent($in).join(\u0026#34;\\n\u0026#34;) ~ (+@c ?? \u0026#34;\\n\u0026#34; !! \u0026#34;\u0026#34;) ~ \u0026#39;\u0026lt;/f\u0026gt;\u0026#39; }; sub g(*@c) { (temp $in)++; \u0026#34;\u0026lt;g\u0026gt;\\n\u0026#34; ~ @c\u0026gt;\u0026gt;.indent($in).join(\u0026#34;\\n\u0026#34;) ~ (+@c ?? \u0026#34;\\n\u0026#34; !! \u0026#34;\u0026#34;) ~ \u0026#34;\u0026lt;/g\u0026gt;\u0026#34; }; print g(g(f(g()), g(), f())); # OUTPUT: # \u0026lt;g\u0026gt; # \u0026lt;g\u0026gt; # \u0026lt;f\u0026gt; # \u0026lt;g\u0026gt; # \u0026lt;/g\u0026gt; # \u0026lt;/f\u0026gt; # \u0026lt;g\u0026gt; # \u0026lt;/g\u0026gt; # \u0026lt;f\u0026gt; # \u0026lt;/f\u0026gt; # \u0026lt;/g\u0026gt; # \u0026lt;/g\u0026gt; let å‰ç¼€ è·Ÿ temp ç±»ä¼¼, å¦‚æœ block æ²¡æœ‰æˆåŠŸé€€å‡ºåˆ™æ¢å¤ä¹‹å‰çš„å€¼ã€‚æˆåŠŸçš„é€€å‡ºæ„å‘³ç€è¯¥ block è¿”å›äº†ä¸€ä¸ªå®šä¹‰è¿‡çš„å€¼æˆ–ä¸€ä¸ªåˆ—è¡¨ã€‚\nmy $answer = 42; { let $answer = 84; die if not Bool.pick; CATCH { default { say \u0026#34;it\u0026#39;s been reset :(\u0026#34; } } say \u0026#34;we made it 84 sticks!\u0026#34;; } say $answer; åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, å¦‚æœ Bool.pick è¿”å› true, é‚£ä¹ˆç­”æ¡ˆä¼šä¿æŒä¸º 84, å› ä¸ºé‚£ä¸ª block è¿”å›äº†ä¸€ä¸ªå®šä¹‰äº†çš„å€¼(say è¿”å› true)ã€‚ å¦åˆ™é‚£ä¸ª die è¯­å¥ä¼šè®©é‚£ä¸ª block ä¸æˆåŠŸåœ°é€€å‡º, æŠŠç­”æ¡ˆé‡æ–°è®¾ç½®ä¸º 42ã€‚\nç±»å‹çº¦æŸå’Œåˆå§‹åŒ– å˜é‡å¯ä»¥æœ‰ç±»å‹çº¦æŸ, çº¦æŸåœ¨å£°æ˜ç¬¦å’Œå˜é‡åä¹‹é—´:\nmy Int $x = 42; $x = \u0026#39;a string\u0026#39;; # throws an X::TypeCheck::Assignment error CATCH { default { put .^name, \u0026#39;: \u0026#39;, .Str } } # OUTPUT: X::TypeCheck::Assignment: Type check failed in assignment to $x; expected Int but got Str (\u0026#34;a string\u0026#34;) å¦‚æœä¸€ä¸ªæ ‡é‡æœ‰ç±»å‹çº¦æŸä½†æ˜¯æ²¡æœ‰åˆå§‹å€¼, å®ƒä¼šä½¿ç”¨ç±»å‹çº¦æŸçš„ç±»å‹å¯¹è±¡æ¥åˆå§‹åŒ–.\nmy Int $x; say $x.^name; # Int say $x.defined; # False æ²¡æœ‰æ˜¾å¼ç±»å‹çº¦æŸçš„æ ‡é‡çš„ç±»å‹ä¸º Mu, ä½†æ˜¯é»˜è®¤ä¼šæ˜¯ Any ç±»å‹çš„å¯¹è±¡.\nå¸¦æœ‰ @ ç¬¦å·çš„å˜é‡ä¼šè¢«åˆå§‹åŒ–ä¸ºç©ºçš„æ•°ç»„; å¸¦æœ‰ % ç¬¦å·çš„å˜é‡ä¼šè¢«åˆå§‹åŒ–ä¸ºç©ºçš„æ•£åˆ—.\nå˜é‡çš„é»˜è®¤å€¼å¯ä»¥ä½¿ç”¨ is default ç‰¹æ€§è®¾ç½®, é€šè¿‡æŠŠ Nil èµ‹å€¼ç»™å˜é‡æ¥é‡æ–°åº”ç”¨é»˜è®¤å€¼:\nmy Real $product is default(1); say $product; # 1 $produce *= 5; say $product; # 5 $product = Nil; say $product; # 1 é»˜è®¤çš„æœ‰å®šä¹‰çš„å˜é‡æŒ‡ä»¤ ä¸ºäº†å¼ºåˆ¶æ‰€æœ‰çš„å˜é‡æ‹¥æœ‰ä¸€ä¸ªæœ‰å®šä¹‰çš„çº¦æŸ, ä½¿ç”¨ use variables :D æŒ‡ä»¤ã€‚è¿™ä¸ªæŒ‡ä»¤æ˜¯è¯æ³•ä½œç”¨åŸŸçš„å¹¶ä¸”å¯ä»¥ä½¿ç”¨ use variables :_ æŒ‡ä»¤è¿›è¡Œåˆ‡æ¢ã€‚\nuse variables :D; my Int $i; # OUTPUTÂ«===SORRY!=== Error while compiling \u0026lt;tmp\u0026gt;â¤Variable definition of type Int:D (implicit :D by pragma) requires an initializer ... my Int $i = 1; # that works { use variables :_; my Int $i; } # åœ¨è¿™ä¸ª block ä¸­å…³æ‰å®ƒ è¯·æ³¨æ„, èµ‹å€¼ Nil ä¼šæŠŠè¿™ä¸ªå˜é‡æ¢å¤ä¸ºå®ƒçš„é»˜è®¤å€¼ã€‚ä¸€ä¸ªæœ‰å®šä¹‰çš„çº¦æŸç±»å‹çš„é»˜è®¤å€¼æ˜¯ç±»å‹ååŠ ä¸Š :D(ä¾‹å¦‚ Int:D)ã€‚That means a definedness contraint is no guarantee of definedness. è¿™åªé€‚ç”¨äºå˜é‡åˆå§‹åŒ–, ä¸é€‚ç”¨äºç­¾åã€‚\nç‰¹æ®Šå˜é‡ Pre-defined lexical variables\næ¯ä¸ªä»£ç å—ä¸­éƒ½æœ‰3ä¸ªç‰¹åˆ«çš„å˜é‡:\n   å˜é‡ æ„ä¹‰     $_ ç‰¹æ®Šå˜é‡   $/ æ­£åˆ™åŒ¹é…   $! å¼‚å¸¸    $_ $_ æ˜¯ç‰¹æ®Šå˜é‡ï¼Œåœ¨æ²¡æœ‰æ˜¾å¼æ ‡è¯†çš„ä»£ç å—ä¸­ï¼Œå®ƒæ˜¯é»˜è®¤å‚æ•°ã€‚æ‰€ä»¥è¯¸å¦‚ for @array { ... } å’Œ given $var { ... } ä¹‹ç±»çš„ç»“æ„ä¼šå°†å˜é‡ç»‘å®šç»™ $_.\nfor \u0026lt;a b c\u0026gt; { say $_ } # sets $_ to \u0026#39;a\u0026#39;, \u0026#39;b\u0026#39; and \u0026#39;c\u0026#39; in turn say $_ for \u0026lt;a b c\u0026gt;; # same, even though it\u0026#39;s not a block given \u0026#39;a\u0026#39; { say $_ } # sets $_ to \u0026#39;a\u0026#39; say $_ given \u0026#39;a\u0026#39;; # same, å°½ç®¡è¿™ä¸æ˜¯ä¸€ä¸ªå— CATCH å—å°† $_ è®¾ç½®ä¸ºæ•è·åˆ°çš„å¼‚å¸¸ã€‚ ~~ æ™ºèƒ½åŒ¹é…æ“ä½œç¬¦ã€‚ å¯¹ $_ è°ƒç”¨ä¸€ä¸ªæ–¹æ³•å¯ä»¥çœç•¥ç‰¹æ®Šå˜é‡ $_ çš„åå­—ï¼Œä»è€Œå†™çš„æ›´çŸ­ï¼š\n.say; # ä¸ $_.say ç›¸åŒ m/regex/ å’Œ /regex/ æ­£åˆ™åŒ¹é… å’Œ s/regex/subst/ æ›¿æ¢æ˜¯ä½œç”¨äº $_ ä¸Šçš„.\nsay \u0026#34;Looking for strings with non-alphabetic characters...\u0026#34;; for \u0026lt;ab:c d$e fgh ij*\u0026gt; { .say if m/\u0026lt;!alpha\u0026gt;/; } è¾“å‡º:\nLooking for strings with non-alphabetic characters... ab:c d$e ij* $/ $/ æ˜¯åŒ¹é…å˜é‡ã€‚å®ƒå­˜å‚¨ç€æœ€è¿‘ä¸€æ¬¡æ­£åˆ™åŒ¹é…çš„ç»“æœï¼Œé€šå¸¸åŒ…å« Match ç±»å‹çš„å¯¹è±¡ã€‚\n\u0026#39;abc 12\u0026#39; ~~ /\\w+/; # è®¾ç½® $/ ä¸ºä¸€ä¸ªMatch å¯¹è±¡ say $/.Str; # abc Grammar.parse æ–¹æ³•ä¼šæŠŠè°ƒç”¨è€…çš„ $/ è®¾ç½®ä¸º Match object çš„ç»“æœã€‚çœ‹ä¸‹é¢çš„ä»£ç :\nuse XML::Grammar; # panda install XML XML.Grammar.parse(\u0026#34;\u0026lt;p\u0026gt;some text\u0026lt;/p\u0026gt;\u0026#34;); say $/; # OUTPUT: # ï½¢\u0026lt;p\u0026gt;some text\u0026lt;/p\u0026gt;ï½£ # root =\u0026gt; ï½¢\u0026lt;p\u0026gt;some text\u0026lt;/p\u0026gt;ï½£ # name =\u0026gt; ï½¢pï½£ # child =\u0026gt; ï½¢some textï½£ # text =\u0026gt; ï½¢some textï½£ # textnode =\u0026gt; ï½¢some textï½£ # element =\u0026gt; ï½¢\u0026lt;p\u0026gt;some text\u0026lt;/p\u0026gt;ï½£ # name =\u0026gt; ï½¢pï½£ # child =\u0026gt; ï½¢some textï½£ # text =\u0026gt; ï½¢some textï½£ # textnode =\u0026gt; ï½¢some textï½£ å…¶ä»–åŒ¹é…å˜é‡æ˜¯ $/ å…ƒç´ çš„åˆ«åï¼š\n$0 # same as $/[0] $1 # same as $/[1] $\u0026lt;named\u0026gt; # same as $/\u0026lt;named\u0026gt; ä½ç½®å±æ€§ å¦‚æœæ­£åˆ™ä¸­æœ‰æ•è·åˆ†ç»„, $/ ä¸­ä¼šæœ‰ä½ç½®å±æ€§. å®ƒä»¬ç”±åœ†æ‹¬å·ç»„æˆ.\n\u0026#39;abbbbbcdddddeffg\u0026#39; ~~ /a (b+)c (d+ef+)g /; say $/[0]; # ï½¢bbbbbï½£ say $/[1]; # ï½¢dddddeffï½£ è¿™äº›æ•è·åˆ†ç»„ä¹Ÿèƒ½ä½¿ç”¨ $0,$1,$2 ç­‰ä¾¿æ·å½¢å¼å–å¾—:\nsay $0; # ï½¢bbbbbï½£ say $1; # ï½¢dddddeffï½£ è¦è·å–æ‰€æœ‰çš„ä½ç½®å±æ€§, ä½¿ç”¨ $/.list, @$/,@( ) ä¸­çš„ä»»æ„ä¸€ä¸ªéƒ½å¯ä»¥:\nsay @().join; # bbbbbdddddeff å‘½åå±æ€§ å¦‚æœæ­£åˆ™ä¸­æœ‰å‘½åæ•è·åˆ†ç»„, $/ å¯ä»¥æœ‰å‘½åå±æ€§, æˆ–è€…æ­£åˆ™è°ƒç”¨äº†å¦ä¸€ä¸ªæ­£åˆ™:\n\u0026#39;I.... see?\u0026#39; ~~ /\\w+$\u0026lt;punctuation\u0026gt;=[\u0026lt;-[\\w\\s]\u0026gt;+]\\s*$\u0026lt;final-word\u0026gt;=[\\w+.]/; say $/\u0026lt;punctuation\u0026gt;; # ï½¢....ï½£ say $/\u0026lt;final-word\u0026gt;; # ï½¢see?ï½£ è¿™äº›å‘½åæ•è·åˆ†ç»„ä¹Ÿèƒ½ä½¿ç”¨ä¾¿æ·å½¢å¼çš„ $\u0026lt;named\u0026gt; è·å–:\nsay $\u0026lt;punctuation\u0026gt;; # ï½¢....ï½£ say $\u0026lt;final-word\u0026gt;; # ï½¢see?ï½£ è¦è·å–æ‰€æœ‰çš„å‘½åå±æ€§, ä½¿ç”¨ $/.hash, %$/, %()ä¸­çš„ä»»ä½•ä¸€ä¸ª:\nsay %().join; # \u0026#34;punctuation ....final-word see?\u0026#34; $! å˜é‡ $! æ˜¯é”™è¯¯å˜é‡. å¦‚æœ try block æˆ–è¯­å¥å‰ç¼€æ•è·åˆ°å¼‚å¸¸, é‚£ä¸ªå¼‚å¸¸å°±ä¼šè¢«å­˜å‚¨åœ¨ $! ä¸­ã€‚å¦‚æœæ²¡æœ‰æ•è·åˆ°å¼‚å¸¸, é‚£ä¹ˆ $! ä¼šè¢«è®¾ç½®ä¸º Any ç±»å‹å¯¹è±¡ã€‚ æ³¨æ„, CATCH å—ä¸è®¾ç½® $!ã€‚CATCH åœ¨ block ä¸­æŠŠ $_ è®¾ç½®ä¸ºæ•è·åˆ°çš„å¼‚å¸¸ã€‚\nç¼–è¯‘æ—¶å˜é‡    Compile-time Variables è¯´æ˜     $?FILE æ‰€åœ¨æ–‡ä»¶   $?LINE æ‰€åœ¨è¡Œ   ::?CLASS æ‰€åœ¨ç±»   \u0026amp;?ROUTINE æ‰€åœ¨å­ä¾‹ç¨‹   \u0026amp;?BLOCK æ‰€åœ¨å—   %?LANG What is the current set of interwoven languages?   %?RESOURCES The files associated with the \u0026ldquo;Distribution\u0026rdquo; of the current compilation unit.    for \u0026#39;.\u0026#39; { .Str.say when !.IO.d; .IO.dir()\u0026gt;\u0026gt;.\u0026amp;?BLOCK when .IO.d # lets recurse a little! } å…¶å®ƒç¼–è¯‘æ—¶å˜é‡ï¼š\n   Compile-time Variables è¯´æ˜     $?PACKAGE æ‰€åœ¨åŒ…   $?MODULE æ‰€åœ¨æ¨¡å—   $?CLASS æ‰€åœ¨ç±»(as variable)   $?ROLE æ‰€åœ¨è§’è‰²(as variable)   $?GRAMMAR æ‰€åœ¨ grammar   $?TABSTOP åœ¨ heredoc æˆ– è™šæ‹Ÿè¾¹è·ä¸­ tab æœ‰å¤šå°‘ç©ºæ ¼   $?USAGE ä» MAIN ç¨‹åºçš„ç­¾åä¸­ç”Ÿæˆçš„ä½¿ç”¨ä¿¡æ¯   $?ENC Str.encode/Buf.decode/various IO æ–¹æ³•çš„é»˜è®¤ç¼–ç .    åŠ¨æ€å˜é‡    Dynamic Variable è¯´æ˜     $*ARGFILES ç¥å¥‡çš„å‘½ä»¤è¡Œè¾“å…¥å¥æŸ„   @*ARGS æ¥è‡ªå‘½ä»¤è¡Œçš„å‚æ•°   $*IN æ ‡å‡†è¾“å…¥æ–‡ä»¶å¥æŸ„, AKA stdin   $*OUT æ ‡å‡†è¾“å‡ºæ–‡ä»¶å¥æŸ„, AKA stdout   $*ERR æ ‡å‡†é”™è¯¯æ–‡ä»¶å¥æŸ„, AKA stderr   %*ENV ç¯å¢ƒå˜é‡   $*REPO å­˜å‚¨å®‰è£…è¿‡çš„/åŠ è½½äº†çš„æ¨¡å—ä¿¡æ¯çš„å˜é‡   $*TZ ç³»ç»Ÿçš„æœ¬åœ°æ—¶åŒº.   $*CWD å½“å‰å·¥ä½œç›®å½•.   $*KERNEL åœ¨å“ªä¸ªå†…æ ¸ä¸‹è¿è¡Œ   $*DISTRO åœ¨å“ªä¸ªæ“ä½œç³»ç»Ÿåˆ†å‘ä¸‹è¿è¡Œ   $*VM åœ¨å“ªä¸ªè™šæ‹Ÿæœºä¸‹è¿è¡Œ   $*PERL åœ¨å“ªä¸ª Perl ä¸‹è¿è¡Œ   $*PID å½“å‰è¿›ç¨‹çš„è¿›ç¨‹ ID   $*PROGRAM-NAME å½“å‰å¯æ‰§è¡Œç¨‹åºçš„è·¯å¾„å°±åƒå®ƒé€šè¿‡å‘½ä»¤è¡Œé”®å…¥ä¸€æ ·, æˆ– -e å¦‚æœ perl å¼•ç”¨äº† -e æ ‡è®°   $*PROGRAM æ­£è¢«æ‰§è¡Œçš„ Perl ç¨‹åºçš„ä½ç½®( ä»¥ IO::Path å¯¹è±¡çš„å½¢å¼)   $*EXECUTABLE å½“å‰è¿è¡Œçš„å¯æ‰§è¡Œ perl çš„ç»å¯¹è·¯å¾„   $*EXECUTABLE-NAME å½“å‰è¿è¡Œçš„å¯æ‰§è¡Œ perl ç¨‹åºçš„åå­—ã€‚(e.g. raku-p, raku-m, Niecza.exe)   $*USER æ­£åœ¨è¿è¡Œè¯¥ç¨‹åºçš„ç”¨æˆ·. å®ƒæ˜¯ä¸€ä¸ªè¢«æ±‚å€¼ä¸º \u0026ldquo;username (uid)\u0026rdquo; çš„å¯¹è±¡. å®ƒåªæœ‰åœ¨è¢«å½“ä½œå­—ç¬¦ä¸²æ—¶æ‰è¢«æ±‚å€¼ä¸ºç”¨æˆ·å, å¦‚æœè¢«å½“ä½œæ•°å­—åˆ™è¢«æ±‚å€¼ä¸ºæ•°å€¼åŒ–çš„ç”¨æˆ· idã€‚   $*GROUP è¿è¡Œç¨‹åºçš„ç”¨æˆ·çš„ä¸»è¦ç»„. å®ƒæ˜¯è¢«è®¡ç®—ä¸º \u0026ldquo;groupname (gid)\u0026rdquo; çš„å¯¹è±¡.å®ƒåªæœ‰åœ¨è¢«å½“ä½œå­—ç¬¦ä¸²æ—¶æ‰è¢«æ±‚å€¼ä¸ºç»„å, å¦‚æœè¢«å½“ä½œæ•°å­—åˆ™è¢«æ±‚å€¼ä¸ºæ•°å€¼åŒ–çš„ç»„ idã€‚   $*HOME ä»£è¡¨å½“å‰è¿è¡Œç¨‹åºçš„ç”¨æˆ·å®¶ç›®å½•çš„ IO::Path å¯¹è±¡ã€‚å¦‚æœå®¶ç›®å½•ä¸ç¡®å®šåˆ™ä¸º Nilã€‚   $*SPEC ç¨‹åºè¿è¡Œçš„å¹³å°çš„åˆé€‚çš„ IO::Spec å­ç±», å¯¹äºç‰¹å®šæ“ä½œç³»ç»Ÿä»£ç ,ä½¿ç”¨æ™ºèƒ½åŒ¹é…: say \u0026ldquo;We are on Windows!\u0026rdquo; if $*SPEC ~~ IO::Spec::Win32   $*TMPDIR ä»£è¡¨ç€ \u0026ldquo;ç³»ç»Ÿä¸´æ—¶ç›®å½•\u0026rdquo; çš„ IO::Path å¯¹è±¡   $*TOLERANCE ç”± \u0026lt;=~=\u0026gt; æ“ä½œç¬¦ä½¿ç”¨å¹¶ä¸”ä»»ä½•ä¾èµ–å®ƒçš„æ“ä½œ, æ¥å†³å®šä¸¤ä¸ªå€¼æ˜¯å¦è¿‘ä¼¼åœ°ç›¸ç­‰, é»˜è®¤ä¸º 1e-15ã€‚   $*THREAD ä»£è¡¨å½“å‰æ‰§è¡Œçº¿ç¨‹çš„ Thread å¯¹è±¡ã€‚   $*SCHEDULER ä»£è¡¨å½“å‰é»˜è®¤è°ƒåº¦ç¨‹åºçš„ ThreadPoolScheduler å¯¹è±¡ã€‚    æ³¨æ„ $*SCHEDULER çš„ç”¨æ³•:\nå¯¹äºå½“å‰çš„ Rakudo, è¿™ä¸ªé»˜è®¤åœ¨æ–¹æ³• .hyper å’Œ .race ä¸Šé‡‡ç”¨æœ€å¤§ 16 ä¸ªçº¿ç¨‹ã€‚è¦æ›´æ”¹çº¿ç¨‹çš„æœ€å¤§æ•°é‡, è¦ä¹ˆåœ¨è¿è¡Œ perl ä¹‹å‰è®¾ç½®ç¯å¢ƒå˜é‡ RAKUDO_MAX_THREADS çš„å€¼, è¦ä¹ˆåœ¨ä½¿ç”¨ .hyper æˆ– .race ä¹‹å‰åˆ›å»ºä¸€ä¸ªé»˜è®¤æ”¹å˜äº†çš„ä½œç”¨åŸŸçš„æ‹·è´:\nmy $*SCHEDULER = ThreadPoolScheduler.new( max_threads =\u0026gt; 64 ); è¿™ç§è¡Œä¸ºåœ¨ spec æµ‹è¯•ä¸­æ²¡æœ‰è¢«æµ‹è¯•å¹¶ä¸”è¿˜ä¼šå˜åŒ–ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2015-08-25-variables-in-raku/","tags":["variable"],"title":"Raku ä¸­çš„å˜é‡"},{"categories":["rakulang"],"contents":"é™¤äº† q å’Œ qq ä¹‹å¤–ï¼Œç°åœ¨è¿˜æœ‰ä¸€ç§åŸºæœ¬å½¢å¼çš„ Qï¼Œå®ƒä¸ä¼šè¿›è¡Œæ’å€¼ï¼Œé™¤éæ˜¾å¼åœ°ä¿®æ”¹å®ƒé‚£æ ·åšã€‚æ‰€ä»¥ï¼Œq å®é™…ä¸Šæ˜¯ Q:q çš„ç®€ç§°ï¼Œqq å®é™…ä¸Šæ˜¯ Q:qq çš„ç®€ç§°ã€‚å®é™…ä¸Šæ‰€æœ‰çš„ quote-like å½¢å¼éƒ½æ´¾ç”Ÿè‡ªå¸¦æœ‰å‰¯è¯çš„ Q å½¢å¼ï¼š\nS02-literals/quoting.t lines 95â€“116 S02-literals/quoting.t lines 132â€“139\nq// Q :q // qq// Q :qq // rx// Q :regex // s/// Q :subst /// tr/// Q :trans /// è¯¸å¦‚ :regex çš„å‰¯è¯é€šè¿‡è½¬æ¢åˆ°ä¸åŒçš„è§£æå™¨æ”¹å˜äº†è¯­è¨€çš„è§£æã€‚è¿™èƒ½å®Œå…¨æ”¹å˜ä»»ä½•ä¹‹åçš„å‰¯è¯è¿˜æœ‰æ‰€å¼•èµ·çš„ä¸œè¥¿è‡ªèº«çš„è§£é‡Šã€‚\nq:s//Q :q :scalar  rx:s//Q :regex:scalar// å°±åƒ q[...] æ‹¥æœ‰ç®€å†™å½¢å¼çš„ \u0026lsquo;\u0026hellip;\u0026rsquo;, å¹¶ä¸” qq[...] æ‹¥æœ‰ç®€å†™å½¢å¼çš„ \u0026ldquo;\u0026hellip;\u0026rdquo; ä¸€æ ·ï¼Œå®Œæ•´çš„ Q[...] å¼•ç”¨ä¹Ÿæœ‰ä¸€ç§ä½¿ç”¨åŠè§’æ‹¬å· ï½¢\u0026hellip;ï½£ çš„çŸ­å½¢å¼ã€‚\nå¼•å·ä¸Šçš„å‰¯è¯ å¹¿ä¹‰ä¸Šçš„å¼•å·ç°åœ¨å¯ä»¥æ¥æ”¶å‰¯è¯äº†ï¼š\n S02-literals/quoting.t lines 210â€“223 S02-literals/quoting.t lines 55â€“69 S02-literals/quoting.t lines 427â€“501  Short Long Meaning ===== ==== ======= :x :exec ä½œä¸ºå‘½ä»¤æ‰§è¡Œå¹¶è¿”å›ç»“æœ :w :words æŒ‰å•è¯åˆ†å‰²ç»“æœ(æ²¡æœ‰å¼•å·ä¿æŠ¤) :ww :quotewords æŒ‰å•è¯åˆ†å‰²ç»“æœ (å¸¦æœ‰å¼•å·ä¿æŠ¤) :v :val Evaluate word or words for value literals :q :single æ’å€¼ \\\\, \\q å’Œ \\' (or whatever) :qq :double ä½¿ç”¨ :s, :a, :h, :f, :c, :b è¿›è¡Œæ’å€¼ :s :scalar æ’å€¼ $ vars :a :array æ’å€¼ @ vars :h :hash æ’å€¼ % vars :f :function æ’å€¼ \u0026amp; è°ƒç”¨ :c :closure æ’å€¼ {...} è¡¨è¾¾å¼ :b :backslash æ’å€¼ \\n, \\t, ç­‰. (è‡³å°‘æš—ç¤ºäº† :q ) :to :heredoc æŠŠç»“æœè§£æä¸º heredoc ç»ˆæ­¢ç¬¦ :regex è§£æä¸ºæ­£åˆ™è¡¨è¾¾å¼ :subst è§£æä¸ºç½®æ¢ (substitution) :trans è§£æä¸ºè½¬æ¢ (transliteration) :code Quasiquoting :p :path è¿”å›ä¸€ä¸ª Path å¯¹è±¡ (æŸ¥çœ‹ S16 è·å–æ›´å¤šé€‰é¡¹) é€šè¿‡åœ¨å¼€å¤´åŠ å…¥ä¸€ä¸ªå¸¦æœ‰çŸ­å½¢å¼çš„å•ä¸ªå‰¯è¯çš„ Qï¼Œqï¼Œæˆ– qqï¼Œä½ å¯ä»¥çœç•¥æ‰ç¬¬ä¸€ä¸ªå†’å·ï¼Œè¿™äº§ç”Ÿäº†å¦‚ä¸‹å½¢å¼ï¼š\nqw /a b c; # P5-esque qw// meaning q:w Qc \u0026#39;...{$x}...; # Q:c//, interpolate only closures qqx/$cmd@args[] # equivalent to P5\u0026#39;s qx// (æ³¨æ„ qx// ä¸æ’å€¼)\nå¦‚æœä½ æƒ³è¿›ä¸€æ­¥ç¼©å†™ï¼Œé‚£ä¹ˆå®šä¹‰ä¸€ä¸ªå®ï¼š\nmacro qx {\u0026#39;qq:x \u0026#39; } # equivalent to P5\u0026#39;s qx// macro qTO { \u0026#39;qqâŒw:to \u0026#39; } # qqâŒw:to// macro quote:\u0026lt;â° â±\u0026gt; ($text) { quasi { {{{$text}}}.quoteharder } } æ‰€æœ‰å¤§å†™çš„å‰¯è¯è¢«ä¿ç•™ç”¨ä½œç”¨æˆ·å®šä¹‰çš„å¼•å·ã€‚æ‰€æœ‰åœ¨ Latin-1 ä¸Šé¢çš„ Unicode åˆ†éš”ç¬¦è¢«ä¿ç•™ç”¨ä½œç”¨æˆ·å®šä¹‰çš„å¼•å·ã€‚ S02-literals/quoting.t lines 352â€“426\nå…³äºä¸Šé¢æˆ‘ä»¬ç°åœ¨æœ‰äº†ä¸€ä¸ªæ¨è®ºï¼Œæˆ‘ä»¬ç°åœ¨èƒ½è¯´ï¼š\n%hash = qw:c/a b c d {@array}{%hash}; æˆ–ï¼š\n%hash = qq:w/a b c d {@array}{%hash}; æŠŠä¸œè¥¿(items)æ’å€¼åˆ° qw ä¸­ã€‚é»˜è®¤åœ°ï¼Œæ•°ç»„å’Œæ•£åˆ—åœ¨æ’å€¼æ—¶åªå¸¦æœ‰ç©ºæ ¼åˆ†éš”ç¬¦ï¼Œæ‰€ä»¥ä¹‹åçš„æŒ‰ç©ºæ ¼åˆ†å‰²ä»æ—§èƒ½å·¥ä½œã€‚ï¼ˆä½†æ˜¯å†…ç½®çš„ Â«\u0026hellip;Â» å¼•å·è‡ªåŠ¨è¿›è¡Œäº†ç­‰ä»·äº qq:ww:v/.../ çš„æ’å€¼ï¼‰ã€‚ å†…ç½®çš„ \u0026lt;...\u0026gt; ç­‰ä»·äº q:w:v/.../ã€‚\nThe Q Lang åœ¨ Raku ä¸­, å­—ç¬¦ä¸²é€šå¸¸ä½¿ç”¨ä¸€äº›å¼•å·ç»“æ„æ¥è¡¨ç¤ºã€‚è¿™äº›å¼•å·ç»“æ„ä¸­,æœ€ç®€å•çš„å°±æ˜¯ Q, é€šè¿‡ä¾¿æ·æ–¹å¼ ï½¢â€¦ï½£ æˆ– Q åè·Ÿç€ç”±ä»»æ„ä¸€å¯¹å„¿åˆ†éš”ç¬¦åŒ…å›´ç€çš„æ–‡æœ¬ã€‚å¤§å¤šæ•°æ—¶å€™, ä½ éœ€è¦çš„åªæ˜¯ 'â€¦' æˆ– \u0026quot;â€¦\u0026quot;.\nLiteral strings: Q Q[A literal string] ï½¢More plainly.ï½£ Q ^Almost any non-word character can be a delimiter!^ Q ï½¢ï½¢Delimiters can be repeated/nested if they are adjacent.ï½£ï½£ åˆ†éš”ç¬¦èƒ½å¤ŸåµŒå¥—, ä½†æ˜¯åœ¨æ™®é€šçš„ Q å½¢å¼ä¸­, åæ–œçº¿è½¬ä¹‰æ˜¯ä¸å…è®¸çš„ã€‚æ¢ç§è¯´æ³•å°±æ˜¯, Q å­—ç¬¦ä¸²å°½å¯èƒ½è¢«ä½œä¸ºå­—é¢é‡ã€‚\nåœ¨ Qã€q æˆ– qq ä¹‹åä¸å…è®¸ç«‹å³ä½¿ç”¨ä¸€äº›åˆ†éš”ç¬¦ã€‚æ ‡è¯†ç¬¦ä¸­å…è®¸çš„ä»»ä½•å­—ç¬¦éƒ½ä¸å…è®¸ä½¿ç”¨ï¼Œå› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¼•å·ç»“æ„å’Œè¿™äº›å­—ç¬¦ä¸€èµ·è¢«è§£é‡Šä¸ºæ ‡è¯†ç¬¦ã€‚æ­¤å¤–ï¼Œ( ) æ˜¯ä¸å…è®¸çš„ï¼Œå› ä¸ºå®ƒè¢«è§£é‡Šä¸ºå‡½æ•°è°ƒç”¨ã€‚å¦‚æœä½ ä»ç„¶å¸Œæœ›ä½¿ç”¨è¿™äº›å­—ç¬¦ä½œä¸ºåˆ†éš”ç¬¦ï¼Œè¯·ç”¨ç©ºæ ¼å°†å®ƒä»¬ä¸ Qã€q æˆ– qq åˆ†éš”å¼€ã€‚è¯·æ³¨æ„ï¼Œä¸€äº›è‡ªç„¶è¯­è¨€åœ¨å­—ç¬¦ä¸²çš„å³ä¾§ä½¿ç”¨å·¦åˆ†éš”å¼•å·ã€‚Q ä¸æ”¯æŒè¿™äº›ï¼Œå› ä¸ºå®ƒä¾èµ– unicode å±æ€§æ¥åŒºåˆ†å·¦åˆ†éš”ç¬¦å’Œå³åˆ†éš”ç¬¦ã€‚\nQ'this will not work!' Q(this won't work either!) ä¸Šé¢å¯¹ä¾‹å­ä¼šäº§ç”Ÿé”™è¯¯ã€‚ç„¶è€Œï¼Œä¸‹é¢è¿™ä¸ªèƒ½èµ·ä½œç”¨ï¼š\nQ (this is fine, because of space after Q) Q 'and so is this' Q\u0026lt;Make sure you \u0026lt;match\u0026gt; opening and closing delimiters\u0026gt; Q{This is still a closing curly brace â†’ \\} è¿™äº›ä¾‹å­äº§ç”Ÿï¼š\nthis is fine, because of space after Q and so is this Make sure you \u0026lt;match\u0026gt; opening and closing delimiters This is still a closing curly brace â†’ \\ å¼•å·ç»“æ„çš„è¡Œä¸ºå¯ä»¥ç”¨å‰¯è¯ä¿®æ”¹ï¼Œåé¢çš„ç« èŠ‚ä¼šè¯¦ç»†è§£é‡Šã€‚\n   Short Long Meaning     :x :exec Execute as command and return results   :w :words Split result on words (no quote protection)   :ww :quotewords Split result on words (with quote protection)   :q :single Interpolate \\, \\qq[\u0026hellip;] and escaping the delimiter with \\   :qq :double Interpolate with :s, :a, :h, :f, :c, :b   :s :scalar Interpolate $ vars   :a :array Interpolate @ vars   :h :hash Interpolate % vars   :f :function Interpolate \u0026amp; calls   :c :closure Interpolate {\u0026hellip;} expressions   :b :backslash Enable backslash escapes (\\n, \\qq, $foo, etc)   :to :heredoc Parse result as heredoc terminator   :v :val Convert to allomorph if possible    Escaping: q 'Very plain'; q[This back\\slash stays]; q[This back\\\\slash stays]; # Identical output q{This is not a closing curly brace â†’ \\}, but this is â†’ }; Q :q $There are no backslashes here, only lots of \\$\\$\\$\u0026gt;!$; '(Just kidding. There\\'s no money in that string)'; 'No $interpolation {here}!'; Q:q!Just a literal \u0026quot;\\n\u0026quot; here!; q å½¢å¼çš„å¼•å·ç»“æ„å…è®¸ä½¿ç”¨åæ–œçº¿è½¬ä¹‰å¯èƒ½ä¼šç»“æŸå­—ç¬¦ä¸²çš„å­—ç¬¦. åæ–œçº¿è‡ªèº«ä¹Ÿèƒ½è¢«è½¬ä¹‰, å°±åƒä¸Šé¢çš„ç¬¬ä¸‰ä¸ªä¾‹å­é‚£æ ·. é€šå¸¸çš„å½¢å¼æ˜¯ '...' æˆ– q åè·Ÿç€åˆ†éš”ç¬¦, ä½†æ˜¯å®ƒä¹Ÿèƒ½ä½œä¸º Q ä¸Šçš„å‰¯è¯ä½¿ç”¨, å°±åƒä¸Šé¢çš„ç¬¬äº”ä¸ªå’Œæœ€åä¸€ä¸ªä¾‹å­é‚£æ ·.\nè¿™äº›ä¾‹å­äº§ç”Ÿ:\nVery plain This back\\slash stays This back\\slash stays This is not a closing brace â†’ } but this is â†’ There are no backslashes here, only lots of $$$! (Just kidding. There's no money in that string) No $interpolation {here}! Just a literal \u0026quot;\\n\u0026quot; here \\qq[...] è½¬ä¹‰åºåˆ—å…è®¸ qq æ’å€¼ çš„ä¸€éƒ¨åˆ†å­—ç¬¦ä¸²ã€‚å½“å­—ç¬¦ä¸²ä¸­æœ‰ HTML æ ‡è®°æ—¶ï¼Œä½¿ç”¨è¿™ä¸ªè½¬ä¹‰åºåˆ—éå¸¸æ–¹ä¾¿ï¼Œå¯ä»¥é¿å…å°†å°–æ‹¬å·è§£é‡Šä¸ºæ•£åˆ—é”®:\nmy $var = \u0026#39;foo\u0026#39;; say \u0026#39;\u0026lt;code\u0026gt;$var\u0026lt;/code\u0026gt; is \u0026lt;var\u0026gt;\\qq[$var.uc()]\u0026lt;/var\u0026gt;\u0026#39;; # OUTPUT: Â«\u0026lt;code\u0026gt;$var\u0026lt;/code\u0026gt; is \u0026lt;var\u0026gt;FOO\u0026lt;/var\u0026gt;â¤Â» Interpolation: qq my $color = \u0026#39;blue\u0026#39;; say \u0026#34;My favorite color is $color!\u0026#34;; # My favorite color is blue! qq å½¢å¼ - é€šå¸¸ä½¿ç”¨åŒå¼•å·å†™æˆ - å…è®¸å˜é‡çš„æ’å€¼, ä¾‹å¦‚å­—ç¬¦ä¸²ä¸­èƒ½å†™å…¥å˜é‡, ä»¥ä½¿å˜é‡çš„å†…å®¹èƒ½æ’å…¥åˆ°å­—ç¬¦ä¸²ä¸­. åœ¨ qq å¼•èµ·å­—ç¬¦ä¸²ä¸­, ä¹Ÿèƒ½è½¬ä¹‰å˜é‡.\nsay \u0026#34;The \\$color variable contains the value \u0026#39;$color\u0026#39;\u0026#34;; # The $color variable contatins the value \u0026#39;blue\u0026#39; qq çš„å¦å¤–ä¸€ç§åŠŸèƒ½æ˜¯ä½¿ç”¨èŠ±æ‹¬å·åœ¨å­—ç¬¦ä¸²ä¸­æ’å€¼ Raku ä»£ç :\nmy ($x, $y, $z) = 4, 3.5, 3; say \u0026#34;This room is $xm by $ym by $zm.\u0026#34;; say \u0026#34;Therefore its volume should be { $x * $y * $z }mÂ³!\u0026#34;; è¾“å‡º:\nThis room is 4 m by 3.5 m by 3 m. Therefore its volume should be 42 mÂ³! é»˜è®¤æƒ…å†µä¸‹, åªæœ‰å¸¦æœ‰ $ ç¬¦å·çš„å˜é‡æ‰èƒ½æ­£å¸¸æ’å€¼. è¿™æ—¶, \u0026quot;documentation@raku.org\u0026quot; ä¸ä¼šæ’å€¼ @raku å˜é‡ã€‚å¦‚æœä½ ç¡®å®æƒ³é‚£ä¹ˆåš, åœ¨å˜é‡ååé¢æ·»åŠ ä¸€ä¸ª []:\nmy @neighbors = \u0026#34;Felix\u0026#34;, \u0026#34;Danielle\u0026#34;, \u0026#34;Lucinda\u0026#34;; say \u0026#34;@neighbors[]and I try our best to coexist peacefully.\u0026#34;; è¾“å‡º:\nFelix Danielle Lucinda and I try our best to coexist peacefully. é€šå¸¸ä½¿ç”¨ä¸€ä¸ªæ–¹æ³•è°ƒç”¨ä¼šæ›´åˆé€‚. åªæœ‰åœ¨ qq å¼•å·ä¸­, æ–¹æ³•è°ƒç”¨åé¢æœ‰åœ†æ‹¬å·, å°±èƒ½è¿›è¡Œæ’å€¼:\nsay \u0026#34;@neighbors.join(\u0026#39;, \u0026#39;)and I try our best to coexist peacefully.\u0026#34;; è¾“å‡º:\nFelix, Danielle, Lucinda and I try our best to coexist peacefully. è€Œ \u0026quot;@example.com\u0026quot; äº§ç”Ÿ @example.com.\nè¦è°ƒç”¨å­ä¾‹ç¨‹è¯·ä½¿ç”¨ \u0026amp; ç¬¦å·ã€‚\nsay \u0026#34;abc\u0026amp;uc(\u0026#34;def\u0026#34;)ghi\u0026#34;; # OUTPUT: Â«abcDEFghiâ¤Â» åç¯ç¼€æ“ä½œç¬¦å’Œ subscripts ä¹Ÿä¼šè¢«æ’å€¼ã€‚\nmy %h = :1st; say \u0026#34;abc%h\u0026lt;st\u0026gt;ghi\u0026#34;; # OUTPUT: Â«abc1ghiâ¤Â» è¦è¾“å…¥ unicode åºåˆ—ï¼Œè¯·ä½¿ç”¨ \\x æˆ– \\x[] åŠ ä¸Šå­—ç¬¦çš„åå…­è¿›åˆ¶ç¼–ç æˆ–å­—ç¬¦åˆ—è¡¨ã€‚\nmy $s = \u0026#34;I \\x2665Raku!\u0026#34;; say $s; # OUTPUT: Â«I â™¥ Raku!â¤Â» $s = \u0026#34;I really \\x[2661,2665,2764,1f495] Raku!\u0026#34;; say $s; # OUTPUT: Â«I really â™¡â™¥â¤ğŸ’• Raku!â¤Â» æ‚¨è¿˜å¯ä»¥åœ¨ \\c[] ä¸­ä½¿ç”¨ unicode åç§°ã€å‘½ååºåˆ—å’Œåç§°åˆ«åã€‚\nmy $s = \u0026#34;Camelia \\c[BROKEN HEART]my \\c[HEAVY BLACK HEART]!\u0026#34;; say $s; # OUTPUT: Â«Camelia ğŸ’” my â¤!â¤Â» å¯¹æœªå®šä¹‰å€¼è¿›è¡Œæ’å€¼å°†å¼•å‘æ§ä»¶å¼‚å¸¸ï¼Œè¯¥å¼‚å¸¸å¯ä»¥åœ¨å½“å‰æ§ä»¶å—ä¸­ä½¿ç”¨ CONTROL æ•è·ã€‚\nsub niler {Nil}; my Str $a = niler; say(\u0026#34;$a.html\u0026#34;, \u0026#34;sometext\u0026#34;); say \u0026#34;alive\u0026#34;; # this line is dead code CONTROL { .die }; Word quoting: qw qw|! @ # $ % ^ \u0026amp; * \\| \u0026lt; \u0026gt; | eqv '! @ # $ % ^ \u0026amp; * | \u0026lt; \u0026gt;'.words.list q:w { [ ] \\{ \\} } eqv ('[', ']', '{', '}') Q:w | [ ] { } | eqv ('[', ']', '{', '}') :w é€šå¸¸å†™ä½œ qw, æŠŠå­—ç¬¦ä¸²åˆ†å‰²ä¸º \u0026ldquo;words\u0026rdquo; (å•è¯). åœ¨è¿™ç§æƒ…æ™¯ä¸‹, å•è¯è¢«å®šä¹‰ä¸ºç”±ç©ºæ ¼åˆ†å‰²çš„ä¸€ä¸²éç©ºç™½å­—ç¬¦. q:w å’Œ qw ç»§æ‰¿äº† q çš„æ’å€¼å’Œè½¬ä¹‰è¯­æ³•, è¿˜æœ‰å•å¼•å·å­—ç¬¦ä¸²åˆ†å‰²ç¬¦, è€Œ Qw å’Œ Q:w ç»§æ‰¿äº† Q çš„éè½¬ä¹‰è¯­æ³•.\nmy @directions = \u0026#39;left\u0026#39;, \u0026#39;right,\u0026#39;, \u0026#39;up\u0026#39;, \u0026#39;down\u0026#39;; è¿™æ ·è¯»å’Œå†™éƒ½æ›´å®¹æ˜“:\nmy @directions = qw|left right up down; Word quoting: \u0026lt;\u0026gt; say \u0026lt;a b c\u0026gt; eqv (\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;, \u0026#39;c\u0026#39;); # OUTPUT: Â«Trueâ¤Â» say \u0026lt;a b 42\u0026gt; eqv (\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;, \u0026#39;42\u0026#39;); # OUTPUT: Â«Falseâ¤Â», the 42 became an IntStr allomorph say \u0026lt;42 \u0026gt; ~~ Int; # OUTPUT: Â«Trueâ¤Â» say \u0026lt;42 \u0026gt; ~~ Str; # OUTPUT: Â«Trueâ¤Â» å°–æ‹¬å·çš„å¼•å·ç±»ä¼¼äº qwï¼Œä½†æœ‰ä¸€ä¸ªé¢å¤–çš„ç‰¹æ€§ï¼Œå¯ä»¥è®©ä½ æ„é€ ç‰¹å®šæ•°å­—çš„åŒè´¨å¼‚å½¢ä½“æˆ–å­—é¢é‡:\nsay \u0026lt;42 4/2 1e6 1+1i abc\u0026gt;.raku; # OUTPUT: Â«(IntStr.new(42, \u0026#34;42\u0026#34;), RatStr.new(2.0, \u0026#34;4/2\u0026#34;), NumStr.new(1000000e0, \u0026#34;1e6\u0026#34;), ComplexStr.new(\u0026lt;1+1i\u0026gt;, \u0026#34;1+1i\u0026#34;), \u0026#34;abc\u0026#34;)â¤Â» è¦æ„é€  Rat æˆ– Complex å­—é¢é‡ï¼Œè¯·åœ¨æ•°å­—å‘¨å›´ä½¿ç”¨å°–æ‹¬å·ï¼Œä¸å¸¦ä»»ä½•é¢å¤–çš„ç©ºæ ¼:\nsay \u0026lt;42/10\u0026gt;.^name; # OUTPUT: Â«Ratâ¤Â» say \u0026lt;1+42i\u0026gt;.^name; # OUTPUT: Â«Complexâ¤Â» say \u0026lt;42/10 \u0026gt;.^name; # OUTPUT: Â«RatStrâ¤Â» say \u0026lt;1+42i \u0026gt;.^name; # OUTPUT: Â«ComplexStrâ¤Â» ä¸ 42/10 å’Œ 1+42i ç›¸æ¯”ï¼Œä¸æ¶‰åŠé™¤æ³•(æˆ–åŠ æ³•)è¿ç®—ã€‚è¿™å¯¹äºä¾‹ç¨‹ç­¾åä¸­çš„å­—é¢é‡å¾ˆæœ‰ç”¨ï¼Œä¾‹å¦‚:\nsub close-enough-Ï€ (\u0026lt;355/113\u0026gt;) { say \u0026#34;Your Ï€ is close enough!\u0026#34; } close-enough-Ï€ 710/226; # OUTPUT: Â«Your Ï€ is close enough!â¤Â» # WRONG: can\u0026#39;t do this, since it\u0026#39;s a division operation sub compilation-failure (355/113) {} Word quoting with quote protection: qww å•è¯å¼•ç”¨çš„ qw æ ¼å¼å°†æŒ‰å­—é¢æ„æ€å¤„ç†å¼•ç”¨å­—ç¬¦ï¼Œå°†å®ƒä»¬ä¿ç•™åœ¨ç»“æœå•è¯ä¸­:\nsay qw{\u0026#34;a b\u0026#34; c}.raku; # OUTPUT: Â«(\u0026#34;\\\u0026#34;a\u0026#34;, \u0026#34;b\\\u0026#34;\u0026#34;, \u0026#34;c\u0026#34;)â¤Â» å› æ­¤ï¼Œå¦‚æœæ‚¨å¸Œæœ›åœ¨ç»“æœå•è¯ä¸­ä¿ç•™å¼•ç”¨çš„å­å­—ç¬¦ä¸²ä½œä¸ºå•ä¸ªé¡¹ï¼Œåˆ™éœ€è¦ä½¿ç”¨ qww å˜ä½“:\nsay qww{\u0026#34;a b\u0026#34; c}.raku; # OUTPUT: Â«(\u0026#34;a b\u0026#34;, \u0026#34;c\u0026#34;)â¤Â» Word quoting with interpolation: qqw qw å½¢å¼çš„ word quoting ä¸ä¼šè¿›è¡Œå˜é‡æ’å€¼:\nmy $a = 42; say qw{$a b c}; # $a b c å› æ­¤, å¦‚æœä½ æƒ³åœ¨å¼•å·å­—ç¬¦ä¸²ä¸­è¿›è¡Œå˜é‡æ’å€¼, ä½ éœ€è¦ä½¿ç”¨ qqw å˜ä½“:\nmy $a = 42; my @list = qqw{$ab c}; say @list; # 42 b c æ³¨æ„ï¼Œå˜é‡æ’å€¼å‘ç”Ÿåœ¨å•è¯åˆ†å‰²ä¹‹å‰:\nmy $a = \u0026#34;a b\u0026#34;; my @list = qqw{$ac}; .say for @list; # OUTPUT: Â«aâ¤bâ¤câ¤Â» Word quoting with interpolation and quote protection: qqww qqw å½¢å¼çš„å•è¯å¼•ç”¨ä¼šæŠŠå¼•èµ·çš„å­—ç¬¦å½“ä½œå­—é¢é‡ï¼Œå°†å¼•èµ·çš„å­—ç¬¦ç•™åœ¨ç»“æœå•è¯ä¸­:\nmy $a = 42; say qqw{\u0026#34;$ab\u0026#34; c}.raku; # OUTPUT: Â«(\u0026#34;\\\u0026#34;42\u0026#34;, \u0026#34;b\\\u0026#34;\u0026#34;, \u0026#34;c\u0026#34;)â¤Â» å› æ­¤ï¼Œå¦‚æœå¸Œæœ›åœ¨ç»“æœå•è¯ä¸­ä¿ç•™å¼•èµ·çš„å­å­—ç¬¦ä¸²ä¸ºå•ä¸ªé¡¹ï¼Œåˆ™éœ€è¦ä½¿ç”¨ qqww å˜ä½“:\nmy $a = 42; say qqww{\u0026#34;$ab\u0026#34; c}.raku; # OUTPUT: Â«(\u0026#34;42 b\u0026#34;, \u0026#34;c\u0026#34;)â¤Â» å¼•å·ä¿æŠ¤å‘ç”Ÿåœ¨æ’å€¼ä¹‹å‰ï¼Œæ’å€¼å‘ç”Ÿåœ¨åˆ†è¯ä¹‹å‰ï¼Œæ‰€ä»¥æ¥è‡ªæ’å€¼å˜é‡å†…éƒ¨çš„å¼•å·åªæ˜¯å­—é¢å¼•å·å­—ç¬¦:\nmy $a = \u0026#34;1 2\u0026#34;; say qqww{\u0026#34;$a\u0026#34; $a}.raku; # OUTPUT: Â«(\u0026#34;1 2\u0026#34;, \u0026#34;1\u0026#34;, \u0026#34;2\u0026#34;)â¤Â» my $b = \u0026#34;1 \\\u0026#34;2 3\\\u0026#34;\u0026#34;; say qqww{\u0026#34;$b\u0026#34; $b}.raku; # OUTPUT: Â«(\u0026#34;1 \\\u0026#34;2 3\\\u0026#34;\u0026#34;, \u0026#34;1\u0026#34;, \u0026#34;\\\u0026#34;2\u0026#34;, \u0026#34;3\\\u0026#34;\u0026#34;)â¤Â» Word quoting with interpolation and quote protection: Â« Â» è¿™ç§å¼•ç”¨æ–¹å¼ç±»ä¼¼äº qqwwï¼Œä½†å®ƒå…·æœ‰æ„é€  allomorphs çš„é¢å¤–å¥½å¤„(ä½¿å…¶åŠŸèƒ½ç›¸å½“äº qq:ww:v)ã€‚ä¸ Â«Â» ç­‰ä»·çš„ ASCII æ˜¯åŒå°–æ‹¬å· \u0026lt;\u0026lt; \u0026gt;\u0026gt;ã€‚\n# Allomorph Construction my $a = 42; say Â«$ab c Â».raku; # OUTPUT: Â«(IntStr.new(42, \u0026#34;42\u0026#34;), \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;)â¤Â» my $a = 42; say \u0026lt;\u0026lt;$ab c \u0026gt;\u0026gt;.raku; # OUTPUT: Â«(IntStr.new(42, \u0026#34;42\u0026#34;), \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;)â¤Â» # Quote Protection my $a = 42; say Â«\u0026#34;$ab\u0026#34; c Â».raku; # OUTPUT: Â«(\u0026#34;42 b\u0026#34;, \u0026#34;c\u0026#34;)â¤Â» my $a = 42; say \u0026lt;\u0026lt;\u0026#34;$ab\u0026#34; c \u0026gt;\u0026gt;.raku; # OUTPUT: Â«(\u0026#34;42 b\u0026#34;, \u0026#34;c\u0026#34;)â¤Â» Shell quoting: qx è¦å°†å­—ç¬¦ä¸²ä½œä¸ºå¤–éƒ¨ç¨‹åºè¿è¡Œï¼Œä¸ä»…å¯ä»¥å°†å­—ç¬¦ä¸²ä¼ é€’ç»™ shell æˆ– run å‡½æ•°ï¼Œè¿˜å¯ä»¥æ‰§è¡Œ shell å¼•ç”¨ã€‚ç„¶è€Œï¼Œæœ‰ä¸€äº›å¾®å¦™ä¹‹å¤„éœ€è¦è€ƒè™‘ã€‚qx å¼•å·ä¸æ’å…¥å˜é‡ã€‚å› æ­¤\nmy $world = \u0026#34;there\u0026#34;; say qx{echo \u0026#34;hello $world\u0026#34;} ä»…ä»…æ‰“å° hello. ç„¶è€Œ, å¦‚æœä½ åœ¨è°ƒç”¨ raku ä¹‹å‰å£°æ˜äº†ä¸€ä¸ªç¯å¢ƒå˜é‡, è¿™åœ¨ qx é‡Œæ˜¯å¯ç”¨çš„, ä¾‹å¦‚:\nWORLD=\u0026quot;there\u0026quot; raku \u0026gt; say qx{echo \u0026quot;hello $WORLD\u0026quot;} ç°åœ¨ä¼šæ‰“å° hello there.\nè°ƒç”¨ qx ä¼šè¿”å›ç»“æœ, æ‰€ä»¥è¿™ä¸ªç»“æœèƒ½è¢«èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ä»¥ä¾¿åæ¥ä½¿ç”¨:\nmy $output = qx{echo \u0026#34;hello!\u0026#34;}; say $output; # hello! Shell quoting with interpolation: qqx å¦‚æœå¸Œæœ›åœ¨å¤–éƒ¨å‘½ä»¤ä¸­ä½¿ç”¨ Raku å˜é‡çš„å†…å®¹ï¼Œé‚£ä¹ˆåº”è¯¥ä½¿ç”¨ qqx shell å¼•ç”¨ç»“æ„:\nmy $world = \u0026#34;there\u0026#34;; say qqx{echo \u0026#34;hello $world\u0026#34;}; # hello there å†ä¸€æ¬¡, å¤–éƒ¨å‘½ä»¤çš„è¾“å‡ºç»“æœå¯ä»¥ä¿å­˜åœ¨ä¸€ä¸ªå˜é‡ä¸­:\nmy $word = \u0026#34;cool\u0026#34;; my $option = \u0026#34;-i\u0026#34;; my $file = \u0026#34;/usr/share/dict/words\u0026#34;; my $output = qqx{grep $option$word$file}; # runs the command: grep -i cool /usr/share/dict/words say $output; # Cooleyâ¤Cooley\u0026#39;sâ¤Coolidgeâ¤Coolidge\u0026#39;sâ¤coolâ¤ ... æœ‰å…³æ‰§è¡Œå¤–éƒ¨å‘½ä»¤çš„æ›´å¥½æ–¹æ³•ï¼Œè¯·å‚è§ run å’Œ Proc::Asyncã€‚\nHeredocs: :to ä¸€ç§æ–¹ä¾¿çš„å†™å¤šè¡Œå­—ç¬¦ä¸²å­—é¢é‡çš„æ–¹å¼æ˜¯ heredocsï¼Œå®ƒè®©ä½ é€‰æ‹©è‡ªå·±çš„åˆ†éš”ç¬¦:\nsay q:to/END/;Here is some multi-line string END heredoc çš„å†…å®¹æ€»æ˜¯ä»ä¸‹ä¸€è¡Œå¼€å§‹ï¼Œæ‰€ä»¥ä½ å¯ä»¥(ä¹Ÿåº”è¯¥)å®Œæˆè¿™ä¸€è¡Œã€‚\nmy $escaped = my-escaping-function(q:to/TERMINATOR/,language =\u0026gt; \u0026#39;html\u0026#39;); Here are the contents of the heredoc. Potentially multiple lines. TERMINATOR å¦‚æœç»ˆæ­¢åˆ†éš”ç¬¦ç¼©è¿›äº†, åŒç­‰æ•°é‡çš„ç¼©è¿›ä¼šä»å­—ç¬¦ä¸²å­—é¢é‡ä¸Šç§»é™¤. å› æ­¤ä¸‹é¢è¿™ä¸ª heredoc\nsay q:to/END/;Here is some multi line string END è¾“å‡º:\nHere is some multi line string heredoc åŒ…å«äº†ç»ˆæ­¢ç¬¦ä¹‹å‰çš„æ¢è¡Œç¬¦ã€‚\nè¦å…è®¸å¯¹å˜é‡è¿›è¡Œæ’å€¼ï¼Œå¯ä»¥ä½¿ç”¨ qq å½¢å¼ï¼Œä½†å¦‚æœä¸æ˜¯å·²å®šä¹‰å˜é‡çš„æ ‡è¯†ç¬¦ï¼Œåˆ™å¿…é¡»è½¬ä¹‰å…ƒå­—ç¬¦ {\\ å’Œ $ã€‚ä¾‹å¦‚:\nmy $f = \u0026#39;db.7.3.8\u0026#39;; my $s = qq:to/END/;option \\{ file \u0026#34;$f\u0026#34;; }; END say $s; ä¼šäº§ç”Ÿï¼š\noption { file \u0026quot;db.7.3.8\u0026quot;; }; æ‚¨å¯ä»¥åœ¨åŒä¸€è¡Œå¼€å§‹å¤šä¸ª heredocã€‚\nmy ($first, $second) = qq:to/END1/,qq:to/END2/; FIRST MULTILINE STRING END1 SECOND MULTILINE STRING END2 Unquoting å­—é¢é‡å­—ç¬¦ä¸²å…è®¸ä½¿ç”¨è½¬ä¹‰åºåˆ—æ’å…¥å†…åµŒçš„å¼•ç”¨ç»“æ„ï¼Œä¾‹å¦‚:\nmy $animal=\u0026#34;quaggas\u0026#34;; say \u0026#39;These animals look like \\qq[$animal]\u0026#39;; # OUTPUT: Â«These animals look like quaggasâ¤Â» say \u0026#39;These animals are \\qqw[$animal or zebras]\u0026#39;; # OUTPUT: Â«These animals are quaggas or zebrasâ¤Â» åœ¨æœ¬ä¾‹ä¸­ï¼Œ\\qq å°†åšåŒå¼•å·å†…æ’ï¼Œ\\qqw æ–‡å­—å†…æ’ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œè½¬ä¹‰ä»»ä½•å…¶ä»–å¼•ç”¨ç»“æ„éƒ½å°†ä»¥ç›¸åŒçš„æ–¹å¼è¿›è¡Œï¼Œä»è€Œå…è®¸åœ¨å­—é¢é‡å­—ç¬¦ä¸²ä¸­è¿›è¡Œæ’å€¼ã€‚\nRegexes æœ‰å…³åœ¨ regexes ä¸­åº”ç”¨çš„å¼•ç”¨çš„ä¿¡æ¯ï¼Œè¯·å‚é˜…æ­£åˆ™è¡¨è¾¾å¼æ–‡æ¡£ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2015-08-24-quote-in-raku/","tags":["quote"],"title":"Raku ä¸­çš„å¼•å·"},{"categories":["rakulang"],"contents":"Raku æ”¯æŒ\u0026quot;æ³›å‹, roles å’Œ å¤šé‡åˆ†å‘\u0026quot;, å®ƒä»¬éƒ½æ˜¯å¾ˆå¥½çš„ç‰¹ç‚¹, å¹¶ä¸”å·²ç»åœ¨å…¶å®ƒ advent calendar ä¸­å‘å¸ƒè¿‡äº†ã€‚\nä½†æ˜¯ä»Šå¤©æˆ‘ä»¬è¦çœ‹çš„æ˜¯ MOPã€‚ \u0026ldquo;MOP\u0026rdquo; ä»£è¡¨ç€å…ƒå¯¹è±¡åè®®(\u0026ldquo;Meta-Object Protocol\u0026rdquo;)ã€‚é‚£æ„å‘³ç€, å®ƒä»¬å®é™…ä¸Šæ˜¯ä½ èƒ½ä»ç”¨æˆ·é‚£è¾¹æ”¹å˜çš„ä¸€éƒ¨åˆ†, è€Œä¸æ˜¯å¯¹è±¡ã€ç±»ç­‰å®šä¹‰è¯­è¨€çš„ä¸œè¥¿ã€‚\nå®é™…ä¸Š, åœ¨ Rakuä¸­, ä½ å¯ä»¥ä¸ºç±»å‹æ·»åŠ æ–¹æ³•, ç§»é™¤æŸä¸ªæ–¹æ³•, åŒ…è£¹æ–¹æ³•, ä½¿ç”¨æ›´å¤šèƒ½åŠ›å¢å¼ºç±»(OO::Actors å’Œ OO::Monitors å°±æ˜¯ä¸¤ä¸ªè¿™æ ·çš„ä¾‹å­), æˆ–è€…ä½ å¯ä»¥å®Œå…¨é‡å®šä¹‰å®ƒ(å¹¶ä¸”, ä¾‹å¦‚, ä½¿ç”¨ Ruby-like çš„å¯¹è±¡ç³»ç»Ÿã€‚è¿™å„¿æœ‰ä¸ªä¾‹å­)ã€‚\nä½†æ˜¯ä»Šå¤©, æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹ç¬¬ä¸€éƒ¨åˆ†: è‡ªçœã€‚åœ¨ç±»å‹åˆ›å»ºå®Œä¹‹åæŸ¥çœ‹å®ƒçš„ç±»å‹, äº†è§£å®ƒ, å¹¶ä½¿ç”¨è¿™äº›ä¿¡æ¯ã€‚\næˆ‘ä»¬å°†è¦åˆ›å»ºçš„æ¨¡å—æ˜¯åŸºäº Sixcheck æ¨¡å—(ä¸€ä¸ª QuickCheck-like æ¨¡å—)çš„éœ€æ±‚: ä¸ºæŸä¸ªç±»å‹ç”Ÿæˆä¸€äº›éšæœºæ•°æ®, ç„¶åæŠŠæ•°æ®å–‚ç»™æˆ‘ä»¬æ­£æµ‹è¯•çš„å‡½æ•°, å¹¶æ£€æŸ¥æŸäº›åç½®æ¡ä»¶(post-condition)ã€‚\næ‰€ä»¥, æˆ‘ä»¬å…ˆå†™å‡ºç¬¬ä¸€ä¸ªç‰ˆæœ¬:\nmy %special-cases{Mu} = (Int) =\u0026gt; -\u0026gt; { (1..50).pick }, (Str) =\u0026gt; -\u0026gt; { (\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;).pick(50).join(\u0026#39;\u0026#39;) }, ; sub generate-data(Mu:U \\t) { %special-cases{t} ?? %special-cases{t}() !! t.new; } generate-data(Int); æ³¨æ„ä»¥ä¸‹å‡ ç‚¹:\n æˆ‘ä»¬ç»™ %special-cases æŒ‡å®šäº†é”®çš„ç±»å‹ã€‚é‚£æ˜¯å› ä¸ºé»˜è®¤åœ°, é”®çš„ç±»å‹ä¸º Strã€‚æ˜¾ç„¶åœ°, æˆ‘ä»¬ä¸æƒ³è®©æˆ‘ä»¬çš„ç±»å‹å­—ç¬¦ä¸²åŒ–ã€‚æˆ‘ä»¬å®é™…ä¸Šåšçš„æ˜¯æŒ‡å®šå®ƒä»¬ä¸º\u0026quot;Mu\u0026quot;çš„å­ç±»(è¿™åœ¨ç±»å‹\u0026quot;é£Ÿç‰©é“¾\u0026quot;çš„é¡¶ç«¯)ã€‚ æˆ‘ä»¬åœ¨ Int å’Œ Str å‘¨å›´æ”¾ä¸Šåœ†æ‹¬å·, ä»¥é¿å…å­—ç¬¦ä¸²åŒ–ã€‚ æˆ‘ä»¬åœ¨å‡½æ•°å‚æ•°ç±»å‹ä¸­ä½¿ç”¨äº† :Uã€‚é‚£æ„å‘³ç€é‚£ä¸ªå€¼å¿…é¡»æ˜¯æœªå®šä¹‰çš„(undefined)ã€‚ç±»å‹å¯¹è±¡(å°±åƒ Intã€Str ç­‰ç­‰)æ˜¯æœªå®šä¹‰çš„, æ‰€ä»¥å®ƒèƒ½æ»¡è¶³æˆ‘ä»¬(ä½ å¯èƒ½è§è¿‡ä¸€ä¸ªå« Nil çš„ä¸åŒçš„æœªçŸ¥å€¼)ã€‚ ç±»å‹å¯¹è±¡å®é™…ä¸Šæ˜¯å¯¹è±¡, å°±åƒå…¶å®ƒä»»ä½•å¯¹è±¡ä¸€æ ·ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨ç±»å‹å¯¹è±¡ä¸Šè°ƒç”¨ .new æ–¹æ³•, ä¾‹å¦‚, å®ƒå’Œç›´æ¥è°ƒç”¨ Int.new ç›¸åŒ(é‚£å¯¹ä¸€è‡´æ€§å’Œ autovivification å¾ˆæœ‰ç”¨)ã€‚ æˆ‘ä»¬ä¸º Int å’Œ Str æä¾›äº† fallback, å› ä¸ºè°ƒç”¨ Int.new å’Œ Str.new ( 0 å’Œ \u0026quot;\u0026quot; )ä¸ä¼šåœ¨æˆ‘ä»¬åˆ›å»ºçš„æ•°æ®ä¸­ç»™æˆ‘ä»¬ä»»ä½•éšæœºåŒ–ã€‚ Raku åœ¨å‡½æ•°ä¸­è‡ªåŠ¨è¿”å›æœ€åä¸€ä¸ªè¡¨è¾¾å¼ã€‚æ‰€ä»¥ä¸éœ€è¦åœ¨é‚£å„¿æ”¾ä¸Šä¸€ä¸ª returnã€‚  æˆ‘ä»¬ç”¨ä»£ç ç”Ÿæˆæ•°æ®, å…¬å¹³ä¸”å…¬æ­£ã€‚ä½†æ˜¯æˆ‘ä»¬éœ€è¦ç”Ÿæˆæ›´å¤šé‚£æ ·ç®€å•çš„æ•°æ®ã€‚\næˆ‘ä»¬è‡³å°‘éœ€è¦æ”¯æŒå¸¦æœ‰å±æ€§çš„ç±»: æˆ‘ä»¬æƒ³æŸ¥çœ‹å±æ€§åˆ—è¡¨, ä¸ºå®ƒä»¬çš„ç±»å‹ç”Ÿæˆæ•°æ®, å¹¶æŠŠå®ƒä»¬å–‚ç»™æ„é€ å™¨ã€‚\næˆ‘ä»¬è¦èƒ½å¤Ÿçœ‹åˆ°ç±»çš„å†…éƒ¨ã€‚ç”¨ Raku çš„æœ¯è¯­æ¥è¯´, æˆ‘ä»¬å°†è¦åˆ°è¾¾çš„æ˜¯å…ƒå¯¹è±¡åè®®(Meta-Object Protocol)ã€‚é¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç±»:\nclass Article { has Str $.title; has Str $.content; has Int $.view-count; } # æˆ‘ä»¬å¯ä»¥è¿™æ ·æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªå®ä¾‹ Article.new(title =\u0026gt; \u0026#34;Raku Advent, ç¬¬ 19 å¤©\u0026#34;, content =\u0026gt; \u0026#34;Magic!\u0026#34;, view-count =\u0026gt; 0 ); ä½†æ˜¯æˆ‘ä»¬ä¸æƒ³äº²æ‰‹åˆ›å»ºé‚£ä¸ªæ–‡ç«  (article)ã€‚æˆ‘ä»¬æƒ³æŠŠé‚£ä¸ª class Article ä¼ é€’ç»™æˆ‘ä»¬çš„ generate-data å‡½æ•°, å¹¶è¿”å›ä¸€ä¸ª Article(é‡Œé¢å¸¦æœ‰éšæœºæ•°æ®)ã€‚è®©æˆ‘ä»¬å›åˆ°æˆ‘ä»¬çš„ REPL\u0026hellip;\nsay Article.^attributes; # (Str $!title Str $!content Int $!view-count) say Article.^attributes[0].WHAT; # (Attribute) å¦‚æœä½ ç‚¹å‡»äº† MOP é“¾æ¥, ä½ ä¸ä¼šå¯¹æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ªå«æœ‰ 3 ä¸ªå…ƒç´ çš„æ•°ç»„æ„Ÿåˆ°æƒŠè®¶ã€‚å¦‚æœä½ ä»æ—§å¯¹è¯¥è¯­æ³•æ„Ÿåˆ°æƒŠè®¶, é‚£ä¹ˆ .^ æ˜¯å…ƒæ–¹æ³•è°ƒç”¨ã€‚æ„æ€æ˜¯ a.^b ä¼šè¢«è½¬æ¢ä¸º a.HOW.b(a)ã€‚\nå¦‚æœæˆ‘ä»¬æƒ³çŸ¥é“æˆ‘ä»¬å¯ä»¥è®¿é—®åˆ°ä»€ä¹ˆ, æˆ‘ä»¬é—®å®ƒå°±æ˜¯äº†(ç§»é™¤äº†åŒ¿åçš„é‚£äº›):\nAttribute.^methods.grep(*.name ne \u0026#39;\u0026lt;anon\u0026gt;\u0026#39;); # (compose apply_handles get_value set_value # container readonly package inlined WHY set_why Str gist) Attribute.^attributes # Method \u0026#39;gist\u0026#39; not found for invocant of class \u0026#39;BOOTSTRAPATTR\u0026#39; å“å†â€¦ çœ‹èµ·æ¥è¿™æœ‰ç‚¹å¤ª meta äº†ã€‚å¹¸å¥½, æˆ‘ä»¬èƒ½ä½¿ç”¨ Rakudo çš„ä¸€ä¸ªéå¸¸å¥½çš„å±æ€§: å®ƒçš„å¤§éƒ¨åˆ†éƒ½æ˜¯ç”¨ Raku å†™çš„! è¦æŸ¥çœ‹æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»€ä¹ˆ, æˆ‘ä»¬æŸ¥çœ‹æºä»£ç å°±å¥½äº†:\n# has Str $!name; ... # has Mu $!type; æˆ‘ä»¬å¾—åˆ°äº†é”®çš„åå­—, è¿˜æœ‰å»ç”Ÿæˆå€¼çš„ç±»å‹ã€‚è®©æˆ‘ä»¬çœ‹çœ‹\u0026hellip;\n\u0026gt; say Article.^attributes.map(*.name) ($!title $!content $!view-count) \u0026gt; say Article.^attributes.map(*.type) ((Str) (Str) (Int)) å¤©æ‰! çœ‹èµ·æ¥æ˜¯æ­£ç¡®çš„ã€‚(å¦‚æœä½ æƒ³çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘ä»¬å¾—åˆ° $!ï¼ˆç§æœ‰çš„ï¼‰ twigils, é‚£æ˜¯å› ä¸º $. åªæ„å‘³ç€å°†ä¼šç”Ÿæˆçš„ä¸€ä¸ª getter æ–¹æ³•)ã€‚å±æ€§æœ¬èº«ä»ç„¶æ˜¯ç§æœ‰çš„, å¹¶ä¸”åœ¨ç±»ä¸­æ˜¯å¯è®¿é—®çš„ã€‚\nç°åœ¨, æˆ‘ä»¬å”¯ä¸€è¦åšçš„äº‹æƒ…å°±æ˜¯åˆ›å»ºä¸€ä¸ªå¾ªç¯\u0026hellip;\nmy %args; for Article.^attributes -\u0026gt; $attr { %args{$attr.name.substr(2)} = generate-data($attr.type); } say %args.perl; è¿™æ˜¯ä¸€ä¸ªå°†ä¼šæ‰“å°ä»€ä¹ˆçš„ä¾‹å­:\n{:content(\u0026#34;muenglhaxrvykfdjzopqbtwisc\u0026#34;), :title(\u0026#34;rfpjndgohmasuwkyzebixqtvcl\u0026#34;), :view-count(45)} æ¯æ¬¡ä½ è¿è¡Œä½ çš„ä»£ç ä½ éƒ½ä¼šå¾—åˆ°ä¸åŒçš„ç»“æœ(ç„¶è€Œæˆ‘ä¸è®¤ä¸ºå®ƒä¼šåˆ›å»ºä¸€ç¯‡å€¼å¾—é˜…è¯»çš„æ–‡ç« â€¦)ã€‚å‰©ä¸‹å”¯ä¸€è¦åšçš„å°±æ˜¯æŠŠå®ƒä»¬ä¼ é€’ç»™ Article çš„æ„é€ å‡½æ•°:\nsay Article.new(|%args); (å‰ç¼€ | å…è®¸æˆ‘ä»¬æŠŠ %args ä½œä¸ºå…·åå‚æ•°ä¼ é€’, è€Œä¸æ˜¯å•ä¸ªä½ç½®å‚æ•°)ã€‚å†æ¬¡, ä½ åº”è¯¥ä¼šæ‰“å°è¿™äº›ä¸œè¥¿:\nArticle.new(title =\u0026gt; \u0026#34;kyvphxqmejtuicrbsnfoldgzaw\u0026#34;, content =\u0026gt; \u0026#34;jqbtcyovxlngpwikdszfmeuahr\u0026#34;, view-count =\u0026gt; 26) å‘€! æˆ‘ä»¬è®¾æ³•åœ¨ä¸äº†è§£ Article çš„æƒ…å†µä¸‹èƒ¡ä¹±åœ°(blindly)åˆ›å»ºäº†ä¸€ä¸ª Article å®ä¾‹ã€‚ æˆ‘ä»¬çš„ä»£ç èƒ½å¤Ÿç”¨äºä¸ºä»»ä½•æœŸæœ›ä¼ é€’å®ƒçš„ç±»å±æ€§çš„æ„é€ å‡½æ•°ç”Ÿæˆæ•°æ®ã€‚å¥½äº†!\nPS: ç•™ä¸ªä½œä¸š! ç§»åŠ¨åˆ° generate-data å‡½æ•°, ä»¥è‡³äºæˆ‘ä»¬èƒ½ç»™ Article æ·»åŠ ä¸€ä¸ª User $.author å±æ€§, å¹¶ä¸”æ„å»ºå¥½è¿™ä¸ªå‡½æ•°ã€‚ç¥ä½ å¥½è¿!\n","permalink":"https://ohmyweekly.github.io/notes/2015-07-25-introspection-in-raku/","tags":["introspection"],"title":"Raku ä¸­çš„è‡ªçœ"},{"categories":["rakulang"],"contents":"å­¦ä¼šäº†æ€ä¹ˆåˆ›å»ºç±», æˆ‘ä»¬ç»§ç»­ç”¨å®ƒæ¥æ„å»ºæˆ‘ä»¬çš„ä¸­å¿ƒå†…å®¹:\nclass Hammer { method hammer($stuff) { say \u0026#34;You hammer on $stuff. BAM BAM BAM!\u0026#34;; } } class Gavel { method hammer($stuff) { say \u0026#34;You hammer on $stuff. BAM BAM BAM!\u0026#34;; } } class Mallet { method hammer($stuff) { say \u0026#34;You hammer on $stuff. BAM BAM BAM!\u0026#34;; } } ä½†æ˜¯æ³¨æ„åˆ°äº†å—ï¼Ÿè¿™ä¸‰ä¸ªæ–¹æ³•åŒ…å«äº†åŒæ ·çš„æ–¹æ³•, åœ¨ç±»ä¸­é‡å¤äº†ã€‚æˆ‘ä»¬å¿…é¡»é‚£æ ·åšå¦‚æœæˆ‘ä»¬æƒ³è®©æ¯ä¸ª Hammarã€Gavel å’Œ Mallet æœ‰èƒ½åŠ›å‡»æ‰“çš„è¯ã€‚ï¼ˆå¹¶ä¸”é‚£æ˜¯åˆç†çš„ï¼‰ã€‚ä½†æ˜¯é—æ†¾çš„æ˜¯æˆ‘ä»¬ä¸å¾—ä¸æŠŠé‚£ä¸ªæ–¹æ³•ä¸€å¼ä¸‰ä»½ã€‚\nä¸ºä»€ä¹ˆé—æ†¾ï¼Ÿ å› ä¸ºä¸€æ–¹é¢åœ¨çœŸå®ä¸–ç•Œä¸­, æ–¹æ³•å¹¶ä¸æ˜¯å¾ˆå½¼æ­¤ç›¸ä¼¼, æœ‰ä¸€å¤©ä½ å†³å®šåœ¨ hammer æ–¹æ³•ä¸­æ›´æ”¹æŸäº›ä¸œè¥¿, å¹¶æ²¡æœ‰æ„è¯†åˆ°è¿™ä¸ªæ–¹æ³•åœ¨ä¸‰ä¸ªä¸åŒçš„åœ°æ–¹\u0026hellip; è¿™å¯¼è‡´äº†ä¸€å †ç—›è‹¦å’Œéš¾å—ã€‚\næ‰€ä»¥æˆ‘ä»¬çš„æ–°ç©å…·, ç±», å±•ç°å‡ºäº†ä¸€ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬æƒ³åœ¨æ¯ä¸ªç±»ä¸­é‡ç”¨ hammer æ–¹æ³•ã€‚ä¸€ä¸ªæ–°çš„æ¦‚å¿µ, role æ¥æ‹¯æ•‘æˆ‘ä»¬æ¥äº†:\nrole Hammering { method hammer($stuff) { say \u0026#34;You hammer on $stuff. BAM BAM BAM!\u0026#34;; } } è™½ç„¶ç±»ç»å¸¸ä»¥ä¸€ä¸ªåˆé€‚çš„åè¯å‘½å, ä½†æ˜¯ roles ç»å¸¸ä»¥ä¸€ä¸ªåˆ†è¯å‘½å, ä¾‹å¦‚ Hammeringã€‚è¿™ä¸æ˜¯ä¸€ä¸ªå¿…é¡»éµå®ˆçš„è§„åˆ™, ä½†æ˜¯å®ƒæ˜¯ä¸€ä¸ªå¥½çš„ç»éªŒæ³•åˆ™ã€‚ç°åœ¨ç±»çš„å®šä¹‰å˜çš„ç®€å•äº†:\nclass Hammer does Hammering { } class Gavel does Hammering { } class Mallet does Hammering { } æ˜¯çš„, æˆ‘ä»¬å–œæ¬¢é‚£æ ·ã€‚\nè¿™å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ æˆ‘ä»¬åœ¨ç±»ä¸Šä½¿ç”¨ does æ˜¯å¹²ä»€ä¹ˆç”¨çš„ï¼Ÿ role å®šä¹‰ä¸­çš„æ‰€æœ‰æ–¹æ³•éƒ½è¢«æ‹·è´åˆ°ç±»å®šä¹‰ä¸­ã€‚å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªæ‹·è´æ“ä½œ, æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å°½å¯èƒ½å¤šçš„ç±»ã€‚\næ‰€ä»¥, æˆ‘ä»¬åšçš„æ˜¯: å½“æˆ‘ä»¬æƒ³é‡ç”¨æ–¹æ³•çš„æ—¶å€™æŠŠæ–¹æ³•æ”¾è¿› roles é‡Œé¢ã€‚\nä½†æ˜¯å¥½å¤„ä¸æ­¢è¿™ä¸€ç‚¹å„¿ã€‚è‡³å°‘æœ‰ä¸¤ä¸ªå¥½å¤„:\nmy $hammer = Hammer.new; # create a new hammer object say $hammer ~~ Hammer; # \u0026#34;Bool::True\u0026#34; -- yes, this we know say $hammer ~~ Hammering; # \u0026#34;Bool::True\u0026#34; -- ooh! æ‰€ä»¥ $hammer çŸ¥é“å®ƒéµå®ˆäº†(does) Hammering, æˆ‘ä»¬ç°åœ¨ä¸ä»…çŸ¥é“äº†å¯¹è±¡å±äºå“ªä¸ªç±», è¿˜çŸ¥é“äº†å¯¹è±¡å¹¶å…¥äº†ä»€ä¹ˆ roleã€‚è¿™å¾ˆæœ‰ç”¨å¦‚æœæˆ‘ä»¬ä¸ç¡®å®šæˆ‘ä»¬å¤„ç†çš„æ˜¯ä»€ä¹ˆç±»å‹çš„å¯¹è±¡:\nif $unkown_object ~~ Hammering { $unknown_object.hammer(\u0026#34;ç ¸åœ¨é’‰å­ä¸Š\u0026#34;); # will always work } ä¸€ä¸ªç±»èƒ½ä¸€æ¬¡æ¥æ”¶å‡ ä¸ª roles å—ï¼Ÿ æ˜¯çš„, å®ƒå¯ä»¥:\nrole Flying { method fly { say \u0026#34;Whooosh!\u0026#34;; } } class FlyingHammer does Hammering does Flying { } è®©ä¸€ä¸ªç±»åƒé‚£æ ·éµå®ˆå‡ ä¸ª roles å¼•å…¥äº†ä¸€ä¸ªæœ‰æ„æ€çš„å¯èƒ½: å†²çª, å½“æ¥è‡ªä¸¤ä¸ªä¸åŒ roles çš„ä¸¤ä¸ªåŒåæ–¹æ³•å°è¯•å é¢†åŒä¸€ä¸ªç±»æ—¶ã€‚è¿™æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ å¥½å§, è‡³å°‘æœ‰ 3 ç§å¯èƒ½:\n   ç¬¬ä¸€ä¸ª role èµ¢äº†ã€‚ å®ƒçš„æ–¹æ³•ä½è¿›äº†ç±»ä¸­     æœ€åä¸€ä¸ª role èµ¢äº†ã€‚ å®ƒè¦†ç›–äº†ä¹‹å‰çš„æ–¹æ³•     ç¼–è¯‘å¤±è´¥ã€‚å†²çªå¿…é¡»è¢«è§£å†³ã€‚    è¿™ç§æƒ…å†µä¸‹é€‰é¡¹ 3 åº”è¯¥æ˜¯æ­£ç¡®ç­”æ¡ˆã€‚åŸå› å’Œä¹‹å‰ç›¸åŒ: å› ä¸ºç±»å’Œå·¥ç¨‹è¶Šæ¥è¶Šåºå¤§, ç¨‹åºå‘˜å¯èƒ½æ„è¯†ä¸åˆ°ä¸¤ä¸ª role ä¹‹é—´åœ¨å“ªå„¿å‘ç”Ÿå†²çªã€‚æ‰€ä»¥æˆ‘ä»¬æ ‡è®°äº†å®ƒã€‚\nrole Sleeping { method lie { say \u0026#34;æ°´å¹³èººä¸‹\u0026#34;; } } role Lying { method lie { say \u0026#34;è¯´è°...\u0026#34;; } } class SleepingLiar does Sleeping does Lying { } # å†²çª! ä¸‹ä¸€ä¸ªé—®é¢˜, é‚£ä¹ˆ: å½“åœ¨ç±»ä¸­æœ‰ role å†²çªæ—¶, æˆ‘ä»¬æ€ä¹ˆä¿®å¤å®ƒï¼Ÿ ç®€å•: åœ¨ç±»ä¸­è‡ªå·±å®šä¹‰ä¸€ä¸ªåŒåçš„æ–¹æ³•:\nclass SleepingLiar does Sleeping does Lying { method lie { say \u0026#34;Lying in my sleep....\u0026#34;; } } å¦‚æœä½ æƒ³ä»ä¸€ä¸ªè´´åˆ«çš„ role ä¸­è°ƒç”¨ä¸€ä¸ªæ–¹æ³•, è¯­æ³•æ˜¯è¿™æ ·çš„:\nclass SleepingLiar does Sleeping does Lying { method lie { self.Sleeping::lie; } } è¿™å°±æ˜¯ rolesã€‚å®ƒä»¬æŠŠå¯é‡ç”¨çš„è¡Œä¸ºæ··åˆè¿›ç±»ä¸­ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2015-11-16-roles-conflict-in-raku/","tags":["roles"],"title":"Raku ä¸­çš„è§’è‰²å†²çª"},{"categories":["rakulang"],"contents":"Raku ä¸ºé¢å‘å¯¹è±¡ç¼–ç¨‹(OOP)æä¾›å¼ºå¤§æ”¯æŒã€‚å°½ç®¡ Raku å…è®¸ç¨‹åºå‘˜ä»¥å¤šç§èŒƒå¼è¿›è¡Œç¼–ç¨‹, ä½†é¢å‘å¯¹è±¡ç¼–ç¨‹æ˜¯è¯¥è¯­è¨€çš„æ ¸å¿ƒã€‚\nRaku å¸¦æœ‰ä¸°å¯Œçš„é¢„å®šä¹‰ç±»å‹, å¯åˆ†ä¸ºä¸¤ç±»ï¼šå¸¸è§„ç±»å‹å’ŒåŸç”Ÿç±»å‹ã€‚æ‰€æœ‰ä½ èƒ½å­˜å‚¨åˆ°å˜é‡ä¸­çš„ä¸œè¥¿è¦ä¹ˆæ˜¯ä¸€ä¸ªåŸç”Ÿçš„ value, è¦ä¹ˆæ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚è¿™åŒ…æ‹¬å­—é¢å€¼ã€ç±»å‹ï¼ˆç±»å‹å¯¹è±¡ï¼‰ã€code å’Œå®¹å™¨ã€‚\nåŸç”Ÿç±»å‹ç”¨äºåº•å±‚ç±»å‹ï¼ˆä¾‹å¦‚ uint64ï¼‰ã€‚å°½ç®¡åŸç”Ÿç±»å‹æ²¡æœ‰å’Œå¯¹è±¡åŒæ ·çš„åŠŸèƒ½, å¦‚æœåœ¨å…¶ä¸Šè°ƒç”¨æ–¹æ³•, å®ƒä»¬ä¹Ÿä¼šè‡ªåŠ¨è£…å…¥æ™®é€šå¯¹è±¡ã€‚\nä¸€åˆ‡ä¸æ˜¯åŸç”Ÿå€¼çš„ä¸œè¥¿éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚å¯¹è±¡ç¡®å®å…è®¸ç»§æ‰¿å’Œå°è£…ã€‚\nä½¿ç”¨å¯¹è±¡ è¦åœ¨å¯¹è±¡ä¸Šè°ƒç”¨æ–¹æ³•, è¯·åœ¨å¯¹è±¡åä¸Šæ·»åŠ ä¸€ä¸ªç‚¹, ç„¶åæ·»åŠ æ–¹æ³•åç§°ï¼š\nsay \u0026#34;abc\u0026#34;.uc; # OUTPUT: Â«ABCâ¤Â»  è¿™å°†åœ¨ \u0026ldquo;abc\u0026rdquo; ä¸Šè°ƒç”¨ uc æ–¹æ³•, è¿™æ˜¯ä¸€ä¸ª Str ç±»å‹çš„å¯¹è±¡ã€‚è¦ä¸ºæ–¹æ³•æä¾›å‚æ•°, è¯·åœ¨æ–¹æ³•åé¢çš„æ‹¬å·å†…æ·»åŠ å‚æ•°ã€‚\nmy $formatted-text = \u0026#34;Fourscore and seven years ago...\u0026#34;.indent(8); say $formatted-text; # OUTPUT: Â« Fourscore and seven years ago...Â»  $formatted-text ç°åœ¨åŒ…å«ä¸Šé¢çš„æ–‡æœ¬, ä½†ç¼©è¿›äº†8ä¸ªç©ºæ ¼ã€‚\nå¤šä¸ªå‚æ•°ç”±é€—å·åˆ†éš”ï¼š\nmy @words = \u0026#34;Abe\u0026#34;, \u0026#34;Lincoln\u0026#34;; @words.push(\u0026#34;said\u0026#34;, $formatted-text.comb(/\\w+/)); say @words; # OUTPUT: Â«[Abe Lincoln said (Fourscore and seven years ago)]â¤Â»  ç±»ä¼¼åœ°, å¯ä»¥é€šè¿‡åœ¨æ–¹æ³•åæ”¾ç½®å†’å·å¹¶ä½¿ç”¨é€—å·åˆ†éš”å‚æ•°åˆ—è¡¨æ¥æŒ‡å®šå¤šä¸ªå‚æ•°ï¼š\nsay @words.join(\u0026#39;--\u0026#39;).subst: \u0026#39;years\u0026#39;, \u0026#39;DAYS\u0026#39;; # OUTPUT: Â«Abe--Lincoln--said--Fourscore and seven DAYS agoâ¤Â»  å¦‚æœè¦åœ¨æ²¡æœ‰æ‹¬å·çš„æƒ…å†µä¸‹ä¼ é€’å‚æ•°, åˆ™å¿…é¡»åœ¨æ–¹æ³•ä¹‹åæ·»åŠ ä¸€ä¸ª :, å› æ­¤æ²¡æœ‰å†’å·æˆ–æ‹¬å·çš„æ–¹æ³•è°ƒç”¨æ˜ç¡®åœ°æ˜¯æ²¡æœ‰å‚æ•°åˆ—è¡¨çš„æ–¹æ³•è°ƒç”¨ï¼š\nsay 4.log: ; # OUTPUT: Â«1.38629436111989â¤Â» ( natural logarithm of 4 )  say 4.log: +2; # OUTPUT: Â«2â¤Â» ( base-2 logarithm of 4 )  say 4.log +2; # OUTPUT: Â«3.38629436111989â¤Â» ( natural logarithm of 4, plus 2 ) è®¸å¤šçœ‹èµ·æ¥ä¸åƒæ–¹æ³•è°ƒç”¨çš„æ“ä½œï¼ˆä¾‹å¦‚, æ™ºèƒ½åŒ¹é…æˆ–å°†å¯¹è±¡æ’å€¼åˆ°å­—ç¬¦ä¸²ä¸­ï¼‰å¯èƒ½ä¼šå¯¼è‡´æ–¹æ³•è°ƒç”¨ã€‚\næ–¹æ³•å¯ä»¥è¿”å›å¯å˜å®¹å™¨, åœ¨è¿™ç§æƒ…å†µä¸‹, æ‚¨å¯ä»¥åˆ†é…æ–¹æ³•è°ƒç”¨çš„è¿”å›å€¼ã€‚è¿™æ˜¯ä½¿ç”¨å¯¹è±¡çš„å¯è¯»å†™å±æ€§çš„æ–¹å¼ï¼š\n$*IN.nl-in = \u0026#34;\\r\\n\u0026#34;; åœ¨è¿™é‡Œ, æˆ‘ä»¬åœ¨ $*IN å¯¹è±¡ä¸Šè°ƒç”¨ nl-in æ–¹æ³•, ä¸å¸¦å‚æ•°, å¹¶ä½¿ç”¨ = è¿ç®—ç¬¦å°†å…¶èµ‹å€¼ç»™å®ƒè¿”å›çš„å®¹å™¨ã€‚\næ‰€æœ‰å¯¹è±¡éƒ½æ”¯æŒç±»Muçš„æ–¹æ³•, å®ƒæ˜¯å±‚æ¬¡ç»“æ„çš„æ ¹ã€‚æ‰€æœ‰å¯¹è±¡éƒ½æ¥è‡ª Muã€‚\nç±»å‹å¯¹è±¡ ç±»å‹æœ¬èº«æ˜¯å¯¹è±¡, ä½ å¯ä»¥ä½¿ç”¨ç±»å‹çš„åå­—è·å–ç±»å‹å¯¹è±¡:\nmy $int-type-obj = Int; ä½ å¯ä»¥é€šè¿‡è°ƒç”¨ WHAT æ–¹æ³•æŸ¥çœ‹ä»»ä½•å¯¹è±¡çš„ type object(å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªæ–¹æ³•å½¢å¼çš„å®):\nmy $int-type-obj = 1.WHAT; ä½¿ç”¨ === æ’ç­‰è¿ç®—ç¬¦å¯ä»¥æ¯”è¾ƒç±»å‹å¯¹è±¡(Mué™¤å¤–)çš„ç›¸ç­‰æ€§ï¼š\nsub f(Int $x) { if $x.WHAT === Int { say \u0026#39;you passed an Int\u0026#39;; } else { say \u0026#39;you passed a subtype of Int\u0026#39;; } } è™½ç„¶, åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹, .isaæ–¹æ³•å°±è¶³å¤Ÿäº†ï¼š\nsub f($x) { if $x.isa(Int) { ... } ... } å­ç±»å‹å¯ä»¥ä½¿ç”¨ smartmatching æ¥æ£€æŸ¥ï¼š\nif $type ~~ Real { say \u0026#39;$type contains Real or a subtype thereof\u0026#39;; } ç±» ä½¿ç”¨ class å…³é”®å­—è¿›è¡Œç±»çš„å£°æ˜, é€šå¸¸åè·Ÿç±»åï¼š\nclass Journey { } æ­¤å£°æ˜ä¼šåˆ›å»ºç±»å‹å¯¹è±¡å¹¶å°†å…¶å®‰è£…åœ¨åå­— Journey ä¸‹çš„å½“å‰åŒ…å’Œå½“å‰è¯æ³•ä½œç”¨åŸŸä¸­ã€‚æ‚¨è¿˜å¯ä»¥é€šè¿‡è¯æ³•å£°æ˜ç±»\nmy class Journey { } è¿™é™åˆ¶äº†å®ƒä»¬å¯¹å½“å‰è¯æ³•èŒƒå›´çš„å¯è§æ€§, å¦‚æœè¯¥ç±»æ˜¯åµŒå¥—åœ¨æ¨¡å—æˆ–å¦ä¸€ä¸ªç±»ä¸­çš„å®ç°ç»†èŠ‚, è¿™å¯èƒ½å¾ˆæœ‰ç”¨ã€‚\nå±æ€§ å±æ€§å­˜åœ¨äºæ¯ä¸ªç±»çš„å®ä¾‹ä¸­ã€‚å±æ€§ä¸­å­˜å‚¨ç€å¯¹è±¡çš„çŠ¶æ€ã€‚åœ¨ Raku ä¸­, ä¸€åˆ‡å±æ€§éƒ½æ˜¯ç§æœ‰çš„. å®ƒä»¬ä¸€èˆ¬ä½¿ç”¨ has å…³é”®å­—å’Œ ! twigil è¿›è¡Œå£°æ˜ã€‚\nclass Journey { has $!origin; has $!destination; has @!travellers; has $!notes; } è™½ç„¶æ²¡æœ‰å…¬å…±(ç”šè‡³ä¿æŠ¤å±æ€§)å±æ€§, ä¸è¿‡æœ‰ä¸€ç§æ–¹å¼å¯ä»¥è‡ªåŠ¨ç”Ÿæˆè®¿é—®å™¨æ–¹æ³•: ä½¿ç”¨ . twigil ä»£æ›¿ ! twigil ã€‚(é‚£ä¸ª . åº”è¯¥è®©ä½ æƒ³èµ·äº†æ–¹æ³•è°ƒç”¨)ã€‚\nclass Journey { has $.origin; has $.destination; has @!travellers; has $.notes; } è¿™é»˜è®¤æä¾›åªè¯»è®¿é—®å™¨, ä¸ºäº†å…è®¸æ›´æ”¹å±æ€§, è¦æ·»åŠ  is rw ç‰¹æ€§:\nclass Journey { has $.origin; has $.destination; has @!travellers; has $.notes is rw; } ç°åœ¨, Journeyå¯¹è±¡åˆ›å»ºä¹‹å, å®ƒçš„ .origin, .destination å’Œ .notes éƒ½èƒ½ä»ç±»çš„å¤–éƒ¨è®¿é—®, ä½†åªæœ‰ .notes å¯ä»¥è¢«ä¿®æ”¹ã€‚\nå¦‚æœåœ¨æ²¡æœ‰æŸäº›å±æ€§ï¼ˆä¾‹å¦‚ origin æˆ– destinationï¼‰çš„æƒ…å†µä¸‹å®ä¾‹åŒ–å¯¹è±¡, æˆ‘ä»¬å¯èƒ½æ— æ³•è·å¾—æƒ³è¦çš„ç»“æœã€‚è¦é˜²æ­¢è¿™ç§æƒ…å†µ, è¯·æä¾›é»˜è®¤å€¼æˆ–é€šè¿‡ä½¿ç”¨is required trait æ¥æ ‡è®°å±æ€§ä»¥ç¡®ä¿åœ¨å¯¹è±¡åˆ›å»ºæ—¶è®¾ç½®å±æ€§ã€‚\nclass Journey { # error if origin is not provided  has $.origin is required; # set the destination to Orlando as default (unless that is the origin!)  has $.destination = self.origin eq \u0026#39;Orlando\u0026#39; ?? \u0026#39;Kampala\u0026#39; !! \u0026#39;Orlando\u0026#39;; has @!travelers; has $.notes is rw; } å› ä¸ºç±»ä» Mu ç»§æ‰¿äº†ä¸€ä¸ªé»˜è®¤çš„æ„é€ å™¨, å¹¶ä¸”æˆ‘ä»¬ä¹Ÿè¦æ±‚ç±»ä¸ºæˆ‘ä»¬ç”Ÿæˆä¸€äº›è®¿é—®å™¨æ–¹æ³•.\n# åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»çš„å®ä¾‹. my $vacation = Journey.new( origin =\u0026gt; \u0026#39;Sweden\u0026#39;, destination =\u0026gt; \u0026#39;Switzerland\u0026#39;, notes =\u0026gt; \u0026#39;Pack hiking gear!\u0026#39; ); # ä½¿ç”¨è®¿é—®å™¨; è¿™æ‰“å°å‡º Sweden. say $vacation.origin; # ä½¿ç”¨ rw å­˜å–å™¨æ¥æ›´æ”¹å±æ€§çš„å€¼. $vacation.notes = \u0026#39;Pack hiking gear and sunglasses!\u0026#39;; è¯·æ³¨æ„, è™½ç„¶é»˜è®¤æ„é€ å‡½æ•°å¯ä»¥åˆå§‹åŒ–åªè¯»å±æ€§, ä½†å®ƒåªä¼šè®¾ç½®å…·æœ‰è®¿é—®å™¨æ–¹æ³•çš„å±æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´, å³ä½¿æ‚¨ä¼ é€’ travelers =\u0026gt; [\u0026quot;Alex\u0026quot;, \u0026quot;Betty\u0026quot;] ç»™é»˜è®¤æ„é€ å‡½æ•°, @!travelers ä¹Ÿä¸ä¼šåˆå§‹åŒ–è¯¥å±æ€§ã€‚\næ–¹æ³• ä½¿ç”¨ method å…³é”®å­—åœ¨ç±»çš„ body ä¸­å£°æ˜æ–¹æ³•ï¼š\nclass Journey { has $.origin; has $.destination; has @!travellers; has $.notes is rw; method add_traveller($name) { if $name ne any(@!travellers) { push @!travellers, $name; } else { warn \u0026#34;$nameis already going on the journey!\u0026#34;; } } method describe() { \u0026#34;From $!originto $!destination\u0026#34; } } æ–¹æ³•å¯ä»¥æœ‰ç­¾å, å°±åƒå­ä¾‹ç¨‹ä¸€æ ·ã€‚ å±æ€§å¯ä»¥åœ¨æ–¹æ³•ä¸­ä½¿ç”¨, å¹¶ä¸”å¯ä»¥å§‹ç»ˆä¸ ! twigil ä¸€èµ·ä½¿ç”¨, å³ä½¿å±æ€§æ˜¯ç”¨ . twigil å£°æ˜çš„ã€‚ è¿™æ˜¯å› ä¸º . twigil å£°æ˜äº† ! twigil å¹¶ç”Ÿæˆä¸€ä¸ªè®¿é—®æ–¹æ³•ã€‚\nçœ‹çœ‹ä¸Šé¢çš„ä»£ç , åœ¨æ–¹æ³• describe ä¸­ä½¿ç”¨ $!origin å’Œ $.origin æœ‰ä¸€ä¸ªå¾®å¦™ä½†é‡è¦çš„åŒºåˆ«ã€‚$!origin æ˜¯ä¸€ç§å»‰ä»·ä¸”æ˜æ˜¾çš„å±æ€§æŸ¥æ‰¾ã€‚$.origin æ˜¯ä¸€ä¸ªæ–¹æ³•è°ƒç”¨, å› æ­¤å¯ä»¥åœ¨å­ç±»ä¸­é‡å†™ã€‚åªåœ¨ä½ æƒ³è¦å…è®¸è¦†ç›–æ—¶ä½¿ç”¨ $.originã€‚\nä¸å­ä¾‹ç¨‹ä¸åŒ, å…¶ä»–å‘½åå‚æ•°ä¸ä¼šäº§ç”Ÿç¼–è¯‘æ—¶æˆ–è¿è¡Œæ—¶é”™è¯¯ã€‚è¿™å…è®¸é€šè¿‡é‡æ–°åˆ†æ´¾æ¥é“¾æ¥æ–¹æ³•ã€‚\nä½ å¯ä»¥ç¼–å†™è‡ªå·±çš„è®¿é—®å™¨æ¥è¦†ç›–ä»»ä½•æˆ–æ‰€æœ‰è‡ªåŠ¨ç”Ÿæˆçš„è®¿é—®å™¨ã€‚\nmy $â²§ = \u0026#34;\u0026#34; xx 4; # A tab-like thing  class Journey { has $.origin; has $.destination; has @.travelers; has Str $.notes is rw; multi method notes() { \u0026#34;$!notes\\n\u0026#34; }; multi method notes( Str $note ) { $!notes ~= \u0026#34;$note\\n$â²§\u0026#34; }; method Str { \u0026#34;â¤· $!origin\\n$â²§\u0026#34; ~ self.notes() ~ \u0026#34;$!destinationâ¤¶\\n\u0026#34; }; } my $trip = Journey.new( :origin\u0026lt;Here\u0026gt;, :destination\u0026lt;There\u0026gt;, travelers =\u0026gt; \u0026lt;Ã¾or Freya\u0026gt; ); $trip.notes(\u0026#34;First steps\u0026#34;); notes $trip: \u0026#34;Almost there\u0026#34;; print $trip; # OUTPUT:  #â¤· Here  # First steps  # Almost there  #  #There â¤¶  å£°æ˜çš„ multi æ–¹æ³• notes ä½¿ç”¨ä¸åŒçš„ç­¾åè¿›è¡Œè¯»å†™, notes è¦†ç›–äº† $.notes å£°æ˜ä¸­éšå«çš„è‡ªåŠ¨ç”Ÿæˆçš„æ–¹æ³•ã€‚\nè¯·æ³¨æ„, åœ¨ notes $trip: \u0026quot;Almost there\u0026quot; ä¸­æˆ‘ä»¬ä½¿ç”¨äº†é—´æ¥è°ƒç”¨è¯­æ³•, å®ƒé¦–å…ˆæ”¾ç½®æ–¹æ³•åç§°, ç„¶åæ”¾ç½®å¯¹è±¡, ç„¶åç”¨å†’å·åˆ†éš”å‚æ•°ï¼šmethod invocant: argumentsã€‚åªè¦æ„Ÿè§‰æ¯”ç»å…¸çš„å¥ç‚¹å’Œæ‹¬å·æ›´è‡ªç„¶, æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è¿™ç§è¯­æ³•ã€‚å®ƒçš„å·¥ä½œåŸç†å®Œå…¨ç›¸åŒã€‚\nå¯ä»¥åœ¨è¿è¡Œæ—¶ä½¿ç”¨ .\u0026quot;\u0026quot; è¿ç®—ç¬¦è§£ææ–¹æ³•åç§°ã€‚\nclass A { has $.b }; my $name = \u0026#39;b\u0026#39;; A.new.\u0026#34;$name\u0026#34;().say; # OUTPUT: Â«(Any)â¤Â»  ç›¸å¯¹äºå…ˆå‰çš„å±æ€§éƒ¨åˆ†, è¿‡å»ç”¨äºæ›´æ–° $.notes çš„è¯­æ³•åœ¨æœ¬èŠ‚å·²æ”¹å˜ã€‚ä»£æ›¿èµ‹å€¼ï¼š\n$vacation.notes = \u0026#39;Pack hiking gear and sunglasses!\u0026#39;; æˆ‘ä»¬ç°åœ¨åšä¸€ä¸ªæ–¹æ³•è°ƒç”¨:\n$trip.notes(\u0026#34;First steps\u0026#34;); è¦†ç›–é»˜è®¤çš„è‡ªåŠ¨ç”Ÿæˆçš„è®¿é—®å™¨æ„å‘³ç€å®ƒåœ¨è¿”å›èµ‹å€¼æ—¶æä¾›å¯å˜å®¹å™¨ä¸å†å¯ç”¨ã€‚æ–¹æ³•è°ƒç”¨æ˜¯å°†å±æ€§çš„æ›´æ–°æ·»åŠ åˆ°è®¡ç®—å’Œé€»è¾‘çš„é¦–é€‰æ–¹æ³•ã€‚è®¸å¤šç°ä»£è¯­è¨€å¯ä»¥é€šè¿‡ä½¿ç”¨ â€œsetterâ€ æ–¹æ³•é‡è½½èµ‹å€¼æ¥æ›´æ–°å±æ€§ã€‚è™½ç„¶ Raku å¯ä»¥ä¸ºæ­¤ç›®çš„ä½¿ç”¨ Proxy å¯¹è±¡é‡è½½èµ‹å€¼è¿ç®—ç¬¦, ä½†æ˜¯ç›®å‰ä¸é¼“åŠ±ä½¿ç”¨å¤æ‚é€»è¾‘é‡è½½èµ‹å€¼è¿ç®—ç¬¦æ¥è®¾ç½®å±æ€§ä½œä¸ºå¼±é¢å‘å¯¹è±¡è®¾è®¡ã€‚\nhas $!attribute method attribute() { ... } class A { has $.attr is rw; } ç­‰ä»·äº:\nclass A { has $!attr; method attr() is rw { $!attr; } } ç±»å’Œå®ä¾‹æ–¹æ³• æ–¹æ³•çš„ç­¾åå¯ä»¥æœ‰ä¸€ä¸ªè°ƒç”¨è€…(invocant)ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°, åè·Ÿä¸€ä¸ªå†’å·, è¿™å…è®¸è¯¥æ–¹æ³•å¼•ç”¨å®ƒè¢«è°ƒç”¨çš„å¯¹è±¡ã€‚\nclass Foo { method greet($me: $person) { say \u0026#34;Hi, I am $me.^name(), nice to meet you, $person\u0026#34;; } } Foo.new.greet(\u0026#34;Bob\u0026#34;); # OUTPUT: Â«Hi, I am Foo, nice to meet you, Bobâ¤Â»  åœ¨æ–¹æ³•ç­¾åä¸­æä¾›è°ƒç”¨è€…è¿˜å…è®¸é€šè¿‡ä½¿ç”¨ç±»å‹çº¦æŸå°†æ–¹æ³•å®šä¹‰ä¸ºç±»æ–¹æ³•æˆ–å¯¹è±¡æ–¹æ³•ã€‚::?CLASS å˜é‡å¯ç”¨äºåœ¨ç¼–è¯‘æ—¶æä¾›ç±»å, ä¸ :Uï¼ˆå¯¹äºç±»æ–¹æ³•ï¼‰æˆ– :Dï¼ˆå¯¹äºå®ä¾‹æ–¹æ³•ï¼‰ç»“åˆä½¿ç”¨ã€‚\nclass Pizza { has $!radius = 42; has @.ingredients; # ç±»æ–¹æ³•: construct from a list of ingredients  method from-ingredients(::?CLASS:U $pizza: @ingredients) { $pizza.new( ingredients =\u0026gt; @ingredients ); } # å®ä¾‹æ–¹æ³•  method get-radius(::?CLASS:D:) { $!radius } } my $p = Pizza.from-ingredients: \u0026lt;cheese pepperoni vegetables\u0026gt;; say $p.ingredients; # OUTPUT: Â«[cheese pepperoni vegetables]â¤Â»  say $p.get-radius; # OUTPUT: Â«42â¤Â»  say Pizza.get-radius; # This will fail.  CATCH { default { put .^name ~ \u0026#34;:\\n\u0026#34; ~ .Str } }; # OUTPUT: Â«X::Parameter::InvalidConcreteness:â¤  # Invocant of method \u0026#39;get-radius\u0026#39; must be  # an object instance of type \u0026#39;Pizza\u0026#39;,  # not a type object of type \u0026#39;Pizza\u0026#39;.  # Did you forget a \u0026#39;.new\u0026#39;?Â»  é€šè¿‡ä½¿ç”¨multiå£°æ˜ç¬¦, æ–¹æ³•æ—¢å¯ä»¥æ˜¯ç±»æ–¹æ³•ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡æ–¹æ³•ï¼š\nclass C { multi method f(::?CLASS:U:) { say \u0026#34;class method\u0026#34; } multi method f(::?CLASS:D:) { say \u0026#34;object method\u0026#34; } } C.f; # OUTPUT: Â«class methodâ¤Â»  C.new.f; # OUTPUT: Â«object methodâ¤Â»  self åœ¨æ–¹æ³•å†…éƒ¨, æœ¯è¯­ self å¯ç”¨å¹¶ç»‘å®šåˆ°è°ƒç”¨å¯¹è±¡ã€‚self å¯ä»¥ç”¨æ¥è°ƒç”¨è°ƒç”¨è€…çš„å…¶ä»–æ–¹æ³•, åŒ…æ‹¬æ„é€ å‡½æ•°ï¼š\nclass Box { has $.data; method make-new-box-from() { self.new: data =\u0026gt; $!data; } } self ä¹Ÿå¯ä»¥ç”¨åœ¨ç±»æ–¹æ³•æˆ–å®ä¾‹æ–¹æ³•ä¸­, ä½†è¦æ³¨æ„å°è¯•ä»å¦ä¸€ä¸ªæ–¹æ³•è°ƒç”¨ä¸€ç§ç±»å‹çš„æ–¹æ³•ï¼š\nclass C { method g() { 42 } method f(::?CLASS:U:) { self.g } method d(::?CLASS:D:) { self.f } } C.f; # OUTPUT: Â«42â¤Â»  C.new.d; # This will fail.  CATCH { default { put .^name ~ \u0026#34;:\\n\u0026#34; ~ .Str } }; # OUTPUT: Â«X::Parameter::InvalidConcreteness:â¤  # Invocant of method \u0026#39;f\u0026#39; must be a type object of type \u0026#39;C\u0026#39;,  # not an object instance of type \u0026#39;C\u0026#39;. Did you forget a \u0026#39;multi\u0026#39;?Â»  self ä¹Ÿå¯ä»¥ä¸å±æ€§ä¸€èµ·ä½¿ç”¨, åªè¦å®ƒä»¬å…·æœ‰è®¿é—®å™¨ã€‚self.a å°†ä¸ºå£°æ˜ä¸º has $.a çš„å±æ€§è°ƒç”¨è®¿é—®å™¨ã€‚ç„¶è€Œ, self.a å’Œ $.a ä¹‹é—´å­˜åœ¨å·®å¼‚, å› ä¸ºåè€…å°†é¡¹åŒ–; $.a å°†ç­‰åŒäº self.a.item æˆ– $(self.a)ã€‚\nclass A { has $.x = (1, 2, 3); method b() { .say for self.x; .say for $.x } }; A.new.b; # OUTPUT: Â«1â¤2â¤3â¤(1 2 3)â¤Â»  æ–¹æ³•è°ƒç”¨çš„å†’å·è¯­æ³•ä»…æ”¯æŒä½¿ç”¨æ–¹æ³•è°ƒç”¨ self, è€Œä¸æ”¯æŒå¿«æ·æ–¹å¼ã€‚\nè¯·æ³¨æ„, å¦‚æœ Mu ä¸­çš„ç›¸å…³æ–¹æ³• bless, CREATE æ²¡æœ‰é‡è½½, self å°†æŒ‡å‘è¿™äº›æ–¹æ³•çš„ç±»å‹å¯¹è±¡ã€‚\nåœ¨å¦ä¸€æ–¹é¢, åœ¨åˆå§‹åŒ–çš„ä¸åŒé˜¶æ®µ, åœ¨å®ä¾‹ä¸Šè°ƒç”¨å­æ–¹æ³• BUILD å’Œ TWEAKã€‚å­ç±»ä¸­åŒåçš„å­æ–¹æ³•å°šæœªè¿è¡Œ, å› æ­¤ä½ ä¸åº”è¯¥ä¾èµ–è¿™äº›æ–¹æ³•ä¸­çš„æ½œåœ¨è™šæ–¹æ³•è°ƒç”¨ã€‚\nç§æœ‰æ–¹æ³• æ–¹æ³•åå‰å¸¦æœ‰æ„Ÿå¹å·çš„æ–¹æ³•ä¸èƒ½ä»å®šä¹‰ç±»ä¹‹å¤–çš„ä»»ä½•åœ°æ–¹è°ƒç”¨; è¿™äº›æ–¹æ³•æ˜¯ç§æœ‰çš„, å› ä¸ºå®ƒä»¬åœ¨å£°æ˜å®ƒä»¬çš„ç±»ä¹‹å¤–æ˜¯ä¸å¯è§çš„ã€‚ä½¿ç”¨æ„Ÿå¹å·è€Œä¸æ˜¯ç‚¹å·è°ƒç”¨ç§æœ‰æ–¹æ³•ï¼š\nclass FunMath { has $.value is required; method !do-subtraction( $num ) { if $num ~~ Str { return $!value + (-1 * $num.chars); } return $!value + (-1 * $num); } method minus( $minuend: $subtrahend ) { # invoking the private method on the explicit invocant  $minuend!do-subtraction($subtrahend); } } my $five = FunMath.new(value =\u0026gt; 5); say $five.minus(6); # OUTPUT: Â«-1â¤Â»  say $five.do-subtraction(6); CATCH { default { put .^name ~ \u0026#34;:\\n\u0026#34; ~ .Str } } # OUTPUT: Â«X::Method::NotFound:  # No such method \u0026#39;do-subtraction\u0026#39; for invocant of type  # \u0026#39;FunMath\u0026#39;. Did you mean \u0026#39;!do-subtraction\u0026#39;?â¤Â»  ç§æœ‰æ–¹æ³•ä¸èƒ½è¢«å­ç±»ç»§æ‰¿ã€‚\nå­æ–¹æ³• å­æ–¹æ³•æ˜¯å­ç±»ä¸ç»§æ‰¿çš„å…¬å…±æ–¹æ³•ã€‚è¯¥åç§°æºäºå®ƒä»¬åœ¨è¯­ä¹‰ä¸Šä¸å­ä¾‹ç¨‹ç±»ä¼¼çš„äº‹å®ã€‚\nå­æ–¹æ³•å¯¹äºå¯¹è±¡æ„é€ å’Œé”€æ¯ä»»åŠ¡ä»¥åŠç‰¹å®šäºç‰¹å®šç±»å‹çš„ä»»åŠ¡éå¸¸æœ‰ç”¨, å› æ­¤å­ç±»å‹å¿…é¡»é‡å†™å®ƒä»¬ã€‚\nä¾‹å¦‚, é»˜è®¤æ–¹æ³• new åœ¨ç»§æ‰¿é“¾ä¸­çš„æ¯ä¸ªç±»ä¸Šè°ƒç”¨ submethod BUILD:\nclass Point2D { has $.x; has $.y; submethod BUILD(:$!x, :$!y) { say \u0026#34;Initializing Point2D\u0026#34;; } } class InvertiblePoint2D is Point2D { submethod BUILD() { say \u0026#34;Initializing InvertiblePoint2D\u0026#34;; } method invert { self.new(x =\u0026gt; - $.x, y =\u0026gt; - $.y); } } say InvertiblePoint2D.new(x =\u0026gt; 1, y =\u0026gt; 2); # OUTPUT: Â«Initializing Point2Dâ¤Â»  # OUTPUT: Â«Initializing InvertiblePoint2Dâ¤Â»  # OUTPUT: Â«InvertiblePoint2D.new(x =\u0026gt; 1, y =\u0026gt; 2)â¤Â»  å¦è¯·å‚è§ï¼šObject_constructionã€‚\nç»§æ‰¿ ç±»å¯ä»¥æœ‰çˆ¶ç±»:\nclass Child is Parent1 is Parent2 { } å¦‚æœåœ¨å­ç±»ä¸Šè°ƒç”¨ä¸€ä¸ªæ–¹æ³•, ä½†æ˜¯å­ç±»æ²¡æœ‰æä¾›è¯¥æ–¹æ³•, åˆ™è°ƒç”¨å…¶ä¸­ä¸€ä¸ªçˆ¶ç±»ä¸­åŒåæ–¹æ³•(å¦‚æœå­˜åœ¨)ã€‚çˆ¶ç±»è¢«æŸ¥è¯¢çš„é¡ºåºå°±å«åšæ–¹æ³•è§£æé¡ºåº(MRO)ã€‚Raku ä½¿ç”¨ C3 æ–¹æ³•è§£æé¡ºåºã€‚ä½ å¯ä»¥é€šè¿‡è°ƒç”¨ç±»å‹çš„å…ƒç±»å‹æ–¹æ³•å¾—çŸ¥è¿™ä¸ªç±»å‹çš„ MRO.\nå¦‚æœä¸€ä¸ªç±»æ²¡æœ‰æŒ‡å®šå®ƒçš„çˆ¶ç±», å°±é»˜è®¤ä½¿ç”¨ Any. æ‰€æœ‰çš„ç±»éƒ½ç›´æ¥æˆ–é—´æ¥çš„æ´¾ç”Ÿäº Mu - ç±»å‹å±‚çº§ç»“æ„çš„æ ¹ã€‚\næ‰€æœ‰å¯¹å…¬å…±æ–¹æ³•çš„è°ƒç”¨éƒ½æ˜¯ C++ æ„ä¹‰ä¸Šçš„â€œè™šæ‹Ÿâ€, è¿™æ„å‘³ç€å¯¹è±¡çš„å®é™…ç±»å‹å†³å®šäº†è¦è°ƒç”¨çš„æ–¹æ³•, è€Œä¸æ˜¯å£°æ˜çš„ç±»å‹ï¼š\nclass Parent { method frob { say \u0026#34;the parent class frobs\u0026#34; } } class Child is Parent { method frob { say \u0026#34;the child\u0026#39;s somewhat more fancy frob is called\u0026#34; } } my Parent $test; $test = Child.new; $test.frob; # calls the frob method of Child rather than Parent  # OUTPUT: Â«the child\u0026#39;s somewhat more fancy frob is calledâ¤Â»  å¯¹è±¡æ„é€  å¯¹è±¡é€šå¸¸é€šè¿‡æ–¹æ³•è°ƒç”¨åˆ›å»º, æˆ–è€…é€šè¿‡ç±»å‹å¯¹è±¡æˆ–è€…é€šè¿‡åŒç±»å‹çš„å…¶å®ƒå¯¹è±¡åˆ›å»ºã€‚\nç±» Mu æä¾›äº†ä¸€ä¸ªåä¸º new çš„æ„é€ å‡½æ•°æ–¹æ³•, å®ƒæ¥å—å‘½åå‚æ•°å¹¶ä½¿ç”¨å®ƒä»¬æ¥åˆå§‹åŒ–å…¬å…±å±æ€§ã€‚\nclass Point { has $.x; has $.y; } my $p = Point.new( x =\u0026gt; 5, y =\u0026gt; 2); # ^^^ inherited from class Mu say \u0026#34;x: \u0026#34;, $p.x; say \u0026#34;y: \u0026#34;, $p.y; # OUTPUT: Â«x: 5â¤Â»  # OUTPUT: Â«y: 2â¤Â»  Mu.new åœ¨è°ƒç”¨è€…èº«ä¸Šè°ƒç”¨ bless æ–¹æ³•, ä¼ é€’æ‰€æœ‰çš„å‘½åå‚æ•°ã€‚ bless åˆ›å»ºæ–°çš„å¯¹è±¡, ç„¶åä»¥åå‘æ–¹æ³•è§£æé¡ºåº(å³ä»Muåˆ°å¤§å¤šæ•°æ´¾ç”Ÿç±»)éå†æ‰€æœ‰å­ç±», å¹¶ä¸”åœ¨æ¯ä¸ªç±»ä¸­æ£€æŸ¥æ˜¯å¦å­˜åœ¨åä¸º BUILD çš„æ–¹æ³•ã€‚ å¦‚æœè¯¥æ–¹æ³•å­˜åœ¨, åˆ™ä½¿ç”¨è¯¥æ–¹æ³•ä¸­çš„æ‰€æœ‰å‘½åå‚æ•°è°ƒç”¨è¯¥ new æ–¹æ³•ã€‚å¦‚æœä¸å­˜åœ¨åä¸º BUILD çš„æ–¹æ³•, è¿™ä¸ªç±»çš„å…¬å¼€å±æ€§å°±ä¼šç”¨åŒåçš„å‘½åå‚æ•°è¿›è¡Œåˆå§‹åŒ–ã€‚ åœ¨ä»»ä½•ä¸€ç§æƒ…å†µä¸‹, å¦‚æœ BULID æ–¹æ³•å’Œ é»˜è®¤æ„é€ å‡½æ•° éƒ½æ²¡æœ‰å¯¹å±æ€§è¿›è¡Œåˆå§‹åŒ–, åˆ™åº”ç”¨é»˜è®¤å€¼ã€‚è¿™æ„å‘³ç€ BUILD å¯ä»¥æ›´æ”¹å±æ€§, ä½†å®ƒæ— æƒè®¿é—®å£°æ˜ä¸ºå…¶é»˜è®¤å€¼çš„å±æ€§çš„å†…å®¹; è¿™äº›åªåœ¨ TWEAKï¼ˆè§ä¸‹æ–‡ï¼‰ä¸­å¯ç”¨, å®ƒå¯ä»¥â€œçœ‹åˆ°â€åœ¨ç±»çš„å£°æ˜ä¸­åˆå§‹åŒ–çš„å±æ€§çš„å†…å®¹ã€‚\nåœ¨ BUILD è¢«è°ƒç”¨ä¹‹å, åä¸º TWEAK çš„æ–¹æ³•ä¼šè¢«è°ƒç”¨, å¦‚æœå®ƒä»¬å­˜åœ¨, ä¼ é€’ç»™ new çš„æ‰€æœ‰å‘½åå‚æ•°ä¹Ÿä¼šä¼ é€’ç»™ TWEAKã€‚è¯·å‚é˜…ä¸‹é¢çš„ä½¿ç”¨ç¤ºä¾‹ã€‚\nç”±äº BUILD å’Œ TWEAK å­æ–¹æ³•çš„é»˜è®¤è¡Œä¸º, æ´¾ç”Ÿäº Mu çš„ new æ„é€ å‡½æ•°çš„å‘½åå‚æ•°å¯ç›´æ¥å¯¹åº”çš„ä»»ä½•æ–¹æ³•è§£æé¡ºåºç±»çš„å…¬å…±å±æ€§, æˆ–å¯¹åº”äºä»»ä½• BUILD æˆ– TWEAK å­æ–¹æ³•çš„ä»»ä½•å‘½åå‚æ•°ã€‚\næ­¤å¯¹è±¡æ„é€ æ–¹æ¡ˆå¯¹è‡ªå®šä¹‰æ„é€ å‡½æ•°æœ‰å‡ ä¸ªå«ä¹‰ã€‚é¦–å…ˆ, è‡ªå®šä¹‰ BUILD æ–¹æ³•åº”å§‹ç»ˆæ˜¯å­æ–¹æ³•, å¦åˆ™å®ƒä»¬ä¼šç ´åå­ç±»ä¸­çš„å±æ€§åˆå§‹åŒ–ã€‚å…¶æ¬¡, BUILD å­æ–¹æ³•å¯ç”¨äºåœ¨å¯¹è±¡æ„é€ æ—¶è¿è¡Œè‡ªå®šä¹‰ä»£ç ã€‚å®ƒä»¬è¿˜å¯ç”¨äºä¸ºå±æ€§åˆå§‹åŒ–åˆ›å»ºåˆ«åï¼š\nclass EncodedBuffer { has $.enc; has $.data; submethod BUILD(:encoding(:$enc), :$data) { $!enc := $enc; $!data := $data; } } my $b1 = EncodedBuffer.new( encoding =\u0026gt; \u0026#39;UTF-8\u0026#39;, data =\u0026gt; [64, 65] ); my $b2 = EncodedBuffer.new( enc =\u0026gt; \u0026#39;UTF-8\u0026#39;, data =\u0026gt; [64, 65] ); # both enc and encoding are allowed now  å› ä¸ºä¼ é€’å®å‚ç»™å­ä¾‹ç¨‹æŠŠå®å‚ç»‘å®šç»™äº†å½¢å‚, å¦‚æœæŠŠå±æ€§ç”¨ä½œå½¢å‚, åˆ™ä¸éœ€è¦å•ç‹¬çš„ç»‘å®šæ­¥éª¤ã€‚ æ‰€ä»¥ä¸Šé¢çš„ä¾‹å­å¯ä»¥å†™ä¸º:\nsubmethod BUILD(:encoding(:$!enc), :$!data) { # nothing to do here anymore, the signature binding # does all the work for us. } ä½†æ˜¯, å½“å±æ€§å¯èƒ½å…·æœ‰ç‰¹æ®Šç±»å‹è¦æ±‚ï¼ˆä¾‹å¦‚ :$!id å¿…é¡»ä¸ºæ­£æ•´æ•°ï¼‰æ—¶, è¯·è°¨æ…ä½¿ç”¨æ­¤å±æ€§çš„è‡ªåŠ¨ç»‘å®šã€‚è¯·è®°ä½, é™¤éæ‚¨ä¸“é—¨å¤„ç†æ­¤å±æ€§, å¦åˆ™å°†åˆ†é…é»˜è®¤å€¼, å¹¶ä¸”è¯¥é»˜è®¤å€¼å°†ä¸º Any, è¿™ä¼šå¯¼è‡´ç±»å‹é”™è¯¯ã€‚\nç¬¬ä¸‰ä¸ªå«ä¹‰æ˜¯, å¦‚æœä½ æƒ³è¦ä¸€ä¸ªæ¥å—ä½ç½®å‚æ•°çš„æ„é€ å‡½æ•°, ä½ å¿…é¡»ç¼–å†™è‡ªå·±çš„ new æ–¹æ³•ï¼š\nclass Point { has $.x; has $.y; method new($x, $y) { self.bless(:$x, :$y); } } ç„¶è€Œ, è¿™ä¸æ˜¯æœ€ä½³å®è·µ, å› ä¸ºå®ƒä½¿å¾—ä»å­ç±»æ­£ç¡®åœ°åˆå§‹åŒ–å¯¹è±¡å˜å¾—æ›´éš¾äº†ã€‚\nå¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯, åå­— new åœ¨ Raku ä¸­å¹¶ä¸ç‰¹åˆ«ã€‚å®ƒåªæ˜¯ä¸€ä¸ªå¸¸è§çš„çº¦å®š, åœ¨å¤§å¤šæ•°Rakuç±»ä¸­éƒ½éå¸¸å½»åº•ã€‚ä½ å¯ä»¥ä»åœ¨è°ƒç”¨çš„ä»»ä½•æ–¹æ³•è°ƒç”¨ bless, æˆ–è€…ä½¿ç”¨ CREATE æ¥æ‘†å¼„ä½çº§åˆ«çš„å·¥ä½œã€‚\nTWEAK å­æ–¹æ³•å…è®¸ä½ åœ¨å¯¹è±¡æ„é€ åæ£€æŸ¥æˆ–ä¿®æ”¹å±æ€§ï¼š\nclass RectangleWithCachedArea { has ($.x1, $.x2, $.y1, $.y2); has $.area; submethod TWEAK() { $!area = abs( ($!x2 - $!x1) * ( $!y2 - $!y1) ); } } say RectangleWithCachedArea.new( x2 =\u0026gt; 5, x1 =\u0026gt; 1, y2 =\u0026gt; 1, y1 =\u0026gt; 0).area; # OUTPUT: Â«4â¤Â»  å¯¹è±¡å…‹éš† å…‹éš†æ˜¯ä½¿ç”¨æ‰€æœ‰å¯¹è±¡ä¸Šå¯ç”¨çš„cloneæ–¹æ³•å®Œæˆçš„, è¿™äº›å…‹éš†æ–¹æ³•å¯ä»¥æµ…å…‹éš†å…¬å…±å’Œç§æœ‰å±æ€§ã€‚å…¬å…±å±æ€§çš„æ–°å€¼å¯ä»¥ä½œä¸ºå‘½åå‚æ•°æä¾›ã€‚\nclass Foo { has $.foo = 42; has $.bar = 100; } my $o1 = Foo.new; my $o2 = $o1.clone: :bar(5000); say $o1; # Foo.new(foo =\u0026gt; 42, bar =\u0026gt; 100)  say $o2; # Foo.new(foo =\u0026gt; 42, bar =\u0026gt; 5000)  æœ‰å…³å¦‚ä½•å…‹éš†éæ ‡é‡å±æ€§çš„è¯¦ç»†ä¿¡æ¯, è¯·å‚é˜…æ–‡æ¡£ä»¥è·å–å…‹éš†, ä»¥åŠå®ç°è‡ªå·±çš„è‡ªå®šä¹‰å…‹éš†æ–¹æ³•çš„ç¤ºä¾‹ã€‚\nè§’è‰² è§’è‰²æ˜¯å±æ€§å’Œæ–¹æ³•çš„é›†åˆ; ä½†æ˜¯, ä¸ç±»ä¸åŒ, è§’è‰²ä»…ç”¨äºæè¿°å¯¹è±¡è¡Œä¸ºçš„ä¸€éƒ¨åˆ†; è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸€èˆ¬æ¥è¯´, è§’è‰²åº”è¯¥åœ¨ç±»å’Œå¯¹è±¡ä¸­æ··åˆä½¿ç”¨ã€‚é€šå¸¸, ç±»ç”¨äºç®¡ç†å¯¹è±¡, è€Œè§’è‰²ç”¨äºç®¡ç†å¯¹è±¡å†…çš„è¡Œä¸ºå’Œä»£ç é‡ç”¨ã€‚\nè§’è‰²ä½¿ç”¨å…³é”®å­— role æ”¾åœ¨æ‰€å£°æ˜çš„è§’è‰²åç§°å‰é¢ã€‚è§’è‰²ä½¿ç”¨ does å…³é”®å­— mixed in, does å…³é”®å­—æ”¾åœ¨è§’è‰²åä¹‹å‰ã€‚\nconstant â²§ = \u0026#34;\u0026#34; xx 4; # Just a â²§ab  role Notable { has Str $.notes is rw; multi method notes() { \u0026#34;$!notes\\n\u0026#34; }; multi method notes( Str $note ) { $!notes ~= \u0026#34;$note\\n\u0026#34; ~ â²§ }; } class Journey does Notable { has $.origin; has $.destination; has @.travelers; method Str { \u0026#34;â¤· $!origin\\n\u0026#34; ~ â²§ ~ self.notes() ~ \u0026#34;$!destinationâ¤¶\\n\u0026#34; }; } my $trip = Journey.new( :origin\u0026lt;Here\u0026gt;, :destination\u0026lt;There\u0026gt;, travelers =\u0026gt; \u0026lt;Ã¾or Freya\u0026gt; ); $trip.notes(\u0026#34;First steps\u0026#34;); notes $trip: \u0026#34;Almost there\u0026#34;; print $trip; # OUTPUT:  #â¤· Here  # First steps  # Almost there  #  #There â¤¶  ä¸€æ—¦ç¼–è¯‘å™¨è§£æè§’è‰²å£°æ˜çš„ç»“æŸå¤§æ‹¬å·, è§’è‰²å°±æ˜¯ä¸å¯å˜çš„ã€‚\nrole Serializable { method serialize() { self.perl; # å¾ˆç²—è¶…çš„åºåˆ—åŒ– } method deserialization-code($buf) { EVAL $buf; # åè½¬ .perl æ“ä½œ } } class Point does Serializable { has $.x; has $.y; } my $p = Point.new(:x(1), :y(2)); my $serialized = $p.serialize; # ç”± role æä¾›çš„æ–¹æ³• my $clone-of-p = Point.deserialization-code($serialized); say $clone-of-p.x; # 1 ç¼–è¯‘å™¨ä¸€è§£æåˆ° role å£°æ˜çš„é—­åˆèŠ±æ‹¬å·, roles å°±ä¸å¯å˜äº†ã€‚\nåº”ç”¨è§’è‰² è§’è‰²åº”ç”¨ç¨‹åºä¸ç±»ç»§æ‰¿æœ‰å¾ˆå¤§ä¸åŒã€‚å°†è§’è‰²åº”ç”¨äºç±»æ—¶, è¯¥è§’è‰²çš„æ–¹æ³•å°†å¤åˆ¶åˆ°ç±»ä¸­ã€‚å¦‚æœå°†å¤šä¸ªè§’è‰²åº”ç”¨äºåŒä¸€ä¸ªç±», åˆ™å†²çªï¼ˆä¾‹å¦‚, åŒåçš„å±æ€§æˆ– non-multi æ–¹æ³•ï¼‰ä¼šå¯¼è‡´ç¼–è¯‘æ—¶é”™è¯¯, è¿™å¯ä»¥é€šè¿‡åœ¨ç±»ä¸­æä¾›åŒåçš„æ–¹æ³•æ¥è§£å†³ã€‚\nè¿™æ¯”å¤šé‡ç»§æ‰¿å®‰å…¨å¾—å¤š, å…¶ä¸­ç¼–è¯‘å™¨ä»ä¸æ£€æµ‹å†²çª, è€Œæ˜¯è§£æä¸ºæ–¹æ³•è§£æé¡ºåºä¸­è¾ƒæ—©å‡ºç°çš„è¶…ç±», è¿™å¯èƒ½ä¸æ˜¯ç¨‹åºå‘˜æƒ³è¦çš„ã€‚\nä¾‹å¦‚, å¦‚æœä½ å·²ç»å‘ç°äº†ä¸€ç§æœ‰æ•ˆçš„æ–¹æ³•æ¥éª‘ç‰›, å¹¶è¯•å›¾æŠŠå®ƒä½œä¸ºä¸€ç§æ–°çš„æµè¡Œäº¤é€šå½¢å¼æ¨é”€, ä½ å¯èƒ½ä¼šæœ‰ä¸€ä¸ª Bull ç±», å¯¹äºä½ åœ¨æˆ¿å­å‘¨å›´çš„æ‰€æœ‰å…¬ç‰›, ä»¥åŠä¸€ä¸ª Automobile ç±», ä½ å¯ä»¥é©¾é©¶çš„ä¸œè¥¿ã€‚\nclass Bull { has Bool $.castrated = False; method steer { # Turn your bull into a steer  $!castrated = True; return self; } } class Automobile { has $.direction; method steer($!direction) { } } class Taurus is Bull is Automobile { } my $t = Taurus.new; say $t.steer; # OUTPUT: Â«Taurus.new(castrated =\u0026gt; Bool::True, direction =\u0026gt; Any)â¤Â»  é€šè¿‡è¿™ç§è®¾ç½®, æ‚¨çš„è´«å›°å®¢æˆ·å°†å‘ç°è‡ªå·±æ— æ³•è½¬åŠ¨ä»–ä»¬çš„é‡‘ç‰›åº§, æ‚¨å°†æ— æ³•ç”Ÿäº§æ›´å¤šçš„äº§å“ï¼åœ¨è¿™ç§æƒ…å†µä¸‹, ä½¿ç”¨è§’è‰²å¯èƒ½æ›´å¥½ï¼š\nrole Bull-Like { has Bool $.castrated = False; method steer { # Turn your bull into a steer  $!castrated = True; return self; } } role Steerable { has Real $.direction; method steer(Real $d = 0) { $!direction += $d; } } class Taurus does Bull-Like does Steerable { } è¿™æ®µä»£ç ä¼šæ­»äºï¼š\n===SORRY!=== Method 'steer' must be resolved by class Taurus because it exists in multiple roles (Steerable, Bull-Like) è¿™é¡¹æ£€æŸ¥å¯ä»¥ä¸ºä½ çœå»å¾ˆå¤šéº»çƒ¦ï¼š\nclass Taurus does Bull-Like does Steerable { method steer($direction?) { self.Steerable::steer($direction) } } å°†è§’è‰²åº”ç”¨äºç¬¬äºŒä¸ªè§’è‰²æ—¶, å®é™…åº”ç”¨ç¨‹åºå°†å»¶è¿Ÿ, ç›´åˆ°ç¬¬äºŒä¸ªè§’è‰²åº”ç”¨äºç±», æ­¤æ—¶ä¸¤ä¸ªè§’è‰²éƒ½å°†åº”ç”¨äºè¯¥ç±»ã€‚ä»è€Œ\nrole R1 { # methods here  } role R2 does R1 { # methods here  } class C does R2 { } äº§ç”Ÿç›¸åŒç±» C ä¸º\nrole R1 { # methods here  } role R2 { # methods here  } class C does R1 does R2 { } Stubs å½“è§’è‰²åŒ…å« stubbed æ–¹æ³•æ—¶, å¿…é¡»åœ¨å°†è§’è‰²åº”ç”¨äºç±»æ—¶æä¾›åŒåæ–¹æ³•çš„ non-stubbed ç‰ˆæœ¬ã€‚è¿™å…è®¸æ‚¨åˆ›å»ºå……å½“æŠ½è±¡æ¥å£çš„è§’è‰²ã€‚\nrole AbstractSerializable { method serialize() { ... } # literal ... here marks the  # method as a stub  } # the following is a compile time error, for example  # Method \u0026#39;serialize\u0026#39; must be implemented by Point because  # it\u0026#39;s required by a role  class APoint does AbstractSerializable { has $.x; has $.y; } # this works:  class SPoint does AbstractSerializable { has $.x; has $.y; method serialize() { \u0026#34;p($.x, $.y)\u0026#34; } } stubbed æ–¹æ³•çš„å®ç°ä¹Ÿå¯ä»¥ç”±å¦ä¸€ä¸ªè§’è‰²æä¾›ã€‚\nç»§æ‰¿ è§’è‰²ä¸èƒ½ä»ç±»ç»§æ‰¿, ä½†å®ƒä»¬å¯ä»¥æºå¸¦ç±», å¯¼è‡´ä»»ä½•å…·æœ‰è¯¥è§’è‰²çš„ç±»ä»æ‰¿è½½çš„ç±»ç»§æ‰¿ã€‚æ‰€ä»¥, å¦‚æœä½ å†™ï¼š\nrole A is Exception { } class X::Ouch does A { } X::Ouch.^parents.say # OUTPUT: Â«((Exception))â¤Â» ç„¶å X::Ouch å°†ç›´æ¥ä» Exception ç»§æ‰¿, æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ—å‡ºå…¶çˆ¶é¡¹æ¥çœ‹åˆ°ã€‚\nç”±äºå®ƒä»¬ä¸ä½¿ç”¨å¯èƒ½ç§°ä¸ºç»§æ‰¿çš„ä¸œè¥¿, å› æ­¤è§’è‰²ä¸æ˜¯ç±»å±‚æ¬¡ç»“æ„çš„ä¸€éƒ¨åˆ†ã€‚ä½¿ç”¨ .^roles å…ƒæ–¹æ³•åˆ—å‡ºè§’è‰², å®ƒä½¿ç”¨ transitive æ ‡è®°æ¥åŒ…å«æ‰€æœ‰çº§åˆ«æˆ–ä»…åŒ…å«ç¬¬ä¸€ä¸ªçº§åˆ«ã€‚å°½ç®¡å¦‚æ­¤, ä»ç„¶å¯ä»¥ä½¿ç”¨æ™ºèƒ½åŒ¹é…æˆ–ç±»å‹çº¦æŸæ¥æµ‹è¯•ç±»æˆ–å®ä¾‹, ä»¥æŸ¥çœ‹å®ƒæ˜¯å¦èµ·ä½œç”¨ã€‚\nrole F { } class G does F { } G.^roles.say; # OUTPUT: Â«((F))â¤Â»  role Ur {} role Ar does Ur {} class Whim does Ar {}; Whim.^roles(:!transitive).say; # OUTPUT: Â«((Ar))â¤Â»  say G ~~ F; # OUTPUT: Â«Trueâ¤Â»  multi a (F $a) { \u0026#34;F\u0026#34;.say } multi a ($a) { \u0026#34;not F\u0026#34;.say } a(G); # OUTPUT: Â«Fâ¤Â»  ä¸»ä»ç§©åº role M { method f { say \u0026#34;I am in role M\u0026#34; } } class A { method f { say \u0026#34;I am in class A\u0026#34; } } class B is A does M { method f { say \u0026#34;I am in class B\u0026#34; } } class C is A does M { } B.new.f; # OUTPUT Â«I am in class Bâ¤Â»  C.new.f; # OUTPUT Â«I am in role Mâ¤Â»  è¯·æ³¨æ„, multi-method çš„æ¯ä¸ªå€™é€‰é¡¹éƒ½æ˜¯å®ƒè‡ªå·±çš„æ–¹æ³•ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹, ä»¥ä¸Šä»…é€‚ç”¨äºä¸¤ä¸ªè¿™æ ·çš„å€™é€‰é¡¹å…·æœ‰ç›¸åŒç­¾åçš„æƒ…å†µã€‚å¦åˆ™, æ²¡æœ‰å†²çª, å€™é€‰è€…åªæ˜¯æ·»åŠ åˆ° multi-method ä¸­ã€‚\nè‡ªåŠ¨è§’è‰²åŒå…³ ä»»ä½•ç›´æ¥å®ä¾‹åŒ–è§’è‰²æˆ–å°†å…¶ç”¨ä½œç±»å‹å¯¹è±¡çš„å°è¯•éƒ½å°†è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªä¸è§’è‰²åŒåçš„ç±», ä»è€Œå¯ä»¥é€æ˜åœ°ä½¿ç”¨è§’è‰², å°±å¥½åƒå®ƒæ˜¯ä¸€ä¸ªç±»ä¸€æ ·ã€‚\nrole Point { has $.x; has $.y; method abs { sqrt($.x * $.x + $.y * $.y) } method dimensions { 2 } } say Point.new(x =\u0026gt; 6, y =\u0026gt; 8).abs; # OUTPUT Â«10â¤Â»  say Point.dimensions; # OUTPUT Â«2â¤Â»  æˆ‘ä»¬æŠŠè¿™ç§è‡ªåŠ¨åˆ›å»ºçš„ç±»å«åŒå…³, å¹¶ä¸”å°†ç”Ÿæˆçš„ç±»å«åŒå…³è¯­ã€‚\nä½†æ˜¯, Punning ä¸æ˜¯ç”±å¤§å¤šæ•°å…ƒç¼–ç¨‹æ„é€ å¼•èµ·çš„, å› ä¸ºå®ƒä»¬æœ‰æ—¶ç”¨äºç›´æ¥ä½¿ç”¨è§’è‰²ã€‚\nå‚æ•°åŒ–è§’è‰² è§’è‰²å¯ä»¥é€šè¿‡åœ¨æ–¹æ‹¬å·ä¸­ç»™å®ƒä»¬ç­¾åæ¥å‚æ•°åŒ–ï¼š\nrole BinaryTree[::Type] { has BinaryTree[Type] $.left; has BinaryTree[Type] $.right; has Type $.node; method visit-preorder(\u0026amp;cb) { cb $.node; for $.left, $.right -\u0026gt; $branch { $branch.visit-preorder(\u0026amp;cb) if defined $branch; } } method visit-postorder(\u0026amp;cb) { for $.left, $.right -\u0026gt; $branch { $branch.visit-postorder(\u0026amp;cb) if defined $branch; } cb $.node; } method new-from-list(::?CLASS:U: *@el) { my $middle-index = @el.elems div 2; my @left = @el[0 .. $middle-index - 1]; my $middle = @el[$middle-index]; my @right = @el[$middle-index + 1 .. *]; self.new( node =\u0026gt; $middle, left =\u0026gt; @left ?? self.new-from-list(@left) !! self, right =\u0026gt; @right ?? self.new-from-list(@right) !! self, ); } } my $t = BinaryTree[Int].new-from-list(4, 5, 6); $t.visit-preorder(\u0026amp;say); # OUTPUT: Â«5â¤4â¤6â¤Â»  $t.visit-postorder(\u0026amp;say); # OUTPUT: Â«4â¤6â¤5â¤Â»  è¿™é‡Œ, ç­¾ååªåŒ…å«ç±»å‹æ•è·, ä½†ä»»ä½•ç­¾åéƒ½å¯ä»¥ï¼š\nenum Severity \u0026lt;debug info warn error critical\u0026gt;; role Logging[$filehandle = $*ERR] { method log(Severity $sev, $message) { $filehandle.print(\u0026#34;[{uc $sev}] $message\\n\u0026#34;); } } Logging[$*OUT].log(debug, \u0026#39;here we go\u0026#39;); # OUTPUT: Â«[DEBUG] here we goâ¤Â»  æ‚¨å¯ä»¥æ‹¥æœ‰å¤šä¸ªåŒåè§’è‰², ä½†ç­¾åä¸åŒ; å¤šé‡åˆ†æ´¾çš„æ­£å¸¸è§„åˆ™é€‚ç”¨äºé€‰æ‹©å¤šä¸ªå€™é€‰è€…ã€‚\næ··åˆè§’è‰² è§’è‰²å¯ä»¥æ··åˆåˆ°å¯¹è±¡ä¸­ã€‚è§’è‰²çš„ç»™å®šå±æ€§å’Œæ–¹æ³•å°†æ·»åŠ åˆ°å¯¹è±¡å·²æœ‰çš„æ–¹æ³•å’Œå±æ€§ä¸­ã€‚æ”¯æŒå¤šä¸ªmixinå’ŒåŒ¿åè§’è‰²ã€‚\nrole R { method Str() {\u0026#39;hidden!\u0026#39;} }; my $i = 2 but R; sub f(\\bound){ put bound }; f($i); # OUTPUT: Â«hidden!â¤Â»  my @positional := \u0026lt;a b\u0026gt; but R; say @positional.^name; # OUTPUT: Â«List+{R}â¤Â»  è¯·æ³¨æ„, å¯¹è±¡æ··åˆäº†è§’è‰², è€Œä¸æ˜¯å¯¹è±¡çš„ç±»æˆ–å®¹å™¨ã€‚å› æ­¤, @-sigiled å®¹å™¨å°†éœ€è¦ç»‘å®šä»¥ä½¿è§’è‰²åšæŒ, å¦‚ç¤ºä¾‹ä¸­çš„ @positional æ‰€ç¤ºã€‚æŸäº›è¿ç®—ç¬¦å°†è¿”å›ä¸€ä¸ªæ–°å€¼, ä»è€Œæœ‰æ•ˆåœ°ä»ç»“æœä¸­åˆ é™¤ mixinã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½¿ç”¨ does åœ¨å˜é‡å£°æ˜ä¸­æ··åˆè§’è‰²å¯èƒ½æ›´ä¸ºæ¸…æ™°ï¼š\nrole R {}; my @positional does R = \u0026lt;a b\u0026gt;; say @positional.^name; # OUTPUT: Â«Array+{R}â¤Â»  è¿ç®—ç¬¦ infix:\u0026lt;but\u0026gt; æ¯”åˆ—è¡¨æ„é€ å‡½æ•°çª„ã€‚æä¾›è¦æ··åˆçš„è§’è‰²åˆ—è¡¨æ—¶, è¯·å§‹ç»ˆä½¿ç”¨æ‹¬å·ã€‚\nrole R1 { method m {} } role R2 { method n {} } my $a = 1 but R1,R2; # R2 is in sink context, issues a WARNING  say $a.^name; # OUTPUT: Â«Int+{R1}â¤Â»  my $all-roles = 1 but (R1,R2); say $all-roles.^name; # OUTPUT: Â«Int+{R1,R2}â¤Â»  Mixins å¯ç”¨äºå¯¹è±¡ç”Ÿå‘½ä¸­çš„ä»»ä½•ä¸€ç‚¹ã€‚\n# A counter for Table of Contents  role TOC-Counter { has Int @!counters is default(0); method Str() { @!counters.join: \u0026#39;.\u0026#39; } method inc($level) { @!counters[$level - 1]++; @!counters.splice($level); self } } my Num $toc-counter = NaN; # don\u0026#39;t do math with Not A Number  say $toc-counter; # OUTPUT: Â«NaNâ¤Â»  $toc-counter does TOC-Counter; # now we mix the role in  $toc-counter.inc(1).inc(2).inc(2).inc(1).inc(2).inc(2).inc(3).inc(3); put $toc-counter / 1; # OUTPUT: Â«NaNâ¤Â» (because that\u0026#39;s numerical context)  put $toc-counter; # OUTPUT: Â«2.2.2â¤Â» (put will call TOC-Counter::Str)  è§’è‰²å¯ä»¥æ˜¯åŒ¿åçš„ã€‚\nmy %seen of Int is default(0 but role :: { method Str() {\u0026#39;NULL\u0026#39;} }); say %seen\u0026lt;not-there\u0026gt;; # OUTPUT: Â«NULLâ¤Â»  say %seen\u0026lt;not-there\u0026gt;.defined; # OUTPUT: Â«Trueâ¤Â» (0 may be False but is well defined)  say Int.new(%seen\u0026lt;not-there\u0026gt;); # OUTPUT: Â«0â¤Â»  å…ƒå¯¹è±¡ç¼–ç¨‹å’Œè‡ªçœ Raku æœ‰ä¸€ä¸ªå…ƒå¯¹è±¡ç³»ç»Ÿ, è¿™æ„å‘³ç€å¯¹è±¡ã€ç±»ã€è§’è‰²ã€Grammarsã€enums ç­‰è¡Œä¸ºæœ¬èº«ç”±å…¶å®ƒå¯¹è±¡æ§åˆ¶; è¿™äº›å¯¹è±¡å«åšå…ƒå¯¹è±¡(æƒ³æƒ³å…ƒæ“ä½œç¬¦, å®ƒæ“ä½œçš„å¯¹è±¡æ˜¯æ™®é€šæ“ä½œç¬¦). åƒæ™®é€šå¯¹è±¡ä¸€æ ·, å…ƒå¯¹è±¡æ˜¯ç±»çš„å®ä¾‹, è¿™æ—¶æˆ‘ä»¬ç§°å®ƒä»¬ä¸ºå…ƒç±»ã€‚\nå¯¹æ¯ä¸ªå¯¹è±¡æˆ–ç±», ä½ èƒ½é€šè¿‡è°ƒç”¨ .HOW æ–¹æ³•è·å–å…ƒå¯¹è±¡. æ³¨æ„, å°½ç®¡è¿™çœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªæ–¹æ³•è°ƒç”¨, ä½†å®ƒæ›´åƒå®ã€‚\næ‰€ä»¥, ä½ èƒ½ç”¨å…ƒå¯¹è±¡å¹²äº›ä»€ä¹ˆå‘¢? ä½ å¯ä»¥é€šè¿‡æ¯”è¾ƒå…ƒç±»çš„ç›¸ç­‰æ€§æ¥æ£€æŸ¥ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦å…·æœ‰åŒæ ·çš„å…ƒç±»:\nsay 1.HOW === 2.HOW; # True say 1.HOW === Int.HOW; # True say 1.HOW === Num.HOW; # False Raku ä½¿ç”¨å•è¯ HOW, Higher Order Workings, æ¥å¼•ç”¨å…ƒå¯¹è±¡ç³»ç»Ÿã€‚å› æ­¤, åœ¨ Rakudo ä¸­ä¸å¿…å¯¹æ­¤åƒæƒŠ, æ§åˆ¶ç±»è¡Œä¸ºçš„å…ƒç±»çš„ç±»åå«åš Raku::Metamodel::ClassHowã€‚æ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ª Raku::Metamodel::ClassHOWçš„å®ä¾‹ã€‚\nä½†æ˜¯,ç†æ‰€å½“ç„¶çš„, å…ƒæ¨¡å‹ä¸ºä½ åšäº†å¾ˆå¤šã€‚ä¾‹å¦‚å®ƒå…è®¸ä½ å†…çœå¯¹è±¡å’Œç±»ã€‚å…ƒå¯¹è±¡æ–¹æ³•è°ƒç”¨çš„çº¦å®šæ˜¯, åœ¨å…ƒå¯¹è±¡ä¸Šè°ƒç”¨æ–¹æ³•, å¹¶ä¸”ä¼ é€’æ„Ÿå…´è¶£çš„å¯¹è±¡ä½œä¸ºå¯¹è±¡çš„ç¬¬ä¸€å‚æ•°ã€‚æ‰€ä»¥, è¦è·å–å¯¹è±¡çš„ç±»å, ä½ å¯ä»¥è¿™æ ·å†™:\nmy $object = 1; my $metaobject = 1.HOW; say $metaobject.name($object); # Int # or shorter: say 1.HOW.name(1); # Int ä¸ºäº†é¿å…ä½¿ç”¨åŒä¸€ä¸ªå¯¹è±¡ä¸¤æ¬¡, æœ‰ä¸€ä¸ªä¾¿æ·å†™æ³•:\nsay 1.^name; # Int # same as say 1.HOW.name(1); # Int å†…çœ å†…çœå°±æ˜¯åœ¨è¿è¡Œæ—¶è·å–å¯¹è±¡æˆ–ç±»çš„ä¿¡æ¯çš„è¿‡ç¨‹ã€‚åœ¨ Raku ä¸­, æ‰€æœ‰çš„å†…çœéƒ½ä¼šæœæŸ¥åŸå¯¹è±¡ã€‚æ ‡å‡†çš„åŸºäºç±»å¯¹è±¡çš„ ClassHow æä¾›äº†è¿™äº›å·¥å…·:\ncan ç»™å®šä¸€ä¸ªæ–¹æ³•å, can è¿”å›å¯ç”¨çš„æ–¹æ³•å\nclass A { method x($a) {} }; class B is A { method x() {} }; say B.^can(\u0026#39;x\u0026#39;).elems; # 2 for B.^can(\u0026#39;x\u0026#39;) { say .arity; # 1, 2 } åœ¨è¿™ä¸ªä¾‹å­ä¸­, ç±» B ä¸­æœ‰ä¸¤ä¸ªåä¸º x çš„æ–¹æ³•å¯èƒ½å¯ç”¨(å°½ç®¡ä¸€ä¸ªæ­£å¸¸çš„æ–¹æ³•è°ƒç”¨ä»…ä»…ä¼šç›´æ¥è°ƒç”¨å®‰ç½®åœ¨ B ä¸­é‚£ä¸ªæ–¹æ³•). B ä¸­çš„é‚£ä¸ªæ–¹æ³•æœ‰ä¸€ä¸ªå‚æ•°(ä¾‹å¦‚, å®ƒæœŸæœ›ä¸€ä¸ªå‚æ•°, ä¸€ä¸ªè°ƒç”¨è€…(self)), è€Œ A ä¸­çš„ x æ–¹æ³•æœŸæœ› 2 ä¸ªå‚æ•°( self å’Œ $a).\nmethods è¿”å›ç±»ä¸­å¯ç”¨å…¬å…±æ–¹æ³•çš„åˆ—è¡¨( è¿™åŒ…æ‹¬çˆ¶ç±»å’Œ roles ä¸­çš„æ–¹æ³•). é»˜è®¤å®ƒä¼šåœåœ¨ç±» Cool, Any æˆ– Mu é‚£å„¿; è‹¥çœŸè¦è·å–æ‰€æœ‰çš„æ–¹æ³•, ä½¿ç”¨å‰¯è¯ :all.\nclass A { method x() { }; } say A.^methods(); # x say A.^methods(:all); # x infinite defined ... mro æŒ‰æ–¹æ³•è§£æé¡ºåºè¿”å›ç±»è‡ªèº«çš„åˆ—è¡¨å’Œå®ƒä»¬çš„çˆ¶ç±». å½“æ–¹æ³•è¢«è°ƒç”¨æ—¶, ç±»å’Œå®ƒçš„çˆ¶ç±»æŒ‰é‚£ä¸ªé¡ºåºè¢«è®¿é—®.(ä»…ä»…æ˜¯æ¦‚å¿µä¸Š; å®é™…ä¸Šæ–¹æ³•åˆ—è¡¨åœ¨ç±»æ„å»ºæ˜¯å°±åˆ›å»ºäº†).\nsay 1.^mro; # (Int) (Cool) (Any) (Mu) name è¿”å›ç±»çš„åå­—:\nsay \u0026#39;a string\u0026#39;.^name; # Str parents è¿”å›ä¸€ä¸ªçˆ¶ç±»çš„åˆ—è¡¨. é»˜è®¤å®ƒä¼šåœåœ¨ Cool, Any æˆ–è€… Mu é‚£å„¿, ä½†ä½ å¯ä»¥æä¾›ä¸€ä¸ªå‰¯è¯ :allæ¥å‹åˆ¶å®ƒ. ä½¿ç”¨å‰¯è¯ :tree ä¼šè¿”å›ä¸€ä¸ªåµŒå¥—åˆ—è¡¨.\nclass D { }; class C1 is D { }; class C2 is D { }; class B is C1 is C2 { }; class A is B { }; say A.^parents(:all).perl; # (B, C1, C2, D, Any, Mu) say A.^parents(:all, :tree).perl; # ([B, [C1, [D, [Any, [Mu]]]], [C2, [D, [Any, [Mu]]]]],) https://docs.raku.org/language/objects\n","permalink":"https://ohmyweekly.github.io/notes/2015-06-15-object-orientation-in-raku/","tags":["object"],"title":"Raku ä¸­çš„é¢å‘å¯¹è±¡"},{"categories":["rakulang"],"contents":"Raku ä¸­çš„å¤§éƒ¨åˆ†å¥æ³•ç»“æ„èƒ½å½’ç±»ä¸ºé¡¹å’Œæ“ä½œç¬¦. è¿™å„¿ä½ èƒ½æ‰¾åˆ°å„ç§ä¸åŒç±»å‹çš„é¡¹çš„æ¦‚è§ˆ.\nLiterals Int 42 12_300_00 :16\u0026lt;DEAD_BEEF\u0026gt; #åå…­è¿›åˆ¶ Int å­—é¢é‡ç”±æ•°å­—ç»„æˆ, å¹¶ä¸”èƒ½åœ¨æ•°å­—ä¹‹é—´åŒ…å«ä¸‹åˆ’çº¿. ä½¿ç”¨ :radix\u0026lt;number\u0026gt; å†’å·å¯¹å„¿å½¢å¼èƒ½æŒ‡å®š 10 è¿›åˆ¶å¤–çš„å…¶å®ƒè¿›åˆ¶.\nRat æœ‰ç†æ•° 12.34 1_200.345_678 Rat(æœ‰ç†æ•°)å­—é¢é‡ç”±ä¸€ä¸ªç‚¹å·åˆ†å‰²çš„ä¸¤éƒ¨åˆ†æ•´æ•°ç»„æˆ. æ³¨æ„å°¾éƒ¨çš„ç‚¹å·æ˜¯ä¸å…è®¸çš„, æ‰€ä»¥ä½ å¿…é¡»å†™æˆ 1.0 è€Œé 1. ( è¿™ä¸ªè§„åˆ™å¾ˆé‡è¦, å› ä¸ºæœ‰ä¸€ä¸ªä»¥ç‚¹å·å¼€å¤´çš„ä¸­ç¼€æ“ä½œç¬¦, ä¾‹å¦‚ .. èŒƒå›´æ“ä½œç¬¦ ).\nNum æµ®ç‚¹æ•° 12.3e-32 3e8 Num(æµ®ç‚¹æ•°)å­—é¢é‡ç”± Rat æˆ– Int å­—é¢é‡åé¢å†è·Ÿç€ä¸€ä¸ªå­—æ¯ e å’Œ ä¸€ä¸ªæŒ‡æ•°(å¯èƒ½ä¸ºè´Ÿ)ç»„æˆ. 3e8 ä½¿ç”¨ å€¼ 3* 10**8 æ„å»ºäº†ä¸€ä¸ª Num.\nStr \u0026#39;a string\u0026#39;\u0026#39;I\\\u0026#39;m escaped!\u0026#39; \u0026#34;I don\u0026#39;t need to be\u0026#34; \u0026#34;\\\u0026#34;But I still can be,\\\u0026#34; he said.\u0026#34; q|Other delimiters can be used too! å­—ç¬¦ä¸²å­—é¢é‡å¸¸å¸¸ä½¿ç”¨ ' æˆ– \u0026quot; åˆ›å»º, ç„¶å„¿, å­—ç¬¦ä¸²åœ¨ Raku ä¸­å…¶å®æ˜¯ä¸€ç§å¼ºå¤§çš„å­è¯­è¨€.\nRegex /match some text / rx/slurp \\srest (.*)$/ è¿™ä¸¤ç§ä¼šäº§ç”Ÿå­—é¢æ­£åˆ™ã€‚\nPair a =\u0026gt; 1 \u0026#39;a\u0026#39; =\u0026gt; \u0026#39;b\u0026#39; :identifier :!identifier :identifier\u0026lt;value\u0026gt; :identifier\u0026lt;value1 value2\u0026gt; :identifier($value) :identifier[\u0026#39;val1\u0026#39;, \u0026#39;val2\u0026#39;] :identifier{key1 =\u0026gt; \u0026#39;val1\u0026#39;, key2 =\u0026gt; \u0026#39;value2\u0026#39;} :$item :@array :%hash :\u0026amp;callable Pair å¯¹è±¡çš„åˆ›å»ºè¦ä¹ˆä½¿ç”¨ infix:Â«=\u0026gt;Â» (å®ƒä¼šè‡ªåŠ¨æ‹¬èµ·å·¦è¾¹, å¦‚æœå·¦è¾¹æ˜¯æ ‡è¯†ç¬¦çš„è¯), è¦ä¹ˆä½¿ç”¨å„ç§å†’å·å¯¹å„¿å½¢å¼. é‚£äº›æ€»æ˜¯ä»¥ä¸€ä¸ªå†’å·å¼€å¤´çš„åˆ›å»ºå½¢å¼, å†’å·åé¢è¦ä¹ˆè·Ÿç€ä¸€ä¸ªæ ‡è¯†ç¬¦, è¦ä¹ˆè·Ÿç€ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å˜é‡(ä¸å¸¦ç¬¦å·çš„å˜é‡åä½œä¸º pair çš„é”®, å˜é‡çš„å€¼ä½œä¸º pair çš„é”®å€¼).\nåœ¨æ ‡è¯†ç¬¦å½¢å¼çš„å†’å·å¯¹å„¿ä¸­, å¯é€‰çš„å€¼å¯ä»¥æ˜¯ä»»æ„ç¯ç¼€. å¦‚æœæ²¡æœ‰ç¯ç¼€, é‚£å®ƒçš„å€¼å°±æ˜¯ Bool::True. !:identifier å½¢å¼çš„å€¼æ˜¯ Bool::False.\nå¦‚æœå†’å·å¯¹å„¿åœ¨å‚æ•°åˆ—è¡¨ä¸­, æ‰€æœ‰çš„å†’å·å¯¹å„¿éƒ½ä¼šä½œä¸ºå‘½åå‚æ•°, ä½†æ˜¯ 'quoted string' =\u0026gt; $value é™¤å¤–.\nterm * * ä¼šåˆ›å»ºä¸€ä¸ªç±»å‹ä¸º Whatever çš„å¯¹è±¡. è¯¦æƒ…æŸ¥çœ‹ Whatever.\nIdentifier terms Rakuä¸­æœ‰å†…å»ºçš„æ ‡è¯†ç¬¦é¡¹, åˆ—å‡ºå¦‚ä¸‹. æ­¤å¤–, ä½¿ç”¨è¯¥è¯­æ³•èƒ½æ·»åŠ æ–°çš„æ ‡è¯†ç¬¦é¡¹.\nsub term:\u0026lt;fourty-two\u0026gt; { 42 }; say fourty-two æˆ–è€…ä½œä¸ºå¸¸é‡:\nconstant forty-two = 42; say fourty-two self åœ¨æ–¹æ³•ä¸­, self æŒ‡å‘æ–¹æ³•çš„è°ƒç”¨è€…( ä¾‹å¦‚, æ–¹æ³•è¢«è°ƒç”¨çš„å¯¹è±¡). å¦‚æœæŠŠå®ƒç”¨åœ¨æ²¡æœ‰æ„ä¹‰çš„ä¸Šä¸‹æ–‡ä¸­, ä¼šæŠ›å‡ºä¸€ä¸ª  X::Syntax::NoSelf ç±»å‹çš„ç¼–è¯‘æ—¶é”™è¯¯.\nnow è¿”å›ä¸€ä¸ªä»£è¡¨å½“å‰æ—¶é—´çš„å®ä¾‹å¯¹è±¡.\nrand è¿”å›ä¸€ä¸ªèŒƒå›´ä¸º 0..^1 çš„ä¼ªéšæœºæµ®ç‚¹æ•°.\npi è¿”å›æ•°å€¼ pi, ä¾‹å¦‚, åœ†çš„å‘¨é•¿å’ŒåŠå¾„ä¹‹é—´çš„æ¯”ç‡.\ne è¿”å›æ¬§æ‹‰æ•°å€¼.\ni è¿”å›å¤æ•°çš„è™šéƒ¨.\n","permalink":"https://ohmyweekly.github.io/notes/2015-11-21-terms-in-raku/","tags":["term"],"title":"Raku ä¸­çš„é¡¹"},{"categories":["rakulang"],"contents":"ç¬¬å…«ç«  å‡½æ•°å¼ç¼–ç¨‹ åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹çœ‹ä¸€äº›æœ‰åˆ©äºå‡½æ•°å¼ç¼–ç¨‹çš„åŠŸèƒ½ã€‚\nå‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘ å‡½æ•°/å­ä¾‹ç¨‹æ˜¯ä¸€ç­‰å…¬æ°‘:\n å®ƒä»¬èƒ½ä½œä¸ºå‚æ•°ä¼ é€’ å®ƒä»¬èƒ½ä»å¦å¤–ä¸€ä¸ªå‡½æ•°ä¸­è¿”å› å®ƒä»¬èƒ½è¢«èµ‹å€¼ç»™å˜é‡  map å‡½æ•°æ˜¯ç”¨æ¥è¯´æ˜è¿™ä¸ªæ¦‚å¿µçš„æå¥½ä¾‹å­ã€‚map æ˜¯é«˜é˜¶å‡½æ•°, å®ƒæ¥æ”¶å¦å¤–ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ã€‚\nè„šæœ¬\nmy @array = \u0026lt;1 2 3 4 5\u0026gt;; sub squared($x) { $x ** 2 } say map(\u0026amp;squared, @array); è¾“å‡º\n(1 4 9 16 25) è§£é‡Š\næˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå«åš squared çš„å­ä¾‹ç¨‹, å®ƒæ¥æ”¶ä¸€ä¸ªæ•°å­—å¹¶è¿”å›è¯¥æ•°å­—çš„äºŒæ¬¡å¹‚ã€‚ä¸‹ä¸€æ­¥, æˆ‘ä»¬ä½¿ç”¨ map è¿™ä¸ªé«˜é˜¶å‡½æ•°å¹¶ä¼ é€’ç»™å®ƒä¸¤ä¸ªå‚æ•°, ä¸€ä¸ªå­ä¾‹ç¨‹å’Œä¸€ä¸ªæ•°ç»„ã€‚ç»“æœæ˜¯æ‰€æœ‰æ•°ç»„å…ƒç´ çš„å¹³æ–¹ç»„æˆçš„åˆ—è¡¨ã€‚\næ³¨æ„å½“ä¼ é€’å­ä¾‹ç¨‹ä½œä¸ºå‚æ•°æ—¶, æˆ‘ä»¬éœ€è¦åœ¨å­ä¾‹ç¨‹çš„åå­—å‰æ·»åŠ ä¸€ä¸ª \u0026amp; ç¬¦å·ã€‚\né—­åŒ… ã€€åœ¨ Raku ä¸­æ‰€æœ‰çš„ä»£ç å¯¹è±¡éƒ½æ˜¯é—­åŒ…, è¿™æ„å‘³ç€å®ƒä»¬èƒ½ä»å¤–éƒ¨ä½œç”¨åŸŸ(outer scope)å¼•ç”¨è¯æ³•å˜é‡(lexical variables)ã€‚\nåŒ¿åå‡½æ•° ã€€åŒ¿åå‡½æ•°ä¹Ÿå«åš lambdaã€‚\nåŒ¿åå‡½æ•°æ²¡æœ‰ç»‘å®šåˆ°æ ‡è¯†ç¬¦(åŒ¿åå‡½æ•°æ²¡æœ‰åå­—)ã€‚\nè®©æˆ‘ä»¬ä½¿ç”¨åŒ¿åå‡½æ•°é‡å†™ map é‚£ä¸ªä¾‹å­ã€‚\nmy @array = \u0026lt;1 2 3 4 5\u0026gt;; say map(-\u0026gt; $x {$x ** 2}, @array); æˆ‘ä»¬æ²¡æœ‰å£°æ˜å­ä¾‹ç¨‹å¹¶æŠŠå®ƒä½œä¸ºå‚æ•°ä¼ é€’ç»™ map, è€Œæ˜¯åœ¨é‡Œé¢ç›´æ¥å®šä¹‰äº†åŒ¿åå‡½æ•°ã€‚\nåŒ¿åå‡½æ•° -\u0026gt; $x {$x ** 2} æ²¡æœ‰å¥æŸ„å¹¶ä¸”ä¸èƒ½è¢«è°ƒç”¨ã€‚\næŒ‰ç…§ Raku çš„è¯´æ³•æˆ‘ä»¬æŠŠè¿™ä¸ªæ ‡è®°å«åš pointy blockã€‚\npointy block ä¹Ÿèƒ½ç”¨äºæŠŠå‡½æ•°èµ‹å€¼ç»™å˜é‡:\nmy $squared = -\u0026gt; $x { $x ** 2 } say $squared(9); é“¾å¼è°ƒç”¨ ã€€åœ¨ Raku ä¸­, æ–¹æ³•å¯ä»¥é“¾æ¥èµ·æ¥, ä½ ä¸å†éœ€è¦æŠŠä¸€ä¸ªæ–¹æ³•çš„ç»“æœä½œä¸ºå‚æ•°ä¼ é€’ç»™å¦å¤–ä¸€ä¸ªæ–¹æ³•äº†ã€‚\næˆ‘ä»¬å‡è®¾ä½ æœ‰ä¸€ä¸ªæ•°ç»„ã€‚ä½ è¢«è¦æ±‚è¿”å›è¯¥æ•°ç»„çš„å”¯ä¸€å€¼, å¹¶ä¸”æŒ‰ä»å¤§åˆ°å°çš„é¡ºåºæ’åºã€‚\nä½ å¯èƒ½ä¼šé€šè¿‡å†™å‡ºè¿‘ä¼¼äºè¿™æ ·çš„ä»£ç æ¥è§£å†³é‚£ä¸ªé—®é¢˜:\nmy @array = \u0026lt;7 8 9 0 1 2 4 3 5 6 7 8 9 \u0026gt;; my @final-array = reverse(sort(unique(@array))); say @final-array; é¦–å…ˆæˆ‘ä»¬åœ¨ @array èº«ä¸Šè°ƒç”¨ unique å‡½æ•°, ç„¶åæˆ‘ä»¬æŠŠå®ƒçš„ç»“æœä½œä¸ºå‚æ•°ä¼ é€’ç»™ sort å‡½æ•°, å†ç„¶åæˆ‘ä»¬æŠŠç»“æœä¼ é€’ç»™ reverse å‡½æ•°ã€‚\nå’Œä¸Šé¢çš„ä¾‹å­ç›¸æ¯”, Raku å…è®¸é“¾å¼æ–¹æ³•ã€‚\nä¸Šé¢çš„ä¾‹å­å¯ä»¥åƒä¸‹é¢è¿™æ ·å†™, åˆ©ç”¨æ–¹æ³•é“¾çš„ä¼˜ç‚¹:\nmy @array = \u0026lt;7 8 9 0 1 2 4 3 5 6 7 8 9 \u0026gt;; my @final-array = @array.unique.sort.reverse; say @final-array; ä½ å·²ç»çœ‹åˆ°é“¾å¼æ–¹æ³•çœ‹èµ·æ¥æœ‰å¤šæ¸…çˆ½å•¦ã€‚\nFeed æ“ä½œç¬¦ ã€€feed æ“ä½œç¬¦, åœ¨æœ‰äº›å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ä¸­ä¹Ÿå«ç®¡é“, ç„¶è€Œå®ƒæ˜¯é“¾å¼æ–¹æ³•çš„ä¸€ä¸ªæ›´å¥½çš„å¯è§†åŒ–äº§å‡ºã€‚\nå‘å‰æµ\nmy @array = \u0026lt;7 8 9 0 1 2 4 3 5 6\u0026gt;; @array ==\u0026gt; unique() ==\u0026gt; sort() ==\u0026gt; reverse() ==\u0026gt; my @final-array; say @final-array; è§£é‡Š\nä» @array å¼€å§‹, ç„¶åè¿”å›ä¸€ä¸ªå”¯ä¸€å…ƒç´ çš„åˆ—è¡¨ ç„¶å æ’åºå®ƒ ç„¶å åè½¬å®ƒ ç„¶å æŠŠç»“æœä¿å­˜åˆ° @final-array ä¸­ å°±åƒä½ çœ‹åˆ°çš„é‚£æ ·, æ–¹æ³•çš„æµå‘æ˜¯è‡ªä¸Šè€Œä¸‹çš„ã€‚\nå‘åæµ\nmy @array = \u0026lt;7 8 9 0 1 2 4 3 5 6\u0026gt;; my @final-array-v2 \u0026lt;== reverse() \u0026lt;== sort() \u0026lt;== unique() \u0026lt;== @array; say @final-array-v2; è§£é‡Š\nå‘åæµå°±åƒå‘å‰æµä¸€æ ·, ä½†æ˜¯æ˜¯ä»¥åè½¬çš„é¡ºåºå†™çš„ã€‚\næ–¹æ³•çš„æµåŠ¨æ–¹å‘æ˜¯è‡ªä¸‹è€Œä¸Šã€‚\nHyper æ“ä½œç¬¦ ã€€hyper æ“ä½œç¬¦ Â». ä¼šåœ¨åˆ—è¡¨çš„æ‰€æœ‰å…ƒç´ èº«ä¸Šè°ƒç”¨ä¸€ä¸ªæ–¹æ³•å¹¶è¿”å›æ‰€æœ‰ç»“æœçš„ä¸€ä¸ªåˆ—è¡¨ã€‚\nmy @array = \u0026lt;0 1 2 3 4 5 6 7 8 9 10\u0026gt;; sub is-even($var) { $var %% 2 }; say @arrayÂ».is-prime; say @arrayÂ».\u0026amp;is-even; ä½¿ç”¨ hyper æ“ä½œç¬¦æˆ‘ä»¬èƒ½è°ƒç”¨ Raku ä¸­å·²ç»å®šä¹‰è¿‡çš„æ–¹æ³•, ä¾‹å¦‚ is-prime å‘Šè¯‰æˆ‘ä»¬ä¸€ä¸ªæ•°å­—æ˜¯å¦æ˜¯è´¨æ•°ã€‚\næ­¤å¤–æˆ‘ä»¬èƒ½å®šä¹‰æ–°çš„å­ä¾‹ç¨‹å¹¶ä½¿ç”¨ hyper æ“ä½œç¬¦è°ƒç”¨å®ƒä»¬ã€‚ä½†æ˜¯è¿™æ—¶æˆ‘ä»¬å¿…é¡»åœ¨æ–¹æ³•çš„åå­—å‰é¢åŠ ä¸Š \u0026amp; ç¬¦å·ã€‚ä¾‹å¦‚ \u0026amp;is-evenã€‚\nè¿™å¾ˆå®ç”¨å› ä¸ºå®ƒä½¿æˆ‘ä»¬ä¸å¿…å†™ for å¾ªç¯å°±å¯ä»¥è¿­ä»£æ¯ä¸ªå€¼ã€‚\nJunctions ã€€junction æ˜¯å€¼çš„é€»è¾‘å åŠ ã€‚\nåœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ 1|2|3 æ˜¯ä¸€ä¸ª junctionã€‚\nmy $var = 2; if $var == 1|2|3 { say \u0026#34;The variable is 1 or 2 or 3\u0026#34; } junctions çš„ä½¿ç”¨å¸¸å¸¸è§¦å‘è‡ªåŠ¨çº¿ç¨‹åŒ–; æ¯ä¸ª junction å…ƒç´ éƒ½æ‰§è¡Œè¯¥æ“ä½œ, å¹¶ä¸”æ‰€æœ‰çš„ç»“æœè¢«ç»„åˆåˆ°ä¸€ä¸ªæ–°çš„ junction ä¸­å¹¶è¿”å›ã€‚\nLazy Lists ã€€æƒ°æ€§åˆ—è¡¨æ˜¯è¢«æƒ°æ€§æ±‚å€¼çš„åˆ—è¡¨ã€‚\næƒ°æ€§æ±‚å€¼å»¶è¿Ÿè¡¨è¾¾å¼çš„è®¡ç®—ç›´åˆ°éœ€è¦æ—¶, å¹¶æŠŠç»“æœå­˜å‚¨åˆ°æŸ¥è¯¢è¡¨ä¸­ä»¥é¿å…é‡å¤è®¡ç®—ã€‚\næƒ°æ€§åˆ—è¡¨çš„ä¼˜ç‚¹åŒ…æ‹¬:\n é€šè¿‡é¿å…ä¸å¿…è¦çš„è®¡ç®—å¸¦æ¥çš„æ€§èƒ½æå‡ æ„å»ºæ½œåœ¨çš„æ— é™æ•°æ®ç»“æ„çš„èƒ½åŠ› å®šä¹‰æ§åˆ¶æµçš„èƒ½åŠ›  æˆ‘ä»¬ä½¿ç”¨ä¸­ç¼€æ“ä½œç¬¦ ... æ¥åˆ›å»ºæƒ°æ€§åˆ—è¡¨ã€‚\næƒ°æ€§åˆ—è¡¨æ‹¥æœ‰ä¸€ä¸ªåˆå§‹å…ƒç´ , ä¸€ä¸ªå‘ç”Ÿå™¨å’Œä¸€ä¸ªç»“æŸç‚¹ã€‚\nç®€å•çš„æƒ°æ€§åˆ—è¡¨\nmy $lazylist = (1 ... 10); say $lazylist; åˆå§‹å…ƒç´ ä¸º 1 è€Œç»“æŸç‚¹ä¸º 10ã€‚å› ä¸ºæ²¡æœ‰å®šä¹‰å‘ç”Ÿå™¨æ‰€ä»¥é»˜è®¤çš„å‘ç”Ÿå™¨ä¸º successor(+1)ã€‚æ¢å¥è¯è¯´, è¿™ä¸ªæƒ°æ€§åˆ—è¡¨å¯èƒ½è¿”å›(å¦‚æœéœ€è¦çš„è¯)ä¸‹é¢çš„å…ƒç´  (1, 2, 3, 4, 5, 6, 7, 8, 9, 10)ã€‚\næ— é™æƒ°æ€§åˆ—è¡¨\nmy $lazylist = (1 ... Inf); say $lazylist; è¯¥åˆ—è¡¨å¯èƒ½è¿”å›(å¦‚æœéœ€è¦çš„è¯) 1 åˆ°æ— ç©·å¤§ä¹‹é—´çš„ä»»ä½•æ•´æ•°, æ¢å¥è¯è¯´, å¯ä»¥è¿”å›ä»»ä½•æ•´æ•°ã€‚\nä½¿ç”¨æ¨æ–­å‘ç”Ÿå™¨åˆ›å»ºæƒ°æ€§åˆ—è¡¨\nmy $lazylist = (0,2 ... 10); say $lazylist; åˆå§‹çš„å…ƒç´ æ˜¯ 0 å’Œ 2 è€Œç»“æŸç‚¹æ˜¯ 10ã€‚è™½ç„¶æ²¡æœ‰å®šä¹‰å‘ç”Ÿå™¨, ä½†æ˜¯ä½¿ç”¨äº†åˆå§‹å…ƒç´ , Raku ä¼šæŠŠç”Ÿæˆå™¨æ¨æ–­ä¸º (+2)ã€‚\nè¿™ä¸ªæƒ°æ€§åˆ—è¡¨å¯èƒ½è¿”å›(å¦‚æœéœ€è¦çš„è¯)ä¸‹é¢çš„å…ƒç´  (0, 2, 4, 6, 8, 10)ã€‚\nä½¿ç”¨å®šä¹‰çš„å‘ç”Ÿå™¨åˆ›å»ºæƒ°æ€§åˆ—è¡¨\nmy $lazylist = (0, { $_ + 3 } ... 12); say $lazylist; åœ¨è¿™ä¸ªä¾‹å­ä¸­, æˆ‘ä»¬åœ¨é—­åˆ { } ä¸­æ˜¾å¼åœ°å®šä¹‰äº†ä¸€ä¸ªå‘ç”Ÿå™¨ã€‚\nè¿™ä¸ªæƒ°æ€§åˆ—è¡¨å¯èƒ½è¿”å›(å¦‚æœéœ€è¦çš„è¯)ä¸‹é¢çš„å…ƒç´  (0, 3, 6, 9, 12)ã€‚\n å½“ä½¿ç”¨æ˜¾å¼çš„å‘ç”Ÿå™¨æ—¶, ç»“æŸç‚¹å¿…é¡»æ˜¯å‘ç”Ÿå™¨èƒ½è¿”å›çš„ä¸€ä¸ªå€¼ã€‚\nå¦‚æœåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­æˆ‘ä»¬ä½¿ç”¨çš„ç»“æŸç‚¹æ˜¯ 10 è€Œé 12, é‚£ä¹ˆå‘ç”Ÿå™¨å°±ä¸ä¼šåœæ­¢ã€‚å‘ç”Ÿå™¨ä¼šè·³è¿‡é‚£ä¸ªç»“æŸç‚¹ã€‚\näºŒé€‰ä¸€, ä½ å¯ä»¥ä½¿ç”¨ 0 ...^ * \u0026gt; 10 ä»£æ›¿ 0 ... 10ã€‚ä½ å¯ä»¥æŠŠå®ƒè¯»ä½œ: ä» 0 ç›´åˆ°ç¬¬ä¸€ä¸ªå¤§äº 10(ä¸åŒ…æ‹¬å®ƒ)çš„å€¼\nè¿™ä¸ä¼šä½¿å‘ç”Ÿå™¨åœæ­¢\nmy $lazylist = (0, { $_ + 3 } ... 10); say $lazylist; è¿™ä¼šä½¿å‘ç”Ÿå™¨åœæ­¢\nmy $lazylist = (0, { $_ + 3 } ...^ * \u0026gt; 10); say $lazylist;  ç¬¬ä¹ç«  ç±»å’Œå¯¹è±¡ åœ¨ä¸Šä¸€ç« ä¸­æˆ‘ä»¬å­¦ä¹ äº† Raku ä¸­å‡½æ•°å¼ç¼–ç¨‹çš„ä¾¿åˆ©æ€§ã€‚åœ¨è¿™ä¸€ç« ä¸­æˆ‘ä»¬å°†çœ‹çœ‹ Raku ä¸­çš„é¢å‘å¯¹è±¡ç¼–ç¨‹ã€‚\nä»‹ç» ã€€é¢å‘å¯¹è±¡ç¼–ç¨‹æ˜¯å½“ä»Šå¹¿æ³›ä½¿ç”¨çš„èŒƒå¼ä¹‹ä¸€ã€‚å¯¹è±¡æ˜¯ä¸€ç»„ç»‘å®šåœ¨ä¸€èµ·çš„å˜é‡å’Œå­ä¾‹ç¨‹ã€‚\nå…¶ä¸­çš„å˜é‡å«åšå±æ€§, è€Œå­ä¾‹ç¨‹è¢«å«åšæ–¹æ³•ã€‚å±æ€§å®šä¹‰å¯¹è±¡çš„çŠ¶æ€, è€Œæ–¹æ³•å®šä¹‰å¯¹è±¡çš„è¡Œä¸ºã€‚\nç±»å®šä¹‰ä¸€ç»„å¯¹è±¡ç»“æ„ã€‚\nä¸ºäº†ç†è§£å®ƒä»¬ä¹‹é—´çš„å…³ç³», è€ƒè™‘ä¸‹é¢çš„ä¾‹å­:\n   æˆ¿é—´é‡Œæœ‰ 4 ä¸ª people objects =\u0026gt; 4 people     è¿™ 4 ä¸ªäººæ˜¯ humans class =\u0026gt; Human   å®ƒä»¬æœ‰ä¸åŒçš„åå­—,å¹´çºª,æ€§åˆ«å’Œå›½ç± attribute =\u0026gt; name,age,sex,nationality    æŒ‰é¢å‘å¯¹è±¡çš„è¯´æ³•, å¯¹è±¡æ˜¯ç±»çš„å®ä¾‹ã€‚\nè€ƒè™‘ä¸‹é¢çš„è„šæœ¬:\nclass Human { has $name; has $age; has $sex; has $nationality; } my $john = Human.new(name =\u0026gt; \u0026#39;John\u0026#39;, age =\u0026gt; 23, sex =\u0026gt; \u0026#39;M\u0026#39; nationality =\u0026gt; \u0026#39;American\u0026#39;) say $john;  class å…³é”®å­—ç”¨äºå®šä¹‰ç±»ã€‚ has å…³é”®å­—ç”¨äºå®šä¹‰ç±»çš„å±æ€§ã€‚ .new æ–¹æ³•è¢«ç§°ä¹‹ä¸ºæ„é€ å‡½æ•°ã€‚å®ƒåˆ›å»ºäº†å¯¹è±¡ä½œä¸ºç±»çš„å®ä¾‹ã€‚  åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, æ–°çš„å˜é‡ $john ä¿å­˜äº†ç”± Human.new() æ‰€å®šä¹‰çš„æ–° \u0026ldquo;Human\u0026rdquo; å®ä¾‹ã€‚ ä¼ é€’ç»™ .new() æ–¹æ³•çš„å‚æ•°ç”¨äºè®¾ç½®åº•å±‚å¯¹è±¡çš„å±æ€§ã€‚ ç±»å¯ä»¥ä½¿ç”¨ my æ¥å£°æ˜ä¸€ä¸ªæœ¬åœ°ä½œç”¨åŸŸ:\nmy class Human { } å°è£… ã€€å°è£…æ˜¯ä¸€ä¸ªé¢å‘å¯¹è±¡çš„æ¦‚å¿µ, å®ƒæŠŠä¸€ç»„æ•°æ®å’Œæ–¹æ³•æ†ç»‘åœ¨ä¸€å—ã€‚ å¯¹è±¡ä¸­çš„æ•°æ®(å±æ€§)åº”è¯¥æ˜¯ç§æœ‰çš„, æ¢å¥è¯è¯´, åªèƒ½ä»å¯¹è±¡å†…éƒ¨è®¿é—®å®ƒã€‚ ä¸ºäº†ä»å¯¹è±¡å¤–éƒ¨è®¿é—®å¯¹è±¡çš„å±æ€§, æˆ‘ä»¬ä½¿ç”¨å«åšå­˜å–å™¨çš„æ–¹æ³•ã€‚ ä¸‹é¢ä¸¤ä¸ªè„šæœ¬æ‹¥æœ‰åŒæ ·çš„ç»“æœã€‚\nç›´æ¥è®¿é—®å˜é‡:\nmy $var = 7; say $var; å°è£…\nmy $var = 7; sub sayvar { $var; } say sayvar; sayvar æ˜¯ä¸€ä¸ªå­˜å–å™¨ã€‚å®ƒè®©æˆ‘ä»¬é€šè¿‡ä¸ç›´æ¥è®¿é—®è¿™ä¸ªå˜é‡æ¥è®¿é—®è¿™ä¸ªå˜é‡ã€‚ åœ¨ Raku ä¸­ä½¿ç”¨ twigils ä½¿å¾—å°è£…å¾ˆä¾¿åˆ©ã€‚ Twigils æ˜¯ç¬¬äºŒ ç¬¦å·ã€‚å®ƒä»¬å­˜åœ¨äºç¬¦å·å’Œå±æ€§åä¹‹é—´ã€‚ æœ‰ä¸¤ä¸ª twigils ç”¨åœ¨ç±»ä¸­:\n ! ç”¨äºæ˜¾å¼åœ°å£°æ˜å±æ€§æ˜¯ç§æœ‰çš„ . ç”¨äºä¸ºå±æ€§è‡ªåŠ¨ç”Ÿæˆå­˜å–å™¨  é»˜è®¤åœ°, æ‰€æœ‰çš„å±æ€§éƒ½æ˜¯ç§æœ‰çš„, ä½†æ˜¯æ€»æ˜¯ç”¨ ! twigil æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ã€‚ ä¸ºäº†å’Œæˆ‘è¯´çš„ç›¸ä¸€è‡´, æˆ‘ä»¬åº”è¯¥æŠŠä¸Šé¢çš„ç±»é‡å†™æˆä¸‹é¢è¿™æ ·:\nclass Human { has $!name; has $!age; has $!sex; has $!nationality; } my $john = Human.new(name =\u0026gt; \u0026#39;John\u0026#39;, age =\u0026gt; 23, sex =\u0026gt; \u0026#39;M\u0026#39;, nationality =\u0026gt; \u0026#39;American\u0026#39;); say $john; ç»™è„šæœ¬è¿½åŠ è¿™æ ·çš„çš„è¯­å¥: say $john.age; å®ƒä¼šè¿”å›è¿™æ ·çš„é”™è¯¯: Method 'age' not found for invocant of class 'Human'ã€‚ åŸå› æ˜¯ $!age æ˜¯ç§æœ‰çš„å¹¶ä¸”åªèƒ½ç”¨äºå¯¹è±¡å†…éƒ¨ã€‚ å°è¯•åœ¨å¯¹è±¡å¤–éƒ¨è®¿é—®å®ƒä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚ ç°åœ¨ç”¨ has $.age ä»£æ›¿ $!age å¹¶çœ‹çœ‹ say $john.age; çš„ç»“æœæ˜¯ä»€ä¹ˆã€‚\nå…·åå‚æ•° vs. ä½ç½®å‚æ•° ã€€åœ¨ Raku ä¸­, æ‰€æœ‰çš„ç±»ç»§æ‰¿äº†ä¸€ä¸ªé»˜è®¤çš„ .new æ„é€ å‡½æ•°ã€‚ é€šè¿‡ä¸ºä»–æä¾›å‚æ•°, å®ƒèƒ½ç”¨äºåˆ›å»ºå¯¹è±¡ã€‚ åªèƒ½æä¾›å…·åå‚æ•°ç»™é»˜è®¤çš„æ„é€ å‡½æ•°ã€‚\nå¦‚æœä½ è€ƒè™‘åˆ°ä¸Šé¢çš„ä¾‹å­, ä½ ä¼šçœ‹åˆ°æ‰€æœ‰æä¾›ç»™ .new æ–¹æ³•çš„å‚æ•°éƒ½æ˜¯æŒ‰åå­—å®šä¹‰çš„:\n name =\u0026gt; \u0026lsquo;John\u0026rsquo; age =\u0026gt; 23  å‡å¦‚æˆ‘ä¸æƒ³åœ¨æ¯æ¬¡åˆ›å»ºæ–°å¯¹è±¡çš„æ—¶å€™ä¸ºæ¯ä¸ªå±æ€§æä¾›ä¸€ä¸ªåå­—å‘¢? é‚£ä¹ˆæˆ‘éœ€è¦åˆ›å»ºå¦å¤–ä¸€ä¸ªæ¥æ”¶ä½ç½®å‚æ•°çš„æ„é€ å‡½æ•°ã€‚\nclass Human { has $.name; has $.age; has $.sex; has $.nationality; # é‡å†™é»˜è®¤æ„é€ å‡½æ•°çš„æ–°æ„é€ å‡½æ•° method new ($name, $age, $sex, $nationality) { self.bless(:$name, :$age, :$sex, :$nationality); } } my $john = Human.new(\u0026#39;John\u0026#39;, 23, \u0026#39;M\u0026#39;, \u0026#39;American\u0026#39;); say $john; èƒ½æ¥æ”¶ä½ç½®å‚æ•°çš„æ„é€ å‡½æ•°éœ€è¦æŒ‰ä¸Šé¢é‚£æ ·å®šä¹‰ã€‚\næ–¹æ³• ã€€ä»‹ç» ã€€æ–¹æ³•æ˜¯å¯¹è±¡çš„å­ä¾‹ç¨‹ã€‚ åƒå­ä¾‹ç¨‹ä¸€æ ·, æ–¹æ³•æ˜¯ä¸€ç§æ‰“åŒ…ä¸€ç»„åŠŸèƒ½çš„æ‰‹æ®µ, å®ƒä»¬æ¥æ”¶å‚æ•°, æ‹¥æœ‰ç­¾åå¹¶å¯ä»¥è¢«å®šä¹‰ä¸º multiã€‚ æ–¹æ³•æ˜¯ä½¿ç”¨å…³é”®å­— method æ¥å®šä¹‰çš„ã€‚\næ­£å¸¸æƒ…å†µä¸‹, æ–¹æ³•è¢«è¦æ±‚åœ¨å¯¹è±¡çš„å±æ€§èº«ä¸Šæ‰§è¡Œä¸€äº›åŠ¨ä½œã€‚è¿™å¼ºåˆ¶äº†å°è£…çš„æ¦‚å¿µã€‚å¯¹è±¡çš„å±æ€§åªèƒ½åœ¨å¯¹è±¡é‡Œé¢ä½¿ç”¨æ–¹æ³•æ¥æ“ä½œã€‚åœ¨å¯¹è±¡å¤–é¢, åªèƒ½å’Œå¯¹è±¡çš„æ–¹æ³•äº¤äº’, å¹¶ä¸”ä¸èƒ½è®¿é—®å®ƒçš„å±æ€§ã€‚\nclass Human { has $.name; has $.age; has $.sex; has $.nationality; has $.eligible; method assess-eligibility { if self.age \u0026lt; 21 { $!eligible = \u0026#39;No\u0026#39; } else { $!eligible = \u0026#39;Yes\u0026#39; } } } my $john = Human.new(name =\u0026gt; \u0026#39;John\u0026#39;, age =\u0026gt; 23, sex =\u0026gt; \u0026#39;M\u0026#39;, nationality =\u0026gt; \u0026#39;American\u0026#39;); $john.assess-eligibility; say $john.eligible; ä¸€æ—¦æ–¹æ³•å®šä¹‰åœ¨ç±»ä¸­, å®ƒä»¬å°±èƒ½åœ¨å¯¹è±¡èº«ä¸Šä½¿ç”¨ç‚¹è®°å·æ¥è°ƒç”¨: object.method æˆ–åƒä¸Šé¢çš„ä¾‹å­é‚£æ ·: $john.assess-eligibilityã€‚ åœ¨æ–¹æ³•çš„å®šä¹‰ä¸­, å¦‚æœæˆ‘ä»¬éœ€è¦å¼•ç”¨å¯¹è±¡æœ¬èº«ä»¥è°ƒç”¨å¦ä¸€ä¸ªæ–¹æ³•, åˆ™ä½¿ç”¨ self å…³é”®å­—ã€‚ åœ¨æ–¹æ³•çš„å®šä¹‰ä¸­, å¦‚æœæˆ‘ä»¬éœ€è¦å¼•ç”¨å±æ€§, åˆ™ä½¿ç”¨ !, å³ä½¿å±æ€§æ˜¯ä½¿ç”¨ . å®šä¹‰çš„ã€‚ ç†ç”±æ˜¯ . twigil åšçš„å°±æ˜¯ä½¿ç”¨ ! å£°æ˜ä¸€ä¸ªå±æ€§å¹¶è‡ªåŠ¨åˆ›å»ºå­˜å–å™¨ã€‚\nåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, if self.age \u0026lt; 21 å’Œ if $!age \u0026lt; 21 ä¼šæœ‰åŒæ ·çš„æ•ˆæœ, å°½ç®¡å®ƒä»¬ä»æŠ€æœ¯ä¸Šæ¥è®²æ˜¯ä¸åŒçš„:\n self.age è°ƒç”¨äº† .age æ–¹æ³•(å­˜å–å™¨)  äºŒé€‰ä¸€, è¿˜èƒ½å†™æˆ $.age\n $!age æ˜¯ç›´æ¥è°ƒç”¨é‚£ä¸ªå˜é‡  ç§æœ‰æ–¹æ³• ã€€æ­£å¸¸çš„æ–¹æ³•èƒ½ä»ç±»çš„å¤–é¢åœ¨å¯¹è±¡èº«ä¸Šè°ƒç”¨ã€‚ ç§æœ‰æ–¹æ³•æ˜¯åªèƒ½ä»ç±»çš„å†…éƒ¨è°ƒç”¨çš„æ–¹æ³•ã€‚\nä¸€ä¸ªå¯èƒ½çš„ä½¿ç”¨æƒ…å†µæ˜¯ä¸€ä¸ªæ–¹æ³•è°ƒç”¨å¦å¤–ä¸€ä¸ªæ‰§è¡Œç‰¹å®šåŠ¨ä½œçš„æ–¹æ³•ã€‚è¿æ¥å¤–éƒ¨ä¸–ç•Œçš„æ–¹æ³•æ˜¯å…¬å…±çš„è€Œè¢«å¼•ç”¨çš„é‚£ä¸ªæ–¹æ³•åº”è¯¥ä¿æŒç§æœ‰ã€‚æˆ‘ä»¬ä¸æƒ³è®©ç”¨æˆ·ç›´æ¥è°ƒç”¨å®ƒ, æ‰€ä»¥æˆ‘ä»¬æŠŠå®ƒå£°æ˜ä¸ºç§æœ‰çš„ã€‚\nç§æœ‰æ–¹æ³•çš„å£°æ˜éœ€è¦åœ¨æ–¹æ³•çš„åå­—å‰ä½¿ç”¨ ! twigilã€‚ ç§æœ‰æ–¹æ³•æ˜¯ä½¿ç”¨ ! è€Œé . è°ƒç”¨çš„ã€‚\nmethod !iamprivate { # code goes in here } method iampublic { self!iamprivate; # do additional things } ç±»å±æ€§ ã€€ç±»å±æ€§æ˜¯å±äºç±»è‡ªèº«è€Œéç±»çš„å¯¹è±¡çš„å±æ€§ã€‚ å®ƒä»¬èƒ½åœ¨å®šä¹‰æœŸé—´åˆå§‹åŒ–ã€‚ ç±»å±æ€§æ˜¯ä½¿ç”¨ my å…³é”®å­—è€Œé has å…³é”®å­—å£°æ˜çš„ã€‚ å®ƒä»¬æ˜¯åœ¨ç±»è‡ªå·±èº«ä¸Šè€Œéå®ƒçš„å¯¹è±¡èº«ä¸Šè°ƒç”¨çš„ã€‚\nclass Human { has $.name; my $.counter = 0; method new($name) { Human.counter++; self.bless(:$name); } } my $a = Human.new(\u0026#39;a\u0026#39;); my $b = Human.new(\u0026#39;b\u0026#39;); say Human.counter; è®¿é—®ç±»å‹ ã€€åˆ°ç°åœ¨ä¸ºæ­¢æˆ‘ä»¬çœ‹åˆ°çš„æ‰€ä»¥ä¾‹å­éƒ½ä½¿ç”¨å­˜å–å™¨æ¥ä»å¯¹è±¡å±æ€§ä¸­è·å–ä¿¡æ¯ã€‚ å‡å¦‚æˆ‘ä»¬éœ€è¦ä¿®æ”¹å±æ€§çš„å€¼å‘¢? æˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸‹é¢çš„ is rw å…³é”®å­—æŠŠå®ƒæ ‡è®°ä¸º read/writeã€‚\nclass Human { has $.name; has $.age is rw; } my $john = Human.new(name =\u0026gt; \u0026#39;John\u0026#39;, age =\u0026gt; 21); say $john.age; $john.age = 23; say $john.age; é»˜è®¤åœ°, æ‰€æœ‰å±æ€§éƒ½å£°æ˜ä¸ºåªè¯», ä½†æ˜¯ä½ å¯ä»¥æ˜¾å¼åœ°ä½¿ç”¨ is readonly æ¥å£°æ˜ã€‚\nç»§æ‰¿ ã€€ä»‹ç» ã€€ç»§æ‰¿æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„å¦ä¸€ä¸ªæ¦‚å¿µã€‚ å½“å®šä¹‰ç±»çš„æ—¶å€™, å¾ˆå¿«æˆ‘ä»¬ä¼šæ„æ€åˆ°å¾ˆå¤šå±æ€§/æ–¹æ³•åœ¨å¾ˆå¤šç±»ä¸­æ˜¯å…±æœ‰çš„ã€‚ æˆ‘ä»¬åº”è¯¥é‡å¤ä»£ç å—?\nä¸! æˆ‘ä»¬åº”è¯¥ä½¿ç”¨ç»§æ‰¿ã€‚ å‡è®¾æˆ‘ä»¬æƒ³å®šä¹‰ä¸¤ä¸ªç±», ä¸€ä¸ªç±»æ˜¯ Human, ä¸€ä¸ªç±»æ˜¯ Employeesã€‚ Human æ‹¥æœ‰ä¸¤ä¸ªå±æ€§: name å’Œ ageã€‚\nEmployees æ‹¥æœ‰ 4 ä¸ªå±æ€§: name, age, company å’Œ salaryã€‚ å°è¯•æŒ‰ä¸‹é¢å®šä¹‰ç±»:\nclass Human { has $.name; has $.age; } class Employee { has $.name; has $.age; has $.company; has $.salary; } è™½ç„¶ä¸Šé¢çš„ä»£ç æŠ€æœ¯ä¸Šæ˜¯æ­£ç¡®çš„, ä½†æ˜¯æ¦‚å¿µä¸Šå·®ã€‚ æ›´å¥½çš„å†™æ³•æ˜¯ä¸‹é¢è¿™æ ·:\nclass Human { has $.name; has $.age; } class Employee is Human { has $.company; has $.salary; } is å…³é”®å­—å®šä¹‰äº†ç»§æ‰¿ã€‚ æŒ‰é¢å‘å¯¹è±¡çš„è¯´æ³•, Employee æ˜¯ Human çš„å­©å­, è€Œ Human æ˜¯ Employee çš„çˆ¶äº²ã€‚\næ‰€æœ‰çš„å­ç±»ç»§æ‰¿äº†çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•, æ‰€ä»¥æ²¡æœ‰å¿…è¦é‡æ–°å®ƒä»¬ã€‚\né‡å†™ ã€€ç±»ä»å®ƒä»¬çš„çˆ¶ç±»ä¸­ç»§æ‰¿æ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•ã€‚ æœ‰äº›æƒ…å†µä¸‹, æˆ‘ä»¬éœ€è¦è®©å­ç±»ä¸­çš„æ–¹æ³•è¡¨ç°å¾—å’Œç»§æ‰¿çš„æ–¹æ³•ä¸ä¸€æ ·ã€‚ ä¸ºäº†åšåˆ°è¿™, æˆ‘ä»¬åœ¨å­ç±»ä¸­é‡æ–°å®šä¹‰æ–¹æ³•ã€‚\nè¿™ä¸ªæ¦‚å¿µå°±å«åšé‡å†™ã€‚\nåœ¨ä¸‹é¢çš„ä¾‹å­ä¸­, introduce-yourself æ–¹æ³•è¢« Employee ç±»ç»§æ‰¿ã€‚\nclass Human { has $.name; has $.age; method introduce-yourself { say \u0026#39;Hi æˆ‘æ˜¯äººç±», æˆ‘çš„åå­—æ˜¯ \u0026#39; ~ self.name; } } class Employee is Human { has $.company; has $.salary; } my $john = Human.new(name =\u0026gt; \u0026#39;John\u0026#39;, age =\u0026gt; 23,); my $jane = Employee.new(name =\u0026gt; \u0026#39;Jane\u0026#39;, age =\u0026gt; 25, company =\u0026gt; \u0026#39;Acme\u0026#39;, salary =\u0026gt; 4000); $john.introduce-yourself; $jane.introduce-yourself; é‡å†™å·¥ä½œå¦‚ä¸‹:\nclass Human { has $.name; has $.age; method introduce-yourself { say \u0026#39;Hi æˆ‘æ˜¯äººç±», æˆ‘çš„åå­—æ˜¯ \u0026#39; ~ self.name; } } class Employee is Human { has $.company; has $.salary; method introduce-yourself { say \u0026#39;Hi æˆ‘æ˜¯ä¸€åå‘˜å·¥, æˆ‘çš„åå­—æ˜¯ \u0026#39; ~ self.name ~ \u0026#39;æˆ‘å·¥ä½œåœ¨: \u0026#39; ~ self.comapny; } } my $john = Human.new(name =\u0026gt;\u0026#39;John\u0026#39;,age =\u0026gt; 23,); my $jane = Employee.new(name =\u0026gt;\u0026#39;Jane\u0026#39;,age =\u0026gt; 25,company =\u0026gt; \u0026#39;Acme\u0026#39;,salary =\u0026gt; 4000); $john.introduce-yourself; $jane.introduce-yourself; æ ¹æ®å¯¹è±¡æ‰€å±çš„ç±», ä¼šè°ƒç”¨æ­£ç¡®çš„æ–¹æ³•ã€‚\nSubmethods ã€€Submethods æ˜¯ä¸€ç§å­ç±»ç»§æ‰¿ä¸åˆ°çš„æ–¹æ³•ã€‚\nå®ƒä»¬åªèƒ½ä»æ‰€å£°æ˜çš„ç±»ä¸­è®¿é—®ã€‚ å®ƒä»¬ä½¿ç”¨ submethod å…³é”®å­—å®šä¹‰ã€‚\nå¤šé‡ç»§æ‰¿ ã€€åœ¨ Raku ä¸­å…è®¸å¤šé‡ç»§æ‰¿ã€‚ä¸€ä¸ªç±»å¯ä»¥ç»§æ‰¿è‡ªå¤šä¸ªå…¶å®ƒçš„ç±»ã€‚\nclass bar-chart { has Int @.bar-values; method plot { say @.bar-values; } } class line-chart { has Int @.line-values; method plot { say @.line-values; } } class combo-chart is bar-chart is line-chart { } my $actual-sales = bar-chart.new(bar-values =\u0026gt; [10,9,11,8,7,10]); my $forecast-sales = line-chart.new(line-values =\u0026gt; [9,8,10,7,6,9]); my $actual-vs-forecast = combo-chart.new(bar-values =\u0026gt; [10,9,11,8,7,10], line-values =\u0026gt; [9,8,10,7,6,9]); say \u0026#34;å®é™…çš„é”€å”®: \u0026#34;; $actual-sales.plot; say \u0026#34;é¢„æµ‹çš„é”€å”®: \u0026#34;; $forecast-sales.plot; say \u0026#34;å®é™… vs é¢„æµ‹:\u0026#34;; $actual-vs-forecast.plot; è¾“å‡º:\nå®é™…çš„é”€å”®: [10 9 11 8 7 10] é¢„æµ‹çš„é”€å”®: [9 8 10 7 6 9] å®é™… vs é¢„æµ‹: [10 9 11 8 7 10] è§£é‡Š\ncombo-chart ç±»åº”è¯¥èƒ½æŒæœ‰ä¸¤ä¸ªåºåˆ—, ä¸€ä¸ªæ˜¯ç»˜åˆ¶æ¡å½¢å›¾çš„å®é™…å€¼, å¦ä¸€ä¸ªæ˜¯ç»˜åˆ¶æŠ˜çº¿å›¾çš„é¢„æµ‹å€¼ã€‚\nè¿™å°±æ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆæŠŠå®ƒå®šä¹‰ä¸º line-chart å’Œ bar-chart çš„å­©å­çš„åŸå› ã€‚\nä½ åº”è¯¥æ³¨æ„åˆ°äº†, åœ¨ combo-chart èº«ä¸Šè°ƒç”¨ plot æ–¹æ³•å¹¶æ²¡æœ‰äº§ç”Ÿæ‰€è¦æ±‚çš„ç»“æœã€‚å®ƒåªç»˜åˆ¶äº†ä¸€ä¸ªåºåˆ—ã€‚\nå‘ç”Ÿäº†ä»€ä¹ˆäº‹?\ncombo-chart ç»§æ‰¿è‡ª line-chart å’Œ bar-chart, å®ƒä»¬éƒ½æœ‰ä¸€ä¸ªå«åš plot çš„æ–¹æ³•ã€‚å½“æˆ‘ä»¬åœ¨ combo-chart èº«ä¸Šè°ƒç”¨é‚£ä¸ªæ–¹æ³•æ—¶, Raku å†…éƒ¨ä¼šå°è¯•é€šè¿‡è°ƒç”¨å…¶æ‰€ç»§æ‰¿çš„æ–¹æ³•ä¹‹ä¸€æ¥è§£å†³å†²çªã€‚\nçº æ­£\nä¸ºäº†è¡¨ç°å¾—æ­£ç¡®, æˆ‘ä»¬åº”è¯¥åœ¨ combo-chart ä¸­é‡å†™ plot æ–¹æ³•ã€‚\nclass bar-chart { has Int @.bar-values; method plot { say @.bar-values; } } class line-chart { has Int @.line-values; method plot { say @.line-values; } } class combo-chart is bar-chart is line-chart { method plot { say @.bar-values; say @.line-values; } } my $actual-sales = bar-chart.new(bar-values =\u0026gt; [10,9,11,8,7,10]); my $forecast-sales = line-chart.new(line-values =\u0026gt; [9,8,10,7,6,9]); my $actual-vs-forecast = combo-chart.new(bar-values =\u0026gt; [10,9,11,8,7,10], line-values =\u0026gt; [9,8,10,7,6,9]); say \u0026#34;å®é™…çš„é”€å”®: \u0026#34;; $actual-sales.plot; say \u0026#34;é¢„æµ‹çš„é”€å”®: \u0026#34;; $forecast-sales.plot; say \u0026#34;å®é™… vs é¢„æµ‹:\u0026#34;; $actual-vs-forecast.plot; è¾“å‡º:\nå®é™…çš„é”€å”®: [10 9 11 8 7 10] é¢„æµ‹çš„é”€å”®: [9 8 10 7 6 9] å®é™… vs é¢„æµ‹: [10 9 11 8 7 10] [9 8 10 7 6 9] Roles ã€€Roles åœ¨å®ƒä»¬æ˜¯å±æ€§å’Œæ–¹æ³•çš„é›†åˆè¿™ä¸ªæ„ä¹‰ä¸Šå’Œç±»æœ‰ç‚¹ç±»ä¼¼ã€‚ Roles ä½¿ç”¨å…³é”®å­— role å£°æ˜, è€Œæƒ³å®ç°è¯¥ role çš„ç±»å¯ä»¥ä½¿ç”¨ does å…³é”®å­—ã€‚\nä½¿ç”¨ roles é‡å†™å¤šé‡ç»§æ‰¿çš„ä¾‹å­\nrole bar-chart { has Int @.bar-values; method plot { say @.bar-values; } } role line-chart { has Int @.line-values; method plot { say @.line-values; } } class combo-chart does bar-chart does line-chart { method plot { say @.bar-values; say @.line-values; } } my $actual-sales = bar-chart.new(bar-values =\u0026gt; [10,9,11,8,7,10]); my $forecast-sales = line-chart.new(line-values =\u0026gt; [9,8,10,7,6,9]); my $actual-vs-forecast = combo-chart.new(bar-values =\u0026gt; [10,9,11,8,7,10], line-values =\u0026gt; [9,8,10,7,6,9]); say \u0026#34;å®é™…çš„é”€å”®: \u0026#34;; $actual-sales.plot; say \u0026#34;é¢„æµ‹çš„é”€å”®: \u0026#34;; $forecast-sales.plot; say \u0026#34;å®é™… vs é¢„æµ‹:\u0026#34;; $actual-vs-forecast.plot; è¿è¡Œä¸Šé¢çš„è„šæœ¬ä½ ä¼šçœ‹åˆ°ç»“æœæ˜¯ä¸€æ ·çš„ã€‚\nç°åœ¨ä½ é—®é—®è‡ªå·±, å¦‚æœ roles è¡¨ç°å¾—åƒç±»çš„è¯é‚£ä¹ˆå®ƒä»¬çš„ç”¨é€”æ˜¯ä»€ä¹ˆå‘¢?\nè¦å›ç­”ä½ çš„é—®é¢˜, ä¿®æ”¹ç¬¬ä¸€ä¸ªç”¨äºå±•ç¤ºå¤šé‡ç»§æ‰¿çš„è„šæœ¬, è¿™ä¸ªè„šæœ¬ä¸­æˆ‘ä»¬å¿˜è®°é‡å†™ plot æ–¹æ³•äº†ã€‚\nrole bar-chart { has Int @.bar-values; method plot { say @.bar-values; } } role line-chart { has Int @.line-values; method plot { say @.line-values; } } class combo-chart does bar-chart does line-chart { } my $actual-sales = bar-chart.new(bar-values =\u0026gt; [10,9,11,8,7,10]); my $forecast-sales = line-chart.new(line-values =\u0026gt; [9,8,10,7,6,9]); my $actual-vs-forecast = combo-chart.new(bar-values =\u0026gt; [10,9,11,8,7,10], line-values =\u0026gt; [9,8,10,7,6,9]); say \u0026#34;Actual sales:\u0026#34;; $actual-sales.plot; say \u0026#34;Forecast sales:\u0026#34;; $forecast-sales.plot; say \u0026#34;Actual vs Forecast:\u0026#34;; $actual-vs-forecast.plot; è¾“å‡º:\n===SORRY!=== Method 'plot' must be resolved by class combo-chart because it exists in multiple roles (line-chart, bar-chart) è§£é‡Š\nå¦‚æœå¤šä¸ª roles è¢«åº”ç”¨åˆ°åŒä¸€ä¸ªç±»ä¸­, ä¼šå‡ºç°å†²çªå¹¶æŠ›å‡ºä¸€ä¸ªç¼–è¯‘æ—¶é”™è¯¯ã€‚ è¿™æ˜¯æ¯”å¤šé‡ç»§æ‰¿æ›´å®‰å…¨çš„æ–¹æ³•, å…¶ä¸­å†²çªä¸è¢«è®¤ä¸ºæ˜¯é”™è¯¯å¹¶ä¸”ç®€å•åœ°åœ¨è¿è¡Œæ—¶è§£å†³ã€‚ Roles ä¼šæé†’ä½ æœ‰å†²çªã€‚\nå†…çœ ã€€å†…çœæ˜¯è·å–è¯¸å¦‚å¯¹è±¡çš„ç±»å‹ã€å±æ€§æˆ–æ–¹æ³•ç­‰å¯¹è±¡å±æ€§çš„ä¿¡æ¯çš„è¿‡ç¨‹ã€‚\nclass Human { has Str $.name; has Int $.age; method introduce-yourself { say \u0026#39;Hi i am a human being, my name is \u0026#39; ~ self.name; } } class Employee is Human { has Str $.company; has Int $.salary; method introduce-yourself { say \u0026#39;Hi i am a employee, my name is \u0026#39; ~ self.name ~ \u0026#39;and I work at: \u0026#39; ~ self.company; } } my $john = Human.new(name =\u0026gt;\u0026#39;John\u0026#39;,age =\u0026gt; 23,); my $jane = Employee.new(name =\u0026gt;\u0026#39;Jane\u0026#39;,age =\u0026gt; 25,company =\u0026gt; \u0026#39;Acme\u0026#39;,salary =\u0026gt; 4000); say $john.WHAT; say $jane.WHAT; say $john.^attributes; say $jane.^attributes; say $john.^methods; say $jane.^methods; say $jane.^parents; if $jane ~~ Human {say \u0026#39;Jane is a Human\u0026#39;}; å†…çœä½¿ç”¨äº†:\n .WHAT è¿”å›å·²ç»åˆ›å»ºçš„å¯¹è±¡æ‰€å±çš„ç±»ã€‚ .^attributes è¿”å›ä¸€ä¸ªåŒ…å«è¯¥å¯¹è±¡æ‰€æœ‰å±æ€§çš„åˆ—è¡¨ã€‚ .^mtethods è¿”å›èƒ½åœ¨è¯¥å¯¹è±¡èº«ä¸Šè°ƒç”¨çš„æ‰€æœ‰æ–¹æ³•ã€‚ .^parents è¿”å›è¯¥å¯¹è±¡æ‰€å±ç±»çš„æ‰€æœ‰çˆ¶ç±»ã€‚ ~~ å«åšæ™ºèƒ½åŒ¹é…æ“ä½œç¬¦ã€‚å¦‚æœå¯¹è±¡æ˜¯ä»å®ƒæ‰€è¿›è¡Œæ¯”è¾ƒçš„ç±»æˆ–ä»»ä½•å®ƒç»§æ‰¿çš„ç±»åˆ›å»ºçš„, åˆ™è®¡ç®—ä¸º Trueã€‚  ç¬¬åç«  å¼‚å¸¸å¤„ç† æ•è·å¼‚å¸¸ ã€€å¼‚å¸¸æ˜¯å½“æŸäº›ä¸œè¥¿å‡ºé”™æ—¶å‘ç”Ÿåœ¨è¿è¡Œæ—¶çš„ç‰¹æ®Šè¡Œä¸ºã€‚\næˆ‘ä»¬è¯´å¼‚å¸¸è¢«æŠ›å‡ºã€‚è€ƒè™‘ä¸‹é¢è¿™ä¸ªè¿è¡Œæ­£ç¡®çš„è„šæœ¬:\nmy Str $name; $name = \u0026#34;Joanna\u0026#34;; say \u0026#34;Hello \u0026#34; ~ $name; say \u0026#34;How are you doing today?\u0026#34; è¾“å‡º:\nHello Joanna How are you doing today? ç°åœ¨è®©è¿™ä¸ªè„šæœ¬æŠ›å‡ºå¼‚å¸¸:\nmy Str $name; $name = 123; say \u0026#34;Hello \u0026#34; ~ $name; say \u0026#34;How are you doing today?\u0026#34; è¾“å‡º:\nType check failed in assignment to $name; expected Str but got Int in block \u0026lt;unit\u0026gt; at exceptions.pl6:2 ä½ åº”è¯¥çœ‹åˆ°å½“é”™è¯¯å‡ºç°æ—¶(åœ¨è¿™ä¸ªä¾‹å­ä¸­æŠŠæ•°ç»„èµ‹å€¼ç»™å­—ç¬¦ä¸²å˜é‡)ç¨‹åºä¼šåœæ­¢å¹¶ä¸”å…¶å®ƒè¡Œçš„ä»£ç ä¸ä¼šè¢«æ‰§è¡Œ, å³ä½¿å®ƒä»¬æ˜¯æ­£ç¡®çš„ã€‚\nå¼‚å¸¸å¤„ç†æ˜¯æ•è·å·²ç»æŠ›å‡ºçš„å¼‚å¸¸çš„è¿‡ç¨‹ä»¥ä½¿è„šæœ¬èƒ½ç»§ç»­å·¥ä½œã€‚\nmy Str $name; try { $name = 123; say \u0026#34;Hello \u0026#34; ~ $name; CATCH { default { say \u0026#34;Can you tell us your name again, we couldn\u0026#39;t find it in the register.\u0026#34;; } } } say \u0026#34;How are you doing today?\u0026#34;; è¾“å‡º:\nCan you tell us your name again, we couldn't find it in the register. How are you doing today? å¼‚å¸¸å¤„ç†æ˜¯ä½¿ç”¨ try-catch block å®Œæˆçš„ã€‚\ntry { # code goes in here # å¦‚æœæœ‰ä¸œè¥¿å‡ºé”™, è„šæœ¬ä¼šè¿›å…¥åˆ°ä¸‹é¢çš„ CATCH block ä¸­ # å¦‚æœä»€ä¹ˆé”™è¯¯ä¹Ÿæ²¡æœ‰, é‚£ä¹ˆ CATCH block ä¼šè¢«å¿½ç•¥ CATCH { default { # åªæœ‰æŠ›å‡ºå¼‚å¸¸æ—¶, è¿™å„¿çš„ä»£ç æ‰ä¼šè¢«æ±‚å€¼ } } } CATCH block èƒ½åƒå®šä¹‰ given block é‚£æ ·å®šä¹‰ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬èƒ½æ•è·å¹¶å¤„ç†å„ç§ä¸åŒç±»å‹çš„å¼‚å¸¸ã€‚\ntry { #code goes in here #if anything goes wrong, the script will enter the below CATCH block #if nothing goes wrong the CATCH block will be ignored CATCH { when X::AdHoc { #do something if an exception of type X::AdHoc is thrown } when X::IO { #do something if an exception of type X::IO is thrown } when X::OS { #do something if an exception of type X::OS is thrown } default { #do something if an exception is thrown and doesn\u0026#39;t belong to the above types } } } æŠ›å‡ºå¼‚å¸¸ ã€€å’Œæ•è·å¼‚å¸¸ç›¸æ¯”, Raku ä¹Ÿå…è®¸ä½ æ˜¾å¼åœ°æŠ›å‡ºå¼‚å¸¸ã€‚ æœ‰ä¸¤ç§ç±»å‹çš„å¼‚å¸¸å¯ä»¥æŠ›å‡º:\n ad-hoc å¼‚å¸¸ ç±»å‹å¼‚å¸¸  ad-hoc\nmy Int $age = 21; die \u0026#34;Error !\u0026#34;; typed\nmy Int $age = 21; X::AdHoc.new(payload =\u0026gt; \u0026#39;Error !\u0026#39;).throw; ä½¿ç”¨ die å­ä¾‹ç¨‹åé¢è·Ÿç€å¼‚å¸¸æ¶ˆæ¯æ¥æŠ›å‡º Ad-hoc å¼‚å¸¸ã€‚\nTyped å¼‚å¸¸æ˜¯å¯¹è±¡, å› æ­¤ä¸Šé¢çš„ä¾‹å­ä¸­ä½¿ç”¨äº† .new() æ„é€ å‡½æ•°ã€‚\næ‰€æœ‰ç±»å‹åŒ–çš„å¼‚å¸¸éƒ½æ˜¯ä»ç±» X å¼€å§‹, ä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­:\n X::AdHoc æ˜¯æœ€ç®€å•çš„å¼‚å¸¸ç±»å‹ X::IO è·Ÿ IO é”™è¯¯æœ‰å…³ã€‚ X::OS è·Ÿ OS é”™è¯¯æœ‰å…³ã€‚ X::Str::Numeric è·ŸæŠŠå­—ç¬¦ä¸²å¼ºåˆ¶è½¬æ¢ä¸ºæ•°å­—æœ‰å…³ã€‚   æŸ¥çœ‹å¼‚å¸¸ç±»å‹å’Œç›¸å…³æ–¹æ³•çš„å®Œæ•´åˆ—è¡¨è¯·åˆ° http://doc.raku.org/type.html å¹¶å¯¼èˆªåˆ°ä»¥ X å¼€å¤´çš„ç±»å‹ã€‚\n ç¬¬åä¸€ç«  æ­£åˆ™è¡¨è¾¾å¼ æ­£åˆ™è¡¨è¾¾å¼, æˆ– regex æ˜¯ä¸€ä¸ªç”¨äºæ¨¡å¼åŒ¹é…çš„å­—ç¬¦åºåˆ—ã€‚\nç†è§£å®ƒæœ€ç®€å•çš„ä¸€ç§æ–¹å¼æ˜¯æŠŠå®ƒçœ‹ä½œæ¨¡å¼ã€‚\nif \u0026#39;enlightenment\u0026#39; ~~ m/light / { say \u0026#34;enlightenment contains the word light\u0026#34;; } åœ¨è¿™ä¸ªä¾‹å­ä¸­, æ™ºèƒ½åŒ¹é…æ“ä½œç¬¦ ~~ ç”¨äºæ£€æŸ¥ä¸€ä¸ªå­—ç¬¦ä¸²(enlightenment)æ˜¯å¦åŒ…å«ä¸€ä¸ªå•è¯(light)ã€‚\n\u0026ldquo;Enlightenment\u0026rdquo; ä¸æ­£åˆ™è¡¨è¾¾å¼ m/ light / åŒ¹é…ã€‚\nRegex å®šä¹‰ ã€€æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼å®šä¹‰:\n /light/ m/light/ rx/light/  é™¤éæ˜¾å¼åœ°æŒ‡å®š, å¦åˆ™ç©ºç™½æ˜¯æ— å…³ç´§è¦çš„, m/light/ å’Œ m/ light / æ˜¯ç›¸åŒçš„ã€‚\nåŒ¹é…å­—ç¬¦ ã€€å­—æ¯æ•°å­—å­—ç¬¦å’Œä¸‹åˆ’çº¿ _ åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­æ˜¯æŒ‰åŸæ ·å†™å‡ºçš„ã€‚\næ‰€æœ‰å…¶å®ƒå­—ç¬¦å¿…é¡»ä½¿ç”¨åæ–œçº¿æˆ–ç”¨å¼•å·å›´èµ·æ¥ä»¥è½¬ä¹‰ã€‚\nåæ–œçº¿\nif \u0026#39;Temperature: 13\u0026#39; ~~ m/\\:/ { say \u0026#34;The string provided contains a colon :\u0026#34;; } å•å¼•å·\nif \u0026#39;Age = 13\u0026#39; ~~ m/\u0026#39;=\u0026#39;/ { say \u0026#34;The string provided contains an equal character = \u0026#34;; } åŒå¼•å·\nif \u0026#39;name@company.com\u0026#39; ~~ m/\u0026#34;@\u0026#34;/ { say \u0026#34;This is a valid email address because it contains an @ character\u0026#34;; } åŒ¹é…å­—ç¬¦ç±» ã€€å°±åƒä¹‹å‰ç« èŠ‚çœ‹åˆ°çš„, åŒ¹é…å­—ç¬¦ç±»å¾ˆæ–¹ä¾¿ã€‚\nè¯è™½è¿™ä¹ˆè¯´ï¼Œæ›´ç³»ç»Ÿçš„æ–¹æ³•æ˜¯ä½¿ç”¨ Unicode å±æ€§ã€‚\nUnicode å±æ€§é—­åˆåœ¨ \u0026lt;: \u0026gt; ä¸­ã€‚\nif \u0026#34;John123\u0026#34; ~~ /\u0026lt;:N\u0026gt;/ { say \u0026#34;Contains a number\u0026#34;; } else { say \u0026#34;Doesn\u0026#39;t contain a number\u0026#34; } if \u0026#34;John-Doe\u0026#34; ~~ /\u0026lt;:Lu\u0026gt;/ { say \u0026#34;Contains an uppercase letter\u0026#34;; } else { say \u0026#34;Doesn\u0026#39;t contain an upper case letter\u0026#34; } if \u0026#34;John-Doe\u0026#34; ~~ /\u0026lt;:Pd\u0026gt;/ { say \u0026#34;Contains a dash\u0026#34;; } else { say \u0026#34;Doesn\u0026#39;t contain a dash\u0026#34; } é€šé…ç¬¦ é€šé…ç¬¦ä¹Ÿå¯ä»¥ç”¨åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ã€‚\nç‚¹ . æ„å‘³ç€ä»»ä½•å•ä¸ªå­—ç¬¦ã€‚\nif \u0026#39;abc\u0026#39; ~~ m/a.c / { say \u0026#34;Match\u0026#34;; } if \u0026#39;a2c\u0026#39; ~~ m/a.c / { say \u0026#34;Match\u0026#34;; } if \u0026#39;ac\u0026#39; ~~ m/a.c / { say \u0026#34;Match\u0026#34;; } else { say \u0026#34;No Match\u0026#34;; } é‡è¯ ã€€é‡è¯åœ¨å­—ç¬¦åé¢ç”¨äºæŒ‡å®šæˆ‘ä»¬æœŸæœ›åŒ¹é…å®ƒå‰é¢çš„ä¸œè¥¿çš„æ¬¡æ•°ã€‚\né—®å· ? æ„æ€æ˜¯ 0 æˆ– 1 æ¬¡ã€‚\nif \u0026#39;ac\u0026#39; ~~ m/a?c / { say \u0026#34;Match\u0026#34;; } else { say \u0026#34;No Match\u0026#34;; } if \u0026#39;c\u0026#39; ~~ m/a?c / { say \u0026#34;Match\u0026#34;; } else { say \u0026#34;No Match\u0026#34;; } æ˜Ÿå· * æ„æ€æ˜¯ 0 æˆ–å¤šæ¬¡ã€‚\nif \u0026#39;az\u0026#39; ~~ m/a*z / { say \u0026#34;Match\u0026#34;; } else { say \u0026#34;No Match\u0026#34;; } if \u0026#39;aaz\u0026#39; ~~ m/a*z / { say \u0026#34;Match\u0026#34;; } else { say \u0026#34;No Match\u0026#34;; } if \u0026#39;aaaaaaaaaaz\u0026#39; ~~ m/a*z / { say \u0026#34;Match\u0026#34;; } else { say \u0026#34;No Match\u0026#34;; } if \u0026#39;z\u0026#39; ~~ m/a*z / { say \u0026#34;Match\u0026#34;; } else { say \u0026#34;No Match\u0026#34;; } + æ„æ€æ˜¯è‡³å°‘åŒ¹é… 1 æ¬¡ã€‚\nif \u0026#39;az\u0026#39; ~~ m/a+z / { say \u0026#34;Match\u0026#34;; } else { say \u0026#34;No Match\u0026#34;; } if \u0026#39;aaz\u0026#39; ~~ m/a+z / { say \u0026#34;Match\u0026#34;; } else { say \u0026#34;No Match\u0026#34;; } if \u0026#39;aaaaaaaaaaz\u0026#39; ~~ m/a+z / { say \u0026#34;Match\u0026#34;; } else { say \u0026#34;No Match\u0026#34;; } if \u0026#39;z\u0026#39; ~~ m/a+z / { say \u0026#34;Match\u0026#34;; } else { say \u0026#34;No Match\u0026#34;; } åŒ¹é…ç»“æœ ã€€å½“åŒ¹é…å­—ç¬¦ä¸²çš„æ­£åˆ™è¡¨è¾¾å¼æˆåŠŸæ—¶, åŒ¹é…ç»“æœè¢«å­˜å‚¨åœ¨ä¸€ä¸ªç‰¹æ®Šçš„å˜é‡ $/ ä¸­ã€‚\nè„šæœ¬\nif \u0026#39;Rakudo is a Raku compiler\u0026#39; ~~ m/:sRaku/ { say \u0026#34;The match is: \u0026#34; ~ $/; say \u0026#34;The string before the match is: \u0026#34; ~ $/.prematch; say \u0026#34;The string after the match is: \u0026#34; ~ $/.postmatch; say \u0026#34;The matching string starts at position: \u0026#34; ~ $/.from; say \u0026#34;The matching string ends at position: \u0026#34; ~ $/.to; } è¾“å‡º\nThe match is: Raku The string before the match is: Rakudo is a The string after the match is: compiler The matching string starts at position: 12 The matching string ends at position: 18 è§£é‡Š\n$/ è¿”å›ä¸€ä¸ª Match Object(åŒ¹é… regex çš„å­—ç¬¦ä¸²)ã€‚\nä¸‹é¢çš„æ–¹æ³•å¯ä»¥åœ¨ Match Object èº«ä¸Šè°ƒç”¨:\n .prematch è¿”å›åŒ¹é…å‰é¢çš„å­—ç¬¦ä¸² .postmatch è¿”å›åŒ¹é…åé¢çš„å­—ç¬¦ä¸² .from è¿”å›åŒ¹é…çš„å¼€å§‹ä½ç½® .to è¿”å›åŒ¹é…çš„ç»“æŸä½ç½®   é»˜è®¤åœ°ç©ºç™½åœ¨ regex ä¸­æ˜¯æ— å…³ç´§è¦çš„ã€‚ å¦‚æœæˆ‘ä»¬æƒ³åœ¨ regex ä¸­åŒ…å«ç©ºç™½, æˆ‘ä»¬å¿…é¡»æ˜¾å¼åœ°è¿™æ ·åšã€‚ regex m/:s Raku/ ä¸­çš„ :s å¼ºåˆ¶è€ƒè™‘ç©ºç™½å¹¶ä¸”ä¸ä¼šè¢«åˆ é™¤ã€‚ äºŒé€‰ä¸€, æˆ‘ä»¬èƒ½æŠŠ regex å†™ä¸º m/Perl\\s6/ å¹¶ä½¿ç”¨ \\s å ä½ç¬¦ã€‚ å¦‚æœ regex ä¸­åŒ…å«çš„ç©ºç™½ä¸æ­¢ä¸€ä¸ª, ä½¿ç”¨ :s æ¯”ä½¿ç”¨ \\s æ›´é«˜æ•ˆã€‚\n ä¾‹å­ ã€€è®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸ªé‚®ä»¶æ˜¯å¦åˆæ³•ã€‚\næˆ‘ä»¬å‡è®¾ä¸€ä¸ªåˆæ³•çš„ç”µå­é‚®ä»¶åœ°å€çš„å½¢å¼å¦‚ä¸‹:\nfirst name [dot] last name [at] company [dot] (com/org/net)\n è¿™ä¸ªä¾‹å­ä¸­ç”¨äºç”µå­é‚®ä»¶æ£€æµ‹çš„ regex ä¸æ˜¯å¾ˆå‡†ç¡®ã€‚å®ƒçš„æ ¸å¿ƒæ„å›¾æ˜¯ç”¨æ¥è§£é‡Š Raku ä¸­çš„ regex çš„åŠŸèƒ½çš„ã€‚ ä¸è¦åœ¨ç”Ÿäº§ä¸­åŸæ ·ä½¿ç”¨å®ƒã€‚\n è„šæœ¬\nmy $email = \u0026#39;john.doe@raku.org\u0026#39;; my $regex = /\u0026lt;:L\u0026gt;+\\.\u0026lt;:L\u0026gt;+\\@\u0026lt;:L+:N\u0026gt;+\\.\u0026lt;:L\u0026gt;+/; if $email ~~ $regex { say $/ ~ \u0026#34;is a valid email\u0026#34;; } else { say \u0026#34;This is not a valid email\u0026#34;; } è¾“å‡º\njohn.doe@raku.org is a valid email è§£é‡Š\n \u0026lt;:L\u0026gt; åŒ¹é…å•ä¸ªå­—ç¬¦ \u0026lt;:L\u0026gt;+ åŒ¹é…å•ä¸ªå­—ç¬¦æˆ–æ›´å¤šå­—ç¬¦ \\. åŒ¹é…å•ä¸ªç‚¹å·å­—ç¬¦ \\@ åŒ¹é…å•ä¸ª [at] ç¬¦å· \u0026lt;:L+:N\u0026gt; åŒ¹é…ä¸€ä¸ªå­—æ¯å’Œæ•°å­— \u0026lt;:L+:N\u0026gt;+ åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ¯å’Œæ•°å­—  å…¶ä¸­çš„ regex å¯ä»¥åˆ†è§£æˆå¦‚ä¸‹:\n first name \u0026lt;:L\u0026gt;+ [dot] \\. last name \u0026lt;:L\u0026gt;+ [at] \\@ company name \u0026lt;:L+:N\u0026gt;+ [dot] \\. com/org/net \u0026lt;:L\u0026gt;+  å¯é€‰åœ°, ä¸€ä¸ª regex å¯ä»¥è¢«åˆ†è§£æˆå¤šä¸ªå…·å regexesã€‚\nmy $email = \u0026#39;john.doe@raku.org\u0026#39;; my regex many-letters {\u0026lt;:L\u0026gt;+}; my regex dot {\\.}; my regex at {\\@}; my regex many-letters-numbers {\u0026lt;:L+:N\u0026gt;+}; if $email ~~ /\u0026lt;many-letters\u0026gt;\u0026lt;dot\u0026gt;\u0026lt;many-letters\u0026gt;\u0026lt;at\u0026gt;\u0026lt;many-letters-numbers\u0026gt;\u0026lt;dot\u0026gt;\u0026lt;many-letters\u0026gt;/ { say $/ ~ \u0026#34;is a valid email\u0026#34;; } else { say \u0026#34;This is not a valid email\u0026#34;; } å…·å regex æ˜¯ä½¿ç”¨ my regex regex-name { regex definition } å®šä¹‰çš„ã€‚\nå…·å regex å¯ä»¥ä½¿ç”¨ \u0026lt;regex-name\u0026gt; æ¥è°ƒç”¨ã€‚\n æ›´å¤šå…³äº regexes çš„ä¸œè¥¿, æŸ¥çœ‹ http://doc.raku.org/language/regexes\n ç¬¬åäºŒç«  Raku æ¨¡å— Rakudo è‡ªå¸¦äº† Panda è¿™ä¸ªæ¨¡å—å®‰è£…å·¥å…·ã€‚\nè¦å®‰è£…æŒ‡å®šçš„æ¨¡å—, åœ¨ç»ˆç«¯ä¸­é”®å…¥å¦‚ä¸‹å‘½ä»¤:\nzef install \u0026quot;module name\u0026quot;  Raku çš„æ¨¡å—ç›®å½•å¯ä»¥åœ¨ http://modules.raku.org/ ä¸­æ‰¾åˆ°ã€‚\n ä½¿ç”¨æ¨¡å— ã€€MD5 æ˜¯ä¸€ä¸ªå…³äºå¯†ç çš„æ•£åˆ—å‡½æ•°ï¼Œå®ƒäº§ç”Ÿä¸€ä¸ª128ä½çš„æ•£åˆ—å€¼ã€‚ MD5 æœ‰å¤šç§åŠ å¯†å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„å£ä»¤çš„åº”ç”¨ç¨‹åºã€‚å½“æ–°ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œå…¶è¯ä¹¦å¹¶ä¸å­˜å‚¨ä¸ºçº¯æ–‡æœ¬ï¼Œè€Œæ˜¯æ•£åˆ—ã€‚è¿™æ ·åšçš„ç†ç”±æ˜¯ï¼Œå¦‚æœè¯¥æ•°æ®åº“è¢«ç ´è§£ï¼Œæ”»å‡»è€…å°†ä¸èƒ½å¤ŸçŸ¥é“å£ä»¤æ˜¯ä»€ä¹ˆã€‚\næ¯”æ–¹è¯´ï¼Œä½ éœ€è¦ä¸€ä¸ªç”Ÿæˆå¯†ç çš„MD5å“ˆå¸Œä»¥å­˜å‚¨åœ¨æ•°æ®åº“ä¸­å¤‡ç”¨çš„è„šæœ¬ã€‚\nå¹¸è¿çš„æ˜¯ï¼ŒRaku å·²ç»æœ‰ä¸€ä¸ªèƒ½å®ç°MD5ç®—æ³•çš„æ¨¡å—ã€‚æˆ‘ä»¬å®‰è£…ä¸‹:\nzef install Digest::MD5\nç°åœ¨è¿è¡Œä¸‹é¢çš„è„šæœ¬:\nuse Digest::MD5; my $password = \u0026#34;password123\u0026#34;; my $hashed-password = Digest::MD5.new.md5_hex($password); say $hashed-password; ä¸ºäº†è¿è¡Œåˆ›å»ºå“ˆå¸Œçš„ md5_hex() å‡½æ•°, æˆ‘ä»¬éœ€è¦åŠ è½½éœ€è¦çš„æ¨¡å—ã€‚use å…³é”®å­—ç”¨äºåŠ è½½æ¨¡å—ã€‚\nç¬¬åä¸‰ç«  Unicode Unicode æ˜¯ç¼–ç å¹¶è¡¨ç°æ–‡æœ¬çš„æ ‡å‡†, å®ƒæ»¡è¶³äº†ä¸–ç•Œä¸Šçš„å¤§éƒ¨åˆ†ç³»ç»Ÿã€‚\nUTF-8 æ˜¯èƒ½å¤Ÿä»¥Unicodeç¼–ç æ‰€æœ‰å¯èƒ½çš„å­—ç¬¦æˆ–ä»£ç ç‚¹çš„å­—ç¬¦ç¼–ç ã€‚\nå­—ç¬¦çš„å®šä¹‰æ˜¯é€šè¿‡:\nå­—ç´ : å¯è§çš„è¡¨ç¤º\nä»£ç ç‚¹: èµ‹å€¼ç»™å­—ç¬¦çš„æ•°å­—\nä½¿ç”¨ Unicode ã€€è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä½¿ç”¨ Unicode èƒ½è¾“å‡ºä»€ä¹ˆ\nsay \u0026#34;a\u0026#34;; say \u0026#34;\\x0061\u0026#34;; say \u0026#34;\\c[LATIN SMALL LETTER A]\u0026#34;; ä¸Šé¢ 3 è¡Œå±•ç¤ºäº†æ„å»ºå­—ç¬¦çš„ä¸åŒæ–¹æ³•:\n ç›´æ¥å†™å‡ºå­—ç¬¦(å­—ç´ ) ä½¿ç”¨ \\x å’Œä»£ç ç‚¹ ä½¿ç”¨ \\c å’Œä»£ç ç‚¹åå­—  ç°åœ¨æˆ‘ä»¬æ¥è¾“å‡ºç¬‘è„¸\nsay \u0026#34;â˜º\u0026#34;; say \u0026#34;\\x263a\u0026#34;; say \u0026#34;\\c[WHITE SMILING FACE]\u0026#34;; ç»„åˆä¸¤ä¸ªä»£ç ç‚¹çš„å¦å¤–ä¸€ä¸ªä¾‹å­\nsay \u0026#34;Ã¡\u0026#34;; say \u0026#34;\\x00e1\u0026#34;; say \u0026#34;\\x0061\\x0301\u0026#34;; say \u0026#34;\\c[LATIN SMALL LETTER A WITH ACUTE]\u0026#34;; å­—æ¯ Ã¡ å¯ä»¥è¢«å†™ä¸º:\n ä½¿ç”¨å®ƒçš„å”¯ä¸€ä»£ç ç‚¹ \\x00e1 æˆ–ä½œä¸º a å’Œ é‡éŸ³ç¬¦å· \\x0061\\x0301 ä»£ç ç‚¹çš„ç»„åˆ  æœ‰äº›æ–¹æ³•å¯ä»¥ä½¿ç”¨\nsay \u0026#34;Ã¡\u0026#34;.NFC; say \u0026#34;Ã¡\u0026#34;.NFD; say \u0026#34;Ã¡\u0026#34;.uniname; è¾“å‡º\nNFC:0x\u0026lt;00e1\u0026gt; NFD:0x\u0026lt;0061 0301\u0026gt; LATIN SMALL LETTER A WITH ACUTE NFC è¿”å›å”¯ä¸€çš„ä»£ç ç‚¹ã€‚\nNFD åˆ†è§£(decompose)é‚£ä¸ªå­—ç¬¦å¹¶è¿”å›æ¯éƒ¨åˆ†çš„ä»£ç ç‚¹ã€‚\nuniname è¿”å›ä»£ç ç‚¹çš„åå­—ã€‚\nUnicode å­—ç¬¦å¯ä»¥ç”¨ä½œæ ‡è¯†ç¬¦:\nmy $Î” = 1; $Î”++; say $Î”; ç¬¬åå››ç«  å¹¶è¡Œã€å¹¶å‘å’Œå¼‚æ­¥ åœ¨æ­£å¸¸æƒ…å†µä¸‹, ç¨‹åºä¸­çš„æ‰€æœ‰ä»»åŠ¡éƒ½æ˜¯ç›¸ç»§åœ°è¿è¡Œçš„ã€‚\nè¿™å¯èƒ½ä¸æ˜¯ä¸ªäº‹å„¿é™¤éä½ æ­£å°è¯•å»åšçš„ä¸œè¥¿éœ€è¦è€—è´¹å¾ˆå¤šæ—¶é—´ã€‚\nå¾ˆè‡ªç„¶åœ°è¯´, Raku æ‹¥æœ‰èƒ½è®©ä½ å¹¶è¡Œåœ°è¿è¡Œä¸œè¥¿çš„åŠŸèƒ½ã€‚\nåœ¨è¿™ä¸ªé˜¶æ®µ, æ³¨æ„å¹¶è¡Œå¯ä»¥æ˜¯ä¸‹é¢ä¸¤ä¸ªä¸œè¥¿ä¹‹ä¸€æ˜¯å¾ˆé‡è¦çš„:\n ä»»åŠ¡å¹¶è¡ŒåŒ–: ä¸¤ä¸ª(æˆ–æ›´å¤š)ç‹¬ç«‹çš„è¡¨è¾¾å¼å¹¶è¡Œåœ°è¿è¡Œã€‚ æ•°æ®å¹¶è¡ŒåŒ–: å•ä¸ªè¡¨è¾¾å¼å¹¶è¡Œåœ°è¿­ä»£åˆ—è¡¨ä¸­çš„å…ƒç´ ã€‚  è®©æˆ‘ä»¬ä»åè€…å¼€å§‹ã€‚\næ•°æ®å¹¶è¡ŒåŒ–ã€€ ã€€my @array = (0..50000); #Array population my @result = @array.map({ is-prime $_ }); #call is-prime for each array element say now - INIT now; #Output the time it took for the script to complete è€ƒè™‘ä¸Šé¢çš„ä¾‹å­ æˆ‘ä»¬åªåšä¸€ä¸ªæ“ä½œ @array.map({is-prime $_})ã€‚is-prime å­ä¾‹ç¨‹ç›¸ç»§è¢«æ¯ä¸ªæ•°ç»„å…ƒç´ æ‰€è°ƒç”¨:\nis-prime @array[0]  ç„¶åæ˜¯ is-prime @array[1] ç„¶åæ˜¯ is-prime @array[2] ç­‰ç­‰ã€‚\nå¹¸è¿çš„æ˜¯, æˆ‘ä»¬èƒ½åŒæ—¶åœ¨å¤šä¸ªæ•°ç»„å…ƒç´ èº«ä¸Šè°ƒç”¨ is-prime å‡½æ•°:\nmy @array = (0..50000); #Array population my @result = @array.race.map({ is-prime $_ }); #call is-prime for each array element say now - INIT now; #Output the time it took to complete æ³¨æ„è¡¨è¾¾å¼ä¸­ä½¿ç”¨çš„ raceã€‚è¿™ä¸ªæ–¹æ³•ä¼šä½¿æ•°ç»„å…ƒç´ èƒ½å¤Ÿå¹¶è¡Œåœ°è¿­ä»£ã€‚\nè¿è¡Œä¸¤ä¸ªä¾‹å­(ä½¿ç”¨å’Œä¸ä½¿ç”¨ race)è¿è¡Œä¹‹å, æ¯”è¾ƒä¸¤ä¸ªè„šæœ¬è¿è¡Œç»“æŸæ‰€èŠ±è´¹çš„æ—¶é—´ã€‚\n race ä¸ä¼šä¿å­˜å…ƒç´ çš„é¡ºåºã€‚å¦‚æœä½ æƒ³é‚£æ ·åš, ä½¿ç”¨ hyper ä»£æ›¿ã€‚\nrace\nmy @array = (1..1000); my @result = @array.race.map( {$_ + 1} ); @resultÂ».say; hyper\nmy @array = (1..1000); my @result = @array.hyper.map( {$_ + 1} ); @resultÂ».say; å¦‚æœä½ ä¿©ä¸ªè„šæœ¬éƒ½è¿è¡Œäº†, ä½ åº”è¯¥æ³¨æ„åˆ°ä¸€ä¸ªæ’åºäº†ä¸€ä¸ªæ²¡æœ‰æ’åºã€‚\n ä»»åŠ¡å¹¶è¡ŒåŒ– ã€€my @array1 = (0..49999); my @array2 = (2..50001); my @result1 = @array1.map( {is-prime($_ + 1)} ); my @result2 = @array2.map( {is-prime($_ - 1)} ); say @result1 == @result2; say now - INIT now; è€ƒè™‘ä¸Šé¢çš„ä¾‹å­:\n æˆ‘ä»¬å®šä¹‰äº† 2 ä¸ªæ•°ç»„ å¯¹æ¯ä¸ªæ•°ç»„åº”ç”¨ä¸åŒçš„æ“ä½œå¹¶ä¿å­˜ç»“æœ å¹¶æ£€æŸ¥ä¸¤ä¸ªç»“æœæ˜¯å¦ç›¸åŒ  è¯¥è„šæœ¬ç­‰åˆ° @array1.map( {is-prime($_ +1)} ) å®Œæˆç„¶åè®¡ç®— @array1.map( {is-prime($_ +1)} )ã€‚\nåº”ç”¨åˆ°æ¯ä¸ªæ•°ç»„çš„ä¿©ä¸ªæ“ä½œå½¼æ­¤é—´æ²¡æœ‰ä¾èµ–ã€‚\nä¸ºä»€ä¹ˆä¸å¹¶è¡Œåœ°æ‰§è¡Œå‘¢?\nmy @array1 = (0..49999); my @array2 = (2..50001); my $promise1 = start @array1.map( {$_ + 1} ); my $promise2 = start @array2.map( {$_ - 1} ); my @result1 = await $promise1; my @result2 = await $promise2; say @result1 == @result2; say now - INIT now; è§£é‡Š\nstart æ–¹æ³•è®¡ç®—å®ƒåé¢çš„ä»£ç å¹¶è¿”å›promise ç±»å‹çš„å¯¹è±¡æˆ–promiseã€‚\nå¦‚æœä»£ç è¢«æ­£ç¡®åœ°æ±‚å€¼, é‚£ä¹ˆ promise ä¼šè¢«ä¿ç•™(kept)ã€‚\nå¦‚æœä»£ç æŠ›å‡ºå¼‚å¸¸, é‚£ä¹ˆ promise ä¼šè¢«ç ´å(broken)ã€‚\nawait æ–¹æ³•ç­‰å¾…ä¸€ä¸ª promiseã€‚\nå¦‚æœé‚£ä¸ª promise æ˜¯è¢«ä¿ç•™çš„, await ä¼šè·å–åˆ°è¿”å›å€¼ã€‚\nå¦‚æœé‚£ä¸ª promise æ˜¯è¢«ç ´åçš„, await ä¼šè·å–åˆ°æŠ›å‡ºå¼‚å¸¸ã€‚\næ£€æŸ¥æ¯ä¸ªè„šæœ¬å®Œæˆæ‰€èŠ±è´¹çš„æ—¶é—´ã€‚\n å¹¶è¡Œæ€»æ˜¯æ·»åŠ çº¿ç¨‹å¼€é”€ã€‚å¦‚æœå¼€é”€æŠµæ¶ˆä¸äº†è¿ç®—é€Ÿåº¦çš„å¢é•¿ï¼Œé‚£ä¹ˆè¯¥è„šæœ¬ä¼šæ˜¾å¾—è¾ƒæ…¢ã€‚ è¿™å°±æ˜¯ä¸ºä»€ä¹ˆï¼Œåœ¨å¾ˆç®€å•çš„è„šæœ¬ä¸­ä½¿ç”¨ raceï¼Œhyperï¼Œstart å’Œ await å®é™…ä¸Šå¯ä»¥ä½¿å®ƒä»¬æ…¢ä¸‹æ¥ã€‚\n å¹¶å‘å’Œå¼‚æ­¥ ã€€ å…³äºå¹¶å‘å’Œå¼‚æ­¥ç¼–ç¨‹çš„æ›´å¤šä¿¡æ¯, è¯·æŸ¥çœ‹ http://doc.raku.org/language/concurrency\n ç¬¬åäº”ç«  ç¤¾åŒº å¾ˆå¤šè®¨è®ºå‘ç”Ÿåœ¨ #raku IRC é¢‘é“ä¸­ã€‚ä½ å¯ä»¥åˆ° http://raku.org/community/irc è¿›è¡Œä»»ä½•è¯¢é—®ã€‚\nhttp://pl6anet.org/ æ˜¯ä¸€ä¸ª Raku åšå®¢èšåˆå™¨ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2015-12-21-raku-intro/","tags":["intro"],"title":"Raku å…¥é—¨"},{"categories":["rakulang"],"contents":"ç¬¬äºŒå¤©: ç”¨ MAIN å‡½æ•°æ§åˆ¶å‘½ä»¤è¡Œäº¤äº’ åœ¨ UNIX ç¯å¢ƒä¸‹ï¼Œå¾ˆå¤šè„šæœ¬éƒ½æ˜¯è¦ä»å‘½ä»¤è¡Œé‡Œè·å–è¿è¡Œå‚æ•°çš„ã€‚åœ¨ Raku ä¸­å®ç°è¿™ä¸ªç›¸å½“ç®€å•ã€‚æ¯”å¦‚ä¸‹é¢è¿™æ ·ï¼š\n$ cat add.pl sub MAIN ($x, $y) { say $x + $y } $ raku add.pl 3 4 7 $ raku add.pl too many arguments Usage: add.pl x y åªè¦å®šä¹‰ä¸€ä¸ªå¸¦å‘½åå˜é‡çš„ MAIN å‡½æ•°ï¼Œä½ å°±å¯ä»¥è·å¾—ä¸€ä¸ªå‘½ä»¤è¡Œåˆ†æå™¨ã€‚ç„¶åå‘½ä»¤è¡Œå‚æ•°å°±è¢«è‡ªåŠ¨ç»‘å®šåˆ° $x å’Œ $y ä¸Šäº†ã€‚å¦‚æœä¸åŒ¹é…ï¼Œè¿˜æœ‰æ¸©é¦¨çš„ Usage æç¤ºã€‚\nå½“ç„¶ï¼Œä½ å¯èƒ½æ›´å–œæ¬¢è‡ªå·±å®šåˆ¶ Usage ä¿¡æ¯ã€‚é‚£ä¹ˆè‡ªå·±åŠ¨æ‰‹ï¼Œç¼–å†™ USAGE å‡½æ•°å¥½äº†ï¼š\n$ cat add2.pl sub MAIN($x, $y) { say $x + $y } sub USAGE () { say \u0026#34;Usage: add.pl \u0026lt;num1\u0026gt; \u0026lt;num2\u0026gt;\u0026#34;; } $ raku add2.pl too many arguments Usage: add.pl \u0026lt;num1\u0026gt; \u0026lt;num2\u0026gt; æ›´è¿›ä¸€æ­¥çš„ï¼Œä½ å¯ä»¥ç”¨ multi æŒ‡ä»¤å£°æ˜å¤šä¸ª MAIN å‡½æ•°ä»¥å®Œæˆä¸€ç§å¯æ›¿ä»£çš„è¯­æ³•ï¼Œæˆ–è€…æ ¹æ®æŸäº›å¸¸é‡åšå‡ºä¸åŒååº”ï¼Œæ¯”å¦‚ï¼š\n$ cat calc #!/usr/bin/env raku multi MAIN(\u0026#39;add\u0026#39;, $x, $y) { say $x + $y } multi MAIN(\u0026#39;div\u0026#39;, $x, $y) { say $x / $y } multi MAIN(\u0026#39;mult\u0026#39;, $x, $y) { say $x * $y } $ ./calc add 3 5 8 $ ./calc mult 3 5 15 $ ./calc Usage: ./calc add x y or ./calc div x y or ./calc mult x y è¿˜æœ‰å‘½åå‚æ•°å¯¹åº”ä¸åŒçš„é€‰é¡¹çš„æƒ…å†µï¼š\n$ cat copy.pl sub MAIN($source, $target, Bool :$verbose) { say \u0026#34;Copying \u0026#39;$source\u0026#39; to \u0026#39;$target\u0026#39;\u0026#34; if $verbose; run \u0026#34;cp $source$target\u0026#34;; } $ raku copy.pl calc calc2 $ raku copy.pl --verbose calc calc2 Copying \u0026#39;calc\u0026#39; to \u0026#39;calc2\u0026#39; è¿™é‡Œç”³æ˜å˜é‡ $verbose ç±»å‹ä¸º Boolï¼Œä¹Ÿå°±æ˜¯ä¸æ¥å—èµ‹å€¼ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªç±»å‹çº¦æŸçš„è¯ï¼Œå®ƒæ˜¯éœ€è¦èµ‹å€¼çš„ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š\n$ cat do-nothing.pl sub MAIN(:$how = \u0026#39;fast\u0026#39;) { say \u0026#34;Do nothing, but do it $how\u0026#34;; } $ raku do-nothing.pl Do nothing, but do it fast $ raku do-nothing.pl --how=well Do nothing, but do it well $ raku do-nothing.pl what? Usage: do-nothing.pl [--how=value-of-how] æ€»ä¹‹ï¼ŒRaku æä¾›äº†å†…ç½®çš„å‘½ä»¤è¡Œè§£æåŠŸèƒ½å’Œä½¿ç”¨å¸®åŠ©è¯´æ˜ï¼Œä½ åªè¦å£°æ˜å¥½å‡½æ•°å°±è¡Œäº†ã€‚\næ–‡ä»¶æ“ä½œ  ç›®å½•  ä¸å†ç”¨ opendir å’Œå…¶ä»–ç¥é©¬æ»´ï¼ŒRaku ä¸­æœ‰ä¸“é—¨çš„ dir å‡½æ•°ï¼Œç”¨æ¥åˆ—å‡ºæŒ‡å®šç›®å½•ï¼ˆé»˜è®¤æ˜¯å½“å‰æ‰€åœ¨ç›®å½•ï¼‰ä¸‹æ‰€æœ‰çš„æ–‡ä»¶ã€‚å¥½äº†ï¼Œç›´æ¥è´´ä»£ç ï¼š\ndir dir \u0026#39;t\u0026#39; # t ç›®å½•ä¸‹çš„æ–‡ä»¶ dir è¿˜æœ‰ä¸€ä¸ªå¯é€‰çš„å‘½åå‚æ•° testï¼Œç”¨æ¥ grep ç»“æœï¼Œè¿™æ ·ï¼š\ndir \u0026#39;src/core\u0026#39;, test =\u0026gt; any(/^C/, /^P/) åˆ›å»ºç›®å½•ï¼Œè¿˜æ˜¯ mkdir å‡½æ•°æ²¡é”™å•¦ã€‚\n æ–‡ä»¶  æœ€ç®€å•çš„è¯»å–æ–‡ä»¶çš„åŠæ³•ï¼Œæ˜¯ç›´æ¥ä½¿ç”¨ slurp å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä»¥æ ‡é‡å½¢å¼è¿”å›æ–‡ä»¶çš„å†…å®¹ï¼Œè¿™æ ·ï¼š\nslurp \u0026#39;VERSION\u0026#39; å½“ç„¶åŸå§‹çš„æ–‡ä»¶å¥æŸ„æ–¹å¼è¿˜æ˜¯æœ‰æ•ˆçš„ï¼Œè¿™æ ·ï¼š\nmy $fh = open \u0026#39;CREDITS\u0026#39; $fh.getc #è¯»å–ä¸€ä¸ªå­—ç¬¦ $fh.get #è¯»å–ä¸€è¡Œï¼ˆè¯‘è€…æ³¨ï¼šè¿™ä¸¤çœ‹èµ·æ¥å¥½æœ‰ C è¯­è¨€çš„èµ¶è„šå•Šï¼‰ $fh.close; $fh = open \u0026#39;new\u0026#39;, :w # ä»¥å¯å†™æ–¹å¼æ‰“å¼€ $fh.print(\u0026#39;foo\u0026#39;) $fh.say(\u0026#39;bar\u0026#39;) $fh.close; say slurp(\u0026#39;new\u0026#39;)  æ–‡ä»¶æµ‹è¯•  å¦‚æœè¦æµ‹è¯•æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä»¥åŠæ–‡ä»¶çš„å…·ä½“ç±»å‹ï¼Œç›´æ¥ä½¿ç”¨ ~~ æ“ä½œç¬¦å°±æå®šäº†ï¼Œè¿˜æ˜¯ç”¨ä»£ç è¯´è¯ï¼š\n\u0026#39;LICENSE\u0026#39;.IO ~~ :e # æ–‡ä»¶(å¹¿ä¹‰çš„)æ˜¯å¦å­˜åœ¨ \u0026#39;LICENSE\u0026#39;.IO ~~ :d # é‚£ä¹ˆä»–æ˜¯ç›®å½•ä¹ˆï¼Ÿ \u0026#39;LICENSE\u0026#39;.IO ~~ :f # é‚£ä¹ˆæ˜¯æ–‡ä»¶ä¹ˆ(ç‹­ä¹‰çš„)ï¼Ÿ  File::Find  å¦‚æœè¿™äº›ä¸ªæ ‡å‡†ç‰¹æ€§è¿˜ä¸å¤Ÿï¼Œé‚£æ¨¡å—å°±æ´¾ä¸Šç”¨åœºäº†ã€‚File::Tools åŒ…é‡Œçš„ File::Find æ¨¡å—å¯ä»¥é€’å½’ä½ æŒ‡å®šçš„ç›®å½•æ‰¾ä½ è¦çš„ä¸œè¥¿ç„¶ååˆ—å‡ºæ¥ã€‚è¿™ä¸ªæ¨¡å—åº”è¯¥æ˜¯è·Ÿç€ Rakudo Star ä¸€èµ·æ‰“åŒ…äº†ï¼Œå¦‚æœä½ åªè£¸è£…äº† Rakudoï¼Œé‚£ä¹ˆç”¨ neutro å‘½ä»¤å®‰è£…ä¹Ÿæ˜¯æŒºæ–¹ä¾¿çš„ã€‚\né¢ï¼Œè¿˜æ˜¯è¦ä¾‹å­ï¼Ÿå¥½å§~å¾ˆç®€å•çš„ä¸€è¡Œ find(:dir, :type, :name(/foo/))ï¼Œè¿™å°±ä¼šåœ¨ t/dir1 ç›®å½•ä¸‹ï¼Œå¯»æ‰¾åå­—åŒ¹é… foo çš„æ–‡ä»¶ï¼Œç„¶åä»¥æ ‘çš„å½¢å¼åˆ—å‡ºæ¥~ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼šè¿™å‘½ä»¤çš„è¿”å›å¯ä¸æ˜¯æ–‡æœ¬æ ‡é‡ï¼Œè€Œæ˜¯ä¸€ä¸ªä¸ªåŒ…æ‹¬ä»–ä»¬çš„å®Œæ•´è·¯å¾„åœ¨å†…çš„å¯¹è±¡ï¼Œè€Œä¸”è¿˜æä¾›æ–‡ä»¶æœ¬èº«ä»¥åŠæ–‡ä»¶æ‰€åœ¨ç›®å½•çš„è®¿é—®å™¨ï¼æ›´å¤šä¿¡æ¯ï¼Œç›´æ¥çœ‹æ–‡æ¡£å§ã€‚\n1ã€åˆ›å»ºæ–°æ–‡ä»¶\nopen(\u0026#39;new\u0026#39;, :w).close 2ã€åŒ¿åæ–‡ä»¶å¥æŸ„\ngiven open(\u0026#39;foo\u0026#39;, :w) { .say(\u0026#39;Hello, world!\u0026#39;); .close } ç¬¬å››å¤© â€“ åºåˆ—æ“ä½œç¬¦ å»å¹´ï¼Œæœ‰ä¸€ä¸ªåºåˆ—æ“ä½œç¬¦çš„ç®€è¦æ¢³ç†ï¼š\nmy @even-numbers := 0, 2 ... *; # ç®—æœ¯åºåˆ— my @odd-numbers := 1, 3 ... *; my @powers-of-two := 1, 2, 4 ... *; # å‡ ä½•åºåˆ— è¿™äº›ç°åœ¨åœ¨ Rakudo é‡Œé¢å®ç°äº†ï¼š\nmy @powers-of-two := 1, 2, 4 ... *; @powers-of-two[^10]; # 1 2 4 8 16 32 64 128 256 512 æˆ‘ä»¬éœ€è¦å‰Šå‡è¿™ä¸ªæ— é™åˆ—è¡¨è®© Rakudo ä¸ä¼šèŠ±è´¹æ— é™é•¿çš„æ—¶é—´æ¥è®¡ç®—å®ƒã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä½¿ç”¨ [^10], è¿™å…¶å®æ˜¯è¯´ \u0026ldquo;ç»™æˆ‘å‰ 10 ä¸ªå…ƒç´ \u0026rdquo;ã€‚æ³¨æ„ï¼Œå½“ä½ æŠŠä¸€ä¸ªæƒ°æ€§åˆ—è¡¨ç»‘å®šåˆ°ä¸€ä¸ªæ•°ç»„å˜é‡ä¸Šæ—¶ï¼Œè¢«è®¡ç®—è¿‡çš„å€¼æ˜¯ä¼šè¢«è®°å¿†çš„ï¼Œè¿™æ˜¯ä¸€ç§å¿«æ·çš„ç¼“å­˜ã€‚\nåºåˆ—æ“ä½œç¬¦ ... æ˜¯ä¸€ä¸ªç”Ÿæˆæƒ°æ€§åˆ—è¡¨çš„å¼ºå¤§å·¥å…·ã€‚ä¸Šé¢çš„ä¾‹å­ä»…ä»…æš—ç¤ºäº†å®ƒèƒ½åšä»€ä¹ˆã€‚ç»™å®šä¸€ä¸ªæ•°å­—ï¼Œå®ƒå°±ä»è¿™ä¸ªæ•°å­—å¼€å§‹å¾€ä¸‹è®¡æ•°ï¼ˆé™¤éåºåˆ—çš„ç»ˆç‚¹æ˜¯ä¸€ä¸ªæ›´å°çš„æ•°å­—ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä¼šå€’æ•°ã€‚\n1 ... 10; # 1 2 3 4 5 6 7 8 9 10 5 ... 1; # 5 4 3 2 1 ç»™å®šä¸¤ä¸ªæ•°å­—æ¥å¼€å§‹ä¸€ä¸ªåºåˆ—ï¼Œå®ƒä¼šæŠŠè¿™å½“ä½œä¸€ä¸ªç®—æœ¯åºåˆ—ï¼ŒæŠŠå‰ä¸¤ä¸ªå…ƒç´ çš„å·®å¼‚æ·»åŠ åˆ°æœ€åä¸€ä¸ªç”Ÿæˆçš„å…ƒç´ ä¸Šæ¥äº§ç”Ÿä¸‹ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœç»™å®šä¸‰ä¸ªå…ƒç´ ï¼Œå®ƒä¼šæ£€æŸ¥å®ƒä»¬æ˜¯å¦ä»£è¡¨ä¸€ä¸ªç®—æœ¯åºåˆ—çš„å¼€å§‹æˆ–è€…å®ƒæ˜¯å¦æ˜¯ä¸€ä¸ªå‡ ä½•åºåˆ—ï¼Œç„¶åç»§ç»­è¿™ä¸ªåºåˆ—ã€‚\nå½“ç„¶ï¼Œå¾ˆå¤šæœ‰è¶£çš„åºåˆ—æ—¢éç®—æœ¯åºåˆ—ä¹Ÿéå‡ ä½•åºåˆ—ï¼Œè¿™æ—¶ï¼Œä½ éœ€è¦æ˜¾å¼åœ°æä¾›ä¸€ä¸ª sub æ¥ç”Ÿæˆåºåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªæ•°ï¼š\nmy @Fibonacci := 0, 1, -\u0026gt; $a, $b { $a + $b } ... *; @Fibonacci[^10]; # 0 1 1 2 3 5 8 13 21 34 ä¸Šé¢çš„ -\u0026gt; $a, $b { $a + $b } æ˜¯ä¸€ä¸ª pointy block (æˆ–è€…æ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°)ï¼Œå®ƒå¸¦æœ‰ 2 ä¸ªå‚æ•°å¹¶è¿”å›å®ƒä»¬çš„å’Œã€‚è¿™ä¸ªåºåˆ—æ“ä½œç¬¦è®¡ç®—å‡ºè¯¥ block æœ‰å¤šå°‘ä¸ªå‚æ•°ï¼Œç„¶åä»å½“å‰åºåˆ—çš„æœ«å°¾ä¼ é€’æ‰€éœ€çš„å‚æ•°æ¥ç”Ÿæˆåºåˆ—çš„ä¸‹ä¸€ä¸ªæ•°å­—ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå¾ªç¯ä¸‹å»ã€‚\næˆ–è€…ä¹Ÿå¯ä»¥ä¸­æ–­å¾ªç¯ï¼Œç›®å‰ä¸ºæ­¢ï¼Œæ‰€æœ‰çš„ä¾‹å­éƒ½æœ‰ä¸€ä¸ªæ˜Ÿå· * æ”¾åœ¨å³è¾¹ï¼Œå®ƒæ„å‘³ç€â€œæ²¡æœ‰ç»ˆæ­¢æ¡ä»¶â€ã€‚å¦‚æœä½ åè€Œåœ¨é‚£é‡Œæ”¾ä¸Šä¸€ä¸ªæ•°å­—ï¼Œè¿™ä¸ªåˆ—è¡¨å°±ä¼šç»ˆæ­¢åœ¨é‚£ä¸ªæ•°å­—ã€‚\n1, 1.1 ... 2; # 1 1.1 1.2 1.3 1.4 1.5 1.6 1.7 1.8 1.9 2 1, 1.1 ... 2.01; # 1 1.1 1.2 1.3 1.4 1.5 1.6 1.7 1.8 1.9 2 (1, 1.1 ... 2.01)[^14] # (1 1.1 1.2 1.3 1.4 1.5 1.6 1.7 1.8 1.9 2 Nil Nil Nil) ç¬¬ä¸€ä¸ªåˆ—è¡¨å¾ˆè‡ªç„¶åœ°ç»ˆæ­¢äº†ï¼Œä½†æ˜¯ç¬¬äºŒä¸ªåˆ—è¡¨æ¼æ‰äº†ç»ˆæ­¢æ•°ï¼Œå®ƒä¼šå¾ªç¯ä¸‹å»ã€‚ç»“æœå°±æ˜¯ä¸€ä¸ªæ— é™åˆ—è¡¨ï¼Œæ‰€ä»¥æˆ‘æŠŠå®ƒé™åˆ¶åˆ°å‰ 14 ä¸ªå…ƒç´ ï¼Œä»¥è‡³äºæˆ‘ä»¬èƒ½æ˜ç™½å®ƒæ­£åœ¨åšä»€ä¹ˆã€‚\né‚£äº›æœ‰åšæµ®ç‚¹æ•°å­¦èƒŒæ™¯çš„äººå¯èƒ½ä¼šæ°”æ€¥è´¥ååœ°è¯´åå¤å¢åŠ  0.1 ç›´åˆ°ç²¾ç¡®åˆ° 2 ä¸ºæ­¢å¾ˆå±é™©ã€‚\nåœ¨ Raku ä¸­ï¼Œæ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºå®ƒä¼šåœ¨å¯èƒ½çš„åœ°æ–¹ä½¿ç”¨æœ‰ç†æ•°ï¼ˆä¾‹å¦‚.åˆ†æ•°)ã€‚å¦‚æœæˆ‘æƒ³æ‰¾å‡ºæ‰€æœ‰ 10000 ä»¥ä¸‹çš„æ–æ³¢çº³å¥‘æ•°ï¼Œè¦æ‰¾åˆ°åˆ°ä½•å¤„åœæ­¢çš„é‚£ä¸ªç²¾ç¡®çš„æ•°å­—æ˜¯å¾ˆå¤§çš„é—®é¢˜ã€‚å¹¸è¿çš„æ˜¯ï¼Œå°±åƒä½ èƒ½ä½¿ç”¨å—æ¥æŒ‡å®šæ€æ ·ç”Ÿæˆåºåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ä¸€æ ·ï¼Œä½ å¯ä»¥ä½¿ç”¨å—æ¥æµ‹è¯•åºåˆ—æ˜¯å¦ç»“æŸï¼š\n0, 1, -\u0026gt; $a, $b { $a + $b } ... -\u0026gt; $a { $a \u0026gt; 10000 }; # 0 1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 1597 2584 4181 6765 10946 å°–å¤´å— -\u0026gt; $a { $a \u0026gt; 10000 } åˆ›å»ºäº†ä¸€ä¸ªå«æœ‰ä¸€ä¸ªå‚æ•°çš„å—ï¼Œå¹¶ä¸”å½“å‚æ•°å¤§äº 10000 æ—¶è¿”å›çœŸï¼›è¿™å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„æµ‹è¯•ã€‚\né™¤äº†æˆ‘ä»¬æ‰€æœŸå¾…çš„æ‰€æœ‰æ–æ³¢é‚£å¥‘æ•°å°äº 10000ã€‚ æˆ‘ä»¬ç”Ÿæˆçš„è£´æ³¢çº³å¥‘æ•°æœ‰ä¸€ä¸ªå¤§äº 10000 çš„ï¼Œå½“ä¼ é€’ä¸€ä¸ªå—ä½œä¸ºç»ˆæ­¢æµ‹è¯•æ—¶ï¼Œè¯¥åºåˆ—æ“ä½œç¬¦æ‰€æœ‰çš„å…ƒç´ ç›´åˆ°é‚£ä¸ªå—è¿”å›çœŸä¸ºæ­¢ï¼Œç„¶åå®ƒè¿”å›æœ€åä¸€ä¸ªå…ƒç´ ï¼Œç„¶ååœæ­¢ã€‚ä½†æ˜¯æœ‰ä¸€ç§æ›¿ä»£å½¢å¼çš„æ“ä½œç¬¦èƒ½åšåŒæ ·çš„äº‹æƒ…ï¼š\n0, 1, -\u0026gt; $a, $b { $a + $b } ...^ -\u0026gt; $a { $a \u0026gt; 10000 }; # 0 1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 1597 2584 4181 6765 ä» ... è½¬æ¢ä¸º ...^ æ„å‘³ç€ç»“æœåˆ—è¡¨ä¸åŒ…å«è®©ç»ˆæ­¢æµ‹è¯•è¿”å›çœŸæ—¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚\nåœ¨ Raku ä¸­è¿™çœŸæ˜¯ä¸€ç§å†—é•¿çš„æŒ‡å®šåºåˆ—çš„æ–¹æ³•ã€‚åœ¨è¿™é‡Œæˆ‘æ²¡æœ‰åœ°æ–¹è§£é‡Šæ‰€è°“çš„é—­åŒ…ï¼Œä½†æ˜¯å»å¹´çš„æ–‡ç« å·²ç»è¯´è¿‡å®ƒä»¬ã€‚ä½¿ç”¨é—­åŒ…ï¼Œä½ å¯ä»¥å°†ä¸Šä¸€ä¸ªåºåˆ—å†™ä¸ºï¼š\n0, 1, * + * ...^ * \u0026gt; 10000; # 0 1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 1597 2584 4181 6765 è¿™æ ·å†™æ˜¯å¦æ¸…æ™°å®Œå…¨å–å†³äºä½ ï¼Œæ¡æ¡å¤§è·¯é€šç½—é©¬ã€‚å¹¶ä¸”ï¼Œåºåˆ—æ“ä½œç¬¦çš„å·¦ä¾§å¯ä»¥æ˜¯ä»»ä½•åˆ—è¡¨ï¼Œç”šè‡³æ˜¯æƒ°æ€§çš„ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥å¾ˆå®¹æ˜“çš„ä½¿ç”¨ä¸€ä¸ªç»ˆæ­¢å—æ¥å¾—åˆ°å·²å­˜åœ¨çš„æƒ°æ€§åˆ—è¡¨çš„æœ‰é™çš„ä¸€éƒ¨åˆ†ï¼š\nmy @Fibonacci := 0, 1, * + * ... *; @Fibonacci ...^ * \u0026gt; 10000; # 0 1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 1597 2584 4181 6765 say @Fibonacci[30]; # 832040 (æˆ‘åšæŒæœ€åçš„æ£€æŸ¥åªæ˜¯ä¸ºäº†è¯´æ˜ @Fibonacci åœ¨è¶…è¿‡ 10000 ä¹‹åä¾ç„¶ä¼šç»§ç»­ã€‚\nè¿™æ‰è§¦åŠåˆ°åºåˆ—èƒ½åšä»€ä¹ˆçš„çš®æ¯›ï¼Œæ›´å¤šçš„ä¿¡æ¯ï¼ŒæŸ¥çœ‹ç»†åˆ™ä¸­çš„ â€œList infix precedenceâ€ï¼Œç„¶åä¸‹æ‹‰åˆ°åºåˆ—æ“ä½œç¬¦ï¼ˆå°½ç®¡å¦‚æ­¤ï¼Œæ³¨æ„è¿™è¿˜æ²¡æœ‰å…¨éƒ¨å®ç°ï¼å®ƒæ˜¯ä¸€ä¸ªæå…¶å¤æ‚çš„æ“ä½œç¬¦ã€‚ï¼‰\næˆ‘è¿˜è¦å‘Šè¯‰ä½ çš„æ˜¯ï¼Œåºåˆ—æ“ä½œç¬¦ä¸å±€é™äºå·¥ä½œäºæ•°å­—ï¼Œå¦‚æœä½ æ˜¾å¼åœ°æŒ‡å®šäº†ä½ è‡ªå·±çš„ç”Ÿæˆå™¨ï¼Œä½ å¯ä»¥ç”Ÿæˆä»»ä½•ç±»å‹çš„åºåˆ—ã€‚ä½†æ˜¯æˆ‘å–œæ¬¢å°†è¿™ä¿ç•™åˆ°æœªæ¥çš„åœ£è¯èŠ‚ç¤¼ç‰©ã€‚\nç¬¬äº”å¤© â€“ ä¸ºä»€ä¹ˆ Raku è¯­æ³•æ˜¯ä½ æƒ³è¦çš„ åœ£ä¸´æœˆç¬¬äº”å¤©ï¼Œæ‚¨æˆ–è®¸æœ‰äº›å¤±æœ›æ²¡èƒ½çœ‹åˆ° Raku é…·å‘†äº†çš„æ–°ç©æ³•ã€‚è¿™æ¬¡ä¼šæ˜¯ç›´è§‚çš„è§£é‡Šä¸€äº›ç¼–ç¨‹è¯­è¨€çš„è¿è¡ŒåŸç†ã€‚ ä½œä¸ºæ ·ä¾‹ï¼Œå…ˆè¯´ä¸‹é¢è¿™ä¸¤è¡Œå§ï¼š\nsay 6 / 3; say \u0026#39;Price: 15 Euro\u0026#39; ~~ /\\d+/; å—¯ï¼Œä¸¤è¡Œä»£ç çš„è¿è¡Œç»“æœåˆ†åˆ«æ˜¯ 2 å’Œ 15ã€‚ç›¸ä¿¡è¿™å¯¹ Raku ç¨‹åºå‘˜æ¥è¯´æ²¡ä»€ä¹ˆå¯å¥‡æ€ªçš„ã€‚ä½†ä½ å†ç»†çœ‹çœ‹ï¼Œä¸¤è¡Œéƒ½æœ‰æ–œæ  /ï¼Œå´ä¸ºäº†å®Œå…¨ä¸ä¸€æ ·çš„ç›®çš„ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ•°å€¼è¿ç®—ï¼Œç¬¬äºŒ ä¸ªæ˜¯æ­£åˆ™åŒ¹é…ã€‚\nRaku æ€ä¹ˆçŸ¥é“ä¸€ä¸ª / å·æ„å‘³ç€ä»€ä¹ˆï¼Ÿè¿™å½“ç„¶ä¸æ˜¯ç®€å•çš„çœ‹ / å·åé¢çš„æ–‡æœ¬æ¥å†³å®šï¼Œå› ä¸ºæ­£åˆ™è¡¨è¾¾å¼å¯ä»¥çœ‹èµ·æ¥è·Ÿæ™®é€šä»£ç ä¸€æ ·ã€‚ ç­”æ¡ˆæ˜¯ï¼šRaku ä¼šæŒç»­è·Ÿè¸ªä»–çš„é¢„æœŸã€‚Raku é¢„æœŸä¸­æœ€é‡è¦çš„ä¸¤æ ·ä¸œè¥¿å°±æ˜¯ï¼šè¯å’Œæ“ä½œç¬¦ã€‚\nä¸€ä¸ªè¯å¯ä»¥æ˜¯åƒ 23 æˆ–è€… str è¿™æ ·çš„æ–‡å­—ã€‚å½“è§£é‡Šå™¨å‘ç°è¿™æ ·ä¸€ä¸ªæ–‡å­—ï¼Œç„¶ååé¢å°±ä¼šæ˜¯ä¸€ä¸ªè¯­å¥çš„ç»“æŸï¼ˆå³åˆ†å·;ï¼‰ï¼Œæˆ–è€…ä¸€ä¸ªæ“ä½œç¬¦åƒ +/* ç­‰ç­‰ã€‚è¿‡äº†è¿™ä¸ªæ“ä½œç¬¦ï¼Œè§£ é‡Šå™¨åˆå¼€å§‹é¢„æœŸä¸‹ä¸€ä¸ªè¯ã€‚\nå…¶å®è¿™å°±æ˜¯é—®é¢˜çš„ç­”æ¡ˆäº†ï¼šå½“è§£é‡Šå™¨é¢„æœŸä¸ºè¯çš„æ—¶å€™ï¼Œæ–œçº¿ / å°±ä»£è¡¨æ­£åˆ™è¡¨è¾¾å¼çš„å¼€å§‹ï¼›å½“é¢„æœŸä¸ºæ“ä½œç¬¦çš„æ—¶å€™ï¼Œæ–œçº¿ / å°±ä»£è¡¨æ•°å­—çš„é™¤æ³•è¿ç®—ã€‚\nè¿™ç§åšæ³•é€ æˆäº†æ·±è¿œçš„åæœã€‚å­å‡½æ•°è¿è¡Œå¯ä»¥ä¸åŠ æ‹¬å·ï¼Œè€Œåœ¨å‡½æ•°ååé¢ï¼Œperl é¢„æœŸä¸€ä¸ªè¯å¼€ç«¯çš„å‚æ•°åˆ—è¡¨ã€‚å¦ä¸€æ–¹é¢ï¼Œç±»å‹åå¿…é¡»è·Ÿåœ¨æ“ä½œç¬¦åé¢ï¼Œæ‰€ä»¥ï¼Œæ‰€æœ‰çš„ç±»å‹åå¿… é¡»åœ¨è§£ææ—¶å°±æ˜¯å·²çŸ¥çš„ã€‚\nè¿™æ ·ï¼Œå¾ˆå¤šå­—ç¬¦éƒ½å¯ä»¥é‡å¤ä½¿ç”¨åœ¨ä¸åŒçš„è¯­æ³•ç¯å¢ƒä¸‹äº†ã€‚\nç¬¬å…­å¤© â€“ X å’Œ Z å…ƒæ“ä½œç¬¦ Raku ä¸­ä¸€ä¸ªæ–°çš„åˆ›æ„å°±æ˜¯å…ƒæ“ä½œç¬¦ï¼Œè¿™ç§å…ƒæ“ä½œç¬¦å’Œæ™®é€šçš„æ“ä½œç¬¦ç»“åˆæ”¹å˜äº†æ™®é€šæ“ä½œç¬¦çš„è¡Œä¸ºã€‚è¿™ç§å…ƒæ“ä½œç¬¦æœ‰å¾ˆå¤šï¼Œä½†è¿™é‡Œæˆ‘ä»¬åªå…³æ³¨å®ƒä»¬ä¸­çš„ä¸¤ä¸ª: X å’Œ Zã€‚\nX æ“ä½œç¬¦ä½ å¯èƒ½å·²ç»è§è¿‡å®ƒä½œä¸ºä¸­ç¼€äº¤å‰æ“ä½œç¬¦çš„æ™®é€šè§’è‰²ã€‚å®ƒå°†åˆ—è¡¨è”åˆåœ¨ä¸€èµ·ï¼Œæ¯ä¸ªåˆ—è¡¨ä¸­å„å–ä¸€ä¸ªå…ƒç´ ï¼š\nsay ((1, 2) X (\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;)).raku; # ((1, \u0026#34;a\u0026#34;), (1, \u0026#34;b\u0026#34;), (2, \u0026#34;a\u0026#34;), (2, \u0026#34;b\u0026#34;)) ç„¶è€Œ, è¿™ä¸ªä¸­ç¼€æ“ä½œç¬¦ infix:\u0026lt;X\u0026gt; å…¶å®æ˜¯å°† X æ“ä½œç¬¦åº”ç”¨åˆ°åˆ—è¡¨è¿æ¥æ“ä½œç¬¦ infix:\u0026lt;,\u0026gt; ä¸Šçš„ç®€ä¾¿å½¢å¼ã€‚äº‹å®ä¸Šï¼Œä½ å¯ä»¥è¿™æ ·å†™ï¼š\nsay ((1, 2) X, (10, 11)).raku; # ((1, 10), (1, 11), (2, 10), (2, 11)) å¦‚æœä½ å°† X åº”ç”¨åˆ°ä¸åŒçš„ä¸­ç¼€æ“ä½œç¬¦ä¸Šé¢ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿåº”ç”¨åˆ° infix:\u0026lt;+\u0026gt; ä¸Šå‘¢ï¼Ÿ\nsay ((1, 2) X+ (10, 11)).raku; # (11, 12, 12, 13).list å®ƒåšäº†ä»€ä¹ˆï¼Ÿå®ƒä¸æ˜¯ä»æ¯ä¸ªç»„åˆä¸­æŒ‘å‡ºæ‰€æœ‰çš„å…ƒç´ åˆ—è¡¨ï¼Œè¿™ä¸ªæ“ä½œç¬¦å°†ä¸­ç¼€æ“ä½œç¬¦ + åº”ç”¨åˆ°å…ƒç´ é—´ï¼Œå¹¶ä¸”ç»“æœä¸æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œè€Œæ˜¯ä¸€ä¸ªæ•°å­—ï¼Œæ˜¯é‚£ä¸ªç»„åˆä¸­æ‰€æœ‰å…ƒç´ çš„å’Œã€‚\nè¿™å¯¹ä»»ä½•ä¸­ç¼€æ“ä½œç¬¦éƒ½æœ‰æ•ˆã€‚çœ‹çœ‹å­—ç¬¦ä¸²è¿æ¥ infix:\u0026lt; ~ \u0026gt;ï¼š\nsay ((1, 2) X~ (10, 11)).raku; # (\u0026#34;110\u0026#34;, \u0026#34;111\u0026#34;, \u0026#34;210\u0026#34;, \u0026#34;211\u0026#34;) æˆ–è€…ä¹Ÿè®¸æ•°å€¼ç›¸ç­‰æ“ä½œç¬¦ infix:\u0026lt;==\u0026gt;\nsay ((1, 2) X== (1, 1)).raku # (Bool::True, Bool::True, Bool::False, Bool::False) ä½†æ˜¯è¿™ç¯‡æ–‡ç« ä¹Ÿæ˜¯å…³äº Z å…ƒæ“ä½œç¬¦çš„ã€‚æˆ‘ä»¬æœŸæœ›ä½ å·²ç»çŸ¥é“ä»–æ˜¯ä»€ä¹ˆäº†ã€‚å¦‚æœä½ é‡è§è¿‡ä¸­ç¼€æ“ä½œç¬¦ Zï¼Œå®ƒå½“ç„¶æ˜¯ Z, çš„ä¾¿æ·å½¢å¼ã€‚\nsay ((1, 2) Z, (3, 4)).raku; # ((1, 3), (2, 4)) say ((1, 2) Z+ (3, 4)).raku; # (4, 6).list say ((1, 2) Z== (1, 1)).raku; # (Bool::True, Bool::False) Z, ç„¶å, ä¾æ¬¡æ“ä½œæ¯ä¸ªåˆ—è¡¨çš„æ¯ä¸ªå…ƒç´ ï¼ŒåŒæ—¶æ“ä½œæ¯ä¸ªåˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œç„¶ååŒæ—¶æ“ä½œç¬¬äºŒå¯¹å„¿ï¼Œç„¶åç¬¬ä¸‰å¯¹å„¿ï¼Œä¸ç®¡æœ‰å¤šå°‘ã€‚å½“åˆ°è¾¾åˆ—è¡¨çš„ç»“å°¾æ—¶åœæ­¢ã€‚\nZ ä¹Ÿæ˜¯æƒ°æ€§çš„,æ‰€ä»¥ä½ å¯ä»¥å°†å®ƒç”¨åœ¨ä¸¤ä¸ªæ— é™åˆ—è¡¨ä¸Šï¼Œå®ƒä¼šå°½å¯èƒ½å¤šåœ°ç”Ÿæˆä½ éœ€è¦çš„ç»“æœã€‚X åªèƒ½å¤„ç†å·¦è¾¹æ˜¯æ— é™åˆ—è¡¨çš„åˆ—è¡¨ï¼Œå¦åˆ™å®ƒä¸ä¼šè®¾æ³•å¾—åˆ°ä»»ä½•ä¸œè¥¿ã€‚\næœ‰ä¸€ä¸ªé”®å’Œå€¼å¾—åˆ—è¡¨ï¼Œä½ æƒ³å¾—åˆ°ä¸€ä¸ªæ•£åˆ—ï¼Ÿ å®¹æ˜“ï¼\nmy %hash = @keys Z=\u0026gt; @values; æˆ–è€…ï¼Œä¹Ÿè®¸ä½ æƒ³å¹¶è¡Œéå†ä¸¤ä¸ªåˆ—è¡¨ï¼Ÿ\nfor @a Z @b -\u0026gt; $a, $b { ... } æˆ–è€…ä¸‰ä¸ª?\nfor @a Z @b Z @c -\u0026gt; $a, $b, $c { ... } æˆ–è€…ä½ èƒ½ä»æ‰”3æ¬¡æœ‰10ä¸ªé¢çš„éª°å­çš„æ‰€æœ‰æ•°å­—ç»„åˆä¸­ï¼Œå¾—åˆ°æ‰€æœ‰å¯èƒ½çš„æ€»æ•°ï¼š\nmy @d10 = 1 ... 10; my @scores = (@d10 X+ @d10) X+ @d10; å¦‚æœä½ æƒ³çœ‹åˆ°ä¸€äº›åœ¨çœŸå®ä¸–ç•Œè¿™äº›åŸæ“ä½œç¬¦çš„ç”¨é€”ï¼Œçœ‹çœ‹ Moritz Lenzâ€™s å†™çš„ Sudoku.pm æ•°ç‹¬è§£ç®—å™¨ã€‚\nç¬¬ä¸ƒå¤© è¯æ³•å˜é‡ ç¼–ç¨‹æ€»æ˜¯ä»¶å¾ˆéš¾æŒç»­åšä¸‹å»çš„äº‹æƒ…ã€‚ä¸²å‡ è¡Œä»£ç å¾ˆå®¹æ˜“ï¼Œæ ¹æ®æƒ³æ³•åšä¸€ä¸ªåŸå‹ä¹Ÿæ˜¯è½»æ¾æ„‰å¿«çš„ã€‚ä½†éšç€ç¨‹åºæ…¢æ…¢å˜å¤§ï¼Œç»´æŠ¤æ—¶é—´æ…¢æ…¢å˜é•¿ï¼Œäº‹æƒ…æ…¢æ…¢å°±æ£˜æ‰‹èµ·æ¥äº†â€¦â€¦æœ€åï¼Œå¦‚æœä¸å¹¸çš„è¯ï¼Œæˆ‘ä»¬å°±å¾—è¢«è¿«é‡æ„â€”â€”ä¸æ˜¯å› ä¸ºæ—©å…ˆçš„é—®é¢˜å¤æ‚ï¼Œè€Œæ˜¯å› ä¸ºç¨‹åºæœ¬èº«å¤æ‚äº†â€¦â€¦åœ¨ä¸æ–­çš„è°ƒè¯•ä¸­æ€¥ç™½äº†å¤´çš„ç¨‹åºå‘˜ä»¬ï¼Œæ—©å°±ä¸è®°å¾—åˆ°åº•è¦æ€ä¹ˆæ‰©å±•ç¨‹åºä»¥å®Œæˆç›®çš„äº†â€¦â€¦\næ‰€ä»¥æˆ‘ä»¬å›æº¯ä¸€ä¸‹ç¼–ç¨‹å²ï¼Œæ‰¾æ‰¾å¯¹ç€å¤æ‚æ€§çš„åŠæ³•ã€‚è€Œç­”æ¡ˆå°±åœ¨é‚£é‡Œï¼Œä¸æ¥ä¸å»â€”â€”é™åˆ¶é•¿åº¦ã€‚å½“ä½ æ¶æ„ä¸€ä¸ªæˆç™¾ä¸Šåƒæ¨¡å—ç»„æˆçš„å¤§å‹ç¨‹åºçš„æ—¶å€™ï¼Œä½ å¿…é¡»èƒ½å¤Ÿè®©è¿™äº›ç»„ä»¶é€šè¿‡è¡¨é¢ä¸Šå¾ˆå°çš„è®¾ç½®è¿›è¡Œäº¤äº’â€”â€”å¦åˆ™ä½ å°±ç­‰ç€è¢«ä¹±ä¸ƒå…«ç³Ÿçš„ç»„åˆå¹²æ­»å§ã€‚\nåœ¨å„å±‚æ¬¡çš„ç¼–ç¨‹ä¸Šï¼Œæˆ‘ä»¬éƒ½å¯ä»¥çœ‹åˆ°è¿™ä¹ˆä¸€ä¸ªåŸåˆ™ã€‚å› ä¸ºä»–å°±åªå…³å¿ƒè¿™ä¸€ä»¶äº‹æƒ…ï¼šåˆ†æ•£æ³¨æ„ï¼Œä¸“ä¸€çš„åšä¸€ä»¶äº‹æƒ…ï¼BCNF èŒƒå¼ã€monads (è¯‘è€…æ³¨ï¼šä¸çŸ¥é“è¿™ä¸œä¸œå’‹ç¿»è¯‘)ã€å•å­ï¼Œä¾‹ç¨‹ï¼Œç±»ï¼Œè§’è‰²ï¼Œæ¨¡å—ï¼ŒåŒ…ç­‰ã€‚è¿™äº›éƒ½æ˜¯åœ¨ç£ä¿ƒå’ŒæŒ‡å¯¼æˆ‘ä»¬é™åˆ¶ç¼–ç¨‹çš„é•¿åº¦ã€‚è¿™æ ·æˆ‘ä»¬æ‰ä¸ä¼šè¾“åœ¨ç»„ åˆå­¦ä¸Šã€‚è€Œè¿™æ–¹é¢æœ€ç®€å•çš„ä¾‹å­ï¼Œå°±æ˜¯è¯æ³•å˜é‡ã€‚\n{ my $var; # $varå¯è§ } # $varä¸å¯è§ å“ˆå“ˆï¼Œè¿™å°±æ˜¯ä»Šå¤©è¦ä»‹ç»çš„ä¸€ä¸ªéå¸¸é…·çš„åŠŸèƒ½äº†ï¼éå¸¸æœ‰è¶£çš„è¯´ã€‚\nPerl ä»ç¬¬ä¸€ç‰ˆå¼€å§‹ï¼Œåœ¨è¿™æ–¹é¢ä¸€ç›´ä¸å¤ªå¯¹ã€‚æ¯”å¦‚ Perl5 çš„é»˜è®¤å˜é‡ä½œç”¨åŸŸæ˜¯åŒ…ã€‚è€Œè¿™å°±æ˜¯å…¨å±€å˜é‡çš„ä¸€ç§ã€‚æˆ‘åœ¨æŸä¸ªä»£ç å—é‡Œå®šä¹‰äº†ä¸€ä¸ªå˜é‡ï¼Œå…¶ä»–åœ°æ–¹å±…ç„¶ä¹Ÿèƒ½çœ‹åˆ°â€¦â€¦\n$ perl -v This is perl 5, version 12, subversion 1 (v5.12.1) $ perl -E \u0026#39;{ $var = 42 }; say $var\u0026#39; 42 $ perl -wE \u0026#39;{ my $var= 42 }; say $var\u0026#39; Name \u0026#34;main::var\u0026#34; used only once: possible typo at -e line 1. Use of uninitialized value $var in say at -e line 1. åœ¨ Raku é‡Œï¼Œè¯æ³•å˜é‡å˜æˆäº†é»˜è®¤è®¾ç½®ã€‚åœ¨ Rakudo ä¸Šè¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œæ ¹æœ¬æ— æ³•é€šè¿‡ç¼–è¯‘ï¼š\n$ raku -e \u0026#39;{ $var = 42 }; say $var\u0026#39; ===SORRY!=== Symbol \u0026#39;$var\u0026#39; not predeclared in \u0026lt;anonymous\u0026gt; $ raku -e \u0026#39;{ my $var = 42 }; say $var\u0026#39; ===SORRY!=== Symbol \u0026#39;$var\u0026#39; not predeclared in \u0026lt;anonymous\u0026gt; å¥½äº†ï¼Œä½ å¯èƒ½è¯´ï¼šâ€œå—¯ï¼Œå¯ä»¥å‡å°‘ç‚¹æ‰“é”™å­—çš„å¯èƒ½äº†â€ã€‚è¿™å½“ç„¶æ²¡é”™ï¼Œä½†æ˜¯æ›´é‡è¦çš„æ˜¯ï¼šè¿™è®©ä½ è®¤çœŸå¦è¯šçš„å¯¹å¾…å˜é‡ä½œç”¨åŸŸã€‚è¿™å¯¹ä½ æ§åˆ¶ä»£ç å¤æ‚æ€§å¾ˆæœ‰åˆ©ï¼\næˆ‘ä»¬å¯ä»¥è¯´å‡ºå¾ˆå¤šå¾ˆå¤šè§£é‡Šæ¥è¯´æ˜ä¸ºå•¥ Perl5 è¿™ä¹ˆåšã€‚æ¯”å¦‚ Perl5 å·²ç»å»ºè®®å¤§å®¶ use warnings; use strict; ï¼Œæ¯”å¦‚ Perl5 æ‰¿è¯ºçš„å‘åå…¼å®¹ï¼Œå—¯ï¼Œå¾ˆä¼Ÿå¤§çš„åšæ³•ï¼Œè€Œ Perl1 å‹æ ¹æ²¡æ‰“ç®—ç”¨æ¥å†™å¤§å‹ç¨‹åºå’Œç®¡ç†å¸¦æ¥çš„å¤æ‚æ€§ï¼›æ¯”å¦‚å…¨å±€å˜é‡åœ¨å•è¡Œæ¨¡å¼ä¸‹çš„å„ç§æ–¹ä¾¿â€¦â€¦\nRaku å†…ç½®çš„å¼ºåˆ¶ä½ ä»å°å¤„ç€æ‰‹ï¼Œå¸®ä½ åœ¨ç³»ç»Ÿæ‰©å®¹çš„æ—¶å€™ï¼Œæ›´è‹›è´£çš„å…³æ³¨æ¶æ„åŸºç¡€ã€‚åœ¨å˜é‡æ–¹é¢ï¼Œä¹Ÿå°±æ˜¯åœ¨è„šæœ¬å’Œæ¨¡å—ä¸­ï¼Œå°†è¯æ³•å˜é‡ä½œä¸ºé»˜è®¤è®¾ç½®ã€‚ä¸è¿‡åœ¨ perl -e æ‰§è¡Œçš„å•è¡Œå‘½ä»¤ä¸­ï¼Œé»˜è®¤ä¾ç„¶æ˜¯å…¨å±€å˜é‡ã€‚ï¼ˆ Rakudo è¿˜æ²¡æœ‰å®ç°è¿™ä¸ªï¼Œç›®å‰å•è¡Œä¾ç„¶æ˜¯è¯æ³•å˜é‡ï¼ŒæœŸå¾…å®ç°çš„é‚£å¤©~ï¼‰\nç»§ç»­ã€‚å¥½åƒåˆ°è¿™é‡Œä½ æ„Ÿè§‰è¯æ³•å˜é‡çš„ä»·å€¼å·²ç»è¯´å®Œäº†ï¼Ÿæ²¡æœ‰ï¼æ­£ç¡®è®¾è®¡çš„ç»“æœå¯æ˜¯ä»¤äººæƒŠè®¶å’Œå¥–é‡‘æºæºä¸æ–­å•Š~è€ƒè™‘ä¸€ä¸‹è¿™ä¸ªå­ç¨‹åºï¼š\nsub counter($start_value) { my $count = $start_value; return { $count++ }; } è¿™é‡Œè¿”å›çš„æ˜¯ä¸€ä¸ªä»£ç å—ã€‚æ‰€ä»¥æ¯æ¬¡æˆ‘ä»¬è°ƒç”¨ counter() çš„æ—¶å€™ï¼Œå¾—åˆ°çš„éƒ½æ˜¯ä¸€å°ç‰‡æ–­å¼€çš„ä»£ç ã€‚ç„¶åçœ‹çœ‹å½“æˆ‘åˆ›å»ºä¸¤ç‰‡è¿™æ ·çš„ä»£ç åçš„ç»“æœï¼š\nmy $c1 = counter(5); say $c1(); # 5 say $c1(); # 6 \u0026amp;nbsp_place_holder; my $c2 = counter(42); say $c2(); # 42 say $c1(); # 7 say $c2(); # 43 çœ‹åˆ°äº†å§ï¼Œ $c1 å’Œ $c2 æ˜¯å®Œå…¨åˆ†å¼€çš„ï¼Œä»–ä»¬ç›¸äº’ç‹¬ç«‹äº’ä¸å½±å“ã€‚å°½ç®¡ä»–ä»¬éƒ½å†™æˆ $count çš„æ ·å­ï¼Œçœ‹èµ·æ¥çœŸæ˜¯å·®ä¸å¤šï¼Œä½†ä»–ä»¬éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„å­˜å‚¨å•å…ƒâ€”â€”å› ä¸ºæ¯æ¬¡æˆ‘ä»¬è¿è¡Œè¿›å…¥é‚£ä¸ªä»£ç å—çš„æ—¶å€™ï¼Œå°±æ˜¯ä¸€æ¬¡é‡æ–°å¼€å§‹ã€‚è¿™ä¸ªå°ä»£ç å—ä»è¿è¡Œä¸­çš„è®¡æ•°å™¨é‡Œè¿”å›ï¼Œè¿™äº›è®¡æ•°å™¨é‡Œä¿ç•™äº†å­˜å‚¨å•å…ƒçš„å¯¹åº”å…³ç³»ã€‚ï¼ˆä»–â€œå…³é—­â€è¿™ä¸ªå­˜å‚¨å•å…ƒï¼Œä¿æŠ¤å®ƒä¸è¢« GC å›æ”¶æ‰ã€‚è¿™ç±»ä»£ç å—å«é—­åŒ…ï¼‰\nè¿™ä¸ªé—­åŒ…çœ‹èµ·æ¥åƒæ˜¯ä¸ªè½»é‡çº§çš„å¯¹è±¡ï¼Ÿgxgxï¼Œä»–ä»¬ç¡®å®å°±æ˜¯ã€‚é—­åŒ…èƒŒåçš„åŸåˆ™ï¼Œå³è§„èŒƒå¯¹é—­åŒ…å€¼çš„è®¿é—®æ–¹å¼ï¼Œä¸é¢å‘å¯¹è±¡èƒŒåçš„å°è£…å’Œä¿¡æ¯çš„åŸåˆ™æ˜¯ä¸€æ ·çš„ã€‚ä»–ä»¬éƒ½æ˜¯å°½åŠ›é™åˆ¶äº‹æƒ…çš„ç¨‹åº¦ï¼Œåœ¨äº‹æƒ…å˜å¾—ç³Ÿç³•çš„æ—¶å€™ï¼Œå¸®å¿™å‡å°‘å…¶å½±å“å’ŒæŸå¤±ã€‚\nä½ å¯ä»¥ç”¨è¯æ³•å˜é‡åšäº›å¾ˆæœ‰è¶£çš„äº‹æƒ…ï¼Œæ¯”å¦‚é—­åŒ…ï¼›è€ŒåŒ…å˜é‡ä¸è¡Œã€‚è¯æ³•å˜é‡æœ€é…·å•¦ï¼å¼å¼~~\nç¬¬å…«å¤© - ä¸åŒä¸œè¥¿ç”¨ä¸åŒåå­— Perl5 çš„æ–°æ‰‹ä»¬ï¼Œæ€»ä¼šå¾ˆå¥‡æ€ªçš„è¯´ä¸ºå•¥è‡ªå·±æ²¡æ³•å€’è£…å‘¢ï¼ŸPerl é‡Œæœ‰å†…ç½®çš„ reverse å‘½ä»¤ï¼Œä½†å¥½åƒå‹æ ¹ä¸èµ·ä½œç”¨å•Šï¼š\n$ perl -E \u0026#34;say reverse \u0026#39;hello\u0026#39;\u0026#34; hello å½“ä»–ä»¬å»é—®ä¸€äº›æœ‰ç»éªŒçš„ perler çš„æ—¶å€™ï¼Œè§£å†³åŠæ³•å¾ˆå¿«å°±æœ‰äº†ã€‚å› ä¸º reverse æœ‰ä¸¤ç§æ“ä½œæ¨¡å¼ï¼Œåˆ†åˆ«å·¥ä½œåœ¨æ ‡é‡å’Œåˆ—è¡¨ç¯å¢ƒä¸‹ï¼Œç”¨æ¥å€’è£…å­—ç¬¦ä¸²å’Œåˆ—è¡¨å…ƒç´ ï¼š\n$ perl -E \u0026#34;say scalar reverse \u0026#39;hello\u0026#39;\u0026#34; olleh æ¯”è¾ƒæ‚²å‰§çš„æ˜¯è¿™ä¸ªæƒ…å†µå’Œå¤§å¤šæ•°çš„ perl è¯­å¢ƒæ˜¯ä¸ä¸€è‡´çš„ã€‚æ¯”æ–¹è¯´ï¼Œç»å¤§å¤šæ•°çš„æ“ä½œç¬¦å’Œå‡½æ•°ç”±è‡ªå·±å†³å®šè¯­å¢ƒï¼Œå¹¶åœ¨è¿™ä¸ªè¯­å¢ƒä¸‹åˆ†ææ•°æ®ã€‚å¥½æ¯” + å’Œ * ä½œç”¨äºæ•°å­—ï¼Œ. ä½œç”¨äºå­—ç¬¦ä¸²ã€‚æ‰€ä»¥è¯´ä»–ä»¬ä»£è¡¨ä¸€ä¸ªæ“ä½œå¹¶ä¸”æä¾›è¯­å¢ƒï¼Œè€Œ reverse å´ä¸æ˜¯ã€‚\nåœ¨ Raku é‡Œï¼Œæˆ‘ä»¬ä»è¿‡å»çš„é”™è¯¯é‡Œå¸å–æ•™è®­ä»¥æ‘†è„±å†å²çš„çª˜å¢ƒã€‚æ‰€ä»¥æˆ‘ä»¬æŠŠåˆ—è¡¨å€’å™ï¼Œå­—ç¬¦ä¸²ç¿»è½¬ï¼Œå“ˆå¸Œåæ¼”åˆ†å¼€æˆäº†ä¸‰ä¸ªæ“ä½œï¼š\n# å­—ç¬¦ä¸²ç¿»è½¬ï¼Œæ”¹åå«flip $ raku -e \u0026#39;say flip \u0026#34;hello\u0026#34;\u0026#39; olleh # åˆ—è¡¨å€’å™ $ raku -e \u0026#39;say join \u0026#34;, \u0026#34;, reverse \u0026lt;ab cd ef\u0026gt;\u0026#39; ef, cd, ab # å“ˆå¸Œåè½¬ï¼Œå« invert my %capitals = France =\u0026gt; \u0026#34;Paris\u0026#34;, UK =\u0026gt; \u0026#34;London\u0026#34;; say %capitals.invert.raku; (\u0026#34;Paris\u0026#34; =\u0026gt; \u0026#34;France\u0026#34;, \u0026#34;London\u0026#34; =\u0026gt; \u0026#34;UK\u0026#34;) æ³¨æ„å“ˆå¸Œçš„åæ¼”å’Œå…¶ä»–ä¸¤ä¸ªä¸åŒã€‚å› ä¸ºå“ˆå¸Œçš„å€¼ä¸è¦æ±‚æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥åæ¼”åï¼Œå“ˆå¸Œç»“æ„å¯èƒ½ä¼šè¢«æ”¹å˜ï¼Œæˆ–è€…æŸäº›å€¼è¢«è¦†ç›–â€¦â€¦ å¦‚æœå¿…è¦çš„è¯ï¼Œä½¿ç”¨è€…å¯ä»¥è‡ªå·±å†³å®šè¿”å›å“ˆå¸Œç»“æ„æ—¶çš„æ“ä½œæ–¹å¼ã€‚æ¯”å¦‚ä¸‹é¢å°±æ˜¯ä¸€ç§æ— æŸçš„æ–¹å¼ï¼š\nmy %inverse; %inverse.push( %original.invert ); è¿™ä¸ªæ–¹æ³•ä¼šåœ¨é”®å€¼å¯¹å­˜åœ¨çš„æƒ…å†µä¸‹ï¼ŒæŠŠæ–°å€¼ push åœ¨åŸæœ‰å€¼çš„é˜Ÿå°¾å˜æˆä¸€ä¸ªæ•°ç»„ï¼š\nmy %h; %h.push(\u0026#39;foo\u0026#39; =\u0026gt; 1); # foo =\u0026gt; 1 %h.push(\u0026#39;foo\u0026#39; =\u0026gt; 2); # foo =\u0026gt; [1, 2] %h.push(\u0026#39;foo\u0026#39; =\u0026gt; 3); # foo =\u0026gt; [1, 2, 3] è¿™ä¸‰ä¸ªå‡½æ•°ï¼Œéƒ½ä¼šå¼ºåˆ¶è½¬æ¢ä»–ä»¬çš„å‚æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ ä¼ é€’ä¸€ä¸ªåˆ—è¡¨ç»™ flipï¼Œè¿™ä¸ªåˆ—è¡¨ä¼šè¢«å¼ºåˆ¶æˆå­—ç¬¦ä¸²åå†ç¿»è½¬è¿”å›ã€‚\nç¬¬åå¤© â€“ Feed operators ä½¿ç”¨Perl 5 ç¼–ç¨‹ä¸€æ®µæ—¶é—´çš„äººå¯èƒ½é‡åˆ°æˆ–å†™è¿‡ä¸‹é¢è¿™æ ·ç›¸ä¼¼çš„ä»£ç ï¼š\nmy @new = sort { ... } map { ... } grep { ... } @original; åœ¨è¿™ä¸ªæ„é€ ä¸­ï¼Œæ•°æ®ä» @original æ•°ç»„æµè¿› grepï¼Œç„¶åæŒ‰é¡ºåºï¼Œæµè¿› map ï¼Œç„¶åæµè¿› sortï¼Œæœ€åå°†ç»“æœèµ‹å€¼ç»™ @new æ•°ç»„ã€‚å› ä¸ºå®ƒä»¬æ¯ä¸ªéƒ½å°†åˆ—è¡¨ä½œä¸ºå®ƒä»¬æœ€ç»ˆçš„å‚æ•°ï¼Œä»…ä»…é€šè¿‡ä½ç½®ï¼Œæ•°æ®ä»ä¸€ä¸ªæ“ä½œç¬¦å‘å·¦æµè¿›ä¸‹ä¸€ä¸ªæ“ä½œç¬¦ã€‚\nRaku, ä»å¦ä¸€æ–¹é¢ï¼Œé€šè¿‡å¼•å…¥æµå‘æ“ä½œç¬¦è®©æ•°æ®ä»ä¸€ä¸ªæ“ä½œç¬¦æµè¿›å¦ä¸€ä¸ªæ“ä½œç¬¦ï¼Œè®©è¿™ç§æ€æƒ³æ›´æ˜ç¡®ã€‚ä¸Šé¢çš„ Perl 5 ä»£ç èƒ½ä½¿ç”¨ Raku é‡å†™ï¼š\nmy @new \u0026lt;== sort { ... } \u0026lt;== map { ... } \u0026lt;== grep { ... } \u0026lt;== @original; æ³¨æ„æ¡æ¡å¤§è·¯é€šç½—é©¬ï¼Œè¿™ä¸ªåœ¨ Raku ä¸­æ›´èƒ½ä½“ç°ã€‚ä½ ä¹Ÿå¯ä»¥è·Ÿ Perl 5 çš„å†™æ³•ç›¸åŒï¼š\nmy @new = sort { ... }, map { ... }, grep { ... }, @original; å”¯ä¸€ä¸åŒçš„æ˜¯é¢å¤–çš„é€—å·ã€‚\næ‰€ä»¥ï¼Œæˆ‘ä»¬ä»è¿™äº›æµå‘æ“ä½œç¬¦å¾—åˆ°äº†ä»€ä¹ˆï¼Ÿé€šå¸¸ï¼Œå½“æˆ‘ä»¬é˜…è¯»ä»£ç çš„æ—¶å€™ï¼Œä½ æ˜¯ä»å·¦å‘å³è¯»çš„ï¼Œåœ¨åŸæ¥çš„ Perl 5 ä»£ç ä¸­ï¼Œä½ å¯èƒ½ä»å·¦åˆ°å³é˜…è¯»ä½ çš„ä»£ç ç›´åˆ°ä½ å‘ç°æ­£åœ¨å¤„ç†çš„ç»“æ„ï¼Œå…¶æµå‘æ˜¯ä»å³å‘å·¦çš„ï¼Œç„¶åä½ è·³åˆ°æœ«å°¾ï¼ŒæŒ‰ç…§ä»å³å¾€å·¦çš„æ–¹å¼å†è¯»ä¸€éã€‚\nåœ¨ Raku ä¸­ï¼Œç°åœ¨æœ‰ä¸€ä¸ªçªå‡ºçš„å¥æ³•æ ‡è®°ï¼Œå‘Šè¯‰ä½ æ•°æ®å‘å·¦æµåŠ¨çš„æ€§è´¨ã€‚\nè¿™æ ·å†™ä¹Ÿå¯ä»¥ï¼š\n@original ==\u0026gt; grep { ... } ==\u0026gt; map { ... } ==\u0026gt; sort { ... } ==\u0026gt; my @new; ä¸‹é¢æ˜¯ä¸€äº›ä½¿ç”¨æµå‘æ“ä½œç¬¦çš„ä¾‹å­ï¼š\nmy @random-nums = (1..100).pick(*); # 100ä¸ªéšæœºæ•° my @odds-squared \u0026lt;== sort \u0026lt;== map { $_ ** 2 } \u0026lt;== grep { $_ % 2 } \u0026lt;== @random-nums; say ~@odds-squared; my @a= (1..100).pick(*); @a ==\u0026gt; grep {$_ % 2} ==\u0026gt; map { $_ ** 2} ==\u0026gt; sort {$^a \u0026lt;=\u0026gt; $^b} ==\u0026gt; my @c; # 1 9 25 49 81 121 169 225 289 361 441 529 625 729 841 961 1089 1225 1369 1521 1681 1849 2025 2209 2401 2601 2809 3025 3249 3481 3721 3969 4225 4489 4761 5041 5329 5625 5929 6241 6561 6889 7225 7569 7921 8281 8649 9025 9409 9801 my @odds-squared \u0026lt;== sort {$^b \u0026lt;=\u0026gt; $^a} \u0026lt;== map { $_ ** 2 } \u0026lt;== grep { $_ % 2 } \u0026lt;== @random-nums # é™åºæ’åˆ— # 9801 9409 9025 8649 8281 7921 7569 7225 6889 6561 6241 5929 5625 5329 5041 4761 4489 4225 3969 3721 3481 3249 3025 2809 2601 2401 2209 2025 1849 1681 1521 1369 1225 1089 961 841 729 625 529 441 361 289 225 169 121 81 49 25 9 1 my @rakudo-people = \u0026lt;scott patrick carl moritz jonathan jerry stephen\u0026gt;; @rakudo-people ==\u0026gt; grep { /at/ } ==\u0026gt; map { .ucfirst } ==\u0026gt; my @who-it\u0026#39;s-at; say ~@who-it\u0026#39;s-at; # Patrick Jonathan [+](my @a) \u0026lt;== map {$_ **2} \u0026lt;== 1..10 # 385ï¼Œ 1 åˆ° 10 çš„å¹³æ–¹å’Œ [+]() \u0026lt;== map {$_ **2} \u0026lt;== 1..10 # 385 ç¬¬åäºŒå¤© â€“ æ™ºèƒ½åŒ¹é… è¿˜è®°å¾—Raku Advent åºåˆ—æ“ä½œç¬¦å—?å› ä¸ºæœ€åä¸€ä¸ªå‚æ•°å®ƒæ¥å—çš„æ˜¯ä¸€ä¸ªä¸Šé™ï¼Œè¿™è®©åºåˆ—çš„ç”Ÿæˆåœæ­¢äº†ï¼Œä¾‹å¦‚ï¼š\n1, 2, 4 ... 32; # 1 2 4 8 16 32 1, 2, 4 ... * \u0026gt; 10; # 1 2 4 8 16 1,2,4 ... * \u0026gt; 100; # 1 2 4 8 16 32 64 128 1,2,4 ...^ * \u0026gt; 100; # 1 2 4 8 16 32 64 ä½ èƒ½çœ‹åˆ°ï¼Œåœ¨ç¬¬ä¸€ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨äº†æ•°å€¼ç›¸ç­‰ã€‚ç¬¬äºŒä¸ªæ›´æœ‰æ„æ€ï¼š*\u0026gt;10 åœ¨å†…éƒ¨è¢«é‡å†™ä¸ºä¸€ä¸ªé—­åŒ…ï¼Œåƒè¿™æ · -\u0026gt; $x { $x \u0026gt; 10 } (through currying).\nåºåˆ—æ“ä½œç¬¦åšäº†ä¸€äº›ä¸å¯æ€è®®çš„æ¯”è¾ƒï¼Œæ ¹æ®åŒ¹é…è€…çš„ç±»å‹ã€‚è¿™ç§æ¯”è¾ƒå°±å«åšæ™ºèƒ½åŒ¹é…ï¼Œå¹¶ä¸”æ˜¯åœ¨ Raku ä¸­é‡å¤å‡ºç°çš„ä¸€ä¸ªæ¦‚å¿µï¼Œä¾‹å¦‚ï¼š\n# after the \u0026#39;when\u0026#39; keyword: given $age { when 100 { say \u0026#34;congratulations!\u0026#34; } when * \u0026lt; 18 { say \u0026#34;You\u0026#39;re not of age yet\u0026#34; } } # after \u0026#39;where\u0026#39;: subset Even of Int where * %% 2; # æ˜¾å¼åœ°ä½¿ç”¨æ™ºèƒ½åŒ¹é…æ“ä½œç¬¦: if $input ~~ m/^\\d+$/ { say \u0026#34;$inputis an integer\u0026#34;; } # arguments to grep(), first() etc.: my @even = @numbers.grep: Even; åœ¨æ™ºèƒ½æ“ä½œç¬¦ ~~ çš„å³ä¾§ï¼Œå¹¶ä¸”åœ¨ when å’Œ where çš„åé¢ï¼Œè¦åŒ¹é…çš„å€¼è¢«è®¾ç½®ä¸º ä¸»é¢˜å˜é‡ $_ã€‚\nä¸‹é¢æ˜¯ä¸€äº›æ™ºèƒ½æ“ä½œç¬¦çš„ç”¨æ³•ï¼š\n$foo ~~ Str #å®ƒçš„ç±»å‹æ˜¯ Strå—? $foo ~~ 6 #å®ƒç­‰äº 6 å—? $foo ~~ \u0026#34;bar\u0026#34; #æˆ–è€…å®ƒæ˜¯ \u0026#34;bar\u0026#34; å—? $foo ~~ /\\w+\u0026#39;-\u0026#39;\\d+/ # å®ƒåŒ¹é…æŸä¸ªæ¨¡å¼å—? $foo ~~ (15..25) # å®ƒçš„å€¼åœ¨ 15 å’Œ 25 ä¹‹é—´å—? $foo ~~ -\u0026gt; $x { say \u0026#39;ok\u0026#39; if 5 \u0026lt; $x \u0026lt; 25 } # è°ƒç”¨é—­åŒ… $foo ~~ [1, *, 1, *, 1, *] # å«æœ‰6ä¸ªå…ƒç´ çš„æ•°ç»„ï¼Œæ˜¯å¦å…¶æ‰€æœ‰çš„å¥‡æ•°å…ƒç´ çš„å€¼éƒ½ä¸º 1? æ™ºèƒ½åŒ¹é…çš„å…¨éƒ¨è¡¨ç°å¯ä»¥åœ¨è¿™æ‰¾åˆ°ï¼š.\næ™ºèƒ½åŒ¹é…æ²¡æœ‰ç‰¹æ®Šçš„æ“ä½œç¬¦ï¼Œè€Œå¤§éƒ¨åˆ†æ™ºèƒ½åŒ¹é…çš„æƒ…å†µä¼šè¿”å› Bool å€¼ï¼Œå¯¹æ­£åˆ™è¿›è¡ŒåŒ¹é…ä¼šè¿”å›ä¸€ä¸ª Match å¯¹è±¡\nä½ å¯èƒ½å¼€å§‹æ€€ç–‘ï¼šä¸€ä¸ªæ­£ç¡®çš„ï¼Œå†…ç½®çš„ç±»å‹ï¼Œæˆ‘æ€ä¹ˆå°†å®ƒç”¨åœ¨æˆ‘è‡ªå·±çš„ç±»ä¸­ï¼Ÿä½ éœ€è¦ä¸ºå®ƒå†™ä¸€ä¸ªç‰¹åˆ«çš„ ACCEPTS æ–¹æ³•ã€‚å‡å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªå«Point çš„ç±»ï¼š\nclass Point { has $.x; has $.y; method ACCEPTS(Positional $p2) { return $.x == $p2[0] and $.y == $p2[1] } } ä¸€åˆ‡éƒ½æ¸…æ¥šäº†å—?è®©æˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„:\nmy $a = Point.new(x =\u0026gt; 7, y =\u0026gt; 9); say [3, 5] ~~ $a; # Bool::False say (7, 9) ~~ $a; # Bool::True ç°åœ¨èƒ½æ°å½“åœ°åšåˆ°ä½ æƒ³è¦çš„ï¼Œç”šè‡³ä½¿ç”¨ä½ è‡ªå·±çš„ç±»ã€‚\nç¬¬ 16 å¤© - Raku é‡Œçš„æ—¶é—´ ä»Šå¤©æ˜¯åœ£è¯æœˆå†çš„ç¬¬ 0x10 å¤©ï¼Œæ˜¯æ—¶å€™å­¦ä¹ ä¸€ä¸‹ raku é‡Œçš„æ—¶é—´äº†ã€‚S32::Temporal ç®€ä»‹åœ¨è¿‡å»ä¸€å¹´ä¸­æœ‰äº†å¤§é‡çš„ä¿®æ”¹ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥ä»‹ç»ä¸€ä¸‹åœ¨ raku å®ç°ä¸­å…³äºæ—¶é—´çš„ä¸€äº›åŸºç¡€çŸ¥è¯†ã€‚\ntime å’Œ now æ˜¯ä¸¤ä¸ªå¯ä»¥è¿”å›å½“å‰æ—¶é—´ï¼ˆè‡³å°‘æ˜¯ä½ çš„ç³»ç»Ÿè®¤ä¸ºçš„å½“å‰æ—¶é—´ï¼‰çš„è¯ã€‚ç®€å•çš„å±•ç¤ºä¸€ä¸‹ï¼š\nsay time; say now; 1292460064 Instant:2010-12-16T00:41:4.873248Z ç¬¬ä¸€ä¸ªæ˜æ˜¾çš„åŒºåˆ«ï¼Œå‰è€…è¿”å›çš„æ˜¯ POSIX æ ¼å¼çš„æ•°å€¼å‹çš„ç»“æœï¼›è€Œåè€…è¿”å›çš„æ˜¯ä¸€ä¸ªç¬é—´çš„å¯¹è±¡ã€‚å¦‚æœä½ æƒ³è·å–ç§’çº§ä»¥ä¸‹å°æ•°ç‚¹ä½æˆ–è€…è¯´é—°ç§’ï¼Œè¯·ç”¨ now ï¼›å¦‚æœä¸ç”¨ï¼Œé‚£ç”¨ time è·å– POSIX æ ¼å¼å°±å¤Ÿäº†ã€‚éšä½ çš„ä¾¿ã€‚\n DateTime å’Œä»–çš„ä¼™ä¼´  å¤§å¤šæ•°æ—¶å€™ï¼Œä½ è¦çš„ä¸æ˜¯å½“å‰æ—¶é—´ã€‚è¿™ç§æ—¶å€™ï¼Œä½ éœ€è¦çš„æ˜¯ DateTime ã€‚æ¯”å¦‚è¿˜æ˜¯è·å–å½“å‰æ—¶é—´ï¼š\nmy $moment = DateTime.new(now); # æˆ–è€… DateTime.new(time) ä½ æœ‰ä¸¤ç§æ–¹å¼æ¥åˆ›å»º DateTime å¯¹è±¡ï¼š\nmy $dw = DateTime.new(:year(1963), :month(11), :day(23), :hour(17), :minute(15)); è¿™æ˜¯ UTC æ—¶åŒºï¼Œå¦‚æœä½ è¦æ›´æ”¹æ—¶åŒºçš„è¯ï¼Œå†åŠ ä¸Š :timezone å°±å¥½äº†ã€‚è¿™ä¸ªæ ¼å¼é‡Œï¼Œåªæœ‰ :year æ˜¯å¿…é¡»çš„ï¼Œå…¶ä»–çš„é»˜è®¤å°±æ˜¯1æœˆ1å·åŠå¤œ0ç‚¹0åˆ†ã€‚\nä¸Šé¢è¿™ç§å†™æ³•ç¡®å®ä¹å‘³ï¼Œä½ å¯ä»¥é‡‡ç”¨ ISO8601 æ ¼å¼çš„è¾“å…¥ï¼Œæ¥åˆ›å»ºä¸€ä¸ª DateTime å¯¹è±¡ï¼š\nmy $dw = DateTime.new(\u0026#34;1963-11-23T17:15:00Z\u0026#34;); å…¶ä¸­ Z è¡¨ç¤º UTC ï¼Œæƒ³æ”¹å˜çš„è¯ï¼ŒæŠŠ Z æ›¿æ¢æˆ +hhmm æˆ–è€… -hhmm å°±å¥½äº†ã€‚hh è¡¨ç¤ºå°æ—¶ï¼Œmm è¡¨ç¤ºåˆ†é’Ÿã€‚ æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªæ›´ç®€ç•¥çš„ Date å¯¹è±¡ã€‚åªåŒ…æ‹¬å¹´æœˆæ—¥çš„ï¼š\nmy $jfk = Date.new(\u0026#34;1963-11-22\u0026#34;); # ä½ ä¹Ÿå¯ä»¥ç”¨:year ç­‰çš„å†™æ³• å¼•å…¥ Date å¯¹è±¡ï¼Œæ˜¯å¸å–äº† CPAN ä¸Š DateTime æ¨¡å—çš„æ•™è®­ï¼šæœ‰æ—¶å€™ä½ å‹æ ¹ä¸å…³å¿ƒä»€ä¹ˆæ—¶åŒºå•Šé—°ç§’å•Šçš„ã€‚Date å¯¹è±¡éå¸¸å®¹æ˜“å¤„ç†ï¼Œæ¯”å¦‚å®ƒæœ‰å†…ç½®çš„ .succ å’Œ .pred æ–¹æ³•ï¼Œç”¨æ¥ç®€å•çš„é€’å¢å’Œé€’å‡ã€‚\n$jfk++; # è‚¯å°¼è¿ªé‡åˆºåçš„ç¬¬äºŒå¤© æœ€åâ€¦\nä»¥ä¸Šå°±æ˜¯å…³äº Raku é‡Œçš„æ—¶é—´çš„å†…å®¹äº†ï¼Œæƒ³äº†è§£æ›´å¤šç»†èŠ‚ï¼Œå»çœ‹çœ‹è§„èŒƒå§ï¼›æˆ–è€…å»ç¤¾åŒºé‡Œæé—®\nç¬¬åä¹å¤© - å‡ä½œçœŸæ—¶çœŸäº¦å‡ ä»Šå¤©çš„åœ£ä¸´ç¤¼ç‰©æ˜¯æ•™å¤§å®¶æ€ä¹ˆç”¨æ··æ·†å®Œæˆä¸€ä¸ªå°é‚ªæ¶æ»´ç›®çš„ï¼Œå¼å¼~çœ‹èµ·æ¥è¿™ä¸ªåŠŸèƒ½æŒºç–¯ç‹‚çš„ï¼Œå…¶å®æœ‰æ—¶å€™è›®æœ‰ç”¨çš„ã€‚å…ˆçœ‹ä¸‹é¢è¿™ä¸ªç”¨ but çš„ä¾‹å­ï¼š\nmy $value = 42 but role { method Bool { False } }; say $value; # 42 say ?$value; # False ä½ çœ‹ï¼Œæˆ‘ä»¬æ”¹å˜äº† $value çš„ .Bool æ–¹æ³•ã€‚ä»–ä¸å½±å“ç¨‹åºé‡Œå…¶ä»–æ‰€æœ‰çš„æ•´æ•°ï¼Œå“ªæ€•åˆ«çš„å˜é‡ä¹Ÿæ˜¯ 42ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¯¹äº Int å‹ï¼Œ.Bool æ–¹æ³•ï¼ˆé€šè¿‡?æ“ä½œç¬¦ï¼‰è¿”å›å€¼ä¾æ®æ˜¯æ˜¯å¦ç­‰äº 0ã€‚ä½†è¿™æ¬¡å®ƒæ°¸è¿œéƒ½è¿”å› false äº†ã€‚ äº‹å®ä¸Šï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å†™çš„æ›´ç®€å•ï¼Œå› ä¸º False æ˜¯ä¸€ä¸ªæšä¸¾å€¼ï¼š\nmy $value = 42 but False; å› ä¸º False æ˜¯ Bool å€¼ï¼Œæ‰€æœ‰å®ƒä¼šè‡ªåŠ¨é‡è½½ .Bool æ–¹æ³•ã€‚è¿™æ˜¯ Raku çš„ä¸€ç§è½¬æ¢æ–¹æ³•ã€‚å…¶ä»–çš„å€¼ï¼Œä¹Ÿä¼šå¯¹åº”çš„é‡è½½ã€‚\nè¿™æ ·åœ¨æœ‰çš„æ—¶å€™ï¼Œè¿™ä¸ªä¸œè¥¿å°±æ¯”è¾ƒæœ‰ç”¨äº†ï¼šåœ¨ Perl5 é‡Œï¼Œä½ ç”¨ system è°ƒç”¨ shell çš„æ—¶å€™ï¼Œå¾—ç‰¢ç‰¢è®°ä½åœ¨ shell é‡Œï¼Œè¿”å› 0 æ‰æ˜¯æ­£å¸¸çš„ï¼š\nif ( system($cmd) == 0 ) { # æˆ–è€…!system($cmd) # ... } è€Œåœ¨ Raku ä¸­ï¼Œå¯¹åº”çš„ run å‘½ä»¤è¿”å›çš„æ˜¯ä¸Šé¢è¯´çš„è¿™ç§é‡è½½è¿‡çš„ Intï¼Œå½“ä¸”ä»…å½“è¿”å›å€¼æ˜¯ 0 çš„æ—¶å€™ï¼Œå®ƒçš„ bool å˜æˆäº† Trueï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„é¢ï¼\nif run($cmd) { #ä¸éœ€è¦å¦å®šäº† # ... } å¥½äº†ï¼Œç°åœ¨è¿›å…¥æœ€ç–¯ç‹‚çš„éƒ¨åˆ† â€”â€” æˆ‘ä»¬å¯ä»¥é‡è½½å¸ƒå°”å€¼çš„å¸ƒå°”æ–¹æ³•ï¼š\nmy $value = True but False; say $value; # True say ?$value; # False æ²¡é”™ï¼ŒRaku å…è®¸ä½ è¿™æ ·è‡ªå·±è¸¢è‡ªå·±å±è‚¡~~è™½ç„¶æˆ‘ä¹Ÿä¸çŸ¥é“é™¤äº†æ£ä¹±å¤–æ€ä¹ˆä¼šæœ‰äººæ„¿æ„è¿™ä¹ˆåšï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯å¾ˆé«˜å…´çœ‹åˆ° Raku ä¿æŒè¿™ç§å¾®å¦™çš„è·Ÿè¸ªå’Œé‡è½½ç±»å‹çš„å¿ƒæ€ã€‚æˆ‘å¯æ²¡æœ‰â€¦â€¦\nDay 21 â€“ transliteration and beyond è½¬æ¢å¬èµ·æ¥åƒæ‹‰ä¸è¯æ ¹,æ„å‘³ç€å­—æ¯çš„å˜åŒ–ã€‚è¿™å°±æ˜¯ Str.trans æ–¹æ³•æ‰€åšçš„ã€‚\nsay \u0026#34;GATTACA\u0026#34;.trans( \u0026#34;TCAG\u0026#34; =\u0026gt; \u0026#34;0123\u0026#34; ); # prints \u0026#34;3200212\\n\u0026#34; ä½¿ç”¨è¿‡Perl5 çš„äººé©¬ä¸Šæ„è¯†åˆ°è¿™å°±æ˜¯ tr/tcag/0123/ .\nä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œä½¿ç”¨ ROT-13ç®—æ³•åŠ å¯†æ–‡æœ¬ï¼š\nsub rot13($text) { $text.trans( \u0026#34;A..Za..z\u0026#34; =\u0026gt; \u0026#34;N..ZA..Mn..za..m\u0026#34; ) } å½“ .trans æ–¹æ³•çœ‹åˆ°é‚£äº› .. åŒºé—´æ—¶ï¼Œå®ƒä¼šåœ¨å†…éƒ¨å°†é‚£äº›å­—æ¯å±•å¼€ (æ‰€ä»¥ \u0026ldquo;n..z\u0026rdquo; æ„æ€æ˜¯ \u0026ldquo;nopqrstuvwxyz\u0026rdquo;). å› æ­¤,rot13å­ä¾‹ç¨‹çš„æœ€ç»ˆæ•ˆæœæ˜¯å°†ASCIIå­—æ¯è¡¨çš„ç‰¹å®šéƒ¨åˆ†æ˜ å°„åˆ°å…¶ä»–éƒ¨åˆ†ã€‚\nåœ¨ Perl5 ä¸­ï¼Œä¸¤ä¸ªç‚¹è·Ÿä¸€ä¸ªç ´æŠ˜å·ç›¸åŒï¼Œä½†æ˜¯åœ¨Raku ä¸­æˆ‘ä»¬è®©é‚£ä¸¤ä¸ªç‚¹ .. ä»£è¡¨ èŒƒå›´çš„æ¦‚å¿µï¼Œåœ¨ä¸»ç¨‹åºä¸­ï¼Œåœ¨æ­£åˆ™ä¸­ï¼Œè¿˜æœ‰åœ¨è¿™é‡Œï¼Œè½¬æ¢ã€‚\nè¦æ³¨æ„çš„æ˜¯ï¼Œ.trans æ–¹æ³•æ˜¯ä¸ä¼šæ”¹å˜åŸæ¥çš„å­—ç¬¦ä¸²ï¼› å®ƒä¸ä¼šå™¶è¾¹ $text, è€Œæ˜¯è¿”å›ä¸€ä¸ªæ–°çš„å€¼ã€‚è¿™åœ¨ Raku ä¸­ä¹Ÿæ˜¯ä¸€ä¸ªé€šç”¨çš„æ—‹å¾‹ã€‚è¦æ”¹å˜åŸå€¼ï¼Œè¯·ä½¿ç”¨ .=trans\n$kabbala.=trans(\u0026#34;A..Ia..i\u0026#34; =\u0026gt; \u0026#34;1..91..9\u0026#34;); (å¹¶ä¸”ï¼Œå®ƒä¸ä»…ä»…é€‚ç”¨äº .trans æ–¹æ³•ï¼Œå®ƒå¯¹æ‰€æœ‰æ–¹æ³•éƒ½é€‚ç”¨ã€‚)\n.trans æ–¹æ³•åŒ…å«äº†ä¸€ä¸ªç§˜å¯†æ­¦å™¨ï¼šå‡å¦‚æˆ‘ä»¬æƒ³è½¬ä¹‰ä¸€äº›HTMLï¼Œå³ï¼Œæ ¹æ®ä¸‹é¢è¿™ä¸ªè¡¨æ¥æ›¿æ¢ä¸œè¥¿ï¼š\n\u0026amp; =\u0026gt; \u0026amp;amp; \u0026lt; =\u0026gt; \u0026amp;lt; \u0026gt; =\u0026gt; \u0026amp;gt; ä½†æ˜¯æˆ‘ä»¬ä¸æƒ³å…³å¿ƒæ›¿æ¢è¿˜è¦æŒ‰é¡ºåºè¿›è¡Œï¼š\nfoo =\u0026gt; bar foolishness =\u0026gt; folly åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœå‰é¢çš„æ›¿æ¢å…ˆå‘ç”Ÿï¼Œå°±ä¸å›æœ‰åé¢çš„æ›¿æ¢å‡ºç°äº† - è¿™å¯èƒ½ä¸æ˜¯ä½ æƒ³è¦çš„ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬æƒ³åœ¨çŸ­çš„å­ä¸²ä¹‹å‰ï¼Œå°è¯•å¹¶åŒ¹é…æœ€é•¿çš„å­ä¸²ã€‚\næ‰€ä»¥ï¼Œè¿™çœ‹èµ·æ¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæœ€é•¿è®°å·çš„æ›¿æ¢åŒ¹é…ï¼Œä»¥é¿å…å› ä¸ºå¶ç„¶çš„é‡å¤æ›¿æ¢è€Œäº§ç”Ÿçš„æ— é™å¾ªç¯ã€‚ é‚£å°±æ˜¯ Raku çš„ .trans æ–¹æ³•æ‰€æä¾›çš„ã€‚è¿™å°±æ˜¯å®ƒçš„ç§˜å¯†æ­¦å™¨ï¼šåµŒå…¥ä¸¤ä¸ªæ•°ç»„è€Œéå­—ç¬¦ä¸²ã€‚å¯¹äº HTML è½¬ä¹‰ï¼Œæˆ‘ä»¬æ‰€éœ€è¦çš„å°±æ˜¯ï¼š\nmy $escaped = $html.trans( [ \u0026#39;\u0026amp;\u0026#39;, \u0026#39;\u0026lt;\u0026#39;, \u0026#39;\u0026gt;\u0026#39; ] =\u0026gt; [ \u0026#39;\u0026amp;amp;\u0026#39;, \u0026#39;\u0026amp;lt;\u0026#39;, \u0026#39;\u0026amp;gt;\u0026#39; ] ); æ›¿æ¢çš„é¡ºåºé—®é¢˜å’Œé¿å…å¾ªç¯å°±ä¸ç”¨æˆ‘ä»¬å…³å¿ƒäº†ã€‚\nç¬¬äºŒåäºŒå¤© - Meta-Object Protocol ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ç”¨ä½ æœ€çˆ±çš„ç¼–ç¨‹è¯­è¨€å†™ä¸€ä¸ªç±»â€”â€”ä½†æ˜¯ä¸æ˜¯æŒ‰éƒ¨å°±ç­çš„å†™ç±»å®šä¹‰ï¼Œè€Œæ˜¯é€šè¿‡å‡ è¡Œä»£ç ï¼Ÿæœ‰äº›è¯­è¨€æä¾›äº† API æ¥å®Œæˆè¿™ä¸ªåŠŸèƒ½ã€‚è¿™äº› API çš„åé¢ï¼Œå°±æ˜¯å…ƒå¯¹è±¡åè®®( Meta-Object Protocol )ï¼Œç®€ç§° MOPã€‚\nRaku å°±æœ‰ MOPï¼Œä½ å¯ä»¥è‡ªå·±åˆ›å»ºç±»ã€è§’è‰²ã€è¯­æ³•ï¼Œæ·»åŠ æ–¹æ³•å’Œå±æ€§ï¼Œå¹¶ä¸”å†…çœç±»ã€‚æ¯”å¦‚æˆ‘ä»¬å¯ä»¥è°ƒç”¨ MOP æŸ¥çœ‹ Rakudo æ˜¯å¦‚ä½•å®ç° Rat ç±»å‹ï¼ˆæœ‰ç†æ•°ï¼‰çš„ã€‚è°ƒç”¨ MOP ï¼Œåªè¦æŠŠä¸€èˆ¬çš„ . æ¢æˆ .^ å°±å¯ä»¥äº†ã€‚\n$ raku \u0026gt; say join \u0026#39;, \u0026#39;, Rat.^attributes $!numerator, $!denominator \u0026gt; # åˆ—å‡ºå…¨éƒ¨æ–¹æ³•æ¯”è¾ƒå¤šï¼Œæ‰€ä»¥éšæœºé€‰å‡ ä¸ª \u0026gt; say join \u0026#39;, \u0026#39;, Rat.^methods(:local).pick(5) unpolar, ceiling, reals, Str, round \u0026gt; say Rat.^methods(:local).grep(\u0026#39;log\u0026#39;).[0].signature.raku :(Numeric $x: Numeric $base = { ... };; *%_) æ˜¾ç¤ºå‡ºæ¥çš„è¿™å‡ è¡Œä¿¡æ¯ç›¸ä¿¡éƒ½æ˜¯ä¸è¨€è‡ªæ˜äº†ã€‚Rat æœ‰ä¸¤ä¸ªå±æ€§ï¼Œ$!numerator å’Œ $!denominatorï¼›æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œå…¶ä¸­ log æ–¹æ³•å¯æ¥å—çš„ç¬¬ä¸€ä¸ªå˜é‡æ˜¯æ•°å€¼å‹ invocant(è¯‘è€…æ³¨ï¼šä¸çŸ¥é“æ€ä¹ˆç¿»è¯‘ï¼Œåæ­£å°±æ˜¯å¯¹è±¡æœ¬èº«çš„å¼•ç”¨ $_[0] )ï¼Œç”¨å†’å·æ ‡è®°è¿‡ï¼›ç¬¬äºŒä¸ªå˜é‡å‚æ•°æ˜¯å¯é€‰çš„ï¼Œåå­—æ˜¯ $baseï¼Œå®ƒè®¾æœ‰ä¸€ä¸ªé»˜è®¤å€¼ï¼Œä¸è¿‡ Rakudo ä¸æ‰“ç®—å‘Šè¯‰ä½ â€¦â€¦\nRaku çš„æ•°æ®åº“æ¥å£ä»£ç é‡Œæœ‰ä¸€ä¸ªå¾ˆä¸é”™çš„ä½¿ç”¨å®ä¾‹ã€‚å®ƒæœ‰ä¸€ä¸ªé€‰é¡¹ç”¨æ¥è®°å½•å¯¹è±¡çš„è°ƒç”¨ï¼Œä½†æ˜¯åªæ˜¯è®°å½•ä¸€éƒ¨åˆ†ç‰¹å®šè§’è‰²ï¼ˆæ¯”å¦‚å’Œè¿æ¥ç®¡ç†æˆ–è€…æ•°æ®æ£€ç´¢æœ‰å…³çš„ï¼‰ã€‚ä¸‹é¢æ˜¯ dbi é‡Œçš„ä»£ç ï¼š\nsub log-calls($obj, Role $r) { my $wrapper = RoleHOW.new; for $r.^methods -\u0026gt; $m { $wrapper.^add_method($m.name, method (|$c) { # æ‰“å°æ—¥å¿—ä¿¡æ¯ï¼Œnote() å‡½æ•°è¾“å‡ºåˆ°æ ‡å‡†é”™è¯¯ note \u0026#34;\u0026gt;\u0026gt; $m\u0026#34;; nextsame; }); } $wrapper.^compose(); # does æ“ä½œç¬¦å’Œ but ç±»ä¼¼ï¼Œä¸è¿‡åªä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„æ‹·è´ $obj does $wrapper; } role Greet { method greet($x) { say \u0026#34;hello, $x\u0026#34;; } } class SomeGreeter does Greet { method LOLGREET($x) { say \u0026#34;OH HAI \u0026#34;~ uc $x; } } my $o = log-calls(SomeGreeter.new, Greet); # è®°å½•æ—¥å¿—å•¦ï¼Œå› ä¸ºç”± Greet è§’è‰²æä¾›äº† $o.greet(\u0026#39;you\u0026#39;); # æ²¡è®°å½•ï¼Œå› ä¸ºæ²¡è§’è‰²æä¾›è¿™ä¸ª $o.LOLGREET(\u0026#39;u\u0026#39;); è¿è¡Œç»“æœå¦‚ä¸‹ï¼š\n\u0026gt;\u0026gt; greet hello, you OH HAI U æ‰€ä»¥è¯´ï¼Œæœ‰äº† MOP ï¼Œé™¤äº†æŒ‡å®šçš„è¯­æ³•ï¼Œä½ è¿˜å¯ä»¥åƒæ™®é€šæ¥å£ä¸€æ ·è®¿é—®ç±»ã€è§’è‰²ã€è¯­æ³•å’Œå±æ€§ã€‚è¿™ç»™äº†é¢å‘å¯¹è±¡æ›´å¤§çš„çµæ´»æ€§ï¼Œå¯ä»¥è½»æ¾çš„å†…çœå’Œä¿®æ”¹å¯¹è±¡äº†ã€‚\nç¬¬23å¤© - ä¸€äº›ç²¾å½©çš„æ’åºç¤ºä¾‹ ç»§ç»­æˆ‘ä»¬çš„åœ£ä¸´ç¤¼ç‰©ã€‚\næ’åºæ˜¯ä¸€ä¸ªéå¸¸éå¸¸å¸¸è§çš„ç¼–ç¨‹ä»»åŠ¡ã€‚Raku åŠ å¼ºäº†å®ƒçš„ .sort åŠŸèƒ½æ¥å¸®åŠ©å¤§å®¶æ›´å¥½çš„æ’åºã€‚ æœ€æœ€æ­£å¸¸çš„é»˜è®¤å†™æ³•æ˜¯è¿™æ ·çš„ï¼š\nmy @sorted = @unsorted.sort; # æˆ–è€…è¿™æ · sort @unsorted; å’Œ Perl 5 ä¸€æ ·ï¼Œä¹Ÿæ˜¯å¯ä»¥è‡ªå®šä¹‰å‡½æ•°çš„ï¼š\n# æ•°å€¼æ¯”è¾ƒ my @sorted = @unsorted.sort: { $^a \u0026lt;=\u0026gt; $^b }; # æˆ–è€…ç”¨å‡½æ•°è°ƒç”¨çš„å½¢å¼ my @sorted = sort { $^a \u0026lt;=\u0026gt; $^b }, @unsorted; # å­—ç¬¦ä¸²æ¯”å¯¹ ( è·ŸPerl5çš„cmpä¸€æ · ) my @sorted = @unsorted.sort: { $^a leg $^b }; # ç±»å‹ä¾èµ–æ¯”å¯¹ my @sorted = @unsorted.sort: { $^a cmp $^b }; ä½ ä¹Ÿå¯ä»¥æŠŠ : æ¢æˆ () ï¼Œç„¶åå†è·Ÿä¸Šä¸€äº›æ–¹æ³•è¿›è¡Œåç»­å¤„ç†ï¼Œæ¯”å¦‚ï¼š\nmy @topten = @scores.sort( { $^b \u0026lt;=\u0026gt; $^a } ).list.munch(10); å°æç¤ºï¼š $a å’Œ $b ä¸å†åƒåœ¨ Perl5 ä¸­é‚£æ ·æœ‰ç‰¹æ®Šå«ä¹‰äº†ï¼Œåœ¨ sort ä»£ç å—é‡Œç”¨åˆ«çš„å‘½åå˜é‡ $varã€ä½ç½®å˜é‡ $^var æˆ–è€…å…¶ä»–ä»»ä½•çš„éƒ½è·Ÿåœ¨å…¶ä»–ä»£ç æ®µé‡Œä¸€æ ·ã€‚\nä½ å¯ä»¥ç›´æ¥åœ¨æ’åºçš„æ—¶å€™ç›´æ¥å°±åšå¥½å˜æ¢å‡½æ•°ï¼š\nmy @sorted = @unsorted.sort: { foo($^a) cmp foo($^b) }; ä¸è¿‡ foo() ä¼šåœ¨é‡å¤æ‰§è¡Œï¼Œå¦‚æœåˆ—è¡¨ä¸å¤§ä¹Ÿå°±ç½¢äº†ï¼Œå¦‚æœæ¯”è¾ƒå¤§çš„è¯â€¦â€¦å¦‚æœ foo() è¿˜æ˜¯ä¸ªè®¡ç®—å¯†é›†å‹çš„â€¦â€¦ä½ æ‡‚çš„ï¼\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒPerl 5 é‡Œæœ‰ä¸ªä¹ æƒ¯å°±æ˜¯ä½¿ç”¨æ–½ç“¦èŒ¨( Schwartzian )å˜æ¢ã€‚æ–½ç“¦èŒ¨å˜æ¢çš„åšæ³•å°±æ˜¯ decorate-sort-undecorateï¼Œfoo() å‡½æ•°åªç”¨æ‰§è¡Œä¸€æ¬¡ï¼š\n@sorted = map { $_-\u0026gt;[0] } sort { $a-\u0026gt;[1] cmp $b-\u0026gt;[1] } map { [$_, foo($_)] } @unsorted; Raku é‡Œï¼Œä½ ä¸€æ ·å¯ä»¥ä½¿ç”¨æ–½ç“¦èŒ¨å˜æ¢ï¼Œä¸è¿‡ Raku å†…ç½®äº†ä¸€äº›æ™ºèƒ½æ–¹æ³•ã€‚å¦‚æœä½ æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥å—çš„å‚æ•°ä¸ªæ•°æ˜¯ 0 æˆ– 1ï¼ŒRaku ä¼šè‡ªåŠ¨çš„æ›¿ä½ å¯ç”¨æ–½ç“¦èŒ¨å˜æ¢ã€‚\nç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹ä¸€äº›ä¾‹å­å§ã€‚\n ä¸åŒºåˆ†å¤§å°å†™çš„æ’åº  æŠŠæ¯ä¸ªå…ƒç´ éƒ½æ”¹æˆå°å†™ï¼Œç„¶åæŠŠæ•°ç»„æŒ‰ç…§å°å†™çš„æ¬¡åºæ’å¥½è¿”å›ã€‚\nmy @sorted = @unsorted.sort: { .lc };  å•è¯é•¿åº¦æ’åº  æŠŠæ¯ä¸ªå…ƒç´ çš„å•è¯æŒ‰ç…§ä»çŸ­åˆ°é•¿æ’åºã€‚\nmy @sorted = @unsorted.sort: { .chars }; æˆ–è€…ä»é•¿åˆ°çŸ­:\nmy @sorted = @unsorted.sort: { -.chars };  å¤šæ¬¡æ’åºæ¯”è¾ƒ  ä½ å¯ä»¥åœ¨ sort ä»£ç å—é‡Œæ”¾å¤šä¸ªæ¯”è¾ƒå‡½æ•°ï¼Œsort ä¼šæ³¨æ„æ‰§è¡Œç›´åˆ°é€€å‡ºã€‚æ¯”å¦‚åœ¨å•è¯é•¿åº¦çš„åŸºç¡€ä¸Šï¼Œå†æŒ‰ç…§ ASCII ç çš„é¡ºåºæ’åºã€‚\n.say for @a.sort: { $^a.chars, $^a } ; ä¸è¿‡ï¼Œåœ¨ Rakudo é‡Œå¥½åƒè¿è¡Œæœ‰ç‚¹é—®é¢˜â€¦â€¦å®ƒåªä¼šæ¯”è¾ƒé•¿åº¦ä¸ä¼šæ¯”è¾ƒæ•°å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ10 æ’åœ¨ 2 çš„å‰é¢ã€‚ï¼ˆæ²¡å…³ç³»ï¼ŒTMTONTDIï¼‰\nRaku é‡Œçš„ sort æœ¬èº«æ˜¯ç¨³å®šå·¥ä½œçš„ï¼Œä½ å¯ä»¥é‡å¤ä½¿ç”¨ã€‚\n.say for @a.sort.sort: { $^a.chars }; ä¸è¿‡è¿™æ · sort æœ‰ä¸¤æ¬¡è°ƒç”¨ï¼Œno fashionï¼æ‰€ä»¥ä½ è¿˜å¯ä»¥è¿™ä¹ˆå†™ï¼š\n.say for @a.sort: { $^a.chars \u0026lt;=\u0026gt; $^b.chars || $^a leg $^b }; ä¸è¿‡è¿™ä¸‹ä½ æœ‰ä¸¤ä¸ªå‚æ•°äº†ï¼ŒRaku æ²¡æ³•è‡ªåŠ¨ç»™ä½ å¯åŠ¨æ–½ç“¦èŒ¨å˜æ¢äº†ã€‚\nåˆæˆ–è€…ï¼Œä½ å¯ä»¥åŠ ä¸Šä¸€ä¸ªç»™è‡ªç„¶æ•°æ’åºçš„å‡½æ•°ï¼š\n.say for @a.sort: { $^a.chars.\u0026amp;naturally, $^a }; â€œç»™è‡ªç„¶æ•°æ’åºï¼Ÿâ€æˆ‘å¥½åƒå¬åˆ°ä½ ä»¬çš„å“­å£°äº†ï¼Œâ€œå“ªé‡Œæœ‰ï¼Ÿâ€ å¾ˆé«˜å…´ä½ ä»¬è¿™ä¹ˆé—®ï¼Œç°åœ¨ç»§ç»­è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\n è‡ªç„¶æ•°æ’åº  æ ‡å‡†çš„è¯æ³•æ’åºæ˜¯æŒ‰ç…§ ASCII æ¬¡åºçš„ã€‚å…ˆæ˜¯è‡ªç„¶æ•°ï¼Œç„¶åæ˜¯å¤§å†™å­—æ¯ï¼Œæœ€åæ˜¯å°å†™å­—æ¯ã€‚æ‰€ä»¥äººä»¬åœ¨æ’åºçš„æ—¶å€™ç»å¸¸å¾—åˆ°è¿™æ ·çš„ç»“æœï¼š\n0 1 100 11 144th 2 21 210 3rd 33rd AND ARE An Bit Can and by car d1 d10 d2 å®Œå…¨æ­£ç¡®ï¼Œä½†æ˜¯æ²¡ç”¨â€¦â€¦å°¤å…¶æ˜¯å¯¹éç¨‹åºå‘˜æ¥è¯´ï¼Œæ›´éƒé—·äº†å°±â€¦â€¦çœŸæ­£çš„è‡ªç„¶æ’åºï¼Œåº”è¯¥æ˜¯å…ˆæŒ‰æ•°å­¦é‡çº§æ’è‡ªç„¶æ•°ï¼Œç„¶åæ‰æ˜¯å¤§å°å†™å­—æ¯ã€‚æ¯”å¦‚ä¸Šé¢é‚£ä¸ªä¾‹å­ï¼Œåº”è¯¥æ’æˆè¿™æ ·ï¼š\n0 1 2 3rd 11 21 33rd 100 144th 210 An AND and ARE Bit by Can car d1 d2 d10 æ‰€ä»¥ï¼Œæˆ‘ä»¬å¿…é¡»çš„åœ¨æ’åºçš„æ—¶å€™åŠ ä¸Šä¸€ç‚¹è½¬æ¢äº†ã€‚æˆ‘ä½¿ç”¨ .subst æ–¹æ³•ï¼Œè¿™æ˜¯æˆ‘ä»¬æ‰€ç†Ÿæ‚‰çš„ s/// æ“ä½œç¬¦çš„é¢å‘å¯¹è±¡å½¢å¼ã€‚\n.subst(/(\\d+)/, -\u0026gt; $/ { 0 ~ $0.chars.chr ~ $0 }, :g) ç¬¬ä¸€éƒ¨åˆ†ï¼Œæ•è·ä¸€ä¸ªè¿ç»­çš„æ•°å­—ï¼Œç„¶åç”± -\u0026gt; $/ {} æ„æˆä¸€ä¸ªå°–å·å—ï¼Œæ„æ€æ˜¯ï¼šâ€œä¼ é€’åŒ¹é…åˆ° $/ çš„æ•°ç»„åˆ° {} ä»£ç é‡Œâ€ã€‚ç„¶åä»£ç é‡Œæ›¿æ¢æˆç”¨ 0 æŒ‰ç…§æ•°é‡çº§æ’åºçš„é¡ºåºè”ç»“çš„å­—ç¬¦ä¸²ã€‚è¿™ä¸ª 0 æ˜¯ä»¥ ASCII å­—ç¬¦ä¸²å‡ºç°ï¼Œè”ç»“åœ¨åŸå§‹å­—ç¬¦ä¸²ä¸Šçš„ã€‚æœ€å /g è¡¨ç¤ºå…¨å±€æ›¿æ¢ã€‚\nå¦‚æœä¹Ÿä¸åŒºåˆ†å¤§å°å†™ï¼Œé‚£ä¹ˆï¼š\n.lc.subst(/(\\d+)/, -\u0026gt; $/ { 0 ~ $0.chars.chr ~ $0 }, :g) æ”¹æˆå­ä¾‹ç¨‹çš„æ–¹å¼ï¼š\nsub naturally ($a) { $a.lc.subst(/(\\d+)/, -\u0026gt; $/ { 0 ~ $0.chars.chr ~ $0 }, :g) } çœ‹èµ·æ¥å¾ˆä¸é”™äº†ï¼Œä¸è¿‡è¿˜æœ‰ç‚¹å°é—®é¢˜ï¼Œæ¯”å¦‚ THE ã€ The å’Œ the ä¼šæŒ‰ç…§ä»–ä»¬åœ¨åˆ—è¡¨é‡Œçš„é¡ºåºè¿”å›ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬é¢„è®¡çš„é¡ºåºã€‚æœ‰ä¸ªç®€å•çš„è§£å†³åŠæ³•ï¼Œå°±æ˜¯åœ¨è½¬æ¢è¿‡çš„å…ƒç´ çš„ç»“å°¾ï¼ŒåŠ ä¸Šä¸€ä¸ªä¸­æ–­ã€‚æ‰€ä»¥æœ€ç»ˆç»“æœæ˜¯ï¼š\nsub naturally ($a) { $a.lc.subst(/(\\d+)/, -\u0026gt; $/ { 0 ~ $0.chars.chr ~ $0 }, :g) ~ \u0026#34;\\x0\u0026#34; ~ $a } ç„¶åä½ çœ‹ï¼Œè¿™ä¸ªå­ä¾‹ç¨‹åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¯ä»¥ç”¨ä¸Šæ–½ç“¦èŒ¨å˜æ¢äº†ï¼š\n.say for \u0026lt;0 1 100 11 144th 2 21 210 3rd 33rd AND ARE An Bit Can and by car d1 d10 d2\u0026gt;.sort: { .\u0026amp;naturally }; æˆ–è€…ç”¨æ¥ç»™ ip æ’åºï¼š\nmy @ips = ((0..255).roll(4).join(\u0026#39;.\u0026#39;)for 0..99); .say for @ips.sort: { .\u0026amp;naturally }; è¾“å‡º:\n4.108.172.65 5.149.121.70 10.24.201.53 11.10.90.219 12.83.84.206 12.124.106.41 12.162.149.98 14.203.88.93 16.18.0.178 17.68.226.104 21.201.181.225 23.61.166.202 ä»¥åŠç›®å½•æ’åºå•Šç­‰ç­‰å„ç§æ•°å­—ä¸å­—æ¯çš„æ··åˆä½“ã€‚\næœ€åï¼Œåœ£è¯å¿«ä¹ï¼Œæ’åºå¿«ä¹ï¼Œæ„¿æ–½ç“¦èŒ¨ä¸ä½ åŒåœ¨ï¼\n","permalink":"https://ohmyweekly.github.io/notes/2015-10-05-raku-calendar-2010/","tags":["calendar"],"title":"Raku åœ£è¯æœˆå†(2010)"},{"categories":["rakulang"],"contents":"å–œæ¬¢ä¿®å¤ Raku ç¼–è¯‘å™¨ä¸­çš„ bug? è¿™å„¿æœ‰ä¸€ä¸ªgreat grammar bugglet: å½“ â€â€ å¼•å·ç”¨åœ¨å¼•èµ·çš„ç”¨ç©ºç™½åˆ†å‰²çš„å•è¯åˆ—è¡¨æ„é€ å™¨ä¸­æ—¶çœ‹èµ·æ¥å¥½åƒä¸èƒ½å·¥ä½œ:\nsay â€hello worldâ€; .say for qww\u0026lt;â€hello worldâ€\u0026gt;; .say for qww\u0026lt;\u0026#34;hello world\u0026#34;\u0026gt;; # OUTPUT: # hello world # â€hello # worldâ€ # hello world â€ å¼•å·ä¸åº”è¯¥å‡ºç°åœ¨è¾“å‡ºä¸­å¹¶ä¸”åœ¨è¾“å‡ºä¸­æˆ‘ä»¬åº”è¯¥åªæœ‰ 3 è¡Œè¾“å‡º; è¿™ 3 è¡Œè¾“å‡ºéƒ½æ˜¯ hello worldã€‚çœ‹èµ·æ¥åƒæ˜¯ä¸€ä¸ªå¾…ä¿®å¤çš„æœ‰è¶£çš„ bug! æˆ‘ä»¬è¿›å»çœ‹çœ‹ã€‚\nä½ æ€æ ·æ‹¼å†™å®ƒ? äº‹å®ä¸Šè¿™æ®µä»£ç æ²¡èƒ½æ­£ç¡®è§£æè¡¨æ˜è¿™æ˜¯ä¸€ä¸ª grammar bugã€‚å¤§éƒ¨åˆ†çš„ grammar ä½åœ¨ src/Raku/Grammar.nqpä¸­, ä½†æ˜¯åœ¨æˆ‘ä»¬çš„æ‰‹å˜è„ä¹‹å‰, è®©æˆ‘ä»¬æ¥è§£å†³æˆ‘ä»¬åº”è¯¥æŸ¥çœ‹ä»€ä¹ˆã€‚\näºŒè¿›åˆ¶ raku æœ‰ä¸€ä¸ª --target å‘½ä»¤è¡Œå‚æ•°æ¥æ¥æ”¶å…¶ä¸­ä¹‹ä¸€çš„ç¼–è¯‘æ­¥éª¤å¹¶ä¸”ä¼šå¯¼è‡´é‚£ä¸ªæ­¥éª¤çš„è¾“å‡ºè¢«äº§ç”Ÿå‡ºæ¥ã€‚é‚£å„¿æœ‰å“ªäº›æ­¥éª¤? æ ¹æ®ä½ æ­£ä½¿ç”¨çš„åç«¯å®ƒä»¬ä¹Ÿä¼šæœ‰æ‰€ä¸åŒ, ä½†æ˜¯ä½ å¯ä»¥ä»…ä»…è¿è¡Œ raku --stagestats -e '' æŠŠå®ƒä»¬éƒ½æ‰“å°å‡ºæ¥:\nzoffix@leliana:~$ raku --stagestats -e '' Stage start : 0.000 Stage parse : 0.077 Stage syntaxcheck: 0.000 Stage ast : 0.000 Stage optimize : 0.001 Stage mast : 0.004 Stage mbc : 0.000 Stage moar : 0.000 Grammars æ˜¯å…³äºè§£æçš„, æ‰€ä»¥æˆ‘ä»¬ä¼šæŸ¥è¯¢ parse ç›®æ ‡(target)ã€‚è‡³äºè¦æ‰§è¡Œçš„ä»£ç , æˆ‘ä»¬ä¼šä»…ä»…ç»™å®ƒæœ‰é—®é¢˜çš„é‚£å—; å³ qww\u0026lt;\u0026gt;:\nzoffix@leliana:~$ raku --target=parse -e 'qww\u0026lt;â€hello worldâ€\u0026gt;' - statementlist: qww\u0026lt;â€hello worldâ€\u0026gt; - statement: 1 matches - EXPR: qww\u0026lt;â€hello worldâ€\u0026gt; - value: qww\u0026lt;â€hello worldâ€\u0026gt; - quote: qww\u0026lt;â€hello worldâ€\u0026gt; - quibble: \u0026lt;â€hello worldâ€\u0026gt; - babble: - B: - nibble: â€hello worldâ€ - quote_mod: ww - sym: ww é‚£å¾ˆæ£’! æ¯ä¸€è¡Œå‰é¢éƒ½æœ‰èƒ½åœ¨ grammar ä¸­æ‰¾åˆ°çš„ token çš„åå­—, æ‰€ä»¥ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†åœ¨å“ªé‡ŒæŸ¥æ‰¾é—®é¢˜ã€‚\næˆ‘ä»¬è¿˜çŸ¥é“åŸºæœ¬çš„å¼•å·èƒ½æ­£ç¡®åœ°å·¥ä½œ, æ‰€ä»¥æˆ‘ä»¬ä¹Ÿå€¾å€’å‡ºå®ƒä»¬çš„è§£ææ­¥éª¤, æ¥çœ‹çœ‹è¿™ä¸¤ä¸ªè¾“å‡ºä¹‹é—´æ˜¯å¦æœ‰ä»€ä¹ˆä¸åŒ:\nzoffix@leliana:~$ raku --target=parse -e 'qww\u0026lt;\u0026quot;hello world\u0026quot;\u0026gt;' - statementlist: qww\u0026lt;\u0026quot;hello world\u0026quot;\u0026gt; - statement: 1 matches - EXPR: qww\u0026lt;\u0026quot;hello world\u0026quot;\u0026gt; - value: qww\u0026lt;\u0026quot;hello world\u0026quot;\u0026gt; - quote: qww\u0026lt;\u0026quot;hello world\u0026quot;\u0026gt; - quibble: \u0026lt;\u0026quot;hello world\u0026quot;\u0026gt; - babble: - B: - nibble: \u0026quot;hello world\u0026quot; - quote_mod: ww - sym: ww é‚£ä¹ˆ\u0026hellip; å¥½å§, é™¤äº†å¼•å·ä¸åŒ, è§£ææ•°å®Œå…¨ä¸€æ ·ã€‚æ‰€ä»¥å®ƒçœ‹èµ·æ¥å¥½åƒæ‰€æœ‰æ¶‰åŠçš„ tokens éƒ½æ˜¯ç›¸åŒçš„, ä½†æ˜¯é‚£äº› tokens æ‰€åšçš„äº‹æƒ…ä¸åŒã€‚\næˆ‘ä»¬ä¸å¿…æ£€æŸ¥è¾“å‡ºä¸­æˆ‘ä»¬çœ‹åˆ°çš„æ¯ä¸ª tokensã€‚statementlist å’Œ statement æ˜¯åŒ¹é…æ™®é€šè¯­å¥çš„ tokens, EXPR æ˜¯å ä½ç¬¦è§£æå™¨, value æ˜¯å®ƒæ­£æ“ä½œçš„å€¼ä¸­çš„ä¸€ä¸ªã€‚æˆ‘ä»¬ä¼šå¿½ç•¥ä¸Šé¢é‚£äº›, ç•™ç»™æˆ‘ä»¬çš„æ˜¯ä¸‹é¢è¿™æ ·ä¸€ä¸ªå¯ç–‘çš„åˆ—è¡¨:\n- quote: qww\u0026lt;â€hello worldâ€\u0026gt; - quibble: \u0026lt;â€hello worldâ€\u0026gt; - babble: - B: - nibble: â€hello worldâ€ - quote_mod: ww - sym: ww è®©æˆ‘ä»¬å¼€å§‹è´¨é—®å®ƒä»¬ã€‚\nåˆ°å…”å­æ´é‡Œå»\u0026hellip; ä½ è‡ªå·±æä¸€ä»½æœ¬åœ°çš„ Rakudo ä»“åº“, å¦‚æœä½ å·²ç»æœ‰äº†ä¸€ä»½,é‚£ä¹ˆæ‰“å¼€ src/Raku/Grammar.nqp, ç„¶åæ”¾æ¾ç‚¹ã€‚\næˆ‘ä»¬ä¼šä»æ ‘çš„é¡¶éƒ¨åˆ°åº•éƒ¨è·Ÿéšæˆ‘ä»¬çš„ tokens, æ‰€ä»¥æˆ‘ä»¬é¦–å…ˆéœ€è¦æ‰¾åˆ°çš„æ˜¯ token quote, rule quote, regex quote æˆ– method quote; ä»¥é‚£ä¸ªé¡ºåºæœç´¢, å› ä¸ºç¬¬ä¸€é¡¹å¾ˆå¯èƒ½å°±æ˜¯æ­£ç¡®çš„ä¸œè¥¿ã€‚\nè¿™ç§æƒ…å†µä¸‹, å®ƒæ˜¯ä¸€ä¸ª token quote, å®ƒæ˜¯ä¸€ä¸ª proto regexã€‚æˆ‘ä»¬çš„ä»£ç ä½¿ç”¨äº†å®ƒçš„ q ç‰ˆæœ¬å¹¶ä¸”ä½ è¿˜å¯ä»¥è®¤å‡ºé è¿‘å®ƒçš„ qq å’Œ Q ç‰ˆæœ¬:\ntoken quote:sym\u0026lt;q\u0026gt; {:my $qm;\u0026#39;q\u0026#39;[|\u0026lt;quote_mod\u0026gt;{}\u0026lt;.qok($/)\u0026gt;{ $qm := $\u0026lt;quote_mod\u0026gt;.Str }\u0026lt;quibble(%*LANG\u0026lt;Quote\u0026gt;, \u0026#39;q\u0026#39;, $qm)\u0026gt;|{}\u0026lt;.qok($/)\u0026gt;\u0026lt;quibble(%*LANG\u0026lt;Quote\u0026gt;, \u0026#39;q\u0026#39;)\u0026gt;]} token quote:sym\u0026lt;qq\u0026gt;{ :my $qm; \u0026#39;qq\u0026#39; [ | \u0026lt;quote_mod\u0026gt; { $qm := $\u0026lt;quote_mod\u0026gt;.Str }\u0026lt;.qok($/)\u0026gt;\u0026lt;quibble(%*LANG\u0026lt;Quote\u0026gt;, \u0026#39;qq\u0026#39;, $qm)\u0026gt;|{}\u0026lt;.qok($/)\u0026gt;\u0026lt;quibble(%*LANG\u0026lt;Quote\u0026gt;, \u0026#39;qq\u0026#39;)\u0026gt;] } token quote:sym\u0026lt;Q\u0026gt; {:my $qm;\u0026#39;Q\u0026#39;[|\u0026lt;quote_mod\u0026gt;{ $qm := $\u0026lt;quote_mod\u0026gt;.Str }\u0026lt;.qok($/)\u0026gt;\u0026lt;quibble(%*LANG\u0026lt;Quote\u0026gt;, $qm)\u0026gt;|{}\u0026lt;.qok($/)\u0026gt;\u0026lt;quibble(%*LANG\u0026lt;Quote\u0026gt;)\u0026gt;]} å¯ä»¥çœ‹åˆ° qq å’Œ Q çš„ä¸»ä½“çœ‹èµ·æ¥åƒ q, æˆ‘ä»¬ä¹Ÿæ¥çœ‹çœ‹å®ƒä»¬æ˜¯å¦æœ‰æˆ‘ä»¬è¦æ‰¾çš„é‚£ä¸ª bug:\nzoffix@leliana:~$ raku -e '.say for qqww\u0026lt;â€hello worldâ€\u0026gt;' â€hello worldâ€ zoffix@leliana:~$ raku -e '.say for Qww\u0026lt;â€hello worldâ€\u0026gt;' â€hello world æ˜¯çš„, å®ƒä»¬ä¹Ÿå­˜åœ¨, æ‰€ä»¥ token quote ä¸å¯èƒ½æ˜¯é‚£ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬æ¥åˆ†è§£ä¸‹ token quote:sym\u0026lt;q\u0026gt; æ˜¯åšä»€ä¹ˆçš„, æ¥ç®—å‡ºæ€ä¹ˆè¿›è¡Œåˆ°ä¸‹ä¸€æ­¥; å®ƒçš„å¤‡é€‰ä¹‹ä¸€æ²¡æœ‰è¢«ç”¨åœ¨æˆ‘ä»¬å½“å‰çš„ä»£ç ä¸­, æ‰€ä»¥æˆ‘ä¼šçœç•¥å®ƒ:\ntoken quote:sym\u0026lt;q\u0026gt; {:my $qm;\u0026#39;q\u0026#39;[|\u0026lt;quote_mod\u0026gt;{}\u0026lt;.qok($/)\u0026gt;{ $qm := $\u0026lt;quote_mod\u0026gt;.Str }\u0026lt;quibble(%*LANG\u0026lt;Quote\u0026gt;, \u0026#39;q\u0026#39;, $qm)\u0026gt;|# (this branch omited) ]} åœ¨ç¬¬äºŒè¡Œä¸­, æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå˜é‡, ç„¶ååŒ¹é…å­—é¢å€¼ q ç„¶åæ˜¯ quote_mod tokenã€‚é‚£ä¸ªæ˜¯æˆ‘ä»¬çš„ --target=parse è¾“å‡ºä¸­çš„ä¸€éƒ¨åˆ†å¹¶ä¸”å¦‚æœä½ åƒæˆ‘ä»¬æ‰¾å‡º quote token é‚£æ ·æ‰¾å‡ºå®ƒ, ä½ ä¼šæ³¨æ„åˆ°å®ƒæ˜¯ä¸€ä¸ª proto regex, å³, åœ¨é‚£ç§æƒ…å†µä¸‹, åŒ¹é…æˆ‘ä»¬ä»£ç çš„ ww å—ã€‚åé¢è·Ÿç€çš„ç©º {} å—æˆ‘ä»¬å¯ä»¥å¿½ç•¥(é‚£æ˜¯ä¸€ä¸ª bug çš„æ›¿ä»£æ–¹æ³•å¯èƒ½åœ¨ä½ è¯»åˆ°è¿™å„¿æ—¶å·²ç»è¢«ä¿®å¤äº†)ã€‚ç›®å‰ä¸ºæ­¢, æˆ‘ä»¬å·²ç»åŒ¹é…äº†æˆ‘ä»¬ä»£ç çš„ qww å—ã€‚\nå†å¾€å‰èµ°, æˆ‘ä»¬é‡è§äº†å¯¹ qok token çš„è°ƒç”¨, å½“å‰çš„ Match å¯¹è±¡ä½œä¸ºå…¶å‚æ•°ã€‚\u0026lt;.qok\u0026gt; ä¸­çš„ç‚¹å·è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªéæ•è· token åŒ¹é…, è¿™å°±æ˜¯å®ƒä¸ºä»€ä¹ˆå®ƒæ²¡æœ‰åœ¨æˆ‘ä»¬çš„ --target=parse è¾“å‡ºä¸­å‡ºç°çš„åŸå› ã€‚æˆ‘ä»¬å®šä½åˆ°é‚£ä¸ª token å¹¶çœ‹çœ‹å®ƒæ˜¯å…³äºä»€ä¹ˆçš„:\ntoken qok($x) {Â»\u0026lt;![(]\u0026gt;[\u0026lt;?[:]\u0026gt;||\u0026lt;!{ my $n := ~$x; $*W.is_name([$n]) || $*W.is_name([\u0026#39;\u0026amp;\u0026#39; ~ $n]) }\u0026gt;][\\s*\u0026#39;#\u0026#39;\u0026lt;.panic: \u0026#34;# not allowed as delimiter\u0026#34;\u0026gt;]?\u0026lt;.ws\u0026gt;} æˆ‘çš„å¤©å‘! è¿™ä¹ˆå¤šç¬¦å·, ä½†æ˜¯è¿™ä¸ªå®¶ä¼™å¾ˆå®¹æ˜“äº†: Â» æ˜¯ä¸€ä¸ªå³å•è¯è¾¹ç•Œåé¢ä¸èƒ½è·Ÿç€ä¸€ä¸ªå¼€åœ†æ‹¬å·(\u0026lt;![(]\u0026gt;), å†è·Ÿç€ä¸€ä¸ªå¤‡é€‰åˆ†æ”¯([]), å†è·Ÿç€ä¸€ä¸ªæ£€æŸ¥, å³æˆ‘ä»¬ä¸æƒ³å°è¯•ä½¿ç”¨ # å·ä½œä¸ºåˆ†å‰²ç¬¦([...]?), æœ€åè·Ÿç€ä¸€ä¸ª \u0026lt;.ws\u0026gt; token åå™¬å„ç§å„æ ·çš„ç©ºç™½ã€‚\nåœ¨å¤‡é€‰åˆ†æ”¯ä¸­, æˆ‘ä»¬ä½¿ç”¨äº†é¦–ä¸ªtokenåŒ¹é…çš„ || å¤‡é€‰åˆ†æ”¯(å’Œæœ€é•¿tokenåŒ¹é… | ç›¸å), å¹¶ä¸”é¦–ä¸ª token å‘å‰æŸ¥çœ‹ä¸€ä¸ªå†’å· \u0026lt;?[:]\u0026gt;ã€‚ å¦‚æœå¤±è´¥äº†, æˆ‘ä»¬å°±å­—ç¬¦ä¸²åŒ–é‚£ä¸ªç»™å®šçš„å‚æ•°(~$x)å¹¶ä¸”ä¹‹ååœ¨ Worldå¯¹è±¡ èº«ä¸Šè°ƒç”¨ is_name æ–¹æ³•, åŸæ ·åœ°ä¼ é€’å¸¦æœ‰å‰ç½® \u0026amp; ç¬¦å·çš„å­—ç¬¦ä¸²åŒ–çš„å‚æ•°ã€‚ä¼ é€’çš„ ~$x æ˜¯ç›®å‰ä¸ºæ­¢æˆ‘ä»¬çš„ token quote:sym\u0026lt;q\u0026gt; token æ‰€åŒ¹é…åˆ°çš„ä¸œè¥¿(å¹¶ä¸”é‚£æ˜¯å­—ç¬¦ä¸² qww)ã€‚is_name æ–¹æ³•ä»…ä»…æ£€æŸ¥é‚£ä¸ªç»™å®šçš„ç¬¦å·æ˜¯å¦è¢«å®šä¹‰è¿˜æœ‰æ ¹æ®é‚£ä¸ªè¿”å›å€¼æ£€æŸ¥æˆ‘ä»¬çš„ token åŒ¹é…ä¼šé€šè¿‡è¿˜æ˜¯ä¼šå¤±è´¥ã€‚å¦‚æœé‚£ä¸ªæ±‚å€¼ä»£ç è¿”å›ä¸€ä¸ªçœŸå€¼é‚£ä¹ˆæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨çš„ \u0026lt;!{ ... }\u0026gt; ç»“æ„å°±ä¼šå¤±è´¥ã€‚\næ€»è€Œè¨€ä¹‹, è¿™ä¸ª token æ‰€åšçš„æ‰€æœ‰äº‹æƒ…å°±æ˜¯æ£€æŸ¥æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ # ä½œä¸ºåˆ†éš”ç¬¦å¹¶ä¸”æ²¡æœ‰å°è¯•å»è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æˆ–subã€‚æˆ¿é—´çš„è¿™ä¸ªè§’è½æ²¡æœ‰ bug è¿¹è±¡ã€‚ è®©æˆ‘ä»¬å›åˆ°æˆ‘ä»¬çš„ token quote:sym\u0026lt;q\u0026gt; æ¥æŸ¥çœ‹ä¸‹ä¸€æ­¥åšä»€ä¹ˆ:\ntoken quote:sym\u0026lt;q\u0026gt; {:my $qm;\u0026#39;q\u0026#39;[|\u0026lt;quote_mod\u0026gt;{}\u0026lt;.qok($/)\u0026gt;{ $qm := $\u0026lt;quote_mod\u0026gt;.Str }\u0026lt;quibble(%*LANG\u0026lt;Quote\u0026gt;, \u0026#39;q\u0026#39;, $qm)\u0026gt;|# (this branch omited) ]} æˆ‘ä»¬å·²ç»å®Œæˆäº† \u0026lt;.qok\u0026gt; çš„æ£€æŸ¥, æ‰€ä»¥ä¸‹ä¸€æ­¥æ˜¯ { $qm := $\u0026lt;quote_mod\u0026gt;.Str }, é‚£ä»…ä»…æŠŠåŒ¹é…åˆ° quote_mod token çš„å­—ç¬¦ä¸²å€¼å­˜åˆ° $qm å˜é‡ä¸­ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­, é‚£ä¸ªå€¼å°±æ˜¯å­—ç¬¦ä¸² wwã€‚\nä¸‹é¢è·Ÿç€çš„æ˜¯å¦å¤–ä¸€ä¸ª token, å®ƒåœ¨æˆ‘ä»¬çš„ --target=parse sè¾“å‡ºä¸­å‡ºç°è¿‡:\n\u0026lt;quibble(%*LANG\u0026lt;Quote\u0026gt;, \u0026#39;q\u0026#39;, $qm)\u0026gt; è¿™é‡Œ, æˆ‘ä»¬ä½¿ç”¨ä¸‰ä¸ªä½ç½®å‚æ•°å¼•ç”¨äº†é‚£ä¸ª token: Quote language braid, å­—ç¬¦ä¸² q å’Œ æˆ‘ä»¬ä¿å­˜åœ¨å˜é‡ $qm ä¸­çš„å­—ç¬¦ä¸² wwã€‚æˆ‘æƒ³çŸ¥é“å®ƒæ˜¯åšä»€ä¹ˆçš„ã€‚é‚£æ˜¯æˆ‘ä»¬çš„ä¸‹ä¸€ç«™ã€‚å…¨åŠ›ä»¥èµ´!\nNibble Quibble Babbling Nibbler è¿™é‡Œæ˜¯å®Œæ•´çš„ token quibble å¹¶ä¸”ä½ é©¬ä¸Šå¯ä»¥å‘ç°æˆ‘ä»¬ä¸å¾—ä¸ä»å¼€å§‹å¾€æ›´æ·±å¤„æŒ–æ˜, å› ä¸ºç¬¬ 5 è¡Œæ˜¯å¦å¤–ä¸€ä¸ª token åŒ¹é…:\ntoken quibble($l, *@base_tweaks) {:my $lang;:my $start;:my $stop;\u0026lt;babble($l, @base_tweaks)\u0026gt;{ my $B := $\u0026lt;babble\u0026gt;\u0026lt;B\u0026gt;.ast; $lang := $B[0]; $start := $B[1]; $stop := $B[2]; }$start\u0026lt;nibble($lang)\u0026gt;[$stop||{ $/.CURSOR.typed_panic( \u0026#39;X::Comp::AdHoc\u0026#39;, payload =\u0026gt; \u0026#34;Couldn\u0026#39;t find terminator $stop(corresponding $startwas at line { HLL::Compiler.lineof( $\u0026lt;babble\u0026gt;\u0026lt;B\u0026gt;.orig(), $\u0026lt;babble\u0026gt;\u0026lt;B\u0026gt;.from() ) })\u0026#34;, expected =\u0026gt; [$stop], ) } ] { nqp::can($lang, \u0026#39;herelang\u0026#39;) \u0026amp;\u0026amp; self.queue_heredoc( $*W.nibble_to_str( $/, $\u0026lt;nibble\u0026gt;.ast[1], -\u0026gt; { \u0026#34;Stopper \u0026#39;\u0026#34; ~ $\u0026lt;nibble\u0026gt; ~ \u0026#34;\u0026#39; too complex for heredoc\u0026#34; }), $lang.herelang, ) } } æˆ‘ä»¬å®šä¹‰äº† 3 ä¸ªå˜é‡ç„¶åå¼•ç”¨äº† babble token, è¿™ä¸ª babble å¼•ç”¨äº†å’Œ quibble token æ‰€å¼•ç”¨çš„åŒæ ·çš„å‚æ•°ã€‚æˆ‘ä»¬æ¥ä»¥å’ŒæŸ¥æ‰¾æ‰€æœ‰ä¹‹å‰çš„ tokens åŒæ ·çš„æ–¹å¼æŸ¥æ‰¾å®ƒå¹¶çª¥æ¢å®ƒçš„å†…æ ¸ã€‚ä¸ºäº†ç®€æ´, æˆ‘ç§»é™¤äº†å¤§çº¦ä¸€åŠä»£ç :é‚£éƒ¨åˆ†æ˜¯å¤„ç†å‰¯è¯çš„, ç›®å‰æˆ‘ä»¬ä¸èƒ½åœ¨æˆ‘ä»¬çš„ä»£ç ä¸­ä½¿ç”¨å®ƒã€‚\ntoken babble($l, @base_tweaks?) {:my @extra_tweaks;# \u0026lt;irrelevant portion redacted\u0026gt; $\u0026lt;B\u0026gt;=[\u0026lt;?before.\u0026gt;]{ # Work out the delimeters. my $c := $/.CURSOR; my @delims := $c.peek_delimiters($c.target, $c.pos); my $start := @delims[0]; my $stop := @delims[1]; # Get the language. my $lang := self.quote_lang($l, $start, $stop, @base_tweaks, @extra_tweaks); $\u0026lt;B\u0026gt;.\u0026#39;!make\u0026#39;([$lang, $start, $stop]); }} æˆ‘ä»¬é€šè¿‡æŠŠå‘å‰æŸ¥çœ‹æ•è·åˆ° $\u0026lt;B\u0026gt; æ•è·ä¸­å¼€å§‹, å®ƒç”¨ä½œæ›´æ–°å½“å‰çš„ Cursor ä½ç½®, ç„¶åè¿›å…¥ä»¥æ‰§è¡Œé‚£ä¸ªä»£ç å—ã€‚æˆ‘ä»¬æŠŠå½“å‰çš„ Cursor å­˜å‚¨åœ¨ $c ä¸­, ç„¶ååœ¨å®ƒèº«ä¸Šè°ƒç”¨ .peek_delimiters æ–¹æ³•ã€‚å¦‚æœæˆ‘ä»¬ä¸ºäº†å®ƒåœ¨å†…ç½®çš„ rakudo ç›®å½•ä¸­è¿›è¡Œ grep, æˆ‘ä»¬ä¼šçœ‹åˆ°å®ƒè¢«å®šä¹‰åœ¨ NQPä¸­, åœ¨ nqp/src/HLL/Grammar.nqpä¸­, ä½†æ˜¯åœ¨æˆ‘ä»¬å†²å‡ºå»é˜…è¯»å®ƒçš„ä»£ç ä¹‹å‰, æ³¨æ„å®ƒæ˜¯æ€æ ·è¿”å›ä¸¤ä¸ªåˆ†éš”ç¬¦çš„ã€‚æˆ‘ä»¬ä»…ä»…æŠŠå®ƒä»¬æ‰“å°å‡ºæ¥å¥½äº†?\nsrc/Raku/Grammar.nqp çš„ .nqp åç¼€åè¡¨æ˜æˆ‘ä»¬æ­£å¤„åœ¨ NQP çš„åœ°ç›˜å„¿, æ‰€ä»¥æˆ‘ä»¬ä¸è¦ä½¿ç”¨ NQP opsä»…ä»…å¹¶ä¸”ä¸æ˜¯å®Œå…¨çš„ Raku ä»£ç ã€‚é€šè¿‡æŠŠä¸‹é¢è¿™ä¸€è¡Œä»£ç æ·»åŠ åˆ° @delim è¢«èµ‹å€¼ç»™ $start å’Œ $stop çš„åœ°æ–¹, æˆ‘ä»¬èƒ½æ‰¾å‡º .peek_delimiters ç»™æˆ‘ä»¬çš„ä¸œè¥¿:\nnqp::say(\u0026#34;$sart$stop\u0026#34;); ç¼–è¯‘!\n$ perl Configure.pl --gen-moar --gen-nqp --backends=moar \u0026amp;\u0026amp; make \u0026amp;\u0026amp; make test \u0026amp;\u0026amp; make install å³ä½¿åœ¨ç¼–è¯‘æœŸé—´, é€šè¿‡åå‡ºé¢å¤–çš„ä¸œè¥¿, æˆ‘ä»¬çš„è°ƒè¯•è¡Œå·²ç»ç»™äº†æˆ‘ä»¬æ‰€æœ‰é‚£äº›åˆ†éš”ç¬¦æ˜¯å…³äºä»€ä¹ˆçš„å¯å‘ã€‚å†æ¬¡è¿è¡Œæˆ‘ä»¬çš„æœ‰é—®é¢˜çš„ä»£ç :\n$ ./raku -e \u0026#39;.say for qww\u0026lt;â€hello worldâ€\u0026gt;;\u0026#39; \u0026lt; \u0026gt; hello world æ‰“å°å‡ºçš„åˆ†éš”ç¬¦æ˜¯ qww é‡Œçš„å°–æ‹¬å·åˆ†éš”ç¬¦ã€‚æˆ‘ä»¬å¯¹é‚£äº›ä¸æ„Ÿå…´è¶£, æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¿½ç•¥ .peek_delimiters å¹¶ç»§ç»­ã€‚å†å¾€ä¸Šæ˜¯ .quote_lang æ–¹æ³•ã€‚ å®ƒçš„åå­—é‡Œæœ‰ä¸€ä¸ª\u0026quot;å¼•å·\u0026quot;è€Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå…³äºå¼•å·çš„é—®é¢˜.. å¬èµ·æ¥æˆ‘ä»¬ç¦»çœŸç›¸è¶Šæ¥è¶Šè¿‘äº†ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹æˆ‘ä»¬æ­£ä¼ é€’ç»™å®ƒçš„æ˜¯ä»€ä¹ˆå‚æ•°:\n $1 â€” Quote language braid $start / $stop â€” å°–æ‹¬å·åˆ†éš”ç¬¦ @base_tweaks â€” åŒ…å«ä¸€ä¸ªå…ƒç´ : å­—ç¬¦ä¸² ww @extra_tweaks â€” é¢å¤–çš„å‰¯è¯, è¿™é‡Œæˆ‘ä»¬æ²¡æœ‰, æ‰€ä»¥è¿™ä¸ªæ•°ç»„æ˜¯ç©ºçš„  å®šä½åˆ° method quote_lang; å®ƒä»ç„¶åœ¨ src/Raku/Grammar.nqpæ–‡ä»¶ä¸­:\nmethod quote_lang($l, $start, $stop, @base_tweaks?, @extra_tweaks?) { sub lang_key() { # \u0026lt;body redacted\u0026gt; } sub con_lang() { # \u0026lt;body redacted\u0026gt; } # Get language from cache or derive it. my $key := lang_key(); nqp::existskey(%quote_lang_cache, $key) \u0026amp;\u0026amp; $key ne \u0026#39;NOCACHE\u0026#39; ?? %quote_lang_cache{$key} !! (%quote_lang_cache{$key} := con_lang()); } æˆ‘ä»¬æœ‰ä¸¤ä¸ªè¯æ³•å­ä¾‹ç¨‹ lang_key å’Œ con_lang, åœ¨å®ƒä»¬ä¸‹é¢æˆ‘ä»¬æŠŠ lang_key çš„è¾“å‡ºå­˜å‚¨åˆ° $key ä¸­, åœ¨ %quote_lang_cache ä¸­è¿™ä¸ª $key è¢«ç”¨åœ¨æ•´ä¸ªç¼“å­˜ dance ä¸­, æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¿½ç•¥æ‰ lang_key sub å¹¶ç›´æ¥è¿›å…¥ con_lang, å®ƒè¢«è°ƒç”¨ä»¥ç”Ÿæˆæˆ‘ä»¬çš„ quote_lang æ–¹æ³•çš„è¿”å›å€¼:\nsub con_lang() { my $lang := $l.\u0026#39;!cursor_init\u0026#39;(self.orig(), :p(self.pos()), :shared(self.\u0026#39;!shared\u0026#39;())); for @base_tweaks { $lang := $lang.\u0026#34;tweak_$_\u0026#34;(1); } for @extra_tweaks { my $t := $_[0]; if nqp::can($lang, \u0026#34;tweak_$t\u0026#34;) { $lang := $lang.\u0026#34;tweak_$t\u0026#34;($_[1]); } else { self.sorry(\u0026#34;Unrecognized adverb: :$t\u0026#34;); } } nqp::istype($stop,VMArray) || $start ne $stop ?? $lang.balanced($start, $stop) !! $lang.unbalanced($stop); } åœ¨åˆå§‹åŒ– Cursor ä½ç½®ä¹‹å, $lang ç»§ç»­åŒ…å«æˆ‘ä»¬çš„ Quote è¯­è¨€ç¼–ç»‡ç„¶åæˆ‘ä»¬è½è¿›ä¸€ä¸ª for å¾ªç¯æ¥è¿­ä»£ @base_tweaks, å¯¹äºé‡Œé¢çš„æ¯ä¸€ä¸ªå…ƒç´ , æˆ‘ä»¬éƒ½è°ƒç”¨æ–¹æ³• tweak_$_, ç»™å®ƒä¼ é€’ä¸€ä¸ªçœŸå€¼ 1ã€‚å› ä¸ºæˆ‘ä»¬ä»…ä»…åªæœ‰ä¸€ä¸ª base tweak, è¿™æ„å‘³ç€æˆ‘ä»¬æ­£åœ¨Quote braidä¸Šè°ƒç”¨æ–¹æ³• tweak_wwã€‚æˆ‘ä»¬æ¥çœ‹çœ‹é‚£ä¸ªæ–¹æ³•æ˜¯å…³äºä»€ä¹ˆçš„ã€‚\nå› ä¸º Quote braid è¢«å®šä¹‰åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­, ä»…ä»…æœç´¢ method tweak_ww å¥½äº†:\nmethod tweak_ww($v) { $v ?? self.add-postproc(\u0026#34;quotewords\u0026#34;).apply_tweak(ww) !! self } å¾ˆå¥½ã€‚æˆ‘ä»¬ç»™å®ƒçš„ $v ä¸ºçœŸ, æ‰€ä»¥æˆ‘ä»¬è°ƒç”¨äº† .add-postproc ç„¶åè°ƒç”¨ .apply_tweak(ww)ã€‚çœ‹ä¸€ä¸‹é‚£ä¸ªæ–¹æ³•çš„ä¸Šé¢å’Œä¸‹é¢, æˆ‘ä»¬çœ‹åˆ° .add-postproc ä¹Ÿç”¨åœ¨å…¶å®ƒä¸å« bug çš„å¼•å·ä¸­, æ‰€ä»¥æˆ‘ä»¬å¿½ç•¥å®ƒå¹¶ç›´æ¥è·³åˆ° .apply_tweak:\nmethod apply_tweak($role) { my $target := nqp::can(self, \u0026#39;herelang\u0026#39;) ?? self.herelang !! self; $target.HOW.mixin($target, $role); self } å•Šå“ˆ! å®ƒçš„å‚æ•°æ˜¯ä¸€ä¸ª role å¹¶ä¸”å®ƒæŠŠè¯¥ role æ··è¿›æ¥æˆ‘ä»¬çš„ Quote braid ä¸­ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹é‚£ä¸ª role æ˜¯å…³äºä»€ä¹ˆçš„(å†ä¸€æ¬¡, ä»…ä»…åœ¨æ–‡ä»¶ä¸­æœç´¢ role ww, æˆ–è€…ä»…ä»…å‘ä¸Šæ»šåŠ¨ä¸€ç‚¹):\nrole ww { token escape:sym\u0026lt;\u0026#39; \u0026#39;\u0026gt; {\u0026lt;?[\u0026#39;]\u0026gt;\u0026lt;quote=.LANG(\u0026#39;MAIN\u0026#39;,\u0026#39;quote\u0026#39;)\u0026gt;} token escape:sym\u0026lt;â€˜ â€™\u0026gt; {\u0026lt;?[â€˜]\u0026gt;\u0026lt;quote=.LANG(\u0026#39;MAIN\u0026#39;,\u0026#39;quote\u0026#39;)\u0026gt;} token escape:sym\u0026lt;\u0026#34; \u0026#34;\u0026gt; {\u0026lt;?[\u0026#34;]\u0026gt;\u0026lt;quote=.LANG(\u0026#39;MAIN\u0026#39;,\u0026#39;quote\u0026#39;)\u0026gt;} token escape:sym\u0026lt;â€œ â€\u0026gt; {\u0026lt;?[â€œ]\u0026gt;\u0026lt;quote=.LANG(\u0026#39;MAIN\u0026#39;,\u0026#39;quote\u0026#39;)\u0026gt;} token escape:sym\u0026lt;colonpair\u0026gt; {\u0026lt;?[:]\u0026gt;\u0026lt;!RESTRICTED\u0026gt;\u0026lt;colonpair=.LANG(\u0026#39;MAIN\u0026#39;,\u0026#39;colonpair\u0026#39;)\u0026gt;} token escape:sym\u0026lt;#\u0026gt; {\u0026lt;?[#]\u0026gt;\u0026lt;.LANG(\u0026#39;MAIN\u0026#39;, \u0026#39;comment\u0026#39;)\u0026gt;} } å¥¥, æˆ‘çš„å¤©å‘!å¼•å·! å¦‚æœè¿™ä¸ªåœ°æ–¹ä¸æ˜¯æˆ‘ä»¬ä¿®å¤ bug çš„åœ°æ–¹, é‚£ä¹ˆæˆ‘å°±æ˜¯ä¸€ä¸ªèŠ­è•¾èˆå¥³æ¼”å‘˜ã€‚ æˆ‘ä»¬æ‰¾åˆ°å®ƒäº†!\næˆ‘ä»¬å®šä½åˆ°çš„ role æŠŠè¿›äº†æŸäº› tokens æ··åˆè¿›äº†æˆ‘ä»¬æ­£ä½¿ç”¨çš„ Quote braid ä¸­æ¥è§£æ qww çš„å†…å®¹ã€‚æˆ‘ä»¬å¸¦æœ‰ bug çš„ â€â€ å¼•å·ç»„åˆæ˜æ˜¾ä¸åœ¨é‚£ä¸ªåˆ—è¡¨ä¸­ã€‚æˆ‘ä»¬æ¥æŠŠå®ƒæ·»åŠ è¿›å»!\ntoken escape:sym\u0026lt;â€ â€\u0026gt; {\u0026lt;?[â€]\u0026gt;\u0026lt;quote=.LANG(\u0026#39;MAIN\u0026#39;,\u0026#39;quote\u0026#39;)\u0026gt;} ç¼–è¯‘! è¿è¡Œæˆ‘ä»¬å¸¦æœ‰ bug çš„ä»£ç :\n$ ./raku -e \u0026#39;.say for qww\u0026lt;foo â€hello worldâ€ bar\u0026gt;\u0026#39; foo bar æ‚²å‚¬! å¥½å§, æˆ‘ä»¬ç¡®å®ä¸ºå¼•å·å¤„ç†æ‰¾åˆ°äº†æ­£ç¡®çš„åœ°æ–¹, ä½†æ˜¯æˆ‘ä»¬è®©é—®é¢˜å˜å¾—æ›´åŠ ç³Ÿç³•äº†ã€‚å‘ç”Ÿäº†ä»€ä¹ˆ?\nQuotastic Inaction æˆ‘ä»¬æ–°çš„ token è‚¯å®šè§£æäº†é‚£ä¸ªå¼•å·, ä½†æ˜¯æˆ‘ä»¬ç»å¯¹æ²¡æœ‰ç»™å®ƒæ·»åŠ  Actions åŠ¨ä½œ\u0026hellip; å¥½å§, å¯¹å®ƒèµ·ä½œç”¨ã€‚Action ç±»å’Œ Grammars ç›¸é‚», åœ¨ src/Raku/Actions.nqp ä¸­ã€‚æ‰“å¼€å®ƒå¹¶å®šä½åˆ°åŒ¹é…çš„æ–¹æ³•é‚£é‡Œ; æ¯”å¦‚ method escape:sym\u0026lt;â€œ â€\u0026gt;ã€‚\nmethod escape:sym\u0026lt;\u0026#39; \u0026#39;\u0026gt;($/) { make mark_ww_atom($\u0026lt;quote\u0026gt;.ast); } method escape:sym\u0026lt;\u0026#34; \u0026#34;\u0026gt;($/) { make mark_ww_atom($\u0026lt;quote\u0026gt;.ast); } method escape:sym\u0026lt;â€˜ â€™\u0026gt;($/) { make mark_ww_atom($\u0026lt;quote\u0026gt;.ast); } method escape:sym\u0026lt;â€œ â€\u0026gt;($/) { make mark_ww_atom($\u0026lt;quote\u0026gt;.ast); } å¹¶åœ¨åˆ—è¡¨ä¸­æ·»åŠ æˆ‘ä»¬è‡ªå·±çš„ç‰ˆæœ¬:\nmethod escape:sym\u0026lt;â€ â€\u0026gt;($/) { make mark_ww_atom($\u0026lt;quote\u0026gt;.ast); } ç¼–è¯‘! è¿è¡Œæˆ‘ä»¬å¸¦æœ‰ bug çš„ä»£ç :\n$ ./raku -e \u0026#39;.say for qww\u0026lt;foo â€hello worldâ€ bar\u0026gt;\u0026#39; foo hello world bar å‘¼! æˆåŠŸäº†! ä¸å†æœ‰ bug äº†ã€‚æˆ‘ä»¬ä¿®å¤äº†é‚£ä¸ª bug!\nä½†æ˜¯, ç­‰ä¸€ä¸‹\u0026hellip;\né—æ¼äº†, ä½†æ˜¯æ²¡æœ‰å¿˜è®° çœ‹ä¸€ä¸‹æ‰€æœ‰å¯èƒ½çš„å¥¢åçš„å¼•å·çš„åˆ—è¡¨ã€‚å°½ç®¡æˆ‘ä»¬çš„ bug æŠ¥å‘Šä¸­ä»…ä»…æåˆ°äº† â€â€ å¼•å·å¯¹å„¿, ä½†æ˜¯ â€šâ€˜ å’Œ ã€Œã€ éƒ½ä¸åœ¨æˆ‘ä»¬çš„ role ww tokens ä¸­ã€‚è¿œè¿œä¸æ­¢çš„æ˜¯, æŸäº›å·¦/å³å¼•å·, å½“å®ƒä»¬äº¤æ¢ä½ç½®å, åœ¨å¼•èµ·å­—ç¬¦ä¸²çš„æ—¶å€™ä¹Ÿåˆšå¥½èƒ½å·¥ä½œ, æ‰€ä»¥å®ƒä»¬ä¹Ÿåº”è¯¥åœ¨ qww ä¸­èµ·æ•ˆã€‚ç„¶è€Œ, æ·»åŠ ä¸€æ•´ä¸²é¢å¤–çš„ tokens å’Œä¸€æ•´ä¸²å…¶å®ƒçš„ actions æ–¹æ³•æ˜¯ç›¸å½“ä¸ç²¾å½©çš„ã€‚æœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•?\næˆ‘ä»¬ä»”ç»†çœ‹çœ‹æˆ‘ä»¬çš„ tokens:\ntoken escape:sym\u0026lt;â€œ â€\u0026gt; {\u0026lt;?[â€œ]\u0026gt;\u0026lt;quote=.LANG(\u0026#39;MAIN\u0026#39;,\u0026#39;quote\u0026#39;)\u0026gt;} sym\u0026lt;â€œ â€\u0026gt; æˆ‘ä»¬å¯ä»¥æŠŠå®ƒçœç•¥äº† â€” è¿™é‡Œå®ƒçš„åŠŸèƒ½ä»…ä»…æ˜¯ä½œä¸ºä¸€ä¸ªåå­—ã€‚æˆ‘ä»¬ç•™ä¸‹çš„æ˜¯ä¸€ä¸ªå‘å‰æŸ¥çœ‹çš„ â€œ å¼•å·è¿˜æœ‰ \u0026lt;quote=.LANG('MAIN','quote')\u0026gt;ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å‘å‰æŸ¥çœ‹æ‰€æœ‰çš„æˆ‘ä»¬å…³å¿ƒçš„å¼€å£å¼•å·å¹¶è®© MAIN braid æ¥ç®¡æ‰€æœ‰çš„ç»†èŠ‚ã€‚\næ‰€ä»¥, è®©æˆ‘ä»¬ç”¨è¿™ä¸ªå•ä¸ª token æ›¿æ¢æ‰æ‰€æœ‰çš„å¼•å·å¤„ç† tokens:\ntoken escape:sym\u0026lt;\u0026#39;\u0026gt; {\u0026lt;?[\u0026#39; \u0026#34; â€˜ â€š â€™ â€œ â€ â€ ã€Œ ]\u0026gt;\u0026lt;quote=.LANG(\u0026#39;MAIN\u0026#39;,\u0026#39;quote\u0026#39;)\u0026gt;} å¹¶ä¸”ä½¿ç”¨ä¸‹é¢è¿™ä¸ªå•ä¸ª action æ›¿æ¢æ‰æ‰€æœ‰çš„åŒ¹é… actions æ–¹æ³•:\nmethod escape:sym\u0026lt;\u0026#39;\u0026gt;($/) { make mark_ww_atom($\u0026lt;quote\u0026gt;.ast); } ç¼–è¯‘! è¿è¡Œæˆ‘ä»¬çš„å¸¦æœ‰æŸäº›å¼•å·å˜ä½“çš„ä»£ç :\n$ ./raku -e \u0026#39;.say for qww\u0026lt;â€looks likeâ€ â€šwe fixedâ€˜ ï½¢this thingï½£\u0026gt;\u0026#39; looks like we fixed this thing ç²¾å½©! æˆ‘ä»¬ä¸ä»…è®©æ‰€æœ‰çš„å¼•å·éƒ½èƒ½æ­£å¸¸å·¥ä½œ, è¿˜è®¾æ³•æ¸…ç†çš„å­˜åœ¨çš„ tokens å’Œ actions æ–¹æ³•ã€‚ç°åœ¨æ‰€æœ‰æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å¯¹æˆ‘ä»¬çš„ä¿®å¤åšæµ‹è¯•å¹¶ä¸”æˆ‘ä»¬å·²ç»å‡†å¤‡æäº¤äº†ã€‚\näº«ç”¨ bug çƒ¤è‚‰ Raku å®˜æ–¹æµ‹è¯•å¥—ä»¶ Roast æ˜¯åœ¨ Rakudo å†…å»ºç›®å½•ä¸­çš„ t/spec ä¸­ï¼Œå¦‚æœå®ƒä¸å­˜åœ¨, ä»…ä»…è¿è¡Œ make spectest å°±å¥½äº†å¹¶ä¸”åœ¨å®ƒæŠŠ roast ä»“åº“å…‹éš†åˆ° t/spec ä¸­åå°±ä¸­æ­¢å®ƒã€‚æˆ‘ä»¬éœ€è¦æ‰¾åˆ°åœ¨å“ªé‡Œæ’å…¥æˆ‘ä»¬çš„æµ‹è¯•è€Œ grep æ˜¯å¹²é‚£ä»¶äº‹çš„å¥½æœ‹å‹:\nzoffix@VirtualBox:~/CPANPRC/rakudo/t/spec$ grep -R 'qww' . Binary file ./.git/objects/pack/pack-5bdee39f28283fef4b500859f5b288ea4eec20d7.pack matches ./S02-literals/allomorphic.t: my @wordlist = qqww[1 2/3 4.5 6e7 8+9i] Z (IntStr, RatStr, RatStr, NumStr, ComplexStr); ./S02-literals/allomorphic.t: isa-ok $val, Str, \u0026quot;'$val' from qqww[] is a Str\u0026quot;; ./S02-literals/allomorphic.t: nok $val.isa($wrong-type), \u0026quot;'$val' from qqww[] is not a $wrong-type.perl()\u0026quot;; ./S02-literals/allomorphic.t: my @wordlist = qqww:v[1 2/3 4.5 6e7 8+9i]; ./S02-literals/allomorphic.t: my @written = qqww:v[1 2/3 $num 6e7 8+9i ten]; ./S02-literals/allomorphic.t: is-deeply @angled, @written, \u0026quot;Â«...Â» is equivalent to qqww:v[...]\u0026quot;; ./S02-literals/quoting.t: is(qqww[$alpha $beta], \u0026lt;foo bar\u0026gt;, 'qqww'); ./S02-literals/quoting.t: for (\u0026lt;\u0026lt;$a b c\u0026gt;\u0026gt;, qqww{$a b c}, qqw{$a b c}).kv -\u0026gt; $i, $_ { ./S02-literals/quoting.t: is-deeply qww\u0026lt;a a â€˜b bâ€™ â€šb bâ€™ â€™b bâ€˜ â€™b bâ€˜ â€™b bâ€™ â€šb bâ€˜ â€šb bâ€™ â€œb bâ€ â€b bâ€ ./S02-literals/quoting.t: 'fancy quotes in qww work just like regular quotes'; ./integration/advent2014-day16.t: for flat qww/ foo bar 'first second' / Z @a -\u0026gt; $string, $result { çœ‹èµ·æ¥ S02-literals/quoting.t æ˜¯å®ƒçš„ä¸€ä¸ªå¥½åœ°æ–¹ã€‚æ‰“å¼€é‚£ä¸ªæ–‡ä»¶, åœ¨å®ƒçš„é¡¶éƒ¨, é€šè¿‡æˆ‘ä»¬æ·»åŠ çš„æµ‹è¯•çš„æ•°é‡æ¥å¢åŠ  plan çš„æ•°é‡ â€” åœ¨è¿™ä¸ªä¾‹å­ä¸­ä»…ä»…å¢åŠ ä¸€æ¡å°±å¥½äº†ã€‚ç„¶åæ»šåŠ¨åˆ°åº•éƒ¨å¹¶åˆ›å»ºä¸€ä¸ª block å—, å‰é¢æ·»åŠ ä¸€ä¸ªæ³¨é‡Š, å¹¶ä¸ºæˆ‘ä»¬æ­£ä¿®å¤çš„ bug æŠ¥å‘Šå¼•ç”¨é‚£ä¸ª RT æ ‡ç­¾æ•°å­—ã€‚\nåœ¨æ–‡ä»¶é‡Œé¢, æˆ‘ä»¬ä½¿ç”¨ is-deeply æµ‹è¯•å‡½æ•°, å®ƒä½¿ç”¨ eqv æ“ä½œç¬¦è¯­ä¹‰æ¥åšæµ‹è¯•ã€‚æˆ‘ä»¬ä¼šç»™å®ƒä¸€ä¸ªå¸¦æœ‰å®Œæ•´å¼•å·ä¸²çš„ qww\u0026lt;\u0026gt; è¡Œå¹¶å‘Šè¯‰å®ƒæˆ‘ä»¬æ‰€æœŸæœ›è¿”å›çš„é¡¹ç›®åˆ—è¡¨ã€‚è¿˜è¦å†™ä¸‹æµ‹è¯•æè¿°:\n# RT #128304 { is-deeply qww\u0026lt;a a â€˜b bâ€™ â€šb bâ€™ â€™b bâ€˜ â€™b bâ€˜ â€™b bâ€™ â€šb bâ€˜ â€šb bâ€™ â€œb bâ€ â€b bâ€ â€b bâ€œ â€b bâ€œ â€b bâ€ â€b bâ€œ â€b bâ€ ï½¢b bï½£ ï½¢b bï½£\u0026gt;, (\u0026#39;a\u0026#39;, \u0026#39;a\u0026#39;, |(\u0026#39;b b\u0026#39; xx 16)), \u0026#39;fancy quotes in qww work just like regular quotes\u0026#39;; } è¿”å›åˆ° Rakudo checkout, è¿è¡Œä¿®æ”¹åçš„æµ‹è¯•å¹¶ä¿è¯å®ƒé€šè¿‡:\n$ make t/spec/S02-literals/quoting.t # \u0026lt;lots of output\u0026gt; All tests successful. Files=1, Tests=185, 3 wallclock secs ( 0.03 usr 0.01 sys + 2.76 cusr 0.11 csys = 2.91 CPU) Result: PASS æ¼‚äº®ã€‚æäº¤æµ‹è¯• bug ä¿®å¤å¥½äº†å¹¶ä¸”æŠŠå®ƒä»¬é€èµ°! æˆ‘ä»¬åšåˆ°äº†!\nç»“è®º å½“æˆ‘ä»¬åœ¨ä¿®å¤ Raku ä¸­çš„è§£æ bugs çš„æ—¶å€™, æŠŠç¨‹åºå‡å°‘åˆ°èƒ½é‡æ–°äº§ç”Ÿé‚£ä¸ª bug çš„æœ€å°éƒ¨åˆ†ç„¶åä½¿ç”¨ --target=parse å‘½ä»¤è¡Œå‚æ•°, å¾—åˆ°è§£ææ ‘çš„è¾“å‡º, æ‰¾åˆ°æ‰€åŒ¹é…çš„é‚£ä¸ª tokensã€‚statementlist\nç„¶å, åœ¨ src/Raku/Grammar.nqp ä¸­è·Ÿéšè¿™äº› tokens, å®ƒä¹Ÿç»§æ‰¿è‡ª NQP çš„ src/HLL/Grammar.nqp ã€‚ ä¸ä½äº src/Raku/Actions.nqp ä¸­çš„ actions ç±»åä½œ, è·Ÿéšç€ä»£ç æ‰¾å‡ºæ­£åœ¨åšä»€ä¹ˆå¹¶æœŸæœ›æ‰¾å‡ºé—®é¢˜å‡ºç°åœ¨ä»€ä¹ˆä½ç½®ã€‚\nä¿®å¤å®ƒã€‚æµ‹è¯•å®ƒã€‚å‘å¸ƒå®ƒã€‚\nå……æ»¡äº†ä¹è¶£ã€‚\nhttp://raku.party/post/Perl-6-Core-Hacking-Grammatical-Babble\n","permalink":"https://ohmyweekly.github.io/notes/2016-01-01-raku-core-hacking-grammatical-babble/","tags":["grammar"],"title":"Raku æ ¸å¿ƒé­”æ”¹: Grammar çš„èƒ¡è¨€ä¹±è¯­"},{"categories":["rakulang"],"contents":"å¯¹äº Raku ç¨‹åºå‘˜, .rotor æ˜¯ä¸€ä¸ªå¼ºå¤§çš„åˆ—è¡¨æ“ä½œå·¥å…·ã€‚\nåˆ†æ®µ æœ€ç®€å•çš„, .rotor æ¥æ”¶ä¸€ä¸ªæ•´æ•° $number å¹¶æŠŠåˆ—è¡¨åˆ†æˆå¤šä¸ªå­åˆ—è¡¨, æ¯ä¸ªå­åˆ—è¡¨å«æœ‰ $number ä¸ªå…ƒç´ :\nsay \u0026lt;a b c d e f g h\u0026gt;.rotor: 3 # ((a b c) (d e f)) æˆ‘ä»¬æœ‰ä¸€ä¸ªå«æœ‰ 8 ä¸ªå…ƒç´ çš„åˆ—è¡¨, æˆ‘ä»¬åœ¨è¯¥åˆ—è¡¨ä¸Šè°ƒç”¨æ¥æ”¶å‚æ•° 3 çš„ .rotor æ–¹æ³•, å®ƒè¿”å› 2 ä¸ªåˆ—è¡¨, æ¯ä¸ªåˆ—è¡¨ä¸­å«æœ‰ 3 ä¸ªå…ƒç´ ã€‚ä¸åŒ…æ‹¬åŸåˆ—è¡¨ä¸­çš„æœ€å 2 ä¸ªå…ƒç´ , å› ä¸ºå®ƒä»¬æ²¡æœ‰ç»„æˆä¸€ä¸ªå®Œæ•´çš„3ä¸ªå…ƒç´ çš„åˆ—è¡¨ã€‚ç„¶è€Œå®ƒä»¬å¯ä»¥è¢«åŒ…å«è¿›æ¥, ä½¿ç”¨ :partial å…·åå‚æ•°è®¾ç½®ä¸º True:\nsay \u0026lt;a b c d e f g h\u0026gt;.rotor: 3, :partial # ((a b c) (d e f) (g h)) say \u0026lt;a b c d e f g h\u0026gt;.rotor: 3, :partial(True) # ((a b c) (d e f) (g h)) say \u0026lt;a b c d e f g h\u0026gt;.rotor: 3, :partial(False) # ((a b c) (d e f)) ä¸‹é¢åº”ç”¨ä¸€ä¸‹æˆ‘ä»¬åˆšåˆšå­¦åˆ°çš„ã€‚æŠŠå­—ç¬¦ä¸²åˆ†æˆåˆ—å®½ç›¸ç­‰çš„å‡ æ®µ:\n\u0026#34;foobarberboorboozebazmeow\u0026#34;.comb.rotor(10, :partial)Â».joinÂ».say; # foobarberb # oorboozeba # zmeow åˆ†è¡Œç„¶åæ¯è¡Œå‰é¢æ·»åŠ  4 ä¸ªç©ºæ ¼:\n\u0026#34;foobarberboorboozebazmeow\u0026#34;.comb.rotor(10, :partial)Â».joinÂ».indent(4)Â».say; # foobarberb # oorboozeba # zmeow ä½†æ˜¯è¿™æœ€å¥½è¢«å†™ä¸º:\n\u0026#34;foobarberboorboozebazmeow\u0026#34;.comb(10)Â».say æ³¨æ„ç¼éš™ å‡è®¾ä½ æ­£åœ¨æ¥å—è¾“å…¥: ä½ å¾—åˆ°ä¸€ä¸ªå•è¯, å®ƒçš„æ³•è¯­ç¿»è¯‘å’Œå®ƒçš„è¥¿ç­ç‰™è¯­ç¿»è¯‘, ç­‰ä¸€å †å•è¯ã€‚ä½ åªæƒ³è¾“å‡ºç‰¹å®šè¯­è¨€, æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨æˆ‘ä»¬çš„åˆ—è¡¨ä¸­è·³è¿‡æŸäº›é¡¹ã€‚ .rotor æ¥æ‹¯æ•‘æ¥äº†!\næŒ‡å®šä¸€å¯¹å„¿(Pair)æ•´æ•°ä½œä¸º rotor çš„å‚æ•°ä¼šè®©æ¯ä¸ªåˆ—è¡¨ä¸­å«æœ‰ $key ä¸ªå…ƒç´ , æ¯ä¸ªåˆ—è¡¨ä¹‹é—´æœ‰ $value ä¸ªç©ºéš™ã€‚çœ‹ä¾‹å­æ›´ç®€å•ä¸€äº›:\nsay ^10 .rotor: 3 =\u0026gt; 1, :partial; # OUTPUT: ((0 1 2) (4 5 6) (8 9)) say ^10 .rotor: 2 =\u0026gt; 2, :partial; # OUTPUT: ((0 1) (4 5) (8 9)) ç¬¬ä¸€ä¸ªä¾‹å­æˆ‘ä»¬æŠŠç¼éš™è®¾ç½®ä¸º 1, ç¬¬äºŒä¸ªä¾‹å­æˆ‘ä»¬æŠŠç¼éš™å¢åŠ ä¸º 2ã€‚\nenum \u0026lt;English French Spanish\u0026gt;; say join \u0026#34;\u0026#34;, \u0026lt;Good Bon Buenos morning matin dÃ­as\u0026gt;[French..*].rotor: 1 =\u0026gt; 2; # OUTPUT: Bon matin å…¶ä¸­ [French..*] æ„æ€ä¸º [1..*], ä¾‹å­ä¸­ French è¢«æšä¸¾åŒ–ä¸ºæ•´æ•° 1ã€‚\né‡å  å½“æˆ‘ä»¬è®©ç¼éš™å˜ä¸ºè´Ÿæ•°çš„æ—¶å€™, åˆ†æ®µçš„åˆ—è¡¨ä¸­å°±ä¼šæœ‰å…ƒç´ é‡å :\nsay \u0026lt;a a b c c c d\u0026gt;.rotor: 2 =\u0026gt; -1 # OUTPUT: ((a a) (a b) (b c) (c c) (c c) (c d)) say \u0026lt;a a b c c c d\u0026gt;.rotor(2 =\u0026gt; -1).map: {$_[0] eq $_[1] ?? \u0026#34;same\u0026#34; !! \u0026#34;different\u0026#34;} # OUTPUT: (same different different same same different) å…¨åŠ›ä»¥èµ´ .rotor ä¸å•å•åªèƒ½æ¥å—å•ä¸ª Int å€¼æˆ– Pair, ä½ å¯ä»¥æŒ‡å®šé¢å¤–çš„ Int æˆ– Pairs ä½ç½®å‚æ•°æ¥æŠŠåˆ—è¡¨åˆ†æˆä¸åŒå°ºå¯¸å¤§å°çš„å­åˆ—è¡¨, åˆ—è¡¨ä¹‹é—´çš„ç¼éš™ä¹Ÿä¸åŒã€‚ä¸‹é¢ä»¥ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶ä¸ºä¾‹:\nIP: 198.0.1.22 Login: suser Time: 1454017107 Resource: /report/accounting/x23gs Input: x=42,y=32 Output: success =================================================== IP: 198.0.1.23 Login: nanom Time: 1454027106 Resource: /report/systems/boot Input: mode=standard Output: success æ¯æ®µä¹‹é—´æœ‰ä¸€è¡ŒåŒåˆ’çº¿ã€‚\næˆ‘ä»¬æƒ³è¿™æ ·è¾“å‡º: Header é‡ŒåŒ…å« IP, Login, Time, Resource; Operation é‡ŒåŒ…å« Resource, Input, Outputã€‚\nfor \u0026#39;report.txt\u0026#39;.IO.linesÂ».indent(4).rotor( 4 =\u0026gt; -1, 3 =\u0026gt; 1 ) -\u0026gt; $head, $op { .say for \u0026#34;Header:\u0026#34;, |$head, \u0026#34;Operation:\u0026#34;, |$op, \u0026#39;\u0026#39;; } è¾“å‡º:\nHeader: IP: 198.0.1.22 Login: suser Time: 1454017107 Resource: /report/accounting/x23gs Operation: Resource: /report/accounting/x23gs Input: x=42,y=32 Output: success Header: IP: 198.0.1.23 Login: nanom Time: 1454027106 Resource: /report/systems/boot Operation: Resource: /report/systems/boot Input: mode=standard Output: success å…ˆæ˜¯ 4 ä¸ªå…ƒç´ ä¸€å—, ç¼éš™ä¸º -1(æœ‰é‡å ), ç„¶åæ˜¯ 3 ä¸ªå…ƒç´ ä¸€å—, ç¼éš™ä¸º 1ã€‚è¿™å°±åœ¨æ¯ä¸ªåˆ†æ®µçš„åˆ—è¡¨ä¸­åŒ…å«äº† Resource å­—æ®µã€‚å› ä¸º $op å’Œ $head æ˜¯åˆ—è¡¨, æˆ‘ä»¬ä½¿ç”¨ç®¡é“ç¬¦å· | æ¥å±•å¹³åˆ—è¡¨ã€‚\nè®°ä½, ä½ æä¾›ç»™ .rotor æ–¹æ³•çš„æ¨¡å¼å¯ä»¥åŠ¨æ€åœ°ç”Ÿæˆ! è¿™å„¿æˆ‘ä»¬ä½¿ç”¨ sin å‡½æ•°æ¥ç”Ÿæˆ:\nsay ^92 .rotor( (0.2, 0.4 ... 3).map: (10 * *.sin).Int # pattern we supply to .rotor ).join: \u0026#34;\\n\u0026#34;\u0026#39;è¾“å‡º:\n0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 å†ä¸¾ä¸ªä¾‹å­:\næˆ‘ç°åœ¨æƒ³è¦å°†åŒç±»çš„åºåˆ—ï¼ˆå­—ç¬¦ä¸²ï¼‰è¿›è¡Œåˆå¹¶ï¼Œæ¯”å¦‚æœ‰è¿™æ ·ä¸€ä¸ªæ–‡ä»¶ï¼š\n\u0026gt;seq-1A GACACAGTCACCCGAGCCT \u0026gt;seq-1B TCAATCAATACTGAAGCGA \u0026gt;seq-1C AAAACTAGTCGAGAAGAGAG \u0026gt;seq-1D CGTGGAAAACTCCAG \u0026gt;seq-2A TAAAAGGCGTTCATTGGATATTTC \u0026gt;seq-2B ACTGGCAGTGCATCC æˆ‘æƒ³è¦è¿›è¡Œåˆå¹¶ å¾—åˆ°è¿™æ ·çš„ç»“æœï¼š\n\u0026gt;seq-1 GACACAGTCACCCGAGCCTTCAATCAATACTGAAGCGAAAAACTAGTCGAGAAGAGAGCGTGGAAAACTCCAG \u0026gt;seq-2 TAAAAGGCGTTCATTGGATATTTCACTGGCAGTGCATCC ä½¿ç”¨ rotor æ¥å®ç°:\nmy %re; for \u0026#39;input.txt\u0026#39;.IO.linesÂ».rotor(2, :partial) -\u0026gt; $header, $data { my $key = $header; $key ~~ s/\u0026lt;upper\u0026gt;$//; %re{$key} ~= $data; } for %re.kv -\u0026gt; $key, $value { say \u0026#34;$key\\n$value\u0026#34;; } å®˜ç½‘çš„ä¾‹å­ method rotor(*@cycle, Bool() :$partial) rotor è¿”å›ä¸€ä¸ª list, è¿™ä¸ª list çš„å…ƒç´ ä¹Ÿæ˜¯ list, å…¶ä¸­æ¯ä¸ªå­åˆ—è¡¨ç”±è°ƒç”¨è€…ä¸­çš„å…ƒç´ ç»„æˆ. åœ¨æœ€ç®€å•çš„æƒ…å†µä¸‹, @cycle åªåŒ…å«ä¸€ä¸ªæ•´æ•°, è¿™æ—¶è°ƒç”¨è€…åˆ—è¡¨è¢«åˆ†å‰²ä¸ºå¤šä¸ªå­åˆ—è¡¨, æ¯ä¸ªå­åˆ—è¡¨ä¸­çš„å…ƒç´ å°½å¯èƒ½å¤šçš„ä¸ºé‚£ä¸ªæ•´æ•°æŒ‡å®šçš„ä¸ªæ•°. å¦‚æœ :$partial ä¸º True, ä¸å¤Ÿåˆ†çš„æœ€åé‚£éƒ¨åˆ†ä¹Ÿä¼šè¢«åŒ…æ‹¬è¿›å», å³ä½¿å®ƒä¸æ»¡è¶³é•¿åº¦çš„è¦æ±‚:\nsay (\u0026#39;a\u0026#39;..\u0026#39;h\u0026#39;).rotor(3).join(\u0026#39;|\u0026#39;); # a b c|d e f say (\u0026#39;a\u0026#39;..\u0026#39;h\u0026#39;).rotor(3, :partial).join(\u0026#39;|\u0026#39;); # a b c|d e f|g h å¦‚æœ @cycle çš„å…ƒç´ æ˜¯ä¸€ä¸ªÂ /type/Pair, åˆ™ Pair çš„é”®æŒ‡å®šäº†æ‰€è¿”å›å­åˆ—è¡¨çš„é•¿åº¦(å³æ¯ä¸ªå­åˆ—è¡¨ä¸­å«æœ‰çš„å…ƒç´ æ•°), Pair çš„é”®å€¼æŒ‡å®šä¸¤ä¸ªåˆ—è¡¨ä¹‹é—´çš„é—´éš™; è´Ÿçš„é—´éš™ä¼šäº§ç”Ÿé‡å :\nsay (\u0026#39;a\u0026#39;..\u0026#39;h\u0026#39;).rotor(2 =\u0026gt; 1).join(\u0026#39;|\u0026#39;); # a b|d e|g h say (\u0026#39;a\u0026#39;..\u0026#39;h\u0026#39;).rotor(3 =\u0026gt; -1).join(\u0026#39;|\u0026#39;); # a b c|c d e|e f g my $pair = 2 =\u0026gt; 1; my $key = $pair.key; my $value = $pair.value; say (\u0026#39;a\u0026#39;..\u0026#39;h\u0026#39;).rotor($key =\u0026gt; $value).join(\u0026#39;|\u0026#39;) # a b|d e|g h å¦‚æœ @cycle çš„å…ƒç´ ä¸ªæ•°å¤§äº 1 æ—¶, rotor ä¼šæŒ‰ @cycle ä¸­çš„å…ƒç´ ä¾æ¬¡å¾ªç¯è°ƒç”¨è€…åˆ—è¡¨, å¾—åˆ°æ¯ä¸ªå­åˆ—è¡¨:\nsay (\u0026#39;a\u0026#39;..\u0026#39;h\u0026#39;).rotor(2, 3).join(\u0026#39;|\u0026#39;); # a b|c d e|f g say (\u0026#39;a\u0026#39;..\u0026#39;h\u0026#39;).rotor(1 =\u0026gt; 1, 3).join(\u0026#39;|\u0026#39;); # a|c d e|f ç»„åˆå¤šä¸ªå¾ªç¯å‘¨æœŸå’Œ :partial ä¹Ÿæœ‰æ•ˆ:\nsay (\u0026#39;a\u0026#39;..\u0026#39;h\u0026#39;).rotor(1 =\u0026gt; 1, 3 =\u0026gt; -1, :partial).join(\u0026#39;|\u0026#39;); # a|c d e|e|g h æ³¨æ„, ä» rotor å‡½æ•°è¿”å›çš„ä¸€åˆ—åˆ—è¡¨ä»¬èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡æ—¶ä¼šå±•å¼€ä¸ºä¸€ä¸ªæ•°ç»„:\nmy @maybe_lol = (\u0026#39;a\u0026#39;..\u0026#39;h\u0026#39;).rotor(2 =\u0026gt; 1); @maybe_lol.raku.say; # [\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;d\u0026#34;, \u0026#34;e\u0026#34;, \u0026#34;g\u0026#34;, \u0026#34;h\u0026#34;]\u0026lt;\u0026gt; è¿™å¯èƒ½ä¸æ˜¯ä½ æƒ³è¦çš„, å› ä¸º rotor ä¹‹åçš„è¾“å‡ºçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:\nsay (\u0026#39;a\u0026#39;..\u0026#39;h\u0026#39;).rotor(2 =\u0026gt; 1).raku; # ((\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;), (\u0026#34;d\u0026#34;, \u0026#34;e\u0026#34;), (\u0026#34;g\u0026#34;, \u0026#34;h\u0026#34;)) è¦å¼ºåˆ¶è¿”å›åˆ—è¡¨çš„åˆ—è¡¨, ä½¿ç”¨ç»‘å®šè€Œéèµ‹å€¼:\nmy @really_lol := (\u0026#39;a\u0026#39;..\u0026#39;h\u0026#39;).rotor(2 =\u0026gt; 1); @really_lol.raku.say; # ((\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;), (\u0026#34;d\u0026#34;, \u0026#34;e\u0026#34;), (\u0026#34;g\u0026#34;, \u0026#34;h\u0026#34;)) ","permalink":"https://ohmyweekly.github.io/notes/2015-07-14-the-king-of-list-manipulation/","tags":["rotor"],"title":"rotor: åˆ—è¡¨æ“ä½œä¹‹ç‹"},{"categories":["rakulang"],"contents":"å°±åƒä½ æƒ³çš„é‚£æ ·, åœ¨ç±»çš„å®šä¹‰ä¸­å¯ä»¥å£°æ˜å’Œå®šä¹‰æ–¹æ³•ã€‚ä½ æœŸæœ›ä¸é«˜çš„ç”šè‡³æ–‡æ¡£ä¸­éƒ½å¾ˆå°‘æåŠæ˜¯ç”¨ my å…³é”®å­—å£°æ˜çš„å…è´¹æµ®ç‚¹æ–¹æ³•ã€‚ç°åœ¨ä¸ºä»€ä¹ˆä½ æƒ³è¦:\nmy method foo(SomeClass:D:) { self } æ˜æ˜¾çš„ç­”æ¡ˆæ˜¯å…ƒå¯¹è±¡åè®®ä¸­çš„ add_method æ–¹æ³•, åœ¨ Rakudo é‡Œä½ èƒ½æ‰¾åˆ°å®ƒï¼š\nsrc/core/Bool.pm 32: Bool.^add_method(\u0026#39;pred\u0026#39;, my method pred() { Bool::False }); 33: Bool.^add_method(\u0026#39;succ\u0026#39;, my method succ() { Bool::True }); 35: Bool.^add_method(\u0026#39;enums\u0026#39;, my method enums() { self.^enum_values }); è¿™ç§æ–¹æ³•è¿˜æœ‰å¦å¤–ä¸€ç§æ›´è¯¡å¼‚çš„ç”¨æ³•ã€‚ä½ å¯èƒ½å¾ˆæƒ³çŸ¥é“åœ¨é“¾å¼æ–¹æ³•è°ƒç”¨ä¸­ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆã€‚æˆ‘ä»¬å¯ä»¥æ‰¯å¼€æœ€ä¸Šé¢çš„é‚£ä¸ªè¡¨è¾¾å¼å¹¶æ’å…¥ä¸€ä¸ªçŸ­çš„å˜é‡, è¾“å‡ºæˆ‘ä»¬çš„è°ƒè¯•, å¹¶ä¸”ç»§ç»­é“¾å¼è°ƒç”¨ã€‚å¥½çš„åå­—å¾ˆé‡è¦å¹¶ä¸”æŠŠå®ƒä»¬æµªè´¹åœ¨ä¸€ä¸ªçŸ­å˜é‡ä¸Šæ²¡æœ‰å¿…è¦ã€‚\n\u0026lt;a b c\u0026gt;.\u0026amp;(my method ::(List:D) { dd self; self } ).say; # output # (\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;) # (a b c) æ²¡æœ‰æ˜¾å¼è°ƒç”¨æˆ‘ä»¬å°±ä¸èƒ½æ²¡æœ‰åå­—, å› ä¸º Raku ä¸å…è®¸æˆ‘ä»¬è¿™æ ·åš, æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨äº†ç©ºçš„ä½œç”¨åŸŸ :: ä»¥ä½¿è§£æå™¨é«˜å…´ã€‚ä½¿ç”¨ä¸€ä¸ªåˆé€‚çš„è°ƒç”¨, æˆ‘ä»¬å°±ä¸éœ€è¦å®ƒäº†ã€‚è¿˜æœ‰, é‚£ä¸ªåŒ¿åæ–¹æ³•ä¸æ˜¯ List ä¸­çš„ä¸€å‘˜ã€‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨åç¼€ .\u0026amp; æ¥è°ƒç”¨å®ƒã€‚å¦‚æœæˆ‘ä»¬éœ€è¦å¤šæ¬¡ä½¿ç”¨é‚£ä¸ªæ–¹æ³•æˆ‘ä»¬å¯ä»¥æŠŠå®ƒæ‹‰å‡ºæ¥å¹¶ç»™å®ƒä¸€ä¸ªåå­—ã€‚\nmy multi method debug(List:D:) { dd self; self }; \u0026lt;a b c\u0026gt;.\u0026amp;debug.say; # output (\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;) (a b c) æˆ–è€…, å¦‚æœæˆ‘ä»¬æƒ³å…è®¸å›è°ƒçš„è¯, æˆ‘ä»¬å¯ä»¥æŠŠå®ƒä½œä¸ºé»˜è®¤å‚æ•°èµ‹å€¼ã€‚\nsub f(@l, :\u0026amp;debug = my method (List:D:){self}) { @l.\u0026amp;debug.say }; f \u0026lt;a b c\u0026gt;, debug =\u0026gt; my method ::(List:D){dd self; self}; # output #(\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;) # (a b c) åœ¨ Raku ä¸­åŸºæœ¬ä¸Šæ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯ç±», åŒ…æ‹¬æ–¹æ³•ã€‚ å¦‚æœå®ƒæ˜¯ç±»å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡å¹¶ä¸”æˆ‘ä»¬èƒ½åœ¨æˆ‘ä»¬å–œæ¬¢çš„ä»»ä½•åœ°æ–¹æºœè¿›å»ã€‚\nhttps://gfldex.wordpress.com/2016/07/20/sneaky-methods/\n","permalink":"https://ohmyweekly.github.io/notes/2015-05-01-sneaky-methods/","tags":["method"],"title":"Sneaky Methods"},{"categories":["rakulang"],"contents":"Protocol åœ¨ Swift ä¸­æ˜¯ä¸€ç»„æ–¹æ³•å’Œå±æ€§çš„é›†åˆ, å¯ç”¨äºä»£ç å¤ç”¨ã€‚ Raku ä¸­æœ‰ä¸ä¹‹ç±»ä¼¼çš„ç»“æ„, å«åš Role, ä¸‹é¢è½¬æ¢ä¸€ä¸ª Swift çš„ Protocol ä¸º Raku çš„ Role, æŠŠéƒ¨é—¨äººå‘˜çš„ç›¸å…³ä¿¡æ¯æ‰“å°ä¸ºä¸€ä¸ªè¡¨æ ¼:\nProtocol in Swift ã€€import UIKit func padding(amount: Int) -\u0026gt; String { var paddingString = \u0026#34;\u0026#34; for _ in 0..\u0026lt;amount { paddingString += \u0026#34; \u0026#34; } return paddingString } // åè®® protocol TabularDataSource { var numberOfRows: Int { get } var numberOfColumns: Int { get } func labelForRow(row: Int) -\u0026gt; String // è¡Œæ ‡ç­¾ func labelForColumn(column: Int) -\u0026gt; String // åˆ—æ ‡ç­¾ func itemForRow(row: Int, column: Int) -\u0026gt; Int // è¡¨æ ¼ä¸­çš„å•å…ƒæ ¼ } struct Person { let name: String let age: Int let yearsOfExperience: Int } // è®© **Department** éµå®ˆ **TabularDataSource**åè®® struct Department: TabularDataSource { let name: String var people = [Person]() init(name: String) { self.name = name } mutating func addPerson(person: Person) { people.append(person) } // å®ç°åè®®ä¸­å£°æ˜çš„å±æ€§å’Œæ–¹æ³• var numberOfRows: Int { return people.count } var numberOfColumns: Int { return 2 } func labelForRow(row: Int) -\u0026gt; String { return people[row].name } func labelForColumn(column: Int) -\u0026gt; String { switch column { case 0: return \u0026#34;Age\u0026#34; case 1: return \u0026#34;Years of Experence\u0026#34; default: fatalError(\u0026#34;Invalid column!\u0026#34;) } } func itemForRow(row: Int, column: Int) -\u0026gt; Int { let person = people[row] // æŒ‡å®šçš„è¡Œ switch column { case 0: return person.age case 1: return person.yearsOfExperience default:fatalError(\u0026#34;Invalid column!\u0026#34;) } } } var deparment = Department(name: \u0026#34;Engineering\u0026#34;) deparment.addPerson(Person(name: \u0026#34;Joe\u0026#34;, age: 30, yearsOfExperience: 6)) deparment.addPerson(Person(name: \u0026#34;Karen\u0026#34;, age: 40, yearsOfExperience: 18)) deparment.addPerson(Person(name: \u0026#34;Fred\u0026#34;, age: 50, yearsOfExperience: 20)) // ä¼ å…¥ä¸€ä¸ªæ•°æ®æº func printTable(dataSource: TabularDataSource) { let rowLabels = (0 ..\u0026lt; dataSource.numberOfRows).map { dataSource.labelForRow($0) } let columnLabels = (0 ..\u0026lt; dataSource.numberOfColumns).map { dataSource.labelForColumn($0) } // åˆ›å»ºä¸€ä¸ªæ•°ç»„å­˜å‚¨æ¯ä¸ªè¡Œæ ‡ç­¾çš„å®½åº¦ let rowLabelWidths = rowLabels.map { $0.characters.count } // é™å®šè¡Œæ ‡ç­¾çš„æœ€å¤§é•¿åº¦ guard let maxRowLabelWidth = rowLabelWidths.maxElement() else { return } // åˆ›å»ºç¬¬ä¸€è¡Œ, åŒ…å«åˆ—æ ‡é¢˜ var firstRow = padding(maxRowLabelWidth) + \u0026#34; |\u0026#34; // è·Ÿè¸ªæ¯åˆ—çš„å®½åº¦ var columnWidths = [Int]() for columnLabel in columnLabels { let columnHeader = \u0026#34; \\(columnLabel) |\u0026#34; firstRow += columnHeader columnWidths.append(columnHeader.characters.count) } print(firstRow) for i in 0 ..\u0026lt; dataSource.numberOfRows { let paddingAmount = maxRowLabelWidth - rowLabelWidths[i] var out = rowLabels[i] + padding(paddingAmount) + \u0026#34; |\u0026#34; for j in 0 ..\u0026lt; dataSource.numberOfColumns { let item = dataSource.itemForRow(i, column: j) let itemString = \u0026#34; \\(item) |\u0026#34; let paddingAmount = columnWidths[j] - itemString.characters.count out += padding(paddingAmount) + itemString } print(out) } } printTable(deparment) å…¶ä¸­çš„è®¡ç®—å±æ€§åœ¨ Raku ä¸­å¯ä»¥ä½¿ç”¨é‡å†™å±æ€§çš„æ–¹æ³•æ¥å®Œæˆã€‚\nRole in Raku sub padding(Int $amount) { my $paddingString = \u0026#34;\u0026#34;; $paddingString ~= \u0026#34;\u0026#34; for 0 ..^ $amount; return $paddingString; } # å£°æ˜ä¸€ä¸ªæ¥å£, åªå®šä¹‰äº†æ–¹æ³•å’Œå±æ€§, æ²¡æœ‰åšå®ç° role TabularDataSource { has $.numberOfRows is rw; has $.numberOfColumns is rw; method labelForRow(Int $row) { ... } method labelForColumn(Int $column) { ... } method itemForRow(Int $row, Int $column) { ... } } class Person { has Str $.name; has Int $.age; has Int $.yearsOfExperience; } class Department does TabularDataSource { has $.name; has @.people; method new(Str $name) { self.bless(name =\u0026gt; $name); } # å®ç°æ¥å£ä¸­çš„æ–¹æ³• # é‡å†™æ–¹æ³• has $.numberOfRows å…¶å®æ˜¯ has $!numberOfRows åŠ ä¸Š method numberOfRows() { ... } æ–¹æ³•ã€‚ method numberOfRows() { return @!people.elems; } method numberOfColumns() { return 2; } method addPerson(Person $person) is rw { @!people.append($person); } # å¦‚æœç±»éµå®ˆäº†æŸä¸ª role ä½†æ˜¯æœªå®ç°å…¶ä¸­çš„æ–¹æ³•, åˆ™ä¼šæŠ¥é”™å¦‚ä¸‹: # Method \u0026#39;labelForRow\u0026#39; must be implemented by Department because it is required by a role method labelForRow(Int $row) { return @!people[$row].name; } method labelForColumn(Int $column) { given $column { when 0 { return \u0026#34;Age\u0026#34; } when 1 { return \u0026#34;Years of Experence\u0026#34; } default { die(\u0026#34;Invalid column!\u0026#34;)} } } method itemForRow(Int $row, Int $column) { my $person = @!people[$row]; given $column { when 0 { return $person.age } when 1 { return $person.yearsOfExperience } default { die(\u0026#34;Invalid column\u0026#34;) } } } } my $department = Department.new(\u0026#34;Engineering\u0026#34;); $department.addPerson(Person.new(name =\u0026gt; \u0026#34;Joe\u0026#34;, age =\u0026gt; 30, yearsOfExperience =\u0026gt; 6)); $department.addPerson(Person.new(name =\u0026gt; \u0026#34;Karen\u0026#34;, age =\u0026gt; 40, yearsOfExperience =\u0026gt; 18)); $department.addPerson(Person.new(name =\u0026gt; \u0026#34;Fred\u0026#34;, age =\u0026gt; 50, yearsOfExperience =\u0026gt; 20)); sub printTable(TabularDataSource $dataSource) { my @rowLabels = (0 ..^ $dataSource.numberOfRows ).map: { $dataSource.labelForRow($_)}; my @columnLabels = (0 ..^ $dataSource.numberOfColumns).map: {$dataSource.labelForColumn($_)}; my @rowLabelWidths = @rowLabels.map: {$_.chars}; my $maxRowLabelWidth = @rowLabelWidths.max // return; my $firstRow = padding($maxRowLabelWidth) ~ \u0026#34;|\u0026#34;; my @columnWidths; for @columnLabels -\u0026gt; $columnLabel { my $columnHeader = \u0026#34;$columnLabel|\u0026#34;; $firstRow ~= $columnHeader; @columnWidths.append($columnHeader.chars); } say($firstRow); for 0 ..^ $dataSource.numberOfRows -\u0026gt; $i { my $paddingAmount = $maxRowLabelWidth - @rowLabelWidths[$i]; my $out = @rowLabels[$i] ~ padding($paddingAmount) ~ \u0026#34;|\u0026#34;; for 0 ..^ $dataSource.numberOfColumns -\u0026gt; $j { my $item = $dataSource.itemForRow($i, $j); my $itemString = \u0026#34;$item|\u0026#34;; my $paddingAmount = @columnWidths[$j] - $itemString.chars; $out ~= padding($paddingAmount) ~ $itemString; } say($out); } } printTable($department); role ä¸­çš„ { ... } æ˜¯ yadayada æ“ä½œç¬¦, èµ·å ä½ä½œç”¨, è¡¨ç¤ºæ–¹æ³•ä¼šåœ¨åˆ«å¤„å®ç°ã€‚ç±»ä¸­çš„æ–¹æ³•åŒæ ·ä¹Ÿå¯ä»¥è¿™æ ·å£°æ˜ã€‚\næœ€åè¾“å‡º:\n | Age | Years of Experence | Joe | 30 | 6 | Karen | 40 | 18 | Fred | 50 | 20 | ","permalink":"https://ohmyweekly.github.io/notes/2016-01-21-protocol-in-swift-and-roles-in-raku/","tags":["roles"],"title":"Swift ä¸­çš„ protocol å’Œ Raku ä¸­çš„ roles ä¸€ä¾‹"},{"categories":["rakulang"],"contents":"ä¸‹æ ‡å‰¯è¯ ä¸ºäº†ä½¿åˆ‡ç‰‡ä¸‹æ ‡è¿”å›é™¤äº†å€¼ä»¥å¤–çš„å…¶å®ƒä¸œè¥¿ï¼Œé‚£ä¹ˆç»™ä¸‹æ ‡(subscript)æ·»åŠ åˆé€‚çš„å‰¯è¯ã€‚\n@array = \u0026lt;A B\u0026gt;; @array[0,1,2]; # returns \u0026#39;A\u0026#39;, \u0026#39;B\u0026#39;, (Any) @array[0,1,2] :p; # returns 0 =\u0026gt; \u0026#39;A\u0026#39;, 1 =\u0026gt; \u0026#39;B\u0026#39; @array[0,1,2] :kv; # returns 0, \u0026#39;A\u0026#39;, 1, \u0026#39;B\u0026#39; @array[0,1,2] :k; # returns 0, 1 @array[0,1,2] :v; # returns \u0026#39;A\u0026#39;, \u0026#39;B\u0026#39; %hash = (:a\u0026lt;A\u0026gt;, :b\u0026lt;B\u0026gt;); %hash\u0026lt;a b c\u0026gt;; # returns \u0026#39;A\u0026#39;, \u0026#39;B\u0026#39;, (Any) %hash\u0026lt;a b c\u0026gt; :p; # returns a =\u0026gt; \u0026#39;A\u0026#39;, b =\u0026gt; \u0026#39;B\u0026#39; %hash\u0026lt;a b c\u0026gt; :kv; # returns \u0026#39;a\u0026#39;, \u0026#39;A\u0026#39;, \u0026#39;b\u0026#39;, \u0026#39;B\u0026#39; %hash\u0026lt;a b c\u0026gt; :k; # returns \u0026#39;a\u0026#39;, \u0026#39;b\u0026#39; %hash\u0026lt;a b c\u0026gt; :v; # returns \u0026#39;A\u0026#39;, \u0026#39;B\u0026#39; å¦‚æœå‰¯è¯ä¸ºçœŸï¼Œé‚£ä¹ˆè¿™äº›å‰¯è¯å½¢å¼éƒ½ä¼šæ¸…é™¤ä¸å­˜åœ¨çš„æ¡ç›®ï¼›å¦‚æœä¸ºå‡çš„è¯ï¼Œå°±ä¼šç•™ä¸‹ä¸å­˜åœ¨çš„é¡¹ï¼Œå°±åƒæ™®é€šçš„åˆ‡ç‰‡é‚£æ ·ã€‚æ‰€ä»¥ï¼š\n@array[0,1,2] :!p; # returns 0 =\u0026gt; \u0026#39;A\u0026#39;, 1 =\u0026gt; \u0026#39;B\u0026#39;, 2 =\u0026gt; (Any) %hash\u0026lt;a b c\u0026gt; :!kv; # returns \u0026#39;a\u0026#39;, \u0026#39;A\u0026#39;, \u0026#39;b\u0026#39;, \u0026#39;B\u0026#39;, \u0026#39;c\u0026#39;, (Any) åŒæ ·åœ°ï¼Œ\nmy ($a,$b,$c) = %hash\u0026lt;a b c\u0026gt; :delete; åˆ é™¤é‚£äº›æ¡ç›®å¹¶é¡ºé“è¿”å›å®ƒä»¬ã€‚è¿™ç§å½¢å¼èƒ½å¤Ÿå·¥ä½œæ˜¯å› ä¸ºä¸‹æ ‡æ˜¯é¡¶ç«¯çš„åœ¨å‰çš„æ“ä½œç¬¦ã€‚å¦‚æœæŸäº›å…¶å®ƒçš„æ“ä½œç¬¦çš„ä¼˜å…ˆçº§æ¯”å¤„äºé¡¶ç«¯çš„é€—å·æ“ä½œç¬¦çš„ä¼˜å…ˆçº§ç´§å‡‘ï¼Œé‚£ä¹ˆä½ å¿…é¡»ç”¨æ‹¬å·æ‹¬èµ·å®ƒæˆ–å¼ºåˆ¶ä¸ºåˆ—è¡¨ä¸Šä¸‹æ–‡ï¼š\n1 + (%hash{$x} :delete); $x = (%hash{$x} :delete); ($x) = %hash{$x} :delete; åªæœ‰åœ¨å‰¯è¯ä¸ºçœŸçš„æ—¶å€™å…ƒç´ æ‰ä¼šè¢«åˆ é™¤ã€‚è€Œ :!delete æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç©ºæ“ä½œï¼›ä½ å¯ä»¥åŸºäºä¼ é€’çš„è¯¸å¦‚ :delete($kill'em) æ ‡è®°é¡ºå¸¦æœ‰æ¡ä»¶åœ°åˆ é™¤æ¡ç›®ã€‚åœ¨ä»»ä½•ä¸€ç§æƒ…å†µä¸‹ï¼Œè¢«åˆ é™¤çš„å€¼ä¼šè¢«è¿”å›ã€‚\nä½ ä¹Ÿå¯ä»¥æ‰§è¡Œå­˜åœ¨æ€§æµ‹è¯•ï¼Œè¦ä¹ˆæµ‹è¯•å•ä¸ªæ¡ç›®æ˜¯å¦å­˜åœ¨ï¼Œè¦ä¹ˆæµ‹è¯•æ¡ç›®çš„è¿æ¥æ˜¯å¦å­˜åœ¨ï¼š\nif %hash\u0026lt;foo\u0026gt; :exists {...} if %hash{any \u0026lt;a b c\u0026gt;} :exists {...} if %hash{all \u0026lt;a b c\u0026gt;} :exists {...} if %hash{one \u0026lt;a b c\u0026gt;} :exists {...} if %hash{none \u0026lt;a b c\u0026gt;} :exists {...} æŠŠ :exists å‰¯è¯å’Œä¸€ç»„åˆ‡ç‰‡ç»“æœçš„å¸ƒå°”å€¼åˆ—è¡¨ç»“åˆèµ·æ¥ä½¿ç”¨ï¼Œä½ ä¹Ÿå¯ä»¥ç”¨ç±»å‹çš„è¯­ä¹‰è¿™æ ·ä½¿ç”¨ï¼š\nif any %hash\u0026lt;a b c\u0026gt; :exists {...} if all %hash\u0026lt;a b c\u0026gt; :exists {...} if one %hash\u0026lt;a b c\u0026gt; :exists {...} if none %hash\u0026lt;a b c\u0026gt; :exists {...} ä½ å¯ä»¥ä½¿ç”¨ :!exists æ¥æµ‹è¯•ä¸å­˜åœ¨ã€‚è¿™ç‰¹åˆ«ä¾¿æ·å› ä¸ºä¼˜å…ˆçº§è§„åˆ™è®© !%hash\u0026lt;a\u0026gt; :exists æŠŠ :exists åº”ç”¨åˆ°å‰ç¼€ ! ä¸Šã€‚ %hash\u0026lt;a\u0026gt; :!exists æ²¡æœ‰é‚£ä¸ªé—®é¢˜ã€‚\nç»„åˆä¸‹æ ‡å‰¯è¯ åƒè°ƒç”¨ä¸­å¾—å…·åå‚æ•°é‚£æ ·ï¼Œä¸‹æ ‡ä¸­å¤„ç†å¤šä¸ªå‰¯è¯æ˜¯æ²¡æœ‰é¡ºåºä¹‹åˆ†çš„ã€‚æœ‰äº›ç»„åˆæœ‰æ„ä¹‰ï¼Œä¾‹å¦‚ï¼š\n%a = %b{@keys-to-extract} :delete :p; # same as :p :delete ä¼šæŠŠç»™å®šçš„é”®åˆ†ç‰‡åˆ°å¦å¤–ä¸€ä¸ªæ•£åˆ—ä¸­ã€‚è€Œ\n@actually-deleted = %h{@keys-to-extract} :delete :k; # same as :k :delete ä¼šè¿”å›çœŸæ­£ä»æ•£åˆ—ä¸­åˆ é™¤çš„é”®ã€‚\nåªæŒ‡å®šè¿”å›ç±»å‹çš„å‰¯è¯ï¼Œä¸èƒ½è¢«ç»„åˆï¼Œå› ä¸ºè¯¸å¦‚ :kv :pã€æˆ– :v :k å°±æ²¡æœ‰æ„ä¹‰ã€‚\nä¸‹é¢çš„è¿™äº›å‰¯è¯ç»„åˆè¢«çœ‹åšæ˜¯åˆæ³•çš„ï¼š\n:delete :kv delete, return key/values of actually deleted keys :delete :!kv delete, return key/values of all keys attempted :delete :p delete, return pairs of actually deleted keys :delete :!p delete, return pairs of all keys attempted :delete :k delete, return actually deleted keys :delete :!k delete, return all keys attempted to delete :delete :v delete, return values of actually deleted keys :delete :!v delete, return values of all keys attempted :delete :exists delete, return Bools indicating keys existed :delete :!exists delete, return Bools indicating keys did not exist :delete :exists :kv delete, return list with key,True for key existed :delete :!exists :kv delete, return list with key,False for key existed :delete :exists :!kv delete, return list with key,Bool whether key existed :delete :!exists :!kv delete, return list with key,!Bool whether key existed :delete :exists :p delete, return pairs with key/True for key existed :delete :!exists :p delete, return pairs with key/False for key existed :delete :exists :!p delete, return pairs with key/Bool whether key existed :delete :!exists :!p delete, return pairs with key/!Bool whether key existed :exists :kv return pairs with key,True for key exists :!exists :kv return pairs with key,False for key exists :exists :!kv return pairs with key,Bool for key exists :!exists :!kv return pairs with key,!Bool for key exists :exists :p return pairs with key/True for key exists :!exists :p return pairs with key/False for key exists :exists :!p return pairs with key/Bool for key exists :!exists :!p return pairs with key/!Bool for key exists ","permalink":"https://ohmyweekly.github.io/notes/2015-05-18-subscripts-adverbs/","tags":["subscript","adverb"],"title":"ä¸‹æ ‡å‰¯è¯"},{"categories":["rakulang"],"contents":"Into the Breach å‡è®¾æˆ‘ä»¬ çš„æ—¥å¿—æ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªæ—¶é—´æˆ³ 2016-02-06T14:36+02:00, æˆ‘ä»¬ä½¿ç”¨æ™ºèƒ½åŒ¹é…:\nsay $logfile ~~ /2016-02-06T14:36+02:00/; è¿™ä¼šæŠ¥é”™:\n Unrecognized regex metacharacter - (must be quoted to match literally)\n åœ¨ Raku çš„æ­£åˆ™è¡¨è¾¾å¼ä¸­ä»»ä½•éå­—æ¯æ•°å­—å­—ç¬¦(\u0026lsquo;a\u0026rsquo;..\u0026lsquo;z\u0026rsquo;, \u0026lsquo;A\u0026rsquo;..\u0026lsquo;Z\u0026rsquo;, 0..9)éƒ½å¿…é¡»ç”¨å¼•å·å¼•èµ·æ¥:\nsay $logfile ~~ /2016\u0026#39;-\u0026#39;02\u0026#39;-\u0026#39;06T14\u0026#39;:\u0026#39;36\u0026#39;+\u0026#39;02\u0026#39;:\u0026#39;00/; ç°åœ¨æˆ‘ä»¬å¾—åˆ°ç­‰ä»·çš„å¥‡æ€ªçš„è¡¨è¾¾å¼:\nï½¢2016-01-29T13:25+01:00ï½£ è¿™ä»…ä»…å‘Šè¯‰æˆ‘ä»¬, ~~ æ™ºèƒ½åŒ¹é…æ“ä½œç¬¦åŒ¹é…äº†ä¸€äº›æ–‡æœ¬, è¿™å°±æ˜¯å®ƒåŒ¹é…åˆ°çš„æ–‡æœ¬ã€‚ï½¢ï½£ æ˜¯æ—¥è¯­å¼•å·æ ‡è®°, æ•…æ„å’Œå‰©ä½™çš„æ–‡æœ¬åŒºåˆ†å¼€æ¥ã€‚\nåœ¨ Raku ä¸­, é»˜è®¤æ‰“å°å‡ºå¸¦æœ‰æ˜ç¡®æ ‡è®°çš„åŒ¹é…å¯¹è±¡, å®ƒå‡†ç¡®åœ°å‘Šè¯‰ä½ åŒ¹é…ä»å“ªé‡Œå¼€å§‹, åˆ°å“ªé‡Œç»“æŸã€‚\nå½’çº³ æˆ‘ä»¬æƒ³è®©è¯¥æ­£åˆ™è¡¨è¾¾å¼æ›´å…·æ™®éæ€§, ä¾‹å¦‚åŒ¹é… 2016 å¹´çš„æ—¥å¿—:\nsay $logfile ~~ /2015|2016\u0026#39;-\u0026#39;02\u0026#39;-\u0026#39;06T14\u0026#39;:\u0026#39;36\u0026#39;+\u0026#39;02\u0026#39;:\u0026#39;00/; ä½†æ˜¯è¿™è¿˜ä¼šåŒ¹é…åˆ°æˆ‘ä»¬ä¸æƒ³è¦çš„ä¸œè¥¿, ä¾‹å¦‚ \u0026lsquo;/post/2015/02\u0026rsquo; æˆ–è€…ç”šè‡³ \u0026lsquo;/number/120153\u0026rsquo;ã€‚å› ä¸º |çš„ä¼˜å…ˆçº§æ²¡æœ‰å­—ç¬¦é—´çš„è¿æ¥ä¼˜å…ˆçº§é«˜ã€‚æ‰€ä»¥:\nsay $logfile ~~ /[2015|2016]\u0026#39;-\u0026#39;02\u0026#39;-\u0026#39;06T14\u0026#39;:\u0026#39;36\u0026#39;+\u0026#39;02\u0026#39;:\u0026#39;00/; é—®é¢˜è§£å†³, ä½†æ˜¯æˆ‘ä»¬æƒ³åŒ¹é… \u0026lsquo;[ 1997 | 1998 | 1999 | 2000\u0026hellip; 2015 ]\u0026rsquo; è¿™äº›å‘¢ï¼Ÿ\nLearning Shorthnd åŒ¹é…4ä½æ•°å­—çš„å¹´ä»½å¥½äº†:\nsay $logfile ~~ /\\d\\d\\d\\d\u0026#39;-\u0026#39;02\u0026#39;-\u0026#39;06T14.../; å…¶å®ƒéœ€è¦æ•°å­—çš„åœ°æ–¹ä¹Ÿå¯ä»¥ä½¿ç”¨ \\d è¿™ç§ä¾¿æ·å½¢å¼çš„æ•°å­—:\nsay $logfile ~~ /\\d\\d\\d\\d\u0026#39;-\u0026#39;\\d\\d- \\d\\dT \\d\\d\u0026#39;:\u0026#39;\\d\\d\u0026#39;+\u0026#39;\\d\\d\u0026#39;:\u0026#39;\\d\\d/; '+' \u0026lt;digits\u0026gt; : \u0026lt;digits\u0026gt;Â åªä¼šåŒ¹é… +01 å’Œ +12 ä¹‹é—´çš„æ—¶åŒº, è¿˜æœ‰å…¶å®ƒåœ¨ -11 åˆ° -01 ä¹‹é—´çš„æ—¶åŒº, æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ | æ¥åŒ¹é… \u0026lsquo;+\u0026rsquo; æˆ– \u0026lsquo;-\u0026rsquo;, åƒè¿™æ ·:\nsay $logfile ~~ /\\d\\d\\d\\d\u0026#39;-\u0026#39;\\d\\d- \\d\\dT \\d\\d\u0026#39;:\u0026#39;\\d\\d[\u0026#39;+\u0026#39;|\u0026#39;-\u0026#39;]\\d\\d\u0026#39;:\u0026#39;\\d\\d/; åŸºæœ¬æ­£ç¡®äº†, ä½†æ˜¯ç”±äºå†å²åŸå› , æ—¶åŒºè¿˜èƒ½æ˜¯ä¸€ä¸ªå­—æ¯ Z, æ‰€ä»¥, è¿˜æœ‰ä¸€å¤„è¦ä¿®æ”¹:\nsay $logfile ~~ /\\d\\d\\d\\d\u0026#39;-\u0026#39;\\d\\d- \\d\\dT \\d\\d\u0026#39;:\u0026#39;\\d\\d[[\u0026#39;+\u0026#39;|\u0026#39;-\u0026#39;]\\d\\d\u0026#39;:\u0026#39;\\d\\d|Z ]/; é‡æ„ ä½†æ˜¯é‚£ä¸ª [ '+' ... Z ] è¡¨è¾¾å¼å¤ªé•¿äº†, èƒ½é‡æ„å°±æ›´å¥½äº†ã€‚regex å¯¹è±¡æ¥æ‹¯æ•‘æˆ‘ä»¬äº†, å®ƒå¸®åŠ©æˆ‘ä»¬æ¸…ç†ä»£ç ã€‚\nregex å¯¹è±¡çœ‹èµ·æ¥å¾ˆåƒåŒ¹é…è¡¨è¾¾å¼, é™¤äº†å®ƒä½¿ç”¨èŠ±æ‹¬å·æ¥å‘Šè¯‰ä»å“ªå¼€å§‹, åˆ°å“ªç»“æŸ:\nmy regex Timezone {Z |[\u0026#39;+\u0026#39;|\u0026#39;-\u0026#39;]\\d\\d\u0026#39;:\u0026#39;\\d\\d}; say $logfile ~~ /\\d\\d\\d\\d\u0026#39;-\u0026#39;\\d\\d\u0026#39;-\u0026#39;\\d\\dT \\d\\d\u0026#39;:\u0026#39;\\d\\d\u0026lt;Timezone\u0026gt;/; \u0026lt;..\u0026gt; ä»å¤–è¡¨ä¸Šçœ‹æŠŠé‡æ„åçš„è¡¨è¾¾å¼å’Œä¸»æ–‡æœ¬åˆ†å¼€äº†, è€Œè®© Timezone è¡¨è¾¾å¼åˆ†ç¦»æ„å‘³ç€æˆ‘ä»¬èƒ½åœ¨ä»£ç ä¸­çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨å®ƒäº†ã€‚äº‹å®ä¸Šæˆ‘ä»¬å¯ä»¥é‡æ„å…¶å®ƒçš„æ­£åˆ™:\nmy regex Date {\\d\\d\\d\\d\u0026#39;-\u0026#39;\\d\\d\u0026#39;-\u0026#39;\\d\\d}; my regex Time {\\d\\d\u0026#39;:\u0026#39;\\d\\d}; my regex Timezone {Z |[\u0026#39;+\u0026#39;|\u0026#39;-\u0026#39;]\\d\\d\u0026#39;:\u0026#39;\\d\\d}; say $logfile ~~ /\u0026lt;Date\u0026gt;T \u0026lt;Time\u0026gt;\u0026lt;Timezone\u0026gt;/; è®©æ‰€æœ‰è¿™äº› \\d\\d ååœ¨ä¸€å—å„¿æœ‰äº›ç¢çœ¼, æ‰€ä»¥æˆ‘ä»¬å†é‡æ„ä¸‹:\nmy regex Integer {\\d+}; my regex Date {\u0026lt;Integer\u0026gt;\u0026#39;-\u0026#39;\u0026lt;Integer\u0026gt;\u0026#39;-\u0026#39;\u0026lt;Integer\u0026gt;}; my regex Time {\u0026lt;Integer\u0026gt;\u0026#39;:\u0026#39;\u0026lt;Integer\u0026gt;}; my regex Timezone {Z |[\u0026#39;+\u0026#39;|\u0026#39;-\u0026#39;]\u0026lt;Integer\u0026gt;\u0026#39;:\u0026#39;\u0026lt;Integer\u0026gt;}; say $logfile ~~ /\u0026lt;Date\u0026gt;T \u0026lt;Time\u0026gt;\u0026lt;Timezone\u0026gt;/; http://theperlfisher.blogspot.jp/2016/02/from-regular-expressions-to-grammars-pt.html\n","permalink":"https://ohmyweekly.github.io/notes/2015-04-27-from-regex-to-grammar-part-one/","tags":["regex","grammar"],"title":"ä»æ­£åˆ™è¡¨è¾¾å¼åˆ° Grammar(ç¬¬ä¸€éƒ¨åˆ†)"},{"categories":["rakulang"],"contents":"å¦‚æœä½ æ˜¯æ­£åˆ™è¡¨è¾¾å¼æ–°äºº(è‡³å°‘å½“å®ƒä»¬ç”¨äº Raku ä¸­æ—¶), é‚£æˆ‘å»ºè®®ä½ ä»è¿™ä¸ªç³»åˆ—çš„ç¬¬ä¸€éƒ¨åˆ†å¼€å§‹ã€‚é‚£äº›æŒæ¡äº†ä¸€å®šæ­£åˆ™è¡¨è¾¾å¼çš„äººå¯ä»¥è·³è¿‡ä¸Šå‘¨çš„æ–‡ç« ã€‚ç°åœ¨, ç»§ç»­æ¼”ç¤º!\nä¸Šå‘¨è½¶äº‹ æˆ‘ä»¬å¼€å§‹å¼€å‘ä¸€ä¸ªæ¥æ”¶è¯¸å¦‚:\nvar a = 3; console.log(\u0026#34;Hey, did you konw a = \u0026#34; + a + \u0026#34;?\u0026#34;); Javascript è¡¨è¾¾å¼çš„ Raku ç¼–è¯‘å™¨, å¹¶æŠŠè¿™æ®µä»£ç è½¬æ¢ä¸º Rakudo é‚£æ ·çš„ç¼–è¯‘å™¨èƒ½è¿è¡Œçš„ Raku ä»£ç ã€‚åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰, æƒ³æƒ³è½¬æ¢åçš„ Raku ä»£ç çœ‹èµ·æ¥æ˜¯ä»€ä¹ˆæ ·çš„å¯èƒ½ä¼šæ˜¯ä¸ªå¥½ä¸»æ„ã€‚å¦‚æœä½ å·²ç»çŸ¥é“äº† Perl 5, é‚£ä¹ˆä½ åº”è¯¥ç†Ÿæ‚‰è¿™æ ·çš„ä»£ç ã€‚\nmy $a = 3; say \u0026#34;Hey, did you konw a = \u0026#34; ~ $a ~ \u0026#34;?\u0026#34;; æˆ‘ä»¬å°†éœ€è¦ç¡®ä¿æˆ‘ä»¬çš„æ­£åˆ™è¡¨è¾¾å¼æ•è·åˆ°äº† Javascript çš„è¦ç´ ã€‚å¦‚æœä½ è¿˜è®°å¾—ä¸Šä¸€æ¬¡, æˆ‘ä»¬ä½¿ç”¨è¿™æ ·ä¸€ç»„æ­£åˆ™è¡¨è¾¾å¼æ¥æ•è·æˆ‘ä»¬çš„æ–‡æœ¬:\nmy rule Number {\\d+}; my rule Variable {\\w+}; my rule String {\u0026#39;\u0026#34;\u0026#39;\u0026lt;-[\u0026#34; ]\u0026gt;+\u0026#39;\u0026#34;\u0026#39;}; my rule Assignment-Expression {var \u0026lt;Variable\u0026gt;\u0026#39;=\u0026#39;\u0026lt;Number\u0026gt;}; my rule Function-Call {console \u0026#39;.\u0026#39;log \u0026#39;(\u0026#39;\u0026lt;String\u0026gt;\u0026#39;+\u0026#39;\u0026lt;Variable\u0026gt;\u0026#39;+\u0026#39;\u0026lt;String\u0026gt;\u0026#39;)\u0026#39;}; say \u0026#39;var a = 3; console.log(\u0026#34;Hey, did you konw a = \u0026#34; + a + \u0026#34;?\u0026#34;);\u0026#39; ~~ rule { \u0026lt;Assignment-Expression\u0026gt; \u0026#39;;\u0026#39; \u0026lt;Function-Call\u0026gt; \u0026#39;;\u0026#39; }; å¦‚æœä½ æŠŠè¿™æ®µä»£ç æ”¾åˆ°ä¸€ä¸ª Raku æºæ–‡ä»¶ä¸­å¹¶è¿è¡Œå®ƒ, é‚£ä¹ˆå®ƒçš„è¾“å‡ºç¬¬ä¸€æ¬¡çœ‹èµ·æ¥å¯èƒ½ä¼šæœ‰ç‚¹å¥‡æ€ª:\nï½¢var a = 3; console.log( \u0026quot;Hey, did you know a = \u0026quot; + a + \u0026quot;?\u0026quot; );ï½£ Assignment-Expression =\u0026gt; ï½¢var a = 3ï½£ Variable =\u0026gt; ï½¢a ï½£ Number =\u0026gt; ï½¢3ï½£ Function-Call =\u0026gt; ï½¢console.log( \u0026quot;Hey, did you know a = \u0026quot; + a + \u0026quot;?\u0026quot; )ï½£ String =\u0026gt; ï½¢\u0026quot;Hey, did you know a = \u0026quot; ï½£ Variable =\u0026gt; ï½¢a ï½£ String =\u0026gt; ï½¢\u0026quot;?\u0026quot; ï½£ å¦‚æœä½ æ„¿æ„æš‚æ—¶å¿½ç•¥ ã€Œã€ æ ‡è®°, ä½ ä¼šçœ‹åˆ°åŒ¹é…è¢«ç¼©è¿›äº†, å‡ ä¹åƒèµ„æºç®¡ç†å™¨çª—å£ä¸€æ ·, \u0026lt;Assignment-Expression\u0026gt; ä½œä¸ºç›®å½•, Variable å’Œ Number ä½œä¸ºç›®å½•é‡Œé¢çš„æ–‡ä»¶ã€‚å®é™…ä¸Š, é‚£ç¦»çœŸç›¸ä¸è¿œäº†ã€‚å½“æˆ‘çœ‹åˆ°è¿™ç§ç»“æ„æ—¶, æˆ‘å‘ç°ä½¿ç”¨ä¸€ç‚¹æ·»åŠ çš„è¯­æ³•èƒ½å¸®åŠ©æˆ‘ä»¬åƒè¿™æ ·æ¥è§‚å¯Ÿå®ƒ:\n$/ =\u0026gt; ï½¢var a = 3; console.log( \u0026quot;Hey, did you know a = \u0026quot; + a + \u0026quot;?\u0026quot; );ï½£ \u0026lt;Assignment-Expression\u0026gt; =\u0026gt; ï½¢var a = 3ï½£ \u0026lt;Variable\u0026gt; =\u0026gt; ï½¢a ï½£ \u0026lt;Number\u0026gt; =\u0026gt; ï½¢3ï½£ \u0026lt;Function-Call\u0026gt; =\u0026gt; ï½¢console.log( \u0026quot;Hey, did you know a = \u0026quot; + a + \u0026quot;?\u0026quot; )ï½£ \u0026lt;String\u0026gt; =\u0026gt; ï½¢\u0026quot;Hey, did you know a = \u0026quot; ï½£ \u0026lt;Variable\u0026gt; =\u0026gt; ï½¢a ï½£ \u0026lt;String\u0026gt; =\u0026gt; ï½¢\u0026quot;?\u0026quot; ï½£ è¿™å‡ ä¹è®©æ€ä¹ˆæ‰“å°å‡ºæ–‡æœ¬å˜å¾—æ›´å®¹æ˜“, å¹¶åœ¨æˆ‘ä»¬çš„æ­£åˆ™è¡¨è¾¾å¼ä¸­æŒ‡å‡ºäº†ä¸€ä¸ªå°é—®é¢˜ã€‚æˆ‘ä»¬æ¥æ‰“å°ç»™å˜é‡ a æ‰€èµ‹çš„æ•°å­—, ä»è¿™å„¿å¼€å§‹ã€‚ç¬¬ä¸€è¡Œå‘Šè¯‰æˆ‘ä»¬ç›®å½•çš„æ ¹, æˆ–è€…åŒ¹é…æ ‘æ˜¯ $/ã€‚å¦‚æœä½ åœ¨æµ‹è¯•æ–‡ä»¶çš„æœ«å°¾æ·»åŠ ä¸Š say $/; å¹¶è¿”å›å®ƒ, é‚£ä¹ˆä½ ä¼šçœ‹åˆ°æ•´ä¸ªè¡¨è¾¾å¼è¢«æ‰“å°å‡ºäº† 2 æ¬¡ã€‚é‚£ä¸€å®šæ„å‘³ç€ $/ å°±æ˜¯æ•´ä¸ªåŒ¹é…ã€‚\næ¯å‘ä¸‹æ¨è¿›ä¸€å±‚å°±æ˜¯æŠŠ =\u0026gt; ç®­å¤´çš„å·¦ä¾§çš„ä¸œè¥¿æ·»åŠ åˆ° $/ çš„å³è¾¹ã€‚æŠŠä¹‹å‰çš„ say è¯­å¥ä¿®æ”¹ä¸º say $/\u0026lt;Assignment-Expression\u0026gt;;, å¹¶çœ‹çœ‹è¾“å‡ºå‘ç”Ÿäº†ä»€ä¹ˆæ”¹å˜ã€‚å®ƒç°åœ¨çœ‹èµ·æ¥åº”è¯¥åƒè¿™æ ·:\nï½¢var a = 3ï½£ Variable =\u0026gt; ï½¢a ï½£ Number =\u0026gt; ï½¢3ï½£ è®©æˆ‘ä»¬æŠŠæŠŠæ ‡è®°(ä¸å¯è§)æ·»åŠ è¿›æ¥, æ‰€ä»¥æˆ‘ä»¬èƒ½çŸ¥é“åˆ°äº†å“ªé‡Œ\u0026hellip;\n$/\u0026lt;Assignment-Expression\u0026gt; =\u0026gt; ï½¢var a = 3ï½£ \u0026lt;Variable\u0026gt; =\u0026gt; ï½¢a ï½£ \u0026lt;Number\u0026gt; =\u0026gt; ï½¢3ï½£ æˆ‘ä»¬ç°åœ¨èƒ½çœ‹åˆ°æˆ‘ä»¬çš„ç›®æ ‡, æ•°å­— 3, ä»…ä»…å®åœ¨æ›´ä¸‹é¢çš„ä¸€å±‚ã€‚å’Œä¸Šæ¬¡ä¸€æ ·, æˆ‘ä»¬èƒ½å¤Ÿæ·»åŠ è¡¨è¾¾å¼å·¦ä¾§çš„ä¸œè¥¿, æ‰€ä»¥æˆ‘ä»¬å°±åŠ¨æ‰‹å§ã€‚\nsay $/\u0026lt;Assignment-Expression\u0026gt;\u0026lt;Number\u0026gt;; ï½¢3ï½£ æˆ‘ä»¬å‡ ä¹å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„äº†ã€‚ã€Œã€ æŒ¡é“, æ‰€ä»¥æˆ‘ä»¬åœ¨è¿™å„¿æŠŠå€¼è½¬æ¢å›æ•°å­—ã€‚æˆ‘æŠŠè½¬æ¢(cast)ç”¨å¼•å·æ‰©èµ·æ¥, å› ä¸ºå®ƒä¸æ˜¯ C/C++ ç¨‹åºå‘˜é‚£æ ·è®¤ä¸ºçš„\u0026quot;casting\u0026quot;ã€‚æˆ‘ä»¬æƒ³åšçš„å¤§çº¦ç­‰ä»·äº sscanf(str,\u0026quot;%d\u0026quot;,\u0026amp;num), ä½†æ˜¯åœ¨ Raku ä¸­, è¿™ä¸ªæ“ä½œç¬¦æ›´åŠ ç®€å•:\nsay +$/\u0026lt;Assignment-Expression\u0026gt;\u0026lt;Number\u0026gt;; # 3 å¦‚æœä¸æ·±å…¥æ›´å¤šç»†èŠ‚, é‚£ä¹ˆ $/ æ˜¯ä¸€ä¸ªé‡Œé¢è—ç€éšå¼æ•°å­—ã€å­—ç¬¦ä¸²å’Œå¸ƒå°”å€¼çš„å¯¹è±¡ã€‚å‰é¢æ·»åŠ çš„ + æŠŠéšè—åœ¨ $/ å¯¹è±¡ä¸­çš„æ•°å­—æ˜¾ç¤ºå‡ºæ¥äº†ã€‚\nä» Javascript åˆ° Perl æˆ‘ä»¬ç¦»ä» Javascript ç”Ÿæˆ Raku ä»£ç ä¸è¿œäº†ã€‚è®©æˆ‘ä»¬ä½¿ç”¨ä¸Šé¢æ‰€å­¦çš„å¼€å§‹æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªè¯­å¥, èµ‹å€¼è¯­å¥ã€‚\nsay \u0026#39;my $\u0026#39; ~ $/\u0026lt;Assignment-Expression\u0026gt;\u0026lt;Variable\u0026gt; ~ \u0026#39;= \u0026#39; ~ $/\u0026lt;Assignment-Expression\u0026gt;\u0026lt;Number\u0026gt; ~ \u0026#39;;\u0026#39;; my $a = 3; æˆ‘ä»¬ä»…ä»…ä½¿ç”¨äº† 7 è¡Œ Raku å°±æŠŠä»£ç ä»ä¸€ç§è¯­è¨€è½¬æ¢ä¸ºå¦å¤–ä¸€ç§è¯­è¨€ã€‚å¹¶ä¸”å¤§éƒ¨åˆ†çš„ Raku ä»£ç éƒ½æ˜¯å¯é‡ç”¨çš„, å› ä¸ºå­—ç¬¦ä¸², æ•°å­—, å’Œ Javascript/C/Java é£æ ¼çš„å˜é‡ååœ¨å¤§éƒ¨åˆ†è¯­è¨€ä¹‹é—´æ˜¯é€šç”¨çš„ã€‚\nä¸Šæ¬¡, æˆ‘ä»¬å­¦ä¹ äº†æ€ä¹ˆä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥åˆ›å»ºåŒ¹é…ã€‚è¿™æ¬¡æˆ‘ä»¬å­¦ä¼šäº†æ€ä¹ˆä½¿ç”¨æˆ‘ä»¬è¯´åŒ¹é…åˆ°çš„ä¸œè¥¿, è¿˜æœ‰æ€ä¹ˆåœ¨ say è¯­å¥ä¸­æ‰¾å‡ºæˆ‘ä»¬æƒ³è¦çš„ä¸œè¥¿ã€‚ ä¸å¯è§çš„åŒ¹é…æ ‡è®°ç›¸å½“æœ‰ç”¨, æˆ‘å¯èƒ½ä¼šå†™ä¸€ä¸ªæ¨¡å—æ¥æŠŠå®ƒä»¬æ”¾å›åˆ°åŒ¹é…è¡¨è¾¾å¼ä¸­, é‚£åº”è¯¥ä¸éš¾ã€‚\né‚£ä¸ªæ–¹æ¡ˆæœ‰ä¸€ä¸ªé—®é¢˜, å¦‚æœæˆ‘ä»¬çœ‹ä¸€ä¸‹ \u0026lt;Function-Call\u0026gt; åŒ¹é…, ä¼šå¾ˆå®¹æ˜“å‘ç°é‚£ä¸ªé—®é¢˜ã€‚\n$/\u0026lt;Function-Call\u0026gt; =\u0026gt; ï½¢console.log( \u0026#34;Hey, did you know a = \u0026#34; + a + \u0026#34;?\u0026#34; )ï½£ \u0026lt;String\u0026gt; =\u0026gt; ï½¢\u0026#34;Hey, did you know a = \u0026#34; ï½£ \u0026lt;Variable\u0026gt; =\u0026gt; ï½¢a ï½£ \u0026lt;String\u0026gt; =\u0026gt; ï½¢\u0026#34;?\u0026#34; ï½£ å½“æˆ‘ä»¬å†™äº† say $/\u0026lt;Function-Call\u0026gt;\u0026lt;String\u0026gt;; æ—¶, æˆ‘ä»¬ä¼šè·å–å“ªä¸ª \u0026lt;String\u0026gt;? åœ¨ä½ è¿è¡Œè¿™æ®µä»£ç ä¹‹å‰, å…ˆçŒœæµ‹ä¸€ä¸‹ã€‚ä¼šæ˜¯ç¬¬ä¸€ä¸ªå—, å› ä¸ºä¸€æ—¦åŒ¹é…å¯¹è±¡è¢«åˆ›å»º, Raku å°±ä¸ä¼šæŠŠå®ƒæ›¿æ¢æ‰? ä¼šæ˜¯æœ€åä¸€ä¸ªå—, å› ä¸ºæœ€åä¸€ä¸ª\u0026quot;è¦†ç›–\u0026quot;äº†ç¬¬ä¸€ä¸ª? ç¼–è¯‘å™¨ä¼šä»…ä»…\u0026quot;æ„Ÿåˆ°å›°æƒ‘\u0026quot;ç„¶åä»€ä¹ˆä¹Ÿä¸æ‰“å°å—? è¿è¡Œä¸€ä¸‹çœ‹çœ‹!\nå®ƒå®é™…ä¸Šä»¥ä¸€ä¸ªåˆ—è¡¨çš„å½¢å¼æŠŠä¸¤ä¸ªåŒ¹é…éƒ½è¿”å›äº†, æ‰€ä»¥ä½ å¯ä»¥å¼•ç”¨ä»»ä½•ä¸€ä¸ªã€‚ æˆ‘ä»¬çš„ä¸å¯è§æ ‡è®°ç°åœ¨çœ‹èµ·æ¥é•¿è¿™æ ·:\n$/\u0026lt;Function-Call\u0026gt; =\u0026gt; ï½¢console.log( \u0026quot;Hey, did you know a = \u0026quot; + a + \u0026quot;?\u0026quot; )ï½£ \u0026lt;String\u0026gt;[0] =\u0026gt; ï½¢\u0026quot;Hey, did you know a = \u0026quot; ï½£ \u0026lt;Variable\u0026gt; =\u0026gt; ï½¢a ï½£ \u0026lt;String\u0026gt;[1] =\u0026gt; ï½¢\u0026quot;?\u0026quot; ï½£ æ‰€ä»¥, å¦‚æœæˆ‘ä»¬æƒ³æ‰“å°ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸², æˆ‘ä»¬å¯ä»¥å†™ä¸Š say $/\u0026lt;Function-Call\u0026gt;\u0026lt;String\u0026gt;[0]; å¹¶å¾—åˆ°å«æœ‰æ—¶é«¦çš„æ—¥è¯­æ ‡è®°çš„ã€Œ\u0026ldquo;Hey, did you know a = \u0026quot; ã€ã€‚å¹¸è¿çš„æ˜¯æœ‰ä¸€ç§ä¾¿æ·æ–¹å¼æ¥é¿å…é‚£äº›æ—¥è¯­æ ‡è®°, å°±åƒæ•°å­— 3 ä¸­çš„é‚£æ ·:\nsay ~$/\u0026lt;Function-Call\u0026gt;\u0026lt;String\u0026gt;[0]; \u0026#34;Hey, did you know a = \u0026#34; ~ æ“ä½œç¬¦ä½¿åŒ¹é…å­—ç¬¦ä¸²åŒ–, å°±åƒ + è®©è¿”å›çš„åŒ¹é…æ•°å­—åŒ–ä¸€æ ·ã€‚æ‰€ä»¥ä½ å¯èƒ½è‡ªå·±æŠŠæœ€åä¸€è¡Œå†™ä½œ:\nsay \u0026#39;say \u0026#39; ~ $/\u0026lt;Function-Call\u0026gt;\u0026lt;String\u0026gt;[0] ~ \u0026#39;~ \u0026#39; \u0026#39;$\u0026#39; ~ $/\u0026lt;Function-Call\u0026gt;\u0026lt;Variable\u0026gt; ~ \u0026#39;~ \u0026#39; $\u0026lt;Function-Call\u0026gt;\u0026lt;String\u0026gt;[1] ~ \u0026#39;;\u0026#39;; say \u0026#34;Hey, did you know a = \u0026#34; ~ $a ~ \u0026#34;?\u0026#34;; æˆ‘ä»¬å·²ç»æŠŠæˆ‘ä»¬çš„ä¸¤è¡Œ Javascript ä»£ç ç¼–è¯‘æˆ Raku ä»£ç äº†ã€‚\né‡æ„ ç°åœ¨å·²ç»èƒ½å·¥ä½œäº†, ä½†æ˜¯æœ‰å¾ˆå¤šé‡å¤ã€‚ç›®å‰æˆ‘ä»¬å¾—åˆ°æ˜¯:\nmy rule Variable {\\w+}; my rule String {\u0026#39;\u0026#34;\u0026#39;\u0026lt;-[\u0026#34; ]\u0026gt;+\u0026#39;\u0026#34;\u0026#39;}; my rule Assignment-Expression {var \u0026lt;Variable\u0026gt;\u0026#39;=\u0026#39;\u0026lt;Number\u0026gt;}; my rule Function-Call {console \u0026#39;.\u0026#39;log \u0026#39;(\u0026#39;\u0026lt;String\u0026gt;\u0026#39;+\u0026#39;\u0026lt;Variable\u0026gt;\u0026#39;+\u0026#39;\u0026lt;String\u0026gt;\u0026#39;)\u0026#39;}; \u0026#39;var a = 3; console.log( \u0026#34;Hey, did you know a = \u0026#34; + a + \u0026#34;?\u0026#34; );\u0026#39; ~~ rule { \u0026lt;Assignment-Expression\u0026gt; \u0026#39;;\u0026#39; \u0026lt;Function-Call\u0026gt; \u0026#39;;\u0026#39; } say \u0026#39;my $\u0026#39; ~ $/\u0026lt;Assignment-Expression\u0026gt;\u0026lt;Variable\u0026gt; ~ \u0026#39;= \u0026#39; ~ $/\u0026lt;Assignment-Expression\u0026gt;\u0026lt;Number\u0026gt; ~ \u0026#39;;\u0026#39;; say \u0026#39;say \u0026#39; ~ $/\u0026lt;Function-Call\u0026gt;\u0026lt;String\u0026gt;[0] ~ \u0026#39;~ $\u0026#39; ~ $/\u0026lt;Function-Call\u0026gt;\u0026lt;Variable\u0026gt; ~ \u0026#39;~ \u0026#39; ~ $/\u0026lt;Function-Call\u0026gt;\u0026lt;String\u0026gt;[1] ~ \u0026#39;;\u0026#39;; é‚£äº› rules çœ‹èµ·æ¥ç›¸å½“å¥½, \u0026lt;String\u0026gt; å’Œ \u0026lt;Variable\u0026gt; çš„é‡å¤ä¹Ÿæ˜¯ä¸å¯é¿å…çš„ã€‚ ä½†æ˜¯çœ‹çœ‹ say è¯­å¥, ä½ ä¼šçœ‹åˆ° \u0026lt;Assignment-Expression\u0026gt; å’Œ \u0026lt;Function-Call\u0026gt; é‡å¤äº†è‡ªèº«å¥½å‡ æ¬¡ã€‚é¿å…è¿™ç§é‡å¤çš„ä¸€ç§æ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªä¸´æ—¶å˜é‡, ä½†æ˜¯é‚£å¯èƒ½ä¼šå˜å¾—ä¸‘é™‹ã€‚\nmy $assignment-expression = $/\u0026lt;Assignment-Expression\u0026gt;; say \u0026#39;my $\u0026#39; ~ $assignment-expression\u0026lt;Variable\u0026gt; ~ \u0026#39;= \u0026#39; ~ $assignment-expression\u0026lt;Number\u0026gt; ~ \u0026#39;;\u0026#39; ç›¸å, æˆ‘ä»¬åˆ©ç”¨ Raku çš„å­ä¾‹ç¨‹ç­¾å, å¹¶ä¸”é‡ç”¨ $/ å˜é‡åä»¥ä½¿æˆ‘ä»¬èƒ½é‡ç”¨ä¸Šé¢æ‰€å†™çš„ä»£ç , ç„¶åæ‹¿æ‰ \u0026lt;Assignment-Expression\u0026gt; éƒ¨åˆ†ã€‚ æˆ‘ä¼šæŠŠå­ä¾‹ç¨‹çš„åå­—å‘½åä¸º rule çš„åå­—, åªæ˜¯ä¸ºäº†ç›´æ¥äº†å½“ã€‚(ä½ ä¼šåœ¨ä¹‹åçœ‹åˆ°ä¸ºä»€ä¹ˆè¿™æ ·åšã€‚)\nsub assignment-expression($/) { \u0026#39;my $\u0026#39; ~ $/\u0026lt;Variable\u0026gt; ~ \u0026#39;= \u0026#39; ~ $/\u0026lt;Number\u0026gt; ~ \u0026#39;;\u0026#39; } say assignment-expression( $/\u0026lt;Assignment-Expression\u0026gt; ); è®©æˆ‘ä»¬å¯¹ \u0026lt;Function-Call\u0026gt; ä¹ŸåšåŒæ ·çš„äº‹æƒ…, åˆ›å»ºä¸€ä¸ªå«æœ‰ $/ å­ä¾‹ç¨‹ç­¾åçš„åŒåå‡½æ•°ã€‚ å®ƒç°åœ¨å†™åœ¨ä¸€è¡Œé‡Œé¢å°±å¾ˆæ•´æ´äº†, å¹¶ä¸”åªé‡å¤  éƒ¨åˆ†, å› ä¸ºå®ƒä¸å¾—ä¸é‡å¤ã€‚\nsub function-call( $/ ) { \u0026#39;say \u0026#39; ~ $/\u0026lt;String\u0026gt;[0] ~ \u0026#39;~ \u0026#39; ~ $/\u0026lt;Variable\u0026gt; ~ \u0026#39;~ \u0026#39; ~ $/\u0026lt;String\u0026gt;[1] ~ \u0026#39;;\u0026#39; } say function-call( $/\u0026lt;Function-Call\u0026gt; ); å¯¹è±¡åŒ– ä¸€è·¯ä¸Šæˆ‘åšäº†ç›¸å½“å¤šçš„é€‰æ‹©, è®©æˆ‘ä»¬åˆ°è¾¾è¿™é‡Œã€‚è¿™å°±æ˜¯æˆ‘ä»¬ä¸Šæ¬¡é‡æ„çš„åœ°æ–¹:\nmy rule Number {\\d+}; my rule Variable {\\w+}; my rule String {\u0026#39;\u0026#34;\u0026#39;\u0026lt;-[\u0026#34; ]\u0026gt;+\u0026#39;\u0026#34;\u0026#39;}; my rule Assignment-Expression {var \u0026lt;Variable\u0026gt;\u0026#39;=\u0026#39;\u0026lt;Number\u0026gt;}; my rule Function-Call {console \u0026#39;.\u0026#39;log \u0026#39;(\u0026#39;\u0026lt;String\u0026gt;\u0026#39;+\u0026#39;\u0026lt;Variable\u0026gt;\u0026#39;+\u0026#39;\u0026lt;String\u0026gt;\u0026#39;)\u0026#39;}; \u0026#39;var a = 3; console.log( \u0026#34;Hey, did you know a = \u0026#34; + a + \u0026#34;?\u0026#34; );\u0026#39; ~~ rule { \u0026lt;Assignment-Expression\u0026gt; \u0026#39;;\u0026#39; \u0026lt;Function-Call\u0026gt; \u0026#39;;\u0026#39; } sub assignment-expression( $/ ) { \u0026#39;my $\u0026#39; ~ $/\u0026lt;Variable\u0026gt; ~ \u0026#39;= \u0026#39; ~ $/\u0026lt;Number\u0026gt; ~ \u0026#39;;\u0026#39; } sub function-call( $/ ) { \u0026#39;say \u0026#39; ~ $/\u0026lt;String\u0026gt;[0] ~ \u0026#39;~ $\u0026#39; ~ $/\u0026lt;Variable\u0026gt; ~ \u0026#39;~ \u0026#39; ~ $/\u0026lt;String\u0026gt;[1] ~ \u0026#39;;\u0026#39;; } say assignment-expression( $/\u0026lt;Assignment-Expression\u0026gt; ); say function-call( $/\u0026lt;Function-Call\u0026gt; ); è¿™å°±æ˜¯æˆ‘ä»¬çš„å›æŠ¥ã€‚æˆ‘ä»¬å…ˆæ¡èµ·æœ€åé‚£ä¸¤ä¸ª say è¯­å¥ã€‚ æˆ‘ä»¬è¿˜æ²¡æœ‰ç»™é¡¶å±‚ rule ä¸€ä¸ªåå­—, æ‰€ä»¥æˆ‘ä»¬å°±å«å®ƒ\u0026hellip; å¥½å§, ç°åœ¨è¿˜æ˜¯å« \u0026lsquo;top\u0026rsquo; å§ã€‚\nsub top( $/ ) { assignment-expression( $/ ) ~ function-call( $/ ) } æ”¶å›ä½ çš„åæ§½ æˆ‘ä»¬æš‚æ—¶è¿˜æ²¡æœ‰å¯¹å¤„äºæ–‡ä»¶é¡¶å±‚çš„ rules åšå¤ªå¤šå¤„ç†, æ‰€ä»¥è®©æˆ‘ä»¬å¼€å§‹å·¥ä½œå§ã€‚ åœ¨ Raku ä¸­, å°±ä¸€èˆ¬ç¼–ç¨‹è€Œè¨€, æŠŠä½ çš„ä»£ç æ‰“åŒ…å¤ç”¨æ˜¯ä¸é”™çš„æ³¨æ„ã€‚è€Œ Raku è®©æˆ‘ä»¬ä½¿ç”¨ class å…³é”®å­—å°†æˆ‘ä»¬çš„ç¨‹åºæ‰“åŒ…, æˆ‘ä»¬æ‹¥æœ‰çš„é‚£äº› rules ä»ä»»ä½•æ„ä¹‰ä¸Šæ¥è¯´å®é™…ä¸Šä¸æ˜¯\u0026quot;ä»£ç \u0026rdquo;ã€‚è€Œå®ƒä»¬èƒ½å¤Ÿç”¨äºä»£ç ä¸­, å¹¶ä¸”æˆ‘ä»¬ç¡®å®ä½¿ç”¨äº†å®ƒä»¬, å®ƒä»¬è‡ªèº«å®é™…ä¸Šå¹¶æ²¡æœ‰åšå‡ºä»»ä½•å†³å®šã€‚\næ‰€ä»¥æˆ‘ä»¬ä¸åº”è¯¥ä½¿ç”¨ class å…³é”®å­—æ¥æŠŠå®ƒä»¬æ‰“åŒ…åˆ°ä¸€å—ã€‚ç›¸å, æœ‰å¦å¤–ä¸€ç§ä¾¿æ·çš„ç±»å‹ç”¨äºæŠŠä¸€å †æ­£åˆ™è¡¨è¾¾å¼å’Œ rules æ‰“åŒ…åˆ°ä¸€å—å„¿, å®ƒå«åš grammarã€‚\nå®ƒçš„è¯­æ³•å°±åƒå£°æ˜ä¸€ä¸ªã€Œruleã€ é‚£æ ·ã€‚\ngrammar Javascript { rule Number {\\d+}; rule Variable {\\w+}; rule String {\u0026#39;\u0026#34;\u0026#39;\u0026lt;-[\u0026#34; ]\u0026gt;+\u0026#39;\u0026#34;\u0026#39;}; rule Assignment-Expression {var \u0026lt;Variable\u0026gt;\u0026#39;=\u0026#39;\u0026lt;Number\u0026gt;}; rule Function-Call {console \u0026#39;.\u0026#39;log \u0026#39;(\u0026#39;\u0026lt;String\u0026gt;\u0026#39;+\u0026#39;\u0026lt;Variable\u0026gt;\u0026#39;+\u0026#39;\u0026lt;String\u0026gt;\u0026#39;)\u0026#39;}; rule TOP {\u0026lt;Assignment-Expression\u0026gt;\u0026#39;;\u0026#39;\u0026lt;Function-Call\u0026gt;\u0026#39;;\u0026#39;}; } ä½ ä¼šæ³¨æ„åˆ°, æˆ‘ä»¬ç»™æˆ‘ä»¬çš„é¡¶å±‚ rule ä¹Ÿèµ·äº†ä¸ªåå­—, å¹¶ä¸”æš‚æ—¶æŠŠå®ƒå«åš ã€ŒTOPã€ å§ã€‚ å¦‚æœä½ æ­£åœ¨å®¶ç‹¬è‡ªç©è€, ä½ å¯èƒ½å·²ç»åšå‡ºæ›´æ”¹å¹¶æƒ³çŸ¥é“ ã€Œ\u0026lsquo;var a = 3;\u0026hellip;\u0026rsquo; ~~ rule { \u0026hellip; }ã€ æ˜¯æ€ä¹ˆèµ·ä½œç”¨çš„, å› ä¸ºé”®å…¥è¯¸å¦‚ ã€Œ\u0026lsquo;var a = 3;\u0026hellip;\u0026rsquo; ~~ JavaScript;ã€è¿™æ ·çš„ä¸œè¥¿å¯èƒ½ä¸ä¼šé‚£ä¹ˆæœ‰ä½œç”¨ã€‚\nGrammars å°±åƒç±»ä¸€æ ·, åœ¨é‡Œé¢å®ƒä»¬å®é™…ä¸Šæ˜¯ä¸€å—å¯èƒ½çš„ä»£ç ã€‚ å®ƒä»¬æœ¬èº«ä¸ä¼šå·¥ä½œ, å®ƒä»¬å¿…é¡»ä»æ½œåœ¨çš„è½¬æ¢ä¸ºåŠ¨æ€çš„ä»£ç ã€‚æˆ‘ä»¬å¯ä»¥åƒä½ åœ¨ç±»ä¸­åšçš„é‚£æ ·:\nmy $JavaScript = JavaScript.new; ç°åœ¨æˆ‘ä»¬æ‹¥æœ‰äº†ä¸€ä¸ªå¯ä»¥å·¥ä½œçš„å˜é‡ã€‚ ç°åœ¨, è®©æˆ‘ä»¬æ¥ä½¿ç”¨å®ƒã€‚æ‰€æœ‰çš„ Grammar ç±»éƒ½æœ‰ä¸€ä¸ªå†…ç½®çš„ ã€Œparse()ã€ æ–¹æ³•, ä»¥ä½¿æˆ‘ä»¬èƒ½å¾—åˆ° grammar ä¸­çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚ æˆ‘ä»¬æ¥ä¿®æ”¹æˆ‘ä»¬çš„åŒ¹é…è¯­å¥ä»¥åˆ©ç”¨ parse() æ–¹æ³•:\n$JavaScript.parse(\u0026#39;var a = 3; console.log( \u0026#34;Hey, did you know a = \u0026#34; + a + \u0026#34;?\u0026#34; );\u0026#39;); æˆ‘ä»¬çš„ä»£ç åº”è¯¥åˆèƒ½å·¥ä½œäº†ã€‚\næ¥æ”¶åŠ¨ä½œ ç°åœ¨æˆ‘ä»¬å·²ç»æŠŠæˆ‘ä»¬æ‰€æœ‰çš„åŒ¹é…çš„ä¸œè¥¿æ‰“åŒ…åˆ°ä¸€ä¸ªå°å‹çš„ç±»é‡Œé¢äº†, å¦‚æœæˆ‘ä»¬èƒ½å¯¹é‚£äº›å­ä¾‹ç¨‹åšåŒæ ·çš„å¤„ç†å°†ä¼šå¾ˆæ£’ã€‚ æˆ‘ä»¬åœ¨è¿™å„¿è¯•è¯•, æŠŠæˆ‘ä»¬çš„å­ä¾‹ç¨‹æ”¾åˆ°å®ƒä»¬è‡ªå·±çš„å‘½åç©ºé—´ä¸­, å°±åƒæˆ‘ä»¬å¯¹ rule åšçš„é‚£æ ·ã€‚ æˆ‘ä»¬å¿…é¡»ä» ã€Œsubã€ ä¿®æ”¹ä¸º ã€Œmethodã€, è€Œæˆ‘ä»¬çš„ ã€Œtopã€ æ–¹æ³•å°†ä¼šä½¿ç”¨ ã€Œself.ã€ å»è°ƒç”¨å…¶å®ƒæ–¹æ³•ã€‚\nclass Actions { method assignment-expression( $/ ) { \u0026#39;my $\u0026#39; ~ $/\u0026lt;Variable\u0026gt; ~ \u0026#39;= \u0026#39; ~ $/\u0026lt;Number\u0026gt; ~ \u0026#39;;\u0026#39; } method function-call( $/ ) { \u0026#39;say \u0026#39; ~ $/\u0026lt;String\u0026gt;[0] ~ \u0026#39;~ $\u0026#39; ~ $/\u0026lt;Variable\u0026gt; ~ \u0026#39;~ \u0026#39; ~ $/\u0026lt;String\u0026gt;[1] ~ \u0026#39;;\u0026#39;; } method top( $/ ) { self.assignment-expression( $/\u0026lt;Assignment-Expression\u0026gt; ) ~ self.function-call( $/\u0026lt;Function-Call\u0026gt; ) } } å°±åƒä¹‹å‰é‚£æ ·, æˆ‘ä»¬å¯ä»¥åœ¨ä¸€è¡Œé‡Œé¢åˆ›å»º Actions å¯¹è±¡:\nmy $actions = Actions.new; å¹¶ä¸”è°ƒç”¨ top å‡ ä¹åƒæˆ‘ä»¬ä¹‹å‰åšçš„é‚£æ ·:\nsay $actions.top( $/ ); æˆ‘ä»¬å·²ç»ä¿®æ”¹äº†å¾ˆå¤šä¸œè¥¿äº†, æ‰€ä»¥æˆ‘ä»¬æ¥çœ‹çœ‹åˆ°å“ªäº†ã€‚\ngrammar JavaScript { rule Number {\\d+}; rule Variable {\\w+}; rule String {\u0026#39;\u0026#34;\u0026#39;\u0026lt;-[\u0026#34; ]\u0026gt;+\u0026#39;\u0026#34;\u0026#39;}; rule Assignment-Expression {var \u0026lt;Variable\u0026gt;\u0026#39;=\u0026#39;\u0026lt;Number\u0026gt;}; rule Function-Call {console \u0026#39;.\u0026#39;log \u0026#39;(\u0026#39;\u0026lt;String\u0026gt;\u0026#39;+\u0026#39;\u0026lt;Variable\u0026gt;\u0026#39;+\u0026#39;\u0026lt;String\u0026gt;\u0026#39;)\u0026#39;}; rule TOP {\u0026lt;Assignment-Expression\u0026gt;\u0026#39;;\u0026#39;\u0026lt;Function-Call\u0026gt;\u0026#39;;\u0026#39;} } my $j = JavaScript.new; $j.parse(\u0026#39;var a = 3; console.log( \u0026#34;Hey, did you know a = \u0026#34; + a + \u0026#34;?\u0026#34; );\u0026#39;); class Actions { method assignment-expression( $/ ) { \u0026#39;my $\u0026#39; ~ $/\u0026lt;Variable\u0026gt; ~ \u0026#39;= \u0026#39; ~ $/\u0026lt;Number\u0026gt; ~ \u0026#39;;\u0026#39; } method function-call( $/ ) { \u0026#39;say \u0026#39; ~ $/\u0026lt;String\u0026gt;[0] ~ \u0026#39;~ $\u0026#39; ~ $/\u0026lt;Variable\u0026gt; ~ \u0026#39;~ \u0026#39; ~ $/\u0026lt;String\u0026gt;[1] ~ \u0026#39;;\u0026#39;; } method top( $/ ) { self.assignment-expression( $/\u0026lt;Assignment-Expression\u0026gt; ) ~ self.function-call( $/\u0026lt;Function-Call\u0026gt; ) } } my $actions = Actions.new; say $actions.top($/); ä¸ç”¨æ‹…å¿ƒ, æˆ‘ä»¬å¿«è¦åˆ°äº†ã€‚æ—¢ç„¶æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå•ç‹¬çš„ç±»æ¥å¤„ç† Actions, æˆ‘ä»¬æŠŠæ–¹æ³•é‡å‘½åä¸º Grammar ä¸­æ‰€åŒ¹é…çš„ rule çš„åå­—, ä»¥ä½¿æˆ‘ä»¬ä¸ä¼šå¿˜è®°å®ƒä»¬æ˜¯ä»€ä¹ˆã€‚\nclass Actions { method Assignment-Expression( $/ ) { \u0026#39;my $\u0026#39; ~ $/\u0026lt;Variable\u0026gt; ~ \u0026#39;= \u0026#39; ~ $/\u0026lt;Number\u0026gt; ~ \u0026#39;;\u0026#39; } method Function-Call( $/ ) { \u0026#39;say \u0026#39; ~ $/\u0026lt;String\u0026gt;[0] ~ \u0026#39;~$\u0026#39; ~ $/\u0026lt;Variable\u0026gt; ~ \u0026#39;~ \u0026#39; ~ $/\u0026lt;String\u0026gt;[1] ~ \u0026#39;;\u0026#39;; } method TOP( $/ ) { self.Assignment-Expression( $/\u0026lt;Assignment-Expression\u0026gt; ) ~ self.Function-Call( $/\u0026lt;Function-Call\u0026gt; ) } } æ›´è¿›ä¸€æ­¥, æˆ‘ä»¬è¿˜æœ‰æœ€åä¸€ç‚¹é­”æ³•èƒ½å¤Ÿåˆ©ç”¨ã€‚ æˆ‘ä»¬å°†æŠŠ $javascript å’Œ $actions å¯¹è±¡åƒè¿™æ ·ç»„åˆåœ¨ä¸€å—ã€‚\nsay $javascript.parse(\u0026#39;...\u0026#39;, :actions($actions) ); ã€Œ:actions(\u0026hellip;)ã€ ç»™ ã€Œparse()ã€æ–¹æ³•å£°æ˜çš„å¯é€‰å‚æ•°ã€‚æˆ‘ä»¬æ­£å‘Šè¯‰æ­£åˆ™è¡¨è¾¾å¼å¼•æ“, ä»»ä½•æ—¶å€™, åƒ \u0026lt;Function-Call\u0026gt; æˆ– \u0026lt;TOP\u0026gt; è¿™æ ·çš„ rule åŒ¹é…æ—¶, æˆ‘ä»¬ä¼šåœ¨æˆ‘ä»¬çš„ç±»ä¸­è®©å®ƒè°ƒç”¨å¯¹åº”çš„åŒåæ–¹æ³•ã€‚\nè¿™å‡ ä¹æ˜¯æŒ‰åŸæ ·å·¥ä½œçš„, ä½†æ˜¯å¦‚æœä½ è¿è¡Œä¿®æ”¹åçš„ä»£ç , ä½ ä¼šå‘ç°è§£æè¿”å›äº†åŸæ¥çš„åŒ¹é…å¯¹è±¡, å¸¦ç€æ—¥è¯­å¼•ç”¨æ ‡è®°ã€‚æ‰€ä»¥çœ‹èµ·æ¥å¥½åƒæˆ‘ä»¬åˆå›åˆ°äº†åŸåœ°ã€‚ä¸å®Œå…¨æ˜¯ã€‚\nç»§ç»­, æˆ‘ä»¬åœ¨å…¶ä¸­ä¹‹ä¸€çš„æ–¹æ³•ä¸­æ·»åŠ ä¸€ä¸ªä¸´æ—¶çš„ \u0026quot;say 'Hello';\u0026quot; è¯­å¥, ä»…ä»…æ˜¯ä¸ºäº†ç¡®è®¤å®ƒä»¬æ­£è¢«è°ƒç”¨ã€‚è¿™æ˜¯æ­£åˆ™å¼•æ“æ­£åœ¨å·¥ä½œå¹¶ä¸”å¯èƒ½æ­£è§£æå®ƒæ‰€ going over çš„ä¸€ä¸ªé‡è¦è¯æ®ã€‚ ä½ ç”šè‡³å¯ä»¥ä½¿ç”¨æŸäº›æˆ‘ä»¬ä¸Šé¢å·²ç»å­¦åˆ°çš„æŠ€å·§ç„¶åå†™ä¸Š ã€Œsay $/\u0026lt;Variable\u0026gt;;ã€ æ¥æŸ¥çœ‹åŒ¹é…æ˜¯å¦æ­£åƒä½ æƒ³çš„é‚£æ ·è¿è¡Œã€‚ç»§ç»­è¿è¡Œå¹¶ç©ç©, åšå®Œçš„æ—¶å€™å†å›åˆ°è¿™å„¿ã€‚\næ··åˆä¿¡å·(Mixed Signals) æ­£å‘ç”Ÿçš„æ˜¯æ–¹æ³•æ­£è¢«è°ƒç”¨, ä½†æ˜¯å®ƒä»¬çš„è¾“å‡ºè¢«ä¸¢å¼ƒã€‚æˆ‘ä»¬æ¥æ•è·è¾“å‡ºç„¶åä½¿ç”¨ grammar çš„æœ€åä¸€ä¸ªç‰¹æ€§, æŠ½è±¡è¯­æ³•æ ‘ã€‚ç°åœ¨, è¿™å¯èƒ½ä¼šå‹¾èµ·ååœ¨æ•™å®¤é‡Œçœ‹é»‘æ¿ä¸Šç”»å‡ºçš„ç›’å­å’Œçº¿æ®µçš„åœºæ™¯, ä½†æ˜¯ä¹Ÿæ²¡æœ‰é‚£ä¹ˆç³Ÿç³•äº†ã€‚æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†ä¸€ä¸ª, å®é™…ä¸Š say() çš„è¾“å‡ºå°±æ˜¯ä¸€ä¸ª ASTã€‚\næˆ‘ä»¬æ¥çœ‹ä¸‹å…¶å®ƒè¯­æ³•æ ‘, æˆ‘ä»¬åœ¨åå°åˆ›å»ºçš„é‚£ä¸ªã€‚åœ¨ \u0026ldquo;$javascript.parse(\u0026hellip;)\u0026rdquo; è°ƒç”¨çš„æœ«å°¾æ·»åŠ ä¸Š ã€Œ.astã€, è¿™ä¼šç»™æˆ‘ä»¬å±•ç¤ºæˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„è¯­æ³•æ ‘ã€‚\nå¦‚æœä½ è¿™æ ·åšäº†, ä½ ä¼šçœ‹åˆ°å®ƒæ‰“å°äº†(Any), è¿™é€šå¸¸ç­‰ä»·äºã€ŒåŒ¹é…å¤±è´¥ã€, å•æ˜¯æˆ‘ä»¬ä»ä¹‹å‰çš„æµ‹è¯•ä¸­çŸ¥é“åŒ¹é…æ²¡æœ‰å¤±è´¥ã€‚æ‰€ä»¥è¿™å„¿å‘ç”Ÿäº†ä»€ä¹ˆ? å½“æˆ‘ä»¬çš„æ–¹æ³•è¿è¡Œçš„æ—¶å€™, å®ƒä»¬è¿”å›è¾“å‡º, ä½†æ˜¯ Raku ä¸çŸ¥é“æ€ä¹ˆå¤„ç†è¿™äº›è¾“å‡º, æˆ–è€…è¯´å®ƒä¸çŸ¥é“æŠŠè¾“å‡ºå®‰è£…åˆ°å®ƒæ‰€åˆ›å»ºçš„ AST ä¸­çš„å“ªä¸ªä½ç½®ã€‚\nå…³é”®æ˜¯ä¸€ä¸ªå«åšã€Œmakeã€çš„å°ä¸œè¥¿ã€‚åœ¨æ–¹æ³•çš„å¼€å¤´, æŠŠè¿™ä¸ªæ·»åŠ åˆ°è¿‡å»æˆ‘ä»¬æ”¾ç½®ã€Œsayã€çš„åœ°æ–¹ã€‚\nclass Actions { method Assignment-Expression( $/ ) { make \u0026#39;my $\u0026#39; ~ $/\u0026lt;Variable\u0026gt; ~ \u0026#39;= \u0026#39; ~ $/\u0026lt;Number\u0026gt; ~ \u0026#39;;\u0026#39; } method Function-Call( $/ ) { make \u0026#39;say \u0026#39; ~ $/\u0026lt;String\u0026gt;[0] ~ \u0026#39;~ $\u0026#39; ~ $/\u0026lt;Variable\u0026gt; ~ \u0026#39;~ \u0026#39; ~ $/\u0026lt;String\u0026gt;[1] ~ \u0026#39;;\u0026#39; } method TOP( $/ ) { make $/\u0026lt;Assignment-Expression\u0026gt;.ast ~ $/\u0026lt;Function-Call\u0026gt;.ast } } è¿˜æœ‰, å› ä¸º Raku ä¸ºæˆ‘ä»¬è°ƒç”¨æ–¹æ³•, æˆ‘ä»¬ä¸éœ€è¦è‡ªå·±æ¥è°ƒç”¨ self.Function-Call(...), æˆ‘ä»¬éœ€è¦åšçš„å…¨éƒ¨å·¥ä½œå°±æ˜¯æŸ¥çœ‹ Function-Call(...) è¿”å›ç»™æˆ‘ä»¬çš„è¯­æ³•æ ‘ã€‚æœ€ç»ˆæˆ‘ä»¬åšåˆ°äº†ã€‚ä¸€ä¸ªå®Œæ•´, è™½ç„¶å¾®å°çš„ç¼–è¯‘å™¨ã€‚ä¸ºäº†é˜²æ­¢ä½ åœ¨ç¼–è¾‘æ—¶è¿·å¤±, è¿™å„¿æœ‰ä¸€ä¸ªæœ€ç»ˆçš„ç»“æœã€‚\ngrammar JavaScript { rule Number {\\d+}; rule Variable {\\w+}; rule String {\u0026#39;\u0026#34;\u0026#39;\u0026lt;-[\u0026#34; ]\u0026gt;+\u0026#39;\u0026#34;\u0026#39;}; rule Assignment-Expression {var \u0026lt;Variable\u0026gt;\u0026#39;=\u0026#39;\u0026lt;Number\u0026gt;}; rule Function-Call {console \u0026#39;.\u0026#39;log \u0026#39;(\u0026#39;\u0026lt;String\u0026gt;\u0026#39;+\u0026#39;\u0026lt;Variable\u0026gt;\u0026#39;+\u0026#39;\u0026lt;String\u0026gt;\u0026#39;)\u0026#39;}; rule TOP {\u0026lt;Assignment-Expression\u0026gt;\u0026#39;;\u0026#39;\u0026lt;Function-Call\u0026gt;\u0026#39;;\u0026#39;} } class Actions { method Assignment-Expression( $/ ) { make \u0026#39;my $\u0026#39; ~ $/\u0026lt;Variable\u0026gt; ~ \u0026#39;= \u0026#39; ~ $/\u0026lt;Number\u0026gt; ~ \u0026#39;;\u0026#39; } method Function-Call( $/ ) { make \u0026#39;say \u0026#39; ~ $/\u0026lt;String\u0026gt;[0] ~ \u0026#39;~ $\u0026#39; ~ $/\u0026lt;Variable\u0026gt; ~ \u0026#39;~ \u0026#39; ~ $/\u0026lt;String\u0026gt;[1] ~ \u0026#39;;\u0026#39;; } method TOP( $/ ) { make $/\u0026lt;Assignment-Expression\u0026gt;.ast ~ $/\u0026lt;Function-Call\u0026gt;.ast } } my $j = JavaScript.new; my $a = Actions.new; say $j.parse( \u0026#39;var a = 3; console.log( \u0026#34;Hey, did you know a = \u0026#34; + a + \u0026#34;?\u0026#34; );\u0026#39;, :actions($a)).ast; åˆ°å“ªé‡Œå» ä¸€ä¸ªç®€å•ä½†æ•´æ´çš„æ›´æ”¹æ˜¯ä½ å¯ä»¥æ‰©å±• Assignment-Expression æ¥æ—¢æ¥æ”¶æ•°å­—åˆæ¥æ”¶å­—ç¬¦ä¸²ã€‚ä¸Šæ¬¡æˆ‘ä»¬è°ˆè®ºäº† rules ä¸­çš„è½®è¯•,æ‰€ä»¥è¿™ä¸ªæç¤ºåº”è¯¥è¶³å¤Ÿè®©ä½ å¼€å§‹äº†:\nrule Assignment-Expression {var \u0026lt;Variable\u0026gt;\u0026#39;=\u0026#39;(\u0026lt;Number\u0026gt;|\u0026lt;String\u0026gt;)} ä½ å¿…é¡»ä¿®æ”¹ä¸‹ Assignment-Expression æ–¹æ³•ä»¥ä½¿å®ƒèµ·ä½œç”¨ã€‚æˆ–è€…ä½ å¯ä»¥ç‹¡çŒ¾ä¸€ç‚¹ç„¶åå‘ç°( \u0026lt;Number\u0026gt; | \u0026lt;String\u0026gt; ) å¯ä»¥è½¬æ¢ä¸ºå®ƒè‡ªå·±çš„å°çš„æ™®é€šçš„ \u0026ldquo;Term\u0026rdquo; rule, \u0026ldquo;rule Term { | }\u0026rdquo;, ç„¶åæ·»åŠ ä¸€ä¸ª action \u0026ldquo;method Term($/) { make $/or $/}\u0026rdquo; è€Œåªåœ¨ Assignment-Expression ä¸­ä¿®æ”¹ä¸€ä¸ªä¸œè¥¿ã€‚\nhttp://theperlfisher.blogspot.fr/2016/02/from-regular-expressions-to-grammars-pt_28.html\n","permalink":"https://ohmyweekly.github.io/notes/2015-10-29-from-regex-to-grammar/","tags":["regex","grammar"],"title":"ä»æ­£åˆ™è¡¨è¾¾å¼åˆ° Grammar(ç¬¬äºŒéƒ¨åˆ†)"},{"categories":["rakulang"],"contents":"ä»¥æŒ‡å®šéŸ³é‡éšæœºæ’­æ”¾éŸ³é¢‘æ–‡ä»¶ï¼š\n#!/usr/bin/env raku my %v; # hash to hold data my token filename {.+?\\.\\S\\S\\S}; # filenames end in .??? my token volume {\\d+}; # any digits for volume my regex extra {.+\\S}; # anything following that my $mixer = \u0026#39;mixer\u0026#39;; my $player = \u0026#39;mplayer -vf dsize=600:-2 -geometry +200-10 \u0026#39;; my $lockfile = \u0026#39;/tmp/myplayer\u0026#39;; $lockfile.IO.spurt( $*PID ); # store the process ID so other process can kill this one END { $lockfile.IO.unlink; } # remove the lockfile at end for $=finish.lines { # loop through the lines below \u0026#39;=begin finish\u0026#39; last if /STOP/; # stop at a STOP line if m/(\u0026lt;filename\u0026gt;)\\s+(\u0026lt;volume\u0026gt;)\\s*(\u0026lt;extra\u0026gt;?)/ { # use the regexes/tokens my ( $m, $v, $e ) = $/[0..2]; # get captured values from $/ if $m and $v { # if there\u0026#39;s a filename and volume %v{$m}\u0026lt;v\u0026gt; ~= $v; # store it in the hash %v{$m}\u0026lt;e\u0026gt; ~= $e // \u0026#39;\u0026#39;; # with any extra arguments }}} # lisp-y to save lines for %v.keys.pick(*) -\u0026gt; $m { # loop randomly through keys say \u0026#34;Playing $m\u0026#34;; print qqx{$mixer%v{$m}\u0026lt;v\u0026gt;}; # set the volume print qqx{$player%v{$m}\u0026lt;e\u0026gt;\u0026#34;$m\u0026#34; }; # play the file } =beginfinish300.avi 77 Crystal Skull Rifftrax.avi 77 -aid 2 Star Trek 5.avi 77 Star Trek 7.avi aeon-flux.avi 93 =end finishæ”¹è¿›ç‰ˆï¼š\n#! /usr/bin/env raku my @mixer = \u0026#39;mixer\u0026#39;; my @player = \u0026lt;m6player -vf dsize=600:-2 -geometry +200-10 \u0026gt;; my $lockfile = \u0026#39;/tmp/myplayer\u0026#39;; $lockfile.IO.spurt( $*PID ); END { $lockfile.IO.unlink; } my token filename {.+?\\.\\S\\S\\S}; my token volume {\\d+}; my regex extra {.*}; my %song-data; for $=finish.lines { last if /^ \\s*STOP \\s*$/; next unless m/ \\s* \u0026lt;filename\u0026gt; \\s+ \u0026lt;volume\u0026gt; \u0026lt;extra\u0026gt; /; # $\u0026lt;extra\u0026gt; is short for $/{\u0026#39;extra\u0026#39;} %song-data{~$\u0026lt;filename\u0026gt;}\u0026lt;v e\u0026gt; = +$\u0026lt;volume\u0026gt;, [$\u0026lt;extra\u0026gt;.words]; } # uses sub-signature unpacking for %song-data.pick(*) -\u0026gt; ( :key($m), :value($) (:$v,:@e)) { say \u0026#34;Playing $m\u0026#34;; print run( @mixer, $v, :out ).out.slurp-rest.indent(4); print run( @player, @e, $m, :out ).out.slurp-rest.indent(4); } =beginfinish300.avi 77 Crystal Skull Rifftrax.avi 77 -aid 2 Star Trek 5.avi 77 Star Trek 7.avi aeon-flux.avi 93 =end finish","permalink":"https://ohmyweekly.github.io/notes/2015-06-14-play-audio-at-given-volume/","tags":["regex","audio"],"title":"ä»¥æŒ‡å®šéŸ³é‡éšæœºæ’­æ”¾éŸ³é¢‘æ–‡ä»¶"},{"categories":["rakulang"],"contents":" è§£æ[ ] é‡Œé¢çš„æ•°æ®ï¼š  use Grammar::Debugger; grammar Lines { token TOP {^\u0026lt;line\u0026gt;+$} token line {\\[ \u0026lt;student\u0026gt;+%\u0026lt;semicolon\u0026gt;\\] \\n# æ¢è¡Œ \\n æ˜¯æœ€å®¹æ˜“è¢«å¿½ç•¥çš„åœ°æ–¹ } token student {\u0026lt;myname\u0026gt;+%\u0026lt;comma\u0026gt;# åˆ†éš”ç¬¦ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ª subrule } token myname {\u0026lt;[A..Za..z-]\u0026gt;+# å­—ç¬¦ç±»çš„å†™æ³• \u0026lt;[...]\u0026gt; } token comma {\u0026#39;,\u0026#39;\\s+# é€—å·, åˆ†å· ä¸èƒ½è£¸éœ²å‡ºç°åœ¨ token ä¸­ } token semicolon {\u0026#39;;\u0026#39;\\s+} } my $parse = Lines.parsefile(\u0026#39;test.txt\u0026#39;); say $parse; test.txt çš„å†…å®¹å¦‚ä¸‹ï¼š\n[Lue, Fan] [Lou, Man-Li] [Tian, Mijie; Zhou, Lin; Zou, Xiao; Zheng, Qiaoji; Luo, Lingling; Jiang, Na; Lin, Dunmin] ä¸‹é¢çš„ Grammar ç”¨äºè§£æä¸€ä¸ªå­—ç¬¦ä¸², ç”±äº tokens ä¸èƒ½å›æº¯, æ‰€ä»¥å½“è§£æ $str æ—¶ä½¿ç”¨äº† Grammar çš„ç»§æ‰¿, é‡å†™äº† university è¿™ä¸ª token:\nmy $string = \u0026#34;[Wang, Zhiguo; Zhao, Zhiguo] Hangzhou Normal Univ, Ctr Cognit \u0026amp; Brain Disorders, Hangzhou, Zhejiang, Peoples R China; [Wang, Zhiguo; Theeuwes, Jan] Vrije Univ Amsterdam, Dept Cognit Psychol, Amsterdam, Netherlands\u0026#34;; grammar University::Grammar { token TOP {^\u0026lt;university\u0026gt;$} token university { [ \u0026lt;bracket\u0026gt; \u0026lt;info\u0026gt; ]+ % \u0026#39;; \u0026#39; }token bracket { \u0026#39;[\u0026#39; \u0026lt;studentname\u0026gt; \u0026#39;] \u0026#39; }token studentname { \u0026lt;stdname=.info\u0026gt;+ % \u0026#39;; \u0026#39; }token info { \u0026lt;field\u0026gt;+ % \u0026#39;, \u0026#39; }token field { \u0026lt;-[,\\]\\[;\\n]\u0026gt;+ }} # grammar åƒç±»ä¸€æ ·å¯ä»¥ç»§æ‰¿, é‡Œé¢çš„ token å¯ä»¥è¢«é‡å†™ grammar MyUniversity is University::Grammar{ token university {\u0026lt;info\u0026gt;+%\u0026#39;; \u0026#39;}} my $str = \u0026#34;Zhejiang Univ, Coll Environm \u0026amp; Resources Sci, Dept Resource Sci, Hangzhou 310029, Peoples R China; La Trobe Univ, Dept Agr Sci, Bundoora, Vic 3083, Australia; Hangzhou Normal Coll, Fac Life Sci, Hangzhou, Peoples R China\u0026#34;; my $parsed = University::Grammar.parse($string); # my $parsed = MyUniversity.parse($str); for @($parsed\u0026lt;university\u0026gt;\u0026lt;info\u0026gt;) -\u0026gt; $f { say $f\u0026lt;field\u0026gt;[0]; } ","permalink":"https://ohmyweekly.github.io/notes/2015-07-11-an-example-of-parsing-text-in-grammar/","tags":["grammar"],"title":"ä½¿ç”¨ Grammar è§£ææ–‡æœ¬: ä¸€ä¸ªä¾‹å­"},{"categories":["rakulang"],"contents":"æè¿° ä¸‹é¢çš„æ—¥æœŸ, æœ‰äº›ä½¿ç”¨äº† M D Y æ ¼å¼, æœ‰äº›ä½¿ç”¨äº† Y M D æ ¼å¼, è¿˜ä½¿ç”¨äº†ä»»æ„åˆ†éš”ç¬¦! è¯·æŠŠè¿™äº›æ•£ä¹±çš„æ–‡æœ¬è§£ææˆåˆé€‚çš„ ISO 8601 (YYYY-MM-DD) æ ¼å¼åŒ–æ—¥æœŸã€‚\nå‡è®¾åªæœ‰ä»¥ 4 ä¸ªæ•°å­—å¼€å¤´çš„æ—¥æœŸä½¿ç”¨ Y M D æ ¼å¼, å…¶å®ƒçš„ä½¿ç”¨ M D Y æ ¼å¼ã€‚\nè¾“å…¥æ ·æœ¬ 2/13/15 1-31-10 5 10 2015 2012 3 17 2001-01-01 2008/01/07 è¾“å‡ºæ ·æœ¬ 2015-02-13 2010-01-31 2015-05-10 2012-03-17 2001-01-01 2008-01-07 æ‰©å±•æŒ‘æˆ˜ [ä¸­çº§] ä½¿ç”¨ 2014-12-24 ä½œä¸ºç›¸å¯¹æ—¥æœŸçš„åŸºå‡†ã€‚\nå½“æ·»åŠ  days(å¤©æ•°) æ—¶, è¦è€ƒè™‘åˆ°æ¯æœˆä¼šæœ‰ä¸åŒçš„å¤©æ•°, å¿½ç•¥é—°å¹´ã€‚\nå½“æ·»åŠ æœˆå’Œå¹´æ—¶, ä½¿ç”¨æ•´ä¸ª units, ä»¥è‡³äº:\none month before october 10 is september 10\none year after 2001-04-02 is 2002-04-02\none month after january 30 is february 28 (not march 1)\nSally\u0026rsquo;s inputs: tomorrow 2010-dec-7 OCT 23 1 week ago next Monday last sunDAY 1 year ago 1 month ago last week LAST MONTH 10 October 2010 an year ago 2 years from tomoRRow 1 month from 2016-01-31 4 DAYS FROM today 9 weeks from yesterday Sally\u0026rsquo;s expected outputs: 2014-12-25 2010-12-01 2014-10-23 2014-12-17 2014-12-29 2014-12-21 2013-12-24 2014-11-24 2014-12-15 2014-11-24 2010-10-10 2013-12-24 2016-12-25 2016-02-28 2014-12-28 2015-02-25 smls å¤§ç¥ç»™å‡ºäº†å®Œæ•´çš„ grammarï¼š\nmy $today = Date.new(2014, 12, 24); grammar MessyDate { rule TOP {|\u0026lt;date\u0026gt;{ make $\u0026lt;date\u0026gt;.made }|:i\u0026lt;duration\u0026gt;ago { make $today.earlier: |$\u0026lt;duration\u0026gt;.made }|:i\u0026lt;duration\u0026gt;from \u0026lt;date\u0026gt;{ make $\u0026lt;date\u0026gt;.made.later: |$\u0026lt;duration\u0026gt;.made }} rule date {|[||\u0026lt;month\u0026gt;(\u0026lt;sep\u0026gt;?)\u0026lt;day\u0026gt;[$0\u0026lt;year\u0026gt;]?||\u0026lt;day\u0026gt;(\u0026lt;sep\u0026gt;?)\u0026lt;month\u0026gt;[$0\u0026lt;year\u0026gt;]?||\u0026lt;year\u0026gt;(\u0026lt;sep\u0026gt;?)\u0026lt;month\u0026gt;$0\u0026lt;day\u0026gt;]{ make Date.new: $\u0026lt;year\u0026gt;.made//$today.year, |$\u0026lt;month day\u0026gt;Â».made }|:itoday { make $today }|:iyesterday { make $today - 1 }|:itomorrow { make $today + 1 }|:ilast \u0026lt;weekday\u0026gt;{ make $today - ($today.day-of-week - $\u0026lt;weekday\u0026gt;.made) % 7 || 7 }|:inext \u0026lt;weekday\u0026gt;{ make $today + ($\u0026lt;weekday\u0026gt;.made - $today.day-of-week) % 7 || 7 }|:ilast \u0026lt;unit\u0026gt;{ make $today.earlier: |($\u0026lt;unit\u0026gt;.made =\u0026gt; 1) }|:inext \u0026lt;unit\u0026gt;{ make $today.later: |($\u0026lt;unit\u0026gt;.made =\u0026gt; 1) }} rule duration {\u0026lt;count\u0026gt;\u0026lt;unit\u0026gt;{ make $\u0026lt;unit\u0026gt;.made =\u0026gt; $\u0026lt;count\u0026gt;.made }} token year {|\u0026lt;number(4)\u0026gt;{ make +$\u0026lt;number\u0026gt; }|\u0026lt;number(2, 0..49)\u0026gt;{ make 2000 + $\u0026lt;number\u0026gt; }|\u0026lt;number(2, 50..*)\u0026gt;{ make 1900 + $\u0026lt;number\u0026gt; }} token month {|\u0026lt;number(1..2, 1..12)\u0026gt;{ make +$\u0026lt;number\u0026gt; }|:iJan[uary]?{ make 1 }|:iFeb[ruary]?{ make 2 }|:iMar[ch]?{ make 3 }|:iApr[il]?{ make 4 }|:iMay { make 5 }|:iJun[e]?{ make 6 }|:iJul[y]?{ make 7 }|:iAug[ust]?{ make 8 }|:iSep[tember]?{ make 9 }|:iOct[ober]?{ make 10 }|:iNov[ember]?{ make 11 }|:iDec[ember]?{ make 12 }} token day {\u0026lt;number(1..2, 1..31)\u0026gt;{ make +$\u0026lt;number\u0026gt; }} token weekday {|:iMon[day]?{ make 1 }|:iTue[sday]?{ make 2 }|:iWed[nesday]?{ make 3 }|:iThu[rsday]?{ make 4 }|:iFri[day]?{ make 5 }|:iSat[urday]?{ make 6 }|:iSun[day]?{ make 7 }} token sep {\u0026lt;[-/.\\h]\u0026gt;} token count {(\u0026lt;[0..9]\u0026gt;+){ make +$0 }|an?{ make 1 }} token unit {:i(day|week|month|year)s?{ make $0.lc }} multi token number ($digits){ \u0026lt;[0..9]\u0026gt; ** {$digits}} multi token number ($digits, $test){ (\u0026lt;[0..9]\u0026gt; ** {$digits}) \u0026lt;?{ +$0 ~~ $test }\u0026gt; } } for lines() { say MessyDate.parse($_).made // \u0026#34;failed to parse \u0026#39;$_\u0026#39;\u0026#34;; }  [...] æ˜¯éæ•è·åˆ†ç»„ \u0026lt;[...]\u0026gt; æ˜¯ Raku ä¸­çš„å­—ç¬¦ç±» \u0026lt;number(4)\u0026gt; æ˜¯æ‰©å±•çš„ \u0026lt;...\u0026gt; è¯­æ³•, å®é™…ä¸Šæ˜¯æ–¹æ³•è°ƒç”¨  åœ¨ grammar ä¸­, æœ‰ä¸¤ä¸ª regex çš„å˜ä½“, rule å’Œ tokenã€‚rule é»˜è®¤ä¸ä¼šå›æº¯ã€‚rule ä¸ token çš„ä¸€ä¸ªé‡è¦åŒºåˆ«æ˜¯, rule è¿™æ ·çš„æ­£åˆ™é‡‡å–äº† :sigspace ä¿®é¥°ç¬¦ã€‚ rule å®é™…ä¸Šæ˜¯\nregex :ratchet :sigspace { ... } çš„ç®€å†™ã€‚ratchet è¿™ä¸ªå•è¯çš„æ„æ€æ˜¯: (é˜²å€’è½¬çš„)æ£˜é½¿, æ„æ€å®ƒæ˜¯ä¸èƒ½å›æº¯çš„! è€Œ :sigspace è¡¨æ˜æ­£åˆ™ä¸­çš„ç©ºç™½æ˜¯æœ‰æ„ä¹‰çš„, è€Œ token å®é™…ä¸Šæ˜¯:\nregex :ratchet { ... } çš„ç®€å†™ã€‚ æ‰€ä»¥åœ¨ token ä¸­, è‹¥ä¸æ˜¯æ˜¾å¼çš„å†™ä¸Š \\sã€\\hã€\\n ç­‰ç©ºç™½ç¬¦å·, å…¶å®ƒæƒ…å†µä¸‹å°±å¥½åƒç©ºç™½éšèº«äº†ä¸€æ ·, è™½ç„¶ä½ å†™äº†, ä½†æ˜¯ç¼–è¯‘å™¨å´è§†è€Œä¸è§ã€‚\n// åœ¨å·¦ä¾§åŒ¹é…å¤±è´¥æ—¶ä¼šåœ¨å³ä¾§æä¾›ä¸€ä¸ªé»˜è®¤å€¼ã€‚\n\u0026lt;number(4)\u0026gt; å’Œ \u0026lt;number(2, 0..49)\u0026gt; ä¸­ä½¿ç”¨äº†æ‰©å±•äº†çš„ \u0026lt;...\u0026gt; å…ƒè¯­æ³•ã€‚ æ ‡è¯†ç¬¦(ä¾‹å¦‚å·¦é¢çš„ number)åé¢çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å†³å®šäº†é—­åˆå°–æ‹¬å·ä¹‹å‰å‰©ä½™æ–‡æœ¬çš„å¤„ç†ã€‚å®ƒçš„åº•å±‚è¯­ä¹‰æ˜¯å‡½æ•°æˆ–æ–¹æ³•è°ƒç”¨, æ‰€ä»¥, å¦‚æœæ ‡è¯†ç¬¦åé¢çš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯å·¦åœ†æ‹¬å·, é‚£ä¹ˆå®ƒè¦ä¹ˆæ˜¯æ–¹æ³•è°ƒç”¨, è¦ä¹ˆæ˜¯å‡½æ•°è°ƒç”¨:\n\u0026lt;number(4)\u0026gt; ç­‰ä»·äº \u0026lt;number=\u0026amp;number(4)\u0026gt;\n\u0026lt;number(2, 0..49)\u0026gt; ç­‰ä»·äº \u0026lt;number=\u0026amp;number(2, 0..49)\u0026gt;\nmulti token number ($digits) {\u0026lt;[0..9]\u0026gt;**{$digits}} multi token number ($digits, $test) {(\u0026lt;[0..9]\u0026gt;**{$digits})\u0026lt;?{ +$0 ~~ $test }\u0026gt;} åœ¨æ‰©å±•çš„ \u0026lt;...\u0026gt; è¯­æ³•ä¸­, ä¸€ä¸ªå‰ç½®çš„ ?{ æˆ– !{ æ ‡ç¤ºç€ä»£ç æ–­è¨€:\n(\u0026lt;[0..9]\u0026gt; ** {$digits}) \u0026lt;?{ +$0 ~~ $test }\u0026gt; ç­‰ä»·äºï¼š\n# + å¼ºåˆ¶åé¢çš„$0ä¸ºæ•°å€¼ä¸Šä¸‹æ–‡, ä»¥åŒ¹é… $test ä¸­çš„æ•°å­— (\u0026lt;[0..9]\u0026gt; ** {$digits}) { +$0 ~~ $test or fail } ä¸Šé¢çš„ä¸¤å¥ä»£ç , å…·å regex, token, æˆ– rule æ˜¯ä¸€ä¸ªå­ä¾‹ç¨‹, æ‰€ä»¥å¯ä»¥ä¼ é€’å‚æ•°ç»™å…·å tokenã€‚\nè¿™ä»æ ‡å‡†è¾“å…¥é‡Œè¯»å–æ•£ä¹±çš„æ—¥æœŸå¹¶æŠŠå¯¹åº”çš„ ISO æ—¥æœŸå†™åˆ°æ ‡å‡†è¾“å‡ºã€‚\nå®ƒèƒ½è§£æä»»åŠ¡æè¿°ä¸­çš„æ‰€æœ‰æ—¥æœŸï¼ˆåŒ…å«æ‰©å±•ï¼‰, è¿˜æœ‰ - ç„¶è€Œ, åœ¨å®ƒä»¬ä¸­æˆ‘å¾—åˆ° 4 ä¸ªä¸åŒçš„ç»“æœã€‚è¯·å¼„æ¸…å®ƒä»¬æ˜¯å¦æ˜¯é”™è¯¯çš„, å¹¶ä¸”ä¸ºä»€ä¹ˆæ˜¯é”™çš„:\n2010-dec-7 \u0026ndash;\u0026gt; æˆ‘å¾—åˆ° 2010-12-07 è€Œä¸æ˜¯ 2010-12-01\nlast week \u0026ndash;\u0026gt; æˆ‘å¾—åˆ° 2014-12-17 è€Œä¸æ˜¯ 2014-12-15\n1 month from 2016-01-31 \u0026ndash;\u0026gt; æˆ‘å¾—åˆ° 2016-02-29 è€Œä¸æ˜¯ 2016-02-28\n9 weeks from yesterday \u0026ndash;\u0026gt; æˆ‘å¾—åˆ° 2015-02-24 è€Œä¸æ˜¯ 2015-02-25\næœ‰äººåœ¨è¯„è®ºä¸­é—®ä»– make/made æ˜¯ç±»ä¸­çš„æ–¹æ³•å—ï¼Ÿ\næ˜¯çš„, å®ƒä»¬æ˜¯ Match ç±»çš„æ–¹æ³•ã€‚\nMatch objects(æ³¨æ„ object æ˜¯å¤æ•°) æ¯ä¸ª regex match(å¹¶ä¸”é€šè¿‡æ‰©å±•, æ¯ä¸ª grammar token match)çš„ç»“æœè¢«è¡¨ç¤ºä¸ºä¸€ä¸ª Match å¯¹è±¡ã€‚\né€šè¿‡è¿™ä¸ªå¯¹è±¡ä½ èƒ½è®¿é—®å„ç§ä¿¡æ¯ç‰‡æ®µ:\n åŒ¹é…åˆ°çš„å­—ç¬¦ä¸² å…³äºè¾“å…¥å­—ç¬¦ä¸²åŒ¹é…çš„å¼€å§‹å’Œç»“æŸä½ç½® æ¯ä¸ªä½ç½®æ•è·å’Œå…·åæ•è·çš„sub-matches ä¸è¿™ä¸ªåŒ¹é…æœ‰å…³çš„ AST ç‰‡æ®µ, å¦‚æœæœ‰çš„è¯  AST ç‰‡æ®µ åœ¨ token/rule é‡Œé¢è°ƒç”¨ make, è®¾ç½®å°†ä¼šä¸å½“å‰åŒ¹é…å…³è”çš„ \u0026ldquo;AST ç‰‡æ®µ\u0026rdquo;ã€‚ç„¶å, ä½ å¯ä»¥é€šè¿‡åœ¨å½“å‰ç»“æœ Match å¯¹è±¡èº«ä¸Šè°ƒç”¨ .made æ–¹æ³•æ¥è·å–é‚£ä¸ªå…³è”æ•°æ®ã€‚\nè¿™æ­£æ˜¯è‡ªç”±å½¢å¼çš„æ’æ§½, å…è®¸ä½ ä½¿ç”¨ Match å¯¹è±¡å­˜å‚¨ä»»ä½•ä½ æƒ³è¦çš„ä¸œè¥¿å¹¶åœ¨ä»¥åæ£€ç´¢å®ƒ, å°½ç®¡æ˜¾è€Œæ˜“è§è¿™æ„å‘³ç€åƒæˆ‘é‚£æ ·åˆ›å»ºä¸€ä¸ª ASTã€‚\nåœ¨ grammar ä¸­åˆ›å»º \u0026ldquo;AST\u0026rdquo; åœ¨æˆ‘çš„ grammar ä¸­æ¯ä¸ª token/rule ä½¿ç”¨ .made æ¥å–å¾—å®ƒçš„ sub-rule åŒ¹é…æ„å»ºçš„æ•°æ®ç‰‡æ®µ, æŠŠå®ƒä»¬ç»„åˆæˆä¸€ä¸ªæ›´å¤§çš„æ•°æ®ç‰‡æ®µ, è¿™æ˜¯ä¸ºäº†è®©å®ƒçš„ parent rule èƒ½æ£€ç´¢ã€‚ç­‰ç­‰ã€‚\næˆ‘åœ¨æ¯ä¸ª token/rule é‡Œé¢ä½¿ç”¨è¿™äº›è¯­æ³•ç®€å†™æ¥å¼•ç”¨ sub-matches çš„ Match å¯¹è±¡:\n $0 å¼•ç”¨ sub-matchï¼ˆç”±ä¸€ä¸ª () æ•è·ç»„å¯¼è‡´ï¼‰ çš„ç¬¬ä¸€ä¸ªä½ç½®å¤„çš„ Match å¯¹è±¡ã€‚ $\u0026lt;date\u0026gt; å¼•ç”¨ä¸€ä¸ªåå­—ä¸º date çš„å…·å sub-match çš„ Match å¯¹è±¡(é€šè¿‡ \u0026lt;date\u0026gt; é€’å½’å¼•ç”¨åä¸º date çš„ token å¯¼è‡´).  https://www.reddit.com/r/dailyprogrammer/comments/3wshp7/20151214_challenge_245_easy_date_dilemma/\n","permalink":"https://ohmyweekly.github.io/notes/2015-09-15-use-grammar-to-parse-date/","tags":["grammar"],"title":"ä½¿ç”¨ Grammar è§£ææ—¥æœŸ"},{"categories":["rakulang"],"contents":"ä¸¾ä¸ªä¾‹å­, å‡è®¾ person æœ‰ä¸€ä¸ª age å±æ€§. æˆ‘èƒ½å†™ä¸€ä¸ª multimethod, è®©å®ƒæ¥æ”¶ä¸€ä¸ª person ä½œä¸ºå‚æ•°, å¹¶è¿”å›è¿™æ ·çš„ç»“æœå—:\nreturn \u0026#34;child\u0026#34; if age \u0026lt; 16; return \u0026#34;adult\u0026#34; if 16 \u0026lt;= age \u0026lt; 66; return \u0026#34;senior\u0026#34; if age \u0026gt;= 66; class Person { has Int $.age; has Str $.name; } è¿™ä»…ä»…å®šä¹‰äº†ä¸€ä¸ªæ‹¥æœ‰ä¸¤ä¸ªå±æ€§, å«åš Person çš„ç±». age å¿…é¡»æ˜¯ Int å‹, name å¿…é¡»æ˜¯ Str å‹. . è¯­æ³•ä¼šç”Ÿæˆä¸€ä¸ªåªè¯»è®¿é—®å™¨, ä»¥ä½¿æˆ‘ä»¬èƒ½ä»ç±»çš„å¤–éƒ¨è®¿é—® getter æ–¹æ³•.\nç°åœ¨æˆ‘ä»¬æ¥å®šä¹‰ä¸€ä¸ª age-group multi æ¥å‘Šè¯‰ä¸€ä¸ª person å±äºå“ªä¸ª age-group:\nmulti age-group ($person where (*.age \u0026lt; 16) ) { \u0026#34;child\u0026#34; } multi age-group ($person where (*.age \u0026gt;= 66) ) { \u0026#34;senior\u0026#34;} multi age-group ($person) { \u0026#34;adult\u0026#34; } whereä»å¥ç»™å‚æ•°æ·»åŠ äº†ä¸€ä¸ªçº¦æŸ, è¿™ä¸ªçº¦æŸå‘Šè¯‰å‚æ•°å¿…é¡»åŒ¹é…è¿™ä¸ªå‚æ•°å³è¾¹çš„ä¸œè¥¿.è¿™ç”¨äºåŒºåˆ«å°†è¦é€‰å–çš„ multi. whereä»å¥å¯ä»¥æ˜¯ä¸€ä¸ª regex, ç±»å‹, ä¸€ä¸ªç¡®åˆ‡çš„å€¼, ä¸€ä¸ªæ–­è¨€ block,æˆ–è€…ä¸€äº›å…¶å®ƒä¸œè¥¿.\n*.age \u0026lt; 16 éƒ¨åˆ†å¯èƒ½çœ‹èµ·æ¥æ›´è®©äººè¿·æƒ‘. æ˜Ÿå·æ˜¯ä»€ä¹ˆ? æ˜Ÿå·æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å€¼, å«åš Whatever. å®ƒé€šå¸¸åœ¨ç»™å®šæƒ…å†µä¸‹æ»¡è¶³ä½ çš„éœ€æ±‚. åœ¨æ™ºèƒ½åŒ¹é…ä¸­, å®ƒæ€»æ˜¯åŒ¹é…, æ‰€ä»¥ä½ å¯ä»¥åœ¨ given/when block ä¸­å°†å®ƒç”¨ä½œé»˜è®¤å€¼. ä½†æ˜¯ Whatever æœ€æœ‰ç”¨çš„åœ°æ–¹ä¹‹ä¸€æ˜¯åˆ›å»ºåŒ¿å block. å¯¹äºå¤§éƒ¨åˆ†æ“ä½œç¬¦, å¦‚æœä½ åœ¨ Whatever ä¸Šæ‰§è¡Œå®ƒä»¬, å®ƒä¼šäº§ç”Ÿä¸€ä¸ªåŒ¿å block å¹¶ä½¿ç”¨å®ƒä»¬çš„å‚æ•°æ‰§è¡Œæ“ä½œç¬¦. å¦‚æœä¸€ä¸ªè¡¨è¾¾å¼ä¸­æœ‰å¤šä¸ª Whatever, åˆ™ç”Ÿæˆçš„åŒ¿å block ä¼šæœ‰å¤šä¸ªå‚æ•°å¯¹åº”äºç›¸åº”çš„ Whatever ä½ç½®.\nä¾‹å¦‚, * + 1 äº§ç”Ÿä¸€ä¸ª block,ä½¿å‚æ•°çš„å€¼åŠ 1. * + * äº§ç”Ÿä¸€ä¸ª block ä½¿å®ƒçš„ä¸¤ä¸ªå‚æ•°ç›¸åŠ . è¿™ä¸ªä¾‹å­ä¸­, æˆ‘ä»¬è°ƒç”¨ Whatever çš„ ageæ–¹æ³•, å¹¶è¯¢é—®å®ƒæ˜¯å¦å°äº 16. æˆ‘ä»¬èƒ½ç”¨å…¶å®ƒå‡ ç§æ–¹å¼è¾¾åˆ°åŒæ ·çš„æ•ˆæœ, ä½†æ˜¯æ›´å•°å—¦:\nsub ($person) { $person.age \u0026lt; 16 } -\u0026gt; $person { $person.age \u0026lt; 16 } { .age \u0026lt; 16 } ä½†æ˜¯å¯¹äºåƒè¿™ç§ç®€å•çš„æ“ä½œ, Whatever é€šå¸¸æ¯”å…¶å®ƒæ–¹å¼æ›´æ˜“è¯»ä¹Ÿæ›´ç®€æ´. ä¸å¹¸çš„æ˜¯, åœ¨å‚æ•°åˆ—è¡¨çš„ where ä»å¥ä¸­, ä½ éœ€è¦ä½¿ç”¨æ‹¬å·æ‹¬èµ·å¾ˆå¤šå¤æ‚çš„è¡¨è¾¾å¼, åŒ…æ‹¬ Whatever block.\nç°åœ¨è®©æˆ‘ä»¬åœ¨ Rakudo çš„ REPL ä¸­è¯•è¯•å®ƒå§:\n\u0026gt; age-group Person.new(:name\u0026lt;timmy\u0026gt;, :age(10)) child \u0026gt; age-group Person.new(:name\u0026lt;john\u0026gt;, :age(23)) adult \u0026gt; age-group Person.new(:name\u0026lt;ezekiel\u0026gt;, :age(89)) senior ç›®å‰ä¸ºæ­¢, å¾ˆå¥½. ä½†æ˜¯å¦‚æœæˆ‘ä»¬æ„å¤–åœ°ä¼ é€’äº†ä¸€ä¸ª age è€Œä¸æ˜¯ Person ç»™ age-group å‘¢?\n\u0026gt; age-group 15 Method \u0026#39;age\u0026#39; not found for invocant of class \u0026#39;Int\u0026#39; æˆ‘ä»¬èƒ½æŒ‡å®šåªæœ‰ Person å¯¹äº age-group æ˜¯åˆæ³•çš„:\nmulti age-group (Person $person where (*.age \u0026lt; 16)) { \u0026#34;child\u0026#34; } multi age-group (Person $person where (*.age \u0026gt;= 66)) { \u0026#34;senior\u0026#34; } multi age-group (Person $person) { \u0026#34;adult\u0026#34; } è¿™æ­£ç¡®åœ°å¤„ç†äº† Person é—®é¢˜. è°ƒç”¨å¸¦æœ‰ age å‚æ•°çš„ age-group ä¼šæ€æ ·å‘¢?\n\u0026gt; age-group 15 No applicable candidates found to dispatch to for \u0026#39;age-group\u0026#39;. Available candidates are: :(Person $person where ({ ... })) :(Person $person where ({ ... })) :(Person $person) çœ‹èµ·æ¥æ›´å¥½. å‡å¦‚æˆ‘ä»¬å…è®¸è¯¢é—® age æ‰€å±çš„ age-group å‘¢?\næˆ‘ä»¬èƒ½é‡å†™ age-group çš„ Person å˜ä½“, æ¥æ”¶ Int ç±»å‹çš„ age, å¹¶å†™ä¸€ä¸ªå•ä¸ªçš„ Person å˜ä½“æ¥è°ƒç”¨ age-group:\nmulti age-group(Int $age where (* \u0026lt; 16) ) { \u0026#34;child\u0026#34; } multi age-group(Int $age where (* \u0026gt;= 66) ) { \u0026#34;senior\u0026#34; } multi age-group(Int $age) { \u0026#34;adult\u0026#34; } multi age-group(Person $person) { age-group $person.age } è¿™å¯¹äºæ¯ä¸ª Person ä¾‹å­éƒ½æœ‰æ•ˆ, è¿˜æœ‰å®ƒä»¬çš„ ages.\nç°åœ¨,è®©æˆ‘ä»¬ä½¿ç”¨ age-group å®šä¹‰ä¸€ä¸ªå«åš print-name çš„ multi æ¥åˆ†å‘. æ ¹æ® age-group åˆ†å‘æœ€æ˜æ˜¾çš„æ–¹æ³•æ˜¯ä½¿ç”¨ where ä»å¥.\nmulti print-name(Person $person where (age-group($person) eq \u0026#34;child\u0026#34;)) { \u0026#34;Little {$person.name}\u0026#34; } multi print-name(Person $person where (age-group($person) eq \u0026#34;adult\u0026#34;)) { $person.name } multi print-name(Person $person where (age-group($person) eq \u0026#34;senior\u0026#34;)){ \u0026#34;Old Man {$person.name}\u0026#34;} åŒå¼•å·å­—ç¬¦ä¸²ä¸­çš„ {$person.name} å°† block çš„ç»“æœæ’å€¼åˆ°å­—ç¬¦ä¸²ä¸­.\nè®©æˆ‘ä»¬å†è¯•è¯•:\n\u0026gt; print-name Person.new(:name\u0026lt;timmy\u0026gt;, :age(10)) Little Timmy \u0026gt; print-name Person.new(:name\u0026lt;john\u0026gt;, :age(23)) John \u0026gt; print-name Person.new(:name\u0026lt;ezekiel\u0026gt;, :age(89)) Old Man Ezekiel é‚£å¾ˆæ£’. ä½†æ˜¯å¦‚æœæˆ‘ä»¬æœ‰æ›´å¤šçš„åŸºäº person çš„ age-group çš„ multis è¦åˆ†å‘å‘¢? éš¾é“æˆ‘ä»¬çœŸçš„æ¯æ¬¡éƒ½è¦å†™å‡º (Person $person where (age-group($person) eq \u0026quot;child\u0026quot;)) è¿™æ ·çš„ä»£ç å—? ä¸, æˆ‘ä»¬ä¸éœ€è¦, æ„Ÿè°¢ subset ç±»å‹.\nsubset Child of Person where *.age \u0026lt; 16; subset Adult of Person where -\u0026gt; $person { 16 \u0026lt;= $person.age \u0026lt; 66 }; subset Senior of Person where *.age \u0026gt;= 66; multi print-name(Child $person) { \u0026#34;Little {$person.name}\u0026#34; } multi print-name(Adult $person) { $person.name } multi print-name(Senior $person) { \u0026#34;Old Man {$person.name}\u0026#34; } ç”±äº Rakudo åœ¨å¤„ç†å«æœ‰ç»„åˆçš„é“¾å¼æ¯”è¾ƒæ“ä½œç¬¦çš„ Whatever æ—¶æœ‰ä¸€ä¸ª bug, æˆ‘ä»¬ä¸å¾—ä¸ä¸º Adult å†™ä¸€ä¸ªæ˜¾å¼çš„ block.\nè¿™ä¸ª bug ç°å·²ä¿®å¤, æ‰€ä»¥:\nsubset Adult of Person where -\u0026gt; $person { 16 \u0026lt;= $person.age \u0026lt; 66 }; ç­‰ä»·äº:\nsubset Adult of Person where 16 \u0026lt;= *.age \u0026lt; 66; è¿™ä¸ªæ–°ç‰ˆæœ¬çš„ print-name ä¸ä¹‹å‰æ—§ç‰ˆæœ¬äº§ç”ŸåŒæ ·çš„ç»“æœ. ç°åœ¨æˆ‘ä»¬èƒ½ä» Child/Adult/Senior çš„è§’åº¦é‡å†™ age-group :\nmulti age-group(Child) { \u0026#34;child\u0026#34; } multi age-group(Adult) { \u0026#34;adult\u0026#34; } multi age-group(Senior) { \u0026#34;senior\u0026#34; } multi age-group(Int $age) { age-group Person.new(:$age) } :$age æ˜¯ :age($age) çš„ç®€å†™æ–¹å¼.\nåˆä¸€æ¬¡, æˆ‘ä»¬æœ‰äº†äº§ç”Ÿæƒ³è¦çš„ç»“æœçš„æ›´æ¸…æ™°çš„ä»£ç , å¤šäºäº† multiple åˆ†å‘å’Œ subset ç±»å‹.\n","permalink":"https://ohmyweekly.github.io/notes/2016-01-04-an-example-of-raku-subset-and-multi/","tags":["rakulang"],"title":"ä½¿ç”¨ Raku çš„ subsets å’Œ multi è¾¨åˆ«å¹´é¾„"},{"categories":["rakulang"],"contents":"ä¸ºè‡ªå®šä¹‰çš„ç±»æ·»åŠ ä¸‹æ ‡(subscripts) å‡å¦‚ä½ å®šä¹‰äº†ä¸€ä¸ªç±», ä½ æƒ³æŠŠç±»çš„å®ä¾‹ç”¨ä½œæ•£åˆ—é‚£æ ·, å¯ä»¥ç´¢å¼•å…¶ä¸­çš„å…ƒç´ , é‚£ä¹ˆä½ éœ€è¦è®©ä½ å¾—è‡ªå®šä¹‰éµå®ˆ Associative æ¥å£, å¹¶é‡å†™ AT-KEYã€EXISTS-KEYã€DELETE-KEYã€push ç­‰è·Ÿæ•£åˆ—æœ‰å…³çš„æ–¹æ³•:\nclass HTTPHeader { ... } class HTTPHeader does Associative { has %!fields handles \u0026lt;self.AT-KEY self.EXISTS-KEY self.DELETE-KEY self.push list kv keys values\u0026gt;; method Str { say self.hash.fmt; } multi method EXISTS-KEY ($key) { %!fields{normalize-key $key}:exists } multi method DELETE-KEY ($key) { %!fields{normalize-key $key}:delete } multi method push (*@_) { %!fields.push: @_ } sub normalize-key ($key) { $key.subst(/\\w+/, *.tc, :g) } # titileCase é©¼å³°å¼çš„é”® method AT-KEY (::?CLASS:D: $key) is rw { my $element := %!fields{normalize-key $key}; Proxy.new( FETCH =\u0026gt; method () { $element }, STORE =\u0026gt; method ($value) { $element = do given $valueÂ».split(/\u0026#39;,\u0026#39;\\s+/).flat { when 1 { .[0] } # a single value is stored as a string default { .Array } # multiple values are stored as an array } } ); } } my $header = HTTPHeader.new; say $header.WHAT; #-\u0026gt; (HTTPHeader) \u0026#34;\u0026#34;.say; $header\u0026lt;Accept\u0026gt; = \u0026#34;text/plain\u0026#34;; $header{\u0026#39;Accept-\u0026#39; X~ \u0026lt;Charset Encoding Language\u0026gt;} = \u0026lt;utf-8 gzip en\u0026gt;; $header.push(\u0026#39;Accept-Language\u0026#39; =\u0026gt; \u0026#34;fr\u0026#34;); # like .push on a Hash say $header.hash.fmt; \u0026#34;\u0026#34;.say; # say $header.Str; # åŒä¸Š say $header\u0026lt;Accept-Language\u0026gt;.values; say $header\u0026lt;Accept-Charset\u0026gt;; è¾“å‡ºï¼š\n(HTTPHeader) Accept\ttext/plain Accept-Charset\tutf-8 Accept-Encoding\tgzip Accept-Language\ten fr (en fr) utf-8 åŒæ ·, ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æ•°ç»„ä¸‹æ ‡, åªè¦ä½ é‡å†™ç›¸åº”åœ°æ–¹æ³•ã€‚\nå…³äºä¸ºè‡ªå®šä¹‰çš„ç±»æ·»åŠ ä¸‹æ ‡è¿™ä¸ªé—®é¢˜, stackoverflow ä¸Šçš„å›ç­”æ˜¯ä¸éœ€è¦åœ¨ handles åé¢æ‰€è·Ÿçš„æ–¹æ³•ä¸­æ·»åŠ  selfã€‚ ä»–çš„è§£é‡Šå¦‚ä¸‹:\nä¸ºè‡ªå®šä¹‰çš„ç±»æ·»åŠ ä¸‹æ ‡(subscripts) åœ¨è‡ªå®šä¹‰ç±»ä¸Šå®ç°å…³è”å¼ä¸‹æ ‡(associative subscripting)ã€‚\né€šè¿‡ä»£ç†å®ç° Raku é€šè¿‡åœ¨å®ç°äº†é›†åˆç±»å‹çš„å¯¹è±¡èº«ä¸Šè°ƒç”¨è‰¯å®šä¹‰çš„æ–¹æ³•æ¥å®ç°å…³è”å¼ä¸‹æ ‡å’Œä½ç½®ä¸‹æ ‡ï¼ˆå¯¹äºå†…ç½®ç±»å‹ï¼‰ã€‚é€šè¿‡åœ¨ %!fields å±æ€§åé¢æ·»åŠ  handles ç‰¹æ€§(trait), ä½ å°±æŠŠè¿™äº›æ–¹æ³•è°ƒç”¨ä¼ é€’ç»™äº† %!fields - å®ƒä½œä¸ºä¸€ä¸ªæ•£åˆ—, ä¼šçŸ¥é“æ€ä¹ˆæ¥å¤„ç†é‚£äº›æ–¹æ³•ã€‚\nçµæ´»çš„é”®  However, HTTP header field names are supposed to be case-insensitive (and preferred in camel-case). We can accommodate this by taking the *-KEY and push methods out of the handles list, and implementing them separately\u0026hellip;\n æŠŠæ‰€æœ‰çš„é”®å¤„ç†æ–¹æ³•ä»£ç†ç»™å†…éƒ¨çš„æ•£åˆ—æ„å‘³ç€ä½ çš„é”®å¾—åˆ°äº†æ•£åˆ—é‚£æ ·çš„æ’å€¼ - æ„å‘³ç€å®ƒä»¬å°†æ˜¯å¤§å°å†™æ— å…³çš„å› ä¸ºæ•£åˆ—çš„é”®æ˜¯å¤§å°å†™æ— å…³çš„ã€‚ä¸ºäº†é¿å…é‚£, ä½ æŠŠæ‰€æœ‰è·Ÿé”®æœ‰å…³çš„æ–¹æ³•ä» handles å­å¥ä¸­æ‹¿å‡ºå¹¶è‡ªå·±å®ç°é‚£äº›æ–¹æ³•ã€‚åœ¨ä¾‹å­ä¸­, é”®åœ¨è¢«ç´¢å¼•åˆ° %!fields è®©é”®å˜æˆå¤§å°å†™æ— å…³ä¹‹å‰å…ˆè¿›è¡Œäº†é”®çš„ã€Œæ ‡å‡†åŒ–ã€ã€‚\nçµæ´»çš„å€¼ ä¾‹å­ä¸­çš„æœ€åä¸€éƒ¨åˆ†å±•ç¤ºäº†å½“å€¼å­˜å…¥åˆ°æ•£åˆ—é‚£æ ·çš„å®¹å™¨ä¸­æ—¶ä½ å¦‚ä½•æ§åˆ¶å€¼çš„æ’å€¼ã€‚åˆ°ç›®å‰ä¸ºæ­¢, é€šè¿‡èµ‹å€¼ç»™è¿™ä¸ªè‡ªå®šä¹‰å®¹å™¨çš„å®ä¾‹æä¾›çš„å€¼è¦ä¹ˆæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸², è¦ä¹ˆæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„æ•°ç»„ã€‚é¢å¤–çš„æ§åˆ¶æ˜¯é€šè¿‡ç§»é™¤å®šä¹‰åœ¨çµæ´»çš„é”®ä¸­çš„ AT-KEY æ–¹æ³•æ¥è¾¾æˆçš„å¹¶æä¾›ä¸€ä¸ª Proxy å¯¹è±¡æ¥ä»£æ›¿å®ƒã€‚å¦‚æœä½ ç»™å®¹å™¨èµ‹å€¼, é‚£ä¹ˆä»£ç†äººå¯¹è±¡çš„ STORE æ–¹æ³•ä¼šè¢«è°ƒç”¨å¹¶ä¸”é‚£ä¸ªæ–¹æ³•ä¼šæ‰«ææ‰€æä¾›çš„å­—ç¬¦ä¸²å€¼ä¸­çš„ \u0026quot;, \u0026quot;ï¼ˆæ³¨æ„ç©ºæ ¼æ˜¯å¿…è¦çš„ï¼‰ã€‚å¦‚æœæ‰¾åˆ°ä¼šæ¥æ”¶é‚£ä¸ªå­—ç¬¦ä¸²å€¼ä½œä¸ºå‡ ä¸ªå­—ç¬¦ä¸²å€¼çš„è¯´æ˜ä¹¦ã€‚\nclass HTTPHeader { ... } class HTTPHeader does Associative { has %!fields handles \u0026lt;list kv keys values\u0026gt;; method Str { say self.hash.fmt; } multi method EXISTS-KEY ($key) { %!fields{normalize-key $key}:exists } multi method DELETE-KEY ($key) { %!fields{normalize-key $key}:delete } multi method push (*@_) { %!fields.push: @_ } sub normalize-key ($key) { $key.subst(/\\w+/, *.tc, :g) } method AT-KEY (::?CLASS:D: $key) is rw { my $element := %!fields{normalize-key $key}; Proxy.new( FETCH =\u0026gt; method () { $element }, STORE =\u0026gt; method ($value) { $element = do given $valueÂ».split(/\u0026#39;,\u0026#39;\\s+/).flat { when 1 { .[0] } # a single value is stored as a string default { .Array } # multiple values are stored as an array } } ); } } my $header = HTTPHeader.new; say $header.WHAT; #-\u0026gt; (HTTPHeader) \u0026#34;\u0026#34;.say; $header\u0026lt;Accept\u0026gt; = \u0026#34;text/plain\u0026#34;; $header{\u0026#39;Accept-\u0026#39; X~ \u0026lt;Charset Encoding Language\u0026gt;} = \u0026lt;utf-8 gzip en\u0026gt;; $header.push(\u0026#39;Accept-Language\u0026#39; =\u0026gt; \u0026#34;fr\u0026#34;); # like .push on a Hash say $header.hash.fmt; \u0026#34;\u0026#34;.say; # say $header.Str; # åŒä¸Š say $header\u0026lt;Accept-Language\u0026gt;.values; say $header\u0026lt;Accept-Charset\u0026gt;; è¾“å‡ºï¼š\n(HTTPHeader) Accept\ttext/plain Accept-Charset\tutf-8 Accept-Encoding\tgzip Accept-Language\ten fr (en fr) utf-8 åŒæ ·, ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨æ•°ç»„ä¸‹æ ‡, åªè¦ä½ é‡å†™ç›¸åº”åœ°æ–¹æ³•ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2015-08-18-add-subscripts-for-custom-class-in-raku/","tags":["subscript"],"title":"åœ¨ Raku ä¸­ä¸ºè‡ªå®šä¹‰çš„ç±»æ·»åŠ ä¸‹æ ‡"},{"categories":["rakulang"],"contents":"Raku ä¸­æ€ä¹ˆä¸ºå·²å­˜åœ¨çš„ç±»æ·»åŠ æ–¹æ³• Int ç±»æœ‰ä¸€ä¸ªæ–¹æ³•å«åš is-prime, æˆ‘æƒ³ä¸º Int ç±»å‹æ·»åŠ å…¶å®ƒçš„æ–¹æ³•ã€‚\nclass MyInt is Int { method is-even () returns Bool:D { return False if self % 2; return True; } } my $n = MyInt.new(138); say $n.is-even; é€šè¿‡ç±»çš„ç»§æ‰¿ä¹Ÿæ˜¯ä¸€ç§æ–¹æ³•, ä½†æ˜¯ä¸æ˜¯æˆ‘æƒ³è¦çš„ã€‚Swift ä¸­å¯ä»¥é€šè¿‡æ‰©å±•æ¥å®ç°, Raku ä¸­æœ‰ä¸€ä¸ª add_method æ–¹æ³•:\nmethod add_method(Metamodel::MethodContainer: $obj, $name, $code) è¿™ä¼šç»™å…ƒç±»(meta class)æ·»åŠ ä¸€ä¸ªæ–¹æ³•, ä½¿ç”¨ $name ä½œä¸ºè°ƒç”¨çš„æ–¹æ³•åã€‚è¿™åªä¼šåœ¨ç±»å‹è¢«ç»„åˆå‰ä½¿ç”¨ã€‚\nInt.^add_method( \u0026#39;is-even\u0026#39;, method () returns Bool:D { return False if self % 2; return True; } ); say 137.is-even; say Int.^methods; å¦‚æœæˆ‘è°ƒç”¨ Int.^methods æ—¶, is-even æ²¡æœ‰å‡ºç°ã€‚ä½†æ˜¯ä¸Šé¢çš„ä»£ç èƒ½è¢«è°ƒç”¨å¹¶èµ·ä½œç”¨äº†ã€‚\nInt.^add_method(\u0026#39;fac\u0026#39;, method () returns Int:D { return 1 if self == 0; return 1 if self == 1; my $sum = 1; for 1 .. self {$sum *= $_}; return $sum; }); 1.fac # 1 5.fac # 120 method åé¢çš„åœ†æ‹¬å·æ˜¯æ–¹æ³•çš„ç­¾åï¼š\nInt.^add_method(\u0026#39;power\u0026#39;, method (Int $num) returns Int:D { return self ** $num; }); 2.power(3).say; # 8 2.power(10).say; # 1024 è¯æ³•æ–¹æ³• æˆ‘å¯ä»¥è®©æ–¹æ³•ä¸ä¾é™„äºä»»ä½•ç±», å¹¶ä¸”èƒ½åœ¨å¯¹è±¡ä¸Šè°ƒç”¨è¯¥æ–¹æ³•:\nmy \u0026amp;is-even = method (Int:D :) returns Bool:D { self %% 2 }; è¿™æ„å»ºäº†ä¸€ä¸ª Callableï¼ˆæŸ¥çœ‹ä»¥ä¸‹ \u0026amp;is-even.WHATï¼‰ã€‚ åœ¨ç­¾åä¸­, æˆ‘æŠŠå®ƒçº¦æŸä¸ºä¸€ä¸ªå®šä¹‰äº†çš„ Int ç±»å‹çš„å€¼(Int:D), ä½†æ˜¯æ²¡æœ‰ç»™å®ƒåå­—ã€‚æˆ‘åœ¨ç±»å‹çº¦æŸåé¢æ·»åŠ å†’å·æ¥è¯´æ˜ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è°ƒç”¨è€…ã€‚ç°åœ¨æˆ‘èƒ½æŠŠè¿™ä¸ªæ–¹æ³•åº”ç”¨åˆ°ä»»ä½•æˆ‘æƒ³è¦çš„å¯¹è±¡ä¸Š:\nsay 137.\u0026amp;is-even; say 138.\u0026amp;is-even; say \u0026#34;foo\u0026#34;.\u0026amp;is-even; # works, although inside is-even blow up ","permalink":"https://ohmyweekly.github.io/notes/2015-11-11-add-a-method-to-an-existing-class-in-raku/","tags":["rakulang"],"title":"åœ¨ Raku ä¸­æ€ä¹ˆä¸ºå·²å­˜åœ¨çš„ç±»æ·»åŠ æ–¹æ³•"},{"categories":["rakulang"],"contents":"Proc::Async å…è®¸æˆ‘ä»¬å¼‚æ­¥åœ°æ‰§è¡Œå¤–éƒ¨ç¨‹åºã€‚\nmy $proc = Proc::Async.new(\u0026#34;curl\u0026#34;, \u0026#34;-s\u0026#34;, \u0026#34;-o\u0026#34;, \u0026#34;index.html\u0026#34;, \u0026#34;http://www.cpan.org\u0026#34;); my $res = await $proc.start; æˆ‘ä»¬å¯ä»¥åœ¨ Proc::Async ä¸­ä½¿ç”¨è¶…æ—¶å—? Proc::Async æ²¡æœ‰æ­£å¼æ”¯æŒè¯¥åŠŸèƒ½ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°å®ç°å®ƒã€‚çœ‹ä¸€ä¸‹è¿™ä¸ªï¼š\nclass Proc::Async::Timeout is Proc::Async { has $.timeout is rw; method start($self: |) { return callsame unless $.timeout; my $killer = Promise.in($.timeout).then: { $self.kill }; my $promise = callsame; Promise.anyof($promise, $killer).then: { $promise.result }; } } my $proc = Proc::Async::Timeout.new(\u0026#34;perl\u0026#34;, \u0026#34;-E\u0026#34;, \u0026#34;sleep 5; warn \u0026#39;end\u0026#39;\u0026#34;); $proc.timeout = 1; my $res = await $proc.start; say \u0026#34;maybe timeout\u0026#34; if $res.signal; ä½ ç”šè‡³å¯ä»¥è¿™æ ·åšï¼š\nmy $start = Proc::Async.^methods.first(*.name eq \u0026#34;start\u0026#34;); $start.wrap: method ($self: :$timeout, |c) { return callwith($self, |c) unless $timeout; my $killer = Promise.in($timeout).then: { $self.kill }; my $promise = callwith($self, |c); Promise.anyof($promise, $killer).then: { $promise.result }; }; say await Proc::Async.new(\u0026#34;perl\u0026#34;, \u0026#34;-E\u0026#34;, \u0026#39;sleep 3; say \u0026#34;end\u0026#34;\u0026#39;).start(timeout =\u0026gt; 2); å“‡ï¼Œå“‡ï¼å¦‚æœä½ å‘ç°äº†æ›´é…·çš„æ–¹æ³•ï¼Œè¯·å‘Šè¯‰æˆ‘ã€‚\nhttp://ks0608.hatenablog.com/entry/2016/05/17/001826\n","permalink":"https://ohmyweekly.github.io/notes/2015-05-14-execute-an-external-program-with-timeout-in-raku/","tags":["proc"],"title":"åœ¨ Raku ä¸­æ‰§è¡Œæœ‰è¶…æ—¶çš„å¤–éƒ¨ç¨‹åº"},{"categories":["rakulang"],"contents":"How does one write custom accessor methods in Raku? æˆ‘æœ‰ä¸€ä¸ªç±»:\nclass Wizard { has Int $.mana is rw; } æˆ‘å¯ä»¥è¿™æ ·åš:\nmy Wizard $gandalf .= new; $gandalf.mana = 150; æˆ‘æƒ³åœ¨ä¸æ”¾å¼ƒä½¿ç”¨ $gandalf.mana = 150; çš„æƒ…å†µä¸‹, åœ¨ setter é‡Œé¢åšä¸€äº›æ£€æŸ¥ã€‚æ¢å¥è¯è¯´, æˆ‘ä¸æƒ³è¿™æ ·å†™: $gandalf.setMana(150)ã€‚ å¦‚æœç¨‹åºå°è¯•è®¾ç½®ä¸€ä¸ªè´Ÿå€¼çš„è¯, å°±é€€å‡ºã€‚\nclass Wizard { has Int $!mana; method mana() is rw { return Proxy.new: FETCH =\u0026gt; sub ($) { return $!mana }, STORE =\u0026gt; sub ($, $mana) { die \u0026#34;It\u0026#39;s over 9000!\u0026#34; if ($mana // 0) \u0026gt; 9000; $!mana = $mana; } } } my Wizard $gandalf .= new; say $gandalf.mana; $gandalf.mana = 150; say $gandalf.mana; Pxoxy æ˜¯ä¸€ç§æ‹¦æˆªå¯¹å­˜å‚¨è¿›è¡Œè¯»å†™è°ƒç”¨, å¹¶åšä¸€äº›éé»˜è®¤è¡Œä¸ºçš„æ–¹å¼ã€‚åœ¨è§£æåƒ $gandalf.mana = $gandalf.mana + 5 è¿™ç§è¡¨è¾¾å¼çš„æ—¶å€™, Raku ä¼šè‡ªåŠ¨è°ƒç”¨ FETCH å’Œ STORE æ–¹æ³•ã€‚\nclass Baby { # use . instead of ! for better `.raku` representation  has Int $.mana; # overwrite the method the attribute declaration added method mana () is rw { Proxy.new( FETCH =\u0026gt; -\u0026gt; $ { $!mana }, STORE =\u0026gt; -\u0026gt; $, Int $new { die \u0026#39;invalid mana\u0026#39; unless $new \u0026gt;= 0; # placeholder for a better error $!mana = $new; }) } } my Baby $baby .= new; $baby.mana = 9; say $baby.mana; $baby.mana = -9; ","permalink":"https://ohmyweekly.github.io/notes/2015-05-19-how-to-write-custom-accessor-methods-in-raku/","tags":["accessor"],"title":"åœ¨ Raku ä¸­è‡ªå®šä¹‰å­˜å–å™¨"},{"categories":["rakulang"],"contents":"æ‰©å±• Raku ä¸­çš„ç±»å‹ ä½¿ç”¨ç»§æ‰¿ class BetterInt is Int { method even { self %% 2 } } my BetterInt $x .= new: 42; say $x.even; $x .= new: 71; say $x.even; say $x + 42; # OUTPUT: # True # False # 113 my BetterInt $x çº¦æŸ $x åªèƒ½åŒ…å« BetterInt æˆ–å®ƒçš„å­ç±»è¿™ç§ç±»å‹çš„å¯¹è±¡ã€‚.= new: 42 ç­‰ä»·äº = BetterInt.new: 42ã€‚ ä¸‹é¢çš„å­ä¾‹ç¨‹æœŸæœ›æ¥æ”¶ä¸€ä¸ª Int å‹çš„å‚æ•°ï¼Œä½†æ˜¯ä½ ç»™å®ƒä¼ é€’ä¸€ä¸ª BetterInt ç±»å‹çš„å‚æ•°å®ƒä¼šå¾ˆé«˜å…´:\nsub foo(Int $x) { say \u0026#34;\\$x is $x\u0026#34;} my BetterInt $x .= new: 42; foo $x; # OUTPUT: # $x is 42 But\u0026hellip; But\u0026hellip; But\u0026hellip; å¦å¤–ä¸€ä¸ªé€‰æ‹©æ˜¯æºåˆè¿›ä¸€ä¸ªè§’è‰²(role)ã€‚but ä¸­ç¼€æ“ä½œç¬¦åˆ›å»ºå¯¹è±¡çš„ä¸€ä»½æ‹·è´å¹¶ä¸ºè¯¥å¯¹è±¡æ·»åŠ ä¸€ä¸ªæ–¹æ³•:\nmy $x = 42 but role { method even { self %% 2 } }; say $x.even; # OUTPUT: # True å½“ç„¶è§’è‰²ä¸ä¸€å®šæ˜¯å†…è”çš„ã€‚è¿™å„¿æœ‰å¦å¤–ä¸€ä¸ªä¾‹å­ä½¿ç”¨äº†ä¸€ä¸ªé¢„å®šä¹‰çš„è§’è‰²å¹¶ä¸”è¿˜å±•ç¤ºäº†æˆ‘ä»¬çš„å¯¹è±¡ç¡®å®è¢«æ‹·è´äº†ä¸€ä»½ï¼š\nrole Better { method better { \u0026#34;Yes, I am better\u0026#34; } } class Foo { has $.attr is rw } my $original = Foo.new: :attr\u0026lt;original\u0026gt;; my $copy = $original but Better; $copy.attr = \u0026#39;copy\u0026#39;; say $original.attr; # still \u0026#39;original\u0026#39; say $copy.attr; # this one is \u0026#39;copy\u0026#39; say $copy.better; say $original.better; # fatal error: can\u0026#39;t find method # OUTPUT: # original # copy # Yes, I am better # Method \u0026#39;better\u0026#39; not found for invocant of class \u0026#39;Foo\u0026#39; # in block \u0026lt;unit\u0026gt; at test.p6 line 18 è¿™çœ‹èµ·æ¥æŒºä¸é”™çš„ï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬åŸæ¥çš„ç›®æ ‡æ¥è¯´ï¼Œè¿™ä¸ªæ–¹æ³•è¿˜æ˜¯ç›¸å½“å¼±çš„ï¼š\nmy $x = 42 but role { method even { self %% 2 } }; say $x.even; # True $x = 72; say $x.even; # No such method! é‚£ä¸ªè§’è‰²è¢«æ··åˆè¿›æˆ‘ä»¬å®¹å™¨é‡Œé¢å­˜å‚¨çš„å¯¹è±¡ä¸­äº†ï¼›æ‰€ä»¥ä¸€æ—¦æˆ‘ä»¬åœ¨å®¹å™¨ä¸­æ”¾è¿›äº†ä¸€ä¸ªæ–°çš„å€¼ï¼Œæˆ–é«˜çº§ç‚¹çš„ä¸œè¥¿ï¼Œé‚£ä¹ˆ .even æ–¹æ³•å°±ä¸è§äº†ï¼Œé™¤éæˆ‘ä»¬å†æ¬¡æŠŠé‚£ä¸ªè§’è‰²æ··åˆè¿›æ¥ã€‚\nå­ä¾‹ç¨‹ ä½ çŸ¥é“ä½ å¯ä»¥æŠŠå­ä¾‹ç¨‹å½“åšæ–¹æ³•ç”¨å˜›ï¼Ÿ ä½ æ¥æ”¶é‚£ä¸ªå¯¹è±¡ä½œä¸ºå­ä¾‹ç¨‹çš„ç¬¬ä¸€ä¸ªä½ç½®å‚æ•°å¹¶ä¸”ä½ ç”šè‡³èƒ½ç»§ç»­ä½¿ç”¨é“¾å¼æ–¹æ³•è°ƒç”¨ï¼Œä½†æ˜¯ä¸èƒ½æŠŠé‚£äº›é“¾å­åˆ†è§£æˆå¤šè¡Œï¼š\nsub even { $^a %% 2 }; say 42.\u0026amp;even.uc; # OUTPUT: # TRUE è¿™ç¡®å®æ˜¯ä¸ºæ ¸å¿ƒç±»å‹æ·»åŠ é¢å¤–åŠŸèƒ½çš„ä¸€ç§å¾—ä½“æ–¹å¼ã€‚æˆ‘ä»¬çš„å­ä¾‹ç¨‹å®šä¹‰ä¸­çš„ $^a å¼•ç”¨ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆæˆ‘ä»¬åœ¨è°ƒç”¨çš„é‚£ä¸ªå¯¹è±¡ï¼‰å¹¶ä¸”æ•´ä¸ªå­ä¾‹ç¨‹ä¹Ÿå¯ä»¥è¢«å†™ä¸ºï¼š\nsub ($x) { $x %% 2 } é£é¾™åœ¨å¤© ä¸ç®¡Javaccript çš„é‚£äº›äººä»¬æ€ä¹ˆè·Ÿä½ è¯´, ç„¶è€Œæ‰©å……åŸç”Ÿç±»å‹æ˜¯å±é™©çš„ã€‚å› ä¸ºä½ æ­£å½±å“ç¨‹åºçš„æ‰€æœ‰éƒ¨åˆ†ã€‚ç”šè‡³çœ‹ä¸åˆ°ä½ çš„æ‰©å……çš„æ¨¡å—ä¹Ÿå—åˆ°å½±å“ã€‚\nç°åœ¨æˆ‘æœ‰æƒå‘Šè¯‰ä½ ï¼Œæˆ‘è·Ÿä½ è¯´è¿‡ï¼Œä½ å·¥ä½œçš„æ ¸ç”µå‚èåŒ–äº†ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ä¸€äº›ä»£ç ï¼š\n# Foo.pm6 unit module Foo; sub fob is export { say 42.even; } # Bar.pm6 unit module Bar; use MONKEY-TYPING; augment class Int { method even { self %% 2 } } # test.p6 use Foo; use Bar; say 72.even; fob; # OUTPUT: # True # True æ‰€æœ‰çš„è¡Œä¸ºéƒ½å‘ç”Ÿåœ¨ Bar.pm6 ä¸­ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å†™äº†ä¸€è¡Œ use MONKEY-TYPING å£°æ˜ï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬æ­£åœ¨åšä¸€äº›å±é™©çš„è¡Œä¸ºã€‚ç„¶åæˆ‘ä»¬åœ¨ç±» class Int çš„å‰é¢ä½¿ç”¨äº† augment å…³é”®å­—ä»¥æ‰©å……è¿™ä¸ªå·²ç»å­˜åœ¨çš„ç±»ã€‚æˆ‘ä»¬çš„æ‰©å……æ·»åŠ äº†ä¸€ä¸ªå« even çš„æ–¹æ³•ä»¥å‘Šè¯‰æˆ‘ä»¬é‚£ä¸ª Int æ˜¯å¦æ˜¯å¶æ•°ã€‚\næ‰€æœ‰çš„æ•´æ•°éƒ½å¯ä»¥ä½¿ç”¨ even æ–¹æ³•äº†ï¼Œè¿™è™½ç„¶è¾¾åˆ°äº†æˆ‘ä»¬çš„è¦æ±‚ä½†æ˜¯æœ‰ç‚¹å±é™©ã€‚\næˆ‘é‚ªæ¶äº† æˆ‘ä»¬æ¥æ‰©å…… Cool ç±»å‹ä»¥æ¶µç›–æ‰€æœ‰çš„è¥¿æ–‡æ’ç‰ˆè¡Œé•¿å•ä½ï¼š\nuse MONKEY-TYPING; augment class Cool { method even { self %% 2 } } .say for 72.even, \u0026#39;72\u0026#39;.even, pi.even, Â½.even; # OUTPUT: # Method \u0026#39;even\u0026#39; not found for invocant of class \u0026#39;Int\u0026#39; # in block \u0026lt;unit\u0026gt; at test.p6 line 8 ç³Ÿç³•ï¼Œç¨‹åºå¥”æºƒäº†ï¼åŸå› æ˜¯åœ¨æˆ‘ä»¬æ‰©å…… Cool ç±»å‹çš„æ—¶å€™ï¼Œæ´¾ç”Ÿè‡ª Cool çš„æ‰€æœ‰ç±»å‹å·²ç»æˆå‹äº†(composed)ã€‚æ‰€ä»¥ä¸ºäº†è®©å®ƒèƒ½å·¥ä½œï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨ .^compose å…ƒå¯¹è±¡åè®®æ–¹æ³•æ¥é‡æ–°æ„æˆå®ƒä»¬ï¼š\nuse MONKEY-TYPING; augment class Cool { method even { self %% 2 } } .^compose for Int, Num, Rat, Str, IntStr, NumStr, RatStr; .say for 72.even, \u0026#39;72\u0026#39;.even, pi.even, Â½.even; # OUTPUT: # True # True # False # False å®ƒç°åœ¨èƒ½å·¥ä½œäº†ï¼Int, Num, Rat, Str, IntStr, NumStr, RatStr ç±»å‹æ‹¥æœ‰äº† .even æ–¹æ³•(æ³¨æ„ï¼šè¿™äº›ä¸æ˜¯ç»§æ‰¿è‡ª Cool çš„ä»…æœ‰çš„ç±»å‹)! è¿™æ—¢é‚ªæ¶åˆè®©äººåƒæƒŠã€‚\nç»“è®º å½“æ‰©å…… Raku çš„æ ¸å¿ƒç±»å‹æˆ–å…¶å®ƒä»»æ„ç±»çš„åŠŸèƒ½æ—¶ï¼Œä½ æœ‰å‡ ç§é€‰æ‹©ã€‚\n ä½¿ç”¨ is Class å­ç±» ä½¿ç”¨ but Role æ··åˆä¸€ä¸ªè§’è‰² ä½¿ç”¨ $objec.\u0026amp;sub è°ƒç”¨å­ä¾‹ç¨‹ä½œä¸ºæ–¹æ³•ä½¿ç”¨ ä½¿ç”¨ augmentï¼ˆæ³¨æ„å®‰å…¨ï¼‰  http://blogs.perl.org/users/zoffix_znet/2016/04/extra-typical-perl-6.html\n","permalink":"https://ohmyweekly.github.io/notes/2015-11-25-there-is-more-than-one-way-to-extend-it/","tags":["but","compose"],"title":"æ‰©å±• Raku ä¸­çš„ç±»å‹"},{"categories":["rakulang"],"contents":"æ‰¾å‡ºä¸¤ä¸ªæ–‡ä»¶ä¸­å…±æœ‰çš„è¡Œ, é¡ºåºæ— å…³ç´§è¦ åœ¨ Perl 5 é‡Œ, ä½ å¯ä»¥è¿™æ ·:\n#!/usr/bin/env perl use 5.010; use warnings; use strict; my %filea = map { $_ =\u0026gt; 1 } do { open my $fa, \u0026#39;\u0026lt;\u0026#39;, \u0026#39;filea\u0026#39; or die $!; \u0026lt;$fa\u0026gt; }; my %fileb = map { $_ =\u0026gt; 1 } do { open my $fb, \u0026#39;\u0026lt;\u0026#39;, \u0026#39;fileb\u0026#39; or die $!; \u0026lt;$fb\u0026gt; }; for( keys %filea ){ print if $fileb{$_}; } åœ¨ Raku ä¸­å°±é•¿è¿™æ ·:\n#!/usr/bin/env raku my @a := \u0026#34;filea\u0026#34;.IO.lines; my @b := \u0026#34;fileb\u0026#34;.IO.lines; .say for keys( @a âˆ© @b ); å› ä¸º Raku ä¸­çš„\u0026quot;æƒ°æ€§åˆ—è¡¨â€, åº•å±‚å®ç°èƒ½æŠŠå·¥ä½œåˆ†å‰²æˆä¸åŒçš„ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œ, ç„¶ååœ¨éœ€è¦ç»“æœçš„æ—¶å€™è¿”å›ç»™å®ƒä»¬ã€‚æ‰€ä»¥, è¿™ç§æƒ…å†µä¸‹, @a å’Œ @b çš„å¡«å……å¯ä»¥åŒæ—¶è¿è¡Œ.ä½†æ˜¯è¦ç‚¹æ˜¯, å¦‚æœä½ æœ‰è€—è´¹æ—¶é—´, ä¸å½¼æ­¤ä¾èµ–çš„æ“ä½œ, æˆ–è€…å‡½æ•° A è¦ä¼ é€’ä¸€ä¸ª item åˆ—è¡¨ç»™å‡½æ•° B, è¿™äº›æ“ä½œå¯èƒ½å¹¶è¡Œæ‰§è¡Œ, æé«˜é€Ÿåº¦, ä½ ä¸éœ€è¦åšä»»ä½•çº¿ç¨‹ç›¸å…³çš„ä¸œè¥¿ã€‚éå¸¸èµ!\n","permalink":"https://ohmyweekly.github.io/notes/2015-06-18-find-the-common-lines-in-two-files/","tags":["set"],"title":"æ‰¾åˆ°ä¸¤ä¸ªæ–‡ä»¶ä¸­å…±æœ‰çš„è¡Œ"},{"categories":["rakulang"],"contents":"åœ¨æˆ‘ä»¬æ¢ç´¢ Raku ç­¾åçš„ç¬¬ä¸€éƒ¨åˆ†ä¸­, æˆ‘ä»¬äº†è§£äº†æ€ä¹ˆä½¿ç”¨ Raku å¼ºå¤§è€Œçµæ´»çš„ç±»å‹ç³»ç»Ÿæ¥çº¦æŸå…·åå‚æ•°å’Œä½ç½®å‚æ•°æ˜¯å¦‚ä½•è¢«ä¼ é€’ç»™å­ä¾‹ç¨‹å’Œæ–¹æ³•çš„ã€‚æˆ‘ä»¬è¿˜æ¶‰åŠäº†æ€ä¹ˆä½¿ç”¨ slurp ç­¾åæ¥åˆ›å»ºèƒ½æ¥æ”¶ä»»æ„å…·åå’Œä½ç½®å‚æ•°åˆ—è¡¨çš„å¯å˜å‡½æ•°ã€‚\nRaku çš„ç­¾åç³»ç»Ÿæä¾›äº†æ›´å¤šã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬å°†éªŒè¯å…¶ä¸­æ›´é«˜çº§çš„ç‰¹æ€§, å®ƒä»¬è®© Raku çš„è°ƒç”¨è¯­ä¹‰æ›´å¼ºå¤§ã€‚\nClass çº¦æŸ ä½ å¯ä»¥ä½¿ç”¨ç­¾åæ¥æŒ‡å®šä¼ é€’è¿›å‡½æ•°ä¸­çš„å‚æ•°çš„ç±»å‹çº¦æŸã€‚ä½ ä½¿ç”¨çš„ç±»å‹å¯ä»¥æ˜¯ä»»æ„ç±»åã€‚\nsub foo( Numeric $foo, Str $bar) { say \u0026#34;my string is $barand my number is $foo\u0026#34; } è¿™ä¸ªç­¾åè¦æ±‚æˆ‘ä»¬ä¼ é€’ Numeric å’Œ Str ç±»å‹çš„å‚æ•°ã€‚ä½†æ˜¯å› ä¸º Raku çš„å†…ç½®ç±»å‹å®é™…ä¸Šå°±æ˜¯ç±»(classes), å¹¶ä¸”å› ä¸º Numeric æ‹¥æœ‰å‡ ä¸ªå­ç±»å‹, æˆ‘ä»¬å¯ä»¥ä¼ é€’è¿›ä»»ä½•æ•°å­—ç±»å‹, å®ƒéƒ½èƒ½å·¥ä½œ:\nfoo(42, \u0026#34;blah\u0026#34;); foo(42.99, \u0026#34;yoohoo\u0026#34;); foo(3+9i, \u0026#34;hellooooooo\u0026#34;); # etc æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ç±»ä¸­ç­¾åçš„å·¥ä½œåŸç†ä¹Ÿä¸€æ ·ã€‚\nclass Foo { has $.prop is rw; } sub inspect-a-foo( Foo $my-foo ) { say \u0026#34;this foo\u0026#39;s property is \u0026#34; ~ $my-foo.prop; } my $f = Foo.new( prop =\u0026gt; 42 ); inspect-a-foo($f); # this foo\u0026#39;s property is 42 åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, å­ä¾‹ç¨‹ inspect-a-foo åªä¼šæ¥æ”¶ Foo ç±»å‹çš„å‚æ•°, æˆ–è€… Foo çš„å­ç±»ã€‚\nå¸¦æœ‰ where block çš„ç‰¹å¼‚æ€§ é€šè¿‡åœ¨ç­¾åä¸­ä½¿ç”¨ where å­å¥, Raku å…è®¸æˆ‘ä»¬æ›´è¿›ä¸€æ­¥çš„é™åˆ¶å­ä¾‹ç¨‹çš„å‚æ•°ã€‚where å­å¥æ¥æ”¶ä»»ä½• code block, è¿™ä¸ª code block å¿…é¡»è¿”å›ä¸€ä¸ª true å€¼ä»¥ä½¿ç±»å‹çº¦æŸé€šè¿‡ã€‚\nsub foo(Int $positive where { $positive \u0026gt; 0 } ) { say \u0026#34;æˆ‘å¾ˆç¡®ä¿¡ $positiveæ˜¯æ­£çš„!\u0026#34; } sub bar( Foo $foo where { $foo.prop.isa( Int ) and $foo.prop \u0026gt; 40 } ) { say \u0026#34;è¿™ä¸ª Foo çš„å±æ€§æ˜¯ä¸€ä¸ªå¤§äº 40 çš„æ•´æ•°\u0026#34; } å¯ä»¥æŒ‡å®šå¤šä¸ª where å­å¥æ¥çº¦æŸå¤šä¸ªå‚æ•°ã€‚\nsub quadrant2( Real $x where { $x \u0026lt; 0 }, Real $y where { $y \u0026gt; 0 } ) { say \u0026#34;at the point ($x, $y)\u0026#34; } quadrant2( 1, 1 ); # Constraint type check failed for parameter \u0026#39;$x\u0026#39; quadrant2( -1, -1 ); # Constraint type check failed for parameter \u0026#39;$y\u0026#39; quadrant2( -1, 1 ); # at the point (-1, 1) çº¦æŸå—å„¿(Constraint blocks)ç”šè‡³ä¸éœ€è¦æ˜¯ blocksã€‚äº‹å®ä¸Š, ä»»ä½• Callable ç±»éƒ½å¯ä»¥ã€‚å› æ­¤, ä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°è·å¾—åŠŸèƒ½å‡½æ•°çš„çº¦æŸæ£€æµ‹, å®ƒä»¬èƒ½åœ¨å¤šä¸ªä¸åŒçš„å­ä¾‹ç¨‹ä¹‹é—´å¾ªç¯åˆ©ç”¨ã€‚\nsub is-positive( Real $n ) { $n \u0026gt; 0 } sub is-negative( Real $n ) { $n \u0026lt; 0 } sub is-zero( Real $n ) { $n == 0 } sub quadrant1( Real $x where is-positive( $x ), Real $y where is-positive( $y ) ) { ... } sub quadrant2( Real $x where is-negative( $x ), Real $y where is-positive( $y ) ) { ... } sub quadrant3( Real $x where is-negative( $x ), Real $y where is-negative( $y ) ) { ... } sub quadrant4( Real $x where is-positive( $x ), Real $y where is-negative( $y ) ) { ... } sub x-axis( Real $x, Real $y where is-zero( $y ) ) { ... } sub y-axis( Real $x where is-zero( $x ), Real $y ) { ... } sub origin( Real $x where is-zero( $x ), Real $y where is-zero( $y ) ) { ... } Return Types æ¯ä¸ª Raku å­ä¾‹ç¨‹ä¹Ÿèƒ½æŒ‡å®šå®ƒè‡ªå·±çš„è¿”å›å€¼ç±»å‹ä½œä¸ºç­¾åçš„ä¸€éƒ¨åˆ†ã€‚è¿™å¯ä»¥ä½¿ç”¨ returns å…³é”®å­—æ¥æ˜¾å¼åœ°æŒ‡å®š, ä½†æ˜¯æˆ‘æ›´å–œæ¬¢ç”¨å¿«æ·å½¢å¼çš„ --\u0026gt; æ“ä½œç¬¦, å®ƒåœ¨ç­¾åè‡ªèº«ä¹‹å†…ã€‚ä¸‹é¢å£°æ˜çš„ä¸¤ä¸ªå­ä¾‹ç¨‹æ˜¯ç­‰ä»·çš„:\nsub are-they-equal( Str $foo, Str $bar ) returns Bool { $foo eq $bar } sub are-they-equal( Str $foo, Str $bar --\u0026gt; Bool ) { $foo eq $bar } æ¯«æ— ç–‘é—®åœ°, å¦‚æœè¿”å›é”™è¯¯çš„ç±»å‹ Raku ä¼šæŠ›å‡ºé”™è¯¯ã€‚\nè‡ªçœ Raku ä¸­å­ä¾‹ç¨‹æ˜¯ä¸€ç­‰å¯¹è±¡ã€‚ä½†æ˜¯ Raku å¸¦æ¥äº†ä¸€å¤§å †æ–°çš„å†…çœå·¥å…·, åŒ…å«è¯¢é—®å­ä¾‹ç¨‹çš„ç­¾åä¿¡æ¯çš„èƒ½åŠ›ã€‚æ¯ä¸ªå­ä¾‹ç¨‹çš„ç­¾åå®é™…ä¸Šå°±æ˜¯ Signature ç±»çš„ä¸€ä¸ªå¯¹è±¡ã€‚æˆ‘ä»¬èƒ½æ‰¾å‡ºå­ä¾‹ç¨‹çš„å…ƒæ•°å’Œè¿”å›å€¼ç±»å‹ã€‚æˆ‘ä»¬ç”šè‡³èƒ½å¤Ÿåœ¨ç­¾åä¸­æŠ“å–ä¸€ä¸ª Parameter å¯¹è±¡çš„åˆ—è¡¨ã€‚\nsub are-they-equal( Str $foo, Str $bar ) returns Bool { $foo eq $bar } say \u0026amp;are-they-equal.signature.arity; # 2 say \u0026amp;are-they-equal.signature.returns; # (Bool) my @params = \u0026amp;are-they-equal.signature.params; say @params[0].name; # $foo say @params[0].type; # (Str) say @params[0].sigil; # $ æ€»ä¹‹, Raku çš„ç­¾åå¾ˆå¥½å¾ˆå¼ºå¤§ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2015-08-29-exploring-raku-signatures-part-two/","tags":["signature"],"title":"æ¢ç´¢ Raku ä¸­çš„ç­¾å(ç¬¬äºŒéƒ¨åˆ†)"},{"categories":["rakulang"],"contents":"æ•£åˆ—ä¹Ÿæ˜¯å®¹å™¨ å‡è®¾æˆ‘ä»¬æƒ³è®¡ç®—æŸä¸ªä¸œè¥¿çš„å‡ºç°æ¬¡æ•°, æˆ‘ä»¬é€šå¸¸çš„åšæ³•æ˜¯å¼„ä¸€ä¸ª \u0026ldquo;seen-hash\u0026rdquo; æ•£åˆ—ã€‚æœ‰æ—¶å€™æˆ‘ä»¬æœ‰ä¸€ç»„å¾…æŸ¥è¯¢çš„é”®, å…¶ä¸­æœ‰äº›é”®å¯èƒ½ä¸åœ¨æˆ‘ä»¬æ‰€æ‰«æçš„æ•°æ®ä¸­ã€‚é‚£æ˜¯ä¸€ç§ç‰¹æ®Šæƒ…å†µ, ä½†æ˜¯ Raku èƒ½å¤Ÿå®Œç¾åœ°è§£å†³, å› ä¸ºæ•£åˆ—ä¹Ÿæ˜¯å®¹å™¨, å› æ­¤æˆ‘ä»¬èƒ½å¤Ÿæ‹¥æœ‰é»˜è®¤å€¼ã€‚\nmy $words = \u0026lt;Hashes are containers too\u0026gt;.lc; constant alphabet = \u0026#39;a\u0026#39; .. \u0026#39;z\u0026#39;; my %seen of Int is default(0); %seen{$_}++ for $words.comb; put \u0026#34;$_:%seen{$_}\u0026#34; for alphabet; è¾“å‡ºç»“æœ:\na: 3 b: 0 c: 1 d: 0 e: 3 f: 0 g: 0 h: 2 i: 1 j: 0 k: 0 l: 0 m: 0 n: 2 o: 3 p: 0 q: 0 r: 2 s: 3 t: 2 u: 0 v: 0 w: 0 x: 0 y: 0 z: 0 $words ä¸­æ²¡æœ‰å‡ºç°çš„ç‰¹æ®Šå­—ç¬¦ç”± is default(0) å¤„ç†äº†ã€‚\né»˜è®¤å€¼å¯ä»¥è¢«ç²¾å¿ƒè®¾è®¡ã€‚æˆ‘ä»¬æ¥å¼„ä¸€ä¸ªåœ¨æ•°å€¼ä¸Šä¸‹æ–‡ä¸­ä¸ºé»˜è®¤å€¼ä¸º 0 ä½†æ˜¯åœ¨å­—ç¬¦ä¸²ä¸Šä¸‹æ–‡ä¸­ä¸ºé»˜è®¤å€¼ä¸º NULL å¹¶ä¸”æ€»æ˜¯è¢«å®šä¹‰çš„ä¸€ä¸ªæ•£åˆ—ã€‚\nmy %seen of Int is default(0 but role :: { method Str() {\u0026#39;NULL\u0026#39;} }); say %seen\u0026lt;not-there\u0026gt;, %seen\u0026lt;not-there\u0026gt;.defined, Int.new(%seen\u0026lt;not-there\u0026gt;); # OUTPUT # Â«NULLTrue0â¤Â» ","permalink":"https://ohmyweekly.github.io/notes/2015-06-28-hash-is-also-containers/","tags":["container"],"title":"æ•£åˆ—ä¹Ÿæ˜¯å®¹å™¨"},{"categories":["rakulang"],"contents":"ä½¿ç”¨é“¾å¼å‡½æ•°è°ƒç”¨ è€ƒè™‘æœ€ç®€å•çš„ä¸€ç§æƒ…å†µ, ä¸å¸¦å°æ•°ç‚¹çš„æ•°å­—:\n\u0026#34;1234567890\u0026#34;.comb.reverse.rotor(3,:partial).map(*.join(\u0026#39;\u0026#39;)).join(\u0026#39;,\u0026#39;).comb.reverse.join(\u0026#39;\u0026#39;) # 1,234,567,890 ä½¿ç”¨ \\\\ è½¬ä¹‰ç©ºç™½, ä½¿ä»£ç å¯¹é½:\n\u0026#34;1234567890\u0026#34;.comb\\ .reverse\\ .rotor(3,:partial)\\ .map(*.join(â€˜â€™))\\ .join(â€˜,â€™)\\ .comb\\ .reverse\\ .join(â€˜â€™)\\ .say; ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ ä½¿ç”¨ Grammar ","permalink":"https://ohmyweekly.github.io/notes/2015-12-14-add-separator/","tags":["rotor"],"title":"ç»™æ•°å­—æ·»åŠ åƒåˆ†ä½ç¬¦"},{"categories":["rakulang"],"contents":"ç°åœ¨ä½ å¯èƒ½å·²ç»ä¹ æƒ¯äº† Raku ä¸­åˆ°å¤„å‡ºç°çš„å‰ç¼€ \u0026ldquo;meta\u0026rdquo;ã€‚Metaclasses, Metaobjects, Metaoperators, è¿˜æœ‰è¿·ä¸€èˆ¬çš„ Meta-Object åè®®ã€‚å¬èµ·æ¥ä¸€ç‚¹ä¹Ÿä¸å¯æ€•, ä½ éƒ½è§è¿‡äº†ä¸æ˜¯å—ï¼Ÿä»Šå¤©, åœ¨ Raku Advent Calendar ä¸Š, æˆ‘ä»¬å°†è¿›è¡Œå®Œå…¨çš„ meta åŒ–(full meta)ã€‚æˆ‘ä»¬å°†æ‹¥æœ‰èƒ½è§£æ grammar çš„ grammar, ç„¶åç”Ÿæˆå°†ç”¨äºè§£æ grammar çš„ grammarã€‚\nGrammar æ— ç–‘æ˜¯ Raku çš„æ€æ‰‹çº§åŠŸèƒ½ã€‚æˆ‘ä»¬æ‹¥æœ‰äº†æ­£åˆ™è¡¨è¾¾å¼æ›¾ç»æ²¡æœ‰çš„ä¸œè¥¿: å¯è¯»æ€§ã€å¯ç»„åˆæ€§å½“ç„¶è¿˜æœ‰è§£æ Raku è‡ªèº«çš„èƒ½åŠ›ã€‚â€” å¦‚æœè¿™ä¸èƒ½å±•ç¤ºå®ƒçš„å¼ºå¤§, é‚£æˆ‘ä¸çŸ¥é“ä»€ä¹ˆèƒ½å¤Ÿ!\nä¸ºé¢„å®šä¹‰å¥½çš„ grammar(ä¾‹å¦‚ä»¥ Bachus-Naur å½¢å¼)å†™è§£æå™¨æ€»æ˜¯æœ‰ç‚¹æ— è¶£, å‡ ä¹å’Œå¤åˆ¶ç²˜è´´ä¸€æ ·ã€‚å¦‚æœä½ æ›¾ç»åä¸‹æ¥é‡å¤´å¼€å§‹å†™ä¸€ä¸ªè§£æå™¨(æˆ–è€…æœŸé—´æ¸©ä¹ ä¸€éé‚£æœ¬ä¼˜ç§€çš„\u0026quot;è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç¼–è¯‘å™¨\u0026quot;å›¾ä¹¦), ä½ å¯èƒ½ä¼šæ„è¯†åˆ°æ¨¡å¼æ˜¯å¦‚æ­¤ç›¸ä¼¼:ä»ä½ çš„ grammar ä¸­æ‹¿å‡ºå•ä¸ª rule, ä¸ºå®ƒå†™ä¸€ä¸ªå­ä¾‹ç¨‹, è®©å®ƒè°ƒç”¨(å¯èƒ½æ˜¯é€’å½’çš„)å…¶å®ƒç±»ä¼¼çš„ä¸ºå…¶å®ƒ grmmars rules å®šä¹‰çš„å­ä¾‹ç¨‹, æ¸…æ´—, é‡å¤ã€‚ç°åœ¨æˆ‘ä»¬æœ‰äº†Raku grammar! åœ¨è¿™ä¸ªæ–°ä¸–ç•Œä¸­, æˆ‘ä»¬ä¸å¿…ä¸ºæ¯ä¸ª token å†™ä¸Šå­ä¾‹ç¨‹æ¥å®Œæˆå·¥ä½œäº†ã€‚ ç°åœ¨æˆ‘ä»¬å†™ grammar ç±», é‡Œé¢æ”¾ä¸Š tokensã€rulesã€regexes æ ‡å¿—ã€‚åœ¨æ ‡å¿—é‡Œå†™æ­£åˆ™è¡¨è¾¾å¼(æˆ–ä»£ç )å¹¶å¼•ç”¨(å¯èƒ½æ˜¯é€’å½’çš„) Raku gramamr ä¸­çš„å…¶å®ƒæ ‡å¿—ã€‚å¦‚æœä½ æ›¾ç»ä½¿ç”¨è¿‡è¿™äº›ä¸œè¥¿, ä½ è‚¯å®šä¼šæ„è¯†åˆ° Raku ä¸­çš„ grammar æ˜¯å¤šä¹ˆçš„æ–¹ä¾¿ã€‚\nä½†æ˜¯å‡å¦‚æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä¸ª grammar, ä¾‹å¦‚ä¹‹å‰æåˆ°è¿‡çš„ BNF? æˆ‘ä»¬æ‰€åšçš„å°±æ˜¯å°å¿ƒåœ°æŠŠå·²ç»å­˜åœ¨çš„ grammar(å®é™…ä¸Šåœ¨æˆ‘ä»¬å¤´è„‘ä¸­è§£æå®ƒ)é‡æ–°é”®å…¥åˆ°ä¸€ä¸ªæ–°çš„ Raku Grammar ä¸­ä»¥ä»£è¡¨åŒæ ·çš„ä¸€ä¸ªä¸œè¥¿, ä½†æ˜¯é‚£ç¡®å®æœ‰ä¸€ä¸ªå¯ä½œä¸ºå¯æ‰§è¡Œä»£ç çš„ä¼˜åŠ¿ã€‚å¯¹å¤§å¤šæ•°äººæ¥è¯´, é‚£éƒ½ä¸æ˜¯äº‹å„¿ã€‚æˆ‘ä»¬ä¸æ˜¯æ™®é€šäºº, æˆ‘ä»¬æ˜¯ç¨‹åºå‘˜ã€‚æˆ‘ä»¬æ‹¥æœ‰èµ„æºã€‚å®ƒä»¬ä¼šè®©è¿™äº› grammar å˜å¾—æœ‰æ„ä¹‰ã€‚\nç»å¦™çš„æ˜¯ Raku grammar å’Œè¯­è¨€çš„å…¶å®ƒå…ƒç´ æ²¡ä»€ä¹ˆä¸¤æ ·ã€‚grammar å°±åƒç±»é‚£æ ·ä¹Ÿæ˜¯å¤´ç­‰å…¬æ°‘, å¯ä»¥å†…çœ, æ‰©å±•ã€‚å®é™…ä¸Š, ä½ å¯ä»¥æŸ¥çœ‹ç¼–è¯‘å™¨æºä»£ç è‡ªèº«, ä½ ä¼šæ³¨æ„åˆ° grammar å°±æ˜¯ä¸€ç§ç‰¹å®šç§ç±»çš„ç±»ã€‚å®ƒä»¬éµå®ˆå’Œç±»ä¸€æ ·çš„è§„åˆ™, å…è®¸æˆ‘ä»¬å°±åœ°åˆ›å»º grammar, å°±åœ°ç»™ grammar æ·»åŠ  tokens, æœ€ç»ˆå®Œç»“è¿™ä¸ª gramamr ä»¥æ‹¥æœ‰ä¸€ä¸ªåˆé€‚çš„èƒ½å®ä¾‹åŒ–çš„ç±»å¯¹è±¡ã€‚ç°åœ¨æ—¢ç„¶æˆ‘ä»¬èƒ½è§£æ BNF grammar(å› ä¸ºå®ƒä»¬å°±æ˜¯æ™®é€šçš„æ–‡æœ¬)å¹¶ä»ä»£ç ä¸­åˆ›å»º Raku grammar, è®©æˆ‘ä»¬æŠŠè¿™äº›ç‰‡æ®µæ”¾åœ¨ä¸€èµ·å¹¶å†™ç‚¹èƒ½æ‰‹åŠ¨æŠŠ BNF gramamr è½¬åŒ–ä¸º Raku grammar çš„ä¸œè¥¿ã€‚\nè§£æ BNF grammar çš„ grammar grammar Grammar::BNF { token TOP {\\s*\u0026lt;rule\u0026gt;+\\s*} token rule {\u0026lt;opt-ws\u0026gt;\u0026#39;\u0026lt;\u0026#39;\u0026lt;rule-name\u0026gt;\u0026#39;\u0026gt;\u0026#39;\u0026lt;opt-ws\u0026gt;\u0026#39;::=\u0026#39;\u0026lt;opt-ws\u0026gt;\u0026lt;expression\u0026gt;\u0026lt;line-end\u0026gt;} token expression {\u0026lt;list-of-terms\u0026gt;+%[\\s*\u0026#39;|\u0026#39;\u0026lt;opt-ws\u0026gt;]} token term {\u0026lt;literal\u0026gt;|\u0026#39;\u0026lt;\u0026#39;\u0026lt;rule-name\u0026gt;\u0026#39;\u0026gt;\u0026#39;} token list-of-terms {\u0026lt;term\u0026gt;+%\u0026lt;opt-ws\u0026gt;} token rule-name {\u0026lt;-[\u0026gt;]\u0026gt;+} token opt-ws {\\h*} token line-end {[\u0026lt;opt-ws\u0026gt;\\n]+} token literal {\u0026#39;\u0026#34;\u0026#39;\u0026lt;-[\u0026#34;]\u0026gt;*\u0026#39;\u0026#34;\u0026#39;|\u0026#34;\u0026#39;\u0026#34;\u0026lt;-[\u0026#39;]\u0026gt;*\u0026#34;\u0026#39;\u0026#34;} ... } æœ€ä¸Šå±‚çš„ 3 ä¸ª token å‘ç”Ÿäº†æœ‰æ„æ€çš„äº‹æƒ…ã€‚rule æ˜¯ BNF grammar çš„æ ¸å¿ƒæ„é€ å—: ä¸€ä¸ª \u0026lt;symbol\u0026gt; ::= \u0026lt;expression\u0026gt; å—å„¿, åé¢è·Ÿç€ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚æ•´ä¸ª grammar å°±æ˜¯ä¸€åˆ— ruleã€‚æ¯ä¸ªè¡¨è¾¾å¼æ˜¯ä¸€åˆ—é¡¹ã€æˆ–å¯èƒ½çš„å’Œå®ƒä»¬çš„å¤‡é€‰åˆ†æ”¯ã€‚æ¯ä¸ªé¡¹è¦ä¹ˆæ˜¯ä¸€ä¸ªå­—é¢å€¼, æˆ–ä¸€ä¸ªç”±å°–æ‹¬å·åŒ…å›´çš„æ ‡å¿—åã€‚è¶³å¤Ÿäº†! é‚£æ¶µç›–äº†è§£æéƒ¨åˆ†ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ç”Ÿæˆè‡ªèº«ã€‚æˆ‘ä»¬çš„ç¡®æœ‰ä¸€ç§\u0026quot;ä¸º grammar ä¸­çš„æ¯ä¸ª token åšæŸäº‹\u0026quot;çš„æœºåˆ¶, ä»¥ Actionsçš„å½¢å¼, è®©æˆ‘ä»¬ç»§ç»­å¹¶ä½¿ç”¨å®ƒ:\nmy class Actions { has $.name = \u0026#39;BNFGrammar\u0026#39;; method TOP($/) { my $grmr := Metamodel::GrammarHOW.new_type(:$.name); $grmr.^add_method(\u0026#39;TOP\u0026#39;, EVAL \u0026#39;token { \u0026lt;\u0026#39; ~ $\u0026lt;rule\u0026gt;[0].ast.key ~ \u0026#39;\u0026gt; }\u0026#39;); for $\u0026lt;rule\u0026gt;.map(*.ast) -\u0026gt; $rule { $grmr.^add_method($rule.key, $rule.value); } $grmr.^compose; make $grmr; } method expression($/) { make EVAL \u0026#39;token { \u0026#39; ~ ~$/ ~ \u0026#39;}\u0026#39;; } method rule($/) { make ~$\u0026lt;rule-name\u0026gt; =\u0026gt; $\u0026lt;expression\u0026gt;.ast; } } TOP æ–¹æ³•æ¯«æ— ç–‘é—®æ˜¯æœ€é­”å¹»å’Œæœ€ææ€–çš„, æ‰€ä»¥æ“’è´¼å…ˆæ“’ç‹, å…¶å®ƒå°å–½å•°å°±æ— å…³ç´§è¦äº†ã€‚åŸºæœ¬ä¸Š, TOP é‚£å„¿å‘ç”Ÿäº†ä¸‰ä»¶äº‹:\n 1ã€æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ grammar, ä½œä¸ºä¸€ä¸ªæ–°çš„ Raku ç±»å‹ 2ã€æˆ‘ä»¬ä½¿ç”¨ ^add_method æ–¹æ³•ä¸º grammar æ·»åŠ  token 3ã€æˆ‘ä»¬ä½¿ç”¨ ^compose æ–¹æ³•å®šå‹è¯¥ grammar  è™½ç„¶ Raku æŒ‡å®šåä¸º TOP çš„ token æ˜¯è§£æå¼€å§‹çš„åœ°æ–¹, åœ¨ BNF ä¸­ç¬¬ä¸€ä¸ª rule æ€»æ˜¯å¼€å§‹ç‚¹ã€‚ä¸ºäº†å½¼æ­¤é€‚åº”, æˆ‘ä»¬ç²¾å·§åœ°åˆ¶ä½œäº†ä¸€ä¸ªå‡çš„ TOP token, å®ƒæ­£æ˜¯è°ƒç”¨äº† BNF grammar ä¸­æŒ‡å®šçš„ç¬¬ä¸€ä¸ª ruleã€‚ä¸å¯é¿å…åœ°, ææ€–åˆä»¤äººå¤±æœ›çš„ EVAL å¼•èµ·äº†æˆ‘ä»¬çš„æ³¨æ„, å°±åƒå®ƒè¯´äº†\u0026quot;è¿™å„¿å‘ç”Ÿäº†å¯æ€•çš„äº‹æƒ…\u0026quot; ä¸€æ ·ã€‚å®ƒé‚£æ ·è¯´å¹¶ä¸æ˜¯å®Œå…¨é”™è¯¯çš„, ä½†æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰å…¶å®ƒç¨‹åºåŒ–æ„å»ºå•ç‹¬æ­£åˆ™çš„æ–¹æ³•, æˆ‘ä»¬ä¸å¾—ä¸\u0010æ¥å—è¿™ç‚¹ä¸é€‚ã€‚\nTOP ä¹‹åæˆ‘ä»¬ç»§ç»­ä¸ºæˆ‘ä»¬çš„ grammar æ·»åŠ  BNF rule çš„å‰©ä½™éƒ¨åˆ†, è¿™ä¸€æ¬¡ä¿ç•™å®ƒä»¬åŸæ¥çš„åå­—, ç„¶å ^compose æ•´ä¸ªä¸œè¥¿, æœ€åè®©å®ƒ(make)æˆä¸ºè§£æçš„ç»“æœ: ä¸€ä¸ªåšå¥½çš„è§£æç±»ã€‚\nåœ¨ expression æ–¹æ³•ä¸­æˆ‘ä»¬æŠŠè§£æè¿‡çš„ BNF å…ƒç´ ç²˜è´´åˆ°ä¸€å—ä»¥äº§ç”Ÿåˆæ³•çš„ Raku ä»£ç ã€‚è¿™å˜å¾—ç‰¹åˆ«å®¹æ˜“, å› ä¸ºé‚£ä¿©ä¸ªå•ç‹¬çš„æ ‡å¿—å¸¦æœ‰ç©ºæ ¼, ä½¿ç”¨ç®¡é“ç¬¦å·æ¥è½®è¯•å¤‡é€‰åˆ†æ”¯, å¹¶ä½¿ç”¨å°–æ‹¬å·åŒ…å›´æ ‡å¿—åã€‚ç›®å‰ä¸ºæ­¢, ä¸€ä¸ª rule çœ‹èµ·æ¥åƒè¿™æ ·:\n\u0026lt;foo\u0026gt; ::= \u0026#39;bar\u0026#39; | \u0026lt;baz\u0026gt; æˆ‘ä»¬æ±‚å€¼(EVAL)çš„ Raku ä»£ç å˜ä¸º:\ntoken { \u0026#39;bar\u0026#39; | \u0026lt;baz\u0026gt; } å› ä¸ºæˆ‘ä»¬å·²ç»åœ¨æˆ‘ä»¬ä»£ç çš„ grammar éƒ¨åˆ†æ£€æµ‹æˆ‘ä»¬è§£æçš„ BNF æ˜¯æ­£ç¡®çš„, æ²¡æœ‰ä»€ä¹ˆèƒ½å¤Ÿé˜»æ­¢æˆ‘ä»¬ä¼ é€’è§£ææ•´ä¸ªè¡¨è¾¾å¼å­—é¢å€¼åˆ°æˆ‘ä»¬çš„ä»£ç ä¸­å¹¶ä½¿ç”¨ä¸€ä¸ª token { } æ¥åŒ…è£¹å®ƒ, æ‰€ä»¥è®©æˆ‘ä»¬ç»§ç»­ã€‚\næœ€å, å¯¹äºæˆ‘ä»¬è§£æçš„æ¯ä¸€ä¸ª BNF rule, æˆ‘ä»¬äº§ç”Ÿäº†ä¸€ä¸ªå¾ˆä¸é”™çš„ Pair, æ‰€ä»¥æˆ‘ä»¬çš„ TOP æ–¹æ³•å¾ˆæ„‰å¿«åœ°å¤„ç†å®ƒä»¬ä¸­çš„æ¯ä¸ªã€‚\nçœ‹èµ·æ¥æˆ‘ä»¬å¥½åƒåœ¨è¿™å„¿ç»“æŸäº†, ä½†æ˜¯ä»…ä»…æ˜¯ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨è€…, è®©æˆ‘ä»¬å†™ä¸€ä¸ªæ›´å¥½çš„æ–¹æ³•, æ¥æ”¶ä¸€ä¸ª BNF grammar, å¹¶ä¸ºæˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªå‡†å¤‡å¥½ä½¿ç”¨çš„ç±»å‹å¯¹è±¡ã€‚æˆ‘ä»¬è®°å¾—, grammar å°±æ˜¯ç±», æ‰€ä»¥æˆ‘ä»¬æ²¡æœ‰ä»€ä¹ˆèƒ½é˜»æ­¢æˆ‘ä»¬ç›´æ¥ä¸ºæˆ‘ä»¬çš„ gramamr æ·»åŠ å®ƒ:\ngrammar Grammar::BNF { ... method generate($source, :$name = \u0026#39;BNFGrammar\u0026#39;) { my $actions = Actions.new(:$name); my $ret = self.new.parse($source, :$actions).ast; return $ret.WHAT; } } è¿™å„¿çœ‹èµ·æ¥å¾ˆä¸é”™! åœ¨ä½ å¼€å§‹å¾€ä½ è‡ªå·±çš„é¡¹ç›®ä¸­å¤åˆ¶ç²˜è´´æ‰€æœ‰è¿™äº›ä¹‹å‰, è®°å¾— Grammar::BNFÂ æ˜¯ä¸€ä¸ªå¯åœ¨ Raku Module Ecosystemè·å¾—çš„ Raku æ¨¡å—, ä½¿ç”¨ä½ å–œæ¬¢çš„æ¨¡å—ç®¡ç†å™¨å®‰è£…ã€‚\nå‡è®¾ä½ ç¡®å®èŠ±è´¹æ—¶é—´æŸ¥çœ‹äº†å¼€å¤´çš„ post, ä½ å¯èƒ½ä¼šè®°å¾—æˆ‘è®¸è¯ºè¿‡æˆ‘ä»¬å°†æœ‰ grammar(ç¬¬ä¸€æ¡)æ¥è§£æ grammar(ç¬¬äºŒæ¡), ç„¶åç”Ÿæˆ grammar(ç¬¬ä¸‰æ¡), ä½¿ç”¨ç”Ÿæˆçš„ grammar æ¥è§£æ grammar(ç¬¬å››æ¡)ã€‚ç›®å‰ä¸ºæ­¢ï¼Œ æˆ‘ä»¬å·²ç»çœ‹åˆ°è¿‡ BNF::Grammar grammar(é‚£æ˜¯ç¬¬ä¸€æ¡), å¹¶è§£æä¸€ä¸ª BNF grammar(é‚£æ˜¯ç¬¬äºŒæ¡), ä»¥ç±»å¯¹è±¡çš„å½¢å¼æ¥ç”Ÿæˆ Raku grammar(ç¬¬ä¸‰æ¡)ã€‚ å°±è¿™äº›ã€‚æˆ‘ä»¬ä»æ—§ç¼ºä¹æœ€åä¸€éƒ¨åˆ†, ä½¿ç”¨æ•´ä¸ªä¸œè¥¿æ¥è§£æ grammarã€‚ æˆ‘ä»¬åªå®Œæˆäº† 75% çš„ meta åŒ–, ä»Šå¤©è¶³å¤Ÿäº†ã€‚ä¸ºä»€ä¹ˆç°åœ¨åœæ­¢? ä¸ºä»€ä¹ˆä¸æ‹¿ä¸€ä¸ª BNF grammar , ä½¿ç”¨ Raku grammar æ¥è§£æ grammar, ä½¿ç”¨ Raku BNF grammar çš„ç»“æœæ¥è§£ææˆ‘ä»¬åŸæ¥çš„ BNF Grammar? é‚£ä¸æ˜¯å¾ˆå¥½å—ï¼Ÿæ˜¯çš„, é‚£å¾ˆå¥½, æˆ‘ä»¬åªæ˜¯ç•™äº†ä¸€ä¸ªç»ƒä¹ ç»™ä½ ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2015-04-15-grammar-generating-grammar/","tags":["grammar"],"title":"Grammar Generating Grammar"},{"categories":["rakulang"],"contents":"è–›å®šè°”æ¬§æ–‡åº”è¯¥æ˜¯å–œæ¬¢ Raku çš„, å› ä¸ºä»–çš„è‘—åçš„è–›å®šè°”çš„çŒ«å¯ä»¥ç”¨ Raku çš„ Junctionè¡¨è¾¾:\nmy $cat = \u0026#39;dead\u0026#39; | \u0026#39;alive\u0026#39;; say \u0026#34;cat is both dead and alive\u0026#34; if $cat eq \u0026#39;dead\u0026#39; and $cat eq \u0026#39;alive\u0026#39;; # OUTPUT: # cat is both dead and alive è¿™é‡Œé¢å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…? æˆ‘ä¼šå‘Šè¯‰ä½ å…¨éƒ¨çš„!\nAnyone æ¸¸æˆ? æ‹¿æœ€ç®€å•çš„æ¥è¯´, Junction å…è®¸ä½ æŠŠä¸€å †å€¼å½“ä½œå•ä¸ªå€¼ã€‚ä¾‹å¦‚, ä½ å¯ä»¥ä½¿ç”¨ any Junction æ¥æµ‹è¯•ä¸€ä¸ªå˜é‡æ˜¯å¦ç­‰äºæ‰€ç»™å®šå€¼ä¸­çš„ä»»æ„ä¸€ä¸ª:\nsay \u0026#39;it matches!\u0026#39; if \u0026#39;foo\u0026#39; eq \u0026#39;foo\u0026#39; | \u0026#39;bar\u0026#39; | \u0026#39;ber\u0026#39;; say \u0026#39;single-digit prime\u0026#39; if 5 == any ^9.grep: *.is-prime; my @values = ^100; say \u0026#34;it\u0026#39;s in there!\u0026#34; if 42 == @values.any; # OUTPUT: # it matches! # single-digit prime # it\u0026#39;s in there! è¦ä»ä¸€å †å€¼ä¸­åˆ›å»ºä¸€ä¸ª any Junction, ä½ å¯ä»¥ä½¿ç”¨ | ä¸­ç¼€æ“ä½œç¬¦ã€è°ƒç”¨ any å‡½æ•°æˆ–è€…ä½¿ç”¨ .any æ–¹æ³•ã€‚ä¸Šé¢çš„æ¡ä»¶ä¼šè¿”å› True å¦‚æœ Junction ä¸­çš„ä»»æ„ä¸€ä¸ª(any) å€¼åŒ¹é…æ‰€ç»™å®šçš„å€¼çš„è¯ã€‚äº‹å®ä¸Š, æ²¡æœ‰äººèƒ½é˜»æ­¢ä½ åœ¨ä¸¤ç«¯éƒ½ä½¿ç”¨ Junction:\nmy @one = 1..10; my @two = 5..15; say \u0026#34;There\u0026#39;s overlap!\u0026#34; if @one.any == @two.any; # OUTPUT: # there\u0026#39;s overlap! è¿ç®—ç¬¦ä¼šè¿”å› True å¦‚æœ @one ä¸­çš„ä»»æ„ä¸€ä¸ªå€¼(any) åœ¨æ•°å€¼ä¸Šç­‰äº @two ä¸­çš„ä»»æ„ä¸€ä¸ªå€¼(any)çš„è¯ã€‚è¿™ä¸ªè¯­æ³•ç³–å¾ˆç”œ, ä½†æ˜¯æˆ‘ä»¬è¿˜å¯ä»¥åšçš„æ›´å¤šã€‚\nAll for One and Any for None any Junction å”¯ä¸€ä¸€ä¸ªä½ èƒ½è·å¾—çš„ Junctionã€‚ä½ è¿˜å¯ä»¥é€‰æ‹© allã€anyã€one å’Œ noneã€‚å½“åœ¨å¸ƒå°”ä¸Šä¸‹æ–‡ä¸­æ—¶, å®ƒä»¬çš„æ„æ€å°±åƒä¸‹é¢è¿™æ ·; æ„å»º Junction çš„å‡½æ•°/æ–¹æ³•åå’Œ Junction è‡ªèº«çš„åå­—ä¸€æ ·å¹¶ä¸”ä¸‹é¢è¿˜åˆ—å‡ºäº†æ„å»º Junction çš„ä¸­ç¼€æ“ä½œç¬¦:\n all â€” æ‰€æœ‰çš„å€¼éƒ½è¢«è®¡ç®—ä¸º True(ä½¿ç”¨ä¸­ç¼€ \u0026amp;) any â€” è‡³å°‘å…¶ä¸­çš„ä¸€ä¸ªå€¼è¢«è®¡ç®—ä¸º True(ä½¿ç”¨ä¸­ç¼€ |) one â€” æ­£å¥½å…¶ä¸­æœ‰ä¸€ä¸ªå€¼è¢«è®¡ç®—ä¸º True(ä½¿ç”¨ä¸­ç¼€ ^) none â€” æ²¡æœ‰ä¸€ä¸ªå€¼è¢«è®¡ç®—ä¸º True(æ²¡æœ‰å¯ç”¨çš„ä¸­ç¼€)  ä½¿ç”¨ all JUnction æ—¶è¦ç‰¹åˆ«æ³¨æ„:\nmy @values = 2, 3, 5; say \u0026#39;all primes\u0026#39; if @values.all ~~ *.is-prime; my @moar-values; say \u0026#39;also all primes\u0026#39; if @moar-values.all ~~ *.is-prime; å³ä½¿å®ƒæ²¡æœ‰å€¼çš„æ—¶å€™ä¹Ÿä¼šè¿”å› True, è¿™å¯èƒ½ä¸æ˜¯ä½ æƒ³è¦çš„ã€‚åœ¨é‚£äº›æƒ…å†µä¸‹, ä½ å¯ä»¥ä½¿ç”¨:\nmy @moar-values; say \u0026#39;also all primes\u0026#39; if @moar-values and @moar-values.all ~~ *.is-prime; Call Me, Baby ä½ å¯ä»¥æŠŠ Junction ç”¨ä½œå¹¶ä¸æœŸæœ› Junction çš„å­ä¾‹ç¨‹çš„å‚æ•°ã€‚é‚£ä¹ˆä¼šå‘ç”Ÿä»€ä¹ˆå‘¢? å¯¹äºæ¯ä¸€ä¸ª Junctioned çš„å€¼, é‚£ä¸ªå­ä¾‹ç¨‹éƒ½ä¼šè¢«è°ƒç”¨ä¸€æ¬¡, å¹¶ä¸”è¿”å›å€¼ä¼šæ˜¯ä¸€ä¸ª Junctionï¼š\nsub caculate-things($n) { say \u0026#34;$nis prime\u0026#34; if $n.is-prime; say \u0026#34;$nis an even number\u0026#34; if $n %% 2; say \u0026#34;$nis pretty big\u0026#34; if $n \u0026gt; 1e6; $nÂ²; } my @values = 1, 5, 42, 1e10.Int; say \u0026#39;EXACTLY ONE square is larger than 1e10\u0026#39; if 1e10 \u0026lt; calculate-things @values.one; # OUTPUT: # 5 is a prime # 42 is an even number # 10000000000 is an even number # 10000000000 is pretty big # EXACTLY ONE square is larger than 1e10 æš´éœ²çš„å‰¯ä½œç”¨å¯èƒ½æœ‰ç‚¹å¤ªè¿‡ç¥å¥‡å¹¶ä¸”ä½ å¯èƒ½ä¸æƒ³åœ¨ç”Ÿäº§ä»£ç ä¸­çœ‹åˆ°å®ƒ, ä½†æ˜¯ä½¿ç”¨ä¸€ä¸ªå­ä¾‹ç¨‹æ¥ä¿®æ”¹åŸæ¥çš„ Junctioned åŒ–çš„å€¼æ˜¯ç›¸å½“èƒ½æ¥å—çš„ã€‚æ‰§è¡Œä¸€ä¸ªæ•°æ®åº“æŸ¥è¯¢æ¥è·å–\u0026quot;å®é™…çš„\u0026quot;å€¼å¹¶ä¸”åœ¨ä¹‹åè®¡ç®—é‚£ä¸ªæ¡ä»¶æ€ä¹ˆæ ·ï¼š\nuse DBIish; my $dbh = DBIish.connect: \u0026#39;SQLite\u0026#39;, :database\u0026lt;test.db\u0026gt;; sub lookup ($id) { given $dbh.prepare: \u0026#39;SELECT id, text FROM stuff WHERE id = ?\u0026#39; { .execute: $id; .allrows[0][1] // \u0026#39;\u0026#39;; } } my @ids = 3, 5, 10; say \u0026#39;yeah, it got it, bruh\u0026#39; if \u0026#39;meow\u0026#39; eq lookup @ids.any; # OUTPUT (the database has a row with id = 5 and text = \u0026#39;meow\u0026#39;): # yeah, it got it, bruh æˆ‘ä»¬ä¸€ç›´åœ¨æœŸç›¼ä½ , è¯·å é‚£ä¸ªæ¸¸æˆå˜åŒ–äº†å½“ä½ çš„å­ä¾‹ç¨‹æ­£å¥½æœŸæœ›ä¸€ä¸ª Junction ä½œä¸ºå‚æ•°çš„æ—¶å€™ã€‚\nsub do-stuff (Junction $n) { say \u0026#39;value is even\u0026#39; if $n %% 2; say \u0026#39;value is prime\u0026#39; if $n.is-prime; say \u0026#39;value is large\u0026#39; if $n \u0026gt; 1e10; } do-stuff (2, 3, 1e11.Int).one; say \u0026#39;---\u0026#39;; do-stuff (2, 3, 1e11.Int).any; # OUTPUT: # value is large # --- # value is even # value is prime # value is large å½“æˆ‘ä»¬æä¾›äº†ä¸€ä¸ª one Junction æ—¶, åªæœ‰æ­£å¥½æ»¡è¶³ç»™å®šå€¼ä¸­çš„å…¶ä¸­ä¸€ä¸ªæ¡ä»¶æ‰ä¼šè¢«è§¦å‘ã€‚å½“æˆ‘ä»¬æä¾›ä¸€ä¸ª any Junction æ—¶, æ»¡è¶³æ¡ä»¶çš„ä»»ä½•ä¸€ä¸ªç»™å®šå€¼éƒ½ä¼šè§¦å‘ã€‚\nä½†æ˜¯! ä½ æ²¡æœ‰å¿…è¦éç­‰ç€ä¸–ç•Œä¸ºä½ åˆ†å‘ Junctionã€‚ä½ è‡ªå·±åˆ¶é€ ä¸€ä¸ªæ€ä¹ˆæ ·å‘¢, è¿˜èƒ½åœ¨æµ‹è¯•æ¡ä»¶æ—¶èŠ‚çœä»£ç :\nsub do-stuff (*@v) { my $n = @v.one; say \u0026#34;$nis even\u0026#34; if $n %% 2; say \u0026#34;$nis prime\u0026#34; if $n.is-prime; say \u0026#34;$nis large\u0026#34; if $n \u0026gt; 1e10; } do-stuff 2, 3, 1e11.Int; say \u0026#39;---\u0026#39;; do-stuff 42; # OUTPUT: # one(2, 3, 100000000000) is large # --- # one(42) is even æ²¡æœ‰äººæƒ³è¿‡å°†æ¥å—? è¿˜æœ‰ä¸€ä¸ªå°ç§˜å¯†: Junction è¢«è®¾è®¡ä¸ºæ—¶è‡ªåŠ¨çº¿ç¨‹åŒ–çš„(å³ auto-threaded)ã€‚å°½ç®¡åœ¨å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™å®ƒä»¬åªä¼šä½¿ç”¨ä»…ä»…ä¸€ä¸ªçº¿ç¨‹, ä½ ä¸åº”è¯¥ä¾èµ–å®ƒä»¬èƒ½ä»¥ä»»ä½•å¯é¢„æµ‹çš„é¡ºåºè¢«æ‰§è¡Œã€‚è‡ªåŠ¨çº¿ç¨‹åŒ–ä¼šåœ¨ 2018 å¹´çš„æŸä¸ªæ—¶é—´è¢«å®ç°, æ‰€ä»¥ä¿æŒå…³æ³¨\u0026hellip; ä½ ä¸å¿…åšä»»ä½•äº‹æƒ…, ä½ çš„å€¼å¾—è‡ªåŠ¨çº¿ç¨‹åŒ–çš„å¤æ‚ Junctioned åŒ–çš„æ“ä½œå¯èƒ½ä¼šåœ¨å‡ å¹´ä¹‹å†…å˜å¾—æ›´å¿«ã€‚\nç»“è®º Raku çš„ Junction æ˜¯å€¼çš„å åŠ æ€, å®ƒå…è®¸ä½ æµ‹è¯•å¤šä¸ªå€¼å°±åƒå®ƒä»¬æ˜¯ä¸€ä¸ªå€¼ä¸€æ ·ã€‚é™¤äº†æä¾›éå¸¸çŸ­å¹¶ä¸”æ˜“è¯»çš„è¯­æ³•, Junction è¿˜å…è®¸ä½ ä½¿ç”¨å­ä¾‹ç¨‹å˜æ¢å åŠ å€¼æˆ–è€…ä½¿ç”¨å‰¯ä½œç”¨ã€‚\nä½ è¿˜å¯ä»¥ç”Ÿæˆæ˜¾å¼æ“ä½œ Junction çš„å­ä¾‹ç¨‹æˆ–è€…æŠŠæä¾›çš„å¤šä¸ªå€¼è½¬æ¢æˆ Junction ä»¥ç®€åŒ–ä»£ç ã€‚\næœ€å, Junction è¢«è®¾è®¡ä¸ºèƒ½ä½¿ç”¨æ‰€æœ‰ä½ è®¡ç®—æœºæ‰€æä¾›çš„å¯ç”¨èƒ½åŠ›å¹¶ä¸”åœ¨ä¸ä¹…çš„å°†æ¥ä¼šåšæˆè‡ªåŠ¨çº¿ç¨‹åŒ–ã€‚\nJunction å¾ˆç²¾å½©, ä½¿ç”¨å®ƒä»¬, ç©çš„å¼€å¿ƒ!\n","permalink":"https://ohmyweekly.github.io/notes/2015-03-22-junctions-in-raku/","tags":["junction"],"title":"Junction in Raku"},{"categories":["rakulang"],"contents":"Capture çš„å®šä¹‰:\nclass Capture does Positional does Associative { } Capture æ˜¯ä¸€ä¸ªç”¨äºç»™ code å¯¹è±¡ä¼ é€’å‚æ•°çš„å®¹å™¨ã€‚Captures æ˜¯ç­¾åçš„å¦ä¸€é¢ â€” Captures åœ¨è°ƒç”¨æ–¹å®šä¹‰å®å‚, è€Œç­¾å(Signatures) åœ¨è¢«è°ƒç”¨æ–¹å®šä¹‰å½¢å¼å‚æ•°ã€‚\nå½“ä½ è°ƒç”¨ print $a, $b æ—¶, $a, $b è¿™éƒ¨åˆ†å°±æ˜¯ä¸€ä¸ª Captureã€‚$a, $b åœ¨è¿™å„¿æ˜¯å®å‚ã€‚\nCaptures åŒ…å«ä¸€ä¸ª list-like éƒ¨åˆ†çš„ä½ç½®å‚æ•°å’Œä¸€ä¸ª hash-like éƒ¨åˆ†çš„å…·åå‚æ•°ã€‚å¯¹äºå…·åå‚æ•°, Captures ä½¿ç”¨ä¸€ç§ç•¥å¾®ä¸åŒçš„è¯­æ³•è€Œä¸æ˜¯æ™®é€šçš„ Listã€‚æœ‰ä¸¤ç§ç®€å•çš„æ–¹æ³•ç”Ÿæˆä¸€ä¸ªå…·åå‚æ•°ï¼š\n ä½¿ç”¨ä¸€ä¸ªæœªå¼•èµ·çš„é”®å‘½åä¸€ä¸ªå½¢å‚, åé¢è·Ÿç€ =\u0026gt;, ç„¶åè·Ÿç€å‚æ•° ä½¿ç”¨ä»¥å½¢å‚å‘½åçš„å†’å·å¯¹å„¿å­—é¢é‡  say unique 1, -2, 2, 3, as =\u0026gt; { abs $_ }; # 1, -2, 3 # ... is the same thing as: say unique 1, -2, 2, 3, :as({ abs $_ }); # 1, -2, 3 # Be careful not to quote the name of a named parameter: say unique 1, -2, 2, 3, \u0026#39;as\u0026#39; =\u0026gt; { abs $_ }; # 1, -2, 2, 3, \u0026#34;as\u0026#34; =\u0026gt; { ... } å•ä¸ªç‹¬ç«‹çš„ Capture ä¹Ÿèƒ½è¢«ç”Ÿæˆ, å­˜å‚¨, ç„¶åä¾›ä¹‹åä½¿ç”¨ã€‚ åœ¨é¡¹(term)é‚£å„¿å‰ç½®ä¸€ä¸ªåæ–œçº¿ \\ èƒ½ç”Ÿæˆä¸€ä¸ªå­—é¢çš„ Captureã€‚é€šå¸¸, è¿™ä¸ª term ä¼šæ˜¯ä¸€ä¸ª terms çš„åˆ—è¡¨, åœ¨è¿™ä¸ªåˆ—è¡¨é‡Œé¢, ä»»ä½• Pair å­—é¢å€¼ä¼šè¢«æ”¾åœ¨ Capture çš„å…·åéƒ¨åˆ†, è€Œå…¶å®ƒ terms ä¼šè¢«æ”¾åœ¨Capture çš„ä½ç½®(positional) éƒ¨åˆ†ã€‚\nmy $c = \\(42); # å¸¦æœ‰ä¸€ä¸ª positional éƒ¨åˆ†çš„ Capture  $c = \\(1, 2, a =\u0026gt; \u0026#39;b\u0026#39;); # å¸¦æœ‰ä¸¤ä¸ª positional éƒ¨åˆ†å’Œä¸€ä¸ªå…·åéƒ¨åˆ†çš„ Capture è¦ä½¿ç”¨è¿™æ ·çš„ Capture, åœ¨å‡½æ•°è°ƒç”¨é‡Œä½ å¯ä»¥åœ¨è¿™ä¸ª Capture å‰é¢ä½¿ç”¨ | , é‚£ä¹ˆå®ƒçœ‹èµ·æ¥ä¼šåƒè¿™ä¸ª Capture ä¸­çš„æ‰€æœ‰å€¼éƒ½è¢«ä½œä¸ºå®å‚ç›´æ¥ä¼ é€’è¿™ä¸ªå‡½æ•°äº† â€” å…·åå‚æ•°ä½œä¸ºå…·åå‚æ•°ä¼ é€’, è€Œä½ç½®å‚æ•°ä¼šä½œä¸ºä½ç½®å‚æ•°ä¼ é€’ã€‚ åªè¦ä½ æ„¿æ„, ä½ å¯ä»¥é‡ç”¨è¿™ä¸ª Capture ä»»æ„æ¬¡, ç”šè‡³ä½¿ç”¨ä¸åŒçš„å‡½æ•°ã€‚\nmy $c = \\(4,2,3); reverse(|$c).say; # 3 2 4 sort(5,|$c).say; # 2 3 4 5 åœ¨ç­¾å( Signature) é‡Œé¢, å¯ä»¥åœ¨ä¸å«ç¬¦å·çš„å½¢å‚é‚£å„¿å‰ç½®ä¸€ä¸ªç«–çº¿ | æ¥åˆ›å»ºä¸€ä¸ª Captureã€‚è¿™ä¼šæŠŠä½™ä¸‹çš„å‚æ•°åˆ—è¡¨æ‰“åŒ…åˆ°é‚£ä¸ªå½¢å‚ä¸­ï¼š\nsub f($a, |c) { say c; } f(1, 2, 3, a =\u0026gt; 4, b =\u0026gt; 5); # c is \\(2, 3, a =\u0026gt; 4, b =\u0026gt; 5) è¯·æ³¨æ„ï¼ŒCapture ä»ç„¶æ˜¯åˆ—è¡¨ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½åŒ…å«å®¹å™¨ï¼Œè€Œä¸åªæ˜¯å€¼:\nmy $b = 1; my $c = \\(4,2,$b,3); sort(|$c).say; # 1 2 3 4 $b = 6; sort(|$c).say; # 2 3 4 6 Capture æ–¹æ³•(From Mu) å®šä¹‰ä¸º:\nmethod Capture(Mu:D: --\u0026gt; Capture:D) è¿”å›ä¸è°ƒç”¨è€…çš„å…¬å…±å±æ€§ç›¸å¯¹åº”çš„å‘½åå‚æ•°çš„ Captureï¼š\nclass Foo { has $.foo = 42; has $.bar = 70; method bar { \u0026#39;something else\u0026#39; } }.new.Capture.say; # OUTPUT: Â«\\(:bar(\u0026#34;something else\u0026#34;), :foo(42))â¤Â»  Cpature æ–¹æ³•(from List) å®šä¹‰ä¸º:\nmethod Capture(--\u0026gt; Capture:D) è¿”å›ä¸€ä¸ª Captureï¼Œå…¶ä¸­åˆ—è¡¨ä¸­çš„æ¯ä¸ª Pairï¼ˆå¦‚æœæœ‰ï¼‰å·²è½¬æ¢ä¸ºå‘½åå‚æ•°ï¼ˆä½¿ç”¨Pair stringçš„é”®ï¼‰ã€‚åˆ—è¡¨ä¸­çš„æ‰€æœ‰å…¶ä»–å…ƒç´ æŒ‰ç…§å®ƒä»¬è¢«å‘ç°çš„é¡ºåºè½¬æ¢ä¸ºä½ç½®å‚æ•°ï¼Œå³åˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªé Pair item æˆä¸ºç¬¬ä¸€ä¸ªä½ç½®å‚æ•°ï¼Œå…¶è·å¾—ç´¢å¼• 0ï¼Œç¬¬äºŒä¸ªé pair item æˆä¸ºç¬¬äºŒä¸ªä½ç½®å‚æ•°ï¼Œç´¢å¼•ä¸º 1 ç­‰ã€‚\nmy $list = (7, 5, a =\u0026gt; 2, b =\u0026gt; 17); my $capture = $list.Capture; say $capture.keys; # OUTPUT: Â«(0 1 a b)â¤Â»  my-sub(|$capture); # RESULT: Â«7, 5, 2, 17Â»  sub my-sub($first, $second, :$a, :$b) { say \u0026#34;$first, $second, $a, $b\u0026#34; } ä¸€ä¸ªæ›´é«˜çº§çš„ä¾‹å­æ˜¯æ‰€è¿”å›çš„ Capture ä¸ ç­¾å è¿›è¡Œæ™ºèƒ½åŒ¹é…ã€‚\nmy $list = (7, 5, a =\u0026gt; 2, b =\u0026gt; 17); say so $list.Capture ~~ :($ where * == 7,$,:$a,:$b); # OUTPUT: Â«Trueâ¤Â»  $list = (8, 5, a =\u0026gt; 2, b =\u0026gt; 17); say so $list.Capture ~~ :($ where * == 7,$,:$a,:$b); # OUTPUT: Â«Falseâ¤Â»  ","permalink":"https://ohmyweekly.github.io/notes/2015-04-01-capture-in-raku/","tags":["capture"],"title":"Raku ä¸­çš„æ•è·"},{"categories":["rakulang"],"contents":"æ“ä½œç¬¦ æ“ä½œç¬¦ä¼˜å…ˆçº§ åœ¨åƒ 1 + 2 * 3 è¿™æ ·çš„è¡¨è¾¾å¼ä¸­, 2 * 3 è¢«é¦–å…ˆè®¡ç®—, å› ä¸ºä¸­ç¼€æ“ä½œç¬¦ * çš„ä¼˜å…ˆçº§æ¯” + çš„ä¼˜å…ˆçº§é«˜ã€‚ä¸‹é¢çš„è¡¨ä¸­æ€»ç»“äº† Perl 6 ä¸­ çš„ä¼˜å…ˆçº§çº§åˆ«, ä»æœ€ç‰¢å›ºåˆ°æœ€æ¾æ•£ï¼š\nA\tLevel\tExamples N\tTerms\t42 3.14 \u0026quot;eek\u0026quot; qq[\u0026quot;foo\u0026quot;] $x :!verbose @$array L\tæ–¹æ³•åç¼€\t.meth .+ .? .* .() .[] .{} .\u0026lt;\u0026gt; .Â«Â» .:: .= .^ .: N\tè‡ªå¢\t++ -- R\tæ±‚å¹‚\t** L\tSymbolic unary\t! + - ~ ? | || +^ ~^ ?^ ^ L\tä¹˜æ³•\t* / % %% +\u0026amp; +\u0026lt; +\u0026gt; ~\u0026amp; ~\u0026lt; ~\u0026gt; ?\u0026amp; div mod gcd lcm L\tåŠ æ³•\t+ - +| +^ ~| ~^ ?| ?^ L\té‡å¤\tx xx X\tè¿ç»“ ~ X\tJunctive and\t\u0026amp; X\tJunctive or\t| ^ L\tNamed unary\ttemp let N\tStructural infix but does \u0026lt;=\u0026gt; leg cmp .. ..^ ^.. ^..^ C\tChaining infix\t!= == \u0026lt; \u0026lt;= \u0026gt; \u0026gt;= eq ne lt le gt ge ~~ === eqv !eqv X\tTight and\t\u0026amp;\u0026amp; X\tTight or\t|| ^^ // min max R\tConditional\t?? !! ff fff R\tItem assignment\t= =\u0026gt; += -= **= xx= .= L\tLoose unary\tso not X\tComma operator\t, : X\tList infix\tZ minmax X X~ X* Xeqv ... R\tList prefix\tprint push say die map substr ... [+] [*] any Z= X\tLoose and\tand andthen X\tLoose or\tor xor orelse X\tSequencer\t\u0026lt;==, ==\u0026gt;, \u0026lt;\u0026lt;==, ==\u0026gt;\u0026gt; N\tTerminator\t; {...}, unless, extra ), ], } ä¸‹é¢ä½¿ç”¨çš„ä¸¤å¤„ ! ç¬¦å·ä¸€èˆ¬ä»£è¡¨ä»»ä½•ä¸€å¯¹å„¿æ‹¥æœ‰ç›¸åŒä¼˜å…ˆçº§çš„æ“ä½œç¬¦, ä¸Šè¡¨æŒ‡å®šçš„äºŒå…ƒæ“ä½œç¬¦çš„ç»“åˆæ€§è§£é‡Šå¦‚ä¸‹(å…¶ä¸­ A ä»£è¡¨ç»“åˆæ€§, associativities )ï¼š\nA\tAssoc\tMeaning of $a ! $b ! $c L\tleft\t($a ! $b) ! $c R\tright\t$a ! ($b ! $c) N\tnon\tILLEGAL C\tchain\t($a ! $b) and ($b ! $c) X\tlist\tinfix:\u0026lt;!\u0026gt;($a; $b; $) å¯¹äºä¸€å…ƒæ“ä½œç¬¦, è¿™è§£é‡Šä¸º:\nA\tAssoc\tMeaning of !$a! L\tleft\t(!$a)! R\tright\t!($a!) N\tnon\tILLEGAL ä¸‹é¢æè¿°çš„æ“ä½œç¬¦, é»˜è®¤å‡å®šä¸º left ç»“åˆæ€§ã€‚\næ“ä½œç¬¦ç§ç±» æ“ä½œç¬¦èƒ½å‡ºç°åœ¨ç›¸å¯¹äº term çš„å‡ ä¸ªä½ç½®å¤„ï¼š\n+term\tprefix (åç¼€) term1 + term2\tinfix (ä¸­ç¼€) term++\tpostfix (åç¼€) (term)\tcircumfix (ç¯ç¼€) term1[term2]\tpostcircumfix (åç¯ç¼€) æ¯ä¸ªæ“ä½œç¬¦ä¹Ÿå¯ä»¥ç”¨ä½œå­ä¾‹ç¨‹ã€‚è¿™æ ·çš„å­ä¾‹ç¨‹çš„åå­—ç”±æ“ä½œç¬¦çš„ç§ç±», ç„¶ååè·Ÿä¸€ä¸ªå†’å·, å†åŠ ä¸Šä¸€ç»„å¼•å·ç»“æ„, å¼•å·ç»“æ„ä¸­æ˜¯ç»„æˆæ“ä½œç¬¦çš„ç¬¦å·(s):\ninfix:\u0026lt;+\u0026gt;(1, 2) # same as 1 + 2 circumfix:Â«( )Â»(\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;, \u0026#39;c\u0026#39;) # same as (\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;, \u0026#39;c\u0026#39;), ç›®å‰ç¼–è¯‘é”™è¯¯ã€‚ circumfix:\u0026lt;[ ]\u0026gt;(\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;, \u0026#39;c\u0026#39;).raku.say # [\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;] ä½œä¸ºä¸€ç§ç‰¹æ®Šæƒ…å†µ, listop(åˆ—è¡¨æ“ä½œç¬¦)æ—¢èƒ½ä½œä¸º term åˆèƒ½ä½œä¸ºå‰ç¼€ã€‚å­ä¾‹ç¨‹è°ƒç”¨æ˜¯æœ€å¸¸è§çš„åˆ—è¡¨æ“ä½œç¬¦ã€‚å…¶å®ƒæƒ…å†µåŒ…æ‹¬å…ƒè¿ç®—ä¸­ç¼€æ“ä½œç¬¦ [+]| 1, 2, 3 å’Œ prefix ç­‰ stub æ“ä½œç¬¦ã€‚\nå®šä¹‰è‡ªå®šä¹‰æ“ä½œç¬¦åœ¨ /language/functions#Defining_Operators. ä¸­æœ‰æ¶‰åŠã€‚\nTerm ä¼˜å…ˆçº§ ç¯ç¼€ \u0026lt; \u0026gt; å¼•èµ·å•è¯çš„ç»“æ„, ä»¥ç©ºç™½éš”å¼€å†…å®¹ã€‚å¦‚æœå•è¯çœ‹èµ·æ¥åƒæ•°å­—å­—é¢é‡æˆ– Pair å­—é¢é‡, é‚£ä¹ˆå®ƒä¼šè¢«è½¬ä¸ºåˆé€‚çš„æ•°å­—ã€‚\nsay \u0026lt;a b c\u0026gt;[1] # b ç¯ç¼€ ( ) åˆ†ç»„æ“ä½œç¬¦ã€‚\nåœ¨å‚æ•°åˆ—è¡¨ä¸­, åœ¨å‚æ•°å‘¨å›´æ”¾ä¸Šåœ†æ‹¬å·é˜²æ­¢äº†å‚æ•°è¢«è§£é‡Šä¸ºå…·åå‚æ•°ã€‚\nmulti sub p(:$a!) { say \u0026#39;named\u0026#39; } multi sub p($a) { say \u0026#39;positional\u0026#39; } p a =\u0026gt; 1; # named p (a =\u0026gt; 1); # positional ç¯ç¼€ { } Block æˆ– æ•£åˆ—æ„é€ å™¨ã€‚\nå¦‚æœ {} é‡Œé¢çš„å†…å®¹çœ‹èµ·æ¥åƒä¸€ç»„ pairs å¹¶ä¸”æ²¡æœ‰ $_ æˆ–å…¶å®ƒå ä½ç¬¦å‚æ•°, å°±è¿”å›ä¸€ä¸ªæ•£åˆ—, è¿™ä¸ªæ•£åˆ—ç”±é€é¡¹é€é¡¹çš„ Pair ç»„æˆã€‚\nå¦åˆ™å°±è¿”å›ä¸€ä¸ª Blockã€‚\næ³¨æ„, è¿™ä¸ªç»“æ„æ²¡æœ‰é‡æ–°è§£æå†…å®¹; è€Œé‡Œé¢çš„å†…å®¹æ€»æ˜¯è¢«è§£æä¸ºä¸€ç»„å¥å­ï¼ˆä¾‹å¦‚, åƒä¸€ä¸ª blockï¼‰, å¹¶ä¸”å¦‚æœåé¢çš„åˆ†æè¡¨æ˜å®ƒéœ€è¦è¢«è§£ææˆä¸€ä¸ªæ•£åˆ—, é‚£ä¹ˆ block å°±ä¼šè¢«æ‰§è¡Œå¹¶å¼ºè½¬ä¸ºæ•£åˆ—ã€‚\nç¯ç¼€ [ ] æ•°ç»„æ„é€ å™¨ã€‚åœ¨åˆ—è¡¨ä¸Šä¸‹æ–‡ä¸­è¿”å›ä¸€ä¸ªä¸ä¼šå±•å¹³çš„ item åŒ–çš„æ•°ç»„ã€‚\næ–¹æ³•åç¼€ä¼˜å…ˆçº§ åç¯ç¼€ [ ] sub postcircumfix:\u0026lt;[ ]\u0026gt;(@container, **@index, :$k, :$v, :$kv, :$p, :$exists, :$delete) :$k ä¼šåˆ›å»ºä¸€ä¸ª Pair, å®ƒæ˜¯æ•£åˆ—ä¸­çš„ä¸€ä¸ªæ¡ç›®ã€‚é”®æ˜¯ k, é”®å€¼ä¸º $kvã€‚æ‰€ä»¥, $k ç­‰ä»·äº k =\u0026gt; $k\nè®¿é—® @container ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ , å³æ•°ç»„ç´¢å¼•æ“ä½œï¼š\nmy @alphabet = \u0026#39;a\u0026#39; .. \u0026#39;z\u0026#39;; say @alphabet[0]; #-\u0026gt; a say @alphabet[1]; #-\u0026gt; b say @alphabet[*-1]; #-\u0026gt; z say @alphabet[100]:exists; #-\u0026gt; False say @alphabet[15, 4, 17, 11].join; #-\u0026gt; perl say @alphabet[23 .. *].raku; #-\u0026gt; (\u0026#34;x\u0026#34;, \u0026#34;y\u0026#34;, \u0026#34;z\u0026#34;) @alphabet[1, 2] = \u0026#34;B\u0026#34;, \u0026#34;C\u0026#34;; say @alphabet[0..3].raku #-\u0026gt; (\u0026#34;a\u0026#34;, \u0026#34;B\u0026#34;, \u0026#34;C\u0026#34;, \u0026#34;d\u0026#34;) æŸ¥çœ‹ Subscripts è·å–å…³äºè¯¥æ“ä½œç¬¦è¡Œä¸ºçš„æ›´è¯¦ç»†çš„è§£é‡Š, è¿˜æœ‰æ€ä¹ˆåœ¨è‡ªå®šä¹‰ç±»å‹ä¸­å®ç°å¯¹å®ƒçš„æ”¯æŒã€‚\nåç¯ç¼€ { } sub postcircumfix:\u0026lt;{ }\u0026gt;(%container, **@key, :$k, :$v, :$kv, :$p, :$exists, :$delete) è®¿é—® %container çš„ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ , å³æ•£åˆ—ç´¢å¼•æ“ä½œï¼š\nmy %color = kiwi =\u0026gt; \u0026#34;green\u0026#34;, banana =\u0026gt; \u0026#34;yellow\u0026#34;, cherry =\u0026gt; \u0026#34;red\u0026#34;; say %color{\u0026#34;banana\u0026#34;}; #-\u0026gt; yellow say %color{\u0026#34;cherry\u0026#34;, \u0026#34;kiwi\u0026#34;}.raku; #-\u0026gt; (\u0026#34;red\u0026#34;, \u0026#34;green\u0026#34;) say %color{\u0026#34;strawberry\u0026#34;}:exists; #-\u0026gt; False %color{\u0026#34;banana\u0026#34;, \u0026#34;lime\u0026#34;} = \u0026#34;yellowish\u0026#34;, \u0026#34;green\u0026#34;; %color{\u0026#34;cherry\u0026#34;}:delete; say %color; #-\u0026gt; banana =\u0026gt; yellowish, kiwi =\u0026gt; green, lime =\u0026gt; green æŸ¥çœ‹åç¯ç¼€ \u0026lt; \u0026gt; å’Œåç¯ç¼€ Â« Â» ä½œä¸ºä¾¿æ·å½¢å¼, æŸ¥çœ‹ Subscripts è·å–è¿™ä¸ªæ“ä½œç¬¦è¡Œä¸ºçš„æ›´è¯¦ç»†è§£é‡Š, è¿˜æœ‰æ€ä¹ˆåœ¨è‡ªå®šä¹‰ç±»å‹ä¸­å®ç°å¯¹å®ƒçš„æ”¯æŒã€‚\nåç¯ç¼€ \u0026lt; \u0026gt; åç¯ç¼€ { } çš„ç®€å†™å½¢å¼, å®ƒä¼šå¼•èµ·å®ƒçš„å‚æ•°ã€‚\nmy %color = kiwi =\u0026gt; \u0026#34;green\u0026#34;, banana =\u0026gt; \u0026#34;yellow\u0026#34;, cherry =\u0026gt; \u0026#34;red\u0026#34;; say %color\u0026lt;banana\u0026gt;; #-\u0026gt; yellow say %color\u0026lt;cherry kiwi\u0026gt;.raku; #-\u0026gt; (\u0026#34;red\u0026#34;, \u0026#34;green\u0026#34;) say %color\u0026lt;strawberry\u0026gt;:exists; #-\u0026gt; False è¿™ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„æ“ä½œç¬¦, å®ƒä»…ä»…æ˜¯ä¸€ä¸ªåœ¨ç¼–è¯‘æ—¶æŠŠ \u0026lt; \u0026gt; å˜æˆ {} åç¯ç¼€æ“ä½œç¬¦çš„è¯­æ³•ç³–ã€‚\nåç¯ç¼€ Â« Â» åç¯ç¼€ { } çš„ç®€å†™å½¢å¼ã€‚å®ƒä¼šå¼•èµ·å®ƒçš„å‚æ•°, å¹¶ä¸” Â« Â» ä¸­èƒ½è¿›è¡Œå˜é‡æ’å€¼ã€‚\nmy %color = kiwi =\u0026gt; \u0026#34;green\u0026#34;, banana =\u0026gt; \u0026#34;yellow\u0026#34;, cherry =\u0026gt; \u0026#34;red\u0026#34;; my $fruit = \u0026#34;kiwi\u0026#34;; say %colorÂ«cherry $fruitÂ».raku; #-\u0026gt; (\u0026#34;red\u0026#34;, \u0026#34;green\u0026#34;) è¿™ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„æ“ä½œç¬¦, å®ƒä»…ä»…æ˜¯ä¸€ä¸ªåœ¨ç¼–è¯‘æ—¶æŠŠ Â« Â» å˜æˆ {} åç¯ç¼€æ“ä½œç¬¦çš„è¯­æ³•ç³–ã€‚\nåç¯ç¼€ ( ) è°ƒç”¨æ“ä½œç¬¦ã€‚æŠŠè°ƒç”¨è€…å½“ä½œ Callable å¹¶å¼•ç”¨å®ƒ, å®ƒä½¿ç”¨åœ†æ‹¬å·ä¹‹é—´çš„è¡¨è¾¾å¼ä½œä¸ºå‚æ•°ã€‚\næ³¨æ„, æ ‡è¯†ç¬¦åé¢ç›´æ¥è·Ÿç€ä¸€å¯¹å„¿åœ†æ‹¬å·æ€»æ˜¯è¢«è§£æä¸ºå­ä¾‹ç¨‹è°ƒç”¨ã€‚\nå¦‚æœä½ æƒ³è¦ä½ çš„å¯¹è±¡å“åº”è¯¥è°ƒç”¨æ“ä½œç¬¦, ä½ éœ€è¦å®ç° CALL-ME æ–¹æ³•ã€‚\npostfix . è¯¥æ“ä½œç¬¦ç”¨äºè°ƒç”¨ä¸€ä¸ªæ–¹æ³•, $invocant.methodã€‚\næŠ€æœ¯ä¸Šè®², è¿™ä¸æ˜¯ä¸€ä¸ªæ“ä½œç¬¦, è€Œæ˜¯ç¼–è¯‘å™¨ä¸­ç‰¹æ®Šæƒ…å†µä¸‹çš„è¯­æ³•ã€‚\npostfix .= å¯å˜çš„æ–¹æ³•è°ƒç”¨ã€‚$invocant.=method, è„±å»è¯­æ³•ç³–åå°±æ˜¯ $invocant = $invocant.method, è¿™ä¸ op=. ç±»ä¼¼ã€‚\næŠ€æœ¯ä¸Šè®², è¿™ä¸æ˜¯ä¸€ä¸ªæ“ä½œç¬¦, è€Œæ˜¯ç¼–è¯‘å™¨ä¸­ç‰¹æ®Šæƒ…å†µä¸‹çš„è¯­æ³•ã€‚\npostfix .^ å…ƒæ–¹æ³•è°ƒç”¨ã€‚ $invocant.^method åœ¨ $invocant çš„å…ƒç±»èº«ä¸Šè°ƒç”¨æ–¹æ³•ã€‚è„±å»è¯­æ³•ç³–å, å®ƒå°±æ˜¯ $invocant.HOW.method($invocant, ...)ã€‚æŸ¥çœ‹ HOW è·å–æ›´å¤šä¿¡æ¯ã€‚\næŠ€æœ¯ä¸Šè®², è¿™ä¸æ˜¯ä¸€ä¸ªæ“ä½œç¬¦, è€Œæ˜¯ç¼–è¯‘å™¨ä¸­ç‰¹æ®Šæƒ…å†µä¸‹çš„è¯­æ³•ã€‚\npostfix .? æœ‰å¯èƒ½è¢«è°ƒç”¨çš„æ–¹æ³•è°ƒç”¨ã€‚å¦‚æœæœ‰åä¸º method çš„æ–¹æ³•, $invocant.?method å°±åœ¨ $invocant ä¸Šè°ƒç”¨ method æ–¹æ³•ã€‚å¦åˆ™å®ƒå°±è¿”å› Nilã€‚\næŠ€æœ¯ä¸Šè®², è¿™ä¸æ˜¯ä¸€ä¸ªæ“ä½œç¬¦, è€Œæ˜¯ç¼–è¯‘å™¨ä¸­ç‰¹æ®Šæƒ…å†µä¸‹çš„è¯­æ³•ã€‚\npostfix .+ $invocant.+method  ä» $invocant èº«ä¸Šè°ƒç”¨æ‰€æœ‰å«åš method çš„æ–¹æ³•ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°è¿™ä¸ªåå­—çš„æ–¹æ³•, å°±ä¼šæ­»æ‰ã€‚\næŠ€æœ¯ä¸Šè®², è¿™ä¸æ˜¯ä¸€ä¸ªæ“ä½œç¬¦, è€Œæ˜¯ç¼–è¯‘å™¨ä¸­ç‰¹æ®Šæƒ…å†µä¸‹çš„è¯­æ³•ã€‚\npostfix .* $invocant.*method ä» $invocant èº«ä¸Šè°ƒç”¨æ‰€æœ‰å«åš method çš„æ–¹æ³•ã€‚\næŠ€æœ¯ä¸Šè®², è¿™ä¸æ˜¯ä¸€ä¸ªæ“ä½œç¬¦, è€Œæ˜¯ç¼–è¯‘å™¨ä¸­ç‰¹æ®Šæƒ…å†µä¸‹çš„è¯­æ³•ã€‚\npostfix .postfix å¤§å¤šæ•°æƒ…å†µä¸‹, å¯ä»¥åœ¨åç¼€æˆ–åç¯ç¼€å‰é¢æ”¾ä¸Šä¸€ä¸ªç‚¹ï¼š\n@a[1, 2, 3]; @a.[1, 2, 3]; # Same è¿™å¯¹äºè§†è§‰æ¸…æ™°æˆ–ç®€æ´å¾ˆæœ‰å¸®åŠ©ã€‚ä¾‹å¦‚, å¦‚æœå¯¹è±¡çš„å±æ€§æ˜¯ä¸€ä¸ªå‡½æ•°, åœ¨å±æ€§ååé¢æ”¾ç½®ä¸€å¯¹å„¿åœ†æ‹¬å·ä¼šå˜æˆæ–¹æ³•è°ƒç”¨çš„ä¸€éƒ¨åˆ†ã€‚æ‰€ä»¥è¦ä¹ˆä½¿ç”¨ä¸¤å¯¹å„¿åœ†æ‹¬å·, è¦ä¹ˆåœ¨åœ†æ‹¬å·å‰é¢æ”¾ä¸Šä¸€ä¸ªç‚¹æ¥é˜»æ­¢æ–¹æ³•è°ƒç”¨ã€‚\nclass Operation { has $.symbol; has \u0026amp;.function; } my $addition = Operation.new(:symbol\u0026lt;+\u0026gt;, :function{ $^a + $^b }); say $addition.function()(1, 2); # 3 æˆ–è€…:\nsay $addition.function.(1,2); # 3 ç„¶è€Œ, å¦‚æœåç¼€æ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦, é‚£ä¹ˆå®ƒä¼šè¢«è§£é‡Šä¸ºä¸€ä¸ªæ™®é€šçš„æ–¹æ³•è°ƒç”¨ã€‚\n1.i # No such method 'i' for invocant of type 'Int' æŠ€æœ¯ä¸Šè®², è¿™ä¸æ˜¯ä¸€ä¸ªæ“ä½œç¬¦, è€Œæ˜¯ç¼–è¯‘å™¨ä¸­ç‰¹æ®Šæƒ…å†µä¸‹çš„è¯­æ³•ã€‚\npostfix .: å‰ç¼€èƒ½å¤Ÿåƒæ–¹æ³•é‚£æ ·, ä½¿ç”¨å†’å·å¯¹å„¿æ ‡è®°æ³•æ¥è°ƒç”¨ã€‚ä¾‹å¦‚ï¼š\nmy $a = 1; say ++$a; # 2 say $a.:\u0026lt;++\u0026gt;; # 3 æŠ€æœ¯ä¸Šè®², è¿™ä¸æ˜¯ä¸€ä¸ªæ“ä½œç¬¦, è€Œæ˜¯ç¼–è¯‘å™¨ä¸­ç‰¹æ®Šæƒ…å†µä¸‹çš„è¯­æ³•ã€‚\npostfix .:: ä¸€ä¸ªç±»é™å®šçš„æ–¹æ³•è°ƒç”¨, ç”¨äºè°ƒç”¨ä¸€ä¸ªå®šä¹‰åœ¨çˆ¶ç±»æˆ– role ä¸­çš„æ–¹æ³•, ç”šè‡³åœ¨å­ç±»ä¸­é‡æ–°å®šä¹‰äº†ä¹‹åã€‚\nclass Bar { method baz { 42 } } class Foo is Bar { method baz { \u0026#34;nope\u0026#34; } } say Foo.Bar::baz; # 42 è‡ªå¢ä¼˜å…ˆçº§ prefix ++ multi sub prefix:\u0026lt;++\u0026gt;($x is rw) is assoc\u0026lt;none\u0026gt; æŠŠå®ƒçš„å‚æ•°å¢åŠ  1, å¹¶è¿”å›å¢åŠ åçš„å€¼ã€‚\nmy $x = 3; say ++$x; # 4 say $x; # 4 å®ƒçš„å·¥ä½œåŸç†æ˜¯åœ¨å®ƒçš„å‚æ•°èº«ä¸Šè°ƒç”¨ succ æ–¹æ³•, è¿™å¯ä»¥è®©è‡ªå®šä¹‰ç±»å‹è‡ªç”±åœ°å®ç°å®ƒä»¬è‡ªå·±çš„å¢é‡è¯­ä¹‰ã€‚\nprefix \u0026ndash; multi sub prefix:\u0026lt;--\u0026gt;($x is rw) is assoc\u0026lt;none\u0026gt; æŠŠå®ƒçš„å‚æ•°å‡å°‘ 1, å¹¶è¿”å›å‡å°‘åçš„å€¼ã€‚\nmy $x = 3; say --$x; # 2 say $x; # 2 å®ƒçš„å·¥ä½œåŸç†æ˜¯åœ¨å®ƒçš„å‚æ•°èº«ä¸Šè°ƒç”¨ pred æ–¹æ³•, è¿™å¯ä»¥è®©è‡ªå®šä¹‰ç±»å‹è‡ªç”±åœ°å®ç°å®ƒä»¬è‡ªå·±çš„å‡é‡è¯­ä¹‰ã€‚\npostfix ++ multi sub postfix:\u0026lt;++\u0026gt;($x is rw) is assoc\u0026lt;none\u0026gt; æŠŠå®ƒçš„å‚æ•°å¢åŠ  1, å¹¶è¿”å› unincremented çš„é‚£ä¸ªå€¼ã€‚\nmy $x = 3; say $x++; # 3 say $x; # 4 å®ƒçš„å·¥ä½œåŸç†æ˜¯åœ¨å®ƒçš„å‚æ•°èº«ä¸Šè°ƒç”¨ succ æ–¹æ³•, è¿™å¯ä»¥è®©è‡ªå®šä¹‰ç±»å‹è‡ªç”±åœ°å®ç°å®ƒä»¬è‡ªå·±çš„å¢é‡è¯­ä¹‰ã€‚\næ³¨æ„è¿™å¹¶ä¸ä¸€å®šè¿”å›å®ƒçš„å‚æ•°ã€‚ä¾‹å¦‚, å¯¹äºæœªå®šä¹‰çš„å€¼, å®ƒè¿”å› 0:\nmy $x; say $x++; # 0 say $x; # 1 postfix \u0026ndash; multi sub postfix:\u0026lt;--\u0026gt;($x is rw) is assoc\u0026lt;none\u0026gt; æŠŠå®ƒçš„å‚æ•°å‡å°‘ 1, å¹¶è¿”å› undecremented çš„é‚£ä¸ªå€¼ã€‚\nmy $x = 3; say $x--; # 3 say $x; # 2 å®ƒçš„å·¥ä½œåŸç†æ˜¯åœ¨å®ƒçš„å‚æ•°èº«ä¸Šè°ƒç”¨ pred æ–¹æ³•, è¿™å¯ä»¥è®©è‡ªå®šä¹‰ç±»å‹è‡ªç”±åœ°å®ç°å®ƒä»¬è‡ªå·±çš„å‡é‡è¯­ä¹‰ã€‚\næ³¨æ„è¿™å¹¶ä¸ä¸€å®šè¿”å›å®ƒçš„å‚æ•°ã€‚ä¾‹å¦‚, å¯¹äºæœªå®šä¹‰çš„å€¼, å®ƒè¿”å› 0:\nmy $x; say $x--; # 0 say $x; # -1 æ±‚å¹‚ä¼˜å…ˆçº§ infix ** multi sub infix:\u0026lt;**\u0026gt;(Any, Any) returns Numeric:D is assoc\u0026lt;right\u0026gt; æ±‚å¹‚æ“ä½œç¬¦æŠŠå®ƒçš„ä¸¤ä¸ªå‚æ•°éƒ½å¼ºåˆ¶è½¬ä¸º Numeric , ç„¶åè®¡ç®—, å³ä¾§ä¸ºå¹‚ã€‚\nå¦‚æœ ** å³è¾¹æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°, å¹¶ä¸”å·¦ä¾§æ˜¯ä»»æ„ç²¾åº¦ç±»å‹(Int, FatRat), é‚£ä¹ˆè®¡ç®—ä¸ä¼šæŸå¤±ç²¾åº¦ã€‚\nè±¡å½¢ä¸€å…ƒæ“ä½œç¬¦çš„ä¼˜å…ˆçº§ prefix ? multi sub prefix:\u0026lt;?\u0026gt;(Mu) returns Bool:D å¸ƒå°”ä¸Šä¸‹æ–‡æ“ä½œç¬¦ã€‚\né€šè¿‡åœ¨å‚æ•°èº«ä¸Šè°ƒç”¨ Bool æ–¹æ³•å¼ºåˆ¶å®ƒçš„å‚æ•°ä¸º Boolã€‚æ³¨æ„, è¿™ä¼šä½¿ Junctions å¤±æ•ˆã€‚\nprefix ! multi sub prefix:\u0026lt;!\u0026gt;(Mu) returns Bool:D å¦å®šçš„å¸ƒå°”ä¸Šä¸‹æ–‡æ“ä½œç¬¦ã€‚\né€šè¿‡åœ¨å‚æ•°èº«ä¸Šè°ƒç”¨ Bool æ–¹æ³•å¼ºåˆ¶å®ƒçš„å‚æ•°ä¸º Bool, å¹¶è¿”å›ç»“æœçš„å¦å®šå€¼ã€‚æ³¨æ„, è¿™ä¼šä½¿ Junctions å¤±æ•ˆã€‚\nprefix + multi sub prefix:\u0026lt;+\u0026gt;(Any) returns Numeric:D Numeric ä¸Šä¸‹æ–‡æ“ä½œç¬¦ã€‚\né€šè¿‡åœ¨å‚æ•°èº«ä¸Šè°ƒç”¨ Numeric æ–¹æ³•å¼ºåˆ¶å°†å‚æ•°è½¬ä¸º Numeric ç±»å‹ã€‚\nprefix - multi sub prefix:\u0026lt;-\u0026gt;(Any) returns Numeric:D å¦å®šçš„ Numeric ä¸Šä¸‹æ–‡æ“ä½œç¬¦ã€‚\né€šè¿‡åœ¨å‚æ•°èº«ä¸Šè°ƒç”¨ Numeric æ–¹æ³•å¼ºåˆ¶å°†å‚æ•°è½¬ä¸º Numeric ç±»å‹, å¹¶è¿”å›ç»“æœçš„å¦å®šå€¼ã€‚\nprefix ~ multi sub prefix:\u0026lt;-\u0026gt;(Any) returns Str:D å­—ç¬¦ä¸²ä¸Šä¸‹æ–‡æ“ä½œç¬¦ã€‚\né€šè¿‡åœ¨å‚æ•°èº«ä¸Šè°ƒç”¨ Str æ–¹æ³•å¼ºåˆ¶æŠŠå‚æ•°è½¬ä¸º Str ç±»å‹ã€‚\nprefix | å°† Capture, Enum, Pair, List, EnumMap å’Œ Hash å±•å¹³åˆ°å‚æ•°åˆ—è¡¨ä¸­ã€‚\nï¼ˆåœ¨ Rakudo ä¸­, è¿™ä¸æ˜¯ä½œä¸ºä¸€ä¸ªåˆé€‚çš„æ“ä½œç¬¦æ¥å®ç°çš„, è€Œæ˜¯ç¼–è¯‘å™¨ä¸­çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µ, è¿™æ„å‘³ç€å®ƒåªå¯¹å‚æ•°åˆ—è¡¨æœ‰æ•ˆ, è€Œéåœ¨ä»»æ„ä»£ç ä¸­éƒ½æœ‰æ•ˆã€‚ï¼‰\nprefix +^ multi sub prefix:\u0026lt;+^\u0026gt;(Any) returns Int:D æ•´æ•°æŒ‰ä½å–åã€‚\nå°†å‚æ•°å¼ºè½¬ä¸º Int ç±»å‹å¹¶å¯¹ç»“æœæŒ‰ä½å–å, å‡è®¾ä¸¤è€…äº’è¡¥ã€‚\nprefix ?^ multi sub prefix:\u0026lt;?^\u0026gt;(Mu) returns Bool:D å¸ƒå°”æŒ‰ä½å–åã€‚\nå°†å‚æ•°å¼ºè½¬ä¸º Bool, ç„¶åæŒ‰ä½åè½¬, è¿™ä½¿å®ƒå’Œ prefix:\u0026lt;!\u0026gt; ä¸€æ ·ã€‚\nprefix ^ multi sub prefix:\u0026lt;^\u0026gt;(Any) returns Range:D upto æ“ä½œç¬¦.\nå¼ºåˆ¶æŠŠå®ƒçš„å‚æ•°è½¬ä¸º Numeric, ç”Ÿæˆä¸€ä¸ªä» 0 ç›´åˆ°ï¼ˆä½†æ˜¯æ’é™¤ï¼‰ å‚æ•°ä¸ºæ­¢çš„èŒƒå›´ã€‚\nsay ^5; # 0..^5 for ^5 { } # 5 iterations ä¹˜æ³•ä¼˜å…ˆçº§ infix * multi sub infix:\u0026lt;*\u0026gt;(Any, Any) returns Numeric:D æŠŠä¸¤è¾¹çš„å‚æ•°éƒ½å¼ºè½¬ä¸º Numeric å¹¶æŠŠå®ƒä»¬ç›¸ä¹˜ã€‚ç»“æœæ˜¯ä¸€ä¸ªæ›´å®½çš„ç±»å‹ã€‚æŸ¥çœ‹ Numeric è·å–æ›´è¯¦ç»†ä¿¡æ¯ã€‚\ninfix / multi sub infix:\u0026lt;/\u0026gt;(Any, Any) returns Numeric:D æŠŠä¸¤è¾¹çš„å‚æ•°éƒ½å¼ºåˆ¶ä¸º Numeric, å¹¶ç”¨å·¦è¾¹é™¤ä»¥å³è¾¹çš„æ•°ã€‚æ•´æ•°ç›¸é™¤è¿”å› Rat, å¦åˆ™è¿”å›\u0026quot;æ›´å®½ç±»å‹\u0026quot;çš„ç»“æœã€‚\ninfix div multi sub infix:\u0026lt;div\u0026gt;(Int:D, Int:D) returns Int:D æ•´é™¤ã€‚å‘ä¸‹å–æ•´ã€‚\ninfix % multi sub infix:\u0026lt;%\u0026gt;($x, $y) return Numeric:D æ¨¡æ“ä½œç¬¦ã€‚é¦–å…ˆå¼ºåˆ¶ä¸º Numericã€‚\né€šå¸¸, ä¸‹é¢çš„ç­‰å¼æ˜¯æˆç«‹çš„ï¼š\n$x % $y == $x - floor($x / $y) * $y infix %% multi sub infix:\u0026lt;%%\u0026gt;($a, $b) returns Bool:D æ•´é™¤æ“ä½œç¬¦, å¦‚æœ $a % $b == 0 åˆ™è¿”å› True.\ninfix mod multi sub infix:\u0026lt;mod\u0026gt;(Int:D $a, Int:D $b) returns Int:D æ•´æ•°å–æ¨¡æ“ä½œç¬¦ã€‚è¿”å›æ•´æ•°å–æ¨¡æ“ä½œçš„å‰©ä½™éƒ¨åˆ†ã€‚\ninfix +\u0026amp; multi sub infix:\u0026lt;+\u0026amp;\u0026gt;($a, $b) returns Int:D Numeric æŒ‰ä½ ANDã€‚æŠŠä¸¤ä¸ªå‚æ•°éƒ½å¼ºè½¬ä¸º Int å¹¶æ‰§è¡ŒæŒ‰ä½ AND æ“ä½œ, å‡å®šä¸¤è€…æ˜¯äº’è¡¥çš„ã€‚\ninfix +\u0026lt; multi sub infix:\u0026lt;\u0026lt;+\u0026lt; \u0026gt;\u0026gt;($a, $b) returns Int:D å‘å·¦ç§»åŠ¨æ•´æ•°ä¸ªä½ã€‚\ninfix +\u0026gt; multi sub infix:\u0026lt;\u0026lt;+\u0026gt; \u0026gt;\u0026gt;($a, $b) returns Int:D å‘å³ç§»åŠ¨æ•´æ•°ä¸ªä½ã€‚\ninfix gcd multi sub infix:\u0026lt;gcd\u0026gt;($a, $b) returns Int:D å¼ºåˆ¶ä¸¤ä¸ªå‚æ•°éƒ½ä¸º Int å¹¶è¿”å›æœ€å¤§å…¬åˆ†æ¯ï¼ˆgreatest common denominatorï¼‰ã€‚\ninfix lcm multi sub infix:\u0026lt;lcm\u0026gt;($a, $b) returns Int:D å¼ºåˆ¶ä¸¤ä¸ªå‚æ•°ä¸º Int å¹¶è¿”å›æœ€å°å…¬å€æ•°(least common multiple)\nåŠ æ³•ä¼˜å…ˆçº§ infix + multi sub infix:\u0026lt;+\u0026gt;($a, $b) returns Numeric:D å¼ºåˆ¶ä¸¤ä¸ªå‚æ•°ä¸º Numeric å¹¶æŠŠå®ƒä»¬ç›¸åŠ ã€‚\ninfix - multi sub infix:\u0026lt;-\u0026gt;($a, $b) returns Numeric:D å¼ºåˆ¶ä¸¤ä¸ªå‚æ•°ä¸º Numeric å¹¶ç”¨ç¬¬ä¸€ä¸ªå‚æ•°å‡å»ç¬¬äºŒä¸ªå‚æ•°ã€‚\ninfix +| multi sub infix:\u0026lt;+|\u0026gt;($a, $b) returns Int:D å¼ºåˆ¶ä¸¤ä¸ªå‚æ•°ä¸º Int å¹¶æ‰§è¡ŒæŒ‰ä½ ORï¼ˆåŒ…æ‹¬ ORï¼‰\ninfix +^ multi sub infix:\u0026lt;+^\u0026gt;($a, $b) returns Int:D å¼ºåˆ¶ä¸¤ä¸ªå‚æ•°ä¸º Int å¹¶æ‰§è¡ŒæŒ‰ä½ XORï¼ˆä¸åŒ…æ‹¬ ORï¼‰\ninfix ?| multi sub infix:\u0026lt;?|\u0026gt;($a, $b) returns Bool:D å¼ºåˆ¶ä¸¤ä¸ªå‚æ•°ä¸º Bool å¹¶æ‰§è¡Œé€»è¾‘ ORï¼ˆä¸åŒ…æ‹¬ ORï¼‰\né‡å¤æ“ä½œç¬¦ä¼˜å…ˆçº§ infix x proto sub infix:\u0026lt;x\u0026gt;(Any, Any) returns Str:D multi sub infix:\u0026lt;x\u0026gt;(Any, Any) multi sub infix:\u0026lt;x\u0026gt;(Str:D, Int:D) æŠŠ $a å¼ºè½¬ä¸º Str , æŠŠ $b å¼ºè½¬ä¸º Int, å¹¶é‡å¤å­—ç¬¦ä¸² $b æ¬¡ã€‚å¦‚æœ $b \u0026lt;= 0 åˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚\nsay \u0026#39;ab\u0026#39; x 3; # ababab say 42 x 3; # 424242 infix xx multi sub infix:\u0026lt;xx\u0026gt;($a, $b) returns List:D è¿”å›ä¸€ç»„é‡å¤çš„ $a å¹¶è®¡ç®— $b æ¬¡ï¼ˆ$b è¢«å¼ºè½¬ä¸º Intï¼‰ã€‚å¦‚æœ $b \u0026lt;= 0 ,åˆ™è¿”å›ä¸€ä¸ªç©ºåˆ—è¡¨ã€‚\næ¯æ¬¡é‡å¤éƒ½ä¼šè®¡ç®—å·¦ä¾§çš„å€¼, æ‰€ä»¥\n[1, 2] xx 5 è¿”å› 5 ä¸ªä¸åŒçš„æ•°ç»„ï¼ˆä½†æ˜¯æ¯æ¬¡éƒ½æ˜¯ç›¸åŒçš„å†…å®¹ï¼‰å¹¶ä¸”\nrand xx 3 è¿”å› 3 ä¸ªç‹¬ç«‹çš„ä¼ªéšæœºæ•°ã€‚å³ä¾§å¯ä»¥æ˜¯ *, è¿™æ—¶ä¼šè¿”å›ä¸€ä¸ªæƒ°æ€§çš„, æ— é™çš„åˆ—è¡¨ã€‚\nè¿ç»“ infix ~ proto sub infix:\u0026lt;~\u0026gt;(Any, Any) returns Str:D multi sub infix:\u0026lt;~\u0026gt;(Any, Any) multi sub infix:\u0026lt;~\u0026gt;(Str:D, Str:D) å¼ºåˆ¶ä¸¤ä¸ªå‚æ•°ä¸º Str å¹¶è¿ç»“å®ƒä»¬ã€‚\nsay \u0026#39;ab\u0026#39; ~ \u0026#39;c\u0026#39;; # abc Junctive AND (all) ä¼˜å…ˆçº§ infix \u0026amp; multi sub infix:\u0026lt;\u0026amp;\u0026gt;($a, $b) returns Junction:D is assoc\u0026lt;list\u0026gt; ç”¨å®ƒçš„å‚æ•°åˆ›å»ºä¸€ä¸ª all Junctionã€‚æŸ¥çœ‹ Junctions è·å–æ›´å¤šè¯¦æƒ…ã€‚\nJunctive OR (any) Precedence infix | multi sub infix:\u0026lt;|\u0026gt;($a, $b) returns Junction:D is assoc\u0026lt;list\u0026gt; ç”¨å®ƒçš„å‚æ•°åˆ›å»ºä¸€ä¸ª any Junctionã€‚æŸ¥çœ‹ Junctions è·å–æ›´å¤šè¯¦æƒ…ã€‚\ninfix ^ multi sub infix:\u0026lt;^\u0026gt;($a, $b) returns Junction:D is assoc\u0026lt;list\u0026gt; ç”¨å®ƒçš„å‚æ•°åˆ›å»ºä¸€ä¸ª one Junctionã€‚æŸ¥çœ‹ Junctions è·å–æ›´å¤šè¯¦æƒ…ã€‚\nNamed Unary Precedence prefix temp sub prefix:\u0026lt;temp\u0026gt;(Mu $a is rw) temporizes ä¼ å…¥çš„å˜é‡ä½œä¸ºå‚æ•°, è¿™æ„å‘³ç€é€€å‡ºä½œç”¨åŸŸåå®ƒè¢«é‡ç½®ä¸ºæ—§å€¼ã€‚ï¼ˆè¿™å’Œ Perl 5 ä¸­çš„ local æ“ä½œç¬¦ç±»ä¼¼, é™¤äº† temp ä¸é‡ç½®å€¼ä¹‹å¤–ã€‚ï¼‰\nprefix let sub prefix:\u0026lt;let\u0026gt;(Mu $a is rw) å‡å®šé‡ç½®ï¼šå¦‚æœé€šè¿‡å¼‚å¸¸æˆ– fail() é€€å‡ºå½“å‰ä½œç”¨åŸŸ, æ—§å€¼å°±ä¼šè¢«æ¢å¤ã€‚\nNonchaining Binary Precedence infix does sub infix:\u0026lt;does\u0026gt;(Mu $obj, Mu $role) is assoc\u0026lt;none\u0026gt; åœ¨è¿è¡Œæ—¶æŠŠ $role æ··åˆè¿› $obj ä¸­ã€‚è¦æ±‚ $obj æ˜¯å¯å˜çš„ã€‚\nå‚æ•° $role ä¸ä¸€å®šè¦æ±‚æ˜¯ä¸€ä¸ª role, å®ƒå¯ä»¥è¡¨ç°çš„åƒæ˜¯ä¸€ä¸ª role, ä¾‹å¦‚æšä¸¾å€¼ã€‚\ninfix but sub infix:\u0026lt;but\u0026gt;(Mu $obj, Mu $role) is assoc\u0026lt;none\u0026gt; æŠŠ $role æ··åˆè¿› $obj å¹¶åˆ›å»ºä¸€ä¸ª $obj çš„å‰¯æœ¬ã€‚å› ä¸º $obj æ˜¯ä¸èƒ½ä¿®æ”¹çš„, ä½†æ˜¯èƒ½ä½¿ç”¨ mixins ç”¨äºåˆ›å»ºä¸å¯å˜å€¼ã€‚\nå‚æ•° $role ä¸ä¸€å®šè¦æ±‚æ˜¯ä¸€ä¸ª role, å®ƒå¯ä»¥è¡¨ç°çš„åƒæ˜¯ä¸€ä¸ª role, ä¾‹å¦‚æšä¸¾å€¼ã€‚\ninfix cmp proto sub infix:\u0026lt;cmp\u0026gt;(Any, Any) returns Order:D is assoc\u0026lt;none\u0026gt; multi sub infix:\u0026lt;cmp\u0026gt;(Any, Any) multi sub infix:\u0026lt;cmp\u0026gt;(Real:D, Real:D) multi sub infix:\u0026lt;cmp\u0026gt;(Str:D, Str:D) multi sub infix:\u0026lt;cmp\u0026gt;(Enum:D, Enum:D) multi sub infix:\u0026lt;cmp\u0026gt;(Version:D, Version:D) ä¸€èˆ¬çš„, â€œæ™ºèƒ½çš„â€ ä¸‰è·¯æ¯”è¾ƒå™¨ã€‚\næ¯”è¾ƒå­—ç¬¦ä¸²æ—¶ä½¿ç”¨å­—ç¬¦ä¸²è¯­ä¹‰, æ¯”è¾ƒæ•°å­—æ—¶ä½¿ç”¨æ•°å­—è¯­ä¹‰, æ¯”è¾ƒ Pair å¯¹è±¡æ—¶, å…ˆæ¯”è¾ƒé”®, å†æ¯”è¾ƒå€¼, ç­‰ç­‰ã€‚\nif $a eqv $b, then $a cmp $b always returns Order::Same. say (a =\u0026gt; 3) cmp (a =\u0026gt; 4); # Less say 4 cmp 4.0; # Same say \u0026#39;b\u0026#39; cmp \u0026#39;a\u0026#39;; # More infix leg proto sub infix:\u0026lt;leg\u0026gt;($a, $b) returns Order:D is assoc\u0026lt;none\u0026gt; multi sub infix:\u0026lt;leg\u0026gt;(Any, Any) multi sub infix:\u0026lt;leg\u0026gt;(Str:D, Str:D) å­—ç¬¦ä¸²ä¸‰è·¯æ¯”è¾ƒå™¨ã€‚leg æ˜¯ less, equal è¿˜æœ‰ greater çš„ç®€å†™å½¢å¼ï¼Ÿ\næŠŠä¸¤ä¸ªå‚æ•°éƒ½å¼ºè½¬ä¸º Str, ç„¶åæŒ‰ç…§å­—æ¯æ¬¡åºæ¯”è¾ƒã€‚\nsay \u0026#39;a\u0026#39; leg \u0026#39;b\u0026#39;; Less say \u0026#39;a\u0026#39; leg \u0026#39;a\u0026#39;; Same say \u0026#39;b\u0026#39; leg \u0026#39;a\u0026#39;; More infix \u0026lt;=\u0026gt; multi sub infix:Â«\u0026lt;=\u0026gt;Â»($a, $b) returns Order:D is assoc\u0026lt;none\u0026gt; Numeric ä¸‰è·¯æ¯”è¾ƒå™¨ã€‚\næŠŠä¸¤ä¸ªå‚æ•°å¼ºè½¬ä¸º Real, å¹¶æ‰§è¡Œæ•°å€¼æ¯”è¾ƒã€‚\ninfix .. multi sub infix:\u0026lt;..\u0026gt;($a, $b) returns Range:D is assoc\u0026lt;none\u0026gt; ç”±å‚æ•°åˆ›å»ºä¸€ä¸ª Rangeã€‚\ninfix ..^ multi sub infix:\u0026lt;..^\u0026gt;($a, $b) returns Range:D is assoc\u0026lt;none\u0026gt; ç”±å‚æ•°åˆ›å»ºä¸€ä¸ª Range, ä¸åŒ…å«æœ«ç«¯ã€‚\ninfix ^.. multi sub infix:\u0026lt;^..\u0026gt;($a, $b) returns Range:D is assoc\u0026lt;none\u0026gt; ç”±å‚æ•°åˆ›å»ºä¸€ä¸ª Range, ä¸åŒ…å«å¼€å§‹ç«¯ç‚¹ã€‚\ninfix ^..^ multi sub infix:\u0026lt;^..^\u0026gt;($a, $b) returns Range:D is assoc\u0026lt;none\u0026gt; ç”±å‚æ•°åˆ›å»ºä¸€ä¸ª Range, ä¸åŒ…å«å¼€ç«¯å’Œæœ«ç«¯ã€‚\nChaining Binary Precedence infix == proto sub infix:\u0026lt;==\u0026gt;($, $) returns Bool:D is assoc:\u0026lt;chain\u0026gt; multi sub infix:\u0026lt;==\u0026gt;(Any, Any) multi sub infix:\u0026lt;==\u0026gt;(Int:D, Int:D) multi sub infix:\u0026lt;==\u0026gt;(Num:D, Num:D) multi sub infix:\u0026lt;==\u0026gt;(Rational:D, Rational:D) multi sub infix:\u0026lt;==\u0026gt;(Real:D, Real:D) multi sub infix:\u0026lt;==\u0026gt;(Complex:D, Complex:D) multi sub infix:\u0026lt;==\u0026gt;(Numeric:D, Numeric:D) å¼ºè½¬ä¸¤ä¸ªå‚æ•°ä¸º Numericï¼ˆå¦‚æœå¿…è¦ï¼‰, å¹¶\u0008è¿”å› True å¦‚æœå®ƒä»¬ç›¸ç­‰ã€‚\ninfix != proto sub infix:\u0026lt;!=\u0026gt;(Mu, Mu) returns Bool:D is assoc\u0026lt;chain\u0026gt; å¼ºè½¬ä¸¤ä¸ªå‚æ•°ä¸º Numericï¼ˆå¦‚æœå¿…è¦ï¼‰, å¹¶\u0008è¿”å› True å¦‚æœå®ƒä»¬ä¸ç›¸ç­‰ã€‚\ninfix \u0026lt; proto sub infix:Â«\u0026lt;Â»(Any, Any) returns Bool:D is assoc\u0026lt;chain\u0026gt; multi sub infix:Â«\u0026lt;Â»(Int:D, Int:D) multi sub infix:Â«\u0026lt;Â»(Num:D, Num:D) multi sub infix:Â«\u0026lt;Â»(Real:D, Real:D) å¼ºè½¬ä¸¤ä¸ªå‚æ•°ä¸º Real ï¼ˆå¦‚æœå¿…è¦ï¼‰, å¹¶è¿”å› True å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°å°äºç¬¬äºŒä¸ªå‚æ•°ã€‚\ninfix \u0026lt;= proto sub infix:Â«\u0026lt;=Â»(Any, Any) returns Bool:D is assoc\u0026lt;chain\u0026gt; multi sub infix:Â«\u0026lt;=Â»(Int:D, Int:D) multi sub infix:Â«\u0026lt;=Â»(Num:D, Num:D) multi sub infix:Â«\u0026lt;=Â»(Real:D, Real:D) å¼ºè½¬ä¸¤ä¸ªå‚æ•°ä¸º Real ï¼ˆå¦‚æœå¿…è¦ï¼‰, å¹¶è¿”å› True å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°å°äºç¬¬äºŒä¸ªå‚æ•°ã€‚\ninfix \u0026gt; proto sub infix:Â«\u0026gt;Â»(Any, Any) returns Bool:D is assoc\u0026lt;chain\u0026gt; multi sub infix:Â«\u0026gt;Â»(Int:D, Int:D) multi sub infix:Â«\u0026gt;Â»(Num:D, Num:D) multi sub infix:Â«\u0026gt;Â»(Real:D, Real:D) å¼ºè½¬ä¸¤ä¸ªå‚æ•°ä¸º Real ï¼ˆå¦‚æœå¿…è¦ï¼‰, å¹¶è¿”å› True å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°å¤§äºç¬¬äºŒä¸ªå‚æ•°ã€‚\ninfix \u0026gt;= proto sub infix:Â«\u0026gt;=Â»(Any, Any) returns Bool:D is assoc\u0026lt;chain\u0026gt; multi sub infix:Â«\u0026gt;=Â»(Int:D, Int:D) multi sub infix:Â«\u0026gt;=Â»(Num:D, Num:D) multi sub infix:Â«\u0026gt;=Â»(Real:D, Real:D) å¼ºè½¬ä¸¤ä¸ªå‚æ•°ä¸º Real ï¼ˆå¦‚æœå¿…è¦ï¼‰, å¹¶è¿”å› True å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°å¤§äºæˆ–ç­‰äºç¬¬äºŒä¸ªå‚æ•°ã€‚\ninfix eq proto sub infix:\u0026lt;eq\u0026gt;(Any, Any) returns Bool:D is assoc\u0026lt;chain\u0026gt; multi sub infix:\u0026lt;eq\u0026gt;(Any, Any) multi sub infix:\u0026lt;eq\u0026gt;(Str:D, Str:D) å¼ºè½¬ä¸¤ä¸ªå‚æ•°ä¸º Strï¼ˆå¦‚æœå¿…è¦ï¼‰, å¹¶è¿”å› True å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ç­‰äºç¬¬äºŒä¸ªå‚æ•°ã€‚\nåŠ©è®°æ³•: equal\ninfix ne proto sub infix:\u0026lt;ne\u0026gt;(Mu, Mu) returns Bool:D is assoc\u0026lt;chain\u0026gt; multi sub infix:\u0026lt;ne\u0026gt;(Mu, Mu) multi sub infix:\u0026lt;ne\u0026gt;(Str:D, Str:D) å¼ºè½¬ä¸¤ä¸ªå‚æ•°ä¸º Strï¼ˆå¦‚æœå¿…è¦ï¼‰, å¹¶è¿”å› False å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°ç­‰äºç¬¬äºŒä¸ªå‚æ•°ã€‚\nåŠ©è®°æ³•: not equal\ninfix gt proto sub infix:\u0026lt;gt\u0026gt;(Mu, Mu) returns Bool:D is assoc\u0026lt;chain\u0026gt; multi sub infix:\u0026lt;gt\u0026gt;(Mu, Mu) multi sub infix:\u0026lt;gt\u0026gt;(Str:D, Str:D) å¼ºè½¬ä¸¤ä¸ªå‚æ•°ä¸º Strï¼ˆå¦‚æœå¿…è¦ï¼‰, å¹¶è¿”å› True å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°å¤§äºç¬¬äºŒä¸ªå‚æ•°ã€‚\nåŠ©è®°æ³•: greater than\ninfix ge proto sub infix:\u0026lt;ge\u0026gt;(Mu, Mu) returns Bool:D is assoc\u0026lt;chain\u0026gt; multi sub infix:\u0026lt;ge\u0026gt;(Mu, Mu) multi sub infix:\u0026lt;ge\u0026gt;(Str:D, Str:D) å¼ºè½¬ä¸¤ä¸ªå‚æ•°ä¸º Strï¼ˆå¦‚æœå¿…è¦ï¼‰, å¹¶è¿”å› True å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°å¤§äºç¬¬äºŒä¸ªå‚æ•°ã€‚\nåŠ©è®°æ³•: greater or equal\ninfix lt proto sub infix:\u0026lt;lt\u0026gt;(Mu, Mu) returns Bool:D is assoc\u0026lt;chain\u0026gt; multi sub infix:\u0026lt;lt\u0026gt;(Mu, Mu) multi sub infix:\u0026lt;lt\u0026gt;(Str:D, Str:D) å¼ºè½¬ä¸¤ä¸ªå‚æ•°ä¸º Strï¼ˆå¦‚æœå¿…è¦ï¼‰, å¹¶è¿”å› True å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°å°äºç¬¬äºŒä¸ªå‚æ•°ã€‚\nåŠ©è®°æ³•: less than\ninfix le proto sub infix:\u0026lt;le\u0026gt;(Mu, Mu) returns Bool:D is assoc\u0026lt;chain\u0026gt; multi sub infix:\u0026lt;le\u0026gt;(Mu, Mu) multi sub infix:\u0026lt;le\u0026gt;(Str:D, Str:D) å¼ºè½¬ä¸¤ä¸ªå‚æ•°ä¸º Strï¼ˆå¦‚æœå¿…è¦ï¼‰, å¹¶è¿”å› True å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°å°äºæˆ–ç­‰äºç¬¬äºŒä¸ªå‚æ•°ã€‚\nåŠ©è®°æ³•: less or equal\ninfix before proto sub infix:\u0026lt;before\u0026gt;(Any, Any) returns Bool:D is assoc\u0026lt;chain\u0026gt; multi sub infix:\u0026lt;before\u0026gt;(Any, Any) multi sub infix:\u0026lt;before\u0026gt;(Real:D, Real:D) multi sub infix:\u0026lt;before\u0026gt;(Str:D, Str:D) multi sub infix:\u0026lt;before\u0026gt;(Enum:D, Enum:D) multi sub infix:\u0026lt;before\u0026gt;(Version:D, Version:D) ä¸€èˆ¬çš„æ’åº, ä½¿ç”¨\u0008å’Œ cmp ç›¸åŒçš„è¯­ä¹‰ã€‚å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°å°äºç¬¬äºŒä¸ªå‚æ•°åˆ™è¿”å› Trueã€‚\ninfix after proto sub infix:\u0026lt;after\u0026gt;(Any, Any) returns Bool:D is assoc\u0026lt;chain\u0026gt; multi sub infix:\u0026lt;after\u0026gt;(Any, Any) multi sub infix:\u0026lt;after\u0026gt;(Real:D, Real:D) multi sub infix:\u0026lt;after\u0026gt;(Str:D, Str:D) multi sub infix:\u0026lt;after\u0026gt;(Enum:D, Enum:D) multi sub infix:\u0026lt;after\u0026gt;(Version:D, Version:D) ä¸€èˆ¬çš„æ’åº, ä½¿ç”¨\u0008å’Œ cmp ç›¸åŒçš„è¯­ä¹‰ã€‚å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°å¤§äºç¬¬äºŒä¸ªå‚æ•°åˆ™è¿”å› Trueã€‚\ninfix eqv proto sub infix:\u0026lt;eqv\u0026gt;(Any, Any) returns Bool:D is assoc\u0026lt;chain\u0026gt; proto sub infix:\u0026lt;eqv\u0026gt;(Any, Any) ç­‰å€¼æ“ä½œç¬¦ã€‚å¦‚æœä¸¤ä¸ªå‚æ•°åœ¨ç»“æ„ä¸Šç›¸åŒå°±è¿”å› Trueã€‚ä¾‹å¦‚, ç›¸åŒç±»å‹ï¼ˆå¹¶ä¸”é€’å½’ï¼‰åŒ…å«ç›¸åŒçš„å€¼ã€‚\nsay [1, 2, 3] eqv [1, 2, 3]; # True say Any eqv Any; # True say 1 eqv 2; # False say 1 eqv 1.0; # False å¯¹äºä»»æ„å¯¹è±¡ä½¿ç”¨é»˜è®¤çš„ eqv æ“ä½œæ˜¯ä¸å¯èƒ½çš„ã€‚ä¾‹å¦‚, eqv ä¸è®¤ä¸ºåŒä¸€å¯¹è±¡çš„ä¸¤ä¸ªå®ä¾‹åœ¨ç»“æ„ä¸Šæ˜¯ç›¸ç­‰çš„ï¼š\nclass A { has $.a; } say A.new(a =\u0026gt; 5) eqv A.new(a =\u0026gt; 5); #=\u0026gt;False è¦å¾—åˆ°è¿™ä¸ªç±»çš„å¯¹è±¡ç›¸ç­‰ï¼ˆeqvï¼‰è¯­ä¹‰, éœ€è¦å®ç°ä¸€ä¸ªåˆé€‚çš„ä¸­ç¼€ eqv æ“ä½œç¬¦ï¼š\nclass A { has $.a; } multi infix:\u0026lt;eqv\u0026gt;(A $l, A $r) { $l.a eqv $r.a } say A.new(a =\u0026gt; 5) eqv A.new(a =\u0026gt; 5); #=\u0026gt;True infix === proto sub infix:\u0026lt;===\u0026gt;(Any, Any) returns Bool:D is assoc\u0026lt;chain\u0026gt; proto sub infix:\u0026lt;===\u0026gt;(Any, Any) å€¼ç›¸ç­‰ã€‚å¦‚æœä¸¤ä¸ªå‚æ•°éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡åˆ™è¿”å› Trueã€‚\nclass A { }; my $a = A.new; say $a === $a; # True say A.new === A.new; # False say A === A; # True å¯¹äºå€¼çš„ç±»å‹, === è¡¨ç°çš„å’Œ eqv ä¸€æ ·:\nsay \u0026#39;a\u0026#39; === \u0026#39;a\u0026#39;; # True say \u0026#39;a\u0026#39; === \u0026#39;b\u0026#39;; # False # different types say 1 === 1.0; # False === ä½¿ç”¨ WHICH æ–¹æ³•æ¥è·å–å¯¹è±¡ç›¸ç­‰, æ‰€ä»¥æ‰€æœ‰çš„å€¼ç±»å‹å¿…é¡»é‡å†™æ–¹æ³• WHICHã€‚\ninfix =:= proto sub infix:\u0026lt;=:=\u0026gt;(Mu \\a, Mu \\b) returns Bool:D is assoc\u0026lt;chain\u0026gt; multi sub infix:\u0026lt;=:=\u0026gt;(Mu \\a, Mu \\b) å®¹å™¨ç›¸ç­‰ã€‚è¿”å› True å¦‚æœä¸¤ä¸ªå‚æ•°éƒ½ç»‘å®šåˆ°åŒä¸€ä¸ªå®¹å™¨ä¸Šã€‚å¦‚æœå®ƒè¿”å› True, é‚£é€šå¸¸æ„å‘³ç€ä¿®æ”¹ä¸€ä¸ªå‚æ•°ä¹Ÿä¼šåŒæ—¶ä¿®æ”¹å¦å¤–ä¸€ä¸ªã€‚\nmy ($a, $b) = (1, 3); say $a =:= $b; # False $b = 2; say $a; # 1 $b := $a; say $a =:= $b; # True $a = 5; say $b; # 5 infix ~~ æ™ºèƒ½åŒ¹é…æ“ä½œç¬¦ã€‚æŠŠå·¦ä¾§å‚æ•°èµ·åˆ«åä¸º $_ , ç„¶åè®¡ç®—å³ä¾§çš„å€¼, å¹¶åœ¨å®ƒèº«ä¸Šè°ƒç”¨ .ACCEPTS($_) ã€‚åŒ¹é…çš„è¯­ä¹‰ç”±å³ä¾§æ“ä½œæ•°çš„ç±»å‹å†³å®šã€‚\nè¿™å„¿æœ‰ä¸€ä¸ªå†…å»ºæ™ºèƒ½åŒ¹é…å‡½æ•°çš„æ‘˜è¦ï¼š\nå³ä¾§ æ¯”è¾ƒè¯­ä¹‰ Mu:U\tç±»å‹æ£€æŸ¥ Str\tå­—ç¬¦ä¸²ç›¸ç­‰ Numeric\tæ•°å€¼ç›¸ç­‰ Regex\tæ­£åˆ™åŒ¹é… Callable è°ƒç”¨çš„å¸ƒå°”ç»“æœ Any:D\tå¯¹è±¡ç›¸ç­‰ Tight AND Precedence infix \u0026amp;\u0026amp; åœ¨å¸ƒå°”ä¸Šä¸‹æ–‡ä¸­è¿”å›ç¬¬ä¸€ä¸ªæ±‚å€¼ä¸º False çš„å‚æ•°, å¦åˆ™è¿”å›æœ€åä¸€ä¸ªå‚æ•°ã€‚\næ³¨æ„è¿™æ˜¯çŸ­è·¯æ“ä½œç¬¦, å¦‚æœå…¶ä¸­çš„ä¸€ä¸ªå‚æ•°è®¡ç®—ä¸º false å€¼, é‚£ä¹ˆè¯¥å‚æ•°å³ä¾§çš„å€¼ç»ä¸ä¼šè¢«è®¡ç®—ã€‚\nsub a { 1 } sub b { 0 } sub c { die \u0026#34;never called\u0026#34; }; say a() \u0026amp;\u0026amp; b() \u0026amp;\u0026amp; c(); # 0 Tight OR Precedence infix || åœ¨å¸ƒå°”ä¸Šä¸‹æ–‡ä¸­è¿”å›ç¬¬ä¸€ä¸ªæ±‚å€¼ä¸º True çš„å‚æ•°, å¦åˆ™è¿”å›æœ€åä¸€ä¸ªå‚æ•°ã€‚\næ³¨æ„è¿™æ˜¯çŸ­è·¯æ“ä½œç¬¦, å¦‚æœå…¶ä¸­çš„ä¸€ä¸ªå‚æ•°è®¡ç®—ä¸º true å€¼, é‚£ä¹ˆè¯¥å‚æ•°å³ä¾§çš„å€¼ç»ä¸ä¼šè¢«è®¡ç®—ã€‚\nsub a { 0 } sub b { 1 } sub c { die \u0026#34;never called\u0026#34; }; say a() || b() || c(); # 1 infix ^^ è¿”å›ç¬¬ä¸€ä¸ªå€¼ä¸º true çš„å‚æ•°å¦‚æœåªæœ‰ä¸€ä¸ªçš„è¯, å¦åˆ™è¿”å› Nilã€‚åªè¦æ‰¾åˆ°ä¸¤ä¸ªå€¼ä¸º true çš„å‚æ•°å°±å‘ç”ŸçŸ­è·¯ã€‚\nsay 0 ^^ 42; # 42 say 0 ^^ 42 ^^ 1 ^^ die 8; # (empty line) æ³¨æ„, è¿™ä¸ªæ“ä½œç¬¦çš„è¯­ä¹‰å¯èƒ½ä¸æ˜¯ä½ å‡æƒ³çš„é‚£æ ·ï¼š infix ^^ ç¿»åˆ°å®ƒæ‰¾åˆ°çš„ç¬¬ä¸€ä¸ª true å€¼, æ‰¾åˆ°ç¬¬äºŒä¸ª true å€¼åæ°¸è¿œåœ°åè½¬ä¸º Nil å€¼, ä¸ç®¡è¿˜æœ‰å¤šå°‘ true å€¼ã€‚ï¼ˆæ¢å¥è¯è¯´, å®ƒçš„è¯­ä¹‰æ˜¯\u0026quot;æ‰¾åˆ°ä¸€ä¸ªçœŸå€¼\u0026quot;, è€Œä¸æ˜¯å¸ƒå°”èµ·å¥‡å¶æ ¡éªŒè¯­ä¹‰ï¼‰\ninfix // Defined-or æ“ä½œç¬¦ã€‚è¿”å›ç¬¬ä¸€ä¸ªå®šä¹‰äº†çš„æ“ä½œæ•°, å¦åˆ™è¿”å›æœ€åä¸€ä¸ªæ“ä½œæ•°ã€‚çŸ­è·¯æ“ä½œç¬¦ã€‚\nsay Any // 0 // 42; # 0 infix min è¿”å›å‚æ•°çš„æœ€å°å€¼ã€‚è¯­ä¹‰ç”± cmp è¯­ä¹‰å†³å®šã€‚\n$foo min= 0 # read as: $foo decreases to 0 infix max è¿”å›å‚æ•°çš„æœ€å¤§å€¼ã€‚\n$foo max= 0 # read as: $foo increases to 0 Conditional Operator Precedence infix ?? !! ä¸‰ç›®æ“ä½œç¬¦, æ¡ä»¶æ“ä½œç¬¦ã€‚\n$condition ?? $true !! $false è®¡ç®—å¹¶è¿”å› $true è¡¨è¾¾å¼, å¦‚æœ $condition ä¸ºçœŸçš„è¯ã€‚å¦åˆ™è®¡ç®—å¹¶è¿”å› $false åˆ†æ”¯ã€‚\ninfix ff sub infix:\u0026lt;ff\u0026gt;(Mu $a, Mu $b) è§¦å‘å™¨æ“ä½œç¬¦ã€‚\næŠŠä¸¤ä¸ªå‚æ•°éƒ½è·Ÿ $_ è¿›è¡Œæ¯”è¾ƒï¼ˆå³, $_ ~~ $a å’Œ $_ ~~ $bï¼‰ã€‚æ±‚å€¼ä¸º False ç›´åˆ°å·¦ä¾§çš„æ™ºèƒ½åŒ¹é…ä¸ºçœŸ, è¿™æ—¶, å®ƒæ±‚å€¼ä¸ºçœŸ, ç›´åˆ°å³ä¾§çš„æ™ºèƒ½åŒ¹é…ä¸ºçœŸã€‚\nå®é™…ä¸Š, å·¦è¾¹çš„å‚æ•°æ˜¯\u0026quot;å¼€å§‹â€æ¡ä»¶, å³ä¾§çš„å‚æ•°æ˜¯â€åœæ­¢â€ æ¡ä»¶ã€‚è¿™ç§ç»“æ„ä¸€èˆ¬ç”¨äºæ”¶é›†åªåœ¨ç‰¹å®šåŒºåŸŸçš„è¡Œã€‚ä¾‹å¦‚ï¼š\nmy $excerpt = q:to/END/;Here\u0026#39;s some unimportant text. =begin code This code block is what we\u0026#39;re after. We\u0026#39;ll use \u0026#39;ff\u0026#39; to get it. =end code More unimportant text. END my @codelines = gather for $excerpt.lines { take $_ if \u0026#34;=begin code\u0026#34; ff \u0026#34;=end code\u0026#34; } # this will print four lines, # starting with \u0026#34;=begin code\u0026#34; and ending with \u0026#34;=end code\u0026#34; say @codelines.join(\u0026#34;\\n\u0026#34;); åŒ¹é…å¼€å§‹æ¡ä»¶ä¹‹å, æ“ä½œç¬¦ä¼šç»§ç»­å°†åœæ­¢æ¡ä»¶ä¸ $_ è¿›è¡ŒåŒ¹é…, å¦‚æœæˆåŠŸå°±åšç›¸åº”åœ°è¡¨ç°ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­, åªæœ‰ç¬¬ä¸€ä¸ªå…ƒç´ è¢«æ‰“å°äº†ï¼š\nfor \u0026lt;AB C D B E F\u0026gt; { say $_ if /A/ ff /B/; # prints only \u0026#34;AB\u0026#34; } å¦‚æœä½ æƒ³æµ‹è¯•å¼€å§‹æ¡ä»¶, å¹¶ä¸”æ²¡æœ‰ç»“æŸæ¡ä»¶, * èƒ½ç”¨ä½œ â€œåœæ­¢â€ æ¡ä»¶ã€‚\nfor \u0026lt;A B C D E\u0026gt; { say $_ if /C/ ff *; # prints C, D, and E } å¯¹äº sed-like ç‰ˆæœ¬, åœ¨å¼€å§‹æ¡ä»¶åŒ¹é…æˆåŠŸä¹‹å, å®ƒä¸ä¼šä½¿ç”¨åœæ­¢æ¡ä»¶ä¸ $_ è¿›è¡ŒåŒ¹é…ã€‚\nè¿™ä¸ªæ“ä½œç¬¦ä¸èƒ½è¢«é‡è½½, å› ä¸ºå®ƒè¢«ç¼–è¯‘å™¨ç‰¹æ®Šå¤„ç†è¿‡ã€‚\ninfix ^ff sub infix:\u0026lt;^ff\u0026gt;(Mu $a, Mu $b) åƒ ff é‚£æ ·å·¥ä½œ, é™¤äº†å®ƒä¸ä¼šåœ¨æ¡ç›®åŒ¹é…å¼€å§‹æ¡ä»¶æ—¶è¿”å›çœŸã€‚ï¼ˆåŒ…æ‹¬åŒ¹é…åœæ­¢æ¡ä»¶çš„æ¡ç›®ï¼‰\nä¸€ä¸ªæ¯”è¾ƒ:\nmy @list = \u0026lt;A B C\u0026gt;; say $_ if /A/ ff /C/ for @list; # prints A, B, and C say $_ if /A/ ^ff /C/ for @list; # prints B and C è¿™ä¸ªæ“ä½œç¬¦ä¸èƒ½è¢«é‡è½½, å› ä¸ºå®ƒè¢«ç¼–è¯‘å™¨ç‰¹æ®Šå¤„ç†è¿‡ã€‚\ninfix ff^ sub infix:\u0026lt;ff^\u0026gt;(Mu $a, Mu $b) åƒ ff é‚£æ ·å·¥ä½œ, é™¤äº†å®ƒä¸ä¼šåœ¨æ¡ç›®åŒ¹é…åœæ­¢æ¡ä»¶æ—¶è¿”å›çœŸã€‚ï¼ˆåŒ…æ‹¬ç¬¬ä¸€æ¬¡åŒ¹é…å¼€å§‹æ¡ä»¶çš„æ¡ç›®ï¼‰\nmy @list = \u0026lt;A B C\u0026gt;; say $_ if /A/ ff /C/ for @list; # prints A, B, and C say $_ if /A/ ff^ /C/ for @list; # prints A and B è¿™ä¸ªæ“ä½œç¬¦ä¸èƒ½è¢«é‡è½½, å› ä¸ºå®ƒè¢«ç¼–è¯‘å™¨ç‰¹æ®Šå¤„ç†è¿‡ã€‚\ninfix ^ff^ sub infix:\u0026lt;^ff^\u0026gt;(Mu $a, Mu $b) åƒ ff é‚£æ ·å·¥ä½œ, é™¤äº†å®ƒä¸ä¼šåœ¨æ¡ç›®åŒ¹é…åœæ­¢æ¡ä»¶æ—¶è¿”å›çœŸ, ä¹Ÿä¸ä¼šåœ¨æ¡ç›®åŒ¹é…å¼€å§‹æ—¶è¿”å›çœŸã€‚ï¼ˆæˆ–è€…ä¸¤è€…ï¼‰\nmy @list = \u0026lt;A B C\u0026gt;; say $_ if /A/ ff /C/ for @list; # prints A, B, and C say $_ if /A/ ^ff^ /C/ for @list; # prints B è¿™ä¸ªæ“ä½œç¬¦ä¸èƒ½è¢«é‡è½½, å› ä¸ºå®ƒè¢«ç¼–è¯‘å™¨ç‰¹æ®Šå¤„ç†è¿‡ã€‚\ninfix fff sub infix:\u0026lt;fff\u0026gt;(Mu $a, Mu $b) æ‰§è¡Œ sed-like é‚£æ ·çš„ flipflop æ“ä½œ, åœ¨å…¶ä¸­, å®ƒè¿”å› False ç›´åˆ°å·¦ä¾§çš„å‚æ•°ä¸ $_ æ™ºèƒ½åŒ¹é…, å¹¶ä¸”åœ¨é‚£ä¹‹åè¿”å› True ç›´åˆ°å³ä¾§çš„å‚æ•°å’Œ $_ æ™ºèƒ½åŒ¹é…ã€‚\nåƒ ff é‚£æ ·å·¥ä½œ, é™¤äº†å®ƒæ¯æ¬¡è°ƒç”¨åªå°è¯•ä¸€ä¸ªå‚æ•°ä¹‹å¤–ã€‚å³, å¦‚æœ $_ å’Œå·¦ä¾§çš„å‚æ•°æ™ºèƒ½åŒ¹é…, fff éšåä¸ä¼šå°è¯•å°†åŒä¸€ä¸ª $_ å’Œå³ä¾§çš„å‚æ•°è¿›è¡ŒåŒ¹é…ã€‚\nfor \u0026lt;AB C D B E F\u0026gt; { say $_ if /A/ fff /B/; # Prints \u0026#34;AB\u0026#34;, \u0026#34;C\u0026#34;, \u0026#34;D\u0026#34;, and \u0026#34;B\u0026#34; } å¯¹äº non-sed-like ç‰ˆæœ¬, æŸ¥çœ‹ ff.\nè¿™ä¸ªæ“ä½œç¬¦ä¸èƒ½è¢«é‡è½½, å› ä¸ºå®ƒè¢«ç¼–è¯‘å™¨ç‰¹æ®Šå¤„ç†è¿‡ã€‚\ninfix ^fff sub infix:\u0026lt;^fff\u0026gt;(Mu $a, Mu $b) åƒ fff é‚£æ ·, é™¤äº†å®ƒå¯¹äºå·¦ä¾§çš„åŒ¹é…ä¸è¿”å›çœŸä¹‹å¤–ã€‚\nmy @list = \u0026lt;A B C\u0026gt;; say $_ if /A/ fff /C/ for @list; # prints A, B, and C say $_ if /A/ ^fff /C/ for @list; # prints B and C å¯¹äº non-sed ç‰ˆæœ¬, æŸ¥çœ‹ ^ffã€‚\nè¿™ä¸ªæ“ä½œç¬¦ä¸èƒ½è¢«é‡è½½, å› ä¸ºå®ƒè¢«ç¼–è¯‘å™¨ç‰¹æ®Šå¤„ç†è¿‡ã€‚\ninfix fff^ sub infix:\u0026lt;fff^\u0026gt;(Mu $a, Mu $b) åƒ fff é‚£æ ·, é™¤äº†å®ƒå¯¹äºå³ä¾§çš„åŒ¹é…ä¸è¿”å›çœŸä¹‹å¤–ã€‚\nmy @list = \u0026lt;A B C\u0026gt;; say $_ if /A/ fff /C/ for @list; # prints A, B, and C say $_ if /A/ fff^ /C/ for @list; # prints A and B å¯¹äº non-sed ç‰ˆæœ¬, æŸ¥çœ‹ ff^ã€‚\nè¿™ä¸ªæ“ä½œç¬¦ä¸èƒ½è¢«é‡è½½, å› ä¸ºå®ƒè¢«ç¼–è¯‘å™¨ç‰¹æ®Šå¤„ç†è¿‡ã€‚\ninfix ^fff^ sub infix:\u0026lt;^fff^\u0026gt;(Mu $a, Mu $b) åƒ fff é‚£æ ·, é™¤äº†å®ƒå¯¹äºå·¦ä¾§å’Œå³ä¾§çš„åŒ¹é…éƒ½ä¸è¿”å›çœŸä¹‹å¤–ã€‚\nmy @list = \u0026lt;A B C\u0026gt;; say $_ if /A/ fff /C/ for @list; # prints A, B, and C say $_ if /A/ ^fff^ /C/ for @list; # prints B å¯¹äº non-sed ç‰ˆæœ¬, æŸ¥çœ‹ ^ff^.\nè¿™ä¸ªæ“ä½œç¬¦ä¸èƒ½è¢«é‡è½½, å› ä¸ºå®ƒè¢«ç¼–è¯‘å™¨ç‰¹æ®Šå¤„ç†è¿‡ã€‚\nItem Assignment Precedence infix = sub infix:\u0026lt;=\u0026gt;(Mu $a is rw, Mu $b) Item èµ‹å€¼ã€‚\næŠŠ = å·å³ä¾§çš„å€¼æ”¾å…¥å·¦ä¾§çš„å®¹å™¨ä¸­ã€‚å®ƒçœŸæ­£çš„è¯­ä¹‰æ˜¯ç”±å·¦ä¾§çš„å®¹å™¨ç±»å‹å†³å®šçš„ã€‚\nï¼ˆæ³¨æ„ item èµ‹å€¼å’Œåˆ—è¡¨èµ‹å€¼çš„ä¼˜å…ˆçº§çº§åˆ«ä¸åŒ, å¹¶ä¸”ç­‰å·å·¦ä¾§çš„è¯­æ³•å†³å®šäº†ç­‰å·æ˜¯è¢«è§£æä¸º item èµ‹å€¼è¿˜æ˜¯åˆ—è¡¨èµ‹å€¼æ“ä½œç¬¦ï¼‰ã€‚\ninfix =\u0026gt; sub infix:Â«=\u0026gt;Â»($key, Mu $value) returns Pair:D Pair æ„é€ å™¨ã€‚\nä½¿ç”¨å·¦ä¾§å€¼ä½œä¸ºé”®, å³ä¾§å€¼ä½œä¸ºå€¼, æ„é€ ä¸€ä¸ª Pair å¯¹è±¡ã€‚\næ³¨æ„ =\u0026gt; æ“ä½œç¬¦æ˜¯è¯­æ³•ä¸Šçš„ç‰¹ä¾‹, åœ¨è¿™ä¸ªç»“æ„ä¸­, å®ƒå…è®¸å·¦ä¾§æ˜¯ä¸€ä¸ªæœªè¢«å¼•èµ·çš„æ ‡è¯†ç¬¦ã€‚\nmy $p = a =\u0026gt; 1; say $p.key; # a say $p.value; # 1 åœ¨å‚æ•°åˆ—è¡¨ä¸­, åœ¨ =\u0026gt; å·¦ä¾§ä½¿ç”¨æœªè¢«å¼•èµ·çš„æ ‡è¯†ç¬¦æ„å»ºçš„ Pair ä¼šè¢«è§£é‡Šä¸ºä¸€ä¸ªå…·åå‚æ•°ã€‚\næŸ¥çœ‹ Terms è¯­è¨€æ–‡æ¡£äº†è§£æ›´å¤šåˆ›å»º Pair å¯¹è±¡çš„æ–¹å¼ã€‚\nLoose Unary Precedence prefix not multi sub prefix:\u0026lt;not\u0026gt;(Mu $x) returns Bool:D åœ¨å¸ƒå°”ä¸Šä¸‹æ–‡ä¸­è®¡ç®—å®ƒçš„å‚æ•°ï¼ˆå› æ­¤ä½¿ Junctions å¤±æ•ˆï¼‰, å¹¶è¿”å›å¦å®šçš„ç»“æœã€‚\nprefix so multi sub prefix:\u0026lt;so\u0026gt;(Mu $x) returns Bool:D åœ¨å¸ƒå°”ä¸Šä¸‹æ–‡ä¸­è®¡ç®—å®ƒçš„å‚æ•°ï¼ˆå› æ­¤ä½¿ Junctions å¤±æ•ˆï¼‰, å¹¶è¿”å›ç»“æœã€‚\né€—å·æ“ä½œç¬¦ä¼˜å…ˆçº§ infix : å°±åƒä¸­ç¼€æ“ä½œç¬¦ , é‚£æ ·, : ç”¨ä½œå‚æ•°åˆ†éš”ç¬¦, å¹¶æŠŠå®ƒå·¦ä¾§çš„å‚æ•°æ ‡è®°ä¸ºè°ƒç”¨è€…ã€‚\né‚£ä¼šæŠŠå‡½æ•°è°ƒç”¨è½¬ä¸ºæ–¹æ³•è°ƒç”¨ã€‚\nsubstr(\u0026#39;abc\u0026#39;: 1); # same as \u0026#39;abc\u0026#39;.substr(1) Infix : åªå…è®¸å‡ºç°åœ¨éæ–¹æ³•è°ƒç”¨çš„ç¬¬ä¸€ä¸ªå‚æ•°åé¢ã€‚åœ¨å…¶å®ƒä½ç½®å®ƒä¼šæ˜¯è¯­æ³•é”™è¯¯ã€‚\nList Infix Precedence infix Z sub infix:\u0026lt;Z\u0026gt;(**@lists) returns List:D is assoc\u0026lt;chain\u0026gt; Zip operatorã€‚\nZ åƒä¸€ä¸ªæ‹‰é“¾é‚£æ ·æŠŠåˆ—è¡¨æ’å…¥è¿›æ¥, åªè¦ç¬¬ä¸€ä¸ªè¾“å…¥åˆ—è¡¨è€—å°½å°±åœæ­¢ï¼š\nsay (1, 2 Z \u0026lt;a b c\u0026gt; Z \u0026lt;+ -\u0026gt;).raku; # ((1, \u0026#34;a\u0026#34;, \u0026#34;+\u0026#34;), (2, \u0026#34;b\u0026#34;, \u0026#34;-\u0026#34;)).list Z æ“ä½œç¬¦ä¹Ÿä½œä¸ºå…ƒæ“ä½œç¬¦å­˜åœ¨ï¼š\nsay 100, 200 Z+ 42, 23; # 142, 223 say 1..3 Z~ \u0026lt;a b c\u0026gt; Z~ \u0026#39;x\u0026#39; xx 3; # 1ax 2bx 3cx infix X sub infix:\u0026lt;X\u0026gt;(**@lists) returns List:D is assoc\u0026lt;chain\u0026gt; ä»æ‰€æœ‰åˆ—è¡¨åˆ›å»ºä¸€ä¸ªå¤–ç§¯ã€‚æœ€å³è¾¹çš„å…ƒç´ å˜åŒ–å¾—æœ€è¿…é€Ÿã€‚\n1..3 X \u0026lt;a b c\u0026gt; X 9 # produces (1, \u0026#39;a\u0026#39;, 9), (1, \u0026#39;b\u0026#39;, 9), (1, \u0026#39;c\u0026#39;, 9), # (2, \u0026#39;a\u0026#39;, 9), (2, \u0026#39;b\u0026#39;, 9), (2, \u0026#39;c\u0026#39;, 9), # (3, \u0026#39;a\u0026#39;, 9), (3, \u0026#39;b\u0026#39;, 9), (3, \u0026#39;c\u0026#39;, 9) X æ“ä½œç¬¦ä¹Ÿå¯ä»¥ä½œä¸ºå…ƒæ“ä½œç¬¦ï¼š\n1..3 X~ \u0026lt;a b c\u0026gt; X~ 9 # produces \u0026#39;1a9\u0026#39;, \u0026#39;1b9\u0026#39;, \u0026#39;1c9\u0026#39;, \u0026#39;2a9\u0026#39;, \u0026#39;2b9\u0026#39;, \u0026#39;2c9\u0026#39;, \u0026#39;3a9\u0026#39;, \u0026#39;3b9\u0026#39;, \u0026#39;3c9\u0026#39; infix \u0026hellip; multi sub infix:\u0026lt;...\u0026gt;(**@) is assoc\u0026lt;list\u0026gt; multi sub infix:\u0026lt;...^\u0026gt;(**@) is assoc\u0026lt;list\u0026gt; åºåˆ—æ“ä½œç¬¦æ˜¯ä¸€ä¸ªç”¨äºäº§ç”Ÿæƒ°æ€§åˆ—è¡¨çš„æ™®é€šæ“ä½œç¬¦ã€‚\nå®ƒå¯ä»¥æœ‰ä¸€ä¸ªåˆå§‹å…ƒç´ å’Œä¸€ä¸ªç”Ÿæˆå™¨åœ¨ â€¦ çš„\u0008å·¦ä¾§, åœ¨å³ä¾§æ˜¯ä¸€ä¸ªç«¯ç‚¹ã€‚\nåºåˆ—æ“ä½œç¬¦ä¼šä½¿ç”¨å°½å¯èƒ½å¤šçš„å‚æ•°æ¥è°ƒç”¨ç”Ÿæˆå™¨ã€‚å‚æ•°ä¼šä»åˆå§‹å…ƒç´ å’Œå·²ç”Ÿæˆå…ƒç´ ä¸­è·å–ã€‚\né»˜è®¤çš„ç”Ÿæˆå™¨æ˜¯ *.succ æˆ– *.pred, å–å†³äºæœ«ç«¯æ€ä¹ˆæ¯”è¾ƒï¼š\nsay 1 ... 4; # 1 2 3 4 say 4 ... 1; # 4 3 2 1 say \u0026#39;a\u0026#39; ... \u0026#39;e\u0026#39;; # a b c d e say \u0026#39;e\u0026#39; ... \u0026#39;a\u0026#39;; # e d c b a * (Whatever) æœ«ç«¯ç”Ÿæˆä¸€ä¸ªæ— é™åºåˆ—, ä½¿ç”¨çš„æ˜¯é»˜è®¤çš„ç”Ÿæˆå™¨ *.succã€‚\nsay (1 ... *)[^5]; # 1 2 3 4 5 è‡ªå®šä¹‰ç”Ÿæˆå™¨æ˜¯åœ¨ â€¦ æ“ä½œç¬¦ä¹‹å‰çš„æœ€åä¸€ä¸ªå‚æ•°ã€‚ä¸‹é¢è¿™ä¸ªè‡ªå®šä¹‰ç”Ÿæˆå™¨æ¥æ”¶ä¸¤ä¸ªå‚æ•°, ç”Ÿæˆäº†æ–æ³¢çº³å¥‘æ•°ã€‚\nsay (1, 1, -\u0026gt; $a, $b { $a + $b } ... *)[^8]; # 1 1 2 3 5 8 13 21 # same but shorter say (1, 1, *+* ... *)[^8]; # 1 1 2 3 5 8 13 21 å½“ç„¶è‡ªå®šä¹‰ç”Ÿæˆå™¨ä¹Ÿèƒ½åªæ¥æ”¶ä¸€ä¸ªå‚æ•°ã€‚\nsay 5, { $_ * 2 } ... 40; # 5 10 20 40 ç”Ÿæˆå™¨çš„å‚æ•°ä¸ªæ•°è‡³å°‘è¦å’Œåˆå§‹å…ƒç´ çš„ä¸ªæ•°ä¸€æ ·å¤šã€‚\nå¦‚æœæ²¡æœ‰ç”Ÿæˆå™¨, å¹¶ä¸”æœ‰ä¸æ­¢ä¸€ä¸ªåˆå§‹å…ƒç´ , æ‰€æœ‰çš„åˆå§‹å…ƒç´ éƒ½æ˜¯æ•°å€¼, é‚£ä¹ˆåºåˆ—æ“ä½œç¬¦ä¼šå°è¯•æ¨å¯¼å‡ºç”Ÿæˆå™¨ã€‚å®ƒçŸ¥é“æ•°å­¦å’Œå‡ ä½•åºåˆ—ã€‚\nsay 2, 4, 6 ... 12; # 2 4 6 8 10 12 say 1, 2, 4 ... 32; # 1 2 4 8 16 32 å¦‚æœæœ«ç«¯ä¸æ˜¯ *, å®ƒä¼šå’Œæ¯ä¸ªç”Ÿæˆçš„å…ƒç´ è¿›è¡Œæ™ºèƒ½åŒ¹é…, å½“æ™ºèƒ½åŒ¹é…æˆåŠŸçš„æ—¶å€™åºåˆ—å°±è¢«ç»ˆæ­¢ã€‚å¯¹äº ... æ“ä½œç¬¦, ä¼šåŒ…å«æœ€åä¸€ä¸ªå…ƒç´ , å¯¹äº ...^ æ“ä½œç¬¦, ä¼šæ’é™¤æœ€åçš„é‚£ä¸ªå…ƒç´ ã€‚\nè¿™å…è®¸ä½ è¿™æ ·å†™ï¼š\nsay 1, 1, *+* ...^ *\u0026gt;= 100; æ¥ç”Ÿæˆæ‰€æœ‰ç›´åˆ° 100 ä½†ä¸åŒ…æ‹¬ 100 çš„æ–æ³¢çº³å¥‘æ•°ã€‚\n... æ“ä½œç¬¦è¿˜ä¼šæŠŠåˆå§‹å€¼çœ‹ä½œâ€å·²ç”Ÿæˆçš„å…ƒç´ â€, æ‰€ä»¥å®ƒä»¬ä¹Ÿä¼šå¯¹æœ«ç«¯è¿›è¡Œæ£€æŸ¥ï¼š\nmy $end = 4; say 1, 2, 4, 8, 16 ... $end; # outputs 1 2 4 List Prefix Precedence infix = åˆ—è¡¨èµ‹å€¼ã€‚ å®ƒçœŸæ­£çš„è¯­ä¹‰æ˜¯ç”±å·¦ä¾§çš„å®¹å™¨ç±»å‹å†³å®šçš„ã€‚æŸ¥çœ‹ Array å’Œ Hash è·å–æ™®é€šæ¡ˆä¾‹ã€‚\nitem èµ‹å€¼å’Œåˆ—è¡¨èµ‹å€¼çš„ä¼˜å…ˆçº§çº§åˆ«ä¸åŒ, å¹¶ä¸”ç­‰å·å·¦ä¾§çš„è¯­æ³•å†³å®šäº†ç­‰å·æ˜¯è¢«è§£æä¸º item èµ‹å€¼è¿˜æ˜¯åˆ—è¡¨èµ‹å€¼æ“ä½œç¬¦ã€‚\ninfix := ç»‘å®šã€‚è€Œ $x = $y æ˜¯æŠŠ $y ä¸­çš„å€¼æ”¾åˆ° $x é‡Œé¢, $x := $y ä¼šè®© $x å’Œ $y å¼•ç”¨åŒä¸€ä¸ªå€¼ã€‚\nmy $a = 42; my $b = $a; $b++; say $a; è¿™ä¼šè¾“å‡º 42, å› ä¸º $a å’Œ $b éƒ½åŒ…å«äº†æ•°å­— 42, ä½†æ˜¯å®¹å™¨æ˜¯ä¸åŒçš„ã€‚\nmy $a = 42; my $b := $a; $b++; say $a; è¿™ä¼šæ‰“å° 43, å› ä¸º $b å’Œ $a éƒ½ä»£è¡¨ç€åŒä¸€ä¸ªå¯¹è±¡ã€‚\ninfix ::= åªè¯»ç»‘å®š. æŸ¥çœ‹ infix :=.\nlistop \u0026hellip; è¿™æ˜¯ yada, yada, yada æ“ä½œç¬¦ æˆ– stub æ“ä½œç¬¦ã€‚å¦‚æœå®ƒåœ¨å­ä¾‹ç¨‹æˆ–ç±»å‹ä¸­æ˜¯å”¯ä¸€çš„è¯­å¥, å®ƒä¼šæŠŠå­ä¾‹ç¨‹æˆ–ç±»å‹æ ‡è®°ä¸º stubï¼ˆè¿™åœ¨é¢„å£°æ˜ç±»å‹å’Œç»„æˆ roles ä¸Šä¸‹æ–‡ä¸­æ˜¯æœ‰æ„ä¹‰çš„ï¼‰\nå¦‚æœ ... è¯­å¥è¢«æ‰§è¡Œäº†, å®ƒä¼šè°ƒç”¨ \u0026amp;fail , ä¼´éšç€é»˜è®¤çš„æ¶ˆæ¯ stub ä»£ç çš„æ‰§è¡Œã€‚\nlistop !!! å¦‚æœå®ƒåœ¨å­ä¾‹ç¨‹æˆ–ç±»å‹ä¸­æ˜¯å”¯ä¸€çš„è¯­å¥, å®ƒä¼šæŠŠå­ä¾‹ç¨‹æˆ–ç±»å‹æ ‡è®°ä¸º stubï¼ˆè¿™åœ¨é¢„å£°æ˜ç±»å‹å’Œç»„æˆ roles ä¸Šä¸‹æ–‡ä¸­æ˜¯æœ‰æ„ä¹‰çš„ï¼‰\nå¦‚æœ !!! è¯­å¥è¢«æ‰§è¡Œäº†, å®ƒä¼šè°ƒç”¨ \u0026amp;die , ä¼´éšç€é»˜è®¤çš„æ¶ˆæ¯ stub ä»£ç çš„æ‰§è¡Œã€‚\nlistop ??? å¦‚æœå®ƒåœ¨å­ä¾‹ç¨‹æˆ–ç±»å‹ä¸­æ˜¯å”¯ä¸€çš„è¯­å¥, å®ƒä¼šæŠŠå­ä¾‹ç¨‹æˆ–ç±»å‹æ ‡è®°ä¸º stubï¼ˆè¿™åœ¨é¢„å£°æ˜ç±»å‹å’Œç»„æˆ roles ä¸Šä¸‹æ–‡ä¸­æ˜¯æœ‰æ„ä¹‰çš„ï¼‰\nå¦‚æœ ??? è¯­å¥è¢«æ‰§è¡Œäº†, å®ƒä¼šè°ƒç”¨ \u0026amp;warn , ä¼´éšç€é»˜è®¤çš„æ¶ˆæ¯ stub ä»£ç çš„æ‰§è¡Œã€‚\nLoose AND precedence infix and å’Œä¸­ç¼€æ“ä½œç¬¦ \u0026amp;\u0026amp; ä¸€æ ·, é™¤äº†ä¼˜å…ˆçº§æ›´å®½æ¾ã€‚\nåœ¨å¸ƒå°”ä¸Šä¸‹æ–‡ä¸­è¿”å›ç¬¬ä¸€ä¸ªæ±‚å€¼ä¸º False çš„æ“ä½œæ•°, å¦åˆ™è¿”å›æœ€åä¸€ä¸ªæ“ä½œæ•°ã€‚çŸ­è·¯æ“ä½œç¬¦ã€‚\ninfix andthen è¿”å›ç¬¬ä¸€ä¸ªæœªå®šä¹‰çš„å‚æ•°, å¦åˆ™è¿”å›æœ€åä¸€ä¸ªå‚æ•°ã€‚çŸ­è·¯æ“ä½œç¬¦ã€‚å·¦ä¾§çš„ç»“æœè¢«ç»‘å®šåˆ° $_ èº«ä¸Š, åœ¨å³ä¾§ä¸­ä½¿ç”¨, æˆ–è€…ä½œä¸ºå‚æ•°è¢«ä¼ é€’, å¦‚æœå³ä¾§æ˜¯ä¸€ä¸ª block æˆ– pointy block.\nLoose OR Precedence infix or å’Œä¸­ç¼€æ“ä½œç¬¦ || ä¸€æ ·, é™¤äº†ä¼˜å…ˆçº§æ›´å®½æ¾ã€‚\nåœ¨å¸ƒå°”ä¸Šä¸‹æ–‡ä¸­è¿”å›ç¬¬ä¸€ä¸ªæ±‚å€¼ä¸º True çš„å‚æ•°, å¦åˆ™è¿”å›æœ€åä¸€ä¸ªå‚æ•°ã€‚çŸ­è·¯æ“ä½œç¬¦ã€‚\ninfix orelse å’Œä¸­ç¼€æ“ä½œç¬¦ // ä¸€æ ·, é™¤äº†ä¼˜å…ˆçº§æ›´å®½æ¾ä¹‹å¤–ã€‚\nè¿”å›ç¬¬ä¸€ä¸ªå®šä¹‰è¿‡çš„å‚æ•°, å¦åˆ™è¿”å›æœ€åä¸€ä¸ªå‚æ•°ã€‚çŸ­è·¯æ“ä½œç¬¦ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2015-03-16-operator-in-raku/","tags":["operator"],"title":"Raku ä¸­çš„æ“ä½œç¬¦"},{"categories":["rakulang"],"contents":"Modules Exporting and Selective Importing is export packages(åŒ…), subroutines(å­ä¾‹ç¨‹), variables(å˜é‡), constants(å¸¸é‡) å’Œ enums(æšä¸¾) , é€šè¿‡åœ¨å®ƒä»¬çš„åå­—åé¢æ·»åŠ  is export ç‰¹æ€§æ¥å¯¼å‡ºã€‚\nunit module MyModule; our $var is export = 3; sub foo is export { ... }; constant $FOO is export = \u0026#34;foobar\u0026#34;; enum FooBar is export \u0026lt;one two three\u0026gt;; # Packages like classes can be exported too class MyClass is export {}; # If a subpackage is in the namespace of the current package # it doesn\u0026#39;t need to be explicitly exported class MyModule::MyClass {}; å°±åƒæ‰€æœ‰çš„ traits ä¸€æ ·, å¦‚æœåº”ç”¨åˆ°å­ä¾‹ç¨‹(routine)ä¸Š, \u0026ldquo;is export\u0026rdquo; åº”è¯¥å‡ºç°åœ¨å‚æ•°åˆ—è¡¨çš„åé¢:\nsub foo (Str $string) is export {...} ä½ å¯ä»¥ç»™ is export ä¼ é€’å‘½åå‚æ•°ä»¥ç»„ç»‡è¦å¯¼å‡ºçš„ç¬¦å·, ç„¶åå¯¼å…¥ç¨‹åº\u0001 (importer) å¯ä»¥å‰”é™¤å’Œé€‰æ‹©å¯¼å…¥å“ªä¸€ä¸ªã€‚æœ‰ 3 ä¸ªé¢„å…ˆå®šä¹‰å¥½çš„æ ‡ç­¾ï¼šALL, DEFAULT, MANDATORYï¼ˆå¼ºåˆ¶çš„ï¼‰ã€‚\n# lib/MyModule.pm unit module MyModule; sub bag is export { ... } sub pants is export(:MANDATORY) { ... } sub sunglasses is export(:day) { ... } sub torch is export(:night) { ... } sub underpants is export(:ALL) { ... } # main.pl use lib \u0026#39;lib\u0026#39;; use MyModule; #bag, pants use MyModule :DEFAULT; #the same use MyModule :day; #pants, sunglasses use MyModule :night; #pants, torch use MyModule :ALL; #bag, pants, sunglasses, torch, underpants UNIT::EXPORT::* è¡¨è±¡ä¹‹ä¸‹, å…¶å® is export æ˜¯æŠŠç¬¦å·æ·»åŠ åˆ° EXPORT å‘½åç©ºé—´ä¸­çš„ UNIT ä½œç”¨åŸŸåŒ…ä¸­ã€‚ä¾‹å¦‚, is export(:FOO) ä¼šæŠŠç›®æ ‡æ·»åŠ åˆ° UNIT::EXPORT::FOO åŒ…ä¸­ã€‚è¿™æ­£æ˜¯ Raku å†³å®šå¯¼å…¥ä»€ä¹ˆæ‰€åšçš„ã€‚\nunit module MyModule; sub foo is export { ... } sub bar is export(:other) { ... } ç­‰ä»·äº:\nunit module MyModule; my package EXPORT::DEFAULT { our sub foo { ... } } my package EXPORT::other { our sub bar { ... } } å¤šæ•°æ—¶å€™, is export è¶³å¤Ÿç”¨äº†, ä½†æ˜¯å½“ä½ æƒ³åŠ¨æ€ç”Ÿæˆè¦å¯¼å‡ºçš„ç¬¦å·æ—¶, EXPORT åŒ…å°±å¾ˆæœ‰ç”¨äº†ã€‚ä¾‹å¦‚ï¼š\n# lib/MyModule.pm unit module MuModule; my package EXPORT::DEFAULT { for \u0026lt;zero one two three four\u0026gt;.kv -\u0026gt; $number, $name { for \u0026lt;sqrt log\u0026gt; -\u0026gt; $func { OUR::{\u0026#39;\u0026amp;\u0026#39; ~ $func ~ \u0026#39;-of-\u0026#39; ~ $name } := sub { $number.\u0026#34;$func()\u0026#34; }; } } } # main.pl use MyModule; say sqrt-of-four; #-\u0026gt; 2 say log-of-zero; #-\u0026gt; -Inf EXPORT ä½ å¯ä»¥ç”¨ä¸€ä¸ª EXPORT å­ä¾‹ç¨‹å¯¼å‡ºä»»æ„ç¬¦å·ã€‚EXPORT å¿…é¡»è¿”å›ä¸€ä¸ª Map, åœ¨ map é‡Œé¢é”®æ˜¯ç¬¦å·å, é”®å€¼æ˜¯æƒ³è¦çš„å€¼ã€‚ç¬¦å·ååº”è¯¥åŒ…å«(å¦‚æœæœ‰çš„è¯)å…³è”ç±»å‹ã€‚\nclass MyModule::Class { ... } sub EXPORT { { \u0026#39;$var\u0026#39; =\u0026gt; \u0026#39;one\u0026#39;, \u0026#39;@array\u0026#39; =\u0026gt; \u0026lt;one two three\u0026gt;, \u0026#39;%hash\u0026#39; =\u0026gt; { one =\u0026gt; \u0026#39;two\u0026#39;, three =\u0026gt; \u0026#39;four\u0026#39;}, \u0026#39;\u0026amp;doit\u0026#39; =\u0026gt; sub { ... }, \u0026#39;ShortName\u0026#39; =\u0026gt; MyModule::class } } # main.pl use lib \u0026#39;lib\u0026#39;; use MyModule; say $var; say @array; say %hash; doit(); say ShortName.new; #-\u0026gt; MyModule::Class.new æ³¨æ„, EXPORT ä¸èƒ½å£°æ˜åœ¨åŒ…å†…, å› ä¸ºç›®å‰çš„ rakudo(2015.09) å¥½åƒæŠŠ EXPORT å½“ä½œ compunit çš„ä¸€éƒ¨åˆ†è€ŒéåŒ…çš„ä¸€éƒ¨åˆ†ã€‚\nè™½ç„¶ UNIT::EXPORT åŒ…å¤„ç†ä¼ é€’ç»™ use çš„å‘½åå‚æ•°, è€Œ EXPORT sub å¤„ç†ä½ç½®å‚æ•°ã€‚å¦‚æœä½ æŠŠä½ç½®å‚æ•°ä¼ é€’ç»™ use, é‚£ä¹ˆè¿™äº›å‚æ•°ä¼šè¢«ä¼ é€’ç»™ EXPORTã€‚å¦‚æœä¼ é€’äº†ä½ç½®å‚æ•°, é‚£ä¹ˆ module å°±ä¸å†éœ€è¦å¯¼å‡ºé»˜è®¤ç¬¦å·äº†ã€‚ä½ ä»ç„¶å¯ä»¥ä¼´éšç€ä½ çš„ä½ç½®å‚æ•°, é€šè¿‡æ˜¾å¼åœ°ç»™ use ä¼ é€’ :DEFAULT å‚æ•°æ¥å¯¼å…¥å®ƒä»¬ã€‚\n# lib/MyModule class MyModule::Class {} sub EXPORT($short_name?) { { do $short_name =\u0026gt; MyModule::Class if $short_name } } sub always is export(:MANDATORY) { say \u0026#34;works\u0026#34; } #import with :ALL or :DEFAULT to get sub shy is export { say \u0026#34;you found me!\u0026#34; } # main.pl use lib \u0026#39;lib\u0026#39;; use MyModule \u0026#39;foo\u0026#39;; say foo.new(); #MyModule::Class.new always(); #OK - is imported shy(); #FAIL - won\u0026#39;t be imported å‘å¸ƒæ¨¡å— å¦‚æœä½ å·²ç»å†™äº†ä¸€ä¸ª Raku æ¨¡å—, ä½ æƒ³æŠŠå®ƒåˆ†äº«åˆ°ç¤¾åŒº, æˆ‘ä»¬ä¼šå¾ˆé«˜å…´åœ°æŠŠå®ƒæ”¾åˆ° Raku æ¨¡å—æ–‡ä»¶å¤¹æ¸…å•ä¸­ã€‚Raku modules directory\nç°åœ¨, ä½ éœ€è¦ä½¿ç”¨ git å¯¹ä½ çš„æ¨¡å—è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ã€‚\nè¿™éœ€è¦ä½ æœ‰ä¸€ä¸ª Github å¸å·, ä»¥ä½¿ä½ çš„æ¨¡å—èƒ½è¢«ä»å®ƒçš„ Github ä»“åº“ä¸­åˆ†äº«å‡ºå»ã€‚\nè¦åˆ†äº«ä½ çš„æ¨¡å—, æŒ‰ç…§ä¸‹é¢è¯´çš„åšï¼š\n  åˆ›å»ºä¸€ä¸ªä»¥ä½ çš„æ¨¡å—å‘½åçš„å·¥ç¨‹æ–‡ä»¶å¤¹ã€‚ä¾‹å¦‚, å¦‚æœä½ çš„æ¨¡å—æ˜¯ Vortex::TotalPerspective, é‚£ä¹ˆå°±åˆ›å»ºä¸€ä¸ªå«åš Vortex::TotalPerspective çš„å·¥ç¨‹æ–‡ä»¶å¤¹ã€‚è¿™ä¸ªå·¥ç¨‹ç›®å½•çš„åå­—ä¹Ÿä¼šè¢«ç”¨ä½œ Github ä»“åº“çš„åå­—ã€‚\n  è®©ä½ çš„å·¥ç¨‹ç›®å½•çœ‹èµ·æ¥åƒè¿™æ ·ï¼š\nVortex-TotalPerspective/ |-- lib | `-- Vortex | `-- TotalPerspective.pm |-- LICENSE |-- META.info |-- README.md `-- t `-- basic.t å¦‚æœä½ çš„å·¥ç¨‹åŒ…å«èƒ½å¸®åŠ©ä¸»æ¨¡å—å®Œæˆå·¥ä½œçš„å…¶å®ƒæ¨¡å—, å®ƒä»¬åº”è¯¥è¢«æ”¾åˆ°ä½ çš„ lib ç›®å½•ä¸­åƒè¿™æ ·ç»„ç»‡ï¼š\nlib `-- Vortex |-- TotalPerspective.pm `-- TotalPerspective |-- FairyCake.pm `-- Gargravarr.pm   README.md æ–‡ä»¶æ˜¯ä¸€ä¸ª markdown æ ¼å¼çš„æ–‡ä»¶, å®ƒç¨åä¼šè¢« Github è‡ªåŠ¨æ¸²æŸ“æˆ HTML\n  å…³äº LICENSE æ–‡ä»¶, å¦‚æœä½ æ²¡æœ‰å…¶å®ƒé€‰æ‹©, å°±æ˜¯ç”¨å’Œ Rakudo Raku ä¸€æ ·çš„ LICENSE æŠŠã€‚ä»…ä»…æŠŠå®ƒçš„åŸå§‹ license å¤åˆ¶/ç²˜è´´è¿›ä½ è‡ªå·±çš„ LICENSE æ–‡ä»¶ä¸­ã€‚\n  å¦‚æœä½ è¿˜æ²¡æœ‰ä»»ä½•æµ‹è¯•, ç°åœ¨ä½ å¯ä»¥å¿½ç•¥ t ç›®å½• å’Œ basic.t æ–‡ä»¶ã€‚å…³äºå¦‚ä½•å†™æµ‹è¯•, ä½ å¯ä»¥çœ‹çœ‹å…¶å®ƒæ¨¡å—æ˜¯æ€ä¹ˆä½¿ç”¨ Test çš„ã€‚å®ƒå’Œ Perl'5 çš„ Test::More å¾ˆç±»ä¼¼ã€‚\n  å¦‚æœè¦æ–‡æ¡£åŒ–ä½ çš„æ¨¡å—, åœ¨ä½ çš„æ¨¡å—ä¸­ä½¿ç”¨ Raku Pod æ ‡è®°ã€‚æ¬¢è¿ç»™æ¨¡å—å†™æ–‡æ¡£, å¹¶ä¸”ä¸ºäº†æµè§ˆçš„æ–¹ä¾¿, ä¸€æ—¦ Raku module directory(æˆ–å…¶å®ƒç½‘ç«™) å¼€å§‹æŠŠ Pod æ–‡æ¡£æ¸²æŸ“æˆ HTML, å†™æ–‡æ¡£å°¤ä¸ºé‡è¦ã€‚\n  è®©ä½ çš„ META.info æ–‡ä»¶çœ‹èµ·æ¥åƒè¿™æ ·:\n     { \u0026quot;name\u0026quot; : \u0026quot;Vortex::TotalPerspective\u0026quot;, \u0026quot;version\u0026quot; : \u0026quot;0.1.0\u0026quot;, \u0026quot;description\u0026quot; : \u0026quot;Wonderful simulation to get some perspective.\u0026quot;, \u0026quot;author\u0026quot; : \u0026quot;Your Name\u0026quot;, \u0026quot;provides\u0026quot; : { \u0026quot;Vortex::TotalPerspective\u0026quot; : \u0026quot;lib/Vortex/TotalPerspective.pm\u0026quot; }, \u0026quot;depends\u0026quot; : [ ], \u0026quot;source-url\u0026quot; : \u0026quot;git://github.com/you/Vortex-TotalPerspective.git\u0026quot; } å…³äºé€‰æ‹©ç‰ˆæœ¬å·çš„æ–¹æ¡ˆ, æˆ–è®¸ä½¿ç”¨ \u0026ldquo;major.minor.patch\u0026rdquo; ï¼ˆæŸ¥çœ‹ the spec on versioning è·å–è¯¦ç»†ä¿¡æ¯ ï¼‰ã€‚å¦‚æœç‰ˆæœ¬å·ç°åœ¨å¯¹ä½ æˆ–ä½ çš„ç”¨æˆ·æ¥è¯´ä¸é‡è¦, ä½ å¯ä»¥ç»™ç‰ˆæœ¬é‚£å„¿æ”¾ä¸Šä¸€é¢—æ˜Ÿ(*)ã€‚\nåœ¨ provides ä¸€èŠ‚, åŒ…å«è¿›ä½ çš„å‘å¸ƒä¸­æä¾›çš„æ‰€æœ‰å‘½åç©ºé—´ã€‚\n æŠŠä½ çš„å·¥ç¨‹æ”¾åœ¨ git ç‰ˆæœ¬æ§åˆ¶ä¹‹ä¸‹, å¦‚æœä½ è¿˜æœªè¿™æ ·åšã€‚ ä¸€æ—¦ä½ å¯¹ä½ çš„å·¥ç¨‹æ»¡æ„äº†, åœ¨ Github ä¸Šä¸ºå®ƒåˆ›å»ºä¸€ä¸ªä»“åº“ã€‚å¿…è¦çš„è¯, æŸ¥çœ‹ Github\u0026rsquo;s help docsã€‚ ä½ çš„ Github ä»“åº“çš„åå­—åº”è¯¥å’Œä½ å·¥ç¨‹ç›®å½•çš„åå­—ä¸€æ ·ã€‚åˆ›å»ºå®Œ Githhub ä»“åº“å, Github ä¼šä¸ºä½ å±•ç¤ºæ€ä¹ˆé…ç½®ä½ çš„æœ¬åœ°ä»“åº“ä»¥è·æ‚‰ä½ çš„ Github ä»“åº“ã€‚ æŠŠä½ çš„å·¥ç¨‹æ¨é€åˆ° Github åœ¨ IRC é¢‘é“æ‰¾ä¸ªäººå¸®ä½ å±•ç¤ºæ€ä¹ˆæŠŠä½ çš„æ¨¡å—æ·»åŠ åˆ°ecosystem, æˆ–è€…è®©ä»–ä»¬æ˜¯å¦èƒ½æ›¿ä½ æ·»åŠ ã€‚ pull è¯·æ±‚è¢«æ¥æ”¶ä¹‹å, ç­‰ä¸ªæŠŠå°æ—¶ã€‚å¦‚æœä½ çš„æ¨¡å—æ²¡æœ‰å‡ºç°åœ¨ http://modules.raku.org/, è¯·åˆ° http://modules.raku.org/log/update.log ç¿»çœ‹log æ—¥å¿—æ–‡ä»¶, ä»¥æŸ¥æ‰¾æ˜¯å¦æœ‰é”™è¯¯ã€‚  å°±æ˜¯è¿™æ ·å•¦ï¼æ„Ÿè°¢ä¸º Raku ç¤¾åŒºåšè´¡çŒ®ï¼\nå¦‚æœä½ æƒ³å°è¯•å®‰è£…ä½ çš„æ¨¡å—, ä½¿ç”¨ç†ŠçŒ« panda å®‰è£…å·¥å…·, è¿™å·²ç»åŒ…å«åœ¨ Rakudo Raku ä¸­äº†:\nzef install Vortex::TotalPerspective è¿™ä¼šä¸‹è½½ä½ çš„æ¨¡å—åˆ°å®ƒè‡ªå·±çš„å·¥ä½œç›®å½•(~/.zef), åœ¨é‚£å„¿åˆ›å»º build, å¹¶æŠŠæ¨¡å—å®‰è£…åˆ° ~/.raku\n","permalink":"https://ohmyweekly.github.io/notes/2015-03-23-modules-in-raku/","tags":["module"],"title":"Raku ä¸­çš„æ¨¡å—"},{"categories":["rakulang"],"contents":"Set my $keywords = set \u0026lt;if for unless while\u0026gt;; # create a set sub has-keyword(*@words) { for @words -\u0026gt; $word { # ä¾æ¬¡æ£€æŸ¥æ•°ç»„ä¸­çš„å…ƒç´ æ˜¯å¦å±äºé›†åˆ $keywords return True if $word (elem) $keywords; } False; } say has-keyword \u0026#39;not\u0026#39;, \u0026#39;one\u0026#39;, \u0026#39;here\u0026#39;; # False say has-keyword \u0026#39;but\u0026#39;, \u0026#39;here\u0026#39;, \u0026#39;for\u0026#39;; # True Series Operator my @a=\u0026lt;A G C T\u0026gt;; my $x=@a; for 1 ... * -\u0026gt; $a { (( [X~] $x xx $a )).join(\u0026#39;,\u0026#39;).say; last if $a == 4; } å€’åºçš„ range:\nfor 10 ... 0 { .say; } flip/plop my $file = open \u0026#39;flip_flop.txt\u0026#39;; for $file.lines -\u0026gt; $line { say $line if !($line ~~ m/^\\;/ ff $line ~~ m/^\\\u0026#34;/); } $line ~~ m/^\\;/ ff $line ~~ m/^\\\u0026quot;/ è¿‡æ»¤æ‰ ; å’Œ \u0026quot; ä¹‹é—´çš„å†…å®¹, å†å¯¹å®ƒè¿›è¡Œå–åæ“ä½œå°±æ˜¯è¿‡æ»¤åå‰©ä¸‹çš„æ–‡æœ¬ã€‚\nflip_flop.txt å†…å®¹å¦‚ä¸‹ï¼š\n; next is some lines to skip,include this line fuck fuck fuck dam dam dam mie mie mie \u0026quot; next is subject There is more than one way to do it -- Larry Wall We hope Raku is wrote by the hole Socfilia -- Larry Wall ; next is some lines to skip,include this line fuck fuck fuck dam dam dam mie mie mie \u0026quot; next is subject programming is hard,Let's go shopping -- Larry Wall Ruby is Another Raku -- Larry Wall è¾“å‡ºï¼š\nThere is more than one way to do it -- Larry Wall We hope Raku is wrote by the hole Socfilia -- Larry Wall programming is hard,Let\u0026#39;s go shopping -- Larry Wall Ruby is Another Raku -- Larry Wall ff æ“ä½œç¬¦å·¦å³ä¸¤ä¾§çš„ ^ è¡¨ç¤ºæ’é™¤:\nfor 1..20 {.say if $_==9 ff $_==16} say \u0026#39;-\u0026#39; x 10; for 1..20 {.say if $_==9 ^ff $_==16} say \u0026#39;-\u0026#39; x 10; for 1..20 {.say if $_==9 ff^ $_==16} say \u0026#39;-\u0026#39; x 10; for 1..20 {.say if $_==9 ^ff^ $_==16} è¾“å‡º:\n9 10 11 12 13 14 15 16 ---------- 10 11 12 13 14 15 16 ---------- 9 10 11 12 13 14 15 ---------- 10 11 12 13 14 15 Grammars è§£æ CSV:\nï»¿grammar CSV { token TOP {[\u0026lt;line\u0026gt;\\n?]+} token line {^^# Beginning of a line \u0026lt;value\u0026gt;*%\\, # Any number of \u0026lt;value\u0026gt;s with commas in `between` them $$# End of a line } token value {[|\u0026lt;-[\u0026#34;,\\n]\u0026gt;# Anything not a double quote, comma or newline |\u0026lt;quoted-text\u0026gt;# Or some quoted text ]*# Any number of times } token quoted-text {\\\u0026#34; [|\u0026lt;-[\u0026#34;\\\\]\u0026gt;# Anything not a \u0026#34; or \\ |\u0026#39;\\\u0026#34;\u0026#39;# Or \\\u0026#34;, an escaped quotation mark ]*# Any number of times \\\u0026#34; } } # method parse($str, :$rule = \u0026#39;TOP\u0026#39;, :$actions) returns Match:D say \u0026#34;Valid CSV file!\u0026#34; if CSV.parse( q:to/EOCSV/ ); Year,Make,Model,Length 1997,Ford,E350,2.34 2000,Mercury,Cougar,2.38 EOCSV say CSV.parse( q:to/EOCSV/,\u0026#39;line\u0026#39;, :$actions ); Year,Make,Model,Length 1997,Ford,E350,2.34 2000,Mercury,Cougar,2.38 EOCSV è§£æå¤©æ°”æ•°æ®:\ngrammar StationDataParser { token TOP {^\u0026lt;keyval\u0026gt;+\u0026lt;observations\u0026gt;$} token keyval {$\u0026lt;key\u0026gt;=[\u0026lt;-[=]\u0026gt;+]\u0026#39;=\u0026#39;\\h*$\u0026lt;val\u0026gt;=[\\N+]\\n} token observations {\u0026#39;Obs:\u0026#39;\\h*\\n\u0026lt;observation\u0026gt;+} token observation {$\u0026lt;year\u0026gt;=[\\d+]\\h*\u0026lt;temp\u0026gt;+%%[\\h*]\\n} token temp {\u0026#39;-\u0026#39;?\\d+\\.\\d+} } class StationData { has $.name; has $.country; has @.data; submethod BUILD(:%info (:Name($!name), :Country($!country), *%), :@!data) { } } class StationDataActions { method TOP($/) { make StationData.new( info =\u0026gt; $\u0026lt;keyval\u0026gt;.map(*.ast).hash, data =\u0026gt; $\u0026lt;observations\u0026gt;.ast ); } method keyval($/) { make ~$\u0026lt;key\u0026gt; =\u0026gt; ~$\u0026lt;val\u0026gt;; } method observations($/) { make $\u0026lt;observation\u0026gt;.map(*.ast).grep(*.value.none \u0026lt;= -99); } method observation($/) { make +$\u0026lt;year\u0026gt; =\u0026gt; $\u0026lt;temp\u0026gt;.map(*.Num); } } say StationDataParser.parse( q:to/EOCSV/,:actions(StationDataActions)).ast Name= Jan Mayen Country= NORWAY Lat= 70.9 Long= 8.7 Height= 10 Start year= 1921 End year= 2009 Obs: 1921 -4.4 -7.1 -6.8 -4.3 -0.8 2.2 4.7 5.8 2.7 -2.0 -2.1 -4.0 1922 -0.9 -1.7 -6.2 -3.7 -1.6 2.9 4.8 6.3 2.7 -0.2 -3.8 -2.6 2008 -2.8 -2.7 -4.6 -1.8 1.1 3.3 6.1 6.9 5.8 1.2 -3.5 -0.8 2009 -2.3 -5.3 -3.2 -1.6 2.0 2.9 6.7 7.2 3.8 0.6 -0.3 -1.3 EOCSV Raku Examples  1ã€ç”Ÿæˆ8ä½éšæœºå¯†ç   my @char_set = (0..9, \u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;, \u0026#39;A\u0026#39;..\u0026#39;Z\u0026#39;,\u0026#39;~\u0026#39;,\u0026#39;!\u0026#39;,\u0026#39;@\u0026#39;,\u0026#39;#\u0026#39;,\u0026#39;$\u0026#39;,\u0026#39;%\u0026#39;,\u0026#39;^\u0026#39;,\u0026#39;\u0026amp;\u0026#39;,\u0026#39;*\u0026#39;); say @char_set.pick(8).join(\u0026#34;\u0026#34;) # ä¸é‡å¤çš„8ä½å¯†ç  say @char_set.roll(8).join(\u0026#34;\u0026#34;) # å¯ä»¥é‡å¤  2ã€æ‰“å°å‰5ä¸ªæ•°å­—  .say for 1..10[^5] .say for 1,2,3,4 ... [^10] # è¿™ä¸ªä¼šæ— é™å¾ªç¯   3ã€æ’åº\n  3.1 æŒ‰æ•°å€¼æ’åº\n  my %hash = \u0026#39;Perl\u0026#39; =\u0026gt; 100, \u0026#39;Python\u0026#39; =\u0026gt; 100, \u0026#39;Go\u0026#39; =\u0026gt; 100, \u0026#39;CMD\u0026#39; =\u0026gt; 20, \u0026#39;Php\u0026#39; =\u0026gt; 80, \u0026#39;Java\u0026#39; =\u0026gt; 85; %hash.values.sort; %hash.values.sort(-*);  3.2 æŒ‰åˆ†æ•°æ’åºæ•£åˆ—ï¼š  my %hash = \u0026#39;Perl\u0026#39; =\u0026gt; 80, \u0026#39;Python\u0026#39; =\u0026gt; 100, \u0026#39;Go\u0026#39; =\u0026gt; 95, \u0026#39;CMD\u0026#39; =\u0026gt; 20, \u0026#39;Php\u0026#39; =\u0026gt; 80, \u0026#39;Java\u0026#39; =\u0026gt; 85; for %hash.sort({-.value}).hash.keys -\u0026gt; $key { say $key, \u0026#34;\\t\u0026#34;, %hash{\u0026#34;$key\u0026#34;} } è¾“å‡º:\nPython\t100 Go\t95 Java\t85 Perl\t80 Php\t80 CMD\t20 (\u0026#39;xx\u0026#39;..\u0026#39;zz\u0026#39;).classify(*.substr(1))\u0026lt;z\u0026gt;; # xz yz zz åŠ å¯†ï¼š\nsub rot13 { $^s.trans(\u0026#39;a..z\u0026#39; =\u0026gt; \u0026#39;n..za..m\u0026#39;, \u0026#39;A..Z\u0026#39; =\u0026gt; \u0026#39;N..ZA..M\u0026#39;) }  4ã€æ±‚ 1! + 2! + 3! + 4! +5! + 6! +7! +8! +9! +10!  multi sub postfix:\u0026lt;!\u0026gt;(Int $x){ [*] 1..$x } say [+] 1!,2!,3!,4!,5!,6!,7!,8!,9!,10! # 4037913  5ã€åˆ—å‡ºå¯¹è±¡æ‰€æœ‰å¯ç”¨çš„æ–¹æ³•  ä½¿ç”¨å…ƒå¯¹è±¡åè®®ï¼Œ å³ å¯¹è±¡å.^methods\n\u0026gt; \u0026#34;JZY\u0026#34;.^methods  BUILD Int Num chomp chop substr pred succ match ords lines samecase samespace tr im-leading trim-trailing trim words encode wordcase trans indent codes path WHIC H Bool Str Stringy DUMP ACCEPTS Numeric gist perl comb subst split\n  6ã€ åŒ¿åå­ä¾‹ç¨‹  my $x = sub($a){ $a+2 };say $x($_) for 1..4 my $x = -\u0026gt; $a { $a+2 };say $x($_) for 1..4 my $x = * + 2;say $x($_) for 1..4  7ã€å­—ç¬¦ä¸²ç¿»è½¬ä¸åˆ†å‰²  \u0026gt; 1223.flip 3221 \u0026gt; 'abcd'.flip dcba \u0026gt; 1234.comb 1 2 3 4 \u0026gt; 1234.comb(/./) 1 2 3 4 \u0026gt; 'abcd'.comb a b c d  8ã€æœ‰è¿™ä¹ˆä¸€ä¸ªå››ä½æ•° Aï¼Œå…¶ä¸ªä½æ•°ç›¸åŠ å¾—åˆ° Bï¼Œå°† B ä¹˜ä»¥ B çš„åè½¬æ•°åå¾—åˆ° Aï¼Œè¯·æ±‚å‡ºè¿™ä¸ªæ•°å­—ã€‚  ä¸¾ä¾‹ï¼Œ 1458 å°±ç¬¦åˆè¿™ä¸ªæ¡ä»¶ï¼Œ1+4+5+8 ï¼ 18ï¼Œ 18 ï¼Š 81 ï¼1458\nè¯·æ‰¾å‡ºå¦ä¸€ä¸ªç¬¦åˆä¸Šé¢æ¡ä»¶çš„å››ä½æ•°ã€‚\n(^37).map: { my $r = $_ * .flip; 1000 \u0026lt; $r and $_ == [+] $r.comb and say $r } ^37 äº§ç”Ÿä¸€ä¸ªèŒƒå›´ 0 .. ^37, å°±æ˜¯ 0åˆ°36ä¹‹å‰çš„æ•°ï¼Œåœ¨è¡¨è¾¾å¼ä¸­ä»£è¡¨ B\nmy $b; for 1000..^10000 -\u0026gt; $i { $b=[+] $i.comb; say $i if $b*$b.flip == $i; } è¾“å‡º:\n1458 1729  9ã€ å¤§å°å†™è½¬æ¢  \u0026gt; my $word= \u0026quot;I Love Raku\u0026quot; I Love Raku \u0026gt; $word.wordcase() I Love Raku \u0026gt; my $lowercase = \u0026quot;i love perl 6\u0026quot; i love perl 6 \u0026gt; $lowercase.wordcase() I Love Raku \u0026gt; $word.samecase('A') I LOVE PERL 6 \u0026gt; $word.samecase('a') i love perl 6 \u0026gt; $word.samecase('a').wordcase() I Love Raku  10ã€ å¤šè¡Œæ–‡æœ¬  my $string = q:to/THE END/;Norway Oslo : 59.914289,10.738739 : 2 Bergen : 60.388533,5.331856 : 4 Ukraine Kiev : 50.456001,30.50384 : 3 Switzerland Wengen : 46.608265,7.922065 : 3 THE END say $string;  11ã€ è¶…è¿ç®—ç¬¦ä¸å­ä¾‹ç¨‹  my @a = \u0026lt;1 2 3 4\u0026gt;; sub by2($n){ return 2*$n; } sub power2($n) { return $n ** 2; } my @b = @aÂ».\u0026amp;by2Â».\u0026amp;power2; say @b; # 4 16 36 64 ä¸ºä»€ä¹ˆæ˜¯ \u0026amp;function å‘¢ï¼š\n the name of the by2 function is \u0026amp;by2, just as the name of the foo scalar is $foo and the name of the foo array is @foo\n  12ã€ å¦‚ä½•åœ¨ Raku ä¸­æ‰§è¡Œå¤–éƒ¨å‘½ä»¤å¹¶æ•è·è¾“å‡º  \u0026gt; my $res = qqx{mkdir 123456} # æˆ–ä½¿ç”¨ qx{ } \u0026gt; my $res = qx{mkdir 112233}  13ã€Does Raku support something equivalent to Perl5\u0026rsquo;s DATA and END sections?  =fooThis is a Pod block. A single line one. This Pod block\u0026#39;s name is \u0026#39;foo\u0026#39;.  =beginquxThis is another syntax for defining a Pod block. It allows for multi line content. This block\u0026#39;s name is \u0026#39;qux\u0026#39;. =end qux =dataA data block -- a Pod block with the name \u0026#39;data\u0026#39;.  # Data blocks are P6\u0026#39;s version of P5\u0026#39;s __DATA__. # But you can have multiple data blocks: =begindataAnother data block. This time a multi line one. =end data $=pod.grep(*.name eq \u0026#39;data\u0026#39;).map(*.contents[0].contents.say); say \u0026#39;-\u0026#39; x 45; for @$=pod { if .name eq \u0026#39;data\u0026#39; { say .contents[0].contents } }  14ã€ç”Ÿæˆå«æœ‰26ä¸ªè‹±æ–‡å­—æ¯å’Œä¸‹åˆ’çº¿çš„ junction  any(\u0026#39;A\u0026#39;..\u0026#39;Z\u0026#39;,\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;,\u0026#39;_\u0026#39;);  15ã€åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦æ˜¯å¦åœ¨æŸä¸ªé›†åˆä¸­  \u0026gt; so any(\u0026#39;A\u0026#39;..\u0026#39;Z\u0026#39;,\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;) âˆˆ set(\u0026#34;12a34\u0026#34;.comb) \u0026ldquo;12a34\u0026rdquo;.comb ä¼šæŠŠå­—ç¬¦ä¸²åˆ†å‰²ä¸ºå•ä¸ªå­—ç¬¦ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦æ•°ç»„ã€‚\n 16ã€ç”Ÿæˆ IP åœ°å€èŒƒå›´  .say for \u0026#34;192.168.10.\u0026#34; Â«~Â» (0..255).list  17ã€ ç”Ÿæˆ OC ä¸­çš„æµ‹è¯•æ•°ç»„  .say for \u0026#34;@\u0026#34; Â«~Â» \u0026#39;\u0026#34;Perl\u0026#39; Â«~Â» (1..30).list Â«~Â» \u0026#39;\u0026#34;,\u0026#39; @\u0026quot;Perl\u0026quot;1\u0026quot;, @\u0026quot;Perl\u0026quot;2\u0026quot;, @\u0026quot;Perl\u0026quot;3\u0026quot;, @\u0026quot;Perl\u0026quot;4\u0026quot;, @\u0026quot;Perl\u0026quot;5\u0026quot;, â€¦   18ã€æˆ‘æƒ³ä»¥ AGCT 4 ç§å­—æ¯ä¸ºåŸºç¡€ç”Ÿæˆå­—ç¬¦ä¸²ã€‚  æ¯”å¦‚å¸Œæœ›é•¿åº¦ä¸º1ï¼Œè¾“å‡ºA,G,C,Tã€‚\nå¦‚æœé•¿åº¦ä¸º2ï¼Œè¾“å‡º AA,AG,AC,AT,GA,GG,GC,GT,CA,CG,CC,CT,TA,TG,TC,TTã€‚è¿™æ ·çš„ç»“æœã€‚\n@a X~ \u0026#34;\u0026#34; # é•¿åº¦ä¸º1 (@a X~ @a) # é•¿åº¦ä¸º2 (@a X~ @a) X~ @a # é•¿åº¦ä¸º3 @a X~ @a X~ @a X~ @a # é•¿åº¦ä¸º4 \u0026gt; my @a=\u0026lt;A G C T\u0026gt; A G C T \u0026gt; my $x=@a A G C T \u0026gt; $x xx 2 A G C T A G C T \u0026gt; $x xx 3 A G C T A G C T A G C T \u0026gt; ($x xx 3).WHAT (List) \u0026gt; $x.WHAT (Array) \u0026gt; ([X~] $x xx 2).join(',') AA,AG,AC,AT,GA,GG,GC,GT,CA,CG,CC,CT,TA,TG,TC,TT æƒ°æ€§æ“ä½œç¬¦ï¼š\nmy @a=\u0026lt;A G C T\u0026gt;; my $x=@a; # æˆ–è€…ä½¿ç”¨ $x = @(\u0026#39;A\u0026#39;,\u0026#39;G\u0026#39;,\u0026#39;C\u0026#39;,\u0026#39;T\u0026#39;) for 1 ...^ * -\u0026gt; $a {(([X~] $x xx $a)).join(\u0026#39;,\u0026#39;).say;last if $a==4;}; Best Of Raku  Command Line å‘½ä»¤è¡Œ  # Perl 5 Raku print \u0026#34;bananas are good\\n\u0026#34;; say \u0026#34;bananas are good\u0026#34;; print \u0026#34;and I said: $quotes{\\\u0026#34;me\\\u0026#34;}\\n\u0026#34;; say \u0026#34;and I said: %quotes{\u0026#34;me\u0026#34;}.\u0026#34;; print \u0026#34;and I said: $quotes{\\\u0026#34;me\\\u0026#34;}\\n\u0026#34;; say \u0026#34;and I said: %quotes\u0026lt;me\u0026gt;.\u0026#34;; print \u0026#34;What is ... \u0026#34;; $result = prompt \u0026#34;What is ... \u0026#34;; chomp($result = \u0026lt;\u0026gt;);  File IO  # Perl 5 Raku $content = do { local $/; $content = slurp \u0026#34;poetry.txt\u0026#34;; open my $FH, \u0026#34;poetry.txt\u0026#34;; \u0026lt;$FH\u0026gt; }; chomp(@content = do { @content = lines \u0026#34;poetry.txt\u0026#34;; open my $FH, \u0026#34;poetry.txt\u0026#34;; \u0026lt;$FH\u0026gt; });  Automatic multithreading  Applying operations to junctions and arrays is now syntactically compact and readable. Raku will create threads where appropriate to use multiple processors, cores or hyperthreading for high level language SIMD concurrent processing.\n# Perl 5 Raku my $sum; my $sum = [+] @numbers; $sum += $_ for @numbers; for (0 .. $#factor1) { @product = @factor1 \u0026gt;\u0026gt;*\u0026lt;\u0026lt; @factor2; $product[$] = $factor1[$] * $factor2[$_]; } The Perl 5 code is a simplification, of course Raku \u0026ldquo;does the right thing\u0026rdquo; when the arrays have different lengths.\n æ¯”è¾ƒ  Here are junctions, then chained comparison operators.\n# Perl 5 Raku if ($a == 3 or $a == 4 or $a == 7) {...} if $a = 3 | 4 | 7 {...} if (4 \u0026lt; $a and $a \u0026lt; 12) {...} if 4 \u0026lt; $a \u0026lt; 12 {...} if (4 \u0026lt; $a and $a \u0026lt;= 12) {...} if $a ~~ 4^..12 {...} $a = defined $b ? $b : $c; $a = $b // $c; The defined-OR operator eases lot of cases where Perl 5 newbies could fall into traps.\n Case ç»“æ„  # Perl 5 Raku given $a { if ($a == 2 or $a == 5) {...} }} when 2 | 5 {...} elsif ($a == 6 or $a == 7 or $a == 8 or $a == 9) {} when 6 .. 9 {...} elsif ($a =~ /g/) {...} when \u0026#39;g\u0026#39; {...} else {...} default {...} } That new construct (backported to 5.10) is clear to read, very versatile and when used in combination with junctions, becomes even clearer.\n å¼ºå¤§çš„å¾ªç¯  List iteration via for is now much more versatile.\n# Perl 5 Raku for my $i (0..15) {...} for ^16 -\u0026gt; $i {...} for (my $i=15; $i\u0026gt;1; $i-2) {...} for 15,*-2...1 -\u0026gt; $i {...} for my $key (keys %hash) { for %hash.kv -\u0026gt; $key, $value { print \u0026#34;$key=\u0026gt; $hash{$key}\\n\u0026#34;; ... say \u0026#34;$key=\u0026gt; $value\u0026#34;; ... for my $i (0..$#a) { for zip(@a; @b; @c) -\u0026gt; $a, $b, $c {...} my $a = @a[$i]; my $b = @b[$i]; my $c = @c[$i]; ...  å­ä¾‹ç¨‹ä¸­çš„å…·åå‚æ•°  # Perl 5 Raku sub routine { sub routine ($a, $b, *@rest) {...} my $a = shift; my $b = shift; my @rest = @_; }  Objects with auto generated new and getters and setters  Simple Object creation is now as easy as it gets.\n# Perl 5 Raku package Heart::Gold; class Heart::Gold { has $.speed; sub new { method stop { $.speed = 0 } bless {speed =\u0026gt; 0 }, shift; } } my Heart::Gold $hg1 .= new; sub speed { $hg1.speed = 100; my $self = shift; my $hg2 = $hg1.clone; my $speed = shift; if (defined $speed) { $self-\u0026gt;{speed} = $speed } else { $self-\u0026gt;{speed} } } sub stop { my $self = shift; $self-\u0026gt;{speed} = 0; } Raku Variable  Variable Types  Raku (as Perl 5) knows 3 basic types of variables: Scalars (single values), Arrays (ordered and indexed lists of several values) and Hashes (2 column table, with ID and associated value pairs). They can be easily distinguished, because in front of their name is a special character called sigil (latin for sign). It\u0026rsquo;s the $ (similar to S) for Scalars, @ (like an a) for Arrays and a % (kv pair icon) for a Hash. They are now invariant (not changing), which means for instance, an array vaiable starts always with an @, even if you just want a slice of the content.\n$scalar @array @array[1] # $array[1] in Perl 5 @array[1,2] # @array[1,2] in Perl 5 %hash %hash{\u0026#39;ba\u0026#39;} # $hash{\u0026#39;ba\u0026#39;} in Perl 5 %hash{\u0026#39;ba\u0026#39;,\u0026#39;da\u0026#39;,\u0026#39;bim\u0026#39;} # @hash{\u0026#39;ba\u0026#39;,\u0026#39;da\u0026#39;,\u0026#39;bim\u0026#39;} in Perl 5 The sigils also mark distinct namespaces, meaning: in one lexical scope you can have 3 different variables named $stuff, @stuff and %stuff. These sigils can also be used as an operator to enforce a context in which the following data will be seen.\nThe fourth namespace is for subroutines and similar, even if you don\u0026rsquo;t usually think of them as variables. It\u0026rsquo;s sigil \u0026amp; is used to refer to subroutines without calling them.\nAll special namespaces from Perl 5 (often marked with special syntax), like tokens (PACKAGE), formats, file or dir handles, or builtins are now regular variables or routines.\nBecause all variables contain objects, they have methods. In fact, all operators, including square or curly bracket subscripts, are just methods of an object with a fancy name.\nThe primary sigil can be followed by a secondary sigil, called a twigil, which indicates a special scope for that variable.\nScalar This type stores one value, usually a reference to something: a value of a data type, a code object, an object or a compound of values like a pair, junction, array, hash or capture. The scalar context is now called item context, hence the scalar instruction from Perl 5 was renamed to item.\n$CHAPTER = 3; # first comment! $bin = 0b11; # same value in binary format $pi = 3.14159_26535_89793; # the underscores just ease reading $float = 6.02e-23; # floating number in scientific notation $text = \u0026#39;Welcome all!\u0026#39;; # single quoted string # double quoted string, does eval $pi to it\u0026#39;s content $text = \u0026#34;What is $pi?\u0026#34;; $text = q:to\u0026#39;EOT\u0026#39;;# heredoc string handy for multiline text like HTML templates or email EOT $handle = open $file_name; # file handle # an object from a class with a nested namespace $object = Class::Name.new(); $condition = 3|5|7; # a junction, a logical conjunction of values $arrayref = [0,1,1,2,3,5,8,13,21]; # an array stored as a single item # a hash stored as a single item $hashref = {\u0026#39;audreyt\u0026#39; =\u0026gt; \u0026#39;pugs\u0026#39;, \u0026#39;pm\u0026#39; =\u0026gt; \u0026#39;pct\u0026#39;, \u0026#39;damian\u0026#39; =\u0026gt; \u0026#39;larrys evil henchman\u0026#39;}; # pointing to a callable $coderef = sub { do_something_completely_diffenent(@_) }; (For info on some of those terms: comment, binary format, the underscores ease reading, scientific notation, single-quoted string, double-quoted string, heredoc string, file handle, class, junction, list of values, hash, callable.)\nUnlike Perl 5, references are automatically dereferenced to a fitting context. So you could use these $arrayrefs and $hashrefs similarly to an array or hash, making $ the universal variable prefix, pretty much like in PHP. The primary difference is that $ prefixed lists are not flattened in lists.\nmy $a = (1, 2, 3); my @a = 1, 2, 3; for $a { } # just one iteration for @a { } # three iterations Scalar Methods my $chapter = 3; undefine $chapter; defined $a; # false, returns 0  Array  An array is an ordered and indexed list of scalars. If not specified otherwise, they can be changed, expanded and shortened anytime and used as a list, stack, queue and much more. As in Haskell, lists are processed lazily, which means: the compiler looks only at the part it currently needs. This way Raku can handle infinite lists or do computation on lists that have not been computed yet. The lazy command enforces this and the eager command forces all values to be computed.\nThe list context is forced with a @() operator or list() command. That\u0026rsquo;s not autoflattening like in Perl 5 (automatically convert a List of Lists into one List). If you still want that, say flat(). Or say lol() to explicitly prevent autoflattening.\n@primes = (2,3,5,7,11,13,17,19,23); # an array gets filled like in Perl 5 @primes = 2,3,5,7,11,13,17,19,23 ; # same thing, since unlike P5 round braces just do group @primes = \u0026lt;2 3 5 7 11 13 17 19 23\u0026gt;; # ditto, \u0026lt;\u0026gt; is the new qw() $primes = (2,3,5,7,11,13,17,19,23); # same array object just sits in $primes, $primes[0] is 2 $primes = item @primes; # same thing, more explicit $primes = 2,; # just 2, first element of the Parcel @primes = 2; # array with one element @primes = [2,3,5,7,11,13,17,19,23]; # array with one element (List of Lists - LoL) @dev = {\u0026#39;dan\u0026#39; =\u0026gt; \u0026#39;parrot\u0026#39;}; # array with one element (a Hash) @data = [1..5],[6..10],[11..15]; # Array of Arrays (LoL) @list = lol @data; # no change @list = flat @data; # returns 1..15  Array Slices  @primes # all values as list @primes.values # same thing @primes.keys # list of all indices \u0026#34;@primes[]\u0026#34; # insert all values in a string, uses [] to distinguish from mail adresses $prime = @primes[0]; # get the first prime $prime = @primes[*-1]; # get the last one @some = @primes[2..5]; # get several $cell = @data[1][2]; # get 8, third value of second value (list) $cell = @data[1;2]; # same thing, shorten syntax @numbers = @data[1]; # get a copy of the second subarray (6..10) @copy = @data; # shallow copy of the array  Array Methods  Some of the more important things you can do with lists. All the methods can also used like ops in \u0026ldquo;elems @array;\u0026rdquo;\n? @array; # boolean context, Bool::True if array has any value in it, even if it\u0026#39;s a 0 + @array; # numeric context, number of elements (like in Perl 5 scalar @a) ~ @array; # string context, you get content of all cells, stringified and joined, same as \u0026#34;@primes[]\u0026#34; @array.elems; # same as + @array @array.end; # number of the last element, equal to @array.elems-1 @array.cat; # same ~ @array @array.join(\u0026#39;\u0026#39;); # also same result, you can put another string as parameter that gets between all values @array.unshift; # prepend one value to the array @array.shift; # remove the first value and return it @array.push; # add one value on the end @array.pop; # remove one value from the end and return it @array.splice($pos,$n);# starting at $pos remove $n values and replace them with values that follow those two  parameters  @array.delete(@ind); # delete all cells with indices in @ind @array.exists(@ind); # Bool::True if all indices of @ind have a value (can be 0 or \u0026#39;\u0026#39;) @array.pick([$n]); # return $n (default is 1) randomly selected values, without duplication @array.roll([$n]); # return $n (default is 1) randomly selected values, duplication possible (like roll dice) @array.reverse; # all elements in reversed order # returns a list where $n times first item is taken to last # position if $n is positive, if negative the other way around @array.rotate($n); @array.sort($coderef); # returns a list sorted by a user-defined criteria, default is alphanumerical sorting @array.min; # numerical smallest value of that array @array.max; # numerical largest value of that array $a,$b= @array.minmax; # both at once, like in .sort, .min, or .max, a sorting algorithm can be provided @array.map($coderef); # high oder map function, runs $coderef with every value as $_ and returns the list or results @array.classify($cr); # kind of map, but creates a hash, where keys are the results of $cr and values are from @array @array.categorize($cr);# kind of classify, but closure can have no (Nil) or several results, so a key can have a list of values @array.grep({$_\u0026gt;1}); # high order grep, returns only these elements that pass a condition ($cr returns something positive) @array.first($coder); # kind of grep, return just the first matching value @array.zip; # join arrays by picking first element left successively from here and then there There is even a whole class of metaoperators that work upon lists.  Hash  In Raku a Hash is an unordered list of Pairs. A Pair is a single key =\u0026gt; value association and appears in many places of the language syntax. A hash allows lookup of values by key using {} or \u0026lt;\u0026gt; syntax.\n%dev = \u0026#39;pugs\u0026#39;=\u0026gt;\u0026#39;audreyt\u0026#39;, \u0026#39;pct\u0026#39;=\u0026gt;\u0026#39;pm\u0026#39;, \u0026#34;STD\u0026#34;=\u0026gt;\u0026#39;larry\u0026#39;; %dev = :rakudo(\u0026#39;jnthn\u0026#39;), :testsuite(\u0026#39;moritz\u0026#39;); # adverb (pair) syntax works as well %dev = (\u0026#39;audreyt\u0026#39;, \u0026#39;pugs\u0026#39;, \u0026#39;pm\u0026#39;, \u0026#39;pct\u0026#39;, \u0026#39;larry\u0026#39;, \u0026#34;STD\u0026#34;); # lists get autoconverted in hash context %compiler = Parrot =\u0026gt; {Rakudo =\u0026gt; \u0026#39;jnthn\u0026#39;}, SMOP =\u0026gt; {Mildew =\u0026gt; \u0026#39;ruoso\u0026#39;}; # hash of hashes (HoH)  Hash Slices  $value = %dev{\u0026#39;key\u0026#39;}; # just give me the value related to that key, like in P5 $value = %dev\u0026lt;pm\u0026gt;; # \u0026lt;\u0026gt; autoquotes like qw() in P5 $value = %dev\u0026lt;\u0026lt;$name\u0026gt;\u0026gt;; # same thing, just with eval @values = %dev{\u0026#39;key1\u0026#39;, \u0026#39;key2\u0026#39;}; @values = %dev\u0026lt;key1 key2\u0026gt;; @values = %dev\u0026lt;\u0026lt;key1 key2 $key3\u0026gt;\u0026gt;; %compiler\u0026lt;Parrot\u0026gt;\u0026lt;Rakudo\u0026gt;; # value in a HoH, returns \u0026#39;jnthn\u0026#39; %compiler\u0026lt;SMOP\u0026gt;; # returns the Pair: Mildew =\u0026gt; \u0026#39;ruoso\u0026#39; %dev {\u0026#39;audrey\u0026#39;}; # error, spaces between varname and braces (postcircumfix operator) are no longer allowed %dev\\ {\u0026#39;allison\u0026#39;}; # works, quote the space %dev .\u0026lt;dukeleto\u0026gt;; # error %dev\\ .{\u0026#39;patrick\u0026#39;}; # works too, \u0026#34;long dot style\u0026#34;, because it\u0026#39;s an object in truth  Hash Methods  ? %dev # bool context, true if hash has any pairs + %dev # numeric context, returns number of pairs(keys) ~ %dev # string context, nicely formatted 2 column table using \\t and \\n $table = %dev; # same as ~ %dev %dev.say; # stringified, but only $key and $value are separated by \\t @pairs = %dev; # list of all containing pairs %dev.pairs # same thing in all context %dev.elems # same as + %dev or + %dev.pairs %dev.keys # returns a list of all keys %dev.values # list of all values %dev.kv # flat list with key1, value1, key 2 ... %dev.invert # reverse all key =\u0026gt; value relations %dev.push (@pairs) # inserts a list of pairs, if a key is already present in %dev, both values gets added to an array  Callable  Internally subroutines, methods and alike are variables with the sigil \u0026amp; and stored in a fourth namespace. Unlike Perl 5, all subroutines can be overwritten or augmented with user defined routines. Of course scalars can also contain routines.\n\u0026amp;function = sub { ... }; # store subroutine in callable namespace function(); # call/run it $coderef = sub { ... }; # store it in a scalar $coderef($several, $parameter); # run that code  Data Types  In contrast to variable types (container types) every value has a type too. These are organized internally as classes or roles and can be categorized into 3 piles: the undefined, immutable, and the mutable types.\nYou can assign one of these types to scalar, array, or hash variables, which enforces the contents to be that type.\nmy Int $a; my Int @a; # array of Int  Pair  Pairs are new and their syntax is used nearly everywhere in the language where there is an association between a name and a value.\n$pair = \u0026#39;jakub\u0026#39; =\u0026gt; \u0026#39;helena\u0026#39;; # \u0026#34;=\u0026gt;\u0026#34; is the pair constructor $pair = :jakub(\u0026#39;helena\u0026#39;); # same in adverbial notation $pair = :jakub\u0026lt;helena\u0026gt;; # same using \u0026lt;\u0026gt;, the new qw() $pair.key # returns \u0026#39;jakub\u0026#39; $pair.value # returns \u0026#39;helena\u0026#39; $pair.isa(Pair) # Bool::True  Capture  Captures are also a new type, which holds the parameters a routine gets. Because Perl now knows both positional and named parameters, it is a mixture of a list and array.\n$cap = \\(@a,$s,%h,\u0026#39;a\u0026#39;=\u0026gt;3); # creating a capture, \u0026#34;\\\u0026#34; was free since there are no references anymore |$cap # flatten into argument list (without |, it will pass it as a single value) ||$cap # flatten into semicolon list (meant for variadic functions that take list of lists) One important difference between a capture and a compound structure of lists and hashes: While assignments with = will copy the complete content of the named variables, this is not so in the case of a capture. When I change sinthelastexample,â€†thecontentofcap changes too, because when parameters to a routine are variables, they are also interpolated in the moment the routine is called, not when it\u0026rsquo;s defined.\n  Assignment and Binding\n  Assignment\n  As rightfully expected, assignments are done with the equal sign. But unlike Perl 5 you always get a copy of the right side data assigned to the left, no matter how nested the data structure was (lists of lists eg). You never get in Raku a reference with =. The only exception may be seen captures.\nmy @original = [1,2],[3,4]; my $copy = @original[0]; # $copy points to [1,2] @original[0][0] = \u0026#39;fresh stuff\u0026#39;; # $copy[0] holds still 1  Binding  Since every variable in Raku is a reference, programmers can use binding to get 2 variables that point to the same memory location.\n$original = 5; $original := $mirror; # normal binding, done on runtime $original ::= $mirror; # same thing, but done during compile time $original = 3; say $mirror; # prints 3 $original =:= $mirror # true, because they\u0026#39;re bound together $original === $mirror # also true, because content and type are equal  FP oriented  sub balanced($s) { .none \u0026lt; 0 and .[*-1] == 0 given [\\+] \u0026#39;\\\\\u0026#39; Â«legÂ« $s.comb; } my $n = prompt \u0026#34;Number of bracket pairs: \u0026#34;; my $s = \u0026lt;[ ]\u0026gt;.roll($n*2).join; say \u0026#34;$s{ balanced($s) ?? \u0026#34;is\u0026#34; !! \u0026#34;is not\u0026#34; }well-balanced\u0026#34;  String munging  sub balanced($_ is copy) { () while s:g/\u0026#39;[]\u0026#39;//; $_ eq \u0026#39;\u0026#39;; } my $n = prompt \u0026#34;Number of bracket pairs: \u0026#34;; my $s = \u0026lt;[ ]\u0026gt;.roll($n*2).join; say \u0026#34;$sis\u0026#34;, \u0026#39;not\u0026#39; xx not balanced($s)), \u0026#34;well-balanced\u0026#34;;  Parsing with a grammar  grammar BalBrack { token TOP {\u0026#39;[\u0026#39;\u0026lt;TOP\u0026gt;*\u0026#39;]\u0026#39;} } my $n = prompt \u0026#34;Number of bracket pairs: \u0026#34;; my $s = (\u0026#39;[\u0026#39; xx $n, \u0026#39;]\u0026#39; xx $n).pick(*).join; say \u0026#34;$s{ BalBrack.parse($s) ?? \u0026#34;is\u0026#34; !! \u0026#34;is not\u0026#34; }well-balanced\u0026#34;;  å‡¯æ’’åŠ å¯†  å®ç°ä¸€ä¸ªå‡¯æ’’åŠ å¯†ï¼Œ ç¼–ç å’Œè§£ç éƒ½è¦æœ‰\nkey æ˜¯ä¸€ä¸ª 1 åˆ° 25 ä¹‹é—´çš„æ•´æ•°\nmy @alpha = \u0026#39;A\u0026#39; .. \u0026#39;Z\u0026#39;; sub encrypt ( $key where 1..25, $plaintext ) { $plaintext.trans( @alpha Z=\u0026gt; @alpha.rotate($key) ); } sub decrypt ( $key where 1..25, $cyphertext ) { $cyphertext.trans( @alpha.rotate($key) Z=\u0026gt; @alpha ); } my $original = \u0026#39;THE FIVE BOXING WIZARDS JUMP QUICKLY\u0026#39;; my $en = encrypt( 13, $original ); my $de = decrypt( 13, $en ); .say for $original, $en, $de; say \u0026#39;OK\u0026#39; if $original eq all( map { .\u0026amp;decrypt(.\u0026amp;encrypt($original)) }, 1..25 ); Output: THE FIVE BOXING WIZARDS JUMP QUICKLY GUR SVIR OBKVAT JVMNEQF WHZC DHVPXYL THE FIVE BOXING WIZARDS JUMP QUICKLY OK   æ—¥æœŸæ ¼å¼åŒ–  ä½¿ç”¨ \u0026ldquo;2007-11-10\u0026rdquo; å’Œ \u0026ldquo;Sunday, November 10, 2007\u0026rdquo; æ—¥æœŸæ ¼å¼æ˜¾å¼å½“å‰æ—¥æœŸ:\nuse DateTime::Utils; my $dt = DateTime.now; say strftime(\u0026#39;%Y-%m-%d\u0026#39;, $dt); say strftime(\u0026#39;%A, %B %d, %Y\u0026#39;, $dt);  é˜¶ä¹˜  n çš„é˜¶ä¹˜å®šä¹‰ä¸º n*(n-1)*(n-2)â€¦*1, é›¶çš„é˜¶ä¹˜ä¸º1.\nå®šä¹‰ä¸€ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªæ•°å­—çš„é˜¶ä¹˜ã€‚\n ä½¿ç”¨è‡ªå®šä¹‰åç¼€æ“ä½œç¬¦  sub postfix:\u0026lt;!\u0026gt;($n where $n \u0026gt; 0) { [*] 2..$n } say 5!  [*]  my @a = 1, [\\*] 1..*; say @a[5]; æ ‡é‡å®¹å™¨ä¸­å­˜å‚¨çš„å¯¹è±¡ä¸ä¼šåœ¨ flattening ä¸Šä¸‹æ–‡ä¸­æ’å€¼ï¼Œå³ä½¿é‚£ä¸ªå¯¹è±¡æ˜¯å¯è¿­ä»£çš„ã€‚\nmy @a = 3,4,5; for 1, 2, @a { .say } # 5æ¬¡è¿­ä»£ è¾“å‡º:\n1 2 3 4 5 my $s = @a; for 1, 2, $s { ... } # 3æ¬¡è¿­ä»£ è¾“å‡º:\n1 2 3 4 5 è¿™é‡Œï¼Œ$s å’Œ @a æŒ‡å‘åŒä¸€ä¸ªæ•°ç»„å¯¹è±¡ï¼Œä½†æ˜¯æ ‡é‡å®¹å™¨çš„å‡ºç°é˜»æ­¢ $s è¢«å±•å¼€åˆ° for å¾ªç¯ä¸­ã€‚\n.list å’Œ .flat æ–¹æ³•èƒ½è¢«ç”¨äºè¿˜åŸå±•å¼€è¡Œä¸ºï¼š\nfor 1, 2, $s.list { .say } # 5æ¬¡éå† for 1, 2, @($s) { .say } # 5æ¬¡éå†ï¼Œ@()ä¼šå¼ºåˆ¶ä¸ºåˆ—è¡¨ä¸Šä¸‹æ–‡ è¾“å‡º:\n1 2 3 4 5 ç›¸åï¼Œ.item æ–¹æ³•å’Œ $() èƒ½ç”¨äºé˜²æ­¢æ’å€¼ï¼š\nmy @b = 1,2,@a; # @b æœ‰5ä¸ªå…ƒç´  my @c = 1,2,@a.item; # @c æœ‰3ä¸ªå…ƒç´  my @c = 1,2,$(@a); # åŒä¸Š say +@c; # 3  Feed operators  feed æ“ä½œç¬¦æ˜¯å®Œå…¨æ‡’æƒ°çš„ï¼Œæ„å‘³ç€åœ¨ä½¿ç”¨è€…è¦æ±‚ä»»ä½•å…ƒç´ ä¹‹å‰ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œã€‚è¿™å°±æ˜¯\nmy @a \u0026lt;== grep { ... } \u0026lt;== map { ... } \u0026lt;== grep { ... } \u0026lt;== 1, 2, 3 æ˜¯å®Œå…¨æ‡’æƒ°çš„ã€‚\n Grammars  æ–‡æ³•æ˜¯ä¸€ç§å¼ºå¤§çš„å·¥å…·, ç”¨äºæ‹†è§£æ–‡æœ¬,å¹¶é€šå¸¸è¿”å›æ•°æ®ç»“æ„ ä¾‹å¦‚, Raku æ˜¯ä½¿ç”¨ Raku é£æ ¼çš„æ–‡æ³•è§£æå’Œæ‰§è¡Œçš„. å¯¹æ™®é€š Raku ç”¨æˆ·æ¥è¯´,ä¸€ä¸ªæ›´å®ç”¨çš„ä¾‹å­å°±æ˜¯ JSON::Simple æ¨¡å—, è¿™ä¸ªæ¨¡å—èƒ½ååºåˆ—åŒ–ä»»ä½•æœ‰æ•ˆçš„ JSON æ–‡ä»¶, ååºåˆ—åŒ–ä»£ç è¿˜å†™äº†ä¸åˆ° 100 è¡Œ, ç®€å•,å¯æ‰©å±•.\nè¯æ³•å…è®¸ä½ ç»„ç»‡æ­£åˆ™, å°±åƒç±»å…è®¸ä½ ç»„ç»‡æ™®é€šä»£ç çš„æ–¹æ³•ä¸€æ ·.\nå‘½åæ­£åˆ™ å‘½åæ­£åˆ™æœ‰ç‰¹æ®Šçš„è¯­æ³•, ä¸å­ä¾‹ç¨‹çš„å®šä¹‰ç±»ä¼¼:\nmy regex number {\\d+[\\.\\d+]?} è¿™ä¸ªä¾‹å­ä¸­, æˆ‘ä»¬å¿…é¡»ä½¿ç”¨ my å…³é”®è¯æŒ‡å®šè¿™ä¸ªæ­£åˆ™æ˜¯è¯æ³•ä½œç”¨åŸŸçš„, å› ä¸º å‘½åæ­£åˆ™ é€šå¸¸ç”¨åœ¨ è¯æ³•ä¸­. ç»™æ­£åˆ™å‘½ååæœ‰åˆ©äºåœ¨å…¶ä»–åœ°æ–¹å¤ç”¨æ­£åˆ™:\nsay \u0026#34;32.51\u0026#34; ~~ \u0026amp;number; say \u0026#34;15 + 4.5\u0026#34; ~~ /\u0026lt;number\u0026gt;\\s*\u0026#39;+\u0026#39;\\s*\u0026lt;number\u0026gt;/ é¦–å…ˆè¯´ä¸‹, ä½¿ç”¨ regex/token/rule å®šä¹‰äº†ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼åæ€ä¹ˆå»è°ƒç”¨å®ƒã€‚å°±åƒè°ƒç”¨ä¸€ä¸ªå­ä¾‹ç¨‹é‚£æ ·, ä½¿ç”¨ \u0026amp; ç¬¦å·: \u0026amp; åé¢è·Ÿæ­£åˆ™è¡¨è¾¾å¼çš„åå­—, å³ \u0026amp;regex_nameã€‚\nregex ä¸æ˜¯å‘½åæ­£åˆ™ä»…æœ‰çš„æ ‡è¯†ç¬¦ \u0026ndash; å®é™…ä¸Š, å®ƒç”¨çš„ä¸å¤š. å¤§å¤šæ•°æ—¶å€™, ç”¨çš„æœ€å¤šçš„æ˜¯ token å’Œ rule æ ‡è¯†ç¬¦. å®ƒä»¬éƒ½æ˜¯ä¸èƒ½å›æº¯çš„, è¿™æ„å‘³ç€æ­£åˆ™å¼•æ“åœ¨åŒ¹é…å¤±è´¥æ—¶ä¸ä¼šå¤‡ä»½å’Œé‡è¯•. è¿™é€šå¸¸æ˜¯ä½ æƒ³è¦çš„, ä½†ä¸æ˜¯å¯¹æ‰€æœ‰åœºåˆéƒ½åˆé€‚:\nmy regex works-but-slow {.+q } my token fails-but-fast {.+q } # Tokens ä¸ä¼šæ²¿åŸè·¯è¿”å›, è¿™è®©å®ƒä»¬æ›´å¿«åœ°å¤±è´¥! my $s = \u0026#39;Tokens won\\\u0026#39;t backtrack, which makes them fail quicker!\u0026#39;; say so $s ~~ \u0026amp;works-but-slow; # True say so $s ~~ \u0026amp;fails-but-fast; # False, the entire string get taken by the .+ token å’Œ rule æ ‡è¯†ç¬¦çš„ä¸åŒä¹‹å¤„åœ¨äº rule æ ‡è¯†ç¬¦è®© Regex çš„ :sigspace èµ·ä½œç”¨äº†:\nmy token non-space-y {once upon a time } my rule space-y {once upon a time } say \u0026#39;onceuponatime\u0026#39; ~~ \u0026amp;non-space-y; say \u0026#39;once upon a time\u0026#39; ~~ \u0026amp;space-y; Action Classes å®é™…ä¸Š, å‘½åæ­£åˆ™ç”šè‡³èƒ½æ¥å—é¢å¤–çš„å‚æ•°, å®ƒä½¿ç”¨çš„è¯­æ³•è·Ÿå­ä¾‹ç¨‹å‚æ•°åˆ—è¡¨çš„è¯­æ³•ä¸€æ ·.\nâ€‹å†™ä¸€ä¸ªç¨‹åºæ‰“å°ä» 1 åˆ° 100 çš„æ•´æ•°ï¼Œä½†æ˜¯å¯¹ 3 çš„å€æ•°æ‰“å° \u0026ldquo;Fizz\u0026rdquo;, å¯¹ 5 çš„å€æ•°æ‰“å° \u0026ldquo;Buzz\u0026rdquo;, å¯¹äºå³æ˜¯ 3 çš„å€æ•°ï¼Œåˆæ˜¯ 5 çš„å€æ•°çš„æ‰“å° \u0026ldquo;FizzBuzz\u0026rdquo;.\nfor 1 .. 100 { when $_ %% (3 \u0026amp; 5) { say \u0026#39;FizzBuzz\u0026#39;; } when $_ %% 3 { say \u0026#39;Fizz\u0026#39;; } when $_ %% 5 { say \u0026#39;Buzz\u0026#39;; } default { .say; } } Or abusing multi subs:\nmulti sub fizzbuzz(Int $ where * %% 15) { \u0026#39;FizzBuzz\u0026#39; } multi sub fizzbuzz(Int $ where * %% 5) { \u0026#39;Buzz\u0026#39; } multi sub fizzbuzz(Int $ where * %% 3) { \u0026#39;Fizz\u0026#39; } multi sub fizzbuzz(Int $number ) { $number } (1 .. 100)Â».\u0026amp;fizzbuzz.join(\u0026#34;\\n\u0026#34;).say; Most concisely:\nsay \u0026#39;Fizz\u0026#39; x $_ %% 3 ~ \u0026#39;Buzz\u0026#39; x $_ %% 5 || $_ for 1 .. 100; And here\u0026rsquo;s an implementation that never checks for divisibility:\n.say for ((\u0026#39;\u0026#39; xx 2, \u0026#39;Fizz\u0026#39;) xx * Z~ (\u0026#39;\u0026#39; xx 4, \u0026#39;Buzz\u0026#39;) xx *) Z||1 .. 100; ","permalink":"https://ohmyweekly.github.io/notes/2015-03-16-features-in-raku/","tags":["rakulang"],"title":"Raku ä¸­çš„ç‰¹æ€§(äºŒ)"},{"categories":["rakulang"],"contents":"ä¸€ä¸ªæ—¥å† #!/usr/bin/env raku constant @months = \u0026lt;January February March April May June July August September October November December\u0026gt;; constant @days = \u0026lt;Su Mo Tu We Th Fr Sa\u0026gt;; sub center(Str $text, Int $width) { my $prefix = \u0026#39;\u0026#39; x ($width - $text.chars) div 2; my $suffix = \u0026#39;\u0026#39; x $width - $text.chars - $prefix.chars; return $prefix ~ $text ~ $suffix; } sub MAIN(:$year = Date.today.year, :$month = Date.today.month) { my $dt = Date.new(:year($year), :month($month), :day(1) ); my $ss = $dt.day-of-week % 7; my @slots = \u0026#39;\u0026#39;.fmt(\u0026#34;%2s\u0026#34;) xx $ss; my $days-in-month = $dt.days-in-month; for $ss ..^ $ss + $days-in-month { @slots[$_] = $dt.day.fmt(\u0026#34;%2d\u0026#34;); $dt++ } my $weekdays = @days.fmt(\u0026#34;%2s\u0026#34;).join: \u0026#34;\u0026#34;; say center(@months[$month-1] ~ \u0026#34;\u0026#34; ~ $year, $weekdays.chars); say $weekdays; for @slots.kv -\u0026gt; $k, $v { print \u0026#34;$v\u0026#34;; print \u0026#34;\\n\u0026#34; if ($k+1) %% 7 or $v == $days-in-month; } } Bags and Sets è¿‡å»å‡ å¹´, æˆ‘å†™äº†å¾ˆå¤šè¿™ç§ä»£ç çš„å˜ç§ï¼š\nmy %words; for slurp.comb(/\\w+/).map(*.lc) -\u0026gt; $word { %words{$word}++; } (æ­¤å¤–: slurp.comb(/\\w+/).map(*.lc) ä»æŒ‡å®šçš„æ ‡å‡†è¾“å…¥æˆ–å‘½ä»¤è¡Œè¯»å–æ–‡ä»¶, éå†æ•°æ®ä¸­çš„å•è¯, ç„¶åå°å†™åŒ–è¯¥å•è¯ã€‚ eg: raku slurp.pl score.txt)\nRaku å¼•å…¥äº†ä¸¤ç§æ–°çš„ç»„åˆç±»å‹æ¥å®ç°è¿™ç§åŠŸèƒ½ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹, åŠè·¯æ€å‡ºä¸ª KeyBag ä»£æ›¿äº† hash:\nmy %words := KeyBag.new; for slurp.comb(/\\w+/).map(*.lc) -\u0026gt; $word { %words{$word}++; } è¿™ç§æƒ…å†µä¸‹, ä¸ºä»€ä¹ˆä½ ä¼šå–œæ¬¢ KeyBag å¤šäºæ•£åˆ—å‘¢, éš¾é“æ˜¯å‰è€…ä»£ç æ›´å¤šå—ï¼Ÿå¾ˆå¥½, å¦‚æœä½ æƒ³è¦çš„æ˜¯ä¸€ä¸ªæ­£æ•´æ•°å€¼çš„æ•£åˆ—çš„è¯, KeyBag å°†æ›´å¥½åœ°è¡¨è¾¾å‡ºä½ çš„æ„æ€ã€‚\n%words{\u0026#34;the\u0026#34;} = \u0026#34;green\u0026#34;; æœªå¤„ç†è¿‡çš„å¼‚å¸¸ï¼šä¸èƒ½è§£ææ•°å­—ï¼šgreen\nç„¶è€Œ KeyBag æœ‰å‡ æ¡é”¦å›Šå¦™è®¡ã€‚é¦–å…ˆ, å››è¡Œä»£ç åˆå§‹åŒ–ä½ çš„ KeyBag ä¸æ˜¯å¾ˆç½—å—¦, ä½†æ˜¯ Raku èƒ½è®©å®ƒå…¨éƒ¨å†™åœ¨ä¸€è¡Œä¹Ÿä¸ä¼šæœ‰é—®é¢˜ï¼š\nmy %words := KeyBag.new(slurp.comb(/\\w+/).map(*.lc)); KeyBag.new å°½åŠ›æŠŠæ”¾åˆ°å®ƒé‡Œé¢çš„ä¸œè¥¿å˜æˆ KeyBag çš„å†…å®¹ã€‚ç»™å‡ºä¸€ä¸ªåˆ—è¡¨, åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½ä¼šè¢«æ·»åŠ åˆ° KeyBag ä¸­, ç»“æœå’Œä¹‹å‰çš„ä»£ç å—æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚\nå¦‚æœä½ ä¸éœ€è¦åœ¨åˆ›å»ºbagåå»ä¿®æ”¹å®ƒ, ä½ å¯ä»¥ä½¿ç”¨ Bag æ¥ä»£æ›¿ KeyBagã€‚ä¸åŒä¹‹å¤„æ˜¯ Bag æ˜¯ä¸ä¼šæ”¹å˜çš„ï¼›å¦‚æœ %words æ˜¯ä¸€ä¸ª Bag, åˆ™ %words{$word}++ æ˜¯éæ³•çš„ã€‚å¦‚æœå¯¹ä½ çš„ç¨‹åºæ¥è¯´, ä¸å˜æ²¡æœ‰é—®é¢˜çš„è¯, é‚£ä½ å¯ä»¥è®©ä»£ç æ›´ç´§å‡‘ã€‚\nmy %words := bag slurp.comb(/\\w+/).map(*.lc); # æ•£åˆ— %words ä¸ä¼šå†å˜åŒ– bag æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å­ä¾‹ç¨‹, å®ƒåªæ˜¯å¯¹ä»»ä½•ä½ ç»™å®ƒçš„ä¸œè¥¿ä¸Šè°ƒç”¨ Bag.new æ–¹æ³•ã€‚ï¼ˆæˆ‘ä¸æ¸…æ¥šä¸ºä»€ä¹ˆæ²¡æœ‰åŒæ ·åŠŸèƒ½çš„ keybag å­ä¾‹ç¨‹ï¼‰\nBag å’Œ KeyBag æœ‰å‡ ä¸ªé›•è™«å°æŠ€ã€‚å®ƒä»¬éƒ½æœ‰å®ƒä»¬è‡ªå·±çš„ .roll å’Œ .pick æ–¹æ³•, ä»¥æ ¹æ®ç»™å®šçš„å€¼æ¥æƒè¡¡å®ƒä»¬çš„ç»“æœï¼š\n\u0026gt; my $bag = bag \u0026quot;red\u0026quot; =\u0026gt; 2, \u0026quot;blue\u0026quot; =\u0026gt; 10; \u0026gt; say $bag.roll(10); \u0026gt; say $bag.pick(*).join(\u0026quot; \u0026quot;); blue blue blue blue blue blue red blue red blue blue red blue blue red blue blue blue blue blue blue blue This wouldnâ€™t be too hard to emulate using a normal Array, but this version would be: \u0026gt; $bag = bag \u0026quot;red\u0026quot; =\u0026gt; 20000000000000000001, \u0026quot;blue\u0026quot; =\u0026gt; 100000000000000000000; \u0026gt; say $bag.roll(10); \u0026gt; say $bag.pick(10).join(\u0026quot; \u0026quot;); blue blue blue blue red blue red blue blue blue blue blue blue red blue blue blue red blue blue sub MAIN($file1, $file2) { my $words1 = bag slurp($file1).comb(/\\w+/).map(*.lc); my $words2 = set slurp($file2).comb(/\\w+/).map(*.lc); my $unique = ($words1 (-) $words2); for $unique.list.sort({ -$words1{$_} })[^10] -\u0026gt; $word { say \u0026#34;$word:{ $words1{$word}}\u0026#34;; } } ä¼ é€’ä¸¤ä¸ªæ–‡ä»¶å, è¿™ä½¿å¾— Bag ä»ç¬¬ä¸€ä¸ªæ–‡ä»¶ä¸­è·å–å•è¯, è®© Set ä»ç¬¬äºŒä¸ªæ–‡ä»¶ä¸­è·å–å•è¯, ç„¶åä½¿ç”¨ é›†åˆå·® æ“ä½œç¬¦ (-) æ¥è®¡ç®—åªåœ¨ç¬¬ä¸€ä¸ªæ–‡ä»¶ä¸­å«æœ‰çš„å•è¯, æŒ‰é‚£äº›å•è¯å‡ºç°çš„é¢‘ç‡æ’åº, ç„¶åæ‰“å°å‡ºå‰10 ä¸ªå•è¯ã€‚\nè¿™æ˜¯ä»‹ç» Set çš„æœ€å¥½æ—¶æœºã€‚å°±åƒä½ ä»ä¸Šé¢çŒœåˆ°çš„ä¸€æ ·, Set è·Ÿ Bag çš„ä½œç”¨å¾ˆåƒã€‚ä¸åŒçš„åœ°æ–¹åœ¨äº, å®ƒä»¬éƒ½æ˜¯æ•£åˆ—, è€Œ Bag æ˜¯ä»Anyåˆ°æ­£æ•´æ•°çš„æ˜ å°„, Set æ˜¯ä» Any åˆ° Bool::True çš„æ˜ å°„ã€‚é›†åˆ Set æ˜¯ä¸å¯æ”¹å˜çš„, æ‰€ä»¥ä¹Ÿæœ‰ä¸€ä¸ª å¯å˜çš„ KeySetã€‚\nåœ¨ Set å’Œ Bag ä¹‹é—´, æˆ‘ä»¬æœ‰å¾ˆä¸°å¯Œçš„æ“ä½œç¬¦ï¼š\næ“ä½œç¬¦\tUnicode\tâ€œTexasâ€\tç»“æœç±»å‹ å±äº\tâˆˆ\t(elem)\tBool ä¸å±äº\tâˆ‰\t!(elem)\tBool åŒ…å«\tâˆ‹\t(cont)\tBool ä¸åŒ…å«\tâˆŒ\t!(cont)\tBool å¹¶é›†\tâˆª\t(|)\tSet æˆ– Bag äº¤é›†\tâˆ©\t(\u0026amp;)\tSet æˆ– Bag å·®é›†\t(-)\tSet å­é›†\tâŠ†\t(\u0026lt;=)\tBool éå­é›†\tâŠˆ\t!(\u0026lt;=)\tBool çœŸå­é›†\tâŠ‚\t(\u0026lt;)\tBool éçœŸå­é›†\tâŠ„\t!(\u0026lt;)\tBool è¶…çº§\tâŠ‡\t(\u0026gt;=)\tBool éè¶…çº§\tâŠ‰\t!(\u0026gt;=)\tBool çœŸè¶…çº§\tâŠƒ\t(\u0026gt;)\tBool éçœŸè¶…çº§\tâŠ…\t!(\u0026gt;)\tBool bag multiplication\tâŠ\t(.)\tBag bag addition\tâŠ\t(+)\tBag set symmetric difference (^)\tSet å®ƒä»¬ä¸­çš„å¤§å¤šæ•°éƒ½èƒ½ä¸è¨€è‡ªæ˜ã€‚è¿”å› Set çš„æ“ä½œç¬¦åœ¨åšè¿ç®—å‰ä¼šå°†å®ƒä»¬çš„å‚æ•°æå‡ä¸º Setã€‚è¿”å› Bag çš„æ“ä½œç¬¦åœ¨åšè¿ç®—å‰ä¼šå°†å®ƒä»¬çš„å‚æ•°æå‡ä¸º Bagã€‚è¿”å› Set æˆ– Bag çš„æ“ä½œç¬¦åœ¨åšè¿ç®—å‰ä¼šå°†å®ƒä»¬çš„å‚æ•°æå‡ä¸º Bag, å¦‚æœå®ƒä»¬ä¸­è‡³å°‘æœ‰ä¸€ä¸ªæ˜¯ Bag æˆ– KeyBag, å¦åˆ™ä¼šè½¬æ¢ä¸º Setï¼›åœ¨ä»»ä½•ä¸€ç§æƒ…å†µä¸‹, å®ƒä»¬éƒ½è¿”å›æå‡åçš„ç±»å‹ã€‚\n\u0026gt; my $a = bag \u0026lt;a a a b b c\u0026gt;; # bag(a(3), b(2), c) \u0026gt; my $b = bag \u0026lt;a b b b\u0026gt;; # bag(a, b(3)) \u0026gt; $a (|) $b; bag(\u0026quot;a\u0026quot; =\u0026gt; 3, \u0026quot;b\u0026quot; =\u0026gt; 3, \u0026quot;c\u0026quot; =\u0026gt; 1) \u0026gt; $a (\u0026amp;) $b; bag(\u0026quot;a\u0026quot; =\u0026gt; 1, \u0026quot;b\u0026quot; =\u0026gt; 2) \u0026gt; $a (+) $b; bag(\u0026quot;a\u0026quot; =\u0026gt; 4, \u0026quot;b\u0026quot; =\u0026gt; 5, \u0026quot;c\u0026quot; =\u0026gt; 1) \u0026gt; $a (.) $b; bag(\u0026quot;a\u0026quot; =\u0026gt; 3, \u0026quot;b\u0026quot; =\u0026gt; 6) ä¸‹é¢æ˜¯ä½œè€…æ”¾åœ¨ githubä¸Šçš„ Demo\nA quick example of getting the 10 most common words in Hamlet which are not found in Much Ado About Nothing:\n\u0026gt; raku bin/most-common-unique.pl data/Hamlet.txt data/Much_Ado_About_Nothing.txt ham: 358 queen: 119 hamlet: 118 hor: 111 pol: 86 laer: 62 oph: 58 ros: 53 horatio: 48 clown: 47\nè¶…æ£’çš„åŒ¿åå‡½æ•° Raku å¯¹å‡½æ•°æœ‰å¾ˆå¥½çš„æ”¯æŒã€‚Raku ä»¤äººæƒŠå¹çš„æŠŠå‡½æ•°å£°æ˜åŒ…èµ·æ¥, è®©ä½ å¯ä»¥ç”¨å„ç§æ–¹æ³•æ¥å®šä¹‰ä¸€ä¸ªå‡½æ•°åˆä¸ä¸¢å¤±ä»»ä½•ç‰¹æ€§ã€‚ä½ å¯ä»¥å®šä¹‰å‚æ•°ç±»å‹ã€å¯é€‰å‚æ•°ã€å‘½åå‚æ•°, ç”šè‡³åœ¨å­å¥é‡Œä¹Ÿå¯ä»¥ã€‚å¦‚æœæˆ‘ä¸çŸ¥é“æ›´å¥½çš„ç†ç”±çš„è¯, æˆ‘å¯èƒ½éƒ½åœ¨æ€€ç–‘è¿™æ˜¯ä¸æ˜¯åœ¨è¡¥å¿ Perl5 é‡Œé‚£ä¸ªç›¸å½“åŸºæœ¬çš„å‚æ•°å¤„ç†ï¼ˆå’³å’³ , @_, ä½ æ‡‚çš„ï¼‰ã€‚ é™¤å¼€è¿™äº›, Raku ä¹Ÿå…è®¸ä½ å®šä¹‰æ²¡æœ‰å‘½åçš„å‡½æ•°ã€‚\nsub {say \u0026#34;lol, I\u0026#39;m so anonymous!\u0026#34; } è¿™æœ‰ä»€ä¹ˆç”¨ï¼Ÿä½ ä¸å‘½åå®ƒ, å°±æ²¡æ³•è°ƒç”¨å®ƒå•Š, å¯¹ä¸ï¼Ÿé”™ï¼\nä½ å¯ä»¥ä¿å­˜è¿™ä¸ªå‡½æ•°åˆ°ä¸€ä¸ªå˜é‡é‡Œã€‚æˆ–è€…ä»å¦ä¸€ä¸ªå‡½æ•°é‡Œ return è¿™ä¸ªå‡½æ•°ã€‚æˆ–è€…ä¼ å‚ç»™ä¸‹ä¸€ä¸ªå‡½æ•°ã€‚äº‹å®ä¸Š, å½“ä½ ä¸å‘½åä½ çš„å‡½æ•°çš„æ—¶å€™, ä½ éšåè¦è¿è¡Œä»€ä¹ˆä»£ç å°±å˜å¾—éå¸¸æ¸…æ™°äº†ã€‚å°±åƒä¸€ä¸ªå¯æ‰§è¡Œçš„ \u0026ldquo;todo\u0026rdquo; åˆ—è¡¨ä¸€æ ·ã€‚\nç°åœ¨è®©æˆ‘ä»¬è¯´è¯´åŒ¿åå‡½æ•°å¯ä»¥ç»™æˆ‘ä»¬åšç‚¹ä»€ä¹ˆã€‚åœ¨ Raku é‡Œå®ƒçœ‹èµ·æ¥ä¼šæ˜¯ä»€ä¹ˆæ ·å­å‘¢ï¼Ÿ\nå—¯, å°±ç”¨æœ€è‘—åçš„æ’åºæ¥åšä¾‹å­å§ã€‚ä½ å¯èƒ½æƒ³è±¡ Raku æœ‰ä¸€ä¸ª sort_lexicographically å‡½æ•°å’Œä¸€ä¸ª sort_numberically å‡½æ•°ã€‚ä¸è¿‡å…¶å®æ²¡æœ‰ã€‚åªæœ‰ä¸€ä¸ª sort å‡½æ•°ã€‚å½“ä½ éœ€è¦å…·ä½“ç”¨æŸç§å½¢å¼çš„æ’åºæ—¶, ä½ å°±å¯ä»¥ä¼ é€’ä¸€ä¸ªåŒ¿åå‡½æ•°ç»™ sort ã€‚\nmy @sorted_words = @words.sort({ ~$_ }); my @sorted_numbers = @numbers.sort({ +$_ }); ï¼ˆä»æŠ€æœ¯ä¸Šæ¥è¯´, è¿™æ˜¯å—, ä¸æ˜¯å‡½æ•°ã€‚ä¸è¿‡å¦‚æœä½ ä¸æ‰“ç®—åœ¨é‡Œé¢ä½¿ç”¨ return çš„è¯, å·®å¼‚ä¸å¤§ã€‚ï¼‰ å½“ç„¶ä½ å¯ä»¥åšçš„æ¯”è¿™ä¸¤ä¸ªæ’åºåŠæ³•å¤šå¤šäº†ã€‚ä½ å¯ä»¥é€šè¿‡é‹å­å¤§å°æ’åº, æˆ–è€…æœ€å¤§åœ°é¢é€Ÿåº¦, æˆ–è€…è‡ªç‡ƒå¯èƒ½æ€§çš„é™åºç­‰ç­‰ã€‚å› ä¸ºä½ å¯ä»¥æŠŠä»»ä½•é€»è¾‘ä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ é€’è¿›å»ã€‚é¢å‘å¯¹è±¡çš„æ•™å¾’ä»¬å¯¹è¿™ç§æ¨¡å¼å¯éå¸¸è‡ªè±ª, è¿˜ä¸“é—¨å‘½åä¸ºâ€œä¾èµ–æ³¨å…¥â€ã€‚\næƒ³æƒ³çœ‹, mapã€ grep å’Œ reduce éƒ½å¾ˆä¾èµ–è¿™ç§å‡½æ•°ä¼ é€’ã€‚æˆ‘ä»¬æœ‰æ—¶å€™æŠŠè¿™ç§ä¼ é€’å‡½æ•°ç»™å‡½æ•°çš„åšæ³•å«â€œé«˜é˜¶ç¼–ç¨‹â€, å¥½åƒè¿™æ˜¯æŸäº›é«˜æ‰‹çš„ç‰¹æƒä¼¼çš„ã€‚ä½†å…¶å®è¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰ç”¨è€Œä¸”å¯ä»¥æ™®é€šä½¿ç”¨çš„æŠ€èƒ½ã€‚\nä¸Šé¢çš„ç¤ºä¾‹éƒ½æ˜¯åœ¨å½“å‰æ‰§è¡Œæ—¶å°±è¿è¡Œå‡½æ•°äº†ã€‚å…¶å®è¿™é‡Œæ²¡ä»€ä¹ˆé™åˆ¶ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºå‡½æ•°, ç„¶åç¨åå†è¿è¡Œï¼š\nsub make_surprise_for($name) { return sub { say \u0026#34;Sur-priiise, $name!\u0026#34; }; } my $reveal_surprise = make_surprise_for(\u0026#34;Finn\u0026#34;); # # ç›®å‰ä»€ä¹ˆéƒ½æ²¡å‘ç”Ÿ # ç­‰ç€ # ç»§ç»­ç­‰ç€ # ç­‰å•Šç­‰å•Šç­‰å•Š $reveal_surprise(); # \u0026#34;Sur-priiise, Finn!\u0026#34; $reveal_surpirse é‡Œçš„å‡½æ•°è®°ä½äº† $name å˜é‡å€¼, è™½ç„¶åŸå§‹å‡½æ•°æ˜¯åœ¨å¾ˆæ—©ä¹‹å‰ä¼ é€’è¿›å»çš„å‚æ•°ã€‚æ£’æäº†ï¼è¿™ä¸ªæ•ˆæœå°±å«åœ¨ $name å˜é‡ä¸Šé—­åˆçš„åŒ¿åå‡½æ•°ã€‚ä¸è¿‡è¿™é‡Œå¯æ²¡ä»€ä¹ˆæŠ€æœ¯ - åæ­£å¾ˆæ£’å°±æ˜¯äº†ã€‚\näº‹å®ä¸Š, å¦‚æœæ”¾åœ¨å…¶ä»–ä¸»è¦å­˜å‚¨æœºåˆ¶æ¯”å¦‚æ•°ç»„å’Œæ•£åˆ—æ—è¾¹å†çœ‹åŒ¿åå‡½æ•°æœ¬èº«, è¿™æ„Ÿè§‰æ˜¯å¾ˆè‡ªç„¶çš„äº‹æƒ…ã€‚æ‰€æœ‰è¿™äº›éƒ½å¯ä»¥å­˜å‚¨åœ¨å˜é‡é‡Œ, ä½œä¸ºå‚æ•°ä¼ é€’æˆ–è€…ä»å‡½æ•°é‡Œè¿”å›ã€‚ä¸€ä¸ªåŒ¿åæ•°ç»„å…è®¸ä½ ä¿å­˜åºåˆ—ç»™ä»¥åè°ƒç”¨ã€‚ä¸€ä¸ªåŒ¿åæ•£åˆ—å…è®¸ä½ å­˜å‚¨æ˜ å°„ç»™ä»¥åè°ƒç”¨ã€‚ä¸€ä¸ªåŒ¿åå‡½æ•°å…è®¸ä½ å­˜å‚¨è®¡ç®—æˆ–è€…è¡Œä¸ºç»™ä»¥åè°ƒç”¨ã€‚\næœ¬æœˆæ™šäº›æ—¶å€™, æˆ‘ä¼šå†™ç¯‡ä»‹ç»æ€æ ·é€šè¿‡ Raku çš„åŠ¨æ€åŸŸæ¥åˆ›å»ºæ¼‚äº®çš„ DSL-y æ¥å£ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åŒ¿åå‡½æ•°åœ¨é‚£é‡Œæ˜¯æ€ä¹ˆå‘æŒ¥ä½œç”¨çš„ã€‚\nç¬¬ä¹å¤©:æœ€é•¿æ ‡ç¤ºåŒ¹é… Raku æ­£åˆ™è¡¨è¾¾å¼åå¥½å°½å¯èƒ½çš„åŒ¹é…æœ€é•¿çš„é€‰æ‹©ã€‚\nsay \u0026#34;food and drink\u0026#34; ~~ /foo |food /; # food è¿™è·Ÿ Perl5 ä¸ä¸€æ ·ã€‚Perl5 æ›´å–œæ¬¢ä¸Šé¢ä¾‹å­ä¸­çš„ç¬¬ä¸€ä¸ªé€‰æ‹©, ç»“æœåŒ¹é…çš„æ˜¯ \u0026ldquo;foo\u0026rdquo;ã€‚ å¦‚æœä½ å¸Œæœ›çš„è¯, ä½ ä¾ç„¶å¯ä»¥æŒ‰ç…§ä¼˜å…ˆåŒ¹é…çš„åŸåˆ™è¿è¡Œ, è¿™ä¸ªåŸåˆ™éšè—åœ¨ç¨é•¿é€‰æ‹©æ“ä½œç¬¦ || èƒŒåï¼š\nsay \u0026#34;food and drink\u0026#34; ~~ /foo ||food /; # foo \u0026hellip;å°±æ˜¯è¿™æ ·ã€‚è¿™å°±æ˜¯æœ€é•¿æ ‡è®°åŒ¹é…ã€‚ â˜º çŸ­æ–‡å®Œæ¯•ã€‚\nâ€œå–‚, ç­‰ç­‰ï¼â€ä½ å¬è§ä½ ç»æœ›è€ŒæƒŠè®¶çš„å¤§å«äº†, æ»¡è¶³ä½ å¸Œæœ›è®©æ¯å¤©çš„ Raku åœ£ä¸´å†èµ°çš„æ…¢ä¸€ç‚¹çš„æ„¿æœ›ã€‚â€œä¸ºä»€ä¹ˆè¯´æœ€é•¿æ ‡è®°åŒ¹é…å¾ˆé‡è¦ï¼Ÿè°ä¼šåœ¨æ„è¿™ä¸ªï¼Ÿâ€\næˆ‘å¾ˆé«˜å…´ä½ è¿™æ ·é—®ã€‚äº‹å®è¯æ˜, æœ€é•¿æ ‡è®°åŒ¹é…ï¼ˆç®€ç§° LTM ï¼‰åœ¨å¦‚ä½•è§£æçš„æ—¶å€™å’Œæˆ‘ä»¬çš„ç›´è§‰é…åˆç›¸å½“é»˜å¥‘ã€‚å¦‚æœä½ åˆ›é€ äº†ä¸€é—¨è¯­è¨€, ä½ å¸Œæœ›äººä»¬å¯ä»¥å£°æ˜ä¸€ä¸ªå« forest_density çš„å˜é‡è€Œä¸ç”¨æåŠè¿™ä¸ªå•è¯å’Œå¾ªç¯é‡Œç”¨çš„ for è¯­æ³•å†²çª, LTM å¯ä»¥åšåˆ°ã€‚\næˆ‘å–œæ¬¢â€œå¥‡æ€ªçš„ä¸€è‡´æ€§â€è¿™ä¸ªè¯´æ³• - å°¤å…¶å½“ç¨‹åºè¯­è¨€è®¾è®¡çš„å…±æ€§è®©å¤§å®¶è¶Šæ¥è¶Šé›·åŒçš„æ—¶å€™ã€‚è¿™é‡Œå°±æ˜¯ä¸€ç§åœ¨ç±»å’Œè¯­æ³•ä¹‹é—´çš„ä¸€è‡´æ€§ã€‚ Raku åŸºæœ¬ä¸ŠæŠŠè¿™ç§ä¸€è‡´æ€§å‘æŒ¥åˆ°äº†æè‡´ã€‚è®©æˆ‘ç®€å•çš„é˜è¿°ä¸‹æˆ‘çš„æ„æ€ã€‚ ç°åœ¨æˆ‘ä»¬ä¹ æƒ¯äºå†™ä¸€ä¸ªç±», æ€»ä½“æ¥çœ‹, ç±»å·®ä¸å¤šæ˜¯é•¿è¿™ä¸ªæ ·å­çš„ï¼š\nclass { method method method } å¥‡æ€ªçš„æ˜¯, è¯­æ³•æœ‰ä¸ªéå¸¸ç±»ä¼¼çš„ç»“æ„ï¼š\ngrammar { rule rule rule } (å®é™…ä¸Šå…³é”®è¯æœ‰ regex, token å’Œ rule, ä¸è¿‡å½“æˆ‘ä»¬æŠŠä»–å½“ä½œä¸€ä¸ªç»„æ¥è®¨è®ºçš„æ—¶å€™, æˆ‘ä»¬æš‚æ—¶ç»Ÿä¸€å«åš rules)\næˆ‘ä»¬åŒæ ·ä¹ æƒ¯äºæ´¾ç”Ÿå­ç±»ï¼ˆclass B is Aï¼‰, ç„¶åæ·»åŠ æˆ–è€…é‡å†™æ–¹æ³•æ¥äº§ç”Ÿä¸€ä¸ªæ–°æ—§è¡Œä¸ºåœ¨ä¸€èµ·çš„ç»„åˆã€‚Pelr6 æä¾›äº† multi methods , å®ƒå…è®¸ä½ æ·»åŠ ç›¸åŒåå­—çš„æ–°æ–¹æ³•, è€Œä¸”ä¸é‡å†™åŸæœ‰çš„, å®ƒåªå°è¯•åŒ¹é…æ‰€æœ‰çš„åˆ°æ–°æ–¹æ³•è€Œå·²ã€‚è¿™ä¸ªè°ƒåº¦æ˜¯ç”±ä¸€ä¸ªï¼ˆé€šå¸¸è‡ªåŠ¨ç”Ÿæˆçš„ï¼‰ proto method å¤„ç†çš„ã€‚å®ƒè´Ÿè´£è°ƒåº¦ç»™æ‰€æœ‰åˆæ ¼çš„å€™é€‰è€…ã€‚\nè¿™äº›æ˜¯æ€æ ·ç”¨è¯­æ³•å’Œè§’è‰²è¿è¡Œèµ·æ¥çš„å‘¢ï¼Ÿé¢, é¦–å…ˆå®ƒä»åŸæœ‰çš„é‡Œé¢æ´¾ç”Ÿå‡ºæ–°çš„è¯­æ³•, å’Œæ´¾ç”Ÿå­ç±»ä¸€æ ·ã€‚ï¼ˆäº‹å®ä¸Š, åº•å±‚æ˜¯ å®Œå…¨ ç›¸åŒçš„æœºåˆ¶ã€‚è¯­æ³•ä¸è¿‡æ˜¯æœ‰ä¸ªä¸åŒå…ƒç±»å¯¹è±¡çš„ç±»ç½¢äº†ã€‚ï¼‰æ–°çš„è§’è‰²ä¹Ÿä¼šé‡å†™åŸæœ‰çš„è§’è‰², å’Œä½ åœ¨æ–¹æ³•ä¸Šä¹ æƒ¯çš„ä¸€æ ·ã€‚\nS05 æœ‰ä¸ªæ¼‚äº®çš„è§£æä¿¡ä»¶çš„ç¤ºä¾‹ã€‚ç„¶åæ´¾ç”Ÿå‡ºæ¥è§£ææ­£å¼ä¿¡ä»¶çš„è¯­æ³•ï¼š\ngrammar Letter { rule text {} rule greet {[Hi|Hey|Yo]$=(\\S+?), $$} rule body {+?} # note: backtracks forwards via +? rule close {Later dude, $=(.+)} } grammar FormalLetter is Letter { rule greet {Dear $=(\\S+?), $$} rule close {Yours sincerely, $=(.+)} } æ´¾ç”Ÿå‡ºæ¥çš„ FormalLetter é‡å†™äº† greet å’Œ close, ä½†æ˜¯æ²¡é‡å†™ bodyã€‚\nä½†æ˜¯è¿™ä¸€åˆ‡åœ¨ multi æ–¹æ³•ä¸‹ä¹Ÿèƒ½æ­£å¸¸è¿è¡Œå—ï¼Ÿæˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥å®šä¹‰ä¸€ç§â€œåŸå‹è§’è‰²â€æ¥å…è®¸æˆ‘ä»¬åœ¨ä¸€ä¸ªè¯­æ³•é‡Œç”¨åŒæ ·çš„åå­—æœ‰å¤šç§è§’è‰², å†…å®¹å„ä¸ç›¸åŒï¼Ÿæ¯”å¦‚, æˆ‘ä»¬å¯èƒ½å¸Œæœ›ç”¨ä¸€ä¸ªè§’è‰² term æ¥è§£æè¯­è¨€, ä¸è¿‡æœ‰å¾ˆå¤šä¸åŒçš„ termsï¼šå­—ç¬¦ä¸²ã€æ•°å­—â€¦â€¦è€Œä¸”æ•°å­—å¯èƒ½æ˜¯åè¿›åˆ¶ã€äºŒè¿›åˆ¶ã€å…«è¿›åˆ¶ã€åå…­è¿›åˆ¶ç­‰â€¦â€¦\nRaku è¯­æ³•å¯ä»¥åŒ…å«ä¸€ä¸ªåŸå‹è§’è‰², ç„¶åä½ å¯ä»¥å®šä¹‰ã€é‡å®šä¹‰åŒåè§’è‰²éšä¾¿å¤šå°‘æ¬¡ã€‚æ˜¾ç„¶è®©æˆ‘ä»¬å›åˆ°æ–‡ç« æœ€å¼€å§‹çš„ / foo | food /ã€‚æ‰€æœ‰ä½ èµ·äº†ç›¸åŒåå­—çš„è§’è‰²ä¼šç¼–è¯‘æˆä¸€ä¸ªå¤§çš„ alternationã€‚\nä¸ä»…å¦‚æ­¤ - è°ƒç”¨å…¶ä»–è§’è‰²çš„è§’è‰², æœ‰äº›å¯èƒ½æ˜¯åŸå‹è§’è‰², è¿™äº›ä¹Ÿä¼šå…¨éƒ¨æ‰å¹³åŒ–åˆ°ä¸€ä¸ªå¤§çš„ LTM è½®æµé€‰æ‹©é‡Œã€‚å®è·µä¸­, è¿™æ„å‘³ç€ä¸€ä¸ª term çš„æ‰€æœ‰å¯èƒ½ä¼šä¸€æ¬¡è¢«å…¨éƒ¨å°è¯•ä¸€é, æœºä¼šå¹³ç­‰ã€‚æ²¡å“ªä¸ªä¼šå› ä¸ºè‡ªå·±æ˜¯å…ˆå®šä¹‰çš„æ‰€ä»¥èƒœå‡º, åªæœ‰æœ€é•¿åŒ¹é…çš„é‚£ä¸ªé€‰æ‹©æ‰èƒœå‡ºã€‚\nè¿™ä¸ªå¥‡æ€ªçš„ä¸€è‡´æ€§è¯´æ˜äº‹å®ä¸Š, åœ¨è°ƒç”¨æŸä¸ªæ–¹å¼çš„æ—¶å€™, æœ€å…·ä½“çš„æ–¹æ³•èƒœå‡º, è€Œä¸”è¿™ä¸ªâ€œæœ€å…·ä½“â€å¿…é¡»åŠ ä¸Šå¼•å·ã€‚ç­¾åé‡Œå‚æ•°æè¿°ç±»å‹è¶Šå¥½, æ–¹æ³•å°±è¶Šå…·ä½“ã€‚\nåœ¨åˆ†ææŸä¸ªè§’è‰²çš„æ—¶å€™, åŒæ ·æ˜¯æœ€å…·ä½“çš„è§’è‰²èƒœå‡º, ä¸è¿‡è¿™é‡Œâ€œæœ€å…·ä½“â€å¿…é¡»æˆåŠŸè§£ææ‰è¡Œã€‚è§’è‰²æè¿°ä¸‹ä¸€æ­¥è¿›å…¥çš„æ–‡æœ¬è¶Šè¯¦ç»†, è§’è‰²å°±è¶Šå…·ä½“ã€‚\nè¿™å°±æ˜¯å¥‡æ€ªçš„ä¸€è‡´æ€§ã€‚å› ä¸ºè¡¨é¢ä¸Šæ–¹æ³•å’Œè§’è‰²çœ‹èµ·æ¥å°±æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„æ€ªå…½ã€‚\næˆ‘ä»¬çœŸå¿ƒç›¸ä¿¡æˆ‘ä»¬ç†è§£äº†æ´¾ç”Ÿè¯­æ³•çš„åŸç†å¹¶ä¸”å¾—åˆ°äº†ä¸€é—¨æ–°çš„è¯­è¨€ã€‚ LTM å°±æ˜¯æœ€åˆé€‚çš„å› ä¸ºå®ƒå…è®¸æ–°æ—§è§’è‰²é€šè¿‡ä¸€ä¸ªå…¬å¹³å’Œå¯é¢„æµ‹çš„åŠæ³•æ··æ‚åœ¨ä¸€èµ·ã€‚è§’è‰²ä¸æ˜¯å› ä¸ºä»–ä»¬å®šä¹‰çš„å‰åè€Œèƒœå‡º, è€Œæ˜¯å› ä¸ºå®ƒèƒ½æœ€å¥½çš„è§£ææ–‡æœ¬ã€‚è¿™æ‰æ˜¯æŒ‘é€‰ç²¾è‹±çš„åŠæ³•ã€‚\näº‹å®ä¸Š, Raku ç¼–è¯‘å™¨è‡ªå·±å°±æ˜¯è¿™æ ·å·¥ä½œçš„ã€‚å®ƒä½¿ç”¨ Raku è¯­æ³•è§£æä½ çš„ç¨‹åº, è¿™ä¸ªè¯­æ³•æ˜¯å¯ä»¥æ´¾ç”Ÿçš„â€¦â€¦ä¸ç®¡ä½ åœ¨ç¨‹åºé‡Œä»€ä¹ˆæ—¶å€™å£°æ˜äº†ä¸€ä¸ªæ–°æ“ä½œç¬¦, éƒ½ä¼šç»™ä½ æ´¾ç”Ÿå‡ºä¸€ä¸ªæ–°çš„è¯­æ³•ã€‚æ–°æ“ä½œç¬¦çš„è§£æå°±ä½œä¸ºæ–°è§’è‰²åŠ å…¥åˆ°æ–°è¯­æ³•é‡Œã€‚ç„¶åæŠŠè§£æå‰©ä½™ç¨‹åºçš„ä»»åŠ¡äº¤ç»™æ–°çš„è¯­æ³•ã€‚ä½ çš„æ–°æ“ä½œç¬¦ä¼šèƒœè¿‡é‚£å†™ç›¸åŒä½†åŒ¹é…æ›´çŸ­çš„, ä¸è¿‡è¾“ç»™ç›¸åŒä½†åŒ¹é…æ›´é•¿çš„ã€‚\nå¼€å¼€å¿ƒå¿ƒç© Rakudo å’Œ Euler é¡¹ç›® Raku å®ç°çš„é¢†å…ˆè€… Rakudo , ç›®å‰è¿˜ä¸å®Œç¾, è¯´èµ·æ€§èƒ½ä¹Ÿå°¤å…¶è®©äººå°´å°¬ã€‚ç„¶è€Œå…ˆè¡Œè€…ä¸ä¼šé—®â€œä»–å¿«ä¹ˆï¼Ÿâ€, è€Œä¼šé—®â€œä»–å¤Ÿå¿«ä¹ˆï¼Ÿâ€, ç”šè‡³æ˜¯â€œæˆ‘æ€æ ·èƒ½å¸®ä»–å˜å¾—æ›´å¿«å‘¢ï¼Ÿâ€ã€‚\nä¸ºäº†è¯´æœä½  Rakudo å·²ç»èƒ½åšåˆ°è¶³å¤Ÿå¿«äº†ã€‚æˆ‘ä»¬å‡†å¤‡å°è¯•åšä¸€ç»„ Euler é¡¹ç›®æµ‹è¯•ã€‚å…¶ä¸­å¾ˆå¤šæ¶‰åŠå¼ºè¡Œçš„æ•°å€¼è®¡ç®—, Rakudo ç›®å‰è¿˜ä¸æ˜¯å¾ˆæ“…é•¿ã€‚ä¸è¿‡æˆ‘ä»¬å¯æ²¡å¿…è¦å°±æ­¤é¡¿è¶³ï¼šè¯­è¨€æ€§èƒ½é™ä½äº†, ç¨‹åºå‘˜å°±è¦æ›´å¿ƒçµæ‰‹å·§äº†, è¿™æ­£æ˜¯ä¹è¶£æ‰€åœ¨å•Šã€‚\næ‰€æœ‰çš„ä»£ç éƒ½æ˜¯åœ¨ Rakudo 2012.11 ä¸Šæµ‹è¯•é€šè¿‡çš„ã€‚\nå…ˆä»ä¸€äº›ç®€å•çš„ä¾‹å­å¼€å§‹ã€‚\næƒ³æƒ³æ–æ³¢é‚£å¥‘åºåˆ—é‡Œæ•°å€¼ä¸è¶…è¿‡å››ç™¾ä¸‡çš„å…ƒç´ , è®¡ç®—è¿™äº›å€¼çš„æ€»å’Œã€‚åŠæ³•è¶…çº§ç®€å•ï¼š\nsay [+] grep * %% 2, (1, 2, *+* ...^ * \u0026gt; 4_000_000); è¿è¡Œæ—¶é—´ï¼š0.4ç§’\næ³¨æ„æ€æ ·ä½¿ç”¨æ“ä½œç¬¦æ‰èƒ½è®©ä»£ç å³ç´§å‡‘åˆä¿æŒå¯è¯»æ€§(å½“ç„¶è¿™ç‚¹å¤§å®¶è‚¯å®šæ„è§ä¸ä¸€)ã€‚æˆ‘ä»¬ç”¨äº†ï¼š\n æ— è®ºå¦‚ä½•ç”¨ * åˆ›å»º lambda å‡½æ•° ç”¨åºåˆ—æ“ä½œç¬¦ ...^ æ¥å»ºç«‹æ–æ³¢é‚£å¥‘åºåˆ— ç”¨æ•´é™¤æ“ä½œç¬¦ %% æ¥è¿‡æ»¤å…ƒç´  ç”¨ [+] åš reduce æ“ä½œè®¡ç®—å’Œ  å½“ç„¶, æ²¡äººå¼ºåˆ¶ä½ è¿™æ ·ç–¯ç‹‚çš„ä½¿ç”¨æ“ä½œç¬¦ - é¦™è‰(vanilla)å‘½ä»¤å¼çš„ä»£ç ä¹Ÿæ²¡é—®é¢˜ï¼š\n 600851475143 çš„æœ€å¤§ç´ å› æ•°æ˜¯å¤šå°‘ï¼Ÿ\n å‘½ä»¤å¼çš„è§£å†³æ–¹æ¡ˆæ˜¯è¿™æ ·çš„ï¼š\nsub largest-prime-factor($n is copy) { for 2, 3, *+2 ... * { while $n %% $_ { $n div= $_; return $_ if $_ \u0026gt; $n; } } } say largest-prime-factor(600_851_475_143); è¿è¡Œæ—¶é—´ï¼š2.6ç§’\næ³¨æ„ç”¨çš„ is copy, å› ä¸º Raku çš„ç»‘å®šå‚æ•°é»˜è®¤æ˜¯åªè¯»çš„ã€‚è¿˜æœ‰ç”¨äº†æ•´æ•°é™¤æ³• div, è€Œæ²¡ç”¨æ•°å€¼é™¤æ³•çš„ /ã€‚\nåˆ°ç›®å‰ä¸ºæ­¢éƒ½æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„, æˆ‘ä»¬ç»§ç»­:\nnä»1åˆ°100, nCrçš„å€¼, ä¸ä¸€å®šè¦æ±‚ä¸åŒ, æœ‰å¤šå°‘å¤§äºä¸€ç™¾ä¸‡çš„ï¼Ÿ\næˆ‘ä»¬å°†ä½¿ç”¨ feed æ“ä½œç¬¦ ==\u0026gt; æ¥åˆ†è§£ç®—æ³•æˆè®¡ç®—çš„æ¯ä¸€æ­¥ï¼š\n[1], -\u0026gt; @p { [0, @p Z+ @p, 0] } ... * # ç”Ÿæˆæ¨è¾‰ä¸‰è§’ ==\u0026gt; (*[0..100])() # ç”Ÿæˆ0åˆ°100çš„nè¡Œ ==\u0026gt; map *.list # å¹³é“ºæˆä¸€ä¸ªåˆ—è¡¨ ==\u0026gt; grep * \u0026gt; 1_000_000 # è¿‡æ»¤è¶…è¿‡1000000çš„æ•° ==\u0026gt; elems() # è®¡ç®—ä¸ªæ•° ==\u0026gt; say; # è¾“å‡ºç»“æœ è¿è¡Œæ—¶é—´ï¼š5.2s\næ³¨æ„ä½¿ç”¨äº† Z æ“ä½œç¬¦å’Œ + æ¥å‹ç¼© 0,@p å’Œ @p,0 çš„ä¸¤ä¸ªåˆ—è¡¨ã€‚\nè¿™ä¸ªå•è¡Œç”Ÿæˆæ¨è¾‰ä¸‰è§’çš„å†™æ³•æ˜¯ä» Rosetta ä»£ç é‡Œå·è¿‡æ¥çš„ã€‚é‚£æ˜¯å¦ä¸€ä¸ªä¸é”™çš„é¡¹ç›®, å¦‚æœä½ å¯¹ Raku çš„ç‰‡æ®µç»ƒä¹ å¾ˆæ„Ÿå…´è¶£çš„è¯ã€‚\nè®©æˆ‘ä»¬åšäº›æ›´å·§å¦™çš„ã€‚\nå­˜åœ¨ä¸€ä¸ªæ¯•è¾¾å“¥æ‹‰æ–¯ä¸‰å…ƒæ•°ç»„è®© a +b + c = 1000 ã€‚æ±‚ aã€bã€c çš„å€¼ã€‚\næš´åŠ›ç ´è§£å¯ä»¥å®Œæˆ (Polettix çš„è§£å†³åŠæ³•), ä½†æ˜¯è¿™ä¸ªåŠæ³•ä¸å¤Ÿå¿«ï¼ˆåœ¨æˆ‘æœºå™¨ä¸ŠèŠ±äº†11ç§’å·¦å³ï¼‰ã€‚è®©æˆ‘ä»¬ç”¨ç‚¹ä»£æ•°çŸ¥è¯†æŠŠé—®é¢˜æ›´ç®€å•çš„è§£å†³ã€‚\nå…ˆåˆ›å»ºä¸€ä¸ª (a, b, c) ç»„æˆçš„æ¯•è¾¾å“¥æ‹‰æ–¯ä¸‰å…ƒæ•°ç»„:\na \u0026lt; b \u0026lt; c aÂ² + bÂ² = cÂ² è¦æ±‚ N = a + b +c å°±è¦ç¬¦åˆï¼š\nb = NÂ·(N - 2a) / 2Â·(N - a) c = NÂ·(N - 2a) / 2Â·(N - a) + aÂ²/(N - a) è¿™å°±è‡ªåŠ¨ç¬¦åˆäº† b \u0026lt; c çš„æ¡ä»¶ã€‚ è€Œ a \u0026lt; b çš„æ¡ä»¶åˆ™äº§ç”Ÿä¸‹é¢è¿™ä¸ªçº¦æŸï¼š\na \u0026lt; (1 - 1/âˆš2)Â·N æˆ‘ä»¬å°±å¾—åˆ°ä»¥ä¸‹ä»£ç äº†ï¼š\nsub triplets(\\N) { for 1..Int((1 - sqrt(0.5)) * N) -\u0026gt; \\a { my \\u = N * (N - 2 * a); my \\v = 2 * (N - a); # æ£€æŸ¥ b = u/v æ˜¯å¦æ˜¯æ•´æ•° # å¦‚æœæ˜¯, æˆ‘ä»¬å°±æ‰¾åˆ°äº†ä¸€ä¸ªä¸‰å…ƒæ•°ç»„ if u %% v { my \\b = u div v; my \\c = N - a - b; take $(a, b, c); } } } say [*] .list for gather triplets(1000); è¿è¡Œæ—¶é—´ï¼š0.5s\næ³¨æ„ sigilless å˜é‡ \\N, \\a â€¦â€¦ çš„å£°æ˜, $(...) æ˜¯æ€ä¹ˆç”¨æ¥æŠŠä¸‰å…ƒæ•°ç»„ä½œä¸ºå•ç‹¬å…ƒç´ è¿”å›çš„, ç”¨$_.list çš„ç¼©å†™ .list æ¥æ¢å¤å…¶åˆ—è¡¨æ€§ã€‚\n\u0026amp;triplets å­ä¾‹ç¨‹ä½œä¸ºç”Ÿæˆå™¨, å¹¶ä¸”ä½¿ç”¨ \u0026amp;take åˆ‡æ¢åˆ°ç»“æœã€‚ç›¸åº”çš„ \u0026amp;gather ç”¨æ¥åˆ’å®šç”Ÿæˆå™¨çš„(åŠ¨æ€)ä½œç”¨åŸŸ, è€Œä¸”å®ƒä¹Ÿå¯ä»¥æ”¾è¿› \u0026amp;triplets, è¿™ä¸ªå¯èƒ½è¿”å›ä¸€ä¸ªæƒ°æ€§åˆ—è¡¨ã€‚\næˆ‘ä»¬åŒæ ·å¯ä»¥ä½¿ç”¨æµæ“ä½œç¬¦æ”¹å†™æˆæ•°æ®æµé©±åŠ¨çš„é£æ ¼ï¼š\nconstant N = 1000; 1..Int((1 - sqrt(0.5)) * N) ==\u0026gt; map -\u0026gt; \\a { [ a, N * (N - 2 * a), 2 * (N - a) ] } ==\u0026gt; grep -\u0026gt; [ \\a, \\u, \\v ] { u %% v } ==\u0026gt; map -\u0026gt; [ \\a, \\u, \\v ] { my \\b = u div v; my \\c = N - a - b; a * b * c } ==\u0026gt; say; è¿è¡Œæ—¶é—´ï¼š0.5s\næ³¨æ„æˆ‘ä»¬æ˜¯æ€æ ·ç”¨è§£å‹ç­¾åç»‘å®š -\u0026gt; [...] æ¥è§£å‹ä¼ é€’è¿‡æ¥çš„æ•°ç»„çš„ã€‚\nä½¿ç”¨è¿™ç§ç‰¹æ®Šçš„é£æ ¼æ²¡æœ‰ä»€ä¹ˆå®è´¨çš„å¥½å¤„ï¼šäº‹å®ä¸Šè¿˜å¾ˆå®¹æ˜“å½±å“åˆ°æ€§èƒ½, æˆ‘ä»¬éšåä¼šçœ‹åˆ°ä¸€ä¸ªè¿™æ–¹é¢çš„ä¾‹å­ã€‚ å†™çº¯å‡½æ•°å¼ç®—æ³•æ˜¯ä¸ªè¶…çº§å¥½çš„è·¯å­ã€‚ä¸è¿‡åŸåˆ™ä¸Šè¿™å°±æ„å‘³ç€è®©é‚£äº›è¶³å¤Ÿå…ˆè¿›çš„ä¼˜åŒ–å™¨ä¹±æ¥ï¼ˆæƒ³æƒ³è‡ªåŠ¨å‘é‡åŒ–å’Œçº¿ç¨‹ï¼‰ã€‚ä¸è¿‡ Rakudo è¿˜æ²¡åˆ°è¿™ä¸ªå¤æ‚åœ°æ­¥ã€‚\nä½†æ˜¯å¦‚æœæˆ‘ä»¬æ²¡æœ‰èªæ˜åˆ°å¯ä»¥æ‰¾åˆ°è¿™ä¹ˆç‰›å‰çš„è§£å†³åŠæ³•, è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ\næ±‚ç¬¬ä¸€ä¸ªè¿ç»­å››ä¸ªæ•´æ•°, ä»–ä»¬æœ‰å››ä¸ªä¸åŒçš„ç´ å› æ•°ã€‚\né™¤äº†æš´åŠ›ç ´è§£, æˆ‘æ²¡æ‰¾åˆ°ä»»ä½•æ›´å¥½çš„åŠæ³•ï¼š\nconstant $N = 4; my $i = 0; for 2..* { $i = factors($_) == $N ?? $i + 1 !! 0; if $i == $N { say $_ - $N + 1; last; } } è¿™é‡Œ, \u0026amp;fators è¿”å›ç´ å› æ•°çš„ä¸ªæ•°, åŸå§‹çš„å®ç°å·®ä¸å¤šæ˜¯è¿™æ ·çš„ï¼š\nsub factors($n is copy) { my $i = 0; for 2, 3, *+2 ...^ * \u0026gt; $n { if $n %% $_ { ++$i; repeat while $n %% $_ { $n div= $_ } } } return $i; } è¿è¡Œæ—¶é—´ï¼šunknown (33s for N=3)\næ³¨æ„ repeat while ...{...} çš„ç”¨æ³•, è¿™æ˜¯ do {...} while(...); çš„æ–°å†™æ³•ã€‚ æˆ‘ä»¬å¯ä»¥åŠ ä¸Šç‚¹ç¼“å­˜æ¥åŠ é€Ÿç¨‹åºï¼š\nBEGIN my %cache = 1 =\u0026gt; 0; multi factors($n where %cache) { %cache{$n} } multi factors($n) { for 2, 3, *+2 ...^ * \u0026gt; sqrt($n) { if $n %% $_ { my $r = $n; $r div= $_ while $r %% $_; return %cache{$n} = 1 + factors($r); } } return %cache{$n} = 1; } è¿è¡Œæ—¶é—´ï¼šunknown (3.5s for N=3)\næ³¨æ„ç”¨ BEGIN æ¥åˆå§‹åŒ–ç¼“å­˜, ä¸ç®¡å‡ºç°åœ¨æºä»£ç é‡Œå“ªä¸ªä½ç½®ã€‚è¿˜æœ‰ç”¨ multi æ¥å¯ç”¨å¯¹ \u0026amp;factors çš„å¤šæ ·è°ƒåº¦ã€‚where å­å¥å¯ä»¥æ ¹æ®å‚æ•°çš„å€¼è¿›è¡ŒåŠ¨æ€è°ƒåº¦ã€‚\nå“ªæ€•æœ‰ç¼“å­˜, æˆ‘ä»¬ä¾ç„¶æ— æ³•åœ¨ä¸€ä¸ªåˆç†çš„æ—¶é—´å†…å›ç­”ä¸Šæ¥åŸæ¥çš„é—®é¢˜ã€‚ç°åœ¨æˆ‘ä»¬æ€ä¹ˆåŠï¼Ÿåªèƒ½ç”¨ç‚¹éª—å­æ‰‹æ®µäº†Zavolaj â€“ Rakudo ç‰ˆæœ¬çš„ NativeCall â€“ æ¥åœ¨Cè¯­è¨€é‡Œå®ç°å› å¼åˆ†è§£ã€‚\näº‹å®è¯æ˜è¿™è¿˜ä¸å¤Ÿå¥½, æ‰€ä»¥æˆ‘ä»¬ç»§ç»­é‡æ„å‰©ä¸‹çš„ä»£ç , æ·»åŠ ä¸€äº›åŸå‹å£°æ˜ï¼š\nuse NativeCall; sub factors(int $n) returns int is native(\u0026#39;./prob047-gerdr\u0026#39;) { * } my int $N = 4; my int $n = 2; my int $i = 0; while $i != $N { $i = factors($n) == $N ?? $i + 1 !! 0; $n = $n + 1; } say $n - $N; è¿è¡Œæ—¶é—´ï¼š1m2s (0.8s for N=3)\nç›¸æ¯”ä¹‹ä¸‹, å®Œå…¨ä½¿ç”¨Cè¯­è¨€å®ç°è¿™ä¸ªç®—æ³•, è¿è¡Œæ—¶é—´åœ¨0.1ç§’ä¹‹å†…ã€‚æ‰€ä»¥ç›®å‰ Rakudo è¿˜æ²¡æ³•èµ¢å¾—ä»»ä½•ä¸€ç§é€Ÿåº¦æµ‹è¯•ã€‚\né‡å¤ä¸€ä¸‹, ç”¨ä¸‰ç§åŠæ³•åšä¸€ä»¶äº‹ï¼š\nåœ¨ 2 â‰¤ a â‰¤ 100 å’Œ 2 â‰¤ b â‰¤ 100 çš„æƒ…å†µä¸‹ç”± abç”Ÿæˆçš„åºåˆ—é‡Œæœ‰å¤šå°‘ä¸ä¸€æ ·çš„å…ƒç´ ï¼Ÿ ä¸‹é¢æ˜¯ä¸€ä¸ªå¾ˆæ¼‚äº®ä½†å¾ˆæ…¢çš„è§£å†³åŠæ³•, å¯ä»¥ç”¨æ¥éªŒè¯å…¶ä»–åŠæ³•æ˜¯å¦æ­£ç¡®ï¼š\nsay +(2..100 X=\u0026gt; 2..100).classify({ .key ** .value }); è¿è¡Œæ—¶é—´ï¼š11s\næ³¨æ„ä½¿ç”¨ X=\u0026gt; æ¥æ„é€ ç¬›å¡å°”ä¹˜ç§¯ã€‚ç”¨å¯¹æ„é€ å™¨ =\u0026gt; é˜²æ­¢åºåˆ—è¢«å‹æ‰è€Œå·²ã€‚\nå› ä¸º Rakudo æ”¯æŒå¤§æ•´æ•°è¯­ä¹‰, æ‰€ä»¥åœ¨è®¡ç®—åƒ 100100 è¿™ç§å¤§æ•°çš„æ—¶å€™æ²¡æœ‰ç²¾å¯†åº¦ä¸Šçš„æŸå¤±ã€‚\nä¸è¿‡æˆ‘ä»¬å¹¶ä¸çœŸçš„åœ¨æ„å¹‚çš„å€¼, ä¸è¿‡ç”¨åŸºæ•°å’ŒæŒ‡æ•°æ¥å”¯ä¸€æ ‡ç¤ºå¹‚ã€‚æˆ‘ä»¬éœ€è¦æ³¨æ„åŸºæ•°å¯èƒ½è‡ªå·±æœ¬èº«å°±æ˜¯å‰é¢æŸæ¬¡çš„å¹‚å€¼ï¼š\nconstant A = 100; constant B = 100; my (%powers, %count); # æ‰¾å‡ºé‚£äº›æ˜¯ä¹‹å‰åŸºæ•°çš„å¹‚çš„åŸºæ•° # åˆ†åˆ«å­˜å‚¨åŸºæ•°å’ŒæŒ‡æ•° for 2..Int(sqrt A) -\u0026gt; \\a { next if a ~~ %powers; %powers{a, a**2, a**3 ...^ * \u0026gt; A} = a X=\u0026gt; 1..*; } # è®¡ç®—é‡å¤çš„ä¸ªæ•° for %powers.values -\u0026gt; \\p { for 2..B -\u0026gt; \\e { # ä¸Šå‡åˆ° \\e çš„å¹‚ # æ ¹æ®ä¹‹å‰çš„åŸºæ•°å’Œå¯¹åº”æŒ‡æ•°åˆ†ç±» ++%count{p.key =\u0026gt; p.value * e} } } # æ·»åŠ  +%count ä½œä¸ºä¸€ä¸ªéœ€è¦ä¿å­˜çš„å‰¯æœ¬ say (A - 1) * (B - 1) + %count - [+] %count.values; è¿è¡Œæ—¶é—´ï¼š0.9s\næ³¨æ„ç”¨åºåˆ—æ“ä½œç¬¦ ...^ æ¨æ–­é›†åˆåºåˆ—, åªè¦æä¾›è‡³å°‘ä¸‰ä¸ªå…ƒç´ , åˆ—è¡¨èµ‹å€¼ %powers{...} = ... å°±ä¼šæ— ä¼‘æ­¢çš„è¿›è¡Œä¸‹å»ã€‚\næˆ‘ä»¬å†æ¬¡ç”¨æ•°æ®é©±åŠ¨çš„å‡½æ•°å¼çš„é£æ ¼é‡å†™ä¸€éï¼š\nsub cross(@a, @b) { @a X @b } sub dups(@a) { @a - @a.uniq } constant A = 100; constant B = 100; 2..Int(sqrt A) ==\u0026gt; map -\u0026gt; \\a { (a, a**2, a**3 ...^ * \u0026gt; A) Z=\u0026gt; (a X 1..*).tree } ==\u0026gt; reverse() ==\u0026gt; hash() ==\u0026gt; values() ==\u0026gt; cross(2..B) ==\u0026gt; map -\u0026gt; \\n, [\\r, \\e] { (r) =\u0026gt; e * n } ==\u0026gt; dups() ==\u0026gt; ((A - 1) * (B - 1) - *)() ==\u0026gt; say(); è¿è¡Œæ—¶é—´ï¼š1.5s\næ³¨æ„æˆ‘ä»¬æ€ä¹ˆç”¨ \u0026amp;tree æ¥é˜²æ­¢å‹æ‰çš„ã€‚æˆ‘ä»¬å¯ä»¥åƒä¹‹å‰é‚£æ ·ç”¨ X=\u0026gt; æ›¿ä»£ X , ä¸è¿‡è¿™ä¼šè®©é€šè¿‡ -\u0026gt; \\n, [\\r, \\e] è§£æ„å˜å¾—å¾ˆå¤æ‚ã€‚\nå’Œé¢„æƒ³çš„ä¸€æ ·, è¿™ä¸ªå†™æ³•æ²¡åƒå‘½ä»¤å¼çš„é‚£æ ·æ‰§è¡Œå‡ºæ¥ã€‚æ€ä¹ˆæ‰èƒ½æ­£å¸¸è¿è¡Œå‘¢ï¼Ÿè¿™ç®—æ˜¯æˆ‘ç•™ç»™è¯»è€…çš„ä½œä¸šå§ã€‚\nè§£æ IPv4 åœ°å€ Raku çš„æ­£åˆ™ç°åœ¨æ˜¯ä¸€ç§å­è¯­è¨€äº†, å¾ˆå¤šè¯­æ³•æ²¡æœ‰å˜:\n/\\d+/ æ•è·æ•°å­—ï¼š\n/(\\d+)/ ç°åœ¨ $0 å­˜å‚¨ç€åŒ¹é…åˆ°çš„æ•°å­—, è€Œä¸æ˜¯ Perl 5 ä¸­çš„ $1. æ‰€æœ‰çš„ç‰¹æ®Šå˜é‡ $0,$1,$2 åœ¨ Raku é‡Œå°±æ˜¯ $/[0], $/[1], $/[2]. åœ¨ Perl 5 ä¸­, $0 æ˜¯è„šæœ¬æˆ–ç¨‹åºçš„æ–‡ä»¶å, ä½†æ˜¯è¿™åœ¨ Raku ä¸­å˜æˆäº† $*EXECUTABLE_NAMEã€‚\nå¦‚æœä½ å¯¹è·å¾—ä¸€ä¸ªæ­£åˆ™åŒ¹é…çš„æ‰€æœ‰æ•è·ç»„æ„Ÿå…´è¶£, ä½ å¯ä»¥ä½¿ç”¨ @(), å®ƒæ˜¯ @($/) çš„è¯­æ³•ç³–ã€‚ $/ å˜é‡ä¸­çš„å¯¹è±¡æ‹¥æœ‰è®¸å¤šå…³äºæœ€åä¸€æ¬¡åŒ¹é…çš„æœ‰ç”¨ä¿¡æ¯ã€‚ä¾‹å¦‚, $/.from å°†ç»™ä½ åŒ¹é…çš„èµ·å§‹å­—ç¬¦ä¸²ä½ç½®ã€‚ ä½†æ˜¯ $0 å°†ä½¿æˆ‘ä»¬åœ¨è¿™ç¯‡æ–‡ç« ä¸­èµ°å¾—è¶³å¤Ÿè¿œã€‚æˆ‘ä»¬ç”¨å®ƒæ¥ä»ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æå–å•ä¸ªç‰¹å¾ã€‚\nä¿®é¥°ç¬¦ç°åœ¨æ”¾åœ¨å‰é¢äº†:\n$_ = \u0026#39;1 23 456 78.9\u0026#39;; say .Str for m:g/(\\d+)/; # 1 23 456 78 9 åŒ¹é…æ‰€æœ‰çœ‹èµ·æ¥åƒè¿™æ ·çš„ä¸œè¥¿å¾ˆæœ‰ç”¨, ä»¥è‡³äºå®ƒæœ‰ä¸€ä¸ªä¸“é—¨çš„ .comb æ–¹æ³•ï¼š\n$str.comb(/\\d+/); å¦‚æœä½ å¯¹ .split å¾ˆç†Ÿæ‚‰, ä½ å¯ä»¥æƒ³åˆ° .comb å°±æ˜¯å®ƒçš„è¡¨å“¥, å®ƒåŒ¹é… .split ä¸¢å¼ƒçš„ä¸œè¥¿ ã€‚ Perl 5 ä¸­åŒ¹é… IPv4 åœ°å€çš„æ­£åˆ™å¦‚ä¸‹:\n/(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})\\.(\\d{1,3})/ è¿™åœ¨ Raku ä¸­æ˜¯æ— æ•ˆçš„ã€‚é¦–å…ˆ, {} å—åœ¨ Raku çš„ æ­£åˆ™ä¸­æ˜¯çœŸæ­£çš„ä»£ç å—ï¼›å®ƒä»¬åŒ…å« Raku ä»£ç ã€‚ç¬¬äºŒ, åœ¨ Raku ä¸­è¯·ä½¿ç”¨ ** N..M (æˆ– ** N..*) ä»£æ›¿ {N,M}\nåœ¨ Raku ä¸­åŒ¹é…1åˆ°3ä½æ•°å­—çš„æ­£åˆ™å¦‚ä¸‹:\n/\\d**1..3/ åŒ¹é… Ipv4åœ°å€ï¼š\n/(\\d**1..3)\\.(\\d**1..3)\\.(\\d**1..3)\\.(\\d**1..3)/ é‚£ä»æœ‰ç‚¹ç¬¨æ‹™ã€‚åœ¨ Raku çš„æ­£åˆ™ä¸­, ä½ å¯ä»¥ä½¿ç”¨é‡å¤æ“ä½œç¬¦ % , ä¸‹é¢æ˜¯é‡å¤ (\\d ** 1..3) è¿™ä¸ªæ­£åˆ™ 4æ¬¡, å¹¶ä½¿ç”¨ . ç‚¹å·ä½œä¸ºåˆ†éš”ç¬¦ã€‚\n/(\\d**1..3)**4%\u0026#39;.\u0026#39;/ % æ“ä½œç¬¦æ˜¯ä¸€ä¸ªé‡è¯ä¿®é¥°ç¬¦, æ‰€ä»¥å®ƒåªè·Ÿåœ¨ä¸€ä¸ªåƒ * æˆ– + æˆ– ** çš„é‡è¯åé¢ã€‚ä¸Šé¢çš„æ­£åˆ™æ„æ€æ˜¯ åŒ¹é… 4 ç»„æ•°å­—, åœ¨æ¯ç»„æ•°å­—é—´æ’å…¥ä¸€ä¸ªç›´æ¥é‡ ç‚¹å· .ã€‚\nä½ ä¹Ÿå¯èƒ½æ³¨æ„åˆ° \\. å˜æˆäº† '.' , å®ƒä»¬æ˜¯ä¸€æ ·çš„ã€‚\n$_ = \u0026#34;Go 127.0.0.1, I said! He went to 173.194.32.32.\u0026#34;; say .Str for m:g/(\\d**1..3)**4%\u0026#39;.\u0026#39;/; # output: 127.0.0.1 173.194.32.32 æˆ–è€…æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ .comb:\n$_ = \u0026#34;Go 127.0.0.1, I said! He went to 173.194.32.32.\u0026#34;; my @ip4addrs = .comb(/(\\d**1..3)**4%\u0026#39;.\u0026#39;/); # 127.0.0.1 173.194.32.32 å¦‚æœæˆ‘ä»¬å¯¹å•ç‹¬çš„æ•°å­—æ„Ÿå…´è¶£ï¼š\n$_ = \u0026#34;Go 127.0.0.1, I said! He went to 173.194.32.32.\u0026#34;; say .list\u0026gt;\u0026gt;.Str.perl for m:g/(\\d**1..3)**4%\u0026#39;.\u0026#39;/; # output: (\u0026#34;127\u0026#34;, \u0026#34;0\u0026#34;, \u0026#34;0\u0026#34;, \u0026#34;1\u0026#34;) (\u0026#34;173\u0026#34;, \u0026#34;194\u0026#34;, \u0026#34;32\u0026#34;, \u0026#34;32\u0026#34;) å¼•å· åœ¨å¾ˆå¤šåœ°æ–¹, Raku éƒ½æä¾›ç»™ä½ æ›´åˆç†çš„é»˜è®¤è®¾ç½®ä»¥ä¾¿åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹è®©ä½ çš„å·¥ä½œå˜å¾—æ›´ç®€å•æœ‰è¶£ã€‚å¼•å·ä¹Ÿä¸ä¾‹å¤–ã€‚\næœ€å¸¸è§çš„ä¸¤ç§å¼•å·å°±æ˜¯å•å¼•å·å’ŒåŒå¼•å·ã€‚å•å¼•å·æœ€ç®€å•ï¼šè®©ä½ å¼•èµ·ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚å”¯ä¸€çš„â€œé­”æ³•â€å°±æ˜¯ä½ å¯ä»¥ç”¨åæ–œæ è½¬ä¹‰ä¸€ä¸ªå•å¼•å·ã€‚è€Œå› ä¸ºåæ–œæ çš„è¿™ä¸ªä½œç”¨, ä½ å¯ä»¥ç”¨ \\\\ æ¥è¡¨ç¤ºåæ–œæ æœ¬èº«äº†ã€‚ä¸è¿‡å…¶å®è¿™ä¸ªåšæ³•ä¹Ÿæ˜¯æ²¡å¿…è¦çš„, åæ–œæ è‡ªå·±å¯ä»¥ç›´æ¥ä¼ é€’ã€‚ä¸‹é¢æ˜¯ä¸€ç»„ä¾‹å­ï¼š\n\u0026gt; say 'Everybody loves Magical Trevorâ€™; Everybody loves Magical Trevor \u0026gt; say 'Oh wow, it\\'s backslashed!â€™; Oh wow, it's backslashed! \u0026gt; say 'You can include a \\\\ like thisâ€™; You can include a \\ like this \u0026gt; say 'Nothing like \\n is availableâ€™; Nothing like \\n is available \u0026gt; say 'And a \\ on its own is no problemâ€™; And a \\ on its own is no problem åŒå¼•å·, é¢, ä»å­—é¢ä¸Šçœ‹å°±çŸ¥é“äº†, ä¸¤å€è‡ªç„¶æ›´å¼ºå¤§äº†ã€‚:-) å®ƒæ”¯æŒåæ–œæ è½¬ä¹‰, ä½†æ›´é‡è¦çš„æ˜¯ä»–æ”¯æŒå†…æ’ã€‚ä¹Ÿå°±æ˜¯è¯´å˜é‡å’Œé—­åŒ…å¯ä»¥æ”¾è¿›åŒå¼•å·é‡Œã€‚å¤§å¤§çš„å¸®ä½ èŠ‚çº¦ä½¿ç”¨è¿æ¥æ“ä½œç¬¦æˆ–è€…å­—ç¬¦ä¸²æ ¼å¼å®šä¹‰ç­‰ç­‰çš„æ—¶é—´ã€‚\nä¸‹é¢æ˜¯å‡ ä¸ªç®€å•çš„ä¾‹å­ï¼š\n\u0026gt; say \u0026quot;Ooh look!\\nLine breaks!\u0026quot; Ooh look! Line breaks! \u0026gt; my $who = 'Ninochka'; say \u0026quot;Hello, dear $who\u0026quot; Hello, dear Ninochka \u0026gt; say \u0026quot;Hello, { prompt 'Enter your name: ' }!\u0026quot; Enter your name: _Jonathan_ Hello, Jonathan! ä¸Šé¢ç¬¬äºŒä¸ªä¾‹å­å±•ç¤ºäº†æ ‡é‡å†…æ’, ç¬¬ä¸‰ä¸ªåˆ™å±•ç¤ºäº†é—­åŒ…ä¹Ÿå¯ä»¥æ’å…¥åŒå¼•å·å­—ç¬¦ä¸²é‡Œã€‚é—­åŒ…äº§ç”Ÿçš„å€¼ä¼šè¢«å­—ç¬¦ä¸²åŒ–ç„¶åæ’å…¥å­—ç¬¦ä¸²ä¸­ã€‚é‚£é™¤äº† $ å¼€å¤´çš„å‘¢ï¼Ÿ è§„åˆ™æ˜¯è¿™æ ·çš„ï¼šæ‰€æœ‰çš„éƒ½å¯ä»¥æ’å…¥, ä½†å‰ææ˜¯å®ƒä»¬è¢«æŸäº›åç¯ç¼€(è¯‘è€…æ³¨ï¼špostcircumfix)(ä¹Ÿå°±æ˜¯å¸¦ä¸‹æ ‡æˆ–è€…æ‰©çš„æ•°ç»„æˆ–è€…å“ˆå¸Œ, å¯ä»¥åšå¼•ç”¨æˆ–è€…æ–¹æ³•è°ƒç”¨)å…è®¸ã€‚äº‹å®ä¸Šä½ ä¹Ÿå¯ä»¥æŠŠä»–ä»¬éƒ½å­˜è¿›æ ‡é‡é‡Œã€‚\n\u0026gt; my @beer = \u0026lt;Chimay Hobgoblin Yeti\u0026gt;; Chimay Hobgoblin Yeti \u0026gt; say \u0026quot;First up, a @beer[0]\u0026quot; First up, a Chimay \u0026gt; say \u0026quot;Then @beer[1,2].join(' and ')!\u0026quot; Then Hobgoblin and Yeti! \u0026gt; say \u0026quot;Tu je \u0026amp;prompt('Ktore pivo chces? ')\u0026quot; Ktore pivo chces? _Starobrno_ Tu je Starobrno è¿™é‡Œä½ çœ‹åˆ°äº†ä¸€ä¸ªæ•°ç»„å…ƒç´ çš„å†…æ’, ä¸€ä¸ªè¢«è°ƒç”¨äº†æ–¹æ³•çš„æ•°ç»„åˆ‡ç‰‡çš„å†…æ’å’Œä¸€ä¸ªå‡½æ•°è°ƒç”¨çš„å†…æ’ã€‚åç¯ç¼€è§„åˆ™æ„å‘³ç€æˆ‘ä»¬å†ä¹Ÿä¸ä¼šç ¸æ‰ä½ å£å¹´çš„é‚®ç®±åœ°å€äº†(è¯‘è€…æ³¨ï¼šé‚®ç®±åœ°å€é‡Œæœ‰@å·)ã€‚\n\u0026gt; say \u0026#34;Please spam me at blackhole@jnthn.net\u0026#34; Please spam me at blackhole@jnthn.net é€‰æ‹©ä½ è‡ªå·±çš„åˆ†éš”ç¬¦ å•/åŒå¼•å·å¯¹å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½å¾ˆå¥½ç”¨, ä¸è¿‡å¦‚æœä½ æƒ³åœ¨å­—ç¬¦ä¸²é‡Œä½¿ç”¨è¿™äº›å¼•å·çš„æ—¶å€™å’‹åŠï¼Ÿç»§ç»­ç”¨åæ–œæ ä¸æ˜¯ä»€ä¹ˆå¥½ä¸»æ„ã€‚å…¶å®ä½ å¯ä»¥è‡ªå®šä¹‰å…¶ä»–å­—ç¬¦åšä¸ºå¼•å·å­—ç¬¦ã€‚Raku æ›¿ä½ é€‰å¥½äº†ã€‚q å’Œ qq å¼•å·ç»“æ„åé¢ç´§è·Ÿçš„å­—ç¬¦å°±ä¼šè¢«ä½œä¸ºåˆ†éš”ç¬¦ã€‚å¦‚æœè¿™ä¸ªå­—ç¬¦æœ‰ç›¸å¯¹åº”çš„å…³é—­ç¬¦, é‚£ä¹ˆå°±è‡ªåŠ¨æŸ¥æ‰¾è¿™ä¸ªï¼ˆæ¯”å¦‚, å¦‚æœä½ ç”¨äº†ä¸€ä¸ªå¼€å¯èŠ±æ‹¬å·{, é‚£ä¹ˆå­—ç¬¦ä¸²å°±ä¼šåœ¨é—­åˆèŠ±æ‹¬å·}å¤„ç»“æŸã€‚æ³¨æ„ä½ è¿˜å¯ä»¥ä½¿ç”¨å¤šå­—ç¬¦å¼€å¯ç¬¦å’Œé—­åˆç¬¦ï¼ˆä¸è¿‡è¦æ±‚æ˜¯ç›¸åŒå­—ç¬¦é‡å¤ç»„æˆçš„å¤šå­—ç¬¦ï¼‰ï¼‰ã€‚å¦å¤–, q çš„è¯­ä¹‰ç­‰åŒäºå•å¼•å·, qq çš„è¯­ä¹‰ç­‰åŒäºåŒå¼•å·ã€‚\n\u0026gt; say q{C'est la vie} C'est la vie \u0026gt; say q{{Unmatched } and { are { OK } in { here}} Unmatched } and { are { OK } in { here \u0026gt; say qq!Lottery results: {(1..49).roll(6).sort}! Lottery results: 12 13 26 34 36 46 å®šç•Œç¬¦(Heredoc) æ‰€æœ‰çš„å¼•å·ç»“æ„éƒ½å…è®¸ä½ åŒ…å«å¤šè¡Œå†…å®¹ã€‚ä¸è¿‡, è¿˜æœ‰æ›´å¥½çš„åŠæ³•ï¼šå®šç•Œæ–‡æ¡£ã€‚è¿˜æ˜¯ç”¨ q æˆ–è€… qq å¼€å§‹, ç„¶åè·Ÿä¸Š :to å‰¯è¯æ¥å®šä¹‰æˆ‘ä»¬æœŸæœ›åœ¨æ–‡æœ¬æœ€åæŸè¡ŒåŒ¹é…çš„å­—ç¬¦ã€‚è®©æˆ‘ä»¬é€šè¿‡ä¸‹é¢è¿™ä¸ªæ„Ÿäººçš„æ•…äº‹çœ‹çœ‹å®ƒæ˜¯æ€ä¹ˆå·¥ä½œçš„ã€‚\nprint q:to/THE END/ Once upon a time, there was a pub. The pub had lots of awesome beer. One day, a Perl workshop was held near to the pub. The hackers drank the pub dry. The pub owner could finally afford a vacation. THE END è„šæœ¬çš„è¾“å‡ºå¦‚ä¸‹ï¼š\nOnce upon a time, there was a pub. The pub had lots of awesome beer. One day, a Perl workshop was held near to the pub. The hackers drank the pub dry. The pub owner could finally afford a vacation. æ³¨æ„è¾“å‡ºæ–‡æœ¬å¹¶æ²¡æœ‰åƒæºç¨‹åºé‚£æ ·ç¼©è¿›ã€‚å®šç•Œç¬¦ä¼šè‡ªåŠ¨æ¸…æ¥šç¼©è¿›åˆ°ç»ˆç«¯çš„çº§åˆ«ã€‚å¦‚æœæˆ‘ä»¬ç”¨ qq , æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾€å®šç•Œç¬¦é‡Œæ’å…¥ä¸œè¥¿ã€‚æ³¨æ„è¿™äº›éƒ½æ˜¯é€šè¿‡å­—ç¬¦ä¸²çš„ ident æ–¹æ³•å®ç°çš„, ä½†æ˜¯å¦‚æœä½ çš„å­—ç¬¦ä¸²é‡Œæ²¡æœ‰å†…æ’, æˆ‘ä»¬ä¼šåœ¨ç¼–è¯‘æœŸçš„æ—¶å€™è°ƒç”¨ ident ä½œä¸ºä¸€ç§ä¼˜åŒ–æ‰‹æ®µã€‚\nä½ åŒæ ·å¯ä»¥æœ‰å¤šä¸ªå®šç•Œç¬¦, åŒ…æ‹¬è°ƒç”¨å®šç•Œç¬¦é‡Œçš„æ•°æ®çš„æ–¹æ³•ä¹Ÿæ˜¯å¯ä»¥çš„ï¼ˆæ³¨æ„ä¸‹é¢çš„ç¨‹åºå°±è°ƒç”¨äº† lines æ–¹æ³•ï¼‰ã€‚\nmy ($input, @searches) = q:to/INPUT/,q:to/SEARCHES/.lines; Once upon a time, there was a pub. The pub had lots of awesome beer. One day, a Perl workshop was held near to the pub. The hackers drank the pub dry. The pub owner could finally afford a vacation. INPUT beer masak vacation whisky SEARCHES for @searches -\u0026gt; $s { say $input ~~ /$s/ ?? \u0026#34;Found $s\u0026#34; !! \u0026#34;Didn\u0026#39;t find $s\u0026#34;; } è¿™ä¸ªç¨‹åºè¾“å‡ºæ˜¯ï¼š\nFound beer Didn't find masak Found vacation Didn't find whisky è‡ªå®šä¹‰å¼•å·ç»“æ„çš„å¼•å·å‰¯è¯ å•/åŒå¼•å·çš„è¯­ä¹‰, ä¹Ÿæ˜¯ q å’Œ qq çš„è¯­ä¹‰, å·²ç»å¯ä»¥è§£å†³ç»å¤§å¤šæ•°æƒ…å†µäº†ã€‚ä¸è¿‡å¦‚æœä½ æœ‰è¿™ä¹ˆç§æƒ…å†µï¼šä½ è¦è¾“å‡ºå†…æ’é—­åŒ…è€Œä¸æ˜¯æ ‡é‡æ€ä¹ˆåŠï¼Ÿè¿™æ—¶å€™å°±è¦ç”¨ä¸Šå¼•å·å‰¯è¯äº†ã€‚å®ƒä»¬å†³å®šä½ æ˜¯å¦å¼€å¯å¼•å·ç‰¹æ€§ã€‚ä¸‹é¢æ˜¯ä¾‹å­ï¼š\n\u0026gt; say qq:!s\u0026quot;It costs $10 to {\u0026lt;eat nom\u0026gt;.pick} here.\u0026quot; It costs $10 to eat here. è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº† qq è¯­ä¹‰, ä½†æ˜¯å…³é—­é‡Œæ ‡é‡å†…æ’, è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥æ”¾å¿ƒå¾€é‡Œå†™ä»·é’±è€Œä¸ç”¨æ‹…å¿ƒä»–ä¼šè¯•å›¾è§£ææˆä¸Šä¸€æ¬¡æ­£åˆ™åŒ¹é…çš„ç¬¬åä¸€ä¸ªæ•è·å€¼ã€‚æ³¨æ„è¿™é‡Œä½¿ç”¨çš„æ ‡å‡†çš„å†’å·å¯¹(colonpair)è¯­æ³•ã€‚å¦‚æœä½ å¸Œæœ›ä»ä¸€ä¸ªæœ€åŸºç¡€çš„å¼•å·ç»“æ„å¼€å§‹, ç„¶åè‡ªå·±æ‰‹åŠ¨çš„ä¸€ä¸ªä¸ªæ‰“å¼€é€‰é¡¹, é‚£ä¹ˆä½ åº”è¯¥ä½¿ç”¨ Q ç»“æ„ã€‚\n\u0026gt; say Q{$*OS\\n\u0026amp;sin(3)} $*OS\\n\u0026amp;sin(3) \u0026gt; say Q:s{$*OS\\n\u0026amp;sin(3)} MSWin32\\n\u0026amp;sin(3) \u0026gt; say Q:s:b{$*OS\\n\u0026amp;sin(3)} MSWin32 \u0026amp;sin(3) \u0026gt; say Q:s:b:f{$*OS\\n\u0026amp;sin(3)} MSWin32 0.141120008059867 è¿™é‡Œæˆ‘ä»¬ç”¨äº†æ— ç‰¹æ€§å¼•å·ç»“æ„, ç„¶åæ‰“å¼€é™„åŠ ç‰¹æ€§, åœ°ä¸€ä¸ªæ˜¯æ ‡é‡å†…æ’, ç„¶åæ˜¯åæ–œæ è½¬ä¹‰, ç„¶åå‡½æ•°å†…æ’ã€‚æ³¨æ„æˆ‘ä»¬åŒæ ·å¯ä»¥é€‰æ‹©è‡ªå·±å¸Œæœ›çš„ä»»ä½•åˆ†éš”ç¬¦ã€‚\nå¼•å·ç»“æ„æ˜¯ä¸€é—¨è¯­è¨€ æœ€å, å€¼å¾—ä¸€æçš„æ˜¯ï¼šå½“è§£æå™¨è¿›å…¥å¼•å·ç»“æ„çš„æ—¶å€™, å…¶å®ä»–æ˜¯åˆ‡æ¢æˆè§£æå¦å¤–ä¸€ä¸ªè¯­è¨€äº†ã€‚å½“æˆ‘ä»¬ç”¨å‰¯è¯æ„å»ºå¼•å·ç»“æ„çš„æ—¶å€™, ä»–åªä¸è¿‡æ˜¯æŠŠè¿™äº›é¢å¤–çš„è§’è‰²æ··åˆè¿›åŸºç¡€çš„å¼•å·è¯­è¨€é‡Œæ¥å¼€å¯é¢å¤–çš„ç‰¹æ€§ã€‚å¥½å¥‡çš„ç«¥é‹å¯ä»¥çœ‹è¿™é‡Œï¼š Rakudo æ€ä¹ˆåšåˆ°çš„ã€‚è€Œå½“æˆ‘ä»¬ç¢°åˆ°é—­åŒ…æˆ–è€…å…¶ä»–å†…æ’çš„æ—¶å€™, è§£æå™¨å†ä¸´æ—¶åˆ‡æ¢å›ä¸»è¯­è¨€ã€‚æ‰€ä»¥ä½ å¯ä»¥è¿™æ ·å†™ï¼š\n\u0026gt; say \u0026#34;Hello, { prompt \u0026#34;Enter your name: \u0026#34; }!\u0026#34; Enter your name: Jonathan Hello, Jonathan! è§£æå™¨ä¸ä¼šå›°æƒ‘äºå†…æ’çš„é—­åŒ…é‡Œåˆå¸¦æœ‰å…¶ä»–åŒå¼•å·å­—ç¬¦ä¸²çš„é—®é¢˜ã€‚å› ä¸ºæˆ‘ä»¬è§£æä¸»è¯­è¨€, ç„¶ååˆ‡æ¢åˆ°å¼•å·è¯­è¨€, ç„¶åè¿”å›ä¸»è¯­è¨€, ç„¶åé‡æ–°å†è¿”å›å¼•å·è¯­è¨€æ¥è§£æè¿™ä¸ªç¨‹åºé‡Œçš„å­—ç¬¦ä¸²é‡Œçš„é—­åŒ…é‡Œçš„å­—ç¬¦ä¸²ã€‚è¿™å°±æ˜¯ Raku è§£æå™¨é€ç»™æˆ‘ä»¬çš„åœ£è¯èŠ‚ç¤¼ç‰©, ä¿„ç½—æ–¯å¥—å¨ƒå¨ƒã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2015-04-15-raku-calendar-2012/","tags":["calendar"],"title":"Raku åœ£è¯æœˆå† 2012"},{"categories":["rakulang"],"contents":"Sneaking into a loop Zoffix å›ç­”äº†ä¸€ä¸ªå…³äº Perl 5 çš„ \u0026lt;\u0026gt; æ“ä½œç¬¦çš„é—®é¢˜ã€‚\nslurp.words.Bag.sort(-*.value).fmt(\u0026#34;%10s3d\\n\u0026#34;).say; slurp ä¼šä» STDIN ä¸­è¯»å–æ•´ä¸ª \u0026ldquo;file\u0026rdquo; å¹¶è¿”å›ä¸€ä¸ª Strã€‚æ–¹æ³• Str::words ä¼šæŒ‰ç…§æŸç§ Unicode æ„ä¹‰çš„å•è¯æŠŠè¯¥å­—ç¬¦ä¸²åˆ†å‰²æˆä¸€ä¸ªåˆ—è¡¨ã€‚æŠŠåˆ—è¡¨å¼ºè½¬ä¸º Bag åˆ™åˆ›å»ºä¸€ä¸ªè®¡æ•° Hash, å®ƒæ˜¯å¦‚ä¸‹è¡¨è¿°çš„å¿«æ·æ–¹å¼ã€‚\nmy %h; %h{$_}++ for \u0026lt;peter paul marry\u0026gt;; dd %h; # OUTPUTÂ«Hash %h = {:marry(1), :paul(1), :peter(1)}â¤Â» åœ¨å…³è”æ•°ç»„ä¸Šè°ƒç”¨ .sort(-*.value) ä¼šæŒ‰ç…§å€¼çš„é™åºæ’åºå¹¶è¿”å›ä¸€ä¸ªæ’åºåçš„ Pairs åˆ—è¡¨ã€‚List::fmt ä¼šè°ƒç”¨ Pair::fmt, å®ƒè°ƒç”¨ fmt æ–¹æ³•, .key ä½œä¸ºå…¶ç¬¬äºŒä¸ªå‚æ•°, .value ä¹Ÿä½œä¸ºå‚æ•°ã€‚say ä¼šä¼šä½¿ç”¨ä¸€ä¸ªç©ºæ ¼è¿æ¥å„ä¸ªå…ƒç´ å¹¶è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚æœ€åä¸€æ­¥æœ‰ä¸€ç‚¹é”™è¯¯å› ä¸ºé™¤äº†ç¬¬ä¸€è¡Œä¹‹å¤–çš„æ¯ä¸€è¡Œå‰é¢éƒ½ä¼šæœ‰ä¸€ä¸ªé¢å¤–çš„ç©ºæ ¼ã€‚\nslurp.words.Bag.sort(-*.value).fmt(\u0026#34;%10s=\u0026gt; %3d\u0026#34;).join(\u0026#34;\\n\u0026#34;).say; æ‰‹åŠ¨è¿æ¥å­—ç¬¦ä¸²æ›´å¥½ã€‚è¿™å¯¹äºç®€çŸ­çš„å•è¡Œç¨‹åºæ¥è¯´æœ‰ç‚¹å¤šäº†ã€‚æˆ‘ä»¬éœ€è¦æ‰¾åˆ°æœ€é•¿çš„å•è¯å¹¶ä½¿ç”¨ .chars æ¥è·å–åˆ—å®½ã€‚\nslurp ä¼šåœ¨ $*IN èº«ä¸Šè°ƒç”¨ .slurp-rest æ–¹æ³•ã€‚\n$*IN = \u0026lt;peter paul marry peter paul paul\u0026gt; but role { method slurp-rest { self.Str } }; è¿™æ˜¯ä¸€ç§ hack å› ä¸ºå®ƒä¼šåœ¨ä»»ä½•å½¢å¼çš„ç±»å‹æ£€æµ‹ä¸Šå¤±è´¥å¹¶ä¸”å®ƒé™¤äº† slurp ä¹‹å¤–ä¸ä¼šå¯¹ä»»ä½•ä¸œè¥¿èµ·ä½œç”¨ã€‚è¿˜æœ‰, å®é™…ä¸Šæˆ‘ä»¬ä» $*IN é‚£é‡Œè§£ç»‘ STDINã€‚ä¸è¦åœ¨å·¥ä½œä¸­ä½¿ç”¨è¿™ä¸ªå¥‡æ·«æŠ€å·§ã€‚\nç°åœ¨æˆ‘ä»¬èƒ½å¼€å¿ƒåœ°åå™¬å¹¶å¼€å§‹è®¡æ•°äº†ã€‚\nmy %counted-words = slurp.words.Bag; my $word-width = [max] %counted-words.keysÂ».chars; å¹¶ä¸”ç»§ç»­åœ¨é“¾å­æ–­å¼€çš„åœ°æ–¹ç»§ç»­ã€‚\n%counted-words.sort(-*.value).fmt(\u0026#34;%{$word-width}s3d\u0026#34;).join(\u0026#34;\\n\u0026#34;).say; é—®é¢˜è§£å†³äº†ä½†æ˜¯å¾ˆä¸‘é™‹ã€‚æˆ‘ä»¬æŠŠä¸€ä¸ªå•è¡Œç¨‹åºæ‹†å¼€äº†ã€‚æˆ‘ä»¬æ¥ä¿®å¤ fmt ä»¥ä½¿å®ƒå†æ¬¡å®Œæ•´ã€‚\næˆ‘ä»¬æƒ³è¦çš„æ˜¯ä¸€ä¸ª fmt æ–¹æ³•, å®ƒæ¥æ”¶ä¸€ä¸ªä½ç½®çš„(Positional), ä¸€ä¸ª printf é£æ ¼çš„æ ¼å¼å­—ç¬¦ä¸²å’Œä¸€ä¸ªæ ¼å¼å­—ç¬¦ä¸²ä¸­çš„ block per %*ã€‚è¿˜æœ‰, æˆ‘ä»¬å¯èƒ½éœ€è¦åœ¨ self.fmt å‰é¢æ”¾ä¸Šä¸€ä¸ªåˆ†éš”ç¬¦ã€‚\nmy multi method fmt(Positional:D: $fmt-str, *@width where *.all ~~ Callable, :$separator = \u0026#34;\u0026#34;){ self.fmt( $fmt-str.subst(:g, \u0026#34;%*\u0026#34;, { my \u0026amp;width = @width[$++] // Failure.new(\u0026#34;missingh block\u0026#34;); \u0026#39;%\u0026#39; ~ (\u0026amp;width.count == 2 ?? width(self, $_) !! width(self)) }), $separator); } è¡¨è¾¾å¼ *.all ~~ Callable æ£€æŸ¥ slurp arrayä¸­çš„æ‰€æœ‰å…ƒç´ æ˜¯å¦å®ç°äº† CALL-ME(é‚£æ˜¯å®é™…è¢«æ‰§è¡Œçš„æ–¹æ³•åœ¨ä½ æ‰§è¡Œ foo()çš„æ—¶å€™)ã€‚\nç„¶åæˆ‘ä»¬åœ¨æ ¼å¼å­—ç¬¦ä¸²ä¸Šä½¿ç”¨äº† subst æ¥æ›¿æ¢ %*, æ›¿æ¢æ˜¯ä¸€ä¸ª(é—­åŒ…)å—å„¿, å®ƒæ¯æ¬¡åŒ¹é…è¢«è°ƒç”¨ä¸€æ¬¡ã€‚è€Œä¸”è¿™å„¿æˆ‘ä»¬æœ‰ä¸é”™çš„æƒ¯ç”¨æ³•ã€‚\nsay \u0026#34;1-a 2-b 3-c\u0026#34;.subst(:g, /\\d/, {\u0026lt;one two three\u0026gt;[$++]}); # one-a two-b three-c åŒ¿åçŠ¶æ€å˜é‡ $ ä» 0 å¼€å§‹è®¡æ•°, æ¯æ¬¡ä»£ç å—æ‰§è¡Œæ—¶å¢ 1ã€‚å®é™…ä¸Šæˆ‘ä»¬åœ¨è¿™å„¿åšçš„å°±æ˜¯ç§»é™¤ä¸€ä¸ªå¾ªç¯å¹¶ç»™ subst å·å·åŠ å…¥ä¸€ä¸ªé¢å¤–çš„è®¡æ•°å™¨å’Œæ•°ç»„ä¸‹æ ‡ã€‚æˆ–è€…å¯ä»¥è¯´æˆ‘ä»¬æ³¨å†Œäº†ä¸€ä¸ªè¿­ä»£å™¨åˆ° subst é‡Œé¢çš„å¾ªç¯ä¸­ã€‚æœ‰äººå¯èƒ½ä¼šè´¨ç–‘ subst åº”è¯¥æ¥æ”¶ä¸€ä¸ª Seq ä½œä¸ºå®ƒçš„ç¬¬äºŒä¸ªä½ç½®å‚æ•°, å®ƒä¼šè®©è°ƒç”¨å˜å¾—å†—é•¿ã€‚æ— è®ºå¦‚ä½•, æˆ‘ä»¬æŠŠæ´è¡¥ä¸Šäº†ã€‚\nåœ¨ç¬¬ 11 è¡Œ, æˆ‘ä»¬ä»åå™¬æ•°ç»„ä¸­æ‹¿å‡ºä¸€ä¸ªå…ƒç´ æˆ–è€…åœ¨æ²¡æœ‰å…ƒç´ æ—¶åˆ›å»ºä¸€ä¸ª Failureã€‚æˆ‘ä»¬æŠŠ block å­˜å‚¨åœ¨ä¸€ä¸ªå˜é‡ä¸­å› ä¸ºæˆ‘ä»¬æƒ³åœ¨ç¬¬ 12 è¡Œä¸­å†…çœã€‚å¦‚æœé‚£ä¸ª block æ¥æ”¶ä¸¤ä¸ªä½ç½®å‚æ•°,we feed the topic subst is calling the block with as a 2nd parameter to our stored block. é‚£ç¢°å·§æ˜¯ä¸€ä¸ª Match å¹¶ä¸”å¯¹äºå½±å“æ‰€åŒ¹é…çš„ä¸œè¥¿å¯èƒ½æœ‰ç”¨ã€‚åœ¨æˆ‘ä»¬è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬å¯¹ %* è¿›è¡ŒåŒ¹é…å¹¶ä¸”å½“å‰ä½ç½®ç”± $++ è®¡æ•°ã€‚åšå®Œé‚£ä¸ªä¹‹åæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªæ ¼å¼å­—ç¬¦ä¸², å®ƒå¸¦æœ‰ä¸€ä¸ªç”±ç”¨æˆ·æä¾›çš„ fmt ç‰ˆæœ¬çš„åˆ—å®½å‚æ•°ã€‚\nç”¨æˆ·æä¾›çš„å—å„¿ä½¿ç”¨ä¸€ç»„ Pairs è°ƒç”¨ã€‚æˆ‘ä»¬ä¸å¾—ä¸æ·±å…¥ä¸€å±‚ä»¥å¾—åˆ°æ›´å¤§çš„é”®ã€‚\n{[max] .valuesÂ».keysÂ».chars} å¾—åˆ°ç¬¬ä¸€åˆ—çš„åˆ—å®½ã€‚\nprint %counted-words.sort(-*.value).\u0026amp;fmt( \u0026#34;%*s3d\u0026#34;, {[max] .valuesÂ».keysÂ».chars}, separator =\u0026gt; \u0026#34;\\n\u0026#34;); é‚£ä¸ªæ—¶é«¦çš„ .\u0026amp;fmt è°ƒç”¨æ˜¯å¿…é¡»çš„å› ä¸ºæˆ‘ä»¬å…è´¹çš„æµ®ç‚¹æ–¹æ³•ä¸æ˜¯ List çš„æ–¹æ³•ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2015-03-23-sneaking-into-a-loop/","tags":["rakulang"],"title":"Sneaking Into a Loop"},{"categories":["rakulang"],"contents":"Subset å­é›† Subset å¯ç”¨äºå£°æ˜æŸä¸€ç±»å‹çš„å­é›†ã€‚\nè¾“å…¥ä¸€ä¸ªå¯†ç , è¦æ±‚å¯†ç å¿…é¡»æ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼š\n1ã€ è‡³å°‘ 8 ä½ 2ã€ å¿…é¡»åŒ…å«å¤§å†™å­—æ¯ã€å°å†™å­—æ¯ å’Œ æ•°å­—\nsubset Length8 of Str where *.chars \u0026lt; 8; subset UpCase of Str where none(\u0026#39;A\u0026#39;..\u0026#39;Z\u0026#39;) âˆˆ *.comb.Set; subset LowerCase of Str where none(\u0026#39;a\u0026#39;..\u0026#39;z\u0026#39;) âˆˆ *.comb.Set; subset IntNumber of Str where none(\u0026#39;0\u0026#39;..\u0026#39;9\u0026#39;) âˆˆ *.comb.Set; my $guess = prompt(\u0026#39;Enter your password:\u0026#39;); given $guess { when Length8 { say \u0026#39;å¯†ç é•¿åº¦å¿…é¡»ä¸º 8 ä½ ä»¥ä¸Š\u0026#39;; proceed } when UpCase { say \u0026#39;å¯†ç å¿…é¡»åŒ…æ‹¬å¤§å†™å­—æ¯\u0026#39;; proceed } when LowerCase { say \u0026#39;å¯†ç å¿…é¡»åŒ…å«å°å†™å­—æ¯\u0026#39;; proceed } when IntNumber { say \u0026#39;å¯†ç å¿…é¡»åŒ…å«æ•°å­—\u0026#39;; } } è¯¥ç¨‹åºå…·æœ‰å¯æ‰©å±•æ€§, è¦å¢åŠ ä¸€ç§å¯†ç éªŒè¯, åªæœ‰æ·»åŠ ä¸€ä¸ª subset å°±å¥½äº†, ç„¶ååœ¨ given/when é‡Œé¢å¢åŠ ä¸€ä¸ªå¤„ç†ã€‚\nproceed ç›¸å½“äº continue, ä¸åƒ C é‡Œé¢çš„ falling through, Raku é‡Œé¢çš„ proceed åœ¨ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ª when è¯­å¥æ—¶ä¼šè®¡ç®— when åé¢çš„æ¡ä»¶ã€‚æ‰€ä»¥, åªè¦æœ‰ proceed, åˆ™ proceed åé¢çš„é‚£ä¸ªæ¡ä»¶å°±ä¼šè¢«æ‰§è¡Œã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2015-03-19-subset/","tags":["subset"],"title":"Subset"},{"categories":["rakulang"],"contents":"When å¯ä»¥ç”¨åœ¨ä¸»é¢˜åŒ–($_)çš„è¯­å¥ä¸­ Raku é‡Œé¢æœ‰ä¸ªç‰¹æ®Šçš„å˜é‡å« $_, å³ä¸»é¢˜åŒ–å˜é‡, the variable in question.\nfor (\u0026#39;Swift\u0026#39;, \u0026#39;PHP\u0026#39;, \u0026#39;Python\u0026#39;, \u0026#39;Perl\u0026#39;) -\u0026gt; $item { say $item when $item ~~ /^P/; } è¾“å‡º:\nPHP Python Perl for (12, 24, 56, 42) { .say when *\u0026gt;40 } è¾“å‡º:\n56 42 è€Œ where ç”¨äºå¯¹ç±»å‹è¿›è¡Œçº¦æŸ:\nfor (\u0026#39;Swift\u0026#39;, \u0026#39;PHP\u0026#39;, \u0026#39;Python\u0026#39;, \u0026#39;Perl\u0026#39;, 42) -\u0026gt; $item where $item ~~ Str { say $item; } è¾“å‡º:\nSwift PHP Python Perl Constraint type check failed for parameter '$item' ","permalink":"https://ohmyweekly.github.io/notes/2015-03-15-when-and-where/","tags":["where","when"],"title":"When and Where"},{"categories":["rakulang"],"contents":"Data munging in Raku æ¡ˆä¾‹å­¦ä¹ : ç”Ÿæˆæˆç»©æŠ¥å‘Šå•\nexample.txt STDOUT Peter\tB Celine\tA- ZsÃ³fia\tB+ JoÃ£o\tF Maryam\tB+ ç§€è‹±\tB- Finn\tD+ Aarav\tA Emma\tF Omar\tB è¾“å‡ºæŠ¥å‘Šå•ï¼š\nZsÃ³fia\u0026#39;s grade: B+ List of students with a failing grade: JoÃ£o, Emma Distribution of grades by letter: A: 2 students B: 5 students D: 1 student F: 2 students example.txt æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶, æ¯è¡Œä¸€ä¸ªå­¦ç”Ÿå§“åå’Œåˆ†æ•°, ä¸­é—´ç”¨ç©ºæ ¼åˆ†å‰²ã€‚ æˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„è„šæœ¬èƒ½è§£æè¿™æ ·çš„æ–‡ä»¶å¹¶æ‰“å°å«æœ‰å¦‚ä¸‹ä¿¡æ¯çš„æŠ¥å‘Šï¼š\nå­¦ç”Ÿåä¸º â€œZsÃ³fiaâ€ çš„æˆç»©\næ‰€æœ‰ä¸åŠæ ¼å­¦ç”Ÿçš„åå­— (i.e. worse than D-),\næ ¹æ®å­—æ¯( ä¸å¸¦ +/- ) æŠŠæˆç»©åˆ†ç»„ã€‚å¾—åˆ°å­¦ç”Ÿæˆç»©çš„åˆ†å¸ƒã€‚\nè®©æˆ‘ä»¬ä¸€æ­¥æ­¥æ¥, æ·»åŠ  shebang è¡Œ:\n#!/usr/bin/env raku åœ¨ Raku ä¸­æ‰€æœ‰è¿™äº›éƒ½ä¸ºæˆ‘ä»¬åšå¥½äº†ã€‚\nè¯»å–å¹¶è§£æè¾“å…¥:\nmy %grade = \u0026#34;grades.txt\u0026#34;.IO.lines.map: { m:s/^(\\w+)(\u0026lt;[A..F]\u0026gt;\u0026lt;[+-]\u0026gt;?)$/ or die \u0026#34;Can\u0026#39;t parse line \u0026#39;$_\u0026#39;\u0026#34;; ~$0 =\u0026gt; ~$1 }; åœ¨ Raku ä¸­, å¯¹æ–‡ä»¶åå­—ç¬¦ä¸²è°ƒç”¨ .IO æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªä»£è¡¨æ–‡ä»¶ç³»ç»Ÿè·¯å¾„çš„å¯¹è±¡, æˆ‘ä»¬å¯ä»¥ç»§ç»­åœ¨è¿™ä¸ªå¯¹è±¡ä¸Šè°ƒç”¨ .lines æ–¹æ³•, å¾—åˆ°æ–‡ä»¶çš„æ‰€æœ‰è¡Œçš„ä¸€ä¸ªæƒ°æ€§åˆ—è¡¨ã€‚â€œLazyâ€ æ„å‘³ç€å®ƒåªä¼šä»ç£ç›˜ä¸­æŒ‰éœ€è¯»å–æ–°è¡Œ, å½“æˆ‘ä»¬ä½¿ç”¨ .map æ–¹æ³•éå†åˆ—è¡¨å…ƒç´ çš„æ—¶å€™, è¿™æ ·èƒ½ä½¿ç”¨å•ä¸ªèµ‹å€¼æ“ä½œå°±èƒ½ä¼˜é›…åœ°åˆå§‹åŒ–ä¸€ä¸ªæ•£åˆ—ã€‚\næˆ‘ä»¬ä¸éœ€è¦è®©æ–‡ä»¶å¥æŸ„è¯†åˆ« Unicode, ä¹Ÿä¸ç”¨ç®¡æ–‡ä»¶å¥æŸ„æ˜¯å¦æ­£ç¡®å…³é—­, è¿™åœ¨ Raku ä¸­éƒ½æ˜¯é»˜è®¤å‘ç”Ÿçš„ã€‚\nmethod: ... è¯­æ³•ä¹Ÿå¯ä»¥å†™ä¸º .method(...), å‰è€…ä½¿ map çœ‹èµ·æ¥æ›´åƒä¸€ä¸ª block è¯­å¥, å¹¶å‡å°‘äº†æ‹¬å·å‡Œä¹±ã€‚ :s(\u0026ldquo;sigspace\u0026rdquo;) æ­£åˆ™ä¿®é¥°ç¬¦ä½¿è§£æ token é—´çš„ç©ºç™½æ›´ä¼˜é›…ã€‚ä½† Raku ä¸­çš„å­—ç¬¦ç±»æ¯” Perl 5 å¤æ‚äº†ä¸€ä¸¢ä¸¢ã€‚ æ­£åˆ™æ•è·ç»“æœå˜é‡($0, $1, â€¦) è¿”å›ä¸€ä¸ªå®Œæ•´çš„ Match å¯¹è±¡ - å®ƒä¸ºå¤æ‚ä½¿ç”¨åœºæ™¯å¢åŠ äº†å¾ˆå¤šçµæ´»æ€§, ä½†æ˜¯è¿™é‡Œæˆ‘ä»¬åªæƒ³ä¿ç•™å­—ç¬¦ä¸², æ‰€ä»¥ä½¿ç”¨ ~ å‰ç½®æ“ä½œç¬¦å­—ç¬¦ä¸²åŒ–äº†åŒ¹é…å¯¹è±¡ã€‚\næŸ¥çœ‹æ•°æ®çš„ç‰¹å®šé¡¹:\nsay \u0026#34;ZsÃ³fia\u0026#39;s grade: %grade\u0026lt;ZsÃ³fia\u0026gt;\u0026#34;; Raku æ€»æ˜¯æŠŠæ•£åˆ—ä¸­ { } ä¸­çš„ä¸œè¥¿è§£æä¸ºè¡¨è¾¾å¼, ä½¿ç”¨ \u0026lt; \u0026gt; è¡¨ç¤ºå­—é¢å€¼ã€‚\nè¿‡æ»¤æ•°æ®:\nsay \u0026#34;List of students with a failing grade:\u0026#34;; say \u0026#34;\u0026#34; ~ %grade.grep(*.value ge \u0026#34;E\u0026#34;)Â».key.join(\u0026#34;, \u0026#34;); Raku ä¸­å…è®¸æˆ‘ä»¬æŒ‰æ‰§è¡Œé¡ºåºæŠŠä¸€äº›åˆ—æ–¹æ³•å†™ä¸ºé“¾å¼æ“ä½œã€‚æœ‰ä¸€ä¸ªé‡è¦åŒºåˆ«ï¼šRaku èƒ½è®©æˆ‘ä»¬ç›´æ¥éå†æ•£åˆ—çš„é¡¹, æ•£åˆ—ä¸­æ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ª Pair å¯¹è±¡(Pair å¯¹è±¡èƒ½ä½¿ç”¨ .key å’Œ .value æ–¹æ³•)ã€‚\n* Whatever star ç”¨äºå®šä¹‰ä¸€ä¸ªç®€å•çš„å›è°ƒ, è€Œä¸ç”¨å†™ä¸€ä¸ªèŠ±æ‹¬å·å—ã€‚ Â». hyper operator ç”¨äºå¯¹ .grep è¿”å›çš„ Pairs çš„æ¯ä¸ª Pair ä¸Šè°ƒç”¨ ä¸€æ¬¡ .key æ–¹æ³•, å¾—å‡ºå§“ååˆ—è¡¨\nä»æ•°æ®ä¸­åˆ›å»ºé¢‘ç‡åˆ†å¸ƒ:\nsay \u0026#34;Distribution of grades by letter:\u0026#34;; say \u0026#34;{.key}: {+.value}student{\u0026#34;s\u0026#34; if .value != 1}\u0026#34; for %grade.classify(*.value.comb[0]).sort(*.key); è®¡æ•°å’Œåˆ†ç»„å®åœ¨å¤ªå¸¸è§äº†, Raku æä¾›äº† .classify æ–¹æ³•ã€‚ classify æ–¹æ³•é‡Œéœ€è¦æŒ‡å®šè¦åˆ†ç»„çš„é¡¹(è¿™é‡Œæ˜¯ä»£è¡¨ %grade æ¡ç›®çš„ Pair å¯¹è±¡), è¿™äº›é¡¹åº”è¯¥æ ¹æ®ä»€ä¹ˆè§„åˆ™è¿›è¡Œåˆ†ç»„(è¿™é‡Œæ˜¯æ ¹æ®ç¬¬ä¸€ä¸ªå­—æ¯çš„å€¼, å®ƒä»£è¡¨åˆ†æ•°(æ²¡æœ‰ +/-)ã€‚\nè¿™ç”Ÿæˆä¸€ä¸ªåŒ¿åçš„æ•£åˆ—, æ•£åˆ—çš„å€¼æ˜¯åŒ¿åæ•°ç»„ã€‚\n%(\u0026#34;B\u0026#34; =\u0026gt; [\u0026#34;Peter\u0026#34; =\u0026gt; \u0026#34;B\u0026#34;, \u0026#34;ZsÃ³fia\u0026#34; =\u0026gt; \u0026#34;B+\u0026#34;, \u0026#34;Maryam\u0026#34; =\u0026gt; \u0026#34;B+\u0026#34;, \u0026#34;ç§€è‹±\u0026#34; =\u0026gt; \u0026#34;B-\u0026#34;, \u0026#34;Omar\u0026#34; =\u0026gt; \u0026#34;B\u0026#34;], \u0026#34;A\u0026#34; =\u0026gt; [\u0026#34;Celine\u0026#34; =\u0026gt; \u0026#34;A-\u0026#34;, \u0026#34;Aarav\u0026#34; =\u0026gt; \u0026#34;A\u0026#34;], \u0026#34;F\u0026#34; =\u0026gt; [\u0026#34;JoÃ£o\u0026#34; =\u0026gt; \u0026#34;F\u0026#34;, \u0026#34;Emma\u0026#34; =\u0026gt; \u0026#34;F\u0026#34;], \u0026#34;D\u0026#34; =\u0026gt; [\u0026#34;Finn\u0026#34; =\u0026gt; \u0026#34;D+\u0026#34;]) å› ä¸ºæˆ‘ä»¬åªå¯¹æ¯ç»„å…ƒç´ çš„ä¸ªæ•°æ„Ÿå…´è¶£, æˆ‘ä»¬ä½¿ç”¨ + å‰ç½®æ“ä½œç¬¦æ•°å­—åŒ–æ¯ä¸ªå€¼ç„¶åæ‰“å°å®ƒ, åœ¨æ•°ç»„å‰é¢æ·»åŠ  + ç¬¦å·ä¼šå¾—åˆ°æ•°ç»„å…ƒç´ çš„ä¸ªæ•°ã€‚\nåœ¨ term ä½ç½®ä¸Šä¸€ä¸ªå•ç‹¬çš„ .method æ–¹æ³•ç­‰ä»·äº $_.method, æ„æ€æ˜¯å¯¹å½“å‰å¾ªç¯å˜é‡è°ƒç”¨è¯¥æ–¹æ³•ã€‚ä»»æ„ä»£ç çš„è¿”å›å€¼èƒ½ä½¿ç”¨èŠ±æ‹¬å· {} æ’å€¼åˆ°å­—ç¬¦ä¸²ä¸­ã€‚\nif è¯­å¥èƒ½è¢«ç”¨ä½œè¡¨è¾¾å¼ - å½“æ¡ä»¶ä¸º false æ—¶, è¿”å›ç©ºåˆ—è¡¨, ç„¶åè¢«å­—ç¬¦ä¸²åŒ–ä¸ºç©ºå­—ç¬¦ä¸²ã€‚å¯¹å­—ç¬¦ä¸²è°ƒç”¨ä¸å¸¦å‚æ•°çš„ .comb ä¼šç”Ÿæˆè¯¥å­—ç¬¦ä¸²çš„ä¸€ä¸ªå­—ç¬¦åˆ—è¡¨ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2014-12-19-raku-calendar/","tags":["calendar"],"title":"Raku åœ£è¯æœˆå† - 2014"},{"categories":["rakulang"],"contents":"ç¬¬ä¸€ç«  æ¦‚è¦ ç•¥\nç¬¬äºŒç«  åŸºç¡€ å‡è®¾æœ‰ä¸€åœºä¹’ä¹“çƒæ¯”èµ›, æ¯”èµ›ç»“æœä»¥è¿™ç§æ ¼å¼è®°å½•ï¼š\nPlayer1 Player2 | 3:2 è¿™æ„å‘³ç€é€‰æ‰‹1ä¸é€‰æ‰‹2çš„æ¯”åˆ†ä¸º 3:2, ä½ éœ€è¦ä¸€ä¸ªè„šæœ¬ç®—å‡ºæ¯ä½é€‰æ‰‹èµ¢äº†å‡ åœºæ¯”èµ›å¹¶ä¸”èƒœäº†å‡ å±€ã€‚è¾“å…¥æ•°æ®(å­˜å‚¨åœ¨ä¸€ä¸ªå«åš scores çš„æ–‡ä»¶ä¸­)åƒä¸‹é¢è¿™æ ·ï¼š\nBeth Ana Charlie Dave Ana Dave | 3:0 Charlie Beth | 3:1 Ana Beth | 2:3 Dave Charlie | 3:0 Ana Charlie | 3:1 Beth Dave | 0:3 ç¬¬ä¸€è¡Œæ˜¯é€‰æ‰‹æ¸…å•ã€‚éšåæ¯ä¸€è¡Œè®°å½•ç€æ¯”èµ›ç»“æœã€‚\nè¿™é‡Œä½¿ç”¨ Raku ç»™å‡ºä¸€ç§è§£å†³æ–¹æ¡ˆï¼š\n#!/usr/bin/env raku my $file = open \u0026#39;scores\u0026#39;; my @names = $file.get.words ; # get æ–¹æ³•è¯»å…¥ä¸€è¡Œ, æ¯è°ƒç”¨ä¸€æ¬¡ get, è¯»å–ä¸€è¡Œ my %matches; # èµ¢å¾—æ¯”èµ›æ¬¡æ•° my %sets; # èµ¢å¾—æ¯”èµ›å±€æ•° for $file.lines -\u0026gt; $line { # .lines æ˜¯æƒ°æ€§çš„ my ($pairing, $result) = $line.split(\u0026#39;| \u0026#39;); # å¯¹å‰©ä¸‹çš„æ¯ä¸€è¡Œè°ƒç”¨ split æ“ä½œ my ($p1, $p2) = $pairing.words; # æå–é€‰æ‰‹1å’Œé€‰æ‰‹2çš„åå­— my ($r1, $r2) = $result.split(\u0026#39;:\u0026#39;); # æå–æ¯”èµ›æ¯”åˆ† %sets{$p1} += $r1; # é€‰æ‰‹1èµ¢å¾—çš„æ¯”èµ›å±€æ•° %sets{$p2} += $r2; # é€‰æ‰‹2èµ¢å¾—çš„æ¯”èµ›å±€æ•° if $r1 \u0026gt; $r2 { # å¦‚æœæ¯åœºæ¯”èµ›ä¸­, é€‰æ‰‹1èµ¢çš„å±€æ•°å¤šäºé€‰æ‰‹2, åˆ™é€‰æ‰‹1èµ¢å¾—çš„æ¯”èµ›æ•°+1, åä¹‹é€‰æ‰‹2çš„+1 %matches{$p1}++; } else { %matches{$p2}++; } } my @sorted = @names.sort( { %sets{$_} } ).sort({ %matches{$_} } ).reverse; for @sorted -\u0026gt; $n { say \u0026#34;$nhas won %matches{$n}matches and %sets{$n}sets\u0026#34;; } è¾“å‡ºå¦‚ä¸‹ï¼š\nAna has won 2 matches and 8 sets Dave has won 2 matches and 6 sets Charlie has won 1 matches and 4 sets Beth has won 1 matches and 4 sets æ¯ä¸ª Raku ç¨‹åºåº”è¯¥ä»¥ #!/usr/bin/env raku ä½œä¸ºå¼€å§‹ã€‚\nåœ¨ Raku ä¸­, å˜é‡åä»¥ä¸€ä¸ªé­”ç¬¦æ‰“å¤´, è¿™ä¸ªé­”ç¬¦æ˜¯ä¸€ä¸ªéå­—æ¯æ•°å­—ç¬¦å·, è¯¸å¦‚ $, @, % æˆ–è€… \u0026amp;, è¿˜æœ‰æ›´å°‘è§çš„åŒå†’å· ::ã€‚ å†…ç½®å‡½æ•° open æ‰“å¼€äº†ä¸€ä¸ªåå« scores çš„æ–‡ä»¶, å¹¶è¿”å›ä¸€ä¸ªæ–‡ä»¶å¥æŸ„, å³ä¸€ä¸ªä»£è¡¨è¯¥æ–‡ä»¶çš„å¯¹è±¡ã€‚èµ‹å€¼ç¬¦å· = å°†å¥æŸ„èµ‹å€¼ç»™å·¦è¾¹çš„å˜é‡, è¿™æ„å‘³ç€ $file ç°åœ¨å­˜å‚¨ç€è¯¥æ–‡ä»¶å¥æŸ„ã€‚\nmy @names = $file.get.words; ä¸Šè¾¹è¿™å¥çš„å³ä¾§å¯¹å­˜å‚¨åœ¨ $file ä¸­çš„æ–‡ä»¶å¥æŸ„è°ƒç”¨äº† get æ–¹æ³•, get æ–¹æ³•ä»æ–‡ä»¶ä¸­è¯»å–å¹¶è¿”å›ä¸€è¡Œ, å¹¶å»æ‰è¡Œçš„æœ«å°¾ã€‚.words ä¹Ÿæ˜¯ä¸€ä¸ªæ–¹æ³•, ç”¨äºä» get æ–¹æ³•è¿”å›çš„å­—ç¬¦ä¸²ä¸Šã€‚.words æ–¹æ³•å°†å®ƒçš„ç»„ä»¶ - å®ƒæ“ä½œçš„å­—ç¬¦ä¸², åˆ†è§£æˆä¸€ç»„å•è¯, è¿™é‡Œå³æ„å‘³ç€ä¸å«ç©ºæ ¼çš„å­—ç¬¦ä¸²ã€‚å®ƒæŠŠå•ä¸ªå­—ç¬¦ä¸² \u0026lsquo;Beth Ana Charlie Dave\u0026rsquo; è½¬æ¢æˆä¸€ç»„å­—ç¬¦ä¸² \u0026lsquo;Beth\u0026rsquo;, \u0026lsquo;Ana\u0026rsquo;, \u0026lsquo;Charlie\u0026rsquo;, \u0026lsquo;Dave\u0026rsquo;ã€‚æœ€å, è¿™ç»„å­—ç¬¦ä¸²å­˜å‚¨åœ¨æ•°ç»„ @names ä¸­ã€‚\nmy %matches; my %sets; åœ¨æ¯”åˆ†è®¡æ•°ç¨‹åºä¸­, %matches å­˜å‚¨æ¯ä½é€‰æ‰‹èµ¢å¾—çš„æ¯”èµ›æ•°, %sets å­˜å‚¨æ¯ä½é€‰æ‰‹èµ¢å¾—çš„æ¯”èµ›å±€æ•°ã€‚\nfor $file.lines -\u0026gt; $line { ... } for å¾ªç¯ä¸­ $file.lines äº§ç”Ÿä¸€ç»„ä»æ–‡ä»¶ scores è¯»å–çš„è¡Œ, ä»ä¸Šæ¬¡ $file.lines ç¦»å¼€çš„åœ°æ–¹å¼€å§‹, ä¸€ç›´åˆ°æ–‡ä»¶æœ«å°¾ç»“æŸã€‚ åœ¨ç¬¬ä¸€æ¬¡å¾ªç¯ä¸­, $line ä¼šåŒ…å«å­—ç¬¦ä¸² Ana Dave | 3:0; åœ¨ç¬¬äºŒæ¬¡å¾ªç¯ä¸­, $line ä¼šåŒ…å« Charlie Beth | 3:1,ä»¥æ­¤ç±»æ¨ã€‚\nmy ($pairing, $result) = $line.split(\u0026#39;| \u0026#39;); splitæ­¤å¤„æ˜¯ä¸€ä¸ªæ–¹æ³•, å­—ç¬¦ä¸² \u0026lsquo;|\u0026rsquo; æ˜¯å®ƒçš„å‚æ•°ã€‚\nç¬¬ä¸€æ¬¡å¾ªç¯ç»“æŸï¼š\nVariable Contents $line 'Ana Dave | 3:0' $pairing 'Ana Dave' $result '3:0' $p1 'Ana' $p2 'Dave' $r1 '3' $r2 '0'  my @sorted = @names.sort({ %sets{$_} }).sort({ %matches{$_} }).reverse; è¿™ä¸€å¥æ˜¯æ’åº, å…ˆæŒ‰æ¯”èµ›å±€æ•°å¤šå°‘æ’åº, å†æŒ‰èµ¢å¾—çš„æ¯”èµ›æ•°æ’åº, ç„¶ååè½¬ã€‚æ‰“å°é€‰æ‰‹åå­—çš„æ—¶å€™ä»¥èƒœè´Ÿæ¬¡åºæ’åº, ä»£ç å¿…é¡»ä½¿ç”¨é€‰æ‰‹çš„åˆ†æ•°, è€Œéä»–ä»¬çš„åå­—æ¥è¿›è¡Œæ’åºã€‚sort æ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ªä»£ç å—, ç”¨äºå°†æ•°ç»„å…ƒç´ ï¼ˆé€‰æ‰‹çš„åå­—ï¼‰è½¬æ¢æˆç”¨äºæ’åºçš„æ•°æ®ã€‚æ•°ç»„çš„å…ƒç´ é€šè¿‡å˜é‡ $_ ä¼ é€’åˆ°ä»£ç å—ä¸­ã€‚\næœ€ç®€å•çš„ä½¿ç”¨åˆ†æ•°æ’åºé€‰æ‰‹çš„æ–¹æ³•åº”è¯¥æ˜¯:\n@names.sort( { %matches{$_} } ) è¿™æ˜¯é€šè¿‡ä½¿ç”¨èµ¢å¾—æ¯”èµ›çš„æ¬¡æ•°æ¥è¿›è¡Œæ’åºã€‚ç„¶è€Œ, Ana å’Œ Daveéƒ½èµ¢äº†ä¸¤åœºæ¯”èµ›ã€‚è¿˜éœ€è¦æ¯”è¾ƒè°èµ¢çš„çš„æ¯”èµ›å±€æ•°å¤š, æ‰èƒ½å†³å®šæ¯”èµ›çš„æ’åã€‚\nåœ¨åŒå¼•å·æ‹¬èµ·çš„å­—ç¬¦ä¸²ä¸­, æ ‡é‡å’ŒèŠ±æ‹¬å·ä¸­çš„å˜é‡èƒ½è¿›è¡Œå˜é‡æ’å€¼ã€‚\nmy $names = \u0026#39;things\u0026#39;; say \u0026#39;Do not call me $names\u0026#39;; # Do not call me $names say \u0026#34;Do not call me $names\u0026#34;; # Do not call me things èŠ±æ‹¬å·ä¸­çš„æ•°ç»„è¿›è¡Œæ’å€¼åä¼šå˜æˆç”¨ç©ºæ ¼åˆ†éš”çš„æ¡ç›®ã€‚èŠ±æ‹¬å·ä¸­çš„æ•£åˆ—æ’å€¼åæ¯ä¸ªæ•£åˆ—é”®å€¼å¯¹å•ç‹¬æˆä¸ºä¸€è¡Œ, æ¯è¡ŒåŒ…å«ä¸€ä¸ªå¥, éšåæ˜¯ä¸€ä¸ª tab åˆ¶è¡¨ç¬¦, ç„¶åæ˜¯é”®å€¼, æœ€åæ˜¯ä¸€ä¸ªæ–°è¡Œç¬¦ã€‚\nsay \u0026#34;Math: { 1 + 2 }\u0026#34; # Math: 3 my @people = \u0026lt;Luke Matthew Mark\u0026gt;; say \u0026#34;The synoptics are: {@people}\u0026#34; # The synoptics are: Luke Matthew Mark say \u0026#34;{%sets}\u0026#34;; # From the table tennis tournament # Charlie 4 # Dave 6 # Ana 8 # Beth 4 å½“æ•°ç»„å’Œæ•£åˆ—å˜é‡ç›´æ¥å‡ºç°åœ¨åŒå¼•å·å­—ç¬¦ä¸²ä¸­(å¹¶ä¸”ä¸åœ¨èŠ±æ‹¬å· {} é‡Œ), å®ƒä»¬åªåœ¨å®ƒä»¬çš„åå­—åè·Ÿç€ä¸€ä¸ª postcircumfix - ä¸€å¯¹æ‹¬å·, åé¢è·Ÿç€è¯­å¥æ—¶æ‰ä¼šè¿›è¡Œæ’å€¼ã€‚åœ¨å˜é‡åå’Œåç½®ç¯ç¼€ä¹‹é—´è¿›è¡Œæ–¹æ³•è°ƒç”¨ä¹Ÿæ˜¯å¯ä»¥çš„(ä¾‹å¦‚ @flavours.sort())\nmy @flavours = \u0026lt;vanilla peach\u0026gt;; say \u0026#34;we have @flavours\u0026#34;; # we have @flavours, è¿™é‡Œæ²¡è¿›è¡Œæ’å€¼ say \u0026#34;we have @flavours[0]\u0026#34;; # we have vanilla, åç½®ç¯ç¼€, å˜é‡åå­—åé¢è·Ÿç€ä¸€å¯¹å„¿æ‹¬å· # so-called \u0026#34;Zen slice\u0026#34; say \u0026#34;we have @flavours[]\u0026#34;; # we have vanilla peach # ä»¥åç½®ç¯ç¼€ç»“å°¾çš„æ–¹æ³•è°ƒç”¨ say \u0026#34;we have @flavours.sort()\u0026#34;; # we have peach vanilla # é“¾å¼æ–¹æ³•è°ƒç”¨: say \u0026#34;we have @flavours.sort.join(\u0026#39;, \u0026#39;)\u0026#34;; # we have peach, vanilla ç»ƒä¹  ä¾‹å­ä¸­çš„ç¬¬ä¸€è¡Œé€‰æ‰‹çš„åå­—æ˜¯å¤šä½™çš„, ä½ å¯ä»¥åœ¨å‚åŠ æ¯”èµ›çš„é€‰æ‰‹ä¸­æ‰¾å‡ºæ‰€æœ‰é€‰æ‰‹çš„åå­—ï¼å¦‚æœä¾‹å­ä¸­çš„ç¬¬ä¸€è¡Œè¢«çœç•¥äº†, ä½ å¦‚ä½•æ›´æ”¹ç¨‹åºï¼Ÿæç¤ºï¼š%hash.keys è¿”å›æ•£åˆ— %hash ä¸­çš„æ‰€æœ‰é”®ã€‚\nç­”æ¡ˆ: ç§»é™¤æ­¤è¡Œï¼š\nmy @names = $file.get.words; å¹¶ä¸”å°†\nmy @sorted = @names.sort({ %sets{$_} }).sort({ %matches{$_} }).reverse; å˜æˆ:\nmy @sorted = %sets.keys.sort({ %sets{$_} }).sort({ %matches{$_} }).reverse; é™¤äº†ç§»é™¤å†—ä½™, ä½ ä¹Ÿå¯ä»¥ç”¨å®ƒæ¥æé†’æˆ‘ä»¬, å¦‚æœä¸€ä¸ªé€‰æ‰‹æ²¡æœ‰åœ¨ç¬¬ä¸€è¡Œçš„åå­—æ¸…å•ä¸­è¢«æåˆ°, ä¾‹å¦‚å› ä¸ºè¾“å…¥é”™è¯¯, ä½ è¯¥æ€æ ·ä¿®æ”¹ä½ çš„ç¨‹åºï¼Ÿ\nç­”æ¡ˆ: å¼•å…¥å¦å¤–ä¸€ä¸ªæ•£åˆ—, åˆæ³•é€‰æ‰‹çš„åå­—ä½œä¸ºé”®, å½“è¯»å–é€‰æ‰‹åå­—çš„æ—¶å€™æŸ¥æ‰¾è¯¥æ•£åˆ—ï¼š\nmy @names = $file.get.split(\u0026#39;\u0026#39;); my %legitimate-players; for @names -\u0026gt; $n { # -\u0026gt; ä¸¤ä¾§è¦æœ‰ç©ºæ ¼ %legitimate-players{$n} = 1; } for $file.lines -\u0026gt; $line { my ($pairing, $result) = $line.split(\u0026#39;| \u0026#39;); my ($p1, $p2) = $pairing.split(\u0026#39;\u0026#39;); for $p1, $p2 -\u0026gt; $p { if !%legitimate-players{$p} { say \u0026#34;Warning: \u0026#39;$p\u0026#39;is not on our list!\u0026#34;; } } ... } ç¬¬ä¸‰ç«  æ“ä½œç¬¦ my @scores = \u0026#39;Ana\u0026#39; =\u0026gt; 8, \u0026#39;Dave\u0026#39; =\u0026gt; 6, \u0026#39;Charlie\u0026#39; =\u0026gt; 4, \u0026#39;Beth\u0026#39; =\u0026gt; 4; my $screen-width = 30; my $label-area-width = 1 + [max] @scoresÂ».keyÂ».chars; my $max-score = [max] @scoresÂ».value; my $unit = ($screen-width - $label-area-width) / $max-score; my $format = \u0026#39;%- \u0026#39; ~ $label-area-width ~ \u0026#34;s%s\\n\u0026#34;; for @scores { printf $format, .key, \u0026#39;X\u0026#39; x ($unit * .value); } åœ¨è¿™ä¸ªä¾‹å­ä¸­, æˆ‘ä»¬è®¡ç®—ä¸€ä¸‹æ¯ä½é€‰æ‰‹åœ¨ç«æ ‡èµ›ä¸­èµ¢å¾—æ¯”èµ›çš„å±€æ•°ã€‚\nmy @scores = \u0026#39;Ana\u0026#39; =\u0026gt; 8, \u0026#39;Dave\u0026#39; =\u0026gt; 6, \u0026#39;Charlie\u0026#39; =\u0026gt; 4, \u0026#39;Beth\u0026#39; =\u0026gt; 4; è¿™ä¸€å¥å±€åŒ…å«äº†ä¸‰ä¸ªä¸åŒçš„æ“ä½œç¬¦ = å’Œ =\u0026gt; å’Œ ,ã€‚ä»¥å­—ç¬¦ä¸²è¿æ¥æ“ä½œç¬¦ ~ ä¸ºä¾‹, $string ~= \u0026quot;text\u0026quot; ç­‰ä»·äº $string = $string ~ \u0026quot;text\u0026quot;ã€‚\n=\u0026gt; æ“ä½œç¬¦(å¤§é”®å·)åˆ›å»ºäº†ä¸€ä¸ªé”®å€¼å¯¹å¯¹è±¡, ä¸€ä¸ªé”®å€¼å¯¹å­˜å‚¨ç€é”®å’Œå€¼ï¼›é”®åœ¨ =\u0026gt; æ“ä½œç¬¦çš„å·¦ä¾§, å€¼åœ¨å³ä¾§ã€‚è¿™ä¸ªæ“ä½œç¬¦æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ç‰¹æ€§ï¼šç¼–è¯‘å™¨ä¼šæŠŠ =\u0026gt; æ“ä½œç¬¦å·¦ä¾§çš„ä»»ä½•è£¸æ ‡è¯†ç¬¦è§£é‡Šä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ä½ ä¹Ÿå¯ä»¥è¿™æ ·å†™ï¼š\nmy @scores = Ana =\u0026gt; 8, Dave =\u0026gt; 6, Charlie =\u0026gt; 4, Beth =\u0026gt; 4; æœ€åé€—å·æ“ä½œç¬¦ , æ„å»ºäº†ä¸€ä¸ªå¯¹è±¡åºåˆ—, åœ¨è¯¥æƒ…å†µä¸‹, æ‰€è°“çš„å¯¹è±¡å°±æ˜¯é”®å€¼å¯¹ã€‚\nè¿™ä¸‰ä¸ªæ“ä½œç¬¦éƒ½æ˜¯ä¸­ç¼€æ“ä½œç¬¦, è¿™æ„å‘³ç€å®ƒåœ¨ä¸¤ä¸ªæ¡ç›®ä¹‹é—´ã€‚\nä¸€ä¸ªé¡¹å‰é¢å¯ä»¥æœ‰0ä¸ªæˆ–å¤šä¸ªå‰ç¼€æ“ä½œç¬¦, æ‰€ä»¥ä½ å¯ä»¥å†™æ¯”å¦‚ 4 + -5ã€‚+ å·ï¼ˆä¸€ä¸ªä¸­ç¼€æ“ä½œç¬¦ï¼‰çš„åé¢, ç¼–è¯‘å™¨æœŸæœ›ä¸€ä¸ªé¡¹, ä¸ºäº†å°† - å·è§£é‡Šä¸ºé¡¹ 5 çš„ä¸€ä¸ªå‰ç¼€ã€‚\nmy $label-area-width = 1 + [max] @scoresÂ».keyÂ».chars; Â» æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç¬¦å·, æ‰“å°ä¸å‡ºæ¥å¯ä»¥ç”¨ä¸¤ä¸ªå¤§äºå· \u0026gt;\u0026gt; ä»£æ›¿ã€‚ä¸­ç¼€æ“ä½œç¬¦ max è¿”å›ä¸¤ä¸ªå€¼ä¸­çš„è¾ƒå¤§è€…, æ‰€ä»¥ 2 max 3 è¿”å› 3ã€‚æ–¹æ‹¬å·åŒ…è£¹ç€ä¸€ä¸ªä¸­ç¼€æ“ä½œç¬¦è®© Raku å°†è¯¥ä¸­ç¼€æ“ä½œç¬¦åº”ç”¨åˆ°åˆ—è¡¨ä¸­çš„å…ƒç´ ä¹‹é—´ã€‚[max] 1,5,3,7 å’Œ 1 max 5 max 3 max 7 ä¸€æ ·, ç»“æœéƒ½ä¸º 7ã€‚\nåŒæ ·åœ°, [+] ç”¨æ¥è®¡ç®—åˆ—è¡¨å…ƒç´ çš„å’Œ, [*] ç”¨æ¥è®¡ç®—åˆ—è¡¨å…ƒç´ çš„ç§¯, [\u0026lt;=] ç”¨æ¥æ£€æŸ¥ä¸€ä¸ªåˆ—è¡¨çš„å€¼æ˜¯å¦æŒ‰é€’å¢æ’åºã€‚\n@scoresÂ».keyÂ».chars my @scores = Ana =\u0026gt; 8, Dave =\u0026gt; 6, Charlie =\u0026gt; 4, Beth =\u0026gt; 4; Ana 8 Dave 6 Charlie 4 Beth 4 @scores.key Method \u0026#39;key\u0026#39; not found for invocant of class \u0026#39;Array\u0026#39; @scores\u0026gt;\u0026gt;.key Ana Dave Charlie Beth å°±åƒ @variable.method åœ¨ @variable ä¸Šè°ƒç”¨ä¸€ä¸ªæ–¹æ³•ä¸€æ ·, @arrayÂ».method å¯¹ @array ä¸­çš„æ¯ä¸€é¡¹è°ƒç”¨ method æ–¹æ³•, å¹¶ä¸”è¿”å›ä¸€ä¸ªè¿”å›å€¼çš„åˆ—è¡¨ã€‚å³ @scores\u0026gt;\u0026gt;.key è¿”å›ä¸€ä¸ªåˆ—è¡¨ã€‚\n@scores\u0026gt;\u0026gt;.key\u0026gt;\u0026gt;.chars # æ¯ä¸ªåå­—å«æœ‰å‡ ä¸ªå­—ç¬¦ 4 7 4 è¡¨è¾¾å¼ [max] @scoresÂ».keyÂ».chars ç»™å‡º (3,4,7,4) ä¸­çš„æœ€å¤§å€¼ã€‚å®ƒä¸ä¸‹é¢çš„è¡¨è¾¾å¼ç›¸åŒï¼š\n@scores[0].key.chars max @scores[1].key.chars max @scores[2].key.chars max ... @scores[0] \u0026#34;Ana\u0026#34; =\u0026gt; 8 @scores[0].key Ana my $format = \u0026#39;%- \u0026#39; ~ $label-area-width ~ \u0026#34;s%s\\n\u0026#34;; for @scores { printf $format, .key, \u0026#39;X\u0026#39; x ($unit * .value); } å®šä¹‰ä¸€ä¸ªæ ¼å¼, %- è¡¨ç¤ºå·¦å¯¹é½, ~ æ˜¯å­—ç¬¦ä¸²è¿æ¥æ“ä½œç¬¦ .for å¾ªç¯ä¸­, @scores ä¸­çš„æ¯ä¸€é¡¹è¢«ç»‘å®šç»™ç‰¹æ®Šå˜é‡ $_, .key æ˜¯æ¯é¡¹çš„é”®, å³åå­—, .value æ˜¯æ¯é¡¹çš„é”®å€¼, å³å¾—åˆ†ã€‚å° x æ˜¯å­—ç¬¦ä¸²é‡å¤æ“ä½œç¬¦ã€‚\nå…³äºä¼˜å…ˆçº§çš„çš„ä¸€å¥è¯ my @scores = \u0026#39;Ana\u0026#39; =\u0026gt; 8, \u0026#39;Dave\u0026#39; =\u0026gt; 6, \u0026#39;Charlie\u0026#39; =\u0026gt; 4, \u0026#39;Beth\u0026#39; =\u0026gt; 4; ç­‰å·å³ä¾§äº§ç”Ÿä¸€ä¸ªåˆ—è¡¨ï¼ˆå› ä¸ºé€—å·, æ“ä½œç¬¦ï¼‰, è¿™ä¸ªåˆ—è¡¨ç”±å¯¹å„¿ç»„æˆ(å› ä¸º =\u0026gt;), å¹¶ä¸”ç»“æœèµ‹å€¼ç»™æ•°ç»„å˜é‡ã€‚ åœ¨ Perl5 ä¸­ä¼šè¿™æ ·è§£é‡Š:\n(my @scores = \u0026#39;Ana\u0026#39;) =\u0026gt; 8, \u0026#39;Dave\u0026#39; =\u0026gt; 6, \u0026#39;Charlie\u0026#39; =\u0026gt; 4, \u0026#39;Beth\u0026#39; =\u0026gt; 4; ä»¥è‡³äºæ•°ç»„ @scores ä¸­åªæœ‰ä¸€ä¸ªé¡¹, è¡¨è¾¾å¼çš„å…¶ä½™éƒ¨åˆ†è¢«è®¡ç®—åä¸¢å¼ƒã€‚\nä¼˜å…ˆçº§è§„åˆ™æ§åˆ¶ç€ç¼–è¯‘å™¨å¦‚ä½•è§£é‡Šè¿™ä¸€è¡Œã€‚Raku çš„ä¼˜å…ˆçº§è§„åˆ™ç”³æ˜ ä¸­ç¼€æ“ä½œç¬¦ =\u0026gt; æ¯” , ä¸­ç¼€æ“ä½œç¬¦å¯¹äºå‚æ•°çš„ç»‘å®šæ›´ç´§, è€Œé€—å·æ“ä½œç¬¦æ¯”ç­‰å·èµ‹å€¼æ“ä½œç¬¦ç»‘å®šçš„æ›´ç´§ã€‚\nå®é™…ä¸Šæœ‰ä¸¤ç§ä¸åŒä¼˜å…ˆçº§çš„èµ‹å€¼æ“ä½œç¬¦ã€‚å½“èµ‹å€¼æ“ä½œç¬¦å³ä¾§æ˜¯ä¸€ä¸ªæ ‡é‡æ—¶, ä½¿ç”¨è¾ƒç´§ä¼˜å…ˆçº§çš„é¡¹èµ‹å€¼æ“ä½œç¬¦, å¦åˆ™ä½¿ç”¨è¾ƒæ¾ä¼˜å…ˆçº§çš„åˆ—è¡¨èµ‹å€¼æ“ä½œç¬¦ã€‚(å¦‚åŒèºä¸çš„æ¾ç´§) æ¯”è¾ƒ $a = 1, $b = 2 å’Œ @a = 1, 2, å‰è€…æ˜¯åœ¨ä¸€ä¸ªåˆ—è¡¨ä¸­èµ‹å€¼ç»™ä¸¤ä¸ªå˜é‡, åè€…æ˜¯å°†å«æœ‰ä¸¤ä¸ªé¡¹çš„ä¸€ä¸ªåˆ—è¡¨èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ã€‚\nsay 5 - 7 / 2; # 5 - 3.5 = 1.5 say (5 - 7) / 2; # (-2) / 2 = -1 Raku ä¸­çš„ä¼˜å…ˆçº§å¯ä»¥ç”¨åœ†æ‹¬å·æ”¹å˜, ä½†æ˜¯å¦‚æœåœ†æ‹¬å·ç›´æ¥è·Ÿåœ¨æ ‡è¯†ç¬¦çš„åé¢è€Œä¸åŠ ç©ºæ ¼çš„è¯, åˆ™ä¼šè¢«è§£é‡Šä¸ºå‚æ•°åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼š\nsay(5 - 7) / 2; # -2 åªæ‰“å°å‡ºäº† 5-7 çš„å€¼ã€‚\nä¼˜å…ˆçº§è¡¨\n   expression åç§°     (), 42.5 (tightest precedence)   42.rand term   $x++ method calls and postcircumfixes   $x**2 autoincrement and autodecrement   ?$x, !$x exponentiation operator   +$x, ~$x boolean prefix   2*3, 7/5 prefix context operators   1+2, 7-5 multiplicative infix operators   $a x 3 additive infix operators   $x ~\u0026quot;.nn\u0026quot; replication operators   1\u0026amp;2 string concatenation   1 2   abs $x junctive OR   $x cmp 3 named unary prefix   $x == 3 non-chaining binary operators   $x \u0026amp;\u0026amp; $y chaining binary operators   $x    $x \u0026gt; 0 ?? 1 !! -1 tight OR infix   $x = 1 conditional operator   not $x item assignment   1, 2 loose unary prefix   1, 2 Z @a comma   @a = 1, 2 list infix   $x and say \u0026ldquo;Yes\u0026rdquo; list prefix, list assignment   $x or die \u0026ldquo;No\u0026rdquo; loose AND infix   ; loose OR infix    statement terminator    (loosest precedence)    æ¯”è¾ƒå’Œæ™ºèƒ½åŒ¹é… my @a = 1, 2, 3; my @b = 1, 2, 3; say @a === @a; # Bool::True say @a === @b; # Bool::False # these use identity for value say 3 === 3 # Bool::True say \u0026#39;a\u0026#39; === \u0026#39;a\u0026#39;; # Bool::True my $a = \u0026#39;a\u0026#39;; say $a === \u0026#39;a\u0026#39;; # Bool::True @b===@a; # False @a eqv @b; # True \u0026#39;2\u0026#39; eqv 2; # False åªæœ‰å½“ä¸¤ä¸ªå¯¹è±¡æœ‰ç›¸åŒçš„ç±»å‹å’Œç›¸åŒçš„ç»“æ„æ—¶, eqv æ“ä½œç¬¦æ‰è¿”å› Trueã€‚åœ¨å‰é¢å®šä¹‰çš„ä¾‹å­ä¸­, @a eqv @b ç»“æœä¸º True, å› ä¸º @a å’Œ @b å„è‡ªåŒ…å«ç›¸åŒçš„å€¼, å¦ä¸€æ–¹é¢, \u0026lsquo;2\u0026rsquo; eqv 2 è¿”å› \u0026lsquo;False\u0026rsquo; ,å› ä¸ºä¸€ä¸ªå‚æ•°æ˜¯å­—ç¬¦ä¸², å¦ä¸€ä¸ªæ˜¯æ•´æ•°, ç±»å‹ä¸ç›¸åŒã€‚\næ•°å­—æ¯”è¾ƒ ä½¿ç”¨ == ä¸­ç¼€æ“ä½œç¬¦æŸ¥çœ‹ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦æœ‰ç›¸åŒçš„æ•°å­—å€¼ã€‚å¦‚æœæŸä¸ªå¯¹è±¡ä¸æ˜¯æ•°å­—, Perl ä¼šåœ¨æ¯”è¾ƒä¹‹å‰å°½åŠ›ä½¿å…¶æ•°å­—åŒ–ã€‚å¦‚æœæ²¡æœ‰æ›´å¥½çš„æ–¹å¼å°†å¯¹è±¡è½¬æ¢ä¸ºæ•°å­—, Perl ä¼šä½¿ç”¨é»˜è®¤çš„æ•°å­— 0 ã€‚\nsay 1 == 1.0; # Bool::True say 1 == \u0026#39;1\u0026#39;; # Bool::True say 1 == \u0026#39;2\u0026#39;; # Bool::False say 3 == \u0026#39;3b\u0026#39;; # fails è·Ÿæ•°å­—æ¯”è¾ƒç›¸å…³çš„è¿˜æœ‰ \u0026lt;,\u0026lt;=,\u0026gt;,\u0026gt;=ã€‚å¦‚æœä¸¤ä¸ªå¯¹è±¡çš„æ•°å­—å€¼ä¸åŒ, ä½¿ç”¨ != ä¼šè¿”å› True ã€‚\nå¦‚æœä½ å°†æ•°ç»„æˆ–åˆ—è¡¨ä½œä¸ºæ•°å­—, å®ƒä¼šè®¡ç®—åˆ—è¡¨ä¸­é¡¹çš„ä¸ªæ•°ã€‚\nmy @colors = \u0026lt;red blue green\u0026gt;; if @colors == 3 { say \u0026#34;It\u0026#39;s true, @colorscontains 3 items\u0026#34;; } å­—ç¬¦ä¸²æ¯”è¾ƒ Raku ä¸­ä½¿ç”¨ eq æ¯”è¾ƒå­—ç¬¦ä¸², å¿…è¦æ—¶ä¼šå°†å…¶å‚æ•°è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚\nif $greeting eq \u0026#39;hello\u0026#39; { say \u0026#39;welcome\u0026#39;; } Table 3.2: Operators and Comparisons\n   æ•°å­—æ¯”è¾ƒ å­—ç¬¦ä¸²æ¯”è¾ƒ æ„æ€     == eq ç­‰äº   != ne ä¸ç­‰äº   !== !eq ä¸ç­‰äº   \u0026lt; lt å°äº   \u0026lt;= le å°äºæˆ–ç­‰äº   \u0026gt; gt å¤§äº   \u0026gt;= ge å¤§äºæˆ–ç­‰äº    ä¾‹å¦‚, 'a' lt 'b' ä¸º true, 'a' lt 'aa' ä¹Ÿä¸º trueã€‚ != æ˜¯ !== çš„ä¾¿æ·å½¢å¼, å®ƒå®é™…æ˜¯ ! å…ƒæ“ä½œç¬¦åŠ åœ¨ ä¸­ç¼€æ“ä½œç¬¦ == ä¹‹å‰ã€‚åŒæ ·åœ°, ne å’Œ !eqs æ˜¯ä¸€æ ·çš„ã€‚\nä¸‰è·¯æ“ä½œç¬¦\nä¸‰è·¯æ“ä½œç¬¦æœ‰ä¸¤ä¸ªæ“ä½œæ•°, å¦‚æœå·¦ä¾§è¾ƒå°, è¿”å› Order::Increase , ä¸¤ä¾§ç›¸ç­‰åˆ™è¿”å› Order::Same, å¦‚æœå³ä¾§è¾ƒå°åˆ™è¿”å› Order::Decreaseã€‚å¯¹äºæ•°å­—ä½¿ç”¨ä¸‰è·¯æ“ä½œç¬¦ \u0026lt;=\u0026gt;,å¯¹äºå­—ç¬¦ä¸², ä½¿ç”¨ä¸‰è·¯æ“ä½œç¬¦ leg ï¼ˆå–è‡ª lesser, equal, greaterï¼‰ã€‚ä¸­ç¼€æ“ä½œç¬¦ cmp æ˜¯ä¸€ä¸ªå¯¹ç±»å‹æ•æ„Ÿçš„ä¸‰è·¯æ“ä½œç¬¦, å®ƒåƒ \u0026lt;=\u0026gt; ä¸€æ ·æ¯”è¾ƒæ•°å­—, åƒ leg ä¸€æ ·æ¯”è¾ƒå­—ç¬¦ä¸², å¹¶ä¸”æ¯”è¾ƒé”®å€¼å¯¹å„¿æ—¶, å…ˆæ¯”è¾ƒé”®, å¦‚æœé”®ç›¸åŒå†æ¯”è¾ƒé”®å€¼ï¼š\nsay 10 \u0026lt;=\u0026gt; 5; # +1 say 10 leg 5; # because \u0026#39;1\u0026#39; lt \u0026#39;5\u0026#39; say \u0026#39;ab\u0026#39; leg \u0026#39;a\u0026#39;; # +1, lexicographic comparison ä¸‰è·¯æ“ä½œç¬¦çš„å…¸å‹ç”¨å¤„å°±æ˜¯ç”¨åœ¨æ’åºä¸­ã€‚åˆ—è¡¨ä¸­çš„ .sort æ–¹æ³•èƒ½ä½¿ç”¨ä¸€ä¸ªå«æœ‰ä¸¤ä¸ªå€¼çš„å—æˆ–ä¸€ä¸ªå‡½æ•°, æ¯”è¾ƒå®ƒä»¬, å¹¶è¿”å›ä¸€ä¸ªå°äº, ç­‰äºæˆ–å¤§äº 0 çš„å€¼ã€‚ sort æ–¹æ³•æ ¹æ®è¯¥è¿”å›å€¼è¿›è¡Œæ’åºï¼š\nsay ~\u0026lt;abstract Concrete\u0026gt;.sort; # output: Concrete abstract say ~\u0026lt;abstract Concrete\u0026gt;.sort: -\u0026gt; $a, $b { uc($a) leg uc($b) }; # output: abstract Concrete é»˜è®¤çš„, æ¯”è¾ƒæ˜¯å¤§å°å†™æ•æ„Ÿçš„, é€šè¿‡æ¯”è¾ƒå®ƒä»¬çš„å¤§å†™å˜å½¢, è€Œä¸æ˜¯æ¯”è¾ƒå®ƒä»¬çš„å€¼, è¿™ä¸ªä¾‹å­ä½¿ç”¨äº†å¤§å°å†™æ•æ„Ÿæ’åºã€‚\næ™ºèƒ½åŒ¹é… ä½¿ç”¨ ~~ åšæ­£ç¡®çš„äº‹æƒ…ã€‚\nif $pints-drunk ~~ 8 { say \u0026#34;Go home, you\u0026#39;ve had enough!\u0026#34;; } if $country ~~ \u0026#39;Sweden\u0026#39; { say \u0026#34;Meatballs with lingonberries and potato moose, please.\u0026#34; } unless $group-size ~~ 2..4 { say \u0026#34;You must have between 2 and 4 people to book this tour.\u0026#34;; } æ™ºèƒ½åŒ¹é…æ€»æ˜¯æ ¹æ® ~~ å³ä¾§å€¼çš„ç±»å‹æ¥å†³å®šä½¿ç”¨å“ªç§æ¯”è¾ƒã€‚ä¸Šä¸ªä¾‹å­ä¸­, æ¯”è¾ƒçš„æ˜¯æ•°å­—ã€å­—ç¬¦ä¸²å’ŒèŒƒå›´ã€‚ æ™ºèƒ½åŒ¹é…çš„å·¥ä½œæ–¹å¼ $answer ~~ 42 ç­‰ä»·äº 42.ACCPETS( $answer )ã€‚å¯¹ ~~ æ“ä½œç¬¦å³ä¾§çš„æ“ä½œæ•°è°ƒç”¨ ACCEPTS æ–¹æ³•, å¹¶å°†å·¦æ“ä½œæ•°ä½œä¸ºå‚æ•°ä¼ å…¥ã€‚\nç¬¬å››ç«  å­ä¾‹ç¨‹å’Œç­¾å ä¸€ä¸ªå­ä¾‹ç¨‹å°±æ˜¯ä¸€æ®µæ‰§è¡Œç‰¹æ®Šä»»åŠ¡çš„ä»£ç ç‰‡æ®µã€‚å®ƒå¯ä»¥å¯¹æä¾›çš„æ•°æ®(å®å‚)æ“ä½œ, å¹¶äº§ç”Ÿç»“æœï¼ˆè¿”å›å€¼ï¼‰ã€‚å­ä¾‹ç¨‹çš„ç­¾åæ˜¯å®ƒæ‰€å«çš„å‚æ•°å’Œå®ƒäº§ç”Ÿçš„è¿”å›å€¼çš„æè¿°ã€‚ä»æŸä¸€æ„ä¹‰ä¸Šæ¥è¯´, ç¬¬ä¸‰ç« æè¿°çš„æ“ä½œç¬¦ä¹Ÿæ˜¯ Raku ç”¨ç‰¹æ®Šæ–¹å¼è§£é‡Šçš„å­ä¾‹ç¨‹ã€‚\nç”³æ˜å­ä¾‹ç¨‹ å­ä¾‹ç¨‹ç”³æ˜ç”±å‡ éƒ¨åˆ†ç»„æˆã€‚é¦–å…ˆ, sub è¡¨æ˜ä½ åœ¨ç”³æ˜ä¸€ä¸ªå­ä¾‹ç¨‹, ç„¶åæ˜¯å¯é€‰çš„å­ä¾‹ç¨‹çš„åç§°å’Œå¯é€‰çš„ç­¾åã€‚å­ä¾‹ç¨‹çš„ä¸»ä½“æ˜¯ä¸€ä¸ªç”¨èŠ±æ‹¬å·æ‰©èµ·æ¥çš„ä»£ç å—ã€‚ é»˜è®¤çš„, å­ä¾‹ç¨‹æ˜¯æœ¬åœ°ä½œç”¨åŸŸçš„, å°±åƒä»»ä½•ä½¿ç”¨ my ç”³æ˜çš„å˜é‡ä¸€æ ·ã€‚è¿™æ„å‘³ç€, ä¸€ä¸ªå­ä¾‹ç¨‹åªèƒ½åœ¨å®ƒè¢«ç”³æ˜çš„ä½œç”¨åŸŸå†…è¢«è°ƒç”¨ã€‚ä½¿ç”¨ our æ¥ç”³æ˜å­ä¾‹ç¨‹å¯ä»¥ä½¿å…¶åœ¨å½“å‰åŒ…ä¸­å¯è§ã€‚\n{ our sub eat() { say \u0026#34;om nom nom\u0026#34;; } sub drink() { say \u0026#34;glug glug\u0026#34;; } } our \u0026amp;eat; # makes the package-scoped sub eat available in this lexical scope eat(); # om nom nom drink(); # å¤±è´¥, can\u0026#39;t drink outside of the block our ä¹Ÿèƒ½è®©å­ä¾‹ç¨‹ä»åŒ…æˆ–æ¨¡å—çš„å¤–éƒ¨æ˜¯å¯è§çš„ï¼š\nmodule EatAndDrink { our sub eat() { say \u0026#34;om nom nom\u0026#34;; } sub drink() { say \u0026#34;glug glug\u0026#34;; } } EatAndDrink::eat(); # om nom nom EatAndDrink::drink(); # fails, not declared with \u0026#34;our\u0026#34; ä½ ä¹Ÿå¯ä»¥å¯¼å‡ºä¸€ä¸ªå­ä¾‹ç¨‹, è®©å®ƒåœ¨å¦å¤–çš„ä½œç”¨åŸŸå†…å¯è§ã€‚\n# in file Math/Trivial.pm module Math::Trivial { sub double($x) is export { return 2 * $x; } } ç„¶ååœ¨å…¶å®ƒç¨‹åºæˆ–æ¨¡å—ä¸­ä½ å¯ä»¥è¿™æ ·å†™:\nuse Math::Trivial; # imports sub double say double(21); # 21 is only half the truth Raku çš„å­ä¾‹ç¨‹éƒ½æ˜¯å¯¹è±¡ã€‚ä½ å¯ä»¥å°†å®ƒä»¬éšæ„ä¼ é€’å¹¶å­˜å‚¨åœ¨æ•°æ®ç»“æ„ä¸­ã€‚ç¼–ç¨‹è¯­è¨€è®¾è®¡è€…å¸¸å¸¸å°†å®ƒä»¬ç§°ä¹‹ä¸º first-class å­ä¾‹ç¨‹ï¼›å®ƒä»¬å°±åƒæ•°ç»„å’Œæ•£åˆ—ä¸€æ ·ä½œä¸ºè¯­è¨€çš„åŸºç¡€ã€‚\nFirst-class å­ä¾‹ç¨‹èƒ½å¸®åŠ©ä½ è§£å†³å¤æ‚çš„é—®é¢˜ã€‚ä¾‹å¦‚, ä¸ºäº†åšå‡ºä¸€ä¸ªå¾®å‹çš„ASCIIè‰ºæœ¯èˆè¹ˆå›¾, ä½ å¯èƒ½è¦å»ºç«‹ä¸€ä¸ªæ•£åˆ—, é”®æ˜¯èˆè¹ˆåŠ¨ä½œçš„åç§°, é”®å€¼æ˜¯åŒ¿åæ•£åˆ—ã€‚å‡ä½¿ä½¿ç”¨è€…èƒ½é”®å…¥ä¸€ç³»åˆ—èˆè¹ˆåŠ¨ä½œï¼ˆå¯èƒ½æ˜¯ç«™åœ¨èˆè¹ˆå¹³å°ä¸Šæˆ–å…¶å®ƒå¤–éƒ¨è¾“å…¥è®¾å¤‡ï¼‰ã€‚ ä½ æ€ä¹ˆä¿æŒä¸€ä¸ªå˜é‡æ¸…å•ä¸­éƒ½æ˜¯åˆæ³•çš„è¡Œä¸º, å…è®¸ä½¿ç”¨è€…è¾“å…¥, å¹¶é™åˆ¶è¾“å…¥æ˜¯ä¸€ç³»åˆ—å®‰å…¨çš„è¡Œä¸ºå‘¢ï¼Ÿ\nmy %moves = hands-over-head =\u0026gt; sub { say \u0026#39;/o\\ \u0026#39; }, bird-arms =\u0026gt; sub { say \u0026#39;|/o\\| \u0026#39;}, left =\u0026gt; sub { say \u0026#39;\u0026gt;o \u0026#39; }, right =\u0026gt; sub { say \u0026#39;o\u0026lt; \u0026#39; }, arms-up =\u0026gt; sub { say \u0026#39;\\o/ \u0026#39; }; my @awesome-dance = \u0026lt;arms-up bird-arms right hands-over-head\u0026gt;; for @awesome-dance -\u0026gt; $move { %moves{$move}.(); # åœ¨æ•£åˆ—ä¸Šè°ƒç”¨æ–¹æ³• } outputs: \\o/ |/o\\| o\u0026lt; /o\\.  Adding Signatures å­ä¾‹ç¨‹çš„ç­¾åæ‰§è¡Œä¸¤ä¸ªä»»åŠ¡ã€‚é¦–å…ˆ, å®ƒç”³æ˜å“ªä¸ªè°ƒç”¨è€…å¯èƒ½æˆ–å¿…é¡»å°†å‚æ•°ä¼ é€’ç»™å­ä¾‹ç¨‹ã€‚ç¬¬äºŒ, å®ƒç”³æ˜å­ä¾‹ç¨‹ä¸­çš„å˜é‡è¢«ç»‘å®šåˆ°å“ªäº›å‚æ•°ä¸Šã€‚è¿™äº›å˜é‡å«åšå‚æ•°ã€‚Raku çš„ç­¾åæ›´æ·±å…¥, å®ƒä»¬å…è®¸ä½ é™åˆ¶å‚æ•°çš„ç±»å‹, å€¼å’Œå‚æ•°çš„å®šä¹‰, å¹¶å‡†ç¡®åŒ¹é…å¤æ‚æ•°æ®ç»“æ„çš„æŸä¸€éƒ¨åˆ†ã€‚æ­¤å¤–, å®ƒä»¬ä¹Ÿå…è®¸ä½ æ˜¾å¼åœ°æŒ‡å®šå­ä¾‹ç¨‹è¿”å›å€¼çš„ç±»å‹ã€‚\nåŸºç¡€ ç­¾åæœ€ç®€å•çš„å½¢å¼æ˜¯, ç»‘å®šåˆ°è¾“å…¥å‚æ•°ä¸Šçš„ç”¨é€—å·åˆ†éš”çš„ä¸€åˆ—å˜é‡çš„åå­—ã€‚\nsub order-beer($type, $pints) { say ($pints == 1 ?? \u0026#39;A pint\u0026#39; !! \u0026#34;$pintspints\u0026#34;) ~ \u0026#34;of $type, please.\u0026#34; } order-beer(\u0026#39;Hobgoblin\u0026#39;, 1); # A pint of Hobgoblin, please. order-beer(\u0026#39;ZlatÃ½ BaÅ¾ant\u0026#39;, 3); # 3 pints of ZlatÃ½ BaÅ¾ant, please. è¿™é‡Œä½¿ç”¨çš„å…³ç³»ç»‘å®šè€Œéèµ‹å€¼å°±æ˜¯ç­¾åã€‚é»˜è®¤åœ°, åœ¨ Raku ä¸­, å­ä¾‹ç¨‹ä¸­å¼•ç”¨åˆ°ä¼ å…¥å‚æ•°çš„ç­¾åçš„å˜é‡æ˜¯åªè¯»çš„ã€‚è¿™æ„å‘³ç€ä½ ä¸èƒ½ä»å­ä¾‹ç¨‹å†…éƒ¨ä¿®æ”¹å®ƒä»¬ã€‚ å¦‚æœåªè¯»ç»‘å®šå¤ªå—é™åˆ¶äº†, ä½ å¯ä»¥å°† is rw (rw æ˜¯ read/write çš„ç¼©å†™) ç‰¹æ€§åº”ç”¨åˆ°å‚æ•°ä¸Šä»¥é™ä½è¿™ç§é™åˆ¶ã€‚è¿™ä¸ªç‰¹æ€§è¯´æ˜å‚æ•°æ˜¯å¯è¯»å¯å†™çš„, è¿™å…è®¸ä½ ä»å­ä¾‹ç¨‹å†…éƒ¨ä¿®æ”¹å‚æ•°ã€‚ä½¿ç”¨çš„æ—¶å€™å¿…é¡»å°å¿ƒ, å› ä¸ºå®ƒä¼šä¿®æ”¹ä¼ å…¥çš„åŸå§‹å¯¹è±¡ã€‚å¦‚æœä½ è¯•å›¾ä¼ å…¥ä¸€ä¸ªå­—é¢å€¼, ä¸€ä¸ªå¸¸é‡, æˆ–å…¶å®ƒç±»å‹çš„ä¸å¯å˜å¯¹è±¡åˆ°ä¸€ä¸ªæœ‰ is rw ç‰¹æ€§çš„å‚æ•°ä¸­, ç»‘å®šä¼šåœ¨è°ƒç”¨æ—¶å¤±è´¥å¹¶æŠ›å‡ºå¼‚å¸¸:\nsub make-it-more-so($it is rw) { $it ~= substr($it, $it.chars - 1) x 5; } my $happy = \u0026#34;yay!\u0026#34;; make-it-more-so($happy); say $happy; # yay!!!!!! # åŸå§‹ä¼ å…¥å¯¹è±¡è¢«ä¿®æ”¹äº† make-it-more-so(\u0026#34;uh-oh\u0026#34;); # å¤±è´¥, ä¸èƒ½ä¿®æ”¹ä¸€ä¸ªå¸¸é‡ å¦‚æœä½ æƒ³å°†å‚æ•°çš„æœ¬åœ°å‰¯æœ¬ç”¨åœ¨å­ä¾‹ç¨‹å†…éƒ¨è€Œä¸æ”¹å˜è°ƒç”¨è€…çš„å˜é‡, ä½¿ç”¨ is copy ç‰¹æ€§ï¼š\nsub say-it-one-higher($it is copy) { $it++; say $it; } my $unanswer = 41; say-it-one-higher($unanswer); # 42 say-it-one-higher(41); # 42 say $unanswer; # 41 åœ¨è¯¸å¦‚ C/C++ å’Œ Scheme ç­‰å…¶å®ƒç±»å‹çš„ç¼–ç¨‹è¯­è¨€ä¸­,è¿™ç§å¹¿ä¸ºäººçŸ¥çš„æ±‚å€¼ç­–ç•¥å°±æ˜¯æŒ‰å€¼ä¼ é€’ã€‚å½“ä½¿ç”¨ is copy ç‰¹æ€§æ—¶, åªæœ‰æœ¬åœ°å‰¯æœ¬è¢«èµ‹å€¼ã€‚å…¶å®ƒä»»ä½•ä¼ é€’ç»™å­ä¾‹ç¨‹çš„å‚æ•°åœ¨è°ƒç”¨è€…çš„ä½œç”¨åŸŸå†…ä¿æŒä¸å˜ã€‚ï¼ˆä¸€ä¸ªä¸å¯å˜å¯¹è±¡æ˜¯å½“è¿™ä¸ªå¯¹è±¡è¢«åˆ›å»ºå, å®ƒçš„çŠ¶æ€ä¸ä¼šæ”¹å˜, ä½œä¸ºæ¯”è¾ƒ, ä¸€ä¸ªå¯å˜å¯¹è±¡çš„çŠ¶æ€åœ¨åˆ›å»ºåæ˜¯ä¼šè¢«æ”¹å˜çš„ï¼‰\nä¼ é€’æ•°ç»„ã€æ•£åˆ—å’Œä»£ç  ä¸€ä¸ªå˜é‡çš„é­”ç¬¦è¡¨æ˜å®ƒçš„æœ¬æ„ç”¨é€”ã€‚åœ¨ç­¾åä¸­, å˜é‡çš„é­”ç¬¦ä¹Ÿèµ·ç€é™åˆ¶ä¼ å…¥çš„å‚æ•°ç±»å‹çš„ä½œç”¨ã€‚ä¾‹å¦‚, @ ç¬¦å·æ£€æŸ¥ä¼ å…¥çš„å¯¹è±¡è¡Œä½¿ä½ç½®è§’è‰²ï¼ˆä¸€ä¸ªè§’è‰²åŒ…å«åƒæ•°ç»„å’Œåˆ—è¡¨çš„ç±»å‹ï¼‰ã€‚å¦‚æœä¼ é€’çš„ä¸œè¥¿ä¸èƒ½åŒ¹é…è¿™æ ·çš„é™åˆ¶, ä¼šå¼•èµ·è°ƒç”¨å¤±è´¥ï¼š\nsub shout-them(@words) { for @words -\u0026gt; $w { print uc(\u0026#34;$w\u0026#34;); } } my @last_words = \u0026lt;do not want\u0026gt;; shout-them(@last_words); # DO NOT WANT shout-them(\u0026#39;help\u0026#39;); # å¤±è´¥äº†, å­—ç¬¦ä¸²ä¸æ˜¯ä½ç½®å‚æ•° ç±»ä¼¼åœ°, % ç¬¦å·è¡¨æ˜è°ƒç”¨è€…å¿…é¡»ä¼ é€’ä¸€ä¸ªè¡Œä½¿å…³ç³»è§’è‰²çš„å¯¹è±¡ï¼›å³å…è®¸é€šè¿‡ \u0026lt;...\u0026gt; æˆ– {...} è¿›è¡Œç´¢å¼•çš„ä¸œè¥¿ã€‚ \u0026amp; ç¬¦å·è¦æ±‚è°ƒç”¨è€…ä¼ é€’ä¸€ä¸ªè¯¸å¦‚åŒ¿åæ•£åˆ—ä¹‹ç±»çš„è¡Œä½¿èƒ½è°ƒç”¨çš„è§’è‰²çš„å¯¹è±¡ã€‚åœ¨é‚£ç§æƒ…å†µä¸‹, ä½ ä¹Ÿå¯ä»¥ä¸ç”¨ \u0026amp; ç¬¦å·è°ƒç”¨å¯è°ƒç”¨çš„å‚æ•°ï¼š\nsub do-it-lots(\u0026amp;it, $how-many-times) { for 1..$how-many-times { it(); } } do-it-lots(sub { say \u0026#34;Eating a stroopwafel\u0026#34; }, 10); # æ­¤å¤„æ˜¯ä¸€ä¸ªåŒ¿åå­ä¾‹ç¨‹ æ ‡é‡ä½¿ç”¨ $ ç¬¦å·, å¹¶è¡¨æ˜æ²¡æœ‰é™åˆ¶ã€‚ä»€ä¹ˆéƒ½å¯ä»¥ç»‘å®šåœ¨å®ƒä¸Šé¢, å³ä½¿å®ƒä½¿ç”¨å¦å¤–çš„ç¬¦å·ç»‘å®šåˆ°ä¸€ä¸ªå¯¹è±¡ä¸Šã€‚\næ’å€¼ã€æ•°ç»„å’Œæ•£åˆ— æœ‰æ—¶ä½ æƒ³ä»æ•°ç»„ä¸­å¡«å……å ä½å‚æ•°ã€‚ä½ å¯ä»¥é€šè¿‡åœ¨æ•°ç»„å‰æ·»åŠ ä¸€ä¸ªå‚ç›´ç«–æ¡æˆ–ç®¡é“å­—ç¬¦ ( | ): eat(|@food), è€Œä¸æ˜¯å†™ä½œ eat(@food[0], @food[1], @food[2], ...) ç­‰å°†å®ƒä»¬å¸è¿›å‚æ•°åˆ—è¡¨( | åƒä¸åƒä¸€ä¸ªå¸ç®¡, ^_^)ã€‚\nåŒæ ·åœ°, ä½ å¯ä»¥å°†æ•£åˆ—æ’å€¼è¿›å…·åå‚æ•°:\nsub order-shrimps($count, :$from) { say \u0026#34;I\u0026#39;d like $countpieces of shrimp from the $from, please\u0026#34;; } my %user-preferences = from =\u0026gt; \u0026#39;Northern Sea\u0026#39;; order-shrimps(3, |%user-preferences); # I\u0026#39;d like 3 pieces of shrimp from the Northern Sea, please å¯é€‰å‚æ•° ä¸ºä½¿å‚æ•°å¯é€‰, è¦ä¹ˆç»™ç­¾åçš„å‚æ•°èµ‹å€¼ä¸ºé»˜è®¤å€¼ï¼š\nsub order-steak($how = \u0026#39;medium\u0026#39;) { say \u0026#34;I\u0026#39;d like a steak, $how\u0026#34;; } order-steak(); order-steak(\u0026#39;well done\u0026#39;); æˆ–è€…åœ¨å‚æ•°åå­—çš„åé¢æ·»åŠ ä¸€ä¸ªé—®å·(?):\nsub order-burger($type, $side?) { say \u0026#34;I\u0026#39;d like a $typeburger\u0026#34; ~ ( defined($side) ?? \u0026#34;with a side of $side\u0026#34; !! \u0026#34;\u0026#34; ); } order-burger(\u0026#34;triple bacon\u0026#34;, \u0026#34;deep fried onion rings\u0026#34;); å¦‚æœæ²¡æœ‰å‚æ•°è¢«ä¼ é€’, å‚æ•°ä¼šè¢«ç»‘å®šæˆä¸€ä¸ªæœªå®šä¹‰çš„å€¼ã€‚defined(...) å‡½æ•°ç”¨æ¥æ£€æŸ¥æ˜¯å¦æœ‰å€¼ã€‚\nå¼ºåˆ¶å‚æ•° é»˜è®¤åœ°, ä½ç½®å‚æ•°æ˜¯å¿…ä¸å¯å°‘çš„ã€‚ç„¶è€Œ, ä½ å¯ä»¥é€šè¿‡åœ¨å‚æ•°åé¢è¿½åŠ ä¸€ä¸ªæ„Ÿå¹å·æ¥æ˜¾å¼åœ°æŒ‡å®šè¯¥å‚æ•°æ˜¯å¿…é¡»çš„ï¼š\nsub order-drink($size, $flavor!) { say \u0026#34;$size$flavor, coming right up!\u0026#34;; } order-drink(\u0026#39;Large\u0026#39;, \u0026#39;Mountain Dew\u0026#39;); # OK order-drink(\u0026#39;Small\u0026#39;); # Error å…·åå®å‚å’Œå½¢å‚  arguments å®å‚ parameters å½¢å‚  å½“ä¸€ä¸ªå­ä¾‹ç¨‹æœ‰å¾ˆå¤šå‚æ•°æ—¶, è°ƒç”¨è€…å¾ˆéš¾è®°æ¸…ä¼ é€’å‚æ•°çš„é¡ºåºã€‚è¿™ç§æƒ…å†µä¸‹, é€šè¿‡åå­—ä¼ é€’å‚æ•°å¾€å¾€æ›´å®¹æ˜“ã€‚è¿™æ ·, å‚æ•°å‡ºç°çš„é¡ºåºå°±æ— å…³ç´§è¦äº†:\nsub order-beer($type, $pints) { say ($pints == 1 ?? \u0026#39;A pint\u0026#39; !! \u0026#34;$pintspints\u0026#34;) ~ \u0026#34;of $type, please.\u0026#34; } order-beer(type =\u0026gt; \u0026#39;Hobgoblin\u0026#39;, pints =\u0026gt; 1); # A pint of Hobgoblin, please. order-beer(pints =\u0026gt; 3, type =\u0026gt; \u0026#39;ZlatÃ½ BaÅ¾ant\u0026#39;); # 3 pints of ZlatÃ½ BaÅ¾ant, please. ä½ ä¹Ÿå¯ä»¥æŒ‡å®šå‚æ•°åªèƒ½æŒ‰åå­—è¢«ä¼ é€’ï¼ˆè¿™æ„å‘³ç€å®ƒä¸å…è®¸æŒ‰ä½ç½®ä¼ é€’ï¼‰ã€‚è¿™æ ·çš„è¯, åœ¨å‚æ•°åå­—å‰åŠ ä¸€ä¸ªå†’å·ï¼š\nsub order-shrimps($count, :$from = \u0026#39;Northern Sea\u0026#39;) { say \u0026#34;I\u0026#39;d like $countpieces of shrimp from the $from, please\u0026#34;; } order-shrimps(6); # takes \u0026#39;Northern Sea\u0026#39; order-shrimps(4, from =\u0026gt; \u0026#39;Atlantic Ocean\u0026#39;); order-shrimps(22, \u0026#39;Mediterranean Sea\u0026#39;); # ä¸å…è®¸, :$from is named only ä¸åƒä½ç½®å‚æ•°, å‘½åå‚æ•°é»˜è®¤æ˜¯å¯é€‰çš„ã€‚åœ¨å‘½åå‚æ•°åé¢è¿½åŠ ä¸€ä¸ª ! å·ä½¿å‘½åå‚æ•°å¼ºåˆ¶æ€§å­˜åœ¨ã€‚\nsub design-ice-cream-mixture($base = \u0026#39;Vanilla\u0026#39;, :$name!) { say \u0026#34;Creating a new recipe named $name!\u0026#34; } design-ice-cream-mixture(name =\u0026gt; \u0026#39;Plain\u0026#39;); design-ice-cream-mixture(base =\u0026gt; \u0026#39;Strawberry chip\u0026#39;); # é”™è¯¯,æ²¡æœ‰æŒ‡å®š $name é‡å‘½åå‚æ•°\nå› ä¸ºæŒ‰åå­—ä¼ é€’å®å‚ç»™å½¢å‚æ˜¯åˆç†çš„, å½¢å‚çš„åå­—åº”è¯¥åº”è¯¥ä½œä¸ºå­ä¾‹ç¨‹å…¬å…± API çš„ä¸€éƒ¨åˆ†è¢«è€ƒè™‘åœ¨å†…. å°å¿ƒåœ°æŒ‘é€‰å®ƒä»¬å§! æœ‰æ—¶å€™, ä½¿ç”¨ä¸€ä¸ªåå­—æš´éœ²å½¢å‚è€Œä½¿ç”¨å¦å¤–ä¸€ä¸ªåå­—ç»‘å®šåˆ°å˜é‡ä¼šå¾ˆæ–¹ä¾¿:\nsub announce-time(:dinner($supper) = \u0026#39;8pm\u0026#39;) { say \u0026#34;We eat dinner at $supper\u0026#34;; } announce-time(dinner =\u0026gt; \u0026#39;9pm\u0026#39;); # We eat dinner at 9pm å‚æ•°å¯ä»¥æœ‰å¤šä¸ªåå­—, å¦‚æœä½ çš„ç”¨æˆ·æœ‰äº›æ˜¯è‹±å›½äºº, æœ‰äº›æ˜¯ç¾å›½äºº, ä½ å¯èƒ½è¿™æ ·å†™ï¼š\nsub paint-rectangle( :$x = 0, :$y = 0, :$width = 100, :$height = 50, :color(:colour($c))) { # print a piece of SVG that represents a rectangle say qq[\u0026lt;rect x=\u0026#34;$x\u0026#34; y=\u0026#34;$y\u0026#34; width=\u0026#34;$width\u0026#34; height=\u0026#34;$height\u0026#34; \u0026gt;] } # both calls work the same paint-rectangle :color\u0026lt;Blue\u0026gt;; paint-rectangle :colour\u0026lt;Blue\u0026gt;; # of course you can still fill the other options paint-rectangle :width(30), :height(10), :colour\u0026lt;Blue\u0026gt;; å¯é€‰çš„å‘½åå‚æ•°è¯­æ³•\nå‘½åå˜é‡é€šå¸¸æ˜¯æˆå¯¹çš„ï¼ˆé”®å€¼å¯¹ï¼‰ã€‚å†™ä¸€ä¸ª Pairs æœ‰å¤šç§æ–¹å¼ã€‚å„ç§æ–¹æ³•çš„ä¸åŒä¹‹å¤„å°±æ˜¯æ¸…æ™°æ€§, å› ä¸ºæ¯ç§é€‰æ‹©æä¾›ä¸åŒçš„å¼•è¿°æœºåˆ¶ã€‚ä¸‹é¢çš„ä¸‰ç§è°ƒç”¨æ˜¯ä¸€æ ·çš„æ„æ€ï¼š\nannounce-time(dinner =\u0026gt; \u0026#39;9pm\u0026#39;); announce-time(:dinner(\u0026#39;9pm\u0026#39;)); announce-time(:dinner\u0026lt;9pm\u0026gt;); å¦‚æœä¼ é€’çš„æ˜¯å¸ƒå°”å€¼, ä½ å¯ä»¥çœç•¥é”®å€¼å¯¹çš„é”®å€¼ï¼š\ntoggle-blender( :enabled); # enables the blender å¼€å¯æœæ±æœº toggle-blender(:!enabled); # disables the blender å…³é—­æœæ±æœº å½¢å¦‚ :name ä½†ä¸å¸¦å€¼çš„å‘½åå‚æ•°æœ‰ä¸€ä¸ªéšå¼çš„å¸ƒå°”çœŸå€¼ Bool::Trueã€‚å®ƒçš„å¯¹ç«‹å½¢å¼æ˜¯ :!name , å…¶å€¼æ˜¯éšå¼çš„å¸ƒå°”å‡å€¼ Bool::falseã€‚å¦‚æœä½ ä½¿ç”¨å˜é‡åˆ›å»ºäº†ä¸€ä¸ª Pair, ä½ å¯ä»¥å°†å˜é‡åä½œä¸º Pair çš„é”®å¤ç”¨.\nmy $dinner = \u0026#39;9pm\u0026#39;; announce-dinner :$dinner; # same as dinner =\u0026gt; $dinner;  Pair forms and their meanings. Shorthand Long form Description :allowed allowed =\u0026gt; Bool::True Boolean flag :!allowed allowed =\u0026gt; Bool::False Boolean flag :bev\u0026lt;tea coffee\u0026gt; bev =\u0026gt; ('tea', 'coffee') List :times[1, 3] times =\u0026gt; [1, 3] Array :opts{ a =\u0026gt; 2 } opts =\u0026gt; { a =\u0026gt; 2 } Hash :$var var =\u0026gt; $var Scalar variable :@var var =\u0026gt; @var Array variable :%var var =\u0026gt; %var Hash variable :\u0026amp;var vaf =\u0026gt; \u0026amp;var Callable/ Subroutine variable  ä½ å¯ä»¥ä½¿ç”¨åœ¨ä»»ä½•å¯ä»¥ä½¿ç”¨ Pair å¯¹è±¡çš„ä¸Šä¸‹æ–‡ä½¿ç”¨è¡¨ä¸­çš„ä»»æ„ä¸€ç§å½¢å¼. ä¾‹å¦‚, ç”Ÿæˆæ•£åˆ—:\n# TODO: better example my $black = 12; my %color-popularities = :$black, :blue(8), red =\u0026gt; 18, :white\u0026lt;0\u0026gt;; # ä¸æ­¤ç›¸åŒï¼š # my %color-popularities = # black =\u0026gt; 12, # blue =\u0026gt; 8, # red =\u0026gt; 18, # white =\u0026gt; 0; æœ€å, é€šè¿‡ä½ç½®è€Œéåå­—ä¼ é€’ä¸€ä¸ªå·²å­˜åœ¨çš„ Pair å¯¹è±¡åˆ°å­ä¾‹ç¨‹ä¸­, è¦ä¹ˆæŠŠå®ƒæ”¾åœ¨åœ†æ‹¬å·ä¸­ ( å°±åƒ (:$thing) ), æˆ–è€…ä½¿ç”¨ =\u0026gt; æ“ä½œç¬¦å¼•èµ·å·¦ä¾§çš„å­—ç¬¦ä¸²: \u0026quot;thing\u0026quot; =\u0026gt; $thingã€‚\nå‚æ•°çš„é¡ºåº\nå½“ä½ç½®å‚æ•°å’Œå‘½åå‚æ•°éƒ½å‡ºç°åœ¨ç­¾åä¸­æ—¶, æ‰€æœ‰çš„ä½ç½®å‚æ•°éƒ½è¦å‡ºç°åœ¨å‘½åå‚æ•°ä¹‹å‰ï¼š\nsub mix(@ingredients, :$name) { ... } # OK sub notmix(:$name, @ingredients) { ... } # Error å¿…é¡»çš„ä½ç½®å‚æ•°è¦åœ¨å¯é€‰çš„ä½ç½®å‚æ•°ä¹‹å‰ã€‚ç„¶è€Œ, å‘½åå‚æ•°æ²¡æœ‰è¿™ç§é™åˆ¶ã€‚\nsub copy-machine($amount, $size = \u0026#39;A4\u0026#39;, :$color!, :$quality) { ... } # OK sub fax-machine($amount = 1, $number) { ... } # Error Slurpy å‚æ•° æœ‰æ—¶å€™, ä½ ä¼šå¸Œæœ›è®©å­ä¾‹ç¨‹æ¥å—ä»»ä½•æ•°é‡çš„å‚æ•°, å¹¶ä¸”å°†æ‰€æœ‰è¿™äº›å‚æ•°æ”¶é›†åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„, ç»™ç­¾åæ·»åŠ ä¸€ä¸ªæ•°ç»„å‚æ•°, å°±æ˜¯åœ¨æ•°ç»„å‰æ·»åŠ ä¸€ä¸ª * å·å‰ç¼€ï¼š\nsub shout-them(*@words) { for @words -\u0026gt; $w { print uc(\u0026#34;$w\u0026#34;); } } # ç°åœ¨ä½ å¯ä»¥ä¼ é€’é¡¹ shout-them(\u0026#39;go\u0026#39;); # GO shout-them(\u0026#39;go\u0026#39;, \u0026#39;home\u0026#39;); # GO HOME é™¤äº†é›†åˆæ‰€æœ‰çš„å€¼ä¹‹å¤–, slurpy å‚æ•°ä¼šå±•å¹³ä»»ä½•å®ƒæ¥æ”¶åˆ°çš„æ•°ç»„, æœ€åä½ åªä¼šå¾—åˆ°ä¸€ä¸ªå±•å¹³çš„åˆ—è¡¨, å› æ­¤ï¼š\nmy @words = (\u0026#39;go\u0026#39;, \u0026#39;home\u0026#39;); shout-them(@words); ä¼šå¯¼è‡´ *@words å‚æ•°æœ‰ä¸¤ä¸ªå­—ç¬¦ä¸²å…ƒç´ , è€Œéåªæœ‰å•ä¸ªæ•°ç»„å…ƒç´ ã€‚\nä½ å¯ä»¥é€‰æ‹©å°†æŸäº›å‚æ•°æ•è·åˆ°ä½ç½®å‚æ•°ä¸­, å¹¶è®©å…¶å®ƒå‚æ•°è¢«å¸è¿›æ•°ç»„å‚æ•°é‡Œã€‚è¿™ç§æƒ…å†µä¸‹, slupy åº”è¯¥æ”¾åˆ°æœ€åã€‚ç›¸ä¼¼åœ°, *%hash slurps æ‰€æœ‰å‰©ä¸‹çš„æœªç»‘å®šçš„å‘½åå‚æ•°åˆ°æ•£åˆ— %hash ä¸­ã€‚Slurpy æ•°ç»„å’Œæ•£åˆ—å…è®¸ä½ ä¼ é€’æ‰€æœ‰çš„ä½ç½®å‚æ•°å’Œå‘½åå‚æ•°åˆ°å¦ä¸€ä¸ªå­ä¾‹ç¨‹ä¸­ã€‚\nsub debug-wrapper(\u0026amp;code, *@positional, *%named) { warn \u0026#34;Calling \u0026#39;\u0026amp;code.name()\u0026#39; with arguments \u0026#34; ~ \u0026#34;@positional.perl(), %named.perl()\\n\u0026#34;; code(|@positional, |%named); warn \u0026#34;... back from \u0026#39;\u0026amp;code.name()\u0026#39;\\n\u0026#34;; } debug-wrapper(\u0026amp;order-shrimps, 4, from =\u0026gt; \u0026#39;Atlantic Ocean\u0026#39;); è¿”å›å€¼ å­ä¾‹ç¨‹ä¹Ÿèƒ½è¿”å›å€¼ã€‚ä¹‹å‰æœ¬ç« ä¸­çš„ ASCII è‰ºæœ¯èˆè¹ˆä¾‹å­ä¼šæ›´ç®€å•å½“æ¯ä¸ªå­ä¾‹ç¨‹è¿”å›ä¸€ä¸ªæ–°å­—ç¬¦ä¸²ï¼š\nmy %moves = hands-over-head =\u0026gt; sub { return \u0026#39;/o\\ \u0026#39; }, bird-arms =\u0026gt; sub { return \u0026#39;|/o\\| \u0026#39; }, left =\u0026gt; sub { return \u0026#39;\u0026gt;o \u0026#39; }, right =\u0026gt; sub { return \u0026#39;o\u0026lt; \u0026#39; }, arms-up =\u0026gt; sub { return \u0026#39;\\o/ \u0026#39; }; my @awesome-dance = \u0026lt;arms-up bird-arms right hands-over-head\u0026gt;; for @awesome-dance -\u0026gt; $move { print %moves{$move}.(); } print \u0026#34;\\n\u0026#34;; å­ä¾‹ç¨‹ä¹Ÿèƒ½è¿”å›å¤šä¸ªå€¼ï¼ˆè¯‘è€…æ³¨ï¼šé‚£ä¸å°±æ˜¯è¿”å›ä¸€ä¸ªåˆ—è¡¨å˜›ï¼‰ï¼š\nsub menu { if rand \u0026lt; 0.5 { return (\u0026#39;fish\u0026#39;, \u0026#39;white wine\u0026#39;) } else { return (\u0026#39;steak\u0026#39;, \u0026#39;red wine\u0026#39;); } } my ($food, $beverage) = menu(); å¦‚æœä½ æŠŠ return è¯­å¥æ’é™¤åœ¨å¤–, åˆ™åœ¨å­ä¾‹ç¨‹å†…éƒ¨è¿è¡Œçš„æœ€åä¸€ä¸ªè¯­å¥äº§ç”Ÿçš„å€¼è¢«è¿”å›ã€‚è¿™æ„å‘³ç€å‰ä¸€ä¸ªä¾‹å­å¯ä»¥ç®€åŒ–ä¸ºï¼š\nsub menu { if rand \u0026lt; 0.5 { \u0026#39;fish\u0026#39;, \u0026#39;white wine\u0026#39; } else { \u0026#39;steak\u0026#39;, \u0026#39;red wine\u0026#39;; } } my ($food, $beverage) = menu(); è®°å¾—ï¼šå½“å­ä¾‹ç¨‹ä¸­çš„æ§åˆ¶æµæå…¶å¤æ‚æ—¶, æ·»åŠ ä¸€ä¸ªæ˜¾å¼çš„ return ä¼šè®©ä»£ç æ›´æ¸…æ™°, æ‰€ä»¥ return è¿˜æ˜¯åŠ ä¸Šçš„å¥½ã€‚ return å¦å¤–çš„å‰¯ä½œç”¨å°±æ˜¯æ‰§è¡Œåç«‹å³é€€å‡ºå­ä¾‹ç¨‹ï¼š\nsub create-world(*%characteristics) { my $world = World.new(%characteristics); return $world if %characteristics\u0026lt;temporary\u0026gt;; save-world($world); } \u0026hellip;å¹¶ä¸”ä½ æœ€å¥½åˆ«æ”¾é”™ä½ çš„æ–°å•è¯ $word å¦‚æœå®ƒæ˜¯ä¸´æ—¶çš„ã€‚å› ä¸ºè¿™æ˜¯ä½ è¦è·å–çš„ä»…æœ‰çš„ä¸€ä¸ªã€‚\nè¿”å›å€¼çš„ç±»å‹ åƒå…¶å®ƒç°ä»£è¯­è¨€ä¸€æ ·, Raku å…è®¸ä½ æ˜¾å¼åœ°æŒ‡å®šå­ä¾‹ç¨‹è¿”å›å€¼çš„ç±»å‹ã€‚è¿™å…è®¸ä½ é™åˆ¶ä»å­ä¾‹ç¨‹ä¸­è¿”å›çš„å€¼çš„ç±»å‹ã€‚ä½¿ç”¨ returns ç‰¹æ€§å¯ä»¥åšåˆ°è¿™æ ·ï¼š\nsub double-up($i) returns Int { return $i * 2; } my Int $ultimate-answer = double-up(21); # 42 å½“ç„¶, ä½¿ç”¨è¿™ä¸ª returns ç‰¹æ€§æ˜¯å¯é€‰çš„\nWorking With Types å¾ˆå¤šå­ä¾‹ç¨‹ä¸èƒ½å®Œæ•´æ„ä¹‰ä¸Šä½¿ç”¨ä»»æ„å‚æ•°å·¥ä½œ, ä½†æ˜¯è¦æ±‚å‚æ•°æ”¯æŒç¡®å®šçš„æ–¹æ³•æˆ–æœ‰å…¶å®ƒå±æ€§ã€‚è¿™ç§æƒ…å†µä¸‹, é™åˆ¶å‚æ•°ç±»å‹å°±æœ‰æ„ä¹‰äº†, è¯¸å¦‚ä¼ é€’ä¸æ­£ç¡®å€¼ä½œä¸ºå‚æ•°, å½“è°ƒç”¨å­ä¾‹ç¨‹æ—¶, è¿™ä¼šå¼•èµ· Raku å‘å‡ºé”™è¯¯, æˆ–è€…ç”šè‡³åœ¨ç¼–è¯‘æ—¶, å¦‚æœç¼–è¯‘å™¨è¶³å¤Ÿèªæ˜æ¥æ•æ‰é”™è¯¯ã€‚\nåŸºæœ¬ç±»å‹ æœ€ç®€å•çš„é™åˆ¶å­ä¾‹ç¨‹æ¥æ”¶å¯èƒ½çš„å€¼çš„æ–¹æ³•æ˜¯åœ¨å‚æ•°å‰å†™ä¸Šç±»å‹åã€‚ä¾‹å¦‚, ä¸€ä¸ªå­ä¾‹ç¨‹å¯¹å…¶å‚æ•°æ‰§è¡Œæ•°å€¼è®¡ç®—, è¿™è¦æ±‚å®ƒçš„å‚æ•°ç±»å‹æ˜¯ Numericï¼š\nsub mean(Numeric $a, Numeric $b) { return ($a + $b) / 2; } say mean 2.5, 1.5; say mean \u0026#39;some\u0026#39;, \u0026#39;strings\u0026#39;; äº§ç”Ÿè¾“å‡ºï¼š\nNominal type check failed for parameter \u0026#39;$a\u0026#39;; expected Numeric but got Str instead nominal ç±»å‹æ˜¯ä¸€ä¸ªäººå®é™…ç±»å‹çš„åå­—, è¿™é‡Œæ˜¯ Numericã€‚ å¦‚æœå¤šä¸ªå‚æ•°æœ‰ç±»å‹é™åˆ¶, æ¯ä¸ªå‚æ•°å¿…é¡»å¡«å……å®ƒç»‘å®šçš„å‚æ•°é™åˆ¶çš„ç±»å‹\næ·»åŠ é™åˆ¶ æœ‰æ—¶, ç±»å‹çš„åå­—ä¸è¶³ä»¥æè¿°å‚æ•°çš„è¦æ±‚ã€‚è¿™ç§æƒ…å†µä¸‹, ä½ å¯èƒ½ä½¿ç”¨ where ä»£ç å—æ·»åŠ ä¸€ä¸ªé¢å¤–çš„é™åˆ¶ï¼š\nsub circle-radius-from-area(Real $area where { $area \u0026gt;= 0 }) { ($area / pi).sqrt } say circle-radius-from-area(3); # OK say circle-radius-from-area(-3); # Error å› ä¸ºè¿™ç§è®¡ç®—åªå¯¹éè´Ÿé¢ç§¯å€¼æœ‰æ„ä¹‰, è¯¥å­ä¾‹ç¨‹çš„å‚æ•°åŒ…å«äº†ä¸€ä¸ªé™åˆ¶, å¯¹äºéè´Ÿå€¼å®ƒä¼šè¿”å›çœŸã€‚å¦‚æœè¿™ä¸ªé™åˆ¶è¿”å›ä¸€ä¸ªå‡çš„å€¼, ç±»å‹æ£€æŸ¥ä¼šå¤±è´¥, å½“æœ‰äº›ä¸œè¥¿è°ƒç”¨è¯¥å­ä¾‹ç¨‹æ—¶ã€‚\nwhere ä¹‹åçš„ä»£ç å—æ˜¯å¯é€‰çš„ã€‚Raku é€šè¿‡é€šè¿‡æ™ºèƒ½åŒ¹é… where åé¢çš„å‚æ•°æ¥æ‰§è¡Œæ£€æŸ¥ã€‚ ä¾‹å¦‚, å®ƒå¯èƒ½æ¥å—åœ¨æŸä¸€ç¡®å®šèŒƒå›´ä¸­çš„å‚æ•°ï¼š\nsub set-volume(Numeric $volume where 0..11) { say \u0026#34;Turning it up to $volume\u0026#34;; } æˆ–è€…ä½ å¯ä»¥å°†å‚æ•°é™åˆ¶ä¸ºæ•£åˆ—çš„é”®ï¼š\nmy %in-stock = \u0026#39;Staropramen\u0026#39; =\u0026gt; 8, \u0026#39;Mori\u0026#39; =\u0026gt; 5, \u0026#39;La Trappe\u0026#39; =\u0026gt; 9; sub order-beer(Str $name where %in-stock) { say \u0026#34;Here\u0026#39;s your $name\u0026#34;; %in-stock{$name}--; if %in-stock{$name} == 0 { say \u0026#34;OH NO! That was the last $name, folks! :\u0026#39;(\u0026#34;; %in-stock.delete($name); } } æŠ½è±¡å‚æ•°å’Œå…·ä½“å‚æ•° ä¸‹é¢æ£€æµ‹å˜é‡æ˜¯å¦å®šä¹‰ã€‚åœ¨ Raku ä¸­è¿™æ ·å†™:\nsub foo(Int:D $arg) { # Do something } ç•™æ„é™„åŠ åœ¨å‚æ•°ç±»å‹åé¢çš„ :D ç¬‘è„¸ã€‚è¿™ä¸ªåŠ¨è¯è¡¨æ˜ç»™å®šçš„å‚æ•°å¿…é¡»è¢«ç»‘å®šåˆ°ä¸€ä¸ªå…·ä½“çš„å¯¹è±¡ä¸Šã€‚å¦‚æœä¸æ˜¯çš„è¯, ä¼šæŠ›å‡ºä¸€ä¸ªè¿è¡Œæ—¶å¼‚å¸¸ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒé‚£ä¹ˆé«˜å…´ï¼ä½œä¸ºå¯¹æ¯”, åŠ¨è¯ :U ç”¨äºè¡¨æ˜è¯¥å‚æ•°éœ€è¦ä¸€ä¸ªæœªå®šä¹‰çš„æˆ–æŠ½è±¡çš„å¯¹è±¡ã€‚æ­¤å¤–, åŠ¨è¯ :_ å…è®¸å®šä¹‰æˆ–æœªå®šä¹‰çš„å€¼ã€‚å®é™…ä¸Š, ä½¿ç”¨ :_ æœ‰ç‚¹å¤šä½™ã€‚\næœ€å, åŠ¨è¯ :T èƒ½ç”¨äºè¡¨æ˜å‚æ•°åªèƒ½æ˜¯ç±»å‹å¯¹è±¡, ä¾‹å¦‚\nsub say-foobar(Int:T $arg) { say \u0026#39;FOOBAR!\u0026#39;; } say-foobar(Int); # FOOBAR! ","permalink":"https://ohmyweekly.github.io/notes/2015-03-14-using-raku/","tags":["rakulang"],"title":"Using Raku"},{"categories":["rakulang"],"contents":"è®© Raku ä¸ Perl ç›¸å½“ä¸åŒçš„ä¸€ç‚¹æ˜¯ï¼ŒRaku é¿å…äº†é­”æ³•ã€‚æœ‰å‡ ä¸ªåœ°æ–¹äººä»¬å¯ä»¥è¯´ï¼Œ\u0026ldquo;å®ƒç¥å¥‡åœ°å‘ç”Ÿäº†\u0026rdquo;ã€‚ä½†ä»”ç»†çœ‹ä¸€ä¸‹ï¼Œé€šå¸¸ä¼šå‘ç°è¡Œä¸ºèƒŒåæœ‰ç›¸å½“å¥½è§£é‡Šçš„æœºåˆ¶ã€‚è¿™å°±åƒçœ‹é­”æœ¯å¸ˆçš„æŠŠæˆï¼šæˆ‘ä»¬æ€»æ˜¯çŸ¥é“æœ‰è§£é‡Šï¼Œè€Œä¸”å®ƒä»¬è‚¯å®šæ˜¯ç¬¦åˆé€»è¾‘çš„ã€‚\nå› æ­¤ï¼Œæˆ‘æœ‰ä¸ªå°æŠŠæˆç»™ä½ ã€‚çœ‹ä¸€ä¸‹ä»£ç ï¼Œå‘Šè¯‰æˆ‘ï¼šä½ åœ¨è¿™é‡Œçœ‹åˆ°äº†å¤šå°‘ä¸ªè§’è‰²ï¼Ÿ\nrole R[::T] { has T $.a; } class C does R[Int] { } ç›´è§‚çš„ç­”æ¡ˆå½“ç„¶æ˜¯ 1ï¼Œè¿™ä¹Ÿæ˜¯äº‹å®ã€‚ä½†è¿™é‡Œçš„éƒ¨åˆ†æŠ€å·§æ˜¯æœ¯è¯­çš„æ›¿æ¢ï¼šåœ¨ä½¿ç”¨\u0026quot;è§’è‰²\u0026quot;ä¸€è¯çš„åœ°æ–¹ï¼Œæ›´å‡†ç¡®çš„æœ¯è¯­åº”è¯¥æ˜¯\u0026quot;è§’è‰²ç±»å‹å¯¹è±¡\u0026quot;ã€‚ç°åœ¨ï¼Œè¯•ç€çŒœå‡ºæ­£ç¡®ç­”æ¡ˆã€‚è€Œä¸”ï¼Œè¦ç¡®å®šçš„æ˜¯ï¼Œå®ƒä¸æ­¢ä¸€ä¸ªã€‚\nRaku é­”æœ¯æ˜¯å¦‚ä½•ä¸ç¥å¥‡çš„ Raku çš„æœ€å¤§ä¼˜ç‚¹ä¹‹ä¸€ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œæˆ‘è¶Šæ¥è¶Šå­¦ä¼šé‡è§†ï¼Œå°±æ˜¯å®ƒåšä»»ä½•äº‹æƒ…éƒ½è¦ä¿æŒé€»è¾‘æ€§ã€‚æœ‰æ—¶è¿™å¹¶ä¸æ„å‘³ç€è¦æœ‰ç›´è§‰ã€‚æœ‰äº›è¡Œä¸ºä¸€å¼€å§‹ç”šè‡³å¯èƒ½ä½¿åˆå­¦è€…æ„Ÿåˆ°å›°æƒ‘ã€‚ä½†æ˜¯ï¼Œåœ¨è§£é‡Šæ—¶ï¼Œé€»è¾‘é€šå¸¸æ˜¯ç›¸å½“æœ‰è¯´æœåŠ›çš„ã€‚Raku æä¾›çš„ä¸€å¥—å¹¿æ³›çš„å†…çœå·¥å…·ï¼Œé€šå¸¸å¯¹ç†è§£å®ƒæœ‰å¾ˆå¤§å¸®åŠ©ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å°è¯•ä»¥\u0026quot;é­”æœ¯å¸ˆ\u0026quot;çš„æ–¹å¼æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨å…¶ä¸­çš„ä¸€äº›å·¥å…·æ¥å°†ä¸€åªå…”å­å˜æˆè®¸å¤šåªã€‚\næˆ‘è¿˜å°†åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–äº Rakudo å¯¹ Raku çš„å®ç°ï¼Œå®ƒæ˜¯åŸºäº NQP çš„ï¼Œè¿™ä½¿å¾—åœ¨æŸäº›æƒ…å†µä¸‹ç›¸å½“å®¹æ˜“çœ‹åˆ° Raku è¯­æ³•çš„å¹•åã€‚é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œè¿™ä¹Ÿæ˜¯ Raku ä¸­çš„é­”æ³•é‡å¤„äºå¯å¿½ç•¥ä¸è®¡çš„æ°´å¹³çš„å¦ä¸€ä¸ªåŸå› ã€‚ä½ ä»¬å½“ä¸­æœ‰å¤šå°‘äººï¼Œæˆ‘çš„è¯»è€…ï¼Œæ›¾ç»ç ”ç©¶è¿‡ Perl æˆ–ä»»ä½•ä½ æœ€å–œæ¬¢çš„è¯­è¨€çš„æ¥æºï¼Ÿå¦‚æœæˆ‘ä¸ºè‡ªå·±å›ç­”ï¼Œé‚£ä¹ˆå°±æ˜¯ä¸€ä¸ªè¯ï¼šä»æœªã€‚å°½ç®¡ C è¯­è¨€æ˜¯æˆ‘å¤šå¹´æ¥çš„é¦–é€‰è¯­è¨€ã€‚ä½†ç°åœ¨æˆ‘ä¼šåšæŒè¦æ±‚ä½ åœ¨ä½ çš„ä¸»ç›®å½•ä¸‹çš„æŸä¸ªåœ°æ–¹åš git clone https://github.com/rakudo/rakudo.gitï¼Œæ‰€æœ‰å…¶ä»–é¡¹ç›®éƒ½æ”¾åœ¨é‚£é‡Œã€‚ç„¶åï¼Œåªè¦ä½ é‡åˆ°é—®é¢˜ï¼Œç­”æ¡ˆå¾ˆå¯èƒ½å°±åœ¨ Rakudo é¡¹ç›®çš„ src/Perl6/Metamodel ç›®å½•ä¸‹çš„ä¸€ä¸ªæ–‡ä»¶é‡Œã€‚\nå››ä½ä¸€ä½“ æˆ‘ä¸å¾—ä¸è°·æ­Œä¸€ä¸‹è¿™ä¸ªè¯ã€‚ä»ç¬¬ä¸€éƒ¨ã€Šé»‘å®¢å¸å›½ã€‹ç”µå½±å¼€å§‹ï¼Œ\u0026ldquo;ä¸‰ä½ä¸€ä½“\u0026quot;å¯¹æˆ‘æ¥è¯´å°±å¾ˆç†Ÿæ‚‰äº†ï¼Œä½†å¯¹è¿™ä¸€è¡Œä¸­çš„å…¶ä»–è¯å´ä¸ç†Ÿæ‚‰ã€‚æ˜¯çš„ï¼Œè¿™ä¸ªè¯å°±æ˜¯è¿™ä¸ªæ£˜æ‰‹é—®é¢˜çš„ç­”æ¡ˆã€‚Raku è§’è‰²æ˜¯å››ä½ä¸€ä½“ã€‚è¿™ç¯‡æ–‡ç« å°†ä¸€æ­¥ä¸€æ­¥åœ°å‘Šè¯‰ä½ ä¸ºä»€ä¹ˆã€‚\nåœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘æƒ³æé†’çš„æ˜¯ï¼Œåçœå’Œä¹åº“å…ƒæ¨¡å‹çš„ä¸€èˆ¬çŸ¥è¯†å°†æ˜¯éå¸¸æœ‰ç›Šçš„ã€‚ä¸€äº›ä¿¡æ¯å¯ä»¥åœ¨æœ¬å‘¨æœŸçš„å‰å‡ ç¯‡æ–‡ç« ä¸­æ‰¾åˆ°ï¼Œä¸€äº›å¯ä»¥åœ¨Rakuæ–‡æ¡£ä¸­æ‰¾åˆ°ã€‚\nç¬¬1æ­¥: å¤šé‡æ€§ è®©æˆ‘ä»¬ä»æœ€ç®€å•çš„è‡ªçœå¼€å§‹ã€‚\nâ‡’ raku -e \u0026#39;role R[::T] { }; say R.WHAT\u0026#39; (R) ä¸è¦å’Œ \u0026lsquo;â‡’\u0026rsquo; å­—ç¬¦æ··æ·†ï¼Œè¿™åªæ˜¯æˆ‘æœ€å–œæ¬¢çš„å‘½ä»¤è¡Œæç¤ºã€‚\næ³¨æ„ï¼Œæˆ‘ä»¬åªç”¨æ–¹æ‹¬å·æ¥å£°æ˜è§’è‰²ï¼Œè€Œä¸æ˜¯å¯¹å®ƒè°ƒç”¨æ–¹æ³•ã€‚è¿˜è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªè§’è‰²æŠ¥å‘Šè‡ªå·±åªæ˜¯ Rï¼›åŒæ ·ï¼Œæ²¡æœ‰æ¶‰åŠæ–¹æ‹¬å·ã€‚\næ¥ä¸‹æ¥ï¼Œä½ å¯èƒ½å·²ç»çŸ¥é“ï¼Œåœ¨ Raku ä¸­ï¼ŒåŒä¸€ä¸ªè§’è‰²æœ‰å¯èƒ½æœ‰ä¸åŒçš„å˜ä½“ã€‚\nâ‡’ raku -e \u0026#39;role R[::T] { }; role R { }; say R.WHAT\u0026#39; (R) æˆ‘ä»¬æœ‰ä¸¤ä¸ªå£°æ˜ï¼Œä½†ä»ç„¶åªä½¿ç”¨ R æ¥è°ƒç”¨ WHATã€‚\nè®©æˆ‘ä»¬æ¢ä¸ªè§’åº¦ï¼Œçœ‹çœ‹è¿™ä¸ªè§’è‰²æ˜¯å¦‚ä½•å®ç°çš„ã€‚\nâ‡’ raku -e \u0026#39;role R[::T] { }; say R.HOW.^name\u0026#39; Perl6::Metamodel::ParametricRoleGroupHOW æ³¨æ„åå­—ä¸­çš„ Group éƒ¨åˆ†ã€‚æ–°æ‰‹å¯èƒ½ä¼šå¯¹è¿™ä¸ªè¯æ„Ÿåˆ°å›°æƒ‘ï¼Œåªè¦ä»–ä»¬åªä½¿ç”¨ä¸€ä¸ªè§’è‰²çš„å˜ä½“ã€‚ä½†æ˜¯å½“ä»–ä»¬åˆ°äº†æœ¬èŠ‚ç¬¬äºŒä¸ªä¾‹å­çš„æ—¶å€™ï¼Œäº‹æƒ…å°±å¼€å§‹å˜å¾—æ¯”è¾ƒæ¸…æ¥šäº†ã€‚è®©æˆ‘å†æŠŠå®ƒä»¬å˜å¾—æ›´åŠ æ··ä¹±ã€‚\nrole R[::T] { method foo { 42 } } role R { } say R.^lookup(\u0026#39;foo\u0026#39;); ä½ å¸Œæœ›è¿™æ®µä»£ç èƒ½è¾“å‡ºä»€ä¹ˆï¼Ÿæ ¹æ®æ–‡æ¡£ï¼Œåœ¨ä¸€ä¸ªç±»ä¸Šè¿™æ ·åšä¼šå¾—åˆ°ç›¸å½“å¯é¢„æµ‹çš„ç»“æœã€‚\nclass Foo { method foo { } }; say Foo.^lookup(\u0026#34;foo\u0026#34;); # foo ç°åœ¨ï¼Œå¿˜è®°è¿™ä¸ªç»éªŒå§ã€‚å› ä¸ºå¯¹äºä¸Šé¢çš„ä¾‹å­ä¸­çš„ Rï¼Œæˆ‘ä»¬ä¼šå¾—åˆ° (Mu)ï¼Œæ„æ€æ˜¯æ²¡æœ‰æ‰¾åˆ°æ–¹æ³•ï¼è€Œå¯¹äº Rï¼Œæˆ‘ä»¬ä¼šå¾—åˆ° (Mu)ã€‚\nåœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘æƒ³é€€ä¸€æ­¥è¯´ã€‚å¦‚æœä½ è¯»äº† Raku çš„æ–‡æ¡£æˆ–ä¹¦ï¼Œåšäº†å…³äºè§’è‰²å’Œå‚æ•°åŒ–çš„éƒ¨åˆ†ï¼Œæœ‰ä¸€ä¸ªç»†èŠ‚å¯èƒ½ä¼šè®©ä½ è§‰å¾—ç›¸å½“ç†Ÿæ‚‰ã€‚å¦‚æœè¿™ä¹Ÿæ˜¯æˆ‘è¦æŒ‡å‡ºçš„\u0026quot;ä¸œè¥¿\u0026rdquo;ï¼Œé‚£ä¹ˆä½ å°±ä¸ä¼šé”™äº†ï¼šå‚æ•°åŒ–æ˜¯å…³äºå‚æ•°çš„ï¼›æœ‰äº†å‚æ•°ï¼Œå°±æœ‰äº†ç­¾åï¼\u0026quot;ã€‚ç°åœ¨è¿™æ®µä»£ç ä¸€å®šæ˜¯å®Œå…¨æœ‰æ„ä¹‰çš„ã€‚\nrole R[Int:D $a, Str:D $b] { ... } è§’è‰²å£°æ˜ä¸­è¢«æ–¹æ‹¬å·æ‹¬èµ·æ¥çš„éƒ¨åˆ†æ˜¯ä¸€ä¸ªç­¾åï¼Œè¿™æœ‰å¦ä¸€å±‚æ„æ€ï¼Œæˆ‘å°†åœ¨åé¢å†è°ˆã€‚\nä¸å¹¸çš„æ˜¯ï¼Œæˆ‘åœ¨å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™æœ‰ç‚¹è¶…æ—¶ï¼Œå®ƒåº”è¯¥åœ¨æ¶‰åŠåˆ°å‡ ä¸ªæ›´åŸºæœ¬çš„ä¸»é¢˜ä¹‹åå†å®Œæˆã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼Œæˆ‘ä¸ºä¸‹é¢çš„ä¸€ç‚¹ç¦»é¢˜è€Œé“æ­‰ã€‚\nå¤šé‡åˆ†æ´¾ äººä»¬å¯ä»¥åœ¨ Raku æ–‡æ¡£ä¸­æ‰¾åˆ°è¿™ä¸€éƒ¨åˆ†ã€‚å¦ä¸€èŠ‚é˜è¿°äº†å…¶è¯­æ³•å’ŒåŠŸèƒ½ã€‚ä½†æˆ‘æƒ³ç®€å•åœ°è°ˆè°ˆè¿™ä¸ªåŠŸèƒ½çš„å†…éƒ¨å®ç°ã€‚è®©æˆ‘ä»¬ä»ä¸€ä¸ªåŸºæœ¬çš„å£°æ˜å¼€å§‹ã€‚\nproto foo(|) {*} multi foo(Int:D $i) {} multi foo(Str:D $s) {} say \u0026amp;foo.raku; # proto sub foo (|) {*} æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œraku æ–¹æ³•åªæŠ¥å‘Šäº† protoã€‚å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬å¯¹ \u0026amp;foo è°ƒç”¨ is_dispatcher æ–¹æ³•ï¼Œå®ƒå°†è¿”å› Trueã€‚å¥½çš„ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ª multi åœ¨å“ªé‡Œï¼Œå½“æˆ‘ä»¬è°ƒç”¨ foo(\u0026quot;bar\u0026quot;) æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿç”¨ä¸¤å¥è¯æ¥è¯´ï¼ŒRaku é¦–å…ˆä¼šæ‰¾åˆ° proto æ–¹æ³•ã€‚å¦‚æœå®ƒé€šè¿‡æ£€æŸ¥ is_dispatcher çš„è¿”å›å€¼è¯†åˆ«å‡ºå®ƒæ˜¯è¿™æ ·çš„ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šé€šè¿‡è°ƒç”¨ \u0026amp;foo.candidates æ¥è·å–å·²çŸ¥çš„å€™é€‰åˆ—è¡¨ã€‚\nsay \u0026amp;foo.candidates.map(*.raku).join(\u0026#34;\\n\u0026#34;); # multi sub foo (Int:D $i) { #`(Sub|140560053018928) ... } # multi sub foo (Str:D $s) { #`(Sub|140560053019072) ... } ç„¶åï¼Œå®ƒè¯•å›¾å°†æä¾›çš„å‚æ•°ä¸æ¯ä¸ªå€™é€‰è€…çš„ç­¾åç»‘å®šã€‚å¦‚æœç»‘å®šæˆåŠŸï¼Œåˆ™è°ƒç”¨è¯¥å€™é€‰ç¨‹åºï¼ˆå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼‰ã€‚\næ˜¾ç„¶ï¼Œåœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œäº‹æƒ…è¦å¤æ‚å¾—å¤šï¼Œä½†æˆ‘ä»¬è¿˜ä¸éœ€è¦çŸ¥é“è¿™äº›\u0026hellip;\u0026hellip;\nå›åˆ°å¤šé‡è§’è‰²çš„é—®é¢˜ä¸Š æœ‰æ—¶æˆ‘å¯¹ä¸èƒ½åœ¨æ–‡ç« çš„çº¯æ–‡æœ¬ä¸­é€’å½’åˆ°ä¸€ä¸ªå­ä¸»é¢˜æ„Ÿåˆ°å¥‡æ€ªã€‚å°±æŠŠè¿™ä¸€èŠ‚çš„æ ‡é¢˜çœ‹æˆæ˜¯ä¸Šä¸€èŠ‚çš„ return è¯­å¥\u0026hellip;\u0026hellip;å•Šï¼Œç®—äº†ï¼ä¸è¯´äº†ã€‚\nå¥½å§ï¼Œæˆ‘çš„è§‚ç‚¹æ˜¯ä»€ä¹ˆï¼Œå°±æ˜¯è¦è®²è¿°å¤šé‡è°ƒåº¦çš„æ•…äº‹ï¼Ÿå½“æˆ‘ä»¬çœ‹åˆ° R.HOW åœ¨ç±»åä¸­æŠ¥å‘Šäº†ä¸€ä¸ª Groupï¼Œå°±å¯ä»¥å’Œå¤šé‡è°ƒåº¦å®ç°ä¸­çš„ proto ç›¸æå¹¶è®ºäº†ã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬è°ƒç”¨ HOW æ–¹æ³•çš„ç±»å‹å¯¹è±¡ R æ˜¯ä¸€ä¸ªä¼çŠ¶çš„å®ä½“ï¼Œåœ¨å…¶å…±åŒçš„åå­—ä¸‹ä»£è¡¨äº†è§’è‰²çš„æ‰€æœ‰å˜ä½“ã€‚è€Œä¸”ï¼Œå½“æˆ‘ä»¬æŠŠ R[Int] åº”ç”¨äºä¸€ä¸ªç±»æ—¶ï¼Œå®é™…å‘ç”Ÿçš„è¿‡ç¨‹æ˜¯ä¸€ç§å¤šé‡åˆ†æ´¾ï¼ŒRaku è¯•å›¾æŠŠæ–¹æ‹¬å·ä¸­çš„å‚æ•°ä¸è§’è‰²å€™é€‰è€…çš„ç­¾åç›¸åŒ¹é…ã€‚ç±»ä¼¼äºæˆ‘ä»¬å¦‚ä½•åˆ—å‡º \u0026amp;foo çš„å€™é€‰è€…ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ—å‡º R çš„å€™é€‰è€…ã€‚\n``raku say R.^candidates.map(*.^name).join(\u0026quot;, \u0026ldquo;); # R, R\n å”¯ä¸€ä¸åŒçš„æ˜¯ï¼Œè¿™æ¬¡æˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå…ƒæ–¹æ³• `.^candidates`ã€‚ åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œè¿˜æœ‰ä¸€ä¸ªè°œå›¢æ²¡æœ‰è¢«æ­å¼€ã€‚è¿˜è®°å¾—ä½¿ç”¨ `.^lookup` çš„é‚£ä¸ªä¾‹å­å—ï¼Ÿä¸ºä»€ä¹ˆå®ƒä¸èƒ½æ‰¾åˆ°è¿™ä¸ªæ–¹æ³•ï¼Ÿ `Perl6::Metamodel::ParametricRoleGroupHOW` æ‰€æ”¯æŒçš„ç±»å‹å¯¹è±¡å¹¶ä¸æ˜¯ä¸€ä¸ªæˆ‘ä»¬å¯ä»¥å®é™…ä½¿ç”¨çš„è§’è‰²ã€‚å®ƒæ—¢æ²¡æœ‰æ–¹æ³•ä¹Ÿæ²¡æœ‰å±æ€§ã€‚ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›å®ƒå‡è£…æ˜¯ä¸€ä¸ªæˆç†Ÿçš„è§’è‰²ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œå®ƒé€‰æ‹©äº†ä¸€ä¸ªå€™é€‰è§’è‰²ä½œä¸ºé»˜è®¤è§’è‰²ï¼Œç„¶ååœ¨å…¶ä¸Šé‡æ–°åˆ†é…å¤–éƒ¨è¯·æ±‚ã€‚å½“æœ‰ä¸€ä¸ªæ²¡æœ‰ç­¾åçš„å€™é€‰è€…æ—¶ï¼ˆå¦‚æˆ‘ä»¬çš„ `role R {}`ï¼‰ï¼Œå®ƒå°±æˆä¸ºéšå¼é»˜è®¤ã€‚å¦åˆ™ï¼Œç¬¬ä¸€ä¸ªå£°æ˜çš„æœ‰ç­¾åçš„å€™é€‰è€…å°±ä¼šæˆä¸ºé»˜è®¤çš„å€™é€‰è€…ã€‚ å›åˆ°æˆ‘ä»¬çš„ä¾‹å­ï¼Œ`R.^lookup('foo')` å¤±è´¥äº†ï¼Œå› ä¸º `role R {}` æ²¡æœ‰å£°æ˜ä¸€ä¸ªæœ‰è¿™ä¸ªåå­—çš„æ–¹æ³•ã€‚ ### ç¬¬äºŒæ­¥: å€™é€‰è€… ç›´å¥”ä¸»é¢˜ï¼Œè®©æˆ‘ä»¬å¯¹å€™é€‰è€…æœ¬èº«è¿›è¡Œè‡ªçœã€‚ ```raku say R.^candidates.map({ .HOW.^name }).join(\u0026quot;, \u0026quot;); è¿™çœ‹èµ·æ¥ä¸€å®šå¾ˆç†Ÿæ‚‰ï¼Œåªæ˜¯æˆ‘ä»¬åŠ å…¥äº†.HOWçš„è°ƒç”¨ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬ç”¨å®ƒå¾—åˆ°çš„ä¸œè¥¿ã€‚\nPerl6::Metamodel::ParametricRoleHOW, Perl6::Metamodel::ParametricRoleHOW å®ƒçœ‹èµ·æ¥ä¹Ÿå¾ˆç†Ÿæ‚‰ï¼Œé™¤äº†\u0026hellip;\u0026hellip;æ˜¯çš„ï¼Œåœ¨ç±»åç§°ä¸­æ²¡æœ‰ Groupï¼Œæˆ‘æƒ³æ¬¢è¿æˆ‘ä»¬çš„ç¬¬äºŒç§è§’è‰²! å®é™…ä¸Šï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†ã€‚å¦‚æœæˆ‘åƒè¿™æ ·æŒ¥èˆç€æˆ‘çš„æ‰‹ï¼Œè®©æˆ‘çš„è§‚ä¼—åˆ†å¿ƒï¼Œç”¨\u0026hellip;\nå“å‘€ï¼Œæœ€åä¸€å¥è¯åº”è¯¥æ˜¯è½åœ¨å¦ä¸€ä¸ªçª—å£é‡Œçš„! å¯¹äºä½ ï¼Œæˆ‘çš„è§‚ä¼—ï¼Œæˆ‘è¿˜æœ‰ä¸€è¡Œä»£ç ã€‚\nrole R {}.HOW.^name.say; # Perl6::Metamodel::ParametricRoleHOW BTWï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œè¯´æ˜æ— å¤„ä¸åœ¨çš„ Raku æ¦‚å¿µï¼Œå³æ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚ç”šè‡³å£°æ˜ä¹Ÿæ˜¯ï¼›è€Œä¸”ï¼Œåªæ˜¯ä¸ºäº†å¥½ç©ã€‚\n{ say \u0026#34;foo\u0026#34; }.^name.say; # Block ä½†æ˜¯æˆ‘åˆ†å¿ƒäº†\u0026hellip;\næ‰€ä»¥ï¼Œè¿™é‡ŒçœŸæ­£é‡è¦çš„æ˜¯ï¼Œå½“æˆ‘ä»¬å£°æ˜ä¸€ä¸ªè§’è‰²æ—¶ï¼ŒRaku ä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª Perl6::Metamodel::ParametricRoleHOW ç±»çš„å®ä¾‹ã€‚æ¯ä¸ªå£°æ˜éƒ½æœ‰ä¸€ä¸ªç‹¬ç‰¹çš„ç±»çš„å®ä¾‹æ”¯æŒï¼Œå®ƒè´Ÿè´£æŒæœ‰è§’è‰²ç±»å‹å¯¹è±¡çš„æ¯ä¸ªç»†èŠ‚ã€‚ä¾‹å¦‚ï¼Œè¦æƒ³çŸ¥é“å®ƒæ˜¯å¦å¯ä»¥è¢«å‚æ•°åŒ–ï¼Œå¯ä»¥è¿™æ ·åšã€‚\nsub is_parameterized(Mu \\r --\u0026gt; Bool) { ? r.^signatured } say is_parameterized(role R[::T] {}); # True say is_parameterized(role R {}); # False è¯·æ³¨æ„ï¼Œç”±äº signatured æ˜¯åœ¨ NQP ä¸­å®ç°çš„æ–¹æ³•ï¼Œå®ƒä¸çŸ¥é“é«˜çº§ç±»å‹ï¼Œå¹¶è¿”å›0æˆ–1ã€‚æœ‰æ—¶æƒ…å†µä¼šå˜å¾—æ›´ç³Ÿç³•ã€‚æˆ‘ä¸Šé¢æåˆ°çš„æŸ¥æ‰¾å…ƒæ–¹æ³•å®é™…ä¸Šè¿”å› nqp::null()ï¼Œè¿™æ˜¯ä¸€ç§ VM çº§çš„å¯¹è±¡ã€‚å®ƒå†³ä¸èƒ½å‡ºç°åœ¨ Raku ä¸Šã€‚å› æ­¤è¯­è¨€æŠŠå®ƒå˜æˆäº† Muï¼Œè¿™æ˜¯æœ€åŸºæœ¬çš„ Raku ç±»ã€‚\nå…³äº Perl6::Metamodel::ParametricRoleHOWï¼Œåœ¨è¿™ä¸€ç‚¹ä¸Šæ²¡æœ‰ä»€ä¹ˆå¯è¯´çš„ã€‚ä½†æˆ‘ä»¬ç¨åä¼šå›åˆ°å®ƒä¸Šé¢å»ã€‚\nç¬¬ä¸‰æ­¥: ä¸ç¡®å®šæ€§ ä¸ºäº†æ›´æ¥è¿‘æˆ‘ä»¬çš„ç¬¬ä¸‰ç§è§’è‰²ï¼Œæˆ‘ä»¬ä»ä¸‹é¢è¿™ä¸ªç‰‡æ®µå¼€å§‹ã€‚\nrole R1[::T Stringy, ::V] { method foo { \u0026#34;stringy\u0026#34; } } role R1[::T Numeric, ::V] { method foo { \u0026#34;numeric\u0026#34; } } my \\r = role R2[::T] does R1[Int, T] { } è®©æˆ‘ä»¬è‡ªçœä¸€ä¸‹ R1ã€‚\n# We know there is only one role,  # hence .head for prettier output say r.^roles.map({ .^name ~ \u0026#34;of \u0026#34; ~ .HOW.^name }).head; # R1[Int,T] of Perl6::Metamodel::CurriedRoleHOW è¾“å‡ºæ˜¾ç¤ºäº†ä¸¤ä¸ªæ˜æ˜¾çš„å˜åŒ–ã€‚é¦–å…ˆï¼Œè§’è‰²åç§°ç°åœ¨æŠ¥å‘Šäº†å®ƒçš„å‚æ•°ã€‚ç¬¬äºŒï¼Œå…ƒå¯¹è±¡ç°åœ¨å±äº Perl6::Metamodel::CurriedRoleHOW ç±»ã€‚è¿™æ˜¯ Rakudo åœ¨å¹•ååšçš„å¦ä¸€ç§\u0026quot;é­”æ³•\u0026rdquo;ï¼Œæˆ‘å°†åœ¨æœ¬èŠ‚ä¸­æŠ«éœ²ã€‚\nåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒR2 å£°æ˜æœ€å¼•äººæ³¨ç›®çš„ç‰¹ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿäº‹å®ä¸Šï¼Œåœ¨å®ƒæ¶ˆè€— R1 çš„åœ°æ–¹ï¼Œæˆ‘ä»¬åªçŸ¥é“ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œç¬¬äºŒä¸ªå‚æ•°ä»ç„¶æ˜¯ä¸€ä¸ªé€šç”¨å‚æ•°ã€‚ä¸ºäº†è¡¨ç¤ºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯¹è§’è‰²çš„äº†è§£æ˜¯ä¸å®Œæ•´çš„ï¼ŒRakudo ä½¿ç”¨äº†æŸ¯é‡ŒåŒ–çš„è§’è‰²ã€‚\nä»èµ·æºçš„è§’åº¦æ¥çœ‹ï¼ŒæŸ¯é‡ŒåŒ–è§’è‰²ä¸å‰ä¸¤ç§è§’è‰²çš„å…³é”®åŒºåˆ«åœ¨äºï¼Œæ²¡æœ‰åŠæ³•å£°æ˜ä¸€ä¸ªè§’è‰²ã€‚æŸ¯é‡ŒåŒ–åªèƒ½æ˜¯ä¸€ä¸ªç»„çš„å‚æ•°åŒ–çš„ç»“æœã€‚è€Œä¸”ï¼Œå®é™…ä¸Šï¼Œæˆ‘å¾ˆæ¸…æ¥šï¼Œæ­£å¼çš„ç»„åœ¨ Raku è¯­æ³•ä¸­å¹¶æ²¡æœ‰è¡¨ç¤ºã€‚ä½†æ˜¯åªè¦å®ƒä½œä¸ºç¬¬ä¸€ä¸ªè§’è‰²å£°æ˜çš„ç»“æœå‡ºç°ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¯´å®ƒæ˜¯ç”±å®ƒäº§ç”Ÿçš„ã€‚è€ŒæŸ¯é‡ŒåŒ–åˆ™å®Œå…¨ç”±å‚æ•°åŒ–äº§ç”Ÿã€‚\nä¹Ÿè®¸æœ‰äº›ä»¤äººæƒŠè®¶ï¼Œä½†åœ¨æ‰€æœ‰å‚æ•°éƒ½ä¸ºç¼–è¯‘å™¨æ‰€ç†ŸçŸ¥çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥å‘ç°æŸ¯é‡ŒåŒ–çš„å­˜åœ¨ã€‚\nsay R2[Str].HOW.^name; # Perl6::Metamodel::CurriedRoleHOW éƒ¨åˆ†åŸå› æ˜¯ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨è¿™æ ·çš„è§’è‰²æ—¶ï¼Œæˆ‘ä»¬æ‰€éœ€è¦çš„ä¹Ÿè®¸æ˜¯ä¸€äº›å†…çœã€ç±»å‹æ£€æŸ¥æˆ–ä»»ä½•å…¶ä»–ä¸éœ€è¦å…·ä½“å¯¹è±¡çš„æ“ä½œã€‚æ¯”å¦‚è¯´ã€‚\nsub foo(R1[Int, Str] $a) {...} æˆ‘ä»¬åœ¨è¿™é‡Œéœ€è¦çš„æ˜¯ foo å‚æ•°ï¼Œä»¥é€šè¿‡å¯¹ R1[Int, Str] çš„ç±»å‹æ£€æŸ¥ã€‚å› ä¸ºæŸ¯é‡ŒåŒ–ä¼šå¸®æˆ‘ä»¬å®Œæˆè¿™ä¸ªå·¥ä½œï¼Œæ‰€ä»¥ Rakudo åœ¨è¿™é‡Œä½¿ç”¨å®ƒã€‚\nsay \u0026amp;foo.signature.params[0].type.HOW.^name; # Perl6::Metamodel::CurriedRoleHOW è¿™æ˜¯å› ä¸º:\nsay R2[Str] ~~ R1[Int, Str]; # True say R2[Int] ~~ R1[Int, Str]; # False ä½†è¿˜æœ‰ä¸€ä¸ªä¸»è¦åŸå› ã€‚å®ƒå°†åœ¨ä¸‹ä¸€èŠ‚ä¸­æŠ«éœ²ã€‚\nç¬¬4æ­¥: å…·ä½“æ€§ ä»»ä½•è§’è‰²çš„å‘½è¿éƒ½æ˜¯è¢«ä¸€ä¸ªç±»æ‰€åå™¬ã€‚(BTWï¼Œè¿™é‡Œçš„åŒå…³è¯­ä¹Ÿä¸ä¾‹å¤–ã€‚)ç°åœ¨æ˜¯æ—¶å€™è€ƒè™‘è¿™æœ€åé˜¶æ®µäº†ã€‚\nrole R1[::T] { } role R2[::T] { } role R3 { } class C does R1[Int] does R2[Str] does R3 { } é€šè¿‡åçœç±»ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°æ‰€æœ‰çš„è€æœ‹å‹ã€‚\nsay C.^roles .map({ .^name ~ \u0026#34;of \u0026#34; ~ .HOW.^name }) .join(\u0026#34;\\n\u0026#34;); # R3 of Perl6::Metamodel::ParametricRoleGroupHOW # R2[Str] of Perl6::Metamodel::CurriedRoleHOW # R1[Int] of Perl6::Metamodel::CurriedRoleHOW æœ‰è¶£çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå‘ç°äº†ä¸åŒç§ç±»çš„è§’è‰²çš„æ··åˆã€‚å…¶åŸå› æ˜¯æµ®åœ¨ä¸Šé¢çš„ï¼šä¸ R3 ç›¸åï¼Œå¦å¤–ä¸¤ä¸ªè§’è‰²æ˜¯å‚æ•°åŒ–çš„ã€‚\nä½†ç”±äºæˆ‘å–œæ¬¢è¿·æƒ‘å¬ä¼—ï¼Œæ‰€ä»¥æˆ‘è¦å‘Šè¯‰ä½ ï¼šè¿™äº›å…¶å®ä¸æ˜¯è¿™ä¸ªç±»æ‰€å»ºç«‹çš„è§’è‰²ï¼è¿™æ˜¯å¦ä¸€ä¸ªæ“ä½œã€‚\nå½“ç„¶ï¼Œè¿™æ˜¯å¦ä¸€ç§æ“ä½œã€‚å®Œæ•´çš„çŸ­è¯­å¿…é¡»æ˜¯ä½¿ç”¨è¿™ä¸ªã€‚\u0026ldquo;ä¸æ˜¯ç›´æ¥ä½¿ç”¨çš„è§’è‰²\u0026rdquo;ã€‚\nå½“æˆ‘ä»¬å°è¯•å¦ä¸€ç§æ–¹æ³•æ—¶ï¼Œæƒ…å†µå°±ä¼šå¤§ä¸ç›¸åŒã€‚\nsay C.^mro(:roles) .map({ .^name ~ \u0026#34;of \u0026#34; ~ .HOW.^name }) .join(\u0026#34;\\n\u0026#34;); # C of Perl6::Metamodel::ClassHOW # R3 of Perl6::Metamodel::ConcreteRoleHOW # R2 of Perl6::Metamodel::ConcreteRoleHOW # R1 of Perl6::Metamodel::ConcreteRoleHOW .^roles å’Œ .^mro çš„åŒºåˆ«åœ¨äºï¼Œå‰è€…ä¸ºæˆ‘ä»¬æä¾›äº†ç”¨äºå£°æ˜ç±»çš„å†…å®¹ï¼›è€Œåè€…åˆ™ä¸ºæˆ‘ä»¬æä¾›äº†å®é™…æ„å»ºçš„å†…å®¹ã€‚\næ­£å¦‚ HOW ç±»çš„åå­—æ‰€æš—ç¤ºçš„ï¼Œæˆ‘ä»¬ç°åœ¨å¤„ç†çš„æ˜¯è§’è‰²çš„å…·ä½“è¡¨ç°ã€‚æ¢å¥è¯è¯´ï¼Œè¿™æ˜¯ä¸€ç§æ‰€æœ‰ç»†èŠ‚éƒ½çŸ¥é“çš„è§’è‰²ï¼Œå®ƒä»¬æ˜¯ä¸ºè¿™ä¸ªç‰¹å®šçš„ç±»ä¸“é—¨è®¾è®¡çš„ã€‚è¿™é‡Œå¼ºè°ƒçš„æ˜¯ç›®çš„ï¼šè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºç‰¹åŒ–ï¼›è€Œ specialize æ˜¯å®ç°å®ƒçš„å…ƒæ¨¡å‹æ–¹æ³•çš„åç§°ã€‚\næˆ‘è¿˜æƒ³æé†’ä½ ä¸€ä¸‹ä¸Šä¸€èŠ‚çš„æœ€åä¸€å¥è¯ã€‚ä¸ºä»€ä¹ˆæ¯å½“äººä»¬ä½¿ç”¨ R[Int] æˆ–ç±»ä¼¼å½¢å¼çš„è§’è‰²å‚æ•°åŒ–æ—¶ï¼Œä»–ä»¬éƒ½è¦å¤„ç†ä¸€ä¸ªæŸ¯é‡ŒåŒ–çš„è§’è‰²ï¼ŒåŸå› æ˜¯å®Œå…¨çš„ç‰¹åŒ–éœ€è¦è§’è‰²è¢«æ¶ˆè€—çš„ç±»ã€‚ç¨åæˆ‘å°†è¯´æ˜åŸå› ã€‚\næˆ‘ä»¬ç°åœ¨å¯ä»¥é€€ä¸€æ­¥ï¼Œæ¦‚è¿°ä¸€ä¸‹è§’è‰²çš„ç”Ÿå‘½å‘¨æœŸã€‚\n ä¸€ä¸ª Perl6::Metamodel::ParametricRoleGroupHOW è¢«åˆ›å»ºã€‚ ä¸€ä¸ª Perl6::Metamodel::ParametricRoleHOW è¢«åˆ›å»ºå¹¶æ·»åŠ åˆ°è¯¥ç»„ã€‚ ä¸€ä¸ªç±»è¢«å£°æ˜å¹¶ does è¿™ä¸ªè§’è‰²ã€‚ç¼–è¯‘å™¨å°è¯•å¯¹è§’è‰²è¿›è¡Œå‚æ•°åŒ–ï¼Œå¦‚æœéœ€è¦å‚æ•°åŒ–ï¼ŒPerl6::Metamodel::CurriedRoleHOW å°±ä¼šè¢«åˆ›å»ºï¼›å¦åˆ™å°±ä¼šä½¿ç”¨åŸæ¥çš„ Perl6::Metamodel::ParametricRoleHOWã€‚ å‚æ•°åŒ–çš„ç»“æœè¢«æ·»åŠ åˆ°ç±»çš„è§’è‰²åˆ—è¡¨ä¸­ã€‚ å½“ç±»è¢«ç»„æˆæ—¶ï¼Œæ‰€æœ‰åœ¨ä¸Šä¸€æ­¥ä¸­æ·»åŠ çš„è§’è‰²éƒ½è¢«èµ‹äºˆäº†å„è‡ªçš„å‚æ•°å’Œç±»çš„ç±»å‹å¯¹è±¡ã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬å¾—åˆ°äº†ç”± Perl6::Metamodel::ConcreteRoleHOW æ”¯æŒçš„è§’è‰²ç±»å‹å¯¹è±¡ï¼Œæˆ–è€…æ¢å¥è¯è¯´ï¼Œè§’è‰²å…·ä½“åŒ–ã€‚ è¿™äº›å…·ä½“åŒ–è¢«æ·»åŠ åˆ°ç±»ä¸­ã€‚ å…·ä½“åŒ–æ˜¯é€šè¿‡å°†å…¶å±æ€§å’Œæ–¹æ³•è¿ç§»åˆ°ç±»çš„ç±»å‹å¯¹è±¡ä¸­æ¥åº”ç”¨çš„ã€‚  å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå…·ä½“åŒ–è¢«ä¿ç•™ä¸ºç‹¬ç«‹çš„å®ä½“ï¼Œä¸å®ƒä»¬æ‰€äº§ç”Ÿçš„è§’è‰²åˆ†å¼€ã€‚è¿™å°±æ˜¯æˆ‘ä»¬åœ¨ä¸Šé¢é€šè¿‡ä½¿ç”¨ .^roles å’Œ .^mro è¿›è¡Œå†…çœè§‚å¯Ÿåˆ°çš„ã€‚å®ƒä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ .^concretizations å…ƒæ¨¡å‹æ–¹æ³•æ¥è®¿é—®ã€‚\nsay C.^concretizations .map({ .^name ~ \u0026#34;of \u0026#34; ~ .HOW.^name }) .join(\u0026#34;\\n\u0026#34;); # R3 of Perl6::Metamodel::ConcreteRoleHOW # R2 of Perl6::Metamodel::ConcreteRoleHOW # R1 of Perl6::Metamodel::ConcreteRoleHOW åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæœ‰ä¸¤ä¸ªç›¸å½“å¤§çš„ä¸»é¢˜ä»ç„¶æ•…æ„ä¸æ¸…æ¥šï¼šä¸€ä¸ªè§’è‰²å€™é€‰äººæ˜¯å¦‚ä½•è¢«é€‰æ‹©çš„ï¼Ÿ ä»¥åŠç‰¹åŒ–æ˜¯åšä»€ä¹ˆçš„ï¼Ÿç¬¬ä¸€ä¸ªé—®é¢˜æˆ‘ä¹Ÿè®¸å¯ä»¥æˆ–å¤šæˆ–å°‘åœ°å®Œæ•´åœ°ä»‹ç»ä¸€ä¸‹ã€‚ç¬¬äºŒä¸ªé—®é¢˜å¯¹æœ¬æ–‡æ¥è¯´å¤ªå¤æ‚äº†ï¼Œä½†æœ‰å‡ ä¸ªå…³é”®ç‚¹ç»å¯¹å€¼å¾—ä¸€æã€‚\nç¬¬1aæ­¥: é€‰æ‹© éœ‡æƒŠä¸€ä¸ªæ— è¾œçš„è¯»è€…åœ¨åª’ä½“ä¸­éå¸¸æµè¡Œã€‚è™½ç„¶æˆ‘å‹‰å¼ºç®—æ˜¯ä¸ªè®°è€…ï¼Œä½†åªè¦æˆ‘æŠŠè¿™ç¯‡æ–‡ç« ç§°ä¸ºæ–‡ç« \u0026ndash;æˆ‘æœ‰ä»€ä¹ˆèµ„æ ¼æ‰“ç ´è§„åˆ™ï¼Ÿæ‰€ä»¥ï¼Œè¯·åå¥½ï¼Œæ¡ç´§ä½ çš„å¤§è„‘ã€‚\næˆ‘ä»¬å¼€å§‹äº†\u0026hellip;\u0026hellip;å‡†å¤‡å¥½äº†æ²¡æœ‰\u0026hellip;\u0026hellip;çœŸç›¸å³å°†æ­æ™“ï¼\u0026quot;ã€‚\nè§’è‰²æ˜¯ä¸€ç§ä¾‹ç¨‹ã€‚\nå¾ˆå¥½ï¼Œå¼€å§‹äº†ã€‚æˆ‘è¯´äº†ï¼æˆ‘ä¸€ç›´æƒ³è¯´çš„!\nè¯´çœŸçš„ï¼Œæ­£å¦‚ç»å¸¸å‘ç°çš„å…³äºç‚¹å‡»ç‡çš„æ–°é—»ä¸€æ ·ï¼Œè¿™å¹¶ä¸å®Œå…¨æ˜¯çœŸçš„ï¼Œä½†æœ‰ä¸€ç‚¹æ˜¯çœŸçš„ã€‚æˆ‘æƒ³è®©ä½ è€ƒè™‘ä¸€ä¸ªä¾‹å­ã€‚\nrole R { say \u0026#34;inside the role\u0026#34;; } module Foo { say \u0026#34;inside Foo\u0026#34;; } class C { say \u0026#34;inside the class\u0026#34;; } # inside Foo # inside the class æˆ‘ä»¬åªçœ‹åˆ°ä¸¤è¡Œè¾“å‡ºï¼Œè®©æˆ‘ä»¬äº†è§£åˆ°ç±»çš„å£°æ˜ä¸æ¨¡å—çš„è¡Œä¸ºæ˜¯ä¸€æ ·çš„ã€‚ä½†ä¸æ˜¯è§’è‰²ã€‚è®©æˆ‘ä»¬åœ¨è¿™ä¸ªä¾‹å­ä¸­å†åŠ ä¸€è¡Œã€‚\nR.^candidates[0].^body_block.(C); # inside the role ä¸ºä»€ä¹ˆæ˜¯è¿™æ ·ï¼Œä¸ºä»€ä¹ˆæˆ‘æŠŠ C ä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ é€’ï¼Œæˆ‘å°†åœ¨ä¸‹é¢å…³äºç‰¹åŒ–çš„éƒ¨åˆ†å°è¯•å›ç­”ã€‚\nç°åœ¨æˆ‘å»ºè®®å¯¹ä¸»ä½“å—è¿›è¡Œå†…çœï¼Œä½†é¦–å…ˆè¦åœ¨ä¸Šè¿°ç‰‡æ®µä¸­å¢åŠ ä¸€ä¸ªè§’è‰²çš„å˜ä½“ã€‚\nmy \\r = role R[::T, ::V Numeric] { } say r.^body_block.raku; # multi sub (::$?CLASS ::::?CLASS Mu $, ::T Mu $, ::V Numeric $) { #`(Sub|94052949943024) ... } ç°åœ¨æœ‰å°è±¡äº†å—ï¼Ÿsub å‰é¢çš„ multi è¿™ä¸ªè¯è¯´æ˜äº†ä¸€åˆ‡ï¼Œæˆ‘ç°åœ¨çš„å·¥ä½œå·²ç»å‡å°‘åˆ°æ‰€éœ€çš„æœ€å°çš„æªè¾ã€‚\nå½“ç¼–è¯‘å™¨å»ºç«‹ä¸€ä¸ªè§’è‰²ç»„æ—¶ï¼Œå®ƒä¹Ÿåˆ›å»ºäº†ä¸€ä¸ªå¤šè°ƒåº¦ä¾‹ç¨‹ã€‚åœ¨å†…éƒ¨ï¼Œå®ƒè¢«ç§°ä¸ºé€‰æ‹©å™¨ã€‚åœ¨æ¯ä¸€ä¸ªæ–°æ·»åŠ çš„å‚æ•°åŒ–è§’è‰²ä¸­ï¼Œå®ƒçš„ä¸»ä½“å—ï¼ˆå®é™…ä¸Šæ˜¯ä¸€ä¸ª multi subï¼‰éƒ½ä¼šè¢«æŠ½å–å‡ºæ¥ï¼Œå¹¶ä½œä¸ºä¸€ä¸ªå¤šé‡è°ƒåº¦å€™é€‰ç¨‹åºæ·»åŠ åˆ°é€‰æ‹©å™¨ä¸­ã€‚ç°åœ¨ï¼Œå½“äººä»¬åœ¨ä»–ä»¬çš„ä»£ç ä¸­å†™ä¸‹åƒ R[Int, Str] è¿™æ ·çš„ä¸œè¥¿æ—¶ï¼Œç¼–è¯‘å™¨ä¼šåšä¸€ä¸ªç±»ä¼¼äºé€‰æ‹©å¤šé‡è°ƒåº¦ä¾‹ç¨‹å€™é€‰è€…çš„è¿‡ç¨‹ã€‚åŸºäºè¿›ç¨‹æä¾›çš„ä¸»ä½“å—å€™é€‰ï¼Œå®ƒé€‰æ‹©äº†è¯¥å—æ‰€å±çš„è§’è‰²ã€‚\næ‰€ä»¥ï¼Œç°åœ¨å½“æˆ‘ä»¬æåˆ°è§’è‰²ç­¾åæ—¶ï¼Œä¸€å®šä¼šæœ‰æ›´å¤šçš„æ„ä¹‰ã€‚å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªç­¾åï¼Œä½œä¸ºä¸€ä¸ªäº‹å®ã€‚å¦‚æœæˆ‘æŠŠä¸€ä¸ªè§’è‰²å£°æ˜ role R[::T, ::V] {} ä»¥æŸç§æ›´é€‚åˆäººç±»ç¨‹åºå‘˜é˜…è¯»çš„æ–¹å¼é‡æ–°è¡¨è¿°ï¼Œå®ƒå¯èƒ½çœ‹èµ·æ¥åƒã€‚\n å£°æ˜ä¸€ä¸ªå€™é€‰è§’è‰² Rï¼Œå…¶ä¸»ä½“ä¸ºå—sub (::T, ::V) {...}ã€‚\n å¾ˆå¥½ï¼Œæˆ‘ä»¬ç°åœ¨å·²ç»è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚ä½†æ˜¯ï¼Œæˆ‘ç»†å¿ƒçš„è¯»è€…ï¼Œæ˜¯ä¸æ˜¯æœ‰ä»€ä¹ˆäº‹æƒ…å›°æ‰°ç€ä½ ï¼Ÿä¸Šé¢çš„\u0026quot;ç±»ä¼¼\u0026quot;ä¸€è¯æ˜¯ä¸æ˜¯æ„å‘³ç€æŸç§\u0026hellip;\u0026hellip;å‘ƒ\u0026hellip;\u0026hellip;æƒŠå–œï¼Ÿå¥½å§ï¼Œä¸å¹¸çš„æ˜¯ï¼Œå€™é€‰çš„é€‰æ‹©å¹¶ä¸éµå¾ªå®Œæ•´çš„å¤šé‡è°ƒåº¦åè®®ï¼Œå› ä¸ºå®ƒç¼ºä¹å¯¹å‘½åå‚æ•°çš„æ”¯æŒã€‚è¿™æ˜¯ç”±äºç±»å‹å‚æ•°åŒ–çš„ä½çº§å®ç°çš„é™åˆ¶ã€‚è¿™æ„å‘³ç€ä¸‹é¢çš„ä¸¤ä¸ªå£°æ˜è¢«è®¤ä¸ºæ˜¯ç›¸åŒçš„ã€‚\nrole R[Int, Bool :$foo] {...} role R[Int, Str:D :$bar] {...} å¸Œæœ›å½“æ–°çš„åˆ†æ´¾æœºåˆ¶åˆ°è¾¾ Raku æ—¶ï¼Œæƒ…å†µä¼šæœ‰æ‰€æ”¹å˜ï¼Œä½†æˆ‘åœ¨æ­¤ä¸åšä»»ä½•æ‰¿è¯ºã€‚\nä¸æ­¤åŒæ—¶ï¼Œä½ ä»ç„¶å¯ä»¥ä½¿ç”¨è¿™äº›åå­—ï¼Œåªæ˜¯ä¸è¦ä¾é å®ƒä»¬æ¥å”¯ä¸€åœ°è¯†åˆ«ä½ çš„è§’è‰²å€™é€‰äººã€‚\nä¸€ä¸ªé»‘é­”æ³•å¡æ©æ–¯ è¿™å…¶å®ä¸é€‰æ‹©å€™é€‰è€…æ— å…³ï¼Œä½†æˆ‘ä¸èƒ½å¿å—ä¸ç»™ä½ çœ‹ä¸€äº›æ£˜æ‰‹çš„ä¸œè¥¿ã€‚æ­¤å¤–ï¼Œåœ¨è®¸å¤šå°è¯´å’Œç«¥è¯æ•…äº‹ä¸­ï¼Œé»‘é­”æ³•æ˜¯ä¸€ç§å¯ä»¥è®©ä½ å®ç°ç›®æ ‡çš„ä¸œè¥¿ï¼Œä½†æœ‰ä¸€ä¸ªé™„åŠ çš„ä»·æ ¼æ ‡ç­¾ã€‚æœ‰æ—¶è¿™ä¸ªæ ‡ç­¾æ˜¯ç›¸å½“è¡€è…¥çš„ï¼Œä½†è¿™ä¸æ˜¯æˆ‘çš„æƒ…å†µã€‚å®é™…ä¸Šï¼Œæˆ‘çš„ç›®æ ‡å’Œä»£ä»·æ˜¯ä¸€æ ·çš„ï¼šæˆ‘æƒ³ç”¨ä¸åŒçš„ä¸œè¥¿æ¥å¸å¼•ä½ ã€‚\nè¿™å°±æ˜¯è¦æ–½çš„æ³•æœ¯ã€‚\nuse nqp; my \\r = role R[::T, ::V Numeric] { } class C { } my \\tenv = r.^body_block().(C, Str, Int); my \\ctx = nqp::atpos(tenv, 1); my \\iter = nqp::iterator(ctx); while iter { my \\elem = nqp::shift(iter); say nqp::iterkey_s(elem), \u0026#34;=\u0026gt; \u0026#34;, nqp::iterval(elem); } åªè¦ä¸»ä½“å—æ˜¯ä¸€ä¸ªä¾‹ç¨‹ï¼Œæ˜¾ç„¶æˆ‘ä»¬å¯ä»¥è‡ªå·±è°ƒç”¨å®ƒã€‚ä¸ºäº†ç†è§£å‰©ä¸‹çš„å‡ è¡Œå’Œæ‰€æœ‰ä½¿ç”¨çš„ nqp:: opsï¼Œäººä»¬éœ€è¦å‚è€ƒ NQP ops æ–‡æ¡£ã€‚\næ€»ä¹‹ï¼Œ\u0026ldquo;å’’è¯­\u0026quot;äº§ç”Ÿçš„è¾“å‡ºå¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ã€‚\n::?CLASS =\u0026gt; (C) $?ROLE =\u0026gt; (R) T =\u0026gt; (Str) $?CONCRETIZATION =\u0026gt; (Mu) $?PACKAGE =\u0026gt; (R) ::?PACKAGE =\u0026gt; (R) V =\u0026gt; (Int) ::?ROLE =\u0026gt; (R) $?CLASS =\u0026gt; (C) $_ =\u0026gt; (Mu) ç”¨ä¸¤ä¸ªå­—æ¥è¯´ï¼Œè§’è‰²ä½“å—è¿”å›ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå…ƒç´ çš„æ•°ç»„ã€‚ç¬¬äºŒä¸ªå…ƒç´ æ˜¯ç¬¦å·åç§°åˆ°å…¶å…·ä½“å€¼çš„æ˜ å°„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ =\u0026gt; ç®­å¤´å·¦ä¾§çš„é”®ä¸­ï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°ä»è§’è‰²ç­¾åä¸­å‘ç°æˆ‘ä»¬çš„ T å’Œ V ç±»å‹æ•è·ï¼›ä»¥åŠç¼–è¯‘å™¨å¸¸é‡ï¼Œå¦‚ ::?CLASS å’Œå…¶ä»–ã€‚\næ€»çš„æ¥è¯´ï¼Œä»£ç è¿”å›çš„ä¸œè¥¿è¢«ç§°ä¸ºå†…éƒ¨ç±»å‹ç¯å¢ƒï¼Œå¹¶è¢«ç”¨äºå¦ä¸€ç§å¹¿æ³›é‡‡ç”¨çš„æœºåˆ¶ï¼Œå³æ³›å‹å®ä¾‹åŒ–ã€‚ä½†è¿™ä¸ªè¯é¢˜è‚¯å®šè¿œè¿œè¶…å‡ºäº†æœ¬æ–‡çš„ç›®çš„ã€‚è¿™é‡Œç¡®å®å€¼å¾—ä¸€æçš„æ˜¯ï¼Œæ‰€æœ‰åŒ…å«åœ¨ç¯å¢ƒä¸­çš„ç¬¦å·å®é™…ä¸Šéƒ½æ˜¯è§’è‰²ä½“è¯æ³•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æŠŠæˆ‘çš„ FOO = 42 åŠ å…¥åˆ°ä¸»ä½“ä¸­ï¼Œé‚£ä¹ˆä¸Šé¢çš„è¾“å‡ºå°±ä¼šæœ‰ä»¥ä¸‹ä¸€è¡ŒåŠ å…¥åˆ°å…¶ä¸­ã€‚\nFOO =\u0026gt; 42 å¦å¤–ï¼Œçœ‹ç€è¿™äº›ç¬¦å·ï¼Œä½ ç°åœ¨ç”šè‡³å¯ä»¥æ›´å¥½åœ°ç†è§£ä¸ºä»€ä¹ˆè§’è‰²çš„ç‰¹åŒ–éœ€è¦ä¸€ä¸ªç±»æ¥æ¶ˆè€—å®ƒã€‚ä½ ä¸‹æ¬¡åœ¨åšç±»ä¼¼çš„äº‹æƒ…æ—¶å¯èƒ½ä¼šè€ƒè™‘åˆ°è¿™ä¸€ç‚¹ã€‚\nmethod foo(::?CLASS:D: |) {...} æœ€åæˆ‘æƒ³æŒ‡å‡ºçš„ä¸€ç‚¹æ˜¯ $?CONCRETIZATION ç¬¦å·ï¼Œå®ƒè¿˜æ²¡æœ‰è¢«è®°å½•ä¸‹æ¥ã€‚å®ƒåªåœ¨è§’è‰²ä¸»ä½“å’Œè§’è‰²æ–¹æ³•ä¸­å¯ç”¨ï¼Œå¹¶ä¸”å½“å®ƒå¯ç”¨æ—¶è¢«ç»‘å®šåˆ°è§’è‰²çš„å…·ä½“åŒ–ä¸­ã€‚è¿™ä¸ªç¬¦å·ä¸»è¦æ˜¯ç”¨äºè‡ªçœçš„ç›®çš„ã€‚\næ­¥éª¤4a: ç‰¹åŒ– æ‰€ä»¥ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå€™é€‰è€…ã€‚æˆ‘ä»¬çŸ¥é“å…·ä½“çš„å‚æ•°ã€‚æˆ‘ä»¬çŸ¥é“æ¶ˆè€—å®ƒçš„ç±»ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ç¡®å®çŸ¥é“äº†ä¸€åˆ‡ï¼Œå¯ä»¥è¿›è¡Œç‰¹åŒ–ï¼Œå¹¶å¾—åˆ°å…·ä½“åŒ–ï¼Œæœ€ç»ˆå°†è¿™ä¸ªè§’è‰²çº³å…¥æ¶ˆè´¹å®ƒçš„ç±»ä¸­ã€‚\næ­£å¦‚æˆ‘åœ¨ä¸Šé¢å·²ç»æåˆ°çš„ï¼Œç‰¹åŒ–æ˜¯ä¸€ä¸ªç›¸å½“å¤æ‚çš„è¿‡ç¨‹ã€‚åœ¨ Rakudo å…ƒæ¨¡å‹çš„å®ç°ä¸­ï¼Œå®ƒåˆ†å¸ƒåœ¨å‡ ä¸ªæºæ–‡ä»¶ä¸­ï¼Œå¹¶æ¶‰åŠåˆ°ä¸€äº›å…¶ä»–çš„å†…éƒ¨æœºåˆ¶ï¼Œå¦‚é€šç”¨å®ä¾‹åŒ–ï¼Œæˆ‘åœ¨ä¸Šé¢ä¹Ÿæš—ç¤ºè¿‡ã€‚æˆ‘æœ€å¥½ä¸è¦æ·±ç©¶å…¶ä¸­çš„ç»†èŠ‚ï¼Œè€Œæ˜¯ä¸“æ³¨äºä¸»è¦çš„é˜¶æ®µã€‚é‚£äº›çœŸæ­£å¥½å¥‡çš„äººå¯ä»¥ä» Rakudo ç¼–è¯‘å™¨æºæ–‡ä»¶ src/Perl6/Metamodel/ParametricRoleHOW.nqp ä¸­çš„æ–¹æ³•ç‰¹åŒ–å¼€å§‹ã€‚\nç‰¹åŒ–ä¸€ä¸ªæ–°çš„è§’è‰²ï¼Œé¦–å…ˆè¦åˆ›å»ºä¸€ä¸ª Perl6::Metamodel::ConcreteRoleHOW çš„æ–°å®ä¾‹å’Œç›¸åº”çš„å…·ä½“è§’è‰²ç±»å‹å¯¹è±¡ã€‚ç„¶åè°ƒç”¨ body block æ¥è·å¾—ä¸€ä¸ªç±»å‹ç¯å¢ƒç»“æ„ã€‚æˆ‘å°†é‡ç‚¹ä»‹ç»ä¸€ä¸‹è¿™ä¸ªã€‚åƒå¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬å…ˆä¸¾ä¸€ä¸ªä¾‹å­ã€‚\nrole R { say \u0026#34;inside the role, class is \u0026#34;, ::?CLASS.^name; say \u0026#34;class is composed? \u0026#34;, ::?CLASS.^is_composed ?? \u0026#34;yes\u0026#34; !! \u0026#34;no\u0026#34;; } class C1 does R { } class C2 does R { } # inside the role, class is C1 # class is composed? no # inside the role, class is C2 # class is composed? no æˆ‘ä»¬åœ¨è¿™é‡Œè§‚å¯Ÿåˆ°çš„æ˜¯ï¼Œè§’è‰²ä¸»ä½“å·²ç»è¢«è°ƒç”¨äº†ä¸¤æ¬¡ï¼Œå®ƒçŸ¥é“å®ƒæ‰€åº”ç”¨çš„ç±»ï¼Œè€Œä¸”è¿™ä¸ªç±»è¿˜æ²¡æœ‰è¢«ç»„æˆï¼ˆæˆ‘åœ¨å¦ä¸€ç¯‡æ–‡ç« ä¸­ä»‹ç»äº†ä¸€äº›å…³äºç±»ç”Ÿå‘½å‘¨æœŸçš„ä¿¡æ¯ï¼‰ã€‚å¦å¤–ï¼Œæ­£å¦‚æˆ‘å·²ç»æåˆ°çš„ï¼Œå…·ä½“åŒ–åœ¨è¿™ä¸€ç‚¹ä¸Šå­˜åœ¨ã€‚\nrole R { say $?CONCRETIZATION.^name; # R } ä½†å®ƒè¿˜æ˜¯ç©ºçš„ã€‚\nsay $?CONCRETIZATION.^attributes.elems; # 0 say $?CONCRETIZATION.^methods.elems; # 0 è€Œä¸”ï¼Œå¾ˆæ˜æ˜¾ï¼Œæ²¡æœ‰ç»„æˆã€‚\nsay $?CONCRETIZATION.^is_composed ?? \u0026#34;yes\u0026#34; !! \u0026#34;no\u0026#34;; # no æ‰€æœ‰è¿™äº›ä½¿å¾—è§’è‰²ä½“æˆä¸ºä¸€ä¸ªå¥½åœ°æ–¹ï¼Œå¯ä»¥åœ¨è§’è‰²è¢«å®é™…æ¶ˆè´¹æ—¶åšéœ€è¦åšçš„äº‹æƒ…ã€‚\nç°åœ¨ï¼Œæœ‰äº†æ‰€æœ‰å¿…è¦çš„ä¿¡æ¯ï¼Œå…ƒæ¨¡å‹é€šè¿‡å®ä¾‹åŒ–åŸå§‹å‚æ•°åŒ–æˆ–æŸ¯é‡ŒåŒ–è§’è‰²çš„å±æ€§å’Œæ–¹æ³•ï¼Œå¹¶å°†å®ƒä»¬å®‰è£…åˆ°æ–°åˆ›å»ºçš„å…·ä½“åŒ–ä¸­æ¥æœ€ç»ˆå®Œæˆä¸“ä¸šåŒ–ã€‚ä¾‹å¦‚è¿™ä¸ªç‰‡æ®µçš„ä¾‹å­ã€‚\nrole R[::T] { has T $.attr } class C R[Str] { } å¦‚æœæˆ‘ä»¬è½¬å‚¨åŸå§‹è§’è‰²å’Œå…·ä½“åŒ–çš„å±æ€§ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šçœ‹åˆ°ç±»ä¼¼äºä¸‹é¢çš„è¾“å‡ºã€‚\nrole attr: (Attribute|94613946040184 T $!attr) concretization attr: (Attribute|94613946043184 Str $!attr) å½“ç”¨å±æ€§å’Œæ–¹æ³•å®Œæˆæ—¶ï¼Œä»»ä½•è¢«æ¶ˆè€—çš„è§’è‰²éƒ½ä¼šè¢«å®ä¾‹åŒ–å’Œå…·ä½“åŒ–ã€‚ä¾‹å¦‚ï¼Œå¯¹äºè¿™ä¸ªå£°æ˜ã€‚\nrole R1[::T, ::V] does R2[::T] { ... } R2 çš„å…·ä½“åŒ–å°†è¢«æ·»åŠ åˆ° R1 çš„å…·ä½“åŒ–ä¸­ï¼Œç„¶å R2 çš„å…·ä½“åŒ–å°†è¢«æ·»åŠ åˆ° R1 çš„å…·ä½“åŒ–ä¸­ã€‚\næœ€åï¼Œå¦‚æœæœ‰ä»»ä½•çˆ¶ç±»æ·»åŠ åˆ°è§’è‰²ä¸­ï¼Œå®ƒä»¬ä¹Ÿä¼šè¢«å®ä¾‹åŒ–å’Œæ·»åŠ ã€‚\nå½“æ‰€æœ‰ä¸Šè¿°å‡†å¤‡å·¥ä½œå®Œæˆåï¼Œæˆ‘ä»¬çš„å…·ä½“åŒ–å°±è¢«ç»„æˆäº†ã€‚å®ƒç°åœ¨å·²ç»å‡†å¤‡å¥½è¢«æ·»åŠ åˆ°å®ƒçš„æ¶ˆè´¹ç±»ä¸­ã€‚\næ•…äº‹å°±è¿™æ ·ç»“æŸäº†ã€‚\nå¿è¿˜å€ºåŠ¡ çŸ¥é“å¾ˆä¹…ä»¥å‰çš„æ‰¿è¯ºæœ€ç»ˆå¾—åˆ°äº†å…‘ç°ï¼ŒçœŸçš„è®©äººæ¾äº†ä¸€å£æ°”ã€‚ä¸å¹¸çš„æ˜¯ï¼Œä¸ºäº†æ¶µç›–è¿™ä¸ªä¸»é¢˜ï¼Œæˆ‘å·²ç»è·³è¿‡äº†å…¶ä»–ä¸€äº›æ›´åŸºæœ¬çš„ä¸»é¢˜ã€‚ä¾‹å¦‚ï¼Œè®©è¯»è€…æ›´å¥½åœ°äº†è§£å¤šé‡è°ƒåº¦ã€ç±»å‹å¯¹è±¡çš„ç»„æˆï¼Œä»¥åŠ Rakudoã€NQP å’Œåç«¯è™šæ‹Ÿæœºæ˜¯å¦‚ä½•ç›¸äº’ä½œç”¨çš„ï¼Œè¿™å¯¹è¯»è€…æ˜¯æœ‰ç›Šçš„ã€‚å¦‚æœæˆ‘å†™äº†è¶³å¤Ÿå¤šçš„æ–‡ç« ï¼Œå¹¶è€ƒè™‘æŠŠè¿™äº›ææ–™ç¼–æˆä¸€æœ¬ä¹¦ï¼Œé‚£ä¹ˆç”±è¿™æ®µæ–‡å­—ç»„æˆçš„ç« èŠ‚å°†è¢«æ”¾åœ¨ç¦»ä¹¦çš„å¼€å¤´æ›´è¿œçš„åœ°æ–¹ã€‚\nä¸ç®¡æ€ä¹ˆè¯´ï¼Œæˆ‘å·²ç»å°½äº†æœ€å¤§çš„åŠªåŠ›ï¼Œè¿œç¦»é‚£äº›è¿˜æœªè¢«æåŠçš„æ¦‚å¿µï¼Œå¸Œæœ›ä½ åœ¨è¿™é‡Œæ‰¾åˆ°æœ‰ç”¨çš„ä¿¡æ¯ã€‚\nåŸæ–‡é“¾æ¥: https://vrurg.github.io/arfb-publication/07-roles-or-when-one-is-many/\n","permalink":"https://ohmyweekly.github.io/notes/2021-06-22-roles-or-when-one-is-many/","tags":["Raku","Role"],"title":"Roles or When One Is Many"},{"categories":["rakulang"],"contents":"Self-describing code Junctions  Distributive  %hash{any(@keys)} ç­‰ä»·äº:\nany(%hash{@keys})  Boolean     ç±»å‹ æ“ä½œç¬¦ True if \u0026hellip;     any | è‡³å°‘ä¸€ä¸ªå€¼ä¸ºçœŸ   all \u0026amp; æ‰€æœ‰å€¼éƒ½ä¸ºçœŸ   one ^ åªæœ‰ä¸€ä¸ªå€¼ä¸ºçœŸ   none  å€¼éƒ½ä¸ä¸ºçœŸ    Junctions é€šå¸¸å‡ºç°åœ¨å¸ƒå°”ä¸Šä¸‹æ–‡ä¸­ã€‚ä¾‹å¦‚, åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­, $value å’Œå‡ ä¸ªå€¼è¿›è¡Œç›¸ç­‰æ€§æ¯”è¾ƒã€‚å¾ˆå®¹æ˜“å†™å‡ºè¿™æ ·çš„ä»£ç :\nif $value == 1 || $value == 2 || $value == 5 ä½¿ç”¨ any Junction ä¼šç®€æ´ä¸å°‘:\nif $value == any(1, 2, 5) if $value == (1,2,4).any æƒ¯ç”¨æ³•æ˜¯ä½¿ç”¨ | æ“ä½œç¬¦å·æ¥è¿›è¡Œå¤šå€¼æ¯”è¾ƒ:\nif $value == 1|2|5 æ‰¾å‡ºæ•°ç»„ä¸­æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ , æˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„å¯èƒ½æ˜¯, ä½¿ç”¨ for å¾ªç¯è¿­ä»£æ•°ç»„, æ‰¾å‡ºæ»¡è¶³æ¡ä»¶çš„å…ƒç´ å°±ç«‹å³é€€å‡ºå¾ªç¯:\nmy $result = False; for @values -\u0026gt; $value { if $value \u0026gt; 42 { $result = True; last; } } if $result { ... } æ”¹ç”¨ Junction åç­‰ä»·äº:\nif any(@values) \u0026gt; 42 { ... } è¿˜å¯ä»¥åœ¨ Junction ä¸Šè°ƒç”¨æ–¹æ³•æˆ–è¿ç®—ç¬¦:\nif one(@values).is-prime { ... } if all(@values) %% 3 { ... } Named arguments(å‘½åå‚æ•°) Colonpair(å†’å·å¯¹å„¿) é€šå¸¸ç”¨äºå‘½åå‚æ•°ä¸­:\n:foo(42) foo =\u0026gt; 42 sub bar(:$foo) { say $foo; } bar(:foo(42)); æœ‰å‡ ç§ç‰¹æ®Šå½¢å¼çš„å†’å·å¯¹å„¿:\n:foo :foo(True) :!foo :foo(False) :foo\u0026lt;bar\u0026gt; :foo(\u0026#34;bar\u0026#34;) :foo ä¸ foo =\u0026gt; True ç›¸åŒ, :!foo ç­‰ä»·äº foo =\u0026gt; Falseã€‚:foo\u0026lt;bar\u0026gt; ä½¿ç”¨äº†ä¸€ç»„å°–æ‹¬å·å¼•èµ·äº†å€¼, å€¼åœ¨å°–æ‹¬å·ä¸­ä¸è¿›è¡Œæ’å€¼ã€‚\næ¥çœ‹ä¸€ä¸ªå‘½åå‚æ•°ä¾‹å­, ä¸‹é¢çš„ä»£ç éå† @dirs ä¸­çš„ç›®å½•, æ‰¾å‡ºåç¼€åä¸º txt ä¸”ä¸ä¸ºç©ºçš„æ–‡ä»¶:\nfor find(@dirs, :file, :ext\u0026lt;txt\u0026gt;, :!empty) -\u0026gt; $file { ... } å†’å·å¯¹å„¿çš„å€¼å¯ä»¥æ˜¯å˜é‡, ä½†æ˜¯åœ¨åœ†æ‹¬å·ä¸­å†å†™ä¸€éå˜é‡åå°±æ˜¾å¾—å•°å—¦:\nfoo(:bar($bar), :baz($baz), :quz($quz)) å› æ­¤, å†’å·å¯¹å„¿æä¾›äº†ä¸€ç§ç®€å†™å½¢å¼, å¦‚æœå†’å·åé¢ç´§è·Ÿç€ $ã€@ã€% å’Œ \u0026amp; ç­‰ç¬¦å·, é‚£ä¹ˆå†’å·å¯¹å„¿çš„å€¼å°±æ˜¯ $sthã€@sthã€%sth å’Œ \u0026amp;sth:\nfoo(:$bar, :$baz, :$quz) è¿™ç§ç®€å†™å½¢å¼æ¶ˆé™¤äº†å‘½åå‚æ•°çš„é‡å¤ã€‚\nPointy blocks(å°–å·å—å„¿) All blocks are Callable, å³æ‰€æœ‰çš„å—å„¿éƒ½æ˜¯å¯è°ƒç”¨çš„ã€‚\n for blocks  -\u0026gt; $elem { ...} å°±æ˜¯å°–å·å—å„¿:\nfor @array -\u0026gt; $elem { ... } for å¾ªç¯ä¾æ¬¡æŠŠ @array ä¸­çš„æ¯ä¸ªå…ƒç´ èµ‹å€¼ç»™å°–å·å—å„¿ä¸­çš„ $elem å˜é‡, ç„¶åæ‰§è¡Œå°–å·å—å„¿çš„ä¸»ä½“ã€‚\n Ordering  å¦‚æœ foo ä¾‹ç¨‹æœ‰è¿”å›å€¼ä¸”ä¸ä¸ºå‡, åˆ™èµ‹å€¼ç»™ $value, ç„¶åæ‰§è¡Œå—å„¿çš„ä¸»ä½“:\nif my $value = foo() { ... } ä½†æ˜¯ä¸Šé¢çš„è¯­å¥åœ¨ Raku ä¸­æ˜¯ä¸åˆæ³•çš„, è¦ä½¿ç”¨å°–å·å—å„¿çš„æ–¹å¼:\nif foo() -\u0026gt; $value { ... } Signatures(ç­¾å) for å¾ªç¯å¯ä»¥ä¸€æ¬¡è¿­ä»£ä¸¤ä¸ª(æˆ–å¤šä¸ª)å…ƒç´ ã€‚å°–å·å—å„¿ç›¸å½“äºåŒ¿åå‡½æ•°, å…¶ä¸­çš„ $first, $second å°±æ˜¯å°–å·å—å„¿çš„ç­¾åã€‚\nfor @array -\u0026gt; $first, $second { ... } ä¸‹é¢çš„æ™ºèƒ½åŒ¹é…ä¸­, å˜é‡ $1 å’Œ $2 æœ‰äº›å¤šä½™:\nif / (\\S+)\\s+(.*)/ { my $name = $1; my $value = $2; ... }é€šè¿‡å°–å·å—å„¿, æŠŠåŒ¹é…ç»“æœç›´æ¥èµ‹å€¼ç»™ $name å’Œ $value, èŠ‚çœäº†ä¸¤ä¸ªå˜é‡å:\nif / (\\S+)\\s+(.*)/ -\u0026gt; ($name, $value) { ... } for å°–å·å—å„¿å’Œ if å°–å·å—å„¿çš„ç»“æ„ç±»ä¼¼, è¯­æ³•ä¸Šéå¸¸æ•´é½:\nfor expression() -\u0026gt; $value { ... } if expression() -\u0026gt; $value { ... } Whatever code å¦‚æœ grep çš„è¿‡æ»¤æ¡ä»¶ä¸­æœ‰å¤šä¸ªå˜é‡, é‚£ä¹ˆä½¿ç”¨å°–å·å—å„¿è¿™ç§åŒ¿åå‡½æ•°æ¯”è¾ƒåˆé€‚:\n@numbers.grep(-\u0026gt; $n { $n \u0026gt; 2 }); å¦‚æœè¿‡æ»¤æ¡ä»¶ä¸­åªæœ‰ä¸€ä¸ªå˜é‡, é‚£ä¹ˆå½¢å¼æ›´çŸ­çš„ Whatever code æ›´ç¬¦åˆæƒ¯ç”¨æ³•:\n@numbers.grep(* \u0026gt; 2); Meta-operators  Reduction Zip Corss Hyper  Reduction meta operators\n fold/reduce an infix operator Respects associativity  reduce è¿ç®—ç¬¦å¯ä»¥ç”¨äºæ±‚å’Œ:\nmy $sum = reduce { $^a + $^b }, @list; my $sum = [+] @list [+] # sum [*] # product [~] # join [===] # all equal [\u0026lt;\u0026gt;] # ascending order [||] # first true value, if any  Zip å…ƒè¿ç®—ç¬¦ç”¨äºè¿æ¥åˆ—è¡¨:\n(1, 2, 3) Z+ (30, 20 ,10) # (21, 22, 13) -\u0026gt; ($a, $b) è§£æ„ Zip åçš„å…ƒç´ :\nfor @a Z @b -\u0026gt; ($a, $b) { ... } Z=\u0026gt; è¿ç®—ç¬¦é€šå¸¸ç”¨äºä»ä¸¤ä¸ªåˆ—è¡¨ä¸­åˆ¶ä½œå“ˆå¸Œ:\n%hash = @keys Z=\u0026gt; @values Zip å…ƒè¿ç®—ç¬¦å¯ä»¥å†™æˆé“¾å¼çš„:\n@a Z @b Z @c [Z] @list-of-lists Cross æ˜¯äº¤å‰è¿ç®—ç¬¦ã€‚ä½¿ç”¨ä¸¤å±‚ for å¾ªç¯ä¹Ÿå¯ä»¥å®ç°äº¤å‰è¿ç®—ç¬¦çš„åŠŸèƒ½, å°±æ˜¯ä»£ç ç¨é•¿:\ngather for 3, 9 -\u0026gt; $i { for 2, 10 -\u0026gt; $j { take $i + $j } } è€Œä½¿ç”¨äº¤å‰è¿ç®—ç¬¦, ä¸€è¡Œä»£ç æå®š:\n3, 9 X+ 2, 10 æ·»åŠ å‰ç¼€ä¹Ÿå¾ˆç®€å•:\n\u0026#34;prefix-\u0026#34; X~ @list Hyper è¿ç®—ç¬¦å¯ä»¥æŠŠä»»ä½•è¿ç®—ç¬¦(ä¸­ç¼€ã€å‰ç¼€å’Œåç¼€ç­‰)åº”ç”¨åˆ°åˆ—è¡¨ä¸Š:\n@listÂ».abs @list.map(*.abs) !Â«@list@list.map(!*)@listÂ»[1] @list.map(*[1]) æ¬§å‡ é‡Œå¾—è·ç¦»:\n@a Z- @b Squared(å¹³æ–¹)\n(@a Z- @b)Â»Â² Summed(æ±‚å’Œ)\n[+] (@a Z- @b)Â»Â² Square root(æ±‚å¹³æ–¹æ ¹)\nsqrt [+] (@a Z- @b)Â»Â² Smartmatch(æ™ºèƒ½åŒ¹é…) â€œIs the value part of this setâ€\n@list.grep(* \u0026gt; 2) @list.grep({ $_ eq \u0026#34;foo\u0026#34; }) @list.grep(Int) @list.grep({ .isa(Innt) }) @list.grep(/foo .*bar/) @list.grep({ .match(/foo .*bar/) }) @list.grep(2..4) @list.grep({ 2 \u0026lt;= $_ \u0026lt;= 4 }) @list.grep(:is-prime) @list.grep({ .is-prime }) combine junctions(ç»“åˆ Junctions):\n@list.grep(:is-prime \u0026amp; /22/) @list.grep({ .is-prime \u0026amp;\u0026amp; .matches(/22/) }) @list.grep(none(/22/)) @list.grep({ !.matches(/22/) }) æœ€å, è¿˜æ˜¯æŸ¥æ‰¾æ–‡ä»¶çš„ä¾‹å­:\nfind(@dirs, :ext(\u0026#39;rakumo\u0026#39;|\u0026#39;pm6\u0026#39;), :size(* \u0026gt; 1024), :depth(3..5), :contains(/raku/) ); åŸæ–‡é“¾æ¥: https://www.youtube.com/watch?v=elalwvfmYgk\n","permalink":"https://ohmyweekly.github.io/notes/2021-06-17-raku-syntax-i-miss-in-other-languages/","tags":["Raku"],"title":"Raku Syntax I Miss in Other Languages"},{"categories":["Raku"],"contents":"Raku çš„ Roast ä»“åº“æ˜¯ä¸€ä¸ªæµ‹è¯•å¥—ä»¶, æˆ‘ä»¬å¯ä»¥ä»è¿™ä¸ªä»“åº“ä¸­å­¦ä¹ åˆ°å¾ˆå¤š Raku çš„çŸ¥è¯†ã€‚\nå…ƒè¿ç®—ç¬¦  cross  dd \u0026lt;a b\u0026gt; X \u0026lt;c d\u0026gt; # Output: ((\u0026#34;a\u0026#34;, \u0026#34;c\u0026#34;), (\u0026#34;a\u0026#34;, \u0026#34;d\u0026#34;), (\u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;), (\u0026#34;b\u0026#34;, \u0026#34;d\u0026#34;)).Seq dd 1 X 1 X 1 X 1 # Output: ((1, 1, 1, 1),).Seq dd 1, 2, 3 X** 2, 4 # Output: 1, 1, 4, 16, 9, 81).Seq my @result = gather { for 1..3 X \u0026#39;a\u0026#39;..\u0026#39;b\u0026#39; -\u0026gt; ($n, $a) { take \u0026#34;$n|$a\u0026#34; } } dd @result; # Output: Array @result = [\u0026#34;1|a\u0026#34;, \u0026#34;1|b\u0026#34;, \u0026#34;2|a\u0026#34;, \u0026#34;2|b\u0026#34;, \u0026#34;3|a\u0026#34;, \u0026#34;3|b\u0026#34;] my @result = gather for (1..3 X \u0026#39;A\u0026#39;..\u0026#39;B\u0026#39;) -\u0026gt; $na { take $na.join(\u0026#39;:\u0026#39;); } dd @result; # Output: Array @result = [\u0026#34;1:A\u0026#34;, \u0026#34;1:B\u0026#34;, \u0026#34;2:A\u0026#34;, \u0026#34;2:B\u0026#34;, \u0026#34;3:A\u0026#34;, \u0026#34;3:B\u0026#34;] dd \u0026lt;a b\u0026gt; X, \u0026lt;c d\u0026gt;; # Output: ((\u0026#34;a\u0026#34;, \u0026#34;c\u0026#34;), (\u0026#34;a\u0026#34;, \u0026#34;d\u0026#34;), (\u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;), (\u0026#34;b\u0026#34;, \u0026#34;d\u0026#34;)).Seq dd \u0026lt;a b\u0026gt; X~ \u0026lt;1 2\u0026gt;; # Output: (\u0026#34;a1\u0026#34;, \u0026#34;a2\u0026#34;, \u0026#34;b1\u0026#34;, \u0026#34;b2\u0026#34;).Seq dd \u0026lt;a b\u0026gt; X, 1,2 X, \u0026lt;x y\u0026gt;; # Output: ((\u0026#34;a\u0026#34;, 1, \u0026#34;x\u0026#34;), (\u0026#34;a\u0026#34;, 1, \u0026#34;y\u0026#34;), (\u0026#34;a\u0026#34;, 2, \u0026#34;x\u0026#34;), (\u0026#34;a\u0026#34;, 2, \u0026#34;y\u0026#34;), (\u0026#34;b\u0026#34;, 1, \u0026#34;x\u0026#34;), (\u0026#34;b\u0026#34;, 1, \u0026#34;y\u0026#34;), (\u0026#34;b\u0026#34;, 2, \u0026#34;x\u0026#34;), (\u0026#34;b\u0026#34;, 2, \u0026#34;y\u0026#34;)).Seq dd 1,2 X* 3,4; # Output: (3, 4, 6, 8).Seq dd 1,2 Xcmp 3,2,0; # Output: (Order::Less, Order::Less, Order::More, Order::Less, Order::Same, Order::More).Seq dd 1 X* 3,4; # Output: (3, 4).Seq dd 1, 2 X* 3; # Output: (3, 6).Seq dd 1 X* 3; # Output: (3,).Seq # $[] does not flatten dd $[1,2] X~ \u0026lt;a b\u0026gt; # Output: (\u0026#34;1 2a\u0026#34;, \u0026#34;1 2b\u0026#34;).Seq  zip  dd \u0026lt;a b\u0026gt; Z \u0026lt;c d\u0026gt;; # Output: ((\u0026#34;a\u0026#34;, \u0026#34;c\u0026#34;), (\u0026#34;b\u0026#34;, \u0026#34;d\u0026#34;)).Seq dd 1, 2, 3 Z** 2, 4; # Output: (1, 16).Seq dd \u0026lt;a b\u0026gt; Z~ \u0026lt;1 2\u0026gt;; # Output: (\u0026#34;a1\u0026#34;, \u0026#34;b2\u0026#34;).Seq dd 1,2 Z* 3,4; # Output: (3, 8).Seq dd 1,2 Zcmp 3,2,0; # Output: (Order::Less, Order::Same).Seq dd (1..* Z** 1..*).[^5]; # Output: (1, 4, 27, 256, 3125) dd (1..* Z+ (3, 2 ... *)).[^5]; # Output: (4, 4, 4, 4, 4) dd 1 Z* 3,4; # Output: (3,).Seq dd 1, 2 Z* 3; # Output: (3,).Seq dd 1 Z* 3; # Output: (3,).Seq dd \u0026lt;a b c d\u0026gt; Z \u0026#39;x\u0026#39;, \u0026#39;z\u0026#39;, *; # Output: ((\u0026#34;a\u0026#34;, \u0026#34;x\u0026#34;), (\u0026#34;b\u0026#34;, \u0026#34;z\u0026#34;), (\u0026#34;c\u0026#34;, \u0026#34;z\u0026#34;), (\u0026#34;d\u0026#34;, \u0026#34;z\u0026#34;)).Seq dd 1, 2, 3, * Z 10, 20, 30, 40, 50; # Output: ((1, 10), (2, 20), (3, 30), (3, 40), (3, 50)).Seq dd (2, 10, * Z 3, 4, 5, *).[^5]; # Output: ((2, 3), (10, 4), (10, 5), (10, 5), (10, 5)) dd \u0026lt;a b c d\u0026gt; Z~ \u0026#39;x\u0026#39;, \u0026#39;z\u0026#39;, *; # Output: (\u0026#34;ax\u0026#34;, \u0026#34;bz\u0026#34;, \u0026#34;cz\u0026#34;, \u0026#34;dz\u0026#34;).Seq dd 1, 2, 3, * Z+ 10, 20, 30, 40, 50; # Output: (11, 22, 33, 43, 53).Seq dd (2, 10, * Z* 3, 4, 5, *).[^5]; # Output: (6, 40, 50, 50, 50) dd [Z](1,2,3;4,5,6;7,8,9); # Output: ((1, 4, 7), (2, 5, 8), (3, 6, 9)).Seq dd [Z\u0026lt;](1,2,3;4,5,6;7,8,9); (Bool::True, Bool::True, Bool::True).Seq  hyper  my $a := (1,2,3); my $b := (2,4,6); # ä»¥ä¸‹è¡¨è¾¾å¼éƒ½è¾“å‡º (3, 6, 9) dd $a \u0026gt;\u0026gt;+\u0026lt;\u0026lt; $b; dd $a Â»+Â« $b; dd $a \u0026gt;\u0026gt;+\u0026gt;\u0026gt; $b; dd $a Â»+Â» $b; dd $a \u0026lt;\u0026lt;+\u0026gt;\u0026gt; $b; dd $a Â«+Â» $b; dd $a \u0026lt;\u0026lt;+\u0026lt;\u0026lt; $b; dd $a Â«+Â« $b; dd $a \u0026gt;\u0026gt;[\u0026amp;infix:\u0026lt;+\u0026gt;]\u0026lt;\u0026lt; $b; dd $a Â»[\u0026amp;infix:\u0026lt;+\u0026gt;]Â« $b; dd $a \u0026gt;\u0026gt;[\u0026amp;infix:\u0026lt;+\u0026gt;]\u0026gt;\u0026gt; $b; dd $a Â»[\u0026amp;infix:\u0026lt;+\u0026gt;]Â» $b; dd $a \u0026lt;\u0026lt;[\u0026amp;infix:\u0026lt;+\u0026gt;]\u0026gt;\u0026gt; $b; dd $a Â«[\u0026amp;infix:\u0026lt;+\u0026gt;]Â» $b; dd $a \u0026lt;\u0026lt;[\u0026amp;infix:\u0026lt;+\u0026gt;]\u0026lt;\u0026lt; $b; dd $a Â«[\u0026amp;infix:\u0026lt;+\u0026gt;]Â« $b; Â»*Â« è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§æ¯” Â»+Â« è¿ç®—ç¬¦çš„ä¼˜å…ˆçº§é«˜:\ndd (1, 2, 3) Â»+Â« (10, 20, 30) Â»*Â« (2, 3, 4); # Output: (21, 62, 123) unary postfix(ä¸€å…ƒåç¼€è¿ç®—ç¬¦)\nmy @r = (1, 2, 3); @rÂ»++; dd @r; # Output: Array @r = [2, 3, 4] unary prefix(ä¸€å…ƒå‰ç¼€è¿ç®—ç¬¦)\nmy @r; @r = -Â« (3, 2, 1); dd @r; # Output: Array @r = [-3, -2, -1] dimension upgrade(å‡ç»´), auto dimension upgrade on rhs/lhs ASCII notation\nmy @r = (1, 2, 3) \u0026gt;\u0026gt;+\u0026gt;\u0026gt; 1; dd @r; # Output: Array @r = [2, 3, 4] my @r = 2 \u0026lt;\u0026lt;*\u0026lt;\u0026lt; (10, 20, 30); dd @r; # Output: Array @r = [20, 40, 60] both-dwim and non-dwim sanity:\ndd (1,2,3) \u0026lt;\u0026lt;~\u0026gt;\u0026gt; \u0026lt;A B C D E\u0026gt;; # Output: (\u0026#34;1A\u0026#34;, \u0026#34;2B\u0026#34;, \u0026#34;3C\u0026#34;, \u0026#34;1D\u0026#34;, \u0026#34;2E\u0026#34;) extension(æ‰©å±•)\ndd (1,2,3,4) \u0026gt;\u0026gt;~\u0026gt;\u0026gt; \u0026lt;A B C D E\u0026gt;; # Output: (\u0026#34;1A\u0026#34;, \u0026#34;2B\u0026#34;, \u0026#34;3C\u0026#34;, \u0026#34;4D\u0026#34;) dd (1,2,3,4,5) \u0026lt;\u0026lt;~\u0026lt;\u0026lt; \u0026lt;A B C D\u0026gt;; # Output: (\u0026#34;1A\u0026#34;, \u0026#34;2B\u0026#34;, \u0026#34;3C\u0026#34;, \u0026#34;4D\u0026#34;) dd (1,2,3,4) \u0026gt;\u0026gt;~\u0026gt;\u0026gt; \u0026lt;A B C\u0026gt;; # Output: (\u0026#34;1A\u0026#34;, \u0026#34;2B\u0026#34;, \u0026#34;3C\u0026#34;, \u0026#34;4A\u0026#34;) dd (1,2,3) \u0026lt;\u0026lt;~\u0026lt;\u0026lt; \u0026lt;A B C D\u0026gt;; # Output: (\u0026#34;1A\u0026#34;, \u0026#34;2B\u0026#34;, \u0026#34;3C\u0026#34;, \u0026#34;1D\u0026#34;) dd (1,2,3,4) \u0026gt;\u0026gt;~\u0026gt;\u0026gt; \u0026lt;A B\u0026gt;; # Output: (\u0026#34;1A\u0026#34;, \u0026#34;2B\u0026#34;, \u0026#34;3A\u0026#34;, \u0026#34;4B\u0026#34;) dd (1,2) \u0026lt;\u0026lt;~\u0026lt;\u0026lt; \u0026lt;A B C D\u0026gt;; # Output: (\u0026#34;1A\u0026#34;, \u0026#34;2B\u0026#34;, \u0026#34;1C\u0026#34;, \u0026#34;2D\u0026#34;) dd (1,2,3,4) \u0026gt;\u0026gt;~\u0026gt;\u0026gt; \u0026lt;A\u0026gt;; # Output: (\u0026#34;1A\u0026#34;, \u0026#34;2A\u0026#34;, \u0026#34;3A\u0026#34;, \u0026#34;4A\u0026#34;) dd (1,) \u0026lt;\u0026lt;~\u0026lt;\u0026lt; \u0026lt;A B C D\u0026gt;; # Output: (\u0026#34;1A\u0026#34;, \u0026#34;1B\u0026#34;, \u0026#34;1C\u0026#34;, \u0026#34;1D\u0026#34;) dd (1,2,3,4) \u0026gt;\u0026gt;~\u0026gt;\u0026gt; \u0026#39;A\u0026#39;; # Output: (\u0026#34;1A\u0026#34;, \u0026#34;2A\u0026#34;, \u0026#34;3A\u0026#34;, \u0026#34;4A\u0026#34;) dd 1 \u0026lt;\u0026lt;~\u0026lt;\u0026lt; \u0026lt;A B C D\u0026gt;; # Output: (\u0026#34;1A\u0026#34;, \u0026#34;1B\u0026#34;, \u0026#34;1C\u0026#34;, \u0026#34;1D\u0026#34;) æšä¸¾  åŒ¿åæšä¸¾  åŒ¿åæšä¸¾è¿”å›ä¸€ä¸ª Map:\nmy $e = enum \u0026lt;ook! ook. ook? \u0026gt;; # Map.new((ook! =\u0026gt; 0, ook. =\u0026gt; 1, ook? =\u0026gt; 2)) say $e.keys.elems; # 3 say $e\u0026lt;ook!\u0026gt;; # 0 say $e\u0026lt;ook.\u0026gt;; # 1 say $e\u0026lt;ook?\u0026gt;; # 2  say so $e ~~ Map; # True say $e.keys; # (ook? ook! ook.) anon enum \u0026lt;un\u0026gt; ç­‰ä»·äº enum :: \u0026lt;un\u0026gt;:\nanon enum \u0026lt;un\u0026gt;; # Map.new((un =\u0026gt; 0)) say +un; # 0 my %e = enum :: \u0026lt;foo bar baz \u0026gt;; # {bar =\u0026gt; 1, baz =\u0026gt; 2, foo =\u0026gt; 0} say %e\u0026lt;bar\u0026gt;; # 1 say baz; # baz say +baz; # 2  æšä¸¾ä½œä¸ºè§’è‰²  æšä¸¾å¯ä»¥ç”¨åœ¨ but æˆ– does ä¸­, ç”¨ä»¥å‘½ä»¤ä¸€ä¸ªæƒ³è¦çš„å±æ€§:\nenum Maybe \u0026lt;No Yes Dunno\u0026gt;; class Bar { } class Foo does Maybe {} my $x = Foo.new(Maybe =\u0026gt; No); say $x.No; # True say $x.Yes; # False say $x.Dunno; # False my $y = Bar.new() does Maybe(Yes); say $y.Yes; # True say $y.No; # False say $y.Dunno; # False my $z = Bar.new() but Maybe(Dunno); say $z.No; say $z.Yes; say $z.Dunno; å±æ€§  ä»£ç†  å®˜æ–¹æ–‡æ¡£å…³äº handles çš„ä»‹ç»å¾ˆç²—ç³™, çœ‹å®Œä¾ç„¶ä¸çŸ¥é“æ€ä¹ˆä½¿ç”¨ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2021-06-05-learn-raku-from-roast/","tags":["Raku","Raku roast"],"title":"Learn Raku From Roast"},{"categories":["rustlang"],"contents":"Rust çš„æ ‡å‡†åº“ Trait ä¹‹æ—… Table of Contents\n Intro Trait Basics  Trait Items  Self Functions Methods Associated Types Generic Parameters Generic Types vs Associated Types   Scope Derive Macros Default Impls Generic Blanket Impls Subtraits \u0026amp; Supertraits Trait Objects Marker Traits Auto Traits Unsafe Traits   Auto Traits  Send \u0026amp; Sync Sized   General Traits  Default Clone Copy Any   Formatting Traits  Display \u0026amp; ToString Debug   Operator Traits  Comparison Traits  PartialEq \u0026amp; Eq Hash PartialOrd \u0026amp; Ord   Arithmetic Traits  Add \u0026amp; AddAssign   Closure Traits  FnOnce, FnMut, \u0026amp; Fn   Other Traits  Deref \u0026amp; DerefMut Index \u0026amp; IndexMut Drop     Conversion Traits  From \u0026amp; Into   Error Handling  Error   Conversion Traits Continued  TryFrom \u0026amp; TryInto FromStr AsRef \u0026amp; AsMut Borrow \u0026amp; BorrowMut ToOwned   Iteration Traits  Iterator IntoIterator FromIterator   I/O Traits  Read \u0026amp; Write   Conclusion Discuss Notifications Further Reading  Intro ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œè¿™ä¸¤è€…ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«?\n Deref\u0026lt;Target = T\u0026gt;, AsRef\u0026lt;T\u0026gt; å’Œ Borrow\u0026lt;T\u0026gt;? Clone, Copy å’Œ ToOwned? From\u0026lt;T\u0026gt; å’Œ Into\u0026lt;T\u0026gt;? TryFrom\u0026lt;\u0026amp;str\u0026gt; å’Œ FromStr? FnOnce, FnMut, Fn å’Œ fn?  æˆ–è€…æ›¾ç»é—®è¿‡è‡ªå·±è¿™æ ·çš„é—®é¢˜:\n åœ¨æˆ‘çš„ trait ä¸­, æˆ‘ä»€ä¹ˆæ—¶å€™ä½¿ç”¨å…³è”ç±»å‹, ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ³›å‹ç±»å‹? ä»€ä¹ˆæ˜¯æ³›å‹çš„ blanket å®ç°? subtrait å’Œ supertrait æ˜¯å¦‚ä½•å·¥ä½œçš„? ä¸ºä»€ä¹ˆè¿™ä¸ª trait æ²¡æœ‰ä»»ä½•æ–¹æ³•?  é‚£ä¹ˆè¿™ç¯‡æ–‡ç« å°±æ˜¯ä¸ºä½ å‡†å¤‡çš„! å®ƒå›ç­”äº†ä»¥ä¸Šæ‰€æœ‰çš„é—®é¢˜ä»¥åŠæ›´å¤šçš„é—®é¢˜ã€‚æˆ‘ä»¬å°†ä¸€èµ·å¯¹ Rust æ ‡å‡†åº“ä¸­æ‰€æœ‰æœ€æµè¡Œã€æœ€å¸¸ç”¨çš„ trait è¿›è¡Œå¿«é€Ÿé£è¶Šä¹‹æ—…!\nä½ å¯ä»¥æŒ‰é¡ºåºé€èŠ‚é˜…è¯»æœ¬æ–‡ï¼Œä¹Ÿå¯ä»¥è·³è½¬åˆ°ä½ æœ€æ„Ÿå…´è¶£çš„ traitï¼Œå› ä¸ºæ¯ä¸ª trait éƒ¨åˆ†éƒ½æœ‰ä¸€ä¸ªé“¾æ¥åˆ—è¡¨ï¼Œé“¾æ¥åˆ° â€œå…ˆå†³çŸ¥è¯†â€ éƒ¨åˆ†ï¼Œä½ åº”è¯¥é˜…è¯»è¿™äº›é“¾æ¥ï¼Œä»¥ä¾¿æœ‰è¶³å¤Ÿçš„èƒŒæ™¯æ¥ç†è§£å½“å‰éƒ¨åˆ†çš„è§£é‡Šã€‚\nTrait åŸºç¡€ æˆ‘ä»¬å°†åªæ¶‰åŠè¶³å¤Ÿçš„åŸºç¡€çŸ¥è¯†ï¼Œä»¥ä¾¿æ–‡ç« çš„å…¶ä½™éƒ¨åˆ†å¯ä»¥ç²¾ç®€ï¼Œè€Œä¸å¿…åœ¨ä¸åŒçš„ trait ä¸­é‡æ–°å‡ºç°æ—¶é‡å¤ç›¸åŒçš„æ¦‚å¿µè§£é‡Šã€‚\nTrait é¡¹ Trait é¡¹æ˜¯æŒ‡ä½œä¸º trait å£°æ˜ä¸€éƒ¨åˆ†çš„ä»»ä½•é¡¹ã€‚\nSelf Self æ€»æ˜¯æŒ‡å®ç°ç±»å‹ã€‚\ntraitTrait{// always returns i32 fn returns_num()-\u0026gt; i32;// returns implementing type fn returns_self()-\u0026gt; Self;}struct SomeType;struct OtherType;implTraitforSomeType{fn returns_num()-\u0026gt; i32 {5}// Self == SomeType fn returns_self()-\u0026gt; Self{SomeType}}implTraitforOtherType{fn returns_num()-\u0026gt; i32 {6}// Self == OtherType fn returns_self()-\u0026gt; Self{OtherType}}å‡½æ•° Trait å‡½æ•°æ˜¯ä»»ä½•ç¬¬ä¸€ä¸ªå‚æ•°ä¸ä½¿ç”¨ self å…³é”®å­—çš„å‡½æ•°ã€‚\ntraitDefault{// function fn default()-\u0026gt; Self;}Trait å‡½æ•°å¯ä»¥é€šè¿‡ trait æˆ–å®ç°ç±»å‹æŒ‰ç…§å‘½åç©ºé—´çš„æ–¹å¼æ¥è°ƒç”¨ã€‚\nfn main(){letzero: i32 =Default::default();letzero=i32::default();}æ–¹æ³• Trait æ–¹æ³•æ˜¯æŒ‡ç¬¬ä¸€ä¸ªå‚æ•°ä½¿ç”¨ self å…³é”®å­—å¹¶ä¸”ç±»å‹ä¸º Selfã€\u0026amp;Selfã€\u0026amp;mut Self çš„ä»»ä½•å‡½æ•°ã€‚å‰é¢çš„ç±»å‹ä¹Ÿå¯ä»¥ç”¨ Boxã€Rcã€Arc æˆ– Pin æ¥åŒ…è£…ã€‚\ntraitTrait{// methods fn takes_self(self);fn takes_immut_self(\u0026amp;self);fn takes_mut_self(\u0026amp;mutself);// above methods desugared fn takes_self(self: Self);fn takes_immut_self(self: \u0026amp;Self);fn takes_mut_self(self: \u0026amp;mutSelf);}// example from standard library traitToString{fn to_string(\u0026amp;self)-\u0026gt; String;}å¯ä»¥ä½¿ç”¨å®ç°ç±»å‹ä¸Šçš„ç‚¹è¿ç®—ç¬¦æ¥è°ƒç”¨æ–¹æ³•ã€‚\nfn main(){letfive=5.to_string();}ç„¶è€Œï¼Œä¸å‡½æ•°ç±»ä¼¼ï¼Œå®ƒä»¬ä¹Ÿå¯ä»¥é€šè¿‡ trait æˆ–å®ç°ç±»å‹æŒ‰ç…§å‘½åç©ºé—´çš„æ–¹å¼æ¥è°ƒç”¨ã€‚\nfn main(){letfive=ToString::to_string(\u0026amp;5);letfive=i32::to_string(\u0026amp;5);}å…³è”ç±»å‹ Trait å¯ä»¥æœ‰å…³è”ç±»å‹ã€‚å½“æˆ‘ä»¬éœ€è¦åœ¨å‡½æ•°ç­¾åä¸­ä½¿ç”¨ Self ä»¥å¤–çš„å…¶ä»–ç±»å‹ï¼Œä½†åˆå¸Œæœ›ç±»å‹ç”±å®ç°è€…é€‰æ‹©ï¼Œè€Œä¸æ˜¯åœ¨ trait å£°æ˜ä¸­ç¡¬ç¼–ç æ—¶ï¼Œè¿™å¾ˆæœ‰ç”¨ã€‚\ntraitTrait{type AssociatedType;fn func(arg: Self::AssociatedType);}struct SomeType;struct OtherType;// any type implementing Trait can // choose the type of AssociatedType implTraitforSomeType{type AssociatedType=i8;// chooses i8 fn func(arg: Self::AssociatedType){}}implTraitforOtherType{type AssociatedType=u8;// chooses u8 fn func(arg: Self::AssociatedType){}}fn main(){SomeType::func(-1_i8);// can only call func with i8 on SomeType OtherType::func(1_u8);// can only call func with u8 on OtherType }æ³›å‹å‚æ•° â€œæ³›å‹å‚æ•°â€ æ³›æŒ‡æ³›å‹ç±»å‹å‚æ•°ã€æ³›å‹ lifetime å‚æ•°å’Œæ³›å‹å¸¸é‡å‚æ•°ã€‚ç”±äºè¿™äº›è¯´èµ·æ¥éƒ½å¾ˆæ‹—å£ï¼Œæ‰€ä»¥äººä»¬é€šå¸¸æŠŠå®ƒä»¬ç¼©å†™ä¸º \u0026ldquo;generic types\u0026rdquo;, \u0026ldquo;lifetimes\u0026rdquo; å’Œ \u0026ldquo;generic consts\u0026rdquo;ã€‚ç”±äº generic consts æ²¡æœ‰åœ¨æˆ‘ä»¬å°†è¦æ¶‰åŠçš„ä»»ä½•æ ‡å‡†åº“ trait ä¸­ä½¿ç”¨ï¼Œæ‰€ä»¥å®ƒä»¬ä¸åœ¨æœ¬æ–‡çš„èŒƒå›´ä¹‹å†…ã€‚\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‚æ•°æ¥æ³›å‹åŒ–ä¸€ä¸ª trait å£°æ˜ã€‚\n// trait declaration generalized with lifetime \u0026amp; type parameters traitTrait\u0026lt;\u0026#39;a,T\u0026gt;{// signature uses generic type fn func1(arg: T);// signature uses lifetime fn func2(arg: \u0026amp;\u0026#39;ai32);// signature uses generic type \u0026amp; lifetime fn func3(arg: \u0026amp;\u0026#39;aT);}struct SomeType;impl\u0026lt;\u0026#39;a\u0026gt;Trait\u0026lt;\u0026#39;a,i8\u0026gt;forSomeType{fn func1(arg: i8){}fn func2(arg: \u0026amp;\u0026#39;ai32){}fn func3(arg: \u0026amp;\u0026#39;ai8){}}impl\u0026lt;\u0026#39;b\u0026gt;Trait\u0026lt;\u0026#39;b,u8\u0026gt;forSomeType{fn func1(arg: u8){}fn func2(arg: \u0026amp;\u0026#39;bi32){}fn func3(arg: \u0026amp;\u0026#39;bu8){}}å¯ä»¥ä¸ºæ³›å‹ç±»å‹æä¾›é»˜è®¤å€¼ã€‚æœ€å¸¸ç”¨çš„é»˜è®¤å€¼æ˜¯ Selfï¼Œä½†ä»»ä½•ç±»å‹éƒ½å¯ä»¥ã€‚\n// make T = Self by default traitTrait\u0026lt;T=Self\u0026gt;{fn func(t: T){}}// any type can be used as the default traitTrait2\u0026lt;T=i32\u0026gt;{fn func2(t: T){}}struct SomeType;// omitting the generic type will // cause the impl to use the default // value, which is Self here implTraitforSomeType{fn func(t: SomeType){}}// default value here is i32 implTrait2forSomeType{fn func2(t: i32){}}// the default is overridable as we\u0026#39;d expect implTrait\u0026lt;String\u0026gt;forSomeType{fn func(t: String){}}// overridable here too implTrait2\u0026lt;String\u0026gt;forSomeType{fn func2(t: String){}}é™¤äº†å¯¹ trait è¿›è¡Œå‚æ•°åŒ–å¤–ï¼Œè¿˜å¯ä»¥å¯¹å•ä¸ªå‡½æ•°å’Œæ–¹æ³•è¿›è¡Œå‚æ•°åŒ–ã€‚\ntraitTrait{fn func\u0026lt;\u0026#39;a,T\u0026gt;(t: \u0026amp;\u0026#39;aT);}å°–æ‹¬å·(\u0026lt; \u0026gt;)ä¸­çš„ç±»å‹è¦ä¹ˆæ˜¯æ³›å‹(T), è¦ä¹ˆæ˜¯ä¸€ä¸ªå…·ä½“ç±»å‹(ä¾‹å¦‚ i32)ã€‚æ‰€ä»¥, çœ‹åˆ°å°–æ‹¬å·æ—¶, è¦æ„è¯†åˆ°è¿™ä¸ªä¸œè¥¿åº”è¯¥æ˜¯æ³›å‹çš„ã€‚\næ³›å‹ç±»å‹ vs å…³è”ç±»å‹ æ³›å‹ç±»å‹å’Œå…³è”ç±»å‹éƒ½å°†å†³å®šæƒäº¤ç»™äº†å®ç°è€…ï¼Œè®©ä»–ä»¬å†³å®šåœ¨ trait çš„å‡½æ•°å’Œæ–¹æ³•ä¸­åº”è¯¥ä½¿ç”¨å“ªç§å…·ä½“ç±»å‹ï¼Œæ‰€ä»¥æœ¬èŠ‚è¯•å›¾è§£é‡Šä»€ä¹ˆæ—¶å€™ä½¿ç”¨ä¸€ç§ç±»å‹è€Œä¸æ˜¯å¦ä¸€ç§ç±»å‹ã€‚\nä¸€èˆ¬çš„ç»éªŒæ³•åˆ™æ˜¯\n å½“æ¯ä¸ªç±»å‹åªèƒ½æœ‰ä¸€ä¸ª trait çš„å®ç°æ—¶ï¼Œä½¿ç”¨å…³è”ç±»å‹ã€‚ å½“æ¯ä¸ªç±»å‹å¯ä»¥æœ‰è®¸å¤šå¯èƒ½çš„ trait çš„å®ç°æ—¶ï¼Œä½¿ç”¨æ³›å‹ç±»å‹ã€‚  å‡è®¾æˆ‘ä»¬æƒ³å®šä¹‰ä¸€ä¸ªåä¸º Add çš„ traitï¼Œå®ƒå…è®¸æˆ‘ä»¬å°†å€¼åŠ åœ¨ä¸€èµ·ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªåˆå§‹è®¾è®¡å’Œåªä½¿ç”¨å…³è”ç±»å‹çš„å®ç°ã€‚\ntraitAdd{type Rhs;type Output;fn add(self,rhs: Self::Rhs)-\u0026gt; Self::Output;}struct Point{x: i32,y: i32,}implAddforPoint{type Rhs=Point;type Output=Point;fn add(self,rhs: Point)-\u0026gt; Point{Point{x: self.x+rhs.x,y: self.y+rhs.y,}}}fn main(){letp1=Point{x: 1,y: 1};letp2=Point{x: 2,y: 2};letp3=p1.add(p2);assert_eq!(p3.x,3);assert_eq!(p3.y,3);}æ¯”æ–¹è¯´ï¼Œæˆ‘ä»¬æƒ³ç»™ Point æ·»åŠ å’Œ i32 ç›¸åŠ çš„èƒ½åŠ›ï¼Œå…¶ä¸­ i32 å°†å’Œ x å’Œ y æˆå‘˜ç›¸åŠ ã€‚\ntraitAdd{type Rhs;type Output;fn add(self,rhs: Self::Rhs)-\u0026gt; Self::Output;}struct Point{x: i32,y: i32,}implAddforPoint{type Rhs=Point;type Output=Point;fn add(self,rhs: Point)-\u0026gt; Point{Point{x: self.x+rhs.x,y: self.y+rhs.y,}}}implAddforPoint{// âŒ type Rhs=i32;type Output=Point;fn add(self,rhs: i32)-\u0026gt; Point{Point{x: self.x+rhs,y: self.y+rhs,}}}fn main(){letp1=Point{x: 1,y: 1};letp2=Point{x: 2,y: 2};letp3=p1.add(p2);assert_eq!(p3.x,3);assert_eq!(p3.y,3);letp1=Point{x: 1,y: 1};letint2=2;letp3=p1.add(int2);// âŒ assert_eq!(p3.x,3);assert_eq!(p3.y,3);}è¿™æŠ›å‡º:\nerror[E0119]: conflicting implementations of trait `Add` for type `Point`:\r--\u0026gt; src/main.rs:23:1\r|\r12 | impl Add for Point {\r| ------------------ first implementation here\r...\r23 | impl Add for Point {\r| ^^^^^^^^^^^^^^^^^^ conflicting implementation for `Point`\rç”±äº Add trait æ²¡æœ‰ä»»ä½•æ³›å‹ç±»å‹çš„å‚æ•°åŒ–ï¼Œæˆ‘ä»¬åªèƒ½å¯¹æ¯ä¸ªç±»å‹è¿›è¡Œä¸€æ¬¡å®ç°ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬åªèƒ½ä¸º Rhs å’Œ Output é€‰æ‹©ä¸€æ¬¡ç±»å‹ï¼ä¸ºäº†å…è®¸ Point å’Œ Point ç›¸åŠ ,ä»¥åŠ i32 å’Œ Point ç›¸åŠ ï¼Œæˆ‘ä»¬å¿…é¡»å°† Rhs ä»å…³è”ç±»å‹é‡æ„ä¸ºæ³›å‹ç±»å‹ï¼Œè¿™å°†å…è®¸æˆ‘ä»¬ç”¨ä¸åŒçš„ç±»å‹å‚æ•°ä¸º Rhs å¤šæ¬¡å®ç° Point traitã€‚\ntraitAdd\u0026lt;Rhs\u0026gt;{type Output;fn add(self,rhs: Rhs)-\u0026gt; Self::Output;}struct Point{x: i32,y: i32,}implAdd\u0026lt;Point\u0026gt;forPoint{type Output=Self;fn add(self,rhs: Point)-\u0026gt; Self::Output{Point{x: self.x+rhs.x,y: self.y+rhs.y,}}}implAdd\u0026lt;i32\u0026gt;forPoint{// âœ… type Output=Self;fn add(self,rhs: i32)-\u0026gt; Self::Output{Point{x: self.x+rhs,y: self.y+rhs,}}}fn main(){letp1=Point{x: 1,y: 1};letp2=Point{x: 2,y: 2};letp3=p1.add(p2);assert_eq!(p3.x,3);assert_eq!(p3.y,3);letp1=Point{x: 1,y: 1};letint2=2;letp3=p1.add(int2);// âœ… assert_eq!(p3.x,3);assert_eq!(p3.y,3);}æ¯”æ–¹è¯´ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªåä¸º Line çš„æ–°ç±»å‹ï¼Œå®ƒåŒ…å«ä¸¤ä¸ª Pointï¼Œç°åœ¨åœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­ï¼Œå°†ä¸¤ä¸ª Point ç›¸åŠ åº”è¯¥äº§ç”Ÿä¸€ä¸ª Line è€Œä¸æ˜¯ Pointã€‚è€ƒè™‘åˆ° Add trait å½“å‰çš„è®¾è®¡ï¼Œè¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸º Output æ˜¯ä¸€ä¸ªå…³è”ç±»å‹ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡å°† Output ä»å…³è”ç±»å‹é‡æ„ä¸ºæ³›å‹ç±»å‹æ¥æ»¡è¶³è¿™äº›æ–°çš„è¦æ±‚ã€‚\ntraitAdd\u0026lt;Rhs,Output\u0026gt;{fn add(self,rhs: Rhs)-\u0026gt; Output;}struct Point{x: i32,y: i32,}implAdd\u0026lt;Point,Point\u0026gt;forPoint{fn add(self,rhs: Point)-\u0026gt; Point{Point{x: self.x+rhs.x,y: self.y+rhs.y,}}}implAdd\u0026lt;i32,Point\u0026gt;forPoint{fn add(self,rhs: i32)-\u0026gt; Point{Point{x: self.x+rhs,y: self.y+rhs,}}}struct Line{start: Point,end: Point,}implAdd\u0026lt;Point,Line\u0026gt;forPoint{// âœ… fn add(self,rhs: Point)-\u0026gt; Line{Line{start: self,end: rhs,}}}fn main(){letp1=Point{x: 1,y: 1};letp2=Point{x: 2,y: 2};letp3: Point=p1.add(p2);assert!(p3.x==3\u0026amp;\u0026amp;p3.y==3);letp1=Point{x: 1,y: 1};letint2=2;letp3=p1.add(int2);assert!(p3.x==3\u0026amp;\u0026amp;p3.y==3);letp1=Point{x: 1,y: 1};letp2=Point{x: 2,y: 2};letl: Line=p1.add(p2);// âœ… assert!(l.start.x==1\u0026amp;\u0026amp;l.start.y==1\u0026amp;\u0026amp;l.end.x==2\u0026amp;\u0026amp;l.end.y==2)}é‚£ä¹ˆï¼Œä¸Šé¢çš„ Add trait å“ªç§æœ€å¥½å‘¢ï¼Ÿè¿™çœŸçš„å–å†³äºä½ çš„ç¨‹åºçš„è¦æ±‚! åˆé€‚çš„å°±æ˜¯æœ€å¥½çš„ã€‚\nä½œç”¨åŸŸ Trait é¡¹ä¸èƒ½ä½¿ç”¨ï¼Œé™¤éè¯¥ trait åœ¨ä½œç”¨åŸŸå†…ã€‚å¤§å¤šæ•° Rustaceans åœ¨ç¬¬ä¸€æ¬¡å°è¯•å†™ä¸€ä¸ªç”¨ I/O åšä»»ä½•äº‹æƒ…çš„ç¨‹åºæ—¶ï¼Œéƒ½ä¼šè‰°éš¾åœ°å­¦ä¼šè¿™ä¸€ç‚¹ï¼Œå› ä¸º Read å’Œ Write trait ä¸åœ¨æ ‡å‡†åº“çš„é¢„åŠ è½½ä¸­ã€‚\nusestd::fs::File;usestd::io;fn main()-\u0026gt; Result\u0026lt;(),io::Error\u0026gt;{letmutfile=File::open(\u0026#34;Cargo.toml\u0026#34;)?;letmutbuffer=String::new();file.read_to_string(\u0026amp;mutbuffer)?;// âŒ read_to_string not found in File Ok(())}read_to_string(buf: \u0026amp;mut String) ç”± std::io::Read trait å£°æ˜ï¼Œå¹¶ç”± std::fs::File ç»“æ„ä½“å®ç°ï¼Œä½†ä¸ºäº†è°ƒç”¨å®ƒï¼Œstd::io::Read å¿…é¡»åœ¨ä½œç”¨åŸŸå†…ã€‚\nusestd::fs::File;usestd::io;usestd::io::Read;// âœ… fn main()-\u0026gt; Result\u0026lt;(),io::Error\u0026gt;{letmutfile=File::open(\u0026#34;Cargo.toml\u0026#34;)?;letmutbuffer=String::new();file.read_to_string(\u0026amp;mutbuffer)?;// âœ… Ok(())}æ ‡å‡†åº“ä¸­çš„ prelude æ˜¯æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œå³ std::prelude::v1ï¼Œå®ƒåœ¨æ¯ä¸ªå…¶ä»–æ¨¡å—çš„é¡¶éƒ¨è¢«è‡ªåŠ¨å¯¼å…¥ï¼Œå³ use std::prelude::v1::*ã€‚å› æ­¤ï¼Œä¸‹é¢çš„ trait æ€»æ˜¯åœ¨ä½œç”¨åŸŸå†…ï¼Œæˆ‘ä»¬æ°¸è¿œä¸éœ€è¦æ˜¾å¼å¯¼å…¥å®ƒä»¬ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ prelude çš„ä¸€éƒ¨åˆ†ã€‚\n AsMut AsRef Clone Copy Default Drop Eq Fn FnMut FnOnce From Into ToOwned IntoIterator Iterator PartialEq PartialOrd Send Sized Sync ToString Ord  æ´¾ç”Ÿå® æ ‡å‡†åº“å¯¼å‡ºäº†ä¸€äº›æ´¾ç”Ÿå®ï¼Œå¦‚æœä¸€ä¸ªç±»å‹çš„æ‰€æœ‰æˆå‘˜éƒ½å®ç°äº†æŸä¸ª trait, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™äº›å®æ¥å¿«é€Ÿæ–¹ä¾¿åœ°åœ¨è¿™ä¸ªç±»å‹ä¸Šå®ç°è¯¥ traitã€‚è¿™äº›æ´¾ç”Ÿå®ä»¥å®ƒä»¬æ‰€å®ç°çš„ trait å‘½åã€‚\n Clone Copy Debug Default Eq Hash Ord PartialEq PartialOrd  ä½¿ç”¨ç¤ºä¾‹:\n// macro derives Copy \u0026amp; Clone impl for SomeType #[derive(Copy, Clone)]struct SomeType;æ³¨æ„ï¼šæ´¾ç”Ÿå®åªæ˜¯è¿‡ç¨‹å®ï¼Œå¯ä»¥åšä»»ä½•äº‹æƒ…ï¼Œæ²¡æœ‰ç¡¬æ€§è§„å®šä¸€å®šè¦å®ç°ä¸€ä¸ª traitï¼Œä¹Ÿæ²¡æœ‰è§„å®šåªæœ‰åœ¨ç±»å‹çš„æ‰€æœ‰æˆå‘˜éƒ½å®ç°ä¸€ä¸ª trait çš„æƒ…å†µä¸‹æ‰èƒ½å·¥ä½œï¼Œè¿™äº›åªæ˜¯æ ‡å‡†åº“ä¸­æ´¾ç”Ÿå®æ‰€éµå¾ªçš„çº¦å®šã€‚\né»˜è®¤å®ç° Trait å¯ä»¥ä¸ºå…¶å‡½æ•°å’Œæ–¹æ³•æä¾›é»˜è®¤çš„å®ç°ã€‚\ntraitTrait{fn method(\u0026amp;self){println!(\u0026#34;default impl\u0026#34;);}}struct SomeType;struct OtherType;// use default impl for Trait::method implTraitforSomeType{}implTraitforOtherType{// use our own impl for Trait::method fn method(\u0026amp;self){println!(\u0026#34;OtherType impl\u0026#34;);}}fn main(){SomeType.method();// prints \u0026#34;default impl\u0026#34; OtherType.method();// prints \u0026#34;OtherType impl\u0026#34; }å¦‚æœä¸€äº› trait æ–¹æ³•å¯ä»¥åªç”¨å…¶ä»– trait æ–¹æ³•æ¥å®ç°ï¼Œè¿™å°±ç‰¹åˆ«æ–¹ä¾¿ã€‚\ntraitGreet{fn greet(\u0026amp;self,name: \u0026amp;str)-\u0026gt; String;fn greet_loudly(\u0026amp;self,name: \u0026amp;str)-\u0026gt; String {self.greet(name)+\u0026#34;!\u0026#34;}}struct Hello;struct Hola;implGreetforHello{fn greet(\u0026amp;self,name: \u0026amp;str)-\u0026gt; String {format!(\u0026#34;Hello {}\u0026#34;,name)}// use default impl for greet_loudly }implGreetforHola{fn greet(\u0026amp;self,name: \u0026amp;str)-\u0026gt; String {format!(\u0026#34;Hola {}\u0026#34;,name)}// override default impl fn greet_loudly(\u0026amp;self,name: \u0026amp;str)-\u0026gt; String {letmutgreeting=self.greet(name);greeting.insert_str(0,\u0026#34;Â¡\u0026#34;);greeting+\u0026#34;!\u0026#34;}}fn main(){println!(\u0026#34;{}\u0026#34;,Hello.greet(\u0026#34;John\u0026#34;));// prints \u0026#34;Hello John\u0026#34; println!(\u0026#34;{}\u0026#34;,Hello.greet_loudly(\u0026#34;John\u0026#34;));// prints \u0026#34;Hello John!\u0026#34; println!(\u0026#34;{}\u0026#34;,Hola.greet(\u0026#34;John\u0026#34;));// prints \u0026#34;Hola John\u0026#34; println!(\u0026#34;{}\u0026#34;,Hola.greet_loudly(\u0026#34;John\u0026#34;));// prints \u0026#34;Â¡Hola John!\u0026#34; }æ ‡å‡†åº“ä¸­çš„è®¸å¤š trait ä¸ºå®ƒä»¬çš„è®¸å¤šæ–¹æ³•æä¾›äº†é»˜è®¤çš„å®ç°ã€‚\nGeneric Blanket Impls é€šç”¨å…¨é¢å®ç°æ˜¯åœ¨æ³›å‹ç±»å‹è€Œä¸æ˜¯å…·ä½“ç±»å‹ä¸Šçš„å®ç°ã€‚ä¸ºäº†è§£é‡Šä¸ºä»€ä¹ˆä»¥åŠå¦‚ä½•ä½¿ç”¨ï¼Œè®©æˆ‘ä»¬ä»ä¸ºæ•°å­—ç±»å‹ç¼–å†™ä¸€ä¸ª is_even æ–¹æ³•å¼€å§‹ã€‚\ntraitEven{fn is_even(self)-\u0026gt; bool;}implEvenfori8{fn is_even(self)-\u0026gt; bool {self%2_i8==0_i8}}implEvenforu8{fn is_even(self)-\u0026gt; bool {self%2_u8==0_u8}}implEvenfori16{fn is_even(self)-\u0026gt; bool {self%2_i16==0_i16}}// etc #[test]// âœ… fn test_is_even(){assert!(2_i8.is_even());assert!(4_u8.is_even());assert!(6_i16.is_even());// etc }æ˜¾ç„¶ï¼Œè¿™æ˜¯å¾ˆå•°å—¦çš„ã€‚è€Œä¸”ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„å®ç°å‡ ä¹éƒ½æ˜¯ä¸€æ ·çš„ã€‚æ­¤å¤–ï¼Œå¦‚æœ Rust å†³å®šåœ¨æœªæ¥æ·»åŠ æ›´å¤šçš„æ•°å­—ç±»å‹ï¼Œæˆ‘ä»¬å¿…é¡»è®°å¾—å›åˆ°è¿™æ®µä»£ç ï¼Œå¹¶ç”¨æ–°çš„æ•°å­—ç±»å‹æ›´æ–°å®ƒã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªé€šç”¨çš„å…¨é¢å®ç°æ¥è§£å†³æ‰€æœ‰è¿™äº›é—®é¢˜ã€‚\nusestd::fmt::Debug;usestd::convert::TryInto;usestd::ops::Rem;traitEven{fn is_even(self)-\u0026gt; bool;}// generic blanket impl impl\u0026lt;T\u0026gt;EvenforTwhereT: Rem\u0026lt;Output=T\u0026gt;+PartialEq\u0026lt;T\u0026gt;+Sized,u8: TryInto\u0026lt;T\u0026gt;,\u0026lt;u8asTryInto\u0026lt;T\u0026gt;\u0026gt;::Error: Debug,{fn is_even(self)-\u0026gt; bool {// these unwraps will never panic self%2.try_into().unwrap()==0.try_into().unwrap()}}#[test]// âœ… fn test_is_even(){assert!(2_i8.is_even());assert!(4_u8.is_even());assert!(6_i16.is_even());// etc }Unlike default impls, which provide an impl, generic blanket impls provide the impl, so they are not overridable. ä¸é»˜è®¤å®ç°ä¸åŒï¼Œé»˜è®¤çš„å®ç°æä¾›äº†ä¸€ä¸ªå®ç°ï¼Œè€Œé€šç”¨çš„å…¨é¢å®ç°æä¾›äº†ç‰¹å®šçš„å®ç°ï¼Œæ‰€ä»¥å®ƒä»¬æ˜¯ä¸å¯è¦†ç›–çš„ã€‚\nusestd::fmt::Debug;usestd::convert::TryInto;usestd::ops::Rem;traitEven{fn is_even(self)-\u0026gt; bool;}impl\u0026lt;T\u0026gt;EvenforTwhereT: Rem\u0026lt;Output=T\u0026gt;+PartialEq\u0026lt;T\u0026gt;+Sized,u8: TryInto\u0026lt;T\u0026gt;,\u0026lt;u8asTryInto\u0026lt;T\u0026gt;\u0026gt;::Error: Debug,{fn is_even(self)-\u0026gt; bool {self%2.try_into().unwrap()==0.try_into().unwrap()}}implEvenforu8{// âŒ fn is_even(self)-\u0026gt; bool {self%2_u8==0_u8}}è¿™æŠ›å‡º:\nerror[E0119]: conflicting implementations of trait `Even` for type `u8`:\r--\u0026gt; src/lib.rs:22:1\r|\r10 | / impl\u0026lt;T\u0026gt; Even for T\r11 | | where\r12 | | T: Rem\u0026lt;Output = T\u0026gt; + PartialEq\u0026lt;T\u0026gt; + Sized,\r13 | | u8: TryInto\u0026lt;T\u0026gt;,\r... |\r19 | | }\r20 | | }\r| |_- first implementation here\r21 | 22 | impl Even for u8 {\r| ^^^^^^^^^^^^^^^^ conflicting implementation for `u8`\rThese impls overlap, hence they conflict, hence Rust rejects the code to ensure trait coherence. Trait coherence is the property that there exists at most one impl of a trait for any given type. The rules Rust uses to enforce trait coherence, the implications of those rules, and workarounds for the implications are outside the scope of this article.\nè¿™äº›å®ç°é‡å äº†ï¼Œå› æ­¤å®ƒä»¬å†²çªï¼Œå› æ­¤ Rust æ‹’ç»äº†ç¡®ä¿ trait ä¸€è‡´æ€§çš„ä»£ç ã€‚Trait ä¸€è‡´æ€§æ˜¯æŒ‡ä»»ä½•ç»™å®šç±»å‹çš„ trait æœ€å¤šå­˜åœ¨ä¸€ä¸ªå®ç°çš„å±æ€§ã€‚Rust ç”¨æ¥å¼ºåˆ¶æ‰§è¡Œ trait ä¸€è‡´æ€§çš„è§„åˆ™ï¼Œè¿™äº›è§„åˆ™çš„å«ä¹‰ï¼Œä»¥åŠå«ä¹‰çš„å˜é€šæ–¹æ³•éƒ½ä¸åœ¨æœ¬æ–‡çš„èŒƒå›´å†…ã€‚\nSubtraits \u0026amp; Supertraits \u0026ldquo;subtrait\u0026rdquo; ä¸­çš„ \u0026ldquo;sub\u0026rdquo; æŒ‡çš„æ˜¯å­é›†ï¼Œ\u0026ldquo;supertrait\u0026rdquo; ä¸­çš„ \u0026ldquo;super\u0026rdquo; æŒ‡çš„æ˜¯è¶…é›†ã€‚å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªè¿™æ ·çš„ trait å£°æ˜ã€‚\ntraitSubtrait: Supertrait{}All of the types which impl Subtrait are a subset of all the types which impl Supertrait, or to put it in opposite but equivalent terms: all the types which impl Supertrait are a superset of all the types which impl Subtrait.\nAlso, the above is just syntax sugar for: æ‰€æœ‰å®ç° Subtrait çš„ç±»å‹éƒ½æ˜¯æ‰€æœ‰å®ç° Supertrait çš„ç±»å‹çš„å­é›†ï¼Œæˆ–è€…ç”¨ç›¸åä½†ç­‰ä»·çš„è¯è¯­æ¥è¡¨è¾¾ï¼šæ‰€æœ‰å®ç° Supertrait çš„ç±»å‹éƒ½æ˜¯æ‰€æœ‰å®ç° Subtrait çš„ç±»å‹çš„è¶…é›†ã€‚\nå¦å¤–ï¼Œä¸Šé¢çš„ä»£ç åªæ˜¯ä¸‹é¢è¿™æ®µä»£ç çš„è¯­æ³•ç³–:\ntraitSubtraitwhereSelf: Supertrait{}è¿™æ˜¯ä¸€ä¸ªå¾®å¦™è€Œåˆé‡è¦çš„åŒºåˆ«ï¼Œè¦ç†è§£çš„æ˜¯ï¼Œçº¦æŸæ˜¯åœ¨ Self ä¸Šçš„ï¼Œå³å®ç° Subtrait çš„ç±»å‹ï¼Œè€Œä¸æ˜¯åœ¨ Subtrait æœ¬èº«ã€‚åè€…æ˜¯æ²¡æœ‰ä»»ä½•æ„ä¹‰çš„ï¼Œå› ä¸º trait çº¦æŸåªèƒ½åº”ç”¨äºå…·ä½“çš„ç±»å‹ï¼Œè¿™äº›ç±»å‹å¯ä»¥å®ç° traitã€‚Trait ä¸èƒ½å®ç°å…¶ä»– traitã€‚\ntraitSupertrait{fn method(\u0026amp;self){println!(\u0026#34;in supertrait\u0026#34;);}}traitSubtrait: Supertrait{// this looks like it might impl or // override Supertrait::method but it // does not fn method(\u0026amp;self){println!(\u0026#34;in subtrait\u0026#34;)}}struct SomeType;// adds Supertrait::method to SomeType implSupertraitforSomeType{}// adds Subtrait::method to SomeType implSubtraitforSomeType{}// both methods exist on SomeType simultaneously // neither overriding or shadowing the other fn main(){SomeType.method();// âŒ ambiguous method call // must disambiguate using fully-qualified syntax \u0026lt;SomeTypeasSupertrait\u0026gt;::method(\u0026amp;st);// âœ… prints \u0026#34;in supertrait\u0026#34; \u0026lt;SomeTypeasSubtrait\u0026gt;::method(\u0026amp;st);// âœ… prints \u0026#34;in subtrait\u0026#34; }Furthermore, there are no rules for how a type must impl both a subtrait and a supertrait. It can use the methods from either in the impl of the other. æ­¤å¤–ï¼Œæ²¡æœ‰è§„å®šä¸€ä¸ªç±»å‹å¿…é¡»åŒæ—¶å®ç°ä¸€ä¸ª subtrait å’Œä¸€ä¸ª supertraitã€‚å®ƒå¯ä»¥åœ¨å¦ä¸€ä¸ªç±»å‹çš„å®ç°ä¸­ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªç±»å‹çš„æ–¹æ³•ã€‚\ntraitSupertrait{fn super_method(\u0026amp;mutself);}traitSubtrait: Supertrait{fn sub_method(\u0026amp;mutself);}struct CallSuperFromSub;implSupertraitforCallSuperFromSub{fn super_method(\u0026amp;mutself){println!(\u0026#34;in super\u0026#34;);}}implSubtraitforCallSuperFromSub{fn sub_method(\u0026amp;mutself){println!(\u0026#34;in sub\u0026#34;);self.super_method();}}struct CallSubFromSuper;implSupertraitforCallSubFromSuper{fn super_method(\u0026amp;mutself){println!(\u0026#34;in super\u0026#34;);self.sub_method();}}implSubtraitforCallSubFromSuper{fn sub_method(\u0026amp;mutself){println!(\u0026#34;in sub\u0026#34;);}}struct CallEachOther(bool);implSupertraitforCallEachOther{fn super_method(\u0026amp;mutself){println!(\u0026#34;in super\u0026#34;);ifself.0{self.0=false;self.sub_method();}}}implSubtraitforCallEachOther{fn sub_method(\u0026amp;mutself){println!(\u0026#34;in sub\u0026#34;);ifself.0{self.0=false;self.super_method();}}}fn main(){CallSuperFromSub.super_method();// prints \u0026#34;in super\u0026#34; CallSuperFromSub.sub_method();// prints \u0026#34;in sub\u0026#34;, \u0026#34;in super\u0026#34; CallSubFromSuper.super_method();// prints \u0026#34;in super\u0026#34;, \u0026#34;in sub\u0026#34; CallSubFromSuper.sub_method();// prints \u0026#34;in sub\u0026#34; CallEachOther(true).super_method();// prints \u0026#34;in super\u0026#34;, \u0026#34;in sub\u0026#34; CallEachOther(true).sub_method();// prints \u0026#34;in sub\u0026#34;, \u0026#34;in super\u0026#34; }Hopefully the examples above show that the relationship between subtraits and supertraits can be complex. Before introducing a mental model that neatly encapsulates all of that complexity let\u0026rsquo;s quickly review and establish the mental model we use for understanding trait bounds on generic types: å¸Œæœ›ä¸Šé¢çš„ä¾‹å­èƒ½è¡¨æ˜ï¼Œsubtrait å’Œ supertrait ä¹‹é—´çš„å…³ç³»å¯èƒ½å¾ˆå¤æ‚ã€‚åœ¨ä»‹ç»ä¸€ä¸ªèƒ½æ•´é½åœ°æ¦‚æ‹¬æ‰€æœ‰è¿™äº›å¤æ‚æ€§çš„å¿ƒç†æ¨¡å‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å¿«é€Ÿå›é¡¾å¹¶å»ºç«‹æˆ‘ä»¬ç”¨äºç†è§£æ³›å‹ä¸Šçš„ trait çº¦æŸçš„å¿ƒç†æ¨¡å‹ã€‚\nfn function\u0026lt;T: Clone\u0026gt;(t: T){// impl }Without knowing anything about the impl of this function we could reasonably guess that t.clone() gets called at some point because when a generic type is bounded by a trait that strongly implies it has a dependency on the trait. The mental model for understanding the relationship between generic types and their trait bounds is a simple and intuitive one: generic types depend on their trait bounds.\nNow let\u0026rsquo;s look the trait declaration for Copy: åœ¨ä¸äº†è§£è¿™ä¸ªå‡½æ•°çš„å®ç°çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆç†åœ°çŒœæµ‹ t.clone() åœ¨æŸäº›æ—¶å€™ä¼šè¢«è°ƒç”¨ï¼Œå› ä¸ºå½“ä¸€ä¸ªæ³›å‹è¢«ä¸€ä¸ª trait çº¦æŸæ—¶ï¼Œå¼ºçƒˆåœ°æ„å‘³ç€å®ƒå¯¹ trait æœ‰ä¾èµ–æ€§ã€‚ç†è§£æ³›å‹ä¸å…¶ trait çº¦æŸä¹‹é—´å…³ç³»çš„å¿ƒç†æ¨¡å‹æ˜¯ä¸€ä¸ªç®€å•è€Œç›´è§‚çš„æ¨¡å‹ï¼šæ³›å‹ â€œä¾èµ–â€ å…¶ trait çº¦æŸã€‚\nç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ Copy çš„ trait å£°æ˜ã€‚\ntraitCopy: Clone {}ä¸Šé¢çš„è¯­æ³•çœ‹èµ·æ¥éå¸¸ç±»ä¼¼äºåœ¨æ³›å‹ç±»å‹ä¸Šåº”ç”¨ trait çº¦æŸçš„è¯­æ³•ï¼Œç„¶è€Œ Copy æ ¹æœ¬ä¸ä¾èµ–äº Cloneã€‚æˆ‘ä»¬å‰é¢å¼€å‘çš„å¿ƒç†æ¨¡å‹åœ¨è¿™é‡Œå¹¶ä¸èƒ½å¸®åŠ©æˆ‘ä»¬ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œç†è§£ subtrait å’Œ supertrait ä¹‹é—´å…³ç³»çš„æœ€ç®€å•ã€æœ€ä¼˜é›…çš„å¿ƒç†æ¨¡å‹æ˜¯ï¼šsubtrait â€œç²¾ç‚¼â€ å…¶ supertraitã€‚\nâ€œç²¾ç‚¼â€ è¿™ä¸ªè¯æ•…æ„ä¿æŒæœ‰äº›æ¨¡ç³Šï¼Œå› ä¸ºå®ƒåœ¨ä¸åŒçš„è¯­å¢ƒä¸­å¯ä»¥æœ‰ä¸åŒçš„å«ä¹‰ã€‚\n subtrait å¯èƒ½ä¼šä½¿å®ƒçš„ supertrait çš„æ–¹æ³•æ›´åŠ ç‰¹åŒ–ï¼Œé€Ÿåº¦æ›´å¿«ï¼Œä½¿ç”¨æ›´å°‘çš„å†…å­˜ï¼Œä¾‹å¦‚ï¼šCopy: Clone subtrait å¯ä»¥å¯¹ supertrait çš„æ–¹æ³•çš„å®ç°åšå‡ºé¢å¤–çš„ä¿è¯ï¼Œä¾‹å¦‚ Eq: PartialEq, Ord: PartialOrd, ExactSizeIterator: Iterator subtrait å¯èƒ½ä½¿ supertrait çš„æ–¹æ³•æ›´çµæ´»æˆ–æ›´å®¹æ˜“è°ƒç”¨ï¼Œä¾‹å¦‚ FnMut: FnOnce, `Fn: FnMut subtrait å¯ä»¥æ‰©å±•ä¸€ä¸ª supertraitï¼Œå¹¶æ·»åŠ æ–°çš„æ–¹æ³•ï¼Œä¾‹å¦‚ DoubleEndedIterator: Iterator, ExactSizeIterator: Iterator  Trait å¯¹è±¡ æ³›å‹ç»™äº†æˆ‘ä»¬ç¼–è¯‘æ—¶çš„å¤šæ€æ€§ï¼Œè€Œ trait å¯¹è±¡ç»™äº†æˆ‘ä»¬è¿è¡Œæ—¶çš„å¤šæ€æ€§ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ trait å¯¹è±¡æ¥å…è®¸å‡½æ•°åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°è¿”å›ä¸åŒçš„ç±»å‹ã€‚\nfn example(condition: bool,vec: Vec\u0026lt;i32\u0026gt;)-\u0026gt; Box\u0026lt;dynIterator\u0026lt;Item=i32\u0026gt;\u0026gt;{letiter=vec.into_iter();ifcondition{// Has type: // Box\u0026lt;Map\u0026lt;IntoIter\u0026lt;i32\u0026gt;, Fn(i32) -\u0026gt; i32\u0026gt;\u0026gt; // But is cast to: // Box\u0026lt;dyn Iterator\u0026lt;Item = i32\u0026gt;\u0026gt; Box::new(iter.map(|n|n*2))}else{// Has type: // Box\u0026lt;Filter\u0026lt;IntoIter\u0026lt;i32\u0026gt;, Fn(\u0026amp;i32) -\u0026gt; bool\u0026gt;\u0026gt; // But is cast to: // Box\u0026lt;dyn Iterator\u0026lt;Item = i32\u0026gt;\u0026gt; Box::new(iter.filter(|\u0026amp;n|n\u0026gt;=2))}}Trait å¯¹è±¡è¿˜å…è®¸æˆ‘ä»¬åœ¨é›†åˆä¸­å­˜å‚¨å¼‚æ„ç±»å‹ã€‚\nusestd::f64::consts::PI;struct Circle{radius: f64,}struct Square{side: f64 }traitShape{fn area(\u0026amp;self)-\u0026gt; f64;}implShapeforCircle{fn area(\u0026amp;self)-\u0026gt; f64 {PI*self.radius*self.radius}}implShapeforSquare{fn area(\u0026amp;self)-\u0026gt; f64 {self.side*self.side}}fn get_total_area(shapes: Vec\u0026lt;Box\u0026lt;dynShape\u0026gt;\u0026gt;)-\u0026gt; f64 {shapes.into_iter().map(|s|s.area()).sum()}fn example(){letshapes: Vec\u0026lt;Box\u0026lt;dynShape\u0026gt;\u0026gt;=vec![Box::new(Circle{radius: 1.0}),// Box\u0026lt;Circle\u0026gt; cast to Box\u0026lt;dyn Shape\u0026gt; Box::new(Square{side: 1.0}),// Box\u0026lt;Square\u0026gt; cast to Box\u0026lt;dyn Shape\u0026gt; ];assert_eq!(PI+1.0,get_total_area(shapes));// âœ… }Trait å¯¹è±¡æ˜¯ä¸ç¡®å®šå¤§å°çš„ï¼Œæ‰€ä»¥å®ƒä»¬å¿…é¡»æ€»æ˜¯åœ¨æŒ‡é’ˆåé¢ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®ç±»å‹ä¸­æ˜¯å¦å­˜åœ¨ dyn å…³é”®å­—æ¥åŒºåˆ†å…·ä½“ç±»å‹å’Œ trait å¯¹è±¡ã€‚\nstruct Struct;traitTrait{}// regular struct \u0026amp;StructBox\u0026lt;Struct\u0026gt;Rc\u0026lt;Struct\u0026gt;Arc\u0026lt;Struct\u0026gt;// trait objects \u0026amp;dynTraitBox\u0026lt;dynTrait\u0026gt;Rc\u0026lt;dynTrait\u0026gt;Arc\u0026lt;dynTrait\u0026gt;å¹¶éæ‰€æœ‰çš„ trait éƒ½å¯ä»¥è½¬æ¢ä¸º trait å¯¹è±¡ã€‚å¦‚æœä¸€ä¸ª trait æ»¡è¶³è¿™äº›è¦æ±‚ï¼Œå®ƒå°±æ˜¯å¯¹è±¡å®‰å…¨çš„ã€‚\n trait ä¸éœ€è¦ Self: Sizedã€‚ æ‰€æœ‰ trait çš„æ–¹æ³•éƒ½æ˜¯å¯¹è±¡å®‰å…¨çš„ã€‚  å¦‚æœ trait æ–¹æ³•æ»¡è¶³è¿™äº›è¦æ±‚ï¼Œå®ƒå°±æ˜¯å¯¹è±¡å®‰å…¨çš„ã€‚\n æ–¹æ³•éœ€è¦ Self: Sized æˆ– è¯¥æ–¹æ³•åªåœ¨æ¥æ”¶å™¨ä½ç½®ä½¿ç”¨ Self ç±»å‹ã€‚  ç†è§£ä¸ºä»€ä¹ˆè¦æ±‚æ˜¯è¿™æ ·çš„ï¼Œä¸æœ¬æ–‡å…¶ä»–éƒ¨åˆ†æ— å…³ï¼Œä½†å¦‚æœä½ ä»ç„¶å¥½å¥‡ï¼Œåœ¨ Sizedness in Rust ä¸­ä¼šæœ‰ä»‹ç»ã€‚\nMarker Traits æ ‡è®° trait æ˜¯æ²¡æœ‰ trait é¡¹çš„ traitã€‚å®ƒä»¬çš„å·¥ä½œæ˜¯å°†å®ç°ç±»å‹ â€œæ ‡è®°â€ ä¸ºå…·æœ‰æŸäº›å±æ€§ï¼Œå¦åˆ™ä¸å¯èƒ½ç”¨ç±»å‹ç³»ç»Ÿæ¥è¡¨ç¤ºã€‚\n// Impling PartialEq for a type promises // that equality for the type has these properties: // - symmetry: a == b implies b == a, and // - transitivity: a == b \u0026amp;\u0026amp; b == c implies a == c // But DOES NOT promise this property: // - reflexivity: a == a traitPartialEq{fn eq(\u0026amp;self,other: \u0026amp;Self)-\u0026gt; bool;}// Eq has no trait items! The eq method is already // declared by PartialEq, but \u0026#34;impling\u0026#34; Eq // for a type promises this additional equality property: // - reflexivity: a == a traitEq: PartialEq {}// f64 impls PartialEq but not Eq because NaN != NaN // i32 impls PartialEq \u0026amp; Eq because there\u0026#39;s no NaNs :) Auto Traits è‡ªåŠ¨ trait æ˜¯æŒ‡å¦‚æœä¸€ä¸ªç±»å‹çš„æ‰€æœ‰æˆå‘˜éƒ½å®ç°äº†è¿™ä¸ª traitï¼Œé‚£ä¹ˆè¿™ä¸ª trait å°±ä¼šè¢«è‡ªåŠ¨å®ç°ã€‚â€œæˆå‘˜â€ çš„å«ä¹‰å–å†³äºç±»å‹ï¼Œä¾‹å¦‚ï¼šç»“æ„ä½“çš„å­—æ®µã€æšä¸¾çš„å˜ä½“ã€æ•°ç»„çš„å…ƒç´ ã€å…ƒç»„çš„é¡¹ç­‰ç­‰ã€‚\næ‰€æœ‰çš„è‡ªåŠ¨ trait éƒ½æ˜¯æ ‡è®° traitï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„æ ‡è®° trait éƒ½æ˜¯è‡ªåŠ¨ traitã€‚è‡ªåŠ¨ trait å¿…é¡»æ˜¯æ ‡è®° traitï¼Œè¿™æ ·ç¼–è¯‘å™¨å°±å¯ä»¥ä¸ºå®ƒä»¬æä¾›ä¸€ä¸ªè‡ªåŠ¨çš„ç¼ºçœå®ç°ï¼Œå¦‚æœå®ƒä»¬æœ‰ä»»ä½• trait é¡¹ï¼Œé‚£å°±ä¸å¯èƒ½äº†ã€‚\nè‡ªåŠ¨ trait çš„ä¾‹å­ã€‚\n// implemented for types which are safe to send between threads unsafeautotraitSend{}// implemented for types whose references are safe to send between threads unsafeautotraitSync{}Unsafe Traits Trait å¯ä»¥è¢«æ ‡è®°ä¸ºä¸å®‰å…¨ï¼Œä»¥è¡¨æ˜å®ç°è¯¥ trait å¯èƒ½éœ€è¦ä¸å®‰å…¨çš„ä»£ç ã€‚Send å’Œ Sync éƒ½è¢«æ ‡è®°ä¸º unsafeï¼Œå› ä¸ºå¦‚æœå®ƒä»¬æ²¡æœ‰è¢«è‡ªåŠ¨å®ç°ï¼Œå°±æ„å‘³ç€å®ƒä¸€å®šåŒ…å«ä¸€äº›é Send æˆ–é Sync æˆå‘˜ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æ‰‹åŠ¨æ ‡è®°ç±»å‹ä¸º Send å’Œ Syncï¼Œæˆ‘ä»¬ä½œä¸ºå®ç°è€…å¿…é¡»æ ¼å¤–å°å¿ƒï¼Œä»¥ç¡®ä¿æ²¡æœ‰æ•°æ®ç«äº‰ã€‚\n// SomeType is not Send or Sync struct SomeType{not_send_or_sync: *const(),}// but if we\u0026#39;re confident that our impl doesn\u0026#39;t have any data // races we can explicitly mark it as Send and Sync using unsafe unsafeimplSendforSomeType{}unsafeimplSyncforSomeType{}Auto Traits Send \u0026amp; Sync é¢„å¤‡çŸ¥è¯†\n Marker Traits Auto Traits Unsafe Traits  unsafeautotraitSend{}unsafeautotraitSync{}å¦‚æœä¸€ä¸ªç±»å‹æ˜¯ Sendï¼Œæ„å‘³ç€åœ¨çº¿ç¨‹ä¹‹é—´å‘é€æ˜¯å®‰å…¨çš„ã€‚å¦‚æœä¸€ä¸ªç±»å‹æ˜¯ Syncï¼Œè¿™æ„å‘³ç€åœ¨çº¿ç¨‹ä¹‹é—´å…±äº«å®ƒçš„å¼•ç”¨æ˜¯å®‰å…¨çš„ã€‚æ›´å‡†ç¡®åœ°è¯´ï¼Œå¦‚æœä¸”ä»…å½“ \u0026amp;T æ˜¯ Send æ—¶ï¼Œä¸€äº›ç±»å‹ T æ˜¯ Syncã€‚\nå‡ ä¹æ‰€æœ‰ç±»å‹éƒ½æ˜¯ Send å’Œ Sync çš„ã€‚å”¯ä¸€å€¼å¾—æ³¨æ„çš„ Send å¼‚å¸¸æ˜¯ Rcï¼Œå”¯ä¸€å€¼å¾—æ³¨æ„çš„ Sync å¼‚å¸¸æ˜¯ Rcã€Cell å’Œ RefCellã€‚å¦‚æœæˆ‘ä»¬éœ€è¦ä¸€ä¸ª Rc çš„ Send ç‰ˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Arcã€‚å¦‚æœæˆ‘ä»¬éœ€è¦ Cell æˆ– RefCell çš„ Sync ç‰ˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ Mutex æˆ– RwLockã€‚è™½ç„¶å¦‚æœæˆ‘ä»¬ä½¿ç”¨ Mutex æˆ– RwLock åªæ˜¯åŒ…è£¹ä¸€ä¸ªåŸè¯­ç±»å‹ï¼Œé€šå¸¸æœ€å¥½ä½¿ç”¨æ ‡å‡†åº“æä¾›çš„åŸå­åŸè¯­ç±»å‹ï¼Œå¦‚ AtomicBoolã€AtomicI32ã€AtomicUsize ç­‰ã€‚\nå‡ ä¹æ‰€æœ‰çš„ç±»å‹éƒ½æ˜¯ Syncï¼Œè¿™å¯èƒ½ä¼šè®©ä¸€äº›äººæ„Ÿåˆ°æƒŠè®¶ï¼Œä½†æ˜¯æ˜¯çš„ï¼Œå³ä½¿å¯¹äºæ²¡æœ‰ä»»ä½•å†…éƒ¨åŒæ­¥çš„ç±»å‹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚è¿™è¦å½’åŠŸäº Rust ä¸¥æ ¼çš„å€Ÿç”¨è§„åˆ™ã€‚\næˆ‘ä»¬å¯ä»¥å°†åŒä¸€æ•°æ®çš„è®¸å¤šä¸å¯å˜çš„å¼•ç”¨ä¼ é€’ç»™è®¸å¤šçº¿ç¨‹ï¼Œè€Œä¸”æˆ‘ä»¬ä¿è¯ä¸ä¼šå‡ºç°æ•°æ®ç«äº‰ï¼Œå› ä¸ºåªè¦æœ‰ä»»ä½•ä¸å¯å˜çš„å¼•ç”¨å­˜åœ¨ï¼Œ Rust å°±ä¼šé™æ€åœ°ä¿è¯åº•å±‚æ•°æ®ä¸èƒ½è¢«ä¿®æ”¹ã€‚\nusecrossbeam::thread;fn main(){letmutgreeting=String::from(\u0026#34;Hello\u0026#34;);letgreeting_ref=\u0026amp;greeting;thread::scope(|scoped_thread|{// spawn 3 threads fornin1..=3{// greeting_ref copied into every thread scoped_thread.spawn(move|_|{println!(\u0026#34;{} {}\u0026#34;,greeting_ref,n);// prints \u0026#34;Hello {n}\u0026#34; });}// line below could cause UB or data races but compiler rejects it greeting+=\u0026#34; world\u0026#34;;// âŒ cannot mutate greeting while immutable refs exist });// can mutate greeting after every thread has joined greeting+=\u0026#34; world\u0026#34;;// âœ… println!(\u0026#34;{}\u0026#34;,greeting);// prints \u0026#34;Hello world\u0026#34; }åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥å°†å•ä¸ªå¯å˜å¼•ç”¨ä¼ é€’ç»™ä¸€äº›æ•°æ®åˆ°ä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ä¿è¯ä¸ä¼šå‡ºç°æ•°æ®ç«äº‰ï¼Œå› ä¸º Rust é™æ€åœ°ä¿è¯äº†åˆ«åçš„å¯å˜å¼•ç”¨ä¸èƒ½å­˜åœ¨ï¼Œåº•å±‚æ•°æ®ä¸èƒ½é€šè¿‡ç°æœ‰çš„å•ä¸ªå¯å˜å¼•ç”¨ä»¥å¤–çš„ä»»ä½•ä¸œè¥¿è¿›è¡Œä¿®æ”¹ã€‚\nusecrossbeam::thread;fn main(){letmutgreeting=String::from(\u0026#34;Hello\u0026#34;);letgreeting_ref=\u0026amp;mutgreeting;thread::scope(|scoped_thread|{// greeting_ref moved into thread scoped_thread.spawn(move|_|{*greeting_ref+=\u0026#34; world\u0026#34;;println!(\u0026#34;{}\u0026#34;,greeting_ref);// prints \u0026#34;Hello world\u0026#34; });// line below could cause UB or data races but compiler rejects it greeting+=\u0026#34;!!!\u0026#34;;// âŒ cannot mutate greeting while mutable refs exist });// can mutate greeting after the thread has joined greeting+=\u0026#34;!!!\u0026#34;;// âœ… println!(\u0026#34;{}\u0026#34;,greeting);// prints \u0026#34;Hello world!!!\u0026#34; }è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¤§å¤šæ•°ç±»å‹éƒ½æ˜¯ Sync è€Œä¸éœ€è¦ä»»ä½•æ˜¾å¼åŒæ­¥ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨å¤šä¸ªçº¿ç¨‹ä¸­åŒæ—¶ä¿®æ”¹ä¸€äº›æ•°æ® Tï¼Œç¼–è¯‘å™¨ä¸ä¼šè®©æˆ‘ä»¬è¿™æ ·åšï¼Œç›´åˆ°æˆ‘ä»¬å°†æ•°æ®åŒ…è£¹åœ¨ Arc\u0026lt;Mutex\u0026lt;T\u0026gt;\u0026gt; æˆ– Arc\u0026lt;RwLock\u0026lt;T\u0026gt;\u0026gt; ä¸­ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨å¼ºåˆ¶è¦æ±‚åœ¨éœ€è¦æ—¶ä½¿ç”¨æ˜¾å¼åŒæ­¥ã€‚\nSized é¢„å¤‡çŸ¥è¯†\n Marker Traits Auto Traits  å¦‚æœä¸€ä¸ªç±»å‹æ˜¯ Sized çš„ï¼Œè¿™æ„å‘³ç€å®ƒçš„å­—èŠ‚å¤§å°åœ¨ç¼–è¯‘æ—¶æ˜¯å·²çŸ¥çš„ï¼Œå¹¶ä¸”å¯ä»¥å°†è¯¥ç±»å‹çš„å®ä¾‹æ”¾åœ¨æ ˆä¸Šã€‚\nç±»å‹çš„å¤§å°å’Œå®ƒçš„å«ä¹‰æ˜¯ä¸€ä¸ªå¾®å¦™è€Œåˆå·¨å¤§çš„è¯é¢˜ï¼Œå®ƒå½±å“åˆ°è¯­è¨€çš„å¾ˆå¤šä¸åŒæ–¹é¢ã€‚å®ƒæ˜¯å¦‚æ­¤é‡è¦ï¼Œä»¥è‡³äºæˆ‘å†™äº†æ•´æ•´ä¸€ç¯‡æ–‡ç« ï¼Œå«åš Sizedness in Rustï¼Œæˆ‘å¼ºçƒˆæ¨èä»»ä½•æƒ³æ·±å…¥äº†è§£ç±»å‹å¤§å°çš„äººé˜…è¯»ã€‚æˆ‘æ€»ç»“ä¸€ä¸‹ä¸æœ¬æ–‡ç›¸å…³çš„å‡ ä¸ªå…³é”®å†…å®¹ã€‚\n æ‰€æœ‰çš„æ³›å‹ç±»å‹éƒ½ä¼šå¾—åˆ°ä¸€ä¸ªéšå¼çš„ Sized çº¦æŸã€‚  fn func\u0026lt;T\u0026gt;(t: \u0026amp;T){}// example above desugared fn func\u0026lt;T: Sized\u0026gt;(t: \u0026amp;T){}ç”±äºæ‰€æœ‰æ³›å‹ç±»å‹éƒ½æœ‰ä¸€ä¸ªéšå¼çš„ Sized çº¦æŸï¼Œå¦‚æœæˆ‘ä»¬æƒ³é€€å‡ºè¿™ä¸ªéšå¼çº¦æŸï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ç‰¹æ®Šçš„ \u0026ldquo;æ”¾å®½çº¦æŸ\u0026rdquo; è¯­æ³• ?Sizedï¼Œå®ƒç›®å‰åªå­˜åœ¨äº Sized traitã€‚  // now T can be unsized fn func\u0026lt;T: ?Sized\u0026gt;(t: \u0026amp;T){}æ‰€æœ‰çš„ trait éƒ½æœ‰ä¸€ä¸ªéšå¼çš„ ?Sized çº¦æŸã€‚  traitTrait{}// example above desugared traitTrait: ?Sized{}è¿™æ˜¯ä¸ºäº†è®© trait å¯¹è±¡å¯ä»¥å®ç° traitã€‚åŒæ ·ï¼Œæ‰€æœ‰çš„çç¢ç»†èŠ‚éƒ½åœ¨ Sizedness in Rust ä¸­ã€‚\nGeneral traits Default é¢„å¤‡çŸ¥è¯†\n Self Functions Derive Macros  traitDefault{fn default()-\u0026gt; Self;}å¯ä»¥æ„å»º Default ç±»å‹çš„é»˜è®¤å€¼ã€‚\nstruct Color{r: u8,g: u8,b: u8,}implDefaultforColor{// default color is black fn default()-\u0026gt; Self{Color{r: 0,g: 0,b: 0,}}}è¿™å¯¹å¿«é€Ÿå»ºç«‹åŸå‹å¾ˆæœ‰ç”¨ï¼Œä½†åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªç±»å‹çš„å®ä¾‹ï¼Œè€Œä¸”å¯¹å®ƒæ˜¯ä»€ä¹ˆå¹¶ä¸æŒ‘å‰”ã€‚\nfn main(){// just give me some color! letcolor=Color::default();}è¿™ä¹Ÿæ˜¯ä¸€ä¸ªæˆ‘ä»¬å¯èƒ½æƒ³æ˜ç¡®åœ°æš´éœ²ç»™æˆ‘ä»¬çš„å‡½æ•°ç”¨æˆ·çš„é€‰é¡¹ã€‚\nstruct Canvas;enum Shape{Circle,Rectangle,}implCanvas{// let user optionally pass a color fn paint(\u0026amp;mutself,shape: Shape,color: Option\u0026lt;Color\u0026gt;){// if no color is passed use the default color letcolor=color.unwrap_or_default();// etc }}Default åœ¨æˆ‘ä»¬éœ€è¦æ„é€ æ³›å‹ç±»å‹çš„æ³›å‹è¯­å¢ƒä¸­ä¹Ÿå¾ˆæœ‰ç”¨ã€‚\nfn guarantee_length\u0026lt;T: Default\u0026gt;(mutvec: Vec\u0026lt;T\u0026gt;,min_len: usize)-\u0026gt; Vec\u0026lt;T\u0026gt;{for_in0..min_len.saturating_sub(vec.len()){vec.push(T::default());}vec}æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Default ç±»å‹çš„å¦ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨ Rust çš„ç»“æ„ä½“æ›´æ–°è¯­æ³•å¯¹ç»“æ„ä½“è¿›è¡Œéƒ¨åˆ†åˆå§‹åŒ–ã€‚æˆ‘ä»¬å¯ä»¥ä¸º Color è®¾ç½®ä¸€ä¸ª new æ„é€ å‡½æ•°ï¼Œå°†æ¯ä¸ªæˆå‘˜ä½œä¸ºä¸€ä¸ªå‚æ•°ã€‚\nimplColor{fn new(r: u8,g: u8,b: u8)-\u0026gt; Self{Color{r,g,b,}}}ç„¶è€Œï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨æ–¹ä¾¿çš„æ„é€ å‡½æ•°ï¼Œæ¯ä¸ªæ„é€ å‡½æ•°åªæ¥å—ä¸€ä¸ªç‰¹å®šçš„ç»“æ„ä½“æˆå‘˜ï¼Œå…¶ä»–ç»“æ„ä½“æˆå‘˜åˆ™ä½¿ç”¨é»˜è®¤å€¼ã€‚\nimplColor{fn red(r: u8)-\u0026gt; Self{Color{r,..Color::default()}}fn green(g: u8)-\u0026gt; Self{Color{g,..Color::default()}}fn blue(b: u8)-\u0026gt; Self{Color{b,..Color::default()}}}è¿˜æœ‰ä¸€ä¸ª Default çš„æ´¾ç”Ÿå®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·ç¼–å†™ Colorã€‚\n// default color is still black // because u8::default() == 0 #[derive(Default)]struct Color{r: u8,g: u8,b: u8 }Clone é¢„å¤‡çŸ¥è¯†\n Self Methods Default Impls Derive Macros  traitClone{fn clone(\u0026amp;self)-\u0026gt; Self;// provided default impls fn clone_from(\u0026amp;mutself,source: \u0026amp;Self);}æˆ‘ä»¬å¯ä»¥å°† Clone ç±»å‹çš„ä¸å¯å˜å¼•ç”¨è½¬æ¢ä¸ºè‡ªæœ‰å€¼(owned values)ï¼Œå³ \u0026amp;T -\u0026gt; Tã€‚Clone æ²¡æœ‰å¯¹è¿™ç§è½¬æ¢çš„æ•ˆç‡åšå‡ºæ‰¿è¯ºï¼Œæ‰€ä»¥å®ƒå¯èƒ½æ˜¯ç¼“æ…¢å’Œæ˜‚è´µçš„ã€‚ä¸ºäº†å¿«é€Ÿåœ°åœ¨ä¸€ä¸ªç±»å‹ä¸Šå®ç° Cloneï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ´¾ç”Ÿå®ã€‚\n#[derive(Clone)]struct SomeType{cloneable_member1: CloneableType1,cloneable_member2: CloneableType2,// etc }// macro generates impl below implCloneforSomeType{fn clone(\u0026amp;self)-\u0026gt; Self{SomeType{cloneable_member1: self.cloneable_member1.clone(),cloneable_member2: self.cloneable_member2.clone(),// etc }}}Clone ä¹Ÿå¯ä»¥åœ¨æ³›å‹ä¸Šä¸‹æ–‡ä¸­æ„å»ºä¸€ä¸ªç±»å‹çš„å®ä¾‹ã€‚ä¸‹é¢æ˜¯ä¸Šä¸€èŠ‚ä¸­çš„ä¸€ä¸ªä¾‹å­ï¼Œé™¤äº†ä½¿ç”¨ Clone è€Œä¸æ˜¯ Defaultã€‚\nfn guarantee_length\u0026lt;T: Clone\u0026gt;(mutvec: Vec\u0026lt;T\u0026gt;,min_len: usize,fill_with: \u0026amp;T)-\u0026gt; Vec\u0026lt;T\u0026gt;{for_in0..min_len.saturating_sub(vec.len()){vec.push(fill_with.clone());}vec}äººä»¬ä¹Ÿç»å¸¸ä½¿ç”¨å…‹éš†ä½œä¸ºé€ƒé¿çš„æ–¹æ³•ï¼Œä»¥é¿å…ä¸å€Ÿç”¨æ£€æŸ¥å™¨æ‰“äº¤é“ã€‚ç®¡ç†å¸¦æœ‰å¼•ç”¨çš„ç»“æ„ä½“å¯èƒ½å¾ˆæœ‰æŒ‘æˆ˜æ€§ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡å…‹éš†å°†å¼•ç”¨å˜æˆè‡ªæœ‰å€¼(owned values)ã€‚\n// oof, we gotta worry about lifetimes ğŸ˜Ÿ struct SomeStruct\u0026lt;\u0026#39;a\u0026gt;{data: \u0026amp;\u0026#39;aVec\u0026lt;u8\u0026gt;,}// now we\u0026#39;re on easy street ğŸ˜ struct SomeStruct{data: Vec\u0026lt;u8\u0026gt;,}å¦‚æœæˆ‘ä»¬æ­£åœ¨å¼€å‘çš„ç¨‹åºçš„æ€§èƒ½ä¸æ˜¯æœ€é‡è¦çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸éœ€è¦ä¸ºå…‹éš†æ•°æ®è€Œçƒ¦æ¼ã€‚Rust æ˜¯ä¸€ç§ä½çº§åˆ«çš„è¯­è¨€ï¼Œæš´éœ²äº†å¾ˆå¤šä½çº§åˆ«çš„ç»†èŠ‚ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“è¢«è¿‡æ—©çš„ä¼˜åŒ–æ‰€å¸å¼•ï¼Œè€Œä¸æ˜¯çœŸæ­£è§£å†³æ‰‹å¤´çš„é—®é¢˜ã€‚å¯¹äºè®¸å¤šç¨‹åºæ¥è¯´ï¼Œæœ€å¥½çš„ä¼˜å…ˆé¡ºåºé€šå¸¸æ˜¯é¦–å…ˆå»ºç«‹æ­£ç¡®æ€§ï¼Œå…¶æ¬¡æ˜¯ä¼˜é›…æ€§ï¼Œç¬¬ä¸‰æ˜¯æ€§èƒ½ï¼Œåªæœ‰åœ¨å¯¹ç¨‹åºè¿›è¡Œå‰–æå¹¶ç¡®å®šäº†æ€§èƒ½ç“¶é¢ˆä¹‹åæ‰å…³æ³¨æ€§èƒ½ã€‚è¿™æ˜¯å¾ˆå¥½çš„ä¸€èˆ¬æ€§å»ºè®®ï¼Œå¦‚æœå®ƒä¸é€‚ç”¨äºä½ çš„ç‰¹å®šç¨‹åºï¼Œä½ å°±ä¼šçŸ¥é“ã€‚\nCopy é¢„å¤‡çŸ¥è¯†\n Marker Traits Subtraits \u0026amp; Supertraits Derive Macros  traitCopy: Clone {}æˆ‘ä»¬å¤åˆ¶ Copy ç±»å‹ï¼Œä¾‹å¦‚ï¼šT -\u0026gt; Tã€‚Copy æ‰¿è¯ºå¤åˆ¶æ“ä½œå°†æ˜¯ä¸€ä¸ªç®€å•çš„æŒ‰ä½(bitwise)æ‹·è´ï¼Œæ‰€ä»¥å®ƒå°†æ˜¯éå¸¸å¿«é€Ÿå’Œé«˜æ•ˆçš„ã€‚æˆ‘ä»¬ä¸èƒ½è‡ªå·±å®ç° Copyï¼Œåªæœ‰ç¼–è¯‘å™¨å¯ä»¥æä¾›ä¸€ä¸ªå®ç°ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ Copy æ´¾ç”Ÿå®ï¼Œä»¥åŠ Clone æ´¾ç”Ÿå®æ¥å‘Šè¯‰ç¼–è¯‘å™¨è¿™æ ·åšï¼Œå› ä¸º Copy æ˜¯ Clone çš„ä¸€ä¸ªå­ traitã€‚\n#[derive(Copy, Clone)]struct SomeType;Copy å®Œå–„äº†(refine) Cloneã€‚Clone å¯èƒ½æ˜¯ç¼“æ…¢å’Œæ˜‚è´µçš„ï¼Œä½† Copy ä¿è¯æ˜¯å¿«é€Ÿå’Œä¾¿å®œçš„ï¼Œæ‰€ä»¥ Copy åªæ˜¯ä¸€ä¸ªå¿«é€Ÿ Cloneã€‚å¦‚æœä¸€ä¸ªç±»å‹å®ç°äº† Copyï¼Œè¿™å°±ä½¿å¾— Clone çš„å®ç°å˜å¾—å¾®ä¸è¶³é“äº†ã€‚\n// this is what the derive macro generates impl\u0026lt;T: Copy\u0026gt;CloneforT{// the clone method becomes just a copy fn clone(\u0026amp;self)-\u0026gt; Self{*self}}å½“ä¸€ä¸ªç±»å‹è¢«ç§»åŠ¨æ—¶ï¼Œå®ç°è¯¥ç±»å‹çš„ Copy ä¼šæ”¹å˜å…¶è¡Œä¸ºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç±»å‹éƒ½æœ‰â€œç§»åŠ¨è¯­ä¹‰â€ï¼Œä½†æ˜¯ä¸€æ—¦ä¸€ä¸ªç±»å‹å®ç°äº† `Copy'ï¼Œå®ƒå°±ä¼šå¾—åˆ°â€œå¤åˆ¶è¯­ä¹‰â€ã€‚ä¸ºäº†è§£é‡Šè¿™ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™äº›ç®€å•çš„åœºæ™¯ã€‚\n// a \u0026#34;move\u0026#34;, src: !Copy letdest=src;// a \u0026#34;copy\u0026#34;, src: Copy letdest=src;åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œdest = src å¯¹ src çš„å†…å®¹è¿›è¡Œç®€å•çš„æŒ‰ä½å¤åˆ¶ï¼Œå¹¶å°†ç»“æœç§»åŠ¨åˆ° dest ä¸­ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œåœ¨â€œç§»åŠ¨â€çš„æƒ…å†µä¸‹ï¼Œå€Ÿç”¨æ£€æŸ¥å™¨ä½¿ src å˜é‡æ— æ•ˆï¼Œå¹¶ç¡®ä¿å®ƒä»¥åä¸ä¼šè¢«ç”¨äºå…¶ä»–åœ°æ–¹ï¼Œè€Œåœ¨â€œå¤åˆ¶â€çš„æƒ…å†µä¸‹ï¼Œsrc ä»ç„¶æœ‰æ•ˆå¹¶å¯ä½¿ç”¨ã€‚\nä¸€è¨€ä»¥è”½ä¹‹ã€‚æ‹·è´å°±â€œæ˜¯â€ç§»åŠ¨ã€‚ç§»åŠ¨å°±â€œæ˜¯â€æ‹·è´ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯å€Ÿç”¨æ£€æŸ¥å™¨å¯¹å®ƒä»¬çš„å¤„ç†æ–¹å¼ã€‚\nå…³äºç§»åŠ¨çš„ä¸€ä¸ªæ›´å…·ä½“çš„ä¾‹å­ï¼Œå‡è®¾ src æ˜¯ä¸€ä¸ª Vec\u0026lt;i32\u0026gt;ï¼Œå…¶å†…å®¹æ˜¯è¿™æ ·çš„ã€‚\n{data: *mut[i32],length: usize,capacity: usize }å½“æˆ‘ä»¬å†™ä¸‹ dest = src æ—¶ï¼Œæˆ‘ä»¬çš„ç»“æœæ˜¯ï¼š\nsrc={data: *mut[i32],length: usize,capacity: usize }dest={data: *mut[i32],length: usize,capacity: usize }è¿™ä¸ªæ—¶å€™ï¼Œsrc å’Œ dest éƒ½æœ‰å¯¹ç›¸åŒæ•°æ®çš„åˆ«åå¯å˜å¼•ç”¨ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤§å¿Œï¼Œæ‰€ä»¥å€Ÿç”¨æ£€æŸ¥å™¨ä½¿ src å˜é‡æ— æ•ˆï¼Œè¿™æ ·å®ƒå°±ä¸èƒ½å†è¢«ä½¿ç”¨è€Œä¸ä¼šäº§ç”Ÿç¼–è¯‘é”™è¯¯ã€‚\nå¯¹äºä¸€ä¸ªæ›´å…·ä½“çš„æ‹·è´ä¾‹å­ï¼Œå‡è®¾ src æ˜¯ä¸€ä¸ª Option\u0026lt;i32\u0026gt;ï¼Œå®ƒçš„å†…å®¹æ˜¯è¿™æ ·çš„ï¼š\n{is_valid: bool,data: i32 }ç°åœ¨ï¼Œå½“æˆ‘ä»¬å†™ä¸‹ dest = src æ—¶ï¼Œæˆ‘ä»¬çš„ç»“æœæ˜¯ï¼š\nsrc={is_valid: bool,data: i32 }dest={is_valid: bool,data: i32 }è¿™äº›éƒ½æ˜¯å¯ä»¥åŒæ—¶ä½¿ç”¨çš„! å› æ­¤ Option\u0026lt;i32\u0026gt; æ˜¯å¯ä»¥ Copy çš„ã€‚\nè™½ç„¶ Copy å¯ä»¥æ˜¯ä¸€ä¸ªè‡ªåŠ¨ traitï¼Œä½† Rust è¯­è¨€çš„è®¾è®¡è€…å†³å®šè®©ç±»å‹æ˜¾å¼åœ°é€‰æ‹©å¤åˆ¶è¯­ä¹‰ï¼Œè€Œä¸æ˜¯åœ¨ç±»å‹ç¬¦åˆæ¡ä»¶æ—¶é»˜é»˜åœ°ç»§æ‰¿å¤åˆ¶è¯­ä¹‰ï¼Œå› ä¸ºåè€…ä¼šå¯¼è‡´ä»¤äººæƒŠè®¶çš„æ··ä¹±è¡Œä¸ºï¼Œç»å¸¸å¯¼è‡´é”™è¯¯ã€‚\nAny é¢„å¤‡çŸ¥è¯†\n Self Generic Blanket Impls Subtraits \u0026amp; Supertraits Trait Objects  traitAny: \u0026#39;static{fn type_id(\u0026amp;self)-\u0026gt; TypeId;}Rust çš„å¤šæ€æ€§é£æ ¼æ˜¯å‚æ•°åŒ–çš„ï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨ç±»ä¼¼äºåŠ¨æ€ç±»å‹è¯­è¨€çš„å¤šæ€æ€§é£æ ¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Any trait æ¥æ¨¡ä»¿ã€‚æˆ‘ä»¬ä¸éœ€è¦ä¸ºæˆ‘ä»¬çš„ç±»å‹æ‰‹åŠ¨å®ç°è¿™ä¸ª traitï¼Œå› ä¸ºä¸‹é¢è¿™ä¸ªæ³›å‹è¦†ç›–å®ç°å·²ç»è¦†ç›–äº†ã€‚\nimpl\u0026lt;T: \u0026#39;static+?Sized\u0026gt;AnyforT{fn type_id(\u0026amp;self)-\u0026gt; TypeId{TypeId::of::\u0026lt;T\u0026gt;()}}æˆ‘ä»¬ä» dyn Any ä¸­å¾—åˆ° T çš„æ–¹æ³•æ˜¯é€šè¿‡ä½¿ç”¨ downcast_ref::\u0026lt;T\u0026gt;() å’Œ downcast_mut::\u0026lt;T\u0026gt;() æ–¹æ³•ã€‚\nusestd::any::Any;#[derive(Default)]struct Point{x: i32,y: i32,}implPoint{fn inc(\u0026amp;mutself){self.x+=1;self.y+=1;}}fn map_any(mutany: Box\u0026lt;dynAny\u0026gt;)-\u0026gt; Box\u0026lt;dynAny\u0026gt;{ifletSome(num)=any.downcast_mut::\u0026lt;i32\u0026gt;(){*num+=1;}elseifletSome(string)=any.downcast_mut::\u0026lt;String\u0026gt;(){*string+=\u0026#34;!\u0026#34;;}elseifletSome(point)=any.downcast_mut::\u0026lt;Point\u0026gt;(){point.inc();}any}fn main(){letmutvec: Vec\u0026lt;Box\u0026lt;dynAny\u0026gt;\u0026gt;=vec![Box::new(0),Box::new(String::from(\u0026#34;a\u0026#34;)),Box::new(Point::default()),];// vec = [0, \u0026#34;a\u0026#34;, Point { x: 0, y: 0 }] vec=vec.into_iter().map(map_any).collect();// vec = [1, \u0026#34;a!\u0026#34;, Point { x: 1, y: 1 }] }è¿™ä¸ª trait å¾ˆå°‘éœ€è¦ä½¿ç”¨ï¼Œå› ä¸ºåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå‚æ•°åŒ–å¤šæ€æ€§è¦ä¼˜äºä¸´æ—¶å¤šæ€æ€§ï¼Œåè€…ä¹Ÿå¯ä»¥ç”¨æšä¸¾æ¥æ¨¡æ‹Ÿï¼Œå› ä¸ºæšä¸¾çš„ç±»å‹æ›´å®‰å…¨ï¼Œéœ€è¦çš„è¿‚å›æ›´å°‘ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸Šé¢çš„ä¾‹å­å†™æˆè¿™æ ·ã€‚\n#[derive(Default)]struct Point{x: i32,y: i32,}implPoint{fn inc(\u0026amp;mutself){self.x+=1;self.y+=1;}}enum Stuff{Integer(i32),String(String),Point(Point),}fn map_stuff(mutstuff: Stuff)-\u0026gt; Stuff{match\u0026amp;mutstuff{Stuff::Integer(num)=\u0026gt;*num+=1,Stuff::String(string)=\u0026gt;*string+=\u0026#34;!\u0026#34;,Stuff::Point(point)=\u0026gt;point.inc(),}stuff}fn main(){letmutvec=vec![Stuff::Integer(0),Stuff::String(String::from(\u0026#34;a\u0026#34;)),Stuff::Point(Point::default()),];// vec = [0, \u0026#34;a\u0026#34;, Point { x: 0, y: 0 }] vec=vec.into_iter().map(map_stuff).collect();// vec = [1, \u0026#34;a!\u0026#34;, Point { x: 1, y: 1 }] }å°½ç®¡ Any å¾ˆå°‘è¢«éœ€è¦ï¼Œä½†æœ‰æ—¶ä½¿ç”¨èµ·æ¥è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œæˆ‘ä»¬å°†åœ¨åé¢çš„â€œé”™è¯¯å¤„ç†â€éƒ¨åˆ†çœ‹åˆ°ã€‚\nFormatting Traits æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ std::fmt ä¸­çš„æ ¼å¼åŒ–å®å°†ç±»å‹åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œå…¶ä¸­æœ€è‘—åçš„æ˜¯ println!ã€‚æˆ‘ä»¬å¯ä»¥å°†æ ¼å¼åŒ–å‚æ•°ä¼ é€’ç»™æ ¼å¼ str ä¸­ä½¿ç”¨çš„ {} å ä½ç¬¦ï¼Œç„¶åç”¨æ¥é€‰æ‹©ä½¿ç”¨å“ªä¸ª trait å®ç°æ¥åºåˆ—åŒ–å ä½ç¬¦çš„å‚æ•°ã€‚\n   Trait Placeholder Description     Display {} display representation   Debug {:?} debug representation   Octal {:o} octal representation   LowerHex {:x} lowercase hex representation   UpperHex {:X} uppercase hex representation   Pointer {:p} memory address   Binary {:b} binary representation   LowerExp {:e} lowercase exponential representation   UpperExp {:E} uppercase exponential representation    Display \u0026amp; ToString é¢„å¤‡çŸ¥è¯†\n Self Methods Generic Blanket Impls  traitDisplay{fn fmt(\u0026amp;self,f: \u0026amp;mutFormatter\u0026lt;\u0026#39;_\u0026gt;)-\u0026gt; Result;}Display ç±»å‹å¯ä»¥è¢«åºåˆ—åŒ–ä¸º Stringï¼Œè¿™å¯¹ç¨‹åºçš„ç»ˆç«¯ç”¨æˆ·å¾ˆå‹å¥½ã€‚ä¾‹å¦‚ï¼Œç»™ Point å®ç° Display:\nusestd::fmt;#[derive(Default)]struct Point{x: i32,y: i32,}implfmt::DisplayforPoint{fn fmt(\u0026amp;self,f: \u0026amp;mutfmt::Formatter\u0026lt;\u0026#39;_\u0026gt;)-\u0026gt; fmt::Result{write!(f,\u0026#34;({}, {})\u0026#34;,self.x,self.y)}}fn main(){println!(\u0026#34;origin: {}\u0026#34;,Point::default());// prints \u0026#34;origin: (0, 0)\u0026#34; // get Point\u0026#39;s Display representation as a String letstringified_point=format!(\u0026#34;{}\u0026#34;,Point::default());assert_eq!(\u0026#34;(0, 0)\u0026#34;,stringified_point);// âœ… }é™¤äº†ä½¿ç”¨ format! å®æ¥è·å¾—ä¸€ä¸ªç±»å‹çš„æ˜¾ç¤ºè¡¨ç¤ºä¸º String ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ ToString traitã€‚\ntraitToString{fn to_string(\u0026amp;self)-\u0026gt; String;}æˆ‘ä»¬æ²¡æœ‰å¿…è¦è‡ªå·±å»å®ç°è¿™ä¸ª traitã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬ä¸èƒ½è¿™æ ·åšï¼Œå› ä¸ºä¸‹é¢è¿™ä¸ªæ³›å‹è¦†ç›–å®ç°ï¼Œå¯¹äºä»»ä½•å®ç° Display çš„ç±»å‹ï¼Œéƒ½è‡ªåŠ¨å®ç° ToStringã€‚\nimpl\u0026lt;T: Display+?Sized\u0026gt;ToStringforT;å°† ToString ä¸ Point ä¸€èµ·ä½¿ç”¨ã€‚\n#[test]// âœ… fn display_point(){letorigin=Point::default();assert_eq!(format!(\u0026#34;{}\u0026#34;,origin),\u0026#34;(0, 0)\u0026#34;);}#[test]// âœ… fn point_to_string(){letorigin=Point::default();assert_eq!(origin.to_string(),\u0026#34;(0, 0)\u0026#34;);}#[test]// âœ… fn display_equals_to_string(){letorigin=Point::default();assert_eq!(format!(\u0026#34;{}\u0026#34;,origin),origin.to_string());}Debug é¢„å¤‡çŸ¥è¯†\n Self Methods Derive Macros Display \u0026amp; ToString  traitDebug{fn fmt(\u0026amp;self,f: \u0026amp;mutFormatter\u0026lt;\u0026#39;_\u0026gt;)-\u0026gt; Result;}Debug ä¸ Display æœ‰ç›¸åŒçš„ç­¾åã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ {:?} æ ¼å¼ç¬¦æ—¶ï¼ŒDebug å®ç°è¢«è°ƒç”¨ã€‚`Debug' å¯ä»¥è¢«æ´¾ç”Ÿã€‚\nusestd::fmt;#[derive(Debug)]struct Point{x: i32,y: i32,}// derive macro generates impl below implfmt::DebugforPoint{fn fmt(\u0026amp;self,f: \u0026amp;mutfmt::Formatter\u0026lt;\u0026#39;_\u0026gt;)-\u0026gt; fmt::Result{f.debug_struct(\u0026#34;Point\u0026#34;).field(\u0026#34;x\u0026#34;,\u0026amp;self.x).field(\u0026#34;y\u0026#34;,\u0026amp;self.y).finish()}}ä¸ºä¸€ä¸ªç±»å‹å®ç° Debug ä¹Ÿå…è®¸å®ƒåœ¨ dbg! å®ä¸­ä½¿ç”¨ï¼Œè¿™æ¯” println! æ›´æœ‰åˆ©äºä¸´æ—¶åº”æ€¥çš„æ‰“å°æ—¥å¿—ã€‚å®ƒçš„ä¸€äº›ä¼˜ç‚¹å¦‚ä¸‹:\n dbg! æ‰“å°åˆ° stderr è€Œä¸æ˜¯ stdoutï¼Œæ‰€ä»¥è°ƒè¯•æ—¥å¿—å¾ˆå®¹æ˜“ä¸æˆ‘ä»¬ç¨‹åºçš„å®é™… stdout è¾“å‡ºåˆ†å¼€ã€‚ dbg! æ‰“å°ä¼ é€’ç»™å®ƒçš„è¡¨è¾¾å¼ï¼Œä»¥åŠè¡¨è¾¾å¼æ‰€è¯„ä¼°çš„å€¼ã€‚ dbg! æ‹¥æœ‰å…¶å‚æ•°çš„æ‰€æœ‰æƒï¼Œå¹¶è¿”å›è¿™äº›å‚æ•°ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨å®ƒã€‚  fn some_condition()-\u0026gt; bool {true}// no logging fn example(){ifsome_condition(){// some code }}// println! logging fn example_println(){// ğŸ¤¦ letresult=some_condition();println!(\u0026#34;{}\u0026#34;,result);// just prints \u0026#34;true\u0026#34; ifresult{// some code }}// dbg! logging fn example_dbg(){// ğŸ˜ ifdbg!(some_condition()){// prints \u0026#34;[src/main.rs:22] some_condition() = true\u0026#34; // some code }}å”¯ä¸€çš„ç¼ºç‚¹æ˜¯ï¼Œdbg! åœ¨å‘å¸ƒç‰ˆæœ¬ä¸­ä¸ä¼šè¢«è‡ªåŠ¨å‰¥ç¦»ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬ä¸æƒ³åœ¨æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ä½¿ç”¨å®ƒï¼Œå°±å¿…é¡»ä»æˆ‘ä»¬çš„ä»£ç ä¸­æ‰‹åŠ¨åˆ é™¤å®ƒã€‚\nOperator Traits Rust ä¸­çš„æ‰€æœ‰è¿ç®—ç¬¦éƒ½ä¸ trait ç›¸å…³ã€‚å¦‚æœæˆ‘ä»¬æƒ³ä¸ºæˆ‘ä»¬çš„ç±»å‹å®ç°è¿ç®—ç¬¦ï¼Œå°±å¿…é¡»å®ç°ç›¸å…³çš„ traitã€‚\n   Trait(s) Category Operator(s) Description     Eq, PartialEq comparison == equality   Ord, PartialOrd comparison \u0026lt;, \u0026gt;, \u0026lt;=, \u0026gt;= comparison   Add arithmetic + addition   AddAssign arithmetic += addition assignment   BitAnd arithmetic \u0026amp; bitwise AND   BitAndAssign arithmetic \u0026amp;= bitwise assignment   BitXor arithmetic ^ bitwise XOR   BitXorAssign arithmetic ^= bitwise XOR assignment   Div arithmetic / division   DivAssign arithmetic /= division assignment   Mul arithmetic * multiplication   MulAssign arithmetic *= multiplication assignment   Neg arithmetic - unary negation   Not arithmetic ! unary logical negation   Rem arithmetic % remainder   RemAssign arithmetic %= remainder assignment   Shl arithmetic \u0026lt;\u0026lt; left shift   ShlAssign arithmetic \u0026lt;\u0026lt;= left shift assignment   Shr arithmetic \u0026gt;\u0026gt; right shift   ShrAssign arithmetic \u0026gt;\u0026gt;= right shift assignment   Sub arithmetic - subtraction   SubAssign arithmetic -= subtraction assignment   Fn closure (...args) immutable closure invocation   FnMut closure (...args) mutable closure invocation   FnOnce closure (...args) one-time closure invocation   Deref other * immutable dereference   DerefMut other * mutable derenence   Drop other - type destructor   Index other [] immutable index   IndexMut other [] mutable index   RangeBounds other .. range    Comparison Traits    Trait(s) Category Operator(s) Description     Eq, PartialEq comparison == equality   Ord, PartialOrd comparison \u0026lt;, \u0026gt;, \u0026lt;=, \u0026gt;= comparison    PartialEq \u0026amp; Eq é¢„å¤‡çŸ¥è¯†\n Self Methods Generic Parameters Default Impls Generic Blanket Impls Marker Traits Subtraits \u0026amp; Supertraits Sized  traitPartialEq\u0026lt;Rhs=Self\u0026gt;whereRhs: ?Sized,{fn eq(\u0026amp;self,other: \u0026amp;Rhs)-\u0026gt; bool;// provided default impls fn ne(\u0026amp;self,other: \u0026amp;Rhs)-\u0026gt; bool;}PartialEq\u0026lt;Rhs\u0026gt; ç±»å‹å¯ä»¥ä½¿ç”¨ == è¿ç®—ç¬¦æ£€æŸ¥æ˜¯å¦ä¸ Rhs ç±»å‹ç›¸ç­‰ã€‚\næ‰€æœ‰çš„ PartialEq\u0026lt;Rhs\u0026gt; å®ç°å¿…é¡»ç¡®ä¿ç›¸ç­‰æ˜¯å¯¹ç§°çš„å’Œä¼ é€’çš„ã€‚è¿™æ„å‘³ç€å¯¹äºæ‰€æœ‰çš„ a, b, å’Œ c:\n a == b æ„å‘³ç€ b == a (å¯¹ç§°æ€§) a == b \u0026amp;\u0026amp; b == c æ„å‘³ç€ a == c (ä¼ é€’æ€§)  é»˜è®¤æƒ…å†µä¸‹ Rhs = Selfï¼Œå› ä¸ºæˆ‘ä»¬å‡ ä¹æ€»æ˜¯æƒ³æŠŠä¸€ä¸ªç±»å‹çš„å®ä¾‹ç›¸äº’æ¯”è¾ƒï¼Œè€Œä¸æ˜¯ä¸ä¸åŒç±»å‹çš„å®ä¾‹æ¯”è¾ƒã€‚è¿™ä¹Ÿè‡ªåŠ¨ä¿è¯äº†æˆ‘ä»¬çš„å®ç°æ˜¯å¯¹ç§°çš„å’Œä¼ é€’çš„ã€‚\nstruct Point{x: i32,y: i32 }// Rhs == Self == Point implPartialEqforPoint{// impl automatically symmetric \u0026amp; transitive fn eq(\u0026amp;self,other: \u0026amp;Point)-\u0026gt; bool {self.x==other.x\u0026amp;\u0026amp;self.y==other.y}}å¦‚æœä¸€ä¸ªç±»å‹çš„æ‰€æœ‰æˆå‘˜éƒ½å®ç°äº† `PartialEq'ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥è¢«æ´¾ç”Ÿã€‚\n#[derive(PartialEq)]struct Point{x: i32,y: i32 }#[derive(PartialEq)]enum Suit{Spade,Heart,Club,Diamond,}ä¸€æ—¦ä¸ºæˆ‘ä»¬çš„ç±»å‹å®ç°äº† PartialEqï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å…è´¹å¾—åˆ°æˆ‘ä»¬ç±»å‹çš„å¼•ç”¨ä¹‹é—´çš„ç›¸ç­‰æ€§æ¯”è¾ƒï¼Œè¿™è¦æ„Ÿè°¢è¿™äº›æ³›å‹è¦†ç›–å®ç°ã€‚\n// this impl only gives us: Point == Point #[derive(PartialEq)]struct Point{x: i32,y: i32 }// all of the generic blanket impls below // are provided by the standard library // this impl gives us: \u0026amp;Point == \u0026amp;Point impl\u0026lt;A,B\u0026gt;PartialEq\u0026lt;\u0026amp;\u0026#39;_B\u0026gt;for\u0026amp;\u0026#39;_AwhereA: PartialEq\u0026lt;B\u0026gt;+?Sized,B: ?Sized;// this impl gives us: \u0026amp;mut Point == \u0026amp;Point impl\u0026lt;A,B\u0026gt;PartialEq\u0026lt;\u0026amp;\u0026#39;_B\u0026gt;for\u0026amp;\u0026#39;_mutAwhereA: PartialEq\u0026lt;B\u0026gt;+?Sized,B: ?Sized;// this impl gives us: \u0026amp;Point == \u0026amp;mut Point impl\u0026lt;A,B\u0026gt;PartialEq\u0026lt;\u0026amp;\u0026#39;_mutB\u0026gt;for\u0026amp;\u0026#39;_AwhereA: PartialEq\u0026lt;B\u0026gt;+?Sized,B: ?Sized;// this impl gives us: \u0026amp;mut Point == \u0026amp;mut Point impl\u0026lt;A,B\u0026gt;PartialEq\u0026lt;\u0026amp;\u0026#39;_mutB\u0026gt;for\u0026amp;\u0026#39;_mutAwhereA: PartialEq\u0026lt;B\u0026gt;+?Sized,B: ?Sized;ç”±äºè¿™ä¸ª trait æ˜¯æ³›å‹åŒ–çš„ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸åŒç±»å‹ä¹‹é—´çš„ç›¸ç­‰æ€§ã€‚æ ‡å‡†åº“åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œå…è®¸æ£€æŸ¥è®¸å¤šç±»ä¼¼å­—ç¬¦ä¸²çš„ç±»å‹ï¼Œå¦‚Stringã€\u0026amp;strã€PathBufã€\u0026amp;Pathã€OsStringã€\u0026amp;OsStr ç­‰ä¹‹é—´çš„ç›¸ç­‰æ€§ã€‚\nä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬åªåº”è¯¥åœ¨ä¸åŒç±»å‹ä¹‹é—´å®ç°ç›¸ç­‰æ€§å…³ç³»ï¼Œå¦‚æœå®ƒä»¬å®ç°åŒä¸€ç§æ•°æ®ï¼Œå¹¶ä¸”ç±»å‹ä¹‹é—´çš„å”¯ä¸€åŒºåˆ«æ˜¯å®ƒä»¬å¦‚ä½•è¡¨ç¤ºæ•°æ®æˆ–å¦‚ä½•å…è®¸ä¸æ•°æ®è¿›è¡Œäº¤äº’ã€‚\nè¿™é‡Œæœ‰ä¸€ä¸ªå¯çˆ±ä½†ç³Ÿç³•çš„ä¾‹å­ï¼Œè¯´æ˜æœ‰äººå¯èƒ½ä¼šè¢«è¯±æƒ‘å®ç° PartialEq æ¥æ£€æŸ¥ä¸ç¬¦åˆä¸Šè¿°æ ‡å‡†çš„ä¸åŒç±»å‹ä¹‹é—´çš„ç›¸ç­‰ã€‚\n#[derive(PartialEq)]enum Suit{Spade,Club,Heart,Diamond,}#[derive(PartialEq)]enum Rank{Ace,Two,Three,Four,Five,Six,Seven,Eight,Nine,Ten,Jack,Queen,King,}#[derive(PartialEq)]struct Card{suit: Suit,rank: Rank,}// check equality of Card\u0026#39;s suit implPartialEq\u0026lt;Suit\u0026gt;forCard{fn eq(\u0026amp;self,other: \u0026amp;Suit)-\u0026gt; bool {self.suit==*other}}// check equality of Card\u0026#39;s rank implPartialEq\u0026lt;Rank\u0026gt;forCard{fn eq(\u0026amp;self,other: \u0026amp;Rank)-\u0026gt; bool {self.rank==*other}}fn main(){letAceOfSpades=Card{suit: Suit::Spade,rank: Rank::Ace,};assert!(AceOfSpades==Suit::Spade);// âœ… assert!(AceOfSpades==Rank::Ace);// âœ… }è¿™å¾ˆæœ‰æ•ˆï¼Œè€Œä¸”æœ‰ç‚¹é“ç†ã€‚ä¸€å¼ é»‘æ¡ƒAçš„ç‰Œæ—¢æ˜¯Aåˆæ˜¯é»‘æ¡ƒï¼Œå¦‚æœæˆ‘ä»¬è¦å†™ä¸€ä¸ªå¤„ç†æ‰‘å…‹ç‰Œçš„åº“ï¼Œé‚£ä¹ˆæˆ‘ä»¬æƒ³è®©å®ƒç®€å•æ–¹ä¾¿åœ°å•ç‹¬æ£€æŸ¥ä¸€å¼ ç‰Œçš„èŠ±è‰²å’Œç­‰çº§æ˜¯åˆç†çš„ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬è¿˜ç¼ºå°‘ä¸€äº›ä¸œè¥¿ï¼šå¯¹ç§°æ€§ã€‚ æˆ‘ä»¬å¯ä»¥ Card == Suit å’Œ Card == Rankï¼Œä½†æˆ‘ä»¬ä¸èƒ½ Suit == Card æˆ– Rank == Cardï¼Œæ‰€ä»¥è®©æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\n// check equality of Card\u0026#39;s suit implPartialEq\u0026lt;Suit\u0026gt;forCard{fn eq(\u0026amp;self,other: \u0026amp;Suit)-\u0026gt; bool {self.suit==*other}}// added for symmetry implPartialEq\u0026lt;Card\u0026gt;forSuit{fn eq(\u0026amp;self,other: \u0026amp;Card)-\u0026gt; bool {*self==other.suit}}// check equality of Card\u0026#39;s rank implPartialEq\u0026lt;Rank\u0026gt;forCard{fn eq(\u0026amp;self,other: \u0026amp;Rank)-\u0026gt; bool {self.rank==*other}}// added for symmetry implPartialEq\u0026lt;Card\u0026gt;forRank{fn eq(\u0026amp;self,other: \u0026amp;Card)-\u0026gt; bool {*self==other.rank}}æˆ‘ä»¬æœ‰å¯¹ç§°æ€§! å¤ªå¥½äº†ã€‚å¢åŠ å¯¹ç§°æ€§åªæ˜¯æ‰“ç ´äº†ä¼ é€’æ€§ï¼è¿™æ˜¯ä¸å¯èƒ½çš„ã€‚å“å‘€ã€‚ç°åœ¨å¯ä»¥è¿™æ ·äº†ï¼š\nfn main(){// Ace of Spades leta=Card{suit: Suit::Spade,rank: Rank::Ace,};letb=Suit::Spade;// King of Spades letc=Card{suit: Suit::Spade,rank: Rank::King,};assert!(a==b\u0026amp;\u0026amp;b==c);// âœ… assert!(a==c);// âŒ }å®ç° PartialEq ä»¥æ£€æŸ¥ä¸åŒç±»å‹ä¹‹é—´çš„ç›¸ç­‰å…³ç³»çš„ä¸€ä¸ªå¥½ä¾‹å­æ˜¯ä¸€ä¸ªå¤„ç†è·ç¦»çš„ç¨‹åºï¼Œå®ƒä½¿ç”¨ä¸åŒçš„ç±»å‹æ¥ä»£è¡¨ä¸åŒçš„æµ‹é‡å•ä½ã€‚\n#[derive(PartialEq)]struct Foot(u32);#[derive(PartialEq)]struct Yard(u32);#[derive(PartialEq)]struct Mile(u32);implPartialEq\u0026lt;Mile\u0026gt;forFoot{fn eq(\u0026amp;self,other: \u0026amp;Mile)-\u0026gt; bool {self.0==other.0*5280}}implPartialEq\u0026lt;Foot\u0026gt;forMile{fn eq(\u0026amp;self,other: \u0026amp;Foot)-\u0026gt; bool {self.0*5280==other.0}}implPartialEq\u0026lt;Mile\u0026gt;forYard{fn eq(\u0026amp;self,other: \u0026amp;Mile)-\u0026gt; bool {self.0==other.0*1760}}implPartialEq\u0026lt;Yard\u0026gt;forMile{fn eq(\u0026amp;self,other: \u0026amp;Yard)-\u0026gt; bool {self.0*1760==other.0}}implPartialEq\u0026lt;Foot\u0026gt;forYard{fn eq(\u0026amp;self,other: \u0026amp;Foot)-\u0026gt; bool {self.0*3==other.0}}implPartialEq\u0026lt;Yard\u0026gt;forFoot{fn eq(\u0026amp;self,other: \u0026amp;Yard)-\u0026gt; bool {self.0==other.0*3}}fn main(){leta=Foot(5280);letb=Yard(1760);letc=Mile(1);// symmetry assert!(a==b\u0026amp;\u0026amp;b==a);// âœ… assert!(b==c\u0026amp;\u0026amp;c==b);// âœ… assert!(a==c\u0026amp;\u0026amp;c==a);// âœ… // transitivity assert!(a==b\u0026amp;\u0026amp;b==c\u0026amp;\u0026amp;a==c);// âœ… assert!(c==b\u0026amp;\u0026amp;b==a\u0026amp;\u0026amp;c==a);// âœ… }Eq æ˜¯ä¸€ä¸ªæ ‡è®° traitï¼Œæ˜¯ PartialEq\u0026lt;Self\u0026gt; çš„å­ traitã€‚\ntraitEq: PartialEq\u0026lt;Self\u0026gt;{}å¦‚æœæˆ‘ä»¬ä¸ºä¸€ä¸ªç±»å‹å®ç° Eqï¼Œåœ¨ PartialEq æ‰€è¦æ±‚çš„å¯¹ç§°æ€§å’Œä¼ é€’æ€§çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬è¿˜ä¿è¯äº†è‡ªåæ€§ï¼Œå³ å¯¹æ‰€æœ‰ a, a == aã€‚åœ¨è¿™ä¸ªæ„ä¹‰ä¸Šï¼ŒEq å®Œå–„äº† PartialEqï¼Œå› ä¸ºå®ƒä»£è¡¨äº†ä¸€ä¸ªæ›´ä¸¥æ ¼çš„ç›¸ç­‰æ€§ç‰ˆæœ¬ã€‚å¦‚æœä¸€ä¸ªç±»å‹çš„æ‰€æœ‰æˆå‘˜éƒ½æ˜¯Eq çš„ï¼Œé‚£ä¹ˆ Eq å®ç°å°±å¯ä»¥ä¸ºè¯¥ç±»å‹æ´¾ç”Ÿã€‚\næµ®ç‚¹ç±»å‹æ˜¯ PartialEq çš„ï¼Œä½†ä¸æ˜¯ Eq çš„ï¼Œå› ä¸º NaN != NaNã€‚å‡ ä¹æ‰€æœ‰å…¶ä»–çš„ PartialEq ç±»å‹éƒ½æ˜¯ Eqï¼Œå½“ç„¶ï¼Œé™¤éå®ƒä»¬åŒ…å«æµ®ç‚¹ã€‚\nä¸€æ—¦ä¸€ä¸ªç±»å‹å®ç°äº† PartialEq å’Œ Debugï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ assert_eq! å®ä¸­ä½¿ç”¨å®ƒã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æ¯”è¾ƒ PartialEq ç±»å‹çš„é›†åˆã€‚\n#[derive(PartialEq, Debug)]struct Point{x: i32,y: i32,}fn example_assert(p1: Point,p2: Point){assert_eq!(p1,p2);}fn example_compare_collections\u0026lt;T: PartialEq\u0026gt;(vec1: Vec\u0026lt;T\u0026gt;,vec2: Vec\u0026lt;T\u0026gt;){// if T: PartialEq this now works! ifvec1==vec2{// some code }else{// other code }}Hash é¢„å¤‡çŸ¥è¯†\n Self Methods Generic Parameters Default Impls Derive Macros PartialEq \u0026amp; Eq  traitHash{fn hash\u0026lt;H: Hasher\u0026gt;(\u0026amp;self,state: \u0026amp;mutH);// provided default impls fn hash_slice\u0026lt;H: Hasher\u0026gt;(data: \u0026amp;[Self],state: \u0026amp;mutH);}è¿™ä¸ª trait ä¸ä»»ä½•è¿ç®—ç¬¦æ— å…³ï¼Œä½†è°ˆè®ºå®ƒçš„æœ€å¥½æ—¶æœºæ˜¯åœ¨ PartialEq \u0026amp; Eq ä¹‹åï¼Œæ‰€ä»¥å®ƒåœ¨è¿™é‡Œã€‚Hash ç±»å‹å¯ä»¥ä½¿ç”¨ Hasher è¿›è¡Œæ•£åˆ—ã€‚\nusestd:#ï¸âƒ£:Hasher;usestd:#ï¸âƒ£:Hash;struct Point{x: i32,y: i32,}implHashforPoint{fn hash\u0026lt;H: Hasher\u0026gt;(\u0026amp;self,hasher: \u0026amp;mutH){hasher.write_i32(self.x);hasher.write_i32(self.y);}}æœ‰ä¸€ä¸ªæ´¾ç”Ÿå®ï¼Œå®ƒç”Ÿæˆçš„å®ç°ä¸ä¸Šè¿°ç›¸åŒã€‚\n#[derive(Hash)]struct Point{x: i32,y: i32,}å¦‚æœä¸€ä¸ªç±»å‹åŒæ—¶å®ç°äº† Hash å’Œ Eqï¼Œè¿™äº›å®ç°å¿…é¡»ç›¸äº’ä¸€è‡´ï¼Œå³å¯¹äºæ‰€æœ‰çš„ a å’Œ bï¼Œå¦‚æœ a == bï¼Œé‚£ä¹ˆ a.hash() == b.hash()ã€‚æ‰€ä»¥æˆ‘ä»¬åº”è¯¥æ€»æ˜¯ä½¿ç”¨æ´¾ç”Ÿå®æ¥å®ç°ä¸¤è€…ï¼Œæˆ–è€…æ‰‹åŠ¨å®ç°ä¸¤è€…ï¼Œä½†ä¸èƒ½æ··åˆä½¿ç”¨ï¼Œå¦åˆ™å°±æœ‰å¯èƒ½ç ´åä¸Šè¿°ä¸å˜æ€§ã€‚\nä¸ºä¸€ä¸ªç±»å‹å®ç° Eq å’Œ Hash çš„ä¸»è¦å¥½å¤„æ˜¯ï¼Œå®ƒå…è®¸æˆ‘ä»¬å°†è¯¥ç±»å‹ä½œä¸ºé”®å­˜å‚¨åœ¨ HashMap å’Œ HashSet ä¸­ã€‚\nusestd::collections::HashSet;// now our type can be stored // in HashSets and HashMaps! #[derive(PartialEq, Eq, Hash)]struct Point{x: i32,y: i32,}fn example_hashset(){letmutpoints=HashSet::new();points.insert(Point{x: 0,y: 0});// âœ… }PartialOrd \u0026amp; Ord é¢„å¤‡çŸ¥è¯†\n Self Methods Generic Parameters Default Impls Subtraits \u0026amp; Supertraits Derive Macros Sized PartialEq \u0026amp; Eq  enum Ordering{Less,Equal,Greater,}traitPartialOrd\u0026lt;Rhs=Self\u0026gt;: PartialEq\u0026lt;Rhs\u0026gt;whereRhs: ?Sized,{fn partial_cmp(\u0026amp;self,other: \u0026amp;Rhs)-\u0026gt; Option\u0026lt;Ordering\u0026gt;;// provided default impls fn lt(\u0026amp;self,other: \u0026amp;Rhs)-\u0026gt; bool;fn le(\u0026amp;self,other: \u0026amp;Rhs)-\u0026gt; bool;fn gt(\u0026amp;self,other: \u0026amp;Rhs)-\u0026gt; bool;fn ge(\u0026amp;self,other: \u0026amp;Rhs)-\u0026gt; bool;}PartialOrd\u0026lt;Rhs\u0026gt; ç±»å‹å¯ä»¥ä½¿ç”¨ \u0026lt;, \u0026lt;=, \u0026gt;, å’Œ \u0026gt;= è¿ç®—ç¬¦ä¸ Rhs ç±»å‹è¿›è¡Œæ¯”è¾ƒã€‚\næ‰€æœ‰çš„ PartialOrd å®ç°å¿…é¡»ç¡®ä¿æ¯”è¾ƒæ˜¯ä¸å¯¹ç§°çš„å’Œä¼ é€’çš„ã€‚è¿™æ„å‘³ç€å¯¹äºæ‰€æœ‰çš„ a, b, å’Œ c:\n a \u0026lt; b æ„å‘³ç€ !(a \u0026gt; b) (ä¸å¯¹ç§°æ€§) a \u0026lt; b \u0026amp;\u0026amp; b \u0026lt; c æ„å‘³ç€ a \u0026lt; c (ä¼ é€’æ€§)  PartialOrd æ˜¯ PartialEq çš„ä¸€ä¸ªå­ traitï¼Œå®ƒä»¬çš„å®ç°å¿…é¡»æ€»æ˜¯ç›¸äº’ä¸€è‡´ã€‚\nfn must_always_agree\u0026lt;T: PartialOrd +PartialEq\u0026gt;(t1: T,t2: T){assert_eq!(t1.partial_cmp(\u0026amp;t2)==Some(Ordering::Equal),t1==t2);}PartialOrd æ˜¯å¯¹ PartialEq çš„ç»†åŒ–ï¼Œå½“æ¯”è¾ƒ PartialEq ç±»å‹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥å®ƒä»¬æ˜¯å¦ç›¸ç­‰ï¼Œä½†å½“æ¯”è¾ƒ PartialOrd ç±»å‹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥å®ƒä»¬æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœå®ƒä»¬ä¸ç›¸ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥å®ƒä»¬æ˜¯å¦ä¸ç›¸ç­‰ï¼Œå› ä¸ºç¬¬ä¸€é¡¹å°äºæˆ–å¤§äºç¬¬äºŒé¡¹ã€‚\né»˜è®¤æƒ…å†µä¸‹ Rhs = Selfï¼Œå› ä¸ºæˆ‘ä»¬å‡ ä¹æ€»æ˜¯æƒ³æŠŠä¸€ä¸ªç±»å‹çš„å®ä¾‹ç›¸äº’æ¯”è¾ƒï¼Œè€Œä¸æ˜¯å’Œä¸åŒç±»å‹çš„å®ä¾‹æ¯”è¾ƒã€‚è¿™ä¹Ÿè‡ªåŠ¨ä¿è¯äº†æˆ‘ä»¬çš„å®ç°æ˜¯å¯¹ç§°çš„å’Œä¼ é€’çš„ã€‚\nusestd::cmp::Ordering;#[derive(PartialEq, PartialOrd)]struct Point{x: i32,y: i32 }// Rhs == Self == Point implPartialOrdforPoint{// impl automatically symmetric \u0026amp; transitive fn partial_cmp(\u0026amp;self,other: \u0026amp;Point)-\u0026gt; Option\u0026lt;Ordering\u0026gt;{Some(matchself.x.cmp(\u0026amp;other.x){Ordering::Equal=\u0026gt;self.y.cmp(\u0026amp;other.y),ordering=\u0026gt;ordering,})}}å¦‚æœä¸€ä¸ªç±»å‹çš„æ‰€æœ‰æˆå‘˜éƒ½å®ç°äº† PartialOrdï¼Œé‚£ä¹ˆå®ƒå¯ä»¥è¢«æ´¾ç”Ÿã€‚\n#[derive(PartialEq, PartialOrd)]struct Point{x: i32,y: i32,}#[derive(PartialEq, PartialOrd)]enum Stoplight{Red,Yellow,Green,}PartialOrd æ´¾ç”Ÿå®åŸºäºå…¶æˆå‘˜çš„å­—æ¯é¡ºåºå¯¹ç±»å‹è¿›è¡Œæ’åºã€‚\n// generates PartialOrd impl which orders // Points based on x member first and // y member second because that\u0026#39;s the order // they appear in the source code #[derive(PartialOrd, PartialEq)]struct Point{x: i32,y: i32,}// generates DIFFERENT PartialOrd impl // which orders Points based on y member // first and x member second #[derive(PartialOrd, PartialEq)]struct Point{y: i32,x: i32,}Ord is a subtrait of Eq and PartialOrd\u0026lt;Self\u0026gt;: Ord æ˜¯ Eq å’Œ PartialOrd\u0026lt;Self\u0026gt; çš„å­ traitã€‚\ntraitOrd: Eq +PartialOrd\u0026lt;Self\u0026gt;{fn cmp(\u0026amp;self,other: \u0026amp;Self)-\u0026gt; Ordering;// provided default impls fn max(self,other: Self)-\u0026gt; Self;fn min(self,other: Self)-\u0026gt; Self;fn clamp(self,min: Self,max: Self)-\u0026gt; Self;}å¦‚æœæˆ‘ä»¬ä¸ºä¸€ä¸ªç±»å‹å®ç° Ordï¼Œåœ¨ PartialOrd æ‰€è¦æ±‚çš„ä¸å¯¹ç§°æ€§å’Œä¼ é€’æ€§çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬è¿˜ä¿è¯ä¸å¯¹ç§°æ€§æ˜¯å®Œå…¨çš„ï¼Œå³å¯¹äºä»»ä½•ç»™å®šçš„ a å’Œ bï¼Œa == b æˆ– a \u0026gt; b ä¸­åªæœ‰ä¸€ä¸ªæ˜¯çœŸçš„ã€‚åœ¨è¿™ä¸ªæ„ä¹‰ä¸Šï¼ŒOrd å®Œå–„äº† Eq å’Œ PartialOrdï¼Œå› ä¸ºå®ƒä»£è¡¨äº†ä¸€ä¸ªæ›´ä¸¥æ ¼çš„æ¯”è¾ƒç‰ˆæœ¬ã€‚å¦‚æœä¸€ä¸ªç±»å‹å®ç°äº† Ordï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨è¿™ä¸ªå®ç°æ¥å®ç° PartialOrdã€PartialEq å’Œ Eqã€‚\nusestd::cmp::Ordering;// of course we can use the derive macros here #[derive(Ord, PartialOrd, Eq, PartialEq)]struct Point{x: i32,y: i32,}// note: as with PartialOrd, the Ord derive macro // orders a type based on the lexicographical order // of its members // but here\u0026#39;s the impls if we wrote them out by hand implOrdforPoint{fn cmp(\u0026amp;self,other: \u0026amp;Self)-\u0026gt; Ordering{matchself.x.cmp(\u0026amp;self.y){Ordering::Equal=\u0026gt;self.y.cmp(\u0026amp;self.y),ordering=\u0026gt;ordering,}}}implPartialOrdforPoint{fn partial_cmp(\u0026amp;self,other: \u0026amp;Self)-\u0026gt; Option\u0026lt;Ordering\u0026gt;{Some(self.cmp(other))}}implPartialEqforPoint{fn eq(\u0026amp;self,other: \u0026amp;Self)-\u0026gt; bool {self.cmp(other)==Ordering::Equal}}implEqforPoint{}æµ®ç‚¹æ•°å®ç°äº† PartialOrdï¼Œä½†ä¸æ˜¯ Ordï¼Œå› ä¸º NaN \u0026lt; 0 == false å’Œ NaN \u0026gt;= 0 == false åŒæ—¶ä¸ºçœŸã€‚å‡ ä¹æ‰€æœ‰å…¶ä»–çš„ PartialOrd ç±»å‹éƒ½æ˜¯ Ordï¼Œå½“ç„¶ï¼Œé™¤éå®ƒä»¬åŒ…å«æµ®ç‚¹æ•°ã€‚\nä¸€æ—¦ä¸€ä¸ªç±»å‹è¢«è®¤ä¸ºæ˜¯ Ord çš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å…¶å­˜å‚¨åœ¨ BTreeMap å’Œ BTreeSet ä¸­ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ sort() æ–¹æ³•å¯¹å…¶è¿›è¡Œæ’åºï¼Œä»¥åŠå¯¹æ•°ç»„ã€Vec å’Œ VecDeque ç­‰ä»»ä½•ç±»å‹çš„åˆ‡ç‰‡è¿›è¡Œè§£å¼•ç”¨ã€‚\nusestd::collections::BTreeSet;// now our type can be stored // in BTreeSets and BTreeMaps! #[derive(Ord, PartialOrd, PartialEq, Eq)]struct Point{x: i32,y: i32,}fn example_btreeset(){letmutpoints=BTreeSet::new();points.insert(Point{x: 0,y: 0});// âœ… }// we can also .sort() Ord types in collections! fn example_sort\u0026lt;T: Ord\u0026gt;(mutsortable: Vec\u0026lt;T\u0026gt;)-\u0026gt; Vec\u0026lt;T\u0026gt;{sortable.sort();sortable}Arithmetic Traits    Trait(s) Category Operator(s) Description     Add arithmetic + addition   AddAssign arithmetic += addition assignment   BitAnd arithmetic \u0026amp; bitwise AND   BitAndAssign arithmetic \u0026amp;= bitwise assignment   BitXor arithmetic ^ bitwise XOR   BitXorAssign arithmetic ^= bitwise XOR assignment   Div arithmetic / division   DivAssign arithmetic /= division assignment   Mul arithmetic * multiplication   MulAssign arithmetic *= multiplication assignment   Neg arithmetic - unary negation   Not arithmetic ! unary logical negation   Rem arithmetic % remainder   RemAssign arithmetic %= remainder assignment   Shl arithmetic \u0026lt;\u0026lt; left shift   ShlAssign arithmetic \u0026lt;\u0026lt;= left shift assignment   Shr arithmetic \u0026gt;\u0026gt; right shift   ShrAssign arithmetic \u0026gt;\u0026gt;= right shift assignment   Sub arithmetic - subtraction   SubAssign arithmetic -= subtraction assignment    ä»”ç»†ç ”ç©¶æ‰€æœ‰è¿™äº›å°†æ˜¯éå¸¸å¤šä½™çš„ã€‚åæ­£å¤§å¤šæ•°åªé€‚ç”¨äºæ•°å­—ç±»å‹ã€‚æˆ‘ä»¬åªè®¨è®º Add å’Œ AddAssignï¼Œå› ä¸º + æ“ä½œç¬¦é€šå¸¸è¢«é‡è½½æ¥åšå…¶ä»–äº‹æƒ…ï¼Œå¦‚å‘é›†åˆæ·»åŠ é¡¹ç›®æˆ–å°†äº‹ç‰©ä¸²è”èµ·æ¥ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½è¦†ç›–æœ€æœ‰è¶£çš„åœ°æ–¹ï¼Œè€Œä¸ä¼šé‡å¤ã€‚\nAdd \u0026amp; AddAssign é¢„å¤‡çŸ¥è¯†\n Self Methods Associated Types Generic Parameters Generic Types vs Associated Types Derive Macros  traitAdd\u0026lt;Rhs=Self\u0026gt;{type Output;fn add(self,rhs: Rhs)-\u0026gt; Self::Output;}Add\u0026lt;Rhs, Output = T\u0026gt; ç±»å‹å¯ä»¥å’Œ Rhs ç±»å‹ç›¸åŠ ï¼Œå¹¶å°†äº§ç”Ÿ T ä½œä¸ºè¾“å‡ºã€‚\nä¾‹å­ Add\u0026lt;Point, Output = Point\u0026gt; æ˜¯é’ˆå¯¹ Point å®ç°çš„ã€‚\n#[derive(Clone, Copy)]struct Point{x: i32,y: i32,}implAddforPoint{type Output=Point;fn add(self,rhs: Point)-\u0026gt; Point{Point{x: self.x+rhs.x,y: self.y+rhs.y,}}}fn main(){letp1=Point{x: 1,y: 2};letp2=Point{x: 3,y: 4};letp3=p1+p2;assert_eq!(p3.x,p1.x+p2.x);// âœ… assert_eq!(p3.y,p1.y+p2.y);// âœ… }ä½†æ˜¯å¦‚æœæˆ‘ä»¬åªæœ‰å¯¹ Point çš„å¼•ç”¨å‘¢ï¼Ÿé‚£æˆ‘ä»¬è¿˜èƒ½è®©å®ƒä»¬ç›¸åŠ å—ï¼Ÿè®©æˆ‘ä»¬è¯•è¯•ã€‚\nfn main(){letp1=Point{x: 1,y: 2};letp2=Point{x: 3,y: 4};letp3=\u0026amp;p1+\u0026amp;p2;// âŒ }ä¸å¹¸çš„æ˜¯æ²¡æœ‰ã€‚ç¼–è¯‘å™¨ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š\nerror[E0369]: cannot add `\u0026amp;Point` to `\u0026amp;Point`\r--\u0026gt; src/main.rs:50:25\r|\r50 | let p3: Point = \u0026amp;p1 + \u0026amp;p2;\r| --- ^ --- \u0026amp;Point\r| |\r| \u0026amp;Point\r|\r= note: an implementation of `std::ops::Add` might be missing for `\u0026amp;Point`\råœ¨ Rust çš„ç±»å‹ç³»ç»Ÿä¸­ï¼Œå¯¹äºæŸäº›ç±»å‹ T æ¥è¯´ï¼ŒTã€\u0026amp;T å’Œ \u0026amp;mut T éƒ½è¢«è§†ä¸ºå”¯ä¸€çš„ä¸åŒç±»å‹ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»ä¸ºå®ƒä»¬åˆ†åˆ«æä¾› trait å®ç°ã€‚è®©æˆ‘ä»¬ä¸º \u0026amp;Point å®šä¹‰ä¸€ä¸ª Add å®ç°ï¼š\nimplAddfor\u0026amp;Point{type Output=Point;fn add(self,rhs: \u0026amp;Point)-\u0026gt; Point{Point{x: self.x+rhs.x,y: self.y+rhs.y,}}}fn main(){letp1=Point{x: 1,y: 2};letp2=Point{x: 3,y: 4};letp3=\u0026amp;p1+\u0026amp;p2;// âœ… assert_eq!(p3.x,p1.x+p2.x);// âœ… assert_eq!(p3.y,p1.y+p2.y);// âœ… }ç„¶è€Œï¼Œæœ‰äº›äº‹æƒ…è¿˜æ˜¯æ„Ÿè§‰ä¸å¤§å¯¹åŠ²ã€‚æˆ‘ä»¬æœ‰ä¸¤ä¸ªç‹¬ç«‹çš„ Add å®ç°ï¼Œåˆ†åˆ«ç”¨äº Point å’Œ \u0026amp;Pointï¼Œå®ƒä»¬ç›®å‰åšçš„æ˜¯åŒæ ·çš„äº‹æƒ…ï¼Œä½†ä¸èƒ½ä¿è¯å°†æ¥ä¹Ÿä¼šè¿™æ ·åšã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å†³å®šå½“æˆ‘ä»¬æŠŠä¸¤ä¸ª Point ç›¸åŠ æ—¶ï¼Œæˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ªåŒ…å«è¿™ä¸¤ä¸ª Point çš„ Lineï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ Pointï¼Œæˆ‘ä»¬ä¼šåƒè¿™æ ·æ›´æ–°æˆ‘ä»¬çš„ Add ç¨‹åºï¼š\nusestd::ops::Add;#[derive(Copy, Clone)]struct Point{x: i32,y: i32,}#[derive(Copy, Clone)]struct Line{start: Point,end: Point,}// we updated this impl implAddforPoint{type Output=Line;fn add(self,rhs: Point)-\u0026gt; Line{Line{start: self,end: rhs,}}}// but forgot to update this impl, uh oh! implAddfor\u0026amp;Point{type Output=Point;fn add(self,rhs: \u0026amp;Point)-\u0026gt; Point{Point{x: self.x+rhs.x,y: self.y+rhs.y,}}}fn main(){letp1=Point{x: 1,y: 2};letp2=Point{x: 3,y: 4};letline: Line=p1+p2;// âœ… letp1=Point{x: 1,y: 2};letp2=Point{x: 3,y: 4};letline: Line=\u0026amp;p1+\u0026amp;p2;// âŒ expected Line, found Point }æˆ‘ä»¬ç›®å‰å¯¹ \u0026amp;Point çš„ Add å®ç°é€ æˆäº†ä¸å¿…è¦çš„ç»´æŠ¤è´Ÿæ‹…ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™ä¸ªå®ç°ä¸ Point çš„å®ç°ç›¸åŒ¹é…ï¼Œè€Œä¸å¿…åœ¨æ¯æ¬¡æ”¹å˜ Point çš„å®ç°æ—¶éƒ½è¦æ‰‹åŠ¨æ›´æ–°ã€‚æˆ‘ä»¬å¸Œæœ›å°½å¯èƒ½åœ°ä¿æŒæˆ‘ä»¬çš„ä»£ç æ˜¯ DRYï¼ˆDon\u0026rsquo;t Repeat Yourselfï¼‰ã€‚å¹¸è¿çš„æ˜¯è¿™æ˜¯å¯ä»¥å®ç°çš„ã€‚\n// updated, DRY impl implAddfor\u0026amp;Point{type Output=\u0026lt;PointasAdd\u0026gt;::Output;fn add(self,rhs: \u0026amp;Point)-\u0026gt; Self::Output{Point::add(*self,*rhs)}}fn main(){letp1=Point{x: 1,y: 2};letp2=Point{x: 3,y: 4};letline: Line=p1+p2;// âœ… letp1=Point{x: 1,y: 2};letp2=Point{x: 3,y: 4};letline: Line=\u0026amp;p1+\u0026amp;p2;// âœ… }AddAssign\u0026lt;Rhs\u0026gt; ç±»å‹å…è®¸æˆ‘ä»¬ç›¸åŠ å¹¶åˆ†é… Rhs ç±»å‹ç»™å®ƒä»¬ã€‚Trait å£°æ˜å¦‚ä¸‹ï¼š\ntraitAddAssign\u0026lt;Rhs=Self\u0026gt;{fn add_assign(\u0026amp;mutself,rhs: Rhs);}ä¸º Point å’Œ \u0026amp;Point ç±»å‹çš„å®ç°çš„ä¾‹å­å¦‚ä¸‹ï¼š\nusestd::ops::AddAssign;#[derive(Copy, Clone)]struct Point{x: i32,y: i32 }implAddAssignforPoint{fn add_assign(\u0026amp;mutself,rhs: Point){self.x+=rhs.x;self.y+=rhs.y;}}implAddAssign\u0026lt;\u0026amp;Point\u0026gt;forPoint{fn add_assign(\u0026amp;mutself,rhs: \u0026amp;Point){Point::add_assign(self,*rhs);}}fn main(){letmutp1=Point{x: 1,y: 2};letp2=Point{x: 3,y: 4};p1+=\u0026amp;p2;p1+=p2;assert!(p1.x==7\u0026amp;\u0026amp;p1.y==10);}é—­åŒ… Traits    Trait(s) Category Operator(s) Description     Fn closure (...args) immutable closure invocation   FnMut closure (...args) mutable closure invocation   FnOnce closure (...args) one-time closure invocation    FnOnce, FnMut, \u0026amp; Fn é¢„å¤‡çŸ¥è¯†\n Self Methods Associated Types Generic Parameters Generic Types vs Associated Types Subtraits \u0026amp; Supertraits  traitFnOnce\u0026lt;Args\u0026gt;{type Output;fn call_once(self,args: Args)-\u0026gt; Self::Output;}traitFnMut\u0026lt;Args\u0026gt;: FnOnce\u0026lt;Args\u0026gt;{fn call_mut(\u0026amp;mutself,args: Args)-\u0026gt; Self::Output;}traitFn\u0026lt;Args\u0026gt;: FnMut\u0026lt;Args\u0026gt;{fn call(\u0026amp;self,args: Args)-\u0026gt; Self::Output;}è™½ç„¶è¿™äº› trait å­˜åœ¨ï¼Œä½†åœ¨ç¨³å®šçš„ Rust ä¸­ï¼Œæˆ‘ä»¬ä¸å¯èƒ½ä¸ºè‡ªå·±çš„ç±»å‹å®ç°è¿™äº›ç‰¹æ€§ã€‚æˆ‘ä»¬å”¯ä¸€èƒ½åˆ›å»ºçš„å®ç°è¿™äº› trait çš„ç±»å‹æ˜¯é—­åŒ…ã€‚æ ¹æ®é—­åŒ…ä»å…¶ç¯å¢ƒä¸­æ•è·çš„å†…å®¹ï¼Œå†³å®šäº†å®ƒæ˜¯å®ç°äº† FnOnceã€FnMut è¿˜æ˜¯ Fnã€‚\nFnOnce é—­åŒ…åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œå› ä¸ºå®ƒåœ¨æ‰§è¡Œä¸­ä¼šæ¶ˆè€—ä¸€äº›å€¼ã€‚\nfn main(){letrange=0..10;letget_range_count=||range.count();assert_eq!(get_range_count(),10);// âœ… get_range_count();// âŒ }è¿­ä»£å™¨ä¸Šçš„ .count() æ–¹æ³•ä¼šæ¶ˆè€—è¿­ä»£å™¨ï¼Œæ‰€ä»¥å®ƒåªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„é—­åŒ…åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå½“æˆ‘ä»¬è¯•å›¾ç¬¬äºŒæ¬¡è°ƒç”¨å®ƒæ—¶ï¼Œä¼šå‡ºç°è¿™ä¸ªé”™è¯¯ã€‚\nerror[E0382]: use of moved value: `get_range_count`\r--\u0026gt; src/main.rs:5:5\r|\r4 | assert_eq!(get_range_count(), 10);\r| ----------------- `get_range_count` moved due to this call\r5 | get_range_count();\r| ^^^^^^^^^^^^^^^ value used here after move\r|\rnote: closure cannot be invoked more than once because it moves the variable `range` out of its environment\r--\u0026gt; src/main.rs:3:30\r|\r3 | let get_range_count = || range.count();\r| ^^^^^\rnote: this value implements `FnOnce`, which causes it to be moved when called\r--\u0026gt; src/main.rs:4:16\r|\r4 | assert_eq!(get_range_count(), 10);\r| ^^^^^^^^^^^^^^^\rFnMut é—­åŒ…å¯ä»¥è¢«å¤šæ¬¡è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥æ”¹å˜å®ƒä»ç¯å¢ƒä¸­æ•è·çš„å˜é‡ã€‚æˆ‘ä»¬å¯ä»¥è¯´ FnMut é—­åŒ…æ˜¯æ‰§è¡Œå‰¯ä½œç”¨çš„ï¼Œæˆ–è€…è¯´æ˜¯æœ‰çŠ¶æ€çš„ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªé—­åŒ…çš„ä¾‹å­ï¼Œå®ƒé€šè¿‡è·Ÿè¸ªåˆ°ç›®å‰ä¸ºæ­¢çœ‹åˆ°çš„æœ€å°å€¼ï¼Œä»è¿­ä»£å™¨ä¸­è¿‡æ»¤å‡ºæ‰€æœ‰éå‡åºçš„å€¼ã€‚\nfn main(){letnums=vec![0,4,2,8,10,7,15,18,13];letmutmin=i32::MIN;letascending=nums.into_iter().filter(|\u0026amp;n|{ifn\u0026lt;=min{false}else{min=n;true}}).collect::\u0026lt;Vec\u0026lt;_\u0026gt;\u0026gt;();assert_eq!(vec![0,4,8,10,15,18],ascending);// âœ… }FnMut å®Œå–„äº† FnOnceï¼Œå³ FnOnce éœ€è¦å–å¾—å…¶å‚æ•°çš„æ‰€æœ‰æƒï¼Œåªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œä½† FnMut åªéœ€è¦å–å¾—å¯å˜çš„å¼•ç”¨ï¼Œå¯ä»¥å¤šæ¬¡è°ƒç”¨ã€‚FnMut å¯ä»¥åœ¨ä»»ä½•å¯ä»¥ä½¿ç”¨ FnOnce çš„åœ°æ–¹ä½¿ç”¨ã€‚\nFn é—­åŒ…å¯ä»¥è¢«å¤šæ¬¡è°ƒç”¨ï¼Œå¹¶ä¸”ä¸æ”¹å˜å®ƒä»ç¯å¢ƒä¸­æ•è·çš„ä»»ä½•å˜é‡ã€‚æˆ‘ä»¬å¯ä»¥è¯´ Fn é—­åŒ…æ²¡æœ‰å‰¯ä½œç”¨æˆ–æ— çŠ¶æ€ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªé—­åŒ…çš„ä¾‹å­ï¼Œå®ƒè¿‡æ»¤æ‰äº†æ‰€æœ‰å°äºå®ƒä»ç¯å¢ƒä¸­æ•è·çš„è¿­ä»£å™¨ä¸­çš„æŸä¸ªæ ˆå˜é‡çš„å€¼ã€‚\nfn main(){letnums=vec![0,4,2,8,10,7,15,18,13];letmin=9;letgreater_than_9=nums.into_iter().filter(|\u0026amp;n|n\u0026gt;min).collect::\u0026lt;Vec\u0026lt;_\u0026gt;\u0026gt;();assert_eq!(vec![10,15,18,13],greater_than_9);// âœ… }Fn ç»†åŒ–äº† FnMutï¼Œå³ FnMut éœ€è¦å¯å˜çš„å¼•ç”¨å¹¶å¯å¤šæ¬¡è°ƒç”¨ï¼Œä½† Fn åªéœ€è¦ä¸å¯å˜çš„å¼•ç”¨å¹¶å¯å¤šæ¬¡è°ƒç”¨ã€‚Fn å¯ä»¥ç”¨åœ¨ä»»ä½•å¯ä»¥ä½¿ç”¨ FnMut çš„åœ°æ–¹ï¼ŒåŒ…æ‹¬å¯ä»¥ä½¿ç”¨ FnOnce çš„åœ°æ–¹ã€‚\nå¦‚æœä¸€ä¸ªé—­åŒ…æ²¡æœ‰ä»å®ƒçš„ç¯å¢ƒä¸­æ•è·ä»»ä½•ä¸œè¥¿ï¼Œé‚£ä¹ˆä»æŠ€æœ¯ä¸Šè®²ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œè€Œåªæ˜¯ä¸€ä¸ªåŒ¿åå£°æ˜çš„å†…è”å‡½æ•°ï¼Œå¹¶ä¸”å¯ä»¥ä½œä¸ºä¸€ä¸ªæ™®é€šçš„å‡½æ•°æŒ‡é’ˆè¢«è½¬æ¢ã€ä½¿ç”¨å’Œä¼ é€’ï¼Œä¹Ÿå°±æ˜¯ fnã€‚å‡½æ•°æŒ‡é’ˆå¯ä»¥åœ¨ä»»ä½•å¯ä»¥ä½¿ç”¨ Fn çš„åœ°æ–¹ä½¿ç”¨ï¼Œè¿™åŒ…æ‹¬å¯ä»¥ä½¿ç”¨ FnMut å’Œ FnOnce çš„åœ°æ–¹ã€‚\nfn add_one(x: i32)-\u0026gt; i32 {x+1}fn main(){letmutfn_ptr: fn(i32)-\u0026gt; i32 =add_one;assert_eq!(fn_ptr(1),2);// âœ… // capture-less closure cast to fn pointer fn_ptr=|x|x+1;// same as add_one assert_eq!(fn_ptr(1),2);// âœ… }ä¼ é€’æ™®é€šå‡½æ•°æŒ‡é’ˆä»¥ä»£æ›¿é—­åŒ…çš„ä¾‹å­:\nfn main(){letnums=vec![-1,1,-2,2,-3,3];letabsolutes: Vec\u0026lt;i32\u0026gt;=nums.into_iter().map(i32::abs).collect();assert_eq!(vec![1,1,2,2,3,3],absolutes);// âœ… }å…¶ä»– Trait    Trait(s) Category Operator(s) Description     Deref other * immutable dereference   DerefMut other * mutable derenence   Drop other - type destructor   Index other [] immutable index   IndexMut other [] mutable index   RangeBounds other .. range    Deref \u0026amp; DerefMut é¢„å¤‡çŸ¥è¯†\n Self Methods Associated Types Subtraits \u0026amp; Supertraits Sized  traitDeref{type Target: ?Sized;fn deref(\u0026amp;self)-\u0026gt; \u0026amp;Self::Target;}traitDerefMut: Deref{fn deref_mut(\u0026amp;mutself)-\u0026gt; \u0026amp;mutSelf::Target;}å¯ä»¥ä½¿ç”¨è§£å¼•ç”¨æ“ä½œç¬¦ * æŠŠå®ç°äº† Deref\u0026lt;Target = T\u0026gt; trait çš„ç±»å‹è§£å¼•ç”¨ä¸º T ç±»å‹ã€‚è¿™å¯¹äºæ™ºèƒ½æŒ‡é’ˆç±»å‹ï¼ˆå¦‚ Box å’Œ Rcï¼‰æœ‰æ˜æ˜¾çš„ç”¨é€”ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å¾ˆå°‘çœ‹åˆ°åœ¨ Rust ä»£ç ä¸­æ˜¾å¼åœ°ä½¿ç”¨è§£å¼•ç”¨æ“ä½œç¬¦ï¼Œè¿™æ˜¯å› ä¸º Rust çš„ä¸€ä¸ªå«åš â€œå¼ºåˆ¶è§£å¼•ç”¨â€(deref coercion)çš„ç‰¹æ€§ã€‚\nå½“ç±»å‹ä½œä¸ºå‡½æ•°å‚æ•°ä¼ é€’ã€ä»å‡½æ•°è¿”å›æˆ–ä½œä¸ºæ–¹æ³•è°ƒç”¨çš„ä¸€éƒ¨åˆ†ä½¿ç”¨æ—¶ï¼ŒRust ä¼šè‡ªåŠ¨åœ°å¯¹ç±»å‹è¿›è¡Œè§£å¼•ç”¨ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥å°† \u0026amp;String å’Œ \u0026amp;Vec\u0026lt;T\u0026gt; ä¼ é€’ç»™æœŸæœ› \u0026amp;str å’Œ \u0026amp;[T] çš„å‡½æ•°çš„åŸå› ï¼Œå› ä¸º String å®ç°äº† Deref\u0026lt;Target = str\u0026gt;, Vec\u0026lt;T\u0026gt; å®ç°äº† Deref\u0026lt;Target = [T]\u0026gt;ã€‚\nDeref å’Œ DerefMut åªåº”ä¸ºæ™ºèƒ½æŒ‡é’ˆç±»å‹è€Œå®ç°ã€‚äººä»¬è¯•å›¾è¯¯ç”¨å’Œæ»¥ç”¨è¿™äº› trait çš„æœ€å¸¸è§æ–¹å¼æ˜¯è¯•å›¾å°†æŸç§ OOP å¼çš„æ•°æ®ç»§æ‰¿å¡è¿› Rust ä¸­ã€‚è¿™æ˜¯è¡Œä¸é€šçš„ã€‚Rust ä¸æ˜¯é¢å‘å¯¹è±¡çš„ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹å‡ ç§ä¸åŒçš„æƒ…å†µï¼Œåœ¨å“ªäº›æƒ…å†µä¸‹ï¼Œå¦‚ä½•ä»¥åŠä¸ºä»€ä¹ˆå®ƒä¸èµ·ä½œç”¨ã€‚è®©æˆ‘ä»¬ä»è¿™ä¸ªä¾‹å­å¼€å§‹:\nusestd::ops::Deref;struct Human{health_points: u32,}enum Weapon{Spear,Axe,Sword,}// a Soldier is just a Human with a Weapon struct Soldier{human: Human,weapon: Weapon,}implDerefforSoldier{type Target=Human;fn deref(\u0026amp;self)-\u0026gt; \u0026amp;Human{\u0026amp;self.human}}enum Mount{Horse,Donkey,Cow,}// a Knight is just a Soldier with a Mount struct Knight{soldier: Soldier,mount: Mount,}implDerefforKnight{type Target=Soldier;fn deref(\u0026amp;self)-\u0026gt; \u0026amp;Soldier{\u0026amp;self.soldier}}enum Spell{MagicMissile,FireBolt,ThornWhip,}// a Mage is just a Human who can cast Spells struct Mage{human: Human,spells: Vec\u0026lt;Spell\u0026gt;,}implDerefforMage{type Target=Human;fn deref(\u0026amp;self)-\u0026gt; \u0026amp;Human{\u0026amp;self.human}}enum Staff{Wooden,Metallic,Plastic,}// a Wizard is just a Mage with a Staff struct Wizard{mage: Mage,staff: Staff,}implDerefforWizard{type Target=Mage;fn deref(\u0026amp;self)-\u0026gt; \u0026amp;Mage{\u0026amp;self.mage}}fn borrows_human(human: \u0026amp;Human){}fn borrows_soldier(soldier: \u0026amp;Soldier){}fn borrows_knight(knight: \u0026amp;Knight){}fn borrows_mage(mage: \u0026amp;Mage){}fn borrows_wizard(wizard: \u0026amp;Wizard){}fn example(human: Human,soldier: Soldier,knight: Knight,mage: Mage,wizard: Wizard){// all types can be used as Humans borrows_human(\u0026amp;human);borrows_human(\u0026amp;soldier);borrows_human(\u0026amp;knight);borrows_human(\u0026amp;mage);borrows_human(\u0026amp;wizard);// Knights can be used as Soldiers borrows_soldier(\u0026amp;soldier);borrows_soldier(\u0026amp;knight);// Wizards can be used as Mages borrows_mage(\u0026amp;mage);borrows_mage(\u0026amp;wizard);// Knights \u0026amp; Wizards passed as themselves borrows_knight(\u0026amp;knight);borrows_wizard(\u0026amp;wizard);}å› æ­¤ï¼Œä¹ä¸€çœ‹ï¼Œä¸Šé¢çš„å†…å®¹çœ‹èµ·æ¥å¾ˆä¸é”™ï¼ç„¶è€Œï¼Œåœ¨ä»”ç»†ç ”ç©¶åï¼Œå¾ˆå¿«å°±å‘ç°äº†é—®é¢˜ã€‚é¦–å…ˆï¼Œå¼ºåˆ¶è§£å¼•ç”¨åªå¯¹å¼•ç”¨èµ·ä½œç”¨ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬çœŸæ­£æƒ³è¦ä¼ é€’æ‰€æœ‰æƒæ—¶ï¼Œå®ƒå°±ä¸èµ·ä½œç”¨äº†ã€‚\nfn takes_human(human: Human){}fn example(human: Human,soldier: Soldier,knight: Knight,mage: Mage,wizard: Wizard){// all types CANNOT be used as Humans takes_human(human);takes_human(soldier);// âŒ takes_human(knight);// âŒ takes_human(mage);// âŒ takes_human(wizard);// âŒ }æ­¤å¤–ï¼Œå¼ºåˆ¶è§£å¼•ç”¨åœ¨æ³›å‹ä¸Šä¸‹æ–‡ä¸­ä¸èµ·ä½œç”¨ã€‚æ¯”æ–¹è¯´ï¼Œæˆ‘ä»¬åªåœ¨äººç±»èº«ä¸Šå®ç°ä¸€äº› traitï¼š\ntraitRest{fn rest(\u0026amp;self);}implRestforHuman{fn rest(\u0026amp;self){}}fn take_rest\u0026lt;T: Rest\u0026gt;(rester: \u0026amp;T){rester.rest()}fn example(human: Human,soldier: Soldier,knight: Knight,mage: Mage,wizard: Wizard){// all types CANNOT be used as Rest types, only Human take_rest(\u0026amp;human);take_rest(\u0026amp;soldier);// âŒ take_rest(\u0026amp;knight);// âŒ take_rest(\u0026amp;mage);// âŒ take_rest(\u0026amp;wizard);// âŒ }å¦å¤–ï¼Œå°½ç®¡å¼ºåˆ¶è§£å¼•ç”¨åœ¨å¾ˆå¤šåœ°æ–¹éƒ½èƒ½å·¥ä½œï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰åœ°æ–¹éƒ½èƒ½å·¥ä½œã€‚å®ƒå¯¹æ“ä½œæ•°ä¸èµ·ä½œç”¨ï¼Œå°½ç®¡æ“ä½œç¬¦åªæ˜¯æ–¹æ³•è°ƒç”¨çš„è¯­æ³•ç³–ã€‚æ¯”æ–¹è¯´ï¼Œæˆ‘ä»¬æƒ³è®© Mage(æ³•å¸ˆ) ç”¨ += è¿ç®—ç¬¦æ¥å­¦ä¹  Spell(å’’è¯­)ï¼Œè¿™å¾ˆå¯çˆ±ã€‚\nimplDerefMutforWizard{fn deref_mut(\u0026amp;mutself)-\u0026gt; \u0026amp;mutMage{\u0026amp;mutself.mage}}implAddAssign\u0026lt;Spell\u0026gt;forMage{fn add_assign(\u0026amp;mutself,spell: Spell){self.spells.push(spell);}}fn example(mutmage: Mage,mutwizard: Wizard,spell: Spell){mage+=spell;wizard+=spell;// âŒ wizard not coerced to mage here wizard.add_assign(spell);// oof, we have to call it like this ğŸ¤¦ }åœ¨ OOP å¼æ•°æ®ç»§æ‰¿çš„è¯­è¨€ä¸­ï¼Œæ–¹æ³•ä¸­ self çš„å€¼æ€»æ˜¯ç­‰äºè°ƒç”¨è¯¥æ–¹æ³•çš„ç±»å‹ï¼Œä½†åœ¨ Rust ä¸­ï¼Œself çš„å€¼æ€»æ˜¯ç­‰äºå®ç°è¯¥æ–¹æ³•çš„ç±»å‹ã€‚\nstruct Human{profession: \u0026amp;\u0026#39;staticstr,health_points: u32,}implHuman{// self will always be a Human here, even if we call it on a Soldier fn state_profession(\u0026amp;self){println!(\u0026#34;I\u0026#39;m a {}!\u0026#34;,self.profession);}}struct Soldier{profession: \u0026amp;\u0026#39;staticstr,human: Human,weapon: Weapon,}fn example(soldier: \u0026amp;Soldier){assert_eq!(\u0026#34;servant\u0026#34;,soldier.human.profession);assert_eq!(\u0026#34;spearman\u0026#34;,soldier.profession);soldier.human.state_profession();// prints \u0026#34;I\u0026#39;m a servant!\u0026#34; soldier.state_profession();// still prints \u0026#34;I\u0026#39;m a servant!\u0026#34; ğŸ¤¦ }å½“åœ¨ä¸€ä¸ªæ–°ç±»å‹ä¸Šå®ç° Deref æˆ– DerefMut æ—¶ï¼Œä¸Šè¿°çš„é—®é¢˜å°¤å…¶ä¸¥é‡ã€‚å‡è®¾æˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ª SortedVec ç±»å‹ï¼Œå®ƒåªæ˜¯ä¸€ä¸ª Vecï¼Œä½†å®ƒæ€»æ˜¯æŒ‰æ’åºé¡ºåºæ’åˆ—ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬å¦‚ä½•åšçš„ã€‚\nstruct SortedVec\u0026lt;T: Ord\u0026gt;(Vec\u0026lt;T\u0026gt;);impl\u0026lt;T: Ord\u0026gt;SortedVec\u0026lt;T\u0026gt;{fn new(mutvec: Vec\u0026lt;T\u0026gt;)-\u0026gt; Self{vec.sort();SortedVec(vec)}fn push(\u0026amp;mutself,t: T){self.0.push(t);self.0.sort();}}å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨è¿™é‡Œå®ç° DerefMut\u0026lt;Target = Vec\u0026lt;T\u0026gt;\u0026gt;ï¼Œå¦åˆ™ä»»ä½•ä½¿ç”¨ SortedVec çš„äººéƒ½å¯ä»¥è½»æ˜“åœ°ç ´åæ’åºçš„é¡ºåºã€‚ç„¶è€Œï¼Œå®ç° Deref\u0026lt;Target = Vec\u0026lt;T\u0026gt;\u0026gt; è‚¯å®šæ˜¯å®‰å…¨çš„ï¼Œå¯¹å—ï¼Ÿè¯•ç€åœ¨ä¸‹é¢çš„ç¨‹åºä¸­å‘ç°è¿™ä¸ªé”™è¯¯ã€‚\nusestd::ops::Deref;struct SortedVec\u0026lt;T: Ord\u0026gt;(Vec\u0026lt;T\u0026gt;);impl\u0026lt;T: Ord\u0026gt;SortedVec\u0026lt;T\u0026gt;{fn new(mutvec: Vec\u0026lt;T\u0026gt;)-\u0026gt; Self{vec.sort();SortedVec(vec)}fn push(\u0026amp;mutself,t: T){self.0.push(t);self.0.sort();}}impl\u0026lt;T: Ord\u0026gt;DerefforSortedVec\u0026lt;T\u0026gt;{type Target=Vec\u0026lt;T\u0026gt;;fn deref(\u0026amp;self)-\u0026gt; \u0026amp;Vec\u0026lt;T\u0026gt;{\u0026amp;self.0}}fn main(){letsorted=SortedVec::new(vec![2,8,6,3]);sorted.push(1);letsortedClone=sorted.clone();sortedClone.push(4);}æˆ‘ä»¬ä»æœªä¸º SortedVec å®ç° Cloneï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è°ƒç”¨ .clone() æ–¹æ³•æ—¶ï¼Œç¼–è¯‘å™¨ä½¿ç”¨å¼ºåˆ¶è§£å¼•ç”¨æ¥è§£å†³å¯¹ Vec çš„æ–¹æ³•è°ƒç”¨ï¼Œæ‰€ä»¥å®ƒè¿”å›ä¸€ä¸ª Vec è€Œä¸æ˜¯ SortedVec!\nfn main(){letsorted: SortedVec\u0026lt;i32\u0026gt;=SortedVec::new(vec![2,8,6,3]);sorted.push(1);// still sorted // calling clone on SortedVec actually returns a Vec ğŸ¤¦ letsortedClone: Vec\u0026lt;i32\u0026gt;=sorted.clone();sortedClone.push(4);// sortedClone no longer sorted ğŸ’€ }æ€»ä¹‹ï¼Œä»¥ä¸Šè¿™äº›é™åˆ¶ã€çº¦æŸæˆ–éº»çƒ¦éƒ½ä¸æ˜¯ Rust çš„ç¼ºç‚¹ï¼Œå› ä¸º Rust ä¸€å¼€å§‹å°±æ²¡æœ‰è¢«è®¾è®¡æˆä¸€ç§ OO è¯­è¨€æˆ–æ”¯æŒä»»ä½• OOP æ¨¡å¼ã€‚\næœ¬èŠ‚çš„ä¸»è¦å¯ç¤ºæ˜¯ï¼Œä¸è¦è¯•å›¾ç”¨ Deref å’Œ DerefMut å®ç°æ¥è¡¨ç°å¯çˆ±æˆ–èªæ˜ã€‚å®ƒä»¬å®é™…ä¸Šåªé€‚åˆäºæ™ºèƒ½æŒ‡é’ˆç±»å‹ï¼Œç›®å‰åªèƒ½åœ¨æ ‡å‡†åº“ä¸­å®ç°ï¼Œå› ä¸ºæ™ºèƒ½æŒ‡é’ˆç±»å‹ç›®å‰éœ€è¦ä¸ç¨³å®šçš„ç‰¹æ€§å’Œç¼–è¯‘å™¨çš„é­”æ³•æ‰èƒ½å·¥ä½œã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦ç±»ä¼¼äº Deref å’Œ DerefMut çš„åŠŸèƒ½å’Œè¡Œä¸ºï¼Œé‚£ä¹ˆæˆ‘ä»¬å®é™…ä¸Šå¯èƒ½è¦æ‰¾çš„æ˜¯ AsRef å’Œ AsMutï¼Œæˆ‘ä»¬å°†åœ¨åé¢è®¨è®ºã€‚\nIndex \u0026amp; IndexMut é¢„å¤‡çŸ¥è¯†\n Self Methods Associated Types Generic Parameters Generic Types vs Associated Types Subtraits \u0026amp; Supertraits Sized  traitIndex\u0026lt;Idx: ?Sized\u0026gt;{type Output: ?Sized;fn index(\u0026amp;self,index: Idx)-\u0026gt; \u0026amp;Self::Output;}traitIndexMut\u0026lt;Idx\u0026gt;: Index\u0026lt;Idx\u0026gt;whereIdx: ?Sized{fn index_mut(\u0026amp;mutself,index: Idx)-\u0026gt; \u0026amp;mutSelf::Output;}æˆ‘ä»¬å¯ä»¥å°† [] ç´¢å¼•åˆ°æœ‰ T å€¼çš„ Index\u0026lt;T, Output = U\u0026gt; ç±»å‹ï¼Œç´¢å¼•æ“ä½œå°†è¿”å› \u0026amp;U å€¼ã€‚å¯¹äºè¯­æ³•ç³–ï¼Œç¼–è¯‘å™¨ä¼šåœ¨ä»»ä½•ä»ç´¢å¼•æ“ä½œè¿”å›çš„å€¼å‰é¢è‡ªåŠ¨æ’å…¥ä¸€ä¸ªè§£å¼•ç”¨è¿ç®—ç¬¦ *ã€‚\nfn main(){// Vec\u0026lt;i32\u0026gt; impls Index\u0026lt;usize, Output = i32\u0026gt; so // indexing Vec\u0026lt;i32\u0026gt; should produce \u0026amp;i32s and yet... letvec=vec![1,2,3,4,5];letnum_ref: \u0026amp;i32 =vec[0];// âŒ expected \u0026amp;i32 found i32 // above line actually desugars to letnum_ref: \u0026amp;i32 =*vec[0];// âŒ expected \u0026amp;i32 found i32 // both of these alternatives work letnum: i32 =vec[0];// âœ… letnum_ref=\u0026amp;vec[0];// âœ… }ä¸€å¼€å§‹æœ‰ç‚¹è®©äººå›°æƒ‘ï¼Œå› ä¸ºçœ‹èµ·æ¥ Index trait å¹¶ä¸éµå¾ªå®ƒè‡ªå·±çš„æ–¹æ³•ç­¾åï¼Œä½†å®é™…ä¸Šè¿™åªæ˜¯æœ‰é—®é¢˜çš„è¯­æ³•ç³–ã€‚\nå› ä¸º Idx æ˜¯ä¸€ä¸ªæ³›å‹ç±»å‹ï¼ŒIndex trait å¯ä»¥ä¸ºä¸€ä¸ªç»™å®šçš„ç±»å‹å®ç°å¾ˆå¤šæ¬¡ï¼Œåœ¨ Vec\u0026lt;T\u0026gt; çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥ä½¿ç”¨ usize å¯¹å…¶è¿›è¡Œç´¢å¼•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ Range\u0026lt;usize\u0026gt; å¯¹å…¶è¿›è¡Œç´¢å¼•ï¼Œä»¥è·å¾—åˆ‡ç‰‡ã€‚\nfn main(){letvec=vec![1,2,3,4,5];assert_eq!(\u0026amp;vec[..],\u0026amp;[1,2,3,4,5]);// âœ… assert_eq!(\u0026amp;vec[1..],\u0026amp;[2,3,4,5]);// âœ… assert_eq!(\u0026amp;vec[..4],\u0026amp;[1,2,3,4]);// âœ… assert_eq!(\u0026amp;vec[1..4],\u0026amp;[2,3,4]);// âœ… }ä¸ºäº†å±•ç¤ºæˆ‘ä»¬å¦‚ä½•å®ç° Indexï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªæœ‰è¶£çš„ä¾‹å­ï¼Œå±•ç¤ºäº†æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨ä¸€ä¸ªæ–°ç±»å‹å’Œ Index trait æ¥å®ç° Vec çš„åŒ…è£…ç´¢å¼•å’Œè´Ÿç´¢å¼•ã€‚\nusestd::ops::Index;struct WrappingIndex\u0026lt;T\u0026gt;(Vec\u0026lt;T\u0026gt;);impl\u0026lt;T\u0026gt;Index\u0026lt;usize\u0026gt;forWrappingIndex\u0026lt;T\u0026gt;{type Output=T;fn index(\u0026amp;self,index: usize)-\u0026gt; \u0026amp;T{\u0026amp;self.0[index%self.0.len()]}}impl\u0026lt;T\u0026gt;Index\u0026lt;i128\u0026gt;forWrappingIndex\u0026lt;T\u0026gt;{type Output=T;fn index(\u0026amp;self,index: i128)-\u0026gt; \u0026amp;T{letself_len=self.0.len()asi128;letidx=(((index%self_len)+self_len)%self_len)asusize;\u0026amp;self.0[idx]}}#[test]// âœ… fn indexes(){letwrapping_vec=WrappingIndex(vec![1,2,3]);assert_eq!(1,wrapping_vec[0_usize]);assert_eq!(2,wrapping_vec[1_usize]);assert_eq!(3,wrapping_vec[2_usize]);}#[test]// âœ… fn wrapping_indexes(){letwrapping_vec=WrappingIndex(vec![1,2,3]);assert_eq!(1,wrapping_vec[3_usize]);assert_eq!(2,wrapping_vec[4_usize]);assert_eq!(3,wrapping_vec[5_usize]);}#[test]// âœ… fn neg_indexes(){letwrapping_vec=WrappingIndex(vec![1,2,3]);assert_eq!(1,wrapping_vec[-3_i128]);assert_eq!(2,wrapping_vec[-2_i128]);assert_eq!(3,wrapping_vec[-1_i128]);}#[test]// âœ… fn wrapping_neg_indexes(){letwrapping_vec=WrappingIndex(vec![1,2,3]);assert_eq!(1,wrapping_vec[-6_i128]);assert_eq!(2,wrapping_vec[-5_i128]);assert_eq!(3,wrapping_vec[-4_i128]);}æ²¡æœ‰è¦æ±‚ Idx ç±»å‹å¿…é¡»æ˜¯æ•°å­—ç±»å‹æˆ– Rangeï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªæšä¸¾! ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œä½¿ç”¨ç¯®çƒä½ç½®ç´¢å¼•åˆ°ä¸€ä¸ªç¯®çƒé˜Ÿï¼Œä»¥æ£€ç´¢è¯¥é˜Ÿçš„çƒå‘˜ã€‚\nusestd::ops::Index;enum BasketballPosition{PointGuard,ShootingGuard,Center,PowerForward,SmallForward,}struct BasketballPlayer{name: \u0026amp;\u0026#39;staticstr,position: BasketballPosition,}struct BasketballTeam{point_guard: BasketballPlayer,shooting_guard: BasketballPlayer,center: BasketballPlayer,power_forward: BasketballPlayer,small_forward: BasketballPlayer,}implIndex\u0026lt;BasketballPosition\u0026gt;forBasketballTeam{type Output=BasketballPlayer;fn index(\u0026amp;self,position: BasketballPosition)-\u0026gt; \u0026amp;BasketballPlayer{matchposition{BasketballPosition::PointGuard=\u0026gt;\u0026amp;self.point_guard,BasketballPosition::ShootingGuard=\u0026gt;\u0026amp;self.shooting_guard,BasketballPosition::Center=\u0026gt;\u0026amp;self.center,BasketballPosition::PowerForward=\u0026gt;\u0026amp;self.power_forward,BasketballPosition::SmallForward=\u0026gt;\u0026amp;self.small_forward,}}}Drop é¢„å¤‡çŸ¥è¯†\n Self Methods  traitDrop{fn drop(\u0026amp;mutself);}å¦‚æœä¸€ä¸ªç±»å‹å®ç°äº† Dropï¼Œé‚£ä¹ˆå½“å®ƒè¶…å‡ºä½œç”¨åŸŸä½†åœ¨è¢«é”€æ¯ä¹‹å‰ï¼Œdrop å°†åœ¨è¯¥ç±»å‹ä¸Šè°ƒç”¨ã€‚æˆ‘ä»¬å¾ˆå°‘éœ€è¦ä¸ºæˆ‘ä»¬çš„ç±»å‹å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œä½†æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯ï¼Œå¦‚æœä¸€ä¸ªç±»å‹æŒæœ‰ä¸€äº›å¤–éƒ¨èµ„æºï¼Œå½“ç±»å‹è¢«é”€æ¯æ—¶ï¼Œè¿™äº›èµ„æºéœ€è¦è¢«æ¸…ç†æ‰ã€‚\nåœ¨æ ‡å‡†åº“ä¸­æœ‰ä¸€ä¸ª BufWriter ç±»å‹ï¼Œå…è®¸æˆ‘ä»¬å¯¹ Write ç±»å‹è¿›è¡Œç¼“å†²å†™å…¥ã€‚ç„¶è€Œï¼Œå¦‚æœ BufWriter åœ¨å…¶ç¼“å†²åŒºçš„å†…å®¹è¢«åˆ·æ–°åˆ°åº•å±‚çš„ Write ç±»å‹ä¹‹å‰å°±è¢«é”€æ¯äº†å‘¢ï¼Ÿå¹¸å¥½è¿™æ˜¯ä¸å¯èƒ½çš„! BufWriter å®ç°äº† Drop traitï¼Œæ‰€ä»¥æ¯å½“å®ƒç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œflush æ€»æ˜¯è¢«è°ƒç”¨ã€‚\nimpl\u0026lt;W: Write\u0026gt;DropforBufWriter\u0026lt;W\u0026gt;{fn drop(\u0026amp;mutself){self.flush_buf();}}å¦å¤–ï¼ŒRust ä¸­çš„ Mutex æ²¡æœ‰ unlock() æ–¹æ³•ï¼Œå› ä¸ºå®ƒä»¬ä¸éœ€è¦è¿™äº›æ–¹æ³•ã€‚åœ¨ä¸€ä¸ª Mutex ä¸Šè°ƒç”¨ lock() ä¼šè¿”å›ä¸€ä¸ª MutexGuardï¼Œå½“ Mutex è¶…å‡ºä½œç”¨åŸŸæ—¶ï¼Œç”±äºå®ƒçš„ Drop å®ç°ï¼Œå®ƒä¼šè‡ªåŠ¨è§£é”ã€‚\nimpl\u0026lt;T: ?Sized\u0026gt;DropforMutexGuard\u0026lt;\u0026#39;_,T\u0026gt;{fn drop(\u0026amp;mutself){unsafe{self.lock.inner.raw_unlock();}}}ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä½ åœ¨æŸäº›èµ„æºä¸Šå®ç°ä¸€ä¸ªæŠ½è±¡ï¼Œåœ¨ä½¿ç”¨åéœ€è¦æ¸…ç†ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯ä½¿ç”¨ Drop trait çš„ä¸€ä¸ªå¾ˆå¥½çš„ç†ç”±ã€‚\nè½¬æ¢ Traits From \u0026amp; Into é¢„å¤‡çŸ¥è¯†\n Self Functions Methods Generic Parameters Generic Blanket Impls  traitFrom\u0026lt;T\u0026gt;{fn from(T)-\u0026gt; Self;}From\u0026lt;T\u0026gt; ç±»å‹å…è®¸æˆ‘ä»¬å°† T è½¬æ¢ä¸º Selfã€‚\ntraitInto\u0026lt;T\u0026gt;{fn into(self)-\u0026gt; T;}Into\u0026lt;T\u0026gt; ç±»å‹å…è®¸æˆ‘ä»¬å°† Self è½¬æ¢ä¸º Tã€‚\nè¿™äº› trait æ˜¯ä¸€ä¸ªç¡¬å¸çš„ä¸¤ä¸ªä¸åŒä¾§é¢ã€‚æˆ‘ä»¬åªèƒ½ä¸ºæˆ‘ä»¬çš„ç±»å‹å®ç° From\u0026lt;T\u0026gt;ï¼Œå› ä¸º Into\u0026lt;T\u0026gt; çš„å®ç°æ˜¯ç”±ä¸‹é¢è¿™ä¸ªæ³›å‹è¦†ç›–å®ç°è‡ªåŠ¨æä¾›çš„ã€‚\nimpl\u0026lt;T,U\u0026gt;Into\u0026lt;U\u0026gt;forTwhereU: From\u0026lt;T\u0026gt;,{fn into(self)-\u0026gt; U{U::from(self)}}è¿™ä¸¤ä¸ª trait å­˜åœ¨çš„åŸå› æ˜¯ï¼Œå®ƒå…è®¸æˆ‘ä»¬ä»¥ç¨å¾®ä¸åŒçš„æ–¹å¼åœ¨æ³›å‹ç±»å‹ä¸Šç¼–å†™ trait çº¦æŸ(trait bound)ã€‚\nfn function\u0026lt;T\u0026gt;(t: T)where// these bounds are equivalent T: From\u0026lt;i32\u0026gt;,i32: Into\u0026lt;T\u0026gt;{// these examples are equivalent letexample: T=T::from(0);letexample: T=0.into();}å…³äºä½•æ—¶ä½¿ç”¨è¿™ä¸¤ç§æ–¹æ³•å¹¶æ²¡æœ‰ç¡¬æ€§è§„å®šï¼Œæ‰€ä»¥åœ¨æ¯ç§æƒ…å†µä¸‹éƒ½è¦é€‰æ‹©æœ€åˆç†çš„æ–¹æ³•ã€‚ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ä¸€äº›å…³äº Point çš„ä¾‹å­ã€‚\nstruct Point{x: i32,y: i32,}implFrom\u0026lt;(i32,i32)\u0026gt;forPoint{fn from((x,y): (i32,i32))-\u0026gt; Self{Point{x,y}}}implFrom\u0026lt;[i32;2]\u0026gt;forPoint{fn from([x,y]: [i32;2])-\u0026gt; Self{Point{x,y}}}fn example(){// using From letorigin=Point::from((0,0));letorigin=Point::from([0,0]);// using Into letorigin: Point=(0,0).into();letorigin: Point=[0,0].into();}å®ç°ä¸æ˜¯å¯¹ç§°çš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³æŠŠ Point è½¬æ¢æˆå…ƒç»„å’Œæ•°ç»„ï¼Œæˆ‘ä»¬ä¹Ÿå¿…é¡»æ˜¾ç¤ºåœ°åœ°æ·»åŠ è¿™äº›ã€‚\nstruct Point{x: i32,y: i32,}implFrom\u0026lt;(i32,i32)\u0026gt;forPoint{fn from((x,y): (i32,i32))-\u0026gt; Self{Point{x,y}}}implFrom\u0026lt;Point\u0026gt;for(i32,i32){fn from(Point{x,y}: Point)-\u0026gt; Self{(x,y)}}implFrom\u0026lt;[i32;2]\u0026gt;forPoint{fn from([x,y]: [i32;2])-\u0026gt; Self{Point{x,y}}}implFrom\u0026lt;Point\u0026gt;for[i32;2]{fn from(Point{x,y}: Point)-\u0026gt; Self{[x,y]}}fn example(){// from (i32, i32) into Point letpoint=Point::from((0,0));letpoint: Point=(0,0).into();// from Point into (i32, i32) lettuple=\u0026lt;(i32,i32)\u0026gt;::from(point);lettuple: (i32,i32)=point.into();// from [i32; 2] into Point letpoint=Point::from([0,0]);letpoint: Point=[0,0].into();// from Point into [i32; 2] letarray=\u0026lt;[i32;2]\u0026gt;::from(point);letarray: [i32;2]=point.into();}From\u0026lt;T\u0026gt; çš„ä¸€ä¸ªæ™®éç”¨é€”æ˜¯ç¼©å‡æ¨¡æ¿ä»£ç ã€‚å‡è®¾æˆ‘ä»¬åœ¨ç¨‹åºä¸­åŠ å…¥ä¸€ä¸ªåŒ…å«ä¸‰ä¸ª Point çš„ Triangle ç±»å‹ï¼Œè¿™é‡Œæœ‰è®¸å¤šæ–¹æ³•å¯ä»¥æ„å»ºå®ƒã€‚\nstruct Point{x: i32,y: i32,}implPoint{fn new(x: i32,y: i32)-\u0026gt; Point{Point{x,y}}}implFrom\u0026lt;(i32,i32)\u0026gt;forPoint{fn from((x,y): (i32,i32))-\u0026gt; Point{Point{x,y}}}struct Triangle{p1: Point,p2: Point,p3: Point,}implTriangle{fn new(p1: Point,p2: Point,p3: Point)-\u0026gt; Triangle{Triangle{p1,p2,p3}}}impl\u0026lt;P\u0026gt;From\u0026lt;[P;3]\u0026gt;forTrianglewhereP: Into\u0026lt;Point\u0026gt;{fn from([p1,p2,p3]: [P;3])-\u0026gt; Triangle{Triangle{p1: p1.into(),p2: p2.into(),p3: p3.into(),}}}fn example(){// manual construction lettriangle=Triangle{p1: Point{x: 0,y: 0,},p2: Point{x: 1,y: 1,},p3: Point{x: 2,y: 2,},};// using Point::new lettriangle=Triangle{p1: Point::new(0,0),p2: Point::new(1,1),p3: Point::new(2,2),};// using From\u0026lt;(i32, i32)\u0026gt; for Point lettriangle=Triangle{p1: (0,0).into(),p2: (1,1).into(),p3: (2,2).into(),};// using Triangle::new + From\u0026lt;(i32, i32)\u0026gt; for Point lettriangle=Triangle::new((0,0).into(),(1,1).into(),(2,2).into(),);// using From\u0026lt;[Into\u0026lt;Point\u0026gt;; 3]\u0026gt; for Triangle lettriangle: Triangle=[(0,0),(1,1),(2,2),].into();}å¯¹äºä½•æ—¶ã€å¦‚ä½•æˆ–ä¸ºä»€ä¹ˆæˆ‘ä»¬åº”è¯¥ä¸ºæˆ‘ä»¬çš„ç±»å‹å®ç° From\u0026lt;T\u0026gt;ï¼Œæ²¡æœ‰ä»»ä½•è§„åˆ™ï¼Œæ‰€ä»¥è¿™å–å†³äºæˆ‘ä»¬å¯¹æ¯ç§æƒ…å†µçš„æœ€ä½³åˆ¤æ–­ã€‚\nInto\u0026lt;T\u0026gt; çš„ä¸€ä¸ªæµè¡Œç”¨æ³•æ˜¯ä½¿éœ€è¦è‡ªæœ‰å€¼(owned values)çš„å‡½æ•°åœ¨æ¥å—è‡ªæœ‰å€¼æˆ–å€Ÿç”¨å€¼æ—¶å…·æœ‰é€šç”¨æ€§ã€‚\nstruct Person{name: String,}implPerson{// accepts: // - String fn new1(name: String)-\u0026gt; Person{Person{name}}// accepts: // - String // - \u0026amp;String // - \u0026amp;str // - Box\u0026lt;str\u0026gt; // - Cow\u0026lt;\u0026#39;_, str\u0026gt; // - char // since all of the above types can be converted into String fn new2\u0026lt;N: Into\u0026lt;String\u0026gt;\u0026gt;(name: N)-\u0026gt; Person{Person{name: name.into()}}}é”™è¯¯å¤„ç† è°ˆè®ºé”™è¯¯å¤„ç†å’Œ Error trait çš„æœ€ä½³æ—¶æœºæ˜¯åœ¨è®¨è®ºå®Œ Displayã€Debugã€Any å’Œ From ä¹‹åï¼Œåœ¨è®¨è®º TryFrom ä¹‹å‰ï¼Œå› æ­¤é”™è¯¯å¤„ç†éƒ¨åˆ†ä¸è½¬æ¢ trait éƒ¨åˆ†å°´å°¬åœ°ä¸€åˆ†ä¸ºäºŒã€‚\nError é¢„å¤‡çŸ¥è¯†\n Self Methods Default Impls Generic Blanket Impls Subtraits \u0026amp; Supertraits Trait Objects Display \u0026amp; ToString Debug Any From \u0026amp; Into  traitError: Debug+Display{// provided default impls fn source(\u0026amp;self)-\u0026gt; Option\u0026lt;\u0026amp;(dynError+\u0026#39;static)\u0026gt;;fn backtrace(\u0026amp;self)-\u0026gt; Option\u0026lt;\u0026amp;Backtrace\u0026gt;;fn description(\u0026amp;self)-\u0026gt; \u0026amp;str;fn cause(\u0026amp;self)-\u0026gt; Option\u0026lt;\u0026amp;dynError\u0026gt;;}åœ¨ Rust ä¸­ï¼Œé”™è¯¯è¢«è¿”å›ï¼Œè€Œä¸æ˜¯è¢«æŠ›å‡ºã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€äº›ä¾‹å­ã€‚\nç”±äºæ•´æ•°ç±»å‹é™¤ä»¥0ä¼šå¼•èµ· panicï¼Œå¦‚æœæˆ‘ä»¬æƒ³è®©æˆ‘ä»¬çš„ç¨‹åºæ›´å®‰å…¨ã€æ›´æ˜ç¡®ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ª safe_div å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ª Resultï¼Œå°±åƒè¿™æ ·ã€‚\nusestd::fmt;usestd::error;#[derive(Debug, PartialEq)]struct DivByZero;implfmt::DisplayforDivByZero{fn fmt(\u0026amp;self,f: \u0026amp;mutfmt::Formatter\u0026lt;\u0026#39;_\u0026gt;)-\u0026gt; fmt::Result{write!(f,\u0026#34;division by zero error\u0026#34;)}}implerror::ErrorforDivByZero{}fn safe_div(numerator: i32,denominator: i32)-\u0026gt; Result\u0026lt;i32,DivByZero\u0026gt;{ifdenominator==0{returnErr(DivByZero);}Ok(numerator/denominator)}#[test]// âœ… fn test_safe_div(){assert_eq!(safe_div(8,2),Ok(4));assert_eq!(safe_div(5,0),Err(DivByZero));}ç”±äºé”™è¯¯æ˜¯è¿”å›çš„ï¼Œè€Œä¸æ˜¯æŠ›å‡ºçš„ï¼Œæ‰€ä»¥å¿…é¡»æ˜¾å¼å¤„ç†ï¼Œå¦‚æœå½“å‰å‡½æ•°ä¸èƒ½å¤„ç†ä¸€ä¸ªé”™è¯¯ï¼Œå®ƒåº”è¯¥å°†å…¶ä¼ æ’­ç»™è°ƒç”¨è€…ã€‚ä¼ æ’­é”™è¯¯çš„æœ€ä¹ æƒ¯çš„æ–¹æ³•æ˜¯ä½¿ç”¨ ? æ“ä½œç¬¦ï¼Œå®ƒåªæ˜¯ç°åœ¨è¢«åºŸå¼ƒçš„ try! å®çš„è¯­æ³•ç³–ï¼Œå®ƒåªæ˜¯åšè¿™ä¸ªã€‚\nmacro_rules!try{($expr:expr)=\u0026gt;{match$expr{// if Ok just unwrap the value Ok(val)=\u0026gt;val,// if Err map the err value using From and return Err(err)=\u0026gt;{returnErr(From::from(err));}}};}å¦‚æœæˆ‘ä»¬æƒ³å†™ä¸€ä¸ªå°†æ–‡ä»¶è¯»æˆ String çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼Œç”¨ ? å°† io::Error ä¼ æ’­åˆ°å®ƒä»¬å¯èƒ½å‡ºç°çš„ä»»ä½•åœ°æ–¹ã€‚\nusestd::io::Read;usestd::path::Path;usestd::io;usestd::fs::File;fn read_file_to_string(path: \u0026amp;Path)-\u0026gt; Result\u0026lt;String,io::Error\u0026gt;{letmutfile=File::open(path)?;// â¬†ï¸ io::Error letmutcontents=String::new();file.read_to_string(\u0026amp;mutcontents)?;// â¬†ï¸ io::Error Ok(contents)}ä½†æ˜¯ï¼Œå‡è®¾æˆ‘ä»¬æ­£åœ¨è¯»å–çš„æ–‡ä»¶å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ•°å­—åˆ—è¡¨ï¼Œæˆ‘ä»¬æƒ³æŠŠå®ƒä»¬åŠ åœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬ä¼šåƒè¿™æ ·æ›´æ–°æˆ‘ä»¬çš„å‡½æ•°ã€‚\nusestd::io::Read;usestd::path::Path;usestd::io;usestd::fs::File;fn sum_file(path: \u0026amp;Path)-\u0026gt; Result\u0026lt;i32,/* What to put here? */\u0026gt;{letmutfile=File::open(path)?;// â¬†ï¸ io::Error letmutcontents=String::new();file.read_to_string(\u0026amp;mutcontents)?;// â¬†ï¸ io::Error letmutsum=0;forlineincontents.lines(){sum+=line.parse::\u0026lt;i32\u0026gt;()?;// â¬†ï¸ ParseIntError }Ok(sum)}ä½†æ˜¯ç°åœ¨æˆ‘ä»¬çš„ Result çš„é”™è¯¯ç±»å‹æ˜¯ä»€ä¹ˆï¼Ÿå®ƒå¯ä»¥è¿”å›ä¸€ä¸ª io::Error æˆ–è€…ä¸€ä¸ª ParseIntErrorã€‚æˆ‘ä»¬å°†çœ‹ä¸€ä¸‹è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸‰ç§æ–¹æ³•ï¼Œä»ä¸´æ—¶åº”æ€¥çš„æ–¹æ³•å¼€å§‹ï¼Œæœ€åæ˜¯æœ€ç¨³å¥çš„æ–¹æ³•ã€‚\nç¬¬ä¸€ç§æ–¹æ³•æ˜¯è®¤è¯†åˆ°æ‰€æœ‰å®ç°äº† Error çš„ç±»å‹ä¹Ÿå®ç°äº† Displayï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰çš„é”™è¯¯æ˜ å°„åˆ° Stringï¼Œå¹¶ä½¿ç”¨ String ä½œä¸ºæˆ‘ä»¬çš„é”™è¯¯ç±»å‹ã€‚\nusestd::fs::File;usestd::io;usestd::io::Read;usestd::path::Path;fn sum_file(path: \u0026amp;Path)-\u0026gt; Result\u0026lt;i32,String\u0026gt;{letmutfile=File::open(path).map_err(|e|e.to_string())?;// â¬†ï¸ io::Error -\u0026gt; String letmutcontents=String::new();file.read_to_string(\u0026amp;mutcontents).map_err(|e|e.to_string())?;// â¬†ï¸ io::Error -\u0026gt; String letmutsum=0;forlineincontents.lines(){sum+=line.parse::\u0026lt;i32\u0026gt;().map_err(|e|e.to_string())?;// â¬†ï¸ ParseIntError -\u0026gt; String }Ok(sum)}å¯¹æ¯ä¸ªé”™è¯¯è¿›è¡Œå­—ç¬¦ä¸²åŒ–å¤„ç†çš„æ˜æ˜¾ç¼ºç‚¹æ˜¯ï¼Œæˆ‘ä»¬ä¸¢å¼ƒäº†ç±»å‹ä¿¡æ¯ï¼Œè¿™ä½¿å¾—è°ƒç”¨è€…æ›´éš¾å¤„ç†é”™è¯¯ã€‚\nä¸Šè¿°æ–¹æ³•çš„ä¸€ä¸ªéæ˜¾è€Œæ˜“è§çš„å¥½å¤„æ˜¯æˆ‘ä»¬å¯ä»¥å®šåˆ¶å­—ç¬¦ä¸²ä»¥æä¾›æ›´å¤šçš„ç‰¹å®šç¯å¢ƒä¿¡æ¯ã€‚ä¾‹å¦‚ï¼ŒParseIntError é€šå¸¸å­—ç¬¦ä¸²åŒ–ä¸º \u0026ldquo;invalid digit found in string\u0026rdquo;ï¼Œè¿™æ˜¯éå¸¸æ¨¡ç³Šçš„ï¼Œæ²¡æœ‰æåˆ°æ— æ•ˆçš„å­—ç¬¦ä¸²æ˜¯ä»€ä¹ˆæˆ–è€…å®ƒè¯•å›¾è§£ææˆä»€ä¹ˆæ•´æ•°ç±»å‹ã€‚å¦‚æœæˆ‘ä»¬è¦è°ƒè¯•è¿™ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªé”™è¯¯ä¿¡æ¯å‡ ä¹æ˜¯æ— ç”¨çš„ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå·±æä¾›æ‰€æœ‰ä¸ä¸Šä¸‹æ–‡ç›¸å…³çš„ä¿¡æ¯æ¥ä½¿å…¶æ˜æ˜¾æ”¹å–„ã€‚\nsum+=line.parse::\u0026lt;i32\u0026gt;().map_err(|_|format!(\u0026#34;failed to parse {} into i32\u0026#34;,line))?;ç¬¬äºŒç§æ–¹æ³•æ˜¯åˆ©ç”¨æ ‡å‡†åº“ä¸­çš„è¿™ç§æ³›å‹è¦†ç›–å®ç°ã€‚\nimpl\u0026lt;E: error::Error\u0026gt;From\u0026lt;E\u0026gt;forBox\u0026lt;dynerror::Error\u0026gt;;è¿™æ„å‘³ç€ä»»ä½• Error ç±»å‹éƒ½å¯ä»¥é€šè¿‡ ? è¿ç®—ç¬¦éšå¼åœ°è½¬æ¢ä¸º Box\u0026lt;dyn error::Error\u0026gt;ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•äº§ç”Ÿé”™è¯¯çš„å‡½æ•°çš„ Result è¿”å›ç±»å‹ä¸­æŠŠé”™è¯¯ç±»å‹è®¾ç½®ä¸º Box\u0026lt;dyn error::Error\u0026gt;ï¼Œ? è¿ç®—ç¬¦å°†ä¸ºæˆ‘ä»¬å®Œæˆå…¶ä½™çš„å·¥ä½œã€‚\nusestd::fs::File;usestd::io::Read;usestd::path::Path;usestd::error;fn sum_file(path: \u0026amp;Path)-\u0026gt; Result\u0026lt;i32,Box\u0026lt;dynerror::Error\u0026gt;\u0026gt;{letmutfile=File::open(path)?;// â¬†ï¸ io::Error -\u0026gt; Box\u0026lt;dyn error::Error\u0026gt; letmutcontents=String::new();file.read_to_string(\u0026amp;mutcontents)?;// â¬†ï¸ io::Error -\u0026gt; Box\u0026lt;dyn error::Error\u0026gt; letmutsum=0;forlineincontents.lines(){sum+=line.parse::\u0026lt;i32\u0026gt;()?;// â¬†ï¸ ParseIntError -\u0026gt; Box\u0026lt;dyn error::Error\u0026gt; }Ok(sum)}è™½ç„¶æ›´åŠ ç®€æ´ï¼Œä½†è¿™ä¼¼ä¹ä¸ä¹‹å‰çš„æ–¹æ³•æœ‰ç›¸åŒçš„ç¼ºç‚¹ï¼Œå³ä¸¢å¼ƒäº†ç±»å‹ä¿¡æ¯ã€‚è¿™å¤§éƒ¨åˆ†æ˜¯çœŸçš„ï¼Œä½†æ˜¯å¦‚æœè°ƒç”¨è€…çŸ¥é“æˆ‘ä»¬å‡½æ•°çš„å®ç°ç»†èŠ‚ï¼Œä»–ä»¬ä»ç„¶å¯ä»¥ä½¿ç”¨ error::Error ä¸Šçš„ downcast_ref() æ–¹æ³•æ¥å¤„ç†ä¸åŒçš„é”™è¯¯ç±»å‹ï¼Œè¿™å’Œå®ƒåœ¨ dyn Any ç±»å‹ä¸Šçš„ä½œç”¨æ˜¯ä¸€æ ·çš„ã€‚\nfn handle_sum_file_errors(path: \u0026amp;Path){matchsum_file(path){Ok(sum)=\u0026gt;println!(\u0026#34;the sum is {}\u0026#34;,sum),Err(err)=\u0026gt;{ifletSome(e)=err.downcast_ref::\u0026lt;io::Error\u0026gt;(){// handle io::Error }elseifletSome(e)=err.downcast_ref::\u0026lt;ParseIntError\u0026gt;(){// handle ParseIntError }else{// we know sum_file can only return one of the // above errors so this branch is unreachable unreachable!();}}}}ç¬¬ä¸‰ç§æ–¹æ³•æ˜¯æœ€ç¨³å¥å’Œç±»å‹å®‰å…¨çš„æ–¹æ³•ï¼Œå¯ä»¥èšåˆè¿™äº›ä¸åŒçš„é”™è¯¯ï¼Œæ˜¯ä½¿ç”¨ä¸€ä¸ªæšä¸¾å»ºç«‹æˆ‘ä»¬è‡ªå·±çš„è‡ªå®šä¹‰é”™è¯¯ç±»å‹ã€‚\nusestd::num::ParseIntError;usestd::fs::File;usestd::io;usestd::io::Read;usestd::path::Path;usestd::error;usestd::fmt;#[derive(Debug)]enum SumFileError{Io(io::Error),Parse(ParseIntError),}implFrom\u0026lt;io::Error\u0026gt;forSumFileError{fn from(err: io::Error)-\u0026gt; Self{SumFileError::Io(err)}}implFrom\u0026lt;ParseIntError\u0026gt;forSumFileError{fn from(err: ParseIntError)-\u0026gt; Self{SumFileError::Parse(err)}}implfmt::DisplayforSumFileError{fn fmt(\u0026amp;self,f: \u0026amp;mutfmt::Formatter\u0026lt;\u0026#39;_\u0026gt;)-\u0026gt; fmt::Result{matchself{SumFileError::Io(err)=\u0026gt;write!(f,\u0026#34;sum file error: {}\u0026#34;,err),SumFileError::Parse(err)=\u0026gt;write!(f,\u0026#34;sum file error: {}\u0026#34;,err),}}}implerror::ErrorforSumFileError{// the default impl for this method always returns None // but we can now override it to make it way more useful! fn source(\u0026amp;self)-\u0026gt; Option\u0026lt;\u0026amp;(dynerror::Error+\u0026#39;static)\u0026gt;{Some(matchself{SumFileError::Io(err)=\u0026gt;err,SumFileError::Parse(err)=\u0026gt;err,})}}fn sum_file(path: \u0026amp;Path)-\u0026gt; Result\u0026lt;i32,SumFileError\u0026gt;{letmutfile=File::open(path)?;// â¬†ï¸ io::Error -\u0026gt; SumFileError letmutcontents=String::new();file.read_to_string(\u0026amp;mutcontents)?;// â¬†ï¸ io::Error -\u0026gt; SumFileError letmutsum=0;forlineincontents.lines(){sum+=line.parse::\u0026lt;i32\u0026gt;()?;// â¬†ï¸ ParseIntError -\u0026gt; SumFileError }Ok(sum)}fn handle_sum_file_errors(path: \u0026amp;Path){matchsum_file(path){Ok(sum)=\u0026gt;println!(\u0026#34;the sum is {}\u0026#34;,sum),Err(SumFileError::Io(err))=\u0026gt;{// handle io::Error },Err(SumFileError::Parse(err))=\u0026gt;{// handle ParseIntError },}}Conversion Traits Continued TryFrom \u0026amp; TryInto é¢„å¤‡çŸ¥è¯†\n Self Functions Methods Associated Types Generic Parameters Generic Types vs Associated Types Generic Blanket Impls From \u0026amp; Into Error  TryFrom å’Œ TryInto æ˜¯ From å’Œ Into çš„ä¸å¯é ç‰ˆæœ¬ã€‚\ntraitTryFrom\u0026lt;T\u0026gt;{type Error;fn try_from(value: T)-\u0026gt; Result\u0026lt;Self,Self::Error\u0026gt;;}traitTryInto\u0026lt;T\u0026gt;{type Error;fn try_into(self)-\u0026gt; Result\u0026lt;T,Self::Error\u0026gt;;}ä¸ Into ç±»ä¼¼ï¼Œæˆ‘ä»¬ä¸èƒ½è‡ªå·±å®ç° TryIntoï¼Œå› ä¸ºå®ƒçš„å®ç°æ˜¯ç”±ä¸‹é¢è¿™ä¸ªæ³›å‹è¦†ç›–å®ç°æä¾›çš„ã€‚\nimpl\u0026lt;T,U\u0026gt;TryInto\u0026lt;U\u0026gt;forTwhereU: TryFrom\u0026lt;T\u0026gt;,{type Error=U::Error;fn try_into(self)-\u0026gt; Result\u0026lt;U,U::Error\u0026gt;{U::try_from(self)}}Let\u0026rsquo;s say that in the context of our program it doesn\u0026rsquo;t make sense for Points to have x and y values that are less than -1000 or greater than 1000. This is how we\u0026rsquo;d rewrite our earlier From impls using TryFrom to signal to the users of our type that this conversion can now fail: å‡è®¾åœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­ï¼ŒPoint çš„ x å’Œ y çš„å€¼å°äº -1000 æˆ–å¤§äº 1000 æ˜¯ä¸åˆç†çš„ã€‚è¿™å°±æ˜¯æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨ TryFrom é‡å†™æˆ‘ä»¬å…ˆå‰çš„ From å®ç°ï¼Œå‘æˆ‘ä»¬ç±»å‹çš„ç”¨æˆ·å‘å‡ºä¿¡å·ï¼Œè¿™ä¸ªè½¬æ¢ç°åœ¨å¯ä»¥å¤±è´¥ã€‚\nusestd::convert::TryFrom;usestd::error;usestd::fmt;struct Point{x: i32,y: i32,}#[derive(Debug)]struct OutOfBounds;implfmt::DisplayforOutOfBounds{fn fmt(\u0026amp;self,f: \u0026amp;mutfmt::Formatter\u0026lt;\u0026#39;_\u0026gt;)-\u0026gt; fmt::Result{write!(f,\u0026#34;out of bounds\u0026#34;)}}implerror::ErrorforOutOfBounds{}// now fallible implTryFrom\u0026lt;(i32,i32)\u0026gt;forPoint{type Error=OutOfBounds;fn try_from((x,y): (i32,i32))-\u0026gt; Result\u0026lt;Point,OutOfBounds\u0026gt;{ifx.abs()\u0026gt;1000||y.abs()\u0026gt;1000{returnErr(OutOfBounds);}Ok(Point{x,y})}}// still infallible implFrom\u0026lt;Point\u0026gt;for(i32,i32){fn from(Point{x,y}: Point)-\u0026gt; Self{(x,y)}}And here\u0026rsquo;s the refactored TryFrom\u0026lt;[TryInto\u0026lt;Point\u0026gt;; 3]\u0026gt; impl for Triangle: è¿™é‡Œæ˜¯é‡æ„åçš„ TryFrom\u0026lt;[TryInto\u0026lt;Point\u0026gt;; 3]\u0026gt; å®ç°ï¼Œç”¨äº Triangleã€‚\nusestd::convert::{TryFrom,TryInto};usestd::error;usestd::fmt;struct Point{x: i32,y: i32,}#[derive(Debug)]struct OutOfBounds;implfmt::DisplayforOutOfBounds{fn fmt(\u0026amp;self,f: \u0026amp;mutfmt::Formatter\u0026lt;\u0026#39;_\u0026gt;)-\u0026gt; fmt::Result{write!(f,\u0026#34;out of bounds\u0026#34;)}}implerror::ErrorforOutOfBounds{}implTryFrom\u0026lt;(i32,i32)\u0026gt;forPoint{type Error=OutOfBounds;fn try_from((x,y): (i32,i32))-\u0026gt; Result\u0026lt;Self,Self::Error\u0026gt;{ifx.abs()\u0026gt;1000||y.abs()\u0026gt;1000{returnErr(OutOfBounds);}Ok(Point{x,y})}}struct Triangle{p1: Point,p2: Point,p3: Point,}impl\u0026lt;P\u0026gt;TryFrom\u0026lt;[P;3]\u0026gt;forTrianglewhereP: TryInto\u0026lt;Point\u0026gt;,{type Error=P::Error;fn try_from([p1,p2,p3]: [P;3])-\u0026gt; Result\u0026lt;Self,Self::Error\u0026gt;{Ok(Triangle{p1: p1.try_into()?,p2: p2.try_into()?,p3: p3.try_into()?,})}}fn example()-\u0026gt; Result\u0026lt;Triangle,OutOfBounds\u0026gt;{lett: Triangle=[(0,0),(1,1),(2,2)].try_into()?;Ok(t)}FromStr é¢„å¤‡çŸ¥è¯†\n Self Functions Associated Types Error TryFrom \u0026amp; TryInto  traitFromStr{type Err;fn from_str(s: \u0026amp;str)-\u0026gt; Result\u0026lt;Self,Self::Err\u0026gt;;}FromStr types allow performing a fallible conversion from \u0026amp;str into Self. The idiomatic way to use FromStr is to call the .parse() method on \u0026amp;strs: FromStr ç±»å‹å…è®¸æ‰§è¡Œä» \u0026amp;str åˆ° Self çš„é”™è¯¯è½¬æ¢ã€‚ä½¿ç”¨ FromStr çš„ä¹ æƒ¯æ–¹æ³•æ˜¯å¯¹ \u0026amp;str è°ƒç”¨ .parse() æ–¹æ³•ã€‚\nusestd::str::FromStr;fn example\u0026lt;T: FromStr\u0026gt;(s: \u0026amp;\u0026#39;staticstr){// these are all equivalent lett: Result\u0026lt;T,_\u0026gt;=FromStr::from_str(s);lett=T::from_str(s);lett: Result\u0026lt;T,_\u0026gt;=s.parse();lett=s.parse::\u0026lt;T\u0026gt;();// most idiomatic }Point å®ç°çš„ä¾‹å­:\nusestd::error;usestd::fmt;usestd::iter::Enumerate;usestd::num::ParseIntError;usestd::str::{Chars,FromStr};#[derive(Debug, Eq, PartialEq)]struct Point{x: i32,y: i32,}implPoint{fn new(x: i32,y: i32)-\u0026gt; Self{Point{x,y}}}#[derive(Debug, PartialEq)]struct ParsePointError;implfmt::DisplayforParsePointError{fn fmt(\u0026amp;self,f: \u0026amp;mutfmt::Formatter\u0026lt;\u0026#39;_\u0026gt;)-\u0026gt; fmt::Result{write!(f,\u0026#34;failed to parse point\u0026#34;)}}implFrom\u0026lt;ParseIntError\u0026gt;forParsePointError{fn from(_e: ParseIntError)-\u0026gt; Self{ParsePointError}}implerror::ErrorforParsePointError{}implFromStrforPoint{type Err =ParsePointError;fn from_str(s: \u0026amp;str)-\u0026gt; Result\u0026lt;Self,Self::Err\u0026gt;{letis_num=|(_,c): \u0026amp;(usize,char)|matches!(c,\u0026#39;0\u0026#39;..=\u0026#39;9\u0026#39;|\u0026#39;-\u0026#39;);letisnt_num=|t: \u0026amp;(_,_)|!is_num(t);letget_num=|char_idxs: \u0026amp;mutEnumerate\u0026lt;Chars\u0026lt;\u0026#39;_\u0026gt;\u0026gt;|-\u0026gt; Result\u0026lt;(usize,usize),ParsePointError\u0026gt;{let(start,_)=char_idxs.skip_while(isnt_num).next().ok_or(ParsePointError)?;let(end,_)=char_idxs.skip_while(is_num).next().ok_or(ParsePointError)?;Ok((start,end))};letmutchar_idxs=s.chars().enumerate();let(x_start,x_end)=get_num(\u0026amp;mutchar_idxs)?;let(y_start,y_end)=get_num(\u0026amp;mutchar_idxs)?;letx=s[x_start..x_end].parse::\u0026lt;i32\u0026gt;()?;lety=s[y_start..y_end].parse::\u0026lt;i32\u0026gt;()?;Ok(Point{x,y})}}#[test]// âœ… fn pos_x_y(){letp=\u0026#34;(4, 5)\u0026#34;.parse::\u0026lt;Point\u0026gt;();assert_eq!(p,Ok(Point::new(4,5)));}#[test]// âœ… fn neg_x_y(){letp=\u0026#34;(-6, -2)\u0026#34;.parse::\u0026lt;Point\u0026gt;();assert_eq!(p,Ok(Point::new(-6,-2)));}#[test]// âœ… fn not_a_point(){letp=\u0026#34;not a point\u0026#34;.parse::\u0026lt;Point\u0026gt;();assert_eq!(p,Err(ParsePointError));}FromStr has the same signature as TryFrom\u0026lt;\u0026amp;str\u0026gt;. It doesn\u0026rsquo;t matter which one we impl for a type first as long as we forward the impl to the other one. Here\u0026rsquo;s a TryFrom\u0026lt;\u0026amp;str\u0026gt; impl for Point assuming it already has a FromStr impl: FromStr ä¸ TryFrom\u0026lt;\u0026amp;str\u0026gt; çš„ç­¾åç›¸åŒã€‚åªè¦æˆ‘ä»¬æŠŠå®ç°è½¬å‘ç»™å¦ä¸€ä¸ªç±»å‹ï¼Œå“ªä¸€ä¸ªå®ç°å¹¶ä¸é‡è¦ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªé’ˆå¯¹ Point çš„ TryFrom\u0026lt;\u0026amp;str\u0026gt; å®ç°ï¼Œå‡è®¾å®ƒå·²ç»æœ‰ä¸€ä¸ª FromStr å®ç°ã€‚\nimplTryFrom\u0026lt;\u0026amp;str\u0026gt;forPoint{type Error=\u0026lt;PointasFromStr\u0026gt;::Err;fn try_from(s: \u0026amp;str)-\u0026gt; Result\u0026lt;Point,Self::Error\u0026gt;{\u0026lt;PointasFromStr\u0026gt;::from_str(s)}}AsRef \u0026amp; AsMut é¢„å¤‡çŸ¥è¯†\n Self Methods Sized Generic Parameters Sized Deref \u0026amp; DerefMut  traitAsRef\u0026lt;T: ?Sized\u0026gt;{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;T;}traitAsMut\u0026lt;T: ?Sized\u0026gt;{fn as_mut(\u0026amp;mutself)-\u0026gt; \u0026amp;mutT;}?Sized è¯´æ˜ T ç±»å‹æ˜¯å¤§å°ä¸ç¡®å®šçš„ã€‚As ä½œä¸ºä»‹è¯, è¡¨æ˜å‘ç”Ÿäº†ç±»å‹è½¬æ¢ã€‚\nAsRef is for cheap reference to reference conversions. However, one of the most common ways it\u0026rsquo;s used is to make functions generic over whether they take ownership or not:\nAsRef æ˜¯ç”¨äºå»‰ä»·çš„å¼•ç”¨åˆ°å¼•ç”¨çš„è½¬æ¢ã€‚ç„¶è€Œï¼Œå®ƒæœ€å¸¸è§çš„ä½¿ç”¨æ–¹å¼ä¹‹ä¸€æ˜¯ä½¿å‡½æ•°åœ¨æ˜¯å¦æ‹¥æœ‰æ‰€æœ‰æƒä¸Šé€šç”¨ã€‚\n// accepts: // - \u0026amp;str // - \u0026amp;String fn takes_str(s: \u0026amp;str){// use \u0026amp;str }// accepts: // - \u0026amp;str // - \u0026amp;String // - String fn takes_asref_str\u0026lt;S: AsRef\u0026lt;str\u0026gt;\u0026gt;(s: S){lets: \u0026amp;str =s.as_ref();// use \u0026amp;str }fn example(slice: \u0026amp;str,borrow: \u0026amp;String,owned: String){takes_str(slice);takes_str(borrow);takes_str(owned);// âŒ takes_asref_str(slice);takes_asref_str(borrow);takes_asref_str(owned);// âœ… }The other most common use-case is returning a reference to inner private data wrapped by a type which protects some invariant. A good example from the standard library is String which is just a wrapper around Vec\u0026lt;u8\u0026gt;:\nå¦ä¸€ä¸ªæœ€å¸¸è§çš„ç”¨ä¾‹æ˜¯è¿”å›ä¸€ä¸ªå¯¹å†…éƒ¨ç§æœ‰æ•°æ®çš„å¼•ç”¨ï¼Œè¯¥æ•°æ®ç”±ä¸€ä¸ªä¿æŠ¤æŸäº›ä¸å˜æ€§çš„ç±»å‹åŒ…è£¹ã€‚æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯ Stringï¼Œå®ƒåªæ˜¯ Vec\u0026lt;u8\u0026gt; çš„ä¸€ä¸ªåŒ…è£…å™¨ã€‚\nstruct String {vec: Vec\u0026lt;u8\u0026gt;,}This inner Vec cannot be made public because if it was people could mutate any byte and break the String\u0026rsquo;s valid UTF-8 encoding. However, it\u0026rsquo;s safe to expose an immutable read-only reference to the inner byte array, hence this impl: è¿™ä¸ªå†…éƒ¨çš„ Vec ä¸èƒ½è¢«å…¬å¼€ï¼Œå› ä¸ºå¦‚æœå®ƒè¢«å…¬å¼€ï¼Œäººä»¬å¯ä»¥æ”¹å˜ä»»ä½•å­—èŠ‚å¹¶ç ´å String çš„æœ‰æ•ˆ UTF-8 ç¼–ç ã€‚ç„¶è€Œï¼Œå…¬å¼€å†…éƒ¨å­—èŠ‚æ•°ç»„çš„ä¸å¯å˜çš„åªè¯»å¼•ç”¨æ˜¯å®‰å…¨çš„ï¼Œå› æ­¤æœ‰äº†è¿™ä¸ªå®ç°:\nimplAsRef\u0026lt;[u8]\u0026gt;forString;Generally, it often only makes sense to impl AsRef for a type if it wraps some other type to either provide additional functionality around the inner type or protect some invariant on the inner type.\nLet\u0026rsquo;s examine a example of bad AsRef impls: ä¸€èˆ¬æ¥è¯´ï¼Œåªæœ‰å½“ä¸€ä¸ªç±»å‹åŒ…è£…äº†å…¶ä»–ç±»å‹ï¼Œä¸ºå†…éƒ¨ç±»å‹æä¾›äº†é¢å¤–çš„åŠŸèƒ½ï¼Œæˆ–è€…ä¿æŠ¤äº†å†…éƒ¨ç±»å‹çš„æŸäº›ä¸å˜æ€§æ—¶ï¼Œä¸ºå…¶å®ç° AsRef æ‰æœ‰æ„ä¹‰ã€‚\nè®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€ä¸ªä¸å¥½çš„ AsRef å®ç°çš„ä¾‹å­ã€‚\nstruct User{name: String,age: u32,}implAsRef\u0026lt;String\u0026gt;forUser{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;String {\u0026amp;self.name}}implAsRef\u0026lt;u32\u0026gt;forUser{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;u32 {\u0026amp;self.age}}This works and kinda makes sense at first, but quickly falls apart if we add more members to User: è¿™åœ¨ä¸€å¼€å§‹æ˜¯å¯è¡Œçš„ï¼Œè€Œä¸”æœ‰ç‚¹é“ç†ï¼Œä½†å¦‚æœæˆ‘ä»¬ç»™ User å¢åŠ æ›´å¤šçš„æˆå‘˜ï¼Œå¾ˆå¿«å°±ä¼šå´©æºƒã€‚\nstruct User{name: String,email: String,age: u32,height: u32,}implAsRef\u0026lt;String\u0026gt;forUser{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;String {// uh, do we return name or email here? }}implAsRef\u0026lt;u32\u0026gt;forUser{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;u32 {// uh, do we return age or height here? }}A User is composed of Strings and u32s but it\u0026rsquo;s not really the same thing as a String or a u32. Even if we had much more specific types: User æ˜¯ç”± String å’Œ u32 ç»„æˆçš„ï¼Œä½†å®ƒå’Œ String æˆ– u32 å¹¶ä¸æ˜¯çœŸæ­£çš„ä¸€å›äº‹ã€‚å³ä½¿æˆ‘ä»¬æœ‰æ›´å…·ä½“çš„ç±»å‹ã€‚\nstruct User{name: Name,email: Email,age: Age,height: Height,}It wouldn\u0026rsquo;t make much sense to impl AsRef for any of those because AsRef is for cheap reference to reference conversions between semantically equivalent things, and Name, Email, Age, and Height by themselves are not the same thing as a User.\nA good example where we would impl AsRef would be if we introduced a new type Moderator that just wrapped a User and added some moderation specific privileges: å®ç° AsRef å¯¹è¿™äº›éƒ½æ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸º AsRef æ˜¯ç”¨æ¥åœ¨è¯­ä¹‰ä¸Šç­‰åŒçš„äº‹ç‰©ä¹‹é—´è¿›è¡Œå»‰ä»·çš„å¼•ç”¨è½¬æ¢ï¼Œè€Œ Nameã€Emailã€Age å’Œ Height æœ¬èº«å°±å’Œ User ä¸æ˜¯ä¸€å›äº‹ã€‚\nä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å¼•å…¥ä¸€ä¸ªæ–°çš„ç±»å‹ Moderatorï¼Œå®ƒåªæ˜¯åŒ…è£¹äº†ä¸€ä¸ª Userï¼Œå¹¶å¢åŠ äº†ä¸€äº›ç‰¹å®šçš„ç®¡ç†æƒé™ï¼Œæˆ‘ä»¬å°±ä¼šä½¿ç”¨ AsRefã€‚\nstruct User{name: String,age: u32,}// unfortunately the standard library cannot provide // a generic blanket impl to save us from this boilerplate implAsRef\u0026lt;User\u0026gt;forUser{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;User{self}}enum Privilege{BanUsers,EditPosts,DeletePosts,}// although Moderators have some special // privileges they are still regular Users // and should be able to do all the same stuff struct Moderator{user: User,privileges: Vec\u0026lt;Privilege\u0026gt;}implAsRef\u0026lt;Moderator\u0026gt;forModerator{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;Moderator{self}}implAsRef\u0026lt;User\u0026gt;forModerator{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;User{\u0026amp;self.user}}// this should be callable with Users // and Moderators (who are also Users) fn create_post\u0026lt;U: AsRef\u0026lt;User\u0026gt;\u0026gt;(u: U){letuser=u.as_ref();// etc }fn example(user: User,moderator: Moderator){create_post(\u0026amp;user);create_post(\u0026amp;moderator);// âœ… }This works because Moderators are just Users. Here\u0026rsquo;s the example from the Deref section except using AsRef instead: è¿™æ ·åšæ˜¯å› ä¸º Moderator å°±æ˜¯ Userã€‚ä¸‹é¢æ˜¯ Deref éƒ¨åˆ†çš„ä¾‹å­ï¼Œåªæ˜¯ç”¨ AsRef ä»£æ›¿ã€‚\nusestd::convert::AsRef;struct Human{health_points: u32,}implAsRef\u0026lt;Human\u0026gt;forHuman{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;Human{self}}enum Weapon{Spear,Axe,Sword,}// a Soldier is just a Human with a Weapon struct Soldier{human: Human,weapon: Weapon,}implAsRef\u0026lt;Soldier\u0026gt;forSoldier{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;Soldier{self}}implAsRef\u0026lt;Human\u0026gt;forSoldier{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;Human{\u0026amp;self.human}}enum Mount{Horse,Donkey,Cow,}// a Knight is just a Soldier with a Mount struct Knight{soldier: Soldier,mount: Mount,}implAsRef\u0026lt;Knight\u0026gt;forKnight{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;Knight{self}}implAsRef\u0026lt;Soldier\u0026gt;forKnight{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;Soldier{\u0026amp;self.soldier}}implAsRef\u0026lt;Human\u0026gt;forKnight{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;Human{\u0026amp;self.soldier.human}}enum Spell{MagicMissile,FireBolt,ThornWhip,}// a Mage is just a Human who can cast Spells struct Mage{human: Human,spells: Vec\u0026lt;Spell\u0026gt;,}implAsRef\u0026lt;Mage\u0026gt;forMage{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;Mage{self}}implAsRef\u0026lt;Human\u0026gt;forMage{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;Human{\u0026amp;self.human}}enum Staff{Wooden,Metallic,Plastic,}// a Wizard is just a Mage with a Staff struct Wizard{mage: Mage,staff: Staff,}implAsRef\u0026lt;Wizard\u0026gt;forWizard{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;Wizard{self}}implAsRef\u0026lt;Mage\u0026gt;forWizard{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;Mage{\u0026amp;self.mage}}implAsRef\u0026lt;Human\u0026gt;forWizard{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;Human{\u0026amp;self.mage.human}}fn borrows_human\u0026lt;H: AsRef\u0026lt;Human\u0026gt;\u0026gt;(human: H){}fn borrows_soldier\u0026lt;S: AsRef\u0026lt;Soldier\u0026gt;\u0026gt;(soldier: S){}fn borrows_knight\u0026lt;K: AsRef\u0026lt;Knight\u0026gt;\u0026gt;(knight: K){}fn borrows_mage\u0026lt;M: AsRef\u0026lt;Mage\u0026gt;\u0026gt;(mage: M){}fn borrows_wizard\u0026lt;W: AsRef\u0026lt;Wizard\u0026gt;\u0026gt;(wizard: W){}fn example(human: Human,soldier: Soldier,knight: Knight,mage: Mage,wizard: Wizard){// all types can be used as Humans borrows_human(\u0026amp;human);borrows_human(\u0026amp;soldier);borrows_human(\u0026amp;knight);borrows_human(\u0026amp;mage);borrows_human(\u0026amp;wizard);// Knights can be used as Soldiers borrows_soldier(\u0026amp;soldier);borrows_soldier(\u0026amp;knight);// Wizards can be used as Mages borrows_mage(\u0026amp;mage);borrows_mage(\u0026amp;wizard);// Knights \u0026amp; Wizards passed as themselves borrows_knight(\u0026amp;knight);borrows_wizard(\u0026amp;wizard);}Deref didn\u0026rsquo;t work in the prior version of the example above because deref coercion is an implicit conversion between types which leaves room for people to mistakenly formulate the wrong ideas and expectations for how it will behave. AsRef works above because it makes the conversion between types explicit and there\u0026rsquo;s no room leftover to develop any wrong ideas or expectations. Deref åœ¨ä¸Šè¿°ä¾‹å­çš„å…ˆå‰ç‰ˆæœ¬ä¸­ä¸èµ·ä½œç”¨ï¼Œå› ä¸º deref coercion æ˜¯ä¸€ç§éšå¼ç±»å‹è½¬æ¢ï¼Œä¸ºäººä»¬é”™è¯¯åœ°åˆ¶å®šé”™è¯¯çš„æƒ³æ³•å’ŒæœŸæœ›ç•™ä¸‹äº†ç©ºé—´ã€‚AsRef åœ¨ä¸Šé¢èµ·ä½œç”¨ï¼Œå› ä¸ºå®ƒä½¿ç±»å‹é—´çš„è½¬æ¢å˜å¾—æ˜ç¡®ï¼Œæ²¡æœ‰ä½™åœ°æ¥å‘å±•ä»»ä½•é”™è¯¯çš„æƒ³æ³•æˆ–æœŸæœ›ã€‚\nBorrow \u0026amp; BorrowMut é¢„å¤‡çŸ¥è¯†\n Self Methods Generic Parameters Subtraits \u0026amp; Supertraits Sized AsRef \u0026amp; AsMut PartialEq \u0026amp; Eq Hash PartialOrd \u0026amp; Ord  traitBorrow\u0026lt;Borrowed\u0026gt;whereBorrowed: ?Sized,{fn borrow(\u0026amp;self)-\u0026gt; \u0026amp;Borrowed;}traitBorrowMut\u0026lt;Borrowed\u0026gt;: Borrow\u0026lt;Borrowed\u0026gt;whereBorrowed: ?Sized,{fn borrow_mut(\u0026amp;mutself)-\u0026gt; \u0026amp;mutBorrowed;}These traits were invented to solve the very specific problem of looking up String keys in HashSets, HashMaps, BTreeSets, and BTreeMaps using \u0026amp;str values.\nWe can view Borrow\u0026lt;T\u0026gt; and BorrowMut\u0026lt;T\u0026gt; as stricter versions of AsRef\u0026lt;T\u0026gt; and AsMut\u0026lt;T\u0026gt;, where the returned reference \u0026amp;T has equivalent Eq, Hash, and Ord impls to Self. This is more easily explained with a commented example: è¿™äº› trait çš„å‘æ˜æ˜¯ä¸ºäº†è§£å†³åœ¨ HashSet, HashMap, BTreeSet, å’Œ BTreeMap ä¸­ä½¿ç”¨ \u0026amp;str å€¼æŸ¥æ‰¾ String é”®çš„ç‰¹æ®Šé—®é¢˜ã€‚\næˆ‘ä»¬å¯ä»¥æŠŠ Borrow\u0026lt;T\u0026gt; å’Œ BorrowMut\u0026lt;T\u0026gt; çœ‹ä½œæ˜¯ AsRef\u0026lt;T\u0026gt; å’Œ AsMut\u0026lt;T\u0026gt; çš„æ›´ä¸¥æ ¼çš„ç‰ˆæœ¬ï¼Œå…¶ä¸­è¿”å›çš„å¼•ç”¨ \u0026amp;T ä¸ Self çš„ Eqã€Hash å’Œ Ord ç­‰å€¼ã€‚ç”¨ä¸€ä¸ªæ³¨é‡Šçš„ä¾‹å­å¯ä»¥æ›´å®¹æ˜“åœ°è§£é‡Šè¿™ä¸ªé—®é¢˜ã€‚\nusestd::borrow::Borrow;usestd:#ï¸âƒ£:Hasher;usestd::collections::hash_map::DefaultHasher;usestd:#ï¸âƒ£:Hash;fn get_hash\u0026lt;T: Hash\u0026gt;(t: T)-\u0026gt; u64 {letmuthasher=DefaultHasher::new();t.hash(\u0026amp;muthasher);hasher.finish()}fn asref_example\u0026lt;Owned,Ref\u0026gt;(owned1: Owned,owned2: Owned)whereOwned: Eq +Ord+Hash+AsRef\u0026lt;Ref\u0026gt;,Ref: Eq +Ord+Hash{letref1: \u0026amp;Ref=owned1.as_ref();letref2: \u0026amp;Ref=owned2.as_ref();// refs aren\u0026#39;t required to be equal if owned types are equal assert_eq!(owned1==owned2,ref1==ref2);// âŒ letowned1_hash=get_hash(\u0026amp;owned1);letowned2_hash=get_hash(\u0026amp;owned2);letref1_hash=get_hash(\u0026amp;ref1);letref2_hash=get_hash(\u0026amp;ref2);// ref hashes aren\u0026#39;t required to be equal if owned type hashes are equal assert_eq!(owned1_hash==owned2_hash,ref1_hash==ref2_hash);// âŒ // ref comparisons aren\u0026#39;t required to match owned type comparisons assert_eq!(owned1.cmp(\u0026amp;owned2),ref1.cmp(\u0026amp;ref2));// âŒ }fn borrow_example\u0026lt;Owned,Borrowed\u0026gt;(owned1: Owned,owned2: Owned)whereOwned: Eq +Ord+Hash+Borrow\u0026lt;Borrowed\u0026gt;,Borrowed: Eq +Ord+Hash{letborrow1: \u0026amp;Borrowed=owned1.borrow();letborrow2: \u0026amp;Borrowed=owned2.borrow();// borrows are required to be equal if owned types are equal assert_eq!(owned1==owned2,borrow1==borrow2);// âœ… letowned1_hash=get_hash(\u0026amp;owned1);letowned2_hash=get_hash(\u0026amp;owned2);letborrow1_hash=get_hash(\u0026amp;borrow1);letborrow2_hash=get_hash(\u0026amp;borrow2);// borrow hashes are required to be equal if owned type hashes are equal assert_eq!(owned1_hash==owned2_hash,borrow1_hash==borrow2_hash);// âœ… // borrow comparisons are required to match owned type comparisons assert_eq!(owned1.cmp(\u0026amp;owned2),borrow1.cmp(\u0026amp;borrow2));// âœ… }It\u0026rsquo;s good to be aware of these traits and understand why they exist since it helps demystify some of the methods on HashSet, HashMap, BTreeSet, and BTreeMap but it\u0026rsquo;s very rare that we would ever need to impl these traits for any of our types because it\u0026rsquo;s very rare that we would ever need create a pair of types where one is the \u0026ldquo;borrowed\u0026rdquo; version of the other in the first place. If we have some T then \u0026amp;T will get the job done 99.99% of the time, and T: Borrow\u0026lt;T\u0026gt; is already implemented for all T because of a generic blanket impl, so we don\u0026rsquo;t need to manually impl it and we don\u0026rsquo;t need to create some U such that T: Borrow\u0026lt;U\u0026gt;.\nçŸ¥é“è¿™äº› trait å¹¶ç†è§£å®ƒä»¬å­˜åœ¨çš„åŸå› æ˜¯å¾ˆå¥½çš„ï¼Œå› ä¸ºè¿™æœ‰åŠ©äºè§£å¼€ HashSetã€HashMapã€BTreeSet å’Œ BTreeMap ä¸Šçš„ä¸€äº›æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬å¾ˆå°‘éœ€è¦ä¸ºæˆ‘ä»¬çš„ä»»ä½•ç±»å‹å®ç°è¿™äº› traitï¼Œå› ä¸ºæˆ‘ä»¬å¾ˆå°‘éœ€è¦åˆ›å»ºä¸€å¯¹ç±»å‹ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯å¦ä¸€ä¸ªçš„ \u0026ldquo;å€Ÿç”¨\u0026rdquo; ç‰ˆæœ¬ã€‚å¦‚æœæˆ‘ä»¬æœ‰ä¸€äº› Tï¼Œé‚£ä¹ˆ T åœ¨ 99.99% çš„æƒ…å†µä¸‹éƒ½èƒ½å®Œæˆå·¥ä½œï¼Œè€Œä¸” T: Borrow\u0026lt;T\u0026gt; å·²ç»ä¸ºæ‰€æœ‰çš„ T å®ç°äº†ï¼Œå› ä¸ºæœ‰ä¸€ä¸ªé€šç”¨çš„ä¸€æ½å­å®ç°ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨å®ç°å®ƒï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦åˆ›å»ºä¸€äº› Uï¼Œä½¿ T: Borrow\u0026lt;U\u0026gt;ã€‚\nToOwned é¢„å¤‡çŸ¥è¯†\n Self Methods Default Impls Clone Borrow \u0026amp; BorrowMut  traitToOwned{type Owned: Borrow\u0026lt;Self\u0026gt;;fn to_owned(\u0026amp;self)-\u0026gt; Self::Owned;// provided default impls fn clone_into(\u0026amp;self,target: \u0026amp;mutSelf::Owned);}ToOwned is a more generic version of Clone. Clone allows us to take a \u0026amp;T and turn it into an T but ToOwned allows us to take a \u0026amp;Borrowed and turn it into a Owned where Owned: Borrow\u0026lt;Borrowed\u0026gt;.\nIn other words, we can\u0026rsquo;t \u0026ldquo;clone\u0026rdquo; a \u0026amp;str into a String, or a \u0026amp;Path into a PathBuf, or an \u0026amp;OsStr into an OsString, since the clone method signature doesn\u0026rsquo;t support this kind of cross-type cloning, and that\u0026rsquo;s what ToOwned was made for.\nFor similar reasons as Borrow and BorrowMut, it\u0026rsquo;s good to be aware of this trait and understand why it exists but it\u0026rsquo;s very rare we\u0026rsquo;ll ever need to impl it for any of our types.\nToOwned æ˜¯ Clone çš„ä¸€ä¸ªæ›´é€šç”¨çš„ç‰ˆæœ¬ã€‚Clone å…è®¸æˆ‘ä»¬æŠŠä¸€ä¸ª \u0026amp;T å˜æˆä¸€ä¸ª Tï¼Œä½† ToOwned å…è®¸æˆ‘ä»¬æŠŠä¸€ä¸ª \u0026amp;Borrowed å˜æˆä¸€ä¸ª Ownedï¼Œå…¶ä¸­ Owned: Borrow\u0026lt;Borrowed\u0026gt;ã€‚\næ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬ä¸èƒ½æŠŠä¸€ä¸ª \u0026amp;str å…‹éš†æˆä¸€ä¸ª Stringï¼Œæˆ–è€…æŠŠä¸€ä¸ª \u0026amp;Path å…‹éš†æˆä¸€ä¸ª PathBufï¼Œæˆ–è€…æŠŠä¸€ä¸ª \u0026amp;OsStr å…‹éš†æˆä¸€ä¸ª OsStringï¼Œå› ä¸º clone æ–¹æ³•ç­¾åä¸æ”¯æŒè¿™ç§è·¨ç±»å‹å…‹éš†ï¼Œè€Œè¿™æ­£æ˜¯ ToOwned çš„ç”¨é€”ã€‚\nå‡ºäºä¸ Borrow å’Œ BorrowMut ç±»ä¼¼çš„åŸå› ï¼ŒçŸ¥é“è¿™ä¸ª trait å¹¶ç†è§£å®ƒå­˜åœ¨çš„åŸå› æ˜¯å¾ˆå¥½çš„ï¼Œä½†æˆ‘ä»¬å¾ˆå°‘éœ€è¦ä¸ºæˆ‘ä»¬çš„ä»»ä½•ç±»å‹å®ç°è¿™ä¸ª traitã€‚\nIteration Traits Iterator é¢„å¤‡çŸ¥è¯†\n Self Methods Associated Types Default Impls  traitIterator{type Item;fn next(\u0026amp;mutself)-\u0026gt; Option\u0026lt;Self::Item\u0026gt;;// provided default impls fn size_hint(\u0026amp;self)-\u0026gt; (usize,Option\u0026lt;usize\u0026gt;);fn count(self)-\u0026gt; usize;fn last(self)-\u0026gt; Option\u0026lt;Self::Item\u0026gt;;fn advance_by(\u0026amp;mutself,n: usize)-\u0026gt; Result\u0026lt;(),usize\u0026gt;;fn nth(\u0026amp;mutself,n: usize)-\u0026gt; Option\u0026lt;Self::Item\u0026gt;;fn step_by(self,step: usize)-\u0026gt; StepBy\u0026lt;Self\u0026gt;;fn chain\u0026lt;U\u0026gt;(self,other: U)-\u0026gt; Chain\u0026lt;Self,\u0026lt;UasIntoIterator\u0026gt;::IntoIter\u0026gt;whereU: IntoIterator\u0026lt;Item=Self::Item\u0026gt;;fn zip\u0026lt;U\u0026gt;(self,other: U)-\u0026gt; Zip\u0026lt;Self,\u0026lt;UasIntoIterator\u0026gt;::IntoIter\u0026gt;whereU: IntoIterator;fn map\u0026lt;B,F\u0026gt;(self,f: F)-\u0026gt; Map\u0026lt;Self,F\u0026gt;whereF: FnMut(Self::Item)-\u0026gt; B;fn for_each\u0026lt;F\u0026gt;(self,f: F)whereF: FnMut(Self::Item);fn filter\u0026lt;P\u0026gt;(self,predicate: P)-\u0026gt; Filter\u0026lt;Self,P\u0026gt;whereP: FnMut(\u0026amp;Self::Item)-\u0026gt; bool;fn filter_map\u0026lt;B,F\u0026gt;(self,f: F)-\u0026gt; FilterMap\u0026lt;Self,F\u0026gt;whereF: FnMut(Self::Item)-\u0026gt; Option\u0026lt;B\u0026gt;;fn enumerate(self)-\u0026gt; Enumerate\u0026lt;Self\u0026gt;;fn peekable(self)-\u0026gt; Peekable\u0026lt;Self\u0026gt;;fn skip_while\u0026lt;P\u0026gt;(self,predicate: P)-\u0026gt; SkipWhile\u0026lt;Self,P\u0026gt;whereP: FnMut(\u0026amp;Self::Item)-\u0026gt; bool;fn take_while\u0026lt;P\u0026gt;(self,predicate: P)-\u0026gt; TakeWhile\u0026lt;Self,P\u0026gt;whereP: FnMut(\u0026amp;Self::Item)-\u0026gt; bool;fn map_while\u0026lt;B,P\u0026gt;(self,predicate: P)-\u0026gt; MapWhile\u0026lt;Self,P\u0026gt;whereP: FnMut(Self::Item)-\u0026gt; Option\u0026lt;B\u0026gt;;fn skip(self,n: usize)-\u0026gt; Skip\u0026lt;Self\u0026gt;;fn take(self,n: usize)-\u0026gt; Take\u0026lt;Self\u0026gt;;fn scan\u0026lt;St,B,F\u0026gt;(self,initial_state: St,f: F)-\u0026gt; Scan\u0026lt;Self,St,F\u0026gt;whereF: FnMut(\u0026amp;mutSt,Self::Item)-\u0026gt; Option\u0026lt;B\u0026gt;;fn flat_map\u0026lt;U,F\u0026gt;(self,f: F)-\u0026gt; FlatMap\u0026lt;Self,U,F\u0026gt;whereF: FnMut(Self::Item)-\u0026gt; U,U: IntoIterator;fn flatten(self)-\u0026gt; Flatten\u0026lt;Self\u0026gt;whereSelf::Item: IntoIterator;fn fuse(self)-\u0026gt; Fuse\u0026lt;Self\u0026gt;;fn inspect\u0026lt;F\u0026gt;(self,f: F)-\u0026gt; Inspect\u0026lt;Self,F\u0026gt;whereF: FnMut(\u0026amp;Self::Item);fn by_ref(\u0026amp;mutself)-\u0026gt; \u0026amp;mutSelf;fn collect\u0026lt;B\u0026gt;(self)-\u0026gt; BwhereB: FromIterator\u0026lt;Self::Item\u0026gt;;fn partition\u0026lt;B,F\u0026gt;(self,f: F)-\u0026gt; (B,B)whereF: FnMut(\u0026amp;Self::Item)-\u0026gt; bool,B: Default +Extend\u0026lt;Self::Item\u0026gt;;fn partition_in_place\u0026lt;\u0026#39;a,T,P\u0026gt;(self,predicate: P)-\u0026gt; usize whereSelf: DoubleEndedIterator\u0026lt;Item=\u0026amp;\u0026#39;amutT\u0026gt;,T: \u0026#39;a,P: FnMut(\u0026amp;T)-\u0026gt; bool;fn is_partitioned\u0026lt;P\u0026gt;(self,predicate: P)-\u0026gt; bool whereP: FnMut(Self::Item)-\u0026gt; bool;fn try_fold\u0026lt;B,F,R\u0026gt;(\u0026amp;mutself,init: B,f: F)-\u0026gt; RwhereF: FnMut(B,Self::Item)-\u0026gt; R,R: Try\u0026lt;Ok=B\u0026gt;;fn try_for_each\u0026lt;F,R\u0026gt;(\u0026amp;mutself,f: F)-\u0026gt; RwhereF: FnMut(Self::Item)-\u0026gt; R,R: Try\u0026lt;Ok=()\u0026gt;;fn fold\u0026lt;B,F\u0026gt;(self,init: B,f: F)-\u0026gt; BwhereF: FnMut(B,Self::Item)-\u0026gt; B;fn fold_first\u0026lt;F\u0026gt;(self,f: F)-\u0026gt; Option\u0026lt;Self::Item\u0026gt;whereF: FnMut(Self::Item,Self::Item)-\u0026gt; Self::Item;fn all\u0026lt;F\u0026gt;(\u0026amp;mutself,f: F)-\u0026gt; bool whereF: FnMut(Self::Item)-\u0026gt; bool;fn any\u0026lt;F\u0026gt;(\u0026amp;mutself,f: F)-\u0026gt; bool whereF: FnMut(Self::Item)-\u0026gt; bool;fn find\u0026lt;P\u0026gt;(\u0026amp;mutself,predicate: P)-\u0026gt; Option\u0026lt;Self::Item\u0026gt;whereP: FnMut(\u0026amp;Self::Item)-\u0026gt; bool;fn find_map\u0026lt;B,F\u0026gt;(\u0026amp;mutself,f: F)-\u0026gt; Option\u0026lt;B\u0026gt;whereF: FnMut(Self::Item)-\u0026gt; Option\u0026lt;B\u0026gt;;fn try_find\u0026lt;F,R\u0026gt;(\u0026amp;mutself,f: F)-\u0026gt; Result\u0026lt;Option\u0026lt;Self::Item\u0026gt;,\u0026lt;RasTry\u0026gt;::Error\u0026gt;whereF: FnMut(\u0026amp;Self::Item)-\u0026gt; R,R: Try\u0026lt;Ok=bool\u0026gt;;fn position\u0026lt;P\u0026gt;(\u0026amp;mutself,predicate: P)-\u0026gt; Option\u0026lt;usize\u0026gt;whereP: FnMut(Self::Item)-\u0026gt; bool;fn rposition\u0026lt;P\u0026gt;(\u0026amp;mutself,predicate: P)-\u0026gt; Option\u0026lt;usize\u0026gt;whereSelf: ExactSizeIterator +DoubleEndedIterator,P: FnMut(Self::Item)-\u0026gt; bool;fn max(self)-\u0026gt; Option\u0026lt;Self::Item\u0026gt;whereSelf::Item: Ord;fn min(self)-\u0026gt; Option\u0026lt;Self::Item\u0026gt;whereSelf::Item: Ord;fn max_by_key\u0026lt;B,F\u0026gt;(self,f: F)-\u0026gt; Option\u0026lt;Self::Item\u0026gt;whereF: FnMut(\u0026amp;Self::Item)-\u0026gt; B,B: Ord;fn max_by\u0026lt;F\u0026gt;(self,compare: F)-\u0026gt; Option\u0026lt;Self::Item\u0026gt;whereF: FnMut(\u0026amp;Self::Item,\u0026amp;Self::Item)-\u0026gt; Ordering;fn min_by_key\u0026lt;B,F\u0026gt;(self,f: F)-\u0026gt; Option\u0026lt;Self::Item\u0026gt;whereF: FnMut(\u0026amp;Self::Item)-\u0026gt; B,B: Ord;fn min_by\u0026lt;F\u0026gt;(self,compare: F)-\u0026gt; Option\u0026lt;Self::Item\u0026gt;whereF: FnMut(\u0026amp;Self::Item,\u0026amp;Self::Item)-\u0026gt; Ordering;fn rev(self)-\u0026gt; Rev\u0026lt;Self\u0026gt;whereSelf: DoubleEndedIterator;fn unzip\u0026lt;A,B,FromA,FromB\u0026gt;(self)-\u0026gt; (FromA,FromB)whereSelf: Iterator\u0026lt;Item=(A,B)\u0026gt;,FromA: Default +Extend\u0026lt;A\u0026gt;,FromB: Default +Extend\u0026lt;B\u0026gt;;fn copied\u0026lt;\u0026#39;a,T\u0026gt;(self)-\u0026gt; Copied\u0026lt;Self\u0026gt;whereSelf: Iterator\u0026lt;Item=\u0026amp;\u0026#39;aT\u0026gt;,T: \u0026#39;a+Copy;fn cloned\u0026lt;\u0026#39;a,T\u0026gt;(self)-\u0026gt; Cloned\u0026lt;Self\u0026gt;whereSelf: Iterator\u0026lt;Item=\u0026amp;\u0026#39;aT\u0026gt;,T: \u0026#39;a+Clone;fn cycle(self)-\u0026gt; Cycle\u0026lt;Self\u0026gt;whereSelf: Clone;fn sum\u0026lt;S\u0026gt;(self)-\u0026gt; SwhereS: Sum\u0026lt;Self::Item\u0026gt;;fn product\u0026lt;P\u0026gt;(self)-\u0026gt; PwhereP: Product\u0026lt;Self::Item\u0026gt;;fn cmp\u0026lt;I\u0026gt;(self,other: I)-\u0026gt; OrderingwhereI: IntoIterator\u0026lt;Item=Self::Item\u0026gt;,Self::Item: Ord;fn cmp_by\u0026lt;I,F\u0026gt;(self,other: I,cmp: F)-\u0026gt; OrderingwhereF: FnMut(Self::Item,\u0026lt;IasIntoIterator\u0026gt;::Item)-\u0026gt; Ordering,I: IntoIterator;fn partial_cmp\u0026lt;I\u0026gt;(self,other: I)-\u0026gt; Option\u0026lt;Ordering\u0026gt;whereI: IntoIterator,Self::Item: PartialOrd\u0026lt;\u0026lt;IasIntoIterator\u0026gt;::Item\u0026gt;;fn partial_cmp_by\u0026lt;I,F\u0026gt;(self,other: I,partial_cmp: F)-\u0026gt; Option\u0026lt;Ordering\u0026gt;whereF: FnMut(Self::Item,\u0026lt;IasIntoIterator\u0026gt;::Item)-\u0026gt; Option\u0026lt;Ordering\u0026gt;,I: IntoIterator;fn eq\u0026lt;I\u0026gt;(self,other: I)-\u0026gt; bool whereI: IntoIterator,Self::Item: PartialEq\u0026lt;\u0026lt;IasIntoIterator\u0026gt;::Item\u0026gt;;fn eq_by\u0026lt;I,F\u0026gt;(self,other: I,eq: F)-\u0026gt; bool whereF: FnMut(Self::Item,\u0026lt;IasIntoIterator\u0026gt;::Item)-\u0026gt; bool,I: IntoIterator;fn ne\u0026lt;I\u0026gt;(self,other: I)-\u0026gt; bool whereI: IntoIterator,Self::Item: PartialEq\u0026lt;\u0026lt;IasIntoIterator\u0026gt;::Item\u0026gt;;fn lt\u0026lt;I\u0026gt;(self,other: I)-\u0026gt; bool whereI: IntoIterator,Self::Item: PartialOrd\u0026lt;\u0026lt;IasIntoIterator\u0026gt;::Item\u0026gt;;fn le\u0026lt;I\u0026gt;(self,other: I)-\u0026gt; bool whereI: IntoIterator,Self::Item: PartialOrd\u0026lt;\u0026lt;IasIntoIterator\u0026gt;::Item\u0026gt;;fn gt\u0026lt;I\u0026gt;(self,other: I)-\u0026gt; bool whereI: IntoIterator,Self::Item: PartialOrd\u0026lt;\u0026lt;IasIntoIterator\u0026gt;::Item\u0026gt;;fn ge\u0026lt;I\u0026gt;(self,other: I)-\u0026gt; bool whereI: IntoIterator,Self::Item: PartialOrd\u0026lt;\u0026lt;IasIntoIterator\u0026gt;::Item\u0026gt;;fn is_sorted(self)-\u0026gt; bool whereSelf::Item: PartialOrd\u0026lt;Self::Item\u0026gt;;fn is_sorted_by\u0026lt;F\u0026gt;(self,compare: F)-\u0026gt; bool whereF: FnMut(\u0026amp;Self::Item,\u0026amp;Self::Item)-\u0026gt; Option\u0026lt;Ordering\u0026gt;;fn is_sorted_by_key\u0026lt;F,K\u0026gt;(self,f: F)-\u0026gt; bool whereF: FnMut(Self::Item)-\u0026gt; K,K: PartialOrd\u0026lt;K\u0026gt;;}Iterator\u0026lt;Item = T\u0026gt; ç±»å‹å¯ä»¥è¢«è¿­ä»£ï¼Œå¹¶ä¼šäº§ç”Ÿ T ç±»å‹ã€‚æ²¡æœ‰ IteratorMut traitã€‚æ¯ä¸ª Iterator å®ç°å¯ä»¥é€šè¿‡ Item å…³è”ç±»å‹æŒ‡å®šå®ƒæ˜¯è¿”å›ä¸å¯å˜å¼•ç”¨ã€å¯å˜å¼•ç”¨è¿˜æ˜¯æ‹¥æœ‰å…¶å€¼ã€‚\n   Vec\u0026lt;T\u0026gt; æ–¹æ³• è¿”å›     .iter() Iterator\u0026lt;Item = \u0026amp;T\u0026gt;   .iter_mut() Iterator\u0026lt;Item = \u0026amp;mut T\u0026gt;   .into_iter() Iterator\u0026lt;Item = T\u0026gt;    å¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œæœ‰äº›ä¸œè¥¿ä¸æ˜¯å¾ˆæ˜æ˜¾ï¼Œä½†ä¸­çº§ Rustaceans è®¤ä¸ºæ˜¯ç†æ‰€å½“ç„¶çš„ï¼Œé‚£å°±æ˜¯å¤§å¤šæ•°ç±»å‹éƒ½ä¸æ˜¯ä»–ä»¬æœ¬èº«çš„è¿­ä»£å™¨ã€‚å¦‚æœä¸€ä¸ªç±»å‹æ˜¯å¯è¿­ä»£çš„ï¼Œæˆ‘ä»¬å‡ ä¹æ€»æ˜¯å®ç°ä¸€äº›è‡ªå®šä¹‰çš„è¿­ä»£å™¨ç±»å‹æ¥è¿­ä»£å®ƒï¼Œè€Œä¸æ˜¯è¯•å›¾è®©å®ƒè‡ªå·±è¿­ä»£ã€‚\nstruct MyType{items: Vec\u0026lt;String\u0026gt;}implMyType{fn iter(\u0026amp;self)-\u0026gt; implIterator\u0026lt;Item=\u0026amp;String\u0026gt;{MyTypeIterator{index: 0,items: \u0026amp;self.items}}}struct MyTypeIterator\u0026lt;\u0026#39;a\u0026gt;{index: usize,items: \u0026amp;\u0026#39;aVec\u0026lt;String\u0026gt;}impl\u0026lt;\u0026#39;a\u0026gt;IteratorforMyTypeIterator\u0026lt;\u0026#39;a\u0026gt;{type Item=\u0026amp;\u0026#39;aString;fn next(\u0026amp;mutself)-\u0026gt; Option\u0026lt;Self::Item\u0026gt;{ifself.index\u0026gt;=self.items.len(){None}else{letitem=\u0026amp;self.items[self.index];self.index+=1;Some(item)}}}ä¸ºäº†ä¾¿äºæ•™å­¦ï¼Œä¸Šé¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä»å¤´å¼€å§‹å®ç°ä¸€ä¸ª Iteratorï¼Œä½†åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¹ æƒ¯æ€§çš„è§£å†³æ–¹æ¡ˆå°†åªæ˜¯éµä» Vec çš„ iter æ–¹æ³•ã€‚\nstruct MyType{items: Vec\u0026lt;String\u0026gt;}implMyType{fn iter(\u0026amp;self)-\u0026gt; implIterator\u0026lt;Item=\u0026amp;String\u0026gt;{self.items.iter()}}å¦å¤–ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€šç”¨å…¨é¢å®ç°ï¼Œè¦æ³¨æ„ã€‚\nimpl\u0026lt;I: Iterator +?Sized\u0026gt;Iteratorfor\u0026amp;mutI;å®ƒè¯´ä»»ä½•å¯¹è¿­ä»£å™¨çš„å¯å˜å¼•ç”¨ä¹Ÿæ˜¯è¿­ä»£å™¨ï¼Œè¿™ä¸€ç‚¹å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸æˆ‘ä»¬ä½¿ç”¨ self æ¥æ”¶å™¨ï¼Œå°±åƒä½¿ç”¨ \u0026amp;mut self æ¥æ”¶å™¨ä¸€æ ·ã€‚äº†è§£è¿™ä¸€ç‚¹å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸æˆ‘ä»¬ä½¿ç”¨è¿­ä»£å™¨æ–¹æ³•ä¸ self æ¥æ”¶å™¨ï¼Œå°±åƒå®ƒä»¬æœ‰ \u0026amp;mut self æ¥æ”¶å™¨ä¸€æ ·ã€‚\nä¸¾ä¸ªä¾‹å­ï¼Œæƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå¯ä»¥å¤„ç†ä¸€ä¸ªè¶…è¿‡ä¸‰ä¸ªé¡¹çš„è¿­ä»£å™¨ï¼Œä½†æ˜¯å‡½æ•°çš„ç¬¬ä¸€æ­¥æ˜¯å–å‡ºè¿­ä»£å™¨çš„å‰ä¸‰é¡¹ï¼Œå¹¶åœ¨è¿­ä»£å‰©ä¸‹çš„é¡¹ä¹‹å‰åˆ†åˆ«å¤„ç†å®ƒä»¬ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªåˆå­¦è€…å¯èƒ½å°è¯•å†™è¿™ä¸ªå‡½æ•°çš„æ–¹æ³•ã€‚\nfn example\u0026lt;I: Iterator\u0026lt;Item=i32\u0026gt;\u0026gt;(mutiter: I){letfirst3: Vec\u0026lt;i32\u0026gt;=iter.take(3).collect();foriteminiter{// âŒ iter consumed in line above // process remaining items }}å—¯ï¼Œè¿™å¾ˆçƒ¦äººã€‚take æ–¹æ³•æœ‰ä¸€ä¸ª self æ¥æ”¶å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼¼ä¹ä¸èƒ½åœ¨ä¸æ¶ˆè€—æ•´ä¸ªè¿­ä»£å™¨çš„æƒ…å†µä¸‹è°ƒç”¨å®ƒã€‚ä¸‹é¢æ˜¯ä¸Šé¢ä»£ç çš„ä¸€ä¸ªå¤©çœŸçš„é‡æ„ã€‚\nfn example\u0026lt;I: Iterator\u0026lt;Item=i32\u0026gt;\u0026gt;(mutiter: I){letfirst3: Vec\u0026lt;i32\u0026gt;=vec![iter.next().unwrap(),iter.next().unwrap(),iter.next().unwrap(),];foriteminiter{// âœ… // process remaining items }}è¿™è¿˜ç®—å¥½çš„ã€‚ç„¶è€Œï¼Œæƒ¯ç”¨\u0008çš„é‡æ„å…¶å®æ˜¯è¿™æ ·çš„ã€‚\nfn example\u0026lt;I: Iterator\u0026lt;Item=i32\u0026gt;\u0026gt;(mutiter: I){letfirst3: Vec\u0026lt;i32\u0026gt;=iter.by_ref().take(3).collect();foriteminiter{// âœ… // process remaining items }}ä¸å¤ªå®¹æ˜“å‘ç°ã€‚ä½†æ— è®ºå¦‚ä½•ï¼Œç°åœ¨æˆ‘ä»¬çŸ¥é“äº†ã€‚\nå¦å¤–ï¼Œå¯¹äºä»€ä¹ˆå¯ä»¥æ˜¯è¿­ä»£å™¨ï¼Œä»€ä¹ˆä¸èƒ½æ˜¯è¿­ä»£å™¨ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆè§„åˆ™æˆ–çº¦å®šã€‚å¦‚æœç±»å‹æ˜¯ Iteratorï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ã€‚æ ‡å‡†åº“ä¸­çš„ä¸€äº›åˆ›é€ æ€§çš„ä¾‹å­å¦‚ä¸‹ã€‚\nusestd::sync::mpsc::channel;usestd::thread;fn paths_can_be_iterated(path: \u0026amp;Path){forpartinpath{// iterate over parts of a path }}fn receivers_can_be_iterated(){let(send,recv)=channel();thread::spawn(move||{send.send(1).unwrap();send.send(2).unwrap();send.send(3).unwrap();});forreceivedinrecv{// iterate over received values }}IntoIterator é¢„å¤‡çŸ¥è¯†\n Self Methods Associated Types Iterator  traitIntoIteratorwhere\u0026lt;Self::IntoIterasIterator\u0026gt;::Item==Self::Item,{type Item;type IntoIter: Iterator;fn into_iter(self)-\u0026gt; Self::IntoIter;}IntoIterator ç±»å‹å¯ä»¥è¢«è½¬æ¢ä¸ºè¿­ä»£å™¨ï¼Œå› æ­¤å¾—åã€‚å½“ä¸€ä¸ªç±»å‹åœ¨ for-in å¾ªç¯ä¸­ä½¿ç”¨æ—¶ï¼Œä¼šè°ƒç”¨ into_iter æ–¹æ³•ã€‚\n// vec = Vec\u0026lt;T\u0026gt; forvinvec{}// v = T // above line desugared forvinvec.into_iter(){}ä¸ä»… Vec å®ç°äº† IntoIteratorï¼Œå¦‚æœæˆ‘ä»¬æƒ³åˆ†åˆ«è¿­ä»£ä¸å¯å˜å¼•ç”¨æˆ–å¯å˜å¼•ç”¨è€Œä¸æ˜¯æ‹¥æœ‰å…¶å€¼ï¼Œ\u0026amp;Vec å’Œ \u0026amp;mut Vec ä¹Ÿåˆ†åˆ«å®ç°äº† IntoIteratorã€‚\n// vec = Vec\u0026lt;T\u0026gt; forvin\u0026amp;vec{}// v = \u0026amp;T // above example desugared forvin(\u0026amp;vec).into_iter(){}// vec = Vec\u0026lt;T\u0026gt; forvin\u0026amp;mutvec{}// v = \u0026amp;mut T // above example desugared forvin(\u0026amp;mutvec).into_iter(){}FromIterator é¢„å¤‡çŸ¥è¯†\n Self Functions Generic Parameters Iterator IntoIterator  traitFromIterator\u0026lt;A\u0026gt;{fn from_iter\u0026lt;T\u0026gt;(iter: T)-\u0026gt; SelfwhereT: IntoIterator\u0026lt;Item=A\u0026gt;;}FromIterator ç±»å‹å¯ä»¥ä»è¿­ä»£å™¨ä¸­åˆ›å»ºï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸º FromIteratorã€‚FromIterator æœ€å¸¸è§å’Œæœ€ä¹ æƒ¯çš„ç”¨æ³•æ˜¯è°ƒç”¨ Iterator ä¸Šçš„ collect æ–¹æ³•ã€‚\nfn collect\u0026lt;B\u0026gt;(self)-\u0026gt; BwhereB: FromIterator\u0026lt;Self::Item\u0026gt;;å°† Iterator\u0026lt;Item = char\u0026gt; æ”¶é›†æˆ String çš„ä¾‹å­å¦‚ä¸‹:\nfn filter_letters(string: \u0026amp;str)-\u0026gt; String {string.chars().filter(|c|c.is_alphabetic()).collect()}æ ‡å‡†åº“ä¸­çš„æ‰€æœ‰é›†åˆéƒ½å®ç°äº† IntoIterator å’Œ FromIteratorï¼Œè¿™æ ·å¯ä»¥æ›´å®¹æ˜“åœ¨å®ƒä»¬ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚\nusestd::collections::{BTreeSet,HashMap,HashSet,LinkedList};// String -\u0026gt; HashSet\u0026lt;char\u0026gt; fn unique_chars(string: \u0026amp;str)-\u0026gt; HashSet\u0026lt;char\u0026gt;{string.chars().collect()}// Vec\u0026lt;T\u0026gt; -\u0026gt; BTreeSet\u0026lt;T\u0026gt; fn ordered_unique_items\u0026lt;T: Ord\u0026gt;(vec: Vec\u0026lt;T\u0026gt;)-\u0026gt; BTreeSet\u0026lt;T\u0026gt;{vec.into_iter().collect()}// HashMap\u0026lt;K, V\u0026gt; -\u0026gt; LinkedList\u0026lt;(K, V)\u0026gt; fn entry_list\u0026lt;K,V\u0026gt;(map: HashMap\u0026lt;K,V\u0026gt;)-\u0026gt; LinkedList\u0026lt;(K,V)\u0026gt;{map.into_iter().collect()}// and countless more possible examples I/O Traits Read \u0026amp; Write é¢„å¤‡çŸ¥è¯†\n Self Methods Scope Generic Blanket Impls  traitRead{fn read(\u0026amp;mutself,buf: \u0026amp;mut[u8])-\u0026gt; Result\u0026lt;usize\u0026gt;;// provided default impls fn read_vectored(\u0026amp;mutself,bufs: \u0026amp;mut[IoSliceMut\u0026lt;\u0026#39;_\u0026gt;])-\u0026gt; Result\u0026lt;usize\u0026gt;;fn is_read_vectored(\u0026amp;self)-\u0026gt; bool;unsafefn initializer(\u0026amp;self)-\u0026gt; Initializer;fn read_to_end(\u0026amp;mutself,buf: \u0026amp;mutVec\u0026lt;u8\u0026gt;)-\u0026gt; Result\u0026lt;usize\u0026gt;;fn read_to_string(\u0026amp;mutself,buf: \u0026amp;mutString)-\u0026gt; Result\u0026lt;usize\u0026gt;;fn read_exact(\u0026amp;mutself,buf: \u0026amp;mut[u8])-\u0026gt; Result\u0026lt;()\u0026gt;;fn by_ref(\u0026amp;mutself)-\u0026gt; \u0026amp;mutSelfwhereSelf: Sized;fn bytes(self)-\u0026gt; Bytes\u0026lt;Self\u0026gt;whereSelf: Sized;fn chain\u0026lt;R: Read\u0026gt;(self,next: R)-\u0026gt; Chain\u0026lt;Self,R\u0026gt;whereSelf: Sized;fn take(self,limit: u64)-\u0026gt; Take\u0026lt;Self\u0026gt;whereSelf: Sized;}traitWrite{fn write(\u0026amp;mutself,buf: \u0026amp;[u8])-\u0026gt; Result\u0026lt;usize\u0026gt;;fn flush(\u0026amp;mutself)-\u0026gt; Result\u0026lt;()\u0026gt;;// provided default impls fn write_vectored(\u0026amp;mutself,bufs: \u0026amp;[IoSlice\u0026lt;\u0026#39;_\u0026gt;])-\u0026gt; Result\u0026lt;usize\u0026gt;;fn is_write_vectored(\u0026amp;self)-\u0026gt; bool;fn write_all(\u0026amp;mutself,buf: \u0026amp;[u8])-\u0026gt; Result\u0026lt;()\u0026gt;;fn write_all_vectored(\u0026amp;mutself,bufs: \u0026amp;mut[IoSlice\u0026lt;\u0026#39;_\u0026gt;])-\u0026gt; Result\u0026lt;()\u0026gt;;fn write_fmt(\u0026amp;mutself,fmt: Arguments\u0026lt;\u0026#39;_\u0026gt;)-\u0026gt; Result\u0026lt;()\u0026gt;;fn by_ref(\u0026amp;mutself)-\u0026gt; \u0026amp;mutSelfwhereSelf: Sized;}é€šç”¨çš„å…¨é¢å®ç°å€¼å¾—äº†è§£ã€‚\nimpl\u0026lt;R: Read+?Sized\u0026gt;Readfor\u0026amp;mutR;impl\u0026lt;W: Write+?Sized\u0026gt;Writefor\u0026amp;mutW;è¿™è¯´æ˜ä»»ä½•å¯¹ Read ç±»å‹çš„å¯å˜å¼•ç”¨ä¹Ÿæ˜¯ Readï¼Œå¯¹ Write ä¹Ÿæ˜¯å¦‚æ­¤ã€‚äº†è§£è¿™ä¸€ç‚¹å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸æˆ‘ä»¬ä½¿ç”¨ä»»ä½•å¸¦æœ‰ self æ¥æ”¶å™¨çš„æ–¹æ³•ï¼Œå°±åƒå®ƒæœ‰ä¸€ä¸ª \u0026amp;mut self æ¥æ”¶å™¨ä¸€æ ·ã€‚æˆ‘ä»¬å·²ç»åœ¨ Iterator trait éƒ¨åˆ†ä»‹ç»äº†å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ä»¥åŠä¸ºä»€ä¹ˆå®ƒå¾ˆæœ‰ç”¨ï¼Œæ‰€ä»¥æˆ‘ä¸æ‰“ç®—åœ¨è¿™é‡Œå†æ¬¡é‡å¤ã€‚\næˆ‘æƒ³æŒ‡å‡ºï¼Œ\u0026amp;[u8] å®ç°äº† Readï¼ŒVec\u0026lt;u8\u0026gt; å®ç°äº† Writeï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°ä½¿ç”¨ String å¯¹æˆ‘ä»¬çš„æ–‡ä»¶å¤„ç†å‡½æ•°è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œè¿™äº›å‡½æ•°å¾ˆå®¹æ˜“è½¬æ¢ä¸º \u0026amp;[u8] å’Œ Vec\u0026lt;u8\u0026gt;ã€‚\nusestd::path::Path;usestd::fs::File;usestd::io::Read;usestd::io::Write;usestd::io;// function we want to test fn uppercase\u0026lt;R: Read,W: Write\u0026gt;(mutread: R,mutwrite: W)-\u0026gt; Result\u0026lt;(),io::Error\u0026gt;{letmutbuffer=String::new();read.read_to_string(\u0026amp;mutbuffer)?;letuppercase=buffer.to_uppercase();write.write_all(uppercase.as_bytes())?;write.flush()?;Ok(())}// in actual program we\u0026#39;d pass Files fn example(in_path: \u0026amp;Path,out_path: \u0026amp;Path)-\u0026gt; Result\u0026lt;(),io::Error\u0026gt;{letin_file=File::open(in_path)?;letout_file=File::open(out_path)?;uppercase(in_file,out_file)}// however in unit tests we can use Strings! #[test]// âœ… fn example_test(){letin_file: String =\u0026#34;i am screaming\u0026#34;.into();letmutout_file: Vec\u0026lt;u8\u0026gt;=Vec::new();uppercase(in_file.as_bytes(),\u0026amp;mutout_file).unwrap();letout_result=String::from_utf8(out_file).unwrap();assert_eq!(out_result,\u0026#34;I AM SCREAMING\u0026#34;);}ç»“è®º æˆ‘ä»¬ä¸€èµ·å­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿! äº‹å®ä¸Šï¼Œå¤ªå¤šäº†ã€‚å®ƒç°åœ¨æ˜¯æˆ‘ä»¬çš„äº†:\nArtist credit: The Jenkins Comic\nè®¨è®º åœ¨è¿™é‡Œè®¨è®ºè¿™ç¯‡æ–‡ç« \n Github learnrust subreddit official Rust users forum Twitter lobste.rs rust subreddit  é€šçŸ¥ å½“ä¸‹ä¸€ç¯‡åšæ–‡å‘å¸ƒæ—¶ï¼Œä¼šæ”¶åˆ°é€šçŸ¥\n Following pretzelhammer on Twitter or Watching this repo\u0026rsquo;s releases (click Watch -\u0026gt; click Custom -\u0026gt; select Releases -\u0026gt; click Apply)  æ›´å¤šé˜…è¯»  Sizedness in Rust Common Rust Lifetime Misconceptions Learning Rust in 2020 Learn Assembly with Entirely Too Many Brainfuck Compilers  ","permalink":"https://ohmyweekly.github.io/notes/2021-05-19-a-tour-of-rusts-standard-library-traits/","tags":["Rust"],"title":"Rust æ ‡å‡†åº“ä¸­çš„ Trait ä¹‹æ—…"},{"categories":["rakulang"],"contents":"æˆ‘æœ€è¿‘å†™äº†ä¸€ç¯‡å…³äºæ–°çš„ MoarVM è°ƒåº¦æœºåˆ¶çš„æ–‡ç« ï¼Œå¹¶åœ¨é‚£ç¯‡æ–‡ç« ä¸­æŒ‡å‡ºï¼Œæˆ‘åœ¨ Raku çš„å¤šé‡åˆ†æ´¾è¯­ä¹‰æ–¹é¢è¿˜æœ‰ä¸å°‘éœ€è¦å®ç°çš„åœ°æ–¹ã€‚ä»é‚£ä»¥åï¼Œæˆ‘åœ¨è¿™ä¸ªæ–¹å‘ä¸Šå–å¾—äº†ä¸å°çš„è¿›å±•ã€‚è¿™ç¯‡æ–‡ç« åŒ…å«äº†å¯¹æ‰€é‡‡å–çš„æ–¹æ³•çš„æ¦‚è¿°ï¼Œä»¥åŠä¸€äº›éå¸¸ç²—ç•¥çš„æ€§èƒ½æµ‹é‡ã€‚\næˆ‘çš„å¤©å•Šï¼Œè¯­ä¹‰å¤ªå¤šäº† åœ¨ Raku çš„æ‰€æœ‰åˆ†æ´¾ä¸­ï¼Œå¤šé‡åˆ†æ´¾æ˜¯æœ€å¤æ‚çš„ã€‚å¤šé‡åˆ†æ´¾å…è®¸æˆ‘ä»¬å†™ä¸€ç»„å€™é€‰è€…ï¼Œç„¶åæ ¹æ®å‚æ•°çš„æ•°é‡è¿›è¡Œé€‰æ‹©ã€‚\nmulti ok($condition, $desc) { say ($condition ?? \u0026#39;ok\u0026#39; !! \u0026#39;not ok\u0026#39;) ~ \u0026#34;- $desc\u0026#34;; } multi ok($condition) { ok($condition, \u0026#39;\u0026#39;); } æˆ–æ ¹æ®å‚æ•°çš„ç±»å‹:\nmulti to-json(Int $i) { ~$i } multi to-json(Bool $b) { $b ?? \u0026#39;true\u0026#39; !! \u0026#39;false\u0026#39; } è€Œä¸”ä¸åªæ˜¯ä¸€ä¸ªå‚æ•°ï¼Œè€Œæ˜¯å¯èƒ½æœ‰å¾ˆå¤šå‚æ•°:\nmulti truncate(Str $str, Int $chars) { $str.chars \u0026lt; $chars ?? $str !! $str.substr(0, $chars) ~ \u0026#39;...\u0026#39; } multi truncate(Str $str, Str $after) { with $str.index($after) -\u0026gt; $pos { $str.substr(0, $pos) ~ \u0026#39;...\u0026#39; } else { $str } } æˆ‘ä»¬å¯ä»¥æ·»åŠ  where å­å¥æ¥åŒºåˆ†æ™®é€šç±»å‹æ— æ³•æ•æ‰çš„å±æ€§ä¸Šçš„å€™é€‰è€…ã€‚\nmulti fac($n where $n \u0026lt;= 1) { 1 } multi fac($n) { $n * fac($n - 1) } æ¯å½“æˆ‘ä»¬å†™å‡ºä¸€ç»„è¿™æ ·çš„ multi å€™é€‰åˆ—è¡¨æ—¶ï¼Œç¼–è¯‘å™¨å°±ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª proto ä¾‹ç¨‹ã€‚è¿™å°±æ˜¯å®‰è£…åœ¨ç¬¦å·è¡¨ä¸­çš„ï¼Œå­˜æ”¾å€™é€‰åˆ—è¡¨çš„ä¸œè¥¿ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å†™è‡ªå·±çš„ protoï¼Œå¹¶ä½¿ç”¨ç‰¹æ®Šçš„æœ¯è¯­ {*} æ¥å†³å®šåœ¨å“ªä¸€ç‚¹ä¸Šè¿›è¡Œè°ƒåº¦ï¼Œå¦‚æœæœ‰çš„è¯ã€‚\nproto mean($collection) { $collection.elems == 0 ?? Nil !! {*} } multi mean(@arr) { @arr.sum / @arr.elems } multi mean(%hash) { %hash.values.sum / %hash.elems } å€™é€‰è€…æŒ‰çª„åº¦æ’åºï¼ˆä½¿ç”¨æ‹“æ‰‘æ’åºï¼‰ã€‚å¦‚æœå¤šä¸ªå€™é€‰è€…åŒ¹é…ï¼Œä½†å®ƒä»¬çª„åº¦ç›¸åŒï¼Œé‚£ä¹ˆè¿™å°±æ˜¯ä¸€ä¸ªæ­§ä¹‰é”™è¯¯ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬è°ƒç”¨æœ€çª„çš„ä¸€ä¸ªã€‚ç„¶åï¼Œæˆ‘ä»¬é€‰æ‹©çš„å€™é€‰è€…å¯èƒ½ä¼šä½¿ç”¨ callsame å’Œå®ƒçš„æœ‹å‹ä»¬æ¥æ¨è¿Ÿåˆ°ä¸‹ä¸€ä¸ªæœ€çª„çš„å€™é€‰è€…ï¼Œåè€…å¯èƒ½ä¹Ÿä¼šè¿™æ ·åšï¼Œç›´åˆ°æˆ‘ä»¬è¾¾åˆ°æœ€ä¸€èˆ¬çš„åŒ¹é…çš„å€™é€‰è€…ã€‚\nå¤šé‡åˆ†æ´¾æ— å¤„ä¸åœ¨ Raku åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–äºå¤šé‡åˆ†æ´¾ã€‚Raku ä¸­çš„å¤§å¤šæ•°æ“ä½œç¬¦éƒ½è¢«ç¼–è¯‘æˆå¯¹å¤šé‡åˆ†æ´¾å­ç¨‹åºçš„è°ƒç”¨ã€‚å³ä½¿æ˜¯ $a+$b ä¹Ÿä¼šæ˜¯ä¸€ä¸ªå¤šé‡åˆ†æ´¾ã€‚è¿™æ„å‘³ç€é«˜æ•ˆåœ°è¿›è¡Œå¤šé‡åˆ†æ´¾å¯¹æ€§èƒ½çœŸçš„å¾ˆé‡è¦ã€‚è€ƒè™‘åˆ°å…¶è¯­ä¹‰çš„ä¸°å¯Œæ€§ï¼Œè¿™æœ‰å¯èƒ½æœ‰ç‚¹ä»¤äººæ‹…å¿§ã€‚ä¸è¿‡ï¼Œä¹Ÿæœ‰å¥½æ¶ˆæ¯ã€‚\nå¤§å¤šæ•°å¤šé‡è°ƒåº¦éƒ½å¾ˆæ— èŠ æˆ‘ä»¬é‡åˆ°çš„ç»å¤§å¤šæ•°æƒ…å†µæ˜¯:\n ä¸€ä¸ªä»…ç”±å‚æ•°å’Œåä¹‰ç±»å‹çš„æ•°é‡æ‰€åšçš„å†³å®šã€‚ æ—  where å­å¥ æ— è‡ªå®šä¹‰ proto æ—  callsame  è¿™å¹¶ä¸æ˜¯è¯´å…¶ä»–æƒ…å†µä¸é‡è¦ï¼Œå®ƒä»¬ç¡®å®ç›¸å½“æœ‰ç”¨ï¼Œè€Œä¸”å®ƒä»¬çš„è¡¨ç°ä¹Ÿæ˜¯å¯å–çš„ã€‚ä¸è¿‡ï¼Œåœ¨æ™®é€šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬èƒ½çœåˆ™çœï¼Œä¹Ÿæ˜¯å¯å–çš„ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›æ€¥äºè®¡ç®—æ¯ä¸€ä¸ªå•æ¬¡å¤šé‡è°ƒåº¦çš„å…¨éƒ¨å¯èƒ½çš„å€™é€‰è€…ï¼Œå› ä¸ºå¤§å¤šæ•°æ—¶å€™åªæœ‰ç¬¬ä¸€ä¸ªæ‰æ˜¯é‡è¦çš„ã€‚è¿™ä¸ä»…ä»…æ˜¯æ—¶é—´ä¸Šçš„é—®é¢˜ï¼šå›æƒ³ä¸€ä¸‹ï¼Œæ–°çš„è°ƒåº¦æœºåˆ¶ä¼šåœ¨æ¯ä¸ªè°ƒç”¨ç‚¹å­˜å‚¨è°ƒåº¦ç¨‹åºï¼Œå¦‚æœæˆ‘ä»¬åœ¨æ¯ä¸ªè°ƒç”¨ç‚¹å­˜å‚¨æ‰€æœ‰åŒ¹é…çš„å€™é€‰ç¨‹åºåˆ—è¡¨ï¼Œæˆ‘ä»¬ä¹Ÿä¼šæµªè´¹å¾ˆå¤šå†…å­˜ã€‚\næˆ‘ä»¬ä»Šå¤©æ€ä¹ˆåšï¼Ÿ å¦‚ä»Š Rakuo çš„æƒ…å†µå¦‚ä¸‹:\n  å¦‚æœè°ƒåº¦åªç”±å…ƒæ•°å’Œåä¹‰ç±»å‹å†³å®šï¼Œå¹¶ä¸”ä½ ä¸ä½¿ç”¨æ‰å¹³åŒ–çš„å‚æ•°æ¥è°ƒç”¨å®ƒï¼Œå®ƒå¯èƒ½ä¼šè¡¨ç°å¾—å¾ˆå¥½ï¼Œç”šè‡³å¯èƒ½ä¼šäº«å—åˆ°å€™é€‰è€…çš„å†…è”å’Œæ¶ˆé™¤åœ¨æ…¢é€Ÿè·¯å¾„ä¸Šå‘ç”Ÿçš„é‡å¤ç±»å‹æ£€æŸ¥ã€‚è¿™è¦å½’åŠŸäº proto æŒæœ‰ä¸€ä¸ª \u0026ldquo;dispatch cache\u0026rdquo;ï¼Œè¿™æ˜¯ä¸€ä¸ªåœ¨ VM ä¸­å®ç°çš„ç‰¹ä¾‹æœºåˆ¶ï¼Œå®ƒä½¿ç”¨æœç´¢æ ‘ï¼Œæ¯ä¸ªå‚æ•°æœ‰ä¸€ä¸ªçº§åˆ«ã€‚\n  å¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œä½†å®ƒæœ‰ä¸€ä¸ªè‡ªå®šä¹‰çš„ protoï¼Œä¹Ÿä¸ä¼šå¤ªå·®ï¼Œè™½ç„¶ä¸ä¼šå‘ç”Ÿå†…è”ï¼Œå®ƒä»ç„¶å¯ä»¥ä½¿ç”¨æœç´¢æ ‘ã€‚\n  å¦‚æœå®ƒä½¿ç”¨ where å­å¥ï¼Œé€Ÿåº¦ä¼šå¾ˆæ…¢ï¼Œå› ä¸ºæœç´¢æ ‘åªå¤„ç†åœ¨æ¯ä¸€ä¸ªåä¹‰ç±»å‹é›†åˆä¸­æ‰¾åˆ°ä¸€ä¸ªå€™é€‰è€…ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨å®ƒã€‚\n  åŒæ ·çš„é“ç†ä¹Ÿé€‚ç”¨äº callsameï¼Œå®ƒçš„é€Ÿåº¦ä¹Ÿä¼šå¾ˆæ…¢ã€‚\n  å®é™…ä¸Šï¼Œä»Šå¤©çš„æƒ…å†µæ˜¯ï¼Œå¦‚æœåœ¨çƒ­è·¯å¾„é™„è¿‘çš„ä»»ä½•åœ°æ–¹ï¼Œä½ æ ¹æœ¬ä¸ä¼šåœ¨å¤šé‡è°ƒåº¦ä¸­ä½¿ç”¨ whereå­å¥ï¼ˆå¥½å§ï¼Œå¦‚æœä½ çŸ¥é“çƒ­è·¯å¾„åœ¨å“ªé‡Œï¼Œå¹¶ä¸”çŸ¥é“è¿™ç§è°ƒåº¦å¾ˆæ…¢ï¼‰ã€‚åŒç†ï¼Œcallsame ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œè™½ç„¶é‚£ä¸å¤ªå¸¸è§¦è¾¾ã€‚é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½ç”¨æ–°çš„è°ƒåº¦å™¨åšå¾—æ›´å¥½ï¼Ÿ\nå®ˆå«ç±»å‹ æˆ‘ä»¬å…ˆçœ‹çœ‹æœ€ç®€å•çš„æƒ…å†µæ˜¯å¦‚ä½•å¤„ç†çš„ï¼Œç„¶åå†ä»é‚£é‡Œå¼€å§‹å»ºç«‹ã€‚(è¿™å…¶å®æ˜¯æˆ‘åœ¨å®ç°ä¸Šçš„åšæ³•ï¼Œä½†åŒæ—¶æˆ‘ä¹Ÿæœ‰ä¸€ä¸ªå¤§æ¦‚çš„æƒ³æ³•ï¼Œæˆ‘å¸Œæœ›æœ€ç»ˆçš„ç»“æœæ˜¯ä»€ä¹ˆ)ã€‚\nå›å¿†ä¸€ä¸‹è¿™å¯¹å€™é€‰è€…ã€‚\nmulti truncate(Str $str, Int $chars) { $str.chars \u0026lt; $chars ?? $str !! $str.substr(0, $chars) ~ \u0026#39;...\u0026#39; } multi truncate(Str $str, Str $after) { with $str.index($after) -\u0026gt; $pos { $str.substr(0, $pos) ~ \u0026#39;...\u0026#39; } else { $str } } ç„¶åæˆ‘ä»¬æœ‰ä¸€ä¸ªè°ƒç”¨ truncate($message, \u0026quot;\\n\u0026quot;)ï¼Œå…¶ä¸­ $message æ˜¯ Str ç±»å‹çš„ã€‚åœ¨æ–°çš„è°ƒåº¦æœºåˆ¶ä¸‹ï¼Œè°ƒç”¨æ˜¯ä½¿ç”¨ raku-call dispatcher è¿›è¡Œçš„ï¼Œå®ƒè¯†åˆ«å‡ºè¿™æ˜¯ä¸€ä¸ª multi æ–¹æ³•è°ƒåº¦ï¼Œå› æ­¤å§”æ‰˜ç»™ raku-multiã€‚(multi æ–¹æ³•è°ƒåº¦ä¹Ÿä¼šåœ¨é‚£é‡Œç»“æŸ)ã€‚\nè°ƒåº¦çš„è®°å½•é˜¶æ®µ - åœ¨æˆ‘ä»¬ç¬¬ä¸€æ¬¡åˆ°è¾¾è¿™ä¸ªè°ƒç”¨ç‚¹æ—¶ - å°†è¿›è¡Œå¦‚ä¸‹æ“ä½œã€‚\n è¿­ä»£å€™é€‰è€… å¦‚æœæŸä¸ªå€™é€‰è€…åœ¨å‚æ•°æ•°ä¸Šä¸åŒ¹é…ï¼Œå°±ç›´æ¥ä¸¢å¼ƒå®ƒã€‚ç”±äº callsite çš„å½¢çŠ¶æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼Œè€Œä¸”æˆ‘ä»¬åœ¨æ¯ä¸ª callsite éƒ½ä¼šè®¡ç®— dispatch ç¨‹åºï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦ä¸ºæ­¤å»ºç«‹ä»»ä½•é˜²æŠ¤æªæ–½ã€‚ å¦‚æœåœ¨ç±»å‹åŒ¹é…å¹¶ä¸”æˆåŠŸäº†ï¼Œæ³¨æ„æ¶‰åŠå“ªäº›å‚æ•°ï¼Œéœ€è¦ä»€ä¹ˆæ ·çš„å®ˆå«ã€‚ å¦‚æœæ²¡æœ‰åŒ¹é…æˆ–è€…æ¨¡æ£±ä¸¤å¯ï¼Œå°±æŠ¥é”™ï¼Œä¸äº§ç”Ÿè°ƒåº¦ç¨‹åºã€‚ å¦åˆ™ï¼Œåœ¨ç¡®å®šäº†ç±»å‹å®ˆå«åï¼Œå°†é€‰å®šçš„å€™é€‰ç¨‹åºå§”æ‰˜ç»™ raku-invoke è°ƒåº¦ç¨‹åºã€‚  å½“æˆ‘ä»¬å†æ¬¡åˆ°è¾¾åŒä¸€ä¸ªè°ƒç”¨ç‚¹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œè°ƒåº¦ç¨‹åºï¼Œå®ƒå¯ä»¥å¿«é€Ÿæ£€æŸ¥å‚æ•°ç±»å‹æ˜¯å¦ä¸ä¸Šæ¬¡çœ‹åˆ°çš„å‚æ•°ç±»å‹ç›¸åŒ¹é…ï¼Œå¦‚æœç›¸åŒ¹é…ï¼Œæˆ‘ä»¬å°±çŸ¥é“è¦è°ƒç”¨å“ªä¸ªå€™é€‰ç¨‹åºã€‚è¿™äº›æ£€æŸ¥éå¸¸ä¾¿å®œ - æ¯”éå†æ‰€æœ‰å€™é€‰è€…å¹¶æ£€æŸ¥æ¯ä¸ªå€™é€‰è€…æ˜¯å¦åŒ¹é…è¦ä¾¿å®œå¾—å¤šã€‚ä¼˜åŒ–å™¨ä»¥åå¯èƒ½ä¼šè¯æ˜è¿™äº›æ£€æŸ¥æ€»æ˜¯ä¼šæˆä¸ºäº‹å®ï¼Œå¹¶æ¶ˆé™¤å®ƒä»¬ã€‚\nå› æ­¤ï¼Œæ•´ä¸ªè°ƒåº¦è¿‡ç¨‹ - è‡³å°‘å¯¹äºè¿™ä¸ªæˆ‘ä»¬åªæœ‰ç±»å‹å’Œå…ƒæ•°çš„ç®€å•æ¡ˆä¾‹ - å¯ä»¥å‘è™šæ‹Ÿæœº \u0026ldquo;è§£é‡Š\u0026rdquo; ä¸º \u0026ldquo;å¦‚æœå‚æ•°å…·æœ‰è¿™äº›ç¡®åˆ‡çš„ç±»å‹ï¼Œå°±è°ƒç”¨è¿™ä¸ªä¾‹ç¨‹\u0026rdquo;ã€‚è¿™å’Œæˆ‘ä»¬å¯¹æ–¹æ³•åˆ†æ´¾æ‰€åšçš„å·®ä¸å¤šï¼Œé™¤äº†æˆ‘ä»¬åªå…³å¿ƒç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ - è°ƒç”¨è€… - å’Œæ–¹æ³•åçš„å€¼ã€‚(è¿˜è®°å¾—ä¸Šä¸€ç¯‡æ–‡ç« ä¸­è¯´è¿‡ï¼Œå¦‚æœæ˜¯ multi æ–¹æ³•è°ƒåº¦ï¼Œé‚£ä¹ˆæ–¹æ³•è°ƒåº¦å’Œ multi æ–¹æ³•è°ƒåº¦éƒ½ä¼šå®ˆæŠ¤ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ï¼Œä½†æ˜¯æ¶ˆé™¤äº†é‡å¤ï¼Œæ‰€ä»¥åªåšä¸€æ¬¡æ£€æŸ¥)ã€‚\nè¿™å°±è¿›å…¥äº†æ¢å¤ä¹‹æ´ æƒ³å‡ºå¥½çš„æŠ½è±¡æ˜¯å¾ˆéš¾çš„ï¼Œæ–°çš„è°ƒåº¦æœºåˆ¶çš„å¾ˆå¤šæŒ‘æˆ˜å°±åœ¨äºæ­¤ã€‚Raku æœ‰ä¸å°‘ä¸åŒçš„ç±»ä¼¼è°ƒåº¦çš„ä¸œè¥¿ã€‚ç„¶è€Œï¼Œå°†å®ƒä»¬å…¨éƒ¨ç›´æ¥ç¼–ç åœ¨è™šæ‹Ÿæœºä¸­ä¼šå¯¼è‡´å¾ˆé«˜çš„å¤æ‚åº¦ï¼Œè¿™ä½¿å¾—æ„å»ºå¯é çš„ä¼˜åŒ–ï¼ˆç”šè‡³æ˜¯å¯é çš„æœªä¼˜åŒ–çš„å®ç°ï¼ï¼‰å…·æœ‰æŒ‘æˆ˜æ€§ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ç ”ç©¶å‡ºä¸€å¥—ç›¸å¯¹è¾ƒå°çš„åŸè¯­ï¼Œå…è®¸ä»¥è¿™æ ·ä¸€ç§æ–¹å¼å‘è™šæ‹Ÿæœº \u0026ldquo;è§£é‡Š\u0026rdquo; è°ƒåº¦ï¼Œä½¿å…¶èƒ½å¤Ÿæä¾›ä¸é”™çš„æ€§èƒ½ã€‚\nå¾ˆæ˜æ˜¾ï¼Œcallsame æ˜¯ä¸€ç§è°ƒåº¦æ¢å¤ï¼Œä½†è‡ªå®šä¹‰ proto è¿™ç§æƒ…å†µå’Œ where å­å¥è¿™ç§æƒ…å†µå‘¢ï¼Ÿäº‹å®è¯æ˜ï¼Œè¿™äº›ä¹Ÿéƒ½å¯ä»¥ç”¨è°ƒåº¦æ¢å¤çš„æ–¹å¼æ•´é½åœ°è¡¨è¾¾å‡ºæ¥ï¼ˆwhere å­å¥æƒ…å†µéœ€è¦åœ¨è™šæ‹Ÿæœºå±‚é¢å¢åŠ ä¸€ä¸ªå°çš„å†…å®¹ï¼Œåˆ°æ—¶å€™å¯èƒ½å¯¹å…¶ä»–äº‹æƒ…ä¹Ÿæœ‰ç”¨ï¼‰ã€‚ä¸ä»…å¦‚æ­¤ï¼Œç”¨è°ƒåº¦æ¢å¤æ¥ç¼–ç è¿™äº›ç‰¹æ€§ä¹Ÿæ˜¯ç›¸å½“ç›´æ¥çš„ï¼Œå› æ­¤åº”è¯¥æ˜¯é«˜æ•ˆçš„ã€‚æˆ‘ä»¬æ•™ç»™ä¸“é—¨äººå‘˜çš„å…³äºå¦‚ä½•æ›´å¥½åœ°ä½¿ç”¨è°ƒåº¦æ¢å¤çš„æ¯ä¸€ä¸ªæŠ€å·§ï¼Œéƒ½å¯ä»¥è®©æ‰€æœ‰ä½¿ç”¨å®ƒä»¬å®ç°çš„è¯­è¨€ç‰¹æ€§ä¹Ÿå—ç›Šã€‚\nè‡ªå®šä¹‰ proto å›é¡¾è¿™ä¸ªä¾‹å­ã€‚\nproto mean($collection) { $collection.elems == 0 ?? Nil !! {*} } åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¸Œæœ›è¿è¡Œ proto çš„ä¸»ä½“ï¼Œç„¶ååœ¨ {*} è¿™é‡Œè¿›è¡Œå€™é€‰è€…çš„é€‰æ‹©ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œå½“æˆ‘ä»¬æ²¡æœ‰è‡ªå®šä¹‰çš„ proto æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›ç®€å•åœ°ç»§ç»­è°ƒç”¨æ­£ç¡®çš„å¤šã€‚\nä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œæˆ‘é¦–å…ˆå°† multi å€™é€‰è€…çš„é€‰æ‹©é€»è¾‘ä» raku-multi è°ƒåº¦å™¨ç§»åˆ°äº† raku-multi-core è°ƒåº¦å™¨ä¸­ã€‚ç„¶åï¼Œraku-multi dispatcher ä¼šæ£€æŸ¥æˆ‘ä»¬æ˜¯å¦æœ‰ä¸€ä¸ª \u0026ldquo;onlystar\u0026rdquo; protoï¼ˆä¸€ä¸ªä¸éœ€è¦æˆ‘ä»¬è¿è¡Œçš„ protoï¼‰ã€‚å¦‚æœæœ‰ï¼Œå®ƒå°±ä¼šç«‹å³å§”æ‰˜ç»™ raku-multi-coreã€‚å¦‚æœæ²¡æœ‰ï¼Œå®ƒå°±å°†è°ƒåº¦çš„å‚æ•°ä¿å­˜ä¸ºæ¢å¤åˆå§‹åŒ–çŠ¶æ€ï¼Œç„¶åè°ƒç”¨ protoã€‚proto çš„ {*} è¢«ç¼–è¯‘æˆä¸€ä¸ª dispatch resumptionã€‚ç„¶åï¼Œè¿™ä¸ª resumption å§”æ‰˜ç»™ raku-multi-coreã€‚æˆ–è€…ï¼Œåœ¨ä»£ç ä¸­ã€‚\nnqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-register\u0026#39;, \u0026#39;raku-multi\u0026#39;, # Initial dispatch, only setting up resumption if we need to invoke the # proto. -\u0026gt; $capture { my $callee := nqp::captureposarg($capture, 0); my int $onlystar := nqp::getattr_i($callee, Routine, \u0026#39;$!onlystar\u0026#39;); if $onlystar { # Don\u0026#39;t need to invoke the proto itself, so just get on with the # candidate dispatch. nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-delegate\u0026#39;, \u0026#39;raku-multi-core\u0026#39;, $capture); } else { # Set resume init args and run the proto. nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-set-resume-init-args\u0026#39;, $capture); nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-delegate\u0026#39;, \u0026#39;raku-invoke\u0026#39;, $capture); } }, # Resumption means that we have reached the {*} in the proto and so now # should go ahead and do the dispatch. Make sure we only do this if we # are signalled to that it\u0026#39;s a resume for an onlystar (resumption kind 5). -\u0026gt; $capture { my $track_kind := nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-track-arg\u0026#39;, $capture, 0); nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-guard-literal\u0026#39;, $track_kind); my int $kind := nqp::captureposarg_i($capture, 0); if $kind == 5 { nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-delegate\u0026#39;, \u0026#39;raku-multi-core\u0026#39;, nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-get-resume-init-args\u0026#39;)); } elsif !nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-next-resumption\u0026#39;) { nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-delegate\u0026#39;, \u0026#39;boot-constant\u0026#39;, nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-insert-arg-literal-obj\u0026#39;, $capture, 0, Nil)); } }); åˆäºŒä¸ºä¸€ æ¨è¿Ÿåˆ°ä¸‹ä¸€ä¸ªå€™é€‰è€…ï¼ˆä¾‹å¦‚ç”¨ callsameï¼‰å’Œå› ä¸º where å­å¥å¤±è´¥è€Œå°è¯•ä¸‹ä¸€ä¸ªå€™é€‰è€…çœ‹èµ·æ¥éå¸¸ç›¸ä¼¼ï¼šä¸¤è€…éƒ½æ¶‰åŠéå†ä¸€ä¸ªå¯èƒ½çš„å€™é€‰è€…åˆ—è¡¨ã€‚æœ‰ä¸€äº›ç»†èŠ‚ï¼Œä½†å®ƒä»¬æœ‰å¾ˆå¤šå…±åŒç‚¹ï¼Œå¦‚æœèƒ½åœ¨ä½¿ç”¨æ–°çš„ dispatcher å®ç°å¤šé‡åˆ†æ´¾çš„è¿‡ç¨‹ä¸­ä½“ç°å‡ºæ¥å°±æ›´å¥½äº†ã€‚\nåœ¨è¿™ä¹‹å‰ï¼Œå…ˆè¯´ä¸€ä¸ªç•¥æ˜¾å¯æ€•çš„ç»†èŠ‚ï¼Œå½“æˆ‘ä»¬æœ‰ where å­å¥çš„æ—¶å€™ï¼Œä»Šå¤©åœ¨ Rakuo ä¸­æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚é¦–å…ˆï¼Œè°ƒåº¦å™¨ä¼šåšä¸€ä¸ª \u0026ldquo;è¯•ç”¨ç»‘å®š\u0026rdquo;ï¼Œå®ƒé—®ä¸€ä¸ªé—®é¢˜ï¼šè¿™ä¸ªç­¾åä¼šä¸ä¼šç»‘å®šï¼Ÿè¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œå®ƒå¿…é¡»è¯„ä¼°æ‰€æœ‰çš„ where å­å¥ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œå®ƒè¿˜å¿…é¡»ä½¿ç”¨æ…¢è·¯å¾„ç­¾åç»‘å®šå™¨ï¼Œå®ƒå¯¹ç­¾åè¿›è¡Œè§£é‡Šï¼Œå°½ç®¡æˆ‘ä»¬åœ¨å¾ˆå¤šæƒ…å†µä¸‹å¯ä»¥ç¼–è¯‘å®ƒã€‚å¦‚æœå€™é€‰è€…åŒ¹é…ï¼Œå¾ˆå¥½ï¼Œæˆ‘ä»¬é€‰æ‹©å®ƒï¼Œç„¶åè°ƒç”¨å®ƒ\u0026hellip;\u0026hellip;è¿™å°†ç¬¬äºŒæ¬¡è¿è¡Œ where å­å¥ï¼Œä½œä¸ºç¼–è¯‘åçš„ç­¾åç»‘å®šä»£ç çš„ä¸€éƒ¨åˆ†ã€‚è¿™æ ·åšä¸€ç‚¹ä¹Ÿä¸é«˜æ•ˆï¼Œé™¤äº†åœ¨å¼€å‘äººå‘˜çš„æ—¶é—´ä¸Šè¦é«˜æ•ˆå¾—å¤šï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¦è¿™æ ·åšçš„åŸå› ã€‚\næ€»ä¹‹ï¼Œæ¯‹åº¸ç½®ç–‘ï¼Œåœ¨æˆ‘ä½¿ç”¨æ–°çš„è°ƒåº¦å™¨é‡æ–°å®ç°æ—¶ï¼Œæˆ‘ç›¸å½“å¸Œæœ›å°½å¯èƒ½é¿å…è¿™ç§é‡å¤çš„å·¥ä½œå’Œæ…¢è·¯å¾„ç»‘å®šã€‚è€Œä¸”ï¼Œä»¤äººé«˜å…´çš„æ˜¯ï¼Œä¸€ä¸ªå°å°çš„è¡¥å……æä¾›äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆã€‚æœ‰ä¸€ä¸ª op assertparamcheckï¼Œä»»ä½•ç±»å‹çš„å‚æ•°æ£€æŸ¥éƒ½ä¼šè¢«ç¼–è¯‘æˆï¼ˆæ— è®ºæ˜¯ç±»å‹æ£€æŸ¥ã€where å­å¥æ£€æŸ¥ç­‰ï¼‰ï¼Œè¿™å°†è§¦å‘å¯¹ä¸€ä¸ªå‡½æ•°çš„è°ƒç”¨ï¼Œè¯¥å‡½æ•°è·å–å‚æ•°ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯•å›¾è°ƒç”¨çš„ä¸œè¥¿ï¼Œç„¶åå¯ä»¥é€šè¿‡å®ƒä»¬æ¥äº§ç”Ÿé”™è¯¯ä¿¡æ¯ã€‚è¯€çªæ˜¯æä¾›ä¸€ç§è°ƒç”¨ä¾‹ç¨‹çš„æ–¹æ³•ï¼Œä½¿ç»‘å®šå¤±è´¥åï¼Œä¸æ˜¯è°ƒç”¨æŠ¥é”™å‡½æ•°ï¼Œè€Œæ˜¯ç¦»å¼€ä¾‹ç¨‹ï¼Œç„¶ååšä¸€ä¸ªè°ƒåº¦æ¢å¤! è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å°†ä¼ é€’ where å­å¥æ£€æŸ¥å¤±è´¥å˜æˆä¸€ä¸ªè°ƒåº¦æ¢å¤ï¼Œç„¶åä¼šèµ°åˆ°ä¸‹ä¸€ä¸ªå€™é€‰è€…ï¼Œå¹¶ä»£æ›¿å®ƒè¿›è¡Œå°è¯•ã€‚\nçç¢VSéçç¢ è¿™è®©æˆ‘ä»¬å¾—åˆ°äº†å¤§éƒ¨åˆ†çš„è§£å†³æ–¹æ³•ï¼Œä½†åœ¨å¸¸è§çš„æƒ…å†µä¸‹ï¼Œä»ç„¶å­˜åœ¨å†…å­˜å’Œæ—¶é—´æ•ˆç‡çš„é—®é¢˜ï¼Œå³æ²¡æœ‰æ¢å¤å’Œæ²¡æœ‰ where å­å¥ã€‚æˆ‘ä¸ºè¿™ç§æƒ…å†µåˆ›é€ äº†ä¸€ä¸ªæœ¯è¯­ \u0026ldquo;trivial multiple dispatch\u0026rdquo;ï¼Œè¿™ä½¿å¾—å…¶ä»–æƒ…å†µå˜å¾— \u0026ldquo;non-trivial\u0026rdquo;ã€‚äº‹å®ä¸Šï¼Œæˆ‘ç”šè‡³åšäº†ä¸€ä¸ªè°ƒåº¦å™¨ï¼Œå«åš raku-multi-non-trivial! æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥ç»“æŸã€‚\n æœ€åˆå°è¯•å¯»æ‰¾åŒ¹é…çš„å€™é€‰è€…ï¼Œå†³å®šäº†æˆ‘ä»¬å¿…é¡»è€ƒè™‘ where å­å¥ã€‚ä¸€æ—¦æˆ‘ä»¬çœ‹åˆ°æ˜¯è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å°±ä¼šç»§ç»­åˆ¶ä½œä¸€ä¸ªå¯èƒ½åŒ¹é…çš„å€™é€‰è€…çš„å®Œæ•´åˆ—è¡¨ã€‚è¿™æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼ˆåŸå› è§æˆ‘ä¹‹å‰çš„æ–‡ç« ï¼‰ã€‚ æœ€åˆå°è¯•å¯»æ‰¾åŒ¹é…çš„å€™é€‰è€…æ—¶ï¼Œå‘ç°äº†ä¸€ä¸ªå¯ä»¥çº¯ç²¹æ ¹æ®å‚æ•°æ•°å’Œåè¯ç±»å‹æ¥æŒ‘é€‰çš„å€™é€‰è€…ã€‚æˆ‘ä»¬å°±æ­¤åœæ­¢ï¼Œè€Œä¸æ˜¯è¯•å›¾å»ºç«‹ä¸€ä¸ªå®Œæ•´çš„å€™é€‰åˆ—è¡¨ï¼Œå¹¶è¿è¡ŒåŒ¹é…çš„å€™é€‰ã€‚åœ¨ callsame çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æœ€ç»ˆè¿›å…¥çç¢çš„è°ƒåº¦æ¢å¤å¤„ç†ç¨‹åºï¼Œå®ƒ - å› ä¸ºè¿™ç§æƒ…å†µç°åœ¨æ˜¯éçç¢çš„ - å»ºç«‹å®Œæ•´çš„å€™é€‰è€…åˆ—è¡¨ï¼Œä»å®ƒä¸Šé¢å‰ªä¸‹ç¬¬ä¸€é¡¹ï¼ˆå› ä¸ºæˆ‘ä»¬å·²ç»è¿è¡Œäº†é‚£é¡¹ï¼‰ï¼Œç„¶åå§”æ‰˜ç»™ raku-multi-non-trivialã€‚  åœ¨è¿™ä¸ªæè¿°ä¸­å¤±å»äº†å¦ä¸€ä¸ªé‡è¦çš„æ”¹è¿›ï¼šä»Šå¤©ï¼Œå½“æœ‰ where å­å¥æ—¶ï¼Œæˆ‘ä»¬å®Œå…¨å¤±å»äº†ä½¿ç”¨ MoarVM å¤šé‡è°ƒåº¦ç¼“å­˜çš„èƒ½åŠ›ï¼Œä½†åœ¨æ–°çš„è°ƒåº¦å™¨ä¸‹ï¼Œæˆ‘ä»¬åœ¨ callsite å­˜å‚¨äº†ä¸€ä¸ªç±»å‹è¿‡æ»¤çš„å€™é€‰åˆ—è¡¨ï¼Œç„¶åä½¿ç”¨å»‰ä»·çš„ç±»å‹å®ˆå«æ¥æ£€æŸ¥å®ƒæ˜¯å¦æœ‰æ•ˆä½¿ç”¨ã€‚\nåˆæ­¥ç»“æœ æˆ‘åšäº†ä¸€äº›åŸºå‡†æµ‹è¯•ï¼Œçœ‹çœ‹æ–°çš„è°ƒåº¦æœºåˆ¶åœ¨ä»Šå¤© Raku å·²çŸ¥çš„å‡ ç§æ¬¡ä¼˜æƒ…å†µä¸‹çš„è¡¨ç°ã€‚è¿™äº›æ•°å­—å¹¶ä¸èƒ½åæ˜ å‡ºä»€ä¹ˆæ˜¯å¯èƒ½çš„ï¼Œå› ä¸ºç›®å‰ä¸“é—¨äººå‘˜å¯¹æ–°çš„è°ƒåº¦å™¨è¿˜æ²¡æœ‰å¤ªå¤šçš„äº†è§£ã€‚ç›¸åï¼Œå®ƒä»¬åæ˜ äº†æˆ‘ä»¬å¯ä»¥æœŸæœ›çš„æœ€å°æ”¹è¿›ã€‚\nè€ƒè™‘è¿™ä¸ªåŸºå‡†ï¼Œä½¿ç”¨ä¸€ä¸ªå¸¦æœ‰ where å­å¥çš„ multi æ¥é€’å½’å®ç° factorialã€‚\nmulti fac($n where $n \u0026lt;= 1) { 1 } multi fac($n) { $n * fac($n - 1) } for ^100_000 { fac(10) } say now - INIT now; è¿™éœ€è¦è¿›è¡Œä¸€äº›è°ƒæ•´ï¼ˆå¹¶åœ¨ç¯å¢ƒå˜é‡ä¸‹è¿è¡Œï¼‰ä»¥ä½¿ç”¨æ–°çš„è°ƒåº¦å™¨ï¼›è¿™äº›éƒ½æ˜¯æš‚æ—¶çš„ï¼Œç›´åˆ°æˆ‘å°† Rakudo è½¬æ¢ä¸ºé»˜è®¤ä½¿ç”¨æ–°çš„è°ƒåº¦å™¨ã€‚\nuse nqp; multi fac($n where $n \u0026lt;= 1) { 1 } multi fac($n) { $n * nqp::dispatch(\u0026#39;raku-call\u0026#39;, \u0026amp;fac, $n - 1) } for ^100_000 { nqp::dispatch(\u0026#39;raku-call\u0026#39;, \u0026amp;fac, 10); } say now - INIT now; åœ¨æˆ‘çš„æœºå™¨ä¸Šï¼Œç¬¬ä¸€ä¸ªè¿è¡Œæ—¶é—´ä¸º4.86ç§’ï¼Œç¬¬äºŒä¸ªè¿è¡Œæ—¶é—´ä¸º1.34ç§’ã€‚å› æ­¤ï¼Œåœ¨æ–°çš„è°ƒåº¦å™¨ä¸‹ï¼Œè¿è¡Œæ—¶é—´åªéœ€è¿‡å»çš„å››åˆ†ä¹‹ä¸€å¤šä¸€ç‚¹ - è¿™å·²ç»æ˜¯ä¸€ä¸ªç›¸å½“å¤§çš„æ”¹è¿›äº†ã€‚\nä¸€ä¸ªæ¶‰åŠ callsame çš„æ¡ˆä¾‹ä¹Ÿå¾ˆæœ‰æ„æ€ã€‚è¿™é‡Œæ˜¯æ²¡æœ‰ä½¿ç”¨æ–°è°ƒåº¦å™¨çš„æƒ…å†µã€‚\nmulti fallback(Any $x) { \u0026#34;a$x\u0026#34; } multi fallback(Numeric $x) { \u0026#34;n\u0026#34; ~ callsame } multi fallback(Real $x) { \u0026#34;r\u0026#34; ~ callsame } multi fallback(Int $x) { \u0026#34;i\u0026#34; ~ callsame } for ^1_000_000 { fallback(4+2i); fallback(4.2); fallback(42); } say now - INIT now; è€Œé…åˆä¸´æ—¶è°ƒæ•´ä½¿ç”¨æ–°çš„è°ƒåº¦å™¨:\nuse nqp; multi fallback(Any $x) { \u0026#34;a$x\u0026#34; } multi fallback(Numeric $x) { \u0026#34;n\u0026#34; ~ new-disp-callsame } multi fallback(Real $x) { \u0026#34;r\u0026#34; ~ new-disp-callsame } multi fallback(Int $x) { \u0026#34;i\u0026#34; ~ new-disp-callsame } for ^1_000_000 { nqp::dispatch(\u0026#39;raku-call\u0026#39;, \u0026amp;fallback, 4+2i); nqp::dispatch(\u0026#39;raku-call\u0026#39;, \u0026amp;fallback, 4.2); nqp::dispatch(\u0026#39;raku-call\u0026#39;, \u0026amp;fallback, 42); } say now - INIT now; åœ¨æˆ‘çš„æœºå™¨ä¸Šï¼Œç¬¬ä¸€ä¸ªè¿è¡Œæ—¶é—´ä¸º31.3sï¼Œç¬¬äºŒä¸ªè¿è¡Œæ—¶é—´ä¸º11.5sï¼Œè¿™æ„å‘³ç€ä½¿ç”¨æ–°çš„è°ƒåº¦å™¨ï¼Œæˆ‘ä»¬æœ€ç»ˆéœ€è¦çš„æ—¶é—´åªæœ‰å½“å‰ Rakudo çš„ä¸‰åˆ†ä¹‹ä¸€å¤šä¸€ç‚¹ã€‚\nè¿™äº›éƒ½æ˜¯ç›¸å½“é¼“èˆäººå¿ƒçš„ï¼Œä½†æ­£å¦‚å‰é¢æåˆ°çš„ï¼Œå¤§éƒ¨åˆ†çš„å¤šé‡è°ƒåº¦éƒ½æ˜¯çç¢çš„é‚£ç§ï¼Œæ²¡æœ‰ä½¿ç”¨è¿™äº›åŠŸèƒ½ã€‚å¦‚æœæˆ‘åœ¨è®©å…¶ä»–äº‹æƒ…å˜å¾—æ›´å¥½çš„è·¯ä¸ŠæŠŠæœ€å¸¸è§çš„æƒ…å†µå˜å¾—æ›´ç³Ÿï¼Œé‚£å°±ä¸å¥½äº†ã€‚ç°åœ¨è¿˜ä¸èƒ½å¯¹æ­¤è¿›è¡Œå…¬å¹³çš„æ¯”è¾ƒï¼šçç¢çš„å¤šé‡åˆ†æ´¾åœ¨ç‰¹åŒ–å™¨ä¸­å·²ç»å—åˆ°äº†å¾ˆå¤šå…³æ³¨ï¼Œè€Œä¸”å®ƒè¿˜ä¸èƒ½å¾ˆå¥½åœ°ä¼˜åŒ–ä½¿ç”¨æ–°è°ƒåº¦å™¨çš„ä»£ç ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿™æ ·çš„ä¾‹å­ä¸­ã€‚\nmulti m(Int) { } multi m(Str) { } for ^1_000_000 { m(1); m(\u0026#34;x\u0026#34;); } say now - INIT now; å†…åµŒå’Œå…¶ä»–ä¼˜åŒ–ä¼šå°†å…¶å˜æˆä¸€ä¸ªç©ºå¾ªç¯ï¼Œè¿™æ˜¯å¾ˆéš¾åšåˆ°çš„ã€‚ä¸è¿‡æœ‰ä¸€ä»¶äº‹æˆ‘ä»¬å·²ç»å¯ä»¥åšäº†ï¼šåœ¨ç¦ç”¨ specializer çš„æƒ…å†µä¸‹è¿è¡Œå®ƒã€‚æ–°çš„è°ƒåº¦å™¨ç‰ˆæœ¬çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ã€‚\nuse nqp; multi m(Int) { } multi m(Str) { } for ^1_000_000 { nqp::dispatch(\u0026#39;raku-call\u0026#39;, \u0026amp;m, 1); nqp::dispatch(\u0026#39;raku-call\u0026#39;, \u0026amp;m, \u0026#34;x\u0026#34;); } say now - INIT now; ç»“æœåˆ†åˆ«æ˜¯0.463så’Œ0.332sã€‚å› æ­¤ï¼ŒåŸºçº¿æ‰§è¡Œæ—¶é—´ - åœ¨ç‰¹åŒ–å™¨å‘æŒ¥å…¶é­”åŠ›ä¹‹å‰ - ä½¿ç”¨æ–°çš„é€šç”¨è°ƒåº¦æœºåˆ¶æ¯”ä½¿ç”¨æˆ‘ä»¬ç›®å‰ä½¿ç”¨çš„ç‰¹åŒ–å¤šé‡è°ƒåº¦ç¼“å­˜è¦å°‘ã€‚åœ¨åšæµ‹é‡ä¹‹å‰ï¼Œæˆ‘ä¸çŸ¥é“è¿™é‡Œä¼šæœ‰ä»€ä¹ˆé¢„æœŸã€‚é‰´äºæˆ‘ä»¬è¦ä»ä¸€ä¸ªå·²ç»è¢«å‰–æå’Œè°ƒæ•´è¿‡çš„ç‰¹åŒ–æœºåˆ¶è½¬åˆ°ä¸€ä¸ªæ²¡æœ‰å—åˆ°å¦‚æ­¤å…³æ³¨çš„æ–°çš„é€šç”¨æœºåˆ¶ï¼Œæˆ‘å·²ç»åšå¥½äº†æœ€åˆåšå¾—å·®ä¸€ç‚¹çš„å‡†å¤‡ï¼Œå¦‚æœèƒ½åšåˆ°å¹³ä»·å°±å¥½äº†ã€‚åœ¨70%çš„æ—¶é—´é‡Œï¼Œè·‘è¿›äº†70%çš„æ—¶é—´ï¼Œè¿™æ¯”æˆ‘é¢„æœŸçš„è¿›æ­¥æ›´å¤§ã€‚\næˆ‘æœŸæœ›ï¼Œä¸€æ—¦ç‰¹åŒ–å™¨æ›´å¥½åœ°ç†è§£æ–°çš„è°ƒåº¦æœºåˆ¶ï¼Œå®ƒä¹Ÿèƒ½æŠŠä¸Šé¢çš„å†…å®¹å˜æˆä¸€ä¸ªç©ºå¾ªç¯ - ä¸è¿‡ï¼Œç”±äºæ¯æ¬¡ä¼˜åŒ–å¯ä»¥è¿›è¡Œæ›´å¤šçš„è¿­ä»£ï¼Œè¿™åº”è¯¥è¿˜æ˜¯è¡¨ç°ä¸ºæ–°è°ƒåº¦å™¨çš„èƒœåˆ©ã€‚\næœ€åçš„æƒ³æ³• åªè¦å¢åŠ ä¸€ä¸ªç›¸å¯¹è¾ƒå°çš„åŠŸèƒ½ï¼Œæ–°çš„è°ƒåº¦æœºåˆ¶å·²ç»å¯ä»¥å¤„ç†å¤§éƒ¨åˆ†çš„ Raku å¤šé‡è°ƒåº¦è¯­ä¹‰ã€‚æ­¤å¤–ï¼Œå³ä½¿åœ¨ specializer å’Œ JIT æ²¡æœ‰çœŸæ­£èƒ½å¤Ÿåšå¥½çš„æƒ…å†µä¸‹ï¼Œä¸€äº›å¾®åŸºå‡†å·²ç»æ˜¾ç¤ºå‡º3å€-4å€çš„æå‡ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹ã€‚\nåœ¨æˆ‘ä»¬ä½¿ç”¨æ–°çš„è°ƒåº¦å™¨å‡ºè´§ Rakudo ç‰ˆæœ¬ä¹‹å‰ï¼Œè¿˜æœ‰å¾ˆå¤šå·¥ä½œè¦åšã€‚ç„¶è€Œï¼Œå¤šé‡è°ƒåº¦æ˜¯è®¾è®¡ä¸­å‰©ä¸‹çš„æœ€å¤§å¨èƒï¼šå®ƒæ¯”å…¶ä»–ç§ç±»çš„è°ƒåº¦ç›¸å½“å¤šçš„å‚ä¸ï¼Œè€Œä¸”å¾ˆæœ‰å¯èƒ½ä¸€ä¸ªæ„æƒ³ä¸åˆ°çš„ç¼ºç‚¹ä¼šå¼•å‘æ–°ä¸€è½®çš„è®¾è®¡å·¥ä½œï¼Œæˆ–è€…æ­ç¤ºå‡ºä¸€èˆ¬æœºåˆ¶ä¸åŸºçº¿æœªä¼˜åŒ–çš„æƒ…å†µä¸‹, ä¸æ›´ä¸“ä¸šçš„æœºåˆ¶ç›¸æ¯”ï¼Œæ€§èƒ½ä¼šå¾ˆåƒåŠ›ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ²¡æœ‰ä»»ä½•è¿¹è±¡è¡¨æ˜è¿™ä¸¤ç§æƒ…å†µï¼Œæˆ‘è°¨æ…ä¹è§‚åœ°è®¤ä¸ºæ•´ä½“è®¾è®¡æ˜¯å·®ä¸å¤šçš„ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2021-04-15-raku-multiple-dispatch-with-the-new-moarvm-dispatcher/","tags":["Raku"],"title":"Raku Multiple Dispatch With the New MoarVM Dispatcher"},{"categories":["rakulang"],"contents":"Rust çš„æ ‡å‡†åº“ Trait ä¹‹æ—… Table of Contents\n Intro Trait Basics  Trait Items  Self Functions Methods Associated Types Generic Parameters Generic Types vs Associated Types   Scope Derive Macros Default Impls Generic Blanket Impls Subtraits \u0026amp; Supertraits Trait Objects Marker Traits Auto Traits Unsafe Traits   Auto Traits  Send \u0026amp; Sync Sized   General Traits  Default Clone Copy Any   Formatting Traits  Display \u0026amp; ToString Debug   Operator Traits  Comparison Traits  PartialEq \u0026amp; Eq Hash PartialOrd \u0026amp; Ord   Arithmetic Traits  Add \u0026amp; AddAssign   Closure Traits  FnOnce, FnMut, \u0026amp; Fn   Other Traits  Deref \u0026amp; DerefMut Index \u0026amp; IndexMut Drop     Conversion Traits  From \u0026amp; Into   Error Handling  Error   Conversion Traits Continued  TryFrom \u0026amp; TryInto FromStr AsRef \u0026amp; AsMut Borrow \u0026amp; BorrowMut ToOwned   Iteration Traits  Iterator IntoIterator FromIterator   I/O Traits  Read \u0026amp; Write   Conclusion Discuss Notifications Further Reading  Intro ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œè¿™ä¸¤è€…ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«?\n Deref\u0026lt;Target = T\u0026gt;, AsRef\u0026lt;T\u0026gt; å’Œ Borrow\u0026lt;T\u0026gt;? Clone, Copy å’Œ ToOwned? From\u0026lt;T\u0026gt; å’Œ Into\u0026lt;T\u0026gt;? TryFrom\u0026lt;\u0026amp;str\u0026gt; å’Œ FromStr? FnOnce, FnMut, Fn å’Œ fn?  æˆ–è€…æ›¾ç»é—®è¿‡è‡ªå·±è¿™æ ·çš„é—®é¢˜:\n åœ¨æˆ‘çš„ trait ä¸­, æˆ‘ä»€ä¹ˆæ—¶å€™ä½¿ç”¨å…³è”ç±»å‹, ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ³›å‹ç±»å‹? ä»€ä¹ˆæ˜¯æ³›å‹çš„ blanket å®ç°? subtrait å’Œ supertrait æ˜¯å¦‚ä½•å·¥ä½œçš„? ä¸ºä»€ä¹ˆè¿™ä¸ª trait æ²¡æœ‰ä»»ä½•æ–¹æ³•?  é‚£ä¹ˆè¿™ç¯‡æ–‡ç« å°±æ˜¯ä¸ºä½ å‡†å¤‡çš„! å®ƒå›ç­”äº†ä»¥ä¸Šæ‰€æœ‰çš„é—®é¢˜ä»¥åŠæ›´å¤šçš„é—®é¢˜ã€‚æˆ‘ä»¬å°†ä¸€èµ·å¯¹ Rust æ ‡å‡†åº“ä¸­æ‰€æœ‰æœ€æµè¡Œã€æœ€å¸¸ç”¨çš„ trait è¿›è¡Œå¿«é€Ÿé£è¶Šä¹‹æ—…!\nä½ å¯ä»¥æŒ‰é¡ºåºé€èŠ‚é˜…è¯»æœ¬æ–‡ï¼Œä¹Ÿå¯ä»¥è·³è½¬åˆ°ä½ æœ€æ„Ÿå…´è¶£çš„ traitï¼Œå› ä¸ºæ¯ä¸ª trait éƒ¨åˆ†éƒ½æœ‰ä¸€ä¸ªé“¾æ¥åˆ—è¡¨ï¼Œé“¾æ¥åˆ° â€œå…ˆå†³çŸ¥è¯†â€ éƒ¨åˆ†ï¼Œä½ åº”è¯¥é˜…è¯»è¿™äº›é“¾æ¥ï¼Œä»¥ä¾¿æœ‰è¶³å¤Ÿçš„èƒŒæ™¯æ¥ç†è§£å½“å‰éƒ¨åˆ†çš„è§£é‡Šã€‚\nTrait åŸºç¡€ We\u0026rsquo;ll cover just enough of the basics so that the rest of the article can be streamlined without having to repeat the same explanations of the same concepts over and over as they reappear in different traits.\næˆ‘ä»¬å°†åªæ¶‰åŠè¶³å¤Ÿçš„åŸºç¡€çŸ¥è¯†ï¼Œä»¥ä¾¿æ–‡ç« çš„å…¶ä½™éƒ¨åˆ†å¯ä»¥ç²¾ç®€ï¼Œè€Œä¸å¿…åœ¨ä¸åŒçš„ trait ä¸­é‡æ–°å‡ºç°æ—¶é‡å¤ç›¸åŒçš„æ¦‚å¿µè§£é‡Šã€‚\nTrait é¡¹ Trait é¡¹æ˜¯æŒ‡ä½œä¸º trait å£°æ˜ä¸€éƒ¨åˆ†çš„ä»»ä½•é¡¹ã€‚\nSelf Self æ€»æ˜¯æŒ‡å®ç°ç±»å‹ã€‚\ntraitTrait{// always returns i32 fn returns_num()-\u0026gt; i32;// returns implementing type fn returns_self()-\u0026gt; Self;}struct SomeType;struct OtherType;implTraitforSomeType{fn returns_num()-\u0026gt; i32 {5}// Self == SomeType fn returns_self()-\u0026gt; Self{SomeType}}implTraitforOtherType{fn returns_num()-\u0026gt; i32 {6}// Self == OtherType fn returns_self()-\u0026gt; Self{OtherType}}å‡½æ•° Trait å‡½æ•°æ˜¯ä»»ä½•ç¬¬ä¸€ä¸ªå‚æ•°ä¸ä½¿ç”¨ self å…³é”®å­—çš„å‡½æ•°ã€‚\ntraitDefault{// function fn default()-\u0026gt; Self;}Trait å‡½æ•°å¯ä»¥é€šè¿‡ trait æˆ–å®ç°ç±»å‹æŒ‰ç…§å‘½åç©ºé—´çš„æ–¹å¼æ¥è°ƒç”¨ã€‚\nfn main(){letzero: i32 =Default::default();letzero=i32::default();}æ–¹æ³• Trait æ–¹æ³•æ˜¯æŒ‡ç¬¬ä¸€ä¸ªå‚æ•°ä½¿ç”¨ self å…³é”®å­—å¹¶ä¸”ç±»å‹ä¸º Selfã€\u0026amp;Selfã€\u0026amp;mut Self çš„ä»»ä½•å‡½æ•°ã€‚å‰é¢çš„ç±»å‹ä¹Ÿå¯ä»¥ç”¨ Boxã€Rcã€Arc æˆ– Pin æ¥åŒ…è£…ã€‚\ntraitTrait{// methods fn takes_self(self);fn takes_immut_self(\u0026amp;self);fn takes_mut_self(\u0026amp;mutself);// above methods desugared fn takes_self(self: Self);fn takes_immut_self(self: \u0026amp;Self);fn takes_mut_self(self: \u0026amp;mutSelf);}// example from standard library traitToString{fn to_string(\u0026amp;self)-\u0026gt; String;}å¯ä»¥ä½¿ç”¨å®ç°ç±»å‹ä¸Šçš„ç‚¹è¿ç®—ç¬¦æ¥è°ƒç”¨æ–¹æ³•ã€‚\nfn main(){letfive=5.to_string();}ç„¶è€Œï¼Œä¸å‡½æ•°ç±»ä¼¼ï¼Œå®ƒä»¬ä¹Ÿå¯ä»¥é€šè¿‡ trait æˆ–å®ç°ç±»å‹æŒ‰ç…§å‘½åç©ºé—´çš„æ–¹å¼æ¥è°ƒç”¨ã€‚\nfn main(){letfive=ToString::to_string(\u0026amp;5);letfive=i32::to_string(\u0026amp;5);}å…³è”ç±»å‹ Trait å¯ä»¥æœ‰å…³è”ç±»å‹ã€‚å½“æˆ‘ä»¬éœ€è¦åœ¨å‡½æ•°ç­¾åä¸­ä½¿ç”¨ Self ä»¥å¤–çš„å…¶ä»–ç±»å‹ï¼Œä½†åˆå¸Œæœ›ç±»å‹ç”±å®ç°è€…é€‰æ‹©ï¼Œè€Œä¸æ˜¯åœ¨ trait å£°æ˜ä¸­ç¡¬ç¼–ç æ—¶ï¼Œè¿™å¾ˆæœ‰ç”¨ã€‚\ntraitTrait{type AssociatedType;fn func(arg: Self::AssociatedType);}struct SomeType;struct OtherType;// any type implementing Trait can // choose the type of AssociatedType implTraitforSomeType{type AssociatedType=i8;// chooses i8 fn func(arg: Self::AssociatedType){}}implTraitforOtherType{type AssociatedType=u8;// chooses u8 fn func(arg: Self::AssociatedType){}}fn main(){SomeType::func(-1_i8);// can only call func with i8 on SomeType OtherType::func(1_u8);// can only call func with u8 on OtherType }æ³›å‹å‚æ•° â€œæ³›å‹å‚æ•°â€ æ³›æŒ‡æ³›å‹ç±»å‹å‚æ•°ã€æ³›å‹ lifetime å‚æ•°å’Œæ³›å‹å¸¸é‡å‚æ•°ã€‚ç”±äºè¿™äº›è¯´èµ·æ¥éƒ½å¾ˆæ‹—å£ï¼Œæ‰€ä»¥äººä»¬é€šå¸¸æŠŠå®ƒä»¬ç¼©å†™ä¸º \u0026ldquo;generic types\u0026rdquo;, \u0026ldquo;lifetimes\u0026rdquo; å’Œ \u0026ldquo;generic consts\u0026rdquo;ã€‚ç”±äº generic consts æ²¡æœ‰åœ¨æˆ‘ä»¬å°†è¦æ¶‰åŠçš„ä»»ä½•æ ‡å‡†åº“ trait ä¸­ä½¿ç”¨ï¼Œæ‰€ä»¥å®ƒä»¬ä¸åœ¨æœ¬æ–‡çš„èŒƒå›´ä¹‹å†…ã€‚\næˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‚æ•°æ¥æ³›å‹åŒ–ä¸€ä¸ª trait å£°æ˜ã€‚\n// trait declaration generalized with lifetime \u0026amp; type parameters traitTrait\u0026lt;\u0026#39;a,T\u0026gt;{// signature uses generic type fn func1(arg: T);// signature uses lifetime fn func2(arg: \u0026amp;\u0026#39;ai32);// signature uses generic type \u0026amp; lifetime fn func3(arg: \u0026amp;\u0026#39;aT);}struct SomeType;impl\u0026lt;\u0026#39;a\u0026gt;Trait\u0026lt;\u0026#39;a,i8\u0026gt;forSomeType{fn func1(arg: i8){}fn func2(arg: \u0026amp;\u0026#39;ai32){}fn func3(arg: \u0026amp;\u0026#39;ai8){}}impl\u0026lt;\u0026#39;b\u0026gt;Trait\u0026lt;\u0026#39;b,u8\u0026gt;forSomeType{fn func1(arg: u8){}fn func2(arg: \u0026amp;\u0026#39;bi32){}fn func3(arg: \u0026amp;\u0026#39;bu8){}}å¯ä»¥ä¸ºæ³›å‹ç±»å‹æä¾›é»˜è®¤å€¼ã€‚æœ€å¸¸ç”¨çš„é»˜è®¤å€¼æ˜¯ Selfï¼Œä½†ä»»ä½•ç±»å‹éƒ½å¯ä»¥ã€‚\n// make T = Self by default traitTrait\u0026lt;T=Self\u0026gt;{fn func(t: T){}}// any type can be used as the default traitTrait2\u0026lt;T=i32\u0026gt;{fn func2(t: T){}}struct SomeType;// omitting the generic type will // cause the impl to use the default // value, which is Self here implTraitforSomeType{fn func(t: SomeType){}}// default value here is i32 implTrait2forSomeType{fn func2(t: i32){}}// the default is overridable as we\u0026#39;d expect implTrait\u0026lt;String\u0026gt;forSomeType{fn func(t: String){}}// overridable here too implTrait2\u0026lt;String\u0026gt;forSomeType{fn func2(t: String){}}é™¤äº†å¯¹ trait è¿›è¡Œå‚æ•°åŒ–å¤–ï¼Œè¿˜å¯ä»¥å¯¹å•ä¸ªå‡½æ•°å’Œæ–¹æ³•è¿›è¡Œå‚æ•°åŒ–ã€‚\ntraitTrait{fn func\u0026lt;\u0026#39;a,T\u0026gt;(t: \u0026amp;\u0026#39;aT);}æ³›å‹ç±»å‹ vs å…³è”ç±»å‹ æ³›å‹ç±»å‹å’Œå…³è”ç±»å‹éƒ½å°†å†³å®šæƒäº¤ç»™äº†å®ç°è€…ï¼Œè®©ä»–ä»¬å†³å®šåœ¨ trait çš„å‡½æ•°å’Œæ–¹æ³•ä¸­åº”è¯¥ä½¿ç”¨å“ªç§å…·ä½“ç±»å‹ï¼Œæ‰€ä»¥æœ¬èŠ‚è¯•å›¾è§£é‡Šä»€ä¹ˆæ—¶å€™ä½¿ç”¨ä¸€ç§ç±»å‹è€Œä¸æ˜¯å¦ä¸€ç§ç±»å‹ã€‚\nä¸€èˆ¬çš„ç»éªŒæ³•åˆ™æ˜¯\n å½“æ¯ä¸ªç±»å‹åªèƒ½æœ‰ä¸€ä¸ª trait çš„å®ç°æ—¶ï¼Œä½¿ç”¨å…³è”ç±»å‹ã€‚ å½“æ¯ä¸ªç±»å‹å¯ä»¥æœ‰è®¸å¤šå¯èƒ½çš„ trait çš„å®ç°æ—¶ï¼Œä½¿ç”¨æ³›å‹ç±»å‹ã€‚  å‡è®¾æˆ‘ä»¬æƒ³å®šä¹‰ä¸€ä¸ªåä¸º Add çš„ traitï¼Œå®ƒå…è®¸æˆ‘ä»¬å°†å€¼åŠ åœ¨ä¸€èµ·ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªåˆå§‹è®¾è®¡å’Œåªä½¿ç”¨å…³è”ç±»å‹çš„å®ç°ã€‚\ntraitAdd{type Rhs;type Output;fn add(self,rhs: Self::Rhs)-\u0026gt; Self::Output;}struct Point{x: i32,y: i32,}implAddforPoint{type Rhs=Point;type Output=Point;fn add(self,rhs: Point)-\u0026gt; Point{Point{x: self.x+rhs.x,y: self.y+rhs.y,}}}fn main(){letp1=Point{x: 1,y: 1};letp2=Point{x: 2,y: 2};letp3=p1.add(p2);assert_eq!(p3.x,3);assert_eq!(p3.y,3);}æ¯”æ–¹è¯´ï¼Œæˆ‘ä»¬æƒ³ç»™ Point æ·»åŠ å’Œ i32 ç›¸åŠ çš„èƒ½åŠ›ï¼Œå…¶ä¸­ i32 å°†å’Œ x å’Œ y æˆå‘˜ç›¸åŠ ã€‚\ntraitAdd{type Rhs;type Output;fn add(self,rhs: Self::Rhs)-\u0026gt; Self::Output;}struct Point{x: i32,y: i32,}implAddforPoint{type Rhs=Point;type Output=Point;fn add(self,rhs: Point)-\u0026gt; Point{Point{x: self.x+rhs.x,y: self.y+rhs.y,}}}implAddforPoint{// âŒ type Rhs=i32;type Output=Point;fn add(self,rhs: i32)-\u0026gt; Point{Point{x: self.x+rhs,y: self.y+rhs,}}}fn main(){letp1=Point{x: 1,y: 1};letp2=Point{x: 2,y: 2};letp3=p1.add(p2);assert_eq!(p3.x,3);assert_eq!(p3.y,3);letp1=Point{x: 1,y: 1};letint2=2;letp3=p1.add(int2);// âŒ assert_eq!(p3.x,3);assert_eq!(p3.y,3);}è¿™æŠ›å‡º:\nerror[E0119]: conflicting implementations of trait `Add` for type `Point`:\r--\u0026gt; src/main.rs:23:1\r|\r12 | impl Add for Point {\r| ------------------ first implementation here\r...\r23 | impl Add for Point {\r| ^^^^^^^^^^^^^^^^^^ conflicting implementation for `Point`\rç”±äº Add trait æ²¡æœ‰ä»»ä½•æ³›å‹ç±»å‹çš„å‚æ•°åŒ–ï¼Œæˆ‘ä»¬åªèƒ½å¯¹æ¯ä¸ªç±»å‹è¿›è¡Œä¸€æ¬¡å®ç°ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬åªèƒ½ä¸º Rhs å’Œ Output é€‰æ‹©ä¸€æ¬¡ç±»å‹ï¼ä¸ºäº†å…è®¸ Point å’Œ Point ç›¸åŠ ,ä»¥åŠ i32 å’Œ Point ç›¸åŠ ï¼Œæˆ‘ä»¬å¿…é¡»å°† Rhs ä»å…³è”ç±»å‹é‡æ„ä¸ºæ³›å‹ç±»å‹ï¼Œè¿™å°†å…è®¸æˆ‘ä»¬ç”¨ä¸åŒçš„ç±»å‹å‚æ•°ä¸º Rhs å¤šæ¬¡å®ç° Point traitã€‚\ntraitAdd\u0026lt;Rhs\u0026gt;{type Output;fn add(self,rhs: Rhs)-\u0026gt; Self::Output;}struct Point{x: i32,y: i32,}implAdd\u0026lt;Point\u0026gt;forPoint{type Output=Self;fn add(self,rhs: Point)-\u0026gt; Self::Output{Point{x: self.x+rhs.x,y: self.y+rhs.y,}}}implAdd\u0026lt;i32\u0026gt;forPoint{// âœ… type Output=Self;fn add(self,rhs: i32)-\u0026gt; Self::Output{Point{x: self.x+rhs,y: self.y+rhs,}}}fn main(){letp1=Point{x: 1,y: 1};letp2=Point{x: 2,y: 2};letp3=p1.add(p2);assert_eq!(p3.x,3);assert_eq!(p3.y,3);letp1=Point{x: 1,y: 1};letint2=2;letp3=p1.add(int2);// âœ… assert_eq!(p3.x,3);assert_eq!(p3.y,3);}æ¯”æ–¹è¯´ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªåä¸º Line çš„æ–°ç±»å‹ï¼Œå®ƒåŒ…å«ä¸¤ä¸ª Pointï¼Œç°åœ¨åœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­ï¼Œå°†ä¸¤ä¸ª Point ç›¸åŠ åº”è¯¥äº§ç”Ÿä¸€ä¸ª Line è€Œä¸æ˜¯ Pointã€‚è€ƒè™‘åˆ° Add trait å½“å‰çš„è®¾è®¡ï¼Œè¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸º Output æ˜¯ä¸€ä¸ªå…³è”ç±»å‹ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡å°† Output ä»å…³è”ç±»å‹é‡æ„ä¸ºæ³›å‹ç±»å‹æ¥æ»¡è¶³è¿™äº›æ–°çš„è¦æ±‚ã€‚\ntraitAdd\u0026lt;Rhs,Output\u0026gt;{fn add(self,rhs: Rhs)-\u0026gt; Output;}struct Point{x: i32,y: i32,}implAdd\u0026lt;Point,Point\u0026gt;forPoint{fn add(self,rhs: Point)-\u0026gt; Point{Point{x: self.x+rhs.x,y: self.y+rhs.y,}}}implAdd\u0026lt;i32,Point\u0026gt;forPoint{fn add(self,rhs: i32)-\u0026gt; Point{Point{x: self.x+rhs,y: self.y+rhs,}}}struct Line{start: Point,end: Point,}implAdd\u0026lt;Point,Line\u0026gt;forPoint{// âœ… fn add(self,rhs: Point)-\u0026gt; Line{Line{start: self,end: rhs,}}}fn main(){letp1=Point{x: 1,y: 1};letp2=Point{x: 2,y: 2};letp3: Point=p1.add(p2);assert!(p3.x==3\u0026amp;\u0026amp;p3.y==3);letp1=Point{x: 1,y: 1};letint2=2;letp3=p1.add(int2);assert!(p3.x==3\u0026amp;\u0026amp;p3.y==3);letp1=Point{x: 1,y: 1};letp2=Point{x: 2,y: 2};letl: Line=p1.add(p2);// âœ… assert!(l.start.x==1\u0026amp;\u0026amp;l.start.y==1\u0026amp;\u0026amp;l.end.x==2\u0026amp;\u0026amp;l.end.y==2)}é‚£ä¹ˆï¼Œä¸Šé¢çš„ Add trait å“ªç§æœ€å¥½å‘¢ï¼Ÿè¿™çœŸçš„å–å†³äºä½ çš„ç¨‹åºçš„è¦æ±‚! åˆé€‚çš„å°±æ˜¯æœ€å¥½çš„ã€‚\nä½œç”¨åŸŸ Trait é¡¹ä¸èƒ½ä½¿ç”¨ï¼Œé™¤éè¯¥ trait åœ¨ä½œç”¨åŸŸå†…ã€‚å¤§å¤šæ•° Rustaceans åœ¨ç¬¬ä¸€æ¬¡å°è¯•å†™ä¸€ä¸ªç”¨ I/O åšä»»ä½•äº‹æƒ…çš„ç¨‹åºæ—¶ï¼Œéƒ½ä¼šè‰°éš¾åœ°å­¦ä¼šè¿™ä¸€ç‚¹ï¼Œå› ä¸º Read å’Œ Write trait ä¸åœ¨æ ‡å‡†åº“çš„é¢„åŠ è½½ä¸­ã€‚\nusestd::fs::File;usestd::io;fn main()-\u0026gt; Result\u0026lt;(),io::Error\u0026gt;{letmutfile=File::open(\u0026#34;Cargo.toml\u0026#34;)?;letmutbuffer=String::new();file.read_to_string(\u0026amp;mutbuffer)?;// âŒ read_to_string not found in File Ok(())}read_to_string(buf: \u0026amp;mut String) ç”± std::io::Read trait å£°æ˜ï¼Œå¹¶ç”± std::fs::File ç»“æ„ä½“å®ç°ï¼Œä½†ä¸ºäº†è°ƒç”¨å®ƒï¼Œstd::io::Read å¿…é¡»åœ¨ä½œç”¨åŸŸå†…ã€‚\nusestd::fs::File;usestd::io;usestd::io::Read;// âœ… fn main()-\u0026gt; Result\u0026lt;(),io::Error\u0026gt;{letmutfile=File::open(\u0026#34;Cargo.toml\u0026#34;)?;letmutbuffer=String::new();file.read_to_string(\u0026amp;mutbuffer)?;// âœ… Ok(())}æ ‡å‡†åº“ä¸­çš„ prelude æ˜¯æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªæ¨¡å—ï¼Œå³ std::prelude::v1ï¼Œå®ƒåœ¨æ¯ä¸ªå…¶ä»–æ¨¡å—çš„é¡¶éƒ¨è¢«è‡ªåŠ¨å¯¼å…¥ï¼Œå³ use std::prelude::v1::*ã€‚å› æ­¤ï¼Œä¸‹é¢çš„ trait æ€»æ˜¯åœ¨ä½œç”¨åŸŸå†…ï¼Œæˆ‘ä»¬æ°¸è¿œä¸éœ€è¦æ˜¾å¼å¯¼å…¥å®ƒä»¬ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ prelude çš„ä¸€éƒ¨åˆ†ã€‚\n AsMut AsRef Clone Copy Default Drop Eq Fn FnMut FnOnce From Into ToOwned IntoIterator Iterator PartialEq PartialOrd Send Sized Sync ToString Ord  æ´¾ç”Ÿå® æ ‡å‡†åº“å¯¼å‡ºäº†ä¸€äº›æ´¾ç”Ÿå®ï¼Œå¦‚æœä¸€ä¸ªç±»å‹çš„æ‰€æœ‰æˆå‘˜éƒ½å®ç°äº†æŸä¸ª trait, æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™äº›å®æ¥å¿«é€Ÿæ–¹ä¾¿åœ°åœ¨è¿™ä¸ªç±»å‹ä¸Šå®ç°è¯¥ traitã€‚è¿™äº›æ´¾ç”Ÿå®ä»¥å®ƒä»¬æ‰€å®ç°çš„ trait å‘½åã€‚\n Clone Copy Debug Default Eq Hash Ord PartialEq PartialOrd  ä½¿ç”¨ç¤ºä¾‹:\n// macro derives Copy \u0026amp; Clone impl for SomeType #[derive(Copy, Clone)]struct SomeType;æ³¨æ„ï¼šæ´¾ç”Ÿå®åªæ˜¯è¿‡ç¨‹å®ï¼Œå¯ä»¥åšä»»ä½•äº‹æƒ…ï¼Œæ²¡æœ‰ç¡¬æ€§è§„å®šä¸€å®šè¦å®ç°ä¸€ä¸ª traitï¼Œä¹Ÿæ²¡æœ‰è§„å®šåªæœ‰åœ¨ç±»å‹çš„æ‰€æœ‰æˆå‘˜éƒ½å®ç°ä¸€ä¸ª trait çš„æƒ…å†µä¸‹æ‰èƒ½å·¥ä½œï¼Œè¿™äº›åªæ˜¯æ ‡å‡†åº“ä¸­æ´¾ç”Ÿå®æ‰€éµå¾ªçš„çº¦å®šã€‚\né»˜è®¤å®ç° Trait å¯ä»¥ä¸ºå…¶å‡½æ•°å’Œæ–¹æ³•æä¾›é»˜è®¤çš„å®ç°ã€‚\ntraitTrait{fn method(\u0026amp;self){println!(\u0026#34;default impl\u0026#34;);}}struct SomeType;struct OtherType;// use default impl for Trait::method implTraitforSomeType{}implTraitforOtherType{// use our own impl for Trait::method fn method(\u0026amp;self){println!(\u0026#34;OtherType impl\u0026#34;);}}fn main(){SomeType.method();// prints \u0026#34;default impl\u0026#34; OtherType.method();// prints \u0026#34;OtherType impl\u0026#34; }å¦‚æœä¸€äº› trait æ–¹æ³•å¯ä»¥åªç”¨å…¶ä»– trait æ–¹æ³•æ¥å®ç°ï¼Œè¿™å°±ç‰¹åˆ«æ–¹ä¾¿ã€‚\ntraitGreet{fn greet(\u0026amp;self,name: \u0026amp;str)-\u0026gt; String;fn greet_loudly(\u0026amp;self,name: \u0026amp;str)-\u0026gt; String {self.greet(name)+\u0026#34;!\u0026#34;}}struct Hello;struct Hola;implGreetforHello{fn greet(\u0026amp;self,name: \u0026amp;str)-\u0026gt; String {format!(\u0026#34;Hello {}\u0026#34;,name)}// use default impl for greet_loudly }implGreetforHola{fn greet(\u0026amp;self,name: \u0026amp;str)-\u0026gt; String {format!(\u0026#34;Hola {}\u0026#34;,name)}// override default impl fn greet_loudly(\u0026amp;self,name: \u0026amp;str)-\u0026gt; String {letmutgreeting=self.greet(name);greeting.insert_str(0,\u0026#34;Â¡\u0026#34;);greeting+\u0026#34;!\u0026#34;}}fn main(){println!(\u0026#34;{}\u0026#34;,Hello.greet(\u0026#34;John\u0026#34;));// prints \u0026#34;Hello John\u0026#34; println!(\u0026#34;{}\u0026#34;,Hello.greet_loudly(\u0026#34;John\u0026#34;));// prints \u0026#34;Hello John!\u0026#34; println!(\u0026#34;{}\u0026#34;,Hola.greet(\u0026#34;John\u0026#34;));// prints \u0026#34;Hola John\u0026#34; println!(\u0026#34;{}\u0026#34;,Hola.greet_loudly(\u0026#34;John\u0026#34;));// prints \u0026#34;Â¡Hola John!\u0026#34; }æ ‡å‡†åº“ä¸­çš„è®¸å¤š trait ä¸ºå®ƒä»¬çš„è®¸å¤šæ–¹æ³•æä¾›äº†é»˜è®¤çš„å®ç°ã€‚\nGeneric Blanket Impls é€šç”¨å…¨é¢å®ç°æ˜¯åœ¨æ³›å‹ç±»å‹è€Œä¸æ˜¯å…·ä½“ç±»å‹ä¸Šçš„å®ç°ã€‚ä¸ºäº†è§£é‡Šä¸ºä»€ä¹ˆä»¥åŠå¦‚ä½•ä½¿ç”¨ï¼Œè®©æˆ‘ä»¬ä»ä¸ºæ•°å­—ç±»å‹ç¼–å†™ä¸€ä¸ª is_even æ–¹æ³•å¼€å§‹ã€‚\ntraitEven{fn is_even(self)-\u0026gt; bool;}implEvenfori8{fn is_even(self)-\u0026gt; bool {self%2_i8==0_i8}}implEvenforu8{fn is_even(self)-\u0026gt; bool {self%2_u8==0_u8}}implEvenfori16{fn is_even(self)-\u0026gt; bool {self%2_i16==0_i16}}// etc #[test]// âœ… fn test_is_even(){assert!(2_i8.is_even());assert!(4_u8.is_even());assert!(6_i16.is_even());// etc }æ˜¾ç„¶ï¼Œè¿™æ˜¯å¾ˆå•°å—¦çš„ã€‚è€Œä¸”ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„å®ç°å‡ ä¹éƒ½æ˜¯ä¸€æ ·çš„ã€‚æ­¤å¤–ï¼Œå¦‚æœ Rust å†³å®šåœ¨æœªæ¥æ·»åŠ æ›´å¤šçš„æ•°å­—ç±»å‹ï¼Œæˆ‘ä»¬å¿…é¡»è®°å¾—å›åˆ°è¿™æ®µä»£ç ï¼Œå¹¶ç”¨æ–°çš„æ•°å­—ç±»å‹æ›´æ–°å®ƒã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªé€šç”¨çš„å…¨é¢å®ç°æ¥è§£å†³æ‰€æœ‰è¿™äº›é—®é¢˜ã€‚\nusestd::fmt::Debug;usestd::convert::TryInto;usestd::ops::Rem;traitEven{fn is_even(self)-\u0026gt; bool;}// generic blanket impl impl\u0026lt;T\u0026gt;EvenforTwhereT: Rem\u0026lt;Output=T\u0026gt;+PartialEq\u0026lt;T\u0026gt;+Sized,u8: TryInto\u0026lt;T\u0026gt;,\u0026lt;u8asTryInto\u0026lt;T\u0026gt;\u0026gt;::Error: Debug,{fn is_even(self)-\u0026gt; bool {// these unwraps will never panic self%2.try_into().unwrap()==0.try_into().unwrap()}}#[test]// âœ… fn test_is_even(){assert!(2_i8.is_even());assert!(4_u8.is_even());assert!(6_i16.is_even());// etc }Unlike default impls, which provide an impl, generic blanket impls provide the impl, so they are not overridable. ä¸é»˜è®¤å®ç°ä¸åŒï¼Œé»˜è®¤çš„å®ç°æä¾›äº†ä¸€ä¸ªå®ç°ï¼Œè€Œé€šç”¨çš„å…¨é¢å®ç°æä¾›äº†ç‰¹å®šçš„å®ç°ï¼Œæ‰€ä»¥å®ƒä»¬æ˜¯ä¸å¯è¦†ç›–çš„ã€‚\nusestd::fmt::Debug;usestd::convert::TryInto;usestd::ops::Rem;traitEven{fn is_even(self)-\u0026gt; bool;}impl\u0026lt;T\u0026gt;EvenforTwhereT: Rem\u0026lt;Output=T\u0026gt;+PartialEq\u0026lt;T\u0026gt;+Sized,u8: TryInto\u0026lt;T\u0026gt;,\u0026lt;u8asTryInto\u0026lt;T\u0026gt;\u0026gt;::Error: Debug,{fn is_even(self)-\u0026gt; bool {self%2.try_into().unwrap()==0.try_into().unwrap()}}implEvenforu8{// âŒ fn is_even(self)-\u0026gt; bool {self%2_u8==0_u8}}è¿™æŠ›å‡º:\nerror[E0119]: conflicting implementations of trait `Even` for type `u8`:\r--\u0026gt; src/lib.rs:22:1\r|\r10 | / impl\u0026lt;T\u0026gt; Even for T\r11 | | where\r12 | | T: Rem\u0026lt;Output = T\u0026gt; + PartialEq\u0026lt;T\u0026gt; + Sized,\r13 | | u8: TryInto\u0026lt;T\u0026gt;,\r... |\r19 | | }\r20 | | }\r| |_- first implementation here\r21 | 22 | impl Even for u8 {\r| ^^^^^^^^^^^^^^^^ conflicting implementation for `u8`\rThese impls overlap, hence they conflict, hence Rust rejects the code to ensure trait coherence. Trait coherence is the property that there exists at most one impl of a trait for any given type. The rules Rust uses to enforce trait coherence, the implications of those rules, and workarounds for the implications are outside the scope of this article.\nè¿™äº›å®ç°é‡å äº†ï¼Œå› æ­¤å®ƒä»¬å†²çªï¼Œå› æ­¤ Rust æ‹’ç»äº†ç¡®ä¿ trait ä¸€è‡´æ€§çš„ä»£ç ã€‚Trait ä¸€è‡´æ€§æ˜¯æŒ‡ä»»ä½•ç»™å®šç±»å‹çš„ trait æœ€å¤šå­˜åœ¨ä¸€ä¸ªå®ç°çš„å±æ€§ã€‚Rust ç”¨æ¥å¼ºåˆ¶æ‰§è¡Œ trait ä¸€è‡´æ€§çš„è§„åˆ™ï¼Œè¿™äº›è§„åˆ™çš„å«ä¹‰ï¼Œä»¥åŠå«ä¹‰çš„å˜é€šæ–¹æ³•éƒ½ä¸åœ¨æœ¬æ–‡çš„èŒƒå›´å†…ã€‚\nSubtraits \u0026amp; Supertraits \u0026ldquo;subtrait\u0026rdquo; ä¸­çš„ \u0026ldquo;sub\u0026rdquo; æŒ‡çš„æ˜¯å­é›†ï¼Œ\u0026ldquo;supertrait\u0026rdquo; ä¸­çš„ \u0026ldquo;super\u0026rdquo; æŒ‡çš„æ˜¯è¶…é›†ã€‚å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªè¿™æ ·çš„ trait å£°æ˜ã€‚\ntraitSubtrait: Supertrait{}All of the types which impl Subtrait are a subset of all the types which impl Supertrait, or to put it in opposite but equivalent terms: all the types which impl Supertrait are a superset of all the types which impl Subtrait.\nAlso, the above is just syntax sugar for: æ‰€æœ‰å®ç° Subtrait çš„ç±»å‹éƒ½æ˜¯æ‰€æœ‰å®ç° Supertrait çš„ç±»å‹çš„å­é›†ï¼Œæˆ–è€…ç”¨ç›¸åä½†ç­‰ä»·çš„è¯è¯­æ¥è¡¨è¾¾ï¼šæ‰€æœ‰å®ç° Supertrait çš„ç±»å‹éƒ½æ˜¯æ‰€æœ‰å®ç° Subtrait çš„ç±»å‹çš„è¶…é›†ã€‚\nå¦å¤–ï¼Œä¸Šé¢çš„ä»£ç åªæ˜¯ä¸‹é¢è¿™æ®µä»£ç çš„è¯­æ³•ç³–:\ntraitSubtraitwhereSelf: Supertrait{}è¿™æ˜¯ä¸€ä¸ªå¾®å¦™è€Œåˆé‡è¦çš„åŒºåˆ«ï¼Œè¦ç†è§£çš„æ˜¯ï¼Œçº¦æŸæ˜¯åœ¨ Self ä¸Šçš„ï¼Œå³å®ç° Subtrait çš„ç±»å‹ï¼Œè€Œä¸æ˜¯åœ¨ Subtrait æœ¬èº«ã€‚åè€…æ˜¯æ²¡æœ‰ä»»ä½•æ„ä¹‰çš„ï¼Œå› ä¸º trait çº¦æŸåªèƒ½åº”ç”¨äºå…·ä½“çš„ç±»å‹ï¼Œè¿™äº›ç±»å‹å¯ä»¥å®ç° traitã€‚Trait ä¸èƒ½å®ç°å…¶ä»– traitã€‚\ntraitSupertrait{fn method(\u0026amp;self){println!(\u0026#34;in supertrait\u0026#34;);}}traitSubtrait: Supertrait{// this looks like it might impl or // override Supertrait::method but it // does not fn method(\u0026amp;self){println!(\u0026#34;in subtrait\u0026#34;)}}struct SomeType;// adds Supertrait::method to SomeType implSupertraitforSomeType{}// adds Subtrait::method to SomeType implSubtraitforSomeType{}// both methods exist on SomeType simultaneously // neither overriding or shadowing the other fn main(){SomeType.method();// âŒ ambiguous method call // must disambiguate using fully-qualified syntax \u0026lt;SomeTypeasSupertrait\u0026gt;::method(\u0026amp;st);// âœ… prints \u0026#34;in supertrait\u0026#34; \u0026lt;SomeTypeasSubtrait\u0026gt;::method(\u0026amp;st);// âœ… prints \u0026#34;in subtrait\u0026#34; }Furthermore, there are no rules for how a type must impl both a subtrait and a supertrait. It can use the methods from either in the impl of the other. æ­¤å¤–ï¼Œæ²¡æœ‰è§„å®šä¸€ä¸ªç±»å‹å¿…é¡»åŒæ—¶å®ç°ä¸€ä¸ª subtrait å’Œä¸€ä¸ª supertraitã€‚å®ƒå¯ä»¥åœ¨å¦ä¸€ä¸ªç±»å‹çš„å®ç°ä¸­ä½¿ç”¨å…¶ä¸­ä¸€ä¸ªç±»å‹çš„æ–¹æ³•ã€‚\ntraitSupertrait{fn super_method(\u0026amp;mutself);}traitSubtrait: Supertrait{fn sub_method(\u0026amp;mutself);}struct CallSuperFromSub;implSupertraitforCallSuperFromSub{fn super_method(\u0026amp;mutself){println!(\u0026#34;in super\u0026#34;);}}implSubtraitforCallSuperFromSub{fn sub_method(\u0026amp;mutself){println!(\u0026#34;in sub\u0026#34;);self.super_method();}}struct CallSubFromSuper;implSupertraitforCallSubFromSuper{fn super_method(\u0026amp;mutself){println!(\u0026#34;in super\u0026#34;);self.sub_method();}}implSubtraitforCallSubFromSuper{fn sub_method(\u0026amp;mutself){println!(\u0026#34;in sub\u0026#34;);}}struct CallEachOther(bool);implSupertraitforCallEachOther{fn super_method(\u0026amp;mutself){println!(\u0026#34;in super\u0026#34;);ifself.0{self.0=false;self.sub_method();}}}implSubtraitforCallEachOther{fn sub_method(\u0026amp;mutself){println!(\u0026#34;in sub\u0026#34;);ifself.0{self.0=false;self.super_method();}}}fn main(){CallSuperFromSub.super_method();// prints \u0026#34;in super\u0026#34; CallSuperFromSub.sub_method();// prints \u0026#34;in sub\u0026#34;, \u0026#34;in super\u0026#34; CallSubFromSuper.super_method();// prints \u0026#34;in super\u0026#34;, \u0026#34;in sub\u0026#34; CallSubFromSuper.sub_method();// prints \u0026#34;in sub\u0026#34; CallEachOther(true).super_method();// prints \u0026#34;in super\u0026#34;, \u0026#34;in sub\u0026#34; CallEachOther(true).sub_method();// prints \u0026#34;in sub\u0026#34;, \u0026#34;in super\u0026#34; }Hopefully the examples above show that the relationship between subtraits and supertraits can be complex. Before introducing a mental model that neatly encapsulates all of that complexity let\u0026rsquo;s quickly review and establish the mental model we use for understanding trait bounds on generic types: å¸Œæœ›ä¸Šé¢çš„ä¾‹å­èƒ½è¡¨æ˜ï¼Œsubtrait å’Œ supertrait ä¹‹é—´çš„å…³ç³»å¯èƒ½å¾ˆå¤æ‚ã€‚åœ¨ä»‹ç»ä¸€ä¸ªèƒ½æ•´é½åœ°æ¦‚æ‹¬æ‰€æœ‰è¿™äº›å¤æ‚æ€§çš„å¿ƒç†æ¨¡å‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å¿«é€Ÿå›é¡¾å¹¶å»ºç«‹æˆ‘ä»¬ç”¨äºç†è§£æ³›å‹ä¸Šçš„ trait çº¦æŸçš„å¿ƒç†æ¨¡å‹ã€‚\nfn function\u0026lt;T: Clone\u0026gt;(t: T){// impl }Without knowing anything about the impl of this function we could reasonably guess that t.clone() gets called at some point because when a generic type is bounded by a trait that strongly implies it has a dependency on the trait. The mental model for understanding the relationship between generic types and their trait bounds is a simple and intuitive one: generic types depend on their trait bounds.\nNow let\u0026rsquo;s look the trait declaration for Copy: åœ¨ä¸äº†è§£è¿™ä¸ªå‡½æ•°çš„å®ç°çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆç†åœ°çŒœæµ‹ t.clone() åœ¨æŸäº›æ—¶å€™ä¼šè¢«è°ƒç”¨ï¼Œå› ä¸ºå½“ä¸€ä¸ªæ³›å‹è¢«ä¸€ä¸ª trait çº¦æŸæ—¶ï¼Œå¼ºçƒˆåœ°æ„å‘³ç€å®ƒå¯¹ trait æœ‰ä¾èµ–æ€§ã€‚ç†è§£æ³›å‹ä¸å…¶ trait çº¦æŸä¹‹é—´å…³ç³»çš„å¿ƒç†æ¨¡å‹æ˜¯ä¸€ä¸ªç®€å•è€Œç›´è§‚çš„æ¨¡å‹ï¼šæ³›å‹ â€œä¾èµ–â€ å…¶ trait çº¦æŸã€‚\nç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ Copy çš„ trait å£°æ˜ã€‚\ntraitCopy: Clone {}ä¸Šé¢çš„è¯­æ³•çœ‹èµ·æ¥éå¸¸ç±»ä¼¼äºåœ¨æ³›å‹ç±»å‹ä¸Šåº”ç”¨ trait çº¦æŸçš„è¯­æ³•ï¼Œç„¶è€Œ Copy æ ¹æœ¬ä¸ä¾èµ–äº Cloneã€‚æˆ‘ä»¬å‰é¢å¼€å‘çš„å¿ƒç†æ¨¡å‹åœ¨è¿™é‡Œå¹¶ä¸èƒ½å¸®åŠ©æˆ‘ä»¬ã€‚åœ¨æˆ‘çœ‹æ¥ï¼Œç†è§£ subtrait å’Œ supertrait ä¹‹é—´å…³ç³»çš„æœ€ç®€å•ã€æœ€ä¼˜é›…çš„å¿ƒç†æ¨¡å‹æ˜¯ï¼šsubtrait â€œç²¾ç‚¼â€ å…¶ supertraitã€‚\nâ€œç²¾ç‚¼â€ è¿™ä¸ªè¯æ•…æ„ä¿æŒæœ‰äº›æ¨¡ç³Šï¼Œå› ä¸ºå®ƒåœ¨ä¸åŒçš„è¯­å¢ƒä¸­å¯ä»¥æœ‰ä¸åŒçš„å«ä¹‰ã€‚\n subtrait å¯èƒ½ä¼šä½¿å®ƒçš„ supertrait çš„æ–¹æ³•æ›´åŠ ç‰¹åŒ–ï¼Œé€Ÿåº¦æ›´å¿«ï¼Œä½¿ç”¨æ›´å°‘çš„å†…å­˜ï¼Œä¾‹å¦‚ï¼šCopy: Clone subtrait å¯ä»¥å¯¹ supertrait çš„æ–¹æ³•çš„å®ç°åšå‡ºé¢å¤–çš„ä¿è¯ï¼Œä¾‹å¦‚ Eq: PartialEq, Ord: PartialOrd, ExactSizeIterator: Iterator subtrait å¯èƒ½ä½¿ supertrait çš„æ–¹æ³•æ›´çµæ´»æˆ–æ›´å®¹æ˜“è°ƒç”¨ï¼Œä¾‹å¦‚ FnMut: FnOnce, `Fn: FnMut subtrait å¯ä»¥æ‰©å±•ä¸€ä¸ª supertraitï¼Œå¹¶æ·»åŠ æ–°çš„æ–¹æ³•ï¼Œä¾‹å¦‚ DoubleEndedIterator: Iterator, ExactSizeIterator: Iterator  Trait å¯¹è±¡ æ³›å‹ç»™äº†æˆ‘ä»¬ç¼–è¯‘æ—¶çš„å¤šæ€æ€§ï¼Œè€Œ trait å¯¹è±¡ç»™äº†æˆ‘ä»¬è¿è¡Œæ—¶çš„å¤šæ€æ€§ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ trait å¯¹è±¡æ¥å…è®¸å‡½æ•°åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°è¿”å›ä¸åŒçš„ç±»å‹ã€‚\nfn example(condition: bool,vec: Vec\u0026lt;i32\u0026gt;)-\u0026gt; Box\u0026lt;dynIterator\u0026lt;Item=i32\u0026gt;\u0026gt;{letiter=vec.into_iter();ifcondition{// Has type: // Box\u0026lt;Map\u0026lt;IntoIter\u0026lt;i32\u0026gt;, Fn(i32) -\u0026gt; i32\u0026gt;\u0026gt; // But is cast to: // Box\u0026lt;dyn Iterator\u0026lt;Item = i32\u0026gt;\u0026gt; Box::new(iter.map(|n|n*2))}else{// Has type: // Box\u0026lt;Filter\u0026lt;IntoIter\u0026lt;i32\u0026gt;, Fn(\u0026amp;i32) -\u0026gt; bool\u0026gt;\u0026gt; // But is cast to: // Box\u0026lt;dyn Iterator\u0026lt;Item = i32\u0026gt;\u0026gt; Box::new(iter.filter(|\u0026amp;n|n\u0026gt;=2))}}Trait å¯¹è±¡è¿˜å…è®¸æˆ‘ä»¬åœ¨é›†åˆä¸­å­˜å‚¨å¼‚æ„ç±»å‹ã€‚\nusestd::f64::consts::PI;struct Circle{radius: f64,}struct Square{side: f64 }traitShape{fn area(\u0026amp;self)-\u0026gt; f64;}implShapeforCircle{fn area(\u0026amp;self)-\u0026gt; f64 {PI*self.radius*self.radius}}implShapeforSquare{fn area(\u0026amp;self)-\u0026gt; f64 {self.side*self.side}}fn get_total_area(shapes: Vec\u0026lt;Box\u0026lt;dynShape\u0026gt;\u0026gt;)-\u0026gt; f64 {shapes.into_iter().map(|s|s.area()).sum()}fn example(){letshapes: Vec\u0026lt;Box\u0026lt;dynShape\u0026gt;\u0026gt;=vec![Box::new(Circle{radius: 1.0}),// Box\u0026lt;Circle\u0026gt; cast to Box\u0026lt;dyn Shape\u0026gt; Box::new(Square{side: 1.0}),// Box\u0026lt;Square\u0026gt; cast to Box\u0026lt;dyn Shape\u0026gt; ];assert_eq!(PI+1.0,get_total_area(shapes));// âœ… }Trait å¯¹è±¡æ˜¯ä¸ç¡®å®šå¤§å°çš„ï¼Œæ‰€ä»¥å®ƒä»¬å¿…é¡»æ€»æ˜¯åœ¨æŒ‡é’ˆåé¢ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®ç±»å‹ä¸­æ˜¯å¦å­˜åœ¨ dyn å…³é”®å­—æ¥åŒºåˆ†å…·ä½“ç±»å‹å’Œ trait å¯¹è±¡ã€‚\nstruct Struct;traitTrait{}// regular struct \u0026amp;StructBox\u0026lt;Struct\u0026gt;Rc\u0026lt;Struct\u0026gt;Arc\u0026lt;Struct\u0026gt;// trait objects \u0026amp;dynTraitBox\u0026lt;dynTrait\u0026gt;Rc\u0026lt;dynTrait\u0026gt;Arc\u0026lt;dynTrait\u0026gt;å¹¶éæ‰€æœ‰çš„ trait éƒ½å¯ä»¥è½¬æ¢ä¸º trait å¯¹è±¡ã€‚å¦‚æœä¸€ä¸ª trait æ»¡è¶³è¿™äº›è¦æ±‚ï¼Œå®ƒå°±æ˜¯å¯¹è±¡å®‰å…¨çš„ã€‚\n trait ä¸éœ€è¦ Self: Sizedã€‚ æ‰€æœ‰ trait çš„æ–¹æ³•éƒ½æ˜¯å¯¹è±¡å®‰å…¨çš„ã€‚  å¦‚æœ trait æ–¹æ³•æ»¡è¶³è¿™äº›è¦æ±‚ï¼Œå®ƒå°±æ˜¯å¯¹è±¡å®‰å…¨çš„ã€‚\n æ–¹æ³•éœ€è¦ Self: Sized æˆ– è¯¥æ–¹æ³•åªåœ¨æ¥æ”¶å™¨ä½ç½®ä½¿ç”¨ Self ç±»å‹ã€‚  ç†è§£ä¸ºä»€ä¹ˆè¦æ±‚æ˜¯è¿™æ ·çš„ï¼Œä¸æœ¬æ–‡å…¶ä»–éƒ¨åˆ†æ— å…³ï¼Œä½†å¦‚æœä½ ä»ç„¶å¥½å¥‡ï¼Œåœ¨ Sizedness in Rust ä¸­ä¼šæœ‰ä»‹ç»ã€‚\nMarker Traits æ ‡è®° trait æ˜¯æ²¡æœ‰ trait é¡¹çš„ traitã€‚å®ƒä»¬çš„å·¥ä½œæ˜¯å°†å®ç°ç±»å‹ â€œæ ‡è®°â€ ä¸ºå…·æœ‰æŸäº›å±æ€§ï¼Œå¦åˆ™ä¸å¯èƒ½ç”¨ç±»å‹ç³»ç»Ÿæ¥è¡¨ç¤ºã€‚\n// Impling PartialEq for a type promises // that equality for the type has these properties: // - symmetry: a == b implies b == a, and // - transitivity: a == b \u0026amp;\u0026amp; b == c implies a == c // But DOES NOT promise this property: // - reflexivity: a == a traitPartialEq{fn eq(\u0026amp;self,other: \u0026amp;Self)-\u0026gt; bool;}// Eq has no trait items! The eq method is already // declared by PartialEq, but \u0026#34;impling\u0026#34; Eq // for a type promises this additional equality property: // - reflexivity: a == a traitEq: PartialEq {}// f64 impls PartialEq but not Eq because NaN != NaN // i32 impls PartialEq \u0026amp; Eq because there\u0026#39;s no NaNs :) Auto Traits è‡ªåŠ¨ trait æ˜¯æŒ‡å¦‚æœä¸€ä¸ªç±»å‹çš„æ‰€æœ‰æˆå‘˜éƒ½å®ç°äº†è¿™ä¸ª traitï¼Œé‚£ä¹ˆè¿™ä¸ª trait å°±ä¼šè¢«è‡ªåŠ¨å®ç°ã€‚â€œæˆå‘˜â€ çš„å«ä¹‰å–å†³äºç±»å‹ï¼Œä¾‹å¦‚ï¼šç»“æ„ä½“çš„å­—æ®µã€æšä¸¾çš„å˜ä½“ã€æ•°ç»„çš„å…ƒç´ ã€å…ƒç»„çš„é¡¹ç­‰ç­‰ã€‚\næ‰€æœ‰çš„è‡ªåŠ¨ trait éƒ½æ˜¯æ ‡è®° traitï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„æ ‡è®° trait éƒ½æ˜¯è‡ªåŠ¨ traitã€‚è‡ªåŠ¨ trait å¿…é¡»æ˜¯æ ‡è®° traitï¼Œè¿™æ ·ç¼–è¯‘å™¨å°±å¯ä»¥ä¸ºå®ƒä»¬æä¾›ä¸€ä¸ªè‡ªåŠ¨çš„ç¼ºçœå®ç°ï¼Œå¦‚æœå®ƒä»¬æœ‰ä»»ä½• trait é¡¹ï¼Œé‚£å°±ä¸å¯èƒ½äº†ã€‚\nè‡ªåŠ¨ trait çš„ä¾‹å­ã€‚\n// implemented for types which are safe to send between threads unsafeautotraitSend{}// implemented for types whose references are safe to send between threads unsafeautotraitSync{}Unsafe Traits Trait å¯ä»¥è¢«æ ‡è®°ä¸ºä¸å®‰å…¨ï¼Œä»¥è¡¨æ˜å®ç°è¯¥ trait å¯èƒ½éœ€è¦ä¸å®‰å…¨çš„ä»£ç ã€‚Send å’Œ Sync éƒ½è¢«æ ‡è®°ä¸º unsafeï¼Œå› ä¸ºå¦‚æœå®ƒä»¬æ²¡æœ‰è¢«è‡ªåŠ¨å®ç°ï¼Œå°±æ„å‘³ç€å®ƒä¸€å®šåŒ…å«ä¸€äº›é Send æˆ–é Sync æˆå‘˜ï¼Œå¦‚æœæˆ‘ä»¬æƒ³æ‰‹åŠ¨æ ‡è®°ç±»å‹ä¸º Send å’Œ Syncï¼Œæˆ‘ä»¬ä½œä¸ºå®ç°è€…å¿…é¡»æ ¼å¤–å°å¿ƒï¼Œä»¥ç¡®ä¿æ²¡æœ‰æ•°æ®ç«äº‰ã€‚\n// SomeType is not Send or Sync struct SomeType{not_send_or_sync: *const(),}// but if we\u0026#39;re confident that our impl doesn\u0026#39;t have any data // races we can explicitly mark it as Send and Sync using unsafe unsafeimplSendforSomeType{}unsafeimplSyncforSomeType{}Auto Traits Send \u0026amp; Sync é¢„å¤‡çŸ¥è¯†\n Marker Traits Auto Traits Unsafe Traits  unsafeautotraitSend{}unsafeautotraitSync{}å¦‚æœä¸€ä¸ªç±»å‹æ˜¯ Sendï¼Œæ„å‘³ç€åœ¨çº¿ç¨‹ä¹‹é—´å‘é€æ˜¯å®‰å…¨çš„ã€‚å¦‚æœä¸€ä¸ªç±»å‹æ˜¯ Syncï¼Œè¿™æ„å‘³ç€åœ¨çº¿ç¨‹ä¹‹é—´å…±äº«å®ƒçš„å¼•ç”¨æ˜¯å®‰å…¨çš„ã€‚æ›´å‡†ç¡®åœ°è¯´ï¼Œå¦‚æœä¸”ä»…å½“ \u0026amp;T æ˜¯ Send æ—¶ï¼Œä¸€äº›ç±»å‹ T æ˜¯ Syncã€‚\nå‡ ä¹æ‰€æœ‰ç±»å‹éƒ½æ˜¯ Send å’Œ Sync çš„ã€‚å”¯ä¸€å€¼å¾—æ³¨æ„çš„ Send å¼‚å¸¸æ˜¯ Rcï¼Œå”¯ä¸€å€¼å¾—æ³¨æ„çš„ Sync å¼‚å¸¸æ˜¯ Rcã€Cell å’Œ RefCellã€‚å¦‚æœæˆ‘ä»¬éœ€è¦ä¸€ä¸ª Rc çš„ Send ç‰ˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Arcã€‚å¦‚æœæˆ‘ä»¬éœ€è¦ Cell æˆ– RefCell çš„ Sync ç‰ˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥ Mutex æˆ– RwLockã€‚è™½ç„¶å¦‚æœæˆ‘ä»¬ä½¿ç”¨ Mutex æˆ– RwLock åªæ˜¯åŒ…è£¹ä¸€ä¸ªåŸè¯­ç±»å‹ï¼Œé€šå¸¸æœ€å¥½ä½¿ç”¨æ ‡å‡†åº“æä¾›çš„åŸå­åŸè¯­ç±»å‹ï¼Œå¦‚ AtomicBoolã€AtomicI32ã€AtomicUsize ç­‰ã€‚\nå‡ ä¹æ‰€æœ‰çš„ç±»å‹éƒ½æ˜¯ Syncï¼Œè¿™å¯èƒ½ä¼šè®©ä¸€äº›äººæ„Ÿåˆ°æƒŠè®¶ï¼Œä½†æ˜¯æ˜¯çš„ï¼Œå³ä½¿å¯¹äºæ²¡æœ‰ä»»ä½•å†…éƒ¨åŒæ­¥çš„ç±»å‹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚è¿™è¦å½’åŠŸäº Rust ä¸¥æ ¼çš„å€Ÿç”¨è§„åˆ™ã€‚\næˆ‘ä»¬å¯ä»¥å°†åŒä¸€æ•°æ®çš„è®¸å¤šä¸å¯å˜çš„å¼•ç”¨ä¼ é€’ç»™è®¸å¤šçº¿ç¨‹ï¼Œè€Œä¸”æˆ‘ä»¬ä¿è¯ä¸ä¼šå‡ºç°æ•°æ®ç«äº‰ï¼Œå› ä¸ºåªè¦æœ‰ä»»ä½•ä¸å¯å˜çš„å¼•ç”¨å­˜åœ¨ï¼Œ Rust å°±ä¼šé™æ€åœ°ä¿è¯åº•å±‚æ•°æ®ä¸èƒ½è¢«ä¿®æ”¹ã€‚\nusecrossbeam::thread;fn main(){letmutgreeting=String::from(\u0026#34;Hello\u0026#34;);letgreeting_ref=\u0026amp;greeting;thread::scope(|scoped_thread|{// spawn 3 threads fornin1..=3{// greeting_ref copied into every thread scoped_thread.spawn(move|_|{println!(\u0026#34;{} {}\u0026#34;,greeting_ref,n);// prints \u0026#34;Hello {n}\u0026#34; });}// line below could cause UB or data races but compiler rejects it greeting+=\u0026#34; world\u0026#34;;// âŒ cannot mutate greeting while immutable refs exist });// can mutate greeting after every thread has joined greeting+=\u0026#34; world\u0026#34;;// âœ… println!(\u0026#34;{}\u0026#34;,greeting);// prints \u0026#34;Hello world\u0026#34; }åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥å°†å•ä¸ªå¯å˜å¼•ç”¨ä¼ é€’ç»™ä¸€äº›æ•°æ®åˆ°ä¸€ä¸ªçº¿ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥ä¿è¯ä¸ä¼šå‡ºç°æ•°æ®ç«äº‰ï¼Œå› ä¸º Rust é™æ€åœ°ä¿è¯äº†åˆ«åçš„å¯å˜å¼•ç”¨ä¸èƒ½å­˜åœ¨ï¼Œåº•å±‚æ•°æ®ä¸èƒ½é€šè¿‡ç°æœ‰çš„å•ä¸ªå¯å˜å¼•ç”¨ä»¥å¤–çš„ä»»ä½•ä¸œè¥¿è¿›è¡Œä¿®æ”¹ã€‚\nusecrossbeam::thread;fn main(){letmutgreeting=String::from(\u0026#34;Hello\u0026#34;);letgreeting_ref=\u0026amp;mutgreeting;thread::scope(|scoped_thread|{// greeting_ref moved into thread scoped_thread.spawn(move|_|{*greeting_ref+=\u0026#34; world\u0026#34;;println!(\u0026#34;{}\u0026#34;,greeting_ref);// prints \u0026#34;Hello world\u0026#34; });// line below could cause UB or data races but compiler rejects it greeting+=\u0026#34;!!!\u0026#34;;// âŒ cannot mutate greeting while mutable refs exist });// can mutate greeting after the thread has joined greeting+=\u0026#34;!!!\u0026#34;;// âœ… println!(\u0026#34;{}\u0026#34;,greeting);// prints \u0026#34;Hello world!!!\u0026#34; }è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¤§å¤šæ•°ç±»å‹éƒ½æ˜¯ Sync è€Œä¸éœ€è¦ä»»ä½•æ˜¾å¼åŒæ­¥ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨å¤šä¸ªçº¿ç¨‹ä¸­åŒæ—¶ä¿®æ”¹ä¸€äº›æ•°æ® Tï¼Œç¼–è¯‘å™¨ä¸ä¼šè®©æˆ‘ä»¬è¿™æ ·åšï¼Œç›´åˆ°æˆ‘ä»¬å°†æ•°æ®åŒ…è£¹åœ¨ Arc\u0026lt;Mutex\u0026lt;T\u0026gt;\u0026gt; æˆ– Arc\u0026lt;RwLock\u0026lt;T\u0026gt;\u0026gt; ä¸­ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨å¼ºåˆ¶è¦æ±‚åœ¨éœ€è¦æ—¶ä½¿ç”¨æ˜¾å¼åŒæ­¥ã€‚\nSized é¢„å¤‡çŸ¥è¯†\n Marker Traits Auto Traits  å¦‚æœä¸€ä¸ªç±»å‹æ˜¯ Sized çš„ï¼Œè¿™æ„å‘³ç€å®ƒçš„å­—èŠ‚å¤§å°åœ¨ç¼–è¯‘æ—¶æ˜¯å·²çŸ¥çš„ï¼Œå¹¶ä¸”å¯ä»¥å°†è¯¥ç±»å‹çš„å®ä¾‹æ”¾åœ¨æ ˆä¸Šã€‚\nç±»å‹çš„å¤§å°å’Œå®ƒçš„å«ä¹‰æ˜¯ä¸€ä¸ªå¾®å¦™è€Œåˆå·¨å¤§çš„è¯é¢˜ï¼Œå®ƒå½±å“åˆ°è¯­è¨€çš„å¾ˆå¤šä¸åŒæ–¹é¢ã€‚å®ƒæ˜¯å¦‚æ­¤é‡è¦ï¼Œä»¥è‡³äºæˆ‘å†™äº†æ•´æ•´ä¸€ç¯‡æ–‡ç« ï¼Œå«åš Sizedness in Rustï¼Œæˆ‘å¼ºçƒˆæ¨èä»»ä½•æƒ³æ·±å…¥äº†è§£ç±»å‹å¤§å°çš„äººé˜…è¯»ã€‚æˆ‘æ€»ç»“ä¸€ä¸‹ä¸æœ¬æ–‡ç›¸å…³çš„å‡ ä¸ªå…³é”®å†…å®¹ã€‚\n æ‰€æœ‰çš„æ³›å‹ç±»å‹éƒ½ä¼šå¾—åˆ°ä¸€ä¸ªéšå¼çš„ Sized çº¦æŸã€‚  fn func\u0026lt;T\u0026gt;(t: \u0026amp;T){}// example above desugared fn func\u0026lt;T: Sized\u0026gt;(t: \u0026amp;T){}ç”±äºæ‰€æœ‰æ³›å‹ç±»å‹éƒ½æœ‰ä¸€ä¸ªéšå¼çš„ Sized çº¦æŸï¼Œå¦‚æœæˆ‘ä»¬æƒ³é€€å‡ºè¿™ä¸ªéšå¼çº¦æŸï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ç‰¹æ®Šçš„ \u0026ldquo;æ”¾å®½çº¦æŸ\u0026rdquo; è¯­æ³• ?Sizedï¼Œå®ƒç›®å‰åªå­˜åœ¨äº Sized traitã€‚  // now T can be unsized fn func\u0026lt;T: ?Sized\u0026gt;(t: \u0026amp;T){}æ‰€æœ‰çš„ trait éƒ½æœ‰ä¸€ä¸ªéšå¼çš„ ?Sized çº¦æŸã€‚  traitTrait{}// example above desugared traitTrait: ?Sized{}è¿™æ˜¯ä¸ºäº†è®© trait å¯¹è±¡å¯ä»¥å®ç° traitã€‚åŒæ ·ï¼Œæ‰€æœ‰çš„çç¢ç»†èŠ‚éƒ½åœ¨ Sizedness in Rust ä¸­ã€‚\nGeneral traits Default é¢„å¤‡çŸ¥è¯†\n Self Functions Derive Macros  traitDefault{fn default()-\u0026gt; Self;}å¯ä»¥æ„å»º Default ç±»å‹çš„é»˜è®¤å€¼ã€‚\nstruct Color{r: u8,g: u8,b: u8,}implDefaultforColor{// default color is black fn default()-\u0026gt; Self{Color{r: 0,g: 0,b: 0,}}}è¿™å¯¹å¿«é€Ÿå»ºç«‹åŸå‹å¾ˆæœ‰ç”¨ï¼Œä½†åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªç±»å‹çš„å®ä¾‹ï¼Œè€Œä¸”å¯¹å®ƒæ˜¯ä»€ä¹ˆå¹¶ä¸æŒ‘å‰”ã€‚\nfn main(){// just give me some color! letcolor=Color::default();}è¿™ä¹Ÿæ˜¯ä¸€ä¸ªæˆ‘ä»¬å¯èƒ½æƒ³æ˜ç¡®åœ°æš´éœ²ç»™æˆ‘ä»¬çš„å‡½æ•°ç”¨æˆ·çš„é€‰é¡¹ã€‚\nstruct Canvas;enum Shape{Circle,Rectangle,}implCanvas{// let user optionally pass a color fn paint(\u0026amp;mutself,shape: Shape,color: Option\u0026lt;Color\u0026gt;){// if no color is passed use the default color letcolor=color.unwrap_or_default();// etc }}Default åœ¨æˆ‘ä»¬éœ€è¦æ„é€ æ³›å‹ç±»å‹çš„æ³›å‹è¯­å¢ƒä¸­ä¹Ÿå¾ˆæœ‰ç”¨ã€‚\nfn guarantee_length\u0026lt;T: Default\u0026gt;(mutvec: Vec\u0026lt;T\u0026gt;,min_len: usize)-\u0026gt; Vec\u0026lt;T\u0026gt;{for_in0..min_len.saturating_sub(vec.len()){vec.push(T::default());}vec}æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Default ç±»å‹çš„å¦ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨ Rust çš„ç»“æ„ä½“æ›´æ–°è¯­æ³•å¯¹ç»“æ„ä½“è¿›è¡Œéƒ¨åˆ†åˆå§‹åŒ–ã€‚æˆ‘ä»¬å¯ä»¥ä¸º Color è®¾ç½®ä¸€ä¸ª new æ„é€ å‡½æ•°ï¼Œå°†æ¯ä¸ªæˆå‘˜ä½œä¸ºä¸€ä¸ªå‚æ•°ã€‚\nimplColor{fn new(r: u8,g: u8,b: u8)-\u0026gt; Self{Color{r,g,b,}}}ç„¶è€Œï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨æ–¹ä¾¿çš„æ„é€ å‡½æ•°ï¼Œæ¯ä¸ªæ„é€ å‡½æ•°åªæ¥å—ä¸€ä¸ªç‰¹å®šçš„ç»“æ„ä½“æˆå‘˜ï¼Œå…¶ä»–ç»“æ„ä½“æˆå‘˜åˆ™ä½¿ç”¨é»˜è®¤å€¼ã€‚\nimplColor{fn red(r: u8)-\u0026gt; Self{Color{r,..Color::default()}}fn green(g: u8)-\u0026gt; Self{Color{g,..Color::default()}}fn blue(b: u8)-\u0026gt; Self{Color{b,..Color::default()}}}è¿˜æœ‰ä¸€ä¸ª Default çš„æ´¾ç”Ÿå®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·ç¼–å†™ Colorã€‚\n// default color is still black // because u8::default() == 0 #[derive(Default)]struct Color{r: u8,g: u8,b: u8 }Clone é¢„å¤‡çŸ¥è¯†\n Self Methods Default Impls Derive Macros  traitClone{fn clone(\u0026amp;self)-\u0026gt; Self;// provided default impls fn clone_from(\u0026amp;mutself,source: \u0026amp;Self);}æˆ‘ä»¬å¯ä»¥å°† Clone ç±»å‹çš„ä¸å¯å˜å¼•ç”¨è½¬æ¢ä¸ºè‡ªæœ‰å€¼(owned values)ï¼Œå³ \u0026amp;T -\u0026gt; Tã€‚Clone æ²¡æœ‰å¯¹è¿™ç§è½¬æ¢çš„æ•ˆç‡åšå‡ºæ‰¿è¯ºï¼Œæ‰€ä»¥å®ƒå¯èƒ½æ˜¯ç¼“æ…¢å’Œæ˜‚è´µçš„ã€‚ä¸ºäº†å¿«é€Ÿåœ°åœ¨ä¸€ä¸ªç±»å‹ä¸Šå®ç° Cloneï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ´¾ç”Ÿå®ã€‚\n#[derive(Clone)]struct SomeType{cloneable_member1: CloneableType1,cloneable_member2: CloneableType2,// etc }// macro generates impl below implCloneforSomeType{fn clone(\u0026amp;self)-\u0026gt; Self{SomeType{cloneable_member1: self.cloneable_member1.clone(),cloneable_member2: self.cloneable_member2.clone(),// etc }}}Clone ä¹Ÿå¯ä»¥åœ¨æ³›å‹ä¸Šä¸‹æ–‡ä¸­æ„å»ºä¸€ä¸ªç±»å‹çš„å®ä¾‹ã€‚ä¸‹é¢æ˜¯ä¸Šä¸€èŠ‚ä¸­çš„ä¸€ä¸ªä¾‹å­ï¼Œé™¤äº†ä½¿ç”¨ Clone è€Œä¸æ˜¯ Defaultã€‚\nfn guarantee_length\u0026lt;T: Clone\u0026gt;(mutvec: Vec\u0026lt;T\u0026gt;,min_len: usize,fill_with: \u0026amp;T)-\u0026gt; Vec\u0026lt;T\u0026gt;{for_in0..min_len.saturating_sub(vec.len()){vec.push(fill_with.clone());}vec}äººä»¬ä¹Ÿç»å¸¸ä½¿ç”¨å…‹éš†ä½œä¸ºé€ƒé¿çš„æ–¹æ³•ï¼Œä»¥é¿å…ä¸å€Ÿç”¨æ£€æŸ¥å™¨æ‰“äº¤é“ã€‚ç®¡ç†å¸¦æœ‰å¼•ç”¨çš„ç»“æ„ä½“å¯èƒ½å¾ˆæœ‰æŒ‘æˆ˜æ€§ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡å…‹éš†å°†å¼•ç”¨å˜æˆè‡ªæœ‰å€¼(owned values)ã€‚\n// oof, we gotta worry about lifetimes ğŸ˜Ÿ struct SomeStruct\u0026lt;\u0026#39;a\u0026gt;{data: \u0026amp;\u0026#39;aVec\u0026lt;u8\u0026gt;,}// now we\u0026#39;re on easy street ğŸ˜ struct SomeStruct{data: Vec\u0026lt;u8\u0026gt;,}å¦‚æœæˆ‘ä»¬æ­£åœ¨å¼€å‘çš„ç¨‹åºçš„æ€§èƒ½ä¸æ˜¯æœ€é‡è¦çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸éœ€è¦ä¸ºå…‹éš†æ•°æ®è€Œçƒ¦æ¼ã€‚Rust æ˜¯ä¸€ç§ä½çº§åˆ«çš„è¯­è¨€ï¼Œæš´éœ²äº†å¾ˆå¤šä½çº§åˆ«çš„ç»†èŠ‚ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“è¢«è¿‡æ—©çš„ä¼˜åŒ–æ‰€å¸å¼•ï¼Œè€Œä¸æ˜¯çœŸæ­£è§£å†³æ‰‹å¤´çš„é—®é¢˜ã€‚å¯¹äºè®¸å¤šç¨‹åºæ¥è¯´ï¼Œæœ€å¥½çš„ä¼˜å…ˆé¡ºåºé€šå¸¸æ˜¯é¦–å…ˆå»ºç«‹æ­£ç¡®æ€§ï¼Œå…¶æ¬¡æ˜¯ä¼˜é›…æ€§ï¼Œç¬¬ä¸‰æ˜¯æ€§èƒ½ï¼Œåªæœ‰åœ¨å¯¹ç¨‹åºè¿›è¡Œå‰–æå¹¶ç¡®å®šäº†æ€§èƒ½ç“¶é¢ˆä¹‹åæ‰å…³æ³¨æ€§èƒ½ã€‚è¿™æ˜¯å¾ˆå¥½çš„ä¸€èˆ¬æ€§å»ºè®®ï¼Œå¦‚æœå®ƒä¸é€‚ç”¨äºä½ çš„ç‰¹å®šç¨‹åºï¼Œä½ å°±ä¼šçŸ¥é“ã€‚\nCopy é¢„å¤‡çŸ¥è¯†\n Marker Traits Subtraits \u0026amp; Supertraits Derive Macros  traitCopy: Clone {}æˆ‘ä»¬å¤åˆ¶ Copy ç±»å‹ï¼Œä¾‹å¦‚ï¼šT -\u0026gt; Tã€‚Copy æ‰¿è¯ºå¤åˆ¶æ“ä½œå°†æ˜¯ä¸€ä¸ªç®€å•çš„æŒ‰ä½(bitwise)æ‹·è´ï¼Œæ‰€ä»¥å®ƒå°†æ˜¯éå¸¸å¿«é€Ÿå’Œé«˜æ•ˆçš„ã€‚æˆ‘ä»¬ä¸èƒ½è‡ªå·±å®ç° Copyï¼Œåªæœ‰ç¼–è¯‘å™¨å¯ä»¥æä¾›ä¸€ä¸ªå®ç°ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ Copy æ´¾ç”Ÿå®ï¼Œä»¥åŠ Clone æ´¾ç”Ÿå®æ¥å‘Šè¯‰ç¼–è¯‘å™¨è¿™æ ·åšï¼Œå› ä¸º Copy æ˜¯ Clone çš„ä¸€ä¸ªå­ traitã€‚\n#[derive(Copy, Clone)]struct SomeType;Copy å®Œå–„äº†(refine) Cloneã€‚Clone å¯èƒ½æ˜¯ç¼“æ…¢å’Œæ˜‚è´µçš„ï¼Œä½† Copy ä¿è¯æ˜¯å¿«é€Ÿå’Œä¾¿å®œçš„ï¼Œæ‰€ä»¥ Copy åªæ˜¯ä¸€ä¸ªå¿«é€Ÿ Cloneã€‚å¦‚æœä¸€ä¸ªç±»å‹å®ç°äº† Copyï¼Œè¿™å°±ä½¿å¾— Clone çš„å®ç°å˜å¾—å¾®ä¸è¶³é“äº†ã€‚\n// this is what the derive macro generates impl\u0026lt;T: Copy\u0026gt;CloneforT{// the clone method becomes just a copy fn clone(\u0026amp;self)-\u0026gt; Self{*self}}å½“ä¸€ä¸ªç±»å‹è¢«ç§»åŠ¨æ—¶ï¼Œå®ç°è¯¥ç±»å‹çš„ Copy ä¼šæ”¹å˜å…¶è¡Œä¸ºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç±»å‹éƒ½æœ‰â€œç§»åŠ¨è¯­ä¹‰â€ï¼Œä½†æ˜¯ä¸€æ—¦ä¸€ä¸ªç±»å‹å®ç°äº† `Copy'ï¼Œå®ƒå°±ä¼šå¾—åˆ°â€œå¤åˆ¶è¯­ä¹‰â€ã€‚ä¸ºäº†è§£é‡Šè¿™ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™äº›ç®€å•çš„åœºæ™¯ã€‚\n// a \u0026#34;move\u0026#34;, src: !Copy letdest=src;// a \u0026#34;copy\u0026#34;, src: Copy letdest=src;åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œdest = src å¯¹ src çš„å†…å®¹è¿›è¡Œç®€å•çš„æŒ‰ä½å¤åˆ¶ï¼Œå¹¶å°†ç»“æœç§»åŠ¨åˆ° dest ä¸­ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œåœ¨â€œç§»åŠ¨â€çš„æƒ…å†µä¸‹ï¼Œå€Ÿç”¨æ£€æŸ¥å™¨ä½¿ src å˜é‡æ— æ•ˆï¼Œå¹¶ç¡®ä¿å®ƒä»¥åä¸ä¼šè¢«ç”¨äºå…¶ä»–åœ°æ–¹ï¼Œè€Œåœ¨â€œå¤åˆ¶â€çš„æƒ…å†µä¸‹ï¼Œsrc ä»ç„¶æœ‰æ•ˆå¹¶å¯ä½¿ç”¨ã€‚\nä¸€è¨€ä»¥è”½ä¹‹ã€‚æ‹·è´å°±â€œæ˜¯â€ç§»åŠ¨ã€‚ç§»åŠ¨å°±â€œæ˜¯â€æ‹·è´ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯å€Ÿç”¨æ£€æŸ¥å™¨å¯¹å®ƒä»¬çš„å¤„ç†æ–¹å¼ã€‚\nå…³äºç§»åŠ¨çš„ä¸€ä¸ªæ›´å…·ä½“çš„ä¾‹å­ï¼Œå‡è®¾ src æ˜¯ä¸€ä¸ª Vec\u0026lt;i32\u0026gt;ï¼Œå…¶å†…å®¹æ˜¯è¿™æ ·çš„ã€‚\n{data: *mut[i32],length: usize,capacity: usize }å½“æˆ‘ä»¬å†™ä¸‹ dest = src æ—¶ï¼Œæˆ‘ä»¬çš„ç»“æœæ˜¯ï¼š\nsrc={data: *mut[i32],length: usize,capacity: usize }dest={data: *mut[i32],length: usize,capacity: usize }è¿™ä¸ªæ—¶å€™ï¼Œsrc å’Œ dest éƒ½æœ‰å¯¹ç›¸åŒæ•°æ®çš„åˆ«åå¯å˜å¼•ç”¨ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤§å¿Œï¼Œæ‰€ä»¥å€Ÿç”¨æ£€æŸ¥å™¨ä½¿ src å˜é‡æ— æ•ˆï¼Œè¿™æ ·å®ƒå°±ä¸èƒ½å†è¢«ä½¿ç”¨è€Œä¸ä¼šäº§ç”Ÿç¼–è¯‘é”™è¯¯ã€‚\nå¯¹äºä¸€ä¸ªæ›´å…·ä½“çš„æ‹·è´ä¾‹å­ï¼Œå‡è®¾ src æ˜¯ä¸€ä¸ª Option\u0026lt;i32\u0026gt;ï¼Œå®ƒçš„å†…å®¹æ˜¯è¿™æ ·çš„ï¼š\n{is_valid: bool,data: i32 }ç°åœ¨ï¼Œå½“æˆ‘ä»¬å†™ä¸‹ dest = src æ—¶ï¼Œæˆ‘ä»¬çš„ç»“æœæ˜¯ï¼š\nsrc={is_valid: bool,data: i32 }dest={is_valid: bool,data: i32 }è¿™äº›éƒ½æ˜¯å¯ä»¥åŒæ—¶ä½¿ç”¨çš„! å› æ­¤ Option\u0026lt;i32\u0026gt; æ˜¯å¯ä»¥ Copy çš„ã€‚\nè™½ç„¶ Copy å¯ä»¥æ˜¯ä¸€ä¸ªè‡ªåŠ¨ traitï¼Œä½† Rust è¯­è¨€çš„è®¾è®¡è€…å†³å®šè®©ç±»å‹æ˜¾å¼åœ°é€‰æ‹©å¤åˆ¶è¯­ä¹‰ï¼Œè€Œä¸æ˜¯åœ¨ç±»å‹ç¬¦åˆæ¡ä»¶æ—¶é»˜é»˜åœ°ç»§æ‰¿å¤åˆ¶è¯­ä¹‰ï¼Œå› ä¸ºåè€…ä¼šå¯¼è‡´ä»¤äººæƒŠè®¶çš„æ··ä¹±è¡Œä¸ºï¼Œç»å¸¸å¯¼è‡´é”™è¯¯ã€‚\nAny é¢„å¤‡çŸ¥è¯†\n Self Generic Blanket Impls Subtraits \u0026amp; Supertraits Trait Objects  traitAny: \u0026#39;static{fn type_id(\u0026amp;self)-\u0026gt; TypeId;}Rust çš„å¤šæ€æ€§é£æ ¼æ˜¯å‚æ•°åŒ–çš„ï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨ç±»ä¼¼äºåŠ¨æ€ç±»å‹è¯­è¨€çš„å¤šæ€æ€§é£æ ¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Any trait æ¥æ¨¡ä»¿ã€‚æˆ‘ä»¬ä¸éœ€è¦ä¸ºæˆ‘ä»¬çš„ç±»å‹æ‰‹åŠ¨å®ç°è¿™ä¸ª traitï¼Œå› ä¸ºä¸‹é¢è¿™ä¸ªæ³›å‹å…¨é¢å®ç°å·²ç»è¦†ç›–äº†ã€‚\nimpl\u0026lt;T: \u0026#39;static+?Sized\u0026gt;AnyforT{fn type_id(\u0026amp;self)-\u0026gt; TypeId{TypeId::of::\u0026lt;T\u0026gt;()}}æˆ‘ä»¬ä» dyn Any ä¸­å¾—åˆ° T çš„æ–¹æ³•æ˜¯é€šè¿‡ä½¿ç”¨ downcast_ref::\u0026lt;T\u0026gt;() å’Œ downcast_mut::\u0026lt;T\u0026gt;() æ–¹æ³•ã€‚\nusestd::any::Any;#[derive(Default)]struct Point{x: i32,y: i32,}implPoint{fn inc(\u0026amp;mutself){self.x+=1;self.y+=1;}}fn map_any(mutany: Box\u0026lt;dynAny\u0026gt;)-\u0026gt; Box\u0026lt;dynAny\u0026gt;{ifletSome(num)=any.downcast_mut::\u0026lt;i32\u0026gt;(){*num+=1;}elseifletSome(string)=any.downcast_mut::\u0026lt;String\u0026gt;(){*string+=\u0026#34;!\u0026#34;;}elseifletSome(point)=any.downcast_mut::\u0026lt;Point\u0026gt;(){point.inc();}any}fn main(){letmutvec: Vec\u0026lt;Box\u0026lt;dynAny\u0026gt;\u0026gt;=vec![Box::new(0),Box::new(String::from(\u0026#34;a\u0026#34;)),Box::new(Point::default()),];// vec = [0, \u0026#34;a\u0026#34;, Point { x: 0, y: 0 }] vec=vec.into_iter().map(map_any).collect();// vec = [1, \u0026#34;a!\u0026#34;, Point { x: 1, y: 1 }] }è¿™ä¸ª trait å¾ˆå°‘éœ€è¦ä½¿ç”¨ï¼Œå› ä¸ºåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå‚æ•°åŒ–å¤šæ€æ€§è¦ä¼˜äºä¸´æ—¶å¤šæ€æ€§ï¼Œåè€…ä¹Ÿå¯ä»¥ç”¨æšä¸¾æ¥æ¨¡æ‹Ÿï¼Œå› ä¸ºæšä¸¾çš„ç±»å‹æ›´å®‰å…¨ï¼Œéœ€è¦çš„è¿‚å›æ›´å°‘ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸Šé¢çš„ä¾‹å­å†™æˆè¿™æ ·ã€‚\n#[derive(Default)]struct Point{x: i32,y: i32,}implPoint{fn inc(\u0026amp;mutself){self.x+=1;self.y+=1;}}enum Stuff{Integer(i32),String(String),Point(Point),}fn map_stuff(mutstuff: Stuff)-\u0026gt; Stuff{match\u0026amp;mutstuff{Stuff::Integer(num)=\u0026gt;*num+=1,Stuff::String(string)=\u0026gt;*string+=\u0026#34;!\u0026#34;,Stuff::Point(point)=\u0026gt;point.inc(),}stuff}fn main(){letmutvec=vec![Stuff::Integer(0),Stuff::String(String::from(\u0026#34;a\u0026#34;)),Stuff::Point(Point::default()),];// vec = [0, \u0026#34;a\u0026#34;, Point { x: 0, y: 0 }] vec=vec.into_iter().map(map_stuff).collect();// vec = [1, \u0026#34;a!\u0026#34;, Point { x: 1, y: 1 }] }å°½ç®¡ Any å¾ˆå°‘è¢«éœ€è¦ï¼Œä½†æœ‰æ—¶ä½¿ç”¨èµ·æ¥è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œæˆ‘ä»¬å°†åœ¨åé¢çš„â€œé”™è¯¯å¤„ç†â€éƒ¨åˆ†çœ‹åˆ°ã€‚\nFormatting Traits æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ std::fmt ä¸­çš„æ ¼å¼åŒ–å®å°†ç±»å‹åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œå…¶ä¸­æœ€è‘—åçš„æ˜¯ println!ã€‚æˆ‘ä»¬å¯ä»¥å°†æ ¼å¼åŒ–å‚æ•°ä¼ é€’ç»™æ ¼å¼ str ä¸­ä½¿ç”¨çš„ {} å ä½ç¬¦ï¼Œç„¶åç”¨æ¥é€‰æ‹©ä½¿ç”¨å“ªä¸ª trait å®ç°æ¥åºåˆ—åŒ–å ä½ç¬¦çš„å‚æ•°ã€‚\n   Trait Placeholder Description     Display {} display representation   Debug {:?} debug representation   Octal {:o} octal representation   LowerHex {:x} lowercase hex representation   UpperHex {:X} uppercase hex representation   Pointer {:p} memory address   Binary {:b} binary representation   LowerExp {:e} lowercase exponential representation   UpperExp {:E} uppercase exponential representation    Display \u0026amp; ToString é¢„å¤‡çŸ¥è¯†\n Self Methods Generic Blanket Impls  traitDisplay{fn fmt(\u0026amp;self,f: \u0026amp;mutFormatter\u0026lt;\u0026#39;_\u0026gt;)-\u0026gt; Result;}Display ç±»å‹å¯ä»¥è¢«åºåˆ—åŒ–ä¸º Stringï¼Œè¿™å¯¹ç¨‹åºçš„ç»ˆç«¯ç”¨æˆ·å¾ˆå‹å¥½ã€‚ä¾‹å¦‚ï¼Œç»™ Point å®ç° Display:\nusestd::fmt;#[derive(Default)]struct Point{x: i32,y: i32,}implfmt::DisplayforPoint{fn fmt(\u0026amp;self,f: \u0026amp;mutfmt::Formatter\u0026lt;\u0026#39;_\u0026gt;)-\u0026gt; fmt::Result{write!(f,\u0026#34;({}, {})\u0026#34;,self.x,self.y)}}fn main(){println!(\u0026#34;origin: {}\u0026#34;,Point::default());// prints \u0026#34;origin: (0, 0)\u0026#34; // get Point\u0026#39;s Display representation as a String letstringified_point=format!(\u0026#34;{}\u0026#34;,Point::default());assert_eq!(\u0026#34;(0, 0)\u0026#34;,stringified_point);// âœ… }é™¤äº†ä½¿ç”¨ format! å®æ¥è·å¾—ä¸€ä¸ªç±»å‹çš„æ˜¾ç¤ºè¡¨ç¤ºä¸º String ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ ToString traitã€‚\ntraitToString{fn to_string(\u0026amp;self)-\u0026gt; String;}æˆ‘ä»¬æ²¡æœ‰å¿…è¦è‡ªå·±å»å®ç°è¿™ä¸ª traitã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬ä¸èƒ½è¿™æ ·åšï¼Œå› ä¸ºä¸‹é¢è¿™ä¸ªæ³›å‹å…¨é¢å®ç°ï¼Œå¯¹äºä»»ä½•å®ç° Display çš„ç±»å‹ï¼Œéƒ½è‡ªåŠ¨å®ç° ToStringã€‚\nimpl\u0026lt;T: Display+?Sized\u0026gt;ToStringforT;å°† ToString ä¸ Point ä¸€èµ·ä½¿ç”¨ã€‚\n#[test]// âœ… fn display_point(){letorigin=Point::default();assert_eq!(format!(\u0026#34;{}\u0026#34;,origin),\u0026#34;(0, 0)\u0026#34;);}#[test]// âœ… fn point_to_string(){letorigin=Point::default();assert_eq!(origin.to_string(),\u0026#34;(0, 0)\u0026#34;);}#[test]// âœ… fn display_equals_to_string(){letorigin=Point::default();assert_eq!(format!(\u0026#34;{}\u0026#34;,origin),origin.to_string());}Debug é¢„å¤‡çŸ¥è¯†\n Self Methods Derive Macros Display \u0026amp; ToString  traitDebug{fn fmt(\u0026amp;self,f: \u0026amp;mutFormatter\u0026lt;\u0026#39;_\u0026gt;)-\u0026gt; Result;}Debug ä¸ Display æœ‰ç›¸åŒçš„ç­¾åã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ {:?} æ ¼å¼ç¬¦æ—¶ï¼ŒDebug å®ç°è¢«è°ƒç”¨ã€‚`Debug' å¯ä»¥è¢«æ´¾ç”Ÿã€‚\nusestd::fmt;#[derive(Debug)]struct Point{x: i32,y: i32,}// derive macro generates impl below implfmt::DebugforPoint{fn fmt(\u0026amp;self,f: \u0026amp;mutfmt::Formatter\u0026lt;\u0026#39;_\u0026gt;)-\u0026gt; fmt::Result{f.debug_struct(\u0026#34;Point\u0026#34;).field(\u0026#34;x\u0026#34;,\u0026amp;self.x).field(\u0026#34;y\u0026#34;,\u0026amp;self.y).finish()}}ä¸ºä¸€ä¸ªç±»å‹å®ç° Debug ä¹Ÿå…è®¸å®ƒåœ¨ dbg! å®ä¸­ä½¿ç”¨ï¼Œè¿™æ¯” println! æ›´æœ‰åˆ©äºä¸´æ—¶åº”æ€¥çš„æ‰“å°æ—¥å¿—ã€‚å®ƒçš„ä¸€äº›ä¼˜ç‚¹å¦‚ä¸‹:\n dbg! æ‰“å°åˆ° stderr è€Œä¸æ˜¯ stdoutï¼Œæ‰€ä»¥è°ƒè¯•æ—¥å¿—å¾ˆå®¹æ˜“ä¸æˆ‘ä»¬ç¨‹åºçš„å®é™… stdout è¾“å‡ºåˆ†å¼€ã€‚ dbg! æ‰“å°ä¼ é€’ç»™å®ƒçš„è¡¨è¾¾å¼ï¼Œä»¥åŠè¡¨è¾¾å¼æ‰€è¯„ä¼°çš„å€¼ã€‚ dbg! æ‹¥æœ‰å…¶å‚æ•°çš„æ‰€æœ‰æƒï¼Œå¹¶è¿”å›è¿™äº›å‚æ•°ï¼Œæ‰€ä»¥ä½ å¯ä»¥åœ¨è¡¨è¾¾å¼ä¸­ä½¿ç”¨å®ƒã€‚  fn some_condition()-\u0026gt; bool {true}// no logging fn example(){ifsome_condition(){// some code }}// println! logging fn example_println(){// ğŸ¤¦ letresult=some_condition();println!(\u0026#34;{}\u0026#34;,result);// just prints \u0026#34;true\u0026#34; ifresult{// some code }}// dbg! logging fn example_dbg(){// ğŸ˜ ifdbg!(some_condition()){// prints \u0026#34;[src/main.rs:22] some_condition() = true\u0026#34; // some code }}å”¯ä¸€çš„ç¼ºç‚¹æ˜¯ï¼Œdbg! åœ¨å‘å¸ƒç‰ˆæœ¬ä¸­ä¸ä¼šè¢«è‡ªåŠ¨å‰¥ç¦»ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬ä¸æƒ³åœ¨æœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ä½¿ç”¨å®ƒï¼Œå°±å¿…é¡»ä»æˆ‘ä»¬çš„ä»£ç ä¸­æ‰‹åŠ¨åˆ é™¤å®ƒã€‚\nOperator Traits Rust ä¸­çš„æ‰€æœ‰è¿ç®—ç¬¦éƒ½ä¸ trait ç›¸å…³ã€‚å¦‚æœæˆ‘ä»¬æƒ³ä¸ºæˆ‘ä»¬çš„ç±»å‹å®ç°è¿ç®—ç¬¦ï¼Œå°±å¿…é¡»å®ç°ç›¸å…³çš„ traitã€‚\n   Trait(s) Category Operator(s) Description     Eq, PartialEq comparison == equality   Ord, PartialOrd comparison \u0026lt;, \u0026gt;, \u0026lt;=, \u0026gt;= comparison   Add arithmetic + addition   AddAssign arithmetic += addition assignment   BitAnd arithmetic \u0026amp; bitwise AND   BitAndAssign arithmetic \u0026amp;= bitwise assignment   BitXor arithmetic ^ bitwise XOR   BitXorAssign arithmetic ^= bitwise XOR assignment   Div arithmetic / division   DivAssign arithmetic /= division assignment   Mul arithmetic * multiplication   MulAssign arithmetic *= multiplication assignment   Neg arithmetic - unary negation   Not arithmetic ! unary logical negation   Rem arithmetic % remainder   RemAssign arithmetic %= remainder assignment   Shl arithmetic \u0026lt;\u0026lt; left shift   ShlAssign arithmetic \u0026lt;\u0026lt;= left shift assignment   Shr arithmetic \u0026gt;\u0026gt; right shift   ShrAssign arithmetic \u0026gt;\u0026gt;= right shift assignment   Sub arithmetic - subtraction   SubAssign arithmetic -= subtraction assignment   Fn closure (...args) immutable closure invocation   FnMut closure (...args) mutable closure invocation   FnOnce closure (...args) one-time closure invocation   Deref other * immutable dereference   DerefMut other * mutable derenence   Drop other - type destructor   Index other [] immutable index   IndexMut other [] mutable index   RangeBounds other .. range    Comparison Traits    Trait(s) Category Operator(s) Description     Eq, PartialEq comparison == equality   Ord, PartialOrd comparison \u0026lt;, \u0026gt;, \u0026lt;=, \u0026gt;= comparison    PartialEq \u0026amp; Eq é¢„å¤‡çŸ¥è¯†\n Self Methods Generic Parameters Default Impls Generic Blanket Impls Marker Traits Subtraits \u0026amp; Supertraits Sized  traitPartialEq\u0026lt;Rhs=Self\u0026gt;whereRhs: ?Sized,{fn eq(\u0026amp;self,other: \u0026amp;Rhs)-\u0026gt; bool;// provided default impls fn ne(\u0026amp;self,other: \u0026amp;Rhs)-\u0026gt; bool;}PartialEq\u0026lt;Rhs\u0026gt; ç±»å‹å¯ä»¥ä½¿ç”¨ == è¿ç®—ç¬¦æ£€æŸ¥æ˜¯å¦ä¸ Rhs ç±»å‹ç›¸ç­‰ã€‚\næ‰€æœ‰çš„ PartialEq\u0026lt;Rhs\u0026gt; å®ç°å¿…é¡»ç¡®ä¿ç›¸ç­‰æ˜¯å¯¹ç§°çš„å’Œä¼ é€’çš„ã€‚è¿™æ„å‘³ç€å¯¹äºæ‰€æœ‰çš„ a, b, å’Œ c:\n a == b æ„å‘³ç€ b == a (å¯¹ç§°æ€§) a == b \u0026amp;\u0026amp; b == c æ„å‘³ç€ a == c (ä¼ é€’æ€§)  é»˜è®¤æƒ…å†µä¸‹ Rhs = Selfï¼Œå› ä¸ºæˆ‘ä»¬å‡ ä¹æ€»æ˜¯æƒ³æŠŠä¸€ä¸ªç±»å‹çš„å®ä¾‹ç›¸äº’æ¯”è¾ƒï¼Œè€Œä¸æ˜¯ä¸ä¸åŒç±»å‹çš„å®ä¾‹æ¯”è¾ƒã€‚è¿™ä¹Ÿè‡ªåŠ¨ä¿è¯äº†æˆ‘ä»¬çš„å®ç°æ˜¯å¯¹ç§°çš„å’Œä¼ é€’çš„ã€‚\nstruct Point{x: i32,y: i32 }// Rhs == Self == Point implPartialEqforPoint{// impl automatically symmetric \u0026amp; transitive fn eq(\u0026amp;self,other: \u0026amp;Point)-\u0026gt; bool {self.x==other.x\u0026amp;\u0026amp;self.y==other.y}}å¦‚æœä¸€ä¸ªç±»å‹çš„æ‰€æœ‰æˆå‘˜éƒ½å®ç°äº† `PartialEq'ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥è¢«æ´¾ç”Ÿã€‚\n#[derive(PartialEq)]struct Point{x: i32,y: i32 }#[derive(PartialEq)]enum Suit{Spade,Heart,Club,Diamond,}ä¸€æ—¦ä¸ºæˆ‘ä»¬çš„ç±»å‹å®ç°äº† PartialEqï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å…è´¹å¾—åˆ°æˆ‘ä»¬ç±»å‹çš„å¼•ç”¨ä¹‹é—´çš„ç›¸ç­‰æ€§æ¯”è¾ƒï¼Œè¿™è¦æ„Ÿè°¢è¿™äº›æ³›å‹å…¨é¢å®ç°ã€‚\n// this impl only gives us: Point == Point #[derive(PartialEq)]struct Point{x: i32,y: i32 }// all of the generic blanket impls below // are provided by the standard library // this impl gives us: \u0026amp;Point == \u0026amp;Point impl\u0026lt;A,B\u0026gt;PartialEq\u0026lt;\u0026amp;\u0026#39;_B\u0026gt;for\u0026amp;\u0026#39;_AwhereA: PartialEq\u0026lt;B\u0026gt;+?Sized,B: ?Sized;// this impl gives us: \u0026amp;mut Point == \u0026amp;Point impl\u0026lt;A,B\u0026gt;PartialEq\u0026lt;\u0026amp;\u0026#39;_B\u0026gt;for\u0026amp;\u0026#39;_mutAwhereA: PartialEq\u0026lt;B\u0026gt;+?Sized,B: ?Sized;// this impl gives us: \u0026amp;Point == \u0026amp;mut Point impl\u0026lt;A,B\u0026gt;PartialEq\u0026lt;\u0026amp;\u0026#39;_mutB\u0026gt;for\u0026amp;\u0026#39;_AwhereA: PartialEq\u0026lt;B\u0026gt;+?Sized,B: ?Sized;// this impl gives us: \u0026amp;mut Point == \u0026amp;mut Point impl\u0026lt;A,B\u0026gt;PartialEq\u0026lt;\u0026amp;\u0026#39;_mutB\u0026gt;for\u0026amp;\u0026#39;_mutAwhereA: PartialEq\u0026lt;B\u0026gt;+?Sized,B: ?Sized;ç”±äºè¿™ä¸ª trait æ˜¯æ³›å‹åŒ–çš„ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸åŒç±»å‹ä¹‹é—´çš„ç›¸ç­‰æ€§ã€‚æ ‡å‡†åº“åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œå…è®¸æ£€æŸ¥è®¸å¤šç±»ä¼¼å­—ç¬¦ä¸²çš„ç±»å‹ï¼Œå¦‚Stringã€\u0026amp;strã€PathBufã€\u0026amp;Pathã€OsStringã€\u0026amp;OsStr ç­‰ä¹‹é—´çš„ç›¸ç­‰æ€§ã€‚\nä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬åªåº”è¯¥åœ¨ä¸åŒç±»å‹ä¹‹é—´å®ç°ç›¸ç­‰æ€§å…³ç³»ï¼Œå¦‚æœå®ƒä»¬å®ç°åŒä¸€ç§æ•°æ®ï¼Œå¹¶ä¸”ç±»å‹ä¹‹é—´çš„å”¯ä¸€åŒºåˆ«æ˜¯å®ƒä»¬å¦‚ä½•è¡¨ç¤ºæ•°æ®æˆ–å¦‚ä½•å…è®¸ä¸æ•°æ®è¿›è¡Œäº¤äº’ã€‚\nè¿™é‡Œæœ‰ä¸€ä¸ªå¯çˆ±ä½†ç³Ÿç³•çš„ä¾‹å­ï¼Œè¯´æ˜æœ‰äººå¯èƒ½ä¼šè¢«è¯±æƒ‘å®ç° PartialEq æ¥æ£€æŸ¥ä¸ç¬¦åˆä¸Šè¿°æ ‡å‡†çš„ä¸åŒç±»å‹ä¹‹é—´çš„ç›¸ç­‰ã€‚\n#[derive(PartialEq)]enum Suit{Spade,Club,Heart,Diamond,}#[derive(PartialEq)]enum Rank{Ace,Two,Three,Four,Five,Six,Seven,Eight,Nine,Ten,Jack,Queen,King,}#[derive(PartialEq)]struct Card{suit: Suit,rank: Rank,}// check equality of Card\u0026#39;s suit implPartialEq\u0026lt;Suit\u0026gt;forCard{fn eq(\u0026amp;self,other: \u0026amp;Suit)-\u0026gt; bool {self.suit==*other}}// check equality of Card\u0026#39;s rank implPartialEq\u0026lt;Rank\u0026gt;forCard{fn eq(\u0026amp;self,other: \u0026amp;Rank)-\u0026gt; bool {self.rank==*other}}fn main(){letAceOfSpades=Card{suit: Suit::Spade,rank: Rank::Ace,};assert!(AceOfSpades==Suit::Spade);// âœ… assert!(AceOfSpades==Rank::Ace);// âœ… }è¿™å¾ˆæœ‰æ•ˆï¼Œè€Œä¸”æœ‰ç‚¹é“ç†ã€‚ä¸€å¼ é»‘æ¡ƒAçš„ç‰Œæ—¢æ˜¯Aåˆæ˜¯é»‘æ¡ƒï¼Œå¦‚æœæˆ‘ä»¬è¦å†™ä¸€ä¸ªå¤„ç†æ‰‘å…‹ç‰Œçš„åº“ï¼Œé‚£ä¹ˆæˆ‘ä»¬æƒ³è®©å®ƒç®€å•æ–¹ä¾¿åœ°å•ç‹¬æ£€æŸ¥ä¸€å¼ ç‰Œçš„èŠ±è‰²å’Œç­‰çº§æ˜¯åˆç†çš„ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬è¿˜ç¼ºå°‘ä¸€äº›ä¸œè¥¿ï¼šå¯¹ç§°æ€§ã€‚ æˆ‘ä»¬å¯ä»¥ Card == Suit å’Œ Card == Rankï¼Œä½†æˆ‘ä»¬ä¸èƒ½ Suit == Card æˆ– Rank == Cardï¼Œæ‰€ä»¥è®©æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\n// check equality of Card\u0026#39;s suit implPartialEq\u0026lt;Suit\u0026gt;forCard{fn eq(\u0026amp;self,other: \u0026amp;Suit)-\u0026gt; bool {self.suit==*other}}// added for symmetry implPartialEq\u0026lt;Card\u0026gt;forSuit{fn eq(\u0026amp;self,other: \u0026amp;Card)-\u0026gt; bool {*self==other.suit}}// check equality of Card\u0026#39;s rank implPartialEq\u0026lt;Rank\u0026gt;forCard{fn eq(\u0026amp;self,other: \u0026amp;Rank)-\u0026gt; bool {self.rank==*other}}// added for symmetry implPartialEq\u0026lt;Card\u0026gt;forRank{fn eq(\u0026amp;self,other: \u0026amp;Card)-\u0026gt; bool {*self==other.rank}}æˆ‘ä»¬æœ‰å¯¹ç§°æ€§! å¤ªå¥½äº†ã€‚å¢åŠ å¯¹ç§°æ€§åªæ˜¯æ‰“ç ´äº†ä¼ é€’æ€§ï¼è¿™æ˜¯ä¸å¯èƒ½çš„ã€‚å“å‘€ã€‚ç°åœ¨å¯ä»¥è¿™æ ·äº†ï¼š\nfn main(){// Ace of Spades leta=Card{suit: Suit::Spade,rank: Rank::Ace,};letb=Suit::Spade;// King of Spades letc=Card{suit: Suit::Spade,rank: Rank::King,};assert!(a==b\u0026amp;\u0026amp;b==c);// âœ… assert!(a==c);// âŒ }å®ç° PartialEq ä»¥æ£€æŸ¥ä¸åŒç±»å‹ä¹‹é—´çš„ç›¸ç­‰å…³ç³»çš„ä¸€ä¸ªå¥½ä¾‹å­æ˜¯ä¸€ä¸ªå¤„ç†è·ç¦»çš„ç¨‹åºï¼Œå®ƒä½¿ç”¨ä¸åŒçš„ç±»å‹æ¥ä»£è¡¨ä¸åŒçš„æµ‹é‡å•ä½ã€‚\n#[derive(PartialEq)]struct Foot(u32);#[derive(PartialEq)]struct Yard(u32);#[derive(PartialEq)]struct Mile(u32);implPartialEq\u0026lt;Mile\u0026gt;forFoot{fn eq(\u0026amp;self,other: \u0026amp;Mile)-\u0026gt; bool {self.0==other.0*5280}}implPartialEq\u0026lt;Foot\u0026gt;forMile{fn eq(\u0026amp;self,other: \u0026amp;Foot)-\u0026gt; bool {self.0*5280==other.0}}implPartialEq\u0026lt;Mile\u0026gt;forYard{fn eq(\u0026amp;self,other: \u0026amp;Mile)-\u0026gt; bool {self.0==other.0*1760}}implPartialEq\u0026lt;Yard\u0026gt;forMile{fn eq(\u0026amp;self,other: \u0026amp;Yard)-\u0026gt; bool {self.0*1760==other.0}}implPartialEq\u0026lt;Foot\u0026gt;forYard{fn eq(\u0026amp;self,other: \u0026amp;Foot)-\u0026gt; bool {self.0*3==other.0}}implPartialEq\u0026lt;Yard\u0026gt;forFoot{fn eq(\u0026amp;self,other: \u0026amp;Yard)-\u0026gt; bool {self.0==other.0*3}}fn main(){leta=Foot(5280);letb=Yard(1760);letc=Mile(1);// symmetry assert!(a==b\u0026amp;\u0026amp;b==a);// âœ… assert!(b==c\u0026amp;\u0026amp;c==b);// âœ… assert!(a==c\u0026amp;\u0026amp;c==a);// âœ… // transitivity assert!(a==b\u0026amp;\u0026amp;b==c\u0026amp;\u0026amp;a==c);// âœ… assert!(c==b\u0026amp;\u0026amp;b==a\u0026amp;\u0026amp;c==a);// âœ… }Eq æ˜¯ä¸€ä¸ªæ ‡è®° traitï¼Œæ˜¯ PartialEq\u0026lt;Self\u0026gt; çš„å­ traitã€‚\ntraitEq: PartialEq\u0026lt;Self\u0026gt;{}å¦‚æœæˆ‘ä»¬ä¸ºä¸€ä¸ªç±»å‹å®ç° Eqï¼Œåœ¨ PartialEq æ‰€è¦æ±‚çš„å¯¹ç§°æ€§å’Œä¼ é€’æ€§çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬è¿˜ä¿è¯äº†è‡ªåæ€§ï¼Œå³ å¯¹æ‰€æœ‰ a, a == aã€‚åœ¨è¿™ä¸ªæ„ä¹‰ä¸Šï¼ŒEq å®Œå–„äº† PartialEqï¼Œå› ä¸ºå®ƒä»£è¡¨äº†ä¸€ä¸ªæ›´ä¸¥æ ¼çš„ç›¸ç­‰æ€§ç‰ˆæœ¬ã€‚å¦‚æœä¸€ä¸ªç±»å‹çš„æ‰€æœ‰æˆå‘˜éƒ½æ˜¯Eq çš„ï¼Œé‚£ä¹ˆ Eq å®ç°å°±å¯ä»¥ä¸ºè¯¥ç±»å‹æ´¾ç”Ÿã€‚\næµ®ç‚¹ç±»å‹æ˜¯ PartialEq çš„ï¼Œä½†ä¸æ˜¯ Eq çš„ï¼Œå› ä¸º NaN != NaNã€‚å‡ ä¹æ‰€æœ‰å…¶ä»–çš„ PartialEq ç±»å‹éƒ½æ˜¯ Eqï¼Œå½“ç„¶ï¼Œé™¤éå®ƒä»¬åŒ…å«æµ®ç‚¹ã€‚\nä¸€æ—¦ä¸€ä¸ªç±»å‹å®ç°äº† PartialEq å’Œ Debugï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ assert_eq! å®ä¸­ä½¿ç”¨å®ƒã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æ¯”è¾ƒ PartialEq ç±»å‹çš„é›†åˆã€‚\n#[derive(PartialEq, Debug)]struct Point{x: i32,y: i32,}fn example_assert(p1: Point,p2: Point){assert_eq!(p1,p2);}fn example_compare_collections\u0026lt;T: PartialEq\u0026gt;(vec1: Vec\u0026lt;T\u0026gt;,vec2: Vec\u0026lt;T\u0026gt;){// if T: PartialEq this now works! ifvec1==vec2{// some code }else{// other code }}Hash é¢„å¤‡çŸ¥è¯†\n Self Methods Generic Parameters Default Impls Derive Macros PartialEq \u0026amp; Eq  traitHash{fn hash\u0026lt;H: Hasher\u0026gt;(\u0026amp;self,state: \u0026amp;mutH);// provided default impls fn hash_slice\u0026lt;H: Hasher\u0026gt;(data: \u0026amp;[Self],state: \u0026amp;mutH);}è¿™ä¸ª trait ä¸ä»»ä½•è¿ç®—ç¬¦æ— å…³ï¼Œä½†è°ˆè®ºå®ƒçš„æœ€å¥½æ—¶æœºæ˜¯åœ¨ PartialEq \u0026amp; Eq ä¹‹åï¼Œæ‰€ä»¥å®ƒåœ¨è¿™é‡Œã€‚Hash ç±»å‹å¯ä»¥ä½¿ç”¨ Hasher è¿›è¡Œæ•£åˆ—ã€‚\nusestd:#ï¸âƒ£:Hasher;usestd:#ï¸âƒ£:Hash;struct Point{x: i32,y: i32,}implHashforPoint{fn hash\u0026lt;H: Hasher\u0026gt;(\u0026amp;self,hasher: \u0026amp;mutH){hasher.write_i32(self.x);hasher.write_i32(self.y);}}æœ‰ä¸€ä¸ªæ´¾ç”Ÿå®ï¼Œå®ƒç”Ÿæˆçš„å®ç°ä¸ä¸Šè¿°ç›¸åŒã€‚\n#[derive(Hash)]struct Point{x: i32,y: i32,}å¦‚æœä¸€ä¸ªç±»å‹åŒæ—¶å®ç°äº† Hash å’Œ Eqï¼Œè¿™äº›å®ç°å¿…é¡»ç›¸äº’ä¸€è‡´ï¼Œå³å¯¹äºæ‰€æœ‰çš„ a å’Œ bï¼Œå¦‚æœ a == bï¼Œé‚£ä¹ˆ a.hash() == b.hash()ã€‚æ‰€ä»¥æˆ‘ä»¬åº”è¯¥æ€»æ˜¯ä½¿ç”¨æ´¾ç”Ÿå®æ¥å®ç°ä¸¤è€…ï¼Œæˆ–è€…æ‰‹åŠ¨å®ç°ä¸¤è€…ï¼Œä½†ä¸èƒ½æ··åˆä½¿ç”¨ï¼Œå¦åˆ™å°±æœ‰å¯èƒ½ç ´åä¸Šè¿°ä¸å˜æ€§ã€‚\nä¸ºä¸€ä¸ªç±»å‹å®ç° Eq å’Œ Hash çš„ä¸»è¦å¥½å¤„æ˜¯ï¼Œå®ƒå…è®¸æˆ‘ä»¬å°†è¯¥ç±»å‹ä½œä¸ºé”®å­˜å‚¨åœ¨ HashMap å’Œ HashSet ä¸­ã€‚\nusestd::collections::HashSet;// now our type can be stored // in HashSets and HashMaps! #[derive(PartialEq, Eq, Hash)]struct Point{x: i32,y: i32,}fn example_hashset(){letmutpoints=HashSet::new();points.insert(Point{x: 0,y: 0});// âœ… }PartialOrd \u0026amp; Ord é¢„å¤‡çŸ¥è¯†\n Self Methods Generic Parameters Default Impls Subtraits \u0026amp; Supertraits Derive Macros Sized PartialEq \u0026amp; Eq  enum Ordering{Less,Equal,Greater,}traitPartialOrd\u0026lt;Rhs=Self\u0026gt;: PartialEq\u0026lt;Rhs\u0026gt;whereRhs: ?Sized,{fn partial_cmp(\u0026amp;self,other: \u0026amp;Rhs)-\u0026gt; Option\u0026lt;Ordering\u0026gt;;// provided default impls fn lt(\u0026amp;self,other: \u0026amp;Rhs)-\u0026gt; bool;fn le(\u0026amp;self,other: \u0026amp;Rhs)-\u0026gt; bool;fn gt(\u0026amp;self,other: \u0026amp;Rhs)-\u0026gt; bool;fn ge(\u0026amp;self,other: \u0026amp;Rhs)-\u0026gt; bool;}PartialOrd\u0026lt;Rhs\u0026gt; ç±»å‹å¯ä»¥ä½¿ç”¨ \u0026lt;, \u0026lt;=, \u0026gt;, å’Œ \u0026gt;= è¿ç®—ç¬¦ä¸ Rhs ç±»å‹è¿›è¡Œæ¯”è¾ƒã€‚\næ‰€æœ‰çš„ PartialOrd å®ç°å¿…é¡»ç¡®ä¿æ¯”è¾ƒæ˜¯ä¸å¯¹ç§°çš„å’Œä¼ é€’çš„ã€‚è¿™æ„å‘³ç€å¯¹äºæ‰€æœ‰çš„ a, b, å’Œ c:\n a \u0026lt; b æ„å‘³ç€ !(a \u0026gt; b) (ä¸å¯¹ç§°æ€§) a \u0026lt; b \u0026amp;\u0026amp; b \u0026lt; c æ„å‘³ç€ a \u0026lt; c (ä¼ é€’æ€§)  PartialOrd æ˜¯ PartialEq çš„ä¸€ä¸ªå­ traitï¼Œå®ƒä»¬çš„å®ç°å¿…é¡»æ€»æ˜¯ç›¸äº’ä¸€è‡´ã€‚\nfn must_always_agree\u0026lt;T: PartialOrd +PartialEq\u0026gt;(t1: T,t2: T){assert_eq!(t1.partial_cmp(\u0026amp;t2)==Some(Ordering::Equal),t1==t2);}PartialOrd æ˜¯å¯¹ PartialEq çš„ç»†åŒ–ï¼Œå½“æ¯”è¾ƒ PartialEq ç±»å‹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥å®ƒä»¬æ˜¯å¦ç›¸ç­‰ï¼Œä½†å½“æ¯”è¾ƒ PartialOrd ç±»å‹æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥å®ƒä»¬æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœå®ƒä»¬ä¸ç›¸ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥å®ƒä»¬æ˜¯å¦ä¸ç›¸ç­‰ï¼Œå› ä¸ºç¬¬ä¸€é¡¹å°äºæˆ–å¤§äºç¬¬äºŒé¡¹ã€‚\né»˜è®¤æƒ…å†µä¸‹ Rhs = Selfï¼Œå› ä¸ºæˆ‘ä»¬å‡ ä¹æ€»æ˜¯æƒ³æŠŠä¸€ä¸ªç±»å‹çš„å®ä¾‹ç›¸äº’æ¯”è¾ƒï¼Œè€Œä¸æ˜¯å’Œä¸åŒç±»å‹çš„å®ä¾‹æ¯”è¾ƒã€‚è¿™ä¹Ÿè‡ªåŠ¨ä¿è¯äº†æˆ‘ä»¬çš„å®ç°æ˜¯å¯¹ç§°çš„å’Œä¼ é€’çš„ã€‚\nusestd::cmp::Ordering;#[derive(PartialEq, PartialOrd)]struct Point{x: i32,y: i32 }// Rhs == Self == Point implPartialOrdforPoint{// impl automatically symmetric \u0026amp; transitive fn partial_cmp(\u0026amp;self,other: \u0026amp;Point)-\u0026gt; Option\u0026lt;Ordering\u0026gt;{Some(matchself.x.cmp(\u0026amp;other.x){Ordering::Equal=\u0026gt;self.y.cmp(\u0026amp;other.y),ordering=\u0026gt;ordering,})}}å¦‚æœä¸€ä¸ªç±»å‹çš„æ‰€æœ‰æˆå‘˜éƒ½å®ç°äº† PartialOrdï¼Œé‚£ä¹ˆå®ƒå¯ä»¥è¢«æ´¾ç”Ÿã€‚\n#[derive(PartialEq, PartialOrd)]struct Point{x: i32,y: i32,}#[derive(PartialEq, PartialOrd)]enum Stoplight{Red,Yellow,Green,}PartialOrd æ´¾ç”Ÿå®åŸºäºå…¶æˆå‘˜çš„å­—æ¯é¡ºåºå¯¹ç±»å‹è¿›è¡Œæ’åºã€‚\n// generates PartialOrd impl which orders // Points based on x member first and // y member second because that\u0026#39;s the order // they appear in the source code #[derive(PartialOrd, PartialEq)]struct Point{x: i32,y: i32,}// generates DIFFERENT PartialOrd impl // which orders Points based on y member // first and x member second #[derive(PartialOrd, PartialEq)]struct Point{y: i32,x: i32,}Ord is a subtrait of Eq and PartialOrd\u0026lt;Self\u0026gt;: Ord æ˜¯ Eq å’Œ PartialOrd\u0026lt;Self\u0026gt; çš„å­ traitã€‚\ntraitOrd: Eq +PartialOrd\u0026lt;Self\u0026gt;{fn cmp(\u0026amp;self,other: \u0026amp;Self)-\u0026gt; Ordering;// provided default impls fn max(self,other: Self)-\u0026gt; Self;fn min(self,other: Self)-\u0026gt; Self;fn clamp(self,min: Self,max: Self)-\u0026gt; Self;}å¦‚æœæˆ‘ä»¬ä¸ºä¸€ä¸ªç±»å‹å®ç° Ordï¼Œåœ¨ PartialOrd æ‰€è¦æ±‚çš„ä¸å¯¹ç§°æ€§å’Œä¼ é€’æ€§çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬è¿˜ä¿è¯ä¸å¯¹ç§°æ€§æ˜¯å®Œå…¨çš„ï¼Œå³å¯¹äºä»»ä½•ç»™å®šçš„ a å’Œ bï¼Œa == b æˆ– a \u0026gt; b ä¸­åªæœ‰ä¸€ä¸ªæ˜¯çœŸçš„ã€‚åœ¨è¿™ä¸ªæ„ä¹‰ä¸Šï¼ŒOrd å®Œå–„äº† Eq å’Œ PartialOrdï¼Œå› ä¸ºå®ƒä»£è¡¨äº†ä¸€ä¸ªæ›´ä¸¥æ ¼çš„æ¯”è¾ƒç‰ˆæœ¬ã€‚å¦‚æœä¸€ä¸ªç±»å‹å®ç°äº† Ordï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨è¿™ä¸ªå®ç°æ¥å®ç° PartialOrdã€PartialEq å’Œ Eqã€‚\nusestd::cmp::Ordering;// of course we can use the derive macros here #[derive(Ord, PartialOrd, Eq, PartialEq)]struct Point{x: i32,y: i32,}// note: as with PartialOrd, the Ord derive macro // orders a type based on the lexicographical order // of its members // but here\u0026#39;s the impls if we wrote them out by hand implOrdforPoint{fn cmp(\u0026amp;self,other: \u0026amp;Self)-\u0026gt; Ordering{matchself.x.cmp(\u0026amp;self.y){Ordering::Equal=\u0026gt;self.y.cmp(\u0026amp;self.y),ordering=\u0026gt;ordering,}}}implPartialOrdforPoint{fn partial_cmp(\u0026amp;self,other: \u0026amp;Self)-\u0026gt; Option\u0026lt;Ordering\u0026gt;{Some(self.cmp(other))}}implPartialEqforPoint{fn eq(\u0026amp;self,other: \u0026amp;Self)-\u0026gt; bool {self.cmp(other)==Ordering::Equal}}implEqforPoint{}æµ®ç‚¹æ•°å®ç°äº† PartialOrdï¼Œä½†ä¸æ˜¯ Ordï¼Œå› ä¸º NaN \u0026lt; 0 == false å’Œ NaN \u0026gt;= 0 == false åŒæ—¶ä¸ºçœŸã€‚å‡ ä¹æ‰€æœ‰å…¶ä»–çš„ PartialOrd ç±»å‹éƒ½æ˜¯ Ordï¼Œå½“ç„¶ï¼Œé™¤éå®ƒä»¬åŒ…å«æµ®ç‚¹æ•°ã€‚\nä¸€æ—¦ä¸€ä¸ªç±»å‹è¢«è®¤ä¸ºæ˜¯ Ord çš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å…¶å­˜å‚¨åœ¨ BTreeMap å’Œ BTreeSet ä¸­ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ sort() æ–¹æ³•å¯¹å…¶è¿›è¡Œæ’åºï¼Œä»¥åŠå¯¹æ•°ç»„ã€Vec å’Œ VecDeque ç­‰ä»»ä½•ç±»å‹çš„åˆ‡ç‰‡è¿›è¡Œè§£å¼•ç”¨ã€‚\nusestd::collections::BTreeSet;// now our type can be stored // in BTreeSets and BTreeMaps! #[derive(Ord, PartialOrd, PartialEq, Eq)]struct Point{x: i32,y: i32,}fn example_btreeset(){letmutpoints=BTreeSet::new();points.insert(Point{x: 0,y: 0});// âœ… }// we can also .sort() Ord types in collections! fn example_sort\u0026lt;T: Ord\u0026gt;(mutsortable: Vec\u0026lt;T\u0026gt;)-\u0026gt; Vec\u0026lt;T\u0026gt;{sortable.sort();sortable}Arithmetic Traits    Trait(s) Category Operator(s) Description     Add arithmetic + addition   AddAssign arithmetic += addition assignment   BitAnd arithmetic \u0026amp; bitwise AND   BitAndAssign arithmetic \u0026amp;= bitwise assignment   BitXor arithmetic ^ bitwise XOR   BitXorAssign arithmetic ^= bitwise XOR assignment   Div arithmetic / division   DivAssign arithmetic /= division assignment   Mul arithmetic * multiplication   MulAssign arithmetic *= multiplication assignment   Neg arithmetic - unary negation   Not arithmetic ! unary logical negation   Rem arithmetic % remainder   RemAssign arithmetic %= remainder assignment   Shl arithmetic \u0026lt;\u0026lt; left shift   ShlAssign arithmetic \u0026lt;\u0026lt;= left shift assignment   Shr arithmetic \u0026gt;\u0026gt; right shift   ShrAssign arithmetic \u0026gt;\u0026gt;= right shift assignment   Sub arithmetic - subtraction   SubAssign arithmetic -= subtraction assignment    ä»”ç»†ç ”ç©¶æ‰€æœ‰è¿™äº›å°†æ˜¯éå¸¸å¤šä½™çš„ã€‚åæ­£å¤§å¤šæ•°åªé€‚ç”¨äºæ•°å­—ç±»å‹ã€‚æˆ‘ä»¬åªè®¨è®º Add å’Œ AddAssignï¼Œå› ä¸º + æ“ä½œç¬¦é€šå¸¸è¢«é‡è½½æ¥åšå…¶ä»–äº‹æƒ…ï¼Œå¦‚å‘é›†åˆæ·»åŠ é¡¹ç›®æˆ–å°†äº‹ç‰©ä¸²è”èµ·æ¥ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½è¦†ç›–æœ€æœ‰è¶£çš„åœ°æ–¹ï¼Œè€Œä¸ä¼šé‡å¤ã€‚\nAdd \u0026amp; AddAssign é¢„å¤‡çŸ¥è¯†\n Self Methods Associated Types Generic Parameters Generic Types vs Associated Types Derive Macros  traitAdd\u0026lt;Rhs=Self\u0026gt;{type Output;fn add(self,rhs: Rhs)-\u0026gt; Self::Output;}Add\u0026lt;Rhs, Output = T\u0026gt; ç±»å‹å¯ä»¥å’Œ Rhs ç±»å‹ç›¸åŠ ï¼Œå¹¶å°†äº§ç”Ÿ T ä½œä¸ºè¾“å‡ºã€‚\nä¾‹å­ Add\u0026lt;Point, Output = Point\u0026gt; æ˜¯é’ˆå¯¹ Point å®ç°çš„ã€‚\n#[derive(Clone, Copy)]struct Point{x: i32,y: i32,}implAddforPoint{type Output=Point;fn add(self,rhs: Point)-\u0026gt; Point{Point{x: self.x+rhs.x,y: self.y+rhs.y,}}}fn main(){letp1=Point{x: 1,y: 2};letp2=Point{x: 3,y: 4};letp3=p1+p2;assert_eq!(p3.x,p1.x+p2.x);// âœ… assert_eq!(p3.y,p1.y+p2.y);// âœ… }ä½†æ˜¯å¦‚æœæˆ‘ä»¬åªæœ‰å¯¹ Point çš„å¼•ç”¨å‘¢ï¼Ÿé‚£æˆ‘ä»¬è¿˜èƒ½è®©å®ƒä»¬ç›¸åŠ å—ï¼Ÿè®©æˆ‘ä»¬è¯•è¯•ã€‚\nfn main(){letp1=Point{x: 1,y: 2};letp2=Point{x: 3,y: 4};letp3=\u0026amp;p1+\u0026amp;p2;// âŒ }ä¸å¹¸çš„æ˜¯æ²¡æœ‰ã€‚ç¼–è¯‘å™¨ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š\nerror[E0369]: cannot add `\u0026amp;Point` to `\u0026amp;Point`\r--\u0026gt; src/main.rs:50:25\r|\r50 | let p3: Point = \u0026amp;p1 + \u0026amp;p2;\r| --- ^ --- \u0026amp;Point\r| |\r| \u0026amp;Point\r|\r= note: an implementation of `std::ops::Add` might be missing for `\u0026amp;Point`\råœ¨ Rust çš„ç±»å‹ç³»ç»Ÿä¸­ï¼Œå¯¹äºæŸäº›ç±»å‹ T æ¥è¯´ï¼ŒTã€\u0026amp;T å’Œ \u0026amp;mut T éƒ½è¢«è§†ä¸ºå”¯ä¸€çš„ä¸åŒç±»å‹ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»ä¸ºå®ƒä»¬åˆ†åˆ«æä¾› trait å®ç°ã€‚è®©æˆ‘ä»¬ä¸º \u0026amp;Point å®šä¹‰ä¸€ä¸ª Add å®ç°ï¼š\nimplAddfor\u0026amp;Point{type Output=Point;fn add(self,rhs: \u0026amp;Point)-\u0026gt; Point{Point{x: self.x+rhs.x,y: self.y+rhs.y,}}}fn main(){letp1=Point{x: 1,y: 2};letp2=Point{x: 3,y: 4};letp3=\u0026amp;p1+\u0026amp;p2;// âœ… assert_eq!(p3.x,p1.x+p2.x);// âœ… assert_eq!(p3.y,p1.y+p2.y);// âœ… }ç„¶è€Œï¼Œæœ‰äº›äº‹æƒ…è¿˜æ˜¯æ„Ÿè§‰ä¸å¤§å¯¹åŠ²ã€‚æˆ‘ä»¬æœ‰ä¸¤ä¸ªç‹¬ç«‹çš„ Add å®ç°ï¼Œåˆ†åˆ«ç”¨äº Point å’Œ \u0026amp;Pointï¼Œå®ƒä»¬ç›®å‰åšçš„æ˜¯åŒæ ·çš„äº‹æƒ…ï¼Œä½†ä¸èƒ½ä¿è¯å°†æ¥ä¹Ÿä¼šè¿™æ ·åšã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å†³å®šå½“æˆ‘ä»¬æŠŠä¸¤ä¸ª Point ç›¸åŠ æ—¶ï¼Œæˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ªåŒ…å«è¿™ä¸¤ä¸ª Point çš„ Lineï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ Pointï¼Œæˆ‘ä»¬ä¼šåƒè¿™æ ·æ›´æ–°æˆ‘ä»¬çš„ Add ç¨‹åºï¼š\nusestd::ops::Add;#[derive(Copy, Clone)]struct Point{x: i32,y: i32,}#[derive(Copy, Clone)]struct Line{start: Point,end: Point,}// we updated this impl implAddforPoint{type Output=Line;fn add(self,rhs: Point)-\u0026gt; Line{Line{start: self,end: rhs,}}}// but forgot to update this impl, uh oh! implAddfor\u0026amp;Point{type Output=Point;fn add(self,rhs: \u0026amp;Point)-\u0026gt; Point{Point{x: self.x+rhs.x,y: self.y+rhs.y,}}}fn main(){letp1=Point{x: 1,y: 2};letp2=Point{x: 3,y: 4};letline: Line=p1+p2;// âœ… letp1=Point{x: 1,y: 2};letp2=Point{x: 3,y: 4};letline: Line=\u0026amp;p1+\u0026amp;p2;// âŒ expected Line, found Point }æˆ‘ä»¬ç›®å‰å¯¹ \u0026amp;Point çš„ Add å®ç°é€ æˆäº†ä¸å¿…è¦çš„ç»´æŠ¤è´Ÿæ‹…ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™ä¸ªå®ç°ä¸ Point çš„å®ç°ç›¸åŒ¹é…ï¼Œè€Œä¸å¿…åœ¨æ¯æ¬¡æ”¹å˜ Point çš„å®ç°æ—¶éƒ½è¦æ‰‹åŠ¨æ›´æ–°ã€‚æˆ‘ä»¬å¸Œæœ›å°½å¯èƒ½åœ°ä¿æŒæˆ‘ä»¬çš„ä»£ç æ˜¯ DRYï¼ˆDon\u0026rsquo;t Repeat Yourselfï¼‰ã€‚å¹¸è¿çš„æ˜¯è¿™æ˜¯å¯ä»¥å®ç°çš„ã€‚\n// updated, DRY impl implAddfor\u0026amp;Point{type Output=\u0026lt;PointasAdd\u0026gt;::Output;fn add(self,rhs: \u0026amp;Point)-\u0026gt; Self::Output{Point::add(*self,*rhs)}}fn main(){letp1=Point{x: 1,y: 2};letp2=Point{x: 3,y: 4};letline: Line=p1+p2;// âœ… letp1=Point{x: 1,y: 2};letp2=Point{x: 3,y: 4};letline: Line=\u0026amp;p1+\u0026amp;p2;// âœ… }AddAssign\u0026lt;Rhs\u0026gt; ç±»å‹å…è®¸æˆ‘ä»¬ç›¸åŠ å¹¶åˆ†é… Rhs ç±»å‹ç»™å®ƒä»¬ã€‚Trait å£°æ˜å¦‚ä¸‹ï¼š\ntraitAddAssign\u0026lt;Rhs=Self\u0026gt;{fn add_assign(\u0026amp;mutself,rhs: Rhs);}ä¸º Point å’Œ \u0026amp;Point ç±»å‹çš„å®ç°çš„ä¾‹å­å¦‚ä¸‹ï¼š\nusestd::ops::AddAssign;#[derive(Copy, Clone)]struct Point{x: i32,y: i32 }implAddAssignforPoint{fn add_assign(\u0026amp;mutself,rhs: Point){self.x+=rhs.x;self.y+=rhs.y;}}implAddAssign\u0026lt;\u0026amp;Point\u0026gt;forPoint{fn add_assign(\u0026amp;mutself,rhs: \u0026amp;Point){Point::add_assign(self,*rhs);}}fn main(){letmutp1=Point{x: 1,y: 2};letp2=Point{x: 3,y: 4};p1+=\u0026amp;p2;p1+=p2;assert!(p1.x==7\u0026amp;\u0026amp;p1.y==10);}é—­åŒ… Traits    Trait(s) Category Operator(s) Description     Fn closure (...args) immutable closure invocation   FnMut closure (...args) mutable closure invocation   FnOnce closure (...args) one-time closure invocation    FnOnce, FnMut, \u0026amp; Fn é¢„å¤‡çŸ¥è¯†\n Self Methods Associated Types Generic Parameters Generic Types vs Associated Types Subtraits \u0026amp; Supertraits  traitFnOnce\u0026lt;Args\u0026gt;{type Output;fn call_once(self,args: Args)-\u0026gt; Self::Output;}traitFnMut\u0026lt;Args\u0026gt;: FnOnce\u0026lt;Args\u0026gt;{fn call_mut(\u0026amp;mutself,args: Args)-\u0026gt; Self::Output;}traitFn\u0026lt;Args\u0026gt;: FnMut\u0026lt;Args\u0026gt;{fn call(\u0026amp;self,args: Args)-\u0026gt; Self::Output;}è™½ç„¶è¿™äº› trait å­˜åœ¨ï¼Œä½†åœ¨ç¨³å®šçš„ Rust ä¸­ï¼Œæˆ‘ä»¬ä¸å¯èƒ½ä¸ºè‡ªå·±çš„ç±»å‹å®ç°è¿™äº›ç‰¹æ€§ã€‚æˆ‘ä»¬å”¯ä¸€èƒ½åˆ›å»ºçš„å®ç°è¿™äº› trait çš„ç±»å‹æ˜¯é—­åŒ…ã€‚æ ¹æ®é—­åŒ…ä»å…¶ç¯å¢ƒä¸­æ•è·çš„å†…å®¹ï¼Œå†³å®šäº†å®ƒæ˜¯å®ç°äº† FnOnceã€FnMut è¿˜æ˜¯ Fnã€‚\nFnOnce é—­åŒ…åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œå› ä¸ºå®ƒåœ¨æ‰§è¡Œä¸­ä¼šæ¶ˆè€—ä¸€äº›å€¼ã€‚\nfn main(){letrange=0..10;letget_range_count=||range.count();assert_eq!(get_range_count(),10);// âœ… get_range_count();// âŒ }è¿­ä»£å™¨ä¸Šçš„ .count() æ–¹æ³•ä¼šæ¶ˆè€—è¿­ä»£å™¨ï¼Œæ‰€ä»¥å®ƒåªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬çš„é—­åŒ…åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå½“æˆ‘ä»¬è¯•å›¾ç¬¬äºŒæ¬¡è°ƒç”¨å®ƒæ—¶ï¼Œä¼šå‡ºç°è¿™ä¸ªé”™è¯¯ã€‚\nerror[E0382]: use of moved value: `get_range_count`\r--\u0026gt; src/main.rs:5:5\r|\r4 | assert_eq!(get_range_count(), 10);\r| ----------------- `get_range_count` moved due to this call\r5 | get_range_count();\r| ^^^^^^^^^^^^^^^ value used here after move\r|\rnote: closure cannot be invoked more than once because it moves the variable `range` out of its environment\r--\u0026gt; src/main.rs:3:30\r|\r3 | let get_range_count = || range.count();\r| ^^^^^\rnote: this value implements `FnOnce`, which causes it to be moved when called\r--\u0026gt; src/main.rs:4:16\r|\r4 | assert_eq!(get_range_count(), 10);\r| ^^^^^^^^^^^^^^^\rFnMut é—­åŒ…å¯ä»¥è¢«å¤šæ¬¡è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥æ”¹å˜å®ƒä»ç¯å¢ƒä¸­æ•è·çš„å˜é‡ã€‚æˆ‘ä»¬å¯ä»¥è¯´ FnMut é—­åŒ…æ˜¯æ‰§è¡Œå‰¯ä½œç”¨çš„ï¼Œæˆ–è€…è¯´æ˜¯æœ‰çŠ¶æ€çš„ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªé—­åŒ…çš„ä¾‹å­ï¼Œå®ƒé€šè¿‡è·Ÿè¸ªåˆ°ç›®å‰ä¸ºæ­¢çœ‹åˆ°çš„æœ€å°å€¼ï¼Œä»è¿­ä»£å™¨ä¸­è¿‡æ»¤å‡ºæ‰€æœ‰éå‡åºçš„å€¼ã€‚\nfn main(){letnums=vec![0,4,2,8,10,7,15,18,13];letmutmin=i32::MIN;letascending=nums.into_iter().filter(|\u0026amp;n|{ifn\u0026lt;=min{false}else{min=n;true}}).collect::\u0026lt;Vec\u0026lt;_\u0026gt;\u0026gt;();assert_eq!(vec![0,4,8,10,15,18],ascending);// âœ… }FnMut å®Œå–„äº† FnOnceï¼Œå³ FnOnce éœ€è¦å–å¾—å…¶å‚æ•°çš„æ‰€æœ‰æƒï¼Œåªèƒ½è°ƒç”¨ä¸€æ¬¡ï¼Œä½† FnMut åªéœ€è¦å–å¾—å¯å˜çš„å¼•ç”¨ï¼Œå¯ä»¥å¤šæ¬¡è°ƒç”¨ã€‚FnMut å¯ä»¥åœ¨ä»»ä½•å¯ä»¥ä½¿ç”¨ FnOnce çš„åœ°æ–¹ä½¿ç”¨ã€‚\nFn é—­åŒ…å¯ä»¥è¢«å¤šæ¬¡è°ƒç”¨ï¼Œå¹¶ä¸”ä¸æ”¹å˜å®ƒä»ç¯å¢ƒä¸­æ•è·çš„ä»»ä½•å˜é‡ã€‚æˆ‘ä»¬å¯ä»¥è¯´ Fn é—­åŒ…æ²¡æœ‰å‰¯ä½œç”¨æˆ–æ— çŠ¶æ€ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªé—­åŒ…çš„ä¾‹å­ï¼Œå®ƒè¿‡æ»¤æ‰äº†æ‰€æœ‰å°äºå®ƒä»ç¯å¢ƒä¸­æ•è·çš„è¿­ä»£å™¨ä¸­çš„æŸä¸ªæ ˆå˜é‡çš„å€¼ã€‚\nfn main(){letnums=vec![0,4,2,8,10,7,15,18,13];letmin=9;letgreater_than_9=nums.into_iter().filter(|\u0026amp;n|n\u0026gt;min).collect::\u0026lt;Vec\u0026lt;_\u0026gt;\u0026gt;();assert_eq!(vec![10,15,18,13],greater_than_9);// âœ… }Fn ç»†åŒ–äº† FnMutï¼Œå³ FnMut éœ€è¦å¯å˜çš„å¼•ç”¨å¹¶å¯å¤šæ¬¡è°ƒç”¨ï¼Œä½† Fn åªéœ€è¦ä¸å¯å˜çš„å¼•ç”¨å¹¶å¯å¤šæ¬¡è°ƒç”¨ã€‚Fn å¯ä»¥ç”¨åœ¨ä»»ä½•å¯ä»¥ä½¿ç”¨ FnMut çš„åœ°æ–¹ï¼ŒåŒ…æ‹¬å¯ä»¥ä½¿ç”¨ FnOnce çš„åœ°æ–¹ã€‚\nå¦‚æœä¸€ä¸ªé—­åŒ…æ²¡æœ‰ä»å®ƒçš„ç¯å¢ƒä¸­æ•è·ä»»ä½•ä¸œè¥¿ï¼Œé‚£ä¹ˆä»æŠ€æœ¯ä¸Šè®²ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œè€Œåªæ˜¯ä¸€ä¸ªåŒ¿åå£°æ˜çš„å†…è”å‡½æ•°ï¼Œå¹¶ä¸”å¯ä»¥ä½œä¸ºä¸€ä¸ªæ™®é€šçš„å‡½æ•°æŒ‡é’ˆè¢«è½¬æ¢ã€ä½¿ç”¨å’Œä¼ é€’ï¼Œä¹Ÿå°±æ˜¯ fnã€‚å‡½æ•°æŒ‡é’ˆå¯ä»¥åœ¨ä»»ä½•å¯ä»¥ä½¿ç”¨ Fn çš„åœ°æ–¹ä½¿ç”¨ï¼Œè¿™åŒ…æ‹¬å¯ä»¥ä½¿ç”¨ FnMut å’Œ FnOnce çš„åœ°æ–¹ã€‚\nfn add_one(x: i32)-\u0026gt; i32 {x+1}fn main(){letmutfn_ptr: fn(i32)-\u0026gt; i32 =add_one;assert_eq!(fn_ptr(1),2);// âœ… // capture-less closure cast to fn pointer fn_ptr=|x|x+1;// same as add_one assert_eq!(fn_ptr(1),2);// âœ… }ä¼ é€’æ™®é€šå‡½æ•°æŒ‡é’ˆä»¥ä»£æ›¿é—­åŒ…çš„ä¾‹å­:\nfn main(){letnums=vec![-1,1,-2,2,-3,3];letabsolutes: Vec\u0026lt;i32\u0026gt;=nums.into_iter().map(i32::abs).collect();assert_eq!(vec![1,1,2,2,3,3],absolutes);// âœ… }å…¶ä»– Trait    Trait(s) Category Operator(s) Description     Deref other * immutable dereference   DerefMut other * mutable derenence   Drop other - type destructor   Index other [] immutable index   IndexMut other [] mutable index   RangeBounds other .. range    Deref \u0026amp; DerefMut é¢„å¤‡çŸ¥è¯†\n Self Methods Associated Types Subtraits \u0026amp; Supertraits Sized  traitDeref{type Target: ?Sized;fn deref(\u0026amp;self)-\u0026gt; \u0026amp;Self::Target;}traitDerefMut: Deref{fn deref_mut(\u0026amp;mutself)-\u0026gt; \u0026amp;mutSelf::Target;}å¯ä»¥ä½¿ç”¨è§£å¼•ç”¨æ“ä½œç¬¦ * æŠŠå®ç°äº† Deref\u0026lt;Target = T\u0026gt; trait çš„ç±»å‹è§£å¼•ç”¨ä¸º T ç±»å‹ã€‚è¿™å¯¹äºæ™ºèƒ½æŒ‡é’ˆç±»å‹ï¼ˆå¦‚ Box å’Œ Rcï¼‰æœ‰æ˜æ˜¾çš„ç”¨é€”ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å¾ˆå°‘çœ‹åˆ°åœ¨ Rust ä»£ç ä¸­æ˜¾å¼åœ°ä½¿ç”¨è§£å¼•ç”¨æ“ä½œç¬¦ï¼Œè¿™æ˜¯å› ä¸º Rust çš„ä¸€ä¸ªå«åš â€œå¼ºåˆ¶è§£å¼•ç”¨â€(deref coercion)çš„ç‰¹æ€§ã€‚\nå½“ç±»å‹ä½œä¸ºå‡½æ•°å‚æ•°ä¼ é€’ã€ä»å‡½æ•°è¿”å›æˆ–ä½œä¸ºæ–¹æ³•è°ƒç”¨çš„ä¸€éƒ¨åˆ†ä½¿ç”¨æ—¶ï¼ŒRust ä¼šè‡ªåŠ¨åœ°å¯¹ç±»å‹è¿›è¡Œè§£å¼•ç”¨ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥å°† \u0026amp;String å’Œ \u0026amp;Vec\u0026lt;T\u0026gt; ä¼ é€’ç»™æœŸæœ› \u0026amp;str å’Œ \u0026amp;[T] çš„å‡½æ•°çš„åŸå› ï¼Œå› ä¸º String å®ç°äº† Deref\u0026lt;Target = str\u0026gt;, Vec\u0026lt;T\u0026gt; å®ç°äº† Deref\u0026lt;Target = [T]\u0026gt;ã€‚\nDeref å’Œ DerefMut åªåº”ä¸ºæ™ºèƒ½æŒ‡é’ˆç±»å‹è€Œå®ç°ã€‚äººä»¬è¯•å›¾è¯¯ç”¨å’Œæ»¥ç”¨è¿™äº› trait çš„æœ€å¸¸è§æ–¹å¼æ˜¯è¯•å›¾å°†æŸç§ OOP å¼çš„æ•°æ®ç»§æ‰¿å¡è¿› Rust ä¸­ã€‚è¿™æ˜¯è¡Œä¸é€šçš„ã€‚Rust ä¸æ˜¯é¢å‘å¯¹è±¡çš„ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹å‡ ç§ä¸åŒçš„æƒ…å†µï¼Œåœ¨å“ªäº›æƒ…å†µä¸‹ï¼Œå¦‚ä½•ä»¥åŠä¸ºä»€ä¹ˆå®ƒä¸èµ·ä½œç”¨ã€‚è®©æˆ‘ä»¬ä»è¿™ä¸ªä¾‹å­å¼€å§‹:\nusestd::ops::Deref;struct Human{health_points: u32,}enum Weapon{Spear,Axe,Sword,}// a Soldier is just a Human with a Weapon struct Soldier{human: Human,weapon: Weapon,}implDerefforSoldier{type Target=Human;fn deref(\u0026amp;self)-\u0026gt; \u0026amp;Human{\u0026amp;self.human}}enum Mount{Horse,Donkey,Cow,}// a Knight is just a Soldier with a Mount struct Knight{soldier: Soldier,mount: Mount,}implDerefforKnight{type Target=Soldier;fn deref(\u0026amp;self)-\u0026gt; \u0026amp;Soldier{\u0026amp;self.soldier}}enum Spell{MagicMissile,FireBolt,ThornWhip,}// a Mage is just a Human who can cast Spells struct Mage{human: Human,spells: Vec\u0026lt;Spell\u0026gt;,}implDerefforMage{type Target=Human;fn deref(\u0026amp;self)-\u0026gt; \u0026amp;Human{\u0026amp;self.human}}enum Staff{Wooden,Metallic,Plastic,}// a Wizard is just a Mage with a Staff struct Wizard{mage: Mage,staff: Staff,}implDerefforWizard{type Target=Mage;fn deref(\u0026amp;self)-\u0026gt; \u0026amp;Mage{\u0026amp;self.mage}}fn borrows_human(human: \u0026amp;Human){}fn borrows_soldier(soldier: \u0026amp;Soldier){}fn borrows_knight(knight: \u0026amp;Knight){}fn borrows_mage(mage: \u0026amp;Mage){}fn borrows_wizard(wizard: \u0026amp;Wizard){}fn example(human: Human,soldier: Soldier,knight: Knight,mage: Mage,wizard: Wizard){// all types can be used as Humans borrows_human(\u0026amp;human);borrows_human(\u0026amp;soldier);borrows_human(\u0026amp;knight);borrows_human(\u0026amp;mage);borrows_human(\u0026amp;wizard);// Knights can be used as Soldiers borrows_soldier(\u0026amp;soldier);borrows_soldier(\u0026amp;knight);// Wizards can be used as Mages borrows_mage(\u0026amp;mage);borrows_mage(\u0026amp;wizard);// Knights \u0026amp; Wizards passed as themselves borrows_knight(\u0026amp;knight);borrows_wizard(\u0026amp;wizard);}å› æ­¤ï¼Œä¹ä¸€çœ‹ï¼Œä¸Šé¢çš„å†…å®¹çœ‹èµ·æ¥å¾ˆä¸é”™ï¼ç„¶è€Œï¼Œåœ¨ä»”ç»†ç ”ç©¶åï¼Œå¾ˆå¿«å°±å‘ç°äº†é—®é¢˜ã€‚é¦–å…ˆï¼Œå¼ºåˆ¶è§£å¼•ç”¨åªå¯¹å¼•ç”¨èµ·ä½œç”¨ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬çœŸæ­£æƒ³è¦ä¼ é€’æ‰€æœ‰æƒæ—¶ï¼Œå®ƒå°±ä¸èµ·ä½œç”¨äº†ã€‚\nfn takes_human(human: Human){}fn example(human: Human,soldier: Soldier,knight: Knight,mage: Mage,wizard: Wizard){// all types CANNOT be used as Humans takes_human(human);takes_human(soldier);// âŒ takes_human(knight);// âŒ takes_human(mage);// âŒ takes_human(wizard);// âŒ }æ­¤å¤–ï¼Œå¼ºåˆ¶è§£å¼•ç”¨åœ¨æ³›å‹ä¸Šä¸‹æ–‡ä¸­ä¸èµ·ä½œç”¨ã€‚æ¯”æ–¹è¯´ï¼Œæˆ‘ä»¬åªåœ¨äººç±»èº«ä¸Šå®ç°ä¸€äº› traitï¼š\ntraitRest{fn rest(\u0026amp;self);}implRestforHuman{fn rest(\u0026amp;self){}}fn take_rest\u0026lt;T: Rest\u0026gt;(rester: \u0026amp;T){rester.rest()}fn example(human: Human,soldier: Soldier,knight: Knight,mage: Mage,wizard: Wizard){// all types CANNOT be used as Rest types, only Human take_rest(\u0026amp;human);take_rest(\u0026amp;soldier);// âŒ take_rest(\u0026amp;knight);// âŒ take_rest(\u0026amp;mage);// âŒ take_rest(\u0026amp;wizard);// âŒ }å¦å¤–ï¼Œå°½ç®¡å¼ºåˆ¶è§£å¼•ç”¨åœ¨å¾ˆå¤šåœ°æ–¹éƒ½èƒ½å·¥ä½œï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰åœ°æ–¹éƒ½èƒ½å·¥ä½œã€‚å®ƒå¯¹æ“ä½œæ•°ä¸èµ·ä½œç”¨ï¼Œå°½ç®¡æ“ä½œç¬¦åªæ˜¯æ–¹æ³•è°ƒç”¨çš„è¯­æ³•ç³–ã€‚æ¯”æ–¹è¯´ï¼Œæˆ‘ä»¬æƒ³è®© Mage(æ³•å¸ˆ) ç”¨ += è¿ç®—ç¬¦æ¥å­¦ä¹  Spell(å’’è¯­)ï¼Œè¿™å¾ˆå¯çˆ±ã€‚\nimplDerefMutforWizard{fn deref_mut(\u0026amp;mutself)-\u0026gt; \u0026amp;mutMage{\u0026amp;mutself.mage}}implAddAssign\u0026lt;Spell\u0026gt;forMage{fn add_assign(\u0026amp;mutself,spell: Spell){self.spells.push(spell);}}fn example(mutmage: Mage,mutwizard: Wizard,spell: Spell){mage+=spell;wizard+=spell;// âŒ wizard not coerced to mage here wizard.add_assign(spell);// oof, we have to call it like this ğŸ¤¦ }åœ¨ OOP å¼æ•°æ®ç»§æ‰¿çš„è¯­è¨€ä¸­ï¼Œæ–¹æ³•ä¸­ self çš„å€¼æ€»æ˜¯ç­‰äºè°ƒç”¨è¯¥æ–¹æ³•çš„ç±»å‹ï¼Œä½†åœ¨ Rust ä¸­ï¼Œself çš„å€¼æ€»æ˜¯ç­‰äºå®ç°è¯¥æ–¹æ³•çš„ç±»å‹ã€‚\nstruct Human{profession: \u0026amp;\u0026#39;staticstr,health_points: u32,}implHuman{// self will always be a Human here, even if we call it on a Soldier fn state_profession(\u0026amp;self){println!(\u0026#34;I\u0026#39;m a {}!\u0026#34;,self.profession);}}struct Soldier{profession: \u0026amp;\u0026#39;staticstr,human: Human,weapon: Weapon,}fn example(soldier: \u0026amp;Soldier){assert_eq!(\u0026#34;servant\u0026#34;,soldier.human.profession);assert_eq!(\u0026#34;spearman\u0026#34;,soldier.profession);soldier.human.state_profession();// prints \u0026#34;I\u0026#39;m a servant!\u0026#34; soldier.state_profession();// still prints \u0026#34;I\u0026#39;m a servant!\u0026#34; ğŸ¤¦ }å½“åœ¨ä¸€ä¸ªæ–°ç±»å‹ä¸Šå®ç° Deref æˆ– DerefMut æ—¶ï¼Œä¸Šè¿°çš„é—®é¢˜å°¤å…¶ä¸¥é‡ã€‚å‡è®¾æˆ‘ä»¬æƒ³åˆ›å»ºä¸€ä¸ª SortedVec ç±»å‹ï¼Œå®ƒåªæ˜¯ä¸€ä¸ª Vecï¼Œä½†å®ƒæ€»æ˜¯æŒ‰æ’åºé¡ºåºæ’åˆ—ã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬å¦‚ä½•åšçš„ã€‚\nstruct SortedVec\u0026lt;T: Ord\u0026gt;(Vec\u0026lt;T\u0026gt;);impl\u0026lt;T: Ord\u0026gt;SortedVec\u0026lt;T\u0026gt;{fn new(mutvec: Vec\u0026lt;T\u0026gt;)-\u0026gt; Self{vec.sort();SortedVec(vec)}fn push(\u0026amp;mutself,t: T){self.0.push(t);self.0.sort();}}å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨è¿™é‡Œå®ç° DerefMut\u0026lt;Target = Vec\u0026lt;T\u0026gt;\u0026gt;ï¼Œå¦åˆ™ä»»ä½•ä½¿ç”¨ SortedVec çš„äººéƒ½å¯ä»¥è½»æ˜“åœ°ç ´åæ’åºçš„é¡ºåºã€‚ç„¶è€Œï¼Œå®ç° Deref\u0026lt;Target = Vec\u0026lt;T\u0026gt;\u0026gt; è‚¯å®šæ˜¯å®‰å…¨çš„ï¼Œå¯¹å—ï¼Ÿè¯•ç€åœ¨ä¸‹é¢çš„ç¨‹åºä¸­å‘ç°è¿™ä¸ªé”™è¯¯ã€‚\nusestd::ops::Deref;struct SortedVec\u0026lt;T: Ord\u0026gt;(Vec\u0026lt;T\u0026gt;);impl\u0026lt;T: Ord\u0026gt;SortedVec\u0026lt;T\u0026gt;{fn new(mutvec: Vec\u0026lt;T\u0026gt;)-\u0026gt; Self{vec.sort();SortedVec(vec)}fn push(\u0026amp;mutself,t: T){self.0.push(t);self.0.sort();}}impl\u0026lt;T: Ord\u0026gt;DerefforSortedVec\u0026lt;T\u0026gt;{type Target=Vec\u0026lt;T\u0026gt;;fn deref(\u0026amp;self)-\u0026gt; \u0026amp;Vec\u0026lt;T\u0026gt;{\u0026amp;self.0}}fn main(){letsorted=SortedVec::new(vec![2,8,6,3]);sorted.push(1);letsortedClone=sorted.clone();sortedClone.push(4);}æˆ‘ä»¬ä»æœªä¸º SortedVec å®ç° Cloneï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è°ƒç”¨ .clone() æ–¹æ³•æ—¶ï¼Œç¼–è¯‘å™¨ä½¿ç”¨å¼ºåˆ¶è§£å¼•ç”¨æ¥è§£å†³å¯¹ Vec çš„æ–¹æ³•è°ƒç”¨ï¼Œæ‰€ä»¥å®ƒè¿”å›ä¸€ä¸ª Vec è€Œä¸æ˜¯ SortedVec!\nfn main(){letsorted: SortedVec\u0026lt;i32\u0026gt;=SortedVec::new(vec![2,8,6,3]);sorted.push(1);// still sorted // calling clone on SortedVec actually returns a Vec ğŸ¤¦ letsortedClone: Vec\u0026lt;i32\u0026gt;=sorted.clone();sortedClone.push(4);// sortedClone no longer sorted ğŸ’€ }æ€»ä¹‹ï¼Œä»¥ä¸Šè¿™äº›é™åˆ¶ã€çº¦æŸæˆ–éº»çƒ¦éƒ½ä¸æ˜¯ Rust çš„ç¼ºç‚¹ï¼Œå› ä¸º Rust ä¸€å¼€å§‹å°±æ²¡æœ‰è¢«è®¾è®¡æˆä¸€ç§ OO è¯­è¨€æˆ–æ”¯æŒä»»ä½• OOP æ¨¡å¼ã€‚\næœ¬èŠ‚çš„ä¸»è¦å¯ç¤ºæ˜¯ï¼Œä¸è¦è¯•å›¾ç”¨ Deref å’Œ DerefMut å®ç°æ¥è¡¨ç°å¯çˆ±æˆ–èªæ˜ã€‚å®ƒä»¬å®é™…ä¸Šåªé€‚åˆäºæ™ºèƒ½æŒ‡é’ˆç±»å‹ï¼Œç›®å‰åªèƒ½åœ¨æ ‡å‡†åº“ä¸­å®ç°ï¼Œå› ä¸ºæ™ºèƒ½æŒ‡é’ˆç±»å‹ç›®å‰éœ€è¦ä¸ç¨³å®šçš„ç‰¹æ€§å’Œç¼–è¯‘å™¨çš„é­”æ³•æ‰èƒ½å·¥ä½œã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦ç±»ä¼¼äº Deref å’Œ DerefMut çš„åŠŸèƒ½å’Œè¡Œä¸ºï¼Œé‚£ä¹ˆæˆ‘ä»¬å®é™…ä¸Šå¯èƒ½è¦æ‰¾çš„æ˜¯ AsRef å’Œ AsMutï¼Œæˆ‘ä»¬å°†åœ¨åé¢è®¨è®ºã€‚\nIndex \u0026amp; IndexMut é¢„å¤‡çŸ¥è¯†\n Self Methods Associated Types Generic Parameters Generic Types vs Associated Types Subtraits \u0026amp; Supertraits Sized  traitIndex\u0026lt;Idx: ?Sized\u0026gt;{type Output: ?Sized;fn index(\u0026amp;self,index: Idx)-\u0026gt; \u0026amp;Self::Output;}traitIndexMut\u0026lt;Idx\u0026gt;: Index\u0026lt;Idx\u0026gt;whereIdx: ?Sized{fn index_mut(\u0026amp;mutself,index: Idx)-\u0026gt; \u0026amp;mutSelf::Output;}æˆ‘ä»¬å¯ä»¥å°† [] ç´¢å¼•åˆ°æœ‰ T å€¼çš„ Index\u0026lt;T, Output = U\u0026gt; ç±»å‹ï¼Œç´¢å¼•æ“ä½œå°†è¿”å› \u0026amp;U å€¼ã€‚å¯¹äºè¯­æ³•ç³–ï¼Œç¼–è¯‘å™¨ä¼šåœ¨ä»»ä½•ä»ç´¢å¼•æ“ä½œè¿”å›çš„å€¼å‰é¢è‡ªåŠ¨æ’å…¥ä¸€ä¸ªè§£å¼•ç”¨è¿ç®—ç¬¦ *ã€‚\nfn main(){// Vec\u0026lt;i32\u0026gt; impls Index\u0026lt;usize, Output = i32\u0026gt; so // indexing Vec\u0026lt;i32\u0026gt; should produce \u0026amp;i32s and yet... letvec=vec![1,2,3,4,5];letnum_ref: \u0026amp;i32 =vec[0];// âŒ expected \u0026amp;i32 found i32 // above line actually desugars to letnum_ref: \u0026amp;i32 =*vec[0];// âŒ expected \u0026amp;i32 found i32 // both of these alternatives work letnum: i32 =vec[0];// âœ… letnum_ref=\u0026amp;vec[0];// âœ… }ä¸€å¼€å§‹æœ‰ç‚¹è®©äººå›°æƒ‘ï¼Œå› ä¸ºçœ‹èµ·æ¥ Index trait å¹¶ä¸éµå¾ªå®ƒè‡ªå·±çš„æ–¹æ³•ç­¾åï¼Œä½†å®é™…ä¸Šè¿™åªæ˜¯æœ‰é—®é¢˜çš„è¯­æ³•ç³–ã€‚\nå› ä¸º Idx æ˜¯ä¸€ä¸ªæ³›å‹ç±»å‹ï¼ŒIndex trait å¯ä»¥ä¸ºä¸€ä¸ªç»™å®šçš„ç±»å‹å®ç°å¾ˆå¤šæ¬¡ï¼Œåœ¨ Vec\u0026lt;T\u0026gt; çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥ä½¿ç”¨ usize å¯¹å…¶è¿›è¡Œç´¢å¼•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ Range\u0026lt;usize\u0026gt; å¯¹å…¶è¿›è¡Œç´¢å¼•ï¼Œä»¥è·å¾—åˆ‡ç‰‡ã€‚\nfn main(){letvec=vec![1,2,3,4,5];assert_eq!(\u0026amp;vec[..],\u0026amp;[1,2,3,4,5]);// âœ… assert_eq!(\u0026amp;vec[1..],\u0026amp;[2,3,4,5]);// âœ… assert_eq!(\u0026amp;vec[..4],\u0026amp;[1,2,3,4]);// âœ… assert_eq!(\u0026amp;vec[1..4],\u0026amp;[2,3,4]);// âœ… }ä¸ºäº†å±•ç¤ºæˆ‘ä»¬å¦‚ä½•å®ç° Indexï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªæœ‰è¶£çš„ä¾‹å­ï¼Œå±•ç¤ºäº†æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨ä¸€ä¸ªæ–°ç±»å‹å’Œ Index trait æ¥å®ç° Vec çš„åŒ…è£…ç´¢å¼•å’Œè´Ÿç´¢å¼•ã€‚\nusestd::ops::Index;struct WrappingIndex\u0026lt;T\u0026gt;(Vec\u0026lt;T\u0026gt;);impl\u0026lt;T\u0026gt;Index\u0026lt;usize\u0026gt;forWrappingIndex\u0026lt;T\u0026gt;{type Output=T;fn index(\u0026amp;self,index: usize)-\u0026gt; \u0026amp;T{\u0026amp;self.0[index%self.0.len()]}}impl\u0026lt;T\u0026gt;Index\u0026lt;i128\u0026gt;forWrappingIndex\u0026lt;T\u0026gt;{type Output=T;fn index(\u0026amp;self,index: i128)-\u0026gt; \u0026amp;T{letself_len=self.0.len()asi128;letidx=(((index%self_len)+self_len)%self_len)asusize;\u0026amp;self.0[idx]}}#[test]// âœ… fn indexes(){letwrapping_vec=WrappingIndex(vec![1,2,3]);assert_eq!(1,wrapping_vec[0_usize]);assert_eq!(2,wrapping_vec[1_usize]);assert_eq!(3,wrapping_vec[2_usize]);}#[test]// âœ… fn wrapping_indexes(){letwrapping_vec=WrappingIndex(vec![1,2,3]);assert_eq!(1,wrapping_vec[3_usize]);assert_eq!(2,wrapping_vec[4_usize]);assert_eq!(3,wrapping_vec[5_usize]);}#[test]// âœ… fn neg_indexes(){letwrapping_vec=WrappingIndex(vec![1,2,3]);assert_eq!(1,wrapping_vec[-3_i128]);assert_eq!(2,wrapping_vec[-2_i128]);assert_eq!(3,wrapping_vec[-1_i128]);}#[test]// âœ… fn wrapping_neg_indexes(){letwrapping_vec=WrappingIndex(vec![1,2,3]);assert_eq!(1,wrapping_vec[-6_i128]);assert_eq!(2,wrapping_vec[-5_i128]);assert_eq!(3,wrapping_vec[-4_i128]);}æ²¡æœ‰è¦æ±‚ Idx ç±»å‹å¿…é¡»æ˜¯æ•°å­—ç±»å‹æˆ– Rangeï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªæšä¸¾! ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œä½¿ç”¨ç¯®çƒä½ç½®ç´¢å¼•åˆ°ä¸€ä¸ªç¯®çƒé˜Ÿï¼Œä»¥æ£€ç´¢è¯¥é˜Ÿçš„çƒå‘˜ã€‚\nusestd::ops::Index;enum BasketballPosition{PointGuard,ShootingGuard,Center,PowerForward,SmallForward,}struct BasketballPlayer{name: \u0026amp;\u0026#39;staticstr,position: BasketballPosition,}struct BasketballTeam{point_guard: BasketballPlayer,shooting_guard: BasketballPlayer,center: BasketballPlayer,power_forward: BasketballPlayer,small_forward: BasketballPlayer,}implIndex\u0026lt;BasketballPosition\u0026gt;forBasketballTeam{type Output=BasketballPlayer;fn index(\u0026amp;self,position: BasketballPosition)-\u0026gt; \u0026amp;BasketballPlayer{matchposition{BasketballPosition::PointGuard=\u0026gt;\u0026amp;self.point_guard,BasketballPosition::ShootingGuard=\u0026gt;\u0026amp;self.shooting_guard,BasketballPosition::Center=\u0026gt;\u0026amp;self.center,BasketballPosition::PowerForward=\u0026gt;\u0026amp;self.power_forward,BasketballPosition::SmallForward=\u0026gt;\u0026amp;self.small_forward,}}}Drop é¢„å¤‡çŸ¥è¯†\n Self Methods  traitDrop{fn drop(\u0026amp;mutself);}å¦‚æœä¸€ä¸ªç±»å‹å®ç°äº† Dropï¼Œé‚£ä¹ˆå½“å®ƒè¶…å‡ºä½œç”¨åŸŸä½†åœ¨è¢«é”€æ¯ä¹‹å‰ï¼Œdrop å°†åœ¨è¯¥ç±»å‹ä¸Šè°ƒç”¨ã€‚æˆ‘ä»¬å¾ˆå°‘éœ€è¦ä¸ºæˆ‘ä»¬çš„ç±»å‹å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œä½†æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯ï¼Œå¦‚æœä¸€ä¸ªç±»å‹æŒæœ‰ä¸€äº›å¤–éƒ¨èµ„æºï¼Œå½“ç±»å‹è¢«é”€æ¯æ—¶ï¼Œè¿™äº›èµ„æºéœ€è¦è¢«æ¸…ç†æ‰ã€‚\nåœ¨æ ‡å‡†åº“ä¸­æœ‰ä¸€ä¸ª BufWriter ç±»å‹ï¼Œå…è®¸æˆ‘ä»¬å¯¹ Write ç±»å‹è¿›è¡Œç¼“å†²å†™å…¥ã€‚ç„¶è€Œï¼Œå¦‚æœ BufWriter åœ¨å…¶ç¼“å†²åŒºçš„å†…å®¹è¢«åˆ·æ–°åˆ°åº•å±‚çš„ Write ç±»å‹ä¹‹å‰å°±è¢«é”€æ¯äº†å‘¢ï¼Ÿå¹¸å¥½è¿™æ˜¯ä¸å¯èƒ½çš„! BufWriter å®ç°äº† Drop traitï¼Œæ‰€ä»¥æ¯å½“å®ƒç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼Œflush æ€»æ˜¯è¢«è°ƒç”¨ã€‚\nimpl\u0026lt;W: Write\u0026gt;DropforBufWriter\u0026lt;W\u0026gt;{fn drop(\u0026amp;mutself){self.flush_buf();}}å¦å¤–ï¼ŒRust ä¸­çš„ Mutex æ²¡æœ‰ unlock() æ–¹æ³•ï¼Œå› ä¸ºå®ƒä»¬ä¸éœ€è¦è¿™äº›æ–¹æ³•ã€‚åœ¨ä¸€ä¸ª Mutex ä¸Šè°ƒç”¨ lock() ä¼šè¿”å›ä¸€ä¸ª MutexGuardï¼Œå½“ Mutex è¶…å‡ºä½œç”¨åŸŸæ—¶ï¼Œç”±äºå®ƒçš„ Drop å®ç°ï¼Œå®ƒä¼šè‡ªåŠ¨è§£é”ã€‚\nimpl\u0026lt;T: ?Sized\u0026gt;DropforMutexGuard\u0026lt;\u0026#39;_,T\u0026gt;{fn drop(\u0026amp;mutself){unsafe{self.lock.inner.raw_unlock();}}}ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœä½ åœ¨æŸäº›èµ„æºä¸Šå®ç°ä¸€ä¸ªæŠ½è±¡ï¼Œåœ¨ä½¿ç”¨åéœ€è¦æ¸…ç†ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯ä½¿ç”¨ Drop trait çš„ä¸€ä¸ªå¾ˆå¥½çš„ç†ç”±ã€‚\nè½¬æ¢ Traits From \u0026amp; Into é¢„å¤‡çŸ¥è¯†\n Self Functions Methods Generic Parameters Generic Blanket Impls  traitFrom\u0026lt;T\u0026gt;{fn from(T)-\u0026gt; Self;}From\u0026lt;T\u0026gt; ç±»å‹å…è®¸æˆ‘ä»¬å°† T è½¬æ¢ä¸º Selfã€‚\ntraitInto\u0026lt;T\u0026gt;{fn into(self)-\u0026gt; T;}Into\u0026lt;T\u0026gt; ç±»å‹å…è®¸æˆ‘ä»¬å°† Self è½¬æ¢ä¸º Tã€‚\nè¿™äº› trait æ˜¯ä¸€ä¸ªç¡¬å¸çš„ä¸¤ä¸ªä¸åŒä¾§é¢ã€‚æˆ‘ä»¬åªèƒ½ä¸ºæˆ‘ä»¬çš„ç±»å‹å®ç° From\u0026lt;T\u0026gt;ï¼Œå› ä¸º Into\u0026lt;T\u0026gt; çš„å®ç°æ˜¯ç”±ä¸‹é¢è¿™ä¸ªæ³›å‹å…¨é¢å®ç°è‡ªåŠ¨æä¾›çš„ã€‚\nimpl\u0026lt;T,U\u0026gt;Into\u0026lt;U\u0026gt;forTwhereU: From\u0026lt;T\u0026gt;,{fn into(self)-\u0026gt; U{U::from(self)}}è¿™ä¸¤ä¸ª trait å­˜åœ¨çš„åŸå› æ˜¯ï¼Œå®ƒå…è®¸æˆ‘ä»¬ä»¥ç¨å¾®ä¸åŒçš„æ–¹å¼åœ¨æ³›å‹ç±»å‹ä¸Šç¼–å†™ trait çº¦æŸ(trait bound)ã€‚\nfn function\u0026lt;T\u0026gt;(t: T)where// these bounds are equivalent T: From\u0026lt;i32\u0026gt;,i32: Into\u0026lt;T\u0026gt;{// these examples are equivalent letexample: T=T::from(0);letexample: T=0.into();}å…³äºä½•æ—¶ä½¿ç”¨è¿™ä¸¤ç§æ–¹æ³•å¹¶æ²¡æœ‰ç¡¬æ€§è§„å®šï¼Œæ‰€ä»¥åœ¨æ¯ç§æƒ…å†µä¸‹éƒ½è¦é€‰æ‹©æœ€åˆç†çš„æ–¹æ³•ã€‚ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ä¸€äº›å…³äº Point çš„ä¾‹å­ã€‚\nstruct Point{x: i32,y: i32,}implFrom\u0026lt;(i32,i32)\u0026gt;forPoint{fn from((x,y): (i32,i32))-\u0026gt; Self{Point{x,y}}}implFrom\u0026lt;[i32;2]\u0026gt;forPoint{fn from([x,y]: [i32;2])-\u0026gt; Self{Point{x,y}}}fn example(){// using From letorigin=Point::from((0,0));letorigin=Point::from([0,0]);// using Into letorigin: Point=(0,0).into();letorigin: Point=[0,0].into();}å®ç°ä¸æ˜¯å¯¹ç§°çš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³æŠŠ Point è½¬æ¢æˆå…ƒç»„å’Œæ•°ç»„ï¼Œæˆ‘ä»¬ä¹Ÿå¿…é¡»æ˜¾ç¤ºåœ°åœ°æ·»åŠ è¿™äº›ã€‚\nstruct Point{x: i32,y: i32,}implFrom\u0026lt;(i32,i32)\u0026gt;forPoint{fn from((x,y): (i32,i32))-\u0026gt; Self{Point{x,y}}}implFrom\u0026lt;Point\u0026gt;for(i32,i32){fn from(Point{x,y}: Point)-\u0026gt; Self{(x,y)}}implFrom\u0026lt;[i32;2]\u0026gt;forPoint{fn from([x,y]: [i32;2])-\u0026gt; Self{Point{x,y}}}implFrom\u0026lt;Point\u0026gt;for[i32;2]{fn from(Point{x,y}: Point)-\u0026gt; Self{[x,y]}}fn example(){// from (i32, i32) into Point letpoint=Point::from((0,0));letpoint: Point=(0,0).into();// from Point into (i32, i32) lettuple=\u0026lt;(i32,i32)\u0026gt;::from(point);lettuple: (i32,i32)=point.into();// from [i32; 2] into Point letpoint=Point::from([0,0]);letpoint: Point=[0,0].into();// from Point into [i32; 2] letarray=\u0026lt;[i32;2]\u0026gt;::from(point);letarray: [i32;2]=point.into();}From\u0026lt;T\u0026gt; çš„ä¸€ä¸ªæ™®éç”¨é€”æ˜¯ç¼©å‡æ¨¡æ¿ä»£ç ã€‚å‡è®¾æˆ‘ä»¬åœ¨ç¨‹åºä¸­åŠ å…¥ä¸€ä¸ªåŒ…å«ä¸‰ä¸ª Point çš„ Triangle ç±»å‹ï¼Œè¿™é‡Œæœ‰è®¸å¤šæ–¹æ³•å¯ä»¥æ„å»ºå®ƒã€‚\nstruct Point{x: i32,y: i32,}implPoint{fn new(x: i32,y: i32)-\u0026gt; Point{Point{x,y}}}implFrom\u0026lt;(i32,i32)\u0026gt;forPoint{fn from((x,y): (i32,i32))-\u0026gt; Point{Point{x,y}}}struct Triangle{p1: Point,p2: Point,p3: Point,}implTriangle{fn new(p1: Point,p2: Point,p3: Point)-\u0026gt; Triangle{Triangle{p1,p2,p3}}}impl\u0026lt;P\u0026gt;From\u0026lt;[P;3]\u0026gt;forTrianglewhereP: Into\u0026lt;Point\u0026gt;{fn from([p1,p2,p3]: [P;3])-\u0026gt; Triangle{Triangle{p1: p1.into(),p2: p2.into(),p3: p3.into(),}}}fn example(){// manual construction lettriangle=Triangle{p1: Point{x: 0,y: 0,},p2: Point{x: 1,y: 1,},p3: Point{x: 2,y: 2,},};// using Point::new lettriangle=Triangle{p1: Point::new(0,0),p2: Point::new(1,1),p3: Point::new(2,2),};// using From\u0026lt;(i32, i32)\u0026gt; for Point lettriangle=Triangle{p1: (0,0).into(),p2: (1,1).into(),p3: (2,2).into(),};// using Triangle::new + From\u0026lt;(i32, i32)\u0026gt; for Point lettriangle=Triangle::new((0,0).into(),(1,1).into(),(2,2).into(),);// using From\u0026lt;[Into\u0026lt;Point\u0026gt;; 3]\u0026gt; for Triangle lettriangle: Triangle=[(0,0),(1,1),(2,2),].into();}å¯¹äºä½•æ—¶ã€å¦‚ä½•æˆ–ä¸ºä»€ä¹ˆæˆ‘ä»¬åº”è¯¥ä¸ºæˆ‘ä»¬çš„ç±»å‹å®ç° From\u0026lt;T\u0026gt;ï¼Œæ²¡æœ‰ä»»ä½•è§„åˆ™ï¼Œæ‰€ä»¥è¿™å–å†³äºæˆ‘ä»¬å¯¹æ¯ç§æƒ…å†µçš„æœ€ä½³åˆ¤æ–­ã€‚\nInto\u0026lt;T\u0026gt; çš„ä¸€ä¸ªæµè¡Œç”¨æ³•æ˜¯ä½¿éœ€è¦è‡ªæœ‰å€¼(owned values)çš„å‡½æ•°åœ¨æ¥å—è‡ªæœ‰å€¼æˆ–å€Ÿç”¨å€¼æ—¶å…·æœ‰é€šç”¨æ€§ã€‚\nstruct Person{name: String,}implPerson{// accepts: // - String fn new1(name: String)-\u0026gt; Person{Person{name}}// accepts: // - String // - \u0026amp;String // - \u0026amp;str // - Box\u0026lt;str\u0026gt; // - Cow\u0026lt;\u0026#39;_, str\u0026gt; // - char // since all of the above types can be converted into String fn new2\u0026lt;N: Into\u0026lt;String\u0026gt;\u0026gt;(name: N)-\u0026gt; Person{Person{name: name.into()}}}é”™è¯¯å¤„ç† è°ˆè®ºé”™è¯¯å¤„ç†å’Œ Error trait çš„æœ€ä½³æ—¶æœºæ˜¯åœ¨è®¨è®ºå®Œ Displayã€Debugã€Any å’Œ From ä¹‹åï¼Œåœ¨è®¨è®º TryFrom ä¹‹å‰ï¼Œå› æ­¤é”™è¯¯å¤„ç†éƒ¨åˆ†ä¸è½¬æ¢ trait éƒ¨åˆ†å°´å°¬åœ°ä¸€åˆ†ä¸ºäºŒã€‚\nError é¢„å¤‡çŸ¥è¯†\n Self Methods Default Impls Generic Blanket Impls Subtraits \u0026amp; Supertraits Trait Objects Display \u0026amp; ToString Debug Any From \u0026amp; Into  traitError: Debug+Display{// provided default impls fn source(\u0026amp;self)-\u0026gt; Option\u0026lt;\u0026amp;(dynError+\u0026#39;static)\u0026gt;;fn backtrace(\u0026amp;self)-\u0026gt; Option\u0026lt;\u0026amp;Backtrace\u0026gt;;fn description(\u0026amp;self)-\u0026gt; \u0026amp;str;fn cause(\u0026amp;self)-\u0026gt; Option\u0026lt;\u0026amp;dynError\u0026gt;;}åœ¨ Rust ä¸­ï¼Œé”™è¯¯è¢«è¿”å›ï¼Œè€Œä¸æ˜¯è¢«æŠ›å‡ºã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€äº›ä¾‹å­ã€‚\nç”±äºæ•´æ•°ç±»å‹é™¤ä»¥0ä¼šå¼•èµ· panicï¼Œå¦‚æœæˆ‘ä»¬æƒ³è®©æˆ‘ä»¬çš„ç¨‹åºæ›´å®‰å…¨ã€æ›´æ˜ç¡®ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ª safe_div å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ª Resultï¼Œå°±åƒè¿™æ ·ã€‚\nusestd::fmt;usestd::error;#[derive(Debug, PartialEq)]struct DivByZero;implfmt::DisplayforDivByZero{fn fmt(\u0026amp;self,f: \u0026amp;mutfmt::Formatter\u0026lt;\u0026#39;_\u0026gt;)-\u0026gt; fmt::Result{write!(f,\u0026#34;division by zero error\u0026#34;)}}implerror::ErrorforDivByZero{}fn safe_div(numerator: i32,denominator: i32)-\u0026gt; Result\u0026lt;i32,DivByZero\u0026gt;{ifdenominator==0{returnErr(DivByZero);}Ok(numerator/denominator)}#[test]// âœ… fn test_safe_div(){assert_eq!(safe_div(8,2),Ok(4));assert_eq!(safe_div(5,0),Err(DivByZero));}ç”±äºé”™è¯¯æ˜¯è¿”å›çš„ï¼Œè€Œä¸æ˜¯æŠ›å‡ºçš„ï¼Œæ‰€ä»¥å¿…é¡»æ˜¾å¼å¤„ç†ï¼Œå¦‚æœå½“å‰å‡½æ•°ä¸èƒ½å¤„ç†ä¸€ä¸ªé”™è¯¯ï¼Œå®ƒåº”è¯¥å°†å…¶ä¼ æ’­ç»™è°ƒç”¨è€…ã€‚ä¼ æ’­é”™è¯¯çš„æœ€ä¹ æƒ¯çš„æ–¹æ³•æ˜¯ä½¿ç”¨ ? æ“ä½œç¬¦ï¼Œå®ƒåªæ˜¯ç°åœ¨è¢«åºŸå¼ƒçš„ try! å®çš„è¯­æ³•ç³–ï¼Œå®ƒåªæ˜¯åšè¿™ä¸ªã€‚\nmacro_rules!try{($expr:expr)=\u0026gt;{match$expr{// if Ok just unwrap the value Ok(val)=\u0026gt;val,// if Err map the err value using From and return Err(err)=\u0026gt;{returnErr(From::from(err));}}};}å¦‚æœæˆ‘ä»¬æƒ³å†™ä¸€ä¸ªå°†æ–‡ä»¶è¯»æˆ String çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼Œç”¨ ? å°† io::Error ä¼ æ’­åˆ°å®ƒä»¬å¯èƒ½å‡ºç°çš„ä»»ä½•åœ°æ–¹ã€‚\nusestd::io::Read;usestd::path::Path;usestd::io;usestd::fs::File;fn read_file_to_string(path: \u0026amp;Path)-\u0026gt; Result\u0026lt;String,io::Error\u0026gt;{letmutfile=File::open(path)?;// â¬†ï¸ io::Error letmutcontents=String::new();file.read_to_string(\u0026amp;mutcontents)?;// â¬†ï¸ io::Error Ok(contents)}ä½†æ˜¯ï¼Œå‡è®¾æˆ‘ä»¬æ­£åœ¨è¯»å–çš„æ–‡ä»¶å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ•°å­—åˆ—è¡¨ï¼Œæˆ‘ä»¬æƒ³æŠŠå®ƒä»¬åŠ åœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬ä¼šåƒè¿™æ ·æ›´æ–°æˆ‘ä»¬çš„å‡½æ•°ã€‚\nusestd::io::Read;usestd::path::Path;usestd::io;usestd::fs::File;fn sum_file(path: \u0026amp;Path)-\u0026gt; Result\u0026lt;i32,/* What to put here? */\u0026gt;{letmutfile=File::open(path)?;// â¬†ï¸ io::Error letmutcontents=String::new();file.read_to_string(\u0026amp;mutcontents)?;// â¬†ï¸ io::Error letmutsum=0;forlineincontents.lines(){sum+=line.parse::\u0026lt;i32\u0026gt;()?;// â¬†ï¸ ParseIntError }Ok(sum)}ä½†æ˜¯ç°åœ¨æˆ‘ä»¬çš„ Result çš„é”™è¯¯ç±»å‹æ˜¯ä»€ä¹ˆï¼Ÿå®ƒå¯ä»¥è¿”å›ä¸€ä¸ª io::Error æˆ–è€…ä¸€ä¸ª ParseIntErrorã€‚æˆ‘ä»¬å°†çœ‹ä¸€ä¸‹è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸‰ç§æ–¹æ³•ï¼Œä»ä¸´æ—¶åº”æ€¥çš„æ–¹æ³•å¼€å§‹ï¼Œæœ€åæ˜¯æœ€ç¨³å¥çš„æ–¹æ³•ã€‚\nç¬¬ä¸€ç§æ–¹æ³•æ˜¯è®¤è¯†åˆ°æ‰€æœ‰å®ç°äº† Error çš„ç±»å‹ä¹Ÿå®ç°äº† Displayï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰çš„é”™è¯¯æ˜ å°„åˆ° Stringï¼Œå¹¶ä½¿ç”¨ String ä½œä¸ºæˆ‘ä»¬çš„é”™è¯¯ç±»å‹ã€‚\nusestd::fs::File;usestd::io;usestd::io::Read;usestd::path::Path;fn sum_file(path: \u0026amp;Path)-\u0026gt; Result\u0026lt;i32,String\u0026gt;{letmutfile=File::open(path).map_err(|e|e.to_string())?;// â¬†ï¸ io::Error -\u0026gt; String letmutcontents=String::new();file.read_to_string(\u0026amp;mutcontents).map_err(|e|e.to_string())?;// â¬†ï¸ io::Error -\u0026gt; String letmutsum=0;forlineincontents.lines(){sum+=line.parse::\u0026lt;i32\u0026gt;().map_err(|e|e.to_string())?;// â¬†ï¸ ParseIntError -\u0026gt; String }Ok(sum)}å¯¹æ¯ä¸ªé”™è¯¯è¿›è¡Œå­—ç¬¦ä¸²åŒ–å¤„ç†çš„æ˜æ˜¾ç¼ºç‚¹æ˜¯ï¼Œæˆ‘ä»¬ä¸¢å¼ƒäº†ç±»å‹ä¿¡æ¯ï¼Œè¿™ä½¿å¾—è°ƒç”¨è€…æ›´éš¾å¤„ç†é”™è¯¯ã€‚\nä¸Šè¿°æ–¹æ³•çš„ä¸€ä¸ªéæ˜¾è€Œæ˜“è§çš„å¥½å¤„æ˜¯æˆ‘ä»¬å¯ä»¥å®šåˆ¶å­—ç¬¦ä¸²ä»¥æä¾›æ›´å¤šçš„ç‰¹å®šç¯å¢ƒä¿¡æ¯ã€‚ä¾‹å¦‚ï¼ŒParseIntError é€šå¸¸å­—ç¬¦ä¸²åŒ–ä¸º \u0026ldquo;invalid digit found in string\u0026rdquo;ï¼Œè¿™æ˜¯éå¸¸æ¨¡ç³Šçš„ï¼Œæ²¡æœ‰æåˆ°æ— æ•ˆçš„å­—ç¬¦ä¸²æ˜¯ä»€ä¹ˆæˆ–è€…å®ƒè¯•å›¾è§£ææˆä»€ä¹ˆæ•´æ•°ç±»å‹ã€‚å¦‚æœæˆ‘ä»¬è¦è°ƒè¯•è¿™ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªé”™è¯¯ä¿¡æ¯å‡ ä¹æ˜¯æ— ç”¨çš„ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå·±æä¾›æ‰€æœ‰ä¸ä¸Šä¸‹æ–‡ç›¸å…³çš„ä¿¡æ¯æ¥ä½¿å…¶æ˜æ˜¾æ”¹å–„ã€‚\nsum+=line.parse::\u0026lt;i32\u0026gt;().map_err(|_|format!(\u0026#34;failed to parse {} into i32\u0026#34;,line))?;ç¬¬äºŒç§æ–¹æ³•æ˜¯åˆ©ç”¨æ ‡å‡†åº“ä¸­çš„è¿™ç§æ³›å‹å…¨é¢å®ç°ã€‚\nimpl\u0026lt;E: error::Error\u0026gt;From\u0026lt;E\u0026gt;forBox\u0026lt;dynerror::Error\u0026gt;;è¿™æ„å‘³ç€ä»»ä½• Error ç±»å‹éƒ½å¯ä»¥é€šè¿‡ ? è¿ç®—ç¬¦éšå¼åœ°è½¬æ¢ä¸º Box\u0026lt;dyn error::Error\u0026gt;ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•äº§ç”Ÿé”™è¯¯çš„å‡½æ•°çš„ Result è¿”å›ç±»å‹ä¸­æŠŠé”™è¯¯ç±»å‹è®¾ç½®ä¸º Box\u0026lt;dyn error::Error\u0026gt;ï¼Œ? è¿ç®—ç¬¦å°†ä¸ºæˆ‘ä»¬å®Œæˆå…¶ä½™çš„å·¥ä½œã€‚\nusestd::fs::File;usestd::io::Read;usestd::path::Path;usestd::error;fn sum_file(path: \u0026amp;Path)-\u0026gt; Result\u0026lt;i32,Box\u0026lt;dynerror::Error\u0026gt;\u0026gt;{letmutfile=File::open(path)?;// â¬†ï¸ io::Error -\u0026gt; Box\u0026lt;dyn error::Error\u0026gt; letmutcontents=String::new();file.read_to_string(\u0026amp;mutcontents)?;// â¬†ï¸ io::Error -\u0026gt; Box\u0026lt;dyn error::Error\u0026gt; letmutsum=0;forlineincontents.lines(){sum+=line.parse::\u0026lt;i32\u0026gt;()?;// â¬†ï¸ ParseIntError -\u0026gt; Box\u0026lt;dyn error::Error\u0026gt; }Ok(sum)}è™½ç„¶æ›´åŠ ç®€æ´ï¼Œä½†è¿™ä¼¼ä¹ä¸ä¹‹å‰çš„æ–¹æ³•æœ‰ç›¸åŒçš„ç¼ºç‚¹ï¼Œå³ä¸¢å¼ƒäº†ç±»å‹ä¿¡æ¯ã€‚è¿™å¤§éƒ¨åˆ†æ˜¯çœŸçš„ï¼Œä½†æ˜¯å¦‚æœè°ƒç”¨è€…çŸ¥é“æˆ‘ä»¬å‡½æ•°çš„å®ç°ç»†èŠ‚ï¼Œä»–ä»¬ä»ç„¶å¯ä»¥ä½¿ç”¨ error::Error ä¸Šçš„ downcast_ref() æ–¹æ³•æ¥å¤„ç†ä¸åŒçš„é”™è¯¯ç±»å‹ï¼Œè¿™å’Œå®ƒåœ¨ dyn Any ç±»å‹ä¸Šçš„ä½œç”¨æ˜¯ä¸€æ ·çš„ã€‚\nfn handle_sum_file_errors(path: \u0026amp;Path){matchsum_file(path){Ok(sum)=\u0026gt;println!(\u0026#34;the sum is {}\u0026#34;,sum),Err(err)=\u0026gt;{ifletSome(e)=err.downcast_ref::\u0026lt;io::Error\u0026gt;(){// handle io::Error }elseifletSome(e)=err.downcast_ref::\u0026lt;ParseIntError\u0026gt;(){// handle ParseIntError }else{// we know sum_file can only return one of the // above errors so this branch is unreachable unreachable!();}}}}ç¬¬ä¸‰ç§æ–¹æ³•æ˜¯æœ€ç¨³å¥å’Œç±»å‹å®‰å…¨çš„æ–¹æ³•ï¼Œå¯ä»¥èšåˆè¿™äº›ä¸åŒçš„é”™è¯¯ï¼Œæ˜¯ä½¿ç”¨ä¸€ä¸ªæšä¸¾å»ºç«‹æˆ‘ä»¬è‡ªå·±çš„è‡ªå®šä¹‰é”™è¯¯ç±»å‹ã€‚\nusestd::num::ParseIntError;usestd::fs::File;usestd::io;usestd::io::Read;usestd::path::Path;usestd::error;usestd::fmt;#[derive(Debug)]enum SumFileError{Io(io::Error),Parse(ParseIntError),}implFrom\u0026lt;io::Error\u0026gt;forSumFileError{fn from(err: io::Error)-\u0026gt; Self{SumFileError::Io(err)}}implFrom\u0026lt;ParseIntError\u0026gt;forSumFileError{fn from(err: ParseIntError)-\u0026gt; Self{SumFileError::Parse(err)}}implfmt::DisplayforSumFileError{fn fmt(\u0026amp;self,f: \u0026amp;mutfmt::Formatter\u0026lt;\u0026#39;_\u0026gt;)-\u0026gt; fmt::Result{matchself{SumFileError::Io(err)=\u0026gt;write!(f,\u0026#34;sum file error: {}\u0026#34;,err),SumFileError::Parse(err)=\u0026gt;write!(f,\u0026#34;sum file error: {}\u0026#34;,err),}}}implerror::ErrorforSumFileError{// the default impl for this method always returns None // but we can now override it to make it way more useful! fn source(\u0026amp;self)-\u0026gt; Option\u0026lt;\u0026amp;(dynerror::Error+\u0026#39;static)\u0026gt;{Some(matchself{SumFileError::Io(err)=\u0026gt;err,SumFileError::Parse(err)=\u0026gt;err,})}}fn sum_file(path: \u0026amp;Path)-\u0026gt; Result\u0026lt;i32,SumFileError\u0026gt;{letmutfile=File::open(path)?;// â¬†ï¸ io::Error -\u0026gt; SumFileError letmutcontents=String::new();file.read_to_string(\u0026amp;mutcontents)?;// â¬†ï¸ io::Error -\u0026gt; SumFileError letmutsum=0;forlineincontents.lines(){sum+=line.parse::\u0026lt;i32\u0026gt;()?;// â¬†ï¸ ParseIntError -\u0026gt; SumFileError }Ok(sum)}fn handle_sum_file_errors(path: \u0026amp;Path){matchsum_file(path){Ok(sum)=\u0026gt;println!(\u0026#34;the sum is {}\u0026#34;,sum),Err(SumFileError::Io(err))=\u0026gt;{// handle io::Error },Err(SumFileError::Parse(err))=\u0026gt;{// handle ParseIntError },}}Conversion Traits Continued TryFrom \u0026amp; TryInto é¢„å¤‡çŸ¥è¯†\n Self Functions Methods Associated Types Generic Parameters Generic Types vs Associated Types Generic Blanket Impls From \u0026amp; Into Error  TryFrom and TryInto are the versions of From and Into. TryFrom å’Œ TryInto æ˜¯ From å’Œ Into çš„ä¸å¯é ç‰ˆæœ¬ã€‚\ntraitTryFrom\u0026lt;T\u0026gt;{type Error;fn try_from(value: T)-\u0026gt; Result\u0026lt;Self,Self::Error\u0026gt;;}traitTryInto\u0026lt;T\u0026gt;{type Error;fn try_into(self)-\u0026gt; Result\u0026lt;T,Self::Error\u0026gt;;}Similarly to Into we cannot impl TryInto because its impl is provided by this generic blanket impl: ä¸ Into ç±»ä¼¼ï¼Œæˆ‘ä»¬ä¸èƒ½å®ç° TryIntoï¼Œå› ä¸ºå®ƒçš„å®ç°æ˜¯ç”±ä¸‹é¢è¿™ä¸ªæ³›å‹å…¨é¢å®ç°æä¾›çš„ã€‚\nimpl\u0026lt;T,U\u0026gt;TryInto\u0026lt;U\u0026gt;forTwhereU: TryFrom\u0026lt;T\u0026gt;,{type Error=U::Error;fn try_into(self)-\u0026gt; Result\u0026lt;U,U::Error\u0026gt;{U::try_from(self)}}Let\u0026rsquo;s say that in the context of our program it doesn\u0026rsquo;t make sense for Points to have x and y values that are less than -1000 or greater than 1000. This is how we\u0026rsquo;d rewrite our earlier From impls using TryFrom to signal to the users of our type that this conversion can now fail: å‡è®¾åœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­ï¼ŒPoint çš„ x å’Œ y çš„å€¼å°äº -1000 æˆ–å¤§äº 1000 æ˜¯ä¸åˆç†çš„ã€‚è¿™å°±æ˜¯æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨ TryFrom é‡å†™æˆ‘ä»¬å…ˆå‰çš„ From å®ç°ï¼Œå‘æˆ‘ä»¬ç±»å‹çš„ç”¨æˆ·å‘å‡ºä¿¡å·ï¼Œè¿™ä¸ªè½¬æ¢ç°åœ¨å¯ä»¥å¤±è´¥ã€‚\nusestd::convert::TryFrom;usestd::error;usestd::fmt;struct Point{x: i32,y: i32,}#[derive(Debug)]struct OutOfBounds;implfmt::DisplayforOutOfBounds{fn fmt(\u0026amp;self,f: \u0026amp;mutfmt::Formatter\u0026lt;\u0026#39;_\u0026gt;)-\u0026gt; fmt::Result{write!(f,\u0026#34;out of bounds\u0026#34;)}}implerror::ErrorforOutOfBounds{}// now fallible implTryFrom\u0026lt;(i32,i32)\u0026gt;forPoint{type Error=OutOfBounds;fn try_from((x,y): (i32,i32))-\u0026gt; Result\u0026lt;Point,OutOfBounds\u0026gt;{ifx.abs()\u0026gt;1000||y.abs()\u0026gt;1000{returnErr(OutOfBounds);}Ok(Point{x,y})}}// still infallible implFrom\u0026lt;Point\u0026gt;for(i32,i32){fn from(Point{x,y}: Point)-\u0026gt; Self{(x,y)}}And here\u0026rsquo;s the refactored TryFrom\u0026lt;[TryInto\u0026lt;Point\u0026gt;; 3]\u0026gt; impl for Triangle: è¿™é‡Œæ˜¯é‡æ„åçš„ TryFrom\u0026lt;[TryInto\u0026lt;Point\u0026gt;; 3]\u0026gt; å®ç°ï¼Œç”¨äº Triangleã€‚\nusestd::convert::{TryFrom,TryInto};usestd::error;usestd::fmt;struct Point{x: i32,y: i32,}#[derive(Debug)]struct OutOfBounds;implfmt::DisplayforOutOfBounds{fn fmt(\u0026amp;self,f: \u0026amp;mutfmt::Formatter\u0026lt;\u0026#39;_\u0026gt;)-\u0026gt; fmt::Result{write!(f,\u0026#34;out of bounds\u0026#34;)}}implerror::ErrorforOutOfBounds{}implTryFrom\u0026lt;(i32,i32)\u0026gt;forPoint{type Error=OutOfBounds;fn try_from((x,y): (i32,i32))-\u0026gt; Result\u0026lt;Self,Self::Error\u0026gt;{ifx.abs()\u0026gt;1000||y.abs()\u0026gt;1000{returnErr(OutOfBounds);}Ok(Point{x,y})}}struct Triangle{p1: Point,p2: Point,p3: Point,}impl\u0026lt;P\u0026gt;TryFrom\u0026lt;[P;3]\u0026gt;forTrianglewhereP: TryInto\u0026lt;Point\u0026gt;,{type Error=P::Error;fn try_from([p1,p2,p3]: [P;3])-\u0026gt; Result\u0026lt;Self,Self::Error\u0026gt;{Ok(Triangle{p1: p1.try_into()?,p2: p2.try_into()?,p3: p3.try_into()?,})}}fn example()-\u0026gt; Result\u0026lt;Triangle,OutOfBounds\u0026gt;{lett: Triangle=[(0,0),(1,1),(2,2)].try_into()?;Ok(t)}FromStr é¢„å¤‡çŸ¥è¯†\n Self Functions Associated Types Error TryFrom \u0026amp; TryInto  traitFromStr{type Err;fn from_str(s: \u0026amp;str)-\u0026gt; Result\u0026lt;Self,Self::Err\u0026gt;;}FromStr types allow performing a fallible conversion from \u0026amp;str into Self. The idiomatic way to use FromStr is to call the .parse() method on \u0026amp;strs: FromStr ç±»å‹å…è®¸æ‰§è¡Œä» \u0026amp;str åˆ° Self çš„é”™è¯¯è½¬æ¢ã€‚ä½¿ç”¨ FromStr çš„ä¹ æƒ¯æ–¹æ³•æ˜¯å¯¹ \u0026amp;str è°ƒç”¨ .parse() æ–¹æ³•ã€‚\nusestd::str::FromStr;fn example\u0026lt;T: FromStr\u0026gt;(s: \u0026amp;\u0026#39;staticstr){// these are all equivalent lett: Result\u0026lt;T,_\u0026gt;=FromStr::from_str(s);lett=T::from_str(s);lett: Result\u0026lt;T,_\u0026gt;=s.parse();lett=s.parse::\u0026lt;T\u0026gt;();// most idiomatic }Point å®ç°çš„ä¾‹å­:\nusestd::error;usestd::fmt;usestd::iter::Enumerate;usestd::num::ParseIntError;usestd::str::{Chars,FromStr};#[derive(Debug, Eq, PartialEq)]struct Point{x: i32,y: i32,}implPoint{fn new(x: i32,y: i32)-\u0026gt; Self{Point{x,y}}}#[derive(Debug, PartialEq)]struct ParsePointError;implfmt::DisplayforParsePointError{fn fmt(\u0026amp;self,f: \u0026amp;mutfmt::Formatter\u0026lt;\u0026#39;_\u0026gt;)-\u0026gt; fmt::Result{write!(f,\u0026#34;failed to parse point\u0026#34;)}}implFrom\u0026lt;ParseIntError\u0026gt;forParsePointError{fn from(_e: ParseIntError)-\u0026gt; Self{ParsePointError}}implerror::ErrorforParsePointError{}implFromStrforPoint{type Err =ParsePointError;fn from_str(s: \u0026amp;str)-\u0026gt; Result\u0026lt;Self,Self::Err\u0026gt;{letis_num=|(_,c): \u0026amp;(usize,char)|matches!(c,\u0026#39;0\u0026#39;..=\u0026#39;9\u0026#39;|\u0026#39;-\u0026#39;);letisnt_num=|t: \u0026amp;(_,_)|!is_num(t);letget_num=|char_idxs: \u0026amp;mutEnumerate\u0026lt;Chars\u0026lt;\u0026#39;_\u0026gt;\u0026gt;|-\u0026gt; Result\u0026lt;(usize,usize),ParsePointError\u0026gt;{let(start,_)=char_idxs.skip_while(isnt_num).next().ok_or(ParsePointError)?;let(end,_)=char_idxs.skip_while(is_num).next().ok_or(ParsePointError)?;Ok((start,end))};letmutchar_idxs=s.chars().enumerate();let(x_start,x_end)=get_num(\u0026amp;mutchar_idxs)?;let(y_start,y_end)=get_num(\u0026amp;mutchar_idxs)?;letx=s[x_start..x_end].parse::\u0026lt;i32\u0026gt;()?;lety=s[y_start..y_end].parse::\u0026lt;i32\u0026gt;()?;Ok(Point{x,y})}}#[test]// âœ… fn pos_x_y(){letp=\u0026#34;(4, 5)\u0026#34;.parse::\u0026lt;Point\u0026gt;();assert_eq!(p,Ok(Point::new(4,5)));}#[test]// âœ… fn neg_x_y(){letp=\u0026#34;(-6, -2)\u0026#34;.parse::\u0026lt;Point\u0026gt;();assert_eq!(p,Ok(Point::new(-6,-2)));}#[test]// âœ… fn not_a_point(){letp=\u0026#34;not a point\u0026#34;.parse::\u0026lt;Point\u0026gt;();assert_eq!(p,Err(ParsePointError));}FromStr has the same signature as TryFrom\u0026lt;\u0026amp;str\u0026gt;. It doesn\u0026rsquo;t matter which one we impl for a type first as long as we forward the impl to the other one. Here\u0026rsquo;s a TryFrom\u0026lt;\u0026amp;str\u0026gt; impl for Point assuming it already has a FromStr impl: FromStr ä¸ TryFrom\u0026lt;\u0026amp;str\u0026gt; çš„ç­¾åç›¸åŒã€‚åªè¦æˆ‘ä»¬æŠŠå®ç°è½¬å‘ç»™å¦ä¸€ä¸ªç±»å‹ï¼Œå“ªä¸€ä¸ªå®ç°å¹¶ä¸é‡è¦ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªé’ˆå¯¹ Point çš„ TryFrom\u0026lt;\u0026amp;str\u0026gt; å®ç°ï¼Œå‡è®¾å®ƒå·²ç»æœ‰ä¸€ä¸ª FromStr å®ç°ã€‚\nimplTryFrom\u0026lt;\u0026amp;str\u0026gt;forPoint{type Error=\u0026lt;PointasFromStr\u0026gt;::Err;fn try_from(s: \u0026amp;str)-\u0026gt; Result\u0026lt;Point,Self::Error\u0026gt;{\u0026lt;PointasFromStr\u0026gt;::from_str(s)}}AsRef \u0026amp; AsMut é¢„å¤‡çŸ¥è¯†\n Self Methods Sized Generic Parameters Sized Deref \u0026amp; DerefMut  traitAsRef\u0026lt;T: ?Sized\u0026gt;{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;T;}traitAsMut\u0026lt;T: ?Sized\u0026gt;{fn as_mut(\u0026amp;mutself)-\u0026gt; \u0026amp;mutT;}?Sized è¯´æ˜ T ç±»å‹æ˜¯å¤§å°ä¸ç¡®å®šçš„ã€‚As ä½œä¸ºä»‹è¯, è¡¨æ˜å‘ç”Ÿäº†ç±»å‹è½¬æ¢ã€‚\nAsRef is for cheap reference to reference conversions. However, one of the most common ways it\u0026rsquo;s used is to make functions generic over whether they take ownership or not:\nAsRef æ˜¯ç”¨äºå»‰ä»·çš„å¼•ç”¨åˆ°å¼•ç”¨çš„è½¬æ¢ã€‚ç„¶è€Œï¼Œå®ƒæœ€å¸¸è§çš„ä½¿ç”¨æ–¹å¼ä¹‹ä¸€æ˜¯ä½¿å‡½æ•°åœ¨æ˜¯å¦æ‹¥æœ‰æ‰€æœ‰æƒä¸Šé€šç”¨ã€‚\n// accepts: // - \u0026amp;str // - \u0026amp;String fn takes_str(s: \u0026amp;str){// use \u0026amp;str }// accepts: // - \u0026amp;str // - \u0026amp;String // - String fn takes_asref_str\u0026lt;S: AsRef\u0026lt;str\u0026gt;\u0026gt;(s: S){lets: \u0026amp;str =s.as_ref();// use \u0026amp;str }fn example(slice: \u0026amp;str,borrow: \u0026amp;String,owned: String){takes_str(slice);takes_str(borrow);takes_str(owned);// âŒ takes_asref_str(slice);takes_asref_str(borrow);takes_asref_str(owned);// âœ… }The other most common use-case is returning a reference to inner private data wrapped by a type which protects some invariant. A good example from the standard library is String which is just a wrapper around Vec\u0026lt;u8\u0026gt;:\nå¦ä¸€ä¸ªæœ€å¸¸è§çš„ç”¨ä¾‹æ˜¯è¿”å›ä¸€ä¸ªå¯¹å†…éƒ¨ç§æœ‰æ•°æ®çš„å¼•ç”¨ï¼Œè¯¥æ•°æ®ç”±ä¸€ä¸ªä¿æŠ¤æŸäº›ä¸å˜æ€§çš„ç±»å‹åŒ…è£¹ã€‚æ ‡å‡†åº“ä¸­çš„ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯ Stringï¼Œå®ƒåªæ˜¯ Vec\u0026lt;u8\u0026gt; çš„ä¸€ä¸ªåŒ…è£…å™¨ã€‚\nstruct String {vec: Vec\u0026lt;u8\u0026gt;,}This inner Vec cannot be made public because if it was people could mutate any byte and break the String\u0026rsquo;s valid UTF-8 encoding. However, it\u0026rsquo;s safe to expose an immutable read-only reference to the inner byte array, hence this impl: è¿™ä¸ªå†…éƒ¨çš„ Vec ä¸èƒ½è¢«å…¬å¼€ï¼Œå› ä¸ºå¦‚æœå®ƒè¢«å…¬å¼€ï¼Œäººä»¬å¯ä»¥æ”¹å˜ä»»ä½•å­—èŠ‚å¹¶ç ´å String çš„æœ‰æ•ˆ UTF-8 ç¼–ç ã€‚ç„¶è€Œï¼Œå…¬å¼€å†…éƒ¨å­—èŠ‚æ•°ç»„çš„ä¸å¯å˜çš„åªè¯»å¼•ç”¨æ˜¯å®‰å…¨çš„ï¼Œå› æ­¤æœ‰äº†è¿™ä¸ªå®ç°:\nimplAsRef\u0026lt;[u8]\u0026gt;forString;Generally, it often only makes sense to impl AsRef for a type if it wraps some other type to either provide additional functionality around the inner type or protect some invariant on the inner type.\nLet\u0026rsquo;s examine a example of bad AsRef impls: ä¸€èˆ¬æ¥è¯´ï¼Œåªæœ‰å½“ä¸€ä¸ªç±»å‹åŒ…è£…äº†å…¶ä»–ç±»å‹ï¼Œä¸ºå†…éƒ¨ç±»å‹æä¾›äº†é¢å¤–çš„åŠŸèƒ½ï¼Œæˆ–è€…ä¿æŠ¤äº†å†…éƒ¨ç±»å‹çš„æŸäº›ä¸å˜æ€§æ—¶ï¼Œä¸ºå…¶å®ç° AsRef æ‰æœ‰æ„ä¹‰ã€‚\nè®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€ä¸ªä¸å¥½çš„ AsRef å®ç°çš„ä¾‹å­ã€‚\nstruct User{name: String,age: u32,}implAsRef\u0026lt;String\u0026gt;forUser{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;String {\u0026amp;self.name}}implAsRef\u0026lt;u32\u0026gt;forUser{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;u32 {\u0026amp;self.age}}This works and kinda makes sense at first, but quickly falls apart if we add more members to User: è¿™åœ¨ä¸€å¼€å§‹æ˜¯å¯è¡Œçš„ï¼Œè€Œä¸”æœ‰ç‚¹é“ç†ï¼Œä½†å¦‚æœæˆ‘ä»¬ç»™ User å¢åŠ æ›´å¤šçš„æˆå‘˜ï¼Œå¾ˆå¿«å°±ä¼šå´©æºƒã€‚\nstruct User{name: String,email: String,age: u32,height: u32,}implAsRef\u0026lt;String\u0026gt;forUser{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;String {// uh, do we return name or email here? }}implAsRef\u0026lt;u32\u0026gt;forUser{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;u32 {// uh, do we return age or height here? }}A User is composed of Strings and u32s but it\u0026rsquo;s not really the same thing as a String or a u32. Even if we had much more specific types: User æ˜¯ç”± String å’Œ u32 ç»„æˆçš„ï¼Œä½†å®ƒå’Œ String æˆ– u32 å¹¶ä¸æ˜¯çœŸæ­£çš„ä¸€å›äº‹ã€‚å³ä½¿æˆ‘ä»¬æœ‰æ›´å…·ä½“çš„ç±»å‹ã€‚\nstruct User{name: Name,email: Email,age: Age,height: Height,}It wouldn\u0026rsquo;t make much sense to impl AsRef for any of those because AsRef is for cheap reference to reference conversions between semantically equivalent things, and Name, Email, Age, and Height by themselves are not the same thing as a User.\nA good example where we would impl AsRef would be if we introduced a new type Moderator that just wrapped a User and added some moderation specific privileges: å®ç° AsRef å¯¹è¿™äº›éƒ½æ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸º AsRef æ˜¯ç”¨æ¥åœ¨è¯­ä¹‰ä¸Šç­‰åŒçš„äº‹ç‰©ä¹‹é—´è¿›è¡Œå»‰ä»·çš„å¼•ç”¨è½¬æ¢ï¼Œè€Œ Nameã€Emailã€Age å’Œ Height æœ¬èº«å°±å’Œ User ä¸æ˜¯ä¸€å›äº‹ã€‚\nä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å¼•å…¥ä¸€ä¸ªæ–°çš„ç±»å‹ Moderatorï¼Œå®ƒåªæ˜¯åŒ…è£¹äº†ä¸€ä¸ª Userï¼Œå¹¶å¢åŠ äº†ä¸€äº›ç‰¹å®šçš„ç®¡ç†æƒé™ï¼Œæˆ‘ä»¬å°±ä¼šä½¿ç”¨ AsRefã€‚\nstruct User{name: String,age: u32,}// unfortunately the standard library cannot provide // a generic blanket impl to save us from this boilerplate implAsRef\u0026lt;User\u0026gt;forUser{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;User{self}}enum Privilege{BanUsers,EditPosts,DeletePosts,}// although Moderators have some special // privileges they are still regular Users // and should be able to do all the same stuff struct Moderator{user: User,privileges: Vec\u0026lt;Privilege\u0026gt;}implAsRef\u0026lt;Moderator\u0026gt;forModerator{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;Moderator{self}}implAsRef\u0026lt;User\u0026gt;forModerator{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;User{\u0026amp;self.user}}// this should be callable with Users // and Moderators (who are also Users) fn create_post\u0026lt;U: AsRef\u0026lt;User\u0026gt;\u0026gt;(u: U){letuser=u.as_ref();// etc }fn example(user: User,moderator: Moderator){create_post(\u0026amp;user);create_post(\u0026amp;moderator);// âœ… }This works because Moderators are just Users. Here\u0026rsquo;s the example from the Deref section except using AsRef instead: è¿™æ ·åšæ˜¯å› ä¸º Moderator å°±æ˜¯ Userã€‚ä¸‹é¢æ˜¯ Deref éƒ¨åˆ†çš„ä¾‹å­ï¼Œåªæ˜¯ç”¨ AsRef ä»£æ›¿ã€‚\nusestd::convert::AsRef;struct Human{health_points: u32,}implAsRef\u0026lt;Human\u0026gt;forHuman{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;Human{self}}enum Weapon{Spear,Axe,Sword,}// a Soldier is just a Human with a Weapon struct Soldier{human: Human,weapon: Weapon,}implAsRef\u0026lt;Soldier\u0026gt;forSoldier{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;Soldier{self}}implAsRef\u0026lt;Human\u0026gt;forSoldier{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;Human{\u0026amp;self.human}}enum Mount{Horse,Donkey,Cow,}// a Knight is just a Soldier with a Mount struct Knight{soldier: Soldier,mount: Mount,}implAsRef\u0026lt;Knight\u0026gt;forKnight{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;Knight{self}}implAsRef\u0026lt;Soldier\u0026gt;forKnight{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;Soldier{\u0026amp;self.soldier}}implAsRef\u0026lt;Human\u0026gt;forKnight{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;Human{\u0026amp;self.soldier.human}}enum Spell{MagicMissile,FireBolt,ThornWhip,}// a Mage is just a Human who can cast Spells struct Mage{human: Human,spells: Vec\u0026lt;Spell\u0026gt;,}implAsRef\u0026lt;Mage\u0026gt;forMage{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;Mage{self}}implAsRef\u0026lt;Human\u0026gt;forMage{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;Human{\u0026amp;self.human}}enum Staff{Wooden,Metallic,Plastic,}// a Wizard is just a Mage with a Staff struct Wizard{mage: Mage,staff: Staff,}implAsRef\u0026lt;Wizard\u0026gt;forWizard{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;Wizard{self}}implAsRef\u0026lt;Mage\u0026gt;forWizard{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;Mage{\u0026amp;self.mage}}implAsRef\u0026lt;Human\u0026gt;forWizard{fn as_ref(\u0026amp;self)-\u0026gt; \u0026amp;Human{\u0026amp;self.mage.human}}fn borrows_human\u0026lt;H: AsRef\u0026lt;Human\u0026gt;\u0026gt;(human: H){}fn borrows_soldier\u0026lt;S: AsRef\u0026lt;Soldier\u0026gt;\u0026gt;(soldier: S){}fn borrows_knight\u0026lt;K: AsRef\u0026lt;Knight\u0026gt;\u0026gt;(knight: K){}fn borrows_mage\u0026lt;M: AsRef\u0026lt;Mage\u0026gt;\u0026gt;(mage: M){}fn borrows_wizard\u0026lt;W: AsRef\u0026lt;Wizard\u0026gt;\u0026gt;(wizard: W){}fn example(human: Human,soldier: Soldier,knight: Knight,mage: Mage,wizard: Wizard){// all types can be used as Humans borrows_human(\u0026amp;human);borrows_human(\u0026amp;soldier);borrows_human(\u0026amp;knight);borrows_human(\u0026amp;mage);borrows_human(\u0026amp;wizard);// Knights can be used as Soldiers borrows_soldier(\u0026amp;soldier);borrows_soldier(\u0026amp;knight);// Wizards can be used as Mages borrows_mage(\u0026amp;mage);borrows_mage(\u0026amp;wizard);// Knights \u0026amp; Wizards passed as themselves borrows_knight(\u0026amp;knight);borrows_wizard(\u0026amp;wizard);}Deref didn\u0026rsquo;t work in the prior version of the example above because deref coercion is an implicit conversion between types which leaves room for people to mistakenly formulate the wrong ideas and expectations for how it will behave. AsRef works above because it makes the conversion between types explicit and there\u0026rsquo;s no room leftover to develop any wrong ideas or expectations. Deref åœ¨ä¸Šè¿°ä¾‹å­çš„å…ˆå‰ç‰ˆæœ¬ä¸­ä¸èµ·ä½œç”¨ï¼Œå› ä¸º deref coercion æ˜¯ä¸€ç§éšå¼ç±»å‹è½¬æ¢ï¼Œä¸ºäººä»¬é”™è¯¯åœ°åˆ¶å®šé”™è¯¯çš„æƒ³æ³•å’ŒæœŸæœ›ç•™ä¸‹äº†ç©ºé—´ã€‚AsRef åœ¨ä¸Šé¢èµ·ä½œç”¨ï¼Œå› ä¸ºå®ƒä½¿ç±»å‹é—´çš„è½¬æ¢å˜å¾—æ˜ç¡®ï¼Œæ²¡æœ‰ä½™åœ°æ¥å‘å±•ä»»ä½•é”™è¯¯çš„æƒ³æ³•æˆ–æœŸæœ›ã€‚\nBorrow \u0026amp; BorrowMut é¢„å¤‡çŸ¥è¯†\n Self Methods Generic Parameters Subtraits \u0026amp; Supertraits Sized AsRef \u0026amp; AsMut PartialEq \u0026amp; Eq Hash PartialOrd \u0026amp; Ord  traitBorrow\u0026lt;Borrowed\u0026gt;whereBorrowed: ?Sized,{fn borrow(\u0026amp;self)-\u0026gt; \u0026amp;Borrowed;}traitBorrowMut\u0026lt;Borrowed\u0026gt;: Borrow\u0026lt;Borrowed\u0026gt;whereBorrowed: ?Sized,{fn borrow_mut(\u0026amp;mutself)-\u0026gt; \u0026amp;mutBorrowed;}These traits were invented to solve the very specific problem of looking up String keys in HashSets, HashMaps, BTreeSets, and BTreeMaps using \u0026amp;str values.\nWe can view Borrow\u0026lt;T\u0026gt; and BorrowMut\u0026lt;T\u0026gt; as stricter versions of AsRef\u0026lt;T\u0026gt; and AsMut\u0026lt;T\u0026gt;, where the returned reference \u0026amp;T has equivalent Eq, Hash, and Ord impls to Self. This is more easily explained with a commented example: è¿™äº› trait çš„å‘æ˜æ˜¯ä¸ºäº†è§£å†³åœ¨ HashSet, HashMap, BTreeSet, å’Œ BTreeMap ä¸­ä½¿ç”¨ \u0026amp;str å€¼æŸ¥æ‰¾ String é”®çš„ç‰¹æ®Šé—®é¢˜ã€‚\næˆ‘ä»¬å¯ä»¥æŠŠ Borrow\u0026lt;T\u0026gt; å’Œ BorrowMut\u0026lt;T\u0026gt; çœ‹ä½œæ˜¯ AsRef\u0026lt;T\u0026gt; å’Œ AsMut\u0026lt;T\u0026gt; çš„æ›´ä¸¥æ ¼çš„ç‰ˆæœ¬ï¼Œå…¶ä¸­è¿”å›çš„å¼•ç”¨ \u0026amp;T ä¸ Self çš„ Eqã€Hash å’Œ Ord ç­‰å€¼ã€‚ç”¨ä¸€ä¸ªæ³¨é‡Šçš„ä¾‹å­å¯ä»¥æ›´å®¹æ˜“åœ°è§£é‡Šè¿™ä¸ªé—®é¢˜ã€‚\nusestd::borrow::Borrow;usestd:#ï¸âƒ£:Hasher;usestd::collections::hash_map::DefaultHasher;usestd:#ï¸âƒ£:Hash;fn get_hash\u0026lt;T: Hash\u0026gt;(t: T)-\u0026gt; u64 {letmuthasher=DefaultHasher::new();t.hash(\u0026amp;muthasher);hasher.finish()}fn asref_example\u0026lt;Owned,Ref\u0026gt;(owned1: Owned,owned2: Owned)whereOwned: Eq +Ord+Hash+AsRef\u0026lt;Ref\u0026gt;,Ref: Eq +Ord+Hash{letref1: \u0026amp;Ref=owned1.as_ref();letref2: \u0026amp;Ref=owned2.as_ref();// refs aren\u0026#39;t required to be equal if owned types are equal assert_eq!(owned1==owned2,ref1==ref2);// âŒ letowned1_hash=get_hash(\u0026amp;owned1);letowned2_hash=get_hash(\u0026amp;owned2);letref1_hash=get_hash(\u0026amp;ref1);letref2_hash=get_hash(\u0026amp;ref2);// ref hashes aren\u0026#39;t required to be equal if owned type hashes are equal assert_eq!(owned1_hash==owned2_hash,ref1_hash==ref2_hash);// âŒ // ref comparisons aren\u0026#39;t required to match owned type comparisons assert_eq!(owned1.cmp(\u0026amp;owned2),ref1.cmp(\u0026amp;ref2));// âŒ }fn borrow_example\u0026lt;Owned,Borrowed\u0026gt;(owned1: Owned,owned2: Owned)whereOwned: Eq +Ord+Hash+Borrow\u0026lt;Borrowed\u0026gt;,Borrowed: Eq +Ord+Hash{letborrow1: \u0026amp;Borrowed=owned1.borrow();letborrow2: \u0026amp;Borrowed=owned2.borrow();// borrows are required to be equal if owned types are equal assert_eq!(owned1==owned2,borrow1==borrow2);// âœ… letowned1_hash=get_hash(\u0026amp;owned1);letowned2_hash=get_hash(\u0026amp;owned2);letborrow1_hash=get_hash(\u0026amp;borrow1);letborrow2_hash=get_hash(\u0026amp;borrow2);// borrow hashes are required to be equal if owned type hashes are equal assert_eq!(owned1_hash==owned2_hash,borrow1_hash==borrow2_hash);// âœ… // borrow comparisons are required to match owned type comparisons assert_eq!(owned1.cmp(\u0026amp;owned2),borrow1.cmp(\u0026amp;borrow2));// âœ… }It\u0026rsquo;s good to be aware of these traits and understand why they exist since it helps demystify some of the methods on HashSet, HashMap, BTreeSet, and BTreeMap but it\u0026rsquo;s very rare that we would ever need to impl these traits for any of our types because it\u0026rsquo;s very rare that we would ever need create a pair of types where one is the \u0026ldquo;borrowed\u0026rdquo; version of the other in the first place. If we have some T then \u0026amp;T will get the job done 99.99% of the time, and T: Borrow\u0026lt;T\u0026gt; is already implemented for all T because of a generic blanket impl, so we don\u0026rsquo;t need to manually impl it and we don\u0026rsquo;t need to create some U such that T: Borrow\u0026lt;U\u0026gt;.\nçŸ¥é“è¿™äº› trait å¹¶ç†è§£å®ƒä»¬å­˜åœ¨çš„åŸå› æ˜¯å¾ˆå¥½çš„ï¼Œå› ä¸ºè¿™æœ‰åŠ©äºè§£å¼€ HashSetã€HashMapã€BTreeSet å’Œ BTreeMap ä¸Šçš„ä¸€äº›æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬å¾ˆå°‘éœ€è¦ä¸ºæˆ‘ä»¬çš„ä»»ä½•ç±»å‹å®ç°è¿™äº› traitï¼Œå› ä¸ºæˆ‘ä»¬å¾ˆå°‘éœ€è¦åˆ›å»ºä¸€å¯¹ç±»å‹ï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯å¦ä¸€ä¸ªçš„ \u0026ldquo;å€Ÿç”¨\u0026rdquo; ç‰ˆæœ¬ã€‚å¦‚æœæˆ‘ä»¬æœ‰ä¸€äº› Tï¼Œé‚£ä¹ˆ T åœ¨ 99.99% çš„æƒ…å†µä¸‹éƒ½èƒ½å®Œæˆå·¥ä½œï¼Œè€Œä¸” T: Borrow\u0026lt;T\u0026gt; å·²ç»ä¸ºæ‰€æœ‰çš„ T å®ç°äº†ï¼Œå› ä¸ºæœ‰ä¸€ä¸ªé€šç”¨çš„ä¸€æ½å­å®ç°ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨å®ç°å®ƒï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦åˆ›å»ºä¸€äº› Uï¼Œä½¿ T: Borrow\u0026lt;U\u0026gt;ã€‚\nToOwned é¢„å¤‡çŸ¥è¯†\n Self Methods Default Impls Clone Borrow \u0026amp; BorrowMut  traitToOwned{type Owned: Borrow\u0026lt;Self\u0026gt;;fn to_owned(\u0026amp;self)-\u0026gt; Self::Owned;// provided default impls fn clone_into(\u0026amp;self,target: \u0026amp;mutSelf::Owned);}ToOwned is a more generic version of Clone. Clone allows us to take a \u0026amp;T and turn it into an T but ToOwned allows us to take a \u0026amp;Borrowed and turn it into a Owned where Owned: Borrow\u0026lt;Borrowed\u0026gt;.\nIn other words, we can\u0026rsquo;t \u0026ldquo;clone\u0026rdquo; a \u0026amp;str into a String, or a \u0026amp;Path into a PathBuf, or an \u0026amp;OsStr into an OsString, since the clone method signature doesn\u0026rsquo;t support this kind of cross-type cloning, and that\u0026rsquo;s what ToOwned was made for.\nFor similar reasons as Borrow and BorrowMut, it\u0026rsquo;s good to be aware of this trait and understand why it exists but it\u0026rsquo;s very rare we\u0026rsquo;ll ever need to impl it for any of our types.\nToOwned æ˜¯ Clone çš„ä¸€ä¸ªæ›´é€šç”¨çš„ç‰ˆæœ¬ã€‚Clone å…è®¸æˆ‘ä»¬æŠŠä¸€ä¸ª \u0026amp;T å˜æˆä¸€ä¸ª Tï¼Œä½† ToOwned å…è®¸æˆ‘ä»¬æŠŠä¸€ä¸ª \u0026amp;Borrowed å˜æˆä¸€ä¸ª Ownedï¼Œå…¶ä¸­ Owned: Borrow\u0026lt;Borrowed\u0026gt;ã€‚\næ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬ä¸èƒ½æŠŠä¸€ä¸ª \u0026amp;str å…‹éš†æˆä¸€ä¸ª Stringï¼Œæˆ–è€…æŠŠä¸€ä¸ª \u0026amp;Path å…‹éš†æˆä¸€ä¸ª PathBufï¼Œæˆ–è€…æŠŠä¸€ä¸ª \u0026amp;OsStr å…‹éš†æˆä¸€ä¸ª OsStringï¼Œå› ä¸º clone æ–¹æ³•ç­¾åä¸æ”¯æŒè¿™ç§è·¨ç±»å‹å…‹éš†ï¼Œè€Œè¿™æ­£æ˜¯ ToOwned çš„ç”¨é€”ã€‚\nå‡ºäºä¸ Borrow å’Œ BorrowMut ç±»ä¼¼çš„åŸå› ï¼ŒçŸ¥é“è¿™ä¸ª trait å¹¶ç†è§£å®ƒå­˜åœ¨çš„åŸå› æ˜¯å¾ˆå¥½çš„ï¼Œä½†æˆ‘ä»¬å¾ˆå°‘éœ€è¦ä¸ºæˆ‘ä»¬çš„ä»»ä½•ç±»å‹å®ç°è¿™ä¸ª traitã€‚\nIteration Traits Iterator é¢„å¤‡çŸ¥è¯†\n Self Methods Associated Types Default Impls  traitIterator{type Item;fn next(\u0026amp;mutself)-\u0026gt; Option\u0026lt;Self::Item\u0026gt;;// provided default impls fn size_hint(\u0026amp;self)-\u0026gt; (usize,Option\u0026lt;usize\u0026gt;);fn count(self)-\u0026gt; usize;fn last(self)-\u0026gt; Option\u0026lt;Self::Item\u0026gt;;fn advance_by(\u0026amp;mutself,n: usize)-\u0026gt; Result\u0026lt;(),usize\u0026gt;;fn nth(\u0026amp;mutself,n: usize)-\u0026gt; Option\u0026lt;Self::Item\u0026gt;;fn step_by(self,step: usize)-\u0026gt; StepBy\u0026lt;Self\u0026gt;;fn chain\u0026lt;U\u0026gt;(self,other: U)-\u0026gt; Chain\u0026lt;Self,\u0026lt;UasIntoIterator\u0026gt;::IntoIter\u0026gt;whereU: IntoIterator\u0026lt;Item=Self::Item\u0026gt;;fn zip\u0026lt;U\u0026gt;(self,other: U)-\u0026gt; Zip\u0026lt;Self,\u0026lt;UasIntoIterator\u0026gt;::IntoIter\u0026gt;whereU: IntoIterator;fn map\u0026lt;B,F\u0026gt;(self,f: F)-\u0026gt; Map\u0026lt;Self,F\u0026gt;whereF: FnMut(Self::Item)-\u0026gt; B;fn for_each\u0026lt;F\u0026gt;(self,f: F)whereF: FnMut(Self::Item);fn filter\u0026lt;P\u0026gt;(self,predicate: P)-\u0026gt; Filter\u0026lt;Self,P\u0026gt;whereP: FnMut(\u0026amp;Self::Item)-\u0026gt; bool;fn filter_map\u0026lt;B,F\u0026gt;(self,f: F)-\u0026gt; FilterMap\u0026lt;Self,F\u0026gt;whereF: FnMut(Self::Item)-\u0026gt; Option\u0026lt;B\u0026gt;;fn enumerate(self)-\u0026gt; Enumerate\u0026lt;Self\u0026gt;;fn peekable(self)-\u0026gt; Peekable\u0026lt;Self\u0026gt;;fn skip_while\u0026lt;P\u0026gt;(self,predicate: P)-\u0026gt; SkipWhile\u0026lt;Self,P\u0026gt;whereP: FnMut(\u0026amp;Self::Item)-\u0026gt; bool;fn take_while\u0026lt;P\u0026gt;(self,predicate: P)-\u0026gt; TakeWhile\u0026lt;Self,P\u0026gt;whereP: FnMut(\u0026amp;Self::Item)-\u0026gt; bool;fn map_while\u0026lt;B,P\u0026gt;(self,predicate: P)-\u0026gt; MapWhile\u0026lt;Self,P\u0026gt;whereP: FnMut(Self::Item)-\u0026gt; Option\u0026lt;B\u0026gt;;fn skip(self,n: usize)-\u0026gt; Skip\u0026lt;Self\u0026gt;;fn take(self,n: usize)-\u0026gt; Take\u0026lt;Self\u0026gt;;fn scan\u0026lt;St,B,F\u0026gt;(self,initial_state: St,f: F)-\u0026gt; Scan\u0026lt;Self,St,F\u0026gt;whereF: FnMut(\u0026amp;mutSt,Self::Item)-\u0026gt; Option\u0026lt;B\u0026gt;;fn flat_map\u0026lt;U,F\u0026gt;(self,f: F)-\u0026gt; FlatMap\u0026lt;Self,U,F\u0026gt;whereF: FnMut(Self::Item)-\u0026gt; U,U: IntoIterator;fn flatten(self)-\u0026gt; Flatten\u0026lt;Self\u0026gt;whereSelf::Item: IntoIterator;fn fuse(self)-\u0026gt; Fuse\u0026lt;Self\u0026gt;;fn inspect\u0026lt;F\u0026gt;(self,f: F)-\u0026gt; Inspect\u0026lt;Self,F\u0026gt;whereF: FnMut(\u0026amp;Self::Item);fn by_ref(\u0026amp;mutself)-\u0026gt; \u0026amp;mutSelf;fn collect\u0026lt;B\u0026gt;(self)-\u0026gt; BwhereB: FromIterator\u0026lt;Self::Item\u0026gt;;fn partition\u0026lt;B,F\u0026gt;(self,f: F)-\u0026gt; (B,B)whereF: FnMut(\u0026amp;Self::Item)-\u0026gt; bool,B: Default +Extend\u0026lt;Self::Item\u0026gt;;fn partition_in_place\u0026lt;\u0026#39;a,T,P\u0026gt;(self,predicate: P)-\u0026gt; usize whereSelf: DoubleEndedIterator\u0026lt;Item=\u0026amp;\u0026#39;amutT\u0026gt;,T: \u0026#39;a,P: FnMut(\u0026amp;T)-\u0026gt; bool;fn is_partitioned\u0026lt;P\u0026gt;(self,predicate: P)-\u0026gt; bool whereP: FnMut(Self::Item)-\u0026gt; bool;fn try_fold\u0026lt;B,F,R\u0026gt;(\u0026amp;mutself,init: B,f: F)-\u0026gt; RwhereF: FnMut(B,Self::Item)-\u0026gt; R,R: Try\u0026lt;Ok=B\u0026gt;;fn try_for_each\u0026lt;F,R\u0026gt;(\u0026amp;mutself,f: F)-\u0026gt; RwhereF: FnMut(Self::Item)-\u0026gt; R,R: Try\u0026lt;Ok=()\u0026gt;;fn fold\u0026lt;B,F\u0026gt;(self,init: B,f: F)-\u0026gt; BwhereF: FnMut(B,Self::Item)-\u0026gt; B;fn fold_first\u0026lt;F\u0026gt;(self,f: F)-\u0026gt; Option\u0026lt;Self::Item\u0026gt;whereF: FnMut(Self::Item,Self::Item)-\u0026gt; Self::Item;fn all\u0026lt;F\u0026gt;(\u0026amp;mutself,f: F)-\u0026gt; bool whereF: FnMut(Self::Item)-\u0026gt; bool;fn any\u0026lt;F\u0026gt;(\u0026amp;mutself,f: F)-\u0026gt; bool whereF: FnMut(Self::Item)-\u0026gt; bool;fn find\u0026lt;P\u0026gt;(\u0026amp;mutself,predicate: P)-\u0026gt; Option\u0026lt;Self::Item\u0026gt;whereP: FnMut(\u0026amp;Self::Item)-\u0026gt; bool;fn find_map\u0026lt;B,F\u0026gt;(\u0026amp;mutself,f: F)-\u0026gt; Option\u0026lt;B\u0026gt;whereF: FnMut(Self::Item)-\u0026gt; Option\u0026lt;B\u0026gt;;fn try_find\u0026lt;F,R\u0026gt;(\u0026amp;mutself,f: F)-\u0026gt; Result\u0026lt;Option\u0026lt;Self::Item\u0026gt;,\u0026lt;RasTry\u0026gt;::Error\u0026gt;whereF: FnMut(\u0026amp;Self::Item)-\u0026gt; R,R: Try\u0026lt;Ok=bool\u0026gt;;fn position\u0026lt;P\u0026gt;(\u0026amp;mutself,predicate: P)-\u0026gt; Option\u0026lt;usize\u0026gt;whereP: FnMut(Self::Item)-\u0026gt; bool;fn rposition\u0026lt;P\u0026gt;(\u0026amp;mutself,predicate: P)-\u0026gt; Option\u0026lt;usize\u0026gt;whereSelf: ExactSizeIterator +DoubleEndedIterator,P: FnMut(Self::Item)-\u0026gt; bool;fn max(self)-\u0026gt; Option\u0026lt;Self::Item\u0026gt;whereSelf::Item: Ord;fn min(self)-\u0026gt; Option\u0026lt;Self::Item\u0026gt;whereSelf::Item: Ord;fn max_by_key\u0026lt;B,F\u0026gt;(self,f: F)-\u0026gt; Option\u0026lt;Self::Item\u0026gt;whereF: FnMut(\u0026amp;Self::Item)-\u0026gt; B,B: Ord;fn max_by\u0026lt;F\u0026gt;(self,compare: F)-\u0026gt; Option\u0026lt;Self::Item\u0026gt;whereF: FnMut(\u0026amp;Self::Item,\u0026amp;Self::Item)-\u0026gt; Ordering;fn min_by_key\u0026lt;B,F\u0026gt;(self,f: F)-\u0026gt; Option\u0026lt;Self::Item\u0026gt;whereF: FnMut(\u0026amp;Self::Item)-\u0026gt; B,B: Ord;fn min_by\u0026lt;F\u0026gt;(self,compare: F)-\u0026gt; Option\u0026lt;Self::Item\u0026gt;whereF: FnMut(\u0026amp;Self::Item,\u0026amp;Self::Item)-\u0026gt; Ordering;fn rev(self)-\u0026gt; Rev\u0026lt;Self\u0026gt;whereSelf: DoubleEndedIterator;fn unzip\u0026lt;A,B,FromA,FromB\u0026gt;(self)-\u0026gt; (FromA,FromB)whereSelf: Iterator\u0026lt;Item=(A,B)\u0026gt;,FromA: Default +Extend\u0026lt;A\u0026gt;,FromB: Default +Extend\u0026lt;B\u0026gt;;fn copied\u0026lt;\u0026#39;a,T\u0026gt;(self)-\u0026gt; Copied\u0026lt;Self\u0026gt;whereSelf: Iterator\u0026lt;Item=\u0026amp;\u0026#39;aT\u0026gt;,T: \u0026#39;a+Copy;fn cloned\u0026lt;\u0026#39;a,T\u0026gt;(self)-\u0026gt; Cloned\u0026lt;Self\u0026gt;whereSelf: Iterator\u0026lt;Item=\u0026amp;\u0026#39;aT\u0026gt;,T: \u0026#39;a+Clone;fn cycle(self)-\u0026gt; Cycle\u0026lt;Self\u0026gt;whereSelf: Clone;fn sum\u0026lt;S\u0026gt;(self)-\u0026gt; SwhereS: Sum\u0026lt;Self::Item\u0026gt;;fn product\u0026lt;P\u0026gt;(self)-\u0026gt; PwhereP: Product\u0026lt;Self::Item\u0026gt;;fn cmp\u0026lt;I\u0026gt;(self,other: I)-\u0026gt; OrderingwhereI: IntoIterator\u0026lt;Item=Self::Item\u0026gt;,Self::Item: Ord;fn cmp_by\u0026lt;I,F\u0026gt;(self,other: I,cmp: F)-\u0026gt; OrderingwhereF: FnMut(Self::Item,\u0026lt;IasIntoIterator\u0026gt;::Item)-\u0026gt; Ordering,I: IntoIterator;fn partial_cmp\u0026lt;I\u0026gt;(self,other: I)-\u0026gt; Option\u0026lt;Ordering\u0026gt;whereI: IntoIterator,Self::Item: PartialOrd\u0026lt;\u0026lt;IasIntoIterator\u0026gt;::Item\u0026gt;;fn partial_cmp_by\u0026lt;I,F\u0026gt;(self,other: I,partial_cmp: F)-\u0026gt; Option\u0026lt;Ordering\u0026gt;whereF: FnMut(Self::Item,\u0026lt;IasIntoIterator\u0026gt;::Item)-\u0026gt; Option\u0026lt;Ordering\u0026gt;,I: IntoIterator;fn eq\u0026lt;I\u0026gt;(self,other: I)-\u0026gt; bool whereI: IntoIterator,Self::Item: PartialEq\u0026lt;\u0026lt;IasIntoIterator\u0026gt;::Item\u0026gt;;fn eq_by\u0026lt;I,F\u0026gt;(self,other: I,eq: F)-\u0026gt; bool whereF: FnMut(Self::Item,\u0026lt;IasIntoIterator\u0026gt;::Item)-\u0026gt; bool,I: IntoIterator;fn ne\u0026lt;I\u0026gt;(self,other: I)-\u0026gt; bool whereI: IntoIterator,Self::Item: PartialEq\u0026lt;\u0026lt;IasIntoIterator\u0026gt;::Item\u0026gt;;fn lt\u0026lt;I\u0026gt;(self,other: I)-\u0026gt; bool whereI: IntoIterator,Self::Item: PartialOrd\u0026lt;\u0026lt;IasIntoIterator\u0026gt;::Item\u0026gt;;fn le\u0026lt;I\u0026gt;(self,other: I)-\u0026gt; bool whereI: IntoIterator,Self::Item: PartialOrd\u0026lt;\u0026lt;IasIntoIterator\u0026gt;::Item\u0026gt;;fn gt\u0026lt;I\u0026gt;(self,other: I)-\u0026gt; bool whereI: IntoIterator,Self::Item: PartialOrd\u0026lt;\u0026lt;IasIntoIterator\u0026gt;::Item\u0026gt;;fn ge\u0026lt;I\u0026gt;(self,other: I)-\u0026gt; bool whereI: IntoIterator,Self::Item: PartialOrd\u0026lt;\u0026lt;IasIntoIterator\u0026gt;::Item\u0026gt;;fn is_sorted(self)-\u0026gt; bool whereSelf::Item: PartialOrd\u0026lt;Self::Item\u0026gt;;fn is_sorted_by\u0026lt;F\u0026gt;(self,compare: F)-\u0026gt; bool whereF: FnMut(\u0026amp;Self::Item,\u0026amp;Self::Item)-\u0026gt; Option\u0026lt;Ordering\u0026gt;;fn is_sorted_by_key\u0026lt;F,K\u0026gt;(self,f: F)-\u0026gt; bool whereF: FnMut(Self::Item)-\u0026gt; K,K: PartialOrd\u0026lt;K\u0026gt;;}Iterator\u0026lt;Item = T\u0026gt; ç±»å‹å¯ä»¥è¢«è¿­ä»£ï¼Œå¹¶ä¼šäº§ç”Ÿ T ç±»å‹ã€‚æ²¡æœ‰ IteratorMut traitã€‚æ¯ä¸ª Iterator å®ç°å¯ä»¥é€šè¿‡ Item å…³è”ç±»å‹æŒ‡å®šå®ƒæ˜¯è¿”å›ä¸å¯å˜å¼•ç”¨ã€å¯å˜å¼•ç”¨è¿˜æ˜¯æ‹¥æœ‰å…¶å€¼ã€‚\n   Vec\u0026lt;T\u0026gt; æ–¹æ³• è¿”å›     .iter() Iterator\u0026lt;Item = \u0026amp;T\u0026gt;   .iter_mut() Iterator\u0026lt;Item = \u0026amp;mut T\u0026gt;   .into_iter() Iterator\u0026lt;Item = T\u0026gt;    å¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œæœ‰äº›ä¸œè¥¿ä¸æ˜¯å¾ˆæ˜æ˜¾ï¼Œä½†ä¸­çº§ Rustaceans è®¤ä¸ºæ˜¯ç†æ‰€å½“ç„¶çš„ï¼Œé‚£å°±æ˜¯å¤§å¤šæ•°ç±»å‹éƒ½ä¸æ˜¯ä»–ä»¬æœ¬èº«çš„è¿­ä»£å™¨ã€‚å¦‚æœä¸€ä¸ªç±»å‹æ˜¯å¯è¿­ä»£çš„ï¼Œæˆ‘ä»¬å‡ ä¹æ€»æ˜¯å®ç°ä¸€äº›è‡ªå®šä¹‰çš„è¿­ä»£å™¨ç±»å‹æ¥è¿­ä»£å®ƒï¼Œè€Œä¸æ˜¯è¯•å›¾è®©å®ƒè‡ªå·±è¿­ä»£ã€‚\nstruct MyType{items: Vec\u0026lt;String\u0026gt;}implMyType{fn iter(\u0026amp;self)-\u0026gt; implIterator\u0026lt;Item=\u0026amp;String\u0026gt;{MyTypeIterator{index: 0,items: \u0026amp;self.items}}}struct MyTypeIterator\u0026lt;\u0026#39;a\u0026gt;{index: usize,items: \u0026amp;\u0026#39;aVec\u0026lt;String\u0026gt;}impl\u0026lt;\u0026#39;a\u0026gt;IteratorforMyTypeIterator\u0026lt;\u0026#39;a\u0026gt;{type Item=\u0026amp;\u0026#39;aString;fn next(\u0026amp;mutself)-\u0026gt; Option\u0026lt;Self::Item\u0026gt;{ifself.index\u0026gt;=self.items.len(){None}else{letitem=\u0026amp;self.items[self.index];self.index+=1;Some(item)}}}ä¸ºäº†ä¾¿äºæ•™å­¦ï¼Œä¸Šé¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä»å¤´å¼€å§‹å®ç°ä¸€ä¸ª Iteratorï¼Œä½†åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¹ æƒ¯æ€§çš„è§£å†³æ–¹æ¡ˆå°†åªæ˜¯éµä» Vec çš„ iter æ–¹æ³•ã€‚\nstruct MyType{items: Vec\u0026lt;String\u0026gt;}implMyType{fn iter(\u0026amp;self)-\u0026gt; implIterator\u0026lt;Item=\u0026amp;String\u0026gt;{self.items.iter()}}å¦å¤–ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€šç”¨å…¨é¢å®ç°ï¼Œè¦æ³¨æ„ã€‚\nimpl\u0026lt;I: Iterator +?Sized\u0026gt;Iteratorfor\u0026amp;mutI;å®ƒè¯´ä»»ä½•å¯¹è¿­ä»£å™¨çš„å¯å˜å¼•ç”¨ä¹Ÿæ˜¯è¿­ä»£å™¨ï¼Œè¿™ä¸€ç‚¹å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸æˆ‘ä»¬ä½¿ç”¨ self æ¥æ”¶å™¨ï¼Œå°±åƒä½¿ç”¨ \u0026amp;mut self æ¥æ”¶å™¨ä¸€æ ·ã€‚äº†è§£è¿™ä¸€ç‚¹å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸æˆ‘ä»¬ä½¿ç”¨è¿­ä»£å™¨æ–¹æ³•ä¸ self æ¥æ”¶å™¨ï¼Œå°±åƒå®ƒä»¬æœ‰ \u0026amp;mut self æ¥æ”¶å™¨ä¸€æ ·ã€‚\nä¸¾ä¸ªä¾‹å­ï¼Œæƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå¯ä»¥å¤„ç†ä¸€ä¸ªè¶…è¿‡ä¸‰ä¸ªé¡¹çš„è¿­ä»£å™¨ï¼Œä½†æ˜¯å‡½æ•°çš„ç¬¬ä¸€æ­¥æ˜¯å–å‡ºè¿­ä»£å™¨çš„å‰ä¸‰é¡¹ï¼Œå¹¶åœ¨è¿­ä»£å‰©ä¸‹çš„é¡¹ä¹‹å‰åˆ†åˆ«å¤„ç†å®ƒä»¬ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªåˆå­¦è€…å¯èƒ½å°è¯•å†™è¿™ä¸ªå‡½æ•°çš„æ–¹æ³•ã€‚\nfn example\u0026lt;I: Iterator\u0026lt;Item=i32\u0026gt;\u0026gt;(mutiter: I){letfirst3: Vec\u0026lt;i32\u0026gt;=iter.take(3).collect();foriteminiter{// âŒ iter consumed in line above // process remaining items }}å—¯ï¼Œè¿™å¾ˆçƒ¦äººã€‚take æ–¹æ³•æœ‰ä¸€ä¸ª self æ¥æ”¶å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼¼ä¹ä¸èƒ½åœ¨ä¸æ¶ˆè€—æ•´ä¸ªè¿­ä»£å™¨çš„æƒ…å†µä¸‹è°ƒç”¨å®ƒã€‚ä¸‹é¢æ˜¯ä¸Šé¢ä»£ç çš„ä¸€ä¸ªå¤©çœŸçš„é‡æ„ã€‚\nfn example\u0026lt;I: Iterator\u0026lt;Item=i32\u0026gt;\u0026gt;(mutiter: I){letfirst3: Vec\u0026lt;i32\u0026gt;=vec![iter.next().unwrap(),iter.next().unwrap(),iter.next().unwrap(),];foriteminiter{// âœ… // process remaining items }}è¿™è¿˜ç®—å¥½çš„ã€‚ç„¶è€Œï¼Œæƒ¯ç”¨\u0008çš„é‡æ„å…¶å®æ˜¯è¿™æ ·çš„ã€‚\nfn example\u0026lt;I: Iterator\u0026lt;Item=i32\u0026gt;\u0026gt;(mutiter: I){letfirst3: Vec\u0026lt;i32\u0026gt;=iter.by_ref().take(3).collect();foriteminiter{// âœ… // process remaining items }}ä¸å¤ªå®¹æ˜“å‘ç°ã€‚ä½†æ— è®ºå¦‚ä½•ï¼Œç°åœ¨æˆ‘ä»¬çŸ¥é“äº†ã€‚\nå¦å¤–ï¼Œå¯¹äºä»€ä¹ˆå¯ä»¥æ˜¯è¿­ä»£å™¨ï¼Œä»€ä¹ˆä¸èƒ½æ˜¯è¿­ä»£å™¨ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆè§„åˆ™æˆ–çº¦å®šã€‚å¦‚æœç±»å‹æ˜¯ Iteratorï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ã€‚æ ‡å‡†åº“ä¸­çš„ä¸€äº›åˆ›é€ æ€§çš„ä¾‹å­å¦‚ä¸‹ã€‚\nusestd::sync::mpsc::channel;usestd::thread;fn paths_can_be_iterated(path: \u0026amp;Path){forpartinpath{// iterate over parts of a path }}fn receivers_can_be_iterated(){let(send,recv)=channel();thread::spawn(move||{send.send(1).unwrap();send.send(2).unwrap();send.send(3).unwrap();});forreceivedinrecv{// iterate over received values }}IntoIterator é¢„å¤‡çŸ¥è¯†\n Self Methods Associated Types Iterator  traitIntoIteratorwhere\u0026lt;Self::IntoIterasIterator\u0026gt;::Item==Self::Item,{type Item;type IntoIter: Iterator;fn into_iter(self)-\u0026gt; Self::IntoIter;}IntoIterator ç±»å‹å¯ä»¥è¢«è½¬æ¢ä¸ºè¿­ä»£å™¨ï¼Œå› æ­¤å¾—åã€‚å½“ä¸€ä¸ªç±»å‹åœ¨ for-in å¾ªç¯ä¸­ä½¿ç”¨æ—¶ï¼Œä¼šè°ƒç”¨ into_iter æ–¹æ³•ã€‚\n// vec = Vec\u0026lt;T\u0026gt; forvinvec{}// v = T // above line desugared forvinvec.into_iter(){}ä¸ä»… Vec å®ç°äº† IntoIteratorï¼Œå¦‚æœæˆ‘ä»¬æƒ³åˆ†åˆ«è¿­ä»£ä¸å¯å˜å¼•ç”¨æˆ–å¯å˜å¼•ç”¨è€Œä¸æ˜¯æ‹¥æœ‰å…¶å€¼ï¼Œ\u0026amp;Vec å’Œ \u0026amp;mut Vec ä¹Ÿåˆ†åˆ«å®ç°äº† IntoIteratorã€‚\n// vec = Vec\u0026lt;T\u0026gt; forvin\u0026amp;vec{}// v = \u0026amp;T // above example desugared forvin(\u0026amp;vec).into_iter(){}// vec = Vec\u0026lt;T\u0026gt; forvin\u0026amp;mutvec{}// v = \u0026amp;mut T // above example desugared forvin(\u0026amp;mutvec).into_iter(){}FromIterator é¢„å¤‡çŸ¥è¯†\n Self Functions Generic Parameters Iterator IntoIterator  traitFromIterator\u0026lt;A\u0026gt;{fn from_iter\u0026lt;T\u0026gt;(iter: T)-\u0026gt; SelfwhereT: IntoIterator\u0026lt;Item=A\u0026gt;;}FromIterator ç±»å‹å¯ä»¥ä»è¿­ä»£å™¨ä¸­åˆ›å»ºï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸º FromIteratorã€‚FromIterator æœ€å¸¸è§å’Œæœ€ä¹ æƒ¯çš„ç”¨æ³•æ˜¯è°ƒç”¨ Iterator ä¸Šçš„ collect æ–¹æ³•ã€‚\nfn collect\u0026lt;B\u0026gt;(self)-\u0026gt; BwhereB: FromIterator\u0026lt;Self::Item\u0026gt;;å°† Iterator\u0026lt;Item = char\u0026gt; æ”¶é›†æˆ String çš„ä¾‹å­å¦‚ä¸‹:\nfn filter_letters(string: \u0026amp;str)-\u0026gt; String {string.chars().filter(|c|c.is_alphabetic()).collect()}æ ‡å‡†åº“ä¸­çš„æ‰€æœ‰é›†åˆéƒ½å®ç°äº† IntoIterator å’Œ FromIteratorï¼Œè¿™æ ·å¯ä»¥æ›´å®¹æ˜“åœ¨å®ƒä»¬ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚\nusestd::collections::{BTreeSet,HashMap,HashSet,LinkedList};// String -\u0026gt; HashSet\u0026lt;char\u0026gt; fn unique_chars(string: \u0026amp;str)-\u0026gt; HashSet\u0026lt;char\u0026gt;{string.chars().collect()}// Vec\u0026lt;T\u0026gt; -\u0026gt; BTreeSet\u0026lt;T\u0026gt; fn ordered_unique_items\u0026lt;T: Ord\u0026gt;(vec: Vec\u0026lt;T\u0026gt;)-\u0026gt; BTreeSet\u0026lt;T\u0026gt;{vec.into_iter().collect()}// HashMap\u0026lt;K, V\u0026gt; -\u0026gt; LinkedList\u0026lt;(K, V)\u0026gt; fn entry_list\u0026lt;K,V\u0026gt;(map: HashMap\u0026lt;K,V\u0026gt;)-\u0026gt; LinkedList\u0026lt;(K,V)\u0026gt;{map.into_iter().collect()}// and countless more possible examples I/O Traits Read \u0026amp; Write é¢„å¤‡çŸ¥è¯†\n Self Methods Scope Generic Blanket Impls  traitRead{fn read(\u0026amp;mutself,buf: \u0026amp;mut[u8])-\u0026gt; Result\u0026lt;usize\u0026gt;;// provided default impls fn read_vectored(\u0026amp;mutself,bufs: \u0026amp;mut[IoSliceMut\u0026lt;\u0026#39;_\u0026gt;])-\u0026gt; Result\u0026lt;usize\u0026gt;;fn is_read_vectored(\u0026amp;self)-\u0026gt; bool;unsafefn initializer(\u0026amp;self)-\u0026gt; Initializer;fn read_to_end(\u0026amp;mutself,buf: \u0026amp;mutVec\u0026lt;u8\u0026gt;)-\u0026gt; Result\u0026lt;usize\u0026gt;;fn read_to_string(\u0026amp;mutself,buf: \u0026amp;mutString)-\u0026gt; Result\u0026lt;usize\u0026gt;;fn read_exact(\u0026amp;mutself,buf: \u0026amp;mut[u8])-\u0026gt; Result\u0026lt;()\u0026gt;;fn by_ref(\u0026amp;mutself)-\u0026gt; \u0026amp;mutSelfwhereSelf: Sized;fn bytes(self)-\u0026gt; Bytes\u0026lt;Self\u0026gt;whereSelf: Sized;fn chain\u0026lt;R: Read\u0026gt;(self,next: R)-\u0026gt; Chain\u0026lt;Self,R\u0026gt;whereSelf: Sized;fn take(self,limit: u64)-\u0026gt; Take\u0026lt;Self\u0026gt;whereSelf: Sized;}traitWrite{fn write(\u0026amp;mutself,buf: \u0026amp;[u8])-\u0026gt; Result\u0026lt;usize\u0026gt;;fn flush(\u0026amp;mutself)-\u0026gt; Result\u0026lt;()\u0026gt;;// provided default impls fn write_vectored(\u0026amp;mutself,bufs: \u0026amp;[IoSlice\u0026lt;\u0026#39;_\u0026gt;])-\u0026gt; Result\u0026lt;usize\u0026gt;;fn is_write_vectored(\u0026amp;self)-\u0026gt; bool;fn write_all(\u0026amp;mutself,buf: \u0026amp;[u8])-\u0026gt; Result\u0026lt;()\u0026gt;;fn write_all_vectored(\u0026amp;mutself,bufs: \u0026amp;mut[IoSlice\u0026lt;\u0026#39;_\u0026gt;])-\u0026gt; Result\u0026lt;()\u0026gt;;fn write_fmt(\u0026amp;mutself,fmt: Arguments\u0026lt;\u0026#39;_\u0026gt;)-\u0026gt; Result\u0026lt;()\u0026gt;;fn by_ref(\u0026amp;mutself)-\u0026gt; \u0026amp;mutSelfwhereSelf: Sized;}é€šç”¨çš„å…¨é¢å®ç°å€¼å¾—äº†è§£ã€‚\nimpl\u0026lt;R: Read+?Sized\u0026gt;Readfor\u0026amp;mutR;impl\u0026lt;W: Write+?Sized\u0026gt;Writefor\u0026amp;mutW;è¿™è¯´æ˜ä»»ä½•å¯¹ Read ç±»å‹çš„å¯å˜å¼•ç”¨ä¹Ÿæ˜¯ Readï¼Œå¯¹ Write ä¹Ÿæ˜¯å¦‚æ­¤ã€‚äº†è§£è¿™ä¸€ç‚¹å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸æˆ‘ä»¬ä½¿ç”¨ä»»ä½•å¸¦æœ‰ self æ¥æ”¶å™¨çš„æ–¹æ³•ï¼Œå°±åƒå®ƒæœ‰ä¸€ä¸ª \u0026amp;mut self æ¥æ”¶å™¨ä¸€æ ·ã€‚æˆ‘ä»¬å·²ç»åœ¨ Iterator trait éƒ¨åˆ†ä»‹ç»äº†å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ä»¥åŠä¸ºä»€ä¹ˆå®ƒå¾ˆæœ‰ç”¨ï¼Œæ‰€ä»¥æˆ‘ä¸æ‰“ç®—åœ¨è¿™é‡Œå†æ¬¡é‡å¤ã€‚\næˆ‘æƒ³æŒ‡å‡ºï¼Œ\u0026amp;[u8] å®ç°äº† Readï¼ŒVec\u0026lt;u8\u0026gt; å®ç°äº† Writeï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°ä½¿ç”¨ String å¯¹æˆ‘ä»¬çš„æ–‡ä»¶å¤„ç†å‡½æ•°è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œè¿™äº›å‡½æ•°å¾ˆå®¹æ˜“è½¬æ¢ä¸º \u0026amp;[u8] å’Œ Vec\u0026lt;u8\u0026gt;ã€‚\nusestd::path::Path;usestd::fs::File;usestd::io::Read;usestd::io::Write;usestd::io;// function we want to test fn uppercase\u0026lt;R: Read,W: Write\u0026gt;(mutread: R,mutwrite: W)-\u0026gt; Result\u0026lt;(),io::Error\u0026gt;{letmutbuffer=String::new();read.read_to_string(\u0026amp;mutbuffer)?;letuppercase=buffer.to_uppercase();write.write_all(uppercase.as_bytes())?;write.flush()?;Ok(())}// in actual program we\u0026#39;d pass Files fn example(in_path: \u0026amp;Path,out_path: \u0026amp;Path)-\u0026gt; Result\u0026lt;(),io::Error\u0026gt;{letin_file=File::open(in_path)?;letout_file=File::open(out_path)?;uppercase(in_file,out_file)}// however in unit tests we can use Strings! #[test]// âœ… fn example_test(){letin_file: String =\u0026#34;i am screaming\u0026#34;.into();letmutout_file: Vec\u0026lt;u8\u0026gt;=Vec::new();uppercase(in_file.as_bytes(),\u0026amp;mutout_file).unwrap();letout_result=String::from_utf8(out_file).unwrap();assert_eq!(out_result,\u0026#34;I AM SCREAMING\u0026#34;);}ç»“è®º æˆ‘ä»¬ä¸€èµ·å­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿! äº‹å®ä¸Šï¼Œå¤ªå¤šäº†ã€‚å®ƒç°åœ¨æ˜¯æˆ‘ä»¬çš„äº†:\nArtist credit: The Jenkins Comic\nè®¨è®º åœ¨è¿™é‡Œè®¨è®ºè¿™ç¯‡æ–‡ç« \n Github learnrust subreddit official Rust users forum Twitter lobste.rs rust subreddit  é€šçŸ¥ å½“ä¸‹ä¸€ç¯‡åšæ–‡å‘å¸ƒæ—¶ï¼Œä¼šæ”¶åˆ°é€šçŸ¥\n Following pretzelhammer on Twitter or Watching this repo\u0026rsquo;s releases (click Watch -\u0026gt; click Custom -\u0026gt; select Releases -\u0026gt; click Apply)  æ›´å¤šé˜…è¯»  Sizedness in Rust Common Rust Lifetime Misconceptions Learning Rust in 2020 Learn Assembly with Entirely Too Many Brainfuck Compilers  ","permalink":"https://ohmyweekly.github.io/notes/2021-05-19-a-tour-of-rust-standard-library-traits/","tags":["Raku"],"title":"Rust çš„æ ‡å‡†åº“ Trait ä¹‹æ—…"},{"categories":["rustlang","kafka"],"contents":"è¿™æ˜¯ä¸€ä¸ªä¸¤éƒ¨åˆ†çš„ç³»åˆ—ï¼Œå¸®åŠ©ä½ å¼€å§‹ä½¿ç”¨ Rust å’Œ Kafkaã€‚æˆ‘ä»¬å°†ä½¿ç”¨ rust-rdkafka crateï¼Œå®ƒæœ¬èº«å°±æ˜¯åŸºäº librdkafkaï¼ˆCåº“ï¼‰çš„ã€‚\nåœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç» Kafka Producer APIã€‚\nåˆå§‹è®¾ç½® ç¡®ä¿ä½ å®‰è£…äº†ä¸€ä¸ª Kafka broker - æœ¬åœ°è®¾ç½®åº”è¯¥è¶³å¤Ÿäº†ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿéœ€è¦å®‰è£…Rust - ä½ éœ€è¦1.45æˆ–ä»¥ä¸Šç‰ˆæœ¬ã€‚\nåœ¨ä½ å¼€å§‹ä¹‹å‰ï¼Œå…ˆå…‹éš† GitHub repoã€‚\ngit clone https://github.com/abhirockzz/rust-kafka-101 cd part1 æ£€æŸ¥ Cargo.toml æ–‡ä»¶:\n... [dependencies] rdkafka = { version = \u0026quot;0.25\u0026quot;, features = [\u0026quot;cmake-build\u0026quot;,\u0026quot;ssl\u0026quot;] } ... å…³äº cmake-build åŠŸèƒ½çš„è¯´æ˜ rust-rdkafka æä¾›äº†å‡ ç§è§£å†³ librdkafka ä¾èµ–å…³ç³»çš„æ–¹æ³•ã€‚æˆ‘é€‰æ‹©äº† static é“¾æ¥ï¼Œå…¶ä¸­ librdkafka è¢«ç¼–è¯‘ã€‚ä¸è¿‡ä½ ä¹Ÿå¯ä»¥é€‰æ‹© dynamic é“¾æ¥æ¥å¼•ç”¨æœ¬åœ°å®‰è£…çš„ç‰ˆæœ¬ã€‚\n æ›´å¤šå†…å®¹ï¼Œè¯·å‚è€ƒä»¥ä¸‹é“¾æ¥\n å¥½å§ï¼Œæˆ‘ä»¬å…ˆä»åŸºæœ¬çš„å¼€å§‹è¯´èµ·ã€‚\nç®€å•çš„ç”Ÿäº§è€… è¿™é‡Œæ˜¯ä¸€ä¸ªåŸºäº BaseProducer çš„ç®€å•ç”Ÿäº§è€…ã€‚\nletproducer: BaseProducer=ClientConfig::new().set(\u0026#34;bootstrap.servers\u0026#34;,\u0026#34;localhost:9092\u0026#34;).set(\u0026#34;security.protocol\u0026#34;,\u0026#34;SASL_SSL\u0026#34;).set(\u0026#34;sasl.mechanisms\u0026#34;,\u0026#34;PLAIN\u0026#34;).set(\u0026#34;sasl.username\u0026#34;,\u0026#34;\u0026lt;update\u0026gt;\u0026#34;).set(\u0026#34;sasl.password\u0026#34;,\u0026#34;\u0026lt;update\u0026gt;\u0026#34;).create().expect(\u0026#34;invalid producer config\u0026#34;);send æ–¹æ³•å¼€å§‹äº§ç”Ÿæ¶ˆæ¯ - å®ƒæ˜¯åœ¨ç´§ç¼© loop ä¸­å®Œæˆçš„ï¼Œä¸­é—´æœ‰ä¸€ä¸ª thread::sleep(ä¸æ˜¯åœ¨ç”Ÿäº§ä¸­ä¼šåšçš„äº‹æƒ…)ï¼Œä»¥ä½¿å…¶æ›´å®¹æ˜“è¿½è¸ª/è·Ÿè¸ªç»“æœã€‚é”®ã€å€¼ï¼ˆæœ‰æ•ˆè½½è·ï¼‰å’Œç›®æ ‡ Kafka ä¸»é¢˜ä»¥ BaseRecord çš„å½¢å¼è¡¨ç¤ºã€‚\nforiin1..100{println!(\u0026#34;sending message\u0026#34;);producer.send(BaseRecord::to(\u0026#34;rust\u0026#34;).key(\u0026amp;format!(\u0026#34;key-{}\u0026#34;,i)).payload(\u0026amp;format!(\u0026#34;value-{}\u0026#34;,i)),).expect(\u0026#34;failed to send message\u0026#34;);thread::sleep(Duration::from_secs(3));} ä½ å¯ä»¥åœ¨æ–‡ä»¶ src/1_producer_simple.rs ä¸­æŸ¥çœ‹æ•´ä¸ªä»£ç ã€‚\n è¦æµ‹è¯•ç”Ÿäº§è€…æ˜¯å¦åœ¨å·¥ä½œ \u0026hellip; è¿è¡Œè¿™æ®µä»£ç :\n åªéœ€å°†æ–‡ä»¶ src/1_producer_simple.rs é‡å‘½åä¸º main.rsã€‚ æ‰§è¡Œ cargo run  ä½ åº”è¯¥çœ‹åˆ°è¿™ä¸ªè¾“å‡º:\nsending message sending message sending message ... åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿè¦å¼„æ¸…æ¥š - ä½¿ç”¨ Kafka CLI æ¶ˆè´¹è€…ï¼ˆæˆ–å…¶ä»–æ¶ˆè´¹è€…å®¢æˆ·ç«¯ï¼Œå¦‚ kafkacatï¼‰è¿æ¥åˆ°ä½ çš„ Kafka ä¸»é¢˜ï¼ˆæˆ‘åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ä½¿ç”¨ rust ä½œä¸º Kafka ä¸»é¢˜çš„åç§°ï¼‰ã€‚ä½ åº”è¯¥çœ‹åˆ°æ¶ˆæ¯æµè¿›æ¥äº†ã€‚\nä¾‹å¦‚\n\u0026amp;KAFKA_HOME/bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic rust --from-beginning ç”Ÿäº§è€…å›è°ƒ æˆ‘ä»¬ç°åœ¨æ˜¯åœ¨çé£! é™¤éæˆ‘ä»¬æ˜ç¡®åœ°åˆ›å»ºä¸€ä¸ªæ¶ˆè´¹è€…æ¥æŸ¥çœ‹æˆ‘ä»¬çš„æ¶ˆæ¯ï¼Œå¦åˆ™æˆ‘ä»¬ä¸çŸ¥é“å®ƒä»¬æ˜¯å¦è¢«å‘é€åˆ° Kafkaã€‚è®©æˆ‘ä»¬é€šè¿‡å®ç° ProducerContext(trait)æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä»¥æŒ‚æ¥åˆ° produce äº‹ä»¶ - å®ƒå°±åƒä¸€ä¸ªå›è°ƒã€‚\né¦–å…ˆä¸º ClientContext trait åˆ›å»ºä¸€ä¸ªç»“æ„ä½“å’Œä¸€ä¸ªç©ºçš„å®ç°ï¼ˆè¿™æ˜¯å¿…é¡»çš„ï¼‰ã€‚\nstruct ProducerCallbackLogger;implClientContextforProducerCallbackLogger{}ç°åœ¨åˆ°äº†ä¸»è¦éƒ¨åˆ†ï¼Œæˆ‘ä»¬åœ¨ ProducerContext trait ä¸­å®ç° delivery å‡½æ•°ã€‚\nimplProducerContextforProduceCallbackLogger{type DeliveryOpaque=();fn delivery(\u0026amp;self,delivery_result: \u0026amp;rdkafka::producer::DeliveryResult\u0026lt;\u0026#39;_\u0026gt;,_delivery_opaque: Self::DeliveryOpaque,){letdr=delivery_result.as_ref();matchdr{Ok(msg)=\u0026gt;{letkey: \u0026amp;str =msg.key_view().unwrap().unwrap();println!(\u0026#34;produced message with key {} in offset {} of partition {}\u0026#34;,key,msg.offset(),msg.partition())}Err(producer_err)=\u0026gt;{letkey: \u0026amp;str =producer_err.1.key_view().unwrap().unwrap();println!(\u0026#34;failed to produce message with key {} - {}\u0026#34;,key,producer_err.0,)}}}}æˆ‘ä»¬æ ¹æ® DeliveryResult(æ¯•ç«Ÿå®ƒæ˜¯ä¸€ä¸ª Result)æ¥åŒ¹é…æˆåŠŸ(Ok)å’Œå¤±è´¥(Err)çš„æƒ…å†µã€‚æˆ‘ä»¬æ‰€åšçš„åªæ˜¯ç®€å•åœ°è®°å½•è¿™ä¸¤ç§æƒ…å†µä¸‹çš„æ¶ˆæ¯ï¼Œå› ä¸ºè¿™åªæ˜¯ä¸€ä¸ªä¾‹å­ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œåšä»»ä½•ä½ æƒ³åšçš„äº‹æƒ…ï¼ˆè™½ç„¶ä¸è¦å¤ªç–¯ç‹‚ï¼ï¼‰ã€‚\n æˆ‘ä»¬å¿½ç•¥äº† ProducerContext trait çš„å…³è”ç±»å‹ DeliveryOpaqueã€‚\n æˆ‘ä»¬éœ€è¦ç¡®ä¿æˆ‘ä»¬æ’å…¥äº† ProducerContext çš„å®ç°ã€‚æˆ‘ä»¬é€šè¿‡ä½¿ç”¨ create_with_context æ–¹æ³•ï¼ˆè€Œä¸æ˜¯ createï¼‰æ¥å®ç°ï¼Œå¹¶ç¡®ä¿ä¸º BaseProducer æä¾›æ­£ç¡®çš„ç±»å‹ã€‚\nletproducer: BaseProducer\u0026lt;ProduceCallbackLogger\u0026gt;=ClientConfig::new().set(....)....create_with_context(ProduceCallbackLogger{})...å¦‚ä½•è°ƒç”¨ \u0026ldquo;å›è°ƒ\u0026rdquo;ï¼Ÿ å¥½äº†ï¼Œæˆ‘ä»¬æœ‰äº†å®ç°ï¼Œä½†æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥è§¦å‘å®ƒ! å…¶ä¸­ä¸€ä¸ªæ–¹æ³•å°±æ˜¯åœ¨ç”Ÿäº§è€…ä¸Šè°ƒç”¨ flushã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæˆ‘ä»¬çš„ producer å†™æˆè¿™æ ·ã€‚\n æ·»åŠ  producer.flush(Duration::from_secs(3));, å¹¶ æ³¨é‡Šæ‰ sleep (just for now)  producer.send(BaseRecord::to(\u0026#34;rust\u0026#34;).key(\u0026amp;format!(\u0026#34;key-{}\u0026#34;,i)).payload(\u0026amp;format!(\u0026#34;value-{}\u0026#34;,i)),).expect(\u0026#34;failed to send message\u0026#34;);producer.flush(Duration::from_secs(3));println!(\u0026#34;flushed message\u0026#34;);//thread::sleep(Duration::from_secs(3)); ç­‰ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½ send æ–¹æ³•æ˜¯éé˜»å¡çš„ï¼ˆé»˜è®¤ï¼‰ï¼Œä½†é€šè¿‡åœ¨æ¯æ¬¡ send åè°ƒç”¨ flushï¼Œæˆ‘ä»¬ç°åœ¨å·²ç»å°†å…¶è½¬æ¢ä¸ºåŒæ­¥è°ƒç”¨ - ä»æ€§èƒ½è§’åº¦æ¥çœ‹ï¼Œä¸æ¨èä½¿ç”¨ã€‚\næˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ ThreadedProducer æ¥æ”¹å–„è¿™ç§æƒ…å†µã€‚å®ƒè´Ÿè´£åœ¨åå°çº¿ç¨‹ä¸­è°ƒç”¨ poll æ–¹æ³•ï¼Œä»¥ç¡®ä¿å‘é€å›è°ƒé€šçŸ¥çš„ä¼ é€’ã€‚è¿™æ ·åšéå¸¸ç®€å• - åªéœ€å°†ç±»å‹ä» BaseProducer æ”¹ä¸º ThreadedProducer å³å¯!\n#before: BaseProducer\u0026lt;ProduceCallbackLogger\u0026gt;#after: ThreadedProducer\u0026lt;ProduceCallbackLogger\u0026gt;è€Œä¸”ï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦å†è°ƒç”¨ flush äº†ã€‚\n...//producer.flush(Duration::from_secs(3)); //println!(\u0026#34;flushed message\u0026#34;); thread::sleep(Duration::from_secs(3));... ä»£ç åœ¨ src/2_threaded_producer.rs ä¸­å¯ä»¥æ‰¾åˆ°ã€‚\n å†æ¬¡è¿è¡Œè¯¥ç¨‹åº  å°†æ–‡ä»¶ src/2_threaded_producer.rs é‡å‘½åä¸º main.rsï¼Œå¹¶ä¸” æ‰§è¡Œ cargo run  è¾“å‡º:\nsending message sending message produced message with key key-1 in offset 6 of partition 2 produced message with key key-2 in offset 3 of partition 0 sending message produced message with key key-3 in offset 7 of partition 2 æ­£å¦‚é¢„æœŸçš„é‚£æ ·ï¼Œä½ åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°ç”Ÿäº§è€…äº‹ä»¶å›è°ƒï¼Œè¡¨ç¤ºæ¶ˆæ¯ç¡®å®è¢«å‘é€åˆ°äº† Kafka ä¸»é¢˜ã€‚å½“ç„¶ï¼Œä½ å¯ä»¥ç›´æ¥è¿æ¥åˆ°ä¸»é¢˜ï¼Œå¹¶å†æ¬¡æ£€æŸ¥ï¼Œå°±åƒä¹‹å‰ä¸€æ ·ã€‚\n\u0026amp;KAFKA_HOME/bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic rust --from-beginning  è¦å°è¯•å¤±è´¥çš„æƒ…å†µï¼Œè¯·å°è¯•ä½¿ç”¨ä¸€ä¸ªä¸æ­£ç¡®çš„ä¸»é¢˜åç§°ï¼Œå¹¶æ³¨æ„ delivery å®ç°çš„ Err å˜ä½“æ˜¯å¦‚ä½•è¢«è°ƒç”¨çš„ã€‚\n å‘é€ JSON æ¶ˆæ¯ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªæ˜¯å‘é€ String ä½œä¸º key å’Œ valueã€‚JSON æ˜¯ä¸€ç§å¸¸ç”¨çš„æ¶ˆæ¯æ ¼å¼ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨å®ƒã€‚\nå‡è®¾æˆ‘ä»¬è¦å‘é€ User ä¿¡æ¯ï¼Œå°†ä½¿ç”¨è¿™ä¸ªç»“æ„ä½“æ¥è¡¨ç¤ºã€‚\nstruct User{id: i32,email: String,}ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ serde_json åº“å°†å…¶åºåˆ—åŒ–ä¸º JSONã€‚æˆ‘ä»¬æ‰€éœ€è¦çš„å°±æ˜¯ä½¿ç”¨ serde ä¸­çš„è‡ªå®šä¹‰æ´¾ç”Ÿå‡½æ•° - Deserialize å’Œ Serializeã€‚\nuseserde::{Deserialize,Serialize};#[derive(Serialize, Deserialize, Debug)]struct User{id: i32,email: String,}ä¿®æ”¹ç”Ÿäº§è€…å¾ªç¯ã€‚  åˆ›å»ºä¸€ä¸ª User å®ä¾‹ ä½¿ç”¨ to_string_pretty å°†å…¶åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²ã€‚ åœ¨æœ‰æ•ˆè½½è·ä¸­åŠ å…¥è¿™ä¸€ç‚¹  ...letuser_json=serde_json::to_string_pretty(\u0026amp;user).expect(\u0026#34;json serialization failed\u0026#34;);producer.send(BaseRecord::to(\u0026#34;rust\u0026#34;).key(\u0026amp;format!(\u0026#34;user-{}\u0026#34;,i)).payload(\u0026amp;user_json),).expect(\u0026#34;failed to send message\u0026#34;);... ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ to_vec(è€Œä¸æ˜¯ to_string())å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªå­—èŠ‚çš„Vec(Vec\u0026lt;u8\u0026gt;)ã€‚\n è¦è¿è¡Œè¯¥ç¨‹åº\u0026hellip;  å°†æ–‡ä»¶ src/3_JSON_payload.rs é‡å‘½åä¸º main.rsï¼Œç„¶å æ‰§è¡Œ cargo run  ä»ä¸»é¢˜ä¸­æ¶ˆè´¹:\n\u0026amp;KAFKA_HOME/bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic rust --from-beginning ä½ åº”è¯¥çœ‹åˆ°å¸¦æœ‰ String çš„é”®ï¼ˆå¦‚ user-34ï¼‰å’Œ JSON å€¼çš„æ¶ˆæ¯ã€‚\n{ \u0026#34;id\u0026#34;: 34, \u0026#34;email\u0026#34;: \u0026#34;user-34@foobar.com\u0026#34; } æœ‰æ›´å¥½çš„æ–¹æ³•å—ï¼Ÿ æ˜¯çš„ï¼å¦‚æœä½ ä¹ æƒ¯äº† Kafka Java å®¢æˆ·ç«¯ä¸­çš„å£°æ˜å¼åºåˆ—åŒ–/å»åºåˆ—åŒ–æ–¹æ³•ï¼ˆå¯èƒ½å…¶ä»–å®¢æˆ·ç«¯ä¹Ÿä¸€æ ·ï¼‰ï¼Œä½ å¯èƒ½ä¸å–œæ¬¢è¿™ç§ \u0026ldquo;æ˜¾å¼\u0026rdquo; æ–¹æ³•ã€‚åªæ˜¯ä¸ºäº†è®©å¤§å®¶æ˜ç™½ï¼Œè¿™æ˜¯ä½ åœ¨ Java ä¸­çš„åšæ³•ã€‚\nProperties props = new Properties(); props.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, \u0026#34;localhost:9092\u0026#34;); props.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, \u0026#34;org.apache.kafka.common.serialization.StringSerializer\u0026#34;); props.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, \u0026#34;io.confluent.kafka.serializers.json.KafkaJsonSchemaSerializer\u0026#34;); .... ProducerRecord\u0026lt;String, User\u0026gt; record = new ProducerRecord\u0026lt;String, User\u0026gt;(topic, key, user); producer.send(record);  è¯·æ³¨æ„ï¼Œæ‚¨åªéœ€å°† Producer é…ç½®ä¸ºä½¿ç”¨ KafkaJsonSchemaSerializerï¼ŒUser ç±»å°±ä¼šè¢«åºåˆ—åŒ–ä¸º JSONã€‚\n rust-rdkafka ç”¨ ToBytes trait æä¾›äº†ç±»ä¼¼çš„ä¸œè¥¿ã€‚ä¸‹é¢æ˜¯å®ƒçš„æ ·å­ã€‚\npubtraitToBytes{/// Converts the provided data to bytes. fn to_bytes(\u0026amp;self)-\u0026gt; \u0026amp;[u8];}ä¸è¨€è€Œå–»å§ï¼ŸStringã€Vec\u0026lt;u8\u0026gt; ç­‰éƒ½æœ‰ç°æœ‰çš„å®ç°ã€‚æ‰€ä»¥ä½ å¯ä»¥ä½¿ç”¨è¿™äº›ç±»å‹ä½œä¸ºé”®æˆ–å€¼ï¼Œè€Œä¸éœ€è¦ä»»ä½•é¢å¤–çš„å·¥ä½œ - è¿™æ­£æ˜¯æˆ‘ä»¬åˆšåˆšåšçš„ã€‚ä½†é—®é¢˜æ˜¯æˆ‘ä»¬çš„æ–¹æ³•æ˜¯ \u0026ldquo;æ˜¾å¼\u0026rdquo; çš„ï¼Œå³æˆ‘ä»¬å°† User ç»“æ„è½¬æ¢ä¸º JSON å­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶ä¼ é€’å‡ºå»ã€‚\nå¦‚æœæˆ‘ä»¬å¯ä»¥ä¸º User å®ç° ToBytes å‘¢ï¼Ÿ implToBytesforUser{fn to_bytes(\u0026amp;self)-\u0026gt; \u0026amp;[u8]{letb=serde_json::to_vec_pretty(\u0026amp;self).expect(\u0026#34;json serialization failed\u0026#34;);b.as_slice()}}ä½ ä¼šçœ‹åˆ°ä¸€ä¸ªç¼–è¯‘å™¨é”™è¯¯ã€‚\ncannot return value referencing local variable `b` returns a value referencing data owned by the current function  æ›´å¤šçš„èƒŒæ™¯èµ„æ–™ï¼Œè¯·å‚è€ƒ GitHub çš„é—®é¢˜ã€‚æˆ‘å¾ˆä¹æ„çœ‹åˆ°å…¶ä»–å¯ä»¥ä¸ ToBytes ä¸€èµ·å·¥ä½œçš„ä¾‹å­ - å¦‚æœä½ æœ‰è¿™æ–¹é¢çš„æ„è§ï¼Œè¯·åœ¨ç•™è¨€ä¸­ç•™ä¸‹ã€‚\n TL;DRæ˜¯ï¼Œæœ€å¥½åšæŒç”¨ \u0026ldquo;æ˜¾å¼\u0026rdquo; çš„æ–¹å¼åšäº‹ï¼Œé™¤éä½ æœ‰ä¸€ä¸ª ToBytes çš„å®ç°ï¼Œ\u0026ldquo;ä¸æ¶‰åŠåˆ†é…ï¼Œä¸èƒ½å¤±è´¥\u0026rdquo;ã€‚\næ€»ç»“ ç¬¬ä¸€éƒ¨åˆ†å°±åˆ°è¿™é‡Œã€‚ç¬¬äºŒéƒ¨åˆ†å°†æ¶‰åŠå›´ç»• Kafka æ¶ˆè´¹è€…çš„è¯é¢˜ã€‚\nåŸæ–‡é“¾æ¥: https://dev.to/abhirockzz/getting-started-with-kafka-and-rust-part-1-4hkb\n","permalink":"https://ohmyweekly.github.io/notes/2021-04-14-getting-started-with-kafka-and-rust-part1/","tags":["Rust"],"title":"Kafka å’Œ Rustå…¥é—¨ - ç¬¬ä¸€éƒ¨åˆ†"},{"categories":["rustlang","error"],"contents":"ã€ŠRust ç¼–ç¨‹è¯­è¨€ã€‹ä¸­çš„ç¤ºä¾‹é¡¹ç›®å¯¹äºå‘æ–°çš„æ½œåœ¨ Rustaceans ä»‹ç» Rust çš„ä¸åŒæ–¹é¢å’Œç‰¹æ€§æ˜¯éå¸¸å¥½çš„ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡æ‰©å±•ã€ŠRust ç¼–ç¨‹è¯­è¨€ã€‹ä¸­çš„ minigrep é¡¹ç›®ï¼Œçœ‹çœ‹å®ç°æ›´å¼ºå¤§çš„é”™è¯¯å¤„ç†åŸºç¡€æ¶æ„çš„ä¸€äº›ä¸åŒæ–¹æ³•ã€‚\nminigrep é¡¹ç›®åœ¨ç¬¬12ç« ä¸­ä»‹ç»ï¼Œå®ƒå¼•å¯¼è¯»è€…æ„å»ºä¸€ä¸ªç®€å•ç‰ˆæœ¬çš„ grep å‘½ä»¤è¡Œå·¥å…·ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºæœç´¢æ–‡æœ¬çš„å·¥å…·ã€‚ä¾‹å¦‚ï¼Œä½ ä¼šä¼ å…¥ä¸€ä¸ªæŸ¥è¯¢ï¼Œä½ è¦æœç´¢çš„æ–‡æœ¬ï¼Œä»¥åŠæ–‡æœ¬æ‰€åœ¨çš„æ–‡ä»¶åï¼Œç„¶åå¾—åˆ°åŒ…å«æŸ¥è¯¢æ–‡æœ¬çš„æ‰€æœ‰è¡Œã€‚\nè¿™ç¯‡æ–‡ç« çš„ç›®æ ‡æ˜¯ç”¨æ›´å¼ºå¤§çš„é”™è¯¯å¤„ç†æ¨¡å¼æ¥æ‰©å±•æœ¬ä¹¦çš„ minigrep å®ç°ï¼Œè¿™æ ·ä½ å°±èƒ½æ›´å¥½åœ°äº†è§£ Rust é¡¹ç›®ä¸­å¤„ç†é”™è¯¯çš„ä¸åŒæ–¹æ³•ã€‚\nä½œä¸ºå‚è€ƒï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æœ¬ä¹¦çš„ minigrep ç‰ˆæœ¬çš„æœ€ç»ˆä»£ç ã€‚\né”™è¯¯å¤„ç†ç”¨ä¾‹ å½“æ¶‰åŠåˆ° Rust é¡¹ç›®çš„ç»“æ„æ—¶ï¼Œä¸€ä¸ªå¸¸è§çš„æ¨¡å¼æ˜¯æœ‰ä¸€ä¸ª \u0026ldquo;åº“\u0026rdquo; çš„éƒ¨åˆ†å’Œä¸€ä¸ª \u0026ldquo;åº”ç”¨\u0026rdquo; çš„éƒ¨åˆ†ï¼Œå‰è€…æ˜¯ä¸»è¦çš„æ•°æ®ç»“æ„ã€å‡½æ•°å’Œé€»è¾‘ï¼Œåè€…æ˜¯å°†åº“å‡½æ•°è”ç³»åœ¨ä¸€èµ·ã€‚\nä½ å¯ä»¥åœ¨åŸå§‹ minigrep ä»£ç çš„æ–‡ä»¶ç»“æ„ä¸­çœ‹åˆ°è¿™ä¸€ç‚¹ï¼šåº”ç”¨é€»è¾‘å­˜åœ¨äº src/bin/main.rs æ–‡ä»¶ä¸­ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªè–„è–„çš„åŒ…è£¹ï¼ŒåŒ…è£¹ç€åœ¨ src/lib.rs æ–‡ä»¶ä¸­å®šä¹‰çš„æ•°æ®ç»“æ„å’Œå‡½æ•°ï¼›ä¸»å‡½æ•°æ‰€åšçš„å°±æ˜¯è°ƒç”¨ minigrep::runã€‚\nè¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå› ä¸ºå–å†³äºæˆ‘ä»¬æ˜¯åœ¨æ„å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºè¿˜æ˜¯ä¸€ä¸ªåº“ï¼Œä¼šæ”¹å˜æˆ‘ä»¬å¤„ç†é”™è¯¯çš„æ–¹å¼ã€‚\nå½“æ¶‰åŠåˆ°ä¸€ä¸ªåº”ç”¨ç¨‹åºæ—¶ï¼Œæœ€ç»ˆç”¨æˆ·å¾ˆå¯èƒ½ä¸æƒ³çŸ¥é“æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´äº†ä¸€ä¸ªé”™è¯¯çš„çç¢ç»†èŠ‚ã€‚äº‹å®ä¸Šï¼Œåº”ç”¨ç¨‹åºçš„æœ€ç»ˆç”¨æˆ·å¯èƒ½åªåº”è¯¥åœ¨é”™è¯¯æ— æ³•æ¢å¤çš„æƒ…å†µä¸‹è¢«é€šçŸ¥é”™è¯¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæä¾›å…³äºä¸ºä»€ä¹ˆå‘ç”Ÿä¸å¯æ¢å¤çš„é”™è¯¯çš„ç»†èŠ‚ä¹Ÿæ˜¯æœ‰ç”¨çš„ï¼Œç‰¹åˆ«æ˜¯å½“å®ƒä¸ç”¨æˆ·è¾“å…¥æœ‰å…³æ—¶ã€‚å¦‚æœæŸç§å¯æ¢å¤çš„é”™è¯¯å‘ç”Ÿåœ¨åå°ï¼Œåº”ç”¨ç¨‹åºçš„æ¶ˆè´¹è€…å¯èƒ½ä¸éœ€è¦çŸ¥é“å®ƒã€‚\nç›¸åï¼Œå½“æ¶‰åŠåˆ°ä¸€ä¸ªåº“æ—¶ï¼Œæœ€ç»ˆç”¨æˆ·æ˜¯å…¶ä»–å¼€å‘äººå‘˜ï¼Œä»–ä»¬æ­£åœ¨ä½¿ç”¨è¯¥åº“å¹¶åœ¨å…¶ä¹‹ä¸Šæ„å»ºä¸€äº›ä¸œè¥¿ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›å°½å¯èƒ½å¤šåœ°æä¾›å…³äºæˆ‘ä»¬çš„åº“ä¸­å‘ç”Ÿçš„ä»»ä½•é”™è¯¯çš„ç›¸å…³ç»†èŠ‚ã€‚ç„¶åï¼Œåº“çš„æ¶ˆè´¹è€…å°†å†³å®šä»–ä»¬æƒ³è¦å¦‚ä½•å¤„ç†è¿™äº›é”™è¯¯ã€‚\né‚£ä¹ˆï¼Œå½“æˆ‘ä»¬çš„é¡¹ç›®ä¸­æ—¢æœ‰åº“éƒ¨åˆ†åˆæœ‰åº”ç”¨éƒ¨åˆ†æ—¶ï¼Œè¿™ä¸¤ç§æ–¹æ³•æ˜¯å¦‚ä½•ä¸€èµ·å‘æŒ¥ä½œç”¨çš„å‘¢ï¼Ÿmain å‡½æ•°æ‰§è¡Œ minigrep::run å‡½æ•°ï¼Œå¹¶è¾“å‡ºç»“æœä¸­å‡ºç°çš„ä»»ä½•é”™è¯¯ã€‚æ‰€ä»¥æˆ‘ä»¬å¤§éƒ¨åˆ†çš„é”™è¯¯å¤„ç†å·¥ä½œå°†é›†ä¸­åœ¨åº“éƒ¨åˆ†ã€‚\næµ®ç°åº“é”™è¯¯ åœ¨ src/lib.rs ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªå‡½æ•°ï¼ŒConfig::new å’Œ runï¼Œå®ƒä»¬å¯èƒ½ä¼šè¿”å›é”™è¯¯ã€‚\nimplConfig{pubfn new(mutargs: env::Args)-\u0026gt; Result\u0026lt;Config,\u0026amp;\u0026#39;staticstr\u0026gt;{args.next();letquery=matchargs.next(){Some(arg)=\u0026gt;arg,None=\u0026gt;returnErr(\u0026#34;Didn\u0026#39;t get a query string\u0026#34;),};letfilename=matchargs.next(){Some(arg)=\u0026gt;arg,None=\u0026gt;returnErr(\u0026#34;Didn\u0026#39;t get a file name\u0026#34;),};letcase_sensitive=env::var(\u0026#34;CASE_INSENSITIVE\u0026#34;).is_err();Ok(Config{query,filename,case_sensitive,})}pubfn run(config: Config)-\u0026gt; Result\u0026lt;(),Box\u0026lt;dynError\u0026gt;\u0026gt;{letcontents=fs::read_to_string(config.filename)?;letresults=ifconfig.case_sensitive{search(\u0026amp;config.query,\u0026amp;contents)}else{search_case_insensitive(\u0026amp;config.query,\u0026amp;contents)};forlineinresults{println!(\u0026#34;{}\u0026#34;,line);}Ok(())}ç¡®åˆ‡æœ‰ä¸‰ä¸ªåœ°æ–¹åœ¨è¿”å›é”™è¯¯ï¼šä¸¤ä¸ªé”™è¯¯å‘ç”Ÿåœ¨ Config::new å‡½æ•°ä¸­ï¼Œè¯¥å‡½æ•°è¿”å›ä¸€ä¸ª Result\u0026lt;Configï¼Œ\u0026amp;'static str\u0026gt;ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒResult çš„é”™è¯¯å˜ä½“æ˜¯ä¸€ä¸ªé™æ€å­—ç¬¦ä¸²åˆ‡ç‰‡ã€‚\nåœ¨è¿™é‡Œï¼Œå½“ç”¨æˆ·æ²¡æœ‰æä¾›æŸ¥è¯¢æ—¶ï¼Œæˆ‘ä»¬ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚\nletquery=matchargs.next(){Some(arg)=\u0026gt;arg,None=\u0026gt;returnErr(\u0026#34;Didn\u0026#39;t get a query string\u0026#34;),};è¿™é‡Œï¼Œå½“ç”¨æˆ·æ²¡æœ‰æä¾›æ–‡ä»¶åæ—¶ï¼Œæˆ‘ä»¬ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚\nletfilename=matchargs.next(){Some(arg)=\u0026gt;arg,None=\u0026gt;returnErr(\u0026#34;Didn\u0026#39;t get a file name\u0026#34;),};ä»¥è¿™ç§æ–¹å¼å°†é”™è¯¯ç»“æ„åŒ–ä¸ºé™æ€å­—ç¬¦ä¸²çš„ä¸»è¦é—®é¢˜æ˜¯ï¼Œé”™è¯¯ä¿¡æ¯å¹¶æ²¡æœ‰è¢«æ”¾ç½®åœ¨ä¸€ä¸ªä¸­å¿ƒä½ç½®ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°é‡æ„å®ƒä»¬ã€‚è¿™ä¹Ÿä½¿å¾—æˆ‘ä»¬æ›´éš¾åœ¨ç›¸åŒç±»å‹çš„é”™è¯¯ä¹‹é—´ä¿æŒé”™è¯¯ä¿¡æ¯çš„ä¸€è‡´æ€§ã€‚\nç¬¬ä¸‰ç§é”™è¯¯å‘ç”Ÿåœ¨ run å‡½æ•°çš„é¡¶éƒ¨ï¼Œå®ƒè¿”å›ä¸€ä¸ª Result\u0026lt;(), Box\u0026lt;dyn Error\u0026gt;\u0026gt;ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé”™è¯¯å˜ä½“æ˜¯ä¸€ä¸ªå®ç° Error trait çš„ trait å¯¹è±¡ã€‚æ¢å¥è¯è¯´ï¼Œè¿™ä¸ªå‡½æ•°çš„é”™è¯¯å˜ä½“æ˜¯å®ç° Error trait çš„ç±»å‹çš„ä»»ä½•å®ä¾‹ã€‚\nåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†è°ƒç”¨ fs::read_to_string æ—¶å¯èƒ½å‘ç”Ÿçš„ä»»ä½•é”™è¯¯å†’å‡ºæ¥ã€‚\nletcontents=fs::read_to_string(config.filename)?;è¿™é€‚ç”¨äºè°ƒç”¨ fs::read_to_string æ—¶å¯èƒ½å‡ºç°çš„é”™è¯¯ï¼Œå› ä¸ºè¿™ä¸ªå‡½æ•°èƒ½å¤Ÿè¿”å›å¤šç§ç±»å‹çš„é”™è¯¯ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥è¡¨ç¤ºè¿™äº›ä¸åŒçš„å¯èƒ½çš„é”™è¯¯ç±»å‹ï¼›å®ƒä»¬ä¹‹é—´çš„å…±åŒç‚¹æ˜¯å®ƒä»¬éƒ½å®ç°äº† Error traitï¼æœ€ç»ˆï¼Œæˆ‘ä»¬è¦åšçš„æ˜¯å®šä¹‰æ‰€æœ‰è¿™äº›é”™è¯¯ç±»å‹ã€‚\næœ€ç»ˆï¼Œæˆ‘ä»¬è¦åšçš„æ˜¯åœ¨ä¸€ä¸ªä¸­å¿ƒä½ç½®å®šä¹‰æ‰€æœ‰è¿™äº›ä¸åŒç±»å‹çš„é”™è¯¯ï¼Œå¹¶è®©å®ƒä»¬éƒ½æˆä¸ºå•ä¸€ç±»å‹çš„å˜ä½“ã€‚\nåœ¨ä¸€ä¸ªä¸­å¿ƒç±»å‹ä¸­å®šä¹‰é”™è¯¯å˜ç§ æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªæ–°çš„ src/error.rs æ–‡ä»¶ï¼Œå¹¶å®šä¹‰ä¸€ä¸ªæšä¸¾ AppErrorï¼Œå¹¶åœ¨æ­¤è¿‡ç¨‹ä¸­æ´¾ç”Ÿå‡º Debug traitï¼Œä»¥ä¾¿æˆ‘ä»¬åœ¨éœ€è¦æ—¶å¯ä»¥å¾—åˆ°ä¸€ä¸ªè°ƒè¯•è¡¨ç¤ºã€‚æˆ‘ä»¬å°†ä¸ºè¿™ä¸ªæšä¸¾çš„æ¯ä¸€ä¸ªå˜ä½“å‘½åï¼Œä½¿å®ƒä»¬æ°å½“åœ°ä»£è¡¨ä¸‰ç§ç±»å‹çš„é”™è¯¯ã€‚\n#[derive(Debug)]pubenum AppError{MissingQuery,MissingFilename,ConfigLoad,}ç¬¬ä¸‰ä¸ªå˜ä½“ï¼ŒConfigLoadï¼Œæ˜ å°„åˆ° Config::run å‡½æ•°ä¸­è°ƒç”¨ fs::read_to_string æ—¶å¯èƒ½å‡ºç°çš„é”™è¯¯ã€‚ä¹ä¸€çœ‹ï¼Œè¿™ä¼¼ä¹æœ‰ç‚¹ä¸å¦¥ï¼Œå› ä¸ºå¦‚æœè¯¥å‡½æ•°å‡ºç°é”™è¯¯ï¼Œé‚£å°±æ˜¯åœ¨è¯»å–æä¾›çš„é…ç½®æ–‡ä»¶æ—¶å‡ºç°äº†æŸç§I/Oé—®é¢˜ã€‚é‚£ä¹ˆæˆ‘ä»¬ä¸ºä»€ä¹ˆä¸æŠŠå®ƒå‘½åä¸º IOError æˆ–è€…ç±»ä¼¼çš„ä¸œè¥¿å‘¢ï¼Ÿ\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”±äºæˆ‘ä»¬æ˜¯å°†ä¸€ä¸ªæ ‡å‡†åº“å‡½æ•°çš„é”™è¯¯æµ®å‡ºæ°´é¢ï¼Œæ‰€ä»¥æè¿°æµ®å‡ºæ°´é¢çš„é”™è¯¯æ˜¯å¦‚ä½•å½±å“å®ƒçš„ï¼Œè€Œä¸æ˜¯ç®€å•åœ°é‡ç”³å®ƒï¼Œè¿™ä¸æˆ‘ä»¬çš„åº”ç”¨æ›´ç›¸å…³ã€‚å½“ fs::read_to_string å‘ç”Ÿé”™è¯¯æ—¶ï¼Œä¼šé˜»æ­¢æˆ‘ä»¬çš„ Config åŠ è½½ï¼Œæ‰€ä»¥è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬æŠŠå®ƒå‘½åä¸º ConfigLoadã€‚\nç°åœ¨æˆ‘ä»¬æœ‰äº†è¿™ä¸ªç±»å‹ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–°ä»£ç ä¸­æ‰€æœ‰è¿”å›é”™è¯¯çš„åœ°æ–¹ä»¥åˆ©ç”¨è¿™ä¸ª AppError æšä¸¾ã€‚\nè¿”å› AppError çš„å˜ä½“ åœ¨æˆ‘ä»¬çš„ src/lib.rs æ–‡ä»¶çš„é¡¶éƒ¨ï¼Œæˆ‘ä»¬éœ€è¦å£°æ˜æˆ‘ä»¬çš„é”™è¯¯æ¨¡å—ï¼Œå¹¶å°† error::AppError å¸¦å…¥ä½œç”¨åŸŸã€‚\nmod error;useerror::AppError;åœ¨æˆ‘ä»¬çš„ Config::new å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ›´æ–°æˆ‘ä»¬ä½œä¸ºé”™è¯¯è¿”å›é™æ€å­—ç¬¦ä¸²åˆ‡ç‰‡çš„åœ°æ–¹ï¼Œä»¥åŠå‡½æ•°æœ¬èº«çš„è¿”å›ç±»å‹ã€‚\n-pubfn new(mutargs: env::Args)-\u0026gt; Result\u0026lt;Config,\u0026amp;\u0026#39;staticstr\u0026gt;+pubfn new(mutargs: env::Args)-\u0026gt; Result\u0026lt;Config,AppError\u0026gt;// --snip-- letquery=matchargs.next(){Some(arg)=\u0026gt;arg,-None=\u0026gt;returnErr(\u0026#34;Didn\u0026#39;t get a query string\u0026#34;),+None=\u0026gt;returnErr(AppError::MissingQuery),};letfilename=matchargs.next(){Some(arg)=\u0026gt;arg,-None=\u0026gt;returnErr(\u0026#34;Didn\u0026#39;t get a file name\u0026#34;),+None=\u0026gt;returnErr(AppError::MissingFilename),};// --snip-- è¿è¡Œå‡½æ•°ä¸­çš„ç¬¬ä¸‰ä¸ªé”™è¯¯ï¼Œåªéœ€è¦æˆ‘ä»¬æ›´æ–°å®ƒçš„è¿”å›ç±»å‹ï¼Œå› ä¸º ? æ“ä½œç¬¦å·²ç»è´Ÿè´£å°†é”™è¯¯å†’å‡ºæ¥ï¼Œå¹¶åœ¨å‘ç”Ÿæ—¶è¿”å›ã€‚\n-pubfn run(config: Config)-\u0026gt; Result\u0026lt;(),Box\u0026lt;dynError\u0026gt;\u0026gt;+pubfn run(config: Config)-\u0026gt; Result\u0026lt;(),AppError\u0026gt;å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨æˆ‘ä»¬çš„é”™è¯¯å˜ä½“ï¼Œä¸€æ—¦å‘ç”Ÿï¼Œè¿™äº›é”™è¯¯å˜ä½“å°†è¢«æµ®ç°åˆ°æˆ‘ä»¬çš„ main å‡½æ•°ä¸­å¹¶æ‰“å°å‡ºæ¥ã€‚ä½†æ˜¯æˆ‘ä»¬ä¸å†æœ‰ä¹‹å‰å®šä¹‰çš„å®é™…é”™è¯¯ä¿¡æ¯äº†ï¼æˆ‘ä»¬å¯ä»¥ç”¨ thiserror æ³¨é‡Šé”™è¯¯å˜ä½“ã€‚\nç”¨ thiserror æ³¨é‡Šé”™è¯¯å˜ä½“ thiserror crate æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„å·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€ç§ç¬¦åˆäººä½“å·¥ç¨‹å­¦çš„æ–¹å¼æ¥æ ¼å¼åŒ– Rust åº“ä¸­çš„é”™è¯¯ä¿¡æ¯ã€‚\nå®ƒå…è®¸æˆ‘ä»¬åœ¨ AppError æšä¸¾ä¸­ç”¨æˆ‘ä»¬å¸Œæœ›æ˜¾ç¤ºç»™æœ€ç»ˆç”¨æˆ·çš„å®é™…é”™è¯¯ä¿¡æ¯æ¥æ³¨è§£æ¯ä¸ªå˜ä½“ã€‚\nè®©æˆ‘ä»¬åœ¨ Cargo.toml ä¸­æ·»åŠ å®ƒä½œä¸ºä¾èµ–ã€‚\n[dependencies] thiserror = \u0026#34;1\u0026#34; åœ¨ src/error.rs ä¸­ï¼Œæˆ‘ä»¬å°†æŠŠ thiserror::Error trait å¸¦å…¥ä½œç”¨åŸŸï¼Œå¹¶è®©æˆ‘ä»¬çš„ AppError ç±»å‹æ´¾ç”Ÿå®ƒã€‚æˆ‘ä»¬éœ€è¦æ´¾ç”Ÿè¿™ä¸ª traitï¼Œä»¥ä¾¿ç”¨ #[error] å—æ¥æ³¨è§£æ¯ä¸ªæšä¸¾å˜é‡ã€‚ç°åœ¨æˆ‘ä»¬æŒ‡å®šæˆ‘ä»¬å¸Œæœ›ä¸ºæ¯ä¸ªç‰¹å®šå˜é‡æ˜¾ç¤ºçš„é”™è¯¯ä¿¡æ¯ã€‚\n+usestd::io;+usethiserror::Error;-#[derive(Debug)]+#[derive(Debug, Error)]pubenum AppError{+#[error(\u0026#34;Didn\u0026#39;t get a query string\u0026#34;)]MissingQuery,+#[error(\u0026#34;Didn\u0026#39;t get a file name\u0026#34;)]MissingFilename,+#[error(\u0026#34;Could not load config\u0026#34;)]ConfigLoad{+#[from]+source: io::Error,+}}ConfigLoad å˜ä½“ä¸­å¢åŠ äº†ä»€ä¹ˆé¢å¤–çš„ä¸œè¥¿ï¼Ÿç”±äº ConfigLoad é”™è¯¯åªæœ‰åœ¨è°ƒç”¨ fs::read_to_string å‡ºç°åº•å±‚é”™è¯¯æ—¶æ‰ä¼šå‘ç”Ÿï¼Œæ‰€ä»¥ ConfigLoad å˜ä½“å®é™…ä¸Šåšçš„æ˜¯å›´ç»•åº•å±‚I/Oé”™è¯¯æä¾›é¢å¤–çš„ä¸Šä¸‹æ–‡ã€‚\nthiserror å…è®¸æˆ‘ä»¬é€šè¿‡ç”¨ #[from] æ¥æ³¨è§£ä¸€ä¸ªä½çº§é”™è¯¯ï¼Œä»¥å°†æºç è½¬æ¢ä¸ºæˆ‘ä»¬è‡ªåˆ¶çš„é”™è¯¯ç±»å‹ï¼Œä»è€Œå°†å…¶åŒ…è£¹åœ¨é¢å¤–çš„ä¸Šä¸‹æ–‡ä¸­ã€‚è¿™æ ·ä¸€æ¥ï¼Œå½“ä¸€ä¸ªI/Oé”™è¯¯å‘ç”Ÿæ—¶ï¼ˆæ¯”å¦‚æˆ‘ä»¬æŒ‡å®šäº†ä¸€ä¸ªè¦æœç´¢çš„æ–‡ä»¶ï¼Œä½†å®é™…ä¸Šå¹¶ä¸å­˜åœ¨ï¼‰ï¼Œæˆ‘ä»¬å°±ä¼šå¾—åˆ°è¿™æ ·ä¸€ä¸ªé”™è¯¯ã€‚\nCould not load config: Os { code: 2, kind: NotFound, message: \u0026quot;No such file or directory\u0026quot; } å¦‚æœæ²¡æœ‰å®ƒï¼Œäº§ç”Ÿçš„é”™è¯¯ä¿¡æ¯çœ‹èµ·æ¥åƒè¿™æ ·ã€‚\nOs { code: 2, kind: NotFound, message: \u0026quot;No such file or directory\u0026quot; } å¯¹äºæˆ‘ä»¬åº“çš„æ¶ˆè´¹è€…æ¥è¯´ï¼Œè¦æƒ³æ‰¾å‡ºè¿™ä¸ªé”™è¯¯çš„æ¥æºæ˜¯æ¯”è¾ƒå›°éš¾çš„ï¼Œé¢å¤–çš„ä¸Šä¸‹æ–‡å¸®åŠ©å¾ˆå¤§ã€‚\nä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ä½¿ç”¨è¿™ä¸ªé”™è¯¯çš„ minigrep ç‰ˆæœ¬ã€‚\næ›´åŠ æ‰‹åŠ¨çš„æ–¹æ³• ç°åœ¨ï¼Œæˆ‘ä»¬å°†æ¢ä¸ªè§’åº¦ï¼Œçœ‹çœ‹å¦‚ä½•åœ¨ä¸å°†å…¶ä½œä¸ºä¾èµ–çš„æƒ…å†µä¸‹ï¼Œå®ç°ä¸ thiserror ç›¸åŒçš„ç»“æœã€‚\nåœ¨å¼•æ“ç›–ä¸‹ï¼Œthiserror ç”¨ç¨‹åºå®æ‰§è¡Œäº†ä¸€äº›é­”æ³•ï¼Œè¿™å¯¹ç¼–è¯‘é€Ÿåº¦æœ‰æ˜æ˜¾çš„å½±å“ã€‚åœ¨ minigrep çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„é”™è¯¯å˜ä½“å¾ˆå°‘ï¼Œè€Œä¸”é¡¹ç›®ä¹Ÿå¾ˆå°ï¼Œæ‰€ä»¥ä¾èµ– thiserror å¹¶ä¸ä¼šå¢åŠ å¤šå°‘ç¼–è¯‘æ—¶é—´ï¼Œä½†æ˜¯åœ¨ä¸€ä¸ªæ›´å¤§æ›´å¤æ‚çš„é¡¹ç›®ä¸­ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªè€ƒè™‘å› ç´ ã€‚\næ‰€ä»¥åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæˆ‘ä»¬å°†æŠŠè¿™ç¯‡æ–‡ç« æ’•æ‰ï¼Œæ¢æˆæˆ‘ä»¬è‡ªå·±çš„æ‰‹åŠ¨å®ç°æ¥ç»“æŸè¿™ç¯‡æ–‡ç« ã€‚èµ°è¿™æ¡è·¯çš„å¥½å¤„æ˜¯ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ src/error.rs æ–‡ä»¶å°±å¯ä»¥å®ç°æ‰€æœ‰å¿…è¦çš„æ”¹å˜ï¼ˆå½“ç„¶ï¼Œé™¤äº†ä»æˆ‘ä»¬çš„ Cargo.toml ä¸­åˆ é™¤ thiserror ä¹‹å¤–ï¼‰ã€‚\n[dependencies] - thiserror = \u0026#34;1\u0026#34; è®©æˆ‘ä»¬åˆ é™¤æ‰€æœ‰ thiserror æä¾›ç»™æˆ‘ä»¬çš„æ³¨é‡Šã€‚æˆ‘ä»¬è¿˜å°†ç”¨ std::error::Error trait æ›¿æ¢ thiserror::Error traitã€‚\n-usethiserror::Error;+usestd::error::Error;-#[derive(Debug, Error)]+#[derive(Error)]pubenum AppError{-#[error(\u0026#34;Didn\u0026#39;t get a query string\u0026#34;)]MissingQuery,-#[error(\u0026#34;Didn\u0026#39;t get a file name\u0026#34;)]MissingFilename,-#[error(\u0026#34;Could not load config\u0026#34;)]ConfigLoad{-#[from]source: io::Error,}}ä¸ºäº†æ¢å¤æˆ‘ä»¬åˆšåˆšæ“¦é™¤çš„æ‰€æœ‰åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦åšä¸‰ä»¶äº‹ã€‚\n ä¸º AppError å®ç° Display traitï¼Œè¿™æ ·æˆ‘ä»¬çš„é”™è¯¯å˜ä½“å°±å¯ä»¥æ˜¾ç¤ºç»™ç”¨æˆ·äº†ã€‚ ä¸º AppError å®ç° Error traitã€‚è¿™ä¸ª trait ä»£è¡¨äº†å¯¹é”™è¯¯ç±»å‹çš„åŸºæœ¬æœŸæœ›ï¼Œå³å®ƒä»¬å®ç°äº† Display å’Œ Debugï¼Œå†åŠ ä¸Šè·å–é”™è¯¯åº•å±‚æºæˆ–åŸå› çš„èƒ½åŠ›ã€‚ ä¸º AppError å®ç° From\u0026lt;io::Error\u0026gt;ã€‚è¿™æ˜¯å¿…è¦çš„ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å°†ä» fs::read_to_string è¿”å›çš„I/Oé”™è¯¯è½¬æ¢ä¸º AppError çš„å®ä¾‹ã€‚  è¿™é‡Œæ˜¯æˆ‘ä»¬å¯¹ AppError çš„ Display trait çš„å®ç°ã€‚å®ƒå°†æ¯ä¸ªé”™è¯¯å˜é‡æ˜ å°„ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶å†™å…¥åˆ° Display formatter ä¸­ã€‚\nusestd::fmt;implfmt::DisplayforAppError{fn fmt(\u0026amp;self,f: \u0026amp;mutfmt::Formatter\u0026lt;\u0026#39;_\u0026gt;)-\u0026gt; fmt::Result{matchself{Self::MissingQuery=\u0026gt;f.write_str(\u0026#34;Didn\u0026#39;t get a query string\u0026#34;),Self::MissingFilename=\u0026gt;f.write_str(\u0026#34;Didn\u0026#39;t get a file name\u0026#34;),Self::ConfigLoad{source}=\u0026gt;write!(f,\u0026#34;Could not load config: {}\u0026#34;,source),}}}è€Œè¿™å°±æ˜¯æˆ‘ä»¬å¯¹ Error trait çš„å®ç°ã€‚è¦å®ç°çš„ä¸»è¦æ–¹æ³•æ˜¯ Error::source æ–¹æ³•ï¼Œå®ƒçš„ç›®çš„æ˜¯æä¾›é”™è¯¯æºçš„ä¿¡æ¯ã€‚å¯¹äºæˆ‘ä»¬çš„ AppError ç±»å‹ï¼Œåªæœ‰ ConfigLoad ä¼šæš´éœ²ä»»ä½•åº•å±‚æºä¿¡æ¯ï¼Œå³è°ƒç”¨ fs::read_to_string å¯èƒ½å‘ç”Ÿçš„I/Oé”™è¯¯ã€‚åœ¨å…¶ä»–é”™è¯¯å˜ä½“çš„æƒ…å†µä¸‹ï¼Œæ²¡æœ‰åº•å±‚çš„æºä¿¡æ¯éœ€è¦æš´éœ²ã€‚\nusestd::error;implerror::ErrorforAppError{fn source(\u0026amp;self)-\u0026gt; Option\u0026lt;\u0026amp;(dynError+\u0026#39;static)\u0026gt;{matchself{Self::ConfigLoad{source}=\u0026gt;Some(source),_=\u0026gt;None,}}}è¿”å›ç±»å‹çš„ \u0026amp;(dyn Error + 'static') éƒ¨åˆ†ç±»ä¼¼äºæˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„ Box\u0026lt;dyn Error\u0026gt; trait å¯¹è±¡ã€‚è¿™é‡Œçš„ä¸»è¦åŒºåˆ«æ˜¯ï¼Œtrait å¯¹è±¡æ˜¯åœ¨ä¸€ä¸ªä¸å¯å˜çš„å¼•ç”¨åé¢ï¼Œè€Œä¸æ˜¯ Box æŒ‡é’ˆã€‚è¿™é‡Œçš„ 'static lifetime æ„å‘³ç€ trait å¯¹è±¡æœ¬èº«åªåŒ…å«æ‹¥æœ‰çš„å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå†…éƒ¨ä¸å­˜å‚¨ä»»ä½•å¼•ç”¨ã€‚è¿™æ˜¯å¿…è¦çš„ï¼Œä»¥ä¾¿è®©ç¼–è¯‘å™¨ç¡®ä¿¡è¿™é‡Œæ²¡æœ‰æ‚¬ç©ºæŒ‡é’ˆçš„æœºä¼šã€‚\næœ€åï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§å°† io::Error è½¬æ¢ä¸º AppError çš„æ–¹æ³•ã€‚æˆ‘ä»¬å°†é€šè¿‡ä¸º AppError for From\u0026lt;io::error\u0026gt; æ¥å®ç°ã€‚\nimplFrom\u0026lt;io::Error\u0026gt;forAppError{fn from(source: io::Error)-\u0026gt; Self{Self::ConfigLoad{source}}}è¿™ä¸ªæ²¡ä»€ä¹ˆå¥½è¯´çš„ã€‚å¦‚æœæˆ‘ä»¬å¾—åˆ°ä¸€ä¸ª io::Errorï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯å°†å…¶è½¬æ¢ä¸º AppErrorï¼Œå¹¶å°†å…¶å°è£…åœ¨ ConfigLoad å˜ä½“ä¸­ã€‚\nè¿™å°±æ˜¯å…¨éƒ¨äº†ï¼Œä¼™è®¡ä»¬ ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°è¿™ä¸ªç‰ˆæœ¬çš„ minigrep å®ç°ã€‚\næ€»ç»“ æœ€åï¼Œæˆ‘ä»¬è®¨è®ºäº†ã€ŠRustç¼–ç¨‹è¯­è¨€ã€‹ä¸€ä¹¦ä¸­ä»‹ç»çš„åŸå§‹ minigrep å®ç°åœ¨é”™è¯¯å¤„ç†æ–¹é¢æ˜¯å¦‚ä½•æœ‰ç‚¹æ¬ ç¼ºçš„ï¼Œä»¥åŠå¦‚ä½•è€ƒè™‘ä¸åŒçš„é”™è¯¯å¤„ç†ç”¨ä¾‹ã€‚\nä»é‚£é‡Œï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ thiserror crate å°†æ‰€æœ‰å¯èƒ½çš„é”™è¯¯å˜ä½“é›†ä¸­åˆ°ä¸€ä¸ªç±»å‹ä¸­ã€‚\næœ€åï¼Œæˆ‘ä»¬å‰¥å¼€äº† thiserror æä¾›çš„å¤–è¡£ï¼Œå±•ç¤ºäº†å¦‚ä½•æ‰‹åŠ¨å¤åˆ¶åŒæ ·çš„åŠŸèƒ½ã€‚\nå¸Œæœ›å¤§å®¶èƒ½ä»è¿™ç¯‡æ–‡ç« ä¸­å­¦åˆ°ä¸€äº›ä¸œè¥¿!\nåŸæ–‡é“¾æ¥: https://dev.to/seanchen1991/a-beginner-s-guide-to-handling-errors-in-rust-40k2\n","permalink":"https://ohmyweekly.github.io/notes/2021-04-14-a-beginner-guide-to-handling-errors-in-rust/","tags":["Rust"],"title":"Rust ä¸­å¤„ç†é”™è¯¯çš„åˆçº§æŒ‡å—"},{"categories":["rustlang"],"contents":"Sizedness in Rust Table of Contents\n Intro Sizedness Sized Trait Sized in Generics Unsized Types  Slices Trait Objects Trait Object Limitations  Cannot Cast Unsized Types to Trait Objects Cannot create Multi-Trait Objects   User-Defined Unsized Types   Zero-Sized Types  Unit Type User-Defined Unit Structs Never Type User-Defined Pseudo Never Types PhantomData   Conclusion Discuss Notifications Further Reading  Intro Sizednessæ˜¯Rustä¸­æœ€é‡è¦çš„æ¦‚å¿µä¹‹ä¸€ã€‚å®ƒä¸å…¶ä»–è¯­è¨€ç‰¹æ€§æœ‰å¾ˆå¤šå¾®å¦™çš„äº¤é›†ï¼Œåªæ˜¯ä»¥_\u0026ldquo;xåœ¨ç¼–è¯‘æ—¶ä¸çŸ¥é“å¤§å°\u0026rdquo;_é”™è¯¯ä¿¡æ¯çš„å½¢å¼å‡ºç°ï¼Œè€Œè¿™äº›é”™è¯¯ä¿¡æ¯æ˜¯æ¯ä¸ªRustaceanéƒ½éå¸¸ç†Ÿæ‚‰çš„ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨ä»å¤§å°ç±»å‹ï¼Œåˆ°æ— å¤§å°ç±»å‹ï¼Œå†åˆ°é›¶å¤§å°ç±»å‹çš„å„ç§é£å‘³ï¼ŒåŒæ—¶ç ”ç©¶å®ƒä»¬çš„ç”¨ä¾‹ã€å¥½å¤„ã€ç—›ç‚¹å’Œå˜é€šæ–¹æ³•ã€‚\næˆ‘ä½¿ç”¨çš„çŸ­è¯­è¡¨ï¼Œä»¥åŠå®ƒä»¬çš„å«ä¹‰ã€‚\n   Phrase Shorthand for     sizedness property of being sized or unsized   sized type type with a known size at compile time   1) unsized type or2) DST dynamically-sized type, i.e. size not known at compile time   ?sized type type that may or may not be sized   unsized coercion coercing a sized type into an unsized type   ZST zero-sized type, i.e. instances of the type are 0 bytes in size   width single unit of measurement of pointer width   1) thin pointer or2) single-width pointer pointer that is 1 width   1) fat pointer or2) double-width pointer pointer that is 2 widths   1) pointer or2) reference some pointer of some width, width will be clarified by context   slice double-width pointer to a dynamically sized view into some array    Sizedness åœ¨ Rust ä¸­ï¼Œå¦‚æœåœ¨ç¼–è¯‘æ—¶å¯ä»¥ç¡®å®šç±»å‹çš„å­—èŠ‚å¤§å°ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç¡®å®šç±»å‹çš„å¤§å°ã€‚ç¡®å®šä¸€ä¸ªç±»å‹çš„å¤§å°å¯¹äºèƒ½å¤Ÿåœ¨æ ˆä¸Šä¸ºè¯¥ç±»å‹çš„å®ä¾‹åˆ†é…è¶³å¤Ÿçš„ç©ºé—´æ˜¯å¾ˆé‡è¦çš„ã€‚å›ºå®šå¤§å°çš„ç±»å‹å¯ä»¥é€šè¿‡å€¼æˆ–å¼•ç”¨æ¥ä¼ é€’ã€‚å¦‚æœä¸€ä¸ªç±»å‹çš„å¤§å°ä¸èƒ½åœ¨ç¼–è¯‘æ—¶ç¡®å®šï¼Œé‚£ä¹ˆå®ƒè¢«ç§°ä¸ºä¸ç¡®å®šå¤§å°ç±»å‹æˆ– DSTï¼ŒåŠ¨æ€å¤§å°ç±»å‹ã€‚ç”±äºä¸ç¡®å®šå¤§å°ç±»å‹ä¸èƒ½è¢«æ”¾ç½®åœ¨æ ˆä¸Šï¼Œå®ƒä»¬åªèƒ½é€šè¿‡å¼•ç”¨æ¥ä¼ é€’ã€‚ä¸‹é¢æ˜¯ä¸€äº›å›ºå®šå¤§å°ç±»å‹å’Œä¸ç¡®å®šå¤§å°ç±»å‹çš„ä¾‹å­ã€‚\nusestd::mem::size_of;fn main(){// primitives assert_eq!(4,size_of::\u0026lt;i32\u0026gt;());assert_eq!(8,size_of::\u0026lt;f64\u0026gt;());// tuples assert_eq!(8,size_of::\u0026lt;(i32,i32)\u0026gt;());// arrays assert_eq!(0,size_of::\u0026lt;[i32;0]\u0026gt;());assert_eq!(12,size_of::\u0026lt;[i32;3]\u0026gt;());struct Point{x: i32,y: i32,}// structs assert_eq!(8,size_of::\u0026lt;Point\u0026gt;());// enums assert_eq!(8,size_of::\u0026lt;Option\u0026lt;i32\u0026gt;\u0026gt;());// get pointer width, will be // 4 bytes wide on 32-bit targets or // 8 bytes wide on 64-bit targets constWIDTH: usize =size_of::\u0026lt;\u0026amp;()\u0026gt;();// pointers to sized types are 1 width assert_eq!(WIDTH,size_of::\u0026lt;\u0026amp;i32\u0026gt;());assert_eq!(WIDTH,size_of::\u0026lt;\u0026amp;muti32\u0026gt;());assert_eq!(WIDTH,size_of::\u0026lt;Box\u0026lt;i32\u0026gt;\u0026gt;());assert_eq!(WIDTH,size_of::\u0026lt;fn(i32)-\u0026gt; i32\u0026gt;());constDOUBLE_WIDTH: usize =2*WIDTH;// unsized struct struct Unsized{unsized_field: [i32],}// pointers to unsized types are 2 widths assert_eq!(DOUBLE_WIDTH,size_of::\u0026lt;\u0026amp;str\u0026gt;());// slice assert_eq!(DOUBLE_WIDTH,size_of::\u0026lt;\u0026amp;[i32]\u0026gt;());// slice assert_eq!(DOUBLE_WIDTH,size_of::\u0026lt;\u0026amp;dynToString\u0026gt;());// trait object assert_eq!(DOUBLE_WIDTH,size_of::\u0026lt;Box\u0026lt;dynToString\u0026gt;\u0026gt;());// trait object assert_eq!(DOUBLE_WIDTH,size_of::\u0026lt;\u0026amp;Unsized\u0026gt;());// user-defined unsized type // unsized types size_of::\u0026lt;str\u0026gt;();// compile error size_of::\u0026lt;[i32]\u0026gt;();// compile error size_of::\u0026lt;dynToString\u0026gt;();// compile error size_of::\u0026lt;Unsized\u0026gt;();// compile error }æˆ‘ä»¬å¦‚ä½•ç¡®å®šå›ºå®šå¤§å°ç±»å‹çš„å¤§å°æ˜¯ç›´æˆªäº†å½“çš„ï¼šæ‰€æœ‰åŸç”Ÿç±»å‹å’ŒæŒ‡é’ˆéƒ½æœ‰å·²çŸ¥çš„å¤§å°ï¼Œæ‰€æœ‰çš„ç»“æ„ä½“ã€å…ƒç»„ã€æšä¸¾å’Œæ•°ç»„åªæ˜¯ç”±åŸç”Ÿç±»å‹å’ŒæŒ‡é’ˆæˆ–å…¶ä»–åµŒå¥—çš„ç»“æ„ä½“ã€å…ƒç»„ã€æšä¸¾å’Œæ•°ç»„ç»„æˆï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è€ƒè™‘åˆ°å¡«å……å’Œå¯¹é½æ‰€éœ€çš„é¢å¤–å­—èŠ‚ï¼Œé€’å½’åœ°è®¡æ•°å­—èŠ‚å³å¯ã€‚æˆ‘ä»¬æ— æ³•ç¡®å®šä¸ç¡®å®šå¤§å°ç±»å‹çš„å¤§å°ï¼ŒåŸå› åŒæ ·ç®€å•æ˜äº†ï¼šåˆ‡ç‰‡å¯ä»¥æœ‰ä»»æ„æ•°é‡çš„å…ƒç´ åœ¨å…¶ä¸­ï¼Œå› æ­¤åœ¨è¿è¡Œæ—¶å¯ä»¥æ˜¯ä»»æ„å¤§å°çš„ï¼Œtrait å¯¹è±¡å¯ä»¥ç”±ä»»æ„æ•°é‡çš„ç»“æ„æˆ–æšä¸¾å®ç°ï¼Œå› æ­¤åœ¨è¿è¡Œæ—¶ä¹Ÿå¯ä»¥æ˜¯ä»»æ„å¤§å°çš„ã€‚\nä¸“ä¸šæç¤º\n åœ¨Rustä¸­ï¼Œè§†å›¾åˆ°æ•°ç»„ä¸­çš„åŠ¨æ€å¤§å°çš„æŒ‡é’ˆè¢«ç§°ä¸ºåˆ‡ç‰‡ã€‚ä¾‹å¦‚ \u0026amp;str æ˜¯ä¸€ä¸ª\u0026quot;å­—ç¬¦ä¸²åˆ‡ç‰‡\u0026quot;, \u0026amp;[i32] ä¸€ä¸ª \u0026ldquo;i32 åˆ‡ç‰‡\u0026rdquo;ã€‚ åˆ‡ç‰‡æ˜¯åŒå€å®½åº¦çš„ï¼Œå› ä¸ºå®ƒä»¬å­˜å‚¨äº†ä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆå’Œæ•°ç»„ä¸­å…ƒç´ çš„æ•°é‡ã€‚ trait å¯¹è±¡æŒ‡é’ˆæ˜¯åŒå®½åº¦çš„ï¼Œå› ä¸ºå®ƒä»¬å­˜å‚¨äº†ä¸€ä¸ªæŒ‡å‘æ•°æ®çš„æŒ‡é’ˆå’Œä¸€ä¸ªæŒ‡å‘ vtable çš„æŒ‡é’ˆã€‚ ä¸ç¡®å®šå¤§å°çš„ç»“æ„ä½“æŒ‡é’ˆæ˜¯åŒå€å®½åº¦çš„ï¼Œå› ä¸ºå®ƒä»¬å­˜å‚¨äº†ä¸€ä¸ªæŒ‡å‘ç»“æ„ä½“æ•°æ®çš„æŒ‡é’ˆå’Œç»“æ„ä½“çš„å¤§å°ã€‚ ä¸ç¡®å®šå¤§å°çš„ç»“æ„ä½“åªèƒ½æœ‰1ä¸ªä¸ç¡®å®šå¤§å°çš„å­—æ®µï¼Œè€Œä¸”å¿…é¡»æ˜¯ç»“æ„ä½“ä¸­çš„æœ€åä¸€ä¸ªå­—æ®µã€‚  ä¸ºäº†è®©å¤§å®¶çœŸæ­£æ˜ç™½å…³äºä¸ç¡®å®šå¤§å°ç±»å‹çš„åŒå®½åº¦æŒ‡é’ˆçš„ç‚¹ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªæ¯”è¾ƒæ•°ç»„å’Œåˆ‡ç‰‡çš„æ³¨é‡Šä»£ç ç¤ºä¾‹ã€‚\nusestd::mem::size_of;constWIDTH: usize =size_of::\u0026lt;\u0026amp;()\u0026gt;();constDOUBLE_WIDTH: usize =2*WIDTH;fn main(){// data length stored in type // an [i32; 3] is an array of three i32s letnums: \u0026amp;[i32;3]=\u0026amp;[1,2,3];// single-width pointer assert_eq!(WIDTH,size_of::\u0026lt;\u0026amp;[i32;3]\u0026gt;());letmutsum=0;// can iterate over nums safely // Rust knows it\u0026#39;s exactly 3 elements fornuminnums{sum+=num;}assert_eq!(6,sum);// unsized coercion from [i32; 3] to [i32] // data length now stored in pointer letnums: \u0026amp;[i32]=\u0026amp;[1,2,3];// double-width pointer required to also store data length assert_eq!(DOUBLE_WIDTH,size_of::\u0026lt;\u0026amp;[i32]\u0026gt;());letmutsum=0;// can iterate over nums safely // Rust knows it\u0026#39;s exactly 3 elements fornuminnums{sum+=num;}assert_eq!(6,sum);}è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæ³¨é‡Šçš„ä»£ç ä¾‹å­ï¼Œæ¯”è¾ƒç»“æ„ä½“å’Œ trait å¯¹è±¡ã€‚\nusestd::mem::size_of;constWIDTH: usize =size_of::\u0026lt;\u0026amp;()\u0026gt;();constDOUBLE_WIDTH: usize =2*WIDTH;traitTrait{fn print(\u0026amp;self);}struct Struct;struct Struct2;implTraitforStruct{fn print(\u0026amp;self){println!(\u0026#34;struct\u0026#34;);}}implTraitforStruct2{fn print(\u0026amp;self){println!(\u0026#34;struct2\u0026#34;);}}fn print_struct(s: \u0026amp;Struct){// always prints \u0026#34;struct\u0026#34; // this is known at compile-time s.print();// single-width pointer assert_eq!(WIDTH,size_of::\u0026lt;\u0026amp;Struct\u0026gt;());}fn print_struct2(s2: \u0026amp;Struct2){// always prints \u0026#34;struct2\u0026#34; // this is known at compile-time s2.print();// single-width pointer assert_eq!(WIDTH,size_of::\u0026lt;\u0026amp;Struct2\u0026gt;());}fn print_trait(t: \u0026amp;dynTrait){// print \u0026#34;struct\u0026#34; or \u0026#34;struct2\u0026#34; ? // this is unknown at compile-time t.print();// Rust has to check the pointer at run-time // to figure out whether to use Struct\u0026#39;s // or Struct2\u0026#39;s implementation of \u0026#34;print\u0026#34; // so the pointer has to be double-width assert_eq!(DOUBLE_WIDTH,size_of::\u0026lt;\u0026amp;dynTrait\u0026gt;());}fn main(){// single-width pointer to data lets=\u0026amp;Struct;print_struct(s);// prints \u0026#34;struct\u0026#34; // single-width pointer to data lets2=\u0026amp;Struct2;print_struct2(s2);// prints \u0026#34;struct2\u0026#34; // unsized coercion from Struct to dyn Trait // double-width pointer to point to data AND Struct\u0026#39;s vtable lett: \u0026amp;dynTrait=\u0026amp;Struct;print_trait(t);// prints \u0026#34;struct\u0026#34; // unsized coercion from Struct2 to dyn Trait // double-width pointer to point to data AND Struct2\u0026#39;s vtable lett: \u0026amp;dynTrait=\u0026amp;Struct2;print_trait(t);// prints \u0026#34;struct2\u0026#34; }å…³é”®è¦ç‚¹\n åªæœ‰å›ºå®šå¤§å°ç±»å‹çš„å®ä¾‹æ‰èƒ½è¢«æ”¾ç½®åœ¨æ ˆä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥é€šè¿‡å€¼æ¥ä¼ é€’ ä¸ç¡®å®šå¤§å°ç±»å‹çš„å®ä¾‹ä¸èƒ½æ”¾åœ¨æ ˆä¸Šï¼Œå¿…é¡»é€šè¿‡å¼•ç”¨æ¥ä¼ é€’ æŒ‡å‘ä¸ç¡®å®šå¤§å°ç±»å‹çš„æŒ‡é’ˆæ˜¯åŒå®½åº¦çš„ï¼Œå› ä¸ºé™¤äº†æŒ‡å‘æ•°æ®å¤–ï¼Œå®ƒä»¬è¿˜éœ€è¦åšé¢å¤–çš„è®°è´¦å·¥ä½œï¼Œä»¥è·Ÿè¸ªæ•°æ®çš„é•¿åº¦æˆ–æŒ‡å‘ä¸€ä¸ª vtable  Sized Trait Rustä¸­çš„ \u0026ldquo;Sized\u0026rdquo; trait æ˜¯ä¸€ä¸ªè‡ªåŠ¨ trait å’Œä¸€ä¸ªæ ‡è®° traitã€‚\nè‡ªåŠ¨ trait æ˜¯æŒ‡å½“ä¸€ä¸ªç±»å‹é€šè¿‡æŸäº›æ¡ä»¶æ—¶ï¼Œè‡ªåŠ¨å®ç°çš„ traitã€‚æ ‡è®° trait æ˜¯æ ‡è®°ä¸€ä¸ªç±»å‹å…·æœ‰ç‰¹å®šå±æ€§çš„ traitã€‚æ ‡è®° trait æ²¡æœ‰ä»»ä½• trait é¡¹ï¼Œå¦‚æ–¹æ³•ã€å…³è”å‡½æ•°ã€å…³è”å¸¸é‡æˆ–å…³è”ç±»å‹ã€‚æ‰€æœ‰çš„è‡ªåŠ¨ trait éƒ½æ˜¯æ ‡è®° traitï¼Œä½†ä¸æ˜¯æ‰€æœ‰çš„æ ‡è®° trait éƒ½æ˜¯è‡ªåŠ¨ traitã€‚è‡ªåŠ¨ trait å¿…é¡»æ˜¯æ ‡è®° traitï¼Œæ‰€ä»¥ç¼–è¯‘å™¨å¯ä»¥ä¸ºå®ƒä»¬æä¾›ä¸€ä¸ªè‡ªåŠ¨çš„ç¼ºçœå®ç°ï¼Œå¦‚æœ trait æœ‰ä»»ä½• trait é¡¹ï¼Œè¿™æ˜¯ä¸å¯èƒ½çš„ã€‚\nå¦‚æœä¸€ä¸ªç±»å‹çš„æ‰€æœ‰æˆå‘˜ä¹Ÿæ˜¯ \u0026ldquo;ç¡®å®šå¤§å°çš„\u0026rdquo;ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šå¾—åˆ°ä¸€ä¸ªè‡ªåŠ¨çš„ Sized å®ç°ã€‚\u0026ldquo;æˆå‘˜\u0026quot;çš„å«ä¹‰å–å†³äºæ‰€åŒ…å«çš„ç±»å‹ï¼Œä¾‹å¦‚ï¼šç»“æ„ä½“çš„å­—æ®µã€æšä¸¾çš„å˜ä½“ã€æ•°ç»„çš„å…ƒç´ ã€å…ƒç»„çš„é¡¹ç­‰ç­‰ã€‚ä¸€æ—¦ä¸€ä¸ªç±»å‹è¢« \u0026ldquo;æ ‡è®°\u0026rdquo; äº†ä¸€ä¸ª Sized çš„å®ç°ï¼Œè¿™æ„å‘³ç€åœ¨ç¼–è¯‘æ—¶å°±çŸ¥é“å®ƒçš„å­—èŠ‚å¤§å°ã€‚\nå…¶ä»–è‡ªåŠ¨æ ‡è®° trait çš„ä¾‹å­æ˜¯ Send å’Œ Sync traitã€‚å¦‚æœè·¨çº¿ç¨‹å‘é€ä¸€ä¸ªç±»å‹æ˜¯å®‰å…¨çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å‹å°±æ˜¯å¯ Send çš„ã€‚å¦‚æœåœ¨çº¿ç¨‹ä¹‹é—´å…±äº«è¯¥ç±»å‹çš„å¼•ç”¨æ˜¯å®‰å…¨çš„ï¼Œé‚£ä¹ˆè¯¥ç±»å‹å°±æ˜¯å¯ Sync çš„ã€‚å¦‚æœä¸€ä¸ªç±»å‹çš„æ‰€æœ‰æˆå‘˜éƒ½æ˜¯å¯ Send å’Œ Sync çš„, é‚£ä¹ˆè¿™ä¸ªç±»å‹å°±ä¼šå¾—åˆ°è‡ªåŠ¨çš„ Send å’Œ Sync å®ç°ã€‚Sized çš„ç‰¹æ®Šä¹‹å¤„åœ¨äºå®ƒä¸å¯èƒ½é€‰æ‹©é€€å‡ºï¼Œä¸åƒå…¶ä»–è‡ªåŠ¨æ ‡è®° trait å¯ä»¥é€‰æ‹©é€€å‡ºã€‚\n#![feature(negative_impls)]// this type is Sized, Send, and Sync struct Struct;// opt-out of Send trait impl!SendforStruct{}// opt-out of Sync trait impl!SyncforStruct{}impl!SizedforStruct{}// compile error è¿™ä¼¼ä¹æ˜¯åˆç†çš„ï¼Œå› ä¸ºæˆ‘ä»¬å¯èƒ½æœ‰ç†ç”±ä¸å¸Œæœ›æˆ‘ä»¬çš„ç±»å‹è¢«è·¨çº¿ç¨‹å‘é€æˆ–å…±äº«ï¼Œä½†æ˜¯å¾ˆéš¾æƒ³è±¡æˆ‘ä»¬ä¼šå¸Œæœ›ç¼–è¯‘å™¨ \u0026ldquo;å¿˜è®°\u0026rdquo; æˆ‘ä»¬ç±»å‹çš„å¤§å°ï¼Œå¹¶å°†å…¶è§†ä¸ºä¸€ä¸ªä¸ç¡®å®šå¤§å°çš„ç±»å‹ï¼Œå› ä¸ºè¿™ä¸ä¼šå¸¦æ¥ä»»ä½•å¥½å¤„ï¼Œåªä¼šè®©ç±»å‹æ›´éš¾å¤„ç†ã€‚\nå¦å¤–ï¼Œè¯´å¾—è¿‚è…ä¸€ç‚¹ï¼ŒSized åœ¨æŠ€æœ¯ä¸Šå¹¶ä¸æ˜¯ä¸€ä¸ªè‡ªåŠ¨ traitï¼Œå› ä¸ºå®ƒæ²¡æœ‰ä½¿ç”¨ auto å…³é”®å­—æ¥å®šä¹‰ï¼Œä½†æ˜¯ç¼–è¯‘å™¨å¯¹å®ƒçš„ç‰¹æ®Šå¤„ç†ä½¿å®ƒçš„è¡Œä¸ºä¸è‡ªåŠ¨ trait éå¸¸ç›¸ä¼¼ï¼Œæ‰€ä»¥åœ¨å®è·µä¸­ï¼ŒæŠŠå®ƒçœ‹ä½œæ˜¯ä¸€ä¸ªè‡ªåŠ¨ trait æ˜¯å¯ä»¥çš„ã€‚\nå…³é”®è¦ç‚¹\n Sized æ˜¯ä¸€ä¸ªè‡ªåŠ¨æ ‡è®° trait  æ³›å‹ä¸­çš„ Sized æ¯å½“æˆ‘ä»¬ç¼–å†™ä»»ä½•æ³›å‹ä»£ç æ—¶ï¼Œæ¯ä¸€ä¸ªæ³›å‹ç±»å‹å‚æ•°éƒ½ä¼šè¢«é»˜è®¤çš„ Sized trait è‡ªåŠ¨ç»‘å®šï¼Œè¿™ä¸€ç‚¹å¹¶ä¸æ˜æ˜¾ã€‚\n// this generic function... fn func\u0026lt;T\u0026gt;(t: T){}// ...desugars to... fn func\u0026lt;T: Sized\u0026gt;(t: T){}// ...which we can opt-out of by explicitly setting ?Sized... fn func\u0026lt;T: ?Sized\u0026gt;(t: T){}// compile error // ...which doesn\u0026#39;t compile since t doesn\u0026#39;t have // a known size so we must put it behind a pointer... fn func\u0026lt;T: ?Sized\u0026gt;(t: \u0026amp;T){}// compiles fn func\u0026lt;T: ?Sized\u0026gt;(t: Box\u0026lt;T\u0026gt;){}// compiles ä¸“ä¸šæç¤º\n ?Sized can be pronounced \u0026ldquo;optionally sized\u0026rdquo; or \u0026ldquo;maybe sized\u0026rdquo; and adding it to a type parameter\u0026rsquo;s bounds allows the type to be sized or unsized ?Sized in general is referred to as a \u0026ldquo;widening bound\u0026rdquo; or a \u0026ldquo;relaxed bound\u0026rdquo; as it relaxes rather than constrains the type parameter ?Sized is the only relaxed bound in Rust  So why does this matter? Well, any time we\u0026rsquo;re working with a generic type and that type is behind a pointer we almost always want to opt-out of the default Sized bound to make our function more flexible in what argument types it will accept. Also, if we don\u0026rsquo;t opt-out of the default Sized bound we\u0026rsquo;ll eventually get some surprising and confusing compile error messages.\nLet me take you on the journey of the first generic function I ever wrote in Rust. I started learning Rust before the dbg! macro landed in stable so the only way to print debug values was to type out println!(\u0026quot;{:?}\u0026quot;, some_value); every time which is pretty tedious so I decided to write a debug helper function like this:\n ?Sized å¯ä»¥è¯»ä½œ \u0026ldquo;optionally sized\u0026rdquo; æˆ– \u0026ldquo;maybe sized\u0026rdquo;ï¼Œå°†å®ƒæ·»åŠ åˆ°ç±»å‹å‚æ•°çš„ç»‘å®šä¸­ï¼Œå¯ä»¥è®©ç±»å‹è¢«ç¡®å®šå¤§å°æˆ–ä¸ç¡®å®šå¤§å°ã€‚ ?Sized ä¸€èˆ¬è¢«ç§°ä¸º \u0026ldquo;æ‹“å®½ç»‘å®š\u0026rdquo; æˆ– \u0026ldquo;å®½æ¾ç»‘å®š\u0026rdquo;ï¼Œå› ä¸ºå®ƒæ”¾æ¾è€Œä¸æ˜¯çº¦æŸç±»å‹å‚æ•°ã€‚ ?Sized æ˜¯ Rust ä¸­å”¯ä¸€çš„å®½æ¾ç»‘å®šã€‚  é‚£ä¹ˆä¸ºä»€ä¹ˆè¿™å¾ˆé‡è¦å‘¢ï¼Ÿä»»ä½•æ—¶å€™ï¼Œå½“æˆ‘ä»¬åœ¨å¤„ç†æ³›å‹ç±»å‹ï¼Œå¹¶ä¸”è¯¥ç±»å‹åœ¨ä¸€ä¸ªæŒ‡é’ˆåé¢æ—¶ï¼Œæˆ‘ä»¬å‡ ä¹æ€»æ˜¯å¸Œæœ›é€‰æ‹©é€€å‡ºé»˜è®¤çš„ Sized ç»‘å®šï¼Œä»¥ä½¿æˆ‘ä»¬çš„å‡½æ•°åœ¨æ¥å—ä»€ä¹ˆå‚æ•°ç±»å‹æ—¶æ›´åŠ çµæ´»ã€‚å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬ä¸é€‰æ‹©é€€å‡ºé»˜è®¤çš„ Sized ç»‘å®šï¼Œæˆ‘ä»¬æœ€ç»ˆä¼šå¾—åˆ°ä¸€äº›ä»¤äººæƒŠè®¶å’Œå›°æƒ‘çš„ç¼–è¯‘é”™è¯¯ä¿¡æ¯ã€‚\nè®©æˆ‘å¸¦ä½ äº†è§£ä¸€ä¸‹æˆ‘åœ¨ Rust ä¸­å†™çš„ç¬¬ä¸€ä¸ªæ³›å‹å‡½æ•°çš„å†ç¨‹ã€‚åœ¨ dbg! å®ç™»é™†ç¨³å®šç‰ˆä¹‹å‰ï¼Œæˆ‘å°±å¼€å§‹å­¦ä¹  Rust äº†ï¼Œæ‰€ä»¥æ‰“å°è°ƒè¯•å€¼çš„å”¯ä¸€æ–¹æ³•å°±æ˜¯æ¯æ¬¡éƒ½è¦æ‰“å‡º println!(\u0026quot;{:?}\u0026quot;, some_value);ï¼Œè¿™æ˜¯å¾ˆä¹å‘³çš„ï¼Œæ‰€ä»¥æˆ‘å†³å®šå†™ä¸€ä¸ªåƒè¿™æ ·çš„è°ƒè¯•å¸®åŠ©å‡½æ•°ã€‚\nusestd::fmt::Debug;fn debug\u0026lt;T: Debug\u0026gt;(t: T){// T: Debug + Sized println!(\u0026#34;{:?}\u0026#34;,t);}fn main(){debug(\u0026#34;my str\u0026#34;);// T = \u0026amp;str, \u0026amp;str: Debug + Sized âœ”ï¸ }åˆ°ç›®å‰ä¸ºæ­¢è¿˜ä¸é”™ï¼Œä½†å‡½æ•°ä¼šå¯¹ä¼ é€’ç»™å®ƒçš„ä»»ä½•å€¼æ‹¥æœ‰æ‰€æœ‰æƒï¼Œè¿™æœ‰ç‚¹çƒ¦äººï¼Œæ‰€ä»¥æˆ‘æŠŠå‡½æ•°æ”¹ä¸ºåªæ¥å—å¼•ç”¨ã€‚\nusestd::fmt::Debug;fn dbg\u0026lt;T: Debug\u0026gt;(t: \u0026amp;T){// T: Debug + Sized println!(\u0026#34;{:?}\u0026#34;,t);}fn main(){dbg(\u0026#34;my str\u0026#34;);// \u0026amp;T = \u0026amp;str, T = str, str: Debug + !Sized âŒ }ç°åœ¨å‡ºç°äº†è¿™ä¸ªé”™è¯¯ã€‚\nerror[E0277]: thesizeforvaluesoftype `str`cannotbeknownatcompilationtime--\u0026gt; src/main.rs:8:9|3|fn dbg\u0026lt;T: Debug\u0026gt;(t: \u0026amp;T){|-requiredbythisboundin`dbg`...8|dbg(\u0026#34;my str\u0026#34;);|^^^^^^^^doesn\u0026#39;thaveasizeknownatcompile-time|=help: thetrait`std::marker::Sized`isnotimplementedfor`str`=note: tolearnmore,visit\u0026lt;https://doc.rust-lang.org/book/ch19-04-advanced-types.html#dynamically-sized-types-and-the-sized-trait\u0026gt; help: considerrelaxingtheimplicit`Sized`restriction|3|fn dbg\u0026lt;T: Debug+?Sized\u0026gt;(t: \u0026amp;T){|å½“æˆ‘ç¬¬ä¸€æ¬¡çœ‹åˆ°è¿™ä¸ªé—®é¢˜æ—¶ï¼Œæˆ‘å‘ç°å®ƒä»¤äººéš¾ä»¥ç½®ä¿¡çš„æ··ä¹±ã€‚å°½ç®¡æˆ‘çš„å‡½æ•°å¯¹å‚æ•°çš„é™åˆ¶æ¯”ä»¥å‰æ›´ä¸¥æ ¼ï¼Œä½†ç°åœ¨å®ƒå´è«åå…¶å¦™åœ°æŠ›å‡ºäº†ä¸€ä¸ªç¼–è¯‘é”™è¯¯ï¼è¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿåˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ\næˆ‘å·²ç»åœ¨ä¸Šé¢çš„ä»£ç æ³¨é‡Šä¸­ç ´åäº†ç­”æ¡ˆï¼Œä½†åŸºæœ¬ä¸Šã€‚Rust åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­æŠŠ T è§£æä¸ºå…·ä½“ç±»å‹æ—¶ï¼Œä¼šæ‰§è¡Œæ¨¡å¼åŒ¹é…ã€‚è¿™é‡Œæœ‰å‡ ä¸ªè¡¨æ ¼å¯ä»¥å¸®åŠ©æ¾„æ¸…ã€‚\n   Type T \u0026amp;T     \u0026amp;str T = \u0026amp;str T = str       Type Sized     str âŒ   \u0026amp;str âœ”ï¸   \u0026amp;\u0026amp;str âœ”ï¸    è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä¸å¾—ä¸åœ¨æ”¹æˆå–ç”¨å¼•ç”¨åï¼ŒåŠ äº†ä¸€ä¸ª ?Sized çš„ç»‘å®šï¼Œä½¿å‡½æ•°èƒ½æ­£å¸¸å·¥ä½œã€‚ä¸‹é¢æ˜¯å¯ä»¥å·¥ä½œçš„å‡½æ•°ã€‚\nusestd::fmt::Debug;fn debug\u0026lt;T: Debug+?Sized\u0026gt;(t: \u0026amp;T){// T: Debug + ?Sized println!(\u0026#34;{:?}\u0026#34;,t);}fn main(){debug(\u0026#34;my str\u0026#34;);// \u0026amp;T = \u0026amp;str, T = str, str: Debug + !Sized âœ”ï¸ }å…³é”®è¦ç‚¹\n æ‰€æœ‰çš„æ³›å‹ç±»å‹å‚æ•°é»˜è®¤éƒ½æ˜¯è‡ªåŠ¨ç»‘å®š Sizedã€‚ å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªæ³›å‹å‡½æ•°ï¼Œå®ƒçš„å‚æ•°æ˜¯æŒ‡é’ˆåé¢çš„ä¸€äº› Tï¼Œä¾‹å¦‚ \u0026amp;Tã€Box\u0026lt;T\u0026gt;ã€Rc\u0026lt;T\u0026gt; ç­‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å‡ ä¹æ€»æ˜¯å¸Œæœ›ç”¨T: ?Sized æ¥é€€å‡ºé»˜è®¤çš„ Sized çº¦æŸã€‚  Unsized ç±»å‹ åˆ‡ç‰‡ æœ€å¸¸è§çš„åˆ‡ç‰‡æ˜¯å­—ç¬¦ä¸²åˆ‡ç‰‡ \u0026amp;str å’Œæ•°ç»„åˆ‡ç‰‡ \u0026amp;[T]ã€‚åˆ‡ç‰‡çš„å¥½å¤„æ˜¯è®¸å¤šå…¶ä»–ç±»å‹ä¹Ÿä¼šå¯¹å…¶è¿›è¡Œ coerceï¼Œæ‰€ä»¥åˆ©ç”¨åˆ‡ç‰‡å’Œ Rust çš„è‡ªåŠ¨ç±»å‹ coerceï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™çµæ´»çš„ APIã€‚\nç±»å‹ coerce å¯ä»¥å‘ç”Ÿåœ¨å‡ ä¸ªåœ°æ–¹ï¼Œä½†æœ€æ˜æ˜¾çš„æ˜¯åœ¨å‡½æ•°å‚æ•°å’Œæ–¹æ³•è°ƒç”¨æ—¶ã€‚æˆ‘ä»¬æ„Ÿå…´è¶£çš„ç±»å‹ coerce æ˜¯ deref coerce å’Œ unsized coerceã€‚deref coerce æ˜¯æŒ‡å½“ T åœ¨ deref æ“ä½œä¹‹åè¢« coerce æˆä¸€ä¸ª Uï¼Œå³ T: Deref\u0026lt;Target = U\u0026gt;ï¼Œä¾‹å¦‚ String.deref() -\u0026gt; strã€‚ä¸ç¡®å®šå¤§å° coerce æ˜¯æŒ‡ T è¢« coerce æˆ Uï¼Œå…¶ä¸­ T æ˜¯ä¸€ä¸ªç¡®å®šå¤§å°çš„ç±»å‹ï¼ŒU æ˜¯ä¸€ä¸ªä¸ç¡®å®šå¤§å°çš„ç±»å‹ï¼Œå³ T: Unsize\u0026lt;U\u0026gt;ï¼Œä¾‹å¦‚ [i32; 3] -\u0026gt; [i32]ã€‚\ntraitTrait{fn method(\u0026amp;self){}}implTraitforstr{// can now call \u0026#34;method\u0026#34; on // 1) str or // 2) String since String: Deref\u0026lt;Target = str\u0026gt; }impl\u0026lt;T\u0026gt;Traitfor[T]{// can now call \u0026#34;method\u0026#34; on // 1) any \u0026amp;[T] // 2) any U where U: Deref\u0026lt;Target = [T]\u0026gt;, e.g. Vec\u0026lt;T\u0026gt; // 3) [T; N] for any N, since [T; N]: Unsize\u0026lt;[T]\u0026gt; }fn str_fun(s: \u0026amp;str){}fn slice_fun\u0026lt;T\u0026gt;(s: \u0026amp;[T]){}fn main(){letstr_slice: \u0026amp;str =\u0026#34;str slice\u0026#34;;letstring: String =\u0026#34;string\u0026#34;.to_owned();// function args str_fun(str_slice);str_fun(\u0026amp;string);// deref coercion // method calls str_slice.method();string.method();// deref coercion letslice: \u0026amp;[i32]=\u0026amp;[1];letthree_array: [i32;3]=[1,2,3];letfive_array: [i32;5]=[1,2,3,4,5];letvec: Vec\u0026lt;i32\u0026gt;=vec![1];// function args slice_fun(slice);slice_fun(\u0026amp;vec);// deref coercion slice_fun(\u0026amp;three_array);// unsized coercion slice_fun(\u0026amp;five_array);// unsized coercion // method calls slice.method();vec.method();// deref coercion three_array.method();// unsized coercion five_array.method();// unsized coercion }å…³é”®è¦ç‚¹\n åˆ©ç”¨åˆ‡ç‰‡å’Œ Rust çš„è‡ªåŠ¨ç±»å‹å¼ºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™çµæ´»çš„ APIã€‚  Trait å¯¹è±¡ Traits é»˜è®¤æ˜¯ ?Sized çš„ã€‚è¿™ä¸ªç¨‹åº:\ntraitTrait: ?Sized{}æŠ›å‡ºè¿™ä¸ªé”™è¯¯:\nerror: `?Trait`isnotpermittedinsupertraits--\u0026gt; src/main.rs:1:14|1|traitTrait: ?Sized{}|^^^^^^|=note: traitsare`?Sized`bydefaultæˆ‘ä»¬å¾ˆå¿«å°±ä¼šè®¨è®ºä¸ºä»€ä¹ˆ trait é»˜è®¤ä¸º ?Sizedï¼Œä½†é¦–å…ˆè®©æˆ‘ä»¬é—®é—®è‡ªå·±ï¼Œä¸€ä¸ª trait è¢« ?Sized çš„å«ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿè®©æˆ‘ä»¬æŠŠä¸Šé¢çš„ä¾‹å­å»æ‰ã€‚\ntraitTraitwhereSelf: ?Sized{}å¥½çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œtrait å…è®¸ self æ˜¯ä¸€ä¸ªä¸ç¡®å®šå¤§å°çš„ç±»å‹ã€‚æ­£å¦‚æˆ‘ä»¬å‰é¢æ‰€å­¦ï¼Œæˆ‘ä»¬ä¸èƒ½é€šè¿‡å€¼æ¥ä¼ é€’ä¸ç¡®å®šå¤§å°çš„ç±»å‹ï¼Œæ‰€ä»¥è¿™é™åˆ¶äº†æˆ‘ä»¬åœ¨ trait ä¸­å®šä¹‰æ–¹æ³•çš„ç§ç±»ã€‚åº”è¯¥æ˜¯ä¸å¯èƒ½å†™å‡ºä¸€ä¸ªé€šè¿‡å–å€¼æ¥è·å–æˆ–è¿”å› self çš„æ–¹æ³•ï¼Œç„¶è€Œè¿™ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œå®ƒçš„ç¼–è¯‘:\ntraitTrait{fn method(self);// compiles }ç„¶è€Œï¼Œå½“æˆ‘ä»¬è¯•å›¾å®ç°è¯¥æ–¹æ³•æ—¶ï¼Œæ— è®ºæ˜¯é€šè¿‡æä¾›ä¸€ä¸ªé»˜è®¤çš„å®ç°ï¼Œè¿˜æ˜¯é€šè¿‡å®ç°ä¸€ä¸ªä¸ç¡®å®šå¤§å°ç±»å‹çš„ traitï¼Œæˆ‘ä»¬éƒ½ä¼šå¾—åˆ°ç¼–è¯‘é”™è¯¯ã€‚\ntraitTrait{fn method(self){}// compile error }implTraitforstr{fn method(self){}// compile error }æŠ›å‡º:\nerror[E0277]: thesizeforvaluesoftype `Self`cannotbeknownatcompilationtime--\u0026gt; src/lib.rs:2:15|2|fn method(self){}|^^^^doesn\u0026#39;thaveasizeknownatcompile-time|=help: thetrait`std::marker::Sized`isnotimplementedfor`Self`=note: tolearnmore,visit\u0026lt;https://doc.rust-lang.org/book/ch19-04-advanced-types.html#dynamically-sized-types-and-the-sized-trait\u0026gt; =note: alllocalvariablesmusthaveastaticallyknownsize=help: unsizedlocalsaregatedasanunstablefeaturehelp: considerfurtherrestricting`Self`|2|fn method(self)whereSelf: std::marker::Sized{}|^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^error[E0277]: thesizeforvaluesoftype `str`cannotbeknownatcompilationtime--\u0026gt; src/lib.rs:6:15|6|fn method(self){}|^^^^doesn\u0026#39;thaveasizeknownatcompile-time|=help: thetrait`std::marker::Sized`isnotimplementedfor`str`=note: tolearnmore,visit\u0026lt;https://doc.rust-lang.org/book/ch19-04-advanced-types.html#dynamically-sized-types-and-the-sized-trait\u0026gt; =note: alllocalvariablesmusthaveastaticallyknownsize=help: unsizedlocalsaregatedasanunstablefeatureå¦‚æœæˆ‘ä»¬å†³å¿ƒé€šè¿‡å€¼æ¥ä¼ é€’ selfï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ˜¾å¼ç»‘å®š trait ä¸ Sized æ¥è§£å†³ç¬¬ä¸€ä¸ªé”™è¯¯ã€‚\ntraitTrait: Sized {fn method(self){}// compiles }implTraitforstr{// compile error fn method(self){}}ç°åœ¨æŠ›å‡º:\nerror[E0277]: thesizeforvaluesoftype `str`cannotbeknownatcompilationtime--\u0026gt; src/lib.rs:7:6|1|traitTrait: Sized {|-----requiredbythisboundin`Trait`...7|implTraitforstr{|^^^^^doesn\u0026#39;thaveasizeknownatcompile-time|=help: thetrait`std::marker::Sized`isnotimplementedfor`str`=note: tolearnmore,visit\u0026lt;https://doc.rust-lang.org/book/ch19-04-advanced-types.html#dynamically-sized-types-and-the-sized-trait\u0026gt; è¿™å¹¶æ²¡æœ‰é—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“ï¼Œå½“æˆ‘ä»¬å°† trait ä¸ Sized ç»‘å®šåï¼Œæˆ‘ä»¬å°±ä¸èƒ½å†ä¸ºè¯¸å¦‚ str è¿™æ ·çš„ä¸ç¡®å®šå¤§å°ç±»å‹å®ç°å®ƒäº†ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæˆ‘ä»¬çœŸçš„æƒ³ä¸º str å®ç° traitï¼Œå¦ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ä¿ç•™ ?Sized traitï¼Œå¹¶é€šè¿‡å¼•ç”¨ä¼ é€’ selfã€‚\ntraitTrait{fn method(\u0026amp;self){}// compiles }implTraitforstr{fn method(\u0026amp;self){}// compiles }ä¸å…¶å°†æ•´ä¸ª trait æ ‡è®°ä¸º ?Sized æˆ– Sizedï¼Œæˆ‘ä»¬æœ‰æ›´ç»†åŒ–å’Œç²¾ç¡®çš„é€‰æ‹©ï¼Œå°†å•ä¸ªæ–¹æ³•æ ‡è®°ä¸º Sizedï¼Œåƒè¿™æ ·ã€‚\ntraitTrait{fn method(self)whereSelf: Sized {}}implTraitforstr{}// compiles!? fn main(){\u0026#34;str\u0026#34;.method();// compile error }ä»¤äººæƒŠè®¶çš„æ˜¯ï¼ŒRustç¼–è¯‘ impl Trait for str {} æ—¶æ²¡æœ‰ä»»ä½•æŠ±æ€¨ï¼Œä½†å½“æˆ‘ä»¬è¯•å›¾åœ¨ä¸€ä¸ªä¸ç¡®å®šå¤§å°çš„ç±»å‹ä¸Šè°ƒç”¨ method æ—¶ï¼Œå®ƒæœ€ç»ˆè¿˜æ˜¯æŠ“åˆ°äº†é”™è¯¯ï¼Œæ‰€ä»¥ä¸€åˆ‡æ­£å¸¸ã€‚è¿™æœ‰ç‚¹æ€ªå¼‚ï¼Œä½†ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€äº›çµæ´»æ€§ï¼Œåªè¦æˆ‘ä»¬ä»ä¸è°ƒç”¨ Sized æ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ä¸€äº› Sized æ–¹æ³•ä¸ºä¸ç¡®å®šå¤§å°çš„ç±»å‹å®ç° traitã€‚\ntraitTrait{fn method(self)whereSelf: Sized {}fn method2(\u0026amp;self){}}implTraitforstr{}// compiles fn main(){// we never call \u0026#34;method\u0026#34; so no errors \u0026#34;str\u0026#34;.method2();// compiles }ç°åœ¨å›åˆ°æœ€åˆçš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆ trait é»˜è®¤æ˜¯ ?Sizedï¼Ÿç­”æ¡ˆæ˜¯ trait å¯¹è±¡ã€‚trait å¯¹è±¡æœ¬è´¨ä¸Šæ˜¯ä¸ç¡®å®šå¤§å°çš„ï¼Œå› ä¸ºä»»ä½•å¤§å°çš„ç±»å‹éƒ½å¯ä»¥å®ç° traitï¼Œå› æ­¤æˆ‘ä»¬åªæœ‰åœ¨ Trait: ?Sized çš„æƒ…å†µä¸‹ï¼Œæ‰èƒ½ä¸º dyn Trait å®ç° Traitã€‚ç”¨ä»£ç æ¥è¯´ï¼š\ntraitTrait: ?Sized{}// the above is REQUIRED for implTraitfordynTrait{// compiler magic here }// since `dyn Trait` is unsized // and now we can use `dyn Trait` in our program fn function(t: \u0026amp;dynTrait){}// compiles å¦‚æœæˆ‘ä»¬å°è¯•å®é™…ç¼–è¯‘ä¸Šè¿°ç¨‹åºï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ï¼š\nerror[E0371]: theobjecttype `(dynTrait+\u0026#39;static)`automaticallyimplementsthetrait`Trait`--\u0026gt; src/lib.rs:5:1|5|implTraitfordynTrait{|^^^^^^^^^^^^^^^^^^^^^^^^`(dynTrait+\u0026#39;static)`automaticallyimplementstrait`Trait`è¿™å°±æ˜¯ç¼–è¯‘å™¨å‘Šè¯‰æˆ‘ä»¬è¦å†·é™ï¼Œå› ä¸ºå®ƒè‡ªåŠ¨ä¸º dyn Trait æä¾›äº† Trait çš„å®ç°ã€‚åŒæ ·ï¼Œç”±äº dyn Trait æ˜¯ä¸ç¡®å®šå¤§å°çš„ï¼Œç¼–è¯‘å™¨åªèƒ½åœ¨ Trait: ?Sized çš„æƒ…å†µä¸‹æä¾›è¿™ä¸ªå®ç°ã€‚å¦‚æœæˆ‘ä»¬å°† Trait ä¸ Sized ç»‘å®šï¼Œé‚£ä¹ˆ Trait å°±å˜æˆäº† \u0026ldquo;å¯¹è±¡ä¸å®‰å…¨\u0026rdquo; çš„äº†ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ä¸èƒ½å°†å®ç° Trait çš„ç±»å‹è½¬ä¸º dyn Trait çš„ trait å¯¹è±¡ã€‚æ­£å¦‚é¢„æœŸçš„é‚£æ ·ï¼Œè¿™ä¸ªç¨‹åºä¸èƒ½ç¼–è¯‘:\ntraitTrait: Sized {}fn function(t: \u0026amp;dynTrait){}// compile error æŠ›å‡º:\nerror[E0038]: thetrait`Trait`cannotbemadeintoanobject--\u0026gt; src/lib.rs:3:18|1|traitTrait: Sized {}|----------...becauseitrequires`Self: Sized`|||thistraitcannotbemadeintoanobject...2|3|fn function(t: \u0026amp;dynTrait){}|^^^^^^^^^^thetrait`Trait`cannotbemadeintoanobjectè®©æˆ‘ä»¬å°è¯•ç”¨ Sized æ–¹æ³•åˆ¶ä½œä¸€ä¸ª ?Sized traitï¼Œçœ‹çœ‹èƒ½å¦å°†å®ƒè½¬ä¸€ä¸ª trait å¯¹è±¡ã€‚\ntraitTrait{fn method(self)whereSelf: Sized {}fn method2(\u0026amp;self){}}fn function(arg: \u0026amp;dynTrait){// compiles arg.method();// compile error arg.method2();// compiles }æ­£å¦‚æˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„é‚£æ ·ï¼Œåªè¦æˆ‘ä»¬ä¸è°ƒç”¨ trait å¯¹è±¡ä¸Šçš„ Sized æ–¹æ³•ï¼Œä¸€åˆ‡éƒ½æ²¡é—®é¢˜ã€‚\nå…³é”®è¦ç‚¹\n æ‰€æœ‰çš„ traits é»˜è®¤éƒ½æ˜¯ ?Sized çš„ã€‚ Trait: ?Sized æ˜¯ impl Trait for dyn Trait æ‰€å¿…éœ€çš„ã€‚ æˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸ªæ–¹æ³•çš„åŸºç¡€ä¸Šè¦æ±‚ Self: Sizedã€‚ ç”± Sized ç»‘å®šçš„ trait ä¸èƒ½æˆä¸º trait å¯¹è±¡ã€‚  trait å¯¹è±¡é™åˆ¶ å³ä½¿ä¸€ä¸ª traitt æ˜¯å¯¹è±¡å®‰å…¨çš„ï¼Œä¹Ÿä¼šæœ‰ä¸€äº›ä¸å¤§å°ç›¸å…³çš„è¾¹ç¼˜æƒ…å†µï¼Œè¿™äº›æƒ…å†µé™åˆ¶äº†å“ªäº›ç±»å‹å¯ä»¥è½¬æ¢ä¸º trait å¯¹è±¡ï¼Œä»¥åŠä¸€ä¸ª trait å¯¹è±¡å¯ä»¥è¡¨ç¤ºå¤šå°‘ä¸ªå’Œä»€ä¹ˆæ ·çš„ traitã€‚\nä¸èƒ½å°†ä¸ç¡®å®šå¤§å°çš„ç±»å‹è½¬æ¢ä¸º Trait å¯¹è±¡ fn generic\u0026lt;T: ToString\u0026gt;(t: T){}fn trait_object(t: \u0026amp;dynToString){}fn main(){generic(String::from(\u0026#34;String\u0026#34;));// compiles generic(\u0026#34;str\u0026#34;);// compiles trait_object(\u0026amp;String::from(\u0026#34;String\u0026#34;));// compiles, unsized coercion trait_object(\u0026#34;str\u0026#34;);// compile error, unsized coercion impossible }æŠ›å‡º:\nerror[E0277]: thesizeforvaluesoftype `str`cannotbeknownatcompilationtime--\u0026gt; src/main.rs:8:18|8|trait_object(\u0026#34;str\u0026#34;);// compile error |^^^^^doesn\u0026#39;thaveasizeknownatcompile-time|=help: thetrait`std::marker::Sized`isnotimplementedfor`str`=note: tolearnmore,visit\u0026lt;https://doc.rust-lang.org/book/ch19-04-advanced-types.html#dynamically-sized-types-and-the-sized-trait\u0026gt; =note: requiredforthecasttotheobjecttype `dynstd::string::ToString`ä¸ºä»€ä¹ˆå°†ä¸€ä¸ª \u0026amp;String ä¼ ç»™ä¸€ä¸ªæœŸæœ›å¾—åˆ° \u0026amp;dyn ToString çš„å‡½æ•°ï¼Œæ˜¯å› ä¸ºç±»å‹èƒè¿«ã€‚String å®ç°äº† ToStringï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸ç¡®å®šå¤§å°çš„èƒè¿«å°† String è¿™æ ·çš„ç¡®å®šå¤§å°çš„ç±»å‹è½¬æ¢æˆ dyn ToString è¿™æ ·çš„ä¸ç¡®å®šå¤§å°çš„ç±»å‹ã€‚str ä¹Ÿå®ç°äº† ToStringï¼Œå°† str è½¬æ¢ä¸º dyn ToString ä¹Ÿéœ€è¦ä¸€ä¸ªä¸ç¡®å®šå¤§å°çš„èƒè¿«ï¼Œä½† str å·²ç»æ˜¯ä¸ç¡®å®šå¤§å°çš„äº†ï¼æˆ‘ä»¬å¦‚ä½•å°†ä¸€ä¸ªå·²ç»æ˜¯ä¸ç¡®å®šå¤§å°çš„ç±»å‹ï¼Œå˜æˆå¦ä¸€ä¸ªä¸ç¡®å®šå¤§å°çš„ç±»å‹ï¼Ÿ\n\u0026amp;str æŒ‡é’ˆæ˜¯åŒå®½çš„ï¼Œå­˜å‚¨ä¸€ä¸ªæ•°æ®æŒ‡é’ˆå’Œæ•°æ®é•¿åº¦ã€‚\u0026amp;dyn ToString æŒ‡é’ˆä¹Ÿæ˜¯åŒå®½åº¦çš„ï¼Œå­˜å‚¨ä¸€ä¸ªæŒ‡å‘æ•°æ®çš„æŒ‡é’ˆå’Œä¸€ä¸ªæŒ‡å‘ vtable çš„æŒ‡é’ˆã€‚è¦æŠŠä¸€ä¸ª \u0026amp;str èƒè¿«æˆä¸€ä¸ª \u0026amp;dyn toStringï¼Œå°±éœ€è¦ä¸€ä¸ªä¸‰å€å®½åº¦çš„æŒ‡é’ˆæ¥å­˜å‚¨ä¸€ä¸ªæŒ‡å‘æ•°æ®çš„æŒ‡é’ˆã€æ•°æ®é•¿åº¦å’Œä¸€ä¸ªæŒ‡å‘ vtable çš„æŒ‡é’ˆã€‚Rust ä¸æ”¯æŒä¸‰å€å®½åº¦æŒ‡é’ˆï¼Œæ‰€ä»¥ä¸å¯èƒ½å°†ä¸€ä¸ªä¸ç¡®å®šå¤§å°çš„ç±»å‹è½¬æ¢æˆä¸€ä¸ª trait å¯¹è±¡ã€‚\nå‰é¢2æ®µç”¨è¡¨æ ¼æ€»ç»“äº†ä¸€ä¸‹ã€‚\n   Type Pointer to Data Data Length Pointer to VTable Total Width     \u0026amp;String âœ”ï¸ âŒ âŒ 1 âœ”ï¸   \u0026amp;str âœ”ï¸ âœ”ï¸ âŒ 2 âœ”ï¸   \u0026amp;String as \u0026amp;dyn ToString âœ”ï¸ âŒ âœ”ï¸ 2 âœ”ï¸   \u0026amp;str as \u0026amp;dyn ToString âœ”ï¸ âœ”ï¸ âœ”ï¸ 3 âŒ    ä¸èƒ½åˆ›å»º Multi-Trait å¯¹è±¡ traitTrait{}traitTrait2{}fn function(t: \u0026amp;(dynTrait+Trait2)){}æŠ›å‡º:\nerror[E0225]: onlyautotraitscanbeusedasadditionaltraitsinatraitobject--\u0026gt; src/lib.rs:4:30|4|fn function(t: \u0026amp;(dynTrait+Trait2)){}|-----^^^^^^|||||additionalnon-autotrait||traitaliasusedintraitobjecttype (additionaluse)|firstnon-autotrait|traitaliasusedintraitobjecttype (firstuse)è¯·è®°ä½ï¼Œtrait å¯¹è±¡æŒ‡é’ˆæ˜¯åŒå®½åº¦çš„ï¼šå­˜å‚¨1ä¸ªæŒ‡å‘æ•°æ®çš„æŒ‡é’ˆå’Œå¦ä¸€ä¸ªæŒ‡å‘ vtable çš„æŒ‡é’ˆï¼Œä½†è¿™é‡Œæœ‰2ä¸ªtraitï¼Œæ‰€ä»¥æœ‰2ä¸ª vtableï¼Œè¿™å°±éœ€è¦ \u0026amp;(dyn Trait + Trait2) æŒ‡é’ˆæ˜¯3ä¸ªå®½åº¦ã€‚åƒ Send å’Œ Sync è¿™æ ·çš„è‡ªåŠ¨ trait æ˜¯å…è®¸çš„ï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰æ–¹æ³•ï¼Œå› æ­¤æ²¡æœ‰ vtableã€‚\nè¿™æ–¹é¢çš„å˜é€šæ–¹æ³•æ˜¯é€šè¿‡ä½¿ç”¨å¦ä¸€ä¸ª trait æ¥ç»„åˆ vtableï¼Œæ¯”å¦‚è¿™æ ·ã€‚\ntraitTrait{fn method(\u0026amp;self){}}traitTrait2{fn method2(\u0026amp;self){}}traitTrait3: Trait+Trait2{}// auto blanket impl Trait3 for any type that also impls Trait \u0026amp; Trait2 impl\u0026lt;T: Trait+Trait2\u0026gt;Trait3forT{}// from `dyn Trait + Trait2` to `dyn Trait3` fn function(t: \u0026amp;dynTrait3){t.method();// compiles t.method2();// compiles }è¿™ä¸ªå˜é€šæ–¹æ³•çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯ï¼ŒRust ä¸æ”¯æŒ supertrait å‘ä¸Šè½¬æ¢ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ª dyn Trait3ï¼Œæˆ‘ä»¬ä¸èƒ½åœ¨éœ€è¦ dyn Trait æˆ– dyn Trait2 çš„åœ°æ–¹ä½¿ç”¨å®ƒã€‚è¿™ä¸ªç¨‹åºä¸èƒ½ç¼–è¯‘ã€‚\ntraitTrait{fn method(\u0026amp;self){}}traitTrait2{fn method2(\u0026amp;self){}}traitTrait3: Trait+Trait2{}impl\u0026lt;T: Trait+Trait2\u0026gt;Trait3forT{}struct Struct;implTraitforStruct{}implTrait2forStruct{}fn takes_trait(t: \u0026amp;dynTrait){}fn takes_trait2(t: \u0026amp;dynTrait2){}fn main(){lett: \u0026amp;dynTrait3=\u0026amp;Struct;takes_trait(t);// compile error takes_trait2(t);// compile error }æŠ›å‡º:\nerror[E0308]: mismatchedtypes--\u0026gt; src/main.rs:22:17|22|takes_trait(t);|^expectedtrait`Trait`,foundtrait`Trait3`|=note: expectedreference`\u0026amp;dynTrait`foundreference`\u0026amp;dynTrait3`error[E0308]: mismatchedtypes--\u0026gt; src/main.rs:23:18|23|takes_trait2(t);|^expectedtrait`Trait2`,foundtrait`Trait3`|=note: expectedreference`\u0026amp;dynTrait2`foundreference`\u0026amp;dynTrait3`è¿™æ˜¯å› ä¸º dyn Trait3 æ˜¯ä¸€ä¸ªä¸åŒäº dyn Trait å’Œ dyn Trait çš„ç±»å‹ï¼Œå› ä¸ºå®ƒä»¬æœ‰ä¸åŒçš„ vtable å¸ƒå±€ï¼Œå°½ç®¡ dyn Trait3 ç¡®å®åŒ…å« dyn Trait å’Œ dyn Trait2 çš„æ‰€æœ‰æ–¹æ³•ã€‚è¿™é‡Œçš„å˜é€šåŠæ³•æ˜¯å¢åŠ æ˜¾å¼è½¬æ¢æ–¹æ³•ã€‚\ntraitTrait{}traitTrait2{}traitTrait3: Trait+Trait2{fn as_trait(\u0026amp;self)-\u0026gt; \u0026amp;dynTrait;fn as_trait2(\u0026amp;self)-\u0026gt; \u0026amp;dynTrait2;}impl\u0026lt;T: Trait+Trait2\u0026gt;Trait3forT{fn as_trait(\u0026amp;self)-\u0026gt; \u0026amp;dynTrait{self}fn as_trait2(\u0026amp;self)-\u0026gt; \u0026amp;dynTrait2{self}}struct Struct;implTraitforStruct{}implTrait2forStruct{}fn takes_trait(t: \u0026amp;dynTrait){}fn takes_trait2(t: \u0026amp;dynTrait2){}fn main(){lett: \u0026amp;dynTrait3=\u0026amp;Struct;takes_trait(t.as_trait());// compiles takes_trait2(t.as_trait2());// compiles }è¿™æ˜¯ä¸€ä¸ªç®€å•è€Œç›´æ¥çš„å·¥ä½œæ–¹æ³•ï¼Œä¼¼ä¹æ˜¯ Rust ç¼–è¯‘å™¨å¯ä»¥ä¸ºæˆ‘ä»¬è‡ªåŠ¨å®Œæˆçš„äº‹æƒ…ã€‚Rust å¹¶ä¸ç¾äºæ‰§è¡Œç±»å‹èƒè¿«ï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨ deref å’Œ unsized èƒè¿«ä¸­æ‰€çœ‹åˆ°çš„é‚£æ ·ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆæ²¡æœ‰ trait å‘ä¸Šèƒè¿«å‘¢ï¼Ÿè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é—®é¢˜ï¼Œæœ‰ä¸€ä¸ªç†Ÿæ‚‰çš„ç­”æ¡ˆï¼šRustæ ¸å¿ƒå›¢é˜Ÿæ­£åœ¨ç ”ç©¶å…¶ä»–æ›´é«˜ä¼˜å…ˆçº§å’Œæ›´é«˜å½±å“çš„åŠŸèƒ½ã€‚å¾ˆå…¬å¹³ã€‚\nå…³é”®è¦ç‚¹\n Rust ä¸æ”¯æŒå®½åº¦è¶…è¿‡2çš„æŒ‡é’ˆï¼Œæ‰€ä»¥\u0026hellip;  æˆ‘ä»¬ä¸èƒ½å°†ä¸ç¡®å®šå¤§å°çš„ç±»å‹è½¬æ¢ trait å¯¹è±¡ æˆ‘ä»¬ä¸èƒ½æœ‰å¤šä¸ª trait å¯¹è±¡ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†å¤šä¸ª trait å¼ºè½¬æˆä¸€ä¸ª trait æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚    ç”¨æˆ·è‡ªå®šä¹‰çš„ä¸ç¡®å®šå¤§å°ç±»å‹ struct Unsized{unsized_field: [i32],}æˆ‘ä»¬å¯ä»¥é€šè¿‡èµ‹äºˆç»“æ„ä½“ä¸€ä¸ªä¸ç¡®å®šå¤§å°çš„å­—æ®µæ¥å®šä¹‰ä¸€ä¸ªä¸ç¡®å®šå¤§å°çš„ç»“æ„ä½“ã€‚ä¸ç¡®å®šå¤§å°çš„ç»“æ„ä½“åªèƒ½æœ‰1ä¸ªä¸ç¡®å®šå¤§å°çš„å­—æ®µï¼Œè€Œä¸”å®ƒå¿…é¡»æ˜¯ç»“æ„ä½“ä¸­çš„æœ€åä¸€ä¸ªå­—æ®µã€‚è¿™æ˜¯ä¸€ä¸ªè¦æ±‚ï¼Œè¿™æ ·ç¼–è¯‘å™¨å°±å¯ä»¥åœ¨ç¼–è¯‘æ—¶ç¡®å®šç»“æ„ä¸­æ¯ä¸ªå­—æ®µçš„èµ·å§‹åç§»é‡ï¼Œè¿™å¯¹é«˜æ•ˆå¿«é€Ÿçš„å­—æ®µè®¿é—®éå¸¸é‡è¦ã€‚æ­¤å¤–ï¼Œä½¿ç”¨åŒå®½åº¦æŒ‡é’ˆæœ€å¤šåªèƒ½è·Ÿè¸ªä¸€ä¸ªä¸ç¡®å®šå¤§å°çš„å­—æ®µï¼Œå› ä¸ºæ›´å¤šçš„ä¸ç¡®å®šå¤§å°çš„å­—æ®µå°†éœ€è¦æ›´å¤šçš„å®½åº¦ã€‚\né‚£ä¹ˆæˆ‘ä»¬åˆ°åº•è¯¥å¦‚ä½•å®ä¾‹åŒ–è¿™ä¸ªä¸œè¥¿å‘¢ï¼Ÿå’Œæˆ‘ä»¬å¤„ç†ä»»ä½•ä¸ç¡®å®šå¤§å°ç±»å‹çš„æ–¹å¼ä¸€æ ·ï¼šå…ˆåšä¸€ä¸ªå¯ç¡®å®šå¤§å°çš„ç‰ˆæœ¬ï¼Œç„¶åèƒè¿«å®ƒå˜æˆä¸ç¡®å®šå¤§å°çš„ç‰ˆæœ¬ã€‚ç„¶è€Œï¼ŒUnsized çš„å®šä¹‰æ€»æ˜¯ä¸ç¡®å®šå¤§å°çš„ï¼Œæ²¡æœ‰åŠæ³•åˆ¶ä½œå®ƒçš„å¯ç¡®å®šå¤§å°ç‰ˆæœ¬ï¼å”¯ä¸€çš„å˜é€šåŠæ³•æ˜¯ä½¿ç»“æ„ä½“é€šç”¨åŒ–ï¼Œä½¿å®ƒå¯ä»¥å­˜åœ¨äºç¡®å®šå¤§å°çš„ç‰ˆæœ¬ä¸­å’Œä¸ç¡®å®šå¤§å°çš„ç‰ˆæœ¬ä¸­ã€‚\nstruct MaybeSized\u0026lt;T: ?Sized\u0026gt;{maybe_sized: T,}fn main(){// unsized coercion from MaybeSized\u0026lt;[i32; 3]\u0026gt; to MaybeSized\u0026lt;[i32]\u0026gt; letms: \u0026amp;MaybeSized\u0026lt;[i32]\u0026gt;=\u0026amp;MaybeSized{maybe_sized: [1,2,3]};}é‚£ä¹ˆè¿™æœ‰ä»€ä¹ˆç”¨å¤„å‘¢ï¼Ÿæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«å¼•äººæ³¨ç›®çš„ï¼Œç”¨æˆ·å®šä¹‰çš„ä¸ç¡®å®šå¤§å°çš„ç±»å‹ç°åœ¨æ˜¯ä¸€ä¸ªéå¸¸åŠæˆå“çš„åŠŸèƒ½ï¼Œå®ƒä»¬çš„å±€é™æ€§è¶…è¿‡äº†ä»»ä½•å¥½å¤„ã€‚è¿™é‡Œæåˆ°å®ƒä»¬çº¯ç²¹æ˜¯ä¸ºäº†å…¨é¢æ€§ã€‚\næœ‰è¶£çš„äº‹å®ï¼š std::fi::OsStr å’Œ std::path::Path æ˜¯æ ‡å‡†åº“ä¸­çš„2ä¸ªä¸ç¡®å®šå¤§å°çš„ç»“æ„ï¼Œä½ å¯èƒ½å·²ç»åœ¨ä¸çŸ¥ä¸è§‰ä¸­ä½¿ç”¨è¿‡äº†ã€‚\nå…³é”® è¦ç‚¹\n ç”¨æˆ·å®šä¹‰çš„ä¸ç¡®å®šå¤§å°ç±»å‹ç°åœ¨æ˜¯ä¸€ä¸ªåŠæˆå“çš„åŠŸèƒ½ï¼Œå®ƒä»¬çš„å±€é™æ€§è¶…è¿‡äº†ä»»ä½•å¥½å¤„  Zero-Sized ç±»å‹ Zero-Sized ä¹å¬èµ·æ¥å¾ˆå¥‡å¼‚ï¼Œä½†åˆ°å¤„éƒ½åœ¨ä½¿ç”¨ã€‚\nUnit ç±»å‹ æœ€å¸¸è§çš„é›¶å¤§å°ç±»å‹æ˜¯ Unit ç±»å‹: (). æ‰€æœ‰çš„ç©ºå— {} éƒ½è¯„ä¼°ä¸º ()ï¼Œå¦‚æœå—æ˜¯éç©ºçš„ï¼Œä½†æœ€åä¸€ä¸ªè¡¨è¾¾å¼ç”¨åˆ†å· ; ä¸¢å¼ƒï¼Œé‚£ä¹ˆå®ƒä¹Ÿè¯„ä¼°ä¸º ()ã€‚ä¾‹å­å¦‚ä¸‹:\nfn main(){leta: ()={};letb: i32 ={5};letc: ()={5;};}æ¯ä¸€ä¸ªæ²¡æœ‰æ˜¾å¼è¿”å›ç±»å‹çš„å‡½æ•°éƒ½ä¼šé»˜è®¤è¿”å› ()ã€‚\n// with sugar fn function(){}// desugared fn function()-\u0026gt; (){}ç”±äº () æ˜¯é›¶å­—èŠ‚ï¼Œæ‰€ä»¥ () çš„æ‰€æœ‰å®ä¾‹éƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¿™ä½¿å¾— Defaultã€PartialEq å’Œ Ord çš„å®ç°éå¸¸ç®€å•ã€‚\nusestd::cmp::Ordering;implDefaultfor(){fn default(){}}implPartialEqfor(){fn eq(\u0026amp;self,_other: \u0026amp;())-\u0026gt; bool {true}fn ne(\u0026amp;self,_other: \u0026amp;())-\u0026gt; bool {false}}implOrdfor(){fn cmp(\u0026amp;self,_other: \u0026amp;())-\u0026gt; Ordering{Ordering::Equal}}ç¼–è¯‘å™¨ç†è§£ () æ˜¯é›¶å¤§å°çš„ï¼Œå¹¶ä¼˜åŒ–äº†ä¸ () å®ä¾‹çš„äº¤äº’ã€‚ä¾‹å¦‚ï¼ŒVec\u0026lt;()\u0026gt; æ°¸è¿œä¸ä¼šè¿›è¡Œä»»ä½•å †åˆ†é…ï¼Œä» Vec ä¸­æ¨é€å’Œå¼¹å‡º () åªæ˜¯å¢åŠ å’Œå‡å°‘å®ƒçš„ len å­—æ®µã€‚\nfn main(){// zero capacity is all the capacity we need to \u0026#34;store\u0026#34; infinitely many () letmutvec: Vec\u0026lt;()\u0026gt;=Vec::with_capacity(0);// causes no heap allocations or vec capacity changes vec.push(());// len++ vec.push(());// len++ vec.push(());// len++ vec.pop();// len-- assert_eq!(2,vec.len());}ä¸Šé¢çš„ä¾‹å­æ²¡æœ‰å®é™…åº”ç”¨ï¼Œä½†æ˜¯æœ‰æ²¡æœ‰ä»€ä¹ˆæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰æ„ä¹‰åœ°åˆ©ç”¨ä¸Šé¢çš„æƒ³æ³•å‘¢ï¼Ÿä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œæ˜¯çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°† Value è®¾ç½®ä¸º ()ï¼Œä» HashMap\u0026lt;Keyï¼ŒValue\u0026gt; ä¸­å¾—åˆ°ä¸€ä¸ªé«˜æ•ˆçš„ HashSet\u0026lt;Key\u0026gt; å®ç°ï¼Œè¿™æ­£æ˜¯ Rust æ ‡å‡†åº“ä¸­ HashSet çš„å·¥ä½œåŸç†ã€‚\n// std::collections::HashSet pubstruct HashSet\u0026lt;T\u0026gt;{map: HashMap\u0026lt;T,()\u0026gt;,}å…³é”®è¦ç‚¹\n ZST çš„æ‰€æœ‰å®ä¾‹éƒ½æ˜¯å½¼æ­¤ç›¸ç­‰çš„ã€‚ Rust ç¼–è¯‘å™¨çŸ¥é“ä¼˜åŒ–ä¸ ZSTs çš„äº¤äº’ã€‚  ç”¨æˆ·è‡ªå®šä¹‰çš„ Unit ç»“æ„ä½“ Unit ç»“æ„ä½“æ˜¯æŒ‡ä¸å«ä»»ä½•å­—æ®µçš„ç»“æ„ä½“ï¼Œå¦‚\nstruct Struct;å±æ€§ï¼Œä½¿ Unit ç»“æ„ä½“æ¯” () æ›´æœ‰ç”¨ã€‚\n æˆ‘ä»¬å¯ä»¥åœ¨è‡ªå·±çš„ Unit ç»“æ„ä½“ä¸Šå®ç°ä»»ä½•æˆ‘ä»¬æƒ³è¦çš„ traitï¼ŒRust çš„ trait å­¤å„¿è§„åˆ™é˜»æ­¢æˆ‘ä»¬å®ç°æ ‡å‡†åº“ä¸­å®šä¹‰çš„ () çš„ traitã€‚ åœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­ï¼ŒUnit ç»“æ„ä½“å¯ä»¥è¢«èµ‹äºˆæœ‰æ„ä¹‰çš„åç§°ã€‚ Unit ç»“æ„ä½“ï¼Œå°±åƒæ‰€æœ‰ç»“æ„ä½“ä¸€æ ·ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸å¯å¤åˆ¶çš„ï¼Œè¿™åœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­å¯èƒ½å¾ˆé‡è¦ã€‚  Never ç±»å‹ ç¬¬äºŒç§æœ€å¸¸è§çš„ ZST æ˜¯ never ç±»å‹: !ã€‚ ä¹‹æ‰€ä»¥ç§°ä¸º never ç±»å‹ï¼Œæ˜¯å› ä¸ºå®ƒä»£è¡¨çš„æ˜¯æ°¸è¿œä¸ä¼šè§£æåˆ°ä»»ä½•å€¼çš„è®¡ç®—ã€‚\n! çš„å‡ ä¸ªæœ‰è¶£çš„ç‰¹æ€§ä½¿å®ƒä¸åŒäº ()ã€‚\n ! å¯ä»¥è¢«èƒè¿«æˆä»»ä½•å…¶ä»–ç±»å‹ã€‚ ä¸å¯èƒ½åˆ›å»º ! çš„å®ä¾‹ã€‚  ç¬¬ä¸€ä¸ªæœ‰è¶£çš„å±æ€§å¯¹äººä½“å·¥ç¨‹å­¦éå¸¸æœ‰ç”¨ï¼Œå…è®¸æˆ‘ä»¬ä½¿ç”¨åƒè¿™æ ·çš„æ–¹ä¾¿çš„å®ã€‚\n// nice for quick prototyping fn example\u0026lt;T\u0026gt;(t: \u0026amp;[T])-\u0026gt; Vec\u0026lt;T\u0026gt;{unimplemented!()// ! coerced to Vec\u0026lt;T\u0026gt; }fn example2()-\u0026gt; i32 {// we know this parse call will never fail match\u0026#34;123\u0026#34;.parse::\u0026lt;i32\u0026gt;(){Some(num)=\u0026gt;num,None=\u0026gt;unreachable!(),// ! coerced to i32 }}fn example3(some_condition: bool)-\u0026gt; \u0026amp;\u0026#39;staticstr{if!some_condition{panic!()// ! coerced to \u0026amp;str }else{\u0026#34;str\u0026#34;}}break, continue å’Œ return è¡¨è¾¾å¼ä¹Ÿæ‹¥æœ‰ç±»å‹ !:\nfn example()-\u0026gt; i32 {// we can set the type of x to anything here // since the block never evaluates to any value letx: String ={return123// ! coerced to String };}fn example2(nums: \u0026amp;[i32])-\u0026gt; Vec\u0026lt;i32\u0026gt;{letmutfiltered=Vec::new();fornuminnums{filtered.push(if*num\u0026lt;0{break// ! coerced to i32 }elseif*num%2==0{*num}else{continue// ! coerced to i32 });}filtered}! çš„ç¬¬äºŒä¸ªæœ‰è¶£çš„å±æ€§å…è®¸æˆ‘ä»¬åœ¨ç±»å‹å±‚é¢ä¸Šå°†æŸäº›çŠ¶æ€æ ‡è®°ä¸ºä¸å¯èƒ½ã€‚è®©æˆ‘ä»¬ä»¥è¿™ä¸ªå‡½æ•°ç­¾åä¸ºä¾‹ã€‚\nfn function()-\u0026gt; Result\u0026lt;Success,Error\u0026gt;;æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœå‡½æ•°è¿”å›å¹¶æˆåŠŸï¼ŒResult å°†åŒ…å«ä¸€äº›ç±»å‹ä¸º Success çš„å®ä¾‹ï¼Œå¦‚æœå‡½æ•°å‡ºé”™ï¼ŒResult å°†åŒ…å«ä¸€äº›ç±»å‹ä¸º Error çš„å®ä¾‹ã€‚ç°åœ¨æˆ‘ä»¬æ¥å¯¹æ¯”ä¸€ä¸‹è¿™ä¸ªå‡½æ•°çš„ç­¾åã€‚\nfn function()-\u0026gt; Result\u0026lt;Success,!\u0026gt;;æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœå‡½æ•°è¿”å›å¹¶ä¸”æˆåŠŸäº†ï¼ŒResult å°†æŒæœ‰ä¸€äº›ç±»å‹ä¸º Success çš„å®ä¾‹ï¼Œå¦‚æœå‡ºé”™äº†\u0026hellip;ä½†ç­‰ç­‰ï¼Œå®ƒæ°¸è¿œä¸ä¼šå‡ºé”™ï¼Œå› ä¸ºä¸å¯èƒ½åˆ›å»º ! çš„å®ä¾‹ã€‚é‰´äºä¸Šé¢çš„å‡½æ•°ç­¾åï¼Œæˆ‘ä»¬çŸ¥é“è¿™ä¸ªå‡½æ•°æ°¸è¿œä¸ä¼šå‡ºé”™ã€‚é‚£è¿™ä¸ªå‡½æ•°ç­¾åå‘¢:\nfn function()-\u0026gt; Result\u0026lt;!,Error\u0026gt;;å‰é¢çš„åä¹‰è¯ç°åœ¨æ˜¯çœŸçš„ï¼šå¦‚æœè¿™ä¸ªå‡½æ•°è¿”å›ï¼Œæˆ‘ä»¬çŸ¥é“å®ƒè‚¯å®šå‡ºé”™äº†ï¼Œå› ä¸ºæˆåŠŸæ˜¯ä¸å¯èƒ½çš„ã€‚\nå‰ä¸€ä¸ªä¾‹å­çš„å®é™…åº”ç”¨æ˜¯ FromStr å¯¹ String çš„å®ç°ï¼Œå› ä¸ºå°† \u0026amp;str è½¬æ¢ä¸º String æ˜¯ä¸å¯èƒ½å¤±è´¥çš„ã€‚\n#![feature(never_type)]usestd::str::FromStr;implFromStrforString{type Err =!;fn from_str(s: \u0026amp;str)-\u0026gt; Result\u0026lt;String,Self::Err\u0026gt;{Ok(String::from(s))}}åä¸€ä¸ªä¾‹å­çš„å®é™…åº”ç”¨æ˜¯ä¸€ä¸ªè¿è¡Œæ— é™å¾ªç¯çš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ°¸è¿œä¸æ‰“ç®—è¿”å›ï¼Œå°±åƒæœåŠ¡å™¨å“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚ä¸€æ ·ï¼Œé™¤éæœ‰ä¸€äº›é”™è¯¯ã€‚\n#![feature(never_type)]fn run_server()-\u0026gt; Result\u0026lt;!,ConnectionError\u0026gt;{loop{let(request,response)=get_request()?;letresult=request.process();response.send(result);}}è¿™ä¸ª feature æ ‡è®°æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºå½“ never ç±»å‹å­˜åœ¨å¹¶åœ¨ Rust å†…éƒ¨å·¥ä½œæ—¶ï¼Œåœ¨ç”¨æˆ·ä»£ç ä¸­ä½¿ç”¨å®ƒä»ç„¶è¢«è®¤ä¸ºæ˜¯å®éªŒæ€§çš„ã€‚\nè¦ç‚¹\n ! å¯ä»¥è¢«èƒè¿«æˆä»»ä½•å…¶ä»–ç±»å‹ã€‚ ä¸å¯èƒ½åˆ›å»º ! çš„å®ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥æ ‡è®°æŸäº›çŠ¶æ€ï¼Œåœ¨ç±»å‹çº§åˆ«ä¸Šæ˜¯ä¸å¯èƒ½çš„ã€‚  ç”¨æˆ·å®šä¹‰çš„ä¼ª Never ç±»å‹ è™½ç„¶ä¸å¯èƒ½å®šä¹‰ä¸€ä¸ªå¯ä»¥å¼ºåˆ¶åˆ°ä»»ä½•å…¶ä»–ç±»å‹çš„ç±»å‹ï¼Œä½†å¯ä»¥å®šä¹‰ä¸€ä¸ªä¸å¯èƒ½åˆ›å»ºå®ä¾‹çš„ç±»å‹ï¼Œæ¯”å¦‚ä¸€ä¸ª enumï¼Œæ²¡æœ‰ä»»ä½•å˜ä½“ã€‚\nenum Void{}è¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥ä»å‰é¢çš„2ä¸ªä¾‹å­ä¸­ç§»é™¤ feature æ ‡è®°ï¼Œå¹¶ä½¿ç”¨ç¨³å®šçš„ Rust å®ç°å®ƒä»¬ã€‚\nenum Void{}// example 1 implFromStrforString{type Err =Void;fn from_str(s: \u0026amp;str)-\u0026gt; Result\u0026lt;String,Self::Err\u0026gt;{Ok(String::from(s))}}// example 2 fn run_server()-\u0026gt; Result\u0026lt;Void,ConnectionError\u0026gt;{loop{let(request,response)=get_request()?;letresult=request.process();response.send(result);}}è¿™æ˜¯ Rust æ ‡å‡†åº“ä½¿ç”¨çš„æŠ€æœ¯ï¼Œå› ä¸º String çš„ FromStr å®ç°çš„ Err ç±»å‹æ˜¯ std::convert::Infallibleï¼Œå®ƒè¢«å®šä¹‰ä¸º:\npubenum Infallible{}PhantomData ç¬¬ä¸‰ç§æœ€å¸¸ç”¨çš„ ZST å¯èƒ½æ˜¯ PhantomDataã€‚PhantomData æ˜¯ä¸€ä¸ªé›¶å¤§å°çš„æ ‡è®°ç»“æ„ï¼Œå®ƒå¯ä»¥ç”¨æ¥ \u0026ldquo;æ ‡è®°\u0026rdquo; ä¸€ä¸ªåŒ…å«çš„ç»“æ„ä½“å…·æœ‰æŸäº›å±æ€§ã€‚å®ƒå’Œå®ƒçš„è‡ªåŠ¨æ ‡è®° trait è¡¨äº²å¦‚ Sizedã€Sendã€Sync ç­‰åœ¨ç›®çš„ä¸Šæ˜¯ç›¸ä¼¼çš„ï¼Œä½†ä½œä¸ºä¸€ä¸ªæ ‡è®°ç»“æ„ä½“çš„ä½¿ç”¨æ–¹å¼æœ‰ç‚¹ä¸åŒã€‚å¯¹ PhantomData è¿›è¡Œå½»åº•çš„è§£é‡Šå¹¶æ¢ç´¢å®ƒçš„æ‰€æœ‰ç”¨ä¾‹ä¸åœ¨æœ¬æ–‡çš„èŒƒå›´å†…ï¼Œæ‰€ä»¥æˆ‘ä»¬åªç®€å•åœ°ä»‹ç»ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚å›é¡¾ä¸€ä¸‹å‰é¢ä»‹ç»çš„è¿™ä¸ªä»£ç ç‰‡æ®µã€‚\n#![feature(negative_impls)]// this type is Send and Sync struct Struct;// opt-out of Send trait impl!SendforStruct{}// opt-out of Sync trait impl!SyncforStruct{}å¾ˆä¸å¹¸ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨ä¸€ä¸ª feature æ ‡è®°ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥åªä½¿ç”¨ç¨³å®šçš„ Rust æ¥è¾¾åˆ°åŒæ ·çš„ç»“æœï¼Ÿæˆ‘ä»¬å·²ç»äº†è§£åˆ°ï¼Œä¸€ä¸ªç±»å‹åªæœ‰å½“å®ƒçš„æ‰€æœ‰æˆå‘˜ä¹Ÿæ˜¯ Send å’Œ Sync æ—¶æ‰æ˜¯ Send å’Œ Sync çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åƒ Rc\u0026lt;()\u0026gt; ä¸€æ ·åœ¨ Struct ä¸­æ·»åŠ ä¸€ä¸ª !Send å’Œ !Sync æˆå‘˜ã€‚\nusestd::rc::Rc;// this type is not Send or Sync struct Struct{// adds 8 bytes to every instance _not_send_or_sync: Rc\u0026lt;()\u0026gt;,}è¿™ä¸å¤ªç†æƒ³ï¼Œå› ä¸ºå®ƒå¢åŠ äº† Struct çš„æ¯ä¸ªå®ä¾‹çš„å¤§å°ï¼Œè€Œä¸”æˆ‘ä»¬ç°åœ¨æ¯æ¬¡è¦åˆ›å»ºä¸€ä¸ª Struct æ—¶ï¼Œè¿˜å¾—å‡­ç©ºæƒ³è±¡å‡ºä¸€ä¸ª Rc\u0026lt;()\u0026gt;ã€‚ç”±äº PhantomData æ˜¯ä¸€ä¸ª ZSTï¼Œå®ƒè§£å†³äº†è¿™ä¸¤ä¸ªé—®é¢˜ã€‚\nusestd::rc::Rc;usestd::marker::PhantomData;type NotSendOrSyncPhantom=PhantomData\u0026lt;Rc\u0026lt;()\u0026gt;\u0026gt;;// this type is not Send or Sync struct Struct{// adds no additional size to instances _not_send_or_sync: NotSendOrSyncPhantom,}å…³é”®è¦ç‚¹\n PhantomData æ˜¯ä¸€ä¸ªé›¶å¤§å°çš„æ ‡è®°ç»“æ„ï¼Œå®ƒå¯ä»¥ç”¨æ¥ \u0026ldquo;æ ‡è®°\u0026rdquo; ä¸€ä¸ªåŒ…å«çš„ç»“æ„ä½“å…·æœ‰æŸäº›å±æ€§ã€‚  ç»“è®º  åªæœ‰ç¡®å®šå¤§å°ç±»å‹çš„å®ä¾‹æ‰èƒ½è¢«æ”¾ç½®åœ¨æ ˆä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥é€šè¿‡å€¼æ¥ä¼ é€’ ä¸ç¡®å®šå¤§å°ç±»å‹çš„å®ä¾‹ä¸èƒ½æ”¾åœ¨æ ˆä¸Šï¼Œå¿…é¡»é€šè¿‡å¼•ç”¨æ¥ä¼ é€’ã€‚ æŒ‡å‘ä¸ç¡®å®šå¤§å°ç±»å‹çš„æŒ‡é’ˆæ˜¯åŒå®½åº¦çš„ï¼Œå› ä¸ºé™¤äº†æŒ‡å‘æ•°æ®å¤–ï¼Œå®ƒä»¬è¿˜éœ€è¦åšé¢å¤–çš„è®°è´¦å·¥ä½œï¼Œä»¥è·Ÿè¸ªæ•°æ®çš„é•¿åº¦æˆ–æŒ‡å‘ä¸€ä¸ª vtableã€‚ Sized æ˜¯ä¸€ä¸ª \u0026ldquo;è‡ªåŠ¨\u0026rdquo; æ ‡è®° traitã€‚ æ‰€æœ‰çš„æ³›å‹ç±»å‹å‚æ•°é»˜è®¤éƒ½æ˜¯è‡ªåŠ¨ç»‘å®š Sized çš„ã€‚ å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªæ³›å‹å‡½æ•°ï¼Œå®ƒçš„å‚æ•°æ˜¯æŒ‡é’ˆåé¢çš„ä¸€äº› Tï¼Œä¾‹å¦‚ \u0026amp;Tã€Box\u0026lt;T\u0026gt;ã€Rc\u0026lt;T\u0026gt; ç­‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å‡ ä¹æ€»æ˜¯å¸Œæœ›ç”¨ T: ?Sized æ¥é€€å‡ºé»˜è®¤çš„ Sized çº¦æŸã€‚ åˆ©ç”¨åˆ‡ç‰‡å’Œ Rust çš„è‡ªåŠ¨ç±»å‹å¼ºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™çµæ´»çš„ APIã€‚ æ‰€æœ‰çš„ trait é»˜è®¤ä¸º Sizedã€‚ Trait: ?Sized æ˜¯ impl Trait for dyn Trait æ‰€å¿…éœ€çš„ã€‚ æˆ‘ä»¬å¯ä»¥æ ¹æ®æ¯ä¸ªæ–¹æ³•è¦æ±‚ Self: Sizedã€‚ ç”± Sized  ç»‘å®šçš„ trait ä¸èƒ½è¢«åˆ¶ä½œæˆ trait å¯¹è±¡ã€‚ Rust ä¸æ”¯æŒå®½åº¦è¶…è¿‡2çš„æŒ‡é’ˆï¼Œæ‰€ä»¥\u0026hellip;  æˆ‘ä»¬ä¸èƒ½å°†ä¸ç¡®å®šå¤§å°çš„ç±»å‹è½¬æ¢ä¸º trait å¯¹è±¡ æˆ‘ä»¬ä¸èƒ½æœ‰å¤š trait å¯¹è±¡ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†å¤šä¸ª trait è½¬åŒ–æˆä¸€ä¸ª trait æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚   ç”¨æˆ·å®šä¹‰çš„ä¸ç¡®å®šå¤§å°çš„ç±»å‹ç°åœ¨æ˜¯ä¸€ä¸ªåŠæˆå“çš„åŠŸèƒ½ï¼Œå®ƒä»¬çš„å±€é™æ€§è¶…è¿‡äº†ä»»ä½•å¥½å¤„ ZST çš„æ‰€æœ‰å®ä¾‹éƒ½æ˜¯å½¼æ­¤ç›¸ç­‰çš„ã€‚ Rust ç¼–è¯‘å™¨çŸ¥é“ä¼˜åŒ–ä¸ ZSTs çš„äº¤äº’ã€‚ ! å¯ä»¥è¢«èƒè¿«æˆä»»ä½•å…¶ä»–ç±»å‹ã€‚ ä¸å¯èƒ½åˆ›å»º ! çš„å®ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥æ ‡è®°æŸäº›çŠ¶æ€ï¼Œåœ¨ç±»å‹çº§åˆ«ä¸Šæ˜¯ä¸å¯èƒ½çš„ã€‚ PhantomData æ˜¯ä¸€ä¸ªé›¶å¤§å°çš„æ ‡è®°ç»“æ„ï¼Œå®ƒå¯ä»¥ç”¨æ¥ \u0026ldquo;æ ‡è®°\u0026rdquo; ä¸€ä¸ªåŒ…å«çš„ç»“æ„ä½“å…·æœ‰æŸäº›å±æ€§ã€‚  è®¨è®º åœ¨è¿™é‡Œè®¨è®ºæœ¬æ–‡:\n official Rust users forum learnrust subreddit Twitter rust subreddit Github  é€šçŸ¥ å½“å‘è¡¨ä¸‹ä¸€ç¯‡åšæ–‡æ—¶ï¼Œä¼šæ”¶åˆ°é€šçŸ¥:\n Following pretzelhammer on Twitter or Watching this repo\u0026rsquo;s releases (click Watch -\u0026gt; click Custom -\u0026gt; select Releases -\u0026gt; click Apply)  æ›´å¤šé˜…è¯»  Common Rust Lifetime Misconceptions Tour of Rust\u0026rsquo;s Standard Library Traits Learning Rust in 2020 Learn Assembly with Entirely Too Many Brainfuck Compilers  ","permalink":"https://ohmyweekly.github.io/notes/2021-04-11-sizedness-in-rust/","tags":["Rust","Sizedness"],"title":"Sizedness in Rust"},{"categories":["Rust"],"contents":"æœ¬å¸–æ–‡æ¡£è°ƒç”¨ç«™ç‚¹ä¾èµ–æ³¨å…¥æ¨¡å¼ã€‚è¿™æ˜¯ä¸€ä¸ªç›¸å½“ä½çº§çš„æ ·æœ¬ï¼Œå’Œä¼ä¸š DI æ²¡æœ‰ä»€ä¹ˆå…³ç³»ã€‚è¿™ä¸ªæ¨¡å¼æœ‰ç‚¹ Rust ç‰¹æœ‰ã€‚\né€šå¸¸ï¼Œå½“ä½ å®ç°ä¸€ä¸ªéœ€è¦ç”¨æˆ·æä¾›ä¸€äº›åŠŸèƒ½çš„ç±»å‹æ—¶ï¼Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯åœ¨æ„é€ å‡½æ•°ä¸­æä¾›å®ƒã€‚\nstruct Engine{config: Config,...}implEngine{fn new(config: Config)-\u0026gt; Engine{...}fn go(\u0026amp;mutself){...}}åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®ç°äº† Engineï¼Œè°ƒç”¨è€…æä¾›äº† Configã€‚\nå¦ä¸€ç§æ–¹æ³•æ˜¯å°†ä¾èµ–å…³ç³»ä¼ é€’ç»™æ¯ä¸ªæ–¹æ³•è°ƒç”¨ã€‚\nstruct Engine{...}implEngine{fn new()-\u0026gt; Engine{...}fn go(\u0026amp;mutself,config: \u0026amp;Config){...}}åœ¨ Rust ä¸­ï¼Œåè€…(call-site injection)æœ‰æ—¶ç”¨ lifetime æ›´å¥½ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™äº›ä¾‹å­å§!\nLazy å­—æ®µ åœ¨ç¬¬ä¸€ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æƒ³æ ¹æ®å…¶ä»–å­—æ®µæƒ°æ€§åœ°è®¡ç®—ä¸€ä¸ªå­—æ®µçš„å€¼ã€‚å°±åƒè¿™æ ·:\nstruct Widget{name: String,name_hash: Lazy\u0026lt;u64\u0026gt;,}implWidget{fn new(name: String)-\u0026gt; Widget{Widget{name,name_hash: Lazy::new(||{compute_hash(\u0026amp;self.name)}),}}}è¿™ä¸ªè®¾è®¡çš„é—®é¢˜æ˜¯åœ¨ Rust ä¸­æ— æ³•ä½¿ç”¨ã€‚Lazy ä¸­çš„é—­åŒ…éœ€è¦è®¿é—® selfï¼Œè€Œè¿™å°†åˆ›å»ºä¸€ä¸ªè‡ªå¼•ç”¨çš„æ•°æ®ç»“æ„!\nè§£å†³çš„åŠæ³•æ˜¯åœ¨ä½¿ç”¨ Lazy çš„åœ°æ–¹æä¾›é—­åŒ…ã€‚\nstruct Widget{name: String,name_hash: OnceCell\u0026lt;u64\u0026gt;,}implWidget{fn new(name: String)-\u0026gt; Widget{Widget{name,name_hash: OnceCell::new(),}}fn name_hash(\u0026amp;self)-\u0026gt; u64 {*self.name_hash.get_or_init(||{compute_hash(\u0026amp;self.name)})}}é—´æ¥å“ˆå¸Œè¡¨ ä¸‹ä¸€ä¸ªä¾‹å­æ˜¯å…³äºå°†ä¸€ä¸ªè‡ªå®šä¹‰çš„å“ˆå¸Œå‡½æ•°æ’å…¥åˆ°å“ˆå¸Œè¡¨ä¸­ã€‚åœ¨ Rust çš„æ ‡å‡†åº“ä¸­ï¼Œè¿™åªèƒ½åœ¨ç±»å‹çº§åˆ«ä¸Šå®ç°ï¼Œé€šè¿‡å®ç°ç±»å‹çš„ Hash ç‰¹æ€§ã€‚æ›´é€šç”¨çš„è®¾è®¡æ˜¯åœ¨è¿è¡Œæ—¶ç”¨å“ˆå¸Œå‡½æ•°ç»™è¡¨åšå‚æ•°ã€‚è¿™æ˜¯ C++ æ‰€åšçš„ã€‚ç„¶è€Œåœ¨ Rust ä¸­ï¼Œè¿™å°±ä¸å¤Ÿé€šç”¨äº†ã€‚\nè€ƒè™‘ä¸€ä¸ªå­—ç¬¦ä¸²äº’è¯‘å™¨ï¼Œå®ƒå°†å­—ç¬¦ä¸²å­˜å‚¨åœ¨ä¸€ä¸ªå‘é‡ä¸­ï¼Œå¹¶é¢å¤–ç»´æŠ¤ä¸€ä¸ªåŸºäºå“ˆå¸Œçš„ç´¢å¼•ã€‚\nstruct Interner{vec: Vec\u0026lt;String\u0026gt;,set: HashSet\u0026lt;usize\u0026gt;,}implInterner{fn intern(\u0026amp;mutself,s: \u0026amp;str)-\u0026gt; usize {...}fn lookup(\u0026amp;self,i: usize)-\u0026gt; \u0026amp;str {...}}set å­—æ®µå°†å­—ç¬¦ä¸²å­˜å‚¨åœ¨ä¸€ä¸ªå“ˆå¸Œè¡¨ä¸­ï¼Œä½†å®ƒæ˜¯ç”¨ç›¸é‚» vec çš„ç´¢å¼•æ¥è¡¨ç¤ºå®ƒä»¬ã€‚\nç”¨ä¸€ä¸ªé—­åŒ…æ¥æ„é€  set ä¸ä¼šæˆåŠŸï¼ŒåŸå› å’Œ Lazy ä¸€æ · - è¿™å°†åˆ›å»ºä¸€ä¸ªè‡ªå¼•ç”¨ç»“æ„ã€‚åœ¨ C++ ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªå˜é€šçš„æ–¹æ³• - å¯ä»¥å°† vec è£…ç®±ï¼Œå¹¶åœ¨ Interner å’Œé—­åŒ…ä¹‹é—´å…±äº«ä¸€ä¸ªç¨³å®šçš„æŒ‡é’ˆã€‚åœ¨ Rust ä¸­ï¼Œè¿™ä¼šäº§ç”Ÿåˆ«åï¼Œé˜»æ­¢ä½¿ç”¨ \u0026amp;mut Vecã€‚\nå¥‡æ€ªçš„æ˜¯ï¼Œåœ¨ std API ä¸­ï¼Œä½¿ç”¨æ’åºçš„ vec è€Œä¸æ˜¯å“ˆå¸Œæ˜¯å¯è¡Œçš„ã€‚\nstruct Interner{vec: Vec\u0026lt;String\u0026gt;,// Invariant: sorted set: Vec\u0026lt;usize\u0026gt;,}implInterner{fn intern(\u0026amp;mutself,s: \u0026amp;str)-\u0026gt; usize {letidx=self.set.binary_search_by(|\u0026amp;idx|{self.vec[idx].cmp(s)});matchidx{Ok(idx)=\u0026gt;self.set[idx],Err(idx)=\u0026gt;{letres=self.vec.len();self.vec.push(s.to_string());self.set.insert(idx,res);res}}}fn lookup(\u0026amp;self,i: usize)-\u0026gt; \u0026amp;str {...}}è¿™æ˜¯å› ä¸ºé—­åŒ…æ˜¯åœ¨è°ƒç”¨ç«™ç‚¹è€Œä¸æ˜¯åœ¨æ„é€ ç«™ç‚¹ä¾›ç»™çš„ã€‚\nhashbrown crate é€šè¿‡ RawEntry ä¸ºå“ˆå¸Œæä¾›äº†è¿™ç§é£æ ¼çš„ APIã€‚\nPer å®¹å™¨åˆ†é…å™¨ ç¬¬ä¸‰ä¸ªä¾‹å­æ¥è‡ª Zig ç¼–ç¨‹è¯­è¨€ã€‚ä¸ Rust ä¸åŒï¼ŒZig æ²¡æœ‰ä¸€ä¸ªç¥ç¦çš„å…¨å±€åˆ†é…å™¨ã€‚ç›¸åï¼ŒZig ä¸­çš„å®¹å™¨æœ‰ä¸¤ç§é£å‘³ã€‚\u0026ldquo;Managed\u0026rdquo; é£å‘³æ¥å—ä¸€ä¸ªåˆ†é…å™¨ä½œä¸ºæ„é€ å‚æ•°ï¼Œå¹¶å°†å…¶å­˜å‚¨ä¸ºä¸€ä¸ªå­—æ®µï¼ˆSourceï¼‰ã€‚è€Œ \u0026ldquo;Unmanaged\u0026rdquo; é£å‘³åˆ™åœ¨æ¯ä¸ªæ–¹æ³•ä¸­æ·»åŠ ä¸€ä¸ªåˆ†é…å™¨å‚æ•°ï¼ˆSourceï¼‰ã€‚\nç¬¬äºŒç§æ–¹å¼æ›´èŠ‚ä¿­ - å¯ä»¥ç”¨ä¸€ä¸ªåˆ†é…å™¨å¼•ç”¨ä¸è®¸å¤šå®¹å™¨ã€‚\nèƒ–æŒ‡é’ˆ æœ€åä¸€ä¸ªä¾‹å­æ¥è‡ªäº Rust è¯­è¨€æœ¬èº«ã€‚ä¸ºäº†å®ç°åŠ¨æ€è°ƒåº¦ï¼ŒRust ä½¿ç”¨äº†èƒ–æŒ‡é’ˆï¼Œå®ƒæœ‰ä¸¤ä¸ªå­—å®½ã€‚ç¬¬ä¸€ä¸ªå­—æŒ‡å‘å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå­—æŒ‡å‘ vtableã€‚è¿™äº›æŒ‡é’ˆæ˜¯åœ¨æ³›ç”¨å…·ä½“ç±»å‹çš„æ—¶å€™åˆ¶é€ çš„ã€‚\nè¿™ä¸ C++ ä¸åŒï¼ŒC++ çš„ vtable æŒ‡é’ˆæ˜¯åœ¨æ„é€ è¿‡ç¨‹ä¸­åµŒå…¥åˆ°å¯¹è±¡æœ¬èº«ä¸­çš„ã€‚\nçœ‹äº†è¿™äº›ä¾‹å­åï¼Œæˆ‘å¯¹ Scala å¼çš„éšå¼å‚æ•°å¾ˆçƒ­è¡·ã€‚è€ƒè™‘ä¸€ä¸‹è¿™æ®µå¸¦æœ‰ Zig é£æ ¼å‘é‡çš„ Rust ä»£ç çš„å‡è®¾ã€‚\n{letmuta=get_allocator();letmutxs=Vec::new();letmutys=Vec::new();xs.push(\u0026amp;muta,1);ys.push(\u0026amp;muta,2);}è¿™é‡Œçš„é—®é¢˜æ˜¯ Drop - é‡Šæ”¾å‘é‡éœ€è¦è®¿é—®åˆ†é…å™¨ï¼Œè€Œå¦‚ä½•æä¾›ä¸€ä¸ªåˆ†é…å™¨å¹¶ä¸æ¸…æ¥šã€‚Zig é€šè¿‡ä½¿ç”¨ defer è¯­å¥è€Œä¸æ˜¯ destructors èº²é¿äº†è¿™ä¸ªé—®é¢˜ã€‚åœ¨ä½¿ç”¨éšå¼å‚æ•°çš„ Rust ä¸­ï¼Œæˆ‘æƒ³ä¸‹é¢çš„æ–¹æ³•å¯ä»¥ç”¨ã€‚\nimpl\u0026lt;implicita: \u0026amp;mutAllocator,T\u0026gt;DropforVec\u0026lt;T\u0026gt;æœ€åï¼Œæˆ‘æƒ³åˆ†äº«æœ€åä¸€ä¸ªä¾‹å­ï¼ŒCSDI æ€ç»´å¸®åŠ©æˆ‘å‘ç°äº†ä¸€ä¸ªæ›´å¥½çš„åº”ç”¨çº§æ¶æ„ã€‚\nrust-analyzer çš„å¾ˆå¤šè¡Œä¸ºæ˜¯å¯ä»¥é…ç½®çš„ã€‚æœ‰åµŒå¥—æç¤ºçš„åˆ‡æ¢ï¼Œå®Œæˆåº¦å¯ä»¥è°ƒæ•´ï¼Œä¸€äº›åŠŸèƒ½æ ¹æ®ç¼–è¾‘å™¨çš„ä¸åŒè€Œæœ‰ä¸åŒçš„å·¥ä½œæ–¹å¼ã€‚ç¬¬ä¸€ä¸ªå®ç°æ˜¯å°†ä¸€ä¸ªå…¨å±€çš„ Config ç»“æ„å’Œå…¶ä»–åˆ†æçŠ¶æ€ä¸€èµ·å­˜å‚¨ã€‚ç„¶åå„ä¸ªå­ç³»ç»Ÿè¯»å–è¿™ä¸ª Config çš„ä½ã€‚ä¸ºäº†é¿å…é€šè¿‡è¿™ä¸ªå…±äº«ç»“æ„å°†ä¸åŒçš„åŠŸèƒ½è€¦åˆåœ¨ä¸€èµ·ï¼Œé…ç½®é”®æ˜¯åŠ¨æ€çš„ã€‚\ntype Config=HashMap\u0026lt;String,String\u0026gt;;è¿™ä¸ªç³»ç»Ÿæ˜¯å¯è¡Œçš„ï¼Œä½†æ„Ÿè§‰ç›¸å½“ç¬¨æ‹™ã€‚\nç°åœ¨çš„å®ç°è¦ç®€å•å¾—å¤šã€‚ç°åœ¨æ¯ä¸ªæ–¹æ³•éƒ½æ¥å—ä¸€ä¸ªç‰¹å®šçš„ config å‚æ•°ï¼Œè€Œä¸æ˜¯å°†ä¸€ä¸ªå•ä¸€çš„ Config ä½œä¸ºçŠ¶æ€çš„ä¸€éƒ¨åˆ†æ¥å­˜å‚¨ã€‚\nfn get_completions(analysis: \u0026amp;Analysis,config: \u0026amp;CompletionConfig,file: FileId,offset: usize,)fn get_inlay_hints(analysis: \u0026amp;Analysis,config: \u0026amp;HintsConfig,file: FileId,)ä¸ä»…ä»£ç æ›´ç®€å•ï¼Œè€Œä¸”æ›´çµæ´»ã€‚å› ä¸ºé…ç½®ä¸å†æ˜¯çŠ¶æ€çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥å¯ä»¥æ ¹æ®ä¸Šä¸‹æ–‡çš„ä¸åŒï¼Œå¯¹åŒä¸€åŠŸèƒ½ä½¿ç”¨ä¸åŒçš„é…ç½®ã€‚ä¾‹å¦‚ï¼Œæ˜¾å¼è°ƒç”¨çš„å®Œæˆå’Œå¼‚æ­¥çš„å®Œæˆå¯èƒ½æ˜¯ä¸åŒçš„ã€‚\nåœ¨ /r/rust ä¸Šè®¨è®ºã€‚\nåŸæ–‡é“¾æ¥: https://matklad.github.io/2020/12/28/csdi.html\n","permalink":"https://ohmyweekly.github.io/notes/2021-04-05-call-site-dependency-injection/","tags":["Rust"],"title":"Call Site Dependency Injection"},{"categories":["rustlang"],"contents":"æˆ‘ä¸€ç›´åœ¨é‡è¯» Ted Kaminski å…³äºè½¯ä»¶è®¾è®¡çš„åšå®¢ã€‚æˆ‘å¼ºçƒˆæ¨èæ‰€æœ‰çš„æ–‡ç« ï¼Œå°¤å…¶æ˜¯æ—©æœŸçš„æ–‡ç« ï¼ˆè¿™æ˜¯ç¬¬ä¸€ç¯‡ï¼‰ã€‚ä»–è®¾æ³•æä¾›äº†æ—¢ä¸å¹³å‡¡åˆåˆç†çš„è®¾è®¡å»ºè®®ï¼ˆå½“ç„¶æ˜¯ä¸»è§‚åˆ¤æ–­ï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªéš¾å¾—çš„æ ‡æœ¬!\næ— è®ºå¦‚ä½•ï¼Œè¿™ä¸€ç³»åˆ—çš„è§è§£ä¹‹ä¸€æ˜¯ï¼Œå½“è®¾è®¡ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µæ—¶ï¼Œæˆ‘ä»¬æ€»æ˜¯è¦é¢å¯¹æƒåŠ›å’Œå±æ€§ä¹‹é—´çš„å†…åœ¨æƒè¡¡ã€‚æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç‰¹å®šçš„æŠ½è±¡èƒ½è¡¨è¾¾çš„è¶Šå¤šï¼Œæˆ‘ä»¬å¯¹ä½¿ç”¨å®ƒçš„ä»£ç èƒ½è¯´çš„å°±è¶Šå°‘ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬äººç±»å¯¹æ›´å¤šè¡¨è¾¾èƒ½åŠ›çš„åçˆ±å¹¶éä¸ç”Ÿä¿±æ¥ã€‚è¿™ä¸€ç‚¹åœ¨ç¼–ç¨‹è¯­è¨€ç¤¾åŒºä¸­å¾ˆæ˜æ˜¾ï¼Œç”¨æˆ·ä¸åœåœ°è¦æ±‚æä¾›æ–°åŠŸèƒ½ï¼Œè€Œè¯­è¨€è®¾è®¡è€…å´è¯´ä¸ã€‚\nå®æ˜¯ä¸€ä¸ªåœ¨ \u0026ldquo;æ›´å¼ºå¤§\u0026quot;æ–¹é¢èµ°å¾—å¾ˆè¿œçš„è¯­è¨€åŠŸèƒ½ã€‚å®ç»™äº†ä½ ä¸€ç§åœ¨æºä»£ç ä¸ŠæŠ½è±¡çš„èƒ½åŠ›ã€‚ä½œä¸ºäº¤æ¢ï¼Œä½ æ”¾å¼ƒäº†ï¼ˆè‡ªåŠ¨ï¼‰æ¨ç†è¡¨é¢è¯­æ³•çš„èƒ½åŠ›ã€‚ä½œä¸ºä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œé‡å‘½åé‡æ„åœ¨å…·æœ‰å¼ºå¤§å®ç³»ç»Ÿçš„è¯­è¨€ä¸­å¹¶ä¸èƒ½ 100% å¯é åœ°å·¥ä½œã€‚\næˆ‘ç¡®å®è®¤ä¸ºï¼Œåœ¨ç†æƒ³çš„ä¸–ç•Œé‡Œï¼Œå¯¹äºä¸€ä¸ªæƒ³è¦æ‰©å±•åˆ°å·¨å¤§é¡¹ç›®çš„è¯­è¨€æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªé”™è¯¯çš„äº¤æ˜“ã€‚å½“ä½ å¢åŠ äº†æ›´å¤šçš„ç¨‹åºå‘˜ã€æ›´å¤šçš„å¹´é™å’Œæ›´å¤šçš„æ•°ç™¾ä¸‡è¡Œä»£ç æ—¶ï¼Œè‡ªåŠ¨æ¨ç†å’Œè½¬æ¢æºä»£ç çš„èƒ½åŠ›å°±ä¼šå˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚ä½†æ˜¯ï¼Œè¯·è°¨æ…å¯¹å¾…è¿™ä¸€ç‚¹ - æˆ‘æ˜¾ç„¶æ˜¯æœ‰åè§çš„ï¼Œå› ä¸ºæˆ‘èŠ±äº†å‡ å¹´æ—¶é—´å¼€å‘ Rust IDEã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼Œå®æœ‰å·¨å¤§çš„å¸å¼•åŠ› - å®ƒä»¬æ˜¯è¯­è¨€è®¾è®¡å¸ˆçš„èƒ¶å¸¦ã€‚å®å¾ˆå°‘æ˜¯æœ€å¥½çš„å·¥å…·ï¼Œä½†å®ƒä»¬å‡ ä¹å¯ä»¥å®Œæˆä»»ä½•å·¥ä½œã€‚è¯­è¨€è®¾è®¡æ˜¯æ¸è¿›å¼çš„ã€‚å®ç³»ç»Ÿé€šè¿‡ä¸ºè®¸å¤šåŠŸèƒ½æä¾›ä¸€ä¸ªç°æˆçš„ç©·äººçš„æ›¿ä»£å“æ¥ç¼“è§£è®¾è®¡å‹åŠ›ã€‚\nåœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘æƒ³æ¢è®¨ä¸€ä¸‹ Rust ä¸­å®çš„ç”¨é€”ã€‚ç›®çš„æ˜¯ä¸ºäº†æ‰¾åˆ°ä¸æ”¾å¼ƒ\u0026quot;æ¨ç†æºä»£ç \u0026quot;å±æ€§çš„è§£å†³æ–¹æ¡ˆã€‚\nå­—ç¬¦ä¸²æ’å€¼ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæœ€å¸¸è§çš„ä½¿ç”¨æƒ…å†µæ˜¯ format! ç³»åˆ—çš„å®ã€‚è¿™é‡Œçš„æ— å®è§£å†³æ–¹æ¡ˆå¾ˆç›´æ¥ - å­—ç¬¦ä¸²æ’å€¼è¯­æ³•ã€‚\nletkey=\u0026#34;number\u0026#34;;letvalue=||92;lett=f\u0026#34;$key: ${values()}\u0026#34;;assert_eq!(t.to_string(),\u0026#34;number: 92\u0026#34;);åœ¨ Rust ä¸­ï¼Œæ’å€¼å¯èƒ½ä¸åº”è¯¥ç›´æ¥æ„é€ ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œæ˜¯å¯ä»¥äº§ç”Ÿä¸€ä¸ªå®ç° Display çš„å€¼ï¼ˆå°±åƒ format_args! ä¸€æ ·ï¼‰ï¼Œè¿™æ ·å¯ä»¥é¿å…åˆ†é…ã€‚ä¸€ä¸ªæœ‰è¶£çš„æ‰©å±•æ˜¯å…è®¸åœ¨æ ¼å¼å­—ç¬¦ä¸²ç‰‡æ®µä¸Šè¿­ä»£ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ’å€¼è¯­æ³•å°±å¯ä»¥ç”¨äº SQL è¯­å¥æˆ–å‘½ä»¤è¡Œå‚æ•°ä¹‹ç±»çš„ä¸œè¥¿ï¼Œè€Œä¸ç”¨æ‹…å¿ƒå¼•å…¥æ³¨å…¥æ¼æ´ã€‚\nletarg=\u0026#34;my dir\u0026#34;;letcmd=f\u0026#34;ls $arg\u0026#34;.to_cmd();assert_eq!(cmd.to_string(),\u0026#34;ls \u0026#39;my dir\u0026#39;\u0026#34;);è¿™ç¯‡å…³äº Julia ç¼–ç¨‹è¯­è¨€çš„æ–‡ç« è§£é‡Šäº†è¿™ä¸ªé—®é¢˜ã€‚ xshell crate ä¸º Rust å®ç°äº†è¿™ä¸ªæƒ³æ³•ã€‚\nDerives æˆ‘è®¤ä¸ºåœ¨ Rust ä¸­ï¼Œå®çš„ç¬¬äºŒä¸ªæœ€å¸¸è§ï¼Œä¹Ÿå¯èƒ½æ˜¯æœ€é‡è¦çš„ç”¨æ³•æ˜¯æ´¾ç”Ÿã€‚Rust æ˜¯ä¸ºæ•°ä¸å¤šçš„èƒ½æ­£ç¡®å®ç°å¹³ç­‰çš„è¯­è¨€ä¹‹ä¸€ï¼ˆç¦æ­¢æ¯”è¾ƒè‹¹æœå’Œæ©˜å­ï¼‰ï¼Œä½†è¿™å…³é”®å–å†³äº derive(Eq) çš„èƒ½åŠ›ã€‚è¿™ä¸ªé¢†åŸŸå¸¸è§çš„è§£å†³æ–¹æ¡ˆæ˜¯ç¼–è¯‘å™¨ä¸­çš„ç‰¹æ®Š casingï¼ˆHaskell çš„æ´¾ç”Ÿï¼‰æˆ–è¿è¡Œæ—¶åå°„ã€‚\nä½†æˆ‘æœ€æ„Ÿå…´è¶£çš„è§£å†³æ–¹æ¡ˆæ˜¯ C# æºç ç”Ÿæˆå™¨ã€‚è¿™å¹¶ä¸æ˜¯ä»€ä¹ˆæ–°é²œäº‹ - è¿™åªæ˜¯è€å¼çš„ï¼ˆæºç ï¼‰ä»£ç ç”Ÿæˆå™¨ï¼Œåªæ˜¯å…·æœ‰å¾ˆå¥½çš„å®ç°è´¨é‡ã€‚ä½ å¯ä»¥æä¾›è‡ªå®šä¹‰çš„ä»£ç ï¼Œè¿™äº›ä»£ç åœ¨æ„å»ºè¿‡ç¨‹ä¸­è¢«è¿è¡Œï¼Œå®ƒå¯ä»¥è¯»å–ç°æœ‰çš„æºç å¹¶ç”Ÿæˆé¢å¤–çš„æ–‡ä»¶ï¼Œç„¶åå†æ·»åŠ åˆ°ç¼–è¯‘ä¸­ã€‚\nè¿™ä¸ªè§£å†³æ–¹æ¡ˆçš„ä¼˜ç‚¹åœ¨äºå®ƒå°†æ‰€æœ‰çš„å¤æ‚æ€§ä»è¯­è¨€ä¸­ç§»å‡ºï¼Œç§»åˆ°äº†ç¼–è¯‘ç³»ç»Ÿä¸­ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥å…è´¹è·å¾—åŸºçº¿å·¥å…·æ”¯æŒã€‚ç”Ÿæˆä»£ç çš„ Goto å®šä¹‰ï¼Ÿå°±èƒ½ç”¨äº†ã€‚è°ƒè¯•æ—¶æƒ³ä»‹å…¥ä¸€äº›åºåˆ—åŒ–ä»£ç ï¼Ÿç£ç›˜ä¸Šæœ‰å®é™…çš„æºç ï¼Œæ‰€ä»¥å¯ä»¥æ”¾å¿ƒçš„å»åš! ä½ æ˜¯æ¯”è¾ƒå–œæ¬¢ç”¨ printf çš„äººï¼Ÿå¥½å§ï¼Œä½ éœ€è¦è¯´æœæ„å»ºç³»ç»Ÿä¸è¦è¸©è¿‡ä½ çš„æ”¹åŠ¨ï¼Œä½†æ˜¯ï¼Œå¦åˆ™ï¼Œä¸ºä»€ä¹ˆä¸å‘¢ï¼Ÿ\næ­¤å¤–ï¼Œæºç ç”Ÿæˆå™¨çš„è¡¨ç°åŠ›æ˜æ˜¾æ›´å¼ºã€‚å®ƒä»¬å¯ä»¥è°ƒç”¨åˆ° Roslyn ç¼–è¯‘å™¨æ¥åˆ†ææºä»£ç ï¼Œæ‰€ä»¥å®ƒä»¬èƒ½å¤Ÿç”Ÿæˆç±»å‹å¯¼å‘çš„ä»£ç ã€‚\nä¸ºäº†æœ‰ç”¨ï¼Œæºç ç”Ÿæˆå™¨éœ€è¦ä¸€äº›è¯­è¨€çº§åˆ«çš„æ”¯æŒï¼Œä»¥ä¾¿å°†ä¸€ä¸ªå®ä½“åˆ†å‰²åˆ°å¤šä¸ªæ–‡ä»¶ä¸­ã€‚åœ¨ C# ä¸­ï¼Œéƒ¨åˆ†ç±»å°±æ‰®æ¼”äº†è¿™ä¸ªè§’è‰²ã€‚\nç‰¹å®šé¢†åŸŸè¯­è¨€ å®çš„å­˜åœ¨ç†ç”±æ˜¯åµŒå…¥å¼ DSL çš„å®ç°ã€‚æˆ‘ä»¬å¸Œæœ›åœ¨è¯­è¨€ä¸­å¼•å…¥è‡ªå®šä¹‰è¯­æ³•ï¼Œä»¥ç®€æ´åœ°å¯¹ç¨‹åºçš„é¢†åŸŸè¿›è¡Œå»ºæ¨¡ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ç”¨å®æ¥åµŒå…¥ Rust ä»£ç ä¸­çš„ HTML ç‰‡æ®µã€‚\nå¯¹æˆ‘ä¸ªäººæ¥è¯´ï¼ŒeDSL ä¸æ˜¯è¦è§£å†³çš„é—®é¢˜ï¼Œåªæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚å¼•å…¥ä¸€ä¸ªæ–°çš„å­è¯­è¨€ï¼ˆå³ä½¿æ˜¯å°çš„ï¼‰ä¼šèŠ±è´¹å¤§é‡çš„è®¤çŸ¥å¤æ‚æ€§é¢„ç®—ã€‚å¦‚æœä½ å¶å°”éœ€è¦å®ƒï¼Œæœ€å¥½åšæŒåªæŠŠæœ‰ç‚¹å•°å—¦çš„å‡½æ•°è°ƒç”¨é“¾åœ¨ä¸€èµ·ã€‚å¦‚æœä½ ç»å¸¸éœ€è¦å®ƒï¼Œå¼•å…¥å¤–éƒ¨çš„ DSL æ˜¯æœ‰æ„ä¹‰çš„ï¼Œå®ƒæœ‰ä¸€ä¸ªç¼–è¯‘å™¨ï¼Œä¸€ä¸ªè¯­è¨€æœåŠ¡å™¨ï¼Œä»¥åŠæ‰€æœ‰ä½¿ç¼–ç¨‹å¯Œæœ‰æˆæ•ˆçš„å·¥å…·ã€‚å¯¹æˆ‘æ¥è¯´ï¼ŒåŸºäºå®çš„ DSL åªæ˜¯åœ¨æˆæœ¬æ•ˆç›Šæ›²çº¿ä¸Šä¸è½åƒä¸€ä¸ªæœ‰è¶£çš„ç‚¹ã€‚\nä¹Ÿå°±æ˜¯è¯´ï¼ŒKotlin ç¼–ç¨‹è¯­è¨€å¾ˆå¥½åœ°è§£å†³äº†å¼ºç±»å‹åŒ–ã€å·¥å…·å‹å¥½å‹ DSL çš„é—®é¢˜ï¼ˆä¾‹å­ï¼‰ã€‚ä»¤äººæ°”æ„¤çš„æ˜¯ï¼Œå¾ˆéš¾æŒ‡å‡ºå…·ä½“çš„è§£å†³æ–¹æ¡ˆæ˜¯ä»€ä¹ˆã€‚å°±æ˜¯\u0026hellip;\u0026hellip;ä¸»è¦æ˜¯å…·ä½“çš„è¯­æ³•ã€‚ä¸‹é¢æ˜¯ä¸€äº›æˆåˆ†ã€‚\n é—­åŒ…çš„è¯­æ³•æ˜¯ { arg -\u0026gt; body }ï¼Œæˆ–è€…ç›´æ¥æ˜¯ { body }ï¼Œæ‰€ä»¥é—­åŒ…åœ¨è¯­æ³•ä¸Šç±»ä¼¼äºå—ã€‚ æ‰©å±•æ–¹æ³•ï¼ˆè¿™åªæ˜¯é™æ€æ–¹æ³•çš„è¯­æ³•ç³–ï¼‰ã€‚ Java é£æ ¼çš„éšå¼ thisï¼Œå®ƒå°†åç§°å¼•å…¥åˆ°ä½œç”¨åŸŸä¸­ï¼Œè€Œä¸éœ€è¦æ˜¾å¼å£°æ˜ã€‚ TCP-preserving inline closures (è¿™æ˜¯å”¯ä¸€ä¸€ä¸ªéè¯­æ³•ç‰¹å¾)  å°½ç®¡å¦‚æ­¤ï¼Œè¿™è¿˜ä¸è¶³ä»¥å®ç° Jetpack Compose UI DSLï¼Œå®ƒè¿˜éœ€è¦ä¸€ä¸ªç¼–è¯‘å™¨æ’ä»¶ã€‚\nsqlx æˆ‘æƒ³è°ƒç”¨çš„ä¸€ä¸ªæœ‰è¶£çš„ DSL æ¡ˆä¾‹æ˜¯ sqlx::queryã€‚å®ƒå…è®¸æˆ‘ä»¬å†™è¿™æ ·çš„ä»£ç ã€‚\nletaccount=sqlx::query!(\u0026#34;select (1) as id, \u0026#39;Herp Derpinson\u0026#39; as name\u0026#34;).fetch_one(\u0026amp;mutconn).await?;// anonymous struct has `#[derive(Debug)]` for convenience println!(\u0026#34;{:?}\u0026#34;,account);println!(\u0026#34;{}: {}\u0026#34;,account.id,account.name);è¿™ä¸€ç‚¹æˆ‘æƒ³æ˜¯eDSLç¡®å®å¾ˆæ‹‰é£çš„å‡ ä¸ªæ¡ˆä¾‹ä¹‹ä¸€ã€‚æ²¡æœ‰å®çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä¸çŸ¥é“è¯¥æ€ä¹ˆåšã€‚ä½¿ç”¨å­—ç¬¦ä¸²æ’å€¼ï¼ˆé«˜çº§ç‰ˆæœ¬ï¼Œä»¥ä¿æŠ¤ä¸è¢«æ³¨å…¥ï¼‰ï¼Œå¯ä»¥æŒ‡å®šæŸ¥è¯¢ã€‚ä½¿ç”¨æºç ç”Ÿæˆå™¨ï¼Œå¯ä»¥æ£€æŸ¥æŸ¥è¯¢çš„è¯­æ³•å’Œç±»å‹ï¼Œä¾‹å¦‚ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¼šå‡ºç°ç±»å‹é”™è¯¯ã€‚\nlet(id,name): (i32,f32)=query(\u0026#34;select (1) as id, \u0026#39;Herp Derpinson\u0026#39; as name\u0026#34;).fetch_one(\u0026amp;mutconn).await?;ä½†è¿™è¿˜ä¸è¶³ä»¥ç”Ÿæˆä¸€ä¸ªåŒ¿åç»“æ„ä½“ï¼Œä¹Ÿä¸è¶³ä»¥æ‘†è„±åŠ¨æ€ castsã€‚\næœ‰æ¡ä»¶ç¼–è¯‘ Rust è¿˜ä½¿ç”¨å®è¿›è¡Œæ¡ä»¶ç¼–è¯‘ã€‚è¿™ä¸ªç”¨ä¾‹ä»¤äººä¿¡æœåœ°å±•ç¤ºäº†\u0026quot;ç¼ºä¹å±æ€§\u0026quot;æ–¹é¢çš„èƒ½åŠ›ã€‚å¤„ç†ç‰¹å¾ç»„åˆæ˜¯ Cargo æ°¸è¿œå¤´ç—›çš„é—®é¢˜ã€‚å½“ç‰¹å¾æ ‡å¿—æ”¹å˜æ—¶ï¼Œç”¨æˆ·ä¸å¾—ä¸åå¤é‡æ–°ç¼–è¯‘å¤§å—çš„è£…ç®±å›¾ã€‚åœ¨ CI ä¸Šç”¨ Cargo test --no-default-features æ•æ‰ç±»å‹é”™è¯¯æ˜¯éå¸¸æ¼äººçš„ï¼Œå°¤å…¶æ˜¯å½“ä½ åœ¨æäº¤ PR ä¹‹å‰ç¡®å®è¿è¡Œäº† Cargo testã€‚\u0026ldquo;æ·»åŠ ç‰¹æ€§\u0026quot;æ˜¯ä¸€ä¸ªæ— æ³•é€‰ä¸­çš„ä¸€å¢æƒ…æ„¿ã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä¸çŸ¥é“æœ‰ä»€ä¹ˆå¥½çš„æ— å®é€‰æ‹©ã€‚ä½†æ˜¯ï¼ŒåŸåˆ™ä¸Šï¼Œè¿™ä¼¼ä¹æ˜¯å¯è¡Œçš„ï¼Œå¦‚æœå°†æ¡ä»¶ç¼–è¯‘è¿›ä¸€æ­¥æ¨åˆ°ç¼–è¯‘å™¨æµæ°´çº¿çš„ä¸‹æ¸¸ï¼Œæ¨åˆ°ä»£ç ç”Ÿæˆå’Œé“¾æ¥é˜¶æ®µã€‚ç¼–è¯‘å™¨å¯ä»¥åœ¨ä¸ºä¸€ä¸ªå‡½æ•°ç”Ÿæˆæœºå™¨ä»£ç ä¹‹å‰ï¼Œé€‰æ‹©ç‰¹å®šå¹³å°çš„ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯åœ¨è§£æè¿‡ç¨‹ä¸­æå‰ä¸¢å¼ƒä¸€äº›ä»£ç ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œå®ƒä¼šæ£€æŸ¥è¯¥å‡½æ•°çš„æ‰€æœ‰æ¡ä»¶ç¼–è¯‘ç‰ˆæœ¬æ˜¯å¦å…·æœ‰ç›¸åŒçš„æ¥å£ã€‚è¿™æ ·ä¸€æ¥ï¼Œå¹³å°ç‰¹å®šçš„ç±»å‹é”™è¯¯å°±ä¸å¯èƒ½å‡ºç°äº†ã€‚\nå ä½ç¬¦è¯­æ³• æœ€åä¸€ä¸ªæˆ‘æƒ³ä»‹ç»çš„ç”¨ä¾‹æ˜¯å ä½ç¬¦è¯­æ³•ã€‚Rust çš„ macro_call!(...) è¯­æ³•å¼€è¾Ÿäº†ä¸€ä¸ªå¾ˆå¥½çš„éš”ç¦»åŒºåŸŸï¼Œåªè¦å°æ‹¬å·æ˜¯å¹³è¡¡çš„ï¼Œä»»ä½•ä¸œè¥¿éƒ½å¯ä»¥ç”¨ã€‚ç†è®ºä¸Šï¼Œè¿™å…è®¸è¯­è¨€è®¾è®¡è€…åœ¨ç¡®å®šæŸäº›ä¸œè¥¿ä¹‹å‰å…ˆè¯•éªŒä¸´æ—¶è¯­æ³•ã€‚åœ¨å®è·µä¸­ï¼Œè¿™çœ‹èµ·æ¥å¥½åƒå¹¶æ²¡æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿæœ‰äººåå¯¹ç¨³å®š postfix .awaitï¼Œè€Œä¸é€šè¿‡ä¸­é—´æœŸä¸ await! å®æ¥ç¨³å®šã€‚è€Œä¸”ï¼Œç¨³å®šä¹‹åï¼Œæ‰€æœ‰çš„è¯­æ³•è®¨è®ºéƒ½ç«‹å³è¢«é—å¿˜äº†ï¼Ÿå¦ä¸€æ–¹é¢ï¼Œæˆ‘ä»¬ç¡®å®æœ‰ try! -\u0026gt; ? è½¬å˜ï¼Œä½†æˆ‘ä¸è®¤ä¸ºå®ƒæœ‰åŠ©äºå‘ç°ä»»ä½•è®¾è®¡ä¸Šçš„ç¼ºé™·ï¼Ÿè‡³å°‘ï¼Œæˆ‘ä»¬æˆåŠŸåœ°ç¨³å®šäº†é‚£ä¸ªä¸å¿…è¦çš„é™åˆ¶æ€§å»è¯­æ³•ç³–ã€‚\nå¯¹äºç»“è®ºï¼Œæˆ‘æƒ³ç»•å›æºç ç”Ÿæˆå™¨ã€‚ç©¶ç«Ÿæ˜¯ä»€ä¹ˆè®©å®ƒä»¬æ¯”å®æ›´å®¹æ˜“è¢«å·¥å…·åŒ–ï¼Ÿæˆ‘è®¤ä¸ºæœ‰ä»¥ä¸‹ä¸‰ä¸ªç‰¹æ€§ã€‚ç¬¬ä¸€ï¼Œæ— è®ºæ˜¯è¾“å…¥è¿˜æ˜¯è¾“å‡ºï¼Œä»æ ¹æœ¬ä¸Šè¯´ï¼Œéƒ½æ˜¯æ–‡æœ¬ã€‚æ²¡æœ‰ä¸­é—´çš„è¡¨ç¤ºæ–¹å¼ï¼ˆæ¯”å¦‚ token æ ‘ï¼‰ï¼Œè€Œè¿™ä¸ªå…ƒç¨‹åºè®¾æ–½ä½¿ç”¨çš„æ˜¯ä¸­é—´çš„è¡¨ç¤ºæ–¹å¼ã€‚è¿™æ„å‘³ç€ï¼Œå®ƒä¸éœ€è¦ä¸ç¼–è¯‘å™¨æ·±åº¦é›†æˆã€‚å½“ç„¶ï¼Œåœ¨å†…éƒ¨ï¼Œè¯¥å·¥å…·å¯ä»¥è‡ªç”±åœ°å¯¹ä»£ç è¿›è¡Œä»»æ„è§£æã€ç±»å‹æ£€æŸ¥å’Œè½¬æ¢ã€‚å…¶æ¬¡ï¼Œæœ‰ä¸€ä¸ªé˜¶æ®µæ€§çš„åŒºåˆ†ã€‚æºç ç”Ÿæˆå™¨æ˜¯ä¸€æ¬¡æ‰§è¡Œï¼Œæ— åºçš„ã€‚åœ¨å…ƒç¼–ç¨‹å’Œåç§°è§£æä¹‹é—´æ²¡æœ‰æ¥å›ï¼Œè¿™åˆå¯ä»¥å°†\u0026quot;å…ƒ\u0026quot;çš„éƒ¨åˆ†ä¿ç•™åœ¨å¤–é¢ã€‚ç¬¬ä¸‰ï¼Œæºç ç”Ÿæˆå™¨åªèƒ½æ·»åŠ ä»£ç ï¼Œä¸èƒ½æ”¹å˜ç°æœ‰ä»£ç çš„å«ä¹‰ã€‚è¿™æ„å‘³ç€ï¼Œåœ¨ä»£ç ç”Ÿæˆå™¨çš„å­˜åœ¨ä¸‹ï¼Œè¯­ä¹‰ä¸Šåˆç†çš„æºç è½¬æ¢ä¾ç„¶å¦‚æ­¤ã€‚\nå°±è¿™æ ·å§! åœ¨ /r/rust ä¸Šè®¨è®ºã€‚\nåŸæ–‡é“¾æ¥: https://matklad.github.io/2021/02/14/for-the-love-of-macros.html\n","permalink":"https://ohmyweekly.github.io/notes/2021-04-05-for-the-love-of-macros/","tags":["Rust"],"title":"For the Love of Macros"},{"categories":["rakulang"],"contents":"Raku ä¸ PostgreSQL çš„è¿æ¥æ€§ä¸€è§ˆ åœ¨æˆ‘çœ‹æ¥ï¼ŒRaku æ˜¯ä¸€é—¨ä¼Ÿå¤§çš„è¯­è¨€ï¼Œæˆ‘æ¯å¤©éƒ½åœ¨ä½¿ç”¨å®ƒï¼Œè€Œä¸”è¶Šæ¥è¶Šå¤šã€‚æˆ‘å¯ä»¥è¯´å®ƒå°†å–ä»£æˆ‘çš„ Perl è„šæœ¬ã€‚\nRaku æœ‰ä¸€ä¸ªå¹¿æ³›çš„æ¨¡å—åº“ï¼Œå½“ç„¶åŒ…æ‹¬æ•°æ®åº“è¿æ¥ï¼Œè¿™åè¿‡æ¥åˆåŒ…æ‹¬è¿æ¥ PostgreSQL çš„åŠŸèƒ½ã€‚ åœ¨è¿™ç¯‡ç®€å•çš„æ–‡ç« ä¸­ï¼Œæˆ‘å°†å¿«é€Ÿæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ Raku çš„ä¸€æ®µä»£ç æ¥å®Œæˆè®¸å¤šæ¯”æ•°æ®åº“åº”ç”¨ç¨‹åºè¿˜çç¢çš„ä»»åŠ¡ã€‚ è„šæœ¬æ˜¯ä»¥å¢é‡çš„æ–¹å¼å‘ˆç°çš„ï¼Œæ‰€ä»¥è¿æ¥æ•°æ®åº“éƒ¨åˆ†å¿…é¡»å§‹ç»ˆä½œä¸ºè„šæœ¬çš„å‰è¨€ã€‚\nDB::Pg æ¨¡å—åœ¨æŸç§ç¨‹åº¦ä¸Šä¸ Perl 5 çš„ DBD::Pg å¾ˆç›¸ä¼¼ï¼Œæ‰€ä»¥å¾ˆå¤šæ¦‚å¿µå’Œæ–¹æ³•åéƒ½ä¼šè®©äººæƒ³èµ·åè€…ã€‚\nå®‰è£…æ–¹æ³• å¯ä»¥ä½¿ç”¨ zef æ¥å®‰è£… DB::Pg æ¨¡å—ã€‚\n% zef install DB::Pg æ ¹æ®ä½ çš„ç³»ç»Ÿé€Ÿåº¦å’Œå·²ç»å®‰è£…çš„åº“ï¼Œå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿçš„æ—¶é—´ã€‚\nå¦‚æœä½ è¦ä½¿ç”¨ LISTEN/NOTIFYï¼Œä½ éœ€è¦åŒæ—¶å®‰è£… epoLl.NET å’Œ EPOLl.NETã€‚\n% zef install epoll è¿æ¥åˆ°æ•°æ®åº“ ç°åœ¨å¯ä»¥ä½¿ç”¨ DB::Pg æ¨¡å—è¿æ¥åˆ°æ•°æ®åº“ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç®€å•çš„è„šæœ¬å¯ä»¥æ¥å—å‘½ä»¤è¡Œä¸Šçš„æ‰€æœ‰å‚æ•°ï¼ˆæ¸…æ™°çš„æ–‡æœ¬ï¼ï¼‰ï¼Œå¯ä»¥æ˜¯ï¼š\n#!raku use DB::Pg; sub MAIN( Str :$host = \u0026#39;miguel\u0026#39;, Str :$username = \u0026#39;luca\u0026#39;, Str :$password = \u0026#39;secet\u0026#39;, Str :$database = \u0026#39;testdb\u0026#39; ) { \u0026#34;Connecting $username@ $host/$database\u0026#34;.say; my $connection = DB::Pg.new: conninfo =\u0026gt; \u0026#34;host=$hostuser=$usernamepassword=$passworddbname=$database\u0026#34;; å¦‚ä½ æ‰€è§ï¼ŒDB::Pgæ¨¡å—æ¥å—ä¸€ä¸ª conninfo å­—ç¬¦ä¸²ã€‚\nè¯»å–æŸ¥è¯¢å’Œç»“æœ .query æ–¹æ³•å…è®¸å‘æ•°æ®åº“å‘å‡ºè¯»å–æŸ¥è¯¢ã€‚ç»“æœæ˜¯ä¸€ä¸ª Result ç±»å¯¹è±¡ï¼Œå®ƒå¯ä»¥é€šè¿‡ä¸åŒçš„æ–¹æ³•æ¥ä½¿ç”¨ï¼Œæœ€è‘—åçš„æ˜¯ .hash å’Œ .arraysï¼Œå®ƒä»¬è¿”å›ä¸€è¿ä¸²çš„ hash æˆ– arraysï¼Œä»æŸ¥è¯¢ä¸­æå–çš„æ¯ä¸€è¡Œéƒ½æœ‰ä¸€ä¸ª .rows å’Œ .column ç­‰ç‰¹æ®Šæ–¹æ³•åˆ†åˆ«æä¾›äº†æŸ¥è¯¢è¿”å›çš„è¡Œæ•°å’Œç»“æœé›†çš„åˆ—åã€‚\nä¸¾ä¸ªä¾‹å­ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªç®€å•çš„æŸ¥è¯¢ã€‚\nmy $query = \u0026#39;SELECT current_role, current_time\u0026#39;; my $results = $connection.query: $query; say \u0026#34;The query { $query }returned { $results.rows }rows with columns: { $results.columns.join( \u0026#39;, \u0026#39; ) }\u0026#34;; for $results.hashes -\u0026gt; $row { for $row.kv -\u0026gt; $column, $value { say \u0026#34;Column $column= $value\u0026#34;; } } ä¸Šé¢è¿™æ®µä»£ç æä¾›äº†ä¸€ä¸ªç±»ä¼¼äºä¸‹é¢çš„è¾“å‡ºã€‚\næŸ¥è¯¢ SELECT current_role, current_time è¿”å›1è¡Œï¼Œåˆ—æ•°ä¸ºï¼š current_role, current_timeã€‚\nColumn current_role = luca Column current_time = 14:48:47.147983+02 å…‰æ ‡ é»˜è®¤æƒ…å†µä¸‹ï¼Œ.query æ–¹æ³•å°†ä»æŸ¥è¯¢ä¸­è·å–æ‰€æœ‰çš„è¡Œï¼Œè¿™å¯¹äºè¾ƒå¤§çš„æ•°æ®é›†æ¥è¯´æ˜¯ä¸€ä¸ªé—®é¢˜ã€‚å¯ä»¥ä½¿ç”¨ .cursor æ–¹æ³•ï¼Œå®ƒå¯ä»¥æ¥å—å¯é€‰çš„æ‰¹é‡å¤§å°ï¼ˆé»˜è®¤ä¸º1000ä¸ªå…ƒç»„ï¼‰ï¼Œå¹¶å¯é€‰åœ°æ¥å—å°†ç»“æœè·å–ä¸ºå“ˆå¸Œåºåˆ—çš„æŒ‡å®šå™¨ã€‚\nä½œä¸ºä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚\nfor $connection.cursor( \u0026#39;select * from raku\u0026#39;, fetch =\u0026gt; 2, :hash ) -\u0026gt; %row { say \u0026#34;====================\u0026#34;; for %row.kv -\u0026gt; $column, $value { say \u0026#34;Column [ $column] = $value\u0026#34;; } say \u0026#34;====================\u0026#34;; } äº§ç”Ÿå’Œè¾“å‡ºåƒè¿™æ ·çš„ä¸œè¥¿ã€‚\n==================== Column [ pk ] = 2 Column [ t ] = This is value 0 ==================== ==================== Column [ pk ] = 3 Column [ t ] = This is value 1 ==================== ==================== Column [ t ] = This is value 2 Column [ pk ] = 4 ==================== ==================== Column [ pk ] = 5 Column [ t ] = This is value 3 ==================== ... æ’°å†™å£°æ˜ ç¼–å†™è¯­å¥å¯ä»¥é€šè¿‡ .execute æ–¹æ³•æ¥æ‰§è¡Œï¼Œå¦‚:\n$connection.execute: q\u0026lt;insert into raku( t ) values( \u0026#39;Hello World\u0026#39; )\u0026gt;; äº¤æ˜“å’Œç¼–åˆ¶æŠ¥è¡¨ ä¸ºäº†å¤„ç†äº‹åŠ¡ï¼Œä½ éœ€è¦è®¿é—®è¢«\u0026quot;å±è”½\u0026quot;åˆ° DB::Pg ä¸»å¯¹è±¡ä¸­çš„æ•°æ®åº“å¤„ç†ç¨‹åºã€‚æ•°æ®åº“å¯¹è±¡åƒå¾€å¸¸ä¸€æ ·æä¾›äº† .beginã€.rollbackã€.commitç­‰æ–¹æ³•ã€‚\næ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ .prepare æ–¹æ³•æ¥è·å¾—ä¸€ä¸ªå·²å‡†å¤‡å¥½çš„è¯­å¥ï¼Œè¯¥è¯­å¥å¯ä»¥è¢«ç¼“å­˜å¹¶ç”¨äºå¾ªç¯å’Œé‡å¤æ€§ä»»åŠ¡ä¸­ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ.prepare æ–¹æ³•ä½¿ç”¨äº† $1ã€$2 ç­‰å‚æ•°å ä½ç¬¦ï¼Œå½“è¯­å¥æ¥å—å•ä¸ªå€¼æ—¶ï¼Œå¿…é¡»åœ¨ .execute ä¸­ä¸æŒ‡å®šç´¢å¼•ã€‚\nä¸¾ä¸ªä¾‹å­\nmy $database-handler = $connection.db; my $statement = $database-handler.prepare: \u0026#39;insert into raku( t ) values( $1 )\u0026#39;; $database-handler.begin; $statement.execute( \u0026#34;This is value $_\u0026#34; ) for 0 .. 10; $database-handler.commit; $database-handler.finish; ä¸Šè¿°å¾ªç¯ç›¸å½“äºä¸€ä¸ªSQLäº‹åŠ¡ï¼Œå¦‚:\nBEGIN;INSERTINTOraku(t)VALUES(\u0026#39;This is value 0\u0026#39;);INSERTINTOraku(t)VALUES(\u0026#39;This is value 1\u0026#39;);INSERTINTOraku(t)VALUES(\u0026#39;This is value 2\u0026#39;);...INSERTINTOraku(t)VALUES(\u0026#39;This is value 10\u0026#39;);COMMIT;.finish æ–¹æ³•æ˜¯å¿…éœ€çš„ï¼Œå› ä¸º DB::Pg å¤„ç†ç¼“å­˜ã€‚è¯·æ³¨æ„ï¼Œ.commit å’Œ .rollback æ–¹æ³•æ˜¯æµç•…çš„ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¯¹è±¡å®ä¾‹ï¼Œè¿™æ ·ä½ å°±å¯ä»¥è°ƒç”¨ .commit.finishã€‚\næ•°æ®åº“ä¸è¿æ¥ ç¼“å­˜çš„å¤„ç†æ–¹å¼æ˜¯ï¼Œå½“å‘å‡ºä¸€ä¸ªæŸ¥è¯¢æ—¶ï¼Œä¼šæ‰“å¼€ä¸€ä¸ªæ–°çš„è¿æ¥å¹¶ä½¿ç”¨ã€‚ä¸€æ—¦å·¥ä½œå®Œæˆï¼Œè¿æ¥å°±ä¼šè¿”å›åˆ°å†…éƒ¨æ± ä¸­ã€‚DB::Pg::Database å¯¹è±¡åšçš„å·¥ä½œå’Œ DB::Pg çš„ä¸€æ ·ï¼Œä¸åŒçš„æ˜¯å®ƒä¸ä¼šè‡ªåŠ¨å°†è¿æ¥è¿”å›åˆ°æ± ä¸­ï¼Œæ‰€ä»¥éœ€è¦è‡ªå·±è¿›è¡Œ . å®Œæˆã€‚\nå› æ­¤ï¼Œä½ å¯ä»¥åœ¨ä¸¤ä¸ªå¯¹è±¡ä¸Šä½¿ç”¨ç›¸åŒçš„ .query å’Œ .execute æ–¹æ³•ï¼Œä½† DB::Pg ä¼šè‡ªåŠ¨å°†è¿æ¥è¿”å›åˆ°å†…éƒ¨æ± ä¸­ï¼Œè€Œæ•°æ®åº“å¯¹è±¡åˆ™å…è®¸ä½ å¯¹ä½•æ—¶å°†è¿æ¥è¿”å›åˆ°æ± ä¸­è¿›è¡Œç»†ç²’åº¦çš„æ§åˆ¶ã€‚\nå¤åˆ¶ PostgreSQL æä¾›äº†ç‰¹æ®Šçš„ COPY å‘½ä»¤ï¼Œå¯ä»¥ç”¨æ¥å¤åˆ¶ä»å’Œè¿›å…¥ã€‚æœ‰ä¸€ä¸ªæ–¹æ³• .copy-in å¯ä»¥æ‰§è¡Œ COPY FROMï¼Œè€Œ COPY TO å¯ä»¥åœ¨è¿­ä»£å¾ªç¯ä¸­ä½¿ç”¨ã€‚\nmy $file = \u0026#39;/tmp/raku.csv\u0026#39;.IO.open: :w; for $connection.query: \u0026#39;COPY raku TO stdout (FORMAT CSV)\u0026#39; -\u0026gt; $row { $file.print: $row; } ä»¥ä¸Šå°† CSV ç»“æœå¯¼å‡ºåˆ°æ–‡æœ¬æ–‡ä»¶ä¸Šã€‚ å¦‚æœè¦è¯»å›æ•°æ®ï¼Œå¯ä»¥å‘å‡º .copy-in æ–¹æ³•ï¼Œä½†é¦–å…ˆéœ€è¦å‘å‡º SQL COPYã€‚å·¥ä½œæµç¨‹æ˜¯\nissue a COPY FROM STDIN; use .copy-data to slurp all the data; use .copy-end to notify the database that the COPY is concluded. å¯¹.copy-endçš„éœ€æ±‚æ˜¯ä¸€ä¸ªå»ºè®®ï¼šå¯ä»¥åœ¨ä¸€æ¬¡è¿è¡Œä¸­å‘å‡ºä¸åŒçš„.copy-dataï¼Œä¾‹å¦‚ä»ä¸åŒæ–‡ä»¶ä¸­å¯¼å…¥æ•°æ®ã€‚\n$database-handler = $connection.db; $database-handler.query: \u0026#39;COPY raku FROM STDIN (FORMAT CSV)\u0026#39;; $database-handler.copy-data: \u0026#39;/tmp/raku1.csv\u0026#39;.IO.slurp; $database-handler.copy-data: \u0026#39;/tmp/raku2.csv\u0026#39;.IO.slurp; $database-handler.copy-end; è½¬æ¢å™¨ å¯ä»¥æŒ‡å®šè½¬æ¢å™¨ï¼Œå³å¤„ç†è¿›å‡ºæ•°æ®åº“çš„å€¼çš„ç‰¹æ®Šè§’è‰²ï¼›è¿™è®©æˆ‘æƒ³èµ·äº† DBI::Class çš„ inflate å’Œ deflate é€‰é¡¹ã€‚ ç¬¬ä¸€æ­¥æ˜¯åœ¨ DB::Pg ä¸­ç»™è½¬æ¢å™¨å®ä¾‹æ·»åŠ ä¸€ä¸ªè§’è‰²ï¼Œè¿™æ ·çš„å®ä¾‹å¿…é¡»ã€‚\n å¢åŠ ä¸€ä¸ªæ–°çš„ç±»å‹è½¬æ¢æ–¹æ³•ã€‚ å¢åŠ ä¸€ä¸ªè½¬æ¢æ–¹æ³•æ¥å¤„ç†ç±»å‹å­—ç¬¦ä¸²åŒ–çš„å€¼ï¼Œå¹¶è¿”å›æ–°å€¼ï¼ˆåœ¨ä»»ä½• Raku å®ä¾‹ä¸­ï¼‰ã€‚  ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œä¸‹é¢å°†ä¸€ä¸ªæ–‡æœ¬ PostgreSQL ç±»å‹è½¬æ¢ä¸ºä¸€ä¸ª Str Raku å¯¹è±¡ï¼Œå¹¶åœ¨å…¶å†…å®¹ä¸Šè¿›è¡Œåè½¬ã€‚\n$connection.converter does role fluca-converter { submethod BUILD { self.add-type( text =\u0026gt; Str ) } multi method convert( Str:U, Str:D $value) { $value.flip.uc; } } .say for $connection.query( \u0026#39;select * from raku\u0026#39; ).arrays; äº§ç”Ÿç±»ä¼¼äºçš„è¾“å‡ºã€‚\n[442 DLROW OLLEH] [454 DLROW OLLEH] [466 DLROW OLLEH] å…¶ä¸­å­—ç¬¦ä¸² Hello World è¢«ç¿»è½¬ã€‚\nlisten å’Œ notify DB::Pgä¹Ÿå¯ä»¥å¤„ç†LISTENå’ŒNOTIFYï¼Œå®ƒä»¬èƒ½å¤Ÿä¸Rakuçš„reactåŠ¨æ€åŠŸèƒ½è¿›è¡Œäº¤äº’ã€‚ é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªç®€å•çš„æœºåˆ¶æ¥é€šçŸ¥ä¸€äº›äº‹ä»¶ã€‚\ntestdb=\u0026gt; create or replace rule r_raku_insert as on insert to raku do also SELECT pg_notify( \u0026#39;insert_event\u0026#39;, \u0026#39;INSERTING ROW(S)\u0026#39; ); CREATE RULE testdb=\u0026gt; create or replace rule r_raku_delete as on delete to raku do also SELECT pg_notify( \u0026#39;delete_event\u0026#39;, \u0026#39;DELETING ROW(S)\u0026#39; ); CREATE RULE ç°åœ¨ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªç­‰å¾…ä¼ å…¥äº‹ä»¶çš„ Raku è„šæœ¬ã€‚\nreact { whenever $connection.listen( \u0026#39;delete_event\u0026#39; ) { .say; } whenever $connection.listen( \u0026#39;insert_event\u0026#39; ) { .say; } } ç›®çš„æ˜¯ï¼Œæ¯æ¬¡å‘å‡ºä¸€ä¸ªäº‹ä»¶ï¼Œ.listen éƒ½ä¼šå°†æ¶ˆæ¯æœ‰æ•ˆè½½è·ä¼ é€’ç»™ react ä»£ç å—ã€‚å› æ­¤ï¼Œå‘å‡ºä¸€äº› DELETE å’Œ INSERT ä¼šå¯¼è‡´è¾“å‡ºã€‚\nDELETING ROW(S) INSERTING ROW(S) INSERTING ROW(S) å¯ä»¥é€šè¿‡ .unlisten æ–¹æ³•åœæ­¢ç›‘å¬ååº”å—ã€‚ä¹Ÿå¯ä»¥é€šè¿‡ .notify æ–¹æ³•å‘å‡ºäº‹ä»¶ã€‚\næ€»ç»“ DB::Pg æ˜¯ PostgreSQL çš„ä¸€ä¸ªå¾ˆå¥½çš„é©±åŠ¨ç¨‹åºï¼Œå®ƒå…è®¸ Raku ç›´æ¥åœ¨è¯­è¨€ä¸­åˆ©ç”¨å¾ˆå¤šåŠŸèƒ½ã€‚\næ–‡ç«  A glance at Raku connectivity towards PostgreSQL å·²ç»ç”± Luca Ferrari å‘å¸ƒåœ¨åšå®¢ä¸Šã€‚\nåŸæ–‡é“¾æ¥: https://fluca1978.github.io/2021/03/29/RakuPostgreSQL.html\n","permalink":"https://ohmyweekly.github.io/notes/2021-04-05-psql/","tags":["Raku"],"title":"Psql"},{"categories":["rustlang"],"contents":"å­¦ä¹  std::io::Error åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†å‰–æ Rust æ ‡å‡†åº“ä¸­ std::io::Error ç±»å‹çš„å®ç°ã€‚ç›¸å…³ä»£ç åœ¨è¿™é‡Œï¼šlibrary/std/src/io/error.rsã€‚\nä½ å¯ä»¥æŠŠè¿™ç¯‡æ–‡ç« çœ‹æˆæ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚\n ä¸€ä¸ªæ ‡å‡†åº“çš„ç‰¹å®šä½çš„ç ”ç©¶ ä¸€ä¸ªé«˜çº§é”™è¯¯ç®¡ç†æŒ‡å— ä¸€ä¸ªæ¼‚äº®çš„ API è®¾è®¡æ¡ˆä¾‹  æ–‡ç« è¦æ±‚åŸºæœ¬ç†Ÿæ‚‰ Rust é”™è¯¯å¤„ç†ã€‚\nåœ¨è®¾è®¡ä¸€ä¸ªç”¨äº Result\u0026lt;Tï¼ŒE\u0026gt; çš„ Error ç±»å‹æ—¶ï¼Œä¸»è¦çš„é—®é¢˜æ˜¯\u0026quot;å¦‚ä½•ä½¿ç”¨è¿™ä¸ªé”™è¯¯ï¼Ÿ\u0026quot;ã€‚é€šå¸¸ï¼Œä»¥ä¸‹æƒ…å†µä¹‹ä¸€ä¸ºçœŸã€‚\n é”™è¯¯è¢«ç¨‹åºåŒ–å¤„ç†ã€‚æ¶ˆè´¹è€…æ£€æŸ¥é”™è¯¯ï¼Œæ‰€ä»¥å®ƒçš„å†…éƒ¨ç»“æ„éœ€è¦åœ¨åˆç†çš„ç¨‹åº¦ä¸Šæš´éœ²å‡ºæ¥ã€‚ é”™è¯¯è¢«ä¼ æ’­å¹¶æ˜¾ç¤ºç»™ç”¨æˆ·ã€‚æ¶ˆè´¹è€…ä¸æ£€æŸ¥ fmt::Display ä¹‹å¤–çš„é”™è¯¯ï¼›æ‰€ä»¥å®ƒçš„å†…éƒ¨ç»“æ„å¯ä»¥è¢«å°è£…ã€‚  è¯·æ³¨æ„ï¼Œæš´éœ²å®ç°ç»†èŠ‚å’Œå°è£…ç»†èŠ‚ä¹‹é—´å­˜åœ¨ç´§å¼ å…³ç³»ã€‚å®ç°ç¬¬ä¸€ç§æƒ…å†µçš„å¸¸è§åæ¨¡å¼æ˜¯å®šä¹‰ä¸€ä¸ªå¨æˆ¿æ°´æ§½æšä¸¾ã€‚\npubenum Error{Tokio(tokio::io::Error),ConnectionDiscovery{path: PathBuf,reason: String,stderr: String,},Deserialize{source: serde_json::Error,data: String,},...,Generic(String),}è¿™ç§æ–¹æ³•æœ‰å¾ˆå¤šé—®é¢˜ã€‚\né¦–å…ˆï¼Œä»åº•å±‚åº“ä¸­æš´éœ²é”™è¯¯ä¼šä½¿å®ƒä»¬æˆä¸ºä½ çš„å…¬å…± API çš„ä¸€éƒ¨åˆ†ã€‚åœ¨ä½ çš„ä¾èµ–å…³ç³»ä¸­çš„ä¸»è¦ semver bump ä¼šè¦æ±‚ä½ ä¹Ÿåšä¸€ä¸ªæ–°çš„ä¸»è¦ç‰ˆæœ¬ã€‚\nå…¶æ¬¡ï¼Œå®ƒå°†æ‰€æœ‰çš„å®ç°ç»†èŠ‚éƒ½å›ºå®šä¸‹æ¥ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æ³¨æ„åˆ° ConnectionDiscovery çš„å¤§å°æ˜¯å·¨å¤§çš„ï¼Œé‚£ä¹ˆå°†è¿™ä¸ªå˜ä½“è£…ç®±å°†æ˜¯ä¸€ä¸ªçªç ´æ€§çš„å˜åŒ–ã€‚\nç¬¬ä¸‰ï¼Œå®ƒé€šå¸¸è¡¨æ˜äº†ä¸€ä¸ªæ›´å¤§çš„è®¾è®¡é—®é¢˜ã€‚å¨æˆ¿æ°´æ§½é”™è¯¯å°†ä¸åŒçš„æ•…éšœæ¨¡å¼æ‰“åŒ…æˆä¸€ç§ç±»å‹ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ•…éšœæ¨¡å¼å·®å¼‚å¾ˆå¤§ï¼Œå¤„ç†èµ·æ¥å¯èƒ½å°±ä¸åˆç†äº†! è¿™è¯´æ˜æƒ…å†µçœ‹èµ·æ¥æ›´åƒæ¡ˆä¾‹äºŒã€‚\né”™è¯¯å¨æˆ¿æ°´æ§½ç—…çš„ä¸€ä¸ªç»å¸¸æœ‰æ•ˆçš„æ²»ç–—æ–¹æ³•æ˜¯å°†é”™è¯¯æ¨é€ç»™è°ƒç”¨è€…çš„æ¨¡å¼ã€‚\nè€ƒè™‘è¿™ä¸ªä¾‹å­:\nfn my_function()-\u0026gt; Result\u0026lt;i32,MyError\u0026gt;{letthing=dep_function()?;...Ok(92)}my_function è°ƒç”¨ dep_functionï¼Œæ‰€ä»¥ MyError åº”è¯¥å¯ä»¥ä» DepError è½¬æ¢è¿‡æ¥ã€‚æ›´å¥½çš„å†™æ³•å¯èƒ½æ˜¯è¿™æ ·çš„ã€‚\nfn my_function(thing: DepThing)-\u0026gt; Result\u0026lt;i32,MyError\u0026gt;{...Ok(92)}åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­ï¼Œè°ƒç”¨è€…è¢«è¿«è°ƒç”¨ dep_function å¹¶å¤„ç†å…¶é”™è¯¯ã€‚è¿™å°±ç”¨æ›´å¤šçš„ç±»å‹äº¤æ¢äº†æ›´å¤šçš„ç±»å‹å®‰å…¨ã€‚MyError å’Œ DepError ç°åœ¨æ˜¯ä¸åŒçš„ç±»å‹ï¼Œè°ƒç”¨è€…å¯ä»¥åˆ†åˆ«å¤„ç†å®ƒä»¬ã€‚å¦‚æœ DepError æ˜¯ MyError çš„å˜ä½“ï¼Œé‚£ä¹ˆå°±éœ€è¦è¿›è¡Œè¿è¡Œæ—¶åŒ¹é…ã€‚\nè¿™ä¸ªæƒ³æ³•çš„ä¸€ä¸ªæç«¯ç‰ˆæœ¬æ˜¯ sans-io ç¼–ç¨‹ã€‚å¤§å¤šæ•°é”™è¯¯æ¥è‡ªäº IOï¼›å¦‚æœä½ æŠŠæ‰€æœ‰çš„ IO æ¨ç»™è°ƒç”¨è€…ï¼Œä½ å°±å¯ä»¥è·³è¿‡å¤§éƒ¨åˆ†çš„é”™è¯¯å¤„ç†ã€‚\næ— è®ºæšä¸¾æ–¹æ³•å¤šä¹ˆç³Ÿç³•ï¼Œå®ƒç¡®å®å®ç°äº†ç¬¬ä¸€ç§æƒ…å†µçš„æœ€å¤§å¯æ£€æŸ¥æ€§ã€‚\nä»¥ä¼ æ’­ä¸ºä¸­å¿ƒçš„ç¬¬äºŒç§æƒ…å†µä¸‹çš„é”™è¯¯ç®¡ç†ï¼Œé€šå¸¸æ˜¯é€šè¿‡ä½¿ç”¨ç›’çŠ¶ç‰¹è´¨å¯¹è±¡æ¥å¤„ç†ã€‚åƒ Box\u0026lt;dyn std::error::Error\u0026gt; è¿™æ ·çš„ç±»å‹å¯ä»¥ä»ä»»ä½•å…·ä½“çš„é”™è¯¯ä¸­æ„é€ å‡ºæ¥ï¼Œå¯ä»¥é€šè¿‡ Display æ‰“å°å‡ºæ¥ï¼Œå¹¶ä¸”ä»ç„¶å¯ä»¥é€‰æ‹©é€šè¿‡åŠ¨æ€ä¸‹ä¼ æ¥æš´éœ²åº•å±‚é”™è¯¯ã€‚Anyhow crate å°±æ˜¯è¿™ç§é£æ ¼çš„ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚\nstd::io::Error çš„ä¾‹å­å¾ˆæœ‰è¶£ï¼Œå› ä¸ºå®ƒæƒ³åŒæ—¶å…·å¤‡ä¸Šè¿°ä¸¤ç§é£æ ¼ã€‚\n è¿™æ˜¯ stdï¼Œæ‰€ä»¥å°è£…å’Œé¢å‘æœªæ¥æ˜¯æœ€é‡è¦çš„ã€‚ æ¥è‡ªæ“ä½œç³»ç»Ÿçš„ IO é”™è¯¯å¾€å¾€å¯ä»¥è¢«å¤„ç†ï¼ˆæ¯”å¦‚ EWOULDBLOCKï¼‰ã€‚ å¯¹äºç³»ç»Ÿç¼–ç¨‹è¯­è¨€æ¥è¯´ï¼Œå‡†ç¡®åœ°æš´éœ²åº•å±‚ OS é”™è¯¯æ˜¯å¾ˆé‡è¦çš„ã€‚ æœªæ¥æ½œåœ¨çš„æ“ä½œç³»ç»Ÿé”™è¯¯é›†æ˜¯æ²¡æœ‰é™åˆ¶çš„ã€‚ io::Error ä¹Ÿæ˜¯ä¸€ç§è¯æ±‡ç±»å‹ï¼Œåº”è¯¥å¯ä»¥è¡¨ç¤ºä¸€äº›ä¸å®Œå…¨çš„ os é”™è¯¯ã€‚ä¾‹å¦‚ï¼ŒRust Paths å¯ä»¥åŒ…å«å†…éƒ¨çš„0å­—èŠ‚ï¼Œæ‰“å¼€è¿™æ ·çš„è·¯å¾„åº”è¯¥åœ¨è¿›è¡Œ syscall ä¹‹å‰è¿”å›ä¸€ä¸ª io::Errorã€‚  ä¸‹é¢æ˜¯ std::io::Error çš„æ ·å­ã€‚\npubstruct Error{repr: Repr,}enum Repr{Os(i32),Simple(ErrorKind),Custom(Box\u0026lt;Custom\u0026gt;),}struct Custom{kind: ErrorKind,error: Box\u0026lt;dynerror::Error+Send+Sync\u0026gt;,}é¦–å…ˆè¦æ³¨æ„çš„æ˜¯ï¼Œå®ƒå†…éƒ¨æ˜¯ä¸€ä¸ªæšä¸¾ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªéšè—å¾—å¾ˆå¥½çš„å®ç°ç»†èŠ‚ã€‚ä¸ºäº†å…è®¸æ£€æŸ¥å’Œå¤„ç†å„ç§é”™è¯¯æ¡ä»¶ï¼Œæœ‰ä¸€ä¸ªå•ç‹¬çš„å…¬å…±æ— å­—æ®µç§ç±»æšä¸¾ã€‚\n#[derive(Clone, Copy)]#[non_exhaustive]pubenum ErrorKind{NotFound,PermissionDenied,Interrupted,...Other,}implError{pubfn kind(\u0026amp;self)-\u0026gt; ErrorKind{match\u0026amp;self.repr{Repr::Os(code)=\u0026gt;sys::decode_error_kind(*code),Repr::Custom(c)=\u0026gt;c.kind,Repr::Simple(kind)=\u0026gt;*kind,}}}è™½ç„¶ ErrorKind å’Œ Repr éƒ½æ˜¯æšä¸¾ï¼Œä½†å…¬å¼€æš´éœ² ErrorKind å°±æ²¡é‚£ä¹ˆå¯æ€•äº†ã€‚ä¸€ä¸ª #[non_exhaustive]Copy æ— å­—æ®µæšä¸¾çš„è®¾è®¡ç©ºé—´æ˜¯ä¸€ä¸ªç‚¹ - æ²¡æœ‰åˆç†çš„æ›¿ä»£æ–¹æ¡ˆæˆ–å…¼å®¹æ€§éšæ‚£ã€‚\næœ‰äº› io::Errors åªæ˜¯åŸå§‹çš„æ“ä½œç³»ç»Ÿé”™è¯¯ä»£ç ã€‚\nimplError{pubfn from_raw_os_error(code: i32)-\u0026gt; Error{Error{repr: Repr::Os(code)}}pubfn raw_os_error(\u0026amp;self)-\u0026gt; Option\u0026lt;i32\u0026gt;{matchself.repr{Repr::Os(i)=\u0026gt;Some(i),Repr::Custom(..)=\u0026gt;None,Repr::Simple(..)=\u0026gt;None,}}}ç‰¹å®šå¹³å°çš„ sys::decode_error_kind å‡½æ•°è´Ÿè´£å°†é”™è¯¯ä»£ç æ˜ å°„åˆ° ErrorKind æšä¸¾ã€‚æ‰€æœ‰è¿™äº›éƒ½æ„å‘³ç€ä»£ç å¯ä»¥é€šè¿‡æ£€æŸ¥ .kind() æ¥è·¨å¹³å°å¤„ç†é”™è¯¯ç±»åˆ«ã€‚ç„¶è€Œï¼Œå¦‚æœéœ€è¦ä»¥ä¸€ç§ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„æ–¹å¼å¤„ç†ä¸€ä¸ªéå¸¸ç‰¹æ®Šçš„é”™è¯¯ä»£ç ï¼Œè¿™ä¹Ÿæ˜¯å¯èƒ½çš„ã€‚API å°å¿ƒç¿¼ç¿¼åœ°æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„æŠ½è±¡ï¼Œè€Œæ²¡æœ‰æŠ½è±¡æ‰é‡è¦çš„ä½çº§ç»†èŠ‚ã€‚\nä¸€ä¸ª std::io::Error ä¹Ÿå¯ä»¥ä»ä¸€ä¸ª ErrorKind ä¸­æ„é€ å‡ºæ¥ã€‚\nimplFrom\u0026lt;ErrorKind\u0026gt;forError{fn from(kind: ErrorKind)-\u0026gt; Error{Error{repr: Repr::Simple(kind)}}}è¿™æä¾›äº†è·¨å¹³å°è®¿é—®é”™è¯¯ä»£ç é£æ ¼çš„é”™è¯¯å¤„ç†ã€‚å¦‚æœä½ éœ€è¦å°½å¯èƒ½å¿«çš„é”™è¯¯ï¼Œè¿™å¾ˆæ–¹ä¾¿ã€‚\næœ€åï¼Œè¿˜æœ‰ç¬¬ä¸‰ç§å®Œå…¨è‡ªå®šä¹‰çš„å˜ä½“è¡¨ç¤ºã€‚\nimplError{pubfn new\u0026lt;E\u0026gt;(kind: ErrorKind,error: E)-\u0026gt; ErrorwhereE: Into\u0026lt;Box\u0026lt;dynerror::Error+Send+Sync\u0026gt;\u0026gt;,{Self::_new(kind,error.into())}fn _new(kind: ErrorKind,error: Box\u0026lt;dynerror::Error+Send+Sync\u0026gt;,)-\u0026gt; Error{Error{repr: Repr::Custom(Box::new(Custom{kind,error})),}}pubfn get_ref(\u0026amp;self,)-\u0026gt; Option\u0026lt;\u0026amp;(dynerror::Error+Send+Sync+\u0026#39;static)\u0026gt;{match\u0026amp;self.repr{Repr::Os(..)=\u0026gt;None,Repr::Simple(..)=\u0026gt;None,Repr::Custom(c)=\u0026gt;Some(\u0026amp;*c.error),}}pubfn into_inner(self,)-\u0026gt; Option\u0026lt;Box\u0026lt;dynerror::Error+Send+Sync\u0026gt;\u0026gt;{matchself.repr{Repr::Os(..)=\u0026gt;None,Repr::Simple(..)=\u0026gt;None,Repr::Custom(c)=\u0026gt;Some(c.error),}}}éœ€è¦æ³¨æ„çš„åœ°æ–¹ã€‚\n  é€šç”¨çš„ new å‡½æ•°å§”æ‰˜ç»™å•æ€çš„ _new å‡½æ•°ã€‚è¿™æ”¹å–„äº†ç¼–è¯‘æ—¶é—´ï¼Œå› ä¸ºåœ¨å•æ€åŒ–è¿‡ç¨‹ä¸­éœ€è¦é‡å¤çš„ä»£ç æ›´å°‘ã€‚æˆ‘è®¤ä¸ºè¿™ä¹Ÿæ”¹å–„äº†ä¸€äº›è¿è¡Œæ—¶ï¼š_new å‡½æ•°æ²¡æœ‰è¢«æ ‡è®°ä¸ºå†…è”ï¼Œæ‰€ä»¥ä¼šåœ¨è°ƒç”¨å¤„äº§ç”Ÿä¸€ä¸ªå‡½æ•°è°ƒç”¨ã€‚è¿™æ˜¯å¥½çš„ï¼Œå› ä¸ºé”™è¯¯æ„é€ æ˜¯å†·è·¯å¾„ï¼ŒèŠ‚çœæŒ‡ä»¤ç¼“å­˜æ˜¯å—æ¬¢è¿çš„ã€‚\n  è‡ªå®šä¹‰å˜ä½“è¢«æ¡†ä½äº† - è¿™æ˜¯ä¸ºäº†è®©æ•´ä½“ size_of æ›´å°ã€‚é”™è¯¯çš„ on-the-stack å¤§å°æ˜¯å¾ˆé‡è¦çš„ï¼šå³ä½¿æ²¡æœ‰é”™è¯¯ï¼Œä½ ä¹Ÿè¦ä¸ºæ­¤ä»˜å‡ºä»£ä»·!\n  è¿™ä¸¤ç§ç±»å‹éƒ½æ˜¯æŒ‡\u0026quot;é™æ€é”™è¯¯\u0026quot;ã€‚\ntype A=\u0026amp;(dynerror::Error+Send+Sync+\u0026#39;static);type B=Box\u0026lt;dynerror::Error+Send+Sync\u0026gt;åœ¨ dyn Trait + '_ ä¸­ï¼Œ'_ è¢«çœç•¥ä¸º 'staticï¼Œé™¤é trait å¯¹è±¡æ˜¯åœ¨å¼•ç”¨åé¢ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒè¢«çœç•¥ä¸º \u0026amp;'a dyn Trait + 'aã€‚\nget_ref, get_mut å’Œ into_inner æä¾›äº†å¯¹åº•å±‚é”™è¯¯çš„å®Œå…¨è®¿é—®ã€‚ç±»ä¼¼äº os_error çš„æƒ…å†µï¼ŒæŠ½è±¡æ¨¡ç³Šäº†ç»†èŠ‚ï¼Œä½†ä¹Ÿæä¾›äº†é’©å­æ¥è·å–åº•å±‚æ•°æ®çš„åŸæ ·ã€‚\nåŒæ ·ï¼ŒDisplay çš„å®ç°æ­ç¤ºäº†å†…éƒ¨è¡¨ç¤ºçš„æœ€é‡è¦ç»†èŠ‚ã€‚\nimplfmt::DisplayforError{fn fmt(\u0026amp;self,fmt: \u0026amp;mutfmt::Formatter\u0026lt;\u0026#39;_\u0026gt;)-\u0026gt; fmt::Result{match\u0026amp;self.repr{Repr::Os(code)=\u0026gt;{letdetail=sys::os::error_string(*code);write!(fmt,\u0026#34;{} (os error {})\u0026#34;,detail,code)}Repr::Simple(kind)=\u0026gt;write!(fmt,\u0026#34;{}\u0026#34;,kind.as_str()),Repr::Custom(c)=\u0026gt;c.error.fmt(fmt),}}}ç»¼ä¸Šæ‰€è¿°ï¼Œstd::io::Error:\n å°è£…äº†å®ƒçš„å†…éƒ¨è¡¨ç°å½¢å¼ï¼Œå¹¶é€šè¿‡æ¡†å®šå¤§çš„æšä¸¾å˜ä½“æ¥ä¼˜åŒ–å®ƒã€‚ é€šè¿‡ ErrorKind æ¨¡å¼æä¾›äº†ä¸€ç§æ–¹ä¾¿çš„æ–¹æ³•æ¥å¤„ç†åŸºäºç±»åˆ«çš„é”™è¯¯ã€‚ å®Œå…¨æš´éœ²åº•å±‚æ“ä½œç³»ç»Ÿçš„é”™è¯¯ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚  å¯ä»¥é€æ˜åœ°åŒ…è£¹ä»»ä½•å…¶ä»–é”™è¯¯ç±»å‹ã€‚\næœ€åä¸€ç‚¹æ„å‘³ç€ io::Error å¯ä»¥ç”¨äºä¸´æ—¶é”™è¯¯ï¼Œå› ä¸º \u0026amp;str å’Œ String å¯ä»¥è½¬æ¢ä¸º Box\u0026lt;dyn std::error::Error\u0026gt;ã€‚\nio::Error::new(io::ErrorKind::Other,\u0026#34;something went wrong\u0026#34;)å®ƒä¹Ÿå¯ä»¥ä½œä¸º anyhow çš„ç®€å•æ›¿æ¢ã€‚æˆ‘æƒ³ä¸€äº›åº“å¯èƒ½ä¼šç”¨è¿™ä¸ªæ¥ç®€åŒ–ä»–ä»¬çš„é”™è¯¯å¤„ç†ã€‚\nio::Error::new(io::ErrorKind::InvalidData,my_specific_error)ä¾‹å¦‚ï¼Œserde_json æä¾›äº†ä»¥ä¸‹æ–¹æ³•ã€‚\nfn from_reader\u0026lt;R,T\u0026gt;(rdr: R)-\u0026gt; Result\u0026lt;T,serde_json::Error\u0026gt;whereR: Read,T: DeserializeOwned,è¯»å–ä¼šå› ä¸º io::Error è€Œå¤±è´¥ï¼Œæ‰€ä»¥ serde_json::Error éœ€è¦èƒ½å¤Ÿåœ¨å†…éƒ¨è¡¨ç¤º io::Errorã€‚æˆ‘è®¤ä¸ºè¿™æ˜¯å€’é€€çš„ (ä½†æˆ‘ä¸çŸ¥é“æ•´ä¸ªä¸Šä¸‹æ–‡ï¼Œå¦‚æœè¢«è¯æ˜æ˜¯é”™çš„æˆ‘ä¼šå¾ˆé«˜å…´ï¼)ï¼Œç­¾ååº”è¯¥æ˜¯è¿™æ ·çš„ã€‚\nfn from_reader\u0026lt;R,T\u0026gt;(rdr: R)-\u0026gt; Result\u0026lt;T,io::Error\u0026gt;whereR: Read,T: DeserializeOwned,é‚£ä¹ˆï¼Œserde_json::Error å°±ä¸ä¼šæœ‰ Io çš„å˜ä½“ï¼Œè€Œä¼šä»¥ InvalidData çš„å½¢å¼è¢«è—åˆ° io::Error ä¸­ã€‚ è¡¥é—, 2021-01-25\né‡æ–°é˜…è¯»è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ç°åœ¨è®¤ä¸ºæ­£ç¡®çš„è¿”å›ç±»å‹åº”è¯¥æ˜¯ï¼š\nfn from_reader\u0026lt;R,T\u0026gt;(rdr: R,)-\u0026gt; Result\u0026lt;Result\u0026lt;T,serde_json::Error\u0026gt;,io::Error\u0026gt;whereR: Read,T: DeserializeOwned,è¿™è¿«ä½¿ IO å’Œååºåˆ—åŒ–é”™è¯¯åˆ†å¼€å¤„ç†ï¼Œè¿™åœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯æœ‰æ„ä¹‰çš„ã€‚IO é”™è¯¯å¯èƒ½æ˜¯ç¨‹åºé¢†åŸŸä¹‹å¤–çš„ç¡¬ä»¶/ç¯å¢ƒé—®é¢˜ï¼Œè€Œåºåˆ—åŒ–é”™è¯¯å¾ˆå¯èƒ½æ˜¯ç³»ç»Ÿä¸­çš„æŸä¸ªé”™è¯¯ã€‚\næˆ‘è®¤ä¸º std::io::Error æ˜¯ä¸€ä¸ªéå¸¸äº†ä¸èµ·çš„ç±»å‹ï¼Œå®ƒèƒ½å¤Ÿåœ¨æ²¡æœ‰å¤ªå¤šå¦¥åçš„æƒ…å†µä¸‹ä¸ºè®¸å¤šä¸åŒçš„ç”¨ä¾‹æœåŠ¡ã€‚ä½†æˆ‘ä»¬æ˜¯å¦å¯ä»¥åšå¾—æ›´å¥½å‘¢ï¼Ÿ\nstd::io::Error çš„é¦–è¦é—®é¢˜æ˜¯ï¼Œå½“ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿæ“ä½œå¤±è´¥æ—¶ï¼Œä½ ä¸çŸ¥é“å®ƒæ˜¯ä¸ºå“ªä¸ªè·¯å¾„å¤±è´¥çš„ã€‚è¿™æ˜¯å¯ä»¥ç†è§£çš„ - Rust æ˜¯ä¸€ç§ç³»ç»Ÿè¯­è¨€ï¼Œæ‰€ä»¥å®ƒä¸åº”è¯¥æ¯” OS åŸç”Ÿæä¾›çš„ä¸œè¥¿å¢åŠ å¤šå°‘è„‚è‚ªã€‚OS è¿”å›çš„æ˜¯ä¸€ä¸ªæ•´æ•°è¿”å›ä»£ç ï¼Œè€Œå°†å…¶ä¸ä¸€ä¸ªå †åˆ†é…çš„ PathBuf è€¦åˆåœ¨ä¸€èµ·ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªä¸å¯æ¥å—çš„å¼€é”€!\næˆ‘å¾ˆæƒŠè®¶åœ°å¾—çŸ¥ï¼Œäº‹å®ä¸Šï¼Œstd å¯¹æ¯ä¸€ä¸ªä¸è·¯å¾„ç›¸å…³çš„ç³»ç»Ÿè°ƒç”¨éƒ½ä¼šè¿›è¡Œåˆ†é…ã€‚\nå®ƒéœ€è¦ä»¥æŸç§å½¢å¼å­˜åœ¨ã€‚OS API éœ€è¦åœ¨å­—ç¬¦ä¸²çš„ç»“å°¾æœ‰ä¸€ä¸ªä¸å¹¸çš„é›¶å­—èŠ‚. ä½†æˆ‘æƒ³çŸ¥é“å¯¹çŸ­è·¯å¾„ä½¿ç”¨å †æ ˆåˆ†é…çš„ç¼“å†²åŒºæ˜¯å¦æœ‰æ„ä¹‰ã€‚å¯èƒ½ä¸ä¼š - è·¯å¾„é€šå¸¸ä¸ä¼šé‚£ä¹ˆçŸ­ï¼Œè€Œä¸”ç°ä»£åˆ†é…å™¨èƒ½æœ‰æ•ˆåœ°å¤„ç†ç¬æ—¶åˆ†é…ã€‚\næˆ‘ä¸çŸ¥é“è¿™é‡Œæœ‰ä»€ä¹ˆæ˜æ˜¾çš„å¥½åŠæ³•ã€‚ä¸€ä¸ªé€‰æ‹©æ˜¯åœ¨ç¼–è¯‘æ—¶ï¼ˆä¸€æ—¦æˆ‘ä»¬å¾—åˆ° std-aware cargoï¼‰æˆ–è¿è¡Œæ—¶ï¼ˆa-la RUST_BACKTRACEï¼‰æ·»åŠ å¼€å…³ï¼Œä»¥å †åˆ†é…æ‰€æœ‰ä¸è·¯å¾„ç›¸å…³çš„ IO é”™è¯¯ã€‚ä¸€ä¸ªç±»ä¼¼å½¢çš„é—®é¢˜æ˜¯ io::Error ä¸æºå¸¦ backtraceã€‚\nå¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œstd::io::Error çš„æ•ˆç‡ä¸é«˜ã€‚\nå®ƒçš„ä½“ç§¯æ˜¯ç›¸å½“å¤§çš„ã€‚\nassert_eq!(size_of::\u0026lt;io::Error\u0026gt;(),2*size_of::\u0026lt;usize\u0026gt;());å¯¹äºè‡ªå®šä¹‰çš„æƒ…å†µï¼Œä¼šäº§ç”ŸåŒé‡çš„é—´æ¥å’Œåˆ†é…ã€‚\nenum Repr{Os(i32),Simple(ErrorKind),// First Box :| Custom(Box\u0026lt;Custom\u0026gt;),}struct Custom{kind: ErrorKind,// Second Box :( error: Box\u0026lt;dynerror::Error+Send+Sync\u0026gt;,}æˆ‘æƒ³æˆ‘ä»¬ç°åœ¨å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜äº†\né¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ä¸€ä¸ªç˜¦çš„ç‰¹è´¨å¯¹è±¡æ¥æ‘†è„±åŒé‡å†…å‘æ€§ï¼Œæ¯”å¦‚å¤±è´¥æˆ– anyhowã€‚ç°åœ¨ GlobalAlloc å·²ç»å­˜åœ¨ï¼Œè¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒç›´æ¥çš„å®ç°ã€‚\nå…¶æ¬¡ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æŒ‡é’ˆæ˜¯å¯¹é½çš„è¿™ä¸€äº‹å®ï¼Œå°† Os å’Œ Simple å˜ä½“éƒ½ç”¨æœ€å°çš„æœ‰æ•ˆä½é›†å‚¨è—åˆ° usize ä¸­ã€‚æˆ‘è®¤ä¸ºæˆ‘ä»¬ç”šè‡³å¯ä»¥å‘æŒ¥åˆ›æ„ï¼Œä½¿ç”¨ç¬¬äºŒä¸ªæœ€å°æœ‰æ„ä¹‰çš„ä½ï¼ŒæŠŠç¬¬ä¸€ä¸ªä½ç•™ä½œå°ä¼—ã€‚è¿™æ ·ä¸€æ¥ï¼Œå³ä½¿æ˜¯åƒ io::Result\u0026lt;i32\u0026gt; è¿™æ ·çš„ä¸œè¥¿ï¼Œä¹Ÿå¯ä»¥æ˜¯æŒ‡é’ˆå¤§å°çš„!\næœ¬ç¯‡æ–‡ç« åˆ°æ­¤ç»“æŸã€‚ä¸‹ä¸€æ¬¡ä½ è¦ä¸ºä½ çš„åº“è®¾è®¡ä¸€ä¸ªé”™è¯¯ç±»å‹çš„æ—¶å€™ï¼ŒèŠ±ç‚¹æ—¶é—´å»çœ‹çœ‹ std::io::Error çš„æºå¤´ï¼Œä½ å¯èƒ½ä¼šå‘ç°ä¸€äº›å€¼å¾—å·çš„ä¸œè¥¿ã€‚\nè®¨è®ºåœ¨ /r/rust.Net ä¸Šè¿›è¡Œã€‚\né¢å¤–çš„è°œé¢˜ çœ‹çœ‹å®ç°ä¸­çš„è¿™ä¸€è¡Œã€‚\nimplfmt::DisplayforError{fn fmt(\u0026amp;self,fmt: \u0026amp;mutfmt::Formatter\u0026lt;\u0026#39;_\u0026gt;)-\u0026gt; fmt::Result{match\u0026amp;self.repr{Repr::Os(code)=\u0026gt;{letdetail=sys::os::error_string(*code);write!(fmt,\u0026#34;{} (os error {})\u0026#34;,detail,code)}Repr::Simple(kind)=\u0026gt;write!(fmt,\u0026#34;{}\u0026#34;,kind.as_str()),Repr::Custom(c)=\u0026gt;c.error.fmt(fmt),}}}åŸæ–‡é“¾æ¥: https://matklad.github.io/2020/10/15/study-of-std-io-error.html\n","permalink":"https://ohmyweekly.github.io/notes/2021-04-05-std-error-in-rust/","tags":["Rust"],"title":"Std Error in Rust"},{"categories":["rustlang"],"contents":"Two Beautiful Rust Programs è¿™æ˜¯ä¸€åˆ™ Rust ç¼–ç¨‹è¯­è¨€çš„çŸ­å¹¿å‘Šï¼Œç›®æ ‡æ˜¯æœ‰ç»éªŒçš„ C++ å¼€å‘è€…ã€‚ä½œä¸ºä¸€åˆ™å¹¿å‘Šï¼Œå®ƒåªèƒ½åŠèµ·ä½ çš„èƒƒå£ï¼Œå…·ä½“å†…å®¹è¯·å‚è€ƒå…¶ä»–èµ„æºã€‚\nç¬¬ä¸€ä¸ªç¨‹åº:\nfn main(){letmutxs=vec![1,2,3];letx: \u0026amp;i32 =\u0026amp;xs[0];xs.push(92);println!(\u0026#34;{}\u0026#34;,*x);}è¿™ä¸ªç¨‹åºåˆ›å»ºäº†ä¸€ä¸ª 32 ä½æ•´æ•°çš„å‘é‡(std::vector\u0026lt;int32_t\u0026gt;)ï¼Œæ¥æ”¶ç¬¬ä¸€ä¸ªå…ƒç´  x çš„å¼•ç”¨ï¼Œå†å‘å‘é‡æ¨é€ä¸€ä¸ªæ•°å­—ï¼Œç„¶åä½¿ç”¨ xã€‚è¿™ä¸ªç¨‹åºæ˜¯é”™è¯¯çš„ï¼šæ‰©å±•å‘é‡å¯èƒ½ä¼šä½¿å¯¹å…ƒç´ çš„å¼•ç”¨æ— æ•ˆï¼Œè€Œä¸” *x å¯èƒ½ä¼šå–æ¶ˆå¼•ç”¨ä¸€ä¸ª danging æŒ‡é’ˆã€‚\nè¿™ä¸ªç¨‹åºçš„å¥½å¤„æ˜¯å®ƒä¸ä¼šè¢«ç¼–è¯‘ã€‚\nerror[E0502]: cannot borrow xs as mutable because it is also borrowed as immutable --\u0026gt; src/main.rs:4:5 let x: \u0026amp;i32 = \u0026amp;xs[0]; -- immutable borrow occurs here xs.push(92); ^^^^^^^^^^^ mutable borrow occurs here println!(x); - immutable borrow later used here Rust ç¼–è¯‘å™¨è·Ÿè¸ªæ¯å—æ•°æ®çš„åˆ«åçŠ¶æ€ï¼Œå¹¶ç¦æ­¢æ½œåœ¨çš„åˆ«åæ•°æ®çš„çªå˜ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œx å’Œ xs åˆ«åäº†å‘é‡åœ¨å †ä¸­å­˜å‚¨çš„ç¬¬ä¸€ä¸ªæ•´æ•°ã€‚\nRust ä¸å…è®¸åšå‚»äº‹ã€‚\nç¬¬äºŒä¸ªç¨‹åº:\nusecrossbeam::scope;useparking_lot::{Mutex,MutexGuard};fn main(){letmutcounter=Mutex::new(0);scope(|s|{for_in0..10{s.spawn(|_|{for_in0..10{letmutguard: MutexGuard\u0026lt;i32\u0026gt;=counter.lock();*guard+=1;}});}}).unwrap();lettotal: \u0026amp;muti32=counter.get_mut();println!(\u0026#34;total = {}\u0026#34;,*total)}è¿™ä¸ªç¨‹åºåˆ›å»ºä¸€ä¸ªç”± mutex ä¿æŠ¤çš„æ•´æ•°è®¡æ•°å™¨ï¼Œç”Ÿæˆ10ä¸ªçº¿ç¨‹ï¼Œä»æ¯ä¸ªçº¿ç¨‹å¼€å§‹å°†è®¡æ•°å™¨é€’å¢10æ¬¡ï¼Œå¹¶æ‰“å°å‡ºæ€»æ•°ã€‚\nè®¡æ•°å™¨å˜é‡ä½äºå †æ ˆä¸­ï¼Œè¿™äº›å †æ ˆæ•°æ®çš„æŒ‡é’ˆä¸å…¶ä»–çº¿ç¨‹å…±äº«ã€‚çº¿ç¨‹å¿…é¡»é”å®š mutex æ‰èƒ½è¿›è¡Œå¢é‡ã€‚æ‰“å°æ€»æ•°æ—¶ï¼Œç»•è¿‡ mutex è¯»å–è®¡æ•°å™¨ï¼Œæ²¡æœ‰ä»»ä½•åŒæ­¥ã€‚\nè¿™ä¸ªç¨‹åºçš„å¦™å¤„åœ¨äºï¼Œå®ƒçš„æ­£ç¡®æ€§ä¾èµ–äºå‡ ä½ç²¾å¦™çš„æ¨ç†ï¼Œæ¯ä¸€ä¸ªæ¨ç†éƒ½ä¼šè¢«ç¼–è¯‘å™¨æ£€æŸ¥ã€‚\nå­çº¿ç¨‹ä¸ä¼šé€ƒç¦»ä¸»å‡½æ•° æ‰€ä»¥å¯ä»¥ä»å®ƒçš„å †æ ˆä¸­è¯»å–è®¡æ•°å™¨\nå­çº¿ç¨‹åªé€šè¿‡ mutex è®¿é—® counterã€‚\nå­çº¿ç¨‹å°†åœ¨æˆ‘ä»¬ä»è®¡æ•°å™¨ä¸­è¯»å‡ºæ€»æ•°è€Œä¸ä½¿ç”¨ mutex æ—¶ç»ˆæ­¢ã€‚\nå¦‚æœè¿™äº›çº¦æŸä¸­çš„ä»»ä½•ä¸€ä¸ªè¢«ç ´åï¼Œç¼–è¯‘å™¨å°±ä¼šæ‹’ç»è¯¥ä»£ç ã€‚æ²¡æœ‰å¿…è¦ä½¿ç”¨ std::shared_ptr åªæ˜¯ä¸ºäº†é˜²å¾¡æ€§åœ°ç¡®ä¿å†…å­˜ä¸ä¼šåœ¨ä½ çš„è„šä¸‹è¢«é‡Šæ”¾ã€‚\nRust å…è®¸åšå±é™©çš„ã€èªæ˜çš„ã€å¿«é€Ÿçš„äº‹æƒ…ï¼Œè€Œä¸ç”¨æ‹…å¿ƒå¼•å…¥æœªå®šä¹‰çš„è¡Œä¸ºã€‚\nå¦‚æœä½ å–œæ¬¢ä½ æ‰€çœ‹åˆ°çš„ï¼Œè¿™é‡Œæœ‰ä¸¤æœ¬æˆ‘æ¨èçš„ä¹¦ï¼Œå¯ä»¥è®©ä½ æ›´æ·±å…¥åœ°äº†è§£ Rustã€‚\nåŸæ–‡é“¾æ¥: https://matklad.github.io/2020/07/15/two-beautiful-programs.html\n","permalink":"https://ohmyweekly.github.io/notes/2021-04-05-two-beautiful-rust-programs/","tags":["Rust"],"title":"Two Beautiful Rust Programs"},{"categories":["rakulang"],"contents":"æˆ‘çš„å¤©å•Šï¼Œçœ‹æ¥æˆ‘æ˜¯ä¸¤å¹´å¤šæ¥ç¬¬ä¸€æ¬¡å†™ Raku å†…éƒ¨çš„åšæ–‡äº†ã€‚å½“ç„¶ï¼Œä¸¤å¹´å‰è¿˜ä¸å« Rakuã€‚æ€»ä¹‹ï¼Œè¯ä¸å¤šè¯´ï¼Œç»§ç»­è¯´è¯´è¿™ä¸ªå…±åŒçš„è„‘æ´å§ã€‚\nä»€ä¹ˆæ˜¯è°ƒåº¦ï¼Ÿ æˆ‘ç”¨ \u0026ldquo;dispatch\u0026rdquo; æ¥è¡¨ç¤ºæˆ‘ä»¬æ¥å—ä¸€ç»„å‚æ•°ï¼Œæœ€åæ ¹æ®è¿™äº›å‚æ•°é‡‡å–ä¸€äº›è¡ŒåŠ¨çš„è¿‡ç¨‹ã€‚ä¸€äº›ç†Ÿæ‚‰çš„ä¾‹å­åŒ…æ‹¬:\n  è¿›è¡Œä¸€ä¸ªæ–¹æ³•è°ƒç”¨ï¼Œæ¯”å¦‚ $basket.add($product, $quantity)ã€‚ä¼ ç»Ÿä¸Šï¼Œæˆ‘ä»¬å¯èƒ½åªè°ƒç”¨ $product å’Œ $qauntity ä½œä¸ºå‚æ•°ï¼Œä½†å°±æˆ‘çš„ç›®çš„è€Œè¨€ï¼Œæ‰€æœ‰çš„ $basketã€æ–¹æ³•å \u0026ldquo;add\u0026rdquo;ã€$product å’Œ $quantity éƒ½æ˜¯ dispatch çš„å‚æ•°ï¼šå®ƒä»¬æ˜¯æˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿ï¼Œä»¥ä¾¿å†³å®šæˆ‘ä»¬è¦åšä»€ä¹ˆã€‚\n  è¿›è¡Œå­ç¨‹åºè°ƒç”¨ï¼Œå¦‚ uc($youtube-comment)ã€‚ç”±äº Raku sub è°ƒç”¨æ˜¯è¯æ³•è§£æçš„ï¼Œæ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè°ƒåº¦çš„å‚æ•°æ˜¯ \u0026amp;ucï¼ˆæŸ¥æ‰¾å­ç¨‹åºçš„ç»“æœï¼‰å’Œ $youtube-commentã€‚\n  è°ƒç”¨å¤šä¸ªè°ƒåº¦å­ç¨‹åºæˆ–æ–¹æ³•ï¼Œæ ¹æ®å‚æ•°çš„æ•°é‡å’Œç±»å‹æ¥å†³å®šè°ƒç”¨ä¸€ç»„å€™é€‰ç¨‹åºä¸­çš„å“ªä¸€ä¸ªã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥çœ‹ä½œæ˜¯å‘ç”Ÿåœ¨ä¸Šè¿°ä¸¤ä¸ªè°ƒåº¦ä¸­çš„ä¸€ä¸ª \u0026ldquo;å†…éƒ¨\u0026rdquo;ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨ Raku ä¸­æ—¢æœ‰å¤šé‡è°ƒåº¦å­ç¨‹åºï¼Œä¹Ÿæœ‰æ–¹æ³•ã€‚\n  ä¹ä¸€çœ‹ï¼Œä¹Ÿè®¸å‰ä¸¤ä¸ªçœ‹èµ·æ¥ç›¸å½“ç®€å•ï¼Œç¬¬ä¸‰ä¸ªå°±æœ‰ç‚¹æ‰‹å¿™è„šä¹±äº† - è¿™ä¹Ÿç®—æ˜¯äº‹å®ã€‚ç„¶è€Œï¼ŒRaku è¿˜æœ‰ä¸€äº›å…¶ä»–çš„ç‰¹æ€§ï¼Œä½¿å¾—è°ƒåº¦å˜å¾—ç›¸å½“ï¼Œå—¯ï¼Œæœ‰è¶£ã€‚ä¾‹å¦‚ï¼š\n  wrap å…è®¸æˆ‘ä»¬åŒ…è£…ä»»ä½• Routine (sub æˆ–æ–¹æ³•); åŒ…è£…å™¨å¯ä»¥é€‰æ‹©ç”¨åŸæ¥çš„å‚æ•°æˆ–æ–°çš„å‚æ•°æ¥æœä»åŸæ¥çš„ä¾‹ç¨‹ã€‚\n  å½“è¿›è¡Œå¤šé‡è°ƒåº¦æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªåŸå‹ä¾‹ç¨‹ï¼Œè®©å®ƒé€‰æ‹©ä½•æ—¶ - ç”šè‡³æ˜¯å¦ - è°ƒç”¨åˆé€‚çš„å€™é€‰è€…ã€‚\n  æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ callsame è¿™æ ·çš„ä¾‹ç¨‹ï¼Œä»¥ä¾¿åœ¨è°ƒåº¦ä¸­æ¨è¿Ÿåˆ°ä¸‹ä¸€ä¸ªå€™é€‰è€…ã€‚ä½†è¿™æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬æ˜¯åœ¨ä¸€ä¸ªå¤šé‡è°ƒåº¦ä¸­ï¼Œå®ƒæ„å‘³ç€ä¸‹ä¸€ä¸ªæœ€é€‚ç”¨çš„å€™é€‰è€…ï¼Œå¦‚æœæœ‰çš„è¯ã€‚å¦‚æœæˆ‘ä»¬æ˜¯åœ¨ä¸€ä¸ªæ–¹æ³•è°ƒåº¦ä¸­ï¼Œé‚£ä¹ˆå®ƒæ„å‘³ç€ä¸€ä¸ªåŸºç±»çš„æ–¹æ³•ã€‚(åŒæ ·çš„äº‹æƒ…ä¹Ÿè¢«ç”¨æ¥å®ç°å»ä¸‹ä¸€ä¸ªå°è£…è€…ï¼Œæˆ–è€…ï¼Œæœ€ç»ˆä¹Ÿæ˜¯å»æœ€åˆå°è£…çš„ä¾‹ç¨‹)ã€‚è€Œä¸”è¿™äº›éƒ½å¯ä»¥ç»“åˆèµ·æ¥ï¼šæˆ‘ä»¬å¯ä»¥åŒ…è£…ä¸€ä¸ª multi æ–¹æ³•ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥æœ‰ 3 ä¸ªå±‚æ¬¡çš„ä¸œè¥¿ï¼Œéƒ½æœ‰å¯èƒ½è´¡çŒ®ä¸‹ä¸€ä¸ªè¦è°ƒç”¨çš„ä¸œè¥¿!\n  å¤šäºäº†è¿™ä¸€ç‚¹ï¼Œdispatch - è‡³å°‘åœ¨ Raku ä¸­ - å¹¶ä¸æ€»æ˜¯æˆ‘ä»¬æ‰€åšçš„äº‹æƒ…å¹¶äº§ç”Ÿä¸€ä¸ªç»“æœï¼Œè€Œæ˜¯ä¸€ä¸ªå¯èƒ½ä¼šè¢«è¦æ±‚ç»§ç»­å¤šæ¬¡è¿›è¡Œçš„è¿‡ç¨‹!\næœ€åï¼Œè™½ç„¶æˆ‘ä¸Šé¢æ‰€å†™çš„ä¾‹å­éƒ½å¯ä»¥å¾ˆæ¸…æ¥šåœ°çœ‹æˆæ˜¯è°ƒåº¦çš„ä¾‹å­ï¼Œä½†åœ¨ Raku ä¸­ï¼Œå…¶ä»–ä¸€äº›å¸¸è§çš„æ„é€ ä¹Ÿå¯ä»¥è¡¨è¾¾ä¸ºä¸€ç§è°ƒåº¦ã€‚åˆ†é…æ˜¯ä¸€ä¸ªä¾‹å­ï¼šå®ƒçš„è¯­ä¹‰å–å†³äºåˆ†é…çš„ç›®æ ‡å’Œè¢«åˆ†é…çš„å€¼ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é€‰æ‹©æ­£ç¡®çš„è¯­ä¹‰ã€‚å¼ºåˆ¶ç±»å‹è½¬æ¢(Coercion)æ˜¯å¦ä¸€ä¸ªä¾‹å­ï¼Œè¿”å›å€¼ç±»å‹æ£€æŸ¥åˆæ˜¯ä¸€ä¸ªä¾‹å­ã€‚\nä¸ºä»€ä¹ˆè°ƒåº¦å¾ˆé‡è¦ï¼Ÿ Dispatch åœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­æ— å¤„ä¸åœ¨ï¼Œå®ƒæ‚„æ‚„åœ°æŠŠæƒ³åšäº‹æƒ…çš„ä»£ç å’Œåšäº‹æƒ…çš„ä»£ç è”ç³»åœ¨ä¸€èµ·ã€‚å®ƒçš„æ— å¤„ä¸åœ¨æ„å‘³ç€å®ƒåœ¨ç¨‹åºæ€§èƒ½ä¸­æ‰®æ¼”ç€é‡è¦çš„è§’è‰²ã€‚åœ¨æœ€å¥½çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†æˆæœ¬é™ä¸ºé›¶ã€‚åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œè°ƒåº¦çš„æˆæœ¬é«˜åˆ°è¶³ä»¥è¶…è¿‡ä½œä¸ºè°ƒåº¦ç»“æœçš„å·¥ä½œçš„æˆæœ¬ã€‚\nåˆæ­¥ä¼°è®¡ï¼Œå½“è¿è¡Œæ—¶\u0026quot;ç†è§£\u0026quot;è°ƒåº¦æ—¶ï¼Œæ€§èƒ½è‡³å°‘ä¼šæœ‰äº›ä¸é”™ï¼Œä½†å½“è¿è¡Œæ—¶ä¸ç†è§£æ—¶ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šå¾ˆç³Ÿç³•ã€‚è°ƒåº¦å¾€å¾€æ¶‰åŠåˆ°ä¸€ä¸ªå¯ä»¥ç¼“å­˜çš„å·¥ä½œé‡ï¼Œå¾€å¾€ä¼šæœ‰ä¸€äº›å»‰ä»·çš„é˜²æŠ¤æªæ–½æ¥éªŒè¯ç¼“å­˜ç»“æœçš„æœ‰æ•ˆæ€§ã€‚ä¾‹å¦‚ï¼Œåœ¨æ–¹æ³•è°ƒåº¦ä¸­ï¼Œå¤©çœŸåœ°æˆ‘ä»¬éœ€è¦èµ°ä¸€ä¸ªçº¿æ€§åŒ–çš„ç»§æ‰¿å›¾ï¼Œå¹¶è¯¢é—®æ²¿é€”é‡åˆ°çš„æ¯ä¸ªç±»æ˜¯å¦æœ‰æŒ‡å®šåç§°çš„æ–¹æ³•ã€‚æ˜¾ç„¶ï¼Œå¦‚æœæˆ‘ä»¬åœ¨æ¯æ¬¡æ–¹æ³•è°ƒç”¨æ—¶éƒ½è¿™æ ·åšï¼Œé€Ÿåº¦ä¸ä¼šéå¸¸å¿«ã€‚ç„¶è€Œï¼Œç‰¹å®šç±»å‹ä¸Šçš„ç‰¹å®šæ–¹æ³•åï¼ˆç²¾ç¡®è¯†åˆ«ï¼Œä¸è€ƒè™‘å­ç±»ï¼‰æ¯æ¬¡éƒ½ä¼šè§£æåˆ°åŒä¸€ä¸ªæ–¹æ³•ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç¼“å­˜æŸ¥æ‰¾çš„ç»“æœï¼Œåªè¦è°ƒç”¨è€…çš„ç±»å‹ä¸ç”¨äºäº§ç”Ÿç¼“å­˜ç»“æœçš„ç±»å‹ç›¸åŒ¹é…ï¼Œå°±å¯ä»¥ä½¿ç”¨å®ƒã€‚\nè¯­è¨€è¿è¡Œæ—¶çš„ä¸“é—¨åŒ–ä¸é€šç”¨åŒ–æœºåˆ¶ å½“ä¸€ä¸ªäººå¼€å§‹æ„å»ºä¸€ä¸ªé’ˆå¯¹ç‰¹å®šè¯­è¨€çš„è¿è¡Œæ—¶ï¼Œå¹¶ä¸”å¿…é¡»åœ¨ç›¸å½“ç´§å¼ çš„é¢„ç®—ä¸‹å®Œæˆæ—¶ï¼Œè¦æƒ³è·å¾—æŸç§å¯å®¹å¿çš„æ€§èƒ½ï¼Œæœ€æ˜æ˜¾çš„æ–¹æ³•å°±æ˜¯å°†å„ç§çƒ­è·¯å¾„è¯­è¨€è¯­ä¹‰çƒ˜ç„™åˆ°è¿è¡Œæ—¶ä¸­ã€‚è¿™æ­£æ˜¯ MoarVM çš„èµ·æ­¥æ–¹å¼ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬çœ‹çœ‹ MoarVM å‡ å¹´å‰çš„æ ·å­ï¼Œæˆ‘ä»¬ä¼šå‘ç°è¿™æ ·çš„äº‹æƒ…ã€‚\n å¯¹æ–¹æ³•ç¼“å­˜çš„ä¸€äº›æ”¯æŒ ä¸€ä¸ªä¸ Raku çš„å¤šé‡è°ƒåº¦è¯­ä¹‰é«˜åº¦ç»‘å®šçš„å¤šé‡è°ƒåº¦ç¼“å­˜ï¼Œåªæœ‰åœ¨è°ƒåº¦éƒ½æ˜¯åä¹‰ç±»å‹çš„æ—¶å€™æ‰çœŸæ­£èƒ½å¤Ÿèµ·åˆ°å¸®åŠ©ä½œç”¨ï¼ˆæ‰€ä»¥ä½¿ç”¨ where çš„ä»£ä»·éå¸¸é«˜ï¼‰ã€‚ ä¸€ç§æœºåˆ¶ï¼Œç”¨äºæŒ‡å®šå¦‚ä½•åœ¨å°è£…ä»£ç å¯¹è±¡å†…éƒ¨æ‰¾åˆ°å®é™…çš„ä»£ç å¥æŸ„ï¼ˆä¾‹å¦‚ï¼ŒSub å¯¹è±¡æœ‰ä¸€ä¸ªç§æœ‰å±æ€§ï¼Œå®ƒæŒæœ‰è¯†åˆ«è¦è¿è¡Œçš„å­—èŠ‚ç çš„ä½çº§ä»£ç å¥æŸ„ï¼‰ã€‚ ä¸€äº›æœ‰é™çš„å°è¯•ï¼Œè®©æˆ‘ä»¬èƒ½å¤Ÿåœ¨çŸ¥é“ä¸€ä¸ªè°ƒåº¦ä¸ä¼šç»§ç»­çš„æƒ…å†µä¸‹æ­£ç¡®åœ°è¿›è¡Œä¼˜åŒ– - è¿™éœ€è¦ç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶ä¹‹é—´çš„è°¨æ…åˆä½œï¼ˆæˆ–è€…ä¸é‚£ä¹ˆå¤–äº¤åœ°è®²ï¼Œè¿™éƒ½æ˜¯ä¸€ä¸ªå¤§é»‘å®¢ï¼‰ã€‚  è¿™äº›ä»Šå¤©éƒ½è¿˜åœ¨ï¼Œç„¶è€Œä¹Ÿéƒ½åœ¨æ·˜æ±°çš„è·¯ä¸Šã€‚è¿™ä¸ªæ¦œå•æœ€èƒ½è¯´æ˜é—®é¢˜çš„æ˜¯ä»€ä¹ˆï¼Œä¸åŒ…æ‹¬åœ¨å†…ã€‚æ¯”å¦‚ï¼š\n ç§æœ‰æ–¹æ³•è°ƒç”¨ï¼Œéœ€è¦ä¸åŒçš„ç¼“å­˜ ä½†æœ€åˆçš„è™šæ‹Ÿæœºè®¾è®¡é™åˆ¶äº†æ¯ä¸€ç§ç±»å‹çš„è°ƒç”¨ åˆæ ¼çš„æ–¹æ³•è°ƒç”¨($obj.SomeType::method-name()) ä½“é¢ä¼˜åŒ–è°ƒåº¦æ¢å¤çš„æ–¹æ³•  å‡ å¹´å‰ï¼Œæˆ‘å¼€å§‹éƒ¨åˆ†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¼•å…¥äº†ä¸€ç§æœºåˆ¶ï¼Œæˆ‘ç§°ä¹‹ä¸º \u0026ldquo;specializer æ’ä»¶\u0026rdquo;ã€‚ä½†é¦–å…ˆï¼Œä»€ä¹ˆæ˜¯ç‰¹åŒ–å™¨(specializer)ï¼Ÿ\nMoarVM åˆšå¼€å§‹çš„æ—¶å€™ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„å­—èŠ‚ç è§£é‡Šå™¨ã€‚å®ƒåªéœ€è¦è¶³å¤Ÿå¿«çš„é€Ÿåº¦å‡»è´¥ Parrot VM å°±å¯ä»¥è·å¾—ç›¸å½“çš„ä½¿ç”¨é‡ï¼Œæˆ‘è®¤ä¸ºåœ¨ç»§ç»­å®ç°ä¸€äº›æ›´æœ‰è¶£çš„ä¼˜åŒ–ä¹‹å‰ï¼Œè¿™ä¸€ç‚¹éå¸¸é‡è¦ï¼ˆå½“æ—¶æˆ‘ä»¬è¿˜æ²¡æœ‰ä»Šå¤©è¿™æ ·çš„å‘å¸ƒå‰è‡ªåŠ¨æµ‹è¯•åŸºç¡€è®¾æ–½ï¼Œå› æ­¤æ›´å¤šçš„æ˜¯ä¾èµ–äºæ—©æœŸé‡‡ç”¨è€…çš„åé¦ˆï¼‰ã€‚æ€»ä¹‹ï¼Œåœ¨èƒ½å¤Ÿåƒå…¶ä»–åç«¯ä¸€æ ·è¿è¡Œ Raku è¯­è¨€åä¸ä¹…ï¼Œæˆ‘å°±å¼€å§‹äº†åŠ¨æ€ä¼˜åŒ–å™¨çš„å¼€å‘ã€‚å®ƒåœ¨ç¨‹åºè¢«è§£é‡Šæ—¶æ”¶é›†ç±»å‹ç»Ÿè®¡ï¼Œè¯†åˆ«çƒ­ä»£ç ï¼Œå°†å…¶æ”¾å…¥ SSA å½¢å¼ï¼Œä½¿ç”¨ç±»å‹ç»Ÿè®¡æ’å…¥é˜²æŠ¤ï¼Œå°†è¿™äº›ä¸å­—èŠ‚ç çš„é™æ€å±æ€§ä¸€èµ·ä½¿ç”¨æ¥åˆ†æå’Œä¼˜åŒ–ï¼Œå¹¶ä¸ºç›¸å…³å‡½æ•°ç”Ÿæˆä¸“é—¨çš„å­—èŠ‚ç ã€‚è¿™ä¸ªå­—èŠ‚ç å¯ä»¥çœç•¥ç±»å‹æ£€æŸ¥å’Œå„ç§æŸ¥æ‰¾ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ç³»åˆ—çš„å†…éƒ¨æ“ä½œï¼Œåšå‡ºå„ç§å‡è®¾ï¼Œç”±äºä¼˜åŒ–å™¨è¯æ˜äº†ç¨‹åºçš„å±æ€§ï¼Œè¿™äº›å‡è®¾æ˜¯å®‰å…¨çš„ã€‚è¿™è¢«ç§°ä¸ºä¸“é—¨åŒ–çš„å­—èŠ‚ç ï¼Œå› ä¸ºå®ƒçš„å¾ˆå¤šé€šç”¨æ€§ - è¿™å°†ä½¿å®ƒèƒ½å¤Ÿæ­£ç¡®åœ°å·¥ä½œåœ¨æˆ‘ä»¬å¯èƒ½é‡åˆ°çš„æ‰€æœ‰ç±»å‹çš„å€¼ä¸Š - è¢«åˆ é™¤äº†ï¼Œè½¬è€Œå·¥ä½œåœ¨è¿è¡Œæ—¶å®é™…å‘ç”Ÿçš„ç‰¹æ®Šæƒ…å†µä¸‹ã€‚(ä»£ç ï¼Œå°¤å…¶æ˜¯åŠ¨æ€è¯­è¨€ä¸­çš„ä»£ç ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œç†è®ºä¸Šçš„é€šç”¨æ€§è¿œè¿œå¤§äºå®è·µä¸­çš„é€šç”¨æ€§ã€‚)\nè¿™ä¸ªç»„ä»¶ - å†…éƒ¨ç§°ä¸º \u0026ldquo;spesh\u0026rdquo; çš„ specializer - ä¸º Raku ç¨‹åºçš„æ€§èƒ½å¸¦æ¥äº†æ˜¾è‘—çš„è¿›ä¸€æ­¥æå‡ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œå®ƒçš„å¤æ‚ç¨‹åº¦ä¹Ÿåœ¨ä¸æ–­æé«˜ï¼Œå¹¶é‡‡ç”¨äº†å†…è”å’Œå¸¦æœ‰æ ‡é‡æ›¿æ¢çš„è½¬ä¹‰åˆ†æç­‰ä¼˜åŒ–åŠŸèƒ½ã€‚è¿™äº›å¹¶ä¸æ˜¯å®¹æ˜“æ„å»ºçš„ä¸œè¥¿ - ä½†ä¸€æ—¦è¿è¡Œæ—¶æ‹¥æœ‰äº†å®ƒä»¬ï¼Œå®ƒä»¬å°±ä¼šåˆ›é€ å‡ºä»¥å‰ä¸å­˜åœ¨çš„è®¾è®¡å¯èƒ½æ€§ï¼Œå¹¶ä½¿åœ¨æ²¡æœ‰å®ƒä»¬çš„æƒ…å†µä¸‹åšå‡ºçš„å†³å®šçœ‹èµ·æ¥æ˜¯æ¬¡ä¼˜çš„ã€‚\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œé‚£äº›ç‰¹æ®Šæƒ…å†µä¸‹çš„è¯­è¨€ç‰¹å®šæœºåˆ¶ï¼Œåœ¨æ—©æœŸä¸ºäº†è·å¾—ä¸€äº›é€Ÿåº¦è€Œè¢«åµŒå…¥åˆ°è¿è¡Œæ—¶ä¸­ï¼Œåè€Œæˆä¸ºäº†ä¸€ç§è´Ÿæ‹…å’Œç“¶é¢ˆã€‚å®ƒä»¬å…·æœ‰å¤æ‚çš„è¯­ä¹‰ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å¯¹ä¼˜åŒ–å™¨æ¥è¯´è¦ä¹ˆæ˜¯ä¸é€æ˜çš„ï¼ˆæ‰€ä»¥ä¼˜åŒ–å™¨æ— æ³•å¯¹å®ƒä»¬è¿›è¡Œæ¨ç†ï¼Œæ„å‘³ç€ä¼˜åŒ–å—åˆ°æŠ‘åˆ¶ï¼‰ï¼Œè¦ä¹ˆå°±æ˜¯éœ€è¦åœ¨ä¼˜åŒ–å™¨ä¸­è¿›è¡Œç‰¹æ®Šçš„å°è£…ï¼ˆä¸€ç§è´Ÿæ‹…ï¼‰ã€‚\næ‰€ä»¥ï¼Œå›åˆ° specializer æ’ä»¶ã€‚æˆ‘åˆ°äº†ä¸€ä¸ªåœ°æ­¥ï¼Œæˆ‘æƒ³æ‰¿æ‹…åƒ $obj.?meth(\u0026quot;call me maybe\u0026quot;, dispatch)ã€$obj.SomeType::meth()(ç”¨ç±»å¼€å§‹å¯»æ‰¾çš„è°ƒåº¦é™å®š)ï¼Œä»¥åŠè§’è‰²ä¸­çš„ç§æœ‰æ–¹æ³•è°ƒç”¨(ä¸èƒ½é™æ€è§£æ)è¿™æ ·çš„æ€§èƒ½ã€‚åŒæ—¶ï¼Œæˆ‘è¿˜å‡†å¤‡å®ç°ä¸€å®šé‡çš„è½¬ä¹‰åˆ†æï¼Œä½†æ„è¯†åˆ°å®ƒçš„ä½œç”¨å°†éå¸¸æœ‰é™ï¼Œå› ä¸ºèµ‹å€¼åœ¨è™šæ‹Ÿæœºä¸­ä¹Ÿè¢«ç‰¹ä¾‹åŒ–äº†ï¼Œæœ‰ä¸€å¤§å—ä¸é€æ˜çš„ C ä»£ç åœ¨åšçƒ­è·¯å¾„çš„äº‹æƒ…ã€‚\nä½†ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦è®© C ä»£ç æ¥åšé‚£äº›çƒ­è·¯å¾„çš„äº‹æƒ…å‘¢ï¼Ÿå—¯ï¼Œå› ä¸ºè®©æ¯ä¸ªèµ‹å€¼éƒ½è°ƒç”¨ä¸€ä¸ªè™šæ‹Ÿæœºçº§åˆ«çš„å‡½æ•°ï¼Œåšä¸€å †æ£€æŸ¥å’Œé€»è¾‘ï¼ŒèŠ±è´¹å¤ªå¤§äº†ã€‚ä¸ºä»€ä¹ˆè¿™æ ·åšæˆæœ¬å¾ˆé«˜ï¼Ÿå› ä¸ºå‡½æ•°è°ƒç”¨çš„å¼€é”€å’Œè§£é‡Šçš„æˆæœ¬ã€‚è¿™åœ¨ä»¥å‰éƒ½æ˜¯æ­£ç¡®çš„ã€‚ä½†æ˜¯ï¼Œè‹¥å¹²å¹´åçš„å‘å±•ã€‚\n å†…è”è¢«å®ç°äº†ï¼Œå¹¶ä¸”å¯ä»¥æ¶ˆé™¤åšä¸€ä¸ªå‡½æ•°è°ƒç”¨çš„å¼€é”€ã€‚ æˆ‘ä»¬å¯ä»¥ç¼–è¯‘æˆæœºå™¨ä»£ç ï¼Œæ¶ˆé™¤è§£é‡Šå¼€é”€ã€‚ æˆ‘ä»¬å½“æ—¶çš„å¤„å¢ƒæ˜¯ï¼Œæˆ‘ä»¬æ‰‹å¤´æœ‰ specializer çš„ç±»å‹ä¿¡æ¯ï¼Œå¯ä»¥è®©æˆ‘ä»¬æ¶ˆé™¤ C ä»£ç ä¸­çš„åˆ†æ”¯ï¼Œä½†ç”±äºæˆ‘ä»¬è°ƒç”¨çš„åªæ˜¯ä¸€ä¸ªä¸é€æ˜çš„å‡½æ•°ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•æŠ“ä½è¿™ä¸ªæœºä¼š  æˆ‘è§£å†³äº†ä¸Šé¢æåˆ°çš„åˆ†é…é—®é¢˜å’Œè°ƒåº¦é—®é¢˜ï¼Œå¼•å…¥äº†ä¸€ä¸ªæ–°çš„æœºåˆ¶ï¼šspecializer æ’ä»¶ã€‚å®ƒä»¬çš„å·¥ä½œåŸç†å¦‚ä¸‹ã€‚\n å½“æˆ‘ä»¬ç¬¬ä¸€æ¬¡åˆ°è¾¾å­—èŠ‚ç ä¸­çš„ä¸€ä¸ªç»™å®šçš„è°ƒç”¨ç‚¹æ—¶ï¼Œæˆ‘ä»¬å°±ä¼šè¿è¡Œè¿™ä¸ªæ’ä»¶ã€‚å®ƒäº§ç”Ÿäº†ä¸€ä¸ªè¦è°ƒç”¨çš„ä»£ç å¯¹è±¡ï¼Œä»¥åŠä¸€ç»„å®ˆå«ï¼ˆä¸ºäº†ä½¿ç”¨è¯¥ä»£ç å¯¹è±¡ç»“æœè€Œå¿…é¡»æ»¡è¶³çš„æ¡ä»¶ï¼‰ã€‚ ä¸‹ä¸€æ¬¡åˆ°è¾¾æ—¶ï¼Œæˆ‘ä»¬æ£€æŸ¥æ˜¯å¦æ»¡è¶³å®ˆå«ï¼Œå¦‚æœæ»¡è¶³ï¼Œå°±ç”¨ç»“æœ å¦‚æœæ²¡æœ‰ï¼Œæˆ‘ä»¬å†è¿è¡Œä¸€æ¬¡æ’ä»¶ï¼Œå¹¶åœ¨ callsite å¤„å †ç§¯ä¸€ä¸ªé˜²æŠ¤é›†ã€‚ æˆ‘ä»¬ç»Ÿè®¡äº†ä¸€ä¸ªç»™å®šçš„é˜²æŠ¤é›†æˆåŠŸçš„é¢‘ç‡ï¼Œç„¶åå°†å…¶ç”¨äº specializer  ç»å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯å•æ€çš„ï¼Œè¿™æ„å‘³ç€åªäº§ç”Ÿä¸€ç»„å®ˆå«ï¼Œè€Œä¸”ä¹‹åæ€»æ˜¯æˆåŠŸçš„ã€‚å› æ­¤ï¼Œç‰¹æ®ŠåŒ–å™¨å¯ä»¥å°†è¿™äº›å®ˆå«ç¼–è¯‘åˆ°ä¸“é—¨çš„å­—èŠ‚ç ä¸­ï¼Œç„¶åå‡è®¾ç»™å®šçš„ç›®æ ‡è°ƒç”¨è€…å°±æ˜¯å°†è¢«è°ƒç”¨çš„å®ˆå«ã€‚(è¿›ä¸€æ­¥ï¼Œé‡å¤çš„å®ˆå«å¯ä»¥è¢«æ¶ˆé™¤ï¼Œæ‰€ä»¥æŸä¸ªæ’ä»¶å¼•å…¥çš„å®ˆå«å¯èƒ½ä¼šå‡å°‘åˆ°é›¶)ã€‚\nSpecializer æ’ä»¶æ„Ÿè§‰æŒºå¥½çš„ã€‚ä¸€ä¸ªæ–°æœºåˆ¶è§£å†³äº†å¤šä¸ªä¼˜åŒ–å¤´ç–¼çš„é—®é¢˜ã€‚\næ–°çš„ MoarVM è°ƒåº¦æœºåˆ¶æ˜¯å¯¹ä¸€ä¸ªç›¸å½“ç®€å•çš„é—®é¢˜çš„å›ç­”ï¼šå¦‚æœæˆ‘ä»¬æŠŠæ‰€æœ‰ä¸è°ƒåº¦ç›¸å…³çš„ç‰¹ä¾‹æœºåˆ¶å»æ‰ï¼Œè€Œé‡‡ç”¨æœ‰ç‚¹åƒ specializer æ’ä»¶çš„æœºåˆ¶ï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿç”±æ­¤äº§ç”Ÿçš„æœºåˆ¶éœ€è¦æ˜¯ä¸€ä¸ªæ¯” specializer æ’ä»¶æ›´å¼ºå¤§çš„æœºåˆ¶ã€‚è¿›ä¸€æ­¥è¯´ï¼Œæˆ‘å¯ä»¥å­¦ä¹ ç‰¹æ®Šå™¨æ’ä»¶çš„ä¸€äº›ç¼ºç‚¹ã€‚å› æ­¤ï¼Œè™½ç„¶å®ƒä»¬ä¼šåœ¨æ¯”è¾ƒçŸ­çš„å¯¿å‘½åæ¶ˆå¤±ï¼Œä½†æˆ‘è®¤ä¸ºå¯ä»¥è¯´ï¼Œå¦‚æœæ²¡æœ‰è¿™äº›ç»éªŒï¼Œæˆ‘å°±ä¸ä¼šæœ‰èƒ½åŠ›è®¾è®¡æ–°çš„ MoarVM è°ƒåº¦æœºåˆ¶ã€‚\nè°ƒåº¦æ“ä½œå’Œå¼•å¯¼è°ƒåº¦å™¨ æ‰€æœ‰çš„æ–¹æ³•ç¼“å­˜ã€‚æ‰€æœ‰çš„å¤šé‡è°ƒåº¦ç¼“å­˜ã€‚æ‰€æœ‰çš„ specializer æ’ä»¶ã€‚æ‰€æœ‰ç”¨äºåœ¨ä»£ç å¯¹è±¡ä¸­è§£åŒ…å­—èŠ‚ç å¥æŸ„çš„è°ƒç”¨åè®®çš„ä¸œè¥¿ã€‚è¿™ä¸€åˆ‡éƒ½å°†è¢«å–æ¶ˆï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä¸€ä¸ªæ–°çš„è°ƒåº¦æŒ‡ä»¤ã€‚å®ƒçš„åå­—å¾ˆæ— èŠï¼Œå« dispatchã€‚å®ƒçœ‹èµ·æ¥åƒè¿™æ ·ã€‚\ndispatch_o result, \u0026#39;dispatcher-name\u0026#39;, callsite, arg0, arg1, ..., argN è¿™æ„å‘³ç€ï¼š\n ä½¿ç”¨åä¸º dispatcher-name çš„è°ƒåº¦å™¨ã€‚ ç»™å®ƒæŒ‡å®šçš„å‚æ•°å¯„å­˜å™¨ï¼ˆæ‰€å¼•ç”¨çš„è°ƒç”¨ç‚¹è¡¨ç¤ºå‚æ•°çš„æ•°é‡ï¼‰ã€‚ å°†è°ƒåº¦çš„å¯¹è±¡ç»“æœæ”¾å…¥å¯„å­˜å™¨ç»“æœä¸­ã€‚  (æ—ç™½ï¼šè¿™æ„å‘³ç€ä¸€ä¸ªæ–°çš„è°ƒç”¨çº¦å®šï¼Œå³æˆ‘ä»¬ä¸å†å°†å‚æ•°å¤åˆ¶åˆ°å‚æ•°ç¼“å†²åŒºï¼Œè€Œæ˜¯å°†å¯„å­˜å™¨é›†çš„åŸºæ•°å’Œä¸€ä¸ªæŒ‡é’ˆä¼ é€’åˆ°æ‰¾åˆ°å¯„å­˜å™¨å‚æ•°æ˜ å°„çš„å­—èŠ‚ç ä¸­ï¼Œç„¶ååšä¸€ä¸ªæŸ¥è¯¢ registers[map[argument_index]] æ¥è·å–ä¸€ä¸ªå‚æ•°çš„å€¼ã€‚ä»…æ­¤ä¸€ç‚¹ï¼Œæˆ‘ä»¬åœ¨è§£é‡Šæ—¶å°±å¾ˆçœäº‹ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å†éœ€è¦æ¯ä¸ªå‚æ•°ç»•ç€è§£é‡Šå™¨å¾ªç¯äº†ï¼‰ã€‚)\næœ‰äº›å‚æ•°å¯èƒ½æ˜¯æˆ‘ä»¬ä¼ ç»Ÿä¸Šç§°ä¹‹ä¸ºå‚æ•°çš„ä¸œè¥¿ã€‚æœ‰äº›åˆ™æ˜¯é’ˆå¯¹è°ƒåº¦è¿‡ç¨‹æœ¬èº«ã€‚è¿™å…¶å®å¹¶ä¸é‡è¦ - ä½†å¦‚æœæˆ‘ä»¬å®‰æ’å°†åªé’ˆå¯¹è°ƒåº¦çš„å‚æ•°æ”¾åœ¨å‰é¢ï¼ˆä¾‹å¦‚ï¼Œæ–¹æ³•åï¼‰ï¼Œè€Œå°†é’ˆå¯¹è°ƒåº¦ç›®æ ‡çš„å‚æ•°æ”¾åœ¨åé¢ï¼ˆä¾‹å¦‚ï¼Œæ–¹æ³•å‚æ•°ï¼‰ï¼Œåˆ™ä¼šæ›´åŠ ç†æƒ³ã€‚\næ–°çš„ bootstrap æœºåˆ¶æä¾›äº†å°‘é‡çš„å†…ç½®è°ƒåº¦å™¨ï¼Œå®ƒä»¬çš„åå­—ä»¥ \u0026ldquo;boot-\u0026rdquo; å¼€å¤´ã€‚å®ƒä»¬æ˜¯ï¼š\n boot-value - å–ç¬¬ä¸€ä¸ªå‚æ•°å¹¶å°†å…¶ä½œä¸ºç»“æœï¼ˆèº«ä»½å‡½æ•°ï¼Œé™¤äº†ä¸¢å¼ƒä»»ä½•å…¶ä»–å‚æ•°ï¼‰ã€‚ boot-constant - å–ç¬¬ä¸€ä¸ªå‚æ•°å¹¶å°†å…¶ä½œä¸ºç»“æœï¼Œä½†åŒæ—¶ä¹Ÿå°†å…¶è§†ä¸ºä¸€ä¸ªå°†å§‹ç»ˆäº§ç”Ÿçš„å¸¸é‡å€¼ï¼ˆå› æ­¤æ„å‘³ç€ä¼˜åŒ–å™¨å¯ä»¥å°†ä»»ä½•ç”¨äºè®¡ç®—è¯¥å€¼çš„çº¯ä»£ç è§†ä¸ºæ­»å€¼ï¼‰ã€‚ boot-code - å–ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆå¿…é¡»æ˜¯è™šæ‹Ÿæœºå­—èŠ‚ç å¥æŸ„ï¼‰ï¼Œå¹¶è¿è¡Œè¯¥å­—èŠ‚ç ï¼Œå°†å…¶ä½™å‚æ•°ä½œä¸ºå‚æ•°ä¼ ç»™å®ƒï¼›è¯„ä¼°ä¸ºå­—èŠ‚ç çš„è¿”å›å€¼ã€‚ boot-syscall - å°†ç¬¬ä¸€ä¸ªå‚æ•°è§†ä¸ºè™šæ‹Ÿæœºæä¾›çš„å†…ç½®æ“ä½œçš„åç§°ï¼Œç„¶åè°ƒç”¨å®ƒï¼Œå¹¶å°†å…¶ä½™å‚æ•°ä½œä¸ºå…¶å‚æ•°ã€‚ boot-resume - æ¢å¤æ­£åœ¨è¿›è¡Œçš„æœ€ä¸Šå±‚è°ƒåº¦ã€‚  å·®ä¸å¤šå°±æ˜¯è¿™æ ·ã€‚æˆ‘ä»¬æ„å»ºçš„æ¯ä¸€ä¸ªè°ƒåº¦å™¨ï¼Œä¸ºäº†æ•™ç»™è¿è¡Œæ—¶ä¸€äº›å…¶ä»–çš„è°ƒåº¦è¡Œä¸ºï¼Œæœ€ç»ˆéƒ½ä¼šç»ˆæ­¢äºå…¶ä¸­ä¸€ä¸ªã€‚\nåœ¨å¼•å¯¼ç¨‹åºçš„åŸºç¡€ä¸Š æ•™ MoarVM äº†è§£ä¸åŒç§ç±»çš„è°ƒåº¦ï¼Œä¸å¤–ä¹ä½¿ç”¨è°ƒåº¦æœºåˆ¶æœ¬èº«! åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œboot-syscall è¢«ç”¨æ¥æ³¨å†Œä¸€ä¸ªè°ƒåº¦å™¨ï¼Œè®¾ç½®å®ˆå«ï¼Œå¹¶æä¾›ä¸å®ƒä»¬ç›¸åŒ¹é…çš„ç»“æœã€‚\nè¿™é‡Œæ˜¯ä¸€ä¸ªæœ€å°çš„ä¾‹å­ï¼Œå–è‡ª dispatcher æµ‹è¯•å¥—ä»¶ï¼Œå±•ç¤ºäº†ä¸€ä¸ªæä¾›åŒä¸€æ€§åŠŸèƒ½çš„ dispatcher çš„æ ·å­ã€‚\nnqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-register\u0026#39;, \u0026#39;identity\u0026#39;, -\u0026gt; $capture { nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-delegate\u0026#39;, \u0026#39;boot-value\u0026#39;, $capture); }); sub identity($x) { nqp::dispatch(\u0026#39;identity\u0026#39;, $x) } ok(identity(42) == 42, \u0026#39;Can define identity dispatch (1)\u0026#39;); ok(identity(\u0026#39;foo\u0026#39;) eq \u0026#39;foo\u0026#39;, \u0026#39;Can define identity dispatch (2)\u0026#39;); åœ¨ç¬¬ä¸€æ¡è¯­å¥ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨ dispatcher-register MoarVM ç³»ç»Ÿè°ƒç”¨ï¼Œä¼ é€’ä¸€ä¸ª dispatcher çš„åç§°ä»¥åŠä¸€ä¸ªé—­åŒ…ï¼Œæ¯æ¬¡æˆ‘ä»¬éœ€è¦å¤„ç†è°ƒåº¦æ—¶ï¼Œéƒ½ä¼šè°ƒç”¨è¿™ä¸ªé—­åŒ…ï¼ˆæˆ‘å€¾å‘äºå°†å…¶ç§°ä¸º\u0026quot;è°ƒåº¦å›è°ƒ\u0026quot;ï¼‰ã€‚å®ƒæ¥æ”¶ä¸€ä¸ªå•ä¸€çš„å‚æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªå‚æ•°çš„æ•è·ï¼ˆå…¶å®ä¸æ˜¯ Raku çº§åˆ«çš„æ•è·ï¼Œä½†æƒ³æ³• - ä¸€ä¸ªåŒ…å«ä¸€ç»„è°ƒç”¨å‚æ•°çš„å¯¹è±¡ - æ˜¯ä¸€æ ·çš„ï¼‰ã€‚\næ¯ä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„è°ƒåº¦å™¨æœ€ç»ˆéƒ½åº”è¯¥ä½¿ç”¨ dispatcher-delegateï¼Œä»¥ä¾¿ç¡®å®šå¦ä¸€ä¸ªè°ƒåº¦å™¨å°†æ§åˆ¶æƒä¼ é€’ç»™å®ƒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒç«‹å³å§”æ‰˜ç»™ boot-value - è¿™æ„å‘³ç€å®ƒé™¤äº†æ˜¯ boot-value å†…ç½®è°ƒåº¦å™¨çš„åŒ…è£…å™¨å¤–ï¼Œå…¶å®ä»€ä¹ˆéƒ½ä¸æ˜¯ã€‚\nsub identity åŒ…å«ä¸€ä¸ªè°ƒåº¦æ“ä½œçš„é™æ€å‡ºç°ã€‚é‰´äºæˆ‘ä»¬ä¸¤æ¬¡è°ƒç”¨ subï¼Œæˆ‘ä»¬åœ¨è¿è¡Œæ—¶å°†ä¸¤æ¬¡é‡åˆ°è¿™ä¸ª opï¼Œä½†è¿™ä¸¤æ¬¡æ˜¯éå¸¸ä¸åŒçš„ã€‚\nç¬¬ä¸€æ¬¡æ˜¯ \u0026ldquo;è®°å½•\u0026rdquo; é˜¶æ®µã€‚å‚æ•°å½¢æˆä¸€ä¸ªæ•è·ï¼Œå›è°ƒè¿è¡Œï¼Œå›è°ƒåˆå°†å…¶ä¼ ç»™å¼•å¯¼å€¼è°ƒåº¦å™¨ï¼Œäº§ç”Ÿç»“æœã€‚è¿™æ ·å°±å½¢æˆäº†ä¸€ä¸ªæå…¶ç®€å•çš„è°ƒåº¦ç¨‹åºï¼Œå®ƒè¯´ç»“æœåº”è¯¥æ˜¯æ•è·ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚ç”±äºæ²¡æœ‰å®ˆå«ï¼Œæ‰€ä»¥è¿™å°†æ°¸è¿œæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ç»“æœã€‚\nç¬¬äºŒæ¬¡é‡åˆ°è°ƒåº¦æ“ä½œæ—¶ï¼Œå®ƒé‚£é‡Œå·²ç»è®°å½•äº†ä¸€ä¸ªè°ƒåº¦ç¨‹åºï¼Œæ‰€ä»¥æˆ‘ä»¬å¤„äºè¿è¡Œæ¨¡å¼ã€‚åœ¨ MoarVM æºç ä¸­å¼€å¯è°ƒè¯•æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç»“æœçš„è°ƒåº¦ç¨‹åºæ˜¯è¿™æ ·çš„ã€‚\nDispatch program (1 temporaries) Ops: Load argument 0 into temporary 0 Set result object value from temporary 0 ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå°†å‚æ•° 0 è¯»å…¥ä¸€ä¸ªä¸´æ—¶ä½ç½®ï¼Œç„¶åå°†å…¶è®¾ç½®ä¸ºè°ƒåº¦çš„ç»“æœã€‚è¯·æ³¨æ„ï¼Œæ²¡æœ‰æåˆ°æˆ‘ä»¬ç»è¿‡äº†é¢å¤–çš„ä¸€å±‚è°ƒåº¦ï¼Œè¿™äº›åœ¨ç»“æœè°ƒåº¦ç¨‹åºä¸­çš„æˆæœ¬ä¸ºé›¶ã€‚\næ•è·æ“ä½œ å‚æ•°æ•è·æ˜¯ä¸å¯æ”¹å˜çš„ã€‚å„ç§è™šæ‹Ÿæœºç³»ç»Ÿè°ƒç”¨çš„å­˜åœ¨ï¼Œå¯ä»¥é€šè¿‡ä¸€äº›è°ƒæ•´å°†å®ƒä»¬è½¬åŒ–ä¸ºæ–°çš„å‚æ•°æ•è·ï¼Œä¾‹å¦‚åˆ é™¤æˆ–æ’å…¥å‚æ•°ã€‚è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæµ‹è¯•å¥—ä»¶çš„ä¾‹å­ã€‚\nnqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-register\u0026#39;, \u0026#39;drop-first\u0026#39;, -\u0026gt; $capture { my $capture-derived := nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-drop-arg\u0026#39;, $capture, 0); nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-delegate\u0026#39;, \u0026#39;boot-value\u0026#39;, $capture-derived); }); ok(nqp::dispatch(\u0026#39;drop-first\u0026#39;, \u0026#39;first\u0026#39;, \u0026#39;second\u0026#39;) eq \u0026#39;second\u0026#39;, \u0026#39;dispatcher-drop-arg works\u0026#39;); è¿™å°±åœ¨å°†æ•è·ä¼ é€’ç»™å¼•å¯¼å€¼è°ƒåº¦å™¨ä¹‹å‰ä¸¢å¼ƒäº†ç¬¬ä¸€ä¸ªå‚æ•° - æ„å‘³ç€å®ƒå°†è¿”å›ç¬¬äºŒä¸ªå‚æ•°ã€‚å›å¤´çœ‹ä¸€ä¸‹ä¹‹å‰çš„èº«ä»½å‡½æ•°çš„è°ƒåº¦ç¨‹åºã€‚ä½ èƒ½çŒœåˆ°è¿™ä¸ªç¨‹åºä¼šæ˜¯ä»€ä¹ˆæ ·å­å—ï¼Ÿ\nå¥½å§ï¼Œå°±æ˜¯è¿™æ ·ã€‚\nDispatch program (1 temporaries) Ops: Load argument 1 into temporary 0 Set result string value from temporary 0 åŒæ ·ï¼Œè™½ç„¶åœ¨è¿™æ ·ä¸€ä¸ªè°ƒåº¦å™¨çš„è®°å½•é˜¶æ®µï¼Œæˆ‘ä»¬ç¡®å®æ˜¯åˆ›å»ºäº†æ•è·å¯¹è±¡ï¼Œå¹¶åšäº†ä¸€ä¸ªè°ƒåº¦å™¨ä»£ç†ï¼Œä½†ç”±æ­¤äº§ç”Ÿçš„è°ƒåº¦ç¨‹åºè¦ç®€å•å¾—å¤šã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹çš„ä¾‹å­ã€‚\nmy $target := -\u0026gt; $x { $x + 1 } nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-register\u0026#39;, \u0026#39;call-on-target\u0026#39;, -\u0026gt; $capture { my $capture-derived := nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-insert-arg-literal-obj\u0026#39;, $capture, 0, $target); nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-delegate\u0026#39;, \u0026#39;boot-code-constant\u0026#39;, $capture-derived); }); sub cot() { nqp::dispatch(\u0026#39;call-on-target\u0026#39;, 49) } ok(cot() == 50, \u0026#39;dispatcher-insert-arg-literal-obj works at start of capture\u0026#39;); ok(cot() == 50, \u0026#39;dispatcher-insert-arg-literal-obj works at start of capture after link too\u0026#39;); è¿™é‡Œï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå­˜å‚¨åœ¨å˜é‡ $target ä¸­çš„é—­åŒ…ã€‚æˆ‘ä»¬æŠŠå®ƒä½œä¸ºæ•è·çš„ç¬¬ä¸€ä¸ªå‚æ•°æ’å…¥ï¼Œç„¶åå§”æ‰˜ç»™ boot-code-constantï¼Œå®ƒå°†è°ƒç”¨é‚£ä¸ªä»£ç å¯¹è±¡ï¼Œå¹¶æŠŠå…¶ä»–è°ƒåº¦å‚æ•°ä¼ é€’ç»™å®ƒã€‚å†æ¬¡ï¼Œåœ¨è®°å½•é˜¶æ®µï¼Œæˆ‘ä»¬çœŸæ­£è¦åšçš„äº‹æƒ…æ˜¯è¿™æ ·çš„ã€‚\n åˆ›å»ºä¸€ä¸ªæ–°çš„æ•è· åœ¨å¼€å§‹çš„æ—¶å€™æ’å…¥ä¸€ä¸ªä»£ç å¯¹è±¡ã€‚ å§”æ‰˜ç»™å¼•å¯¼ä»£ç å¸¸é‡åˆ†é…å™¨ï¼Œå®ƒ\u0026hellip;ã€‚ \u0026hellip;åœ¨æ²¡æœ‰åŸå§‹å‚æ•°çš„æƒ…å†µä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„æ•è·ï¼Œå¹¶ä½¿ç”¨è¿™äº›å‚æ•°è¿è¡Œå­—èŠ‚ç ã€‚  ç”±æ­¤äº§ç”Ÿçš„è°ƒåº¦ç¨‹åºå‘¢ï¼Ÿå°±æ˜¯è¿™ä¸ª\nDispatch program (1 temporaries) Ops: Load collectable constant at index 0 into temporary 0 Skip first 0 args of incoming capture; callsite from 0 Invoke MVMCode in temporary 0 ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŠ è½½æˆ‘ä»¬è¦è°ƒç”¨çš„å¸¸é‡å­—èŠ‚ç å¥æŸ„ï¼Œè®¾ç½® argsï¼ˆåœ¨æœ¬ä¾‹ä¸­ç­‰äºä¼ å…¥æ•è·çš„å‚æ•°ï¼‰ï¼Œç„¶åç”¨è¿™äº›å‚æ•°è°ƒç”¨å­—èŠ‚ç ã€‚å‚æ•°çš„æ´—ç‰Œï¼Œåˆä¸€æ¬¡æ¶ˆå¤±äº†ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œåªè¦æˆ‘ä»¬åšæœ€ç»ˆçš„å­—èŠ‚ç è°ƒç”¨çš„å‚æ•°æ˜¯åˆå§‹è°ƒåº¦å‚æ•°çš„å°¾å·´ï¼Œå‚æ•°è½¬æ¢å°±ä¼šå˜å¾—ä¸è¿‡æ˜¯ä¸€ä¸ªæŒ‡é’ˆçš„æ·»åŠ ã€‚\nå®ˆå« ç›®å‰çœ‹åˆ°çš„æ‰€æœ‰è°ƒåº¦æ–¹æ¡ˆéƒ½æ˜¯æ— æ¡ä»¶çš„ï¼šä¸€æ—¦åœ¨æŸä¸€é€šè¯åœ°ç‚¹è®°å½•ä¸‹æ¥ï¼Œå°±åº”ä¸€ç›´ä½¿ç”¨ã€‚è¦ä½¿è¿™æ ·çš„æœºåˆ¶å…·æœ‰å®ç”¨æ€§ï¼Œç¼ºå°‘çš„ä¸€å¤§å—å°±æ˜¯å®ˆå«ã€‚å®ˆå«æ–­è¨€äº†ä¸€äº›å±æ€§ï¼Œæ¯”å¦‚å‚æ•°çš„ç±»å‹æˆ–è€…å‚æ•°æ˜¯ç¡®å®šçš„ï¼ˆInt:Dï¼‰è¿˜æ˜¯ä¸ç¡®å®šçš„ï¼ˆInt:Uï¼‰ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªæœ‰ç‚¹é•¿çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå¹¶åœ¨å…¶ä¸­æ”¾ç½®äº†ä¸€äº›è§£é‡Šã€‚\n# A couple of classes for test purposes my class C1 { } my class C2 { } # A counter used to make sure we\u0026#39;re only invokving the dispatch callback as # many times as we expect. my $count := 0; # A type-name dispatcher that maps a type into a constant string value that # is its name. This isn\u0026#39;t terribly useful, but it is a decent small example. nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-register\u0026#39;, \u0026#39;type-name\u0026#39;, -\u0026gt; $capture { # Bump the counter, just for testing purposes. $count++; # Obtain the value of the argument from the capture (using an existing # MoarVM op, though in the future this may go away in place of a syscall) # and then obtain the string typename also. my $arg-val := nqp::captureposarg($capture, 0); my str $name := $arg-val.HOW.name($arg-val); # This outcome is only going to be valid for a particular type. We track # the argument (which gives us an object back that we can use to guard # it) and then add the type guard. my $arg := nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-track-arg\u0026#39;, $capture, 0); nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-guard-type\u0026#39;, $arg); # Finally, insert the type name at the start of the capture and then # delegate to the boot-constant dispatcher. nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-delegate\u0026#39;, \u0026#39;boot-constant\u0026#39;, nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-insert-arg-literal-str\u0026#39;, $capture, 0, $name)); }); # A use of the dispatch for the tests. Put into a sub so there\u0026#39;s a single # static dispatch op, which all dispatch programs will hang off. sub type-name($obj) { nqp::dispatch(\u0026#39;type-name\u0026#39;, $obj) } # Check with the first type, making sure the guard matches when it should # (although this test would pass if the guard were ignored too). ok(type-name(C1) eq \u0026#39;C1\u0026#39;, \u0026#39;Dispatcher setting guard works\u0026#39;); ok($count == 1, \u0026#39;Dispatch callback ran once\u0026#39;); ok(type-name(C1) eq \u0026#39;C1\u0026#39;, \u0026#39;Can use it another time with the same type\u0026#39;); ok($count == 1, \u0026#39;Dispatch callback was not run again\u0026#39;); # Test it with a second type, both record and run modes. This ensures the # guard really is being checked. ok(type-name(C2) eq \u0026#39;C2\u0026#39;, \u0026#39;Can handle polymorphic sites when guard fails\u0026#39;); ok($count == 2, \u0026#39;Dispatch callback ran a second time for new type\u0026#39;); ok(type-name(C2) eq \u0026#39;C2\u0026#39;, \u0026#39;Second call with new type works\u0026#39;); # Check that we can use it with the original type too, and it has stacked # the dispatch programs up at the same callsite. ok(type-name(C1) eq \u0026#39;C1\u0026#39;, \u0026#39;Call with original type still works\u0026#39;); ok($count == 2, \u0026#39;Dispatch callback only ran a total of 2 times\u0026#39;); è¿™ä¸ªæ—¶å€™å°±ä¼šäº§ç”Ÿä¸¤ä¸ªè°ƒåº¦ç¨‹åºï¼Œä¸€ä¸ªæ˜¯ C1ã€‚\nDispatch program (1 temporaries) Ops: Guard arg 0 (type=C1) Load collectable constant at index 1 into temporary 0 Set result string value from temporary 0 å¦ä¸€ä¸ªæ˜¯ C2:\nDispatch program (1 temporaries) Ops: Guard arg 0 (type=C2) Load collectable constant at index 1 into temporary 0 Set result string value from temporary 0 å†ä¸€æ¬¡ï¼Œæ²¡æœ‰æ•è·æ“ä½œã€è·Ÿè¸ªæˆ–è°ƒåº¦å™¨å§”æ‰˜çš„é—ç•™é—®é¢˜ï¼›è°ƒåº¦ç¨‹åºå¯¹ä¸€ä¸ªå‚æ•°è¿›è¡Œç±»å‹é˜²æŠ¤ï¼Œç„¶åäº§ç”Ÿç»“æœå­—ç¬¦ä¸²ã€‚æ•´ä¸ªå¯¹ $arg-val.HOW.name($arg-val) çš„è°ƒç”¨éƒ½è¢«çœç•¥äº†ï¼Œæˆ‘ä»¬å†™çš„è°ƒåº¦ç¨‹åºå°†çŸ¥è¯†è¿›è¡Œäº†ç¼–ç  - ä»¥è™šæ‹Ÿæœºèƒ½å¤Ÿç†è§£çš„æ–¹å¼ - ä¸€ä¸ªç±»å‹çš„åç§°å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸å¯æ”¹å˜çš„ã€‚\nè¿™ä¸ªä¾‹å­æœ‰ç‚¹é€ ä½œï¼Œä½†ç°åœ¨è€ƒè™‘ä¸€ä¸‹ï¼Œæˆ‘ä»¬åè€Œè¦æŸ¥æ‰¾ä¸€ä¸ªæ–¹æ³•ï¼Œå¹¶åœ¨è°ƒç”¨è€…ç±»å‹ä¸Šè¿›è¡Œå®ˆå«ï¼šè¿™å°±æ˜¯ä¸€ä¸ªæ–¹æ³•ç¼“å­˜! å®ˆæŠ¤æ›´å¤šå‚æ•°çš„ç±»å‹ï¼Œæˆ‘ä»¬å°±æœ‰äº†ä¸€ä¸ªå¤šç¼“å­˜ã€‚ä¸¤è€…éƒ½åšï¼Œæˆ‘ä»¬å°±æœ‰äº†ä¸€ä¸ªå¤šæ–¹æ³•ç¼“å­˜ã€‚\nåè€…å¾ˆæœ‰æ„æ€ï¼Œå› ä¸ºæ–¹æ³•è°ƒåº¦å’Œå¤šè°ƒåº¦éƒ½æƒ³å¯¹è°ƒç”¨è€…è¿›è¡Œå®ˆæŠ¤ã€‚äº‹å®ä¸Šï¼Œåœ¨ MoarVM ä¸­ï¼Œä»Šå¤©ä¼šæœ‰ä¸¤ä¸ªè¿™æ ·çš„ç±»å‹æµ‹è¯•ï¼Œç›´åˆ°æˆ‘ä»¬åˆ°äº†ç‰¹æ®ŠåŒ–å™¨åšå·¥ä½œå¹¶æ¶ˆé™¤è¿™äº›é‡å¤çš„å®ˆå«ã€‚ç„¶è€Œï¼Œæ–°çš„è°ƒåº¦å™¨å¹¶æ²¡æœ‰å°†è°ƒåº¦å™¨ - guard-ç±»å‹å½“ä½œä¸€ç§å‘½ä»¤å¼æ“ä½œï¼Œå°†å®ˆå«å†™å…¥ç»“æœè°ƒåº¦ç¨‹åºä¸­ã€‚ç›¸åï¼Œå®ƒå£°æ˜ç›¸å…³çš„å‚æ•°å¿…é¡»è¢«é˜²æŠ¤ã€‚å¦‚æœå…¶ä»–çš„è°ƒåº¦å™¨å·²ç»è¿™æ ·åšäº†ï¼Œé‚£å®ƒå°±æ˜¯å¹‚ç­‰çš„ã€‚ä¸€æ—¦æˆ‘ä»¬å§”æ´¾é€šè¿‡çš„æ‰€æœ‰è°ƒåº¦ç¨‹åºï¼Œåœ¨é€šå¾€æœ€ç»ˆç»“æœçš„è·¯å¾„ä¸Šï¼Œéƒ½æœ‰äº†è‡ªå·±çš„å‘è¨€æƒï¼Œå°±ä¼šå‘å‡ºå®ˆå«ã€‚\næœ‰è¶£çš„æ˜¯ï¼šç‰¹åˆ«ç»†å¿ƒçš„äººä¼šæ³¨æ„åˆ°ï¼Œè°ƒåº¦æœºåˆ¶ä¹Ÿè¢«ç”¨ä½œå®ç°æ–°çš„è°ƒåº¦ç¨‹åºçš„ä¸€éƒ¨åˆ†ï¼Œäº‹å®ä¸Šï¼Œè¿™æœ€ç»ˆä¹Ÿå°†æ„å‘³ç€ç‰¹æ®ŠåŒ–è€…å¯ä»¥å°†è°ƒåº¦ç¨‹åºç‰¹æ®ŠåŒ–ï¼Œè®©å®ƒä»¬ä¹Ÿè¢« JIT ç¼–è¯‘æˆæ›´é«˜æ•ˆçš„ä¸œè¥¿ã€‚æ¯•ç«Ÿï¼Œä» MoarVM çš„è§’åº¦æ¥çœ‹ï¼Œè¿™ä¸€åˆ‡éƒ½åªæ˜¯è¦è¿è¡Œçš„å­—èŠ‚ç ï¼Œåªæ˜¯æœ‰äº›å­—èŠ‚ç æ˜¯å‘Šè¯‰ VM å¦‚ä½•æ›´é«˜æ•ˆåœ°æ‰§è¡Œ Raku ç¨‹åºçš„!\næ¢å¤è°ƒåº¦ å¯æ¢å¤è°ƒåº¦å™¨éœ€è¦åšä¸¤ä»¶äº‹ã€‚\n åœ¨æ³¨å†Œè°ƒåº¦å™¨çš„æ—¶å€™ï¼Œæä¾›ä¸€ä¸ªæ¢å¤å›è°ƒå’Œä¸€ä¸ªè°ƒåº¦å›è°ƒã€‚ åœ¨ dispatch å›è°ƒä¸­ï¼ŒæŒ‡å®šä¸€ä¸ªæ•è·ï¼Œè¿™å°†å½¢æˆæ¢å¤åˆå§‹åŒ–çŠ¶æ€ã€‚  å½“å‘ç”Ÿæ¢å¤æ—¶ï¼Œå°†è°ƒç”¨æ¢å¤å›è°ƒï¼Œå¹¶æä¾›æ¢å¤çš„ä»»ä½•å‚æ•°ã€‚å®ƒè¿˜å¯ä»¥è·å¾—åœ¨ dispatch å›è°ƒä¸­è®¾ç½®çš„ resume åˆå§‹åŒ–çŠ¶æ€ã€‚resume åˆå§‹åŒ–çŠ¶æ€åŒ…å«äº†ç¬¬ä¸€æ¬¡æ¢å¤è°ƒåº¦æ—¶ç»§ç»­è¿›è¡Œè°ƒåº¦æ‰€éœ€è¦çš„ä¸œè¥¿ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ–¹æ³•è°ƒåº¦çš„å·¥ä½œåŸç†ï¼Œçœ‹ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ã€‚æˆ‘ä¹Ÿä¼šåœ¨æ­¤æ—¶ï¼Œåˆ‡æ¢åˆ°çœ‹çœŸæ­£çš„ Rakudo è°ƒåº¦å™¨ï¼Œè€Œä¸æ˜¯ç®€åŒ–çš„æµ‹è¯•ç”¨ä¾‹ã€‚\nRakudo è°ƒåº¦å™¨åˆ©ç”¨æˆæƒã€é‡å¤å®ˆå«å’Œæ•è·æ“ä½œéƒ½æ²¡æœ‰è¿è¡Œæ—¶æˆæœ¬çš„ä¼˜åŠ¿ï¼Œåœ¨ç»“æœè°ƒåº¦ç¨‹åºä¸­ï¼Œè‡³å°‘åœ¨æˆ‘çœ‹æ¥ï¼Œå¾ˆå¥½åœ°å› ç´ äº†ä¸€ä¸ªæœ‰äº›å¤æ‚çš„è°ƒåº¦è¿‡ç¨‹ã€‚æ–¹æ³•è°ƒåº¦æœ‰å¤šä¸ªåˆ‡å…¥ç‚¹ï¼šæ™®é€šæ— èŠçš„ $obj.meth()ï¼Œé™å®šçš„ $obj.Type::meth()ï¼Œä»¥åŠè°ƒç”¨æˆ‘ä¹Ÿè®¸ $obj.?meth()ã€‚è¿™äº›éƒ½æœ‰å…±åŒçš„ resume è¯­ä¹‰ - æˆ–è€…è‡³å°‘ï¼Œåªè¦æˆ‘ä»¬åœ¨ resume åˆå§‹åŒ–çŠ¶æ€ä¸­å§‹ç»ˆæºå¸¦ä¸€ä¸ªèµ·å§‹ç±»å‹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åšæ–¹æ³•è°ƒåº¦çš„å¯¹è±¡çš„ç±»å‹ï¼Œå°±å¯ä»¥ä½¿å®ƒä»¬æˆä¸ºã€‚\nè¿™é‡Œæ˜¯æ™®é€šæ–¹æ³•è°ƒåº¦çš„åˆ‡å…¥ç‚¹ï¼Œå»æ‰äº†æŠ¥å‘Šç¼ºå¤±æ–¹æ³•é”™è¯¯çš„æ— èŠç»†èŠ‚ã€‚\n# A standard method call of the form $obj.meth($arg); also used for the # indirect form $obj.\u0026#34;$name\u0026#34;($arg). It receives the decontainerized invocant, # the method name, and the the args (starting with the invocant including any # container). nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-register\u0026#39;, \u0026#39;raku-meth-call\u0026#39;, -\u0026gt; $capture { # Try to resolve the method call using the MOP. my $obj := nqp::captureposarg($capture, 0); my str $name := nqp::captureposarg_s($capture, 1); my $meth := $obj.HOW.find_method($obj, $name); # Report an error if there is no such method. unless nqp::isconcrete($meth) { !!! \u0026#39;Error reporting logic elided for brevity\u0026#39;; } # Establish a guard on the invocant type and method name (however the name # may well be a literal, in which case this is free). nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-guard-type\u0026#39;, nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-track-arg\u0026#39;, $capture, 0)); nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-guard-literal\u0026#39;, nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-track-arg\u0026#39;, $capture, 1)); # Add the resolved method and delegate to the resolved method dispatcher. my $capture-delegate := nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-insert-arg-literal-obj\u0026#39;, $capture, 0, $meth); nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-delegate\u0026#39;, \u0026#39;raku-meth-call-resolved\u0026#39;, $capture-delegate); }); ç°åœ¨æ˜¯è§£ææ–¹æ³• dispatcherï¼Œä¹Ÿå°±æ˜¯å¤„ç†æ¢å¤çš„åœ°æ–¹ã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æ­£å¸¸çš„ dispatch å›è°ƒï¼ˆæ¢å¤å›è°ƒæ˜¯åŒ…å«çš„ï¼Œä½†æ˜¯æ˜¯ç©ºçš„ï¼Œæˆ‘ç¨åä¼šå±•ç¤ºå®ƒï¼‰ã€‚\n# Resolved method call dispatcher. This is used to call a method, once we have # already resolved it to a callee. Its first arg is the callee, the second and # third are the type and name (used in deferral), and the rest are the args to # the method. nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-register\u0026#39;, \u0026#39;raku-meth-call-resolved\u0026#39;, # Initial dispatch -\u0026gt; $capture { # Save dispatch state for resumption. We don\u0026#39;t need the method that will # be called now, so drop it. my $resume-capture := nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-drop-arg\u0026#39;, $capture, 0); nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-set-resume-init-args\u0026#39;, $resume-capture); # Drop the dispatch start type and name, and delegate to multi-dispatch or # just invoke if it\u0026#39;s single dispatch. my $delegate_capture := nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-drop-arg\u0026#39;, nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-drop-arg\u0026#39;, $capture, 1), 1); my $method := nqp::captureposarg($delegate_capture, 0); if nqp::istype($method, Routine) \u0026amp;\u0026amp; $method.is_dispatcher { nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-delegate\u0026#39;, \u0026#39;raku-multi\u0026#39;, $delegate_capture); } else { nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-delegate\u0026#39;, \u0026#39;raku-invoke\u0026#39;, $delegate_capture); } }, # Resumption -\u0026gt; $capture { ... \u0026#39;Will be shown later\u0026#39;; }); raku-meth-call ä¸­æœ‰ä¸€ä¸ªå¯ä»¥è®ºè¯çš„æ¬ºéª—ï¼šå®ƒå®é™…ä¸Šå¹¶æ²¡æœ‰æ’å…¥è°ƒç”¨è€…çš„ç±»å‹å¯¹è±¡æ¥ä»£æ›¿è°ƒç”¨è€…ã€‚äº‹å®è¯æ˜ï¼Œè¿™å¹¶ä¸é‡è¦ã€‚å¦åˆ™ï¼Œæˆ‘è®¤ä¸ºæ³¨é‡Šï¼ˆåœ¨çœŸæ­£çš„å®ç°ä¸­ä¹Ÿå¯ä»¥æ‰¾åˆ°ï¼‰å¾ˆå¥½åœ°è¯´æ˜äº†è¿™ä¸ªé—®é¢˜ã€‚\næœ‰ä¸€ä¸ªé‡è¦çš„ç‚¹å¯èƒ½å¹¶ä¸æ¸…æ¥š - ä½†éµå¾ªäº†ä¸€ä¸ªé‡å¤çš„ä¸»é¢˜ - é‚£å°±æ˜¯æ¢å¤åˆå§‹åŒ–çŠ¶æ€çš„è®¾ç½®ä¹Ÿæ›´å¤šçš„æ˜¯ä¸€ç§å£°æ˜å¼è€Œä¸æ˜¯å‘½ä»¤å¼çš„ä¸œè¥¿ï¼šåœ¨è°ƒåº¦çš„æ—¶å€™å¹¶æ²¡æœ‰è¿è¡Œæ—¶æˆæœ¬ï¼Œè€Œæ˜¯æˆ‘ä»¬åœ¨å‘¨å›´ä¿ç•™äº†è¶³å¤Ÿçš„ä¿¡æ¯ï¼Œä»¥ä¾¿èƒ½å¤Ÿåœ¨æˆ‘ä»¬éœ€è¦çš„æ—¶å€™é‡å»ºæ¢å¤åˆå§‹åŒ–çŠ¶æ€ã€‚äº‹å®ä¸Šï¼Œå½“æˆ‘ä»¬å¤„äºæ¢å¤çš„è¿è¡Œé˜¶æ®µæ—¶ï¼Œæˆ‘ä»¬ç”šè‡³ä¸éœ€è¦åœ¨åˆ›å»ºæ•è·å¯¹è±¡çš„æ„ä¹‰ä¸Šé‡å»ºå®ƒï¼‰ã€‚\nç°åœ¨è¯´è¯´å¤ç›˜ã€‚æˆ‘å°†ä»‹ç»ä¸€ä¸ªä¸¥é‡ç®€åŒ–çš„ç‰ˆæœ¬ï¼Œå®ƒåªå¤„ç† callsame è¯­ä¹‰ï¼ˆå®Œæ•´çš„ä¸œè¥¿ä¹Ÿè¦å¤„ç† lastcall å’Œ nextcallee è¿™æ ·çš„ä¹è¶£ï¼‰ã€‚resume åˆå§‹åŒ–çŠ¶æ€çš„å­˜åœ¨æ˜¯ä¸ºäº†ç»™ resumption è¿‡ç¨‹æ’­ç§ã€‚ä¸€æ—¦æˆ‘ä»¬çŸ¥é“æˆ‘ä»¬å®é™…ä¸Šç¡®å®è¦å¤„ç†æ¢å¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥åšä¸€äº›äº‹æƒ…ï¼Œæ¯”å¦‚è®¡ç®—æˆ‘ä»¬æƒ³è¦èµ°è¿‡çš„ç»§æ‰¿å›¾ä¸­çš„å…¨éƒ¨æ–¹æ³•åˆ—è¡¨ã€‚æ¯ä¸ªå¯æ¢å¤çš„è°ƒåº¦å™¨åœ¨è°ƒç”¨æ ˆä¸Šå¾—åˆ°ä¸€ä¸ªå•ä¸€çš„å­˜å‚¨æ§½ï¼Œå®ƒå¯ä»¥ç”¨äºå®ƒçš„çŠ¶æ€ã€‚å®ƒå¯ä»¥åœ¨æ¢å¤çš„ç¬¬ä¸€æ­¥ä¸­åˆå§‹åŒ–è¿™ä¸ªï¼Œç„¶ååœ¨æˆ‘ä»¬èµ°çš„æ—¶å€™æ›´æ–°å®ƒã€‚æˆ–è€…æ›´å‡†ç¡®çš„è¯´ï¼Œå®ƒå¯ä»¥è®¾ç½®ä¸€ä¸ªè°ƒåº¦ç¨‹åºï¼Œåœ¨è¿è¡Œæ—¶å°±ä¼šè¿™æ ·åšã€‚\nå¯¹äºæˆ‘ä»¬å°†è¦èµ°è¿‡çš„å€™é€‰é“¾æ¥è¯´ï¼Œé“¾æ¥åˆ—è¡¨åŸæ¥æ˜¯ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„æ•°æ®ç»“æ„ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è·Ÿè¸ªå½“å‰èŠ‚ç‚¹æ¥å®Œæˆé“¾æ¥åˆ—è¡¨çš„å·¥ä½œï¼Œä¹Ÿå°±æ˜¯è¯´åªéœ€è¦æœ‰ä¸€ä¸ªä¸œè¥¿å‘ç”Ÿçªå˜ï¼Œä¹Ÿå°±æ˜¯å½“å‰è°ƒåº¦çš„çŠ¶æ€ã€‚è°ƒåº¦ç¨‹åºæœºåˆ¶è¿˜æä¾›äº†ä¸€ç§ä»å¯¹è±¡ä¸­è¯»å–å±æ€§çš„æ–¹æ³•ï¼Œè¿™å°±è¶³ä»¥å°†éå†é“¾æ¥åˆ—è¡¨è¡¨è¾¾åˆ°è°ƒåº¦ç¨‹åºä¸­ã€‚è¿™ä¹Ÿæ„å‘³ç€é›¶åˆ†é…ã€‚\næ‰€ä»¥ï¼Œä¸å¤šè¯´äº†ï¼Œä¸‹é¢æ˜¯é“¾æ¥åˆ—è¡¨ï¼ˆåœ¨ NQP è¿™ä¸ªå—é™çš„ Raku å­é›†ä¸­ï¼Œç›¸å½“ä¸å¦‚åœ¨å®Œæ•´çš„ Raku ä¸­æ¼‚äº®ï¼‰ã€‚\n# A linked list is used to model the state of a dispatch that is deferring # through a set of methods, multi candidates, or wrappers. The Exhausted class # is used as a sentinel for the end of the chain. The current state of the # dispatch points into the linked list at the appropriate point; the chain # itself is immutable, and shared over (runtime) dispatches. my class DeferralChain { has $!code; has $!next; method new($code, $next) { my $obj := nqp::create(self); nqp::bindattr($obj, DeferralChain, \u0026#39;$!code\u0026#39;, $code); nqp::bindattr($obj, DeferralChain, \u0026#39;$!next\u0026#39;, $next); $obj } method code() { $!code } method next() { $!next } }; my class Exhausted {}; æœ€åæ˜¯æ¢å¤å¤„ç†ã€‚\nnqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-register\u0026#39;, \u0026#39;raku-meth-call-resolved\u0026#39;, # Initial dispatch -\u0026gt; $capture { ... \u0026#39;Presented earlier; }, # Resumption. The resume init capture\u0026#39;s first two arguments are the type #that we initially did a method dispatch against and the method name #respectively. -\u0026gt; $capture{ # Work out the next method to call, if any. This depends on if we have # an existing dispatch state (that is, a method deferral is already in # progress). my $init := nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-get-resume-init-args\u0026#39;); my $state := nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-get-resume-state\u0026#39;); my $next_method; if nqp::isnull($state) { # No state, so just starting the resumption. Guard on the # invocant type and name. my $track_start_type := nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-track-arg\u0026#39;, $init, 0); nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-guard-type\u0026#39;, $track_start_type); my $track_name := nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-track-arg\u0026#39;, $init, 1); nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-guard-literal\u0026#39;, $track_name); # Also guard on there being no dispatch state. my $track_state := nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-track-resume-state\u0026#39;); nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-guard-literal\u0026#39;, $track_state); # Build up the list of methods to defer through. my $start_type := nqp::captureposarg($init, 0); my str $name := nqp::captureposarg_s($init, 1); my @mro := nqp::can($start_type.HOW, \u0026#39;mro_unhidden\u0026#39;) ?? $start_type.HOW.mro_unhidden($start_type) !! $start_type.HOW.mro($start_type); my @methods; for @mro { my %mt := nqp::hllize($_.HOW.method_table($_)); if nqp::existskey(%mt, $name) { @methods.push(%mt{$name}); } } # If there\u0026#39;s nothing to defer to, we\u0026#39;ll evaluate to Nil (just don\u0026#39;t set # the next method, and it happens below). if nqp::elems(@methods) \u0026gt;= 2 { # We can defer. Populate next method. @methods.shift; # Discard the first one, which we initially called $next_method := @methods.shift; # The immediate next one # Build chain of further methods and set it as the state. my $chain := Exhausted; while @methods { $chain := DeferralChain.new(@methods.pop, $chain); } nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-set-resume-state-literal\u0026#39;, $chain); } } elsif !nqp::istype($state, Exhausted) { # Already working through a chain of method deferrals. Obtain # the tracking object for the dispatch state, and guard against # the next code object to run. my $track_state := nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-track-resume-state\u0026#39;); my $track_method := nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-track-attr\u0026#39;, $track_state, DeferralChain, \u0026#39;$!code\u0026#39;); nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-guard-literal\u0026#39;, $track_method); # Update dispatch state to point to next method. my $track_next := nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-track-attr\u0026#39;, $track_state, DeferralChain, \u0026#39;$!next\u0026#39;); nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-set-resume-state\u0026#39;, $track_next); # Set next method, which we shall defer to. $next_method := $state.code; } else { # Dispatch already exhausted; guard on that and fall through to returning # Nil. my $track_state := nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-track-resume-state\u0026#39;); nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-guard-literal\u0026#39;, $track_state); } # If we found a next method... if nqp::isconcrete($next_method) { # Call with same (that is, original) arguments. Invoke with those. # We drop the first two arguments (which are only there for the # resumption), add the code object to invoke, and then leave it # to the invoke or multi dispatcher. my $just_args := nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-drop-arg\u0026#39;, nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-drop-arg\u0026#39;, $init, 0), 0); my $delegate_capture := nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-insert-arg-literal-obj\u0026#39;, $just_args, 0, $next_method); if nqp::istype($next_method, Routine) \u0026amp;\u0026amp; $next_method.is_dispatcher { nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-delegate\u0026#39;, \u0026#39;raku-multi\u0026#39;, $delegate_capture); } else { nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-delegate\u0026#39;, \u0026#39;raku-invoke\u0026#39;, $delegate_capture); } } else { # No method, so evaluate to Nil (boot-constant disregards all but # the first argument). nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-delegate\u0026#39;, \u0026#39;boot-constant\u0026#39;, nqp::dispatch(\u0026#39;boot-syscall\u0026#39;, \u0026#39;dispatcher-insert-arg-literal-obj\u0026#39;, $capture, 0, Nil)); } }); è¿™æ˜¯ç›¸å½“å¤šçš„å†…å®¹ï¼Œä¹Ÿæ˜¯ç›¸å½“å¤šçš„ä»£ç ã€‚ä½†è¯·è®°ä½ï¼Œè¿™åªæ˜¯è¿è¡Œåœ¨è°ƒåº¦æ¢å¤çš„è®°å½•é˜¶æ®µã€‚å®ƒè¿˜ä¼šåœ¨ callsame çš„ callsite äº§ç”Ÿä¸€ä¸ªè°ƒåº¦ç¨‹åºï¼Œå¹¶å¸¦æœ‰é€šå¸¸çš„å®ˆå«å’Œç»“æœã€‚éšå¼å®ˆå«æ˜¯ä¸ºæˆ‘ä»¬åœ¨è¯¥ç‚¹æ¢å¤çš„è°ƒåº¦ç¨‹åºåˆ›å»ºçš„ã€‚åœ¨æœ€å¸¸è§çš„æƒ…å†µä¸‹ï¼Œè¿™æœ€ç»ˆå°†æ˜¯å•å½¢æˆ–åŒå½¢çš„ï¼Œå°½ç®¡æ¶‰åŠå¤šä¸ªè°ƒåº¦æˆ–æ–¹æ³•è°ƒåº¦çš„åµŒå¥—çš„æƒ…å†µå¯èƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ›´æœ‰å½¢æ€çš„ callsiteã€‚\næˆ‘é€‰å–çš„è®¾è®¡è¿«ä½¿ resume å›è°ƒå¤„ç†ä¸¤ç§æƒ…å†µï¼šç¬¬ä¸€æ¬¡å¤ç”¨å’Œåä¸€æ¬¡å¤ç”¨ã€‚è¿™åœ¨å‡ ä¸ªæ–¹é¢éƒ½ä¸ç†æƒ³ã€‚\nè¿™å¯¹é‚£äº›ç¼–å†™è°ƒåº¦ç®€å†å›è°ƒçš„äººæ¥è¯´æœ‰ç‚¹ä¸æ–¹ä¾¿ã€‚ç„¶è€Œï¼Œè¿™åˆä¸æ˜¯ç‰¹åˆ«å¸¸è§çš„æ´»åŠ¨!\nè¿™ç§å·®å¼‚å¯¼è‡´ä¸¤ä¸ªè°ƒåº¦ç¨‹åºå †ç§¯åœ¨ä¸€ä¸ªè°ƒç”¨ç‚¹ï¼Œè€Œåœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œè¿™ä¸ªè°ƒç”¨ç‚¹å¯èƒ½åªå¾—åˆ°ä¸€ä¸ª åªæœ‰å…¶ä¸­ç¬¬äºŒé¡¹çœŸæ­£é‡è¦ã€‚ä¹‹æ‰€ä»¥ä¸ç»Ÿä¸€ï¼Œæ˜¯ä¸ºäº†ç¡®ä¿ç»å¤§å¤šæ•°ä»æœªæ¢å¤è°ƒåº¦çš„ç”µè¯ï¼Œä¸ä¼šå› å…¶æœ€ç»ˆä»æœªä½¿ç”¨çš„åŠŸèƒ½è€Œäº§ç”Ÿæ¯æ¬¡è°ƒåº¦çš„è´¹ç”¨ã€‚å¦‚æœç»“æœæ˜¯ä½¿ç”¨è¯¥åŠŸèƒ½çš„äººå¤šèŠ±äº†ä¸€ç‚¹æˆæœ¬ï¼Œé‚£å°±è¿™æ ·å§ã€‚äº‹å®ä¸Šï¼Œæ—©æœŸçš„åŸºå‡†æµ‹è¯•æ˜¾ç¤ºï¼Œä½¿ç”¨æ–°è°ƒåº¦å™¨çš„ callsame ä¸ wrap å’Œæ–¹æ³•è°ƒç”¨ä¼¼ä¹æ¯”å½“å‰ Rakudo ä¸­çš„é€Ÿåº¦å¿«äº† 10 å€ï¼Œè¿™è¿˜æ²¡ç­‰ä¸“é—¨äººå‘˜å¯¹å®ƒæœ‰è¶³å¤Ÿçš„äº†è§£ï¼Œå°±å·²ç»è¿›ä¸€æ­¥æ”¹è¿›äº†!\nç›®å‰æ‰€åšçš„äº‹æƒ… æˆ‘ä¸Šé¢è®¨è®ºçš„æ‰€æœ‰å†…å®¹éƒ½å·²ç»å®ç°äº†ï¼Œåªæ˜¯æˆ‘å¯èƒ½åœ¨æŸä¸ªåœ°æ–¹ç»™äººçš„å°è±¡æ˜¯ï¼Œä½¿ç”¨æ–°çš„ dispatcher å·²ç»å®Œå…¨å®ç°äº†å¤šé‡è°ƒåº¦ï¼Œè€Œç°åœ¨è¿˜ä¸æ˜¯è¿™æ ·ï¼ˆæ²¡æœ‰å¤„ç† where å­å¥ï¼Œä¹Ÿä¸æ”¯æŒè°ƒåº¦æ¢å¤ï¼‰ã€‚\nä»Šåçš„æ­¥éª¤ ä¸‹ä¸€æ­¥æ˜¾ç„¶æ˜¯è¦å®Œå…¨å®ç°å¤šè°ƒåº¦çš„ç¼ºå¤±éƒ¨åˆ†ã€‚å¦ä¸€ä¸ªç¼ºå¤±çš„è¯­ä¹‰æ˜¯å¯¹ callwith å’Œ nextwith çš„æ”¯æŒï¼Œå½“æˆ‘ä»¬å¸Œæœ›æ”¹å˜ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå€™é€‰äººæ—¶ä½¿ç”¨çš„å‚æ•°ã€‚æŠ›å¼€å…¶ä»–ä¸€äº›å°é—®é¢˜ä¸è°ˆï¼Œç†è®ºä¸Šæ¥è¯´ï¼Œè¿™è‡³å°‘å¯ä»¥è®©æ‰€æœ‰çš„ Raku è°ƒåº¦è¯­ä¹‰å¾—åˆ°æ”¯æŒã€‚\nç›®å‰ï¼Œæ‰€æœ‰çš„æ ‡å‡†æ–¹æ³•è°ƒç”¨ï¼ˆ$obj.meth()ï¼‰å’Œå…¶ä»–è°ƒç”¨ï¼ˆfoo()å’Œ$foo()ï¼‰éƒ½ä¼šé€šè¿‡ç°æœ‰çš„è°ƒåº¦æœºåˆ¶ï¼Œè€Œä¸æ˜¯æ–°çš„è°ƒåº¦å™¨ã€‚è¿™äº›ä¹Ÿéœ€è¦è¿ç§»åˆ°æ–°çš„è°ƒåº¦å™¨ä¸Šï¼Œè€Œä¸”ä»»ä½•å‘ç°çš„é”™è¯¯éƒ½éœ€è¦ä¿®å¤ã€‚è¿™å°†ä½¿äº‹æƒ…è¾¾åˆ°æ–°è°ƒåº¦å™¨åœ¨è¯­ä¹‰ä¸Šå·²ç»å‡†å¤‡å¥½çš„ç¨‹åº¦ã€‚\nä¹‹åæ˜¯æ€§èƒ½å·¥ä½œï¼šç¡®ä¿ä¸“ç”¨å™¨èƒ½å¤Ÿå¤„ç†è°ƒåº¦ç¨‹åºçš„é˜²æŠ¤å’Œç»“æœã€‚æœ€åˆçš„ç›®æ ‡æ˜¯ï¼Œè®©å¸¸è§è°ƒç”¨å½¢å¼çš„ç¨³æ€æ€§èƒ½è‡³å°‘ä¸å½“å‰ä¹é“ä¸»åˆ†æ”¯ä¸­çš„æ€§èƒ½ç›¸åŒã€‚å·²ç»å¾ˆæ¸…æ¥šäº†ï¼Œå¯¹äºä¸€äº›åˆ°ç›®å‰ä¸ºæ­¢è¿˜å¾ˆå†°å†·çš„ä¸œè¥¿æ¥è¯´ï¼Œä¼šæœ‰ä¸€äº›å¤§çš„èƒœåˆ©ï¼Œä½†å®ƒä¸åº”è¯¥ä»¥æœ€å¸¸è§çš„è°ƒåº¦ç§ç±»çš„é€€æ­¥ä¸ºä»£ä»·ï¼Œå› ä¸ºè¿™äº›è°ƒåº¦ç§ç±»ä¹‹å‰å·²ç»å¾—åˆ°äº†å¤§é‡çš„ä¼˜åŒ–åŠªåŠ›ã€‚\næ­¤å¤–ï¼ŒNQP - ä¹é“ç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶å†…è„çš„å…¶ä»–ä½å†™çš„ä¹çš„é™åˆ¶å½¢å¼ - ä¹Ÿéœ€è¦è¿ç§»åˆ°ä½¿ç”¨æ–°çš„è°ƒåº¦å™¨ã€‚åªæœ‰åšåˆ°è¿™ä¸€ç‚¹ï¼Œæ‰æœ‰å¯èƒ½ä» MoarVM ä¸­æ‰¯å‡ºå½“å‰çš„æ–¹æ³•ç¼“å­˜ã€å¤šè°ƒåº¦ç¼“å­˜ç­‰ã€‚\nä¸€ä¸ªæ‚¬è€Œæœªå†³çš„é—®é¢˜æ˜¯ï¼Œå¦‚ä½•å¤„ç† MoarVM ä»¥å¤–çš„åç«¯ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæ–°çš„è°ƒåº¦æœºåˆ¶å°†è¢«ç§»æ¤åˆ°è¿™äº›åœ°æ–¹ã€‚ç›¸å½“å¤šçš„å†…å®¹åº”è¯¥å¯ä»¥ç”¨ JVM çš„ invokedynamic æ¥è¡¨è¾¾ï¼ˆè€Œè¿™ä¸€åˆ‡å¯èƒ½ä¼šåœ¨åŸºäº Truffle çš„ Raku å®ç°ä¸­å‘æŒ¥å¾—ç›¸å½“å¥½ï¼Œå°½ç®¡æˆ‘ä¸ç¡®å®šç›®å‰æ˜¯å¦æœ‰è¿™æ–¹é¢çš„ç§¯æåŠªåŠ›ï¼‰ã€‚\næœªæ¥çš„æœºä¼š è™½ç„¶æˆ‘ç›®å‰çš„é‡ç‚¹æ˜¯å‘å¸ƒä¸€ä¸ªä½¿ç”¨æ–°è°ƒåº¦æœºåˆ¶çš„ Rakudo å’Œ MoarVM ç‰ˆæœ¬ï¼Œä½†è¿™ä¸ä¼šæ˜¯æ—…ç¨‹çš„ç»ˆç‚¹ã€‚ä¸€äº›çœ¼å‰çš„æƒ³æ³•ã€‚\n å¯¹è§’è‰²çš„æ–¹æ³•è°ƒç”¨éœ€è¦æŠŠè§’è‰²æ‰“å…¥ä¸€ä¸ªç±»ä¸­ï¼Œ æ‰€ä»¥æ–¹æ³•æŸ¥æ‰¾ä¼šè¿”å›ä¸€ä¸ªé—­åŒ…æ¥å®Œæˆè¿™ä¸ªä»»åŠ¡å¹¶æ›¿æ¢è°ƒç”¨è€…ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„é—´æ¥æ€§ï¼›æ–°çš„è°ƒåº¦è€…å¯ä»¥è·å¾— punï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªè°ƒåº¦ç¨‹åºï¼Œç”¨ punn åŒ–çš„ç±»ç±»å‹å¯¹è±¡æ›¿æ¢è§’è‰²ç±»å‹å¯¹è±¡ï¼Œè¿™å°†ä½¿æ¯æ¬¡è°ƒç”¨çš„æˆæœ¬å¤§å¤§é™ä½ã€‚ æˆ‘æœŸæœ›ä½¿ç”¨æ–°çš„ dispatcher å¯ä»¥ä½¿å¥æŸ„ï¼ˆdlegatedï¼‰å’Œ fallbackï¼ˆå¤„ç†ç¼ºå¤±çš„æ–¹æ³•è°ƒç”¨ï¼‰æœºåˆ¶éƒ½èƒ½æœ‰æ›´å¥½çš„è¡¨ç° å½“å‰çš„ assuming - ç”¨äºä¸ºä¾‹ç¨‹è®¨ä»·è¿˜ä»·æˆ–å…¶ä»–é¦–è¦å‚æ•° - çš„å®ç°å¹¶ä¸ç†æƒ³ï¼Œåˆ©ç”¨æ–°è°ƒåº¦å™¨çš„å‚æ•°é‡å†™èƒ½åŠ›çš„å®ç°å¯èƒ½ä¼šæœ‰æ›´å¥½çš„è¡¨ç°ã€‚ åœ¨æ–°çš„è°ƒåº¦æœºåˆ¶çš„å¸®åŠ©ä¸‹ï¼Œä¸€äº›æ–°çš„è¯­è¨€åŠŸèƒ½ä¹Ÿå¯èƒ½ä»¥é«˜æ•ˆçš„æ–¹å¼æä¾›ã€‚ä¾‹å¦‚ï¼Œç›®å‰æ²¡æœ‰ä¸€ç§å¯é çš„æ–¹å¼æ¥å°è¯•è°ƒç”¨ä¸€æ®µä»£ç ï¼Œå¦‚æœç­¾åç»‘å®šäº†å°±è¿è¡Œå®ƒï¼Œå¦‚æœæ²¡æœ‰ç»‘å®šå°±åšå…¶ä»–äº‹æƒ…ã€‚ç›¸åï¼Œåƒ Cro è·¯ç”±å™¨è¿™æ ·çš„ä¸œè¥¿ï¼Œå¿…é¡»å…ˆåšç­¾åçš„è¯•ç»‘å®šï¼Œç„¶åå†åšè°ƒç”¨ï¼Œè¿™ä½¿å¾—è·¯ç”±çš„æˆæœ¬ç›¸å½“é«˜ã€‚è¿˜æœ‰ä¸€ä¸ªå»ºè®®å·²ä¹…çš„æƒ³æ³•ï¼Œå°±æ˜¯é€šè¿‡ç­¾åä¸ when æ„é€ æä¾›æ¨¡å¼åŒ¹é… (ä¾‹å¦‚ï¼Œwhen * -\u0026gt; ($x) {}; when * -\u0026gt; ($x, *@tail) { })ï¼Œè¿™å’Œéœ€æ±‚å·®ä¸å¤šï¼Œåªæ˜¯åœ¨ä¸€ä¸ªä¸å¤ªåŠ¨æ€çš„ç¯å¢ƒä¸‹ã€‚  æœ€å\u0026hellip; åœ¨æ–°çš„è°ƒåº¦æœºåˆ¶ä¸Šçš„å·¥ä½œæ¯”æˆ‘æœ€åˆé¢„æœŸçš„å†ç¨‹è¦é•¿ã€‚è®¾è®¡çš„æ¢å¤éƒ¨åˆ†ç‰¹åˆ«å…·æœ‰æŒ‘æˆ˜æ€§ï¼Œè€Œä¸”è¿˜æœ‰ä¸€äº›é‡è¦çš„ç»†èŠ‚éœ€è¦å¤„ç†ã€‚ä¸€è·¯èµ°æ¥ï¼Œå¤§æ¦‚æœ‰å››ç§æ½œåœ¨çš„æ–¹æ³•è¢«æŠ›å¼ƒäº†ï¼ˆè™½ç„¶å…¶ä¸­çš„å…ƒç´ éƒ½å½±å“äº†æˆ‘åœ¨è¿™ç¯‡æ–‡ç« ä¸­æè¿°çš„å†…å®¹ï¼‰ã€‚èƒ½åšæŒä¸‹æ¥çš„æŠ½è±¡çœŸçš„éå¸¸éå¸¸éš¾ã€‚\næˆ‘æœ€ç»ˆä¹Ÿä¸å¾—ä¸ä»æ ¹æœ¬ä¸Šç¦»å¼€å‡ ä¸ªæœˆåš Raku å·¥ä½œï¼Œåœ¨å…¶ä»–ä¸€äº›å·¥ä½œä¸­æ„Ÿè§‰æœ‰ç‚¹è¢«å‹å®äº†ï¼Œå¹¶ä¸”ä¸€ç›´åœ¨ä¸åŒæ ·é‡è¦çš„ RakuAST é¡¹ç›®ï¼ˆå®ƒå°†å› ä¸ºèƒ½å¤Ÿæ‰¿æ‹…æ–°çš„è°ƒåº¦å™¨çš„å­˜åœ¨è€Œè¢«ç®€åŒ–ï¼Œå¹¶ä¸”è¿˜ä¸ºæˆ‘æä¾›äº†ä¸€ç³»åˆ—æ›´æŸ”å’Œçš„ Raku é»‘å®¢ä»»åŠ¡ï¼Œè€Œè°ƒåº¦å™¨çš„å·¥ä½œæä¾›äº†å¾ˆå°‘çš„è½»æ¾é€‰æ‹©ï¼‰ã€‚\né‰´äºè¿™äº›ï¼Œæˆ‘å¾ˆé«˜å…´ç»ˆäºçœ‹åˆ°äº†éš§é“å°½å¤´çš„å…‰äº®ã€‚å‰©ä¸‹çš„å·¥ä½œæ˜¯æ•°ä¸èƒœæ•°çš„ï¼Œè€Œæˆ‘ä»¬ä½¿ç”¨æ–°çš„è°ƒåº¦å™¨å‘å¸ƒ Rakudo å’Œ MoarVM çš„é‚£ä¸€å¤©ï¼Œæ„Ÿè§‰è¿˜éœ€è¦å‡ ä¸ªæœˆçš„æ—¶é—´ï¼ˆæˆ‘å¸Œæœ›å†™ä¸‹è¿™å¥è¯ä¸æ˜¯åœ¨è¯±æƒ‘å‘½è¿ï¼ï¼‰ã€‚\næ–°çš„è°ƒåº¦å™¨å¯èƒ½æ˜¯ MoarVM è‡ªæˆ‘åˆ›å»ºä»¥æ¥æœ€é‡è¦çš„å˜åŒ–ï¼Œå› ä¸ºå®ƒçœ‹åˆ°æˆ‘ä»¬åˆ é™¤äº†ä¸€å †ä»ä¸€å¼€å§‹å°±å­˜åœ¨çš„ä¸œè¥¿ã€‚RakuAST ä¹Ÿå°†ä¸º Rakudo ç¼–è¯‘å™¨å¸¦æ¥åå¹´æ¥æœ€å¤§çš„æ¶æ„å˜åŒ–ã€‚ä¸¤è€…éƒ½æ˜¯ä¸€ä¸ªæœºä¼šï¼Œå°†å¤šå¹´æ¥å­¦ä¹ çš„ä¸œè¥¿ç¡¬ç”Ÿç”Ÿåœ°æŠ˜åˆåˆ°è¿è¡Œæ—¶å’Œç¼–è¯‘å™¨ä¸­ã€‚æˆ‘å¸Œæœ›å†è¿‡åå¹´ï¼Œå½“æˆ‘å›é¡¾è¿™ä¸€åˆ‡çš„æ—¶å€™ï¼Œè‡³å°‘ä¼šè§‰å¾—è‡ªå·±è¿™æ¬¡çŠ¯äº†æ›´å¤šæœ‰è¶£çš„é”™è¯¯ã€‚\nåŸæ–‡é“¾æ¥: https://6guts.wordpress.com/2021/03/15/towards-a-new-general-dispatch-mechanism-in-moarvm/\n","permalink":"https://ohmyweekly.github.io/notes/2021-03-15-towards-a-new-general-dispatch-mechanism-in-moarvm/","tags":["Raku"],"title":"äº‰å–åœ¨ MoarVM ä¸­å»ºç«‹ä¸€ä¸ªæ–°çš„æ€»è°ƒåº¦æœºåˆ¶"},{"categories":["Flink"],"contents":"PimDaniel æå‡ºäº†ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜ã€‚\næˆ‘å¦‚ä½•åœ¨åŒ¹é…æ—¶æµ‹è¯• match is True : è¿™ä¸èµ·ä½œç”¨ã€‚\nif my ($type,$a,$b,$c) = ($v ~~ /^(\u0026#39;horiz\u0026#39;|\u0026#39;vertic\u0026#39;)\u0026#39;_\u0026#39;(\\d+)\u0026#39;_\u0026#39;(\\d+)\u0026#39;_\u0026#39;(\\d+)$/)\u0026gt;\u0026gt;.Str { ... } å¥½å§ï¼Œæˆ‘åˆ†2æ¬¡åšäº†1/æ•æ‰å¹¶æµ‹è¯•åŒ¹é…ï¼Œ2/å°†åŒ¹é…è½¬æ¢ä¸ºStrã€‚\næ²¡æœ‰å¾—åˆ°åŠæ—¶çš„å›ç­”ï¼Œå®Œå…¨æ²¡æœ‰æ”¹è¿›ã€‚æˆ‘ä¹Ÿæ‰¾ä¸åˆ°ä¸€ä¸ªå¥½çš„æ–¹æ³•æ¥å¿«é€Ÿå®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚äº‹å®ä¸Šæˆ‘èŠ±äº†ä¸€ä¸ªå°æ—¶æ‰ç ´è§£è¿™ä¸ªèºæ¯ã€‚è¿™é‡Œçš„ä¸»è¦é—®é¢˜æ˜¯ï¼Œä¸€ä¸ªå¤±è´¥çš„åŒ¹é…ä¼šäº§ç”Ÿ .Str ä¼šæŠ±æ€¨çš„ Nilã€‚æ‰€ä»¥è®©æˆ‘ä»¬æŠŠ if çš„å¸ƒå°”æ£€æŸ¥å’Œè½¬æ¢ä¸º Str çš„è¿‡ç¨‹åˆ†å¼€ã€‚\nmy $a = \u0026#39;1 B\u0026#39;; if $a ~~ /(\u0026lt;digit\u0026gt;)\\s(\u0026lt;alpha\u0026gt;)/ -\u0026gt; $_ { my ($one, $B) = .deepmap: *.Str; say \u0026#34;$one$B\u0026#34;; } # OUTPUT: 1 B é€šè¿‡å°†æ¡ä»¶è¡¨è¾¾å¼çš„ç»“æœå¼ºè¡Œæ”¾å…¥ä¸»é¢˜ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åŒ¹é…çš„ç»“æœä¸Šè¿è¡Œä»»ä½•æ–¹æ³•ï¼Œä½†å‰ææ˜¯ Match.bool è¿”å› trueã€‚æˆ‘æ²¡æœ‰ CS* å­¦ä½ï¼Œä½†å¦‚æœ Raku-signatures ä¸ä¼šå˜æˆ turing completeï¼Œæˆ‘ä¼šéå¸¸æƒŠè®¶ã€‚\nif $a ~~ /(\u0026lt;digit\u0026gt;)\\s(\u0026lt;alpha\u0026gt;)/ -\u0026gt; Match (Str() $one, Str() $B) { dd $one; dd $B; } # OUTPUT: \u0026#34;1\u0026#34; \u0026#34;B\u0026#34; if å—çš„ç­¾åå°† Match èƒè¿«ä¸ºä¸€ä¸ªåˆ—è¡¨ã€‚æˆ‘ä»¬é€‰æ‹©å…¶ä¸­çš„ä¸¤ä¸ªå…ƒç´ ï¼Œå¹¶å°†è¿™äº›å…ƒç´ èƒè¿«ä¸º Strã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®æ•è·çš„ä½ç½®æ¥å¼ºåˆ¶åˆ°ä»»ä½•æˆ‘ä»¬å–œæ¬¢çš„ä¸œè¥¿ã€‚\nRaku ä¸­çš„ Regexes è¢«ç¼–è¯‘æˆç›¸åŒçš„å­—èŠ‚ç ï¼Œç„¶åç¨‹åºçš„å…¶ä½™éƒ¨åˆ†ã€‚äº‹å®ä¸Šï¼Œè¯­æ³•åªæ˜¯ä¸€ä¸ªå…·æœ‰æœ‰è¶£è¯­æ³•çš„ç±»ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°åœ¨ regex é‡Œé¢è¿è¡ŒRaku ä»£ç ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥æŠŠæ•´ä¸ªç¨‹åºä»å†…éƒ¨ç¿»å‡ºæ¥ã€‚\nmy @a = \u0026lt;1 B 3 D 4\u0026gt;; my @b; my $hit; for @a -\u0026gt; $e { @b.push: ($e ~~ /(\u0026lt;alpha\u0026gt;)||{ next }/).Str; } say @b; # OUTPUT: [B D] åœ¨è¿™é‡Œï¼Œå¦‚æœåŒ¹é…ä¸æˆåŠŸï¼Œæˆ‘ä»¬å°±è·³è¿‡ .pushï¼Œç”¨ next è·³è¿‡å¾ªç¯ä½“çš„å…¶ä½™éƒ¨åˆ†ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ regex å†…éƒ¨å‘å‡ºä»»ä½•æ§åˆ¶å¼‚å¸¸ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å°†æ•´ä¸ªè¿‡ç¨‹ç²˜åœ¨ä¸€ä¸ª sub ä¸­ï¼Œç„¶åä» regex ä¸­è¿”å›æˆ‘ä»¬æ­£åœ¨å¯»æ‰¾çš„å€¼ã€‚\nsub cherry-pick-numeric(Str $matchee) { $matchee ~~ m/(\u0026lt;digit\u0026gt;)\u0026amp;\u0026amp;{ return .Numeric }/; Empty } @b = do .\u0026amp;cherry-pick-numeric for @a; dd @b; # OUTPUT: Array @b = [1, 3, 4] Raku å·²ç»é…é…¿äº†10å¹´ã€‚è¿™æ˜¯ä¸€ä¸ªå·¨å¤§çš„ä»»åŠ¡ã€‚ç°åœ¨ï¼Œå›°éš¾çš„éƒ¨åˆ†æ¥äº†ã€‚æˆ‘ä»¬å¿…é¡»ä»é‚£åºå¤§çš„è¯­è¨€ä¸­æ‰¾åˆ°æ‰€æœ‰å¥½çš„æƒ¯ç”¨æ³•ã€‚å¥½ä¸œè¥¿ä¼šé™ä¸´åˆ°é‚£äº›ç­‰å¾…çš„äººèº«ä¸Šï¼ˆIRCä¸Šï¼‰ã€‚\n*) é˜…è¯»ã€‚ä¸è¦ç›¸ä¿¡æˆ‘å†™çš„ä»»ä½•ä¸œè¥¿ã€‚ä½ å·²ç»è¢«è­¦å‘Šäº†ã€‚\næ›´æ–°ä¸€ä¸‹ã€‚\næˆ‘ä»¥çœŸæ­£çš„æ‡’æƒ°æ–¹å¼ï¼Œæƒ³å‡ºäº†ä¸€ä¸ªåŠæ³•ï¼Œåœ¨æœ¬è¯¥å®Œæˆçš„å·¥ä½œä¹‹åï¼ŒæŠŠåŒ¹é…å˜æˆä¸€ä¸ªæƒ°æ€§åˆ—è¡¨ã€‚\n$a = \u0026#39;1B3D4\u0026#39;; my \\ll := gather $a ~~ m:g/[\u0026lt;alpha\u0026gt;\u0026amp;\u0026amp;{ take $/\u0026lt;alpha\u0026gt;.Str }]|[\u0026lt;digit\u0026gt;\u0026amp;\u0026amp;{ take $/.\u0026lt;digit\u0026gt;.Numeric }]|[{ say \u0026#39;step\u0026#39; }]/; say ll[0]; say ll[3]; # OUTPUT: 1 step step step D æŠ€å·§æ˜¯ç”¨ :g å‰¯è¯å¼ºåˆ¶åŒ¹é…ä¸€ç›´è¿è¡Œåˆ°å­—ç¬¦ä¸²çš„æœ«å°¾ã€‚è¿™ä¸ªè¿è¡Œå°†è¢« take æ‰“æ–­ï¼ˆé€šè¿‡æŠ›å‡º CX::Takeï¼‰ï¼Œå½“ä» gather è¿”å›çš„ Seq ä¸­è¯¢é—®ä¸‹ä¸€ä¸ªå€¼æ—¶å†ç»§ç»­ã€‚æˆ‘ä¸çŸ¥é“è¿™æ˜¯å¦æ˜¯æœ‰æ•ˆçš„å†…å­˜æ€æƒ³ã€‚å¯èƒ½ä¼šæœ‰ä¸€ä¸ª Match å®ä¾‹ä¸ºæ¯ä¸ª take ä¿ç•™åœ¨èº«è¾¹ã€‚\nåŸæ–‡é“¾æ¥: https://gfldex.wordpress.com/2021/03/11/raku-is-a-match-for/\n","permalink":"https://ohmyweekly.github.io/notes/2021-03-12-raku-is-a-match-for-star/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£"],"title":"Raku is a match for *"},{"categories":["Raku"],"contents":"class Student { has $.name; has $.sex; has $!age; method BUILD(:$!name) { } } my $stu = Student.new(:name(\u0026#39;èµµä»Šéº¦\u0026#39;), :sex(\u0026#39;å¥³\u0026#39;)); dd $stu; # Student $stu = Student.new(name =\u0026gt; \u0026#34;èµµä»Šéº¦\u0026#34;, sex =\u0026gt; Any) å¦‚æœä½ åŠ ä¸Š BUILD æ–¹æ³•, ä½ å¿…é¡»è‡ªå·±å…¨æƒè´Ÿè´£è®¾ç½®æ‰€æœ‰çš„ä¸œè¥¿ã€‚ä¹Ÿå°±æ˜¯æ—¢åŒ…æ‹¬å…¬å…±å±æ€§, ä¹ŸåŒ…æ‹¬ç§æœ‰å±æ€§ã€‚\nä½†ä½ å¯ä»¥é€šè¿‡å·§å¦™åœ°å‘½åå‚æ•°æ¥è®©ä½ çš„ç”Ÿæ´»æ›´è½»æ¾ã€‚\nmethod BUILD (:$!name, :$!sex, :$!age) { } BUILD æ–¹æ³•å¯ä»¥åˆå§‹åŒ–ç§æœ‰å±æ€§:\nclass Student { has $.name; has $.sex; has $!age; method BUILD(:$name, :$sex, :$age) { $!name = $name; $!sex = $sex; $!age = $age; } method heart() { return \u0026#39;â™¥ \u0026#39; ~ $!age } } my $stu = Student.new(:name(\u0026#39;èµµä»Šéº¦\u0026#39;), :sex(\u0026#39;å¥³\u0026#39;), :age(18)); dd $stu; say $stu; say $stu.heart(); ä¹Ÿå¯ä»¥åœ¨ TWEAK æ–¹æ³•ä¸­åˆå§‹åŒ–ç§æœ‰å±æ€§:\nclass Student { has $.name; has $.sex; has $!age; method TWEAK(:$name, :$sex, :$age) { $!age = $age + 1; } method heart() { return \u0026#39;â™¥\u0026#39; ~ $!age } } my $stu = Student.new(:name(\u0026#39;èµµä»Šéº¦\u0026#39;), :sex(\u0026#39;å¥³\u0026#39;), :age(18)); dd $stu; say $stu; say $stu.heart(); ä½¿ç”¨ TWEAKï¼Œä½ ä¼šå¾—åˆ°ä¸ BUILD ç›¸åŒçš„å‚æ•°ï¼Œä½†æ‰€æœ‰çš„åˆå§‹è®¾ç½®éƒ½å·²ç»å®Œæˆäº†ï¼ˆBUILD æˆ–å…¬å…±å±æ€§çš„è‡ªåŠ¨ç»‘å®šï¼Œä»¥åŠæ‰€æœ‰çš„é»˜è®¤å€¼ï¼Œå†åŠ ä¸Šä¿è¯æ‰€éœ€å€¼çš„å­˜åœ¨ï¼‰ã€‚ä½ åªæ˜¯æœ‰æœºä¼šåšä¸€äº›æœ€åçš„è°ƒæ•´ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2021-03-07-difference-between-build-and-tweak-in-raku/","tags":["Raku","BUILD","TWEAK","Object"],"title":"BUILD å’Œ TWEAK çš„åŒºåˆ«"},{"categories":["Dart"],"contents":"ç©ºå€¼å®‰å…¨æ˜¯æˆ‘ä»¬åœ¨ Dart 2.0 ä¸­ç”¨å¥å…¨çš„é™æ€ç±»å‹ç³»ç»Ÿå–ä»£äº†åŸæ¥çš„ä¸å¥å…¨çš„å¯é€‰ç±»å‹ç³»ç»Ÿåï¼Œå¯¹ Dart åšå‡ºçš„æœ€å¤§æ”¹å˜ã€‚å½“ Dart åˆšæ¨å‡ºçš„æ—¶å€™ï¼Œç¼–è¯‘æ—¶ç©ºå®‰å…¨æ˜¯ä¸€ä¸ªç½•è§çš„åŠŸèƒ½ï¼Œéœ€è¦é•¿æ—¶é—´çš„ä»‹ç»ã€‚ä»Šå¤©ï¼ŒKotlinã€Swiftã€Rust å’Œå…¶ä»–è¯­è¨€éƒ½æœ‰è‡ªå·±çš„ç­”æ¡ˆï¼Œè¿™å·²ç»æˆä¸ºä¸€ä¸ªéå¸¸ç†Ÿæ‚‰çš„é—®é¢˜ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚\n// Without null safety: bool isEmpty(String string) =\u0026gt; string.length == 0; main() { isEmpty(null); } å¦‚æœä½ åœ¨æ²¡æœ‰ null å®‰å…¨çš„æƒ…å†µä¸‹è¿è¡Œè¿™ä¸ª Dart ç¨‹åºï¼Œå®ƒå°±ä¼šåœ¨è°ƒç”¨.length æ—¶æŠ›å‡ºä¸€ä¸ª NoSuchMethodError å¼‚å¸¸ã€‚null å€¼æ˜¯ Null ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œè€Œ Null æ²¡æœ‰ \u0026ldquo;length\u0026rdquo; getterã€‚è¿è¡Œæ—¶çš„å¤±è´¥å¾ˆç³Ÿç³•ã€‚è¿™åœ¨åƒ Dart è¿™æ ·çš„è¯­è¨€ä¸­å°¤å…¶å¦‚æ­¤ï¼Œå› ä¸ºå®ƒè¢«è®¾è®¡æˆåœ¨ç»ˆç«¯ç”¨æˆ·çš„è®¾å¤‡ä¸Šè¿è¡Œã€‚å¦‚æœä¸€ä¸ªæœåŠ¡å™¨åº”ç”¨ç¨‹åºå¤±è´¥äº†ï¼Œä½ é€šå¸¸å¯ä»¥åœ¨ä»»ä½•äººæ³¨æ„åˆ°ä¹‹å‰é‡æ–°å¯åŠ¨å®ƒã€‚ä½†æ˜¯å½“ä¸€ä¸ª Flutter åº”ç”¨åœ¨ç”¨æˆ·çš„æ‰‹æœºä¸Šå´©æºƒæ—¶ï¼Œä»–ä»¬å¹¶ä¸é«˜å…´ã€‚å½“ä½ çš„ç”¨æˆ·ä¸é«˜å…´æ—¶ï¼Œä½ ä¹Ÿä¸é«˜å…´ã€‚\nå¼€å‘è€…å–œæ¬¢åƒ Dart è¿™æ ·çš„é™æ€ç±»å‹è¯­è¨€ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥è®©ç±»å‹æ£€æŸ¥å™¨åœ¨ç¼–è¯‘æ—¶å‘ç°ä»£ç ä¸­çš„é”™è¯¯ï¼Œé€šå¸¸å°±åœ¨ IDE ä¸­ã€‚è¶Šæ—©å‘ç°é”™è¯¯ï¼Œå°±èƒ½è¶Šæ—©ä¿®å¤å®ƒã€‚å½“è¯­è¨€è®¾è®¡è€…è°ˆè®º \u0026ldquo;ä¿®å¤ç©ºå€¼å¼•ç”¨é”™è¯¯\u0026quot;æ—¶ï¼Œä»–ä»¬çš„æ„æ€æ˜¯ä¸°å¯Œé™æ€ç±»å‹æ£€æŸ¥å™¨ï¼Œä½¿è¯­è¨€èƒ½å¤Ÿæ£€æµ‹åˆ°åƒä¸Šé¢è¯•å›¾åœ¨ä¸€ä¸ªå¯èƒ½æ˜¯ç©ºçš„å€¼ä¸Šè°ƒç”¨ .length è¿™æ ·çš„é”™è¯¯ã€‚\nå¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæ²¡æœ‰ä¸€ä¸ªçœŸæ­£çš„è§£å†³æ–¹æ¡ˆã€‚Rust å’Œ Kotlin éƒ½æœ‰è‡ªå·±çš„æ–¹æ³•ï¼Œåœ¨è¿™äº›è¯­è¨€çš„ä¸Šä¸‹æ–‡ä¸­æ˜¯æœ‰æ„ä¹‰çš„ã€‚è¿™ä¸ªæ–‡æ¡£è¯¦ç»†ä»‹ç»äº†æˆ‘ä»¬å¯¹ Dart çš„ç­”æ¡ˆã€‚å®ƒåŒ…æ‹¬å¯¹é™æ€ç±»å‹ç³»ç»Ÿçš„ä¿®æ”¹ï¼Œä»¥åŠä¸€ç³»åˆ—å…¶ä»–çš„ä¿®æ”¹å’Œæ–°çš„è¯­è¨€ç‰¹æ€§ï¼Œè®©ä½ ä¸ä»…èƒ½å†™å‡ºç©ºå€¼å®‰å…¨çš„ä»£ç ï¼Œè€Œä¸”å¸Œæœ›èƒ½äº«å—è¿™æ ·åšçš„ä¹è¶£ã€‚\nè¿™ä¸ªæ–‡æ¡£å¾ˆé•¿ã€‚å¦‚æœä½ æƒ³çœ‹ä¸€äº›è¾ƒçŸ­çš„æ–‡ä»¶ï¼Œå®ƒåªæ¶µç›–äº†ä½ éœ€è¦çŸ¥é“çš„ä¸œè¥¿ï¼Œä»¥ä¾¿å¼€å§‹è¿è¡Œï¼Œè¯·ä»æ¦‚è¿°å¼€å§‹ã€‚å½“ä½ å‡†å¤‡å¥½äº†æ›´æ·±å…¥çš„ç†è§£ï¼Œå¹¶ä¸”æœ‰æ—¶é—´çš„æ—¶å€™ï¼Œè¯·å›åˆ°è¿™é‡Œï¼Œè¿™æ ·ä½ å°±å¯ä»¥ç†è§£è¿™ä¸ªè¯­è¨€æ˜¯å¦‚ä½•å¤„ç† null çš„ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬è¦è¿™æ ·è®¾è®¡å®ƒï¼Œä»¥åŠå¦‚ä½•å†™å‡ºä¹ æƒ¯çš„ï¼Œç°ä»£çš„ï¼Œç©ºå€¼å®‰å…¨çš„ Dartã€‚(Spoiler alert: å®ƒæœ€ç»ˆä¼šå‡ºäººæ„æ–™åœ°æ¥è¿‘ä½ ä»Šå¤©å†™ Dart çš„æ–¹å¼ã€‚)\nè¯­è¨€å¤„ç†ç©ºå€¼å¼•ç”¨é”™è¯¯çš„å„ç§æ–¹æ³•å„æœ‰ä¼˜ç¼ºç‚¹ã€‚è¿™äº›åŸåˆ™æŒ‡å¯¼äº†æˆ‘ä»¬çš„é€‰æ‹©ã€‚\n ä»£ç é»˜è®¤æƒ…å†µä¸‹åº”è¯¥æ˜¯å®‰å…¨çš„ã€‚å¦‚æœä½ å†™äº†æ–°çš„ Dart ä»£ç ï¼Œå¹¶ä¸”æ²¡æœ‰ä½¿ç”¨ä»»ä½•æ˜¾å¼çš„ä¸å®‰å…¨ç‰¹æ€§ï¼Œå®ƒæ°¸è¿œä¸ä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡ºä¸€ä¸ªç©ºå€¼å¼•ç”¨é”™è¯¯ã€‚æ‰€æœ‰å¯èƒ½çš„ç©ºå€¼å¼•ç”¨é”™è¯¯éƒ½ä¼šè¢«é™æ€åœ°æ•è·ã€‚å¦‚æœä½ æƒ³å°†ä¸€äº›æ£€æŸ¥æ¨è¿Ÿåˆ°è¿è¡Œæ—¶ä»¥è·å¾—æ›´å¤§çš„çµæ´»æ€§ï¼Œä½ å¯ä»¥ï¼Œä½†ä½ å¿…é¡»é€šè¿‡ä½¿ç”¨ä¸€äº›åœ¨ä»£ç ä¸­æ–‡æœ¬å¯è§çš„åŠŸèƒ½æ¥é€‰æ‹©ã€‚  æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬å¹¶ä¸æ˜¯ç»™ä½ ä¸€ä»¶æ•‘ç”Ÿè¡£ï¼Œè®©ä½ æ¯æ¬¡å‡ºæµ·æ—¶éƒ½è®°å¾—ç©¿ä¸Šå®ƒã€‚ç›¸åï¼Œæˆ‘ä»¬ç»™ä½ ä¸€è‰˜ä¸æ²‰çš„èˆ¹ã€‚é™¤éä½ è·³æµ·ï¼Œå¦åˆ™ä½ ä¼šä¿æŒå¹²ç‡¥ã€‚\n ç©ºå€¼å®‰å…¨ä»£ç åº”è¯¥å¾ˆå®¹æ˜“å†™ã€‚å¤§å¤šæ•°ç°æœ‰çš„ Dart ä»£ç éƒ½æ˜¯åŠ¨æ€æ­£ç¡®çš„ï¼Œä¸ä¼šå‡ºç°ç©ºå€¼å¼•ç”¨é”™è¯¯ã€‚ä½ å–œæ¬¢ä½ çš„ Dart ç¨‹åºç°åœ¨çš„æ ·å­ï¼Œæˆ‘ä»¬å¸Œæœ›ä½ èƒ½å¤Ÿç»§ç»­è¿™æ ·å†™ä»£ç ã€‚å®‰å…¨æ€§ä¸åº”è¯¥è¦æ±‚ç‰ºç‰²å¯ç”¨æ€§ï¼Œå¯¹ç±»å‹æ£€æŸ¥å™¨è¿›è¡Œå¿æ‚”ï¼Œæˆ–è€…å¿…é¡»æ˜¾è‘—æ”¹å˜ä½ çš„æ€ç»´æ–¹å¼ã€‚  ç”±æ­¤äº§ç”Ÿçš„ç©ºå®‰å…¨ä»£ç åº”è¯¥æ˜¯å®Œå…¨å¥å…¨çš„ã€‚åœ¨é™æ€æ£€æŸ¥çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œ\u0026ldquo;å¥å…¨\u0026quot;å¯¹ä¸åŒçš„äººæ„å‘³ç€ä¸åŒçš„ä¸œè¥¿ã€‚å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œåœ¨ç©ºå€¼å®‰å…¨çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œè¿™æ„å‘³ç€å¦‚æœä¸€ä¸ªè¡¨è¾¾å¼çš„é™æ€ç±»å‹ä¸å…è®¸ç©ºï¼Œé‚£ä¹ˆè¯¥è¡¨è¾¾å¼çš„ä»»ä½•å¯èƒ½çš„æ‰§è¡Œéƒ½ä¸å¯èƒ½è¯„ä¼°ä¸ºç©ºã€‚è¯­è¨€ä¸»è¦é€šè¿‡é™æ€æ£€æŸ¥æ¥æä¾›è¿™ç§ä¿è¯ï¼Œä½†ä¹Ÿå¯ä»¥æ¶‰åŠä¸€äº›è¿è¡Œæ—¶æ£€æŸ¥ã€‚è™½ç„¶ï¼Œæ³¨æ„ç¬¬ä¸€ä¸ªåŸåˆ™ï¼šä»»ä½•å‘ç”Ÿè¿™äº›è¿è¡Œæ—¶æ£€æŸ¥çš„åœ°æ–¹éƒ½å°†æ˜¯ä½ çš„é€‰æ‹©ï¼‰ã€‚\nå¥å…¨æ€§å¯¹äºç”¨æˆ·çš„ä¿¡å¿ƒå¾ˆé‡è¦ã€‚ä¸€è‰˜å¤§éƒ¨åˆ†æ—¶é—´éƒ½ä¿æŒæ¼‚æµ®çš„èˆ¹ï¼Œå¹¶ä¸æ˜¯ä½ çƒ­è¡·äºåœ¨å…¬æµ·ä¸Šå†’é™©çš„èˆ¹ã€‚ä½†å®ƒå¯¹æˆ‘ä»¬æ— ç•çš„ç¼–è¯‘å™¨é»‘å®¢æ¥è¯´ä¹Ÿå¾ˆé‡è¦ã€‚å½“è¯­è¨€å¯¹ç¨‹åºçš„è¯­ä¹‰å±æ€§åšå‡ºç¡¬æ€§ä¿è¯æ—¶ï¼Œæ„å‘³ç€ç¼–è¯‘å™¨å¯ä»¥æ‰§è¡Œå‡è®¾è¿™äº›å±æ€§ä¸ºçœŸçš„ä¼˜åŒ–ã€‚å½“æ¶‰åŠåˆ° null æ—¶ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç”Ÿæˆæ›´å°çš„ä»£ç ï¼Œæ¶ˆé™¤ä¸éœ€è¦çš„ null æ£€æŸ¥ï¼Œä»¥åŠæ›´å¿«çš„ä»£ç ï¼Œä¸éœ€è¦åœ¨è°ƒç”¨æ–¹æ³•ä¹‹å‰éªŒè¯æ¥æ”¶å™¨æ˜¯é nullã€‚\næœ‰ä¸€ä¸ªæ³¨æ„äº‹é¡¹ï¼šæˆ‘ä»¬åªä¿è¯å®Œå…¨ç©ºå€¼å®‰å…¨çš„ Dart ç¨‹åºçš„å¥å…¨æ€§ã€‚Dart æ”¯æŒåŒ…å«æ–°çš„ç©ºå€¼å®‰å…¨ä»£ç å’Œæ—§çš„é—ç•™ä»£ç æ··åˆçš„ç¨‹åºã€‚åœ¨è¿™äº›æ··åˆç‰ˆæœ¬çš„ç¨‹åºä¸­ï¼Œä»ç„¶å¯èƒ½å‘ç”Ÿç©ºå€¼å¼•ç”¨é”™è¯¯ã€‚åœ¨ä¸€ä¸ªæ··åˆç‰ˆæœ¬çš„ç¨‹åºä¸­ï¼Œä½ å¯ä»¥åœ¨ç©ºå€¼å®‰å…¨çš„éƒ¨åˆ†è·å¾—æ‰€æœ‰çš„é™æ€å®‰å…¨ä¼˜åŠ¿ï¼Œä½†æ˜¯åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºæ˜¯ç©ºå®‰å…¨çš„ä¹‹å‰ï¼Œä½ ä¸èƒ½è·å¾—å®Œæ•´çš„è¿è¡Œæ—¶å¥å…¨æ€§ã€‚\nè¯·æ³¨æ„ï¼Œæ¶ˆé™¤ null å¹¶ä¸æ˜¯ä¸€ä¸ªç›®æ ‡ã€‚null æ²¡æœ‰ä»€ä¹ˆä¸å¥½ã€‚ç›¸åï¼Œèƒ½å¤Ÿè¡¨ç¤ºä¸€ä¸ªå€¼çš„ç¼ºå¤±çœŸçš„å¾ˆæœ‰ç”¨ã€‚ç›´æ¥åœ¨è¯­è¨€ä¸­æ„å»ºå¯¹ç‰¹æ®Šçš„ \u0026ldquo;absence\u0026rdquo; å€¼çš„æ”¯æŒï¼Œä½¿å¾—å¤„ç†ç¼ºå¤±çš„å·¥ä½œå˜å¾—çµæ´»å’Œå¯ç”¨ã€‚å®ƒæ˜¯å¯é€‰å‚æ•°ã€æ–¹ä¾¿çš„ ?. null-aware æ“ä½œç¬¦å’Œé»˜è®¤åˆå§‹åŒ–çš„åŸºç¡€ã€‚å¹¶ä¸æ˜¯ null ä¸å¥½ï¼Œè€Œæ˜¯è®© null å»äº†ä½ æƒ³ä¸åˆ°çš„åœ°æ–¹æ‰ä¼šå¼•èµ·é—®é¢˜ã€‚\nå› æ­¤ï¼Œæœ‰äº† null å®‰å…¨ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯è®©ä½ æ§åˆ¶å’Œæ´å¯Ÿ null å¯ä»¥æµç»ä½ çš„ç¨‹åºçš„åœ°æ–¹ï¼Œå¹¶ç¡®å®šå®ƒä¸èƒ½æµåˆ°æŸä¸ªåœ°æ–¹ï¼Œä»è€Œå¯¼è‡´å´©æºƒã€‚\nç±»å‹ç³»ç»Ÿä¸­çš„ç©ºå€¼ ç©ºå€¼å®‰å…¨å§‹äºé™æ€ç±»å‹ç³»ç»Ÿï¼Œå› ä¸ºå…¶ä»–ä¸€åˆ‡éƒ½å»ºç«‹åœ¨é™æ€ç±»å‹ç³»ç»Ÿä¹‹ä¸Šã€‚ä½ çš„ Dart ç¨‹åºä¸­æœ‰ä¸€ä¸ªå®Œæ•´çš„ç±»å‹å®‡å®™ï¼šåƒ int å’Œ String è¿™æ ·çš„åŸºå…ƒç±»å‹ï¼Œåƒ List è¿™æ ·çš„é›†åˆç±»å‹ï¼Œä»¥åŠæ‰€æœ‰ä½ å’Œä½ ä½¿ç”¨çš„åŒ…æ‰€å®šä¹‰çš„ç±»å’Œç±»å‹ã€‚åœ¨ null å®‰å…¨ä¹‹å‰ï¼Œé™æ€ç±»å‹ç³»ç»Ÿå…è®¸å€¼ null æµå…¥ä»»ä½•è¿™äº›ç±»å‹çš„è¡¨è¾¾å¼ä¸­ã€‚\nåœ¨ç±»å‹ç†è®ºçš„è¡Œè¯ä¸­ï¼ŒNull ç±»å‹è¢«è§†ä¸ºæ‰€æœ‰ç±»å‹çš„ä¸€ä¸ªå­ç±»å‹ã€‚\nåœ¨æŸäº›è¡¨è¾¾å¼ä¸Šå…è®¸çš„æ“ä½œé›† - gettersã€settersã€methods å’Œ operator - ç”±å…¶ç±»å‹å®šä¹‰ã€‚å¦‚æœç±»å‹æ˜¯ Listï¼Œä½ å¯ä»¥å¯¹å®ƒè°ƒç”¨. add() æˆ– []ã€‚å¦‚æœå®ƒæ˜¯ intï¼Œä½ å¯ä»¥è°ƒç”¨ +ã€‚ä½†æ˜¯ç©ºå€¼å¹¶æ²¡æœ‰å®šä¹‰ä»»ä½•è¿™äº›æ–¹æ³•ã€‚å…è®¸ null æµå…¥å…¶ä»–ç±»å‹çš„è¡¨è¾¾å¼æ„å‘³ç€ä»»ä½•è¿™äº›æ“ä½œéƒ½å¯èƒ½å¤±è´¥ã€‚è¿™å°±æ˜¯ null å¼•ç”¨é”™è¯¯çš„çœŸæ­£ç—‡ç»“æ‰€åœ¨ - æ¯ä¸€æ¬¡å¤±è´¥éƒ½æ¥è‡ªäºè¯•å›¾åœ¨ null ä¸ŠæŸ¥æ‰¾ä¸€ä¸ªå®ƒæ²¡æœ‰çš„æ–¹æ³•æˆ–å±æ€§ã€‚\néå¯ç©ºç±»å‹å’Œå¯ç©ºç±»å‹ Null å®‰å…¨é€šè¿‡æ”¹å˜ç±»å‹å±‚æ¬¡ç»“æ„ï¼Œä»æ ¹æœ¬ä¸Šæ¶ˆé™¤äº†è¿™ä¸ªé—®é¢˜ã€‚Null ç±»å‹ä»ç„¶å­˜åœ¨ï¼Œä½†å®ƒä¸å†æ˜¯æ‰€æœ‰ç±»å‹çš„å­ç±»å‹ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œç±»å‹å±‚æ¬¡ç»“æ„æ˜¯è¿™æ ·çš„ã€‚\nç”±äº Null ä¸å†æ˜¯å­ç±»å‹, é™¤äº†ç‰¹æ®Šçš„ Null ç±»ä¹‹å¤–ï¼Œæ²¡æœ‰ä»»ä½•ç±»å‹å…è®¸å€¼ä¸º nullã€‚æˆ‘ä»¬å·²ç»å°†æ‰€æœ‰ç±»å‹é»˜è®¤ä¸ºä¸å¯ç©ºå€¼ã€‚å¦‚æœä½ æœ‰ä¸€ä¸ª String ç±»å‹çš„å˜é‡ï¼Œå®ƒå°†æ€»æ˜¯åŒ…å«ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚åœ¨é‚£é‡Œï¼Œæˆ‘ä»¬å·²ç»ä¿®å¤äº†æ‰€æœ‰çš„ç©ºå€¼å¼•ç”¨é”™è¯¯ã€‚\nå¦‚æœæˆ‘ä»¬è®¤ä¸º null æ ¹æœ¬æ²¡æœ‰ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œåœæ­¢ã€‚ä½†æ˜¯ null æ˜¯æœ‰ç”¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»ç„¶éœ€è¦ä¸€ç§æ–¹æ³•æ¥å¤„ç†å®ƒã€‚å¯é€‰å‚æ•°å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è¯´æ˜æ€§æ¡ˆä¾‹ã€‚è€ƒè™‘ä¸€ä¸‹è¿™ä¸ª null å®‰å…¨çš„ Dart ä»£ç ã€‚\n// Using null safety: makeCoffee(String coffee, [String? dairy]) { if (dairy != null) { print(\u0026#39;$coffeewith $dairy\u0026#39;); } else { print(\u0026#39;Black $coffee\u0026#39;); } } åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¸Œæœ›å…è®¸ dairy å‚æ•°æ¥å—ä»»ä½•å­—ç¬¦ä¸²ï¼Œæˆ–è€…æ¥å— null å€¼ï¼Œè€Œä¸æ¥å—å…¶ä»–ä»»ä½•å€¼ã€‚ä¸ºäº†è¡¨è¾¾è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬åœ¨åº•å±‚åŸºç±»å‹ String çš„ç»“å°¾å¤„åŠ ä¸Š ?ã€‚ ä»æœ¬è´¨ä¸Šè®²ï¼Œè¿™å°±æ˜¯å®šä¹‰äº†ä¸€ä¸ªåº•å±‚ç±»å‹å’Œ Null ç±»å‹çš„è”åˆã€‚æ‰€ä»¥ï¼Œå¦‚æœ Dart æœ‰å…¨åŠŸèƒ½çš„è”åˆç±»å‹ï¼Œé‚£ä¹ˆ String? å°†æ˜¯ String|Null çš„ç®€å†™ã€‚\nä½¿ç”¨å¯ç©ºç±»å‹ å¦‚æœä½ æœ‰ä¸€ä¸ªå¯ç©ºç±»å‹çš„è¡¨è¾¾å¼ï¼Œä½ å¯ä»¥ç”¨è¿™ä¸ªç»“æœåšä»€ä¹ˆï¼Ÿç”±äºæˆ‘ä»¬çš„åŸåˆ™é»˜è®¤æ˜¯å®‰å…¨çš„ï¼Œæ‰€ä»¥ç­”æ¡ˆæ˜¯ä¸å¤šï¼Œæˆ‘ä»¬ä¸èƒ½è®©ä½ å¯¹å®ƒè°ƒç”¨åº•å±‚ç±»å‹çš„æ–¹æ³•ï¼Œå› ä¸ºå¦‚æœå€¼æ˜¯ç©ºçš„ï¼Œè¿™äº›æ–¹æ³•å¯èƒ½ä¼šå¤±è´¥ã€‚\n// Hypothetical unsound null safety: bad(String? maybeString) { print(maybeString.length); } main() { bad(null); } å¦‚æœæˆ‘ä»¬è®©ä½ è¿è¡Œå®ƒï¼Œå°±ä¼šå´©æºƒã€‚æˆ‘ä»¬å”¯ä¸€å¯ä»¥å®‰å…¨åœ°è®©ä½ è®¿é—®çš„æ–¹æ³•å’Œå±æ€§æ˜¯ç”±åº•å±‚ç±»å‹å’Œ Null ç±»å®šä¹‰çš„ã€‚é‚£å°±æ˜¯ toString()ã€== å’Œ hashCodeã€‚å› æ­¤ï¼Œä½ å¯ä»¥ä½¿ç”¨å¯ç©ºç±»å‹ä½œä¸ºæ˜ å°„é”®ï¼Œå°†å®ƒä»¬å­˜å‚¨åœ¨é›†åˆä¸­ï¼Œå°†å®ƒä»¬ä¸å…¶ä»–å€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶åœ¨å­—ç¬¦ä¸²æ’å€¼ä¸­ä½¿ç”¨å®ƒä»¬ï¼Œä½†ä»…æ­¤è€Œå·²ã€‚\nå®ƒä»¬å¦‚ä½•ä¸éå¯ç©ºç±»å‹äº¤äº’ï¼Ÿå°†ä¸€ä¸ªä¸å¯ç©ºå€¼ç±»å‹ä¼ é€’ç»™æœŸæœ›ç©ºå€¼ç±»å‹çš„ä¸œè¥¿æ€»æ˜¯å®‰å…¨çš„ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°æ¥å— String å—ï¼Œé‚£ä¹ˆä¼ é€’ä¸€ä¸ª String æ˜¯å…è®¸çš„ï¼Œå› ä¸ºå®ƒä¸ä¼šå¼•èµ·ä»»ä½•é—®é¢˜ã€‚æˆ‘ä»¬é€šè¿‡ä½¿æ¯ä¸ªå¯ç©ºç±»å‹æˆä¸ºå…¶åº•å±‚ç±»å‹çš„è¶…ç±»å‹æ¥å»ºç«‹æ¨¡å‹ã€‚ä½ ä¹Ÿå¯ä»¥å®‰å…¨åœ°æŠŠ null ä¼ ç»™æœŸæœ›æ˜¯å¯ç©ºç±»å‹çš„ä¸œè¥¿ï¼Œæ‰€ä»¥ Null ä¹Ÿæ˜¯æ¯ä¸ªå¯ç©ºç±»å‹çš„ä¸€ä¸ªå­ç±»å‹ã€‚\nä½†æ˜¯åè¿‡æ¥è¯´ï¼ŒæŠŠä¸€ä¸ªå¯ç©ºç±»å‹ä¼ é€’ç»™æœŸå¾…åº•å±‚éå¯ç©ºç±»å‹çš„ä¸œè¥¿æ˜¯ä¸å®‰å…¨çš„ã€‚æœŸå¾…ä¸€ä¸ª String çš„ä»£ç å¯ä»¥åœ¨å€¼ä¸Šè°ƒç”¨ String æ–¹æ³•ã€‚å¦‚æœä½ æŠŠä¸€ä¸ª String? ä¼ ç»™å®ƒï¼Œnull å¯èƒ½ä¼šæµè¿›æ¥ï¼Œè¿™å¯èƒ½ä¼šå¤±è´¥ã€‚\n// Hypothetical unsound null safety: requireStringNotNull(String definitelyString) { print(definitelyString.length); } main() { String? maybeString = null; // Or not!  requireStringNotNull(maybeString); } è¿™ä¸ªç¨‹åºä¸å®‰å…¨ï¼Œæˆ‘ä»¬ä¸åº”è¯¥å…è®¸å®ƒã€‚ç„¶è€Œï¼ŒDart ä¸€ç›´æœ‰è¿™ä¸ªä¸œè¥¿ï¼Œå«åšéšå¼ä¸‹ä¼ ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æŠŠä¸€ä¸ª Object ç±»å‹çš„å€¼ä¼ é€’ç»™ä¸€ä¸ªæœŸæœ›ä¸º String çš„å‡½æ•°ï¼Œç±»å‹æ£€æŸ¥å™¨å°±ä¼šå…è®¸å®ƒã€‚\n// Without null safety: requireStringNotObject(String definitelyString) { print(definitelyString.length); } main() { Object maybeString = \u0026#39;it is\u0026#39;; requireStringNotObject(maybeString); } ä¸ºäº†ä¿æŒåˆç†æ€§ï¼Œç¼–è¯‘å™¨åœ¨ requireStringNotObject() çš„å‚æ•°ä¸Šé»˜é»˜åœ°æ’å…¥äº†ä¸€ä¸ª as String castã€‚è¿™ä¸ªè½¬ç å¯èƒ½ä¼šåœ¨è¿è¡Œæ—¶å¤±è´¥å¹¶æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œä½†åœ¨ç¼–è¯‘æ—¶ï¼ŒDart è¯´è¿™æ˜¯ç¡®å®šçš„ã€‚ç”±äºéå¯ç©ºç±»å‹è¢«å»ºæ¨¡ä¸ºå¯ç©ºç±»å‹çš„å­ç±»å‹ï¼Œæ‰€ä»¥éšå¼ä¸‹æŠ•ä¼šè®©ä½ æŠŠä¸€ä¸ª String? ä¼ é€’ç»™æœŸå¾…ä¸€ä¸ª String çš„ä¸œè¥¿ã€‚å…è®¸è¿™æ ·åšä¼šè¿åæˆ‘ä»¬é»˜è®¤å®‰å…¨çš„ç›®æ ‡ã€‚æ‰€ä»¥ï¼Œæœ‰äº†ç©ºå€¼å®‰å…¨ï¼Œæˆ‘ä»¬å°±å®Œå…¨å–æ¶ˆäº†éšå¼ä¸‹ä¼ ã€‚\nè¿™ä½¿å¾—å¯¹ requireStringNotNull() çš„è°ƒç”¨ä¼šäº§ç”Ÿä¸€ä¸ªç¼–è¯‘é”™è¯¯ï¼Œè¿™æ˜¯ä½ æƒ³è¦çš„ã€‚ä½†è¿™ä¹Ÿæ„å‘³ç€æ‰€æœ‰çš„éšå¼ä¸‹åŒ…éƒ½ä¼šæˆä¸ºç¼–è¯‘é”™è¯¯ï¼ŒåŒ…æ‹¬å¯¹ requireStringNotObject() çš„è°ƒç”¨ã€‚ä½ å¿…é¡»è‡ªå·±æ·»åŠ æ˜¾å¼ä¸‹ä¼ ã€‚\n// Using null safety: requireStringNotObject(String definitelyString) { print(definitelyString.length); } main() { Object maybeString = \u0026#39;it is\u0026#39;; requireStringNotObject(maybeString as String); } æˆ‘ä»¬è®¤ä¸ºè¿™æ€»ä½“ä¸Šæ˜¯ä¸€ä¸ªå¥½çš„å˜åŒ–ã€‚åœ¨æˆ‘ä»¬çš„å°è±¡ä¸­ï¼Œå¤§å¤šæ•°ç”¨æˆ·ä»æ¥éƒ½ä¸å–œæ¬¢éšæ€§é™é¢‘ã€‚å°¤å…¶æ˜¯ï¼Œä½ å¯èƒ½ä¹‹å‰å°±è¢«è¿™ä¸ªçƒ§è¿‡ã€‚\n// Without null safety: List\u0026lt;int\u0026gt; filterEvens(List\u0026lt;int\u0026gt; ints) { return ints.where((n) =\u0026gt; n.isEven); } å‘ç°é”™è¯¯äº†å—ï¼Ÿ.where() æ–¹æ³•æ˜¯æ‡’æƒ°çš„ï¼Œæ‰€ä»¥å®ƒè¿”å›çš„æ˜¯ä¸€ä¸ª Iterableï¼Œè€Œä¸æ˜¯ Listã€‚è¿™ä¸ªç¨‹åºåœ¨ç¼–è¯‘æ—¶ï¼Œå½“å®ƒè¯•å›¾å°† Iterable æŠ•å°„åˆ° filterEvens å£°æ˜å®ƒè¿”å›çš„ List ç±»å‹æ—¶ï¼Œä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚ç§»é™¤éšå¼ä¸‹æŠ•åï¼Œè¿™å°±å˜æˆäº†ä¸€ä¸ªç¼–è¯‘é”™è¯¯ã€‚\næˆ‘ä»¬è¯´åˆ°å“ªé‡Œäº†ï¼Ÿå¯¹äº†ï¼Œå¥½å§ï¼Œå°±å¥½åƒæˆ‘ä»¬æŠŠä½ ç¨‹åºä¸­çš„ç±»å‹å®‡å®™åˆ†æˆäº†ä¸¤åŠã€‚\næœ‰ä¸€ä¸ªéç©ºå€¼ç±»å‹çš„åŒºåŸŸã€‚è¿™äº›ç±»å‹è®©ä½ å¯ä»¥è®¿é—®æ‰€æœ‰æœ‰è¶£çš„æ–¹æ³•ï¼Œä½†æ°¸è¿œä¸èƒ½åŒ…å« nullã€‚ç„¶åæ˜¯ä¸€ä¸ªç”±æ‰€æœ‰ç›¸åº”çš„å¯ç©ºç±»å‹ç»„æˆçš„å¹³è¡Œå®¶æ—ã€‚è¿™äº›ç±»å‹å…è®¸ nullï¼Œä½†ä½ ä¸èƒ½å¯¹å®ƒä»¬åšå¤ªå¤šäº‹æƒ…ã€‚æˆ‘ä»¬è®©å€¼ä»éå¯ç©ºä¾§æµå‘å¯ç©ºä¾§ï¼Œå› ä¸ºè¿™æ ·åšæ˜¯å®‰å…¨çš„ï¼Œä½†ä¸æ˜¯å…¶ä»–æ–¹å‘ã€‚\nè¿™æ ·çœ‹æ¥ï¼Œå¯ç©ºç±»å‹åŸºæœ¬ä¸Šæ˜¯æ— ç”¨çš„ã€‚å®ƒä»¬æ²¡æœ‰æ–¹æ³•ï¼Œä½ æ— æ³•æ‘†è„±å®ƒä»¬ã€‚åˆ«æ‹…å¿ƒï¼Œæˆ‘ä»¬æœ‰ä¸€æ•´å¥—çš„åŠŸèƒ½æ¥å¸®åŠ©ä½ æŠŠå€¼ä»å¯ç©ºå‹çš„ä¸€åŠç§»åˆ°å¦ä¸€è¾¹ï¼Œæˆ‘ä»¬å¾ˆå¿«å°±ä¼šè®²åˆ°ã€‚\né¡¶éƒ¨å’Œåº•éƒ¨ è¿™ä¸€éƒ¨åˆ†æœ‰ç‚¹æ·±å¥¥ã€‚ä½ å¯ä»¥è·³è¿‡å®ƒï¼Œé™¤äº†æœ€åçš„ä¸¤ä¸ªå­å¼¹ï¼Œé™¤éä½ å¯¹ç±»å‹ç³»ç»Ÿæ„Ÿå…´è¶£ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œåœ¨ä½ çš„ç¨‹åºä¸­ï¼Œæ‰€æœ‰çš„ç±»å‹ä¹‹é—´éƒ½æœ‰è¾¹ç¼˜ï¼Œå®ƒä»¬æ˜¯å½¼æ­¤çš„å­ç±»å‹å’Œè¶…ç±»å‹ã€‚å¦‚æœä½ æŠŠå®ƒç”»å‡ºæ¥ï¼Œå°±åƒè¿™ä¸ªæ–‡æ¡£ä¸­çš„å›¾ä¸€æ ·ï¼Œå®ƒå°†å½¢æˆä¸€ä¸ªå·¨å¤§çš„æœ‰å‘å›¾ï¼Œä¸Šé¢æœ‰åƒ Object è¿™æ ·çš„è¶…ç±»å‹ï¼Œä¸‹é¢æœ‰åƒä½ è‡ªå·±çš„ç±»å‹è¿™æ ·çš„å¶å­ç±»ã€‚\nå¦‚æœè¿™ä¸ªæœ‰å‘å›¾åˆ°äº†é¡¶éƒ¨ï¼Œæœ‰ä¸€ä¸ªå•ä¸€çš„ç±»å‹æ˜¯è¶…ç±»å‹ï¼ˆç›´æ¥æˆ–é—´æ¥ï¼‰ï¼Œè¿™ä¸ªç±»å‹å°±è¢«ç§°ä¸ºé¡¶éƒ¨ç±»å‹ã€‚åŒæ ·ï¼Œå¦‚æœåœ¨é‚£ä¸ªåº•éƒ¨æœ‰ä¸€ä¸ªå¥‡æ€ªçš„ç±»å‹æ˜¯æ¯ä¸ªç±»å‹çš„å­ç±»å‹ï¼Œä½ å°±æœ‰ä¸€ä¸ªåº•éƒ¨ç±»å‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ çš„æœ‰å‘å›¾æ˜¯ä¸€ä¸ªç½‘æ ¼ï¼‰ã€‚\nå¦‚æœä½ çš„ç±»å‹ç³»ç»Ÿæœ‰é¡¶å±‚å’Œåº•å±‚ç±»å‹ï¼Œé‚£æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œå› ä¸ºè¿™æ„å‘³ç€åƒæœ€å°ä¸Šç•Œè¿™æ ·çš„ç±»å‹çº§æ“ä½œï¼ˆç±»å‹æ¨ç†ä½¿ç”¨å®ƒæ¥æ ¹æ®ä¸€ä¸ªæ¡ä»¶è¡¨è¾¾å¼çš„ä¸¤ä¸ªåˆ†æ”¯çš„ç±»å‹æ‰¾å‡ºå®ƒçš„ç±»å‹ï¼‰æ€»æ˜¯å¯ä»¥äº§ç”Ÿä¸€ä¸ªç±»å‹ã€‚åœ¨ null å®‰å…¨ä¹‹å‰ï¼ŒObject æ˜¯ Dart çš„é¡¶å±‚ç±»å‹ï¼ŒNull æ˜¯å…¶åº•å±‚ç±»å‹ã€‚\nç”±äºç°åœ¨ Object æ˜¯ä¸å¯ç©ºçš„ï¼Œæ‰€ä»¥å®ƒä¸å†æ˜¯é¡¶ç±»å‹ã€‚Null ä¸æ˜¯å®ƒçš„å­ç±»å‹ã€‚Dart æ²¡æœ‰å‘½åçš„é¡¶ç±»å‹ã€‚å¦‚æœä½ éœ€è¦ä¸€ä¸ªé¡¶ç±»å‹ï¼Œä½ è¦ Object? åŒæ ·ï¼ŒNull ä¹Ÿä¸å†æ˜¯åº•å±‚ç±»å‹ã€‚å¦‚æœæ˜¯çš„è¯ï¼Œä¸€åˆ‡éƒ½è¿˜ä¼šæ˜¯ nullã€‚ç›¸åï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªæ–°çš„åº•å±‚ç±»å‹ï¼Œåä¸º Neverã€‚\nåœ¨å®è·µä¸­ï¼Œè¿™æ„å‘³ç€ã€‚\nå¦‚æœä½ æƒ³è¡¨æ˜ä½ å…è®¸ä»»ä½•ç±»å‹çš„å€¼ï¼Œå°±ç”¨ Object? è€Œä¸æ˜¯ Object. äº‹å®ä¸Šï¼Œä½¿ç”¨ Object å°±å˜å¾—å¾ˆä¸å¯»å¸¸äº†ï¼Œå› ä¸ºè¯¥ç±»å‹æ„å‘³ç€ \u0026ldquo;å¯èƒ½æ˜¯ä»»ä½•å¯èƒ½çš„å€¼ï¼Œé™¤äº†è¿™ä¸ªå¥‡æ€ªçš„ç¦æ­¢å€¼ null\u0026rdquo;ã€‚\nåœ¨æå°‘æ•°æƒ…å†µä¸‹ï¼Œä½ éœ€è¦ä¸€ä¸ªåº•å±‚ç±»å‹ï¼Œç”¨ Never ä»£æ›¿ Nullã€‚å¦‚æœä½ ä¸çŸ¥é“æ˜¯å¦éœ€è¦åº•å±‚ç±»å‹ï¼Œä½ å¯èƒ½ä¸éœ€è¦ã€‚\nç¡®ä¿æ­£ç¡®æ€§ æˆ‘ä»¬å°†ç±»å‹çš„å®‡å®™åˆ†ä¸ºå¯ç©ºå’Œä¸å¯ç©ºçš„ä¸¤åŠã€‚ä¸ºäº†ä¿æŒå¥å…¨æ€§å’Œæˆ‘ä»¬çš„åŸåˆ™ï¼Œå³é™¤éä½ è¦æ±‚ï¼Œå¦åˆ™ä½ æ°¸è¿œä¸ä¼šåœ¨è¿è¡Œæ—¶å¾—åˆ°ä¸€ä¸ª null å¼•ç”¨é”™è¯¯ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯ null æ°¸è¿œä¸ä¼šå‡ºç°åœ¨é nullable ç«¯çš„ä»»ä½•ç±»å‹ä¸­ã€‚\næ‘†è„±éšå¼ä¸‹ä¼ ï¼Œå»æ‰ Null è¿™ä¸ªåº•å±‚ç±»å‹ï¼Œæ¶µç›–äº†ç±»å‹åœ¨ç¨‹åºä¸­è·¨èµ‹å€¼æµè½¬å’Œåœ¨å‡½æ•°è°ƒç”¨ä¸­ä»å‚æ•°æµè½¬åˆ°å‚æ•°çš„æ‰€æœ‰ä¸»è¦åœ°æ–¹ã€‚å‰©ä¸‹çš„ä¸»è¦çš„ null å¯ä»¥æ½œå…¥çš„åœ°æ–¹æ˜¯å½“ä¸€ä¸ªå˜é‡ç¬¬ä¸€æ¬¡å‡ºç°å’Œç¦»å¼€ä¸€ä¸ªå‡½æ•°çš„æ—¶å€™ã€‚æ‰€ä»¥ä¼šå‡ºç°ä¸€äº›é¢å¤–çš„ç¼–è¯‘é”™è¯¯ã€‚\næ— æ•ˆè¿”å› å¦‚æœä¸€ä¸ªå‡½æ•°çš„è¿”å›ç±»å‹æ˜¯éç©ºçš„ï¼Œé‚£ä¹ˆé€šè¿‡è¯¥å‡½æ•°çš„æ¯ä¸€æ¡è·¯å¾„éƒ½å¿…é¡»åˆ°è¾¾ä¸€ä¸ªè¿”å›å€¼çš„è¿”å›è¯­å¥ã€‚åœ¨ null å®‰å…¨ä¹‹å‰ï¼ŒDart å¯¹äºç¼ºå¤±è¿”å›çš„æƒ…å†µéå¸¸å®½æ¾ã€‚æ¯”å¦‚è¯´\n// Without null safety: String missingReturn() { // No return. } å¦‚æœä½ åˆ†æè¿™ä¸ªï¼Œä½ å°±ä¼šå¾—åˆ°ä¸€ä¸ªæ¸©æŸ”çš„æç¤ºï¼Œä¹Ÿè®¸ä½ å¿˜äº†ä¸€ä¸ªè¿”å›ï¼Œä½†å¦‚æœæ²¡æœ‰ï¼Œä¹Ÿæ²¡ä»€ä¹ˆå¤§ä¸äº†çš„ã€‚è¿™æ˜¯å› ä¸ºå¦‚æœæ‰§è¡Œåˆ°äº†å‡½æ•°ä½“çš„æœ«ç«¯ï¼Œé‚£ä¹ˆ Dart å°±ä¼šéšå¼è¿”å› nullã€‚ç”±äºæ¯ä¸ªç±»å‹éƒ½æ˜¯å¯ç©ºçš„ï¼Œæ‰€ä»¥ä»æŠ€æœ¯ä¸Šè®²ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯å®‰å…¨çš„ï¼Œå°½ç®¡å®ƒå¯èƒ½ä¸æ˜¯ä½ æƒ³è¦çš„ã€‚\nå¯¹äºå¥å…¨çš„éå¯ç©ºç±»å‹ï¼Œè¿™ä¸ªç¨‹åºæ˜¯å®Œå…¨é”™è¯¯çš„ï¼Œä¸å®‰å…¨çš„ã€‚åœ¨ç©ºå€¼å®‰å…¨ä¸‹ï¼Œå¦‚æœä¸€ä¸ªå…·æœ‰éå¯ç©ºå€¼è¿”å›ç±»å‹çš„å‡½æ•°ä¸èƒ½å¯é åœ°è¿”å›ä¸€ä¸ªå€¼ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªç¼–è¯‘é”™è¯¯ã€‚æ‰€è°“ \u0026ldquo;å¯é \u0026rdquo;ï¼Œæ˜¯æŒ‡è¯­è¨€åˆ†æäº†æ‰€æœ‰é€šè¿‡å‡½æ•°çš„æ§åˆ¶æµè·¯å¾„ã€‚åªè¦å®ƒä»¬éƒ½èƒ½è¿”å›ä¸€äº›ä¸œè¥¿ï¼Œå®ƒå°±æ»¡è¶³äº†ã€‚è¿™ä¸ªåˆ†ææ˜¯ç›¸å½“èªæ˜çš„ï¼Œæ‰€ä»¥å³ä½¿è¿™ä¸ªå‡½æ•°ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚\n// Using null safety: String alwaysReturns(int n) { if (n == 0) { return \u0026#39;zero\u0026#39;; } else if (n \u0026lt; 0) { throw ArgumentError(\u0026#39;Negative values not allowed.\u0026#39;); } else { if (n \u0026gt; 1000) { return \u0026#39;big\u0026#39;; } else { return n.toString(); } } } æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚æ›´æ·±å…¥åœ°ç ”ç©¶æ–°çš„æµç¨‹åˆ†æã€‚\næœªåˆå§‹åŒ–çš„å˜é‡ å½“ä½ å£°æ˜ä¸€ä¸ªå˜é‡æ—¶ï¼Œå¦‚æœä½ æ²¡æœ‰ç»™å®ƒä¸€ä¸ªæ˜¾å¼çš„åˆå§‹åŒ–å™¨ï¼ŒDart é»˜è®¤ç”¨ null åˆå§‹åŒ–å˜é‡ã€‚è¿™å¾ˆæ–¹ä¾¿ï¼Œä½†å¦‚æœå˜é‡çš„ç±»å‹æ˜¯ä¸å¯ç©ºçš„ï¼Œæ˜¾ç„¶æ˜¯å®Œå…¨ä¸å®‰å…¨çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¿…é¡»å¯¹ä¸å¯ç©ºå€¼çš„å˜é‡è¿›è¡Œä¸¥æ ¼çš„è§„å®šã€‚\n é¡¶çº§å˜é‡å’Œé™æ€å­—æ®µçš„å£°æ˜å¿…é¡»æœ‰ä¸€ä¸ªåˆå§‹åŒ–å™¨ã€‚ç”±äºè¿™äº›å˜é‡å¯ä»¥åœ¨ç¨‹åºä¸­çš„ä»»ä½•åœ°æ–¹è¢«è®¿é—®å’Œèµ‹å€¼ï¼Œç¼–è¯‘å™¨ä¸å¯èƒ½ä¿è¯å˜é‡åœ¨è¢«ä½¿ç”¨ä¹‹å‰å°±å·²ç»è¢«èµ‹äºˆäº†ä¸€ä¸ªå€¼ã€‚å”¯ä¸€å®‰å…¨çš„é€‰æ‹©æ˜¯è¦æ±‚å£°æ˜æœ¬èº«æœ‰ä¸€ä¸ªåˆå§‹åŒ–è¡¨è¾¾å¼ï¼Œäº§ç”Ÿä¸€ä¸ªæ­£ç¡®ç±»å‹çš„å€¼ã€‚  // Using null safety: int topLevel = 0; class SomeClass { static int staticField = 0; }  å®ä¾‹å­—æ®µå¿…é¡»åœ¨å£°æ˜æ—¶æœ‰ä¸€ä¸ªåˆå§‹åŒ–å™¨ï¼Œä½¿ç”¨åˆå§‹åŒ–å½¢å¼ï¼Œæˆ–è€…åœ¨æ„é€ å‡½æ•°çš„åˆå§‹åŒ–åˆ—è¡¨ä¸­åˆå§‹åŒ–ã€‚è¿™æœ‰å¾ˆå¤šè¡Œè¯ã€‚ä¸‹é¢æ˜¯ä¾‹å­ã€‚  // Using null safety: class SomeClass { int atDeclaration = 0; int initializingFormal; int initializationList; SomeClass(this.initializingFormal) : initializationList = 0; } æ¢å¥è¯è¯´ï¼Œåªè¦å­—æ®µåœ¨åˆ°è¾¾æ„é€ å‡½æ•°ä½“ä¹‹å‰å°±æœ‰ä¸€ä¸ªå€¼ï¼Œå°±å¯ä»¥äº†ã€‚\n å±€éƒ¨å˜é‡æ˜¯æœ€çµæ´»çš„æƒ…å†µã€‚ä¸€ä¸ªä¸å¯ç©ºçš„å±€éƒ¨å˜é‡ä¸éœ€è¦æœ‰ä¸€ä¸ªåˆå§‹åŒ–å™¨ã€‚è¿™å®Œå…¨å¯ä»¥ã€‚  // Using null safety: int tracingFibonacci(int n) { int result; if (n \u0026lt; 2) { result = n; } else { result = tracingFibonacci(n - 2) + tracingFibonacci(n - 1); } print(result); return result; } è§„åˆ™åªæ˜¯å±€éƒ¨å˜é‡åœ¨ä½¿ç”¨å‰å¿…é¡»è‚¯å®šåˆ†é…ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¾é æˆ‘æ‰€æåˆ°çš„æ–°æµåˆ†ææ¥å®ç°ã€‚åªè¦æ¯ä¸ªé€šå¾€å˜é‡ä½¿ç”¨çš„è·¯å¾„éƒ½å…ˆåˆå§‹åŒ–å®ƒï¼Œä½¿ç”¨å°±å¯ä»¥äº†ã€‚\n å¯é€‰å‚æ•°å¿…é¡»æœ‰ä¸€ä¸ªé»˜è®¤å€¼ã€‚å¦‚æœä½ æ²¡æœ‰ä¸ºä¸€ä¸ªå¯é€‰çš„ä½ç½®å‚æ•°æˆ–å‘½åå‚æ•°ä¼ é€’ä¸€ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆè¯­è¨€å°±ä¼šç”¨é»˜è®¤å€¼æ¥å¡«å……å®ƒã€‚å¦‚æœä½ ä¸æŒ‡å®šé»˜è®¤å€¼ï¼Œé‚£ä¹ˆé»˜è®¤çš„é»˜è®¤å€¼å°±æ˜¯ nullï¼Œå¦‚æœå‚æ•°çš„ç±»å‹æ˜¯ä¸å¯ç©ºçš„ï¼Œé‚£å°±é£ä¸èµ·æ¥äº†ã€‚  æ‰€ä»¥ï¼Œå¦‚æœä½ æƒ³è®©ä¸€ä¸ªå‚æ•°æ˜¯å¯é€‰çš„ï¼Œä½ éœ€è¦è®©å®ƒå˜æˆ nullï¼Œæˆ–è€…æŒ‡å®šä¸€ä¸ªæœ‰æ•ˆçš„éç©ºçš„é»˜è®¤å€¼ã€‚\nè¿™äº›é™åˆ¶å¬èµ·æ¥å¾ˆç¹çï¼Œä½†åœ¨å®è·µä¸­å¹¶ä¸å¤ªåã€‚å®ƒä»¬ä¸ç°æœ‰çš„å›´ç»•æœ€ç»ˆå˜é‡çš„é™åˆ¶éå¸¸ç›¸ä¼¼ï¼Œè€Œä¸”ä½ å¯èƒ½å·²ç»ä½¿ç”¨è¿™äº›é™åˆ¶å¤šå¹´ï¼Œç”šè‡³æ²¡æœ‰çœŸæ­£æ³¨æ„åˆ°ã€‚å¦å¤–ï¼Œè¯·è®°ä½ï¼Œè¿™äº›é™åˆ¶åªé€‚ç”¨äºä¸å¯ç©ºå€¼çš„å˜é‡ã€‚ä½ æ€»æ˜¯å¯ä»¥è®©ç±»å‹å¯ç©ºï¼Œç„¶åè®©é»˜è®¤åˆå§‹åŒ–ä¸ºç©ºã€‚\nå³ä¾¿å¦‚æ­¤ï¼Œè¿™äº›è§„åˆ™ä¹Ÿä¼šé€ æˆæ‘©æ“¦ã€‚å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬æœ‰ä¸€å¥—æ–°çš„è¯­è¨€ç‰¹æ€§æ¥æ¶¦æ»‘æœ€å¸¸è§çš„æ¨¡å¼ï¼Œåœ¨è¿™äº›æ–°çš„é™åˆ¶ä¸‹ï¼Œä½ çš„é€Ÿåº¦å˜æ…¢äº†ã€‚ä¸è¿‡ï¼Œé¦–å…ˆï¼Œæ˜¯æ—¶å€™è°ˆè°ˆæµåˆ†æäº†ã€‚\næµç¨‹åˆ†æ æ§åˆ¶æµåˆ†æåœ¨ç¼–è¯‘å™¨ä¸­å·²ç»å­˜åœ¨å¤šå¹´ã€‚å®ƒå¤§å¤šè¢«ç”¨æˆ·éšè—èµ·æ¥ï¼Œåœ¨ç¼–è¯‘å™¨ä¼˜åŒ–è¿‡ç¨‹ä¸­ä½¿ç”¨ï¼Œä½†ä¸€äº›æ–°çš„è¯­è¨€å·²ç»å¼€å§‹ä½¿ç”¨åŒæ ·çš„æŠ€æœ¯æ¥å®ç°å¯è§çš„è¯­è¨€åŠŸèƒ½ã€‚Dart å·²ç»åœ¨ç±»å‹æ¨å¹¿çš„å½¢å¼ä¸‹æœ‰äº†ä¸€æŠ¹æµåˆ†æã€‚\n// With (or without) null safety: bool isEmptyList(Object object) { if (object is List) { return object.isEmpty; // \u0026lt;-- OK!  } else { return false; } } è¯·æ³¨æ„ï¼Œåœ¨æ ‡è®°è¡Œä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¯¹è±¡ä¸Šè°ƒç”¨ isEmptyã€‚è¯¥æ–¹æ³•å®šä¹‰åœ¨ List ä¸Šï¼Œè€Œä¸æ˜¯ Object ä¸Šã€‚è¿™æ˜¯å› ä¸ºç±»å‹æ£€æŸ¥å™¨ä¼šæŸ¥çœ‹ç¨‹åºä¸­æ‰€æœ‰çš„ is è¡¨è¾¾å¼å’Œæ§åˆ¶æµè·¯å¾„ã€‚å¦‚æœæŸä¸ªæ§åˆ¶æµæ„é€ ä½“åªæœ‰åœ¨å˜é‡ä¸Šçš„æŸä¸ª is è¡¨è¾¾å¼ä¸ºçœŸæ—¶æ‰ä¼šæ‰§è¡Œï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªæ„é€ ä½“é‡Œé¢ï¼Œå˜é‡çš„ç±»å‹å°±ä¼šè¢« \u0026ldquo;æ¨å¹¿ \u0026ldquo;åˆ°æµ‹è¯•ç±»å‹ã€‚\nåœ¨è¿™é‡Œçš„ä¾‹å­ä¸­ï¼Œif è¯­å¥çš„ then åˆ†æ”¯åªæœ‰åœ¨ object å®é™…åŒ…å«ä¸€ä¸ª list æ—¶æ‰ä¼šè¿è¡Œã€‚å› æ­¤ï¼ŒDart å°†å¯¹è±¡æ¨å¹¿åˆ° List ç±»å‹ï¼Œè€Œä¸æ˜¯å…¶å£°æ˜çš„ Object ç±»å‹ã€‚è¿™æ˜¯ä¸€ä¸ªæ–¹ä¾¿çš„åŠŸèƒ½ï¼Œä½†å®ƒæ˜¯ç›¸å½“æœ‰é™çš„ã€‚åœ¨ null å®‰å…¨ä¹‹å‰ï¼Œä¸‹é¢çš„åŠŸèƒ½ç›¸åŒçš„ç¨‹åºæ— æ³•å·¥ä½œã€‚\n// Without null safety: bool isEmptyList(Object object) { if (object is! List) return false; return object.isEmpty; // \u0026lt;-- Error! } åŒæ ·ï¼Œåªæœ‰å½“å¯¹è±¡åŒ…å«ä¸€ä¸ª list æ—¶ï¼Œæ‰èƒ½è¾¾åˆ°.isEmpty çš„è°ƒç”¨ï¼Œæ‰€ä»¥è¿™ä¸ªç¨‹åºæ˜¯åŠ¨æ€æ­£ç¡®çš„ã€‚ä½†æ˜¯ç±»å‹æ¨å¹¿è§„åˆ™ä¸å¤Ÿèªæ˜ï¼Œæ²¡æœ‰çœ‹åˆ°è¿”å›è¯­å¥æ„å‘³ç€åªæœ‰å½“å¯¹è±¡æ˜¯ä¸€ä¸ª list æ—¶æ‰èƒ½åˆ°è¾¾ç¬¬äºŒä¸ªè¯­å¥ã€‚\nå¯¹äºç©ºå®‰å…¨ï¼Œæˆ‘ä»¬æŠŠè¿™ç§æœ‰é™çš„åˆ†ææ–¹æ³•ï¼Œåœ¨å‡ ä¸ªæ–¹é¢åšå¾—æ›´åŠ å¼ºå¤§ã€‚\nå¯åˆ°è¾¾æ€§åˆ†æ é¦–å…ˆï¼Œæˆ‘ä»¬ä¿®å¤äº†é•¿æœŸä»¥æ¥çš„æŠ±æ€¨ï¼Œå³ç±»å‹æ¨å¹¿å¯¹æ—©æœŸè¿”å›å’Œå…¶ä»–æ— æ³•åˆ°è¾¾çš„ä»£ç è·¯å¾„å¹¶ä¸èªæ˜ã€‚å½“åˆ†æä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå®ƒç°åœ¨ä¼šè€ƒè™‘åˆ°è¿”å›ã€breakã€æŠ›å‡ºä»¥åŠå‡½æ•°ä¸­ä»»ä½•å…¶ä»–å¯èƒ½æå‰ç»ˆæ­¢æ‰§è¡Œçš„æ–¹å¼ã€‚åœ¨ç©ºå®‰å…¨ä¸‹ï¼Œè¿™ä¸ªå‡½æ•°ã€‚\n// Using null safety: bool isEmptyList(Object object) { if (object is! List) return false; return object.isEmpty; } ç°åœ¨æ˜¯å®Œå…¨æœ‰æ•ˆçš„ã€‚å› ä¸º if è¯­å¥ä¼šåœ¨å¯¹è±¡ä¸æ˜¯ List æ—¶é€€å‡ºå‡½æ•°ï¼Œæ‰€ä»¥ Dart ä¼šåœ¨ç¬¬äºŒæ¡è¯­å¥ä¸­ä¿ƒè¿›å¯¹è±¡æˆä¸º Listã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„æ”¹è¿›ï¼Œå®ƒå¸®åŠ©äº†å¾ˆå¤š Dart ä»£ç ï¼Œç”šè‡³æ˜¯ä¸ nullability æ— å…³çš„ä¸œè¥¿ã€‚\nNever - ä¸å¯è¾¾åˆ°çš„ä»£ç  æ‚¨ä¹Ÿå¯ä»¥å¯¹è¿™ç§å¯è¾¾åˆ°æ€§åˆ†æè¿›è¡Œç¼–ç¨‹ã€‚æ–°çš„åº•ç±»å‹ Never æ²¡æœ‰å€¼ã€‚(ä»€ä¹ˆæ ·çš„å€¼åŒæ—¶æ˜¯ Stringã€bool å’Œ int å‘¢ï¼Ÿ)é‚£ä¹ˆä¸€ä¸ªè¡¨è¾¾å¼å…·æœ‰ Never ç±»å‹æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿæ„å‘³ç€è¯¥è¡¨è¾¾å¼æ°¸è¿œä¸èƒ½æˆåŠŸå®Œæˆè¯„ä¼°ã€‚å®ƒå¿…é¡»æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œä¸­æ­¢ï¼Œæˆ–è€…ä»¥å…¶ä»–æ–¹å¼ç¡®ä¿æœŸæœ›è¡¨è¾¾å¼ç»“æœçš„å‘¨å›´ä»£ç æ°¸è¿œä¸ä¼šè¿è¡Œã€‚\näº‹å®ä¸Šï¼Œæ ¹æ®è¯­è¨€çš„è§„å®šï¼ŒæŠ›å‡ºè¡¨è¾¾å¼çš„é™æ€ç±»å‹æ˜¯ Neverã€‚Never ç±»å‹åœ¨æ ¸å¿ƒåº“ä¸­è¢«å£°æ˜ï¼Œä½ å¯ä»¥å°†å…¶ä½œä¸ºç±»å‹æ³¨é‡Šã€‚ä¹Ÿè®¸ä½ æœ‰ä¸€ä¸ªå¸®åŠ©å‡½æ•°ï¼Œä»¥æ–¹ä¾¿æŠ›å‡ºæŸç§å¼‚å¸¸ã€‚\n// Using null safety: Never wrongType(String type, Object value) { throw ArgumentError(\u0026#39;Expected $type, but was ${value.runtimeType}.\u0026#39;); } ä½ å¯ä»¥è¿™æ ·ä½¿ç”¨ã€‚\n// Using null safety: class Point { final double x, y; bool operator ==(Object other) { if (other is! Point) wrongType(\u0026#39;Point\u0026#39;, other); return x == other.x \u0026amp;\u0026amp; y == other.y; } // Constructor and hashCode... } è¿™ä¸ªç¨‹åºåˆ†æèµ·æ¥æ²¡æœ‰é”™è¯¯ã€‚è¯·æ³¨æ„ï¼Œ==æ–¹æ³•çš„æœ€åä¸€è¡Œè®¿é—®äº†å…¶ä»–çš„.x å’Œ.yã€‚å°½ç®¡å‡½æ•°æ²¡æœ‰ä»»ä½•è¿”å›æˆ–æŠ›å‡ºï¼Œä½†å®ƒå·²ç»è¢«æå‡ä¸º Pointã€‚æ§åˆ¶æµåˆ†æçŸ¥é“ï¼ŒwrongType()çš„å£°æ˜ç±»å‹æ˜¯ Neverï¼Œè¿™æ„å‘³ç€ if è¯­å¥çš„ then åˆ†æ”¯å¿…é¡»ä»¥æŸç§æ–¹å¼ä¸­æ­¢ã€‚ç”±äºç¬¬äºŒæ¡è¯­å¥åªæœ‰åœ¨ other æ˜¯ Point æ—¶æ‰èƒ½åˆ°è¾¾ï¼Œæ‰€ä»¥ Dart æå€¡ä½¿ç”¨å®ƒã€‚\næ¢å¥è¯è¯´ï¼Œåœ¨ä½ è‡ªå·±çš„ API ä¸­ä½¿ç”¨ Never å¯ä»¥è®©ä½ æ‰©å±• Dart çš„å¯è¾¾æ€§åˆ†æã€‚\nç¡®å®šèµ‹å€¼åˆ†æ è¿™ä¸ªæˆ‘ç®€å•çš„æåˆ°äº†å±€éƒ¨å˜é‡ã€‚Dart éœ€è¦ç¡®ä¿ä¸€ä¸ªä¸å¯ç©ºçš„å±€éƒ¨å˜é‡åœ¨è¯»å–ä¹‹å‰æ€»æ˜¯è¢«åˆå§‹åŒ–ã€‚æˆ‘ä»¬ä½¿ç”¨ç¡®å®šèµ‹å€¼åˆ†ææ¥å°½å¯èƒ½çµæ´»åœ°å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚è¯¥è¯­è¨€åˆ†ææ¯ä¸ªå‡½æ•°ä½“ï¼Œå¹¶é€šè¿‡æ‰€æœ‰æ§åˆ¶æµè·¯å¾„è·Ÿè¸ªå±€éƒ¨å˜é‡å’Œå‚æ•°çš„èµ‹å€¼ã€‚åªè¦åœ¨æ¯ä¸€æ¡åˆ°è¾¾æŸä¸ªä½¿ç”¨å˜é‡çš„è·¯å¾„ä¸Šéƒ½å¯¹å˜é‡è¿›è¡Œäº†èµ‹å€¼ï¼Œå°±è®¤ä¸ºè¯¥å˜é‡å·²ç»åˆå§‹åŒ–ã€‚è¿™è®©ä½ å¯ä»¥åœ¨æ²¡æœ‰åˆå§‹åŒ–å™¨çš„æƒ…å†µä¸‹å£°æ˜ä¸€ä¸ªå˜é‡ï¼Œç„¶ååœ¨ä¹‹åä½¿ç”¨å¤æ‚çš„æ§åˆ¶æµå¯¹å…¶è¿›è¡Œåˆå§‹åŒ–ï¼Œå³ä½¿è¯¥å˜é‡å…·æœ‰ä¸å¯ç©ºå€¼çš„ç±»å‹ã€‚\næˆ‘ä»¬è¿˜ä½¿ç”¨ç¡®å®šèµ‹å€¼åˆ†ææ¥ä½¿æœ€ç»ˆå˜é‡æ›´åŠ çµæ´»ã€‚åœ¨ç©ºå®‰å…¨ä¹‹å‰ï¼Œå¦‚æœä½ éœ€è¦ä»¥ä»»ä½•ä¸€ç§æœ‰è¶£çš„æ–¹å¼å¯¹å±€éƒ¨å˜é‡è¿›è¡Œåˆå§‹åŒ–ï¼Œé‚£ä¹ˆä½¿ç”¨ final æ˜¯å¾ˆå›°éš¾çš„ã€‚\n// Using null safety: int tracingFibonacci(int n) { final int result; if (n \u0026lt; 2) { result = n; } else { result = tracingFibonacci(n - 2) + tracingFibonacci(n - 1); } print(result); return result; } è¿™å°†æ˜¯ä¸€ä¸ªé”™è¯¯ï¼Œå› ä¸ºç»“æœå˜é‡æ˜¯ finalï¼Œä½†æ²¡æœ‰åˆå§‹åŒ–å™¨ã€‚åœ¨ç©ºå®‰å…¨ä¸‹è¿›è¡Œæ›´æ™ºèƒ½çš„æµåˆ†æï¼Œè¿™ä¸ªç¨‹åºæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚åˆ†æå¯ä»¥çŸ¥é“ï¼Œåœ¨æ¯æ¡æ§åˆ¶æµè·¯å¾„ä¸Šï¼Œresult è‚¯å®šæ˜¯ç²¾ç¡®åœ°åˆå§‹åŒ–äº†ä¸€æ¬¡ï¼Œæ‰€ä»¥æ ‡è®°å˜é‡ final çš„çº¦æŸæ¡ä»¶æ˜¯æ»¡è¶³çš„ã€‚\nå¯¹ç©ºæ£€æŸ¥çš„ç±»å‹æå‡ æ›´åŠ æ™ºèƒ½çš„æµç¨‹åˆ†æå¸®åŠ©äº†å¾ˆå¤š Dart ä»£ç ï¼Œç”šè‡³æ˜¯ä¸ç©ºæ€§æ— å…³çš„ä»£ç ã€‚ä½†æˆ‘ä»¬ç°åœ¨åšè¿™äº›æ”¹å˜å¹¶ä¸æ˜¯å¶ç„¶çš„ã€‚æˆ‘ä»¬æŠŠç±»å‹åˆ†ä¸ºå¯ç©ºæ€§å’Œéå¯ç©ºæ€§é›†ã€‚å¦‚æœä½ æœ‰ä¸€ä¸ªå¯ç©ºç±»å‹çš„å€¼ï¼Œä½ å°±ä¸èƒ½çœŸæ­£å¯¹å®ƒåšä»»ä½•æœ‰ç”¨çš„äº‹æƒ…ã€‚åœ¨å€¼ä¸ºç©ºçš„æƒ…å†µä¸‹ï¼Œè¿™ç§é™åˆ¶æ˜¯å¥½çš„ã€‚å®ƒå¯ä»¥é˜²æ­¢ä½ å´©æºƒã€‚\nä½†å¦‚æœå€¼ä¸æ˜¯ç©ºçš„ï¼Œèƒ½å¤ŸæŠŠå®ƒç§»åˆ°éå¯ç©ºçš„ä¸€é¢ï¼Œè¿™æ ·ä½ å°±å¯ä»¥å¯¹å®ƒè°ƒç”¨æ–¹æ³•ï¼Œè¿™å°†æ˜¯ä¸€ä»¶å¥½äº‹ã€‚å¯¹äºå±€éƒ¨å˜é‡å’Œå‚æ•°æ¥è¯´ï¼Œæµç¨‹åˆ†ææ˜¯å®ç°è¿™ä¸€ç‚¹çš„ä¸»è¦æ–¹æ³•ä¹‹ä¸€ã€‚æˆ‘ä»¬å·²ç»æ‰©å±•äº†ç±»å‹æå‡ï¼Œè¿˜å¯ä»¥æŸ¥çœ‹ == null å’Œ != null è¡¨è¾¾å¼ã€‚\nå¦‚æœä½ æ£€æŸ¥ä¸€ä¸ªå¯ç©ºç±»å‹çš„å˜é‡ï¼Œçœ‹çœ‹å®ƒæ˜¯ä¸æ˜¯ç©ºçš„ï¼ŒDart å°±ä¼šæŠŠè¿™ä¸ªå˜é‡æ¨å¹¿åˆ°åº•å±‚çš„éå¯ç©ºç±»å‹ã€‚\n// Using null safety: String makeCommand(String executable, [List\u0026lt;String\u0026gt;? arguments]) { var result = executable; if (arguments != null) { result += \u0026#39; \u0026#39; + arguments.join(\u0026#39; \u0026#39;); } } è¿™é‡Œï¼Œarguments æœ‰ä¸€ä¸ªå¯ç©ºçš„ç±»å‹ã€‚é€šå¸¸ï¼Œè¿™ç¦æ­¢ä½ å¯¹å®ƒè°ƒç”¨.join()ã€‚ä½†æ˜¯ç”±äºæˆ‘ä»¬åœ¨ if è¯­å¥ä¸­å¯¹è¯¥è°ƒç”¨è¿›è¡Œäº†ä¿æŠ¤ï¼Œæ£€æŸ¥ä»¥ç¡®ä¿è¯¥å€¼ä¸æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥ Dart å°†å…¶ä» List\u0026lt;String\u0026gt; æå‡ä¸º List\u0026lt;String\u0026gt;ï¼Œå¹¶å…è®¸ä½ åœ¨å…¶ä¸Šè°ƒç”¨æ–¹æ³•æˆ–å°†å…¶ä¼ é€’ç»™æœŸæœ›éç©ºå€¼åˆ—è¡¨çš„å‡½æ•°ã€‚\nè¿™å¬èµ·æ¥æ˜¯ä¸€ä»¶ç›¸å½“å°çš„äº‹æƒ…ï¼Œä½†è¿™ç§åŸºäºæµç¨‹çš„å¯¹ null æ£€æŸ¥çš„æ¨å¹¿æ˜¯ä½¿å¤§å¤šæ•°ç°æœ‰ Dart ä»£ç åœ¨ null å®‰å…¨ä¸‹å·¥ä½œçš„åŸå› ã€‚å¤§å¤šæ•° Dart ä»£ç éƒ½æ˜¯åŠ¨æ€æ­£ç¡®çš„ï¼Œå¹¶ä¸”ç¡®å®é€šè¿‡åœ¨è°ƒç”¨æ–¹æ³•ä¹‹å‰æ£€æŸ¥ç©ºå€¼æ¥é¿å…æŠ›å‡ºç©ºå€¼å¼•ç”¨é”™è¯¯ã€‚æ–°çš„å…³äº null æ£€æŸ¥çš„æµç¨‹åˆ†æå°†è¿™ç§åŠ¨æ€æ­£ç¡®æ€§å˜æˆäº†å¯è¯æ˜çš„é™æ€æ­£ç¡®æ€§ã€‚\nå½“ç„¶ï¼Œå®ƒä¹Ÿèƒ½é…åˆæˆ‘ä»¬å¯¹å¯åˆ°è¾¾æ€§çš„æ›´æ™ºèƒ½çš„åˆ†æã€‚ä¸Šé¢çš„å‡½æ•°ä¹Ÿå¯ä»¥å†™æˆä¸€æ ·ã€‚\n// Using null safety: String makeCommand(String executable, [List\u0026lt;String\u0026gt;? arguments]) { var result = executable; if (arguments == null) return result; return result + \u0026#39; \u0026#39; + arguments.join(\u0026#39; \u0026#39;); } è¯­è¨€ä¹Ÿæ¯”è¾ƒèªæ˜ï¼Œä»€ä¹ˆæ ·çš„è¡¨è¾¾æ–¹å¼ä¼šå¼•èµ·æ¨å¹¿ã€‚æ˜¾å¼ == null æˆ– != null å½“ç„¶å¯ä»¥ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨ asã€assignments æˆ–æˆ‘ä»¬å³å°†æåˆ°çš„åç¼€ ! æ“ä½œç¬¦çš„æ˜¾å¼æŠ•æ·ä¹Ÿä¼šå¯¼è‡´æå‡ã€‚æ€»çš„ç›®æ ‡æ˜¯ï¼Œå¦‚æœä»£ç æ˜¯åŠ¨æ€æ­£ç¡®çš„ï¼Œè€Œä¸”é™æ€åœ°æ‰¾å‡ºè¿™ä¸€ç‚¹æ˜¯åˆç†çš„ï¼Œåˆ†æåº”è¯¥è¶³å¤Ÿèªæ˜ã€‚\nä¸å¿…è¦çš„ä»£ç è­¦å‘Š æ‹¥æœ‰æ›´æ™ºèƒ½çš„å¯è¾¾æ€§åˆ†æï¼Œå¹¶çŸ¥é“ null å¯èƒ½æµç»ä½ çš„ç¨‹åºçš„åœ°æ–¹ï¼Œæœ‰åŠ©äºç¡®ä¿ä½ æ·»åŠ ä»£ç æ¥å¤„ç† nullã€‚ä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨åŒæ ·çš„åˆ†ææ¥æ£€æµ‹ä½ ä¸éœ€è¦çš„ä»£ç ã€‚åœ¨ null å®‰å…¨ä¹‹å‰ï¼Œå¦‚æœä½ å†™äº†è¿™æ ·çš„ä¸œè¥¿ã€‚\n// Using null safety: String checkList(List list) { if (list?.isEmpty) { return \u0026#39;Got nothing\u0026#39;; } return \u0026#39;Got something\u0026#39;; } Dart æ²¡æœ‰åŠæ³•çŸ¥é“é‚£ä¸ª null-aware? æ“ä½œç¬¦æ˜¯å¦æœ‰ç”¨ã€‚å®ƒåªçŸ¥é“ï¼Œä½ å¯ä»¥æŠŠ null ä¼ ç»™å‡½æ•°ã€‚ä½†æ˜¯åœ¨ null safe Dart ä¸­ï¼Œå¦‚æœä½ ç”¨ç°åœ¨ä¸å¯ç©ºçš„ List ç±»å‹æ³¨é‡Šäº†é‚£ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆå®ƒçŸ¥é“ list æ°¸è¿œä¸ä¼šæ˜¯ nullã€‚è¿™å°±æ„å‘³ç€è¿™ä¸ª ?. æ°¸è¿œä¸ä¼šåšä»»ä½•æœ‰ç”¨çš„äº‹æƒ…ï¼Œä½ å¯ä»¥è€Œä¸”åº”è¯¥åªä½¿ç”¨ . ç±»å‹ã€‚\nä¸ºäº†å¸®åŠ©ä½ ç®€åŒ–ä½ çš„ä»£ç ï¼Œæˆ‘ä»¬å·²ç»ä¸ºè¿™æ ·çš„ä¸å¿…è¦çš„ä»£ç æ·»åŠ äº†è­¦å‘Šï¼Œç°åœ¨é™æ€åˆ†æå·²ç»ç²¾ç¡®åˆ°å¯ä»¥æ£€æµ‹åˆ°å®ƒäº†ã€‚åœ¨ä¸€ä¸ªä¸å¯ç©ºç±»å‹ä¸Šä½¿ç”¨ä¸€ä¸ª null-aware æ“ä½œç¬¦ï¼Œç”šè‡³æ˜¯åƒ== null æˆ– != null è¿™æ ·çš„æ£€æŸ¥ï¼Œéƒ½ä¼šè¢«æŠ¥å‘Šä¸ºä¸€ä¸ªè­¦å‘Šã€‚\nå½“ç„¶ï¼Œè¿™ä¹Ÿä¸éç©ºç±»å‹çš„æ™‹å‡æœ‰å…³ã€‚ä¸€æ—¦ä¸€ä¸ªå˜é‡è¢«æ¨å¹¿åˆ°ä¸€ä¸ªä¸å¯ç©ºç±»å‹ï¼Œå¦‚æœä½ å†æ¬¡å¯¹å®ƒè¿›è¡Œå¤šä½™çš„ null æ£€æŸ¥ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªè­¦å‘Šã€‚\n// Using null safety: checkList(List? list) { if (list == null) return \u0026#39;No list\u0026#39;; if (list?.isEmpty) { return \u0026#39;Empty list\u0026#39;; } return \u0026#39;Got something\u0026#39;; } ä½ åœ¨è¿™é‡Œå¾—åˆ°äº†ä¸€ä¸ªè­¦å‘Šï¼Œå› ä¸ºåœ¨å®ƒæ‰§è¡Œçš„æ—¶å€™ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“ list ä¸èƒ½ä¸ºç©ºã€‚è¿™äº›è­¦å‘Šçš„ç›®çš„ä¸ä»…ä»…æ˜¯æ¸…ç†æ— æ„ä¹‰çš„ä»£ç ã€‚é€šè¿‡åˆ é™¤ä¸éœ€è¦çš„ null æ£€æŸ¥ï¼Œæˆ‘ä»¬ç¡®ä¿å‰©ä¸‹çš„æœ‰æ„ä¹‰çš„æ£€æŸ¥èƒ½å¤Ÿè„±é¢–è€Œå‡ºã€‚æˆ‘ä»¬å¸Œæœ›æ‚¨èƒ½å¤ŸæŸ¥çœ‹æ‚¨çš„ä»£ç ï¼Œå¹¶çœ‹åˆ° null å¯ä»¥åœ¨å“ªé‡ŒæµåŠ¨ã€‚\nä½¿ç”¨å¯ç©ºç±»å‹ æˆ‘ä»¬ç°åœ¨å·²ç»æŠŠ null æ”¶è¿›äº†å¯ç©ºç±»å‹çš„é›†åˆã€‚é€šè¿‡æµç¨‹åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°è®©ä¸€äº›éç©ºå€¼è¶Šè¿‡æ …æ è·³åˆ°éå¯ç©ºç±»å‹çš„ä¸€è¾¹ï¼Œåœ¨é‚£é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒä»¬ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„è¿›æ­¥ï¼Œä½†å¦‚æœæˆ‘ä»¬åœ¨è¿™é‡Œåœä¸‹æ¥ï¼Œæ‰€äº§ç”Ÿçš„ç³»ç»Ÿä»ç„¶æ˜¯ç—›è‹¦çš„é™åˆ¶ã€‚æµç¨‹åˆ†æåªå¯¹å±€éƒ¨å’Œå‚æ•°æœ‰å¸®åŠ©ã€‚\nä¸ºäº†å°½é‡æ¢å¤ Dart åœ¨ null å®‰å…¨ä¹‹å‰çš„çµæ´»æ€§\u0026ndash;å¹¶ä¸”åœ¨æŸäº›åœ°æ–¹è¶…è¶Šå®ƒï¼Œæˆ‘ä»¬æœ‰ä¸€äº›å…¶ä»–çš„æ–°ç‰¹æ€§ã€‚\næ›´åŠ æ™ºèƒ½çš„ç©ºæ„ŸçŸ¥æ–¹æ³• Dart çš„ null aware æ“ä½œç¬¦ ?. æ¯” null safety æ›´æ—©ã€‚è¿è¡Œæ—¶è¯­ä¹‰è§„å®šï¼Œå¦‚æœæ¥æ”¶è€…ä¸ºç©ºï¼Œé‚£ä¹ˆå³ä¾§çš„å±æ€§è®¿é—®å°†è¢«è·³è¿‡ï¼Œè¡¨è¾¾å¼è¯„ä»·ä¸ºç©ºã€‚\n// Without null safety: String notAString = null; print(notAString?.length); è¿™ä¸æ˜¯æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œè€Œæ˜¯æ‰“å° \u0026ldquo;null\u0026rdquo;ã€‚null-aware æ“ä½œç¬¦æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å·¥å…·ï¼Œå®ƒä½¿å¯ç©ºç±»å‹åœ¨ Dart ä¸­å¯ç”¨ã€‚è™½ç„¶æˆ‘ä»¬ä¸èƒ½è®©ä½ åœ¨å¯ç©ºç±»å‹ä¸Šè°ƒç”¨æ–¹æ³•ï¼Œä½†æˆ‘ä»¬å¯ä»¥ä¹Ÿç¡®å®è®©ä½ åœ¨å®ƒä»¬ä¸Šä½¿ç”¨ null-aware æ“ä½œç¬¦ã€‚ç©ºå€¼åå®‰å…¨ç‰ˆæœ¬çš„ç¨‹åºæ˜¯ã€‚\n// Using null safety: String? notAString = null; print(notAString?.length); å®ƒçš„å·¥ä½œåŸç†å’Œä¹‹å‰çš„ä¸€æ ·ã€‚\nç„¶è€Œï¼Œå¦‚æœä½ æ›¾ç»åœ¨ Dart ä¸­ä½¿ç”¨è¿‡ null-aware æ“ä½œç¬¦ï¼Œå½“ä½ åœ¨æ–¹æ³•é“¾ä¸­ä½¿ç”¨å®ƒä»¬æ—¶ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°ä¸€ä¸ªçƒ¦æ¼ã€‚æ¯”æ–¹è¯´ï¼Œä½ æƒ³çœ‹çœ‹ä¸€ä¸ªå¯èƒ½ä¸å­˜åœ¨çš„å­—ç¬¦ä¸²çš„é•¿åº¦æ˜¯å¦æ˜¯ä¸€ä¸ªå¶æ•°ï¼ˆä¸æ˜¯ä¸€ä¸ªç‰¹åˆ«ç°å®çš„é—®é¢˜ï¼Œæˆ‘çŸ¥é“ï¼Œä½†è¯·å’Œæˆ‘ä¸€èµ·å·¥ä½œï¼‰ã€‚\n// Using null safety: String? notAString = null; print(notAString?.length.isEven); å³ä½¿è¿™ä¸ªç¨‹åºä½¿ç”¨äº†?ï¼Œä½†åœ¨è¿è¡Œæ—¶è¿˜æ˜¯ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚é—®é¢˜åœ¨äº.isEven è¡¨è¾¾å¼çš„æ¥æ”¶è€…æ˜¯å®ƒå·¦è¾¹çš„æ•´ä¸ª notAString?.length è¡¨è¾¾å¼çš„ç»“æœã€‚è¯¥è¡¨è¾¾å¼çš„å€¼ä¸º nullï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å°è¯•è°ƒç”¨.isEven æ—¶å¾—åˆ°ä¸€ä¸ªç©ºå€¼å¼•ç”¨é”™è¯¯ã€‚å¦‚æœä½ æ›¾ç»åœ¨ Dart ä¸­ä½¿ç”¨è¿‡?.ï¼Œä½ å¯èƒ½å­¦åˆ°äº†ä¸€ä¸ªè‹¦æ¶©çš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯åœ¨ä½ ä½¿ç”¨è¿‡ä¸€æ¬¡ä¹‹åï¼Œä½ å¿…é¡»å°† null-aware æ“ä½œç¬¦åº”ç”¨åˆ°é“¾ä¸­çš„æ¯ä¸ªå±æ€§æˆ–æ–¹æ³•ã€‚\nString? notAString = null; print(notAString?.length?.isEven); è¿™å¾ˆçƒ¦äººï¼Œä½†æ›´ç³Ÿç³•çš„æ˜¯ï¼Œå®ƒæ©ç›–äº†é‡è¦ä¿¡æ¯ã€‚è€ƒè™‘ä¸€ä¸‹ï¼š\n// Using null safety: showGizmo(Thing? thing) { print(thing?.doohickey?.gizmo); } æˆ‘æœ‰ä¸ªé—®é¢˜è¦é—®ä½ ã€‚Thing ä¸Šçš„ doohickey getter å¯ä»¥è¿”å› null å—ï¼Ÿçœ‹èµ·æ¥å¯ä»¥ï¼Œå› ä¸ºä½ åœ¨ç»“æœä¸Šä½¿ç”¨äº†?ã€‚ä½†å¯èƒ½åªæ˜¯ç¬¬äºŒä¸ª?.åªæ˜¯ä¸ºäº†å¤„ç† thing ä¸º null çš„æƒ…å†µï¼Œè€Œä¸æ˜¯ doohickey çš„ç»“æœã€‚ä½ æ— æ³•åˆ¤æ–­ã€‚\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å€Ÿé‰´äº† C#è®¾è®¡ç›¸åŒåŠŸèƒ½çš„ä¸€ä¸ªèªæ˜çš„æƒ³æ³•ã€‚å½“ä½ åœ¨ä¸€ä¸ªæ–¹æ³•é“¾ä¸­ä½¿ç”¨ä¸€ä¸ª null-aware æ“ä½œç¬¦æ—¶ï¼Œå¦‚æœæ¥æ”¶è€…è¯„ä¼°ä¸º nullï¼Œé‚£ä¹ˆæ•´ä¸ªæ–¹æ³•é“¾çš„å…¶ä½™éƒ¨åˆ†éƒ½ä¼šè¢«çŸ­è·¯å¹¶è·³è¿‡ã€‚è¿™æ„å‘³ç€å¦‚æœ doohickey æœ‰ä¸€ä¸ªä¸å¯ç©ºçš„è¿”å›ç±»å‹ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä¹Ÿåº”è¯¥å†™ã€‚\n// Using null safety: showGizmo(Thing? thing) { print(thing?.doohickey.gizmo); } äº‹å®ä¸Šï¼Œå¦‚æœä½ ä¸è¿™æ ·åšï¼Œä½ ä¼šåœ¨ç¬¬äºŒä¸ª?ä¸Šå¾—åˆ°ä¸€ä¸ªä¸å¿…è¦çš„ä»£ç è­¦å‘Šã€‚å¦‚æœä½ çœ‹åˆ°è¿™æ ·çš„ä»£ç ã€‚\n// Using null safety: showGizmo(Thing? thing) { print(thing?.doohickey?.gizmo); } é‚£ä¹ˆä½ å°±å¯ä»¥è‚¯å®šåœ°çŸ¥é“ï¼Œè¿™æ„å‘³ç€ doohickey æœ¬èº«æœ‰ä¸€ä¸ªå¯ç©ºçš„è¿”å›ç±»å‹ã€‚æ¯ä¸€ä¸ª?å¯¹åº”ä¸€ä¸ªå¯ä»¥å¯¼è‡´ null æµå…¥æ–¹æ³•é“¾çš„å”¯ä¸€è·¯å¾„ã€‚è¿™ä½¿å¾—æ–¹æ³•é“¾ä¸­çš„ null-aware æ“ä½œç¬¦æ—¢æ›´ç®€æ´åˆæ›´ç²¾ç¡®ã€‚\nåœ¨è¿™æ—¶ï¼Œæˆ‘ä»¬åˆå¢åŠ äº†å‡ ä¸ªå…¶ä»–çš„ç©ºæ„ŸçŸ¥æ“ä½œç¬¦ã€‚\n// Using null safety:  // Null-aware cascade: receiver?..method(); // Null-aware index operator: receiver?[index]; æ²¡æœ‰ä¸€ä¸ª null-aware å‡½æ•°è°ƒç”¨æ“ä½œç¬¦ï¼Œä½†ä½ å¯ä»¥å†™ã€‚\n// Allowed with or without null safety: function?.call(arg1, arg2); Null æ–­è¨€è¿ç®—ç¬¦ ä½¿ç”¨æµå¼åˆ†æå°†ä¸€ä¸ªå¯ç©ºå‹å˜é‡ç§»åˆ°éå¯ç©ºå‹å˜é‡çš„ä¼Ÿå¤§ä¹‹å¤„åœ¨äºï¼Œè¿™æ ·åšè¢«è¯æ˜æ˜¯å®‰å…¨çš„ã€‚ä½ å¯ä»¥åœ¨ä¹‹å‰çš„å¯ç©ºå‹å˜é‡ä¸Šè°ƒç”¨æ–¹æ³•ï¼Œè€Œä¸ä¼šæ”¾å¼ƒéå¯ç©ºå‹çš„ä»»ä½•å®‰å…¨æˆ–æ€§èƒ½ã€‚\nä½†æ˜¯ï¼Œå¯ç©ºç±»å‹çš„è®¸å¤šæœ‰æ•ˆç”¨é€”æ— æ³•ä»¥å–æ‚¦é™æ€åˆ†æçš„æ–¹å¼è¯æ˜å…¶å®‰å…¨æ€§ã€‚æ¯”å¦‚è¯´\n// Using null safety, incorrectly: class HttpResponse { final int code; final String? error; HttpResponse.ok() : code = 200; HttpResponse.notFound() : code = 404, error = \u0026#39;Not found\u0026#39;; String toString() { if (code == 200) return \u0026#39;OK\u0026#39;; return \u0026#39;ERROR $code${error.toUpperCase()}\u0026#39;; } } å¦‚æœä½ å°è¯•è¿è¡Œè¿™ä¸ªï¼Œä½ åœ¨è°ƒç”¨ toUpperCase()æ—¶å¾—åˆ°ä¸€ä¸ªç¼–è¯‘é”™è¯¯ã€‚é”™è¯¯å­—æ®µæ˜¯å¯ç©ºçš„ï¼Œå› ä¸ºå®ƒåœ¨æˆåŠŸçš„å“åº”ä¸­ä¸ä¼šæœ‰ä¸€ä¸ªå€¼ã€‚æˆ‘ä»¬é€šè¿‡æ£€æŸ¥ç±»å¯ä»¥çœ‹åˆ°ï¼Œå½“é”™è¯¯ä¿¡æ¯ä¸ºç©ºæ—¶ï¼Œæˆ‘ä»¬æ°¸è¿œä¸ä¼šè®¿é—®å®ƒã€‚ä½†è¿™éœ€è¦ç†è§£ä»£ç çš„å€¼å’Œé”™è¯¯çš„å¯ç©ºæ€§ä¹‹é—´çš„å…³ç³»ã€‚ç±»å‹æ£€æŸ¥å™¨æ˜¯çœ‹ä¸åˆ°è¿™ç§è”ç³»çš„ã€‚\næ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬è¿™äº›ä»£ç çš„äººç±»ç»´æŠ¤è€…çŸ¥é“é”™è¯¯åœ¨æˆ‘ä»¬ä½¿ç”¨å®ƒçš„æ—¶å€™ä¸ä¼šæ˜¯ç©ºçš„ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥æ–­è¨€è¿™ä¸€ç‚¹ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä½ ä½¿ç”¨ as cast æ¥æ–­è¨€ç±»å‹ï¼Œåœ¨è¿™é‡Œä½ ä¹Ÿå¯ä»¥åšåŒæ ·çš„äº‹æƒ…ã€‚\n// Using null safety: String toString() { if (code == 200) return \u0026#39;OK\u0026#39;; return \u0026#39;ERROR $code${(error as String).toUpperCase()}\u0026#39;; } å¦‚æœæŠ•é€’å¤±è´¥ï¼Œå°†é”™è¯¯åœ°æŠ•é€’åˆ°ä¸å¯ç©ºçš„ String ç±»å‹ï¼Œä¼šæŠ›å‡ºä¸€ä¸ªè¿è¡Œæ—¶å¼‚å¸¸ã€‚å¦åˆ™ï¼Œå®ƒå°†ä¸ºæˆ‘ä»¬æä¾›ä¸€ä¸ªéç©ºå€¼å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸Šè°ƒç”¨æ–¹æ³•ã€‚\n\u0026ldquo;æŠ•å¼ƒå¯ç©ºæ€§ \u0026ldquo;ç»å¸¸å‡ºç°ï¼Œä»¥è‡³äºæˆ‘ä»¬æœ‰äº†ä¸€ç§æ–°çš„é€Ÿè®°è¯­æ³•ã€‚ä¸€ä¸ªåç¼€çš„æ„Ÿå¹å· (!) å°†å·¦è¾¹çš„è¡¨è¾¾å¼å¹¶å°†å…¶æŠ•å°„åˆ°å…¶åº•å±‚çš„ä¸å¯ç©ºç±»å‹ä¸Šã€‚æ‰€ä»¥ä¸Šé¢çš„å‡½æ•°ç›¸å½“äº\n// Using null safety: String toString() { if (code == 200) return \u0026#39;OK\u0026#39;; return \u0026#39;ERROR $code${error!.toUpperCase()}\u0026#39;; } å½“åº•å±‚ç±»å‹æ˜¯å•°å—¦çš„æ—¶å€™ï¼Œè¿™ä¸ªå•å­—ç¬¦çš„ \u0026ldquo;bang æ“ä½œç¬¦ \u0026ldquo;ç‰¹åˆ«æ–¹ä¾¿ã€‚å¦‚æœä»…ä»…ä¸ºäº†ä»æŸä¸ªç±»å‹ä¸­æŠ•å¼ƒä¸€ä¸ªå•ä¸€çš„?ï¼Œè€Œä¸å¾—ä¸å†™æˆ Map\u0026lt;TransactionProviderFactory, List\u0026lt;Set\u0026gt;ï¼Œé‚£å°±çœŸçš„å¾ˆçƒ¦äººäº†ã€‚\nå½“ç„¶ï¼Œå°±åƒä»»ä½•æŠ•å°„ä¸€æ ·ï¼Œä½¿ç”¨ !çš„åŒæ—¶ä¹Ÿä¼šæŸå¤±é™æ€å®‰å…¨ã€‚å¿…é¡»åœ¨è¿è¡Œæ—¶æ£€æŸ¥æŠ•å°„ä»¥ä¿æŒåˆç†æ€§ï¼Œè€Œä¸”å¯èƒ½ä¼šå¤±è´¥å¹¶æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚ä½†æ˜¯ä½ å¯ä»¥æ§åˆ¶è¿™äº›è½¬ç è¢«æ’å…¥çš„ä½ç½®ï¼Œä½ å¯ä»¥é€šè¿‡æŸ¥çœ‹ä½ çš„ä»£ç éšæ—¶çœ‹åˆ°å®ƒä»¬ã€‚\nLate å˜é‡ ç±»å‹æ£€æŸ¥å™¨ä¸èƒ½è¯æ˜ä»£ç å®‰å…¨çš„æœ€å¸¸è§çš„åœ°æ–¹æ˜¯å›´ç»•é¡¶å±‚å˜é‡å’Œå­—æ®µã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚\n// Using null safety, incorrectly: class Coffee { String _temperature; void heat() { _temperature = \u0026#39;hot\u0026#39;; } void chill() { _temperature = \u0026#39;iced\u0026#39;; } String serve() =\u0026gt; _temperature + \u0026#39; coffee\u0026#39;; } main() { var coffee = Coffee(); coffee.heat(); coffee.serve(); } è¿™é‡Œï¼Œheat()æ–¹æ³•æ˜¯åœ¨æœåŠ¡()ä¹‹å‰è°ƒç”¨çš„ã€‚è¿™æ„å‘³ç€ _temperature åœ¨ä½¿ç”¨ä¹‹å‰ä¼šè¢«åˆå§‹åŒ–ä¸ºä¸€ä¸ªéç©ºå€¼ã€‚ä½†æ˜¯é™æ€åˆ†ææ¥ç¡®å®šè¿™ä¸€ç‚¹æ˜¯ä¸å¯è¡Œçš„ã€‚(å¯¹äºåƒè¿™ä¸ªå¾®ä¸è¶³é“çš„ä¾‹å­æ¥è¯´å¯èƒ½æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¯•å›¾è·Ÿè¸ªä¸€ä¸ªç±»çš„æ¯ä¸€ä¸ªå®ä¾‹çš„çŠ¶æ€æ˜¯éš¾ä»¥è§£å†³çš„ã€‚)ã€‚\nå› ä¸ºç±»å‹æ£€æŸ¥å™¨ä¸èƒ½åˆ†æå­—æ®µå’Œé¡¶å±‚å˜é‡çš„ç”¨é€”ï¼Œå®ƒæœ‰ä¸€ä¸ªä¿å®ˆçš„è§„åˆ™ï¼Œå³ä¸å¯ç©ºå€¼å­—æ®µå¿…é¡»åœ¨å£°æ˜æ—¶åˆå§‹åŒ–ï¼ˆæˆ–è€…åœ¨å®ä¾‹å­—æ®µçš„æ„é€ å‡½æ•°åˆå§‹åŒ–åˆ—è¡¨ä¸­ï¼‰ã€‚æ‰€ä»¥ Dart åœ¨è¿™ä¸ªç±»ä¸ŠæŠ¥å‘Šäº†ä¸€ä¸ªç¼–è¯‘é”™è¯¯ã€‚\nä½ å¯ä»¥é€šè¿‡ä½¿å­—æ®µå¯ç©ºï¼Œç„¶ååœ¨ç”¨é€”ä¸Šä½¿ç”¨ null æ–­è¨€æ“ä½œç¬¦æ¥ä¿®å¤è¿™ä¸ªé”™è¯¯ã€‚\n// Using null safety: class Coffee { String? _temperature; void heat() { _temperature = \u0026#39;hot\u0026#39;; } void chill() { _temperature = \u0026#39;iced\u0026#39;; } String serve() =\u0026gt; _temperature! + \u0026#39; coffee\u0026#39;; } è¿™æ ·åšå¾ˆå¥½ï¼Œä½†å®ƒç»™ç±»çš„ç»´æŠ¤è€…å‘å‡ºäº†ä¸€ä¸ªæ··ä¹±çš„ä¿¡å·ã€‚ä½†å®ƒç»™ç±»çš„ç»´æŠ¤è€…å‘å‡ºäº†ä¸€ä¸ªæ··ä¹±çš„ä¿¡å·ã€‚é€šè¿‡æ ‡è®° _temperature ä¸º nullableï¼Œä½ æš—ç¤º null å¯¹äºè¯¥å­—æ®µæ¥è¯´æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„ã€æœ‰æ„ä¹‰çš„å€¼ã€‚ä½†è¿™ä¸æ˜¯æˆ‘ä»¬çš„ç›®çš„ã€‚_temperature å­—æ®µæ°¸è¿œä¸åº”è¯¥åœ¨å…¶ null çŠ¶æ€ä¸‹è¢«è§‚å¯Ÿåˆ°ã€‚\nä¸ºäº†å¤„ç†å¸¸è§çš„å»¶è¿Ÿåˆå§‹åŒ–çš„çŠ¶æ€æ¨¡å¼ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªæ–°çš„ä¿®é¥°ç¬¦ lateã€‚ä½ å¯ä»¥åƒè¿™æ ·ä½¿ç”¨å®ƒã€‚\n// Using null safety: class Coffee { late String _temperature; void heat() { _temperature = \u0026#39;hot\u0026#39;; } void chill() { _temperature = \u0026#39;iced\u0026#39;; } String serve() =\u0026gt; _temperature + \u0026#39; coffee\u0026#39;; } è¯·æ³¨æ„ï¼Œ_temperature å­—æ®µçš„ç±»å‹ä¸å¯ç©ºï¼Œä½†æ²¡æœ‰åˆå§‹åŒ–ã€‚å¦å¤–ï¼Œåœ¨ä½¿ç”¨å®ƒçš„æ—¶å€™ä¹Ÿæ²¡æœ‰æ˜ç¡®çš„ç©ºæ–­è¨€ã€‚æœ‰ä¸€äº›æ¨¡å‹å¯ä»¥åº”ç”¨åˆ°è¿Ÿåˆ°çš„è¯­ä¹‰ä¸­ï¼Œä½†æˆ‘æ˜¯è¿™æ ·æƒ³çš„ã€‚æ™šæœŸä¿®é¥°ç¬¦çš„æ„æ€æ˜¯ \u0026ldquo;åœ¨è¿è¡Œæ—¶æ‰§è¡Œè¿™ä¸ªå˜é‡çš„çº¦æŸï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶æ‰§è¡Œ\u0026rdquo;ã€‚è¿™å‡ ä¹å°±åƒ \u0026ldquo;late \u0026ldquo;è¿™ä¸ªè¯æè¿°çš„æ˜¯ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå˜é‡çš„ä¿è¯ã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”±äºè¯¥å­—æ®µè¿˜æ²¡æœ‰ç¡®å®šåˆå§‹åŒ–ï¼Œæ‰€ä»¥æ¯æ¬¡è¯»å–è¯¥å­—æ®µæ—¶ï¼Œéƒ½ä¼šæ’å…¥ä¸€ä¸ªè¿è¡Œæ—¶æ£€æŸ¥ï¼Œä»¥ç¡®ä¿å®ƒå·²ç»è¢«åˆ†é…äº†ä¸€ä¸ªå€¼ã€‚å¦‚æœæ²¡æœ‰ï¼Œå°±ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚ç»™å˜é‡ç±»å‹ä¸º String æ„å‘³ç€ \u0026ldquo;ä½ åº”è¯¥æ°¸è¿œä¸ä¼šçœ‹åˆ°æˆ‘çš„å€¼ä¸æ˜¯å­—ç¬¦ä¸²\u0026rdquo;ï¼Œè€ŒåæœŸä¿®é¥°ç¬¦æ„å‘³ç€ \u0026ldquo;åœ¨è¿è¡Œæ—¶éªŒè¯\u0026rdquo;ã€‚\nåœ¨æŸäº›æ–¹é¢ï¼Œè¿Ÿåˆ°ä¿®é¥°ç¬¦æ¯”ä½¿ç”¨? \u0026ldquo;ç¥å¥‡\u0026rdquo;ï¼Œå› ä¸ºå¯¹å­—æ®µçš„ä»»ä½•ä½¿ç”¨éƒ½å¯èƒ½å¤±è´¥ï¼Œè€Œä¸”åœ¨ä½¿ç”¨ç°åœºæ²¡æœ‰ä»»ä½•æ–‡å­—å¯è§ã€‚ä½†ä½ ç¡®å®å¿…é¡»åœ¨å£°æ˜å¤„å†™æ™šæœŸæ‰èƒ½å¾—åˆ°è¿™ç§è¡Œä¸ºï¼Œæˆ‘ä»¬çš„ä¿¡å¿µæ˜¯ï¼Œåœ¨é‚£é‡Œçœ‹åˆ°ä¿®é¥°ç¬¦å·²ç»è¶³å¤Ÿæ˜ç¡®ï¼Œè¿™ä¸€ç‚¹æ˜¯å¯ä»¥ç»´æŠ¤çš„ã€‚\nä½œä¸ºå›æŠ¥ï¼Œä½ å¯ä»¥å¾—åˆ°æ¯”ä½¿ç”¨å¯ç©ºç±»å‹æ›´å¥½çš„é™æ€å®‰å…¨ã€‚å› ä¸ºç°åœ¨å­—æ®µçš„ç±»å‹æ˜¯éå¯ç©ºçš„ï¼Œæ‰€ä»¥è¯•å›¾å°† null æˆ–å¯ç©ºçš„ String åˆ†é…ç»™å­—æ®µæ˜¯ä¸€ä¸ªç¼–è¯‘é”™è¯¯ã€‚æ™šæœŸä¿®é¥°ç¬¦å¯ä»¥è®©ä½ æ¨è¿Ÿåˆå§‹åŒ–ï¼Œä½†ä»ç„¶ç¦æ­¢ä½ æŠŠå®ƒå½“ä½œä¸€ä¸ªå¯ç©ºå˜é‡æ¥å¤„ç†ã€‚\næƒ°æ€§åˆå§‹åŒ– late ä¿®é¥°ç¬¦ä¹Ÿæœ‰ä¸€äº›å…¶ä»–çš„ç‰¹æ®Šèƒ½åŠ›ã€‚è¿™å¯èƒ½çœ‹èµ·æ¥å¾ˆçŸ›ç›¾ï¼Œä½†ä½ å¯ä»¥åœ¨ä¸€ä¸ªæœ‰åˆå§‹åŒ–å™¨çš„å­—æ®µä¸Šä½¿ç”¨ lateã€‚\n// Using null safety: class Weather { late int _temperature = _readThermometer(); } å½“ä½ è¿™æ ·åšçš„æ—¶å€™ï¼Œåˆå§‹åŒ–å™¨ä¼šå˜å¾—æ‡’æƒ°ã€‚å®ƒä¸æ˜¯åœ¨å®ä¾‹æ„é€ å®Œæˆåç«‹å³è¿è¡Œï¼Œè€Œæ˜¯åœ¨ç¬¬ä¸€æ¬¡è®¿é—®è¯¥å­—æ®µæ—¶å°±å»¶è¿Ÿå¹¶ç¼“æ…¢è¿è¡Œã€‚æ¢å¥è¯è¯´ï¼Œå®ƒçš„å·¥ä½œæ–¹å¼ä¸é¡¶å±‚å˜é‡æˆ–é™æ€å­—æ®µçš„åˆå§‹åŒ–å™¨å®Œå…¨ä¸€æ ·ã€‚å½“åˆå§‹åŒ–è¡¨è¾¾å¼çš„æˆæœ¬å¾ˆé«˜ä¸”å¯èƒ½ä¸éœ€è¦æ—¶ï¼Œè¿™å¯ä»¥å¾ˆæ–¹ä¾¿ã€‚\nå½“ä½ åœ¨å®ä¾‹å­—æ®µä¸Šä½¿ç”¨åæœŸï¼Œæ‡’æƒ°åœ°è¿è¡Œåˆå§‹åŒ–å™¨ä¼šç»™ä½ ä¸€ä¸ªé¢å¤–çš„å¥–åŠ±ã€‚é€šå¸¸å®ä¾‹å­—æ®µåˆå§‹åŒ–å™¨ä¸èƒ½è®¿é—®è¿™ä¸ªï¼Œå› ä¸ºåœ¨æ‰€æœ‰å­—æ®µåˆå§‹åŒ–å™¨å®Œæˆä¹‹å‰ï¼Œä½ ä¸èƒ½è®¿é—®æ–°å¯¹è±¡ã€‚ä½†æœ‰äº†è¿Ÿæ¥çš„å­—æ®µï¼Œå°±ä¸å†æ˜¯è¿™æ ·äº†ï¼Œæ‰€ä»¥ä½ å¯ä»¥è®¿é—®è¿™ä¸ªï¼Œè°ƒç”¨æ–¹æ³•ï¼Œæˆ–è€…è®¿é—®å®ä¾‹ä¸Šçš„å­—æ®µã€‚\nlate final å˜é‡ ä½ ä¹Ÿå¯ä»¥æŠŠ late å’Œ final ç»“åˆèµ·æ¥ã€‚\n// Using null safety: class Coffee { late final String _temperature; void heat() { _temperature = \u0026#39;hot\u0026#39;; } void chill() { _temperature = \u0026#39;iced\u0026#39;; } String serve() =\u0026gt; _temperature + \u0026#39; coffee\u0026#39;; } ä¸æ™®é€šçš„ final å­—æ®µä¸åŒï¼Œæ‚¨ä¸å¿…åœ¨å£°æ˜ä¸­æˆ–åœ¨æ„é€ å‡½æ•°åˆå§‹åŒ–åˆ—è¡¨ä¸­åˆå§‹åŒ–è¯¥å­—æ®µã€‚ä½ å¯ä»¥åœ¨ä»¥åçš„è¿è¡Œæ—¶å¯¹å®ƒè¿›è¡Œèµ‹å€¼ã€‚ä½†æ˜¯ä½ åªèƒ½å¯¹å®ƒèµ‹å€¼ä¸€æ¬¡ï¼Œè€Œä¸”è¿™ä¸ªäº‹å®ä¼šåœ¨è¿è¡Œæ—¶è¢«æ£€æŸ¥ã€‚å¦‚æœä½ è¯•å›¾å¯¹å®ƒè¿›è¡Œä¸æ­¢ä¸€æ¬¡çš„èµ‹å€¼ï¼Œå°±åƒè¿™é‡ŒåŒæ—¶è°ƒç”¨ heat() å’Œ chill() ä¸€æ ·ï¼Œç¬¬äºŒæ¬¡èµ‹å€¼å°±ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚è¿™æ˜¯å¯¹æœ€ç»ˆè¢«åˆå§‹åŒ–ä¸”ä¹‹åä¸å¯æ”¹å˜çš„çŠ¶æ€è¿›è¡Œå»ºæ¨¡çš„å¥½æ–¹æ³•ã€‚\næ¢å¥è¯è¯´ï¼Œæ–°çš„ late ä¿®é¥°ç¬¦ç»“åˆ Dart çš„å…¶ä»–å˜é‡ä¿®é¥°ç¬¦ï¼Œè¦†ç›–äº† Kotlin ä¸­ lateinit å’Œ Swift ä¸­ lazy çš„å¤§éƒ¨åˆ†åŠŸèƒ½ç©ºé—´ã€‚å¦‚æœä½ æƒ³åœ¨å±€éƒ¨å˜é‡ä¸Šä½¿ç”¨å®ƒï¼Œä½ ç”šè‡³å¯ä»¥åœ¨å±€éƒ¨å˜é‡ä¸Šä½¿ç”¨å®ƒï¼Œå¦‚æœä½ æƒ³è¿›è¡Œä¸€ç‚¹å±€éƒ¨çš„æ‡’æƒ°è¯„ä¼°ã€‚\næ‰€éœ€çš„å‘½åå‚æ•° ä¸ºäº†ä¿è¯ä½ æ°¸è¿œä¸ä¼šçœ‹åˆ°ä¸€ä¸ªå…·æœ‰ä¸å¯ç©ºç±»å‹çš„ç©ºå‚æ•°ï¼Œç±»å‹æ£€æŸ¥å™¨è¦æ±‚æ‰€æœ‰å¯é€‰å‚æ•°è¦ä¹ˆå…·æœ‰å¯ç©ºç±»å‹ï¼Œè¦ä¹ˆå…·æœ‰é»˜è®¤å€¼ã€‚å¦‚æœä½ æƒ³è®©ä¸€ä¸ªå‘½åçš„å‚æ•°æœ‰ä¸€ä¸ªå¯ç©ºçš„ç±»å‹è€Œæ²¡æœ‰é»˜è®¤å€¼å‘¢ï¼Ÿé‚£å°±æ„å‘³ç€ä½ æƒ³è¦æ±‚è°ƒç”¨è€…æ€»æ˜¯ä¼ é€’å®ƒã€‚æ¢å¥è¯è¯´ï¼Œä½ æƒ³è¦ä¸€ä¸ªå‘½åçš„å‚æ•°ï¼Œä½†ä¸æ˜¯å¯é€‰çš„ã€‚\næˆ‘ç”¨è¿™ä¸ªè¡¨ç›´è§‚åœ°å±•ç¤ºäº† Dart å‚æ•°çš„å„ç§ç±»å‹ã€‚\n mandatory optional +------------+------------+ positional | f(int x) | f([int x]) | +------------+------------+ named | ??? | f({int x}) | +------------+------------+ ç”±äºä¸æ¸…æ¥šçš„åŸå› ï¼ŒDart é•¿æœŸä»¥æ¥ä¸€ç›´æ”¯æŒè¿™ä¸ªè¡¨çš„ä¸‰ä¸ªè§’ï¼Œä½†æŠŠ named+mandatory çš„ç»„åˆç©ºäº†ã€‚åœ¨ç©ºå®‰å…¨çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¡«è¡¥äº†è¿™ä¸€ç‚¹ã€‚ä½ åœ¨å‚æ•°å‰æ”¾ä¸Š requiredï¼Œå°±å¯ä»¥å£°æ˜ä¸€ä¸ªå¿…è¦çš„å‘½åå‚æ•°ã€‚\n// Using null safety: function({int? a, required int? b, int? c, required int? d}) {} åœ¨è¿™é‡Œï¼Œæ‰€æœ‰çš„å‚æ•°éƒ½å¿…é¡»ä»¥åå­—ä¼ é€’ã€‚å‚æ•° a å’Œ c æ˜¯å¯é€‰çš„ï¼Œå¯ä»¥çœç•¥ã€‚å‚æ•° b å’Œ d æ˜¯å¿…å¡«çš„ï¼Œå¿…é¡»ä¼ é€’ã€‚æ³¨æ„ï¼Œè¦æ±‚æ€§ä¸å¯ç©ºæ€§æ— å…³ã€‚å¯ç©ºç±»å‹çš„å‘½åå‚æ•°å¯ä»¥æ˜¯å¿…éœ€çš„ï¼Œä¸å¯ç©ºç±»å‹çš„å‘½åå‚æ•°å¯ä»¥æ˜¯å¯é€‰çš„ï¼ˆå¦‚æœå®ƒä»¬æœ‰ä¸€ä¸ªé»˜è®¤å€¼ï¼‰ã€‚\nè¿™æ˜¯å¦ä¸€ä¸ªæˆ‘è®¤ä¸ºæ— è®ºç©ºå€¼å®‰å…¨æ€§å¦‚ä½•éƒ½èƒ½è®© Dart å˜å¾—æ›´å¥½çš„ç‰¹æ€§ä¹‹ä¸€ã€‚å®ƒåªæ˜¯è®©æˆ‘è§‰å¾—è¿™ä¸ªè¯­è¨€æ›´åŠ å®Œæ•´ã€‚\næŠ½è±¡å­—æ®µ Dart çš„ä¸€ä¸ªç‰¹ç‚¹æ˜¯å®ƒåšæŒäº†ä¸€ä¸ªå«åšç»Ÿä¸€è®¿é—®åŸåˆ™çš„ä¸œè¥¿ã€‚ç”¨äººè¯è¯´å°±æ˜¯å­—æ®µä¸ getter å’Œ setter æ˜¯æ²¡æœ‰åŒºåˆ«çš„ã€‚åœ¨æŸä¸ª Dart ç±»ä¸­çš„ \u0026ldquo;å±æ€§ \u0026ldquo;æ˜¯è®¡ç®—è¿˜æ˜¯å­˜å‚¨ï¼Œè¿™æ˜¯ä¸€ä¸ªå®ç°ç»†èŠ‚ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œåœ¨ä½¿ç”¨æŠ½è±¡ç±»å®šä¹‰æ¥å£çš„æ—¶å€™ï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨å­—æ®µå£°æ˜ã€‚\nabstract class Cup { Beverage contents; } å…¶ç›®çš„æ˜¯è®©ç”¨æˆ·åªå®ç°è¯¥ç±»ï¼Œè€Œä¸è¦æ‰©å±•å®ƒã€‚å­—æ®µè¯­æ³•åªæ˜¯å†™ä¸€ä¸ª getter/setter å¯¹çš„è¾ƒçŸ­æ–¹å¼ã€‚\nabstract class Cup { Beverage get contents; set contents(Beverage); } ä½† Dart ä¸çŸ¥é“è¿™ä¸ªç±»æ°¸è¿œä¸ä¼šè¢«ç”¨ä½œå…·ä½“ç±»å‹ã€‚å®ƒæŠŠé‚£ä¸ªå†…å®¹å£°æ˜çœ‹ä½œæ˜¯ä¸€ä¸ªçœŸå®çš„å­—æ®µã€‚è€Œä¸”ï¼Œä¸å¹¸çš„æ˜¯ï¼Œè¿™ä¸ªå­—æ®µæ˜¯ä¸å¯ç©ºçš„ï¼Œä¹Ÿæ²¡æœ‰åˆå§‹åŒ–å™¨ï¼Œæ‰€ä»¥ä½ å¾—åˆ°ä¸€ä¸ªç¼–è¯‘é”™è¯¯ã€‚\nä¸€ä¸ªè§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨æ˜¾å¼çš„æŠ½è±¡ getter/setter å£°æ˜ï¼Œå°±åƒç¬¬äºŒä¸ªä¾‹å­ä¸­é‚£æ ·ã€‚ä½†è¿™æœ‰ç‚¹å•°å—¦ï¼Œæ‰€ä»¥åœ¨ null å®‰å…¨çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿˜å¢åŠ äº†å¯¹æ˜¾å¼æŠ½è±¡å­—æ®µå£°æ˜çš„æ”¯æŒã€‚\nabstract class Cup { abstract Beverage contents; } è¿™å’Œç¬¬äºŒä¸ªä¾‹å­çš„è¡Œä¸ºå®Œå…¨ä¸€æ ·ã€‚å®ƒåªæ˜¯ç”¨ç»™å®šçš„åç§°å’Œç±»å‹å£°æ˜äº†ä¸€ä¸ªæŠ½è±¡çš„ getter å’Œ setterã€‚\nä½¿ç”¨å¯ç©ºå­—æ®µ è¿™äº›æ–°ç‰¹æ€§æ¶µç›–äº†è®¸å¤šå¸¸è§çš„æ¨¡å¼ï¼Œå¹¶ä¸”åœ¨å¤§å¤šæ•°æ—¶é—´é‡Œï¼Œè®©å¤„ç† null çš„å·¥ä½œå˜å¾—ç›¸å½“è½»æ¾ã€‚ä½†å³ä¾¿å¦‚æ­¤ï¼Œæˆ‘ä»¬çš„ç»éªŒæ˜¯ï¼Œå¯ç©ºå­—æ®µä»ç„¶æ˜¯å›°éš¾çš„ã€‚åœ¨ä½ èƒ½è®©å­—æ®µè¿Ÿåˆ°ä¸”ä¸å¯ç©ºçš„æƒ…å†µä¸‹ï¼Œä½ æ˜¯é‡‘å­èˆ¬çš„å­˜åœ¨ã€‚ä½†åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œä½ éœ€è¦æ£€æŸ¥å­—æ®µæ˜¯å¦æœ‰å€¼ï¼Œè¿™å°±éœ€è¦è®©å®ƒå¯ç©ºï¼Œè¿™æ ·ä½ å°±å¯ä»¥è§‚å¯Ÿåˆ°ç©ºã€‚\nä½ å¯èƒ½ä¼šæœŸæœ›è¿™æ ·åšæ˜¯å¯è¡Œçš„ã€‚\n// Using null safety, incorrectly: class Coffee { String? _temperature; void heat() { _temperature = \u0026#39;hot\u0026#39;; } void chill() { _temperature = \u0026#39;iced\u0026#39;; } void checkTemp() { if (_temperature != null) { print(\u0026#39;Ready to serve \u0026#39; + _temperature + \u0026#39;!\u0026#39;); } } String serve() =\u0026gt; _temperature! + \u0026#39; coffee\u0026#39;; } åœ¨ checkTemp()é‡Œé¢ï¼Œæˆ‘ä»¬æ£€æŸ¥ _temperature æ˜¯å¦ä¸ºç©ºã€‚å¦‚æœä¸æ˜¯ï¼Œæˆ‘ä»¬è®¿é—®å®ƒï¼Œå¹¶æœ€ç»ˆè°ƒç”¨+ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™æ˜¯ä¸å…è®¸çš„ã€‚åŸºäºæµå¼çš„ç±»å‹æ¨å¹¿å¹¶ä¸é€‚ç”¨äºå­—æ®µï¼Œå› ä¸ºé™æ€åˆ†ææ— æ³•è¯æ˜å­—æ®µçš„å€¼åœ¨ä½ æ£€æŸ¥ null å’Œä½ ä½¿ç”¨å®ƒçš„ç‚¹ä¹‹é—´æ²¡æœ‰å˜åŒ–ã€‚è€ƒè™‘åˆ°åœ¨ç—…ç†æƒ…å†µä¸‹ï¼Œå­—æ®µæœ¬èº«å¯èƒ½ä¼šè¢«å­ç±»ä¸­çš„ getter è¦†ç›–ï¼Œåœ¨ç¬¬äºŒæ¬¡è°ƒç”¨æ—¶è¿”å› nullï¼‰ã€‚\næ‰€ä»¥ï¼Œæ—¢ç„¶æˆ‘ä»¬å…³å¿ƒå¥å…¨æ€§ï¼Œé‚£ä¹ˆå­—æ®µå°±ä¸ä¼šæ¨å¹¿ï¼Œä¸Šé¢çš„æ–¹æ³•å°±ä¸ä¼šç¼–è¯‘ã€‚è¿™æ˜¯å¾ˆçƒ¦äººçš„ã€‚åœ¨åƒè¿™é‡Œè¿™æ ·ç®€å•çš„æƒ…å†µä¸‹ï¼Œä½ æœ€å¥½çš„é€‰æ‹©æ˜¯åœ¨å­—æ®µçš„ä½¿ç”¨ä¸Šæ‰“ä¸Šä¸€ä¸ª! è¿™ä¼¼ä¹æ˜¯å¤šä½™çš„ï¼Œä½†è¿™å¤šå°‘æ˜¯ Dart å¦‚ä»Šçš„è¡Œä¸ºæ–¹å¼ã€‚\nå¦ä¸€ä¸ªæœ‰ç”¨çš„æ¨¡å¼æ˜¯å…ˆæŠŠå­—æ®µå¤åˆ¶åˆ°ä¸€ä¸ªæœ¬åœ°å˜é‡ä¸­ï¼Œç„¶åå†ä½¿ç”¨å®ƒã€‚\n// Using null safety: void checkTemp() { var temperature = _temperature; if (temperature != null) { print(\u0026#39;Ready to serve \u0026#39; + temperature + \u0026#39;!\u0026#39;); } } ç”±äºç±»å‹æ¨å¹¿ç¡®å®é€‚ç”¨äºæœ¬åœ°äººï¼Œæ‰€ä»¥ç°åœ¨å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚å¦‚æœä½ éœ€è¦æ”¹å˜å€¼ï¼Œåªè¦è®°å¾—å­˜å‚¨å›å­—æ®µï¼Œè€Œä¸ä»…ä»…æ˜¯æœ¬åœ°ã€‚\næ— æ•ˆæ€§å’Œå±æ€§ åƒå¤§å¤šæ•°ç°ä»£é™æ€ç±»å‹çš„è¯­è¨€ä¸€æ ·ï¼ŒDart æœ‰é€šç”¨ç±»å’Œé€šç”¨æ–¹æ³•ã€‚å®ƒä»¬ä¸å¯ç©ºæ€§çš„äº¤äº’æ–¹å¼æœ‰ä¸€äº›çœ‹ä¼¼åç›´è§‰çš„åœ°æ–¹ï¼Œä½†ä¸€æ—¦ä½ æƒ³æ¸…æ¥šäº†å…¶ä¸­çš„å«ä¹‰ï¼Œå°±ä¼šæ˜ç™½ã€‚é¦–å…ˆæ˜¯ \u0026ldquo;è¿™ä¸ªç±»å‹æ˜¯å¯ç©ºæ€§çš„å—ï¼Ÿ\u0026ldquo;ä¸å†æ˜¯ä¸€ä¸ªç®€å•çš„æ˜¯æˆ–å¦çš„é—®é¢˜ã€‚è€ƒè™‘ä¸€ä¸‹ã€‚\n// Using null safety: class Box\u0026lt;T\u0026gt; { final T object; Box(this.object); } main() { Box\u0026lt;String\u0026gt;(\u0026#39;a string\u0026#39;); Box\u0026lt;int?\u0026gt;(null); } åœ¨ Box çš„å®šä¹‰ä¸­ï¼ŒT æ˜¯ä¸€ä¸ªå¯ç©ºç±»å‹è¿˜æ˜¯ä¸€ä¸ªä¸å¯ç©ºç±»å‹ï¼Ÿæ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œå®ƒå¯ä»¥è¢«å®ä¾‹åŒ–ä¸ºä»»ä½•ä¸€ç§ç±»å‹ã€‚ç­”æ¡ˆæ˜¯ T æ˜¯ä¸€ä¸ªæ½œåœ¨çš„å¯ç©ºç±»å‹ã€‚åœ¨ä¸€ä¸ªé€šç”¨ç±»æˆ–æ–¹æ³•çš„ä¸»ä½“ä¸­ï¼Œæ½œåœ¨å¯ç©ºç±»å‹å…·æœ‰å¯ç©ºç±»å‹å’Œä¸å¯ç©ºç±»å‹çš„æ‰€æœ‰é™åˆ¶ã€‚\nå‰è€…æ„å‘³ç€é™¤äº†åœ¨ Object ä¸Šå®šä¹‰çš„å°‘é‡æ–¹æ³•å¤–ï¼Œä½ ä¸èƒ½è°ƒç”¨å®ƒçš„ä»»ä½•æ–¹æ³•ã€‚åè€…æ„å‘³ç€ä½ å¿…é¡»åœ¨ä½¿ç”¨è¯¥ç±»å‹çš„ä»»ä½•å­—æ®µæˆ–å˜é‡ä¹‹å‰åˆå§‹åŒ–å®ƒä»¬ã€‚è¿™å¯èƒ½ä¼šä½¿ç±»å‹å‚æ•°å˜å¾—ç›¸å½“éš¾å¤„ç†ã€‚\nåœ¨å®è·µä¸­ï¼Œæœ‰å‡ ç§æ¨¡å¼è¡¨ç°å‡ºæ¥ã€‚åœ¨ç±»ä¼¼é›†åˆçš„ç±»ä¸­ï¼Œç±»å‹å‚æ•°å¯ä»¥ç”¨ä»»ä½•ç±»å‹å®ä¾‹åŒ–ï¼Œä½ åªéœ€è¦å¤„ç†è¿™äº›é™åˆ¶ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå°±åƒè¿™é‡Œçš„ä¾‹å­ä¸€æ ·ï¼Œè¿™æ„å‘³ç€åªè¦ä½ éœ€è¦å¤„ç†ä¸€ä¸ªç±»å‹å‚æ•°çš„å€¼ï¼Œå°±å¿…é¡»ç¡®ä¿ä½ ç¡®å®å¯ä»¥è®¿é—®è¿™ä¸ªç±»å‹å‚æ•°çš„å€¼ã€‚å¹¸è¿çš„æ˜¯ï¼Œé›†åˆç±»å¾ˆå°‘å¯¹å…¶å…ƒç´ è°ƒç”¨æ–¹æ³•ã€‚\nåœ¨ä½ æ— æ³•è®¿é—®ä¸€ä¸ªå€¼çš„åœ°æ–¹ï¼Œä½ å¯ä»¥ä½¿ç±»å‹å‚æ•°çš„ä½¿ç”¨æ˜¯å¯ç©ºçš„ã€‚\n// Using null safety: class Box\u0026lt;T\u0026gt; { T? object; Box.empty(); Box.full(this.object); } æ³¨æ„å¯¹è±¡å£°æ˜ä¸Šçš„? ç°åœ¨è¿™ä¸ªå­—æ®µæœ‰ä¸€ä¸ªæ˜¾å¼å¯ç©ºçš„ç±»å‹ï¼Œæ‰€ä»¥å¯ä»¥ä¸åˆå§‹åŒ–å®ƒã€‚\nå½“ä½ ä½¿ä¸€ä¸ªç±»å‹å‚æ•°ç±»å‹åƒè¿™é‡Œçš„ T? ä¸€æ ·å¯ç©ºçš„æ—¶å€™ï¼Œä½ å¯èƒ½éœ€è¦æŠŠå¯ç©ºæ€§æŠ›æ‰ã€‚æ­£ç¡®çš„æ–¹æ³•æ˜¯ä½¿ç”¨æ˜¾å¼ä¸º T çš„è½¬å†™ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ !æ“ä½œç¬¦ã€‚\n// Using null safety: class Box\u0026lt;T\u0026gt; { final T? object; Box.empty(); Box.full(this.object); T unbox() =\u0026gt; object as T; } !æ“ä½œç¬¦æ€»æ˜¯åœ¨å€¼ä¸º null æ—¶æŠ›å‡ºã€‚ä½†æ˜¯å¦‚æœç±»å‹å‚æ•°å·²ç»è¢«å®ä¾‹åŒ–ä¸ºä¸€ä¸ªå¯ç©ºç±»å‹ï¼Œé‚£ä¹ˆ null å¯¹äº T æ¥è¯´æ˜¯ä¸€ä¸ªå®Œå…¨æœ‰æ•ˆçš„å€¼ã€‚\n// Using null safety: main() { var box = Box\u0026lt;int?\u0026gt;.full(null); print(box.unbox()); } è¿™ä¸ªç¨‹åºåº”è¯¥æ— è¯¯åœ°è¿è¡Œã€‚ä½¿ç”¨ T å°±å¯ä»¥å®ç°è¿™ä¸€ç‚¹ã€‚ä½¿ç”¨ !ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚\nå…¶ä»–é€šç”¨ç±»å‹æœ‰ä¸€äº›çº¦æŸï¼Œé™åˆ¶äº†å¯ä»¥åº”ç”¨çš„ç±»å‹å‚æ•°çš„ç§ç±»ã€‚\n// Using null safety: class Interval\u0026lt;T extends num\u0026gt; { T min, max; Interval(this.min, this.max); bool get isEmpty =\u0026gt; max \u0026lt;= min; } å¦‚æœç»‘å®šæ˜¯ä¸å¯ç©ºçš„ï¼Œé‚£ä¹ˆç±»å‹å‚æ•°ä¹Ÿæ˜¯ä¸å¯ç©ºçš„ï¼Œè¿™æ„å‘³ç€ä½ æœ‰ä¸å¯ç©ºç±»å‹çš„é™åˆ¶\u0026ndash;ä½ ä¸èƒ½è®©å­—æ®µå’Œå˜é‡ä¸åˆå§‹åŒ–ã€‚è¿™æ„å‘³ç€ä½ æœ‰ä¸å¯ç©ºå€¼ç±»å‹çš„é™åˆ¶\u0026ndash;ä½ ä¸èƒ½è®©å­—æ®µå’Œå˜é‡ä¸åˆå§‹åŒ–ã€‚è¿™é‡Œçš„ç¤ºä¾‹ç±»å¿…é¡»æœ‰ä¸€ä¸ªåˆå§‹åŒ–å­—æ®µçš„æ„é€ å‡½æ•°ã€‚\nä½œä¸ºè¿™ç§é™åˆ¶çš„å›æŠ¥ï¼Œä½ å¯ä»¥è°ƒç”¨åœ¨å…¶ç»‘å®šä¸Šå£°æ˜çš„å‚æ•°ç±»å‹çš„å€¼çš„ä»»ä½•æ–¹æ³•ã€‚ç„¶è€Œï¼Œæ‹¥æœ‰ä¸€ä¸ªä¸å¯ç©ºçš„ç»‘å®šç¡®å®ä¼šé˜»æ­¢ä½ çš„é€šç”¨ç±»çš„ç”¨æˆ·ç”¨ä¸€ä¸ªå¯ç©ºçš„ç±»å‹å‚æ•°æ¥å®ä¾‹åŒ–å®ƒã€‚å¯¹äºå¤§å¤šæ•°ç±»æ¥è¯´ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªåˆç†çš„é™åˆ¶ã€‚\nä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå¯ç©ºçš„ç»‘å®šã€‚\n// Using null safety: class Interval\u0026lt;T extends num?\u0026gt; { T min, max; bool get isEmpty { var localMin = min; var localMax = max; // No min or max means an open-ended interval.  if (localMin == null || localMax == null) return false; return localMax \u0026lt;= localMin; } } è¿™æ„å‘³ç€åœ¨ç±»çš„ä¸»ä½“ä¸­ï¼Œä½ å¯ä»¥çµæ´»åœ°å°†ç±»å‹å‚æ•°å¤„ç†ä¸º nullableã€‚è¯·æ³¨æ„ï¼Œè¿™æ¬¡æˆ‘ä»¬æ²¡æœ‰æ„é€ å‡½æ•°ï¼Œè¿™ä¹Ÿæ²¡å…³ç³»ã€‚å­—æ®µå°†è¢«éšå¼åˆå§‹åŒ–ä¸º nullã€‚ä½ å¯ä»¥å£°æ˜ç±»å‹å‚æ•°ç±»å‹çš„æœªåˆå§‹åŒ–å˜é‡ã€‚\nä½†æ˜¯ä½ ä¹Ÿæœ‰ nullability çš„é™åˆ¶\u0026ndash;ä½ ä¸èƒ½åœ¨è¯¥ç±»å‹çš„å˜é‡ä¸Šè°ƒç”¨ä»»ä½•ä¸œè¥¿ï¼Œé™¤éä½ å…ˆå¤„ç†å¥½ nullabilityã€‚åœ¨è¿™é‡Œçš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¤åˆ¶å±€éƒ¨å˜é‡ä¸­çš„å­—æ®µï¼Œå¹¶æ£€æŸ¥è¿™äº›å±€éƒ¨å˜é‡æ˜¯å¦ä¸ºç©ºï¼Œä»¥ä¾¿åœ¨ä½¿ç”¨\u0026lt;=ä¹‹å‰ï¼Œæµåˆ†æå°†å®ƒä»¬æ¨å¹¿åˆ°éå¯ç©ºæ€§ç±»å‹ã€‚\nè¯·æ³¨æ„ï¼Œå¯ç©ºæ€§ç»‘å®šå¹¶ä¸å¦¨ç¢ç”¨æˆ·ç”¨éç©ºç±»å‹å®ä¾‹åŒ–ç±»ã€‚ä¸€ä¸ªå¯ç©ºçš„è¾¹ç•Œæ„å‘³ç€ç±»å‹å‚æ•°å¯ä»¥æ˜¯å¯ç©ºçš„ï¼Œè€Œä¸æ˜¯è¯´å®ƒå¿…é¡»æ˜¯å¯ç©ºçš„ã€‚äº‹å®ä¸Šï¼Œå¦‚æœä½ ä¸å†™æ‰©å±•å­å¥ï¼Œç±»å‹å‚æ•°çš„é»˜è®¤çº¦æŸæ˜¯å¯ç©ºå€¼çº¦æŸ Object? æ²¡æœ‰åŠæ³•è¦æ±‚ç±»å‹å‚æ•°æ˜¯å¯ç©ºçš„ã€‚å¦‚æœä½ æƒ³è®©ç±»å‹å‚æ•°çš„ä½¿ç”¨å¯é åœ°æ˜¯å¯ç©ºçš„ï¼Œä½ å¯ä»¥åœ¨ç±»çš„ä¸»ä½“é‡Œé¢ä½¿ç”¨ T?\næ ¸å¿ƒåº“çš„å˜åŒ– è¯­è¨€ä¸­è¿˜æœ‰ä¸€äº›å…¶ä»–çš„è°ƒæ•´ï¼Œä½†éƒ½æ˜¯æ¬¡è¦çš„ã€‚ä¾‹å¦‚ï¼Œæ²¡æœ‰ on å­å¥çš„ catch çš„é»˜è®¤ç±»å‹ç°åœ¨æ˜¯ Object è€Œä¸æ˜¯åŠ¨æ€çš„ã€‚å¼€å…³è¯­å¥ä¸­çš„è·Œç©¿åˆ†æä½¿ç”¨äº†æ–°çš„æµåˆ†æã€‚\nå‰©ä¸‹çš„çœŸæ­£å¯¹ä½ æœ‰æ„ä¹‰çš„å˜åŒ–æ˜¯åœ¨æ ¸å¿ƒåº“ä¸­ã€‚åœ¨æˆ‘ä»¬å¼€å§‹è¿›è¡Œç©ºå€¼å®‰å…¨å¤§å†’é™©ä¹‹å‰ï¼Œæˆ‘ä»¬æ‹…å¿ƒåŸæ¥æ²¡æœ‰åŠæ³•åœ¨ä¸å¤§è§„æ¨¡ç ´åä¸–ç•Œçš„æƒ…å†µä¸‹è®©æˆ‘ä»¬çš„æ ¸å¿ƒåº“å®ç°ç©ºå€¼å®‰å…¨ã€‚ç»“æœå¹¶æ²¡æœ‰é‚£ä¹ˆå¯æ€•ã€‚æœ‰ä¸€äº›é‡å¤§çš„å˜åŒ–ï¼Œä½†å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿ç§»å¾ˆé¡ºåˆ©ã€‚å¤§å¤šæ•°æ ¸å¿ƒåº“è¦ä¹ˆä¸æ¥å— nullï¼Œè‡ªç„¶è€Œç„¶åœ°è¿ç§»åˆ°éå¯ç©ºç±»å‹ï¼Œè¦ä¹ˆæ¥å—å¹¶ä¼˜é›…åœ°ç”¨å¯ç©ºç±»å‹æ¥å—å®ƒã€‚\nä¸è¿‡æœ‰å‡ ä¸ªé‡è¦çš„è§’è½ã€‚\nMap ç´¢å¼•æ“ä½œç¬¦æ˜¯å¯ç©ºçš„ è¿™å¹¶ä¸æ˜¯çœŸæ­£çš„æ”¹å˜ï¼Œæ›´å¤šçš„æ˜¯ä¸€ä¸ªéœ€è¦çŸ¥é“çš„äº‹æƒ…ã€‚Map ç±»çš„ index [] æ“ä½œç¬¦å¦‚æœé”®ä¸å­˜åœ¨ï¼Œåˆ™è¿”å› nullã€‚è¿™æ„å‘³ç€è¯¥æ“ä½œç¬¦çš„è¿”å›ç±»å‹å¿…é¡»æ˜¯å¯ç©ºçš„ã€‚V?\næˆ‘ä»¬å¯ä»¥å°†è¯¥æ–¹æ³•æ”¹ä¸ºå½“é”®ä¸å­˜åœ¨æ—¶æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œç„¶åç»™å®ƒä¸€ä¸ªæ›´å®¹æ˜“ä½¿ç”¨çš„éç©ºå€¼è¿”å›ç±»å‹ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨ç´¢å¼•æ“ä½œç¬¦å¹¶æ£€æŸ¥ null ä»¥æŸ¥çœ‹é”®æ˜¯å¦ä¸å­˜åœ¨çš„ä»£ç æ˜¯éå¸¸å¸¸è§çš„ï¼Œæ ¹æ®æˆ‘ä»¬çš„åˆ†æï¼Œçº¦å æ‰€æœ‰ä½¿ç”¨çš„ä¸€åŠã€‚æ‰“ç ´æ‰€æœ‰è¿™äº›ä»£ç ä¼šè®© Dart ç”Ÿæ€ç³»ç»Ÿç‡ƒèµ·ç†Šç†Šå¤§ç«ã€‚\nç›¸åï¼Œè¿è¡Œæ—¶çš„è¡Œä¸ºæ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤è¿”å›ç±»å‹å¿…é¡»æ˜¯å¯ç©ºçš„ã€‚è¿™æ„å‘³ç€ä½ ä¸€èˆ¬ä¸èƒ½ç«‹å³ä½¿ç”¨ map æŸ¥è¯¢çš„ç»“æœã€‚\n// Using null safety, incorrectly: var map = {\u0026#39;key\u0026#39;: \u0026#39;value\u0026#39;}; print(map[\u0026#39;key\u0026#39;].length); // Error. å½“ä½ è¯•å›¾åœ¨ä¸€ä¸ªå¯ç©ºå­—ç¬¦ä¸²ä¸Šè°ƒç”¨.length æ—¶ï¼Œä¼šå‡ºç°ç¼–è¯‘é”™è¯¯ã€‚åœ¨ä½ çŸ¥é“é”®å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ï¼.length æ¥æ•™å¯¼ç±»å‹æ£€æŸ¥å™¨ã€‚\n// Using null safety: var map = {\u0026#39;key\u0026#39;: \u0026#39;value\u0026#39;}; print(map[\u0026#39;key\u0026#39;]!.length); // OK. æˆ‘ä»¬è€ƒè™‘è¿‡åœ¨ Map ä¸­æ·»åŠ å¦ä¸€ä¸ªæ–¹æ³•æ¥ä¸ºä½ åšè¿™ä»¶äº‹ï¼šæŸ¥æ‰¾ keyï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°å°±æŠ›å‡ºï¼Œå¦åˆ™å°±è¿”å›ä¸€ä¸ªéç©ºå€¼ã€‚ä½†æ˜¯è¯¥æ€ä¹ˆç§°å‘¼å®ƒå‘¢ï¼Ÿæ²¡æœ‰ä¸€ä¸ªåå­—æ¯”å•å­—ç¬¦çš„ !æ›´çŸ­ï¼Œä¹Ÿæ²¡æœ‰ä¸€ä¸ªæ–¹æ³•çš„åå­—æ¯”åœ¨è°ƒç”¨ç°åœºçœ‹åˆ°ä¸€ä¸ªå†…ç½®è¯­ä¹‰çš„ !æ›´æ¸…æ™°ã€‚æ‰€ä»¥ï¼Œåœ¨åœ°å›¾ä¸­è®¿é—®ä¸€ä¸ªå·²çŸ¥å­˜åœ¨å…ƒç´ çš„ä¹ æƒ¯æ€§æ–¹å¼æ˜¯ä½¿ç”¨[]! ä½ ä¼šä¹ æƒ¯çš„ã€‚\næ²¡æœ‰æœªå‘½åçš„ List æ„é€ å‡½æ•° List ä¸Šçš„æœªå‘½åæ„é€ å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªç»™å®šå¤§å°çš„æ–°åˆ—è¡¨ï¼Œä½†æ²¡æœ‰åˆå§‹åŒ–ä»»ä½•å…ƒç´ ã€‚å¦‚æœä½ åˆ›å»ºäº†ä¸€ä¸ªéå¯ç©ºç±»å‹çš„ listï¼Œç„¶åè®¿é—®ä¸€ä¸ªå…ƒç´ ï¼Œè¿™å°†ä¼šåœ¨å¥å…¨æ€§ä¿è¯ä¸­ç•™ä¸‹ä¸€ä¸ªéå¸¸å¤§çš„æ¼æ´ã€‚\nä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬å®Œå…¨åˆ é™¤äº†æ„é€ å‡½æ•°ã€‚åœ¨ç©ºå®‰å…¨ä»£ç ä¸­è°ƒç”¨ List()æ˜¯ä¸€ä¸ªé”™è¯¯ï¼Œå³ä½¿æ˜¯å¯ç©ºç±»å‹ã€‚è¿™å¬èµ·æ¥å¾ˆå“äººï¼Œä½†å®é™…ä¸Šï¼Œå¤§å¤šæ•°ä»£ç éƒ½æ˜¯ä½¿ç”¨ list literalsã€List.filled()ã€List.generate()æˆ–è€…ä½œä¸ºè½¬æ¢å…¶ä»–é›†åˆçš„ç»“æœæ¥åˆ›å»ºåˆ—è¡¨çš„ã€‚å¯¹äºæƒ³è¦åˆ›å»ºæŸç§ç±»å‹çš„ç©ºåˆ—è¡¨çš„è¾¹ç¼˜æƒ…å†µï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€ä¸ªæ–°çš„ List.empty()æ„é€ å‡½æ•°ã€‚\nåœ¨ Dart ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªå®Œå…¨æœªåˆå§‹åŒ–çš„åˆ—è¡¨çš„æ¨¡å¼ä¸€ç›´è®©äººè§‰å¾—æ ¼æ ¼ä¸å…¥ï¼Œç°åœ¨æ›´æ˜¯å¦‚æ­¤ã€‚å¦‚æœä½ çš„ä»£ç è¢«è¿™ä¸€ç‚¹ç ´åäº†ï¼Œä½ å¯ä»¥éšæ—¶é€šè¿‡ä½¿ç”¨è®¸å¤šå…¶ä»–çš„æ–¹æ³•æ¥äº§ç”Ÿä¸€ä¸ªåˆ—è¡¨æ¥ä¿®å¤å®ƒã€‚\nä¸èƒ½åœ¨ä¸å¯ç©ºçš„åˆ—è¡¨ä¸Šè®¾ç½®è¾ƒå¤§çš„é•¿åº¦ è¿™ä¸€ç‚¹é²œä¸ºäººçŸ¥ï¼Œä½† List ä¸Šçš„ length getter ä¹Ÿæœ‰ä¸€ä¸ªç›¸åº”çš„ setterã€‚ä½ å¯ä»¥å°†é•¿åº¦è®¾ç½®ä¸ºä¸€ä¸ªè¾ƒçŸ­çš„å€¼æ¥æˆªæ–­åˆ—è¡¨ã€‚ä½ ä¹Ÿå¯ä»¥å°†å®ƒè®¾ç½®ä¸ºä¸€ä¸ªè¾ƒé•¿çš„é•¿åº¦ï¼Œä»¥ä¾¿ç”¨æœªåˆå§‹åŒ–çš„å…ƒç´ å¡«å……åˆ—è¡¨ã€‚\nå¦‚æœä½ å¯¹ä¸€ä¸ªéç©ºå€¼ç±»å‹çš„åˆ—è¡¨è¿™æ ·åšï¼Œå½“ä½ ä»¥åè®¿é—®é‚£äº›æœªå†™å…¥çš„å…ƒç´ æ—¶ï¼Œä½ ä¼šè¿åå¥å…¨æ€§ã€‚ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µå‘ç”Ÿï¼Œå¦‚æœï¼ˆä¹Ÿåªæœ‰å½“ï¼‰åˆ—è¡¨çš„å…ƒç´ ç±»å‹æ˜¯ä¸å¯ç©ºçš„ï¼Œè€Œä½ åˆå°†å…¶è®¾ç½®ä¸ºè¾ƒé•¿çš„é•¿åº¦æ—¶ï¼Œé•¿åº¦è®¾ç½®å™¨ä¼šæŠ›å‡ºä¸€ä¸ªè¿è¡Œæ—¶å¼‚å¸¸ã€‚æˆªæ–­æ‰€æœ‰ç±»å‹çš„åˆ—è¡¨ä»ç„¶æ˜¯å¯ä»¥çš„ï¼Œä½ å¯ä»¥å¢é•¿å¯ç©ºç±»å‹çš„åˆ—è¡¨ã€‚\nå¦‚æœä½ å®šä¹‰äº†è‡ªå·±çš„åˆ—è¡¨ç±»å‹ï¼Œæ‰©å±•äº† ListBase æˆ–åº”ç”¨äº† ListMixinï¼Œé‚£ä¹ˆè¿™æœ‰ä¸€ä¸ªé‡è¦çš„åæœã€‚è¿™ä¸¤ç§ç±»å‹éƒ½æä¾›äº† insert()çš„å®ç°ï¼Œä¹‹å‰é€šè¿‡è®¾ç½®é•¿åº¦ä¸ºæ’å…¥çš„å…ƒç´ è…¾å‡ºç©ºé—´ã€‚è¿™æ ·åšä¼šå› ç©ºå®‰å…¨è€Œå¤±è´¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å°† ListMixinï¼ˆListBase å…±äº«ï¼‰ä¸­ insert()çš„å®ç°æ”¹ä¸ºè°ƒç”¨ add()ã€‚å¦‚æœä½ æƒ³èƒ½å¤Ÿä½¿ç”¨ç»§æ‰¿çš„ insert()æ–¹æ³•ï¼Œä½ çš„è‡ªå®šä¹‰åˆ—è¡¨ç±»åº”è¯¥æä¾› add()çš„å®šä¹‰ã€‚\nä¸èƒ½åœ¨è¿­ä»£ä¹‹å‰æˆ–ä¹‹åè®¿é—® Iterator.current Iterator ç±»æ˜¯ä¸€ä¸ªå¯å˜çš„ \u0026ldquo;æ¸¸æ ‡ \u0026ldquo;ç±»ï¼Œç”¨äºéå†å®ç° Iterable çš„ç±»å‹çš„å…ƒç´ ã€‚åœ¨è®¿é—®ä»»ä½•å…ƒç´ ä¹‹å‰ï¼Œä½ åº”è¯¥è°ƒç”¨ moveNext()æ¥å‰è¿›åˆ°ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚å½“è¯¥æ–¹æ³•è¿”å› false æ—¶ï¼Œä½ å·²ç»åˆ°è¾¾äº†ç»ˆç‚¹ï¼Œæ²¡æœ‰æ›´å¤šçš„å…ƒç´ ã€‚\nè¿‡å»ï¼Œå¦‚æœä½ åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ moveNext()ä¹‹å‰æˆ–åœ¨è¿­ä»£ç»“æŸåè°ƒç”¨å®ƒï¼Œcurrent ä¼šè¿”å› nullã€‚æœ‰äº† null å®‰å…¨ï¼Œé‚£å°±è¦æ±‚ current çš„è¿”å›ç±»å‹æ˜¯ E? è€Œä¸æ˜¯ Eã€‚è¿™åˆæ„å‘³ç€æ¯ä¸ªå…ƒç´ çš„è®¿é—®éƒ½éœ€è¦è¿›è¡Œè¿è¡Œæ—¶ç©ºæ£€æŸ¥ã€‚\né‰´äºå‡ ä¹æ²¡æœ‰äººä»¥é‚£ç§é”™è¯¯çš„æ–¹å¼è®¿é—®å½“å‰å…ƒç´ ï¼Œè¿™äº›æ£€æŸ¥å°†æ¯«æ— ç”¨å¤„ã€‚ç”±äºåœ¨è¿­ä»£ä¹‹å‰æˆ–ä¹‹åå¯èƒ½ä¼šæœ‰ä¸€ä¸ªè¯¥ç±»å‹çš„å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬è®©è¿­ä»£å™¨çš„è¡Œä¸ºæ²¡æœ‰è¢«å®šä¹‰ï¼Œå¦‚æœä½ åœ¨ä¸åº”è¯¥è°ƒç”¨å®ƒçš„æ—¶å€™è°ƒç”¨å®ƒã€‚å¤§å¤šæ•° Iterator çš„å®ç°éƒ½ä¼šæŠ›å‡ºä¸€ä¸ª StateErrorã€‚\næ€»ç»“ è¿™æ˜¯ä¸€ä¸ªéå¸¸è¯¦ç»†çš„å…³äº null å®‰å…¨çš„è¯­è¨€å’Œåº“å˜åŒ–çš„ä»‹ç»ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„ä¸œè¥¿ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªç›¸å½“å¤§çš„è¯­è¨€å˜åŒ–ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬å¸Œæœ›è¾¾åˆ°ä¸€ä¸ªç‚¹ï¼Œè®© Dart ä»ç„¶æ„Ÿè§‰åˆ°å‡èšåŠ›å’Œå¯ç”¨æ€§ã€‚è¿™ä¸ä»…éœ€è¦æ”¹å˜ç±»å‹ç³»ç»Ÿï¼Œè¿˜éœ€è¦æ”¹å˜å…¶ä»–ä¸€äº›å›´ç»•å®ƒçš„å¯ç”¨æ€§åŠŸèƒ½ã€‚æˆ‘ä»¬ä¸å¸Œæœ›å®ƒè®©äººæ„Ÿè§‰åƒè¢«æ “ä¸Šäº† null safetyã€‚\nè¦å¸¦èµ°çš„æ ¸å¿ƒç‚¹æ˜¯ã€‚\n  ç±»å‹åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸å¯ç©ºå€¼çš„ï¼Œè€Œé€šè¿‡æ·»åŠ  ?. æ¥å®ç°ç©ºå€¼åŒ–ã€‚\n  å¯é€‰å‚æ•°å¿…é¡»æ˜¯å¯ç©ºçš„ï¼Œæˆ–è€…æœ‰ä¸€ä¸ªé»˜è®¤å€¼ã€‚å¯ä»¥ä½¿ç”¨ required ä½¿å‘½åå‚æ•°æˆä¸ºéå¯é€‰å‚æ•°ã€‚ä¸å¯ç©ºå€¼çš„é¡¶å±‚å˜é‡å’Œé™æ€å­—æ®µå¿…é¡»æœ‰åˆå§‹åŒ–å™¨ã€‚ä¸å¯ç©ºå€¼çš„å®ä¾‹å­—æ®µå¿…é¡»åœ¨æ„é€ å‡½æ•°ä¸»ä½“å¼€å§‹ä¹‹å‰åˆå§‹åŒ–ã€‚\n  å¦‚æœæ¥æ”¶è€…ä¸ºç©ºï¼Œåˆ™ç©ºæ„ŸçŸ¥æ“ä½œç¬¦åçš„æ–¹æ³•é“¾ä¼šçŸ­è·¯ã€‚æœ‰æ–°çš„ç©ºæ„ŸçŸ¥çº§è”(?..)å’Œç´¢å¼•(?[])è¿ç®—ç¬¦ã€‚åç¼€çš„ç©ºæ–­è¨€ \u0026ldquo;bang\u0026rdquo; è¿ç®—ç¬¦(!)å°†å…¶å¯ç©ºæ“ä½œæ•°æŠ•å°„åˆ°åº•å±‚çš„éå¯ç©ºç±»å‹ã€‚\n  æµç¨‹åˆ†æè®©ä½ å¯ä»¥å®‰å…¨åœ°å°†å¯ç©ºçš„å±€éƒ¨å˜é‡å’Œå‚æ•°è½¬åŒ–ä¸ºå¯ç”¨çš„éå¯ç©ºå˜é‡ã€‚æ–°çš„æµåˆ†æè¿˜å¯¹ç±»å‹æå‡ã€ç¼ºå¤±è¿”å›ã€ä¸å¯è¾¾ä»£ç å’Œå˜é‡åˆå§‹åŒ–æœ‰æ›´æ™ºèƒ½çš„è§„åˆ™ã€‚\n  late ä¿®é¥°ç¬¦è®©ä½ å¯ä»¥åœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨ä¸å¯ç©ºç±»å‹å’Œ finalï¼Œå¦åˆ™ä½ å¯èƒ½æ— æ³•ä½¿ç”¨ï¼Œä½†ä¼šç‰ºç‰²è¿è¡Œæ—¶æ£€æŸ¥ã€‚å®ƒè¿˜ä¸ºä½ æä¾›äº†æƒ°æ€§åˆå§‹åŒ–çš„å­—æ®µã€‚\n  List ç±»è¢«ä¿®æ”¹ä¸ºé˜²æ­¢æœªåˆå§‹åŒ–å…ƒç´ ã€‚\n  æœ€åï¼Œä¸€æ—¦ä½ å¸æ”¶äº†æ‰€æœ‰è¿™äº›ï¼Œå¹¶è®©ä½ çš„ä»£ç è¿›å…¥ null å®‰å…¨çš„ä¸–ç•Œï¼Œä½ å°±ä¼šå¾—åˆ°ä¸€ä¸ªå¥å…¨çš„ç¨‹åºï¼Œç¼–è¯‘å™¨å¯ä»¥ä¼˜åŒ–ï¼Œå¹¶ä¸”åœ¨ä½ çš„ä»£ç ä¸­å¯ä»¥çœ‹åˆ°æ¯ä¸€ä¸ªå¯èƒ½å‘ç”Ÿè¿è¡Œæ—¶é”™è¯¯çš„åœ°æ–¹ã€‚æˆ‘ä»¬å¸Œæœ›ä½ è§‰å¾—è¿™æ ·çš„åŠªåŠ›æ˜¯å€¼å¾—çš„ã€‚\nåŸæ–‡é“¾æ¥: https://dart.dev/null-safety/understanding-null-safety\n","permalink":"https://ohmyweekly.github.io/notes/2021-03-05-understanding-null-safety/","tags":["Dart","Dart å®˜æ–¹æ–‡æ¡£"],"title":"Understanding Null Safety"},{"categories":["Raku"],"contents":"Raku æœ‰éå¸¸å¥½çš„ Unicode æ”¯æŒ, ä½†æ˜¯è¾“å…¥ Unicode ä¸€ç›´æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ã€‚åœ¨ REPL ä¸­, è¾“å…¥ Unicode éƒ½ä¸å¤ªæ–¹ä¾¿ã€‚ä¸‹é¢ä»‹ç»å‡ ç§æ–¹æ³•æ¥æ–¹ä¾¿åœ°è¾“å…¥ Unicodeã€‚\nComma æœ€æ–¹ä¾¿çš„æ˜¯ä½¿ç”¨ Raku è‡ªå·±çš„ IDE, Commaã€‚ä½†æ˜¯éœ€è¦åšä¸¤ä¸ªè®¾ç½®:\né¦–å…ˆ, åˆ‡æ¢åˆ° Comma IDE, ç‚¹å‡»å·¦ä¸Šè§’èœå•æ çš„ Comma é€‰é¡¹, åœ¨å¼¹å‡ºçš„ Preference çª—å£ä¸­, æ‰¾åˆ°å·¦ä¾§èœå•æ ä¸­çš„ Editor é€‰é¡¹, ç‚¹å‡» Code Style ä¸­çš„ Raku, åœ¨å³ä¾§çš„çª—å£çš„æœ€ä¸Šé¢, æ‰¾åˆ° Schema ä¸€è¡Œ, ç‚¹å‡»å€’ä¸‰è§’å›¾æ ‡, åœ¨ä¸‹æ‹‰èœå•ä¸­é€‰æ‹© Projectã€‚ç„¶ååœ¨ç¬¬äºŒè¡Œæ–‡å­—ä¸­æ‰¾åˆ° Editor Behavior, å‹¾é€‰ Convert operators to Unicodeã€‚å®Œæˆåç‚¹å‡»å³ä¸‹è§’çš„ Apply, ç„¶åç‚¹å‡» OKã€‚\nè¿™æ ·å½“ä½ åœ¨ Comma ä¸­é”®å…¥ \u0026gt;\u0026gt; è¿™æ ·çš„è¿ç®—ç¬¦å, Comma ä¼šè‡ªåŠ¨æŠŠå®ƒè½¬ä¸º Unicode å½¢å¼çš„ Â»ã€‚ç›®å‰å·²æ”¯æŒå¤§éƒ¨åˆ† Unicode è¿ç®—ç¬¦äº†ã€‚Comma æ˜¯è·¨å¹³å°çš„ Raku ç¼–è¾‘å™¨, æ”¯æŒ Windowsã€Linux å’Œ MacOS, æ‰€ä»¥ä½ æƒ³è·¨å¹³å°å¼€å‘çš„è¯, Comma å€¼å¾—ä¸€è¯•ã€‚\nKitty å¦‚æœä½ æƒ³åœ¨ Vim ä¸­å¼€å‘ Raku, åˆä¸æƒ³å¤±å»è¾“å…¥ Unicode çš„ä¹è¶£, è¯·ä½¿ç”¨ Kitty ç»ˆç«¯ã€‚ç‚¹å¼€ Kitty ç»ˆç«¯, ä½¿ç”¨å¿«æ·é”® Ctrl + Shift + U å³å¯è§¦å‘è¾“å…¥ Unnicode çš„ç•Œé¢(ä¹Ÿå¯ä»¥é”®å…¥å‘½ä»¤ kitty +kitten unicode_input æ¥è§¦å‘)ã€‚å†é€šè¿‡å¿«æ·é”® F1ã€F2ã€F3 å’Œ F4 (æˆ–é€šè¿‡ Ctrl+[ å’Œ Ctrl+] åˆ‡æ¢æ ‡ç­¾)å¯ä»¥åˆ†åˆ«æŒ‰ä»£ç æœç´¢ Unicodeã€æŒ‰åå­—æœç´¢ Unicodeã€æŒ‰è¡¨æƒ…æœç´¢å’Œæ”¶è—ã€‚\nä¾‹å¦‚åœ¨ REPL ä¸­é”®å…¥ Unicode å­—ç¬¦:\n$ raku Welcome to ğ‘ğšğ¤ğ®ğğ¨â„¢ v2021.02. Implementing the ğ‘ğšğ¤ğ®â„¢ programming language v6.d. Built on MoarVM version 2021.02. To exit type \u0026#39;exit\u0026#39; or \u0026#39;^D\u0026#39; \u0026gt; my @a = 1..5; \u0026gt; @aÂ».sin å€ŸåŠ© Kitty, æ•°ç»„ @a åé¢çš„ Â» å¯ä»¥è¿™æ ·è¾“å…¥, å…ˆè¾“å…¥ @a, ç„¶åä½¿ç”¨å¿«æ·é”® Shift + Ctrl + U è°ƒå‡º Kitty çš„ Unicode input ç•Œé¢, ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹æ³•, ç¬¬ä¸€ç§æ˜¯é€šè¿‡å¿«æ·é”® F1, ç„¶åè¾“å…¥å¯¹åº”çš„ Unicode ç¼–ç , å†å›è½¦ã€‚ç¬¬äºŒç§æ˜¯é€šè¿‡å¿«æ·é”® F2, é€šè¿‡åå­—æœç´¢, ä¾‹å¦‚è¾“å…¥å•è¯ quota, ä¼šå‡ºç°ä¸€å †å¼•å·ç¬¦å·ä¾›ä½ é€‰æ‹©, æŒ‰ä¸Šä¸‹æ–¹å‘é”®é€‰ä¸­ Â», å†å›è½¦å³å¯ã€‚Vim ä¸­åŒç†ã€‚\nJulia REPL åœ¨ REPL ä¸­è¾“å…¥ \\â€² + å•è¯ + Tab, ä¾‹å¦‚è¾“å…¥ \\heartsuit` å†æŒ‰ Tab, å°±ä¼šè‡ªåŠ¨å˜æˆ â™¡\njulia\u0026gt; \\heartsuit IPython \\^ è¾“å…¥ä¸Šæ ‡, \\_p è¾“å…¥ä¸‹æ ‡ã€‚\n$ ipython \\^a \\_p VScode \\\\â€² + å®Œæ•´çš„å•è¯ + Tab, VsCode ä¼šè‡ªåŠ¨è½¬æ¢ä¸º Unicodeã€‚ ä¾‹å¦‚ ^aå’Œ_p`\ndmenu #!/usr/bin/perl #use strict; #use warnings; #use autodie; #use utf8; open $FH, \u0026#34; | dmenu -i -l 30 -fn \u0026#39;-xos4-terminus-medium-r-*-*-10-*\u0026#39; | sed \u0026#39;s/^\\\\(.\\\\).*/\\\\1/\u0026#39; | tr -d \u0026#39;\\n\u0026#39; | { pbcopy; pbpaste; } \u0026#34;; # if you do not have the xos4-terminus font that makes characters a little bigger : # uncoment this line and use the second here document #open $FH, \u0026#34; | dmenu -i -l 30 | sed \u0026#39;s/^\\\\(.\\\\).*/\\\\1/\u0026#39; | tr -d \u0026#39;\\n\u0026#39; | { xsel -ib; xsel -ip; } \u0026#34;; # also you can compile dmenu from source and change the font size directly in the C done # in the file config.h / config.def.h # this heredoc is well aligned with the -xos4-terminus-medium-r-*-*-10-* font print $FH \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; Â« hyper operator Â» hyper operator âˆˆ membership âˆ‰ non-membership âˆª set union âˆ© set intersection âˆ– set difference â‰¡ set equality â‰¢ set inequality âŠ– symmetric set difference âŠ baggy multiplication âŠ baggy addition âˆ… empty set âŠ† subset âŠˆ not a subset âŠ‚ strict subset âŠ„ not a strict subset âˆ‹ reverse membership âˆŒ reverse non-membership âŠ‡ superset âŠ‰ not a superset âŠƒ strict superset âŠ… not a strict superset âˆ infinity âš› atomic operator Ï€ pi Ï„ tau ğ‘’ Euler\u0026#39;s number âˆ˜ function composition Ã— multiplication Ã· division â‰¤ inferior or equal â‰¥ greater or equal â‰  inequality âˆ’ substraction â‰… approximatively equal â€¦ sequence operator â€˜ left single quotation mark â€™ right single quotation mark â€š single low-9 quotation mark â€ right double quotation mark â€œ left double quotation mark â€ double low-9 quotation mark ï½¢ halfwidth left corner bracket ï½£ halfwidth right corner bracket âº plus superscript â» minus superscript â° 0 superscript Â¹ 1 superscript Â² 2 superscript Â³ 3 superscript â´ 4 superscript âµ 5 superscript â¶ 6 superscript â· 7 superscript â¸ 8 superscript â¹ 9 superscript EOF ; # use this without -xos4-terminus-medium-r-*-*-10-* font # the default font may change given which font packages are installed and given the font configurations #print $FH \u0026lt;\u0026lt;\u0026#39;EOF\u0026#39; #Â« hyper operator #Â» hyper operator #âˆˆ membership #âˆ‰ non-membership #âˆª set union #âˆ© set intersection #âˆ– set difference #â‰¡ set equality #â‰¢ set inequality #âŠ– symmetric set difference #âŠ baggy multiplication #âŠ baggy addition #âˆ… empty set #âŠ† subset #âŠˆ not a subset #âŠ‚ strict subset #âŠ„ not a strict subset #âˆ‹ reverse membership #âˆŒ reverse non-membership #âŠ‡ superset #âŠ‰ not a superset #âŠƒ strict superset #âŠ… not a strict superset #âˆ infinity #âš› atomic operator #Ï€ pi #Ï„ tau #ğ‘’ Euler\u0026#39;s number #âˆ˜ function composition #Ã— multiplication  #Ã· division #â‰¤ inferior or equal #â‰¥ greater or equal #â‰  inequality #âˆ’ substraction #â‰… approximatively equal #â€¦ sequence operator #â€˜ left single quotation mark #â€™ right single quotation mark #â€š single low-9 quotation mark  #â€ right double quotation mark #â€œ left double quotation mark #â€ double low-9 quotation mark #ï½¢ halfwidth left corner bracket #ï½£ halfwidth right corner bracket #âº plus superscript #â» minus superscript #â° 0 superscript #Â¹ 1 superscript  #Â² 2 superscript  #Â³ 3 superscript  #â´ 4 superscript  #âµ 5 superscript  #â¶ 6 superscript  #â· 7 superscript  #â¸ 8 superscript  #â¹ 9 superscript  #EOF #; close $FH; __END__ =pod =head1 NAME lazy_raku_unicode.pl =head1 SYNOPSIS This script allows you to select a Unicode symbol from a drop-down menu that you can simply paste into your text editor, terminal or IDE. All it does is send a heredoc through a pipe to dmenu, and copy to the clipboard the character that you selected. Dmenu is a program that reads lines from stdin, display them in a menu, and write to stdout the lines selected. It is not practical to execute this script from a terminal each time you want a character though. This is why it should be executed by sxhkd. Sxhkd is the program that will call this script each time you press the right key combination. Only the most useful Unicode characters are present to not make dmenu get too slow. (It is usually very fast when there is only ascii text.) This include most of the Raku operators that have a Unicode version, plus some quoting characters, superscripts, and mathematical constants. =head1 MANUAL INSTALLATION STEPS =head2 INSTALLING DMENU B\u0026lt;On Debian or Ubuntu :\u0026gt; sudo apt install suckless-tools B\u0026lt;On Archlinux :\u0026gt; sudo pacman -Sy dmenu B\u0026lt;Compile it from source :\u0026gt; https://tools.suckless.org/dmenu/ =head2 CHANGING DMENU FONT SIZE (OPTIIONAL) You have only two ways of changing the font size : Change the default font with the B\u0026lt;-fn\u0026gt; flag (See dmenu(1) for the specifics). dmenu -l 30 -fn \u0026#39;-xos4-terminus-medium-r-*-*-10-*\u0026#39; Modify directly the C source code of dmenu. Only the files B\u0026lt;config.h / config.def.h\u0026gt;. Simply edit this line and change 10 by 14 for example. static const char *fonts[] = { \u0026#34;monospace:size=10\u0026#34; }; Then execute sudo make install and you\u0026#39;re ready to go. =head2 INSTALLING SXHKD B\u0026lt;On Debian or Ubuntu :\u0026gt; sudo apt install sxhkd B\u0026lt;On Archlinux :\u0026gt; sudo pacman -Sy sxhkd =head2 CONFIGURING SXHKD B\u0026lt;Autostarting sxhkd at startup :\u0026gt; simply put this line in B\u0026lt;~/.xprofile\u0026gt; : sxhkd \u0026amp; B\u0026lt;Setting the keybinding :\u0026gt; Add these two lines in B\u0026lt;~/.config/sxhkd/sxhkdrc\u0026gt; ctrl + apostrophe /path/to/lazy_raku_unicode.pl The keybinding have to start at the beginning of a line, and the command has to follow on the next line and be preceded by a tabulation. To make sxhkd reload the config file, either kill it and relaunch it, or send a SIGUSR1 signal. This command can do it : pidof sxhkd | kill -SIGUSR1 $(cat /dev/stdin) If you want to use a different keybinding, please see sxhkd(1) and use xev(1) to find the name of keys. Here the name of some of the keys : ctrl, super, alt, Return . =head1 SEE ALSO dmenu(1), sxhkd(1), xev(1) =cut å‚è€ƒé“¾æ¥: https://docs.raku.org/language/unicode_entry\n","permalink":"https://ohmyweekly.github.io/notes/2021-03-01-how-to-type-unicode-in-raku/","tags":["Raku","Unicode"],"title":"å¦‚ä½•åœ¨ Raku ä¸­è¾“å…¥ Unicode"},{"categories":["Raku"],"contents":"åœ¨æˆ‘çš„ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘åˆä¸€æ¬¡ä¸ºä» CORE ä¸­å¢å¼ºç±»çš„æ–¹æ³•è€Œè‹¦æ¼ã€‚è¿™ç§æŒ£æ‰å®Œå…¨æ²¡æœ‰å¿…è¦ï¼Œå› ä¸ºæˆ‘å¹¶æ²¡æœ‰ç”¨å¢åŠ çš„æ–¹æ³•æ”¹å˜å¯¹è±¡çš„çŠ¶æ€ã€‚å¯¹äºåšæ›´é«˜çº§çš„ä¸œè¥¿ï¼Œæˆ‘å¯èƒ½ä¸å¾—ä¸è¿™æ ·åšã€‚æŠŠæ‰‹ä¼¸è¿› Raku çš„å†…éƒ¨è¿™ä¹ˆæ·±ï¼Œæˆ‘å¯èƒ½ä¼šæŠŠè‡ªå·±çƒ«ä¼¤ã€‚æ—¢ç„¶æˆ‘æƒ³åšçš„æ˜¯æŠŠæˆ‘çš„ä»£ç ç»‘åœ¨ç¼–è¯‘å™¨çš„å˜åŒ–ä¸Šï¼Œåæ­£æˆ‘å¯èƒ½ä¼šå…¨èº«å¿ƒåœ°æŠ•å…¥åˆ° nqp-land ä¸­å»ã€‚\nmy \\j = 1 | 2 | 3; dd j; use nqp; .say for nqp::getattr(j, Junction, \u0026#39;$!eigenstates\u0026#39;); # OUTPUT: any(1, 2, 3) 1 2 3 æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ nqp æ¥è·å–ç§æœ‰å±æ€§ï¼Œè€Œä¸éœ€è¦æ·»åŠ ä»»ä½•æ–¹æ³•ã€‚è¿™å°±æœ‰ç‚¹å„¿ä¸ä¼¦ä¸ç±»äº†ã€‚æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬ç”¨ä¸€ä¸ªä¼ªæ–¹æ³•æ¥åšä¸€äº› deboilerplatingã€‚\nsub pry(Mu $the-object is raw) { use InterceptAllMethods; class Interceptor { has Mu $!the-object; method ^find_method(Mu \\type, Str $name) { my method (Mu \\SELF:) is raw { use nqp; my $the-object := nqp::getattr(SELF, Interceptor, \u0026#39;$!the-object\u0026#39;); nqp::getattr($the-object, $the-object.WHAT, \u0026#39;$!\u0026#39; ~ $name) } } } use nqp; nqp::p6bindattrinvres(nqp::create(Interceptor), Interceptor, \u0026#39;$!the-object\u0026#39;, $the-object); } .say for j.\u0026amp;pry.eigenstates; # OUTPUT: 1 2 3 é€šè¿‡ InterceptAllMethodsï¼Œlizmat æ”¹å˜äº†ç±»å…³é”®å­—çš„è¡Œä¸ºï¼Œå…è®¸æˆ‘ä»¬æä¾›ä¸€ä¸ª FALLBACK-method æ¥æ•è·ä»»ä½•æ–¹æ³•ï¼ŒåŒ…æ‹¬ä» Mu ç»§æ‰¿çš„æ–¹æ³•ã€‚è¿™åè¿‡æ¥åˆå…è®¸ pry è¿”å›çš„å¯¹è±¡å°†ä»»ä½•æ–¹æ³•è°ƒç”¨è½¬ç§»åˆ°ä¸€ä¸ªè‡ªå®šä¹‰çš„æ–¹æ³•ã€‚åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ .\u0026amp;pry è¢«è°ƒç”¨çš„å¯¹è±¡åšä»»ä½•æˆ‘ä»¬æƒ³åšçš„äº‹æƒ…ã€‚\nç”±äºæˆ‘ä»¬çš„ç‰¹æ®Šå¯¹è±¡ä¼šæ‹¦æˆªä»»ä½•è°ƒç”¨ï¼Œç”šè‡³æ˜¯ Mu çš„è°ƒç”¨ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å¦ä¸€ç§æ–¹æ³•æ¥è°ƒç”¨ .newã€‚ç”±äº .^ ä¸æ˜¯ . çš„ç‰¹æ®Šå½¢å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥è·å¾—å¯¹ç±»æ–¹æ³•çš„è®¿é—®ã€‚\nsub interceptor(Method $the-method){ use InterceptAllMethods; use nqp; sub (Mu $the-object is raw) { my class Interceptor { has Mu $!the-object; has Code $!the-method; method ^find_method(Mu \\type, Mu:D $name) { my method (Mu \\SELF: |c) is raw { $!the-method.($!the-object, $name, |c) } } method ^introspect(Mu \\type, Mu \\obj) { my method call-it() is raw { $!the-object } obj.\u0026amp;call-it; } method ^new(Mu \\type, $the-object!, $the-method) { nqp::p6bindattrinvres( nqp::p6bindattrinvres(nqp::create(Interceptor), Interceptor, \u0026#39;$!the-object\u0026#39;, $the-object), Interceptor, \u0026#39;$!the-method\u0026#39;, $the-method) } } # nqp::p6bindattrinvres( # nqp::p6bindattrinvres(nqp::create(Interceptor), Interceptor, \u0026#39;$!the-object\u0026#39;, $the-object), # Interceptor, \u0026#39;$!the-method\u0026#39;, $the-method); Interceptor.^new($the-object, $the-method) } } my \u0026amp;first-defined = interceptor( my method (Positional \\SELF: $name) { for SELF.flat -\u0026gt; $e { with $e.\u0026#34;$name\u0026#34;(|%_) { .return } } Nil } ); my $file = \u0026lt;file1.txt file2.txt file3.txt nohup.out\u0026gt;Â».IO.\u0026amp;first-defined.open(:r); dd $file; # OUTPUT: Handle $file = IO::Handle.new(path =\u0026gt; IO::Path.new(\u0026#34;nohup.out\u0026#34;, :SPEC(IO::Spec::Unix), :CWD(\u0026#34;/home/dex/projects/raku/tmp\u0026#34;)), chomp =\u0026gt; Bool::True, nl-in =\u0026gt; $[\u0026#34;\\n\u0026#34;, \u0026#34;\\r\\n\u0026#34;], nl-out =\u0026gt; \u0026#34;\\n\u0026#34;, encoding =\u0026gt; \u0026#34;utf8\u0026#34;) sub interceptor æ¥å—ä¸€ä¸ªæ–¹æ³•å¹¶è¿”å›ä¸€ä¸ª subã€‚å¦‚æœè¿™ä¸ª sub åƒæ–¹æ³•ä¸€æ ·è¢«è°ƒç”¨ï¼Œå®ƒå°†æŠŠè¦è¢«è°ƒç”¨çš„æ–¹æ³•çš„åç§°å’Œè°ƒç”¨è€…è½¬å‘ç»™ä¸€ä¸ªè‡ªå®šä¹‰æ–¹æ³•ã€‚å½“ .\u0026amp;first-defined è¢«è°ƒç”¨æ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹å®ƒæ˜¯ä»€ä¹ˆã€‚\nmy \\uhhh-special = \u0026lt;a b c\u0026gt;.\u0026amp;first-defined; dd uhhh-special.^introspect(uhhh-special); # OUTPUT: ($(\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;, \u0026#34;c\u0026#34;), method \u0026lt;anon\u0026gt; (Positional \\SELF: $name, *%_) { #`(Method|93927752146784) ... }) æˆ‘ä»¬å¿…é¡»ç»™ .^introspect ä¸€ä¸ªæˆ‘ä»¬æƒ³çœ‹çš„å¯¹è±¡ï¼Œå› ä¸ºå®ƒçš„è°ƒç”¨è€…æ˜¯ç±» Interceptor çš„ç±»å‹å¯¹è±¡ã€‚\nç›®å‰ï¼Œæˆ‘è¿˜ä¸çŸ¥é“æœ‰ä»€ä¹ˆåŠæ³•ï¼ˆæ¯•ç«Ÿï¼Œæˆ‘çŸ¥é“çš„åªæ˜¯è¶³å¤Ÿå¤šçš„ä¸œè¥¿ï¼ŒçœŸçš„å¾ˆå±é™©ã€‚è¿™æ˜¯ä¸å¹¸çš„ï¼Œå› ä¸º lizmat å†³å®šé‡è½½å…³é”®å­— classï¼Œè€Œä¸æ˜¯ç”¨ä¸åŒçš„åå­—å¯¼å‡ºç‰¹æ®Šçš„ Metamodel::ClassHOWã€‚å¦‚æœæˆ‘ä»¬ä¸æƒ³æˆ–ä¸èƒ½æœ‰å¤–éƒ¨ä¾èµ–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ MOP æ¥åˆ›å»ºæˆ‘ä»¬çš„ç±»å‹å¯¹è±¡ã€‚\nclass InterceptHOW is Metamodel::ClassHOW { method publish_method_cache(|) { } } sub ipry(Mu $the-object is raw) { my \\Interceptor = InterceptHOW.new_type(:name\u0026lt;Interceptor\u0026gt;); Interceptor.^add_attribute(Attribute.new(:name\u0026lt;$!the-object\u0026gt;, :type(Mu), :package(Interceptor))); Interceptor.^add_meta_method(\u0026#39;find_method\u0026#39;, my method find_method(Mu \\type, Str $name) { # say â€looking for $nameâ€œ; my method (Mu \\SELF:) is raw { use nqp; my $the-object := nqp::getattr(SELF, Interceptor, \u0026#39;$!the-object\u0026#39;); nqp::getattr($the-object, $the-object.WHAT, \u0026#39;$!\u0026#39; ~ $name) } }); Interceptor.^compose; use nqp; nqp::p6bindattrinvres(nqp::create(Interceptor), Interceptor, \u0026#39;$!the-object\u0026#39;, $the-object); } å½“æˆ‘å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œæˆ‘å‘ç° .^add_meta_method åªæœ‰åœ¨æä¾›ç»™å®ƒçš„æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„åå­—å’Œ Str ç›¸åŒçš„æ—¶å€™æ‰ä¼šå·¥ä½œã€‚èµ·åˆï¼Œæˆ‘å°è¯•äº†ä¸€ä¸ªåŒ¿åæ–¹æ³•ï¼Œå®ƒæœ€ç»ˆå‡ºç°åœ¨ .^meta_method_table ä¸­ï¼Œä½†ä»æœªè¢«è°ƒç”¨ã€‚æˆ‘æƒ³è¿™ä¸ª bug å…¶å®å¹¶ä¸é‡è¦ï¼Œå› ä¸ºè¿™ä¸ªå…ƒæ–¹æ³•æ ¹æœ¬æ²¡æœ‰è¢«è®°å½•ä¸‹æ¥ã€‚å¦‚æœæˆ‘ç©ç«ï¼Œæˆ‘æ²¡æœ‰æƒåˆ©æŠ±æ€¨çƒ§ä¼¤ã€‚ä½ ä¼šåœ¨é‡å¤–çš„ Actions.nqp ä¸­å‘ç°è¿™ä¸ªæ–¹æ³•ã€‚Class å…³é”®å­—å¹¶æ²¡æœ‰ä»€ä¹ˆç¥å¥‡çš„ä½œç”¨ã€‚Rakudo åªæ˜¯ä½¿ç”¨ MOP æ¥æ„é€ ç±»å‹å¯¹è±¡ã€‚\næˆ‘ä»¬ä¸èƒ½åœ¨ Raku ä¸­é‡è½½èµ‹å€¼æ“ä½œç¬¦ã€‚è¿™å…¶å®å¹¶ä¸éœ€è¦ï¼Œå› ä¸ºèµ‹å€¼æ˜¯é€šè¿‡è°ƒç”¨ä¸€ä¸ªåä¸º STORE çš„æ–¹æ³•æ¥å®ç°çš„ã€‚ç”±äºæˆ‘ä»¬å¾—åˆ°äº†å¯¹ dispatch çš„å®Œå…¨æ§åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥æ‹¦æˆªä»»ä½•æ–¹æ³•è°ƒç”¨ï¼ŒåŒ…æ‹¬ä¸€è¿ä¸²çš„æ–¹æ³•è°ƒç”¨ã€‚\nmulti sub methodify(%h, :$deeply!) { sub interceptor(%h, $parent = Nil){ use InterceptAllMethods; use nqp; class Interceptor is Callable { has Mu $!the-object; has Mu @!stack; method ^find_method(Mu \\type, Mu:D $name) { my method (Mu \\SELF: |c) is raw { my @new-stack = @!stack; my $the-object = $!the-object; if $name eq \u0026#39;STORE\u0026#39; { # workaround for rakudobug#4203 $the-object{||@new-stack.head(*-1)}:delete if $the-object{||@new-stack.head(*-1)}:exists; $the-object{||@new-stack} = c; return-rw c } else { @new-stack.push: $name; my \\nextlevel = SELF.^new($!the-object, @new-stack, $name); nextlevel } } } method ^introspect(Mu \\type, Mu \\obj) { my method call-it() is raw { $!the-object, @!stack } obj.\u0026amp;call-it; } method ^new(Mu \\type, $the-object!, @new-stack?, $name?) { $name ?? nqp::p6bindattrinvres( nqp::p6bindattrinvres(nqp::create(Interceptor), Interceptor, \u0026#39;$!the-object\u0026#39;, $the-object), Interceptor, \u0026#39;@!stack\u0026#39;, @new-stack) !! nqp::p6bindattrinvres(nqp::create(Interceptor), Interceptor, \u0026#39;$!the-object\u0026#39;, $the-object) } } Interceptor.^new(%h) } interceptor(%h) } my %h2; my $o2 = methodify(%h2, :deeply); $o2.a.b = 42; dd %h2; $o2.a.b.c = \u0026lt;answer\u0026gt;; dd %h2; say $o2.a.b.c; # OUTPUT: Hash %h2 = {:a(${:b(\\(42))})} Hash %h2 = {:a(${:b(${:c(\\(\u0026#34;answer\u0026#34;))})})} This type cannot unbox to a native string: P6opaque, Interceptor in block \u0026lt;unit\u0026gt; at /home/dex/projects/raku/any-chain.raku line 310 æ¯å½“æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Interceptor å®ä¾‹ï¼Œå®ƒå­˜å‚¨äº†å‰ä¸€ä¸ªæ–¹æ³•çš„åç§°ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ²¿ç€æ–¹æ³•è°ƒç”¨é“¾ç§»åŠ¨ã€‚ç”±äºèµ‹å€¼è°ƒç”¨ STOREï¼Œæˆ‘ä»¬å¯ä»¥å°†èµ‹å€¼è½¬ç§»åˆ°æˆ‘ä»¬ç”¨ä½œå®é™…æ•°æ®ç»“æ„çš„ Hash ä¸­ã€‚å”‰ï¼Œæ£€ç´¢å€¼å°±ä¸ä¸€æ ·äº†ï¼Œå› ä¸º Raku ä¸åŒºåˆ†æ–¹æ³•è°ƒç”¨å’Œ FETCHã€‚åœ¨è¿™é‡Œï¼Œé¾™æ¯”æˆ‘å¼ºã€‚æˆ‘è¿˜æ˜¯åŒ…å«äº†è¿™ä¸ªä¸€åŠå¤±è´¥çš„å°è¯•ï¼Œå› ä¸ºæˆ‘å¯¹ slippy åŠåˆ—è¡¨æœ‰å¾ˆå¥½çš„åˆ©ç”¨ã€‚è¿™éœ€è¦ä½¿ç”¨ v6.e.previewï¼Œè®©æˆ‘è¸©åˆ°äº†ä¸€ä¸ª bugã€‚å¯èƒ½è¿˜æœ‰æ›´å¤šè¿™æ ·çš„æƒ…å†µã€‚æ‰€ä»¥è¯·ä½¿ç”¨åŒæ ·çš„ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ .e å‘å¸ƒåˆ°é‡å¤–ä¹‹å‰ï¼ŒæŠŠæ‰€æœ‰çš„é‡å…½éƒ½æ€æ‰ã€‚\nèƒ½å¤Ÿå®Œå…¨æ§åˆ¶æ–¹æ³•è°ƒç”¨é“¾å°†æ˜¯ä¸€ä»¶å¥½äº‹ã€‚ä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥ç”¨ RakuAST æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚\næœ‰äº†è¿™äº›å·²ç»å¯ä»¥å·¥ä½œçš„ä¸œè¥¿ï¼Œæˆ‘ä»¬å¯ä»¥åšä¸€äº›æœ‰è¶£çš„äº‹æƒ…ã€‚é‚£äº›çƒ¦äººçš„å¼‚å¸¸æ€»æ˜¯åœ¨æ‹–æˆ‘ä»¬çš„åè…¿ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ try æ¥åŒ–è§£å®ƒä»¬ï¼Œä½†é‚£ä¼šç ´åä¸€ä¸ªæ–¹æ³•è°ƒç”¨é“¾ã€‚\nconstant no-argument-given = Mu.new; sub try(Mu $obj is raw, Mu $alternate-value = no-argument-given) { interceptor(my method (Mu \\SELF: $name, |c) { my $o = SELF; my \\m = $o.^lookup($name) orelse { my $bt = Backtrace.new; my $idx = $bt.next-interesting-index($bt.next-interesting-index + 1); (X::Method::NotFound.new(:method($name), :typename($o.^name)) but role :: { method vault-backtrace { False }}).throw(Backtrace.new($idx + 1)); } try { $o = $o.\u0026#34;$name\u0026#34;(|c); } $! ~~ Exception ?? $alternate-value.WHICH eqv no-argument-given.WHICH ?? $o !! $alternate-value !! $o }).($obj) } class C { has $.greeting; method might-throw { die \u0026#34;Not today love!\u0026#34; } method greet { say $.greeting } } C.new(greeting =\u0026gt; â€šLet\u0026#39;s make love!â€˜).\u0026amp;try.might-throw.greet; # OUTPUT: Let\u0026#39;s make love! ä¼ªæ–¹æ³• try å°†ä¼šåŒ–è§£ä»»ä½•å¼‚å¸¸ï¼Œå¹¶å…è®¸ç»§ç»­è°ƒç”¨ C è¯­è¨€çš„æ–¹æ³•ã€‚æˆ‘å¿…é¡»ç”¨ä¸€ä¸ªç‰¹æ®Šçš„å€¼æ¥æ ‡è®°æ²¡æœ‰å¯é€‰çš„å‚æ•° $alternate-valueï¼Œå› ä¸ºå®ƒå®é™…ä¸Šå¯èƒ½ä¼šæŠŠå¼‚å¸¸å¯¹è±¡å˜æˆ Nilã€‚\næˆ‘å¾ˆè‚¯å®šè¿˜æœ‰å¾ˆå¤šè¿™æ ·çš„å°å¸®æ‰‹åœ¨ç­‰ç€æˆ‘ä»¬å»å‘ç°ã€‚æœªæ¥å¯èƒ½ä¼šæœ‰ä¸€ä¸ªæ¨¡å—ï¼Œå¸Œæœ›èƒ½å¸®åŠ© Raku æˆä¸ºä¸€ä¸ªå¥½çš„ç¼–ç¨‹è¯­è¨€ã€‚\nåŸæ–‡é“¾æ¥: https://gfldex.wordpress.com/2021/02/17/method-ish/\n","permalink":"https://ohmyweekly.github.io/notes/2021-02-17-method-isd/","tags":["Raku","Raku åšå®¢"],"title":"Method-ish"},{"categories":["Raku"],"contents":"ä¸€ç›´ä»¥æ¥ä¹äºåŠ©äººçš„ raiph åœ¨å›ç­”ä¸€ä¸ªå…³äºæ¨¡å¼åŒ¹é…çš„é—®é¢˜æ—¶å¸Œæœ›å¾—åˆ° RakuASTï¼Œå°±åƒåœ¨ Haskell ä¸­ä¸€æ ·ã€‚æœ‰äººæå‡ºç”¨ MMD æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚è¿™æ ·åšï¼Œå¾—åˆ°ä¸€ä¸ªè´¯ç©¿çš„é»˜è®¤è·¯å¾„æ˜¯æ— è§£çš„ã€‚ç”±äº dispatch ç®€å•æ¥è¯´å°±æ˜¯æ¨¡å¼åŒ¹é…ï¼Œæˆ‘ä»¬åªéœ€è¦åšä¸€äº›é¢å¤–çš„å·¥ä½œã€‚ç®€è€Œè¨€ä¹‹ï¼Œdispatcher å¾—åˆ°ä¸€ä¸ªå‡½æ•°åˆ—è¡¨å’Œä¸€ä¸ªå¸¦å‚æ•°çš„åˆ—è¡¨ã€‚ç¬¬ä¸€ä¸ªæ¥å—æ‰€æœ‰å‚æ•°çš„å‡½æ•°è·èƒœã€‚\nclass Hold { has $.key; } class Press { has $.key; } class Err { has $.msg; } sub else(\u0026amp;code) { \u0026amp;code } sub match($needle, *@tests) { for @tests.head(*-1) -\u0026gt; \u0026amp;f { if \u0026amp;f.cando(\\($needle)) { return f($needle); } } @tests.tail.(); } match Hold.new(:key\u0026lt;a\u0026gt;), -\u0026gt; Hold (:$key) { put â€holding $keyâ€œ; }, -\u0026gt; Press (:$key) { put â€pressing $keyâ€œ; }, -\u0026gt; Err (:$msg) { warn â€ERR: $msgâ€œ }, else { fail â€šunsopportedâ€˜ }; æ–¹æ³• .cando éœ€è¦ä¸€ä¸ª Capture æ¥å‘Šè¯‰æˆ‘ä»¬ä¸€ä¸ª Routine æ˜¯å¦å¯ä»¥ç”¨ä¸€ä¸ªç»™å®šçš„å‚æ•°åˆ—è¡¨æ¥è°ƒç”¨ã€‚ä¸ºäº†åˆ›å»ºè¿™æ ·ä¸€ä¸ªæ•è·ï¼Œæˆ‘ä»¬ä½¿ç”¨å­—é¢çš„ \\($arguments, $go, $here)ã€‚æˆ‘ä»¬ä¸åœ¨æœ€åæµ‹è¯•é»˜è®¤å€¼ã€‚ç›¸åï¼Œå½“æ²¡æœ‰å…¶ä»–å‡½æ•°åŒ¹é…æ—¶ï¼Œæˆ‘ä»¬ä¼šè°ƒç”¨è¯¥å‡½æ•°ã€‚å£°æ˜ sub else åªæ˜¯ä¸ºäº†ç¾åŒ–ã€‚\nç”±äºæˆ‘ä»¬æ˜¯åœ¨å‡½æ•°å¼çš„åœŸåœ°ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Raku æä¾›ç»™æˆ‘ä»¬çš„æ‰€æœ‰æ–¹ä¾¿çš„åŠŸèƒ½ã€‚\nmy \u0026amp;key-matcher = \u0026amp;match.assuming(*,[ -\u0026gt; Hold (:$key) { put â€holding $keyâ€œ; }, -\u0026gt; Press (:$key) { put â€pressing $keyâ€œ; }, -\u0026gt; Err (:$msg) { warn â€ERR: $msgâ€œ }, else { fail â€šunsopportedâ€˜ }; ]); sub key-source { gather loop { sleep 1; take (Hold.new(:key\u0026lt;a\u0026gt;), Press.new(:key\u0026lt;b\u0026gt;), Err.new(:msg\u0026lt;WELP!\u0026gt;), \u0026#39;unsupported\u0026#39;).pick; } } .\u0026amp;key-matcher for key-source; æˆ‘ä»¬è¦å¸®åŠ© .assuming æœ‰ç‚¹ç†è§£ slurpiesï¼ŒæŠŠå‡½æ•°åˆ—è¡¨æ”¾åœ¨ä¸€ä¸ªæ˜¾å¼ Array ä¸­ã€‚\næ€»æœ‰ä¸€ç§å‡½æ•°å¼çš„æ–¹æ³•æ¥è§£å†³ä¸€ä¸ªé—®é¢˜ã€‚æœ‰æ—¶æˆ‘ä»¬ç”šè‡³å¯ä»¥ä»ä¸­å¾—åˆ°ä¸€ä¸ªæ•´é½çš„è¯­æ³•ã€‚\nåŸæ–‡é“¾æ¥: https://gfldex.wordpress.com/2021/02/24/pattern-dispatch/\n","permalink":"https://ohmyweekly.github.io/notes/2021-02-28-pattern-dispatch/","tags":["Raku","Raku åšå®¢"],"title":"æ¨¡å¼åˆ†æ´¾"},{"categories":["Raku"],"contents":"æˆ‘ä¸å¤ªå–œæ¬¢ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ä½¿ç”¨åŒ¹é…çš„è¯­æ³•ã€‚å®ƒçš„å‚æ•°åˆ—è¡¨ä¸­çš„é€—å·çœ‹èµ·æ¥å¾ˆå¥‡æ€ªï¼Œä¸åˆé€‚ã€‚ä¹Ÿè®¸æ˜¯å› ä¸ºæˆ‘çš„çœ¼ç›ä¹ æƒ¯äº†ç»™å®šçš„å—ã€‚ç¡ä¸€è§‰å°±å¥½äº†ã€‚\nsub accord(\u0026amp;c) { (c(CALLER::\u0026lt;$_\u0026gt;); succeed) if \u0026amp;c.cando(\\(CALLER::\u0026lt;$_\u0026gt;)) } given Err.new(:msg\u0026lt;a\u0026gt;) { accord -\u0026gt; Hold (:$key) { put â€holding $keyâ€œ; } accord -\u0026gt; Err (:$msg) { warn â€ERR: $msgâ€œ } default { fail â€šunsupportedâ€˜ } } è¿™æ˜¯å› ä¸º accord æ¨¡ä»¿äº† when çš„å·¥ä½œã€‚å®ƒåšäº†ä¸€äº›åŒ¹é…ï¼Œå½“ True æ—¶è°ƒç”¨ä¸€ä¸ªå—ï¼Œå¹¶åœ¨æ¯ä¸ªå—çš„ç»“å°¾æ·»åŠ ä¸€ä¸ª successï¼ˆé€šè¿‡æŠ›å‡ºä¸€ä¸ªæ§åˆ¶å¼‚å¸¸ï¼‰ã€‚given æ‰€åšçš„åªæ˜¯è®¾ç½®ä¸»é¢˜ã€‚å®ƒè¿˜å……å½“äº† caller çš„è§’è‰²ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªä¼ªåŒ…æ¥è®¿é—®å®ƒçš„ $_ã€‚åˆ©ç”¨ pointy çš„ç­¾åæ¥åšè§£æ„æ˜¯ç›¸å½“å¼ºå¤§çš„ã€‚æŠŠè¿™ä¸ªæ·»åŠ åˆ° CORE ä¸­å¯èƒ½æ˜¯ä¸ªå¥½ä¸»æ„ã€‚\næˆ‘ä»¬å¯èƒ½è¦æŠŠ Raku çš„å®šä¹‰æ”¹æˆ: \u0026ldquo;Raku æ˜¯ä¸€ç§é«˜åº¦å¯ç»„åˆçš„ç¼–ç¨‹è¯­è¨€\u0026rdquo;, åœ¨è¿™é‡Œï¼Œæ‰€æœ‰çš„ä¸œè¥¿éƒ½ä¼šè½åˆ°å®å¤„ã€‚\u0026quot;\næ›´æ–°ä¸€ä¸‹ã€‚\næœ‰äº›æƒ…å†µä¸‹ï¼Œ$_ ä¸æ˜¯åŠ¨æ€çš„ã€‚å¦å¤–ï¼Œsuccess æ­£åœ¨æŠ›å‡ºä¸€ä¸ªæ§åˆ¶å¼‚å¸¸ï¼Œè€Œè¿™äº›çš„å¤„ç†ç¨‹åºæ˜¯ç”± when æˆ–é»˜è®¤æ·»åŠ çš„ã€‚è¿™ç§æƒ…å†µæ˜¯åœ¨ç¼–è¯‘æ—¶å‘ç”Ÿçš„ï¼Œç›®å‰ä¸èƒ½ç”¨å®æ¥è§£å†³ã€‚ç¬¬ä¸€ä¸ªé—®é¢˜å¯ä»¥ç”¨é»‘é­”æ³•è§£å†³ã€‚åä¸€ä¸ªé—®é¢˜éœ€è¦ç”¨é»˜è®¤å—ã€‚æˆ‘æ²¡æœ‰æ‰¾åˆ°ä¸€ç§æ–¹æ³•æ¥æä¾›ä¸€ä¸ªåˆç†çš„é”™è¯¯ä¿¡æ¯ï¼Œå¦‚æœç¼ºå°‘è¿™ä¸ªå—ã€‚\nmulti sub accord(\u0026amp;c) { use nqp; $_ := nqp::getlexcaller(\u0026#39;$_\u0026#39;); (c($_); succeed) if \u0026amp;c.cando(\\($_)) } for @possibilities.roll(1) -\u0026gt; $needle { given $needle { accord -\u0026gt; Hold (:$key) { put â€holding $keyâ€œ; } accord -\u0026gt; Err (:$msg) { warn â€ERR: $msgâ€œ } default { warn â€šunsopportedâ€˜ } } } åŸæ–‡é“¾æ¥: https://gfldex.wordpress.com/2021/02/25/custom-when/\n","permalink":"https://ohmyweekly.github.io/notes/2021-02-28-custom-when/","tags":["Raku","Rakulang"],"title":"è‡ªå®šä¹‰ when"},{"categories":["rakulang"],"contents":"åœ¨è¿‡å»çš„å‡ å‘¨é‡Œï¼Œæˆ‘çœ‹åˆ°äº†ä¸€äº›æ–‡ç« å’Œè§†é¢‘ï¼Œè®²è¿°äº†åœ¨å¼€æºè½¯ä»¶ä¸­æ„æ€æ˜¯å¤šä¹ˆçš„ä¼Ÿå¤§ã€‚è¿™æ¬¡æˆ‘åˆæƒ³èµ·äº†å¦ä¸€ç¯‡æ—§æ–‡Raku æ˜¯æˆ‘çš„ MMORPGã€‚å®ƒè¯´ï¼Œä½ å¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢å—ç›Šäºå¼€æºè½¯ä»¶ã€‚æ¯”å¦‚è¯´ï¼Œå¯ä»¥åšä¸€ä¸ªå¤§ä¾ ï¼ŒåŸºäºä¸€äº›å¼€æºè½¯ä»¶æ¥å†™è½¯ä»¶ã€‚ä½œä¸ºå†™æ‰‹ï¼Œå¯ä»¥å†™åšå®¢ã€å¾®åšç­‰ï¼Œå¯¹æ‰€é€‰è½¯ä»¶äº§ç”Ÿå…´è¶£ã€‚æˆ–è€…ä½ å¯ä»¥æˆä¸ºä¸€ä¸ªæ³•å¸ˆ - å®ç°æ–°çš„åŠŸèƒ½å’Œä¿®å¤ bugã€‚ä»Šå¤©å°ç¼–å°±å¸¦ç€å¼“ç®­æ‰‹æ¥å‘Šè¯‰å¤§å®¶å¦‚ä½•æˆä¸º Raku ç¼–ç¨‹è¯­è¨€çš„æ³•å¸ˆã€‚\né€‰æ‹©ä¸€ä¸ªä»»åŠ¡ è®©æˆ‘ä»¬æŒ‘é€‰ä¸€äº›ç¼–è¯‘å™¨çš„ bugï¼Œå¹¶ä¿®å¤å®ƒã€‚è®©æˆ‘ä»¬å» Rakudo ç¼–è¯‘å™¨ issuesä¸­é€‰æ‹©æˆ‘ä»¬æƒ³è¦ä¿®å¤çš„ bugã€‚æˆ‘æ»šåŠ¨äº†ä¸€ä¸‹ bug åˆ—è¡¨ï¼Œé‡åˆ°äº†è§£æ - è¿æ°”ä¸é”™ï¼Œæˆ‘å‰æ®µæ—¶é—´ä¸€ç›´åœ¨ç ”ç©¶ç¼–è¯‘å™¨è¯­æ³•ï¼Œçœ‹äº†ä¸€æœ¬è¿™æ–¹é¢çš„å¥½ä¹¦ã€‚æ‰¾åˆ°äº†å››ä¸ªé—®é¢˜ã€‚\n æ ‡ç­¾ä¸º LTA ï¼ˆLess Than Awesome - å½“çœŸå®è¡Œä¸ºä¸ç›´è§‰é¢„æœŸä¸åŒæ—¶ï¼‰- æˆ‘ä»¬æš‚æ—¶æŠŠå®ƒåˆ’æ‰ã€‚ æ ‡ç­¾ \u0026ldquo;éœ€è¦å…±è¯†\u0026rdquo; - æˆ‘ä»¬åªæƒ³ä¿®å¤ä¸€ä¸ªä¸å¤æ‚çš„ bug - è‚¯å®šè¦åˆ’æ‰ã€‚ æ ‡ç­¾ä¸º \u0026ldquo;grammar and actions\u0026rdquo; çš„å…³äºä¸€ä¸ªå¯èƒ½æ­»çš„ä»£ç æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å€™é€‰äººçš„ç¬¬ä¸€ä¸ªä»»åŠ¡ã€‚  ä»»åŠ¡ç¡®å®šåï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦é…ç½®å·¥ä½œç¯å¢ƒã€‚åœ¨ Windowsã€Linux å’Œ macOS ä¸­ï¼Œä¸€åˆ‡åº”è¯¥éƒ½å·®ä¸å¤šã€‚æˆ‘å°†é€šè¿‡ macOS çš„ä¾‹å­æ¥å‘Šè¯‰ä½ ã€‚\nå»ºç«‹å·¥ä½œç¯å¢ƒ ä¸ºæºç å’Œæˆ‘ä»¬å»ºç«‹çš„ç¼–è¯‘å™¨å»ºç«‹æ–‡ä»¶å¤¹ã€‚\nmkdir ~/dev-rakudo \u0026amp;\u0026amp; mkdir ~/dev-rakudo-install Rakudo ç¼–è¯‘å™¨ç”±ä¸‰éƒ¨åˆ†ç»„æˆã€‚\n è™šæ‹Ÿæœºã€‚ç°åœ¨æœ‰ä¸‰ç§ - JVMã€JS å’Œ MoarVMã€‚æˆ‘ä»¬ä»¥ MoarVM ä¸ºæœ€ç¨³å®šçš„ä¸€ä¸ªã€‚ NQPï¼ˆNot Quite Perlï¼‰ï¼Œæ˜¯ä¸€ç§ä½çº§ï¼ˆä¸­çº§ï¼‰è¯­è¨€çš„å®ç°ï¼Œå®ƒæ˜¯ Raku çš„ä¸€ä¸ª \u0026ldquo;å­é›†\u0026rdquo;ã€‚è™šæ‹Ÿæœºå¯ä»¥æ‰§è¡Œç”¨ NQP ç¼–å†™çš„ä»£ç ã€‚ Rakudo ç¼–è¯‘å™¨æœ¬èº«ï¼Œç”¨ NQP å’Œ Raku ç¼–å†™ã€‚  ä¸‹è½½å¹¶ç¼–è¯‘è¿™ä¸‰ä¸ªç»„ä»¶ã€‚æˆ‘åˆ†åˆ«èŠ±äº†ä¸€åˆ†åŠé’Ÿã€åŠåˆ†é’Ÿå’Œä¸¤åˆ†åŠé’Ÿæ‰ç¼–å¥½ã€‚\ncd ~/dev-rakudo \u0026amp;\u0026amp; git clone git@github.com:MoarVM/MoarVM.git \u0026amp;\u0026amp; cd MoarVM perl Configure.pl --prefix ~/dev-rakudo-install \u0026amp;\u0026amp; make -j 4 \u0026amp;\u0026amp; make install cd ~/dev-rakudo \u0026amp;\u0026amp; git clone git@github.com:Raku/nqp.git \u0026amp;\u0026amp; cd nqp perl Configure.pl --backend=moar --prefix ~/dev-rakudo-install \u0026amp;\u0026amp; make -j 4 \u0026amp;\u0026amp; make install cd ~/dev-rakudo \u0026amp;\u0026amp; git clone git@github.com:rakudo/rakudo.git \u0026amp;\u0026amp; cd rakudo perl Configure.pl --backend=moar --prefix ~/dev-rakudo-install \u0026amp;\u0026amp; make -j 4 \u0026amp;\u0026amp; make install æ³¨æ„å‚æ•°ã€‚--prefix æ˜¾ç¤ºäº† make install å‘½ä»¤åå¯æ‰§è¡Œæ–‡ä»¶çš„å¤åˆ¶ä½ç½®ï¼Œ--backend=moar è¡¨ç¤ºæ­£åœ¨ä½¿ç”¨çš„è™šæ‹Ÿæœºï¼Œè€Œ -j 4 åˆ™è¦æ±‚è·¨å¤šçº¿ç¨‹å¹¶è¡ŒåŒ–ï¼ˆä»¥é˜²åŠ å¿«è¿›åº¦ï¼‰ã€‚ç°åœ¨æˆ‘ä»¬å·²ç»å»ºç«‹äº† Rakudo ç¼–è¯‘å™¨ ~/dev-rakudo-install/bin/rakuã€‚æˆ‘ä»¬è¿˜éœ€è¦å®˜æ–¹çš„ç¼–è¯‘å™¨æµ‹è¯•å¥—ä»¶ã€‚ä½ åº”è¯¥æŠŠå®ƒå’Œå®ƒçš„ä»£ç ä¸€èµ·æ”¾åœ¨æ–‡ä»¶å¤¹é‡Œã€‚\ncd ~/dev-rakudo/rakudo \u0026amp;\u0026amp; git clone https://github.com/Raku/roast.git t/spec æˆ‘ä»¬å…ˆè¿›è¡Œæµ‹è¯•ã€‚è¿™ç§æƒ…å†µå¾ˆå¸¸è§ï¼Œæœ‰äº›æµ‹è¯•ç”šè‡³åœ¨æ–°çš„å˜åŒ–ä¹‹å‰å°±å¤±è´¥äº†ã€‚æˆ‘ä»¬éœ€è¦è¾¨åˆ«å‡ºæ¥ï¼Œè¿™æ ·ä»¥åå°±ä¸ä¼šå®³æ€•è¿™äº›å˜åŒ–ç ´åäº†ä¸€äº›ä¸å¿…è¦çš„ä¸œè¥¿ã€‚\nè¿™é‡Œå’Œä¸‹é¢æˆ‘å°†åœ¨ ~/dev-rakudo/rakudo æ–‡ä»¶å¤¹ä¸­å·¥ä½œï¼Œé™¤éå¦æœ‰è¯´æ˜ã€‚\n\u0026gt; make spectest [...] Test Summary Report ------------------- t/spec/S32-str/utf8-c8.t (Wstat: 65280 Tests: 54 Failed: 0) Non-zero exit status: 255 Parse errors: Bad plan. You planned 66 tests but ran 54. Files=1346, Tests=117144, 829 wallclock secs (27.70 usr 6.04 sys + 2638.79 cusr 210.98 csys = 2883.51 CPU) Result: FAIL make: *** [m-spectest5] Error 1 14åˆ†é’Ÿå†…å…±è¿è¡Œäº†1,346ä¸ªæ–‡ä»¶ä¸­çš„117,144æ¬¡æµ‹è¯•ã€‚ä¸€äº›ä¸utf8ç›¸å…³çš„æµ‹è¯•ç”±äºæŸç§åŸå› å¤±è´¥äº†ï¼Œå…¶ä»–çš„éƒ½èƒ½æ­£å¸¸å·¥ä½œã€‚æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½å»å·¥ä½œäº†!\nè®©æˆ‘ä»¬æ¥çœ‹çœ‹é—®é¢˜çš„é™ˆè¿° é—®é¢˜é™ˆè¿°è¯´ï¼ŒæŸä¸ªå…ƒè¿ç®—ç¬¦ R åœ¨ colonpair ä¸Šå‡ºäº†é—®é¢˜ã€‚æˆ‘æ‰“å¼€æ–‡æ¡£ï¼Œæœç´¢ R è¿™ä¸ªè¯ï¼Œä½†ä¸‹æ‹‰åˆ—è¡¨ä¸­æ²¡æœ‰è¿™ä¸ªåå­—çš„å…ƒè¿ç®—ç¬¦ã€‚æˆ‘è¯•ç€è¾“å…¥ metaopï¼Œçœ‹åˆ°çš„æ˜¯åå‘å…ƒæ“ä½œç¬¦(R)ã€‚åŸæ¥ï¼Œå¦‚æœä½ æƒ³æŠŠäºŒå…ƒè¿ç®—çš„æ“ä½œæ•°æŒ‰ç›¸åçš„é¡ºåºå†™å‡ºæ¥ï¼Œä½ å¯ä»¥åœ¨å…¶ç¬¦å·å‰ä½¿ç”¨å‰ç¼€ Rã€‚\nsay 3 R- 2 == -1 # Output: True Colonpair æ˜¯å‘½åå¯¹çš„è¯­æ³•ã€‚å®ƒçœ‹èµ·æ¥å°±åƒåå­—å‰é¢æœ‰ä¸€ä¸ªå†’å·ï¼Œå‰é¢æœ‰ä¸€ä¸ªæ‹¬å·ï¼Œæœ‰ä¸€ä¸ªå€¼ã€‚ä¾‹å¦‚ :foo(42) æ˜¯ä¸€ä¸ªåç§°ä¸º fooã€å€¼ä¸º 42 çš„å¯¹å„¿ã€‚è¿™ä¸ªè¯­æ³•é€šå¸¸ç”¨äºåœ¨è°ƒç”¨å‡½æ•°æ—¶ï¼Œå‘å‡½æ•°ä¼ é€’ä¸€ä¸ªå‘½åå‚æ•°ä¸­çš„å€¼ã€‚\nsub sub-with-named-parameter(:$foo) { say $foo; } sub-with-named-parameter(:foo(42)); # Output: 42 å¦‚æœä¸€ä¸ªå‡½æ•°å‚æ•°ä¸æ˜¯å‘½åçš„ï¼Œè€Œæ˜¯ä½ç½®çš„ï¼Œé‚£ä¹ˆåœ¨ç”¨å‘½åå¯¹è°ƒç”¨æ—¶ï¼Œå°±ä¼šå‡ºç°ç¼–è¯‘é”™è¯¯ã€‚\nsub sub-without-named-parameter($foo) { # \u0026lt;- æ²¡æœ‰å†’å· say $foo; } sub-without-named-parameter(:foo(42)); # Unexpected named argument \u0026#39;foo\u0026#39; passed å¦‚æœä½ åœ¨è°ƒç”¨è¿™æ ·çš„å‡½æ•°æ—¶ç”¨æ‹¬å·åŒ…å›´ä¸€ä¸ªå‚æ•°ï¼Œæ•´ä¸ªå‚æ•°å¯¹å°†è¢«ä¼ é€’åˆ°ä½ç½®å‚æ•°ã€‚\nsub sub-without-named-parameter($foo) { say $foo; } sub-without-named-parameter((:foo(42))); # Output: foo =\u0026gt; 42 åœ¨ Raku ä¸­ï¼Œä½ å¯ä»¥å†™ä¸€ä¸ªå‡½æ•°æ¥æ•è·æ‰€æœ‰ä¼ é€’ç»™å®ƒçš„å‚æ•°å¹¶åˆ†æå®ƒä»¬ã€‚è¿™æ˜¯åœ¨å•ä¸ªå‚æ•° - æ•è·å‰ç”¨ç«–çº¿å®Œæˆçš„ã€‚\nsub sub-with-capture(|foo) { # \u0026lt;- å‚æ•°æ•è· say foo; } sub-with-capture(:foo(42)); # Output: \\(:foo(42)) sub-with-capture(42); # Output: \\(42) sub-with-capture(:foo(3 Z- 2)); # Output: \\(:foo((1,).Seq)) sub-with-capture(:foo(3 R- 2)); # Output: \\(-1) å€’æ•°ç¬¬äºŒè¡Œä½¿ç”¨äº† Z å…ƒæ“ä½œç¬¦ - zip æ“ä½œç¬¦ã€‚å®ƒå°†å·¦å³ä¸¤éƒ¨åˆ†ä½œä¸ºä¸€ä¸ªåˆ—è¡¨ï¼ŒæŒ‰é¡ºåºæ¯æ¬¡ä»å®ƒä»¬ä¸­æŠ½å–ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¿›è¡Œæ“ä½œï¼Œä»è€Œå½¢æˆä¸€ä¸ªåºåˆ—ã€‚\nåœ¨æœ€åä¸€è¡Œï¼Œåªç”¨äº†æˆ‘ä»¬éœ€è¦çš„ R å…ƒæ“ä½œç¬¦ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªå¯¹ï¼Œè€Œæ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œå®ƒè¢«ä¼ é€’åˆ°å‡½æ•°ä¸­ã€‚æˆ‘ä»¬å¯ä»¥å‡è®¾è¿™æ˜¯å…ƒè¿ç®—ç¬¦å·¥ä½œæ–¹å¼çš„ä¸€äº›ç‰¹æ®Šæ€§ï¼Œä½†ç”¨ Z çš„ä¾‹å­è¡¨æ˜å¹¶éå¦‚æ­¤ã€‚å…¶å®è¿™æ˜¯ä¸€ä¸ª bug - å½“ä¸€ä¸ªå¯¹è¢«ä¼ é€’åˆ°ä¸€ä¸ªä½¿ç”¨ R å…ƒè¿ç®—ç¬¦çš„å‡½æ•°ä¸­æ—¶ï¼Œå®ƒçš„å€¼ä¼šè¢«è½¬æ¢ã€‚\næˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ–°çš„æµ‹è¯• ä¸ºäº†ç¡®ä¿æœªæ¥çš„å˜åŒ–èƒ½å¤Ÿä¿®å¤é”™è¯¯çš„è¡Œä¸ºï¼Œæˆ‘ä»¬éœ€è¦å†™ä¸€ä¸ªæ–°çš„æµ‹è¯•ã€‚åœ¨æµ‹è¯•æ–‡ä»¶ä¸­ä¸éš¾æ‰¾åˆ° R å…ƒæ“ä½œç¬¦çš„æµ‹è¯•ï¼ˆS03-metops/reverse.tï¼‰ã€‚ä¸‹é¢æˆ‘å°†è¡¥å……ä»¥ä¸‹æµ‹è¯•ã€‚\n# https://github.com/rakudo/rakudo/issues/1632 { sub subroutine($expected, |actual) { is actual.gist, $expected, \u0026#34;Ğ¡olonpair exists\u0026#34; } subroutine(\u0026#39;\\(:foo(-1))\u0026#39;, :foo(3 R- 2)); } è¯¥æµ‹è¯•æœ‰ä¸€ä¸ªåŠŸèƒ½ï¼Œæœ‰ä¸¤ä¸ªå‚æ•° - æ­£å¸¸å’Œæ•è·ã€‚åœ¨å‡½æ•°ä½“ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°å’Œä¼ é€’çš„ Capture çš„å­—ç¬¦ä¸²è¡¨ç¤ºè¿›è¡Œæ¯”è¾ƒã€‚ä½ å¯ä»¥ä½¿ç”¨ make å¯¹æ–°æ„å»ºçš„ç¼–è¯‘å™¨è¿›è¡Œå•ç‹¬æµ‹è¯•ã€‚\n\u0026gt; make t/spec/S03-metaops/reverse.t [...] ok 69 - [R~]= not ok 70 - Colonpair exists # Failed test 'Colonpair exists' # at t/spec/S03-metaops/reverse.t line 191 # expected: '\\(:foo(-1))' # got: '\\(-1)' # You planned 69 tests, but ran 70 # You failed 1 test of 70 ä½ å¯ä»¥çœ‹åˆ°ï¼Œæµ‹è¯•å¤±è´¥äº†ï¼ˆå¦‚é¢„æœŸï¼‰ã€‚è¿˜æœ‰ä¸€ä¸ªå•ç‹¬çš„è¯´æ˜ï¼Œç³»ç»Ÿé¢„è®¡69æ¬¡æµ‹è¯•ï¼Œä½†æ”¶åˆ°70æ¬¡ã€‚è¿™æ˜¯åŸºäº TAP çš„æµ‹è¯•ç³»ç»Ÿçš„ç‰¹ç‚¹ - å¿…é¡»åœ¨æ–‡ä»¶çš„é¡¶éƒ¨ä¿®æ­£ä¼ é€’ç»™ plan å‡½æ•°çš„æ•°å­—ã€‚ç°åœ¨æµ‹è¯•å´©æºƒäº†ï¼Œä½†ç¼–å·æ²¡æœ‰å—åˆ°å½±å“ã€‚ä½ å¯ä»¥å¼€å§‹ä¿®å¤å®ƒã€‚\nå‡è§†æ³• ä¸€å¼€å§‹æˆ‘å¾ˆç›¸ä¿¡ä»»åŠ¡ä¸Šçš„æ ‡ç­¾ - å¦‚æœæ˜¯è§£æçš„è¯ï¼Œä¸€å®šæ˜¯æºç è§£æé˜¶æ®µçš„æŸä¸ªåœ°æ–¹å‡ºç°äº†é—®é¢˜ã€‚ç›®å‰æˆ‘çš„è®¤è¯†å¦‚ä¸‹ï¼š\n åŸºç¡€è§£æå™¨ä»£ç åœ¨æ–‡ä»¶ rakudo/src/Perl6/Grammar.nqp ä¸­ã€‚ è¿™ä¸ªè§£æå™¨æ˜¯ä» nqp/src/HLL/Grammar.nqp æ–‡ä»¶ä¸­çš„åŸºç¡€è§£æå™¨ç»§æ‰¿çš„ã€‚ å…ƒæ“ä½œç¬¦çš„è§£æå’Œå·¥ä½œæ–¹å¼éƒ½å·®ä¸å¤šï¼Œä½ å¯ä»¥é€šè¿‡ä»”ç»†è§‚å¯Ÿæ¥å‘ç°ä¸åŒä¹‹å¤„ã€‚  æˆ‘åœ¨åŸºç¡€è§£æå™¨ä»£ç ä¸­æ‰¾åˆ°äº†å¯¹å…ƒæ“ä½œç¬¦çš„å¼•ç”¨ã€‚\ntoken infix_prefix_meta_operator:sym\u0026lt;R\u0026gt; {\u0026lt;sym\u0026gt;\u0026lt;infixish(\u0026#39;R\u0026#39;)\u0026gt;{}\u0026lt;.can_meta($\u0026lt;infixish\u0026gt;, \u0026#34;reverse the args of\u0026#34;)\u0026gt;\u0026lt;O=.revO($\u0026lt;infixish\u0026gt;)\u0026gt;} token infix_prefix_meta_operator:sym\u0026lt;Z\u0026gt; {\u0026lt;sym\u0026gt;\u0026lt;infixish(\u0026#39;Z\u0026#39;)\u0026gt;{}\u0026lt;.can_meta($\u0026lt;infixish\u0026gt;, \u0026#34;zip with\u0026#34;)\u0026gt;\u0026lt;O(|%list_infix)\u0026gt;} è¿™éœ€è¦å¯¹ Raku grammar æœ‰ä¸€å®šçš„äº†è§£ã€‚æ®æˆ‘æ‰€çŸ¥ï¼ŒåŸæ¥è¿™ä¸¤ä¸ªå…ƒè¿ç®—ç¬¦åœ¨è§£æä¸Šå¹¶æ²¡æœ‰æ ¹æœ¬çš„åŒºåˆ«ã€‚ä¸€æ®µæ—¶é—´åï¼Œåœ¨è§£æå™¨çš„æºä»£ç ä¸­æŒ–å¾—å¤Ÿå¤šäº†ï¼Œæˆ‘å¼€å§‹æ€€ç–‘è§£æå·¥ä½œæ˜¯å¦æ­£ç¡®ã€‚è®¤ä¸ºä»£ç  my $r = :foo(3 R- 2); say $r; # Output: foo =\u0026gt; -1 æ­£ç¡®å·¥ä½œçš„å»ºè®® - é—®é¢˜æ°æ°å‘ç”Ÿåœ¨è°ƒç”¨å‡½æ•°æ—¶ã€‚æ˜¾ç„¶ï¼Œæˆ‘ç™½ç™½ç›¸ä¿¡äº†ä»»åŠ¡æ ä¸Šçš„æ ‡ç­¾ã€‚\nç¼–è¯‘å™¨å°†å¸®åŠ©æˆ‘ä»¬ é¢‡ä¸ºè¿Ÿé’çš„æˆ‘æƒ³èµ·äº†æˆ‘ä»ä¸€å¼€å§‹å°±åº”è¯¥åšçš„äº‹æƒ…ã€‚Rakudo ç¼–è¯‘å™¨æœ‰ --target è°ƒè¯•å¼€å…³ã€‚å®ƒå–ç¼–è¯‘å™¨é˜¶æ®µçš„åç§°ï¼Œä½ æƒ³å°†å…¶ç»“æœè¾“å‡ºåˆ°æ§åˆ¶å°å¹¶é€€å‡ºã€‚æˆ‘æƒ³çœ‹çœ‹ --target=parseï¼ˆå› ä¸ºæˆ‘åªçŸ¥é“è¿™ä¸€ä¸ªï¼‰ã€‚\næˆ‘ä» ~/dev-rakudo/rakudo æ–‡ä»¶å¤¹ä¸­ä½¿ç”¨ rakumo-mï¼Œè¿™æ ·æˆ‘å°±ä¸å¿…ç­‰å¾…é€šè¿‡ make install å‘½ä»¤å°†æ‰€éœ€æ–‡ä»¶å¤åˆ¶åˆ° ~/dev-rakudo-installã€‚ç®€å•çš„è„šæœ¬å¯ä»¥è¿™æ ·è¿è¡Œã€‚æ›´å¤æ‚çš„è„šæœ¬å¿…é¡»åœ¨ make install ä¹‹åä» -install ä¸­è¿è¡Œã€‚\n\u0026gt; cat ~/test.raku sub s(|c) { say c } s(:foo(3 R- 2)); s(:foo(3 Z- 2)); \u0026gt; ./rakudo-m --target=parse ~/test.raku [...] - args: (:foo(3 R- 2)) - semiarglist: :foo(3 R- 2) - arglist: 1 matches - EXPR: :foo(3 R- 2) - colonpair: :foo(3 R- 2) - identifier: foo - coloncircumfix: (3 R- 2) - circumfix: (3 R- 2) - semilist: 3 R- 2 - statement: 1 matches - EXPR: R- 2 [...] - args: (:foo(3 Z- 2)) - semiarglist: :foo(3 Z- 2) - arglist: 1 matches - EXPR: :foo(3 Z- 2) - colonpair: :foo(3 Z- 2) - identifier: foo - coloncircumfix: (3 Z- 2) - circumfix: (3 Z- 2) - semilist: 3 Z- 2 - statement: 1 matches - EXPR: Z- 2 [...] ç»“è®ºï¼šR å’Œ Z çš„è§£ææ˜¯ä¸€æ ·çš„ã€‚\nè¿™ä¸æ˜¯è§£æ æ‰€æœ‰è¢«è§£æçš„ä¸œè¥¿éƒ½ä¼šè¢«ä¼ é€’ç»™æ‰€è°“çš„ Actionï¼ŒæŠŠå­—è¯å˜æˆä¸€æ£µè¯­æ³•æ ‘ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼ŒActions ä½äºæ–‡ä»¶ rakudo/src/Perl6/Actions.nqp å’Œ nqp/src/HLL/Actions.nqp ä¸­ã€‚è¿™é‡Œå°±æ¯”è¾ƒå®¹æ˜“ææ¸…æ¥šäº†ï¼Œæ¯•ç«Ÿæ˜¯ä»£ç ï¼Œæ˜¯ grammarã€‚\næˆ‘åœ¨ä¸» Actions ä¸­æ‰¾åˆ°äº†ä»¥ä¸‹ä»£ç ã€‚\n[...] elsif $\u0026lt;infix_prefix_meta_operator\u0026gt; { [...] if $metasym eq 'R' { $helper := '\u0026amp;METAOP_REVERSE'; $t := nqp::flip($t) if $t; } elsif $metasym eq 'X' { $helper := '\u0026amp;METAOP_CROSS'; $t := nqp::uc($t); } elsif $metasym eq 'Z' { $helper := '\u0026amp;METAOP_ZIP'; $t := nqp::uc($t); } my $metapast := QAST::Op.new( :op\u0026lt;call\u0026gt;, :name($helper), WANTED($basepast,'infixish') ); $metapast.push(QAST::Var.new(:name(baseop_reduce($base\u0026lt;OPER\u0026gt;\u0026lt;O\u0026gt;.made)), :scope\u0026lt;lexical\u0026gt;)) if $metasym eq 'X' || $metasym eq 'Z'; [...] å®ƒè¯´ï¼Œå¦‚æœåœ¨ä»£ç ä¸­è§£æäº†å…ƒæ“ä½œç¬¦ Rã€Z æˆ– Xï¼Œå°±åº”è¯¥åœ¨è¯­æ³•æ ‘ä¸­æ·»åŠ ä¸€äº› METAOP_ å‡½æ•°è°ƒç”¨ã€‚åœ¨ Z å’Œ X çš„æƒ…å†µä¸‹ï¼Œå®ƒä¼šå¤šä¸€ä¸ªå‚æ•°ï¼Œå³æŸç§è¿˜åŸå‡½æ•°ã€‚æ‰€æœ‰è¿™äº›åŠŸèƒ½éƒ½å¯ä»¥åœ¨ rakudo/src/core.c/metaops.pm6 ä¸­æ‰¾åˆ°ã€‚\nsub METAOP_REVERSE(\\op) is implementation-detail { -\u0026gt; |args { op.(|args.reverse) } } sub METAOP_ZIP(\\op, \u0026amp;reduce) is implementation-detail { nqp::if(op.prec(\u0026#39;thunky\u0026#39;).starts-with(\u0026#39;.\u0026#39;), -\u0026gt; +lol { my $arity = lol.elems; [...] }, -\u0026gt; +lol { Seq.new(Rakudo::Iterator.ZipIterablesOp(lol,op)) } ) } ç»™ä½ ï¼š\n \\op æ˜¯ç”±æˆ‘ä»¬çš„å…ƒæ“ä½œç¬¦ï¼Œå³-ï¼Œåœ¨å‰é¢çš„æ“ä½œã€‚ Trait implementation-detail åªæ˜¯è¡¨æ˜è¿™ä¸æ˜¯å…¬å…±ä»£ç ï¼Œæ˜¯ç¼–è¯‘å™¨å®ç°çš„ä¸€éƒ¨åˆ†ã€‚ ç”±äº-æ“ä½œæ²¡æœ‰ç¬¨é‡çš„ç‰¹æ€§ï¼Œæ‰€ä»¥ \u0026amp;reduce å‡½æ•°ä¸ä¼šå‚ä¸è®¡ç®—ï¼ŒZ çš„ç»“æœæ˜¯ Seq.new(...)ã€‚ R çš„ç»“æœæ˜¯ä¸€ä¸ªæ“ä½œè°ƒç”¨ - å‚æ•°é¡ºåºç›¸åã€‚  è¿™æ—¶æˆ‘æƒ³èµ·è¿˜æœ‰ä¸€ä¸ª - ç›®æ ‡ï¼Œå³æ˜Ÿã€‚å®ƒå°†æ˜¾ç¤ºè¡ŒåŠ¨çš„ç»“æœã€‚\n\u0026gt; ./rakudo-m --target=ast ~/test.raku [...] - QAST::Op(call \u0026amp;s) \u0026lt;sunk\u0026gt; :statement_id\u0026lt;4\u0026gt; s(:foo(3 R- 2)) - QAST::Op+{QAST::SpecialArg}(call :named\u0026lt;foo\u0026gt;) \u0026lt;wanted\u0026gt; :statement_id\u0026lt;5\u0026gt; :before_promotion\u0026lt;?\u0026gt; R- - QAST::Op(call \u0026amp;METAOP_REVERSE) \u0026lt;wanted\u0026gt; :is_pure\u0026lt;?\u0026gt; - QAST::Var(lexical \u0026amp;infix:\u0026lt;-\u0026gt;) \u0026lt;wanted\u0026gt; - QAST::Want \u0026lt;wanted\u0026gt; 3 - QAST::WVal(Int) - Ii - QAST::IVal(3) 3 - QAST::Want \u0026lt;wanted\u0026gt; 2 - QAST::WVal(Int) - Ii - QAST::IVal(2) 2 [...] - QAST::Op(call \u0026amp;s) \u0026lt;sunk\u0026gt; :statement_id\u0026lt;7\u0026gt; s(:foo(3 Z- 2)) - QAST::Op+{QAST::SpecialArg}(:named\u0026lt;foo\u0026gt;) \u0026lt;wanted\u0026gt; :statement_id\u0026lt;8\u0026gt; :before_promotion\u0026lt;?\u0026gt; Z- - QAST::Op(call \u0026amp;METAOP_ZIP) \u0026lt;wanted\u0026gt; :is_pure\u0026lt;?\u0026gt; - QAST::Var(lexical \u0026amp;infix:\u0026lt;-\u0026gt;) \u0026lt;wanted\u0026gt; - QAST::Var(lexical \u0026amp;METAOP_REDUCE_LEFT) - QAST::Want \u0026lt;wanted\u0026gt; 3 - QAST::WVal(Int) - Ii - QAST::IVal(3) 3 - QAST::Want \u0026lt;wanted\u0026gt; 2 - QAST::WVal(Int) - Ii - QAST::IVal(2) 2 [...] ä¸€å¦‚æ‰€æ–™ã€‚é™¤äº†è°ƒç”¨ä¸åŒçš„ METAOP_ å‡½æ•°å¤–ï¼Œæ‰€æœ‰çš„ä¸œè¥¿å‡ ä¹éƒ½æ˜¯ä¸€æ ·çš„ã€‚ä»å®ƒä»¬çš„ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼ŒåŸåˆ™ä¸Šè¿™äº›å‡½æ•°çš„ä¸åŒä¹‹å¤„åœ¨äºè¿”å›å€¼çš„ç±»å‹ - åˆ†åˆ«æ˜¯ Int å’Œ Seqã€‚ä¼—æ‰€å‘¨çŸ¥ï¼ŒRaku å¯¹ä¸åŒç±»å‹çš„å¯¹è±¡çš„ä¸Šä¸‹æ–‡ç›¸å½“æ•æ„Ÿ\u0026hellip;\u0026hellip;æˆ‘æƒ³ï¼Œå®ƒå…³æ³¨çš„å¯èƒ½æ˜¯è¿”å›å€¼ã€‚æˆ‘è¯•ç€ç”¨ä¸‹é¢çš„æ–¹å¼ä¿®æ”¹ä»£ç ã€‚\nsub METAOP_REVERSE(\\op) is implementation-detail { -\u0026gt; |args { Seq.new(op.(|args.reverse)) } } ç¼–è¯‘ã€è¿è¡Œã€‚\n\u0026gt; make [...] Stage start : 0.000 Stage parse : 61.026 Stage syntaxcheck: 0.000 Stage ast : 0.000 Stage optimize : 7.076 Stage mast : 14.120 Stage mbc : 3.941 [...] \u0026gt; ./rakudo-m ~/test.raku \\(-1) \\(:foo((1,).Seq)) ä¸€åˆ‡éƒ½æ²¡æœ‰æ”¹å˜ã€‚æ‰€ä»¥ï¼Œä¸æ˜¯è¿”å›å€¼\u0026hellip;\u0026hellip;æƒ³äº†æƒ³ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆç»“æœåˆæ˜¯ -1 è€Œä¸æ˜¯ (-1,).Seqã€‚è€Œä¸”ï¼Œä»ä»£ç æ¥çœ‹ï¼ŒSeq æ ¹æœ¬å°±æ²¡æœ‰ä¸€ä¸ªåˆé€‚çš„æ„é€ å‡½æ•°ã€‚ä¸‹ä¸€æ¬¡ï¼Œä½œä¸ºä¸€äº›ç–¯ç‹‚çš„äº‹æƒ…ï¼Œæˆ‘å°è¯•è°ƒç”¨ METAOP_REVERSE ç»“æœåªæ˜¯ä¸ºäº†å´©æºƒã€‚\nsub METAOP_REVERSE(\\op) is implementation-detail { -\u0026gt; |args { die } } ç¼–è¯‘ã€è¿è¡Œã€‚\n\u0026gt; make [...] \u0026gt; ./rakudo-m ~/test.raku \\(-1) \\(:foo((1,).Seq)) æ€ä¹ˆä¼šå‘¢ï¼Ÿè¯­æ³•æ ‘ä¸­åŒ…å«äº†å¯¹ METAOP_REVERSE çš„è°ƒç”¨ï¼Œå®ƒçš„ä»£ç åº”è¯¥æ˜¯æŠ˜å çš„ï¼Œä½†è®¡ç®—ä»ç„¶è¿›è¡Œï¼Œæˆ‘ä»¬å¾—åˆ° -1ã€‚\nè¿™äº›éƒ½ä¸æ˜¯ã€Šè¡ŒåŠ¨ã€‹ã€‚\nè¿™é‡Œæˆ‘çš„ç›®å…‰è½åœ¨ç¼–è¯‘å™¨çš„æ„å»ºæ—¥å¿—ä¸Šã€‚å®ƒæ˜¯ä¸€äº›é˜¶æ®µè¢«åˆ—åœ¨é‚£é‡Œã€‚æˆ‘éšæœºè¯•äº† --target=mastã€‚\n\u0026gt; ./rakudo-m --target=mast ~/test.raku [...] MAST::Frame name\u0026lt;s\u0026gt;, cuuid\u0026lt;1\u0026gt; Local types: 0\u0026lt;obj\u0026gt;, 1\u0026lt;obj\u0026gt;, 2\u0026lt;obj\u0026gt;, 3\u0026lt;obj\u0026gt;, 4\u0026lt;int\u0026gt;, 5\u0026lt;str\u0026gt;, 6\u0026lt;obj\u0026gt;, 7\u0026lt;obj\u0026gt;, 8\u0026lt;obj\u0026gt;, Lexical types: 0\u0026lt;obj\u0026gt;, 1\u0026lt;obj\u0026gt;, 2\u0026lt;obj\u0026gt;, 3\u0026lt;obj\u0026gt;, 4\u0026lt;obj\u0026gt;, Lexical names: 0\u0026lt;c\u0026gt;, 1\u0026lt;$Â¢\u0026gt;, 2\u0026lt;$!\u0026gt;, 3\u0026lt;$/\u0026gt;, 4\u0026lt;$*DISPATCHER\u0026gt;, Lexical map: $!\u0026lt;2\u0026gt;, c\u0026lt;0\u0026gt;, $*DISPATCHER\u0026lt;4\u0026gt;, $Â¢\u0026lt;1\u0026gt;, $/\u0026lt;3\u0026gt;, Outer: name\u0026lt;\u0026lt;unit\u0026gt;\u0026gt;, cuuid\u0026lt;2\u0026gt; [...] æŸç§ä¸å¯è¯»çš„çŸ©é˜µã€‚æ˜Ÿå·å’Œæ¡…æ†ä¹‹é—´æœ‰ä¸€ä¸ªé˜¶æ®µæ€§çš„ä¼˜åŒ–ã€‚\n\u0026gt; ./rakudo-m --target=optimize ~/test.raku [...] - QAST::Op(callstatic \u0026amp;s) \u0026lt;sunk\u0026gt; :statement_id\u0026lt;4\u0026gt; s(:foo(3 R- 2)) - QAST::Op(call \u0026amp;infix:\u0026lt;-\u0026gt;) :METAOP_opt_result\u0026lt;?\u0026gt; - QAST::Want \u0026lt;wanted\u0026gt; 2 - QAST::WVal(Int) - Ii - QAST::IVal(2) 2 - QAST::Want \u0026lt;wanted\u0026gt; 3 - QAST::WVal(Int) - Ii - QAST::IVal(3) 3 [...] - QAST::Op(callstatic \u0026amp;s) \u0026lt;sunk\u0026gt; :statement_id\u0026lt;7\u0026gt; s(:foo(3 Z- 2)) - QAST::Op+{QAST::SpecialArg}(call :named\u0026lt;foo\u0026gt;) \u0026lt;wanted\u0026gt; :statement_id\u0026lt;8\u0026gt; :before_promotion\u0026lt;?\u0026gt; Z- - QAST::Op(callstatic \u0026amp;METAOP_ZIP) \u0026lt;wanted\u0026gt; :is_pure\u0026lt;?\u0026gt; - QAST::Var(lexical \u0026amp;infix:\u0026lt;-\u0026gt;) \u0026lt;wanted\u0026gt; - QAST::Var(lexical \u0026amp;METAOP_REDUCE_LEFT) - QAST::Want \u0026lt;wanted\u0026gt; 3 - QAST::WVal(Int) - Ii - QAST::IVal(3) 3 - QAST::Want \u0026lt;wanted\u0026gt; 2 - QAST::WVal(Int) - Ii - QAST::IVal(2) 2 [...] å“ˆï¼Œå°±æ˜¯è¿™æ ·ã€‚åœ¨ä¼˜åŒ–é˜¶æ®µåï¼Œè¡Œå°†å¤±è¸ªã€‚\n QAST::Op+{QAST::SpecialArg}(call :named\u0026lt;foo\u0026gt;) \u0026lt;wanted\u0026gt; :statement_id\u0026lt;5\u0026gt; :before_promotion\u0026lt;?\u0026gt; R-. å¹¶å°†æ•´ä¸ª METAOP_REVERSE è°ƒç”¨æ›¿æ¢ä¸ºé€šå¸¸çš„æ“ä½œ (\u0026amp;infix:\u0026lt;-\u0026gt;)ã€‚æ‰€ä»¥é—®é¢˜ä¸€å®šåœ¨ä¼˜åŒ–å™¨çš„æŸä¸ªåœ°æ–¹ã€‚  åªæœ‰åœ¨ optim_nameless_call æ–¹æ³•ä¸­æ‰ä¼šæåˆ° \u0026amp;METAOP_ASSIGNï¼Œå…¶ä¸­ QAST::Op+{QAST::SpecialArg}(call :named\u0026lt;foo\u0026gt;)ã€‚æ˜¾ç„¶ï¼Œè¿™ä¸ªæ“ä½œè´Ÿè´£ç”Ÿæˆä¸€ä¸ªå‘½åå¯¹ - å®ƒå·²ç»æœ‰äº†ä¸€ä¸ªåå­—ï¼ˆå‘½åå‚æ•°ï¼‰ï¼Œå®ƒéœ€è¦è®¡ç®—å€¼ã€‚ä»ä¼˜åŒ– _ æ— åæ–¹æ³•çš„æ‰§è¡Œè·¯å¾„æ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼Œæˆ‘ä»¬å¯¹æœ€åä¸€ä¸ªå—æ„Ÿå…´è¶£ã€‚\n[...] elsif self.op_eq_core($metaop, '\u0026amp;METAOP_REVERSE') { return NQPMu unless nqp::istype($metaop[0], QAST::Var) \u0026amp;\u0026amp; nqp::elems($op) == 3; return QAST::Op.new(:op\u0026lt;call\u0026gt;, :name($metaop[0].name), $op[2], $op[1]).annotate_self: 'METAOP_opt_result', 1; } [...] è®©æˆ‘æé†’ä½ ï¼Œä¼˜åŒ–å‰çš„æ ‘æ˜¯è¿™æ ·çš„ã€‚\n[...] - QAST::Op(call \u0026amp;s) \u0026lt;sunk\u0026gt; :statement_id\u0026lt;4\u0026gt; s(:foo(3 R- 2)) - QAST::Op+{QAST::SpecialArg}(call :named\u0026lt;foo\u0026gt;) \u0026lt;wanted\u0026gt; :statement_id\u0026lt;5\u0026gt; :before_promotion\u0026lt;?\u0026gt; R- - QAST::Op(call \u0026amp;METAOP_REVERSE) \u0026lt;wanted\u0026gt; :is_pure\u0026lt;?\u0026gt; - QAST::Var(lexical \u0026amp;infix:\u0026lt;-\u0026gt;) \u0026lt;wanted\u0026gt; - QAST::Want \u0026lt;wanted\u0026gt; 3 - QAST::Want \u0026lt;wanted\u0026gt; 2 [...] è€Œç²¾ç®€ä¹‹åï¼Œæ˜¯è¿™æ ·çš„ã€‚\n[...] - QAST::Op(callstatic \u0026amp;s) \u0026lt;sunk\u0026gt; :statement_id\u0026lt;4\u0026gt; s(:foo(3 R- 2)) - QAST::Op(call \u0026amp;infix:\u0026lt;-\u0026gt;) :METAOP_opt_result\u0026lt;?\u0026gt; - QAST::Want \u0026lt;wanted\u0026gt; 2 - QAST::Want \u0026lt;wanted\u0026gt; 3 [...] ä¹Ÿå°±æ˜¯è¯´ï¼Œä¼˜åŒ– _nameless_call åšäº†ä»¥ä¸‹å·¥ä½œã€‚\nå¦‚æœæˆ‘ä»¬çš„ QAST::Op+{QAST::SpecialArg} æ“ä½œæ²¡æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œå¦‚æœ METAOP_REVERSE è°ƒç”¨æ²¡æœ‰ä¸€ä¸ªæ­£ç¡®çš„ç±»å‹ï¼Œæˆ‘ä»¬å°±è¿”å›ç©ºã€‚è¿™ä¸æ˜¯æˆ‘ä»¬çš„æƒ…å†µã€‚ å¦åˆ™ï¼Œæˆ‘ä»¬å°†è¿”å›ä¸€ä¸ªæ–°çš„æ“ä½œï¼Œä»£æ›¿æˆ‘ä»¬çš„ QAST::Op+{QAST::SpecialArg} æ“ä½œï¼Œä»¥ç›¸åçš„é¡ºåºè°ƒç”¨ \u0026amp;infix:\u0026lt;-\u0026gt; å‚æ•°ã€‚å°±æ˜¯è¯´ï¼ŒæŠŠç»“æœæ‰“åŒ…æˆä¸€å¯¹å°±æ²¡äº†ã€‚\nåœ¨æ‘¸ç´¢äº†ä¸€ä¸‹å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¹¶é˜…è¯»äº† QAST::SpecialArg å’Œ QAST::Node çš„å®ç°åï¼Œæˆ‘æƒ³åˆ°äº†ä¸‹é¢çš„ä»£ç ã€‚\n[...] elsif self.op_eq_core($metaop, '\u0026amp;METAOP_REVERSE') { return NQPMu unless nqp::istype($metaop[0], QAST::Var) \u0026amp;\u0026amp; nqp::elems($op) == 3; my $opt_result := QAST::Op.new(:op\u0026lt;call\u0026gt;, :name($metaop[0].name), $op[2], $op[1]).annotate_self: 'METAOP_opt_result', 1; if $op.named { $opt_result.named($op.named) } # æ·»åŠ é€‰é¡¹ named if $op.flat { $opt_result.flat($op.flat) } # æ·»åŠ é€‰é¡¹ flat return $opt_result; } [...] è¿˜æœ‰æœ¨å¤´ã€‚\n[...] - QAST::Op(callstatic \u0026amp;s) \u0026lt;sunk\u0026gt; :statement_id\u0026lt;4\u0026gt; s(:foo(3 R- 2)) - QAST::Op+{QAST::SpecialArg}(call \u0026amp;infix:\u0026lt;-\u0026gt; :named\u0026lt;foo\u0026gt;) :METAOP_opt_result\u0026lt;?\u0026gt; - QAST::Want \u0026lt;wanted\u0026gt; 2 - QAST::Want \u0026lt;wanted\u0026gt; 3 [...] å‘½åçš„å‚æ•°è¿”å›åˆ°å®ƒçš„ä½ç½®ã€‚æµ‹è¯•ä¹Ÿå¼€å§‹é€šè¿‡ã€‚\n\u0026gt; make t/spec/S03-metaops/reverse.t [...] All tests successful. Files=1, Tests=70, 3 wallclock secs ( 0.03 usr 0.01 sys + 3.61 cusr 0.17 csys = 3.82 CPU) Result: PASS æˆ‘ä»¬æœ¬å¯ä»¥å°±æ­¤æ‰“ä½ï¼Œä½†è¿™æ˜¯ç¼–è¯‘å™¨ä¼˜åŒ–å™¨çš„ä»£ç ï¼Œå®ƒçš„ç»“æœæ˜¯ä¸€ä¸ªæœ‰ä¸¤ä¸ªæ•´æ•°å‚æ•°çš„æ–¹æ³•è°ƒç”¨ã€‚æˆ‘è®¤ä¸ºè¿™åœ¨æŸç§ç¨‹åº¦ä¸Šæ˜¯æ¬¡ä¼˜çš„ã€‚å¦‚æœæˆ‘ä»¬å°†è¿”å›è¡¨è¾¾å¼æ”¹ä¸ºè¿”å› self.visit_op: $opt_result;ï¼Œå¯¹äº§ç”Ÿçš„éä¼˜åŒ–æ“ä½œè°ƒç”¨ä¼˜åŒ–å™¨ï¼Œé‚£ä¹ˆäº§ç”Ÿçš„æ ‘å°±ä¼šåƒè¿™æ ·ã€‚\n[...] - QAST::Op(callstatic \u0026amp;s) \u0026lt;sunk\u0026gt; :statement_id\u0026lt;4\u0026gt; s(:foo(3 R- 2)) - QAST::Want+{QAST::SpecialArg}(:named\u0026lt;foo\u0026gt;) - QAST::WVal+{QAST::SpecialArg}(Int :named\u0026lt;foo\u0026gt;) - QAST::IVal(-1) [...] ç°åœ¨ä¸€åˆ‡éƒ½å¾ˆç†æƒ³ã€‚\nåˆ†äº«æˆæœ æˆ‘ä»¬å·²ç»åˆ°äº†ç»ˆç‚¹çº¿ã€‚ç°åœ¨æˆ‘ä»¬åªéœ€è¦åˆ†äº«æˆ‘ä»¬çš„ç»éªŒã€‚\n é‡è¦çš„æ˜¯ï¼šè¿è¡Œæ‰€æœ‰çš„ make spectest æµ‹è¯•ï¼Œç¡®ä¿æ²¡æœ‰æ–°çš„ä¸œè¥¿è¢«ç ´åã€‚ åœ¨ GitHub ä¸Šä½¿ç”¨ Rakudo ç¼–è¯‘å™¨å’Œæµ‹è¯•åˆ¶ä½œ fork ä»“åº“ã€‚ å°† fork ä»“åº“æ·»åŠ ä¸ºæ–°çš„ git è¿œç¨‹ä»“åº“ã€‚ cd ~/dev-rakudo/rakudo \u0026amp;\u0026amp; git remote add fork ã€‚ cd ~/dev-rakudo/t/spec \u0026amp;\u0026amp; git remote add fork ã€‚  é‡è¦ï¼šç¡®ä¿ä¸¤ä¸ªä»“åº“åœ¨ git ä¸­éƒ½æœ‰æ­£ç¡®çš„ç”¨æˆ·åå’Œç”¨æˆ·é‚®ç®±ã€‚\næäº¤åˆ°ä¸¤ä¸ªç‰ˆæœ¬åº“ï¼Œè¯¦ç»†è¯´æ˜ä½ ä¸ºä»€ä¹ˆåšäº†å“ªäº›æ”¹åŠ¨ï¼Œå¹¶æ·»åŠ å¯¹åŸå§‹é—®é¢˜è·Ÿè¸ªå™¨çš„å¼•ç”¨ã€‚\nè¿è¡Œæäº¤ã€‚\ncd ~/dev-rakudo/rakudo \u0026amp;\u0026amp; git push fork cd ~/dev-rakudo/t/spec \u0026amp;\u0026amp; git push fork å‘ä¸¤ä¸ªä»“åº“æå‡ºæ‹‰å–è¯·æ±‚ã€‚åœ¨ä»–ä»¬çš„æè¿°ä¸­ï¼Œæœ€å¥½æ˜¯ç›¸äº’å‚ç…§å’ŒåŸä»»åŠ¡ã€‚\nç»“è®º å¯¹å¼€æºè½¯ä»¶çš„è´¡çŒ®æ˜¯ï¼š\n è¶£å‘³æ€§å’Œè¶£å‘³æ€§ã€‚ ç»™ä½ çš„æ„Ÿè§‰æ˜¯ï¼Œä½ æ­£åœ¨åšä¸€äº›æœ‰ç”¨çš„äº‹æƒ…ï¼Œä½ çœŸçš„æ˜¯ã€‚ è®©ä½ è®¤è¯†æ–°çš„æœ‰è¶£å’Œä¸“ä¸šçš„äººï¼ˆä»»ä½•å…³äº Raku çš„é—®é¢˜éƒ½ä¼šåœ¨ #raku IRC é¢‘é“ä¸­å¾—åˆ°å›ç­”ï¼‰ã€‚ è§£å†³éæ ‡å‡†ä»»åŠ¡ï¼Œæ²¡æœ‰æˆªæ­¢æ—¥æœŸçš„å‹åŠ›ï¼Œæ˜¯ä¸€ç§å¾ˆå¥½çš„ä½“éªŒã€‚  é€‰æ‹©ä½ è§‰å¾—æœ€èˆ’æœçš„è§’è‰²ç­‰çº§ï¼Œå»åšæ–°çš„ä»»åŠ¡å§!\n","permalink":"https://ohmyweekly.github.io/notes/2021-02-16-contributing-to-raku/","tags":["Raku","Rakulang"],"title":"ä¸ºæœ€å¹´è½»çš„ Raku è´¡çŒ®åŠ›é‡"},{"categories":["Raku"],"contents":"[113] å‘è¡¨äº2021å¹´1æœˆ30æ—¥ã€‚ è¿™æ˜¯æˆ‘å¯¹ Perl æ¯å‘¨æŒ‘æˆ˜#097 çš„å›åº”ã€‚\næŒ‘æˆ˜ #097.1: å‡¯æ’’å¯†ç  ç»™ä½ ä¸€ä¸ªåªåŒ…å«å­—æ¯ A..Z çš„å­—ç¬¦ä¸² $S å’Œä¸€ä¸ªæ•°å­— $Nã€‚ å†™ä¸€ä¸ªè„šæœ¬ï¼Œç”¨å‡¯æ’’å¯†ç å¯¹ç»™å®šçš„å­—ç¬¦ä¸² $S è¿›è¡ŒåŠ å¯†ï¼Œå·¦ç§»å¤§å°ä¸º $Nã€‚\nä¾‹å­: è¾“å…¥: $S = \u0026ldquo;THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG\u0026rdquo;, $N = 3 è¾“å‡º: \u0026ldquo;QEB NRFZH YOLTK CLU GRJMP LSBO QEB IXWV ALD\u0026rdquo;\nPlain: ABCDEFGHIJKLMNOPQRSTUVWXYZ Cipher: XYZABCDEFGHIJKLMNOPQRSTUVW\nPlaintext: THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG Ciphertext: QEB NRFZH YOLTK CLU GRJMP LSBO QEB IXWV ALD\n\u0026ldquo;åªç”¨å­—æ¯ A...Z\u0026rdquo; çš„è¡¨è¿°æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºä¾‹å­ä¸­ä¹Ÿæœ‰å‡ ä¸ªç©ºæ ¼ã€‚å› æ­¤ï¼Œåº”è¯¥å…è®¸è¿™äº›ç©ºæ ¼ã€‚\næ–‡ä»¶: caesar-cipher\n#! /usr/bin/env raku subset AZ-space of Str where /^ \u0026lt;[ A .. Z \\s ]\u0026gt;+ $/; # [1] subset PosInt of Int where -25 \u0026lt;= $_ \u0026lt;= 25; # [2] unit sub MAIN (AZ-space $S = \u0026#39;THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG\u0026#39;, PosInt $N = 3); # [3] say $S.comb.map({ caesar($_, $N) }).join; # [4] sub caesar ($char, $shift) { return $char if $char eq \u0026#34;\u0026#34;; # [5] my $code = $char.ord; # [6] $code -= $shift; # [7] $code += 26 if $code \u0026lt; 65; # \u0026#39;A\u0026#39; # [8] $code -= 26 if $code \u0026gt; 90; # \u0026#39;Z\u0026#39; # [8a] return $code.chr; # [9] } [1] æ‰€å…è®¸çš„å­—ç¬¦ (æˆ– Â«ç‰¹å®šé¢†åŸŸå­—æ¯Â»).\n[2] æŒ‘æˆ˜è¯´å·¦ç§»å€¼æ˜¯ä¸€ä¸ªæ•°å­—ã€‚å…è®¸é™¤æ•´æ•°ä»¥å¤–çš„ä»»ä½•ä¸œè¥¿æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œæ‰€ä»¥æˆ‘æŠŠå€¼é™åˆ¶åœ¨è¿™ä¸ªç±»å‹ã€‚è´Ÿå€¼åº”è¯¥æ˜¯å¯ä»¥çš„ï¼Œå®ƒä»¬æ„å‘³ç€å³ç§»å€¼ï¼ˆè€Œä¸æ˜¯å·¦ç§»ï¼‰ã€‚\n[3] å‚æ•°ï¼Œé»˜è®¤å€¼ä¸ºæŒ‘æˆ˜ä¸­ç»™å‡ºçš„å€¼ã€‚\n[4] å°†å­—ç¬¦ä¸²åˆ†å‰²æˆå•ä¸ªå­—ç¬¦ï¼ˆç”¨æ¢³å­(comb)ï¼Œåœ¨æ¯ä¸ªå­—ç¬¦ä¸Šåº”ç”¨ \u0026ldquo;caesar\u0026rdquo; å‡½æ•°ï¼ˆç”¨mapï¼‰ï¼Œå†æ¬¡å°†å­—ç¬¦è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆç”¨joinï¼‰ï¼Œç„¶åæ‰“å°å‡ºæ¥ã€‚\n[5] ä¸ç§»åŠ¨ç©ºæ ¼ã€‚\n[6] è·å–å­—ç¬¦çš„ä»£ç ç‚¹ã€‚\n[7] å‡å»ç§»ä½å€¼ï¼ˆå½“æˆ‘ä»¬å‘å·¦ç§»ä½æ—¶ï¼Œæˆ–åœ¨å­—æ¯è¡¨ä¸­é™ä½ç§»ä½å€¼ï¼‰ã€‚\n[8] ç»•å›, å¦‚æœæˆ‘ä»¬ç§»å‡ºA-ZèŒƒå›´ï¼Œè¿™é‡Œä¸ºæ›´ä½ - æˆ–æ›´é«˜çš„ [8b]ã€‚\n[9] è·å–æŒ‡å®šä»£ç ç‚¹çš„å­—ç¬¦ã€‚\næŸ¥çœ‹ docs.raku.org/routine/ord è·å–æ›´å¤šå…³äº ord çš„ä¿¡æ¯ã€‚\næŸ¥çœ‹ docs.raku.org/routine/chr è·å–æ›´å¤šå…³äº chr çš„ä¿¡æ¯ã€‚\nè¿è¡Œå®ƒ:\n$ ./caesar-cipher 'THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG' 3 QEB NRFZH YOLTK CLU GRJMP LSBO QEB IXWV ALD $ ./caesar-cipher 'THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG' -3 WKH TXLFN EURZQ IRA MXPSV RYHU WKH ODCB GRJ $ ./caesar-cipher 'THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG' 13 GUR DHVPX OEBJA SBK WHZCF BIRE GUR YNML QBT $ ./caesar-cipher 'THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG' -13 GUR DHVPX OEBJA SBK WHZCF BIRE GUR YNML QBT Raku æœ‰ä¸€ä¸ª ords å˜ä½“ï¼Œå®ƒæ¥æ”¶ä¸€æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä½œä¸º ordã€‚è¿˜æœ‰ chrsï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªä»£ç ç‚¹æ•°ç»„ï¼Œå¹¶å°†å®ƒä»¬å˜æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯åƒ chr é‚£æ ·æ¥æ”¶ä¸€ä¸ªå­—ç¬¦çš„ä»£ç ç‚¹ã€‚è®©æˆ‘ä»¬ç”¨å®ƒä»¬æ¥å†™ä¸€ä¸ªæ›´çŸ­çš„ç¨‹åºã€‚\næ–‡ä»¶: caesar-cipher-map\n#! /usr/bin/env raku subset AZ-space of Str where /^ \u0026lt;[ A .. Z \\s ]\u0026gt;+ $/; subset PosInt of Int where -25 \u0026lt;= $_ \u0026lt;= 25; unit sub MAIN (AZ-space $S = \u0026#39;THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG\u0026#39;, PosInt $N = 3); say caesar($S, $N); sub caesar ($string, $shift) { return $string.ords.map({$_ == 32 ?? 32 !! (($_ - $shift - 65) % 26 ) + 65}).chrs; # #################### # 1a ############# ############ # 1b # 1c ## 1d } [1] æˆ‘ä»¬ä½¿ç”¨mapæ¥æ”¹å˜å„ä¸ªä»£ç ç‚¹ã€‚æˆ‘ä»¬è®©ä»£ç ç‚¹ä¸º32çš„ç©ºé—´å•ç‹¬å­˜åœ¨[1a]ã€‚æ¯ä¸€ä¸ªå…¶ä»–çš„å€¼æˆ‘ä»¬éƒ½è¿˜åŸæˆ0åˆ°25ä¹‹é—´çš„æ•°å­—ï¼ˆé€šè¿‡å‡å»ç¬¬ä¸€ä¸ªå­—æ¯çš„ä»£ç ç‚¹ï¼ˆAï¼š65ï¼‰å’Œç§»ä½å€¼[1b]ï¼‰ã€‚æ¨¡æ•°è¿ç®—ç¬¦ (%) ä¸ºæˆ‘ä»¬å¤„ç†è´Ÿå€¼ï¼Œåšæ­£ç¡®çš„äº‹æƒ…ã€‚ä¾‹å¦‚ï¼š-2 % 26 -\u0026gt; 24 [1c]ã€‚ç„¶åæˆ‘ä»¬æ·»åŠ è°ƒæ•´å€¼åˆ°å®ƒä»¬åº”è¯¥åœ¨çš„ä½ç½®(ä»Aåˆ°Z)[1d]ï¼Œç„¶åæˆ‘ä»¬å°†æ•´ä¸ªæ•°ç»„çš„ä»£ç ç‚¹å˜æˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚\næŸ¥çœ‹ docs.raku.org/routine/ords è·å–æ›´å¤šå…³äº ords çš„ä¿¡æ¯ã€‚\næŸ¥çœ‹ docs.raku.org/routine/chrs è·å–æ›´å¤šå…³äº chrs çš„ä¿¡æ¯ã€‚\nè¿è¡Œå®ƒçš„ç»“æœå’Œä¹‹å‰ä¸€æ ·ã€‚\n$ ./caesar-cipher-map 'THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG' 3 QEB NRFZH YOLTK CLU GRJMP LSBO QEB IXWV ALD $ ./caesar-cipher-map 'THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG' -3 WKH TXLFN EURZQ IRA MXPSV RYHU WKH ODCB GRJ $ ./caesar-cipher-map 'THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG' 13 GUR DHVPX OEBJA SBK WHZCF BIRE GUR YNML QBT $ ./caesar-cipher-map 'THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG' -13 GUR DHVPX OEBJA SBK WHZCF BIRE GUR YNML QBT Perl ç‰ˆæœ¬ è¿™æ˜¯å¯¹ç¬¬ä¸€ä¸ª Raku ç‰ˆçš„ç›´æ¥ç¿»è¯‘ã€‚\nFile: caesar-cipher-perl\n#! /usr/bin/env perl use strict; use warnings; use feature \u0026#39;say\u0026#39;; use feature \u0026#39;signatures\u0026#39;; no warnings \u0026#34;experimental::signatures\u0026#34;; my $S = shift(@ARGV) // \u0026#39;THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG\u0026#39;; die \u0026#34;Illegal characters\u0026#34; unless $S =~/^[A-Z\\s]+$/; my $N = shift(@ARGV) // 3; die \u0026#34;Illegal shift $N\u0026#34; if $N !~ /^\\-?\\d+$/ || $N \u0026lt; -25 || $N \u0026gt; 25; say join(\u0026#34;\u0026#34;, map { caesar($_, $N) } split(//, $S)); sub caesar ($char, $shift) { return $char if $char eq \u0026#34; \u0026#34;; my $code = ord($char); $code -= $shift; $code += 26 if $code \u0026lt; 65; # \u0026#39;A\u0026#39; $code -= 26 if $code \u0026gt; 90; # \u0026#39;Z\u0026#39; return chr($code); } è¿è¡Œå®ƒçš„ç»“æœå’Œ Raku ç‰ˆä¸€æ ·ã€‚\n$ ./caesar-cipher-perl 'THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG' 3 QEB NRFZH YOLTK CLU GRJMP LSBO QEB IXWV ALD $ ./caesar-cipher-perl 'THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG' -3 WKH TXLFN EURZQ IRA MXPSV RYHU WKH ODCB GRJ $ ./caesar-cipher-perl 'THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG' 13 GUR DHVPX OEBJA SBK WHZCF BIRE GUR YNML QBT $ ./caesar-cipher-perl 'THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG' -13 GUR DHVPX OEBJA SBK WHZCF BIRE GUR YNML QBT æŒ‘æˆ˜ #097.2ï¼šäºŒè¿›åˆ¶å­å­—ç¬¦ä¸²(Binary Substrings) ç»™ä½ ä¸€ä¸ªäºŒè¿›åˆ¶å­—ç¬¦ä¸² $B å’Œä¸€ä¸ªæ•´æ•° $Sã€‚\nå†™ä¸€ä¸ªè„šæœ¬æ¥æ‹†åˆ†å¤§å°ä¸º $S çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸² $Bï¼Œç„¶åæ‰¾å‡ºä½¿å…¶ç›¸åŒçš„æœ€å°ç¿»è½¬æ¬¡æ•°ã€‚\nä¾‹ 1: è¾“å…¥: $B = â€œ101100101â€, $S = 3 è¾“å‡º: 1\näºŒè¿›åˆ¶å­å­—ç¬¦ä¸²: \u0026ldquo;101\u0026rdquo;: 0 flip \u0026ldquo;100\u0026rdquo;: 1 flip to make it \u0026ldquo;101\u0026rdquo; \u0026ldquo;101\u0026rdquo;: 0 flip\nä¾‹ 2: è¾“å…¥ $B = â€œ10110111â€, $S = 4 è¾“å‡º: 2\näºŒè¿›åˆ¶å­å­—ç¬¦ä¸²: \u0026ldquo;1011\u0026rdquo;: 0 flip \u0026ldquo;0111\u0026rdquo;: 2 flips to make it \u0026ldquo;1011\u0026rdquo;\næˆ‘ä»¬å…ˆä»ç¬¬ä¸€ä¸ªä¾‹å­ä¸­çš„äºŒè¿›åˆ¶å­å­—ç¬¦ä¸²ä¸­ç æ‰3ä¸ªå­—ç¬¦å—ã€‚\n\u0026gt; say \u0026quot;101100101\u0026quot;.comb(3); # -\u0026gt; (101 100 101) \u0026gt; say \u0026quot;1011001010\u0026quot;.comb(3); # -\u0026gt; (101 100 101 0) ç¬¬äºŒè¡Œæ˜¾ç¤ºäº†å¦‚æœé•¿åº¦ä¸åŒ¹é…ä¼šå‘ç”Ÿä»€ä¹ˆã€‚è¿™å°±ç»™äº†æˆ‘ä»¬ä¸€ä¸ªéæ³•çš„å€¼ï¼Œå› ä¸ºæˆ‘ä»¬ä¸èƒ½å°†ä¸€ä½æ•°ç¿»è½¬ä¸ºä¸‰ä½æ•°çš„å€¼ã€‚æ‰€ä»¥æˆ‘ä»¬å¿…é¡»æ·»åŠ ä¸€ä¸ªæ£€æŸ¥ã€‚\nç„¶åæˆ‘ä»¬å°†ç¬¬ä¸€ä¸ªå­ä¸²ä¸å…¶ä½™çš„å­ä¸²è¿›è¡Œæ¯”è¾ƒï¼Œä¸€æ¬¡ä¸€ä¸ªã€‚åœ¨è¿™é‡Œä½¿ç”¨bitwise XORï¼ˆExclusive ORï¼‰è¿ç®—ç¬¦æ˜¯ä¸€ä¸ªåˆç†çš„é€‰æ‹©ã€‚è¿™ç»™äº†æˆ‘ä»¬ä¸€ä¸ªäºŒè¿›åˆ¶å€¼ï¼Œå…¶ä¸­1çš„æ•°é‡å°±æ˜¯è¯¥å­ä¸²çš„ç¿»è½¬æ¬¡æ•°ã€‚Rakuç¡®å®æœ‰ä¸€ä¸ªXORè¿ç®—ç¬¦ã€‚+^. ä½†æ˜¯å®ƒ \u0026ldquo;å°†ä¸¤ä¸ªå‚æ•°éƒ½å¼ºåˆ¶ä¸ºIntï¼Œå¹¶è¿›è¡Œä½æ™ºXORæ“ä½œ\u0026rdquo;(æ ¹æ®æ–‡æ¡£\u0026quot;ï¼›å‚è§docs.raku.org/language/operators#infix_+^)ã€‚\næˆ‘ä»¬å¯ä»¥åœ¨è¿›è¡ŒXORæ“ä½œä¹‹å‰ï¼Œå°†äºŒè¿›åˆ¶å€¼è½¬æ¢ä¸ºåè¿›åˆ¶å€¼ã€‚è®©æˆ‘ä»¬è¯•è¯•ã€‚\nè·å–ç¿»è½¬çš„æ¬¡æ•°ã€‚\n\u0026gt; say (\u0026quot;10101\u0026quot;.parse-base(2) +^ \u0026quot;10111\u0026quot;.parse-base(2)).base(2).comb.sum; # -\u0026gt; 1 \u0026gt; say (\u0026quot;11101\u0026quot;.parse-base(2) +^ \u0026quot;10111\u0026quot;.parse-base(2)).base(2).comb.sum; # -\u0026gt; 2 è¿™å½“ç„¶å¯è¡Œï¼Œä½†éœ€è¦å¤§é‡çš„ä»£ç ã€‚æ‰€ä»¥æˆ‘å°†ä½¿ç”¨ä¸€ä¸ªæ›´ç®€å•çš„æ–¹æ³• - é€ä¸ªæ¯”è¾ƒæ¯ä¸ªæ•°å­—ã€‚\nFile: binary-substring\n#! /usr/bin/env raku subset BinaryString where /^ \u0026lt;[01]\u0026gt;+ $/; # [1] subset PosInt of Int where * \u0026gt; 0; # [2] unit sub MAIN (BinaryString $B = \u0026#39;101100101\u0026#39;, # [1] PosInt $S where $B.chars %% $S = 3, # [2] :v(:$verbose)); my @B = $B.comb($S.Int); # [3] my $first = @B.shift; # [4] my $total = 0; # [5] for @B -\u0026gt; $current # [6] { my $flip = bit-diff($first, $current); # [7] $total += $flip; # [8] say \u0026#34;: $first-\u0026gt; $current-\u0026gt; Flip: $flip\u0026#34; if $verbose; } say $total; # [9] sub bit-diff ($a, $b) # [7] { my $flip = 0; # [10] for ^$a.chars -\u0026gt; $index # [11] { $flip++ if $a.substr($index,1) ne $b.substr($index,1); # [12] } return $flip; } [1] ç¡®ä¿äºŒè¿›åˆ¶å­—ç¬¦ä¸²æ˜¯åˆæ³•çš„ï¼ˆåªåŒ…å« \u0026ldquo;0 \u0026ldquo;å’Œ \u0026ldquo;1\u0026rdquo;ï¼‰ã€‚\n[2] ç¡®ä¿æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ï¼ŒåŒæ—¶ç¡®ä¿å­—ç¬¦ä¸²æ˜¯è¢«å®ƒå¶æ•°åˆ†å‰²çš„ã€‚(ä¾‹å¦‚ï¼Œ\u0026ldquo;4 \u0026ldquo;ç»™æˆ‘ä»¬æä¾›äº†é•¿åº¦ä¸º4çš„å­ä¸²ï¼Œå¦‚æœæœ€åä¸€ä¸ªè¾ƒçŸ­ï¼Œç¨‹åºå°†ä¸­æ­¢ã€‚)\n[3] æ¢³å­é€šå¸¸ç”¨äºå°†ä¸€ä¸ªå­—ç¬¦ä¸²åˆ†å‰²æˆå•ä¸ªå­—ç¬¦ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡æŒ‡å®šé•¿åº¦æ¥è·å¾—æ¯ä¸ªå­å­—ç¬¦ä¸²ä¸­çš„å¤šä¸ªå­—ç¬¦ï¼Œæ¯”å¦‚è¿™æ ·ã€‚\n[4] ä¾‹å­é¦–å…ˆå°†ç¬¬ä¸€ä¸ªå­ä¸²ä¸è‡ªå·±è¿›è¡Œæ¯”è¾ƒï¼Œç»™å‡ºé›¶ç¿»è½¬ã€‚è¿™æ˜¯æ„šè ¢çš„(ish)ï¼Œæ‰€ä»¥æˆ‘è·³è¿‡è¿™ä¸€ç‚¹ï¼ŒæŠŠç¬¬ä¸€ä¸ªå­ä¸²ç§»å‡ºã€‚\n[5] ç»“æœä¼šåˆ°è¿™é‡Œã€‚\n[6] å¯¹äºæ¯ä¸€ä¸ªå­ä¸²ï¼ˆé™¤äº†ç¬¬ä¸€ä¸ªï¼Œè§[4]ï¼‰ã€‚\n[7] è·å–æ¯ä¸ªå­ä¸²çš„ç¿»è½¬æ¬¡æ•°ã€‚\n[8] å¹¶å°†å…¶æ·»åŠ åˆ°æ€»æ•°ä¸­ã€‚\n[9] æ‰“å°å®ƒã€‚\n[10] ç¿»è½¬çš„æ•°é‡ä¼šåœ¨è¿™é‡Œã€‚\n[11] å¯¹äºä¸¤ä¸ªå­ä¸²ä¸­çš„æ¯ä¸ªç´¢å¼•ï¼ˆå…·æœ‰ç›¸åŒçš„é•¿åº¦ï¼‰ã€‚\n[12] - å¦‚æœç»™å®šä½ç½®ä¸Šçš„å­—ç¬¦ä¸åŒï¼Œåˆ™åœ¨æ€»æ•°çš„åŸºç¡€ä¸ŠåŠ 1ï¼Œæ„å‘³ç€ç§»åŠ¨ã€‚\nSee docs.raku.org/routine/comb for more information about comb.\nè¿è¡Œå®ƒã€‚\n$ ./binary-substring \u0026quot;101100101\u0026quot; 3 1 $ ./binary-substring -v \u0026quot;101100101\u0026quot; 3 : 101 -\u0026gt; 100 -\u0026gt; Flip: 1 : 101 -\u0026gt; 101 -\u0026gt; Flip: 0 1 $ ./binary-substring \u0026quot;10110111\u0026quot; 4 2 $ ./binary-substring -v \u0026quot;10110111\u0026quot; 4 : 1011 -\u0026gt; 0111 -\u0026gt; Flip: 2 2 çœ‹èµ·æ¥ä¸é”™ã€‚\nPerl è¿™æ˜¯å¯¹ Raku ç‰ˆæœ¬çš„ç›´æ¥ç¿»è¯‘ï¼Œåªæ˜¯æˆ‘å¿…é¡»å®ç° \u0026ldquo;comb\u0026rdquo;ã€‚\næ–‡ä»¶ï¼š binary-substring-perl\n#! /usr/bin/env perl use strict; use warnings; use feature \u0026#39;say\u0026#39;; use feature \u0026#39;signatures\u0026#39;; use Getopt::Long; no warnings \u0026#34;experimental::signatures\u0026#34;; my $verbose = 0; GetOptions(\u0026#34;verbose\u0026#34; =\u0026gt; \\$verbose); my $B = shift(@ARGV) // \u0026#39;101100101\u0026#39;; die \u0026#34;Not a binary number\u0026#34; unless $B =~ /^[01]+$/; my $S = shift(@ARGV) // 3; die \u0026#34;Not an integer\u0026#34; unless $S =~ /^[1-9][0-9]*$/; die \u0026#34;Not a legal length\u0026#34; if length($B) % $S; my @B = comb($B, $S); my $first = shift(@B); my $total = 0; for my $current (@B) { my $flip = bit_diff($first, $current); $total += $flip; say \u0026#34;: $first-\u0026gt; $current-\u0026gt; Flip: $flip\u0026#34; if $verbose; } say $total; sub bit_diff ($a, $b) { my $flip = 0; for my $index (0 .. length($a)) { $flip++ if substr($a, $index,1) ne substr($b, $index,1); } return $flip; } sub comb ($string, $length = 1) # [1] { my @result; while ($string) { push(@result, substr($string, 0, $length)); $string = substr($string, $length); } return @result; } [1] ç¼ºå¤±çš„ Raku ä¾‹ç¨‹ \u0026ldquo;comb\u0026rdquo;ã€‚å¯é€‰çš„ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šäº†å®ƒæ‰€è¿”å›çš„æ¯ä¸ªå­ä¸²ä¸­æ‰€åŒ…å«çš„ï¼ˆç¬¬ä¸€ä¸ªå‚æ•°çš„ï¼‰å­ä¸²é•¿åº¦ã€‚\nè¿è¡Œå®ƒçš„ç»“æœä¸ Raku ç‰ˆæœ¬ç›¸åŒã€‚\n$ ./binary-substring-perl \u0026quot;101100101\u0026quot; 3 1 $ ./binary-substring-perl -v \u0026quot;101100101\u0026quot; 3 : 101 -\u0026gt; 100 -\u0026gt; Flip: 1 : 101 -\u0026gt; 101 -\u0026gt; Flip: 0 1 $ ./binary-substring-perl \u0026quot;101100111\u0026quot; 3 2 $ ./binary-substring-perl -v \u0026quot;101100111\u0026quot; 3 : 101 -\u0026gt; 100 -\u0026gt; Flip: 1 : 101 -\u0026gt; 111 -\u0026gt; Flip: 1 2 å°±æ˜¯è¿™æ ·ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2021-01-30-caesarean-substrings-with-raku-and-perl/","tags":["Raku","Rakulang"],"title":"Caesarean Substrings With Raku and Perl"},{"categories":["Flink"],"contents":"If Sets Would DWIM æ¯å½“æˆ‘åœ¨ Raku ä¸­ä½¿ç”¨é›†åˆçš„æ—¶å€™ï¼Œå®ƒä»¬ç»å¸¸æ— æ³• DWIMã€‚è¿™æ˜¯ä¸€ä¸ªç®€çŸ­çš„æ¢ç´¢ï¼Œçœ‹çœ‹æ˜¯å¦å¯ä»¥æ”¹è¿› DWIMminessã€‚\næˆ‘æœ€è¿‘é‡æ–°å®¡è§†äº†æˆ‘å‰æ®µæ—¶é—´å†™çš„ä¸€ä¸ªåˆ©ç”¨ (-) é›†å·®è¿ç®—ç¬¦çš„è„šæœ¬ã€‚è¿™æ®µä»£ç æœ‰ä¸€ä¸ª bug æ½œä¼åœ¨é‚£é‡Œï¼Œæ˜¾è€Œæ˜“è§ï¼Œå› ä¸ºä¸‹é¢çš„ä»£ç å¹¶æ²¡æœ‰æŒ‰ç…§æˆ‘çš„ç›´è§‰å»åšã€‚\nmy @allowed = \u0026lt;m c i p l o t\u0026gt;; my @chars = \u0026#39;impolitic\u0026#39;.comb; my @remainder = @allowed (-) @chars; if +@remainder == 0 { say \u0026#39;pangram\u0026#39;; } else { say \u0026#34;unused: [{@remainder.join(\u0026#39;\u0026#39;)}]\u0026#34;; } unused: [] é”™è¯¯çš„åŸå› æ˜¯ (-) äº§ç”Ÿäº†ä¸€ä¸ª Setï¼Œè€Œèµ‹å€¼ç»™ @remainder ä¼šäº§ç”Ÿ1é¡¹çš„ Arrayã€‚æ€»æ˜¯è¿™æ ·ã€‚ä½†ä¸æ–¹ä¾¿çš„æ˜¯ï¼Œå½“å®ƒæ˜¯ä¸€ä¸ªç©ºé›†åˆæ—¶ï¼Œå®ƒå°±ä¼šå­—ç¬¦ä¸²åŒ–ä¸ºä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œè¿™åªæ˜¯å¸®åŠ©æ©ç›–äº†è¿™ä¸ªæ½œä¼çš„é”™è¯¯ã€‚\nmy @items = \u0026lt;a b c d e\u0026gt; (-) \u0026lt;a b c d e\u0026gt;; say @items.raku; say +@items; [Set.new()] 1 è§£å†³æ–¹æ³•æ¯”è¾ƒç®€å•ã€‚åªè¦ä¸èµ‹å€¼ç»™æ•°ç»„å°±å¯ä»¥äº†ã€‚ä½¿ç”¨ä¸€ä¸ªæ ‡é‡å®¹å™¨æ¥ä»£æ›¿ã€‚\nmy $items = \u0026lt;a b c d e\u0026gt; (-) \u0026lt;a b d\u0026gt;; say $items.raku; say +$items; Set.new(\u0026quot;e\u0026quot;,\u0026quot;c\u0026quot;) 2 ç”šè‡³æ˜¯å…³è”å®¹å™¨ä¹Ÿå¯ä»¥ã€‚\nmy %items = \u0026lt;a b c d e\u0026gt; (-) \u0026lt;a b d\u0026gt;; say %items.raku; say +%items; {:c(Bool::True), :e(Bool::True)} 2 æˆ–åœ¨èµ‹å€¼å‰æ˜ç¡®åœ°å–å‡ºé”®çš„åˆ—è¡¨ã€‚\nmy @items = (\u0026lt;a b c d e\u0026gt; (-) \u0026lt;a b d\u0026gt;).keys; say @items.raku; say +@items; [\u0026quot;e\u0026quot;, \u0026quot;c\u0026quot;] 2 å¾ˆå¥½ï¼Œèµ·ä½œç”¨äº†ã€‚åªæ˜¯ä¸è¦ç”¨æ•°ç»„å®¹å™¨æ¥å¤„ç† Setty è¿™æ ·çš„ä¸œè¥¿ã€‚åªæ˜¯è¿™å¹¶ä¸èƒ½é˜»æ­¢æˆ‘çš„ç›´è§‰æ—¶ä¸æ—¶åœ°ç¢°ä¸Šè¿™ä¸ªé”™è¯¯ã€‚åŒä¸€ç±»çš„ bug åœ¨æˆ‘çš„ä»£ç ä¸­å‡ºç°è¿‡å¥½å‡ æ¬¡ï¼Œå› ä¸ºå®ƒå®åœ¨æ˜¯å¤ªå®¹æ˜“çŠ¯é”™äº†ã€‚Raku ä¸ä¼šå‘Šè¯‰æˆ‘ï¼Œæˆ‘åšé”™äº†ä»€ä¹ˆï¼Œå› ä¸ºä¹Ÿè®¸æ˜¯æ•…æ„çš„ã€‚ä½†é‡è¦çš„æ˜¯ï¼Œ Raku æ²¡æœ‰è®¾æ³• DWIMã€‚\næˆ‘å¯ä»¥é‡‡å–çš„å¦ä¸€ä¸ªæ–¹æ³•æ˜¯å…»æˆæ·»åŠ ç±»å‹ä¿¡æ¯çš„ä¹ æƒ¯ã€‚è¿™æ ·ç¡®å®å¯ä»¥è®© Raku åœ¨æˆ‘æ‰è¿›è¿™ä¸ªé™·é˜±çš„æ—¶å€™å‘Šè¯‰æˆ‘ã€‚\nmy Str @a = \u0026lt;a b c d e\u0026gt; (-) \u0026lt;a b d\u0026gt;; Type check failed in assignment to @a; expected Str but got Set (Set.new(\u0026quot;e\u0026quot;,\u0026quot;c\u0026quot;)) in sub at EVAL_0 line 3 in block \u0026lt;unit\u0026gt; at EVAL_0 line 5 in block \u0026lt;unit\u0026gt; at -e line 1 è¿™æ˜¯ä¸€ä¸ªæ˜æ˜¾çš„ä¾‹å­ï¼Œæ·»åŠ ç±»å‹ä¿¡æ¯æœ‰åŠ©äº Raku ç¼–è¯‘å™¨å¸®åŠ©æˆ‘é¿å…å¼•å…¥è¿™ç§ bugã€‚\nå®éªŒ - ä¸º Set è‡ªå®šä¹‰æ•°ç»„å­˜å‚¨ æˆ‘å¼€å§‹ç ”ç©¶æ ¸å¿ƒè®¾ç½®(core setting)ï¼Œçœ‹çœ‹å¯ä»¥åšä»€ä¹ˆã€‚æˆ‘æƒŠå–œåœ°å‘ç°ï¼Œæˆ‘å¯ä»¥åœ¨ Array.STORE çš„å¤šé‡åˆ†æ´¾ä¸­æ·»åŠ æˆ‘æ­£åœ¨å¯»æ‰¾çš„è¯­ä¹‰ã€‚\nuse MONKEY; augment class Array { multi method STORE(Array:D: Set \\item --\u0026gt; Array:D) { self.STORE(item.keys) } } my @a = \u0026lt;a b c d e\u0026gt; (-) \u0026lt;a b d\u0026gt;; say @a.raku; say +@a; [\u0026quot;c\u0026quot;, \u0026quot;e\u0026quot;] 2 åˆ†äº«è¿™ä¸ªä¼¼ä¹æ˜¯è°¨æ…çš„ï¼Œçœ‹çœ‹æˆ‘çš„å° DWIM æ˜¯å¦æœ‰ä»»ä½•æˆ‘æ²¡æœ‰è€ƒè™‘åˆ°çš„é—®é¢˜æˆ–ç¼ºç‚¹ã€‚ä¸€ä¸ªå¯èƒ½çš„ç¼ºç‚¹æ˜¯ï¼Œå¦‚æœä½ éœ€è¦è¿™æ ·åšçš„è¯ï¼Œä½ éœ€è¦ä½¿ç”¨ , æ¥å¼ºåˆ¶å°†ä¸€ä¸ªé›†åˆå˜æˆä¸€ä¸ªæ•°ç»„ã€‚\nmy @a = \u0026lt;a b c d e\u0026gt; (-) \u0026lt;a b d\u0026gt; , ; say @a.raku; [Set.new(\u0026quot;e\u0026quot;,\u0026quot;c\u0026quot;)] ä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆ æˆ‘å¸Œæœ›è¿™èƒ½å¼•å‘å…³äºè¿™ä¸ªé—®é¢˜ä»¥åŠå…¶ä»–æˆ‘ä»¬çš„ç›´è§‰å’Œ Raku çš„è¡Œä¸ºä¸å¤ªä¸€è‡´çš„æƒ…å†µçš„è®¨è®ºã€‚ä¹Ÿè®¸è¿˜æœ‰å…¶ä»–ç›¸å…³çš„è¯­è¨€è¾¹ç¼˜å¯ä»¥è¢«ç£¨å¹³ï¼Œä»¥æ¶ˆé™¤è¿™ç§å±å®³ã€‚\nåç»­ åœ¨ Reddit ä¸Šæœ‰ä¸€äº›éå¸¸æœ‰å¯å‘æ€§çš„è®¨è®ºï¼Œæ¶µç›–äº†è¯­è¨€è¯­ä¹‰å’Œå„ç§æ›¿ä»£æ–¹æ³•ã€‚å…¬å¹³åœ°è¯´ï¼Œæˆ‘å»ºè®®çš„æ–¹æ³•å¼•å…¥äº†æ›´å¤šçš„ä¸ä¸€è‡´æ€§ï¼Œè€Œä¸æ˜¯ä»·å€¼ï¼Œä½†è®¨è®ºå¯èƒ½ä¼šå¯¼è‡´ä¸€ä¸ªè¯­è¨€ä¸€è‡´çš„è§£å†³æ–¹æ¡ˆã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2021-02-07-if-sets-would-dwim/","tags":["Raku","Rakulang"],"title":"å¦‚æœé›†åˆå¦‚æˆ‘æ‰€æƒ³"},{"categories":["Rust"],"contents":"Grammar ä¸è®¸å¤šè§£æå·¥å…·ä¸€æ ·ï¼Œpest ä½¿ç”¨ä¸ Rust ä»£ç ä¸åŒçš„æ­£å¼ grammar è¿›è¡Œæ“ä½œã€‚pest ä½¿ç”¨çš„æ ¼å¼ç§°ä¸ºè§£æè¡¨è¾¾å¼ grammarï¼Œæˆ– PEGã€‚å½“æ„å»ºä¸€ä¸ªé¡¹ç›®æ—¶ï¼Œpest ä¼šè‡ªåŠ¨å°†ä½äºå•ç‹¬æ–‡ä»¶ä¸­çš„ PEG ç¼–è¯‘æˆæ‚¨å¯ä»¥è°ƒç”¨çš„æ™®é€š Rust å‡½æ•°ã€‚\nå¦‚ä½•æ¿€æ´» pest å¤§å¤šæ•°é¡¹ç›®è‡³å°‘ä¼šæœ‰ä¸¤ä¸ªä½¿ç”¨ pest çš„æ–‡ä»¶ï¼šè§£æå™¨ (æ¯”å¦‚ src/parser/mod.rs) å’Œ grammar (src/parser/grammar.pest)ã€‚å‡è®¾å®ƒä»¬åœ¨åŒä¸€ä¸ªç›®å½•ä¸‹ã€‚\nusepest::Parser;#[derive(Parser)]#[grammar = \u0026#34;parser/grammar.pest\u0026#34;]// relative to project `src` struct MyParser;æ¯å½“ä½ ç¼–è¯‘è¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œpest ä¼šè‡ªåŠ¨ä½¿ç”¨ grammar æ–‡ä»¶ç”Ÿæˆè¿™æ ·çš„é¡¹ã€‚\npubenum Rules{/* ... */}implParserforMyParser{pubfn parse(Rules,\u0026amp;str)-\u0026gt; pest::Pairs{/* ... */}}ä½ æ°¸è¿œä¸ä¼šçœ‹åˆ° enum Rules æˆ– impl Parser çš„çº¯æ–‡æœ¬ã€‚è¿™äº›ä»£ç åªå­˜åœ¨äºç¼–è¯‘è¿‡ç¨‹ä¸­ã€‚ç„¶è€Œï¼Œæ‚¨å¯ä»¥åƒä½¿ç”¨å…¶ä»–æšä¸¾ä¸€æ ·ä½¿ç”¨ Rulesï¼Œå¹¶ä¸”æ‚¨å¯ä»¥é€šè¿‡ Parser API ç« èŠ‚ä¸­æè¿°çš„ Pairs æ¥å£ä½¿ç”¨ parse(...)ã€‚\nå…³äº PEGs çš„è­¦å‘Š! è§£æè¡¨è¾¾å¼ grammar çœ‹èµ·æ¥å’Œä½ å¯èƒ½ä¹ æƒ¯çš„å…¶ä»–è§£æå·¥å…·å¾ˆç›¸ä¼¼ï¼Œæ¯”å¦‚æ­£åˆ™è¡¨è¾¾å¼ã€BNF grammar å’Œå…¶ä»–å·¥å…·ï¼ˆYacc/Bisonã€LALRã€CFGï¼‰ã€‚ç„¶è€Œï¼ŒPEGs çš„è¡Œä¸ºå´æœ‰å¾®å¦™çš„ä¸åŒã€‚PEGs æ˜¯æ€¥åˆ‡çš„ã€éå›æº¯çš„ã€æœ‰åºçš„ã€ä¸å«ç³Šçš„ã€‚\nå¦‚æœä½ ä¸è®¤è¯†ä»¥ä¸Šä»»ä½•ä¸€ä¸ªåå­—ï¼Œä¸è¦å®³æ€•! ä½ å·²ç»æ¯”è®¤è¯†çš„äººå¿«äº†ä¸€æ­¥ - å½“ä½ ä½¿ç”¨ pest çš„ PEGs æ—¶ï¼Œä½ ä¸ä¼šè¢«ä¸å…¶ä»–å·¥å…·çš„æ¯”è¾ƒæ‰€ç»Šå€’ã€‚\nå¦‚æœä½ ä¹‹å‰ä½¿ç”¨è¿‡å…¶ä»–è§£æå·¥å…·ï¼Œä¸€å®šè¦ä»”ç»†é˜…è¯»ä¸‹ä¸€èŠ‚ã€‚æˆ‘ä»¬ä¼šæåˆ°ä¸€äº›å…³äº PEGs çš„å¸¸è§é”™è¯¯ã€‚\nè§£æè¡¨è¾¾å¼è¯­æ³• è§£æè¡¨è¾¾å¼è¯­æ³•(PEG)åªæ˜¯ä¸¥æ ¼åœ°è¡¨ç¤ºäº†å¦‚æœä½ ç”¨æ‰‹å†™ä¸€ä¸ªè§£æå™¨ä¼šå†™çš„ç®€å•çš„å‘½ä»¤å¼ä»£ç ã€‚\nnumber = { // To recognize a number... ASCII_DIGIT+ // take as many ASCII digits as possible (at least one). } expression = { // To recognize an expression... number // first try to take a number... | \u0026quot;true\u0026quot; // or, if that fails, the string \u0026quot;true\u0026quot;. } äº‹å®ä¸Šï¼Œpest äº§ç”Ÿçš„ä»£ç ä¸ä¸Šé¢æ³¨é‡Šä¸­çš„ä¼ªä»£ç ååˆ†ç›¸ä¼¼ã€‚\nEagerness å½“åœ¨è¾“å…¥å­—ç¬¦ä¸²ä¸Šè¿è¡Œé‡å¤çš„ PEG è¡¨è¾¾å¼æ—¶ã€‚\nASCII_DIGIT+ // one or more characters from '0' to '9' å®ƒå°½å¯èƒ½å¤šåœ°è¿è¡Œè¯¥è¡¨è¾¾å¼ï¼ˆ\u0026ldquo;æ€¥åˆ‡åœ°\u0026quot;æˆ– \u0026ldquo;è´ªå©ªåœ°\u0026quot;åŒ¹é…ï¼‰ã€‚å®ƒè¦ä¹ˆæˆåŠŸï¼Œæ¶ˆè€—å®ƒæ‰€åŒ¹é…çš„ä»»ä½•å†…å®¹ï¼Œå¹¶å°†å‰©ä½™çš„è¾“å…¥ä¼ é€’åˆ°è§£æå™¨çš„ä¸‹ä¸€æ­¥ã€‚\n\u0026quot;42 boxes\u0026quot; ^ Running ASCII_DIGIT+ \u0026quot;42 boxes\u0026quot; ^ Successfully took one or more digits! \u0026quot; boxes\u0026quot; ^ Remaining unparsed input. æˆ–å¤±è´¥ï¼Œä»€ä¹ˆä¹Ÿä¸æ¶ˆè€—ã€‚\n\u0026quot;galumphing\u0026quot; ^ Running ASCII_DIGIT+ Failed to take one or more digits! \u0026quot;galumphing\u0026quot; ^ Remaining unparsed input (everything). å¦‚æœä¸€ä¸ªè¡¨è¾¾å¼æœªèƒ½åŒ¹é…ï¼Œé‚£ä¹ˆè¿™ä¸ªå¤±è´¥å°±ä¼šå‘ä¸Šä¼ æ’­ï¼Œæœ€ç»ˆå¯¼è‡´è§£æå¤±è´¥ï¼Œé™¤éè¿™ä¸ªå¤±è´¥åœ¨ grammar ä¸­çš„æŸä¸ªåœ°æ–¹è¢«\u0026quot;æŠ“ä½\u0026rdquo;ã€‚é€‰æ‹©æ“ä½œç¬¦æ˜¯\u0026quot;æ•è·\u0026quot;è¿™ç§å¤±è´¥çš„ä¸€ç§æ–¹æ³•ã€‚\næœ‰åºé€‰æ‹© é€‰æ‹©æ“ä½œç¬¦ï¼Œå†™æˆä¸€æ¡ç«–çº¿ |ï¼Œæ˜¯æœ‰åºçš„ã€‚PEG è¡¨è¾¾å¼ first | second çš„æ„æ€æ˜¯ \u0026ldquo;å…ˆè¯• firstï¼Œä½†å¦‚æœå¤±è´¥äº†ï¼Œå†è¯• second\u0026quot;ã€‚\nåœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œé¡ºåºå¹¶ä¸é‡è¦ã€‚ä¾‹å¦‚ï¼Œ\u0026quot;true\u0026quot; | \u0026quot;false\u0026quot; å°†åŒ¹é…å­—ç¬¦ä¸² \u0026quot;true\u0026quot; æˆ–å­—ç¬¦ä¸² \u0026quot;false\u0026quot;ï¼ˆå¦‚æœä¸¤è€…éƒ½ä¸å‡ºç°ï¼Œåˆ™å¤±è´¥ï¼‰ã€‚\nç„¶è€Œï¼Œæœ‰æ—¶é¡ºåºç¡®å®å¾ˆé‡è¦ã€‚è€ƒè™‘ä¸€ä¸‹ PEG è¡¨è¾¾å¼ \u0026quot;a\u0026quot; | \u0026quot;ab\u0026quot;ã€‚ä½ å¯èƒ½æœŸæœ›å®ƒèƒ½åŒ¹é…å­—ç¬¦ä¸² \u0026quot;a\u0026quot; æˆ–å­—ç¬¦ä¸² \u0026quot;ab\u0026quot;ã€‚ä½†äº‹å®å¹¶éå¦‚æ­¤ - è¯¥è¡¨è¾¾å¼çš„æ„æ€æ˜¯ \u0026ldquo;å°è¯• \u0026quot;a\u0026quot;ï¼›ä½†å¦‚æœå¤±è´¥ï¼Œåˆ™å°è¯• \u0026quot;ab\u0026quot;ã€‚å¦‚æœä½ æ­£åœ¨åŒ¹é…å­—ç¬¦ä¸² \u0026ldquo;abc\u0026rdquo;ï¼Œå°è¯• \u0026quot;a\u0026quot; ä¸ä¼šå¤±è´¥ï¼›ç›¸åï¼Œå®ƒå°†æˆåŠŸåŒ¹é… \u0026quot;a\u0026quot;ï¼Œç•™ä¸‹ \u0026quot;bc\u0026quot; æœªè¢«è§£æã€‚\nä¸€èˆ¬æ¥è¯´ï¼Œå½“ç¼–å†™ä¸€ä¸ªæœ‰é€‰æ‹©çš„è§£æå™¨æ—¶ï¼ŒæŠŠæœ€é•¿æˆ–æœ€å…·ä½“çš„é€‰æ‹©æ”¾åœ¨å‰é¢ï¼Œè€ŒæŠŠæœ€çŸ­æˆ–æœ€ä¸€èˆ¬çš„é€‰æ‹©æ”¾åœ¨æœ€åã€‚\néå›æº¯ åœ¨è§£æè¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ª PEG è¡¨è¾¾å¼è¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ã€‚å¦‚æœæˆåŠŸäº†ï¼Œä¸‹ä¸€æ­¥å°±ç…§å¸¸è¿›è¡Œã€‚ä½†å¦‚æœå®ƒå¤±è´¥äº†ï¼Œæ•´ä¸ªè¡¨è¾¾å¼å°±ä¼šå¤±è´¥ã€‚å¼•æ“ä¸ä¼šåé€€å†è¯•ã€‚\nè¯·çœ‹ä¸‹é¢è¿™ä¸ª grammarï¼Œåœ¨å­—ç¬¦ä¸² \u0026quot;frumious\u0026quot; ä¸Šè¿›è¡ŒåŒ¹é…ã€‚\nword = { // to recognize a word... ANY* // take any character, zero or more times... ~ ANY // followed by any character } ä½ å¯èƒ½æœŸæœ›è¿™æ¡è§„åˆ™èƒ½å¤Ÿè§£æä»»ä½•è‡³å°‘åŒ…å«ä¸€ä¸ªå­—ç¬¦ï¼ˆç›¸å½“äº ANY+ï¼‰çš„è¾“å…¥å­—ç¬¦ä¸²ã€‚ä½†å®ƒä¸ä¼šã€‚ç›¸åï¼Œç¬¬ä¸€ä¸ª ANY* ä¼šæ€¥åˆ‡åœ°åƒæ‰æ•´ä¸ªå­—ç¬¦ä¸² - å®ƒä¼šå¾—å¿æ‰€æ„¿çš„ã€‚ç„¶åï¼Œä¸‹ä¸€ä¸ª ANY å°†ä¸€æ— æ‰€æœ‰ï¼Œæ‰€ä»¥å®ƒä¼šå¤±è´¥ã€‚\n\u0026quot;frumious\u0026quot; ^ (word) \u0026quot;frumious\u0026quot; ^ (ANY*) Success! Continue to `ANY` with remaining input \u0026quot;\u0026quot;. \u0026quot;\u0026quot; ^ (ANY) Failure! Expected one character, but found end of string. åœ¨æœ‰å›æº¯åŠŸèƒ½çš„ç³»ç»Ÿä¸­ï¼ˆæ¯”å¦‚æ­£åˆ™è¡¨è¾¾å¼ï¼‰ï¼Œä½ ä¼šå¾€åé€€ä¸€æ­¥ï¼Œ\u0026ldquo;åå‡º\u0026quot;ä¸€ä¸ªå­—ç¬¦ï¼Œç„¶åå†è¯•ã€‚ä½† PEG ä¸ä¼šè¿™æ ·åšã€‚åœ¨è§„åˆ™ first~second ä¸­ï¼Œä¸€æ—¦ first è§£ææˆåŠŸï¼Œå°±å·²ç»æ¶ˆè€—äº†ä¸€äº›å­—ç¬¦ï¼Œæ°¸è¿œä¸ä¼šå†å›æ¥ï¼Œsecond åªèƒ½åœ¨ first æ²¡æœ‰æ¶ˆè€—çš„è¾“å…¥ä¸Šè¿è¡Œã€‚\næ¯«ä¸å«ç³Š è¿™äº›è§„åˆ™æ„æˆäº†ä¸€ä¸ªä¼˜é›…è€Œç®€å•çš„ç³»ç»Ÿã€‚æ¯ä¸ª PEG è§„åˆ™éƒ½ä¼šåœ¨è¾“å…¥å­—ç¬¦ä¸²çš„å‰©ä½™éƒ¨åˆ†ä¸Šè¿è¡Œï¼Œæ¶ˆè€—å°½å¯èƒ½å¤šçš„è¾“å…¥ã€‚ä¸€æ—¦ä¸€ä¸ªè§„åˆ™å®Œæˆï¼Œå‰©ä¸‹çš„è¾“å…¥å°±ä¼šè¢«ä¼ é€’ç»™è§£æå™¨çš„å…¶ä»–éƒ¨åˆ†ã€‚\nä¾‹å¦‚ï¼Œè¡¨è¾¾å¼ ASCII_DIGIT+ï¼Œ\u0026ldquo;ä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­—\u0026rdquo;ï¼Œå°†å§‹ç»ˆåŒ¹é…å¯èƒ½çš„æœ€å¤§çš„è¿ç»­æ•°å­—åºåˆ—ã€‚ä¸å­˜åœ¨æ„å¤–åœ°è®©åé¢çš„è§„åˆ™å›æº¯å¹¶ä»¥ä¸€ç§ä¸ç›´è§‚å’Œéå±€éƒ¨çš„æ–¹å¼çªƒå–ä¸€äº›æ•°å­—çš„å±é™©ã€‚\nè¿™ä¸å…¶ä»–è§£æå·¥å…·å½¢æˆäº†é²œæ˜çš„å¯¹æ¯”ï¼Œæ¯”å¦‚æ­£åˆ™è¡¨è¾¾å¼å’Œ CFGï¼Œåœ¨è¿™äº›å·¥å…·ä¸­ï¼Œè§„åˆ™çš„ç»“æœå¾€å¾€å–å†³äºä¸€äº›è·ç¦»çš„ä»£ç ã€‚äº‹å®ä¸Šï¼ŒLRè§£æå™¨ä¸­è‘—åçš„\u0026quot;ç§»ä½/è¿˜åŸå†²çª\u0026quot;åœ¨ PEG ä¸­å¹¶ä¸å­˜åœ¨é—®é¢˜ã€‚\nä¸è¦æƒŠæ…Œ è¿™ä¸€åˆ‡åœ¨ä¸€å¼€å§‹å¯èƒ½æœ‰ç‚¹åå¸¸ã€‚ä½†æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼ŒåŸºæœ¬çš„é€»è¾‘æ˜¯éå¸¸ç®€å•å’Œç›´æ¥çš„ã€‚ä½ å¯ä»¥çç¢åœ°é€æ­¥å®Œæˆä»»ä½• PEG è¡¨è¾¾å¼çš„æ‰§è¡Œã€‚\n è¯•è¯•è¿™ä¸ªã€‚ å¦‚æœå®ƒæˆåŠŸäº†ï¼Œå°±å°è¯•ä¸‹ä¸€ä»¶äº‹ã€‚ å¦åˆ™ï¼Œå°è¯•å¦ä¸€ä»¶äº‹ã€‚  (this ~ next_thing) | (other_thing) è¿™äº›è§„åˆ™ç»“åˆåœ¨ä¸€èµ·ï¼Œä½¿å¾— PEG æˆä¸ºç¼–å†™è§£æå™¨çš„éå¸¸æ„‰å¿«çš„å·¥å…·ã€‚\npet è§£æå™¨çš„è¯­æ³• pet grammar æ˜¯è§„åˆ™çš„åˆ—è¡¨ã€‚è§„åˆ™æ˜¯è¿™æ ·å®šä¹‰çš„ã€‚\nmy_rule = { ... } another_rule = { // comments are preceded by two slashes ... // whitespace goes anywhere } ç”±äºè§„åˆ™åè¢«ç¿»è¯‘æˆ Rust enum å˜ä½“ï¼Œæ‰€ä»¥ä¸å…è®¸æˆä¸º Rust å…³é”®å­—ã€‚\nå®šä¹‰è§„åˆ™çš„å·¦å¤§æ‹¬å· { å‰é¢å¯ä»¥æœ‰å½±å“å…¶æ“ä½œçš„ç¬¦å·ã€‚\nsilent_rule = _{ ... } atomic_rule = @{ ... } è¡¨è¾¾å¼ Grammar è§„åˆ™æ˜¯ç”±è¡¨è¾¾å¼å»ºç«‹èµ·æ¥çš„ï¼ˆå› æ­¤ç§°ä¸º\u0026quot;è§£æè¡¨è¾¾å¼æ–‡æ³•\u0026rdquo;ï¼‰ã€‚è¿™äº›è¡¨è¾¾å¼æ˜¯å¯¹å¦‚ä½•è§£æè¾“å…¥å­—ç¬¦ä¸²çš„ç®€æ˜ã€æ­£å¼çš„æè¿°ã€‚\nè¡¨è¾¾å¼æ˜¯å¯ä»¥ç»„åˆçš„ï¼šå®ƒä»¬å¯ä»¥ä»å…¶ä»–è¡¨è¾¾å¼ä¸­æ„å»ºå‡ºæ¥ï¼Œä¹Ÿå¯ä»¥äº’ç›¸åµŒå¥—ï¼Œä»¥äº§ç”Ÿä»»æ„å¤æ‚çš„è§„åˆ™ï¼ˆå°½ç®¡ä½ åº”è¯¥å°†éå¸¸å¤æ‚çš„è¡¨è¾¾å¼åˆ†è§£æˆå¤šä¸ªè§„åˆ™ï¼Œä»¥ä½¿å®ƒä»¬æ›´å®¹æ˜“ç®¡ç†ï¼‰ã€‚\nPEG è¡¨è¾¾å¼æ—¢é€‚ç”¨äºé«˜çº§æ„ä¹‰ï¼Œå¦‚\u0026quot;ä¸€ä¸ªå‡½æ•°ç­¾åï¼Œåé¢æ˜¯ä¸€ä¸ªå‡½æ•°ä½“\u0026rdquo;ï¼Œä¹Ÿé€‚ç”¨äºä½çº§æ„ä¹‰ï¼Œå¦‚\u0026quot;ä¸€ä¸ªåˆ†å·ï¼Œåé¢æ˜¯æ¢è¡Œ\u0026rdquo;ã€‚ç»„åˆå½¢å¼\u0026quot;åé¢æ˜¯\u0026rdquo;ï¼Œå³åºåˆ—æ“ä½œç¬¦ï¼Œåœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹éƒ½æ˜¯ä¸€æ ·çš„ã€‚\nç»ˆç«¯ æœ€åŸºæœ¬çš„è§„åˆ™æ˜¯åŒå¼•å·çš„æ–‡å­—å­—ç¬¦ä¸²ã€‚\u0026quot;text\u0026quot;ã€‚\nå¦‚æœä¸€ä¸ªå­—ç¬¦ä¸²å‰é¢æœ‰ä¸€ä¸ªé€—å·ï¼Œé‚£ä¹ˆå®ƒå¯ä»¥ä¸åŒºåˆ†å¤§å°å†™ï¼ˆä»…é€‚ç”¨äº ASCII å­—ç¬¦ï¼‰: ^\u0026quot;text\u0026quot;ã€‚\nåœ¨ä¸€ä¸ªèŒƒå›´å†…çš„å•ä¸ªå­—ç¬¦è¢«å†™æˆä¸¤ä¸ªå•å¼•å·å­—ç¬¦ï¼Œç”¨ä¸¤ä¸ªç‚¹åˆ†å¼€ï¼š'0'...'9'ã€‚\nä½ å¯ä»¥ç”¨ç‰¹æ®Šè§„åˆ™ ANY æ¥åŒ¹é…ä»»ä½•å•ä¸ªå­—ç¬¦ã€‚è¿™ç›¸å½“äº '\\u{00}'...'\\u{10FFFF}'ï¼Œä»»ä½•ä¸€ä¸ª Unicode å­—ç¬¦ã€‚\n\u0026quot;a literal string\u0026quot; ^\u0026quot;ASCII case-insensitive string\u0026quot; 'a'..'z' ANY æœ€åï¼Œä½ å¯ä»¥ç›´æ¥å†™å‡ºå…¶ä»–è§„åˆ™çš„åç§°æ¥å¼•ç”¨å®ƒä»¬ï¼Œç”šè‡³å¯ä»¥é€’å½’ä½¿ç”¨è§„åˆ™ã€‚\nmy_rule = { \u0026quot;slithy \u0026quot; ~ other_rule } other_rule = { \u0026quot;toves\u0026quot; } recursive_rule = { \u0026quot;mimsy \u0026quot; ~ recursive_rule } åºåˆ— åºåˆ—è¿ç®—ç¬¦å†™æˆä¸€ä¸ªæ³¢æµªå· ~ã€‚\nfirst ~ and_then (\u0026quot;abc\u0026quot;) ~ (^\u0026quot;def\u0026quot;) ~ ('g'..'z') // matches \u0026quot;abcDEFr\u0026quot; å½“åŒ¹é…ä¸€ä¸ªåºåˆ—è¡¨è¾¾å¼æ—¶ï¼Œå°è¯•åŒ¹é… firstã€‚å¦‚æœ first åŒ¹é…æˆåŠŸï¼Œåˆ™æ¥ä¸‹æ¥å°è¯• and_thenã€‚ä½†æ˜¯ï¼Œå¦‚æœ first å¤±è´¥ï¼Œåˆ™æ•´ä¸ªè¡¨è¾¾å¼å¤±è´¥ã€‚\nè¡¨è¾¾å¼çš„åˆ—è¡¨å¯ä»¥ä¸åºåˆ—é“¾åœ¨ä¸€èµ·ï¼Œè¿™è¡¨æ˜æ‰€æœ‰çš„ç»„ä»¶å¿…é¡»å‡ºç°ï¼ŒæŒ‰ç…§æŒ‡å®šçš„é¡ºåºã€‚\næœ‰åºé€‰æ‹© é€‰æ‹©è¿ç®—ç¬¦å†™æˆä¸€æ¡ç«–çº¿ |ã€‚\nfirst | or_else (\u0026quot;abc\u0026quot;) | (^\u0026quot;def\u0026quot;) | ('g'..'z') // matches \u0026quot;DEF\u0026quot; å½“åŒ¹é…ä¸€ä¸ªé€‰æ‹©è¡¨è¾¾å¼æ—¶ï¼Œå°è¯•åŒ¹é… firstã€‚å¦‚æœ first åŒ¹é…æˆåŠŸï¼Œåˆ™æ•´ä¸ªè¡¨è¾¾å¼ç«‹å³æˆåŠŸã€‚ä½†æ˜¯ï¼Œå¦‚æœ first å¤±è´¥ï¼Œæ¥ä¸‹æ¥ä¼šå°è¯• or_elseã€‚\næ³¨æ„ï¼Œfirst å’Œ or_else æ€»æ˜¯åœ¨åŒä¸€ä¸ªä½ç½®å°è¯•ï¼Œå³ä½¿ first åœ¨å¤±è´¥ä¹‹å‰åŒ¹é…äº†ä¸€äº›è¾“å…¥ã€‚å½“é‡åˆ°è§£æå¤±è´¥æ—¶ï¼Œå¼•æ“ä¼šå°è¯•ä¸‹ä¸€ä¸ªæœ‰åºçš„é€‰æ‹©ï¼Œå°±åƒæ²¡æœ‰åŒ¹é…åˆ°è¾“å…¥ä¸€æ ·ã€‚å¤±è´¥çš„è§£ææ°¸è¿œä¸ä¼šæ¶ˆè€—ä»»ä½•è¾“å…¥ã€‚\nstart = { \u0026quot;Beware \u0026quot; ~ creature } creature = { (\u0026quot;the \u0026quot; ~ \u0026quot;Jabberwock\u0026quot;) | (\u0026quot;the \u0026quot; ~ \u0026quot;Jubjub bird\u0026quot;) } \u0026quot;Beware the Jubjub bird\u0026quot; ^ (start) Parses via the second choice of `creature`, even though the first choice matched \u0026quot;the \u0026quot; successfully. å€Ÿç”¨æœ¯è¯­ï¼ŒæŠŠè¿™ç§æ“ä½œçœ‹æˆæ˜¯\u0026quot;äº¤æ›¿\u0026quot;æˆ–ç®€å•çš„ \u0026ldquo;OR\u0026rdquo;ï¼Œæœ‰ç‚¹è¯±äººï¼Œä½†è¿™æ˜¯è¯¯å¯¼ã€‚ä¹‹æ‰€ä»¥ç‰¹åˆ«ä½¿ç”¨ \u0026ldquo;é€‰æ‹©\u0026rdquo; è¿™ä¸ªè¯ï¼Œæ˜¯å› ä¸ºè¿™ä¸ªæ“ä½œä¸ä»…ä»…æ˜¯é€»è¾‘ä¸Šçš„ \u0026ldquo;OR\u0026rdquo;ã€‚\né‡å¤ æœ‰ä¸¤ä¸ªé‡å¤è¿ç®—ç¬¦ï¼šæ˜Ÿå· * å’ŒåŠ å· +ã€‚å®ƒä»¬è¢«æ”¾åœ¨ä¸€ä¸ªè¡¨è¾¾å¼ä¹‹åã€‚æ˜Ÿå· * è¡¨ç¤ºå‰é¢çš„è¡¨è¾¾å¼å¯ä»¥å‡ºç°é›¶æ¬¡æˆ–å¤šæ¬¡ã€‚åŠ å· + è¡¨ç¤ºå‰é¢çš„è¡¨è¾¾å¼å¯ä»¥å‡ºç°ä¸€æ¬¡æˆ–å¤šæ¬¡ï¼ˆå¿…é¡»è‡³å°‘å‡ºç°ä¸€æ¬¡ï¼‰ã€‚\né—®å·è¿ç®—ç¬¦ ? ç±»ä¼¼ï¼Œä½†å®ƒè¡¨ç¤ºè¡¨è¾¾å¼æ˜¯å¯é€‰çš„ - å®ƒå¯ä»¥å‡ºç°0æ¬¡æˆ–1æ¬¡ã€‚\n(\u0026quot;zero\u0026quot; ~ \u0026quot;or\u0026quot; ~ \u0026quot;more\u0026quot;)* (\u0026quot;one\u0026quot; | \u0026quot;or\u0026quot; | \u0026quot;more\u0026quot;)+ (^\u0026quot;optional\u0026quot;)? è¯·æ³¨æ„ï¼Œexpr* å’Œ expr? æ€»æ˜¯ä¼šæˆåŠŸï¼Œå› ä¸ºå®ƒä»¬è¢«å…è®¸åŒ¹é…é›¶æ¬¡ã€‚ä¾‹å¦‚ï¼Œ\u0026quot;a\u0026quot;* ~ \u0026quot;b\u0026quot;? å³ä½¿åœ¨ç©ºçš„è¾“å…¥å­—ç¬¦ä¸²ä¸Šä¹Ÿä¼šæˆåŠŸã€‚\nå…¶ä»–é‡å¤æ¬¡æ•°å¯ä»¥ç”¨å¤§æ‹¬å·æ¥è¡¨ç¤ºã€‚\nexpr{n} // exactly n repetitions expr{m, n} // between m and n repetitions, inclusive expr{, n} // at most n repetitions expr{m, } // at least m repetitions å› æ­¤ï¼Œexpr* ç­‰åŒäº expr{0ï¼Œ}ï¼›expr+ ç­‰åŒäº expr{1ï¼Œ}ï¼›expr? ç­‰åŒäº expr{0ï¼Œ1}ã€‚\nè°“è¯ åœ¨è¡¨è¾¾å¼å‰é¢åŠ ä¸Šå®‰æ‹¬å· \u0026amp; æˆ–æ„Ÿå¹å· !ï¼Œå°±ä¼šå˜æˆä¸€ä¸ªä¸æ¶ˆè€—ä»»ä½•è¾“å…¥çš„è°“è¯ã€‚ä½ å¯èƒ½çŸ¥é“è¿™äº›è¿ç®—ç¬¦ä¸º \u0026ldquo;å‘å‰æŸ¥çœ‹\u0026rdquo; æˆ– \u0026ldquo;ä¸è¿›ä½\u0026rdquo;ã€‚\nå†™æˆå®‰åŸ¹ç¬¦ \u0026amp; çš„æ­£å¼è°“è¯è¯•å›¾åŒ¹é…å…¶å†…éƒ¨è¡¨è¾¾å¼ã€‚å¦‚æœå†…éƒ¨è¡¨è¾¾å¼æˆåŠŸï¼Œè§£æå°±ä¼šç»§ç»­ï¼Œä½†ä½ç½®ä¸è°“è¯ç›¸åŒ - \u0026amp;foo ~ bar å› æ­¤æ˜¯ä¸€ç§ \u0026ldquo;AND\u0026rdquo; è¯­å¥ã€‚\u0026ldquo;è¾“å…¥å­—ç¬¦ä¸²å¿…é¡»åŒ¹é… foo AND bar\u0026quot;ã€‚å¦‚æœå†…éƒ¨è¡¨è¾¾å¼å¤±è´¥ï¼Œæ•´ä¸ªè¡¨è¾¾å¼ä¹Ÿä¼šå¤±è´¥ã€‚\nå†™æˆæ„Ÿå¹å·çš„å¦å®šè°“è¯ !ï¼Œè¯•å›¾åŒ¹é…å…¶å†…éƒ¨è¡¨è¾¾å¼ã€‚å¦‚æœå†…éƒ¨è¡¨è¾¾å¼å¤±è´¥ï¼Œåˆ™è°“è¯æˆåŠŸï¼Œå¹¶åœ¨ä¸è°“è¯ç›¸åŒçš„ä½ç½®ç»§ç»­è§£æã€‚å¦‚æœå†…éƒ¨è¡¨è¾¾å¼æˆåŠŸï¼Œåˆ™è°“è¯å¤±è´¥ - !foo ~ bar å› æ­¤æ˜¯ä¸€ç§ \u0026ldquo;NOT\u0026rdquo; è¯­å¥ã€‚\u0026ldquo;è¾“å…¥çš„å­—ç¬¦ä¸²å¿…é¡»ä¸ bar åŒ¹é…ï¼Œä½†ä¸èƒ½æ˜¯ foo\u0026quot;ã€‚\nè¿™å°±å¼•å‡ºäº†ä¸€ä¸ªå¸¸è§çš„æƒ¯ç”¨æ³•ï¼Œæ„æ€æ˜¯\u0026quot;ä»»ä½•å­—ç¬¦ä½†æ˜¯\u0026rdquo;ï¼š\nnot_space_or_tab = { !( // if the following text is not \u0026quot; \u0026quot; // a space | \u0026quot;\\t\u0026quot; // or a tab ) ~ ANY // then consume one character } triple_quoted_string = { \u0026quot;'''\u0026quot; ~ triple_quoted_character* ~ \u0026quot;'''\u0026quot; } triple_quoted_character = { !\u0026quot;'''\u0026quot; // if the following text is not three apostrophes ~ ANY // then consume one character } æ“ä½œç¬¦ä¼˜å…ˆçº§å’Œåˆ†ç»„ (WIP) é‡å¤è¿ç®—ç¬¦æ˜Ÿå· *ã€åŠ å· + å’Œé—®å· ? é€‚ç”¨äºç´§æ¥å‰é¢çš„è¡¨è¾¾å¼ã€‚\n\u0026quot;One \u0026quot; ~ \u0026quot;or \u0026quot; ~ \u0026quot;more. \u0026quot;+ \u0026quot;One \u0026quot; ~ \u0026quot;or \u0026quot; ~ (\u0026quot;more. \u0026quot;+) are equivalent and match \u0026quot;One or more. more. more. more. \u0026quot; è¾ƒå¤§çš„è¡¨è¾¾å¼å¯ä»¥é€šè¿‡ç”¨æ‹¬å·åŒ…å›´æ¥é‡å¤ã€‚\n(\u0026quot;One \u0026quot; ~ \u0026quot;or \u0026quot; ~ \u0026quot;more. \u0026quot;)+ matches \u0026quot;One or more. One or more. \u0026quot; é‡å¤è¿ç®—ç¬¦çš„ä¼˜å…ˆæ€§æœ€é«˜ï¼Œå…¶æ¬¡æ˜¯è°“è¯è¿ç®—ç¬¦ã€åºåˆ—è¿ç®—ç¬¦ï¼Œæœ€åæ˜¯æœ‰åºé€‰æ‹©ã€‚\nmy_rule = { \u0026quot;a\u0026quot;* ~ \u0026quot;b\u0026quot;? | \u0026amp;\u0026quot;b\u0026quot;+ ~ \u0026quot;a\u0026quot; } // equivalent to my_rule = { ( (\u0026quot;a\u0026quot;*) ~ (\u0026quot;b\u0026quot;?) ) | ( (\u0026amp;(\u0026quot;b\u0026quot;+)) ~ \u0026quot;a\u0026quot; ) } è¾“å…¥çš„å¼€å§‹å’Œç»“æŸ è§„åˆ™ SOI å’Œ EOI åˆ†åˆ«åŒ¹é…è¾“å…¥å­—ç¬¦ä¸²çš„å¼€å§‹å’Œç»“æŸã€‚ä¸¤è€…éƒ½ä¸æ¶ˆè€—ä»»ä½•æ–‡æœ¬ã€‚å®ƒä»¬åªè¡¨æ˜è§£æå™¨å½“å‰æ˜¯å¦åœ¨è¾“å…¥çš„ä¸€ä¸ªè¾¹ç¼˜ã€‚\nä¾‹å¦‚ï¼Œä¸ºäº†ç¡®ä¿ä¸€æ¡è§„åˆ™åŒ¹é…æ•´ä¸ªè¾“å…¥ï¼Œå…¶ä¸­ä»»ä½•è¯­æ³•é”™è¯¯éƒ½ä¼šå¯¼è‡´è§£æå¤±è´¥ï¼ˆè€Œä¸æ˜¯æˆåŠŸä½†ä¸å®Œæ•´çš„è§£æï¼‰ã€‚\nmain = { SOI ~ (...) ~ EOI } éšå«çš„ç©ºç™½ è®¸å¤šè¯­è¨€å’Œæ–‡æœ¬æ ¼å¼å…è®¸åœ¨é€»è¾‘æ ‡è®°ä¹‹é—´ä»»æ„ç•™ç™½å’Œæ³¨é‡Šã€‚ä¾‹å¦‚ï¼ŒRust è®¤ä¸º 4+5 ç›¸å½“äº 4 + 5 å’Œ 4 /* comment */ + 5ã€‚\nå¯é€‰è§„åˆ™ WHITESPACE å’Œ COMMENT å®ç°äº†è¿™ç§è¡Œä¸ºã€‚å¦‚æœå®šä¹‰äº†è¿™ä¸¤ä¸ªè§„åˆ™ä¸­çš„ä»»ä½•ä¸€ä¸ª(æˆ–ä¸¤ä¸ª)ï¼Œå®ƒä»¬å°†è¢«éšå¼åœ°æ’å…¥åˆ°æ¯ä¸ªåºåˆ—å’Œæ¯ä¸ªé‡å¤ä¹‹é—´(åŸå­è§„åˆ™é™¤å¤–)ã€‚\nexpression = { \u0026quot;4\u0026quot; ~ \u0026quot;+\u0026quot; ~ \u0026quot;5\u0026quot; } WHITESPACE = _{ \u0026quot; \u0026quot; } COMMENT = _{ \u0026quot;/*\u0026quot; ~ (!\u0026quot;*/\u0026quot; ~ ANY)* ~ \u0026quot;*/\u0026quot; } \u0026quot;4+5\u0026quot; \u0026quot;4 + 5\u0026quot; \u0026quot;4 + 5\u0026quot; \u0026quot;4 /* comment */ + 5\u0026quot; æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼ŒWHITESPACE å’Œ COMMENT æ˜¯é‡å¤è¿è¡Œçš„ï¼Œæ‰€ä»¥å®ƒä»¬åªéœ€è¦åŒ¹é…ä¸€ä¸ªç©ºç™½å­—ç¬¦æˆ–ä¸€ä¸ªæ³¨é‡Šã€‚ä¸Šé¢çš„ grammar ç›¸å½“äºã€‚\nexpression = { \u0026quot;4\u0026quot; ~ (ws | com)* ~ \u0026quot;+\u0026quot; ~ (ws | com)* ~ \u0026quot;5\u0026quot; } ws = _{ \u0026quot; \u0026quot; } com = _{ \u0026quot;/*\u0026quot; ~ (!\u0026quot;*/\u0026quot; ~ ANY)* ~ \u0026quot;*/\u0026quot; } è¯·æ³¨æ„ï¼Œéšå¼ç©ºæ ¼ä¸ä¼šæ’å…¥è§„åˆ™çš„å¼€å¤´æˆ–ç»“å°¾ - ä¾‹å¦‚ï¼Œè¡¨è¾¾å¼ä¸åŒ¹é… \u0026quot; 4+5 \u0026quot;ã€‚å¦‚æœä½ æƒ³åœ¨è§„åˆ™çš„å¼€å¤´å’Œç»“å°¾åŠ å…¥éšå¼ç©ºæ ¼ï¼Œä½ éœ€è¦æŠŠå®ƒå¤¹åœ¨ä¸¤ä¸ªç©ºè§„åˆ™ä¹‹é—´ï¼ˆé€šå¸¸æ˜¯ SOI å’Œ EOIï¼Œå¦‚ä¸Šæ‰€è¿°ï¼‰ã€‚\nWHITESPACE = _{ \u0026quot; \u0026quot; } expression = { \u0026quot;4\u0026quot; ~ \u0026quot;+\u0026quot; ~ \u0026quot;5\u0026quot; } main = { SOI ~ expression ~ EOI } \u0026quot;4+5\u0026quot; \u0026quot; 4 + 5 \u0026quot; (è¯·åŠ¡å¿…å°† WHITESPACE å’Œ COMMENT è§„åˆ™æ ‡è®°ä¸ºé™é»˜è§„åˆ™ï¼Œé™¤éä½ æƒ³åœ¨å…¶ä»–è§„åˆ™ä¸­çœ‹åˆ°å®ƒä»¬ï¼)\né™é»˜è§„åˆ™å’ŒåŸå­è§„åˆ™ é™é»˜è§„åˆ™å°±åƒæ™®é€šè§„åˆ™ä¸€æ · - å½“è¿è¡Œæ—¶ï¼Œå®ƒä»¬çš„åŠŸèƒ½æ˜¯ä¸€æ ·çš„ - é™¤äº†å®ƒä»¬ä¸äº§ç”Ÿ pairsæˆ– tokensã€‚å¦‚æœä¸€æ¡è§„åˆ™æ˜¯é™é»˜çš„ï¼Œé‚£ä¹ˆå®ƒæ°¸è¿œä¸ä¼šå‡ºç°åœ¨è§£æç»“æœä¸­ã€‚\nè¦åˆ›å»ºä¸€ä¸ªé™é»˜è§„åˆ™ï¼Œè¯·åœ¨å·¦è¾¹çš„å¤§æ‹¬å· { å‰åŠ ä¸Šä¸€ä¸ªä¸‹åˆ’çº¿ _ã€‚\nsilent = _{ ... } åŸå­ pest æœ‰ä¸¤ç§åŸå­è§„åˆ™ï¼šåŸå­å’Œå¤åˆåŸå­ã€‚è¦åšä¸€ä¸ªï¼Œåœ¨å·¦å¤§æ‹¬å· { å‰å†™ä¸Šä¸€ä¸ªç¬¦å·ã€‚\natomic = @{ ... } compound_atomic = ${ ... } è¿™ä¸¤ç§åŸå­è§„åˆ™éƒ½å¯ä»¥é˜²æ­¢éšå¼ç©ºæ ¼ï¼šåœ¨åŸå­è§„åˆ™ä¸­ï¼Œæ³¢æµªå· ~ è¡¨ç¤º \u0026ldquo;ç´§æ¥ç€\u0026rdquo;ï¼Œé‡å¤æ“ä½œç¬¦ï¼ˆæ˜Ÿå· * å’ŒåŠ å· +ï¼‰æ²¡æœ‰éšå¼åˆ†éš”ã€‚æ­¤å¤–ï¼Œæ‰€æœ‰ä»åŸå­è§„åˆ™ä¸­è°ƒç”¨çš„å…¶ä»–è§„åˆ™ä¹Ÿè¢«è§†ä¸ºåŸå­è§„åˆ™ã€‚\nä¸¤è€…çš„åŒºåˆ«åœ¨äºå®ƒä»¬å¦‚ä½•äº§ç”Ÿå†…éƒ¨è§„åˆ™çš„æ ‡è®°ã€‚åœ¨ä¸€ä¸ªåŸå­è§„åˆ™ä¸­ï¼Œå†…éƒ¨åŒ¹é…è§„åˆ™æ˜¯é™é»˜çš„ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œå¤åˆåŸå­è§„åˆ™ä¼šåƒæ™®é€šè§„åˆ™ä¸€æ ·äº§ç”Ÿå†…éƒ¨ tokenã€‚\nå½“æ‚¨è¦è§£æçš„æ–‡æœ¬å¿½ç•¥ç©ºç™½æ—¶ï¼ŒåŸå­è§„åˆ™æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œé™¤äº†å°‘æ•°æƒ…å†µï¼Œä¾‹å¦‚æ–‡å­—å­—ç¬¦ä¸²ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ç¼–å†™ WHITESPACE æˆ– COMMENT è§„åˆ™ï¼Œç„¶åä½¿æ‚¨çš„å­—ç¬¦ä¸²åŒ¹é…è§„åˆ™æˆä¸ºåŸå­è§„åˆ™ã€‚\néåŸå­çš„ æœ‰æ—¶å€™ï¼Œä½ ä¼šæƒ³è¦å–æ¶ˆåŸå­è§£æçš„æ•ˆæœã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³åœ¨è¡¨è¾¾å¼å†…éƒ¨è¿›è¡Œå­—ç¬¦ä¸²æ’å€¼ï¼Œé‡Œé¢çš„è¡¨è¾¾å¼ä»ç„¶å¯ä»¥åƒæ­£å¸¸çš„ä¸€æ ·æœ‰ç©ºæ ¼ã€‚\n#!/bin/env python3 print(f\u0026#34;The answer is {2 + 4}.\u0026#34;) è¿™æ˜¯ä½ ä½¿ç”¨éåŸå­è§„åˆ™çš„åœ°æ–¹ã€‚åœ¨å®šä¹‰çš„å¤§æ‹¬å·å‰é¢å†™ä¸€ä¸ªæ„Ÿå¹å· ! æ— è®ºæ˜¯å¦ä»åŸå­è§„åˆ™ä¸­è°ƒç”¨ï¼Œè¯¥è§„åˆ™éƒ½å°†ä½œä¸ºéåŸå­è§„åˆ™è¿è¡Œã€‚\nfstring = @{ \u0026quot;\\\u0026quot;\u0026quot; ~ ... } expr = !{ ... } å †æ ˆ(WIP) pest ç»´æŠ¤äº†ä¸€ä¸ªå¯ä»¥ç›´æ¥ä» grammar ä¸­æ“ä½œçš„æ ˆã€‚ä¸€ä¸ªè¡¨è¾¾å¼å¯ä»¥ç”¨å…³é”®å­— PUSH è¿›è¡ŒåŒ¹é…å¹¶æ¨åˆ°æ ˆä¸Šï¼Œç„¶åå†ç”¨å…³é”®å­— PEEK å’Œ POP è¿›è¡Œç²¾ç¡®åŒ¹é…ã€‚\nä½¿ç”¨æ ˆå¯ä»¥å¯¹å®Œå…¨ç›¸åŒçš„æ–‡æœ¬è¿›è¡Œå¤šæ¬¡åŒ¹é…ï¼Œè€Œä¸æ˜¯ç›¸åŒçš„æ¨¡å¼ã€‚\nä¾‹å¦‚:\nsame_text = { PUSH( \u0026quot;a\u0026quot; | \u0026quot;b\u0026quot; | \u0026quot;c\u0026quot; ) ~ POP } same_pattern = { (\u0026quot;a\u0026quot; | \u0026quot;b\u0026quot; | \u0026quot;c\u0026quot;) ~ (\u0026quot;a\u0026quot; | \u0026quot;b\u0026quot; | \u0026quot;c\u0026quot;) } åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œsame_pattern ä¼šåŒ¹é… \u0026quot;ab\u0026quot;ï¼Œè€Œ same_text ä¸ä¼šã€‚\nä¸€ä¸ªå®é™…çš„ç”¨é€”æ˜¯è§£æ Rust çš„ \u0026ldquo;åŸå§‹å­—ç¬¦ä¸²å­—é¢å€¼\u0026quot;ï¼Œå®ƒçœ‹èµ·æ¥åƒè¿™æ ·ã€‚\nconstraw_str: \u0026amp;str =r###\u0026#34; Some number of number signs # followed by a quotation mark \u0026#34;. Quotation marks can be used anywhere inside: \u0026#34;\u0026#34;\u0026#34;\u0026#34;\u0026#34;\u0026#34;\u0026#34;\u0026#34;\u0026#34;, as long as one is not followed by a matching number of number signs, which ends the string: \u0026#34;###;å½“è§£æä¸€ä¸ªåŸå§‹å­—ç¬¦ä¸²æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»è·Ÿè¸ªå¼•å·å‰å‡ºç°äº†å¤šå°‘ä¸ªæ•°å­—ç¬¦å· #ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ ˆæ¥å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚\nraw_string = { \u0026quot;r\u0026quot; ~ PUSH(\u0026quot;#\u0026quot;*) ~ \u0026quot;\\\u0026quot;\u0026quot; // push the number signs onto the stack ~ raw_string_interior ~ \u0026quot;\\\u0026quot;\u0026quot; ~ POP // match a quotation mark and the number signs } raw_string_interior = { ( !(\u0026quot;\\\u0026quot;\u0026quot; ~ PEEK) // unless the next character is a quotation mark // followed by the correct amount of number signs, ~ ANY // consume one character )* } å°æŠ„    è¯­æ³• å«ä¹‰ è¯­æ³• å«ä¹‰     foo = { ... } regular rule baz = @{ ... } atomic   bar = _{ ... } silent` qux = ${ ... } compound-atomic     plugh = !{ ... } non-atomic   \u0026quot;abc\u0026quot; exact string ^\u0026quot;abc\u0026quot; case insensitive   'a'..'z' character range ANY any character   foo ~ bar sequence `baz qux`   foo* zero or more bar+ one or more   baz? optional qux{n} exactly n   qux{m, n} between m and n (inclusive)     \u0026amp;foo positive predicate !bar negative predicate   PUSH(baz) match and push     POP match and pop PEEK match without pop    å†…ç½®è§„åˆ™ é™¤äº† ANYï¼ŒåŒ¹é…ä»»ä½•å•ä¸€çš„ Unicode å­—ç¬¦å¤–ï¼Œpest è¿˜æä¾›äº†å‡ æ¡è§„åˆ™ï¼Œè®©è§£ææ–‡æœ¬æ›´åŠ æ–¹ä¾¿ã€‚\nASCII è§„åˆ™ åœ¨å¯æ‰“å°çš„ ASCII å­—ç¬¦ä¸­ï¼Œå®ƒé€šå¸¸å¯¹åŒ¹é…å­—æ¯å­—ç¬¦å’Œæ•°å­—å¾ˆæœ‰ç”¨ã€‚å¯¹äºæ•°å­—ï¼Œpest æä¾›äº†å¸¸è§çš„ï¼ˆåŸºæ•°ï¼‰çš„æ•°å­—ã€‚\n   Built-in rule Equivalent     ASCII_DIGIT '0'..'9'   ASCII_NONZERO_DIGIT '1'..'9'   ASCII_BIN_DIGIT '0'..'1'   ASCII_OCT_DIGIT '0'..'7'   ASCII_HEX_DIGIT `\u0026lsquo;0\u0026rsquo;..\u0026lsquo;9\u0026rsquo;    å¯¹äºå­—æ¯å­—ç¬¦ï¼Œè¦åŒºåˆ†å¤§å†™å’Œå°å†™ã€‚\n   Built-in rule Equivalent     ASCII_ALPHA_LOWER 'a'..'z'   ASCII_ALPHA_UPPER 'A'..'Z'   ASCII_ALPHA `\u0026lsquo;a\u0026rsquo;..\u0026lsquo;z\u0026rsquo;    And for miscellaneous use:\n   Built-in rule Meaning Equivalent     ASCII_ALPHANUMERIC any digit or letter `ASCII_DIGIT   NEWLINE any line feed format `\u0026quot;\\n\u0026rdquo;    ç»Ÿä¸€ç è§„åˆ™ ä¸ºäº†æ›´å®¹æ˜“æ­£ç¡®è§£æä»»æ„ Unicode æ–‡æœ¬ï¼Œpest åŒ…å«äº†å¤§é‡å¯¹åº” Unicode å­—ç¬¦å±æ€§çš„è§„åˆ™ã€‚è¿™äº›è§„åˆ™åˆ†ä¸ºä¸€èˆ¬ç±»åˆ«å’ŒäºŒè¿›åˆ¶å±æ€§è§„åˆ™ã€‚\nUnicode å­—ç¬¦æ ¹æ®å…¶ä¸€èˆ¬ç”¨é€”è¢«åˆ’åˆ†ä¸ºä¸åŒçš„ç±»åˆ«ã€‚æ¯ä¸€ä¸ªå­—ç¬¦éƒ½å±äºä¸€ä¸ªç±»åˆ«ï¼Œå°±åƒæ¯ä¸€ä¸ª ASCII å­—ç¬¦éƒ½æ˜¯ä¸€ä¸ªæ§åˆ¶å­—ç¬¦ã€ä¸€ä¸ªæ•°å­—ã€ä¸€ä¸ªå­—æ¯ã€ä¸€ä¸ªç¬¦å·æˆ–ä¸€ä¸ªç©ºæ ¼ä¸€æ ·ã€‚\næ­¤å¤–ï¼Œæ¯ä¸ª Unicode å­—ç¬¦éƒ½æœ‰ä¸€ä¸ªäºŒè¿›åˆ¶å±æ€§åˆ—è¡¨ï¼ˆçœŸæˆ–å‡ï¼‰ï¼Œå®ƒæ»¡è¶³æˆ–ä¸æ»¡è¶³è¿™äº›å±æ€§ã€‚å­—ç¬¦å¯ä»¥å±äºä»»ä½•æ•°é‡çš„è¿™äº›å±æ€§ï¼Œè¿™å–å†³äºå®ƒä»¬çš„å«ä¹‰ã€‚\nä¾‹å¦‚ï¼Œå­—ç¬¦ \u0026ldquo;A\u0026rdquo;ï¼Œ\u0026ldquo;æ‹‰ä¸æ–‡å¤§å†™å­—æ¯A\u0026rdquo;ï¼Œå±äºä¸€èˆ¬çš„ \u0026ldquo;å¤§å†™å­—æ¯\u0026rdquo; ç±»åˆ«ï¼Œå› ä¸ºå®ƒçš„ä¸€èˆ¬ç”¨é€”æ˜¯å­—æ¯ã€‚å®ƒå…·æœ‰ \u0026ldquo;å¤§å†™å­—æ¯\u0026rdquo; çš„äºŒå…ƒå±æ€§ï¼Œä½†ä¸å…·æœ‰ \u0026ldquo;è¡¨æƒ…ç¬¦å·\u0026rdquo; çš„å±æ€§ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œ\u0026ldquo;è´Ÿæ•°å¹³æ–¹çš„æ‹‰ä¸æ–‡å¤§å†™å­—æ¯A\u0026rdquo; è¿™ä¸ªå­—ç¬¦ï¼Œå› ä¸ºåœ¨æ–‡æœ¬ä¸­ä¸€èˆ¬ä¸ä½œä¸ºå­—æ¯å‡ºç°ï¼Œæ‰€ä»¥å±äºä¸€èˆ¬ç±»åˆ« \u0026ldquo;å…¶ä»–ç¬¦å·\u0026rdquo;ã€‚å®ƒåŒæ—¶å…·æœ‰ \u0026ldquo;å¤§å†™å­—æ¯\u0026rdquo; å’Œ \u0026ldquo;è¡¨æƒ…ç¬¦å·\u0026rdquo; çš„äºŒå…ƒå±æ€§ã€‚\nè¯¦æƒ…è¯·å‚è€ƒã€ŠUnicode æ ‡å‡†ã€‹ç¬¬å››ç« ã€‚\nä¸€èˆ¬ç±»åˆ« ä»å½¢å¼ä¸Šçœ‹ï¼Œç±»åˆ«æ˜¯ä¸é‡å çš„ï¼šæ¯ä¸ª Unicode å­—ç¬¦æ­£å¥½å±äºä¸€ä¸ªç±»åˆ«ï¼Œæ²¡æœ‰ä¸€ä¸ªç±»åˆ«åŒ…å«å¦ä¸€ä¸ªç±»åˆ«ã€‚ç„¶è€Œï¼Œç”±äºæŸäº›ç±»åˆ«ç»„ç»å¸¸ä¸€èµ·ä½¿ç”¨ï¼Œpest åœ¨ä¸‹é¢æš´éœ²äº†ç±»åˆ«çš„å±‚æ¬¡ç»“æ„ã€‚ä¾‹å¦‚ï¼Œè§„åˆ™ CASED_LETTER åœ¨æŠ€æœ¯ä¸Šä¸æ˜¯ Unicode é€šç”¨ç±»åˆ«ï¼Œè€Œæ˜¯åŒ¹é…å±äº UPPERCASE_LETTER æˆ–LOWERCASE_LETTER çš„å­—ç¬¦ï¼Œè¿™äº›éƒ½æ˜¯é€šç”¨ç±»åˆ«ã€‚\n LETTER CASED_LETTER UPPERCASE_LETTER LOWERCASE_LETTER TITLECASE_LETTER MODIFIER_LETTER OTHER_LETTER MARK NONSPACING_MARK SPACING_MARK ENCLOSING_MARK NUMBER DECIMAL_NUMBER LETTER_NUMBER OTHER_NUMBER PUNCTUATION CONNECTOR_PUNCTUATION DASH_PUNCTUATION OPEN_PUNCTUATION CLOSE_PUNCTUATION INITIAL_PUNCTUATION FINAL_PUNCTUATION OTHER_PUNCTUATION SYMBOL MATH_SYMBOL CURRENCY_SYMBOL MODIFIER_SYMBOL OTHER_SYMBOL SEPARATOR SPACE_SEPARATOR LINE_SEPARATOR PARAGRAPH_SEPARATOR OTHER CONTROL FORMAT SURROGATE PRIVATE_USE UNASSIGNED  Binary properties è¿™äº›å±æ€§ä¸­æœ‰è®¸å¤šæ˜¯ç”¨æ¥å®šä¹‰ Unicode æ–‡æœ¬ç®—æ³•çš„ï¼Œå¦‚åŒå‘ç®—æ³•å’Œæ–‡æœ¬åˆ†å‰²ç®—æ³•ã€‚è¿™ç±»å±æ€§å¯¹äºå¤§å¤šæ•°è§£æå™¨æ¥è¯´å¯èƒ½å¹¶ä¸æœ‰ç”¨ã€‚\nä½†æ˜¯ï¼ŒXID_START å’Œ XID_CONTINUE è¿™ä¸¤ä¸ªå±æ€§ç‰¹åˆ«å€¼å¾—æ³¨æ„ï¼Œå› ä¸ºå®ƒä»¬è¢«å®šä¹‰ä¸º \u0026ldquo;ååŠ©æ ‡è¯†ç¬¦çš„æ ‡å‡†å¤„ç†\u0026rdquo;ï¼Œ\u0026ldquo;å¦‚ç¼–ç¨‹è¯­è¨€å˜é‡\u0026rdquo;ã€‚è¯¦è§æŠ€æœ¯æŠ¥å‘Š31ã€‚\n ALPHABETIC BIDI_CONTROL CASE_IGNORABLE CASED CHANGES_WHEN_CASEFOLDED CHANGES_WHEN_CASEMAPPED CHANGES_WHEN_LOWERCASED CHANGES_WHEN_TITLECASED CHANGES_WHEN_UPPERCASED DASH DEFAULT_IGNORABLE_CODE_POINT DEPRECATED DIACRITIC EXTENDER GRAPHEME_BASE GRAPHEME_EXTEND GRAPHEME_LINK HEX_DIGIT HYPHEN IDS_BINARY_OPERATOR IDS_TRINARY_OPERATOR ID_CONTINUE ID_START IDEOGRAPHIC JOIN_CONTROL LOGICAL_ORDER_EXCEPTION LOWERCASE MATH NONCHARACTER_CODE_POINT OTHER_ALPHABETIC OTHER_DEFAULT_IGNORABLE_CODE_POINT OTHER_GRAPHEME_EXTEND OTHER_ID_CONTINUE OTHER_ID_START OTHER_LOWERCASE OTHER_MATH OTHER_UPPERCASE PATTERN_SYNTAX PATTERN_WHITE_SPACE PREPENDED_CONCATENATION_MARK QUOTATION_MARK RADICAL REGIONAL_INDICATOR SENTENCE_TERMINAL SOFT_DOTTED TERMINAL_PUNCTUATION UNIFIED_IDEOGRAPH UPPERCASE VARIATION_SELECTOR WHITE_SPACE XID_CONTINUE XID_START  ä¾‹å­: JSON JSON æ˜¯ä¸€ç§æµè¡Œçš„æ•°æ®åºåˆ—åŒ–æ ¼å¼ï¼Œå®ƒæºäº JavaScript çš„è¯­æ³•ã€‚JSON æ–‡æ¡£æ˜¯æ ‘çŠ¶çš„ï¼Œå¹¶ä¸”å¯èƒ½æ˜¯é€’å½’çš„\u0026ndash;å¯¹è±¡å’Œæ•°ç»„è¿™ä¸¤ç§æ•°æ®ç±»å‹å¯ä»¥åŒ…å«å…¶ä»–å€¼ï¼ŒåŒ…æ‹¬å…¶ä»–å¯¹è±¡å’Œæ•°ç»„ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ª JSON æ–‡æ¡£çš„ä¾‹å­ã€‚\n{ \u0026#34;nesting\u0026#34;: { \u0026#34;inner object\u0026#34;: {} }, \u0026#34;an array\u0026#34;: [1.5, true, null, 1e-6], \u0026#34;string with escaped double quotes\u0026#34; : \u0026#34;\\\u0026#34;quick brown foxes\\\u0026#34;\u0026#34; } è®©æˆ‘ä»¬å†™ä¸€ä¸ªç¨‹åºï¼Œå°† JSON è§£ææˆä¸€ä¸ª Rust å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æŠ½è±¡è¯­æ³•æ ‘ï¼Œç„¶åå°† AST åºåˆ—åŒ–å› JSONã€‚\nè®¾ç½® æˆ‘ä»¬å°†ä»å®šä¹‰ Rust ä¸­çš„ AST å¼€å§‹ã€‚æ¯ä¸ª JSON æ•°æ®ç±»å‹éƒ½ç”±ä¸€ä¸ªæšä¸¾å˜ä½“æ¥è¡¨ç¤ºã€‚\nenum JSONValue\u0026lt;\u0026#39;a\u0026gt;{Object(Vec\u0026lt;(\u0026amp;\u0026#39;astr,JSONValue\u0026lt;\u0026#39;a\u0026gt;)\u0026gt;),Array(Vec\u0026lt;JSONValue\u0026lt;\u0026#39;a\u0026gt;\u0026gt;),String(\u0026amp;\u0026#39;astr),Number(f64),Boolean(bool),Null,}ä¸ºäº†é¿å…ååºåˆ—åŒ–å­—ç¬¦ä¸²æ—¶çš„å¤åˆ¶ï¼ŒJSONValue ä»åŸå§‹æœªè§£æçš„ JSON ä¸­å€Ÿç”¨å­—ç¬¦ä¸²ã€‚ä¸ºäº†ä½¿å…¶å·¥ä½œï¼Œæˆ‘ä»¬ä¸èƒ½è§£é‡Šå­—ç¬¦ä¸²è½¬ä¹‰åºåˆ—ï¼šè¾“å…¥å­—ç¬¦ä¸² \u0026ldquo;\\n\u0026rdquo; å°†ç”± JSONValue::String(\u0026quot;\\n\u0026rdquo;) è¡¨ç¤ºï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰ä¸¤ä¸ªå­—ç¬¦çš„ Rust å­—ç¬¦ä¸²ï¼Œå°½ç®¡å®ƒè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªåªæœ‰ä¸€ä¸ªå­—ç¬¦çš„ JSON å­—ç¬¦ä¸²ã€‚\nè®©æˆ‘ä»¬ç»§ç»­çœ‹åºåˆ—åŒ–å™¨ã€‚ä¸ºäº†æ¸…æ™°èµ·è§ï¼Œå®ƒä½¿ç”¨åˆ†é…çš„ Stringsï¼Œè€Œä¸æ˜¯æä¾› std::fmt::Display çš„å®ç°ï¼Œåè€…ä¼šæ›´ä¹ æƒ¯ã€‚\nfn serialize_jsonvalue(val: \u0026amp;JSONValue)-\u0026gt; String {useJSONValue::*;matchval{Object(o)=\u0026gt;{letcontents: Vec\u0026lt;_\u0026gt;=o.iter().map(|(name,value)|format!(\u0026#34;\\\u0026#34;{}\\\u0026#34;:{}\u0026#34;,name,serialize_jsonvalue(value))).collect();format!(\u0026#34;{{{}}}\u0026#34;,contents.join(\u0026#34;,\u0026#34;))}Array(a)=\u0026gt;{letcontents: Vec\u0026lt;_\u0026gt;=a.iter().map(serialize_jsonvalue).collect();format!(\u0026#34;[{}]\u0026#34;,contents.join(\u0026#34;,\u0026#34;))}String(s)=\u0026gt;format!(\u0026#34;\\\u0026#34;{}\\\u0026#34;\u0026#34;,s),Number(n)=\u0026gt;format!(\u0026#34;{}\u0026#34;,n),Boolean(b)=\u0026gt;format!(\u0026#34;{}\u0026#34;,b),Null=\u0026gt;format!(\u0026#34;null\u0026#34;),}}è¯·æ³¨æ„ï¼Œåœ¨å¯¹è±¡å’Œæ•°ç»„çš„æƒ…å†µä¸‹ï¼Œå‡½æ•°ä¼šé€’å½’åœ°è°ƒç”¨è‡ªå·±ã€‚è¿™ç§æ¨¡å¼å‡ºç°åœ¨æ•´ä¸ªè§£æå™¨ä¸­ã€‚ASTåˆ›å»ºå‡½æ•°åœ¨è§£æç»“æœä¸­é€’å½’è¿­ä»£ï¼Œè€Œè¯­æ³•çš„è§„åˆ™ä¹ŸåŒ…æ‹¬äº†è‡ªå·±ã€‚\ngrammar çš„ç¼–å†™ è®©æˆ‘ä»¬ä» whitespace å¼€å§‹ã€‚JSON ç©ºæ ¼å¯ä»¥å‡ºç°åœ¨ä»»ä½•åœ°æ–¹ï¼Œé™¤äº†å­—ç¬¦ä¸²å†…éƒ¨ï¼ˆå¿…é¡»å•ç‹¬è§£æï¼‰å’Œæ•°å­—ä¸­çš„æ•°å­—ä¹‹é—´ï¼ˆä¸å…è®¸ï¼‰ã€‚è¿™ä½¿å¾—å®ƒå¾ˆé€‚åˆ pest çš„éšå¼ç©ºç™½ã€‚åœ¨ src/json.pest:\nWHITESPACE = _{ \u0026quot; \u0026quot; | \u0026quot;\\t\u0026quot; | \u0026quot;\\r\u0026quot; | \u0026quot;\\n\u0026quot; } JSON è§„èŒƒåŒ…æ‹¬è§£æ JSON å­—ç¬¦ä¸²çš„å›¾ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥ä»è¯¥é¡µé¢å†™å‡ºè¯­æ³•ã€‚è®©æˆ‘ä»¬æŠŠ object å†™æˆä¸€ä¸ªç”¨é€—å·åˆ†éš”çš„å¯¹çš„åºåˆ—ã€‚\nobject = { \u0026quot;{\u0026quot; ~ \u0026quot;}\u0026quot; | \u0026quot;{\u0026quot; ~ pair ~ (\u0026quot;,\u0026quot; ~ pair)* ~ \u0026quot;}\u0026quot; } pair = { string ~ \u0026quot;:\u0026quot; ~ value } array = { \u0026quot;[\u0026quot; ~ \u0026quot;]\u0026quot; | \u0026quot;[\u0026quot; ~ value ~ (\u0026quot;,\u0026quot; ~ value)* ~ \u0026quot;]\u0026quot; } å¯¹è±¡å’Œæ•°ç»„è§„åˆ™å±•ç¤ºäº†å¦‚ä½•ç”¨åˆ†éš”ç¬¦è§£æä¸€ä¸ªæ½œåœ¨çš„ç©ºåˆ—è¡¨ã€‚æœ‰ä¸¤ç§æƒ…å†µï¼šä¸€ç§æ˜¯ç©ºåˆ—è¡¨ï¼Œå¦ä¸€ç§æ˜¯è‡³å°‘æœ‰ä¸€ä¸ªå…ƒç´ çš„åˆ—è¡¨ã€‚è¿™æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºæ•°ç»„ä¸­çš„é€—å·ï¼Œå¦‚ [0ï¼Œ1ï¼Œ]ï¼Œåœ¨ JSON ä¸­æ˜¯éæ³•çš„ã€‚\nç°åœ¨æˆ‘ä»¬å¯ä»¥å†™ valueï¼Œå®ƒä»£è¡¨ä»»ä½•å•ä¸€çš„æ•°æ®ç±»å‹ã€‚æˆ‘ä»¬å°†æ¨¡ä»¿æˆ‘ä»¬çš„ ASTï¼Œå°† boolean å’Œ null å†™æˆå•ç‹¬çš„è§„åˆ™ã€‚\nvalue = _{ object | array | string | number | boolean | null } boolean = { \u0026quot;true\u0026quot; | \u0026quot;false\u0026quot; } null = { \u0026quot;null\u0026quot; } è®©æˆ‘ä»¬æŠŠå­—ç¬¦ä¸²çš„é€»è¾‘åˆ†æˆä¸‰ä¸ªéƒ¨åˆ†ã€‚char æ˜¯ä¸€ä¸ªåŒ¹é…å­—ç¬¦ä¸²ä¸­ä»»ä½•é€»è¾‘å­—ç¬¦çš„è§„åˆ™ï¼ŒåŒ…æ‹¬ä»»ä½•åæ–œæ è½¬ä¹‰åºåˆ—ã€‚inner ä»£è¡¨å­—ç¬¦ä¸²çš„å†…å®¹ï¼Œä¸åŒ…æ‹¬å‘¨å›´çš„åŒå¼•å·ã€‚string åŒ¹é…å­—ç¬¦ä¸²çš„å†…éƒ¨å†…å®¹ï¼ŒåŒ…æ‹¬å‘¨å›´çš„åŒå¼•å·ã€‚\nchar è§„åˆ™ä½¿ç”¨æˆè¯­ !(...) ~ ANYï¼Œå®ƒåŒ¹é…é™¤äº†æ‹¬å·ä¸­ç»™å‡ºçš„å­—ç¬¦ä¹‹å¤–çš„ä»»ä½•å­—ç¬¦ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé™¤äº†åŒå¼•å· \u0026quot;\u0026quot; å’Œåæ–œæ  \\ ä¹‹å¤–ï¼Œä»»ä½•å­—ç¬¦åœ¨å­—ç¬¦ä¸²å†…éƒ¨éƒ½æ˜¯åˆæ³•çš„ï¼Œè¿™éœ€è¦å•ç‹¬çš„è§£æé€»è¾‘ã€‚\nstring = ${ \u0026quot;\\\u0026quot;\u0026quot; ~ inner ~ \u0026quot;\\\u0026quot;\u0026quot; } inner = @{ char* } char = { !(\u0026quot;\\\u0026quot;\u0026quot; | \u0026quot;\\\\\u0026quot;) ~ ANY | \u0026quot;\\\\\u0026quot; ~ (\u0026quot;\\\u0026quot;\u0026quot; | \u0026quot;\\\\\u0026quot; | \u0026quot;/\u0026quot; | \u0026quot;b\u0026quot; | \u0026quot;f\u0026quot; | \u0026quot;n\u0026quot; | \u0026quot;r\u0026quot; | \u0026quot;t\u0026quot;) | \u0026quot;\\\\\u0026quot; ~ (\u0026quot;u\u0026quot; ~ ASCII_HEX_DIGIT{4}) } å› ä¸º string è¢«æ ‡è®°ä¸ºå¤åŸå­ï¼Œæ‰€ä»¥ string token å¯¹ä¹Ÿä¼šåŒ…å«ä¸€ä¸ª inner å¯¹ã€‚å› ä¸º inner è¢«æ ‡è®°ä¸ºåŸå­ï¼Œæ‰€ä»¥åœ¨ inner ä¸­ä¸ä¼šå‡ºç° char å¯¹ã€‚ç”±äºè¿™äº›è§„åˆ™æ˜¯åŸå­æ€§çš„ï¼Œæ‰€ä»¥åœ¨ä¸åŒçš„æ ‡è®°ä¹‹é—´ä¸å…è®¸æœ‰ç©ºæ ¼ã€‚\næ•°å­—æœ‰å››ä¸ªé€»è¾‘éƒ¨åˆ†ï¼šä¸€ä¸ªå¯é€‰çš„ç¬¦å·ã€ä¸€ä¸ªæ•´æ•°éƒ¨åˆ†ã€ä¸€ä¸ªå¯é€‰çš„åˆ†æ•°éƒ¨åˆ†å’Œä¸€ä¸ªå¯é€‰çš„æŒ‡æ•°ã€‚æˆ‘ä»¬å°†æŠŠæ•°å­—æ ‡è®°ä¸ºåŸå­ï¼Œè¿™æ ·å®ƒçš„éƒ¨åˆ†ä¹‹é—´å°±ä¸èƒ½å‡ºç°ç©ºç™½ã€‚\nnumber = @{ \u0026quot;-\u0026quot;? ~ (\u0026quot;0\u0026quot; | ASCII_NONZERO_DIGIT ~ ASCII_DIGIT*) ~ (\u0026quot;.\u0026quot; ~ ASCII_DIGIT*)? ~ (^\u0026quot;e\u0026quot; ~ (\u0026quot;+\u0026quot; | \u0026quot;-\u0026quot;)? ~ ASCII_DIGIT+)? } æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæœ€ç»ˆè§„åˆ™æ¥è¡¨ç¤ºæ•´ä¸ª JSON æ–‡ä»¶ã€‚JSON æ–‡ä»¶çš„å”¯ä¸€åˆæ³•å†…å®¹æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–æ•°ç»„ã€‚æˆ‘ä»¬å°†æŠŠè¿™ä¸ªè§„åˆ™æ ‡è®°ä¸ºæ²‰é»˜ï¼Œè¿™æ ·ä¸€ä¸ªè§£æåçš„ JSON æ–‡ä»¶åªåŒ…å«ä¸¤ä¸ªæ ‡è®°å¯¹ï¼šè§£æåçš„å€¼æœ¬èº«ï¼Œä»¥åŠ EOI è§„åˆ™ã€‚\njson = _{ SOI ~ (object | array) ~ EOI } AST ç”Ÿæˆ è®©æˆ‘ä»¬æŠŠ grammar ç¼–è¯‘æˆ Rustã€‚\nexterncratepest;#[macro_use]externcratepest_derive;usepest::Parser;#[derive(Parser)]#[grammar = \u0026#34;json.pest\u0026#34;]struct JSONParser;æˆ‘ä»¬å°†å†™ä¸€ä¸ªåŒæ—¶å¤„ç†è§£æå’Œ AST ç”Ÿæˆçš„å‡½æ•°ã€‚è¯¥å‡½æ•°çš„ç”¨æˆ·å¯ä»¥åœ¨è¾“å…¥å­—ç¬¦ä¸²ä¸Šè°ƒç”¨å®ƒï¼Œç„¶åå°†è¿”å›çš„ç»“æœä½œä¸º JSONValue æˆ–è§£æé”™è¯¯ã€‚\nusepest::error::Error;fn parse_json_file(file: \u0026amp;str)-\u0026gt; Result\u0026lt;JSONValue,Error\u0026lt;Rule\u0026gt;\u0026gt;{letjson=JSONParser::parse(Rule::json,file)?.next().unwrap();// ... }ç°åœ¨æˆ‘ä»¬éœ€è¦æ ¹æ®è§„åˆ™ï¼Œé€’å½’å¤„ç† Pairã€‚æˆ‘ä»¬çŸ¥é“ json æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–è€…æ•°ç»„ï¼Œä½†æ˜¯è¿™äº›å€¼æœ¬èº«å¯èƒ½åŒ…å«ä¸€ä¸ªå¯¹è±¡æˆ–è€…æ•°ç»„ï¼è¿™æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦å†™ä¸€ä¸ªè¾…åŠ©é€’å½’å‡½æ•°ï¼Œç›´æ¥å°† Pair è§£ææˆ JSONValueã€‚æœ€åˆç†çš„å¤„ç†æ–¹å¼æ˜¯å†™ä¸€ä¸ªè¾…åŠ©é€’å½’å‡½æ•°ï¼Œç›´æ¥å°† Pair è§£ææˆ JSONValueã€‚\nfn parse_json_file(file: \u0026amp;str)-\u0026gt; Result\u0026lt;JSONValue,Error\u0026lt;Rule\u0026gt;\u0026gt;{// ... usepest::iterators::Pair;fn parse_value(pair: Pair\u0026lt;Rule\u0026gt;)-\u0026gt; JSONValue{matchpair.as_rule(){Rule::object=\u0026gt;JSONValue::Object(pair.into_inner().map(|pair|{letmutinner_rules=pair.into_inner();letname=inner_rules.next().unwrap().into_inner().next().unwrap().as_str();letvalue=parse_value(inner_rules.next().unwrap());(name,value)}).collect(),),Rule::array=\u0026gt;JSONValue::Array(pair.into_inner().map(parse_value).collect()),Rule::string=\u0026gt;JSONValue::String(pair.into_inner().next().unwrap().as_str()),Rule::number=\u0026gt;JSONValue::Number(pair.as_str().parse().unwrap()),Rule::boolean=\u0026gt;JSONValue::Boolean(pair.as_str().parse().unwrap()),Rule::null=\u0026gt;JSONValue::Null,Rule::json|Rule::EOI|Rule::pair|Rule::value|Rule::inner|Rule::char|Rule::WHITESPACE=\u0026gt;unreachable!(),}}// ... }å¯¹è±¡å’Œæ•°ç»„çš„æƒ…å†µå€¼å¾—ç‰¹åˆ«æ³¨æ„ã€‚æ•°ç»„ä»¤ç‰Œå¯¹çš„å†…å®¹åªæ˜¯ä¸€ä¸ªå€¼çš„åºåˆ—ã€‚ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Rust è¿­ä»£å™¨ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°å°†æ¯ä¸ªå€¼é€’å½’åœ°æ˜ å°„åˆ°å®ƒçš„è§£æ AST èŠ‚ç‚¹ï¼Œç„¶åå°†å®ƒä»¬æ”¶é›†åˆ°ä¸€ä¸ª Vec ä¸­ã€‚å¯¹äºå¯¹è±¡ï¼Œè¿‡ç¨‹æ˜¯ç±»ä¼¼çš„ï¼Œé™¤äº†è¿­ä»£å™¨æ˜¯åœ¨å¯¹ä¸Šï¼Œæˆ‘ä»¬éœ€è¦åˆ†åˆ«ä»å¯¹ä¸Šæå–åç§°å’Œå€¼ã€‚\næ•°å­—å’Œå¸ƒå°”çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ Rust çš„ str::parse æ–¹æ³•å°†è§£æåçš„å­—ç¬¦ä¸²è½¬æ¢ä¸ºç›¸åº”çš„ Rust ç±»å‹ã€‚æ¯ä¸€ä¸ªåˆæ³•çš„ JSON æ•°å­—éƒ½å¯ä»¥ç›´æ¥è§£ææˆä¸€ä¸ª Rust æµ®ç‚¹æ•°ï¼æˆ‘ä»¬åœ¨ Rust çš„ str::parse æ–¹æ³•ä¸Šè¿è¡Œ parse_valueã€‚\næˆ‘ä»¬å¯¹è§£æç»“æœè¿è¡Œ parse_value æ¥å®Œæˆè½¬æ¢ã€‚\nfn parse_json_file(file: \u0026amp;str)-\u0026gt; Result\u0026lt;JSONValue,Error\u0026lt;Rule\u0026gt;\u0026gt;{// ... Ok(parse_value(json))}ç²¾åŠ å·¥ æˆ‘ä»¬çš„ä¸»è¦åŠŸèƒ½ç°åœ¨éå¸¸ç®€å•ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä»ä¸€ä¸ªåä¸º data.json çš„æ–‡ä»¶ä¸­è¯»å– JSON æ•°æ®ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ–‡ä»¶å†…å®¹è§£ææˆä¸€ä¸ª JSON ASTã€‚æœ€åï¼Œæˆ‘ä»¬å°† AST åºåˆ—åŒ–å›ä¸€ä¸ªå­—ç¬¦ä¸²å¹¶æ‰“å°å‡ºæ¥ã€‚\nusestd::fs;fn main(){letunparsed_file=fs::read_to_string(\u0026#34;data.json\u0026#34;).expect(\u0026#34;cannot read file\u0026#34;);letjson: JSONValue=parse_json_file(\u0026amp;unparsed_file).expect(\u0026#34;unsuccessful parse\u0026#34;);println!(\u0026#34;{}\u0026#34;,serialize_jsonvalue(\u0026amp;json));}è¯•è¯•å§! å°†æœ¬ç« é¡¶éƒ¨çš„ç¤ºä¾‹æ–‡æ¡£å¤åˆ¶åˆ° data.json ä¸­ï¼Œç„¶åè¿è¡Œç¨‹åº! ä½ åº”è¯¥çœ‹åˆ°è¿™æ ·çš„ä¸œè¥¿ã€‚\n$ cargo run [ ... ] {\u0026quot;nesting\u0026quot;:{\u0026quot;inner object\u0026quot;:{}},\u0026quot;an array\u0026quot;:[1.5,true,null,0.000001],\u0026quot;string with escaped double quotes\u0026quot;:\u0026quot;\\\u0026quot;quick brown foxes\\\u0026quot;\u0026quot;} ä¾‹å­: J è¯­è¨€ J è¯­è¨€æ˜¯ä¸€ç§å— APL å½±å“çš„æ•°ç»„ç¼–ç¨‹è¯­è¨€ã€‚åœ¨ J è¯­è¨€ä¸­ï¼Œå¯¹å•ä¸ªæ•°å­—(2*3)çš„æ“ä½œå¯ä»¥å¾ˆå®¹æ˜“åœ°åº”ç”¨äºæ•´ä¸ªæ•°å­—åˆ—è¡¨(2*3 4 5ï¼Œè¿”å› 6 8 10)ã€‚\nJ ä¸­çš„æ“ä½œç¬¦è¢«ç§°ä¸ºåŠ¨è¯ã€‚åŠ¨è¯è¦ä¹ˆæ˜¯ä¸€å…ƒçš„ï¼ˆå–ä¸€ä¸ªå‚æ•°ï¼Œå¦‚ *: 3ï¼Œ\u0026ldquo;3 çš„å¹³æ–¹\u0026rdquo;ï¼‰ï¼Œè¦ä¹ˆæ˜¯äºŒå…ƒçš„ï¼ˆå–ä¸¤ä¸ªå‚æ•°ï¼Œä¸¤è¾¹å„ä¸€ä¸ªï¼Œå¦‚ 5 - 4ï¼Œ\u0026ldquo;5å‡4\u0026rdquo;ï¼‰ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ª J ç¨‹åºçš„ä¾‹å­ã€‚\n\u0026#39;A string\u0026#39; *: 1 2 3 4 matrix =: 2 3 $ 5 + 2 3 4 5 6 7 10 * matrix 1 + 10 20 30 1 2 3 + 10 residues =: 2 | 0 1 2 3 4 5 6 7 residues ä½¿ç”¨ J çš„è§£é‡Šå™¨è¿è¡Œä¸Šè¿°ç¨‹åºï¼Œåœ¨æ ‡å‡†è¾“å‡ºä¸Šå¾—åˆ°å¦‚ä¸‹ç»“æœã€‚\nA string 1 4 9 16 70 80 90 100 110 120 11 21 31 11 12 13 0 1 0 1 0 1 0 1 åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä¸º J çš„ä¸€ä¸ªå­é›†å†™ä¸€ä¸ª grammarï¼Œç„¶åæˆ‘ä»¬å°†é€šè¿‡ä¸€ä¸ªè§£æå™¨ï¼Œé€šè¿‡è¿­ä»£ pest ç»™æˆ‘ä»¬çš„è§„åˆ™æ¥å»ºç«‹ä¸€ä¸ª ASTã€‚ä½ å¯ä»¥åœ¨æœ¬ä¹¦çš„èµ„æºåº“ä¸­æ‰¾åˆ°å®Œæ•´çš„æºä»£ç ã€‚\nGrammar æˆ‘ä»¬å°†ä»ç¨‹åºè§„åˆ™å¼€å§‹ï¼Œé€èŠ‚å»ºç«‹ grammarã€‚\nprogram = _{ SOI ~ \u0026quot;\\n\u0026quot;* ~ (stmt ~ \u0026quot;\\n\u0026quot;+) * ~ stmt? ~ EOI } æ¯ä¸ª J ç¨‹åºéƒ½åŒ…å«ç”±ä¸€ä¸ªæˆ–å¤šä¸ªæ¢è¡Œç¬¦åˆ†éš”çš„è¯­å¥ã€‚è¯·æ³¨æ„å‰é¢çš„ä¸‹åˆ’çº¿ï¼Œå®ƒå‘Šè¯‰ pest å±è”½ program è§„åˆ™ - æˆ‘ä»¬ä¸æƒ³è®© program ä½œä¸ºä¸€ä¸ª token å‡ºç°åœ¨è§£ææµä¸­ï¼Œæˆ‘ä»¬æƒ³è¦çš„æ˜¯åº•å±‚è¯­å¥ã€‚\nè¯­å¥å°±æ˜¯ä¸€ä¸ªç®€å•çš„è¡¨è¾¾å¼ï¼Œç”±äºåªæœ‰ä¸€ç§è¿™æ ·çš„å¯èƒ½æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå°†è¿™ä¸ª stmt è§„åˆ™å±è”½ï¼Œè¿™æ ·æˆ‘ä»¬çš„è§£æå™¨å°±ä¼šæ”¶åˆ°ä¸€ä¸ªåº•å±‚ expr çš„è¿­ä»£å™¨ã€‚\nstmt = _{ expr } è¡¨è¾¾å¼å¯ä»¥æ˜¯å¯¹å˜é‡æ ‡è¯†ç¬¦çš„èµ‹å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¯å•é¡¹è¡¨è¾¾å¼ã€å¯¹å¶è¡¨è¾¾å¼ã€å•ä¸ªå­—ç¬¦ä¸²æˆ–æœ¯è¯­æ•°ç»„ã€‚\nexpr = { assgmtExpr | monadicExpr | dyadicExpr | string | terms } ä¸€å…ƒè¡¨è¾¾å¼ç”±ä¸€ä¸ªåŠ¨è¯ç»„æˆï¼Œå…¶å”¯ä¸€çš„æ“ä½œæ•°åœ¨å³è¾¹ï¼›ä¸‰å…ƒè¡¨è¾¾å¼çš„æ“ä½œæ•°åœ¨åŠ¨è¯çš„ä¸¤è¾¹ã€‚èµ‹å€¼è¡¨è¾¾å¼å°†æ ‡è¯†ç¬¦ä¸è¡¨è¾¾å¼ç›¸å…³è”ã€‚\nåœ¨ J ä¸­ï¼Œæ²¡æœ‰æ“ä½œç¬¦çš„ä¼˜å…ˆæ€§ - æ±‚å€¼æ˜¯å³è”çš„ï¼ˆä»å³åˆ°å·¦ï¼‰ï¼Œæ‹¬å·å†…çš„è¡¨è¾¾å¼å…ˆè¢«æ±‚å€¼ã€‚\nmonadicExpr = { verb ~ expr } dyadicExpr = { (monadicExpr | terms) ~ verb ~ expr } assgmtExpr = { ident ~ \u0026quot;=:\u0026quot; ~ expr } é¡¹çš„åˆ—è¡¨åº”è¯¥è‡³å°‘åŒ…å«ä¸€ä¸ªåè¿›åˆ¶ã€æ•´æ•°ã€æ ‡è¯†ç¬¦æˆ–å°æ‹¬å·è¡¨è¾¾å¼ï¼›æˆ‘ä»¬åªå…³å¿ƒè¿™äº›åŸºç¡€å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨å‰å¯¼ä¸‹åˆ’çº¿å±è”½ term è§„åˆ™ã€‚\nterms = { term+ } term = _{ decimal | integer | ident | \u0026quot;(\u0026quot; ~ expr ~ \u0026quot;)\u0026quot; } J çš„å‡ ä¸ªåŠ¨è¯åœ¨è¿™ä¸ª grammar ä¸­æ˜¯æœ‰å®šä¹‰çš„ï¼ŒJ çš„å…¨éƒ¨è¯æ±‡è¦å¹¿æ³›å¾—å¤šã€‚\nverb = { \u0026quot;\u0026gt;:\u0026quot; | \u0026quot;*:\u0026quot; | \u0026quot;-\u0026quot; | \u0026quot;%\u0026quot; | \u0026quot;#\u0026quot; | \u0026quot;\u0026gt;.\u0026quot; | \u0026quot;+\u0026quot; | \u0026quot;*\u0026quot; | \u0026quot;\u0026lt;\u0026quot; | \u0026quot;=\u0026quot; | \u0026quot;^\u0026quot; | \u0026quot;|\u0026quot; | \u0026quot;\u0026gt;\u0026quot; | \u0026quot;$\u0026quot; } ç°åœ¨æˆ‘ä»¬å¯ä»¥è¿›å…¥è¯æ³•è§„åˆ™äº†ã€‚J ä¸­çš„æ•°å­—å’Œå¹³å¸¸ä¸€æ ·ï¼Œé™¤äº†è´Ÿæ•°ç”¨å‰å¯¼çš„ _ ä¸‹åˆ’çº¿è¡¨ç¤ºå¤–ï¼ˆå› ä¸º - æ˜¯ä¸€ä¸ªåŠ¨è¯ï¼Œå®ƒä½œä¸ºå•é¡¹å¼æ‰§è¡Œå¦å®šï¼Œä½œä¸ºå¯¹å¶å¼æ‰§è¡Œå‡æ³•ï¼‰ã€‚J ä¸­çš„æ ‡è¯†ç¬¦å¿…é¡»ä»¥å­—æ¯å¼€å¤´ï¼Œä½†ä¹‹åå¯ä»¥åŒ…å«æ•°å­—ã€‚å­—ç¬¦ä¸²ç”±å•å¼•å·åŒ…å›´ï¼›å¼•å·æœ¬èº«å¯ä»¥é€šè¿‡ç”¨é™„åŠ å¼•å·è½¬ä¹‰æ¥åµŒå…¥ã€‚\nè¯·æ³¨æ„æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨ pest çš„ @ ä¿®é¥°ç¬¦ä½¿è¿™äº›è§„åˆ™ä¸­çš„æ¯ä¸€æ¡éƒ½æ˜¯åŸå­çš„ï¼Œè¿™æ„å‘³ç€éšå¼ç©ºç™½æ˜¯è¢«ç¦æ­¢çš„ï¼Œè€Œä¸”å†…éƒ¨è§„åˆ™ï¼ˆå³ ident ä¸­çš„ ASCII_ALPHAï¼‰å˜ä¸º silent - å½“æˆ‘ä»¬çš„è§£æå™¨æ¥æ”¶åˆ°è¿™äº› token æ—¶ï¼Œå®ƒä»¬å°†æ˜¯ç»ˆç«¯çš„ã€‚\ninteger = @{ \u0026quot;_\u0026quot;? ~ ASCII_DIGIT+ } decimal = @{ \u0026quot;_\u0026quot;? ~ ASCII_DIGIT+ ~ \u0026quot;.\u0026quot; ~ ASCII_DIGIT* } ident = @{ ASCII_ALPHA ~ (ASCII_ALPHANUMERIC | \u0026quot;_\u0026quot;)* } string = @{ \u0026quot;'\u0026quot; ~ ( \u0026quot;''\u0026quot; | (!\u0026quot;'\u0026quot; ~ ANY) )* ~ \u0026quot;'\u0026quot; } J ä¸­çš„ç©ºç™½åªç”±ç©ºæ ¼å’Œåˆ¶è¡¨ç¬¦ç»„æˆã€‚æ¢è¡Œçš„æ„ä¹‰åœ¨äºå®ƒä»¬æ˜¯å¯¹è¯­å¥çš„å®šç•Œï¼Œå› æ­¤å®ƒä»¬ä¸åœ¨æœ¬è§„åˆ™ä¹‹å†…ã€‚\nWHITESPACE = _{ \u0026quot; \u0026quot; | \u0026quot;\\t\u0026quot; } æœ€åï¼Œæˆ‘ä»¬å¿…é¡»å¤„ç†æ³¨é‡Šã€‚J ä¸­çš„æ³¨é‡Šä»¥ NB. å¼€å§‹ï¼Œä¸€ç›´åˆ°å®ƒä»¬æ‰€åœ¨è¡Œçš„æœ«å°¾ã€‚å…³é”®çš„æ˜¯ï¼Œæˆ‘ä»¬å†³ä¸èƒ½æ¶ˆè€—æ³¨é‡Šè¡Œæœ«çš„æ¢è¡Œï¼›è¿™æ˜¯ä¸ºäº†å°†æ³¨é‡Šä¹‹å‰çš„ä»»ä½•è¯­å¥ä¸åç»­è¡Œçš„è¯­å¥åˆ†å¼€ã€‚\nCOMMENT = _{ \u0026quot;NB.\u0026quot; ~ (!\u0026quot;\\n\u0026quot; ~ ANY)* } è§£æå’Œ AST ç”Ÿæˆ æœ¬èŠ‚å°†ä»‹ç»ä¸€ä¸ªä½¿ç”¨ä¸Šè¿° grammar çš„è§£æå™¨ã€‚è¿™é‡Œçœç•¥äº†åº“ä¸­çš„å†…å®¹å’Œè‡ªæ˜çš„ä»£ç ï¼Œä½ å¯ä»¥åœ¨æœ¬ä¹¦çš„èµ„æºåº“ä¸­æ‰¾åˆ°è§£æå™¨çš„å…¨éƒ¨å†…å®¹ã€‚\né¦–å…ˆæˆ‘ä»¬å°†æšä¸¾æˆ‘ä»¬ grammar ä¸­å®šä¹‰çš„åŠ¨è¯ï¼ŒåŒºåˆ†ä¸€å…ƒåŠ¨è¯å’ŒäºŒå…ƒåŠ¨è¯ã€‚è¿™äº›æšä¸¾å°†åœ¨æˆ‘ä»¬çš„ AST ä¸­ä½œä¸ºæ ‡ç­¾ä½¿ç”¨ã€‚\npubenum MonadicVerb{Increment,Square,Negate,Reciprocal,Tally,Ceiling,ShapeOf,}pubenum DyadicVerb{Plus,Times,LessThan,LargerThan,Equal,Minus,Divide,Power,Residue,Copy,LargerOf,LargerOrEqual,Shape,}é‚£ä¹ˆæˆ‘ä»¬å°±æ¥åˆ—ä¸¾ä¸€ä¸‹ AST çš„å„ç±»èŠ‚ç‚¹ã€‚\npubenum AstNode{Print(Box\u0026lt;AstNode\u0026gt;),Integer(i32),DoublePrecisionFloat(f64),MonadicOp{verb: MonadicVerb,expr: Box\u0026lt;AstNode\u0026gt;,},DyadicOp{verb: DyadicVerb,lhs: Box\u0026lt;AstNode\u0026gt;,rhs: Box\u0026lt;AstNode\u0026gt;,},Terms(Vec\u0026lt;AstNode\u0026gt;),IsGlobal{ident: String,expr: Box\u0026lt;AstNode\u0026gt;,},Ident(String),Str(CString),}ä¸ºäº†è§£æ J ç¨‹åºä¸­çš„é¡¶å±‚è¯­å¥ï¼Œæˆ‘ä»¬æœ‰ä¸‹é¢çš„ parse å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²å½¢å¼çš„ J ç¨‹åºï¼Œå¹¶å°†å…¶ä¼ é€’ç»™ pest è¿›è¡Œè§£æã€‚æˆ‘ä»¬å¾—åˆ°ä¸€ä¸ª Pair çš„åºåˆ—ã€‚æ­£å¦‚ grammar ä¸­æ‰€è§„å®šçš„é‚£æ ·ï¼Œä¸€ä¸ªè¯­å¥åªèƒ½ç”±ä¸€ä¸ªè¡¨è¾¾å¼ç»„æˆï¼Œæ‰€ä»¥ä¸‹é¢çš„åŒ¹é…ä¼šè§£æè¿™äº›é¡¶å±‚è¡¨è¾¾å¼ä¸­çš„æ¯ä¸€ä¸ªï¼Œå¹¶å°†å®ƒä»¬åŒ…è£…åœ¨ä¸€ä¸ª Print AST èŠ‚ç‚¹ä¸­ï¼Œä»¥ç¬¦åˆ J è§£é‡Šå™¨çš„ REPL è¡Œä¸ºã€‚\npubfn parse(source: \u0026amp;str)-\u0026gt; Result\u0026lt;Vec\u0026lt;AstNode\u0026gt;,Error\u0026lt;Rule\u0026gt;\u0026gt;{letmutast=vec![];letpairs=JParser::parse(Rule::program,source)?;forpairinpairs{matchpair.as_rule(){Rule::expr=\u0026gt;{ast.push(Print(Box::new(build_ast_from_expr(pair))));}_=\u0026gt;{}}}Ok(ast)}AST èŠ‚ç‚¹æ˜¯é€šè¿‡éå† Pair è¿­ä»£å™¨ï¼ŒæŒ‰ç…§æˆ‘ä»¬ grammar æ–‡ä»¶ä¸­è®¾å®šçš„æœŸæœ›å€¼ï¼Œä»è¡¨è¾¾å¼ä¸­æ„å»ºå‡ºæ¥çš„ã€‚å¸¸è§çš„è¡Œä¸ºè¢«æŠ½è±¡å‡ºå•ç‹¬çš„å‡½æ•°ï¼Œå¦‚ parse_monadic_verb å’Œ parse_dyadic_verbï¼Œä»£è¡¨è¡¨è¾¾å¼æœ¬èº«çš„ Pair åˆ™åœ¨é€’å½’è°ƒç”¨ build_ast_from_expr ä¸­ä¼ é€’ã€‚\nfn build_ast_from_expr(pair: pest::iterators::Pair\u0026lt;Rule\u0026gt;)-\u0026gt; AstNode{matchpair.as_rule(){Rule::expr=\u0026gt;build_ast_from_expr(pair.into_inner().next().unwrap()),Rule::monadicExpr=\u0026gt;{letmutpair=pair.into_inner();letverb=pair.next().unwrap();letexpr=pair.next().unwrap();letexpr=build_ast_from_expr(expr);parse_monadic_verb(verb,expr)}// ... other cases elided here ... }}äºŒå…ƒåŠ¨è¯ä»å®ƒä»¬çš„å­—ç¬¦ä¸²è¡¨ç¤ºæ–¹å¼ç›´æ¥æ˜ å°„åˆ° AST èŠ‚ç‚¹ã€‚\nfn parse_dyadic_verb(pair: pest::iterators::Pair\u0026lt;Rule\u0026gt;,lhs: AstNode,rhs: AstNode)-\u0026gt; AstNode{AstNode::DyadicOp{lhs: Box::new(lhs),rhs: Box::new(rhs),verb: matchpair.as_str(){\u0026#34;+\u0026#34;=\u0026gt;DyadicVerb::Plus,\u0026#34;*\u0026#34;=\u0026gt;DyadicVerb::Times,\u0026#34;-\u0026#34;=\u0026gt;DyadicVerb::Minus,\u0026#34;\u0026lt;\u0026#34;=\u0026gt;DyadicVerb::LessThan,\u0026#34;=\u0026#34;=\u0026gt;DyadicVerb::Equal,\u0026#34;\u0026gt;\u0026#34;=\u0026gt;DyadicVerb::LargerThan,\u0026#34;%\u0026#34;=\u0026gt;DyadicVerb::Divide,\u0026#34;^\u0026#34;=\u0026gt;DyadicVerb::Power,\u0026#34;|\u0026#34;=\u0026gt;DyadicVerb::Residue,\u0026#34;#\u0026#34;=\u0026gt;DyadicVerb::Copy,\u0026#34;\u0026gt;.\u0026#34;=\u0026gt;DyadicVerb::LargerOf,\u0026#34;\u0026gt;:\u0026#34;=\u0026gt;DyadicVerb::LargerOrEqual,\u0026#34;$\u0026#34;=\u0026gt;DyadicVerb::Shape,_=\u0026gt;panic!(\u0026#34;Unexpected dyadic verb: {}\u0026#34;,pair.as_str()),},}}å¦‚åŒä¸€å…ƒåŠ¨è¯ä¸€æ ·ã€‚\nfn parse_monadic_verb(pair: pest::iterators::Pair\u0026lt;Rule\u0026gt;,expr: AstNode)-\u0026gt; AstNode{AstNode::MonadicOp{verb: matchpair.as_str(){\u0026#34;\u0026gt;:\u0026#34;=\u0026gt;MonadicVerb::Increment,\u0026#34;*:\u0026#34;=\u0026gt;MonadicVerb::Square,\u0026#34;-\u0026#34;=\u0026gt;MonadicVerb::Negate,\u0026#34;%\u0026#34;=\u0026gt;MonadicVerb::Reciprocal,\u0026#34;#\u0026#34;=\u0026gt;MonadicVerb::Tally,\u0026#34;\u0026gt;.\u0026#34;=\u0026gt;MonadicVerb::Ceiling,\u0026#34;$\u0026#34;=\u0026gt;MonadicVerb::ShapeOf,_=\u0026gt;panic!(\u0026#34;Unsupported monadic verb: {}\u0026#34;,pair.as_str()),},expr: Box::new(expr),}}æœ€åï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°æ¥å¤„ç†æ•°å­—å’Œå­—ç¬¦ä¸²ç­‰é¡¹ã€‚æ•°å­—éœ€è¦ä¸€äº›æ“ä½œæ¥å¤„ç† J çš„å‰å¯¼ä¸‹åˆ’çº¿ï¼Œè¡¨ç¤ºå¦å®šï¼Œä½†é™¤æ­¤ä¹‹å¤–ï¼Œå¤„ç†è¿‡ç¨‹æ˜¯å…¸å‹çš„ã€‚\nfn build_ast_from_term(pair: pest::iterators::Pair\u0026lt;Rule\u0026gt;)-\u0026gt; AstNode{matchpair.as_rule(){Rule::integer=\u0026gt;{letistr=pair.as_str();let(sign,istr)=match\u0026amp;istr[..1]{\u0026#34;_\u0026#34;=\u0026gt;(-1,\u0026amp;istr[1..]),_=\u0026gt;(1,\u0026amp;istr[..]),};letinteger: i32 =istr.parse().unwrap();AstNode::Integer(sign*integer)}Rule::decimal=\u0026gt;{letdstr=pair.as_str();let(sign,dstr)=match\u0026amp;dstr[..1]{\u0026#34;_\u0026#34;=\u0026gt;(-1.0,\u0026amp;dstr[1..]),_=\u0026gt;(1.0,\u0026amp;dstr[..]),};letmutflt: f64 =dstr.parse().unwrap();ifflt!=0.0{// Avoid negative zeroes; only multiply sign by nonzeroes. flt*=sign;}AstNode::DoublePrecisionFloat(flt)}Rule::expr=\u0026gt;build_ast_from_expr(pair),Rule::ident=\u0026gt;AstNode::Ident(String::from(pair.as_str())),unknown_term=\u0026gt;panic!(\u0026#34;Unexpected term: {:?}\u0026#34;,unknown_term),}}è¿è¡Œè§£æå™¨ ç°åœ¨æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ª main å‡½æ•°ï¼Œå°† J ç¨‹åºä¼ é€’ç»™æˆ‘ä»¬çš„ pest-enabled è§£æå™¨ã€‚\nfn main(){letunparsed_file=std::fs::read_to_string(\u0026#34;example.ijs\u0026#34;).expect(\u0026#34;cannot read ijs file\u0026#34;);letastnode=parse(\u0026amp;unparsed_file).expect(\u0026#34;unsuccessful parse\u0026#34;);println!(\u0026#34;{:?}\u0026#34;,\u0026amp;astnode);}åœ¨ example.ijs ä¸­ä½¿ç”¨è¿™æ®µä»£ç ã€‚\n_2.5 ^ 3 *: 4.8 title =: 'Spinning at the Boundary' *: _1 2 _3 4 1 2 3 + 10 20 30 1 + 10 20 30 1 2 3 + 10 2 | 0 1 2 3 4 5 6 7 another =: 'It''s Escaped' 3 | 0 1 2 3 4 5 6 7 (2+1)*(2+2) 3 * 2 + 1 1 + 3 % 4 x =: 100 x - 1 y =: x - 1 y å½“æˆ‘ä»¬è¿è¡Œè§£æå™¨æ—¶ï¼Œæˆ‘ä»¬ä¼šåœ¨æ ‡å‡†è¾“å‡ºä¸Šå¾—åˆ°ä»¥ä¸‹æŠ½è±¡è¯­æ³•æ ‘ã€‚\n$ cargo run [ ... ] [Print(DyadicOp { verb: Power, lhs: DoublePrecisionFloat(-2.5), rhs: Integer(3) }), Print(MonadicOp { verb: Square, expr: DoublePrecisionFloat(4.8) }), Print(IsGlobal { ident: \u0026quot;title\u0026quot;, expr: Str(\u0026quot;Spinning at the Boundary\u0026quot;) }), Print(MonadicOp { verb: Square, expr: Terms([Integer(-1), Integer(2), Integer(-3), Integer(4)]) }), Print(DyadicOp { verb: Plus, lhs: Terms([Integer(1), Integer(2), Integer(3)]), rhs: Terms([Integer(10), Integer(20), Integer(30)]) }), Print(DyadicOp { verb: Plus, lhs: Integer(1), rhs: Terms([Integer(10), Integer(20), Integer(30)]) }), Print(DyadicOp { verb: Plus, lhs: Terms([Integer(1), Integer(2), Integer(3)]), rhs: Integer(10) }), Print(DyadicOp { verb: Residue, lhs: Integer(2), rhs: Terms([Integer(0), Integer(1), Integer(2), Integer(3), Integer(4), Integer(5), Integer(6), Integer(7)]) }), Print(IsGlobal { ident: \u0026quot;another\u0026quot;, expr: Str(\u0026quot;It\\'s Escaped\u0026quot;) }), Print(DyadicOp { verb: Residue, lhs: Integer(3), rhs: Terms([Integer(0), Integer(1), Integer(2), Integer(3), Integer(4), Integer(5), Integer(6), Integer(7)]) }), Print(DyadicOp { verb: Times, lhs: DyadicOp { verb: Plus, lhs: Integer(2), rhs: Integer(1) }, rhs: DyadicOp { verb: Plus, lhs: Integer(2), rhs: Integer(2) } }), Print(DyadicOp { verb: Times, lhs: Integer(3), rhs: DyadicOp { verb: Plus, lhs: Integer(2), rhs: Integer(1) } }), Print(DyadicOp { verb: Plus, lhs: Integer(1), rhs: DyadicOp { verb: Divide, lhs: Integer(3), rhs: Integer(4) } }), Print(IsGlobal { ident: \u0026quot;x\u0026quot;, expr: Integer(100) }), Print(DyadicOp { verb: Minus, lhs: Ident(\u0026quot;x\u0026quot;), rhs: Integer(1) }), Print(IsGlobal { ident: \u0026quot;y\u0026quot;, expr: DyadicOp { verb: Minus, lhs: Ident(\u0026quot;x\u0026quot;), rhs: Integer(1) } }), Print(Ident(\u0026quot;y\u0026quot;))] ","permalink":"https://ohmyweekly.github.io/notes/2021-01-20-pest-grammars/","tags":["Rust","Rust Grammar"],"title":"Pest Grammars"},{"categories":["Rust"],"contents":"ä¾‹å­: INI INI(initialization çš„ç®€ç§°)æ–‡ä»¶æ˜¯ç®€å•çš„é…ç½®æ–‡ä»¶ã€‚ç”±äºæ²¡æœ‰æ ‡å‡†çš„æ ¼å¼ï¼Œæˆ‘ä»¬å°†ç¼–å†™ä¸€ä¸ªèƒ½å¤Ÿè§£æè¿™ä¸ªä¾‹å­æ–‡ä»¶çš„ç¨‹åºã€‚\nusername = noha password = plain_text salt = NaCl [server_1] interface=eth0 ip=127.0.0.1 document_root=/var/www/example.org [empty_section] [second_server] document_root=/var/www/example.com ip= interface=eth1 æ¯ä¸€è¡Œéƒ½åŒ…å«ä¸€ä¸ªé”®å’Œå€¼ï¼Œä¸­é—´ç”¨ç­‰å·éš”å¼€ï¼›æˆ–è€…åŒ…å«ä¸€ä¸ªç”¨æ–¹æ‹¬å·æ‹¬èµ·æ¥çš„ç« èŠ‚åï¼›æˆ–è€…æ˜¯ç©ºç™½ï¼Œæ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚\næ¯å½“å‡ºç°ä¸€ä¸ªèŠ‚åï¼Œä¸‹é¢çš„é”®å’Œå€¼å°±å±äºè¯¥èŠ‚ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ªèŠ‚åã€‚æ–‡ä»¶å¼€å¤´çš„é”®å€¼å¯¹å±äºä¸€ä¸ªéšå¼çš„ \u0026ldquo;ç©º\u0026quot;èŠ‚ã€‚\nç¼–å†™ grammar é¦–å…ˆä½¿ç”¨ Cargo åˆå§‹åŒ–ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œæ·»åŠ ä¾èµ–å…³ç³» pest = \u0026quot;2.0\u0026quot; å’Œ pest_derive = \u0026quot;2.0\u0026quot;ã€‚åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ src/ini.pest æ¥ä¿å­˜ grammarã€‚\næˆ‘ä»¬æ–‡ä»¶ä¸­æ„Ÿå…´è¶£çš„æ–‡æœ¬ - usernameã€/var/www/example.org ç­‰ - åªç”±å‡ ä¸ªå­—ç¬¦ç»„æˆã€‚è®©æˆ‘ä»¬åˆ¶å®šä¸€ä¸ªè§„åˆ™æ¥è¯†åˆ«è¯¥é›†åˆä¸­çš„å•ä¸ªå­—ç¬¦ã€‚å†…ç½®çš„è§„åˆ™ ASCII_ALPHANUMERIC æ˜¯è¡¨ç¤ºä»»ä½•å¤§å†™æˆ–å°å†™ ASCII å­—æ¯æˆ–ä»»ä½•æ•°å­—çš„å¿«æ·æ–¹å¼ã€‚\nchar = { ASCII_ALPHANUMERIC | \u0026quot;.\u0026quot; | \u0026quot;_\u0026quot; | \u0026quot;/\u0026quot; } èŠ‚åå’Œå±æ€§é”®ä¸èƒ½ä¸ºç©ºï¼Œä½†å±æ€§å€¼å¯ä»¥ä¸ºç©ºï¼ˆå¦‚ä¸Šæ–‡ä¸­çš„ ip= è¡Œï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå‰è€…ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ç»„æˆï¼Œchar+; åè€…ç”±é›¶æˆ–å¤šä¸ªå­—ç¬¦ç»„æˆï¼Œchar*ã€‚æˆ‘ä»¬å°†å…¶å«ä¹‰åˆ†ä¸ºä¸¤æ¡è§„åˆ™ã€‚\nname = { char+ } value = { char* } ç°åœ¨å¾ˆå®¹æ˜“è¡¨è¾¾è¿™ä¸¤ç§è¾“å…¥è¡Œã€‚\nsection = { \u0026quot;[\u0026quot; ~ name ~ \u0026quot;]\u0026quot; } property = { name ~ \u0026quot;=\u0026quot; ~ value } æœ€åï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè§„åˆ™æ¥è¡¨ç¤ºæ•´ä¸ªè¾“å…¥æ–‡ä»¶ã€‚è¡¨è¾¾å¼ (section | property)? åŒ¹é… sectionã€propertyï¼Œå¦åˆ™ä»€ä¹ˆä¹Ÿä¸åŒ¹é…ã€‚ä½¿ç”¨å†…ç½®è§„åˆ™ NEWLINE æ¥åŒ¹é…è¡Œå°¾ã€‚\nfile = { SOI ~ ((section | property)? ~ NEWLINE)* ~ EOI } è¦å°†è§£æå™¨ç¼–è¯‘æˆ Rustï¼Œæˆ‘ä»¬éœ€è¦åœ¨ src/main.rs ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ã€‚\nexterncratepest;#[macro_use]externcratepest_derive;usepest::Parser;#[derive(Parser)]#[grammar = \u0026#34;ini.pest\u0026#34;]pubstruct INIParser;ç¨‹åºåˆå§‹åŒ– ç°åœ¨æˆ‘ä»¬å¯ä»¥è¯»å–æ–‡ä»¶ï¼Œå¹¶ç”¨ pest è¿›è¡Œè§£æã€‚\nusestd::collections::HashMap;usestd::fs;fn main(){letunparsed_file=fs::read_to_string(\u0026#34;config.ini\u0026#34;).expect(\u0026#34;cannot read file\u0026#34;);letfile=INIParser::parse(Rule::file,\u0026amp;unparsed_file).expect(\u0026#34;unsuccessful parse\u0026#34;)// unwrap the parse result .next().unwrap();// get and unwrap the `file` rule; never fails // ... }æˆ‘ä»¬å°†ä½¿ç”¨åµŒå¥—çš„ HashMap æ¥è¡¨è¾¾å±æ€§åˆ—è¡¨ã€‚å¤–å±‚å“ˆå¸Œ map å°†ä»¥ç« èŠ‚åç§°ä½œä¸ºé”®ï¼Œä»¥ç« èŠ‚å†…å®¹ï¼ˆå†…éƒ¨å“ˆå¸Œ mapï¼‰ä½œä¸ºå€¼ã€‚æ¯ä¸ªå†…éƒ¨å“ˆå¸Œ map å°†æœ‰å±æ€§é”®å’Œå±æ€§å€¼ã€‚ä¾‹å¦‚ï¼Œè¦è®¿é—® server_1 çš„ document_rootï¼Œæˆ‘ä»¬å¯ä»¥å†™ properties[\u0026quot;server_1\u0026quot;][\u0026quot;document_root\u0026quot;]ã€‚éšå«çš„ \u0026ldquo;ç©º\u0026quot;èŠ‚å°†ç”±å¸¸è§„éƒ¨åˆ†è¡¨ç¤ºï¼Œåç§°ä¸ºç©ºå­—ç¬¦ä¸² \u0026quot;\u0026quot;ï¼Œè¿™æ · properties[\u0026quot;\u0026quot;][\u0026quot;salt\u0026quot;] å°±æ˜¯æœ‰æ•ˆçš„ã€‚\nfn main(){// ... letmutproperties: HashMap\u0026lt;\u0026amp;str,HashMap\u0026lt;\u0026amp;str,\u0026amp;str\u0026gt;\u0026gt;=HashMap::new();// ... }è¯·æ³¨æ„ï¼Œå“ˆå¸Œ map çš„é”®å’Œå€¼éƒ½æ˜¯ \u0026amp;strï¼Œå³å€Ÿç”¨çš„å­—ç¬¦ä¸²ã€‚pest è§£æå™¨ä¸ä¼šå¤åˆ¶ä»–ä»¬è§£æçš„è¾“å…¥ï¼Œè€Œæ˜¯å€Ÿç”¨ã€‚æ‰€æœ‰ç”¨äºæ£€æŸ¥è§£æç»“æœçš„æ–¹æ³•éƒ½ä¼šè¿”å›ä»åŸå§‹è§£æå­—ç¬¦ä¸²ä¸­å€Ÿç”¨å­—ç¬¦ä¸²ã€‚\nä¸»å¾ªç¯ ç°åœ¨æˆ‘ä»¬è§£é‡Šè§£æç»“æœã€‚æˆ‘ä»¬å¾ªç¯æµè§ˆæ–‡ä»¶çš„æ¯ä¸€è¡Œï¼Œè¿™ä¸€è¡Œè¦ä¹ˆæ˜¯èŠ‚åï¼Œè¦ä¹ˆæ˜¯é”®å€¼å±æ€§å¯¹ã€‚å¦‚æœé‡åˆ°ä¸€ä¸ªèŠ‚åï¼Œæˆ‘ä»¬æ›´æ–°ä¸€ä¸ªå˜é‡ã€‚å¦‚æœé‡åˆ°ä¸€ä¸ªå±æ€§å¯¹ï¼Œæˆ‘ä»¬å°±è·å–ä¸€ä¸ªå¯¹å½“å‰ç« èŠ‚çš„å“ˆå¸Œ map çš„å¼•ç”¨ï¼Œç„¶åæŠŠè¿™ä¸ªå±æ€§å¯¹æ’å…¥åˆ°è¿™ä¸ªå“ˆå¸Œ map ä¸­ã€‚\n// ... letmutcurrent_section_name=\u0026#34;\u0026#34;;forlineinfile.into_inner(){matchline.as_rule(){Rule::section=\u0026gt;{letmutinner_rules=line.into_inner();// { name } current_section_name=inner_rules.next().unwrap().as_str();}Rule::property=\u0026gt;{letmutinner_rules=line.into_inner();// { name ~ \u0026#34;=\u0026#34; ~ value } letname: \u0026amp;str =inner_rules.next().unwrap().as_str();letvalue: \u0026amp;str =inner_rules.next().unwrap().as_str();// Insert an empty inner hash map if the outer hash map hasn\u0026#39;t // seen this section name before. letsection=properties.entry(current_section_name).or_default();section.insert(name,value);}Rule::EOI=\u0026gt;(),_=\u0026gt;unreachable!(),}}// ... åœ¨è¾“å‡ºæ–¹é¢ï¼Œæˆ‘ä»¬ç”¨æ¼‚äº®çš„æ‰“å° Debug æ ¼å¼ç®€å•åœ°è½¬å‚¨å“ˆå¸Œ mapã€‚\nfn main(){// ... println!(\u0026#34;{:#?}\u0026#34;,properties);}ç©ºç™½ å¦‚æœä½ æŠŠæœ¬ç« é¡¶éƒ¨çš„ä¾‹å­ INI æ–‡ä»¶å¤åˆ¶åˆ° config.ini æ–‡ä»¶ä¸­å¹¶è¿è¡Œç¨‹åºï¼Œå®ƒå°†æ— æ³•è§£æã€‚æˆ‘ä»¬å·²ç»å¿˜è®°äº†ç­‰å·å‘¨å›´çš„å¯é€‰ç©ºæ ¼!\nå¯¹äºå¤§å‹ grammar æ¥è¯´ï¼Œå¤„ç†ç©ºç™½ä¼šå¾ˆä¸æ–¹ä¾¿ã€‚æ˜¾ç¤ºåœ°ç¼–å†™ whitespace è§„åˆ™å¹¶æ‰‹åŠ¨æ’å…¥ç©ºç™½ä¼šè®© grammar å˜å¾—éš¾ä»¥é˜…è¯»å’Œä¿®æ”¹ã€‚pest æä¾›äº†ä¸€ä¸ªç‰¹æ®Šè§„åˆ™ WHITESPACE çš„è§£å†³æ–¹æ¡ˆã€‚å¦‚æœå®šä¹‰äº† WHITESPACEï¼Œå®ƒå°†è¢«éšå¼åœ°è¿è¡Œï¼Œå°½å¯èƒ½å¤šæ¬¡åœ°åœ¨æ¯ä¸ªæ³¢æµªå· ~ å’Œæ¯ä¸ªé‡å¤ä¹‹é—´è¿è¡Œï¼ˆä¾‹å¦‚ï¼Œ* å’Œ +ï¼‰ã€‚å¯¹äºæˆ‘ä»¬çš„ INI è§£æå™¨ï¼Œåªæœ‰ç©ºæ ¼æ‰æ˜¯åˆæ³•çš„ whitespaceã€‚\nWHITESPACE = _{ \u0026quot; \u0026quot; } æˆ‘ä»¬ç”¨ä¸€ä¸ªå‰å¯¼çš„ä¸‹åˆ’çº¿ _{ ... } æ¥æ ‡è®° WHITESPACE è§„åˆ™çš„é™é»˜ã€‚}. è¿™æ ·ï¼Œå³ä½¿å®ƒåŒ¹é…ï¼Œä¹Ÿä¸ä¼šå‡ºç°åœ¨å…¶ä»–è§„åˆ™ä¸­ã€‚å¦‚æœå®ƒä¸æ˜¯é™é»˜çš„ï¼Œè§£æå°±ä¼šå¤æ‚å¾—å¤šï¼Œå› ä¸ºå¯¹ Pairs::next(...) çš„æ¯æ¬¡è°ƒç”¨éƒ½æœ‰å¯èƒ½è¿”å› Rule::WHITESPACE è€Œä¸æ˜¯æƒ³è¦çš„ä¸‹ä¸€æ¡è§„åˆ™ã€‚\nä½†æ˜¯ç­‰ç­‰! èŠ‚åã€é”®æˆ–å€¼ä¸­ä¸åº”è¯¥æœ‰ç©ºæ ¼ï¼ç›®å‰ï¼Œç©ºæ ¼æ˜¯è‡ªåŠ¨æ’å…¥çš„ã€‚ç›®å‰ï¼Œåœ¨ name = { char+ } ä¸­ï¼Œç©ºæ ¼ä¼šè‡ªåŠ¨æ’å…¥å­—ç¬¦ä¹‹é—´ã€‚å¯¹ç©ºæ ¼æ•æ„Ÿçš„è§„åˆ™éœ€è¦ç”¨å‰å¯¼ç¬¦å· @{ ... } æ¥æ ‡è®°åŸå­ã€‚}. åœ¨åŸå­è§„åˆ™ä¸­ï¼Œè‡ªåŠ¨çš„ç©ºç™½å¤„ç†æ˜¯è¢«ç¦ç”¨çš„ï¼Œè€Œå†…éƒ¨è§„åˆ™æ˜¯é™é»˜çš„ã€‚\nname = @{ char+ } value = @{ char* } å®Œå·¥ è¯•è¯•å§ï¼ç¡®ä¿æ–‡ä»¶ config.ini å­˜åœ¨ï¼Œç„¶åè¿è¡Œç¨‹åº! ä½ åº”è¯¥çœ‹åˆ°è¿™æ ·çš„ä¸œè¥¿ã€‚\n$ cargo run [ ... ] { \u0026quot;\u0026quot;: { \u0026quot;password\u0026quot;: \u0026quot;plain_text\u0026quot;, \u0026quot;username\u0026quot;: \u0026quot;noha\u0026quot;, \u0026quot;salt\u0026quot;: \u0026quot;NaCl\u0026quot; }, \u0026quot;second_server\u0026quot;: { \u0026quot;ip\u0026quot;: \u0026quot;\u0026quot;, \u0026quot;document_root\u0026quot;: \u0026quot;/var/www/example.com\u0026quot;, \u0026quot;interface\u0026quot;: \u0026quot;eth1\u0026quot; }, \u0026quot;server_1\u0026quot;: { \u0026quot;interface\u0026quot;: \u0026quot;eth0\u0026quot;, \u0026quot;document_root\u0026quot;: \u0026quot;/var/www/example.org\u0026quot;, \u0026quot;ip\u0026quot;: \u0026quot;127.0.0.1\u0026quot; } } ","permalink":"https://ohmyweekly.github.io/notes/2021-01-19-parser-api-example-ini/","tags":["Rust","Grammar"],"title":"Parser API - è§£æ INI"},{"categories":["Flink"],"contents":"å…ƒç¼–ç¨‹ åœ¨Juliaè¯­è¨€ä¸­ï¼ŒLispæœ€å¼ºçš„é—äº§æ˜¯å®ƒå¯¹å…ƒç¼–ç¨‹çš„æ”¯æŒã€‚å’ŒLispä¸€æ ·ï¼ŒJuliaä¹Ÿå°†è‡ªå·±çš„ä»£ç è¡¨ç¤ºä¸ºè¯­è¨€æœ¬èº«çš„æ•°æ®ç»“æ„ã€‚ç”±äºä»£ç æ˜¯ç”±å¯ä»¥åœ¨è¯­è¨€å†…éƒ¨åˆ›å»ºå’Œæ“ä½œçš„å¯¹è±¡æ¥è¡¨ç¤ºçš„ï¼Œæ‰€ä»¥ç¨‹åºå¯ä»¥è½¬æ¢å’Œç”Ÿæˆè‡ªå·±çš„ä»£ç ã€‚è¿™ä½¿å¾—å¤æ‚çš„ä»£ç ç”Ÿæˆä¸éœ€è¦é¢å¤–çš„æ„å»ºæ­¥éª¤ï¼Œä¹Ÿå…è®¸çœŸæ­£çš„Lispå¼çš„å®åœ¨æŠ½è±¡è¯­æ³•æ ‘çš„å±‚æ¬¡ä¸Šæ“ä½œã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œé¢„å¤„ç†å™¨çš„ \u0026ldquo;å® \u0026ldquo;ç³»ç»Ÿï¼Œå°±åƒCå’ŒC++ä¸€æ ·ï¼Œåœ¨ä»»ä½•å®é™…çš„è§£ææˆ–è§£é‡Šå‘ç”Ÿä¹‹å‰ï¼Œéƒ½ä¼šè¿›è¡Œæ–‡æœ¬æ“ä½œå’Œæ›¿æ¢ã€‚ç”±äºJuliaä¸­æ‰€æœ‰çš„æ•°æ®ç±»å‹å’Œä»£ç éƒ½æ˜¯ç”±Juliaæ•°æ®ç»“æ„æ¥è¡¨ç¤ºçš„ï¼Œå› æ­¤ï¼Œå¼ºå¤§çš„åå°„åŠŸèƒ½å¯ä»¥åƒå…¶ä»–æ•°æ®ä¸€æ ·æ¢ç´¢ç¨‹åºåŠå…¶ç±»å‹çš„å†…éƒ¨ã€‚\nç¨‹åºè¡¨ç¤º æ¯ä¸ªJuliaç¨‹åºéƒ½æ˜¯ä»¥å­—ç¬¦ä¸²çš„å½¢å¼å¼€å§‹çš„ã€‚\njulia\u0026gt; prog = \u0026#34;1 + 1\u0026#34; \u0026#34;1 + 1\u0026#34; æ¥ä¸‹æ¥ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ\nä¸‹ä¸€æ­¥æ˜¯å°†æ¯ä¸ªå­—ç¬¦ä¸²è§£ææˆä¸€ä¸ªå¯¹è±¡ï¼Œç§°ä¸ºè¡¨è¾¾å¼ï¼Œç”¨Juliaç±»å‹ Expr è¡¨ç¤ºã€‚\njulia\u0026gt; ex1 = Meta.parse(prog) :(1 + 1) julia\u0026gt; typeof(ex1) Expr Exprå¯¹è±¡åŒ…å«ä¸¤éƒ¨åˆ†ã€‚\na ç¬¦å·æ ‡è¯†è¡¨è¾¾å¼çš„ç§ç±»ã€‚ç¬¦å·æ˜¯ä¸€ä¸ªå†…åµŒçš„å­—ç¬¦ä¸²æ ‡è¯†ç¬¦ï¼ˆä¸‹æ–‡å°†è¯¦ç»†è®¨è®ºï¼‰ã€‚\njulia\u0026gt; ex1.head :call è¡¨è¾¾å¼å‚æ•°ï¼Œå¯ä»¥æ˜¯ç¬¦å·ã€å…¶ä»–è¡¨è¾¾å¼æˆ–æ–‡å­—å€¼ã€‚\njulia\u0026gt; ex1.args 3-element Array{Any,1}: :+ 1 1 ä¹Ÿå¯ä»¥ç›´æ¥ç”¨å‰ç¼€ç¬¦å·æ„é€ è¡¨è¾¾å¼ã€‚\njulia\u0026gt; ex2 = Expr(:call, :+, 1, 1) :(1 + 1) ä¸Šé¢æ„é€ çš„ä¸¤ä¸ªè¡¨è¾¾å¼\u0026ndash;é€šè¿‡è§£æå’Œç›´æ¥æ„é€ \u0026ndash;æ˜¯ç­‰ä»·çš„ã€‚\njulia\u0026gt; ex1 == ex2 true è¿™é‡Œçš„å…³é”®ç‚¹æ˜¯ï¼ŒJuliaä»£ç åœ¨å†…éƒ¨è¢«è¡¨ç¤ºä¸ºä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œå¯ä»¥ä»è¯­è¨€æœ¬èº«è®¿é—®ã€‚\ndumpå‡½æ•°æä¾›äº†Exprå¯¹è±¡çš„ç¼©è¿›å’Œæ³¨é‡Šæ˜¾ç¤ºã€‚\njulia\u0026gt; dump(ex2) Expr head: Symbol call args: Array{Any}((3,)) 1: Symbol + 2: Int64 1 3: Int64 1 Exprå¯¹è±¡ä¹Ÿå¯ä»¥è¢«åµŒå¥—ã€‚\njulia\u0026gt; ex3 = Meta.parse(\u0026#34;(4 + 4) / 2\u0026#34;) :((4 + 4) / 2) å¦ä¸€ç§æŸ¥çœ‹è¡¨è¾¾å¼çš„æ–¹æ³•æ˜¯ä½¿ç”¨Meta.show_sexprï¼Œå®ƒå¯ä»¥æ˜¾ç¤ºç»™å®šExprçš„Sè¡¨è¾¾å¼å½¢å¼ï¼Œè¿™å¯¹äºLispçš„ç”¨æˆ·æ¥è¯´å¯èƒ½çœ‹èµ·æ¥éå¸¸ç†Ÿæ‚‰ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œè¯´æ˜å¦‚ä½•åœ¨åµŒå¥—çš„Exprä¸Šæ˜¾ç¤ºã€‚\njulia\u0026gt; Meta.show_sexpr(ex3) (:call, :/, (:call, :+, 4, 4), 2) ç¬¦å·\nåœ¨Juliaä¸­ï¼Œ:å­—ç¬¦æœ‰ä¸¤ç§è¯­æ³•ç”¨é€”ã€‚ç¬¬ä¸€ç§å½¢å¼æ˜¯åˆ›å»ºä¸€ä¸ªSymbolï¼Œä¸€ä¸ªå†…éƒ¨å­—ç¬¦ä¸²ï¼Œä½œä¸ºè¡¨è¾¾å¼çš„ä¸€ä¸ªæ„ä»¶ã€‚\njulia\u0026gt; :foo :foo julia\u0026gt; typeof(ans) Symbol ç¬¦å·æ„é€ å‡½æ•°æ¥å—ä»»ä½•æ•°é‡çš„å‚æ•°ï¼Œå¹¶é€šè¿‡å°†å®ƒä»¬çš„å­—ç¬¦ä¸²è¡¨ç¤ºè¿æ¥åœ¨ä¸€èµ·æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç¬¦å·ã€‚\njulia\u0026gt; :foo == Symbol(\u0026#34;foo\u0026#34;) true julia\u0026gt; Symbol(\u0026#34;func\u0026#34;,10) :func10 julia\u0026gt; Symbol(:var,\u0026#39;_\u0026#39;,\u0026#34;sym\u0026#34;) :var_sym è¯·æ³¨æ„ï¼Œè¦ä½¿ç”¨ : è¯­æ³•ï¼Œç¬¦å·çš„åç§°å¿…é¡»æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ ‡è¯†ç¬¦ã€‚å¦åˆ™å¿…é¡»ä½¿ç”¨Symbol(str)æ„é€ å‡½æ•°ã€‚\nåœ¨è¡¨è¾¾å¼çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œç¬¦å·ç”¨äºæŒ‡ç¤ºå¯¹å˜é‡çš„è®¿é—®ï¼›å½“è¡¨è¾¾å¼è¢«è¯„ä¼°æ—¶ï¼Œç¬¦å·ä¼šè¢«æ›¿æ¢ä¸ºåœ¨é€‚å½“çš„ä½œç”¨åŸŸä¸­ä¸è¯¥ç¬¦å·ç»‘å®šçš„å€¼ã€‚\næœ‰æ—¶ï¼Œä¸ºäº†é¿å…åœ¨è§£ææ—¶äº§ç”Ÿæ­§ä¹‰ï¼Œéœ€è¦åœ¨ : çš„å‚æ•°å‘¨å›´åŠ æ‹¬å·ã€‚\njulia\u0026gt; :(:) :(:) julia\u0026gt; :(::) :(::) è¡¨è¾¾å¼å’Œè¯„ä»·\n å¼•ç”¨  å­—ç¬¦çš„ç¬¬äºŒä¸ªè¯­æ³•ç›®çš„æ˜¯åœ¨ä¸ä½¿ç”¨æ˜¾å¼Expræ„é€ å‡½æ•°çš„æƒ…å†µä¸‹åˆ›å»ºè¡¨è¾¾å¼å¯¹è±¡ã€‚è¿™å°±æ˜¯æ‰€è°“çš„å¼•ç”¨ã€‚åœ¨Juliaä»£ç çš„å•æ¡è¯­å¥å‘¨å›´ï¼Œç”¨æˆå¯¹çš„æ‹¬å·è·Ÿä¸Š : å­—ç¬¦ï¼Œå°±å¯ä»¥æ ¹æ®æ‰€é™„çš„ä»£ç ç”Ÿæˆä¸€ä¸ªExprå¯¹è±¡ã€‚ä¸‹é¢æ˜¯ç”¨äºå¼•ç”¨ä¸€ä¸ªç®—æœ¯è¡¨è¾¾å¼çš„ç®€çŸ­å½¢å¼çš„ä¾‹å­ã€‚\n  julia\u0026gt; ex = :(a+b*c+1) :(a + b * c + 1) julia\u0026gt; typeof(ex) Expr (è¦æŸ¥çœ‹è¿™ä¸ªè¡¨è¾¾å¼çš„ç»“æ„ï¼Œå¯ä»¥è¯•è¯•ex.headå’Œex.argsï¼Œæˆ–è€…ä½¿ç”¨ä¸Šé¢çš„dumpæˆ–Meta.@dump)\næ³¨æ„ï¼Œå¯ä»¥ä½¿ç”¨Meta.parseæˆ–ç›´æ¥ä½¿ç”¨Exprå½¢å¼æ„é€ ç­‰ä»·çš„è¡¨è¾¾å¼ã€‚\njulia\u0026gt; :(a + b*c + 1) == Meta.parse(\u0026#34;a + b*c + 1\u0026#34;) == Expr(:call, :+, :a, Expr(:call, :*, :b, :c), 1) true è§£æå™¨æä¾›çš„è¡¨è¾¾å¼ä¸€èˆ¬åªæœ‰ç¬¦å·ã€å…¶ä»–è¡¨è¾¾å¼å’Œå­—é¢å€¼ä½œä¸ºå…¶argsï¼Œè€ŒJuliaä»£ç æ„å»ºçš„è¡¨è¾¾å¼å¯ä»¥æœ‰ä»»æ„çš„è¿è¡Œæ—¶å€¼ï¼Œæ²¡æœ‰å­—é¢å½¢å¼ä½œä¸ºargsã€‚åœ¨è¿™ä¸ªå…·ä½“çš„ä¾‹å­ä¸­ï¼Œ+å’Œaæ˜¯ç¬¦å·ï¼Œ*(b,c)æ˜¯ä¸€ä¸ªå­è¡¨è¾¾å¼ï¼Œ1æ˜¯ä¸€ä¸ª64ä½æœ‰ç¬¦å·æ•´æ•°çš„æ–‡å­—å½¢å¼ã€‚\nå¯¹äºå¤šä¸ªè¡¨è¾¾å¼ï¼Œè¿˜æœ‰ç¬¬äºŒç§å¼•ç”¨çš„è¯­æ³•å½¢å¼ï¼šç”¨å¼•å·\u0026hellip;\u0026hellip;ç»“å°¾æ‹¬èµ·æ¥çš„ä»£ç å—ã€‚\njulia\u0026gt; ex = quote x = 1 y = 2 x + y end quote #= none:2 =# x = 1 #= none:3 =# y = 2 #= none:4 =# x + y end julia\u0026gt; typeof(ex) Expr æ’å€¼\nç”¨å€¼å‚æ•°ç›´æ¥æ„é€ Exprå¯¹è±¡æ˜¯å¾ˆå¼ºå¤§çš„ï¼Œä½†ä¸ \u0026ldquo;æ­£å¸¸çš„ \u0026ldquo;Juliaè¯­æ³•ç›¸æ¯”ï¼ŒExpræ„é€ å‡½æ•°å¯èƒ½å¾ˆä¹å‘³ã€‚ä½œä¸ºä¸€ç§æ›¿ä»£æ–¹æ³•ï¼ŒJuliaå…è®¸å°†å­—å…ƒæˆ–è¡¨è¾¾å¼æ’å€¼åˆ°å¼•ç”¨çš„è¡¨è¾¾å¼ä¸­ã€‚æ’å€¼ç”±å‰ç¼€$è¡¨ç¤ºã€‚\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå˜é‡açš„å€¼è¢«å†…æ’äº†ã€‚\njulia\u0026gt; a = 1; julia\u0026gt; ex = :($a + b) :(1 + b) ä¸æ”¯æŒå‘æœªå¼•ç”¨çš„è¡¨è¾¾å¼æ’å€¼ï¼Œå¹¶ä¼šå¯¼è‡´ç¼–è¯‘æ—¶é”™è¯¯ã€‚\njulia\u0026gt; $a + b ERROR: syntax: \u0026#34;$\u0026#34; expression outside quote åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå…ƒç»„(1,2,3)ä½œä¸ºè¡¨è¾¾å¼è¢«å†…æ’åˆ°ä¸€ä¸ªæ¡ä»¶æµ‹è¯•ä¸­ã€‚\njulia\u0026gt; ex = :(a in $:((1,2,3)) ) :(a in (1, 2, 3)) åœ¨è¡¨è¾¾å¼æ’å€¼ä¸­ä½¿ç”¨$æ˜¯æœ‰æ„è®©äººè”æƒ³åˆ°å­—ç¬¦ä¸²æ’å€¼å’Œå‘½ä»¤æ’å€¼ã€‚è¡¨è¾¾å¼æ’å€¼å¯ä»¥æ–¹ä¾¿çš„ã€å¯è¯»çš„ç¨‹åºåŒ–æ„é€ å¤æ‚çš„Juliaè¡¨è¾¾å¼ã€‚\nåŠˆå‰æ’å€¼\nè¯·æ³¨æ„ï¼Œ$æ’å€¼è¯­æ³•åªå…è®¸åœ¨ä¸€ä¸ªåŒ…å›´è¡¨è¾¾å¼ä¸­æ’å…¥ä¸€ä¸ªè¡¨è¾¾å¼ã€‚å¶å°”ï¼Œä½ æœ‰ä¸€ä¸ªè¡¨è¾¾å¼æ•°ç»„ï¼Œéœ€è¦å®ƒä»¬å…¨éƒ¨æˆä¸ºåŒ…å›´è¡¨è¾¾å¼çš„å‚æ•°ã€‚è¿™å¯ä»¥ç”¨è¯­æ³•$(xs\u0026hellip;)æ¥å®Œæˆã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç ç”Ÿæˆäº†ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œå…¶ä¸­çš„å‚æ•°æ•°æ˜¯é€šè¿‡ç¼–ç¨‹ç¡®å®šçš„ã€‚\njulia\u0026gt; args = [:x, :y, :z]; julia\u0026gt; :(f(1, $(args...))) :(f(1, x, y, z)) åµŒå¥—å¼•ç”¨\nè‡ªç„¶ï¼Œå¼•å·è¡¨è¾¾å¼æœ‰å¯èƒ½åŒ…å«å…¶ä»–å¼•å·è¡¨è¾¾å¼ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œç†è§£å†…æ’æ˜¯å¦‚ä½•å·¥ä½œçš„å¯èƒ½æœ‰ç‚¹æ£˜æ‰‹ã€‚è€ƒè™‘ä¸€ä¸‹è¿™ä¸ªä¾‹å­ã€‚\njulia\u0026gt; x = :(1 + 2); julia\u0026gt; e = quote quote $x end end quote #= none:1 =# $(Expr(:quote, quote #= none:1 =# $(Expr(:$, :x)) end)) end æ³¨æ„ï¼Œç»“æœä¸­åŒ…å«$xï¼Œè¿™æ„å‘³ç€xè¿˜æ²¡æœ‰è¢«è¯„ä¼°ã€‚æ¢å¥è¯è¯´ï¼Œ$è¡¨è¾¾å¼ \u0026ldquo;å±äº \u0026ldquo;å†…éƒ¨å¼•å·è¡¨è¾¾å¼ï¼Œå› æ­¤å®ƒçš„å‚æ•°åªæœ‰åœ¨å†…éƒ¨å¼•å·è¡¨è¾¾å¼æ—¶æ‰ä¼šè¢«è¯„ä¼°ã€‚\njulia\u0026gt; eval(e) quote #= none:1 =# 1 + 2 end ä½†æ˜¯ï¼Œå¤–å¼•å·è¡¨è¾¾å¼èƒ½å¤Ÿå¯¹å†…å¼•å·ä¸­çš„$å†…çš„å€¼è¿›è¡Œæ’å€¼ã€‚è¿™æ˜¯ç”¨å¤šä¸ª$æ¥å®Œæˆçš„ã€‚\njulia\u0026gt; e = quote quote $$x end end quote #= none:1 =# $(Expr(:quote, quote #= none:1 =# $(Expr(:$, :(1 + 2))) end)) end æ³¨æ„åˆ°(1+2)ç°åœ¨å‡ºç°åœ¨ç»“æœä¸­ï¼Œè€Œä¸æ˜¯ç¬¦å·xã€‚å¯¹è¿™ä¸ªè¡¨è¾¾å¼è¿›è¡Œè¯„ä¼°ï¼Œå¾—åˆ°ä¸€ä¸ªå†…æ’çš„3ã€‚\njulia\u0026gt; eval(e) quote #= none:1 =# 3 end è¿™ç§è¡Œä¸ºèƒŒåçš„ç›´è§‰æ˜¯ï¼Œxå¯¹æ¯ä¸ª$éƒ½ä¼šè¢«è¯„ä¼°ä¸€æ¬¡ï¼šä¸€ä¸ª$çš„å·¥ä½œåŸç†ç±»ä¼¼äºeval(:x)ï¼Œç»™å‡ºxçš„å€¼ï¼Œè€Œä¸¤ä¸ª$çš„å·¥ä½œåŸç†ç›¸å½“äºeval(eval(:x))ã€‚\nQuoteNode\nå¼•å·å½¢å¼åœ¨ASTä¸­çš„é€šå¸¸è¡¨ç¤ºæ˜¯ä¸€ä¸ªå¸¦å¤´:quoteçš„Exprã€‚\njulia\u0026gt; dump(Meta.parse(\u0026#34;:(1+2)\u0026#34;)) Expr head: Symbol quote args: Array{Any}((1,)) 1: Expr head: Symbol call args: Array{Any}((3,)) 1: Symbol + 2: Int64 1 3: Int64 2 æ­£å¦‚æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ï¼Œè¿™ç±»è¡¨è¾¾å¼æ”¯æŒç”¨$è¿›è¡Œæ’å€¼ï¼Œä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæœ‰å¿…è¦åœ¨ä¸è¿›è¡Œæ’å€¼çš„æƒ…å†µä¸‹å¼•ç”¨ä»£ç ã€‚è¿™ç§å¼•ç”¨è¿˜æ²¡æœ‰è¯­æ³•ï¼Œä½†åœ¨å†…éƒ¨è¡¨ç¤ºä¸ºä¸€ä¸ªç±»å‹ä¸ºQuoteNodeçš„å¯¹è±¡ã€‚\njulia\u0026gt; eval(Meta.quot(Expr(:$, :(1+2)))) 3 julia\u0026gt; eval(QuoteNode(Expr(:$, :(1+2)))) :($(Expr(:$, :(1 + 2)))) è¯¥è§£æå™¨äº§ç”Ÿçš„QuoteNodesç”¨äºç®€å•çš„å¼•ç”¨é¡¹ç›®ï¼Œå¦‚ç¬¦å·ã€‚\njulia\u0026gt; dump(Meta.parse(\u0026#34;:x\u0026#34;)) QuoteNode value: Symbol x QuoteNodeè¿˜å¯ä»¥ç”¨äºæŸäº›é«˜çº§å…ƒç¼–ç¨‹ä»»åŠ¡ã€‚\nè¯„ä¼°è¡¨è¾¾å¼\nç»™å®šä¸€ä¸ªè¡¨è¾¾å¼å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨evalä½¿Juliaåœ¨å…¨å±€èŒƒå›´å†…å¯¹å…¶è¿›è¡Œè¯„ä¼°ï¼ˆæ‰§è¡Œï¼‰ã€‚\njulia\u0026gt; :(1 + 2) :(1 + 2) julia\u0026gt; eval(ans) 3 julia\u0026gt; ex = :(a + b) :(a + b) julia\u0026gt; eval(ex) ERROR: UndefVarError: b not defined [...] julia\u0026gt; a = 1; b = 2; julia\u0026gt; eval(ex) 3 æ¯ä¸ªæ¨¡å—éƒ½æœ‰è‡ªå·±çš„ eval å‡½æ•°ï¼Œå®ƒå¯ä»¥åœ¨å…¨å±€èŒƒå›´å†…è¯„ä¼°è¡¨è¾¾å¼ã€‚ä¼ é€’ç»™evalçš„è¡¨è¾¾å¼å¹¶ä¸å±€é™äºè¿”å›å€¼\u0026ndash;å®ƒä»¬ä¹Ÿå¯ä»¥äº§ç”Ÿå‰¯ä½œç”¨ï¼Œæ”¹å˜æ¨¡å—ç¯å¢ƒçš„çŠ¶æ€ã€‚\njulia\u0026gt; ex = :(x = 1) :(x = 1) julia\u0026gt; x ERROR: UndefVarError: x not defined julia\u0026gt; eval(ex) 1 julia\u0026gt; x 1 åœ¨è¿™é‡Œï¼Œå¯¹è¡¨è¾¾å¼å¯¹è±¡çš„è¯„ä»·ä¼šå¯¼è‡´ä¸€ä¸ªå€¼è¢«åˆ†é…ç»™å…¨å±€å˜é‡xã€‚\nç”±äºè¡¨è¾¾å¼åªæ˜¯Exprå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡ç¼–ç¨‹æ„é€ ï¼Œç„¶åè¿›è¡Œè¯„ä¼°ï¼Œå› æ­¤å¯ä»¥åŠ¨æ€ç”Ÿæˆä»»æ„ä»£ç ï¼Œç„¶åä½¿ç”¨evalè¿›è¡Œè¿è¡Œã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚\njulia\u0026gt; a = 1; julia\u0026gt; ex = Expr(:call, :+, a, :b) :(1 + b) julia\u0026gt; a = 0; b = 2; julia\u0026gt; eval(ex) 3 açš„å€¼ç”¨äºæ„é€ è¡¨è¾¾å¼exï¼Œè¯¥è¡¨è¾¾å¼å°†+å‡½æ•°åº”ç”¨äºå€¼1å’Œå˜é‡bï¼Œæ³¨æ„aå’Œbçš„ä½¿ç”¨æ–¹å¼çš„é‡è¦åŒºåˆ«ã€‚\nå˜é‡açš„å€¼åœ¨è¡¨è¾¾å¼æ„é€ æ—¶è¢«ç”¨ä½œè¡¨è¾¾å¼ä¸­çš„å³æ—¶å€¼ã€‚å› æ­¤ï¼Œå½“è¡¨è¾¾å¼è¢«è¯„ä¼°æ—¶ï¼Œaçš„å€¼ä¸å†é‡è¦ï¼šè¡¨è¾¾å¼ä¸­çš„å€¼å·²ç»æ˜¯1ï¼Œæ— è®ºaçš„å€¼æ˜¯å¤šå°‘ï¼Œéƒ½æ˜¯ç‹¬ç«‹çš„ã€‚ å¦ä¸€æ–¹é¢ï¼Œåœ¨è¡¨è¾¾å¼çš„æ„é€ ä¸­ä½¿ç”¨äº†ç¬¦å·:bï¼Œæ‰€ä»¥å˜é‡bçš„å€¼åœ¨é‚£ä¸ªæ—¶å€™æ˜¯æ— å…³ç´§è¦çš„\u0026ndash;:båªæ˜¯ä¸€ä¸ªç¬¦å·ï¼Œå˜é‡bç”šè‡³ä¸éœ€è¦è¢«å®šä¹‰ã€‚ä½†åœ¨è¡¨è¾¾å¼è¯„ä¼°æ—¶ï¼Œç¬¦å·:bçš„å€¼æ˜¯é€šè¿‡æŸ¥æ‰¾å˜é‡bçš„å€¼æ¥è§£å†³çš„ã€‚ è¡¨è¾¾å¼ä¸Šçš„å‡½æ•°\nå¦‚ä¸Šæ‰€è¿°ï¼ŒJuliaçš„ä¸€ä¸ªæå…¶æœ‰ç”¨çš„ç‰¹æ€§æ˜¯åœ¨Juliaæœ¬èº«å†…éƒ¨ç”Ÿæˆå’Œæ“ä½œJuliaä»£ç çš„èƒ½åŠ›ã€‚æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†ä¸€ä¸ªå‡½æ•°è¿”å›Exprå¯¹è±¡çš„ä¾‹å­ï¼šparseå‡½æ•°ï¼Œå®ƒæ¥æ”¶ä¸€ä¸²Juliaä»£ç å¹¶è¿”å›ç›¸åº”çš„Exprã€‚ä¸€ä¸ªå‡½æ•°ä¹Ÿå¯ä»¥æ¥å—ä¸€ä¸ªæˆ–å¤šä¸ªExprå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›å¦ä¸€ä¸ªExprã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ã€æ¿€åŠ±æ€§çš„ä¾‹å­ã€‚\njulia\u0026gt; function math_expr(op, op1, op2) expr = Expr(:call, op, op1, op2) return expr end math_expr (generic function with 1 method) julia\u0026gt; ex = math_expr(:+, 1, Expr(:call, :*, 4, 5)) :(1 + 4 * 5) julia\u0026gt; eval(ex) 21 ä½œä¸ºå¦ä¸€ä¸ªä¾‹å­ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå¯ä»¥å°†ä»»ä½•æ•°å­—å‚æ•°ç¿»å€ï¼Œä½†ä¸è€ƒè™‘è¡¨è¾¾å¼ã€‚\njulia\u0026gt; function make_expr2(op, opr1, opr2) opr1f, opr2f = map(x -\u0026gt; isa(x, Number) ? 2*x : x, (opr1, opr2)) retexpr = Expr(:call, op, opr1f, opr2f) return retexpr end make_expr2 (generic function with 1 method) julia\u0026gt; make_expr2(:+, 1, 2) :(2 + 4) julia\u0026gt; ex = make_expr2(:+, 1, Expr(:call, :*, 5, 8)) :(2 + 5 * 8) julia\u0026gt; eval(ex) 42 å® å®æä¾›äº†ä¸€ç§å°†ç”Ÿæˆçš„ä»£ç åŒ…å«åœ¨ç¨‹åºçš„æœ€åä¸»ä½“ä¸­çš„æ–¹æ³•ã€‚å®å°†ä¸€ä¸ªå‚æ•°å…ƒç»„æ˜ å°„åˆ°ä¸€ä¸ªè¿”å›çš„è¡¨è¾¾å¼ï¼Œç”Ÿæˆçš„è¡¨è¾¾å¼ç›´æ¥è¢«ç¼–è¯‘ï¼Œè€Œä¸éœ€è¦è¿è¡Œæ—¶ eval è°ƒç”¨ã€‚å®å‚æ•°å¯ä»¥åŒ…æ‹¬è¡¨è¾¾å¼ã€å­—é¢å€¼å’Œç¬¦å·ã€‚\nåŸºç¡€çŸ¥è¯† è¿™é‡Œæœ‰ä¸€ä¸ªç‰¹åˆ«ç®€å•çš„å®ã€‚\njulia\u0026gt; macro sayhello() return :( println(\u0026#34;Hello, world!\u0026#34;) ) end @sayhello (macro with 1 method) åœ¨ Julia çš„è¯­æ³•ä¸­ï¼Œå®æœ‰ä¸€ä¸ªä¸“é—¨çš„å­—ç¬¦ï¼š@(at ç¬¦å·)ï¼Œåé¢æ˜¯ macro NAME ... end å—ä¸­å£°æ˜çš„å”¯ä¸€åç§°\u0026hellip;.ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç¼–è¯‘å™¨å°†ç”¨ @sayhello æ›¿æ¢æ‰€æœ‰çš„å®ä¾‹ã€‚\n:( println(\u0026#34;Hello, world!\u0026#34;) ) å½“åœ¨ REPL ä¸­è¾“å…¥ @sayhello æ—¶ï¼Œè¡¨è¾¾å¼ä¼šç«‹å³æ‰§è¡Œï¼Œå› æ­¤æˆ‘ä»¬åªçœ‹åˆ°æ±‚å€¼ç»“æœã€‚\njulia\u0026gt; @sayhello() Hello, world! ç°åœ¨ï¼Œè€ƒè™‘ä¸€ä¸ªç¨å¾®å¤æ‚çš„å®ã€‚\njulia\u0026gt; macro sayhello(name) return :( println(\u0026#34;Hello, \u0026#34;, $name) ) end @sayhello (macro with 1 method) è¿™ä¸ªå®åªå–ä¸€ä¸ªå‚æ•°ï¼šnameã€‚å½“é‡åˆ° @sayhello æ—¶ï¼Œå¼•ç”¨çš„è¡¨è¾¾å¼ä¼šè¢«å±•å¼€ï¼Œå°†å‚æ•°çš„å€¼å†…æ’åˆ°æœ€ç»ˆçš„è¡¨è¾¾å¼ä¸­ã€‚\njulia\u0026gt; @sayhello(\u0026#34;human\u0026#34;) Hello, human æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‡½æ•° macroexpand æŸ¥çœ‹å¼•ç”¨çš„è¿”å›è¡¨è¾¾å¼ï¼ˆé‡è¦æç¤ºï¼šè¿™æ˜¯è°ƒè¯•å®çš„ä¸€ä¸ªæå…¶æœ‰ç”¨çš„å·¥å…·ï¼‰ã€‚\njulia\u0026gt; ex = macroexpand(Main, :(@sayhello(\u0026#34;human\u0026#34;)) ) :(Main.println(\u0026#34;Hello, \u0026#34;, \u0026#34;human\u0026#34;)) julia\u0026gt; typeof(ex) Expr æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ\u0026ldquo;human\u0026rdquo; çš„å­—é¢å€¼å·²ç»è¢«æ’è¿›äº†è¡¨è¾¾å¼ä¸­ã€‚\næ­¤å¤–ï¼Œè¿˜å­˜åœ¨ä¸€ä¸ªå® @macroexpandï¼Œä¹Ÿè®¸æ¯” macroexpand å‡½æ•°æ›´æ–¹ä¾¿ä¸€äº›ã€‚\njulia\u0026gt; @macroexpand @sayhello \u0026#34;human\u0026#34; :(println(\u0026#34;Hello, \u0026#34;, \u0026#34;human\u0026#34;)) ç­‰ç­‰ï¼šä¸ºä»€ä¹ˆæ˜¯å®ï¼Ÿ æˆ‘ä»¬åœ¨å‰ä¸€èŠ‚å·²ç»çœ‹åˆ°äº†ä¸€ä¸ªå‡½æ•° f(::Expr...) -\u0026gt; Exprã€‚å…¶å®ï¼Œmacroexpand ä¹Ÿæ˜¯è¿™æ ·ä¸€ä¸ªå‡½æ•°ã€‚é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆè¦æœ‰å®çš„å­˜åœ¨å‘¢ï¼Ÿ\nå®æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºå®ƒä»¬åœ¨ä»£ç è§£ææ—¶æ‰§è¡Œï¼Œå› æ­¤ï¼Œå®å…è®¸ç¨‹åºå‘˜åœ¨å®Œæ•´ç¨‹åºè¿è¡Œä¹‹å‰ç”Ÿæˆå¹¶åŒ…å«è‡ªå®šä¹‰ä»£ç çš„ç‰‡æ®µã€‚ä¸ºäº†è¯´æ˜ä¸¤è€…çš„åŒºåˆ«ï¼Œè¯·è€ƒè™‘ä¸‹é¢çš„ä¾‹å­ã€‚\njulia\u0026gt; macro twostep(arg) println(\u0026#34;I execute at parse time. The argument is: \u0026#34;, arg) return :(println(\u0026#34;I execute at runtime. The argument is: \u0026#34;, $arg)) end @twostep (macro with 1 method) julia\u0026gt; ex = macroexpand(Main, :(@twostep :(1, 2, 3)) ); I execute at parse time. The argument is: :((1, 2, 3)) å½“è°ƒç”¨ macroexpand æ—¶ï¼Œä¼šæ‰§è¡Œå¯¹ println çš„ç¬¬ä¸€æ¬¡è°ƒç”¨ã€‚ç»“æœçš„è¡¨è¾¾å¼åªåŒ…å«ç¬¬äºŒä¸ª printlnã€‚\njulia\u0026gt; typeof(ex) Expr julia\u0026gt; ex :(println(\u0026#34;I execute at runtime. The argument is: \u0026#34;, $(Expr(:copyast, :($(QuoteNode(:((1, 2, 3))))))))) julia\u0026gt; eval(ex) I execute at runtime. The argument is: (1, 2, 3) å®è°ƒç”¨ å®çš„è°ƒç”¨æœ‰ä»¥ä¸‹ä¸€èˆ¬è¯­æ³•ã€‚\n@name expr1 expr2 ... @name(expr1, expr2, ...) æ³¨æ„åœ¨å®åå‰æœ‰åŒºåˆ«çš„ @ï¼Œç¬¬ä¸€ç§å½¢å¼çš„å‚æ•°è¡¨è¾¾å¼ä¹‹é—´æ²¡æœ‰é€—å·ï¼Œç¬¬äºŒç§å½¢å¼çš„ @ ååæ²¡æœ‰ç©ºæ ¼ã€‚ä¸¤ç§æ ·å¼ä¸èƒ½æ··ç”¨ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„è¯­æ³•ä¸ä¸Šé¢çš„ä¾‹å­ä¸åŒï¼Œå®ƒå°†å…ƒç»„ (expr1, expr2, \u0026hellip;) ä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ é€’ç»™å®ã€‚\n@name (expr1, expr2, ...) åœ¨æ•°ç»„å­—é¢é‡ï¼ˆæˆ–è§£æï¼‰ä¸Šè°ƒç”¨å®çš„å¦ä¸€ç§æ–¹æ³•æ˜¯å°†ä¸¤è€…å¹¶åˆ—ï¼Œè€Œä¸ä½¿ç”¨æ‹¬å·ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ•°ç»„å°†æ˜¯å”¯ä¸€è¾“å…¥å®çš„è¡¨è¾¾å¼ã€‚ä¸‹é¢çš„è¯­æ³•æ˜¯ç­‰ä»·çš„ï¼ˆä¸ @name [a b] * v ä¸åŒï¼‰ã€‚\n@name[a b] * v @name([a b]) * v éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œå®ä»¥è¡¨è¾¾å¼ã€å­—é¢å€¼æˆ–ç¬¦å·çš„å½¢å¼æ¥æ”¶å…¶å‚æ•°ã€‚æ¢ç´¢å®å‚æ•°çš„ä¸€ç§æ–¹æ³•æ˜¯åœ¨å®ä½“ä¸­è°ƒç”¨ show å‡½æ•°ã€‚\njulia\u0026gt; macro showarg(x) show(x) # ... remainder of macro, returning an expression end @showarg (macro with 1 method) julia\u0026gt; @showarg(a) :a julia\u0026gt; @showarg(1+1) :(1 + 1) julia\u0026gt; @showarg(println(\u0026#34;Yo!\u0026#34;)) :(println(\u0026#34;Yo!\u0026#34;)) é™¤äº†ç»™å®šçš„å‚æ•°åˆ—è¡¨ä¹‹å¤–ï¼Œæ¯ä¸ªå®éƒ½ä¼šè¢«ä¼ é€’é¢å¤–çš„å‚æ•° __source__ å’Œ __module__ã€‚\nå‚æ•° __source__ æä¾›äº†å…³äºæ¥è‡ªå®è°ƒç”¨çš„ @ ç¬¦å·çš„è§£æå™¨ä½ç½®çš„ä¿¡æ¯ï¼ˆä»¥ LineNumberNode å¯¹è±¡çš„å½¢å¼ï¼‰ã€‚è¿™ä½¿å¾—å®èƒ½å¤ŸåŒ…å«æ›´å¥½çš„é”™è¯¯è¯Šæ–­ä¿¡æ¯ï¼Œå¹¶ä¸”é€šå¸¸è¢«æ—¥å¿—ã€å­—ç¬¦ä¸²è§£æå™¨å®å’Œæ–‡æ¡£ç­‰ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼Œä¹Ÿè¢«ç”¨æ¥å®ç° @LINEã€@FILE å’Œ @DIR å®ã€‚\nä½ç½®ä¿¡æ¯å¯ä»¥é€šè¿‡å¼•ç”¨ __source__.line å’Œ __source__.file æ¥è®¿é—®ã€‚\njulia\u0026gt; macro __LOCATION__(); return QuoteNode(__source__); end @__LOCATION__ (macro with 1 method) julia\u0026gt; dump( @__LOCATION__( )) LineNumberNode line: Int64 2 file: Symbol none å‚æ•° __module__ æä¾›äº†å…³äºå®è°ƒç”¨çš„æ‰©å±•ä¸Šä¸‹æ–‡çš„ä¿¡æ¯ï¼ˆä»¥ Module å¯¹è±¡çš„å½¢å¼ï¼‰ã€‚è¿™å…è®¸å®æŸ¥æ‰¾ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå¦‚ç°æœ‰çš„ç»‘å®šï¼Œæˆ–è€…å°†è¯¥å€¼ä½œä¸ºé¢å¤–çš„å‚æ•°æ’å…¥åˆ°åœ¨å½“å‰æ¨¡å—ä¸­åšè‡ªçœçš„è¿è¡Œæ—¶å‡½æ•°è°ƒç”¨ä¸­ã€‚\næ„å»ºä¸€ä¸ªé«˜çº§å® è¿™é‡Œæ˜¯ Julia çš„ @assert å®çš„ç®€åŒ–å®šä¹‰ã€‚\njulia\u0026gt; macro assert(ex) return :( $ex ? nothing : throw(AssertionError($(string(ex)))) ) end @assert (macro with 1 method) è¿™ä¸ªå®å¯ä»¥è¿™æ ·ä½¿ç”¨ã€‚\njulia\u0026gt; @assert 1 == 1.0 julia\u0026gt; @assert 1 == 0 ERROR: AssertionError: 1 == 0 å®è°ƒç”¨åœ¨è§£ææ—¶æ‰©å±•åˆ°å®ƒçš„è¿”å›ç»“æœã€‚è¿™å°±ç›¸å½“äºå†™ã€‚\n1 == 1.0 ? nothing : throw(AssertionError(\u0026#34;1 == 1.0\u0026#34;)) 1 == 0 ? nothing : throw(AssertionError(\u0026#34;1 == 0\u0026#34;)) ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨ä¸­ï¼Œè¡¨è¾¾å¼ :(1 == 1.0) è¢«æ‹¼æ¥åˆ°æµ‹è¯•æ¡ä»¶æ§½ä¸­ï¼Œè€Œ string(:(1 == 1.0)) çš„å€¼è¢«æ‹¼æ¥åˆ°æ–­è¨€æ¶ˆæ¯æ§½ä¸­ã€‚è¿™æ ·æ„é€ å‡ºæ¥çš„æ•´ä¸ªè¡¨è¾¾å¼ï¼Œå°±è¢«æ”¾åˆ°äº†å‘ç”Ÿ @assert å®è°ƒç”¨çš„è¯­æ³•æ ‘ä¸­ã€‚ç„¶ååœ¨æ‰§è¡Œæ—¶ï¼Œå¦‚æœæµ‹è¯•è¡¨è¾¾å¼è¯„ä¼°ä¸ºçœŸï¼Œé‚£ä¹ˆè¿”å› nothingï¼Œè€Œå¦‚æœæµ‹è¯•ä¸ºå‡ï¼Œåˆ™ä¼šå¼•å‘ä¸€ä¸ªé”™è¯¯ï¼Œè¡¨æ˜æ–­è¨€è¡¨è¾¾å¼æ˜¯å‡çš„ã€‚æ³¨æ„ï¼Œå¦‚æœæŠŠè¿™ä¸ªå†™æˆå‡½æ•°å°±ä¸è¡Œäº†ï¼Œå› ä¸ºåªæœ‰æ¡ä»¶çš„å€¼ï¼Œä¸å¯èƒ½åœ¨é”™è¯¯ä¿¡æ¯ä¸­æ˜¾ç¤ºè®¡ç®—æ¡ä»¶çš„è¡¨è¾¾å¼ã€‚\nJulia Base ä¸­ @assert çš„å®é™…å®šä¹‰æ¯”è¾ƒå¤æ‚ã€‚å®ƒå…è®¸ç”¨æˆ·æœ‰é€‰æ‹©åœ°æŒ‡å®šè‡ªå·±çš„é”™è¯¯ä¿¡æ¯ï¼Œè€Œä¸æ˜¯åªæ‰“å°å¤±è´¥çš„è¡¨è¾¾å¼ã€‚å°±åƒåœ¨å‚æ•°æ•°å¯å˜çš„å‡½æ•°ï¼ˆVarargs Functionsï¼‰ä¸­ä¸€æ ·ï¼Œåœ¨æœ€åä¸€ä¸ªå‚æ•°åé¢ç”¨çœç•¥å·æ¥æŒ‡å®šã€‚\njulia\u0026gt; macro assert(ex, msgs...) msg_body = isempty(msgs) ? ex : msgs[1] msg = string(msg_body) return :($ex ? nothing : throw(AssertionError($msg))) end @assert (macro with 1 method) ç°åœ¨ @assert æœ‰ä¸¤ç§æ“ä½œæ¨¡å¼ï¼Œå–å†³äºå®ƒæ¥æ”¶åˆ°çš„å‚æ•°æ•°é‡ï¼å¦‚æœåªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆ msgs æ•è·çš„è¡¨è¾¾å¼å…ƒç»„å°†æ˜¯ç©ºçš„ï¼Œå®ƒçš„è¡Œä¸ºå’Œä¸Šé¢çš„ç®€å•å®šä¹‰ä¸€æ ·ã€‚å¦‚æœåªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œmsgs æ•è·çš„è¡¨è¾¾å¼å…ƒç»„å°†æ˜¯ç©ºçš„ï¼Œå®ƒçš„è¡Œä¸ºä¸ä¸Šé¢çš„ç®€å•å®šä¹‰ç›¸åŒã€‚ä½†ç°åœ¨å¦‚æœç”¨æˆ·æŒ‡å®šäº†ç¬¬äºŒä¸ªå‚æ•°ï¼Œå®ƒå°†è¢«æ‰“å°åœ¨æ¶ˆæ¯æ­£æ–‡ä¸­ï¼Œè€Œä¸æ˜¯å¤±è´¥çš„è¡¨è¾¾å¼ã€‚ä½ å¯ä»¥ç”¨ @macroexpand å®æ¥æ£€æŸ¥å®æ‰©å±•çš„ç»“æœã€‚\njulia\u0026gt; @macroexpand @assert a == b :(if Main.a == Main.b Main.nothing else Main.throw(Main.AssertionError(\u0026#34;a == b\u0026#34;)) end) julia\u0026gt; @macroexpand @assert a==b \u0026#34;a should equal b!\u0026#34; :(if Main.a == Main.b Main.nothing else Main.throw(Main.AssertionError(\u0026#34;a should equal b!\u0026#34;)) end) å®é™…çš„ @assert å®è¿˜å¯ä»¥å¤„ç†å¦ä¸€ç§æƒ…å†µï¼šå¦‚æœé™¤äº†æ‰“å° \u0026ldquo;a should equal b\u0026rdquo; ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜æƒ³æ‰“å°å®ƒä»¬çš„å€¼å‘¢ï¼Ÿäººä»¬å¯èƒ½ä¼šå¤©çœŸåœ°å°è¯•åœ¨è‡ªå®šä¹‰æ¶ˆæ¯ä¸­ä½¿ç”¨å­—ç¬¦ä¸²æ’å€¼ï¼Œä¾‹å¦‚ï¼Œ@assert a==b \u0026quot;a ($a) should equal b ($b)!\u0026quot;ï¼Œä½†è¿™åœ¨ä¸Šé¢çš„å®ä¸­ä¸ä¼šåƒé¢„æœŸçš„é‚£æ ·å·¥ä½œã€‚ä½ èƒ½æ˜ç™½ä¸ºä»€ä¹ˆå—ï¼Ÿä»å­—ç¬¦ä¸²æ’å€¼å›æƒ³ä¸€ä¸‹ï¼Œæ’å€¼åçš„å­—ç¬¦ä¸²ä¼šè¢«æ”¹å†™æˆå¯¹å­—ç¬¦ä¸²çš„è°ƒç”¨ã€‚æ¯”è¾ƒä¸€ä¸‹ã€‚\njulia\u0026gt; typeof(:(\u0026#34;a should equal b\u0026#34;)) String julia\u0026gt; typeof(:(\u0026#34;a ($a) should equal b ($b)!\u0026#34;)) Expr julia\u0026gt; dump(:(\u0026#34;a ($a) should equal b ($b)!\u0026#34;)) Expr head: Symbol string args: Array{Any}((5,)) 1: String \u0026#34;a (\u0026#34; 2: Symbol a 3: String \u0026#34;) should equal b (\u0026#34; 4: Symbol b 5: String \u0026#34;)!\u0026#34; å› æ­¤ï¼Œç°åœ¨å®ä¸æ˜¯åœ¨ msg_body ä¸­å¾—åˆ°ä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯æ¥æ”¶ä¸€ä¸ªå®Œæ•´çš„è¡¨è¾¾å¼ï¼Œè¿™ä¸ªè¡¨è¾¾å¼éœ€è¦è¢«è¯„ä¼°ï¼Œä»¥ä¾¿æŒ‰ç…§é¢„æœŸçš„æ–¹å¼æ˜¾ç¤ºã€‚è¿™å¯ä»¥ç›´æ¥æ‹¼æ¥åˆ°è¿”å›çš„è¡¨è¾¾å¼ä¸­ï¼Œä½œä¸ºå­—ç¬¦ä¸²è°ƒç”¨çš„ä¸€ä¸ªå‚æ•°ï¼›å®Œæ•´çš„å®ç°è¯·å‚è§ error.jlã€‚\n@assert å®å¾ˆå¥½åœ°åˆ©ç”¨äº†æ‹¼æ¥æˆå¼•å·çš„è¡¨è¾¾å¼ï¼Œç®€åŒ–äº†å®ä½“å†…éƒ¨å¯¹è¡¨è¾¾å¼çš„æ“ä½œã€‚\nå«ç”Ÿå® åœ¨æ¯”è¾ƒå¤æ‚çš„å®ä¸­ä¼šå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯å«ç”Ÿé—®é¢˜ã€‚ç®€è€Œè¨€ä¹‹ï¼Œå®å¿…é¡»ç¡®ä¿å®ƒä»¬åœ¨è¿”å›çš„è¡¨è¾¾å¼ä¸­å¼•å…¥çš„å˜é‡ä¸ä¼šæ„å¤–åœ°ä¸å®ƒä»¬æ‰©å±•åˆ°çš„å‘¨å›´ä»£ç ä¸­çš„ç°æœ‰å˜é‡å‘ç”Ÿå†²çªã€‚ç›¸åï¼Œä½œä¸ºå‚æ•°ä¼ å…¥å®ä¸­çš„è¡¨è¾¾å¼å¾€å¾€è¦åœ¨å‘¨å›´ä»£ç çš„ä¸Šä¸‹æ–‡ä¸­è¿›è¡Œè¯„ä¼°ï¼Œä¸ç°æœ‰å˜é‡è¿›è¡Œäº¤äº’å’Œä¿®æ”¹ã€‚å¦ä¸€ä¸ªå…³æ³¨ç‚¹æ¥è‡ªäºä¸€ä¸ªäº‹å®ï¼Œå³ä¸€ä¸ªå®å¯èƒ½ä¼šåœ¨ä¸å®ƒè¢«å®šä¹‰çš„æ¨¡å—ä¸åŒçš„åœ°æ–¹è¢«è°ƒç”¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿æ‰€æœ‰çš„å…¨å±€å˜é‡è¢«è§£æåˆ°æ­£ç¡®çš„æ¨¡å—ä¸­ã€‚ä¸å…·æœ‰æ–‡æœ¬å®æ‰©å±•çš„è¯­è¨€ï¼ˆå¦‚Cè¯­è¨€ï¼‰ç›¸æ¯”ï¼ŒJulia å·²ç»æœ‰äº†å¾ˆå¤§çš„ä¼˜åŠ¿ï¼Œå› ä¸ºå®ƒåªéœ€è¦è€ƒè™‘è¿”å›çš„è¡¨è¾¾å¼ã€‚æ‰€æœ‰å…¶ä»–çš„å˜é‡ï¼ˆæ¯”å¦‚ä¸Šé¢ @assert ä¸­çš„ msgï¼‰éƒ½éµå¾ªæ­£å¸¸çš„ä½œç”¨åŸŸå—è¡Œä¸ºã€‚\nä¸ºäº†è¯æ˜è¿™äº›é—®é¢˜ï¼Œè®©æˆ‘ä»¬è€ƒè™‘å†™ä¸€ä¸ª @time å®ï¼Œå®ƒæ¥å—ä¸€ä¸ªè¡¨è¾¾å¼ä½œä¸ºå‚æ•°ï¼Œè®°å½•æ—¶é—´ï¼Œè¯„ä¼°è¡¨è¾¾å¼ï¼Œå†æ¬¡è®°å½•æ—¶é—´ï¼Œæ‰“å°å‰åæ—¶é—´çš„å·®å€¼ï¼Œç„¶åä»¥è¡¨è¾¾å¼çš„å€¼ä½œä¸ºå…¶æœ€ç»ˆå€¼ã€‚è¿™ä¸ªå®å¯èƒ½æ˜¯è¿™æ ·çš„ã€‚\nmacro time(ex) return quote local t0 = time_ns() local val = $ex local t1 = time_ns() println(\u0026#34;elapsed time: \u0026#34;, (t1-t0)/1e9, \u0026#34; seconds\u0026#34;) val end end åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¸Œæœ› t0ã€t1 å’Œ val æ˜¯ç§æœ‰çš„ä¸´æ—¶å˜é‡ï¼Œæˆ‘ä»¬å¸Œæœ› time å¼•ç”¨ Julia Base ä¸­çš„ time å‡½æ•°ï¼Œè€Œä¸æ˜¯ç”¨æˆ·å¯èƒ½æ‹¥æœ‰çš„ä»»ä½• time å˜é‡ï¼ˆåŒæ ·é€‚ç”¨äº printlnï¼‰ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœç”¨æˆ·è¡¨è¾¾å¼ ex ä¹ŸåŒ…å«äº†å¯¹ä¸€ä¸ªå« t0 çš„å˜é‡çš„èµ‹å€¼ï¼Œæˆ–è€…å®šä¹‰äº†è‡ªå·±çš„ time å˜é‡ï¼Œå¯èƒ½ä¼šå‡ºç°çš„é—®é¢˜ã€‚æˆ‘ä»¬å¯èƒ½ä¼šå¾—åˆ°é”™è¯¯ï¼Œæˆ–è€…ç¥ç§˜çš„ä¸æ­£ç¡®è¡Œä¸ºã€‚\nJulia çš„å®æ‰©å±•å™¨ç”¨ä»¥ä¸‹æ–¹å¼è§£å†³äº†è¿™äº›é—®é¢˜ã€‚é¦–å…ˆï¼Œå®ç»“æœä¸­çš„å˜é‡è¢«åˆ†ä¸ºå±€éƒ¨æˆ–å…¨å±€ã€‚å¦‚æœä¸€ä¸ªå˜é‡è¢«åˆ†é…ç»™ï¼ˆè€Œä¸æ˜¯å£°æ˜ä¸ºå…¨å±€ï¼‰ã€å£°æ˜ä¸ºå±€éƒ¨ï¼Œæˆ–è€…è¢«ç”¨ä½œå‡½æ•°å‚æ•°åï¼Œé‚£ä¹ˆå®ƒè¢«è®¤ä¸ºæ˜¯å±€éƒ¨çš„ã€‚å¦åˆ™ï¼Œå®ƒè¢«è®¤ä¸ºæ˜¯å…¨å±€å˜é‡ã€‚å±€éƒ¨å˜é‡å°±ä¼šè¢«é‡å‘½åä¸ºå”¯ä¸€çš„ï¼ˆä½¿ç”¨ gensym å‡½æ•°ï¼Œç”Ÿæˆæ–°çš„ç¬¦å·ï¼‰ï¼Œå…¨å±€å˜é‡åˆ™åœ¨å®å®šä¹‰ç¯å¢ƒä¸­è§£å†³ã€‚å› æ­¤ï¼Œä¸Šè¿°ä¸¤ä¸ªé—®é¢˜éƒ½å¾—åˆ°äº†å¤„ç†ï¼›å®çš„å±€éƒ¨å˜é‡ä¸ä¼šä¸ä»»ä½•ç”¨æˆ·å˜é‡å†²çªï¼Œtime å’Œ println å°†å¼•ç”¨ Julia Base å®šä¹‰ã€‚\nç„¶è€Œï¼Œä»ç„¶å­˜åœ¨ä¸€ä¸ªé—®é¢˜ã€‚è€ƒè™‘ä¸‹é¢è¿™ä¸ªå®çš„ä½¿ç”¨ã€‚\nmodule MyModule import Base.@time time() = ... # compute something @time time() end è¿™é‡Œçš„ç”¨æˆ·è¡¨è¾¾å¼ ex æ˜¯å¯¹ time çš„è°ƒç”¨ï¼Œä½†ä¸æ˜¯å®ä½¿ç”¨çš„é‚£ä¸ª time å‡½æ•°ã€‚å®ƒæ˜¾ç„¶æ˜¯æŒ‡ MyModule.timeã€‚å› æ­¤æˆ‘ä»¬å¿…é¡»å®‰æ’ ex ä¸­çš„ä»£ç åœ¨å®è°ƒç”¨ç¯å¢ƒä¸­è¿›è¡Œè§£æã€‚è¿™å¯ä»¥é€šè¿‡ç”¨ esc å¯¹è¡¨è¾¾å¼è¿›è¡Œ\u0026quot;è½¬ä¹‰\u0026quot;æ¥å®ç°ã€‚\nmacro time(ex) ... local val = $(esc(ex)) ... end ä»¥è¿™ç§æ–¹å¼åŒ…è£…çš„è¡¨è¾¾å¼ï¼Œå®æ‰©å±•å™¨ä¸ä¼šç®¡å®ƒï¼Œåªéœ€é€å­—ç²˜è´´åˆ°è¾“å‡ºä¸­å³å¯ã€‚å› æ­¤å®ƒå°†åœ¨å®è°ƒç”¨ç¯å¢ƒä¸­è¢«è§£æã€‚\nåœ¨å¿…è¦çš„æ—¶å€™ï¼Œå¯ä»¥åˆ©ç”¨è¿™ç§è½¬ä¹‰æœºåˆ¶æ¥\u0026quot;è¿å\u0026quot;å«ç”Ÿï¼Œä»¥ä¾¿å¼•å…¥æˆ–æ“ä½œç”¨æˆ·å˜é‡ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„å®åœ¨è°ƒç”¨ç¯å¢ƒä¸­å°† x è®¾ä¸ºé›¶ã€‚\njulia\u0026gt; macro zerox() return esc(:(x = 0)) end @zerox (macro with 1 method) julia\u0026gt; function foo() x = 1 @zerox return x # is zero end foo (generic function with 1 method) julia\u0026gt; foo() 0 è¿™ç§å¯¹å˜é‡çš„æ“ä½œåº”è°¨æ…ä½¿ç”¨ï¼Œä½†å¶å°”ä¹Ÿå¾ˆæ–¹ä¾¿ã€‚\næŒæ¡æ­£ç¡®çš„å«ç”Ÿè§„åˆ™å¯èƒ½æ˜¯ä¸€ä¸ªè‰°å·¨çš„æŒ‘æˆ˜ã€‚åœ¨ä½¿ç”¨å®ä¹‹å‰ï¼Œä½ å¯èƒ½éœ€è¦è€ƒè™‘ä¸€ä¸ªå‡½æ•°é—­åŒ…æ˜¯å¦è¶³å¤Ÿã€‚å¦ä¸€ä¸ªæœ‰ç”¨çš„ç­–ç•¥æ˜¯å°†å°½å¯èƒ½å¤šçš„å·¥ä½œæ¨è¿Ÿåˆ°è¿è¡Œæ—¶ã€‚ä¾‹å¦‚ï¼Œè®¸å¤šå®ç®€å•åœ°å°†å…¶å‚æ•°åŒ…è£¹åœ¨ QuoteNode æˆ–å…¶ä»–ç±»ä¼¼çš„ Expr ä¸­ã€‚ä¸€äº›ä¾‹å­åŒ…æ‹¬ @task bodyï¼Œå®ƒç®€å•åœ°è¿”å› schedule(Task(()-\u0026gt; $body))ï¼Œä»¥åŠ @eval exprï¼Œå®ƒç®€å•åœ°è¿”å› eval(QuoteNode(expr))ã€‚\nä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸Šé¢çš„ @time ä¾‹å­é‡å†™ä¸ºã€‚\nmacro time(expr) return :(timeit(() -\u0026gt; $(esc(expr)))) end function timeit(f) t0 = time_ns() val = f() t1 = time_ns() println(\u0026#34;elapsed time: \u0026#34;, (t1-t0)/1e9, \u0026#34; seconds\u0026#34;) return val end ç„¶è€Œï¼Œæˆ‘ä»¬ä¸è¿™æ ·åšæ˜¯æœ‰å……åˆ†çš„ç†ç”±çš„ï¼šå°† expr åŒ…è£…åœ¨ä¸€ä¸ªæ–°çš„ä½œç”¨åŸŸå—ä¸­ï¼ˆåŒ¿åå‡½æ•°ï¼‰ä¹Ÿä¼šç¨å¾®æ”¹å˜è¡¨è¾¾å¼çš„å«ä¹‰ï¼ˆå…¶ä¸­ä»»ä½•å˜é‡çš„ä½œç”¨åŸŸï¼‰ï¼ŒåŒæ—¶æˆ‘ä»¬å¸Œæœ› @time å¯ä»¥ä½¿ç”¨ï¼Œè€Œå¯¹è¢«åŒ…è£…çš„ä»£ç å½±å“æœ€å°ã€‚\nå®å’Œè°ƒåº¦ å®ï¼Œå°±åƒ Julia å‡½æ•°ä¸€æ ·ï¼Œæ˜¯é€šç”¨çš„ã€‚è¿™æ„å‘³ç€å®ƒä»¬ä¹Ÿå¯ä»¥æœ‰å¤šä¸ªæ–¹æ³•å®šä¹‰ï¼Œè¿™è¦å½’åŠŸäºå¤šé‡åˆ†æ´¾ã€‚\njulia\u0026gt; macro m end @m (macro with 0 methods) julia\u0026gt; macro m(args...) println(\u0026#34;$(length(args))arguments\u0026#34;) end @m (macro with 1 method) julia\u0026gt; macro m(x,y) println(\u0026#34;Two arguments\u0026#34;) end @m (macro with 2 methods) julia\u0026gt; @m \u0026#34;asd\u0026#34; 1 arguments julia\u0026gt; @m 1 2 Two arguments ç„¶è€Œæˆ‘ä»¬åº”è¯¥è®°ä½ï¼Œå®è°ƒåº¦æ˜¯åŸºäºäº¤ç»™å®çš„ AST ç±»å‹ï¼Œè€Œä¸æ˜¯ AST åœ¨è¿è¡Œæ—¶è¯„ä¼°çš„ç±»å‹ã€‚\njulia\u0026gt; macro m(::Int) println(\u0026#34;An Integer\u0026#34;) end @m (macro with 3 methods) julia\u0026gt; @m 2 An Integer julia\u0026gt; x = 2 2 julia\u0026gt; @m x 1 arguments ä»£ç ç”Ÿæˆ å½“éœ€è¦å¤§é‡é‡å¤çš„æ¨¡æ¿ä»£ç æ—¶ï¼Œé€šå¸¸ä¼šä»¥ç¼–ç¨‹æ–¹å¼ç”Ÿæˆï¼Œä»¥é¿å…å†—ä½™ã€‚åœ¨å¤§å¤šæ•°è¯­è¨€ä¸­ï¼Œè¿™éœ€è¦ä¸€ä¸ªé¢å¤–çš„æ„å»ºæ­¥éª¤ï¼Œä»¥åŠä¸€ä¸ªå•ç‹¬çš„ç¨‹åºæ¥ç”Ÿæˆé‡å¤çš„ä»£ç ã€‚åœ¨ Julia ä¸­ï¼Œè¡¨è¾¾å¼æ’å€¼å’Œ eval å…è®¸è¿™æ ·çš„ä»£ç ç”Ÿæˆåœ¨ç¨‹åºæ‰§è¡Œçš„æ­£å¸¸è¿‡ç¨‹ä¸­è¿›è¡Œã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä»¥ä¸‹è‡ªå®šä¹‰ç±»å‹\nstruct MyNumber x::Float64 end # output æˆ‘ä»¬æƒ³ä¸ºå…¶æ·»åŠ ä¸€äº›æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä¸‹é¢çš„å¾ªç¯ä¸­ä»¥ç¼–ç¨‹çš„æ–¹å¼è¿›è¡Œã€‚\nfor op = (:sin, :cos, :tan, :log, :exp) eval(quote Base.$op(a::MyNumber) = MyNumber($op(a.x)) end) end # output ç°åœ¨æˆ‘ä»¬å¯ä»¥ç”¨æˆ‘ä»¬çš„è‡ªå®šä¹‰ç±»å‹æ¥ä½¿ç”¨è¿™äº›å‡½æ•°ã€‚\njulia\u0026gt; x = MyNumber(Ï€) MyNumber(3.141592653589793) julia\u0026gt; sin(x) MyNumber(1.2246467991473532e-16) julia\u0026gt; cos(x) MyNumber(-1.0) è¿™æ ·ä¸€æ¥ï¼ŒJulia å°±åƒè‡ªå·±çš„é¢„å¤„ç†å™¨ä¸€æ ·ï¼Œå¯ä»¥ä»è¯­è¨€å†…éƒ¨ç”Ÿæˆä»£ç ã€‚ä¸Šé¢çš„ä»£ç å¯ä»¥ä½¿ç”¨ : å‰ç¼€å¼•å·çš„å½¢å¼ï¼Œå†™å¾—ç¨æ˜¾ç”Ÿç¡¬ã€‚\nfor op = (:sin, :cos, :tan, :log, :exp) eval(:(Base.$op(a::MyNumber) = MyNumber($op(a.x)))) end ä¸è¿‡ï¼Œè¿™ç§ä½¿ç”¨ eval(quote(...)) æ¨¡å¼ç”Ÿæˆçš„è¯­è¨€å†…ä»£ç å¾ˆå¸¸è§ï¼Œæ‰€ä»¥ Julia è‡ªå¸¦äº†ä¸€ä¸ªå®æ¥ç¼©å†™è¿™ç§æ¨¡å¼ã€‚\nfor op = (:sin, :cos, :tan, :log, :exp) @eval Base.$op(a::MyNumber) = MyNumber($op(a.x)) end @eval å®é‡å†™äº†è¿™ä¸ªè°ƒç”¨ï¼Œä½¿ä¹‹ä¸ä¸Šè¿°è¾ƒé•¿ç‰ˆæœ¬çš„è°ƒç”¨å®Œå…¨ç­‰åŒã€‚å¯¹äºè¾ƒé•¿çš„ç”Ÿæˆä»£ç å—ï¼Œç»™ @eval çš„è¡¨è¾¾å¼å‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªå—ã€‚\n@eval begin # multiple lines end éæ ‡å‡†å­—ç¬¦ä¸²å­—é¢å€¼ ä» Strings ä¸­å›æƒ³ä¸€ä¸‹ï¼Œä»¥æ ‡è¯†ç¬¦ä¸ºå‰ç¼€çš„å­—ç¬¦ä¸²å­—å…ƒç§°ä¸ºéæ ‡å‡†å­—ç¬¦ä¸²å­—å…ƒï¼Œå…¶è¯­ä¹‰å¯èƒ½ä¸æœªåŠ å‰ç¼€çš„å­—ç¬¦ä¸²å­—é¢å€¼ä¸åŒã€‚ä¾‹å¦‚\nr\u0026rdquo;^\\s*(?:#|$) \u0026ldquo;äº§ç”Ÿä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ b \u0026ldquo;DATA\\xff\\u2200 \u0026ldquo;æ˜¯ä¸€ä¸ª[68,65,84,65,255,226,136,128]çš„å­—èŠ‚æ•°ç»„æ–‡å­—ã€‚ ä¹Ÿè®¸ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œè¿™äº›è¡Œä¸ºå¹¶æ²¡æœ‰è¢«ç¡¬ç¼–ç åˆ°Juliaè§£æå™¨æˆ–ç¼–è¯‘å™¨ä¸­ã€‚ç›¸åï¼Œå®ƒä»¬æ˜¯ç”±ä¸€ä¸ªé€šç”¨æœºåˆ¶æä¾›çš„è‡ªå®šä¹‰è¡Œä¸ºï¼Œä»»ä½•äººéƒ½å¯ä»¥ä½¿ç”¨ï¼šå‰ç¼€çš„å­—ç¬¦ä¸²å­—å…ƒè¢«è§£æä¸ºå¯¹ç‰¹åˆ«å‘½åçš„å®çš„è°ƒç”¨ã€‚ä¾‹å¦‚ï¼Œæ­£åˆ™è¡¨è¾¾å¼å®å°±å¦‚ä¸‹ã€‚\nmacro r_str(p) Regex(p) end å°±æ˜¯è¿™æ ·ã€‚è¿™ä¸ªå®è¡¨ç¤ºåº”è¯¥å°†å­—ç¬¦ä¸²å­—è¯r\u0026rdquo;^\\s*(?:#|$) \u0026ldquo;çš„å­—é¢å†…å®¹ä¼ é€’ç»™@r_strå®ï¼Œå¹¶å°†æ‰©å±•çš„ç»“æœæ”¾å…¥å­—ç¬¦ä¸²å­—è¯å‡ºç°çš„è¯­æ³•æ ‘ä¸­ã€‚æ¢å¥è¯è¯´ï¼Œè¡¨è¾¾å¼r\u0026rdquo;^\\s*(?:#|$) \u0026ldquo;ç›¸å½“äºå°†ä¸‹é¢çš„å¯¹è±¡ç›´æ¥æ”¾å…¥è¯­æ³•æ ‘ä¸­ã€‚\nRegex(\u0026#34;^\\\\s*(?:#|\\$)\u0026#34;) å­—ç¬¦ä¸²å½¢å¼ä¸ä»…æ›´çŸ­ã€æ›´æ–¹ä¾¿ï¼Œè€Œä¸”æ•ˆç‡æ›´é«˜ï¼šç”±äºæ­£åˆ™è¡¨è¾¾å¼æ˜¯ç¼–è¯‘çš„ï¼Œè€ŒRegexå¯¹è±¡å®é™…ä¸Šæ˜¯åœ¨ä»£ç ç¼–è¯‘æ—¶åˆ›å»ºçš„ï¼Œæ‰€ä»¥ç¼–è¯‘åªå‘ç”Ÿä¸€æ¬¡ï¼Œè€Œä¸æ˜¯æ¯æ¬¡æ‰§è¡Œä»£ç æ—¶ã€‚è€ƒè™‘ä¸€ä¸‹å¦‚æœæ­£åˆ™è¡¨è¾¾å¼å‘ç”Ÿåœ¨å¾ªç¯ä¸­ã€‚\nfor line = lines m = match(r\u0026#34;^\\s*(?:#|$)\u0026#34;, line) if m === nothing # non-comment else # comment end end ç”±äºæ­£åˆ™è¡¨è¾¾å¼r\u0026rdquo;^/ds*(?:#|$) \u0026ldquo;åœ¨è§£æè¿™æ®µä»£ç æ—¶è¢«ç¼–è¯‘å¹¶æ’å…¥è¯­æ³•æ ‘ä¸­ï¼Œæ‰€ä»¥è¯¥è¡¨è¾¾å¼åªè¢«ç¼–è¯‘ä¸€æ¬¡ï¼Œè€Œä¸æ˜¯æ¯æ¬¡å¾ªç¯æ‰§è¡Œæ—¶éƒ½è¢«ç¼–è¯‘ã€‚ä¸ºäº†åœ¨ä¸ä½¿ç”¨å®çš„æƒ…å†µä¸‹å®ç°è¿™ä¸ªç›®æ ‡ï¼Œå¿…é¡»è¿™æ ·å†™è¿™ä¸ªå¾ªç¯ã€‚\nre = Regex(\u0026#34;^\\\\s*(?:#|\\$)\u0026#34;) for line = lines m = match(re, line) if m === nothing # non-comment else # comment end end æ­¤å¤–ï¼Œå¦‚æœç¼–è¯‘å™¨ä¸èƒ½ç¡®å®šregexå¯¹è±¡åœ¨æ‰€æœ‰å¾ªç¯ä¸­éƒ½æ˜¯æ’å®šçš„ï¼ŒæŸäº›ä¼˜åŒ–å¯èƒ½å°±æ— æ³•å®ç°ï¼Œè¿™å°±ä½¿å¾—è¿™ä¸ªç‰ˆæœ¬çš„æ•ˆç‡ä»ç„¶ä¸å¦‚ä¸Šé¢æ›´æ–¹ä¾¿çš„æ–‡å­—å½¢å¼ã€‚å½“ç„¶ï¼Œåœ¨æœ‰äº›æƒ…å†µä¸‹ï¼Œéå­—é¢å½¢å¼è¿˜æ˜¯æ¯”è¾ƒæ–¹ä¾¿çš„ï¼šå¦‚æœéœ€è¦åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­æ’å…¥ä¸€ä¸ªå˜é‡ï¼Œå°±å¿…é¡»é‡‡å–è¿™ç§æ¯”è¾ƒå•°å—¦çš„æ–¹å¼ï¼›åœ¨æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼æœ¬èº«æ˜¯åŠ¨æ€çš„ï¼Œæœ‰å¯èƒ½åœ¨æ¯æ¬¡å¾ªç¯è¿­ä»£æ—¶å‘ç”Ÿå˜åŒ–çš„æƒ…å†µä¸‹ï¼Œå¿…é¡»åœ¨æ¯æ¬¡è¿­ä»£æ—¶æ„é€ ä¸€ä¸ªæ–°çš„æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡ã€‚ç„¶è€Œï¼Œåœ¨ç»å¤§å¤šæ•°ç”¨ä¾‹ä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼å¹¶ä¸æ˜¯åŸºäºè¿è¡Œæ—¶æ•°æ®æ¥æ„é€ çš„ã€‚åœ¨è¿™å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå°†æ­£åˆ™è¡¨è¾¾å¼å†™æˆç¼–è¯‘æ—¶å€¼çš„èƒ½åŠ›æ˜¯éå¸¸å®è´µçš„ã€‚\nä¸éæ ‡å‡†å­—ç¬¦ä¸²å­—å…ƒä¸€æ ·ï¼Œéæ ‡å‡†å‘½ä»¤å­—å…ƒä¹Ÿæ˜¯ä½¿ç”¨å‘½ä»¤å­—å…ƒè¯­æ³•çš„å‰ç¼€å˜ä½“å­˜åœ¨çš„ã€‚å‘½ä»¤å­—å…ƒcustomliteralè¢«è§£æä¸º@custom_cmd \u0026ldquo;literal\u0026rdquo;ã€‚Juliaæœ¬èº«ä¸åŒ…å«ä»»ä½•éæ ‡å‡†çš„å‘½ä»¤å­—å…ƒï¼Œä½†åŒ…å¯ä»¥åˆ©ç”¨è¿™ç§è¯­æ³•ã€‚é™¤äº†è¯­æ³•ä¸åŒå’Œç”¨_cmdåç¼€ä»£æ›¿_stråç¼€å¤–ï¼Œéæ ‡å‡†å‘½ä»¤å­—å…ƒçš„è¡Œä¸ºä¸éæ ‡å‡†å­—ç¬¦ä¸²å­—å…ƒå®Œå…¨ç›¸åŒã€‚\nå¦‚æœä¸¤ä¸ªæ¨¡å—æä¾›äº†åç§°ç›¸åŒçš„éæ ‡å‡†å­—ç¬¦ä¸²æˆ–å‘½ä»¤å­—å…ƒï¼Œå¯ä»¥ç”¨æ¨¡å—åç§°æ¥é™å®šå­—ç¬¦ä¸²æˆ–å‘½ä»¤å­—å…ƒã€‚ä¾‹å¦‚ï¼Œå¦‚æœFooå’ŒBaréƒ½æä¾›äº†éæ ‡å‡†çš„å­—ç¬¦ä¸²å­—å…ƒ@x_strï¼Œé‚£ä¹ˆå¯ä»¥å†™æˆFoo.x \u0026ldquo;å­—å…ƒ \u0026ldquo;æˆ–Bar.x \u0026ldquo;å­—å…ƒ \u0026ldquo;æ¥åŒºåˆ†ä¸¤è€…ã€‚\nç”¨æˆ·å®šä¹‰å­—ç¬¦ä¸²å­—å…ƒçš„æœºåˆ¶æ˜¯æ·±åˆ»çš„ã€å¼ºå¤§çš„ã€‚ä¸ä»…Juliaçš„éæ ‡å‡†å­—å…ƒç”¨å®ƒæ¥å®ç°ï¼Œè€Œä¸”å‘½ä»¤å­—å…ƒè¯­æ³•ï¼ˆecho \u0026quot;Hello, $person\u0026quot;ï¼‰ä¹Ÿç”¨ä¸‹é¢è¿™ä¸ªçœ‹ä¼¼æ— å®³çš„å®æ¥å®ç°ã€‚\nmacro cmd(str) :(cmd_gen($(shell_parse(str)[1]))) end å½“ç„¶ï¼Œè¿™ä¸ªå®å®šä¹‰ä¸­ä½¿ç”¨çš„å‡½æ•°ä¸­éšè—ç€å¤§é‡çš„å¤æ‚æ€§ï¼Œä½†å®ƒä»¬åªæ˜¯å‡½æ•°ï¼Œå®Œå…¨æ˜¯ç”¨Juliaç¼–å†™çš„ã€‚ä½ å¯ä»¥é˜…è¯»å®ƒä»¬çš„æºç ï¼Œå¹¶ç²¾ç¡®åœ°çœ‹åˆ°å®ƒä»¬çš„ä½œç”¨\u0026ndash;å®ƒä»¬æ‰€åšçš„åªæ˜¯æ„é€ è¡¨è¾¾å¼å¯¹è±¡ï¼Œä»¥ä¾¿æ’å…¥åˆ°ä½ çš„ç¨‹åºçš„è¯­æ³•æ ‘ä¸­ã€‚\nç”Ÿæˆçš„å‡½æ•°\nä¸€ä¸ªéå¸¸ç‰¹æ®Šçš„å®æ˜¯@generatedï¼Œå®ƒå…è®¸ä½ å®šä¹‰æ‰€è°“çš„ç”Ÿæˆå‡½æ•°ã€‚è¿™äº›å‡½æ•°èƒ½å¤Ÿæ ¹æ®å…¶å‚æ•°çš„ç±»å‹ç”Ÿæˆä¸“é—¨çš„ä»£ç ï¼Œå…¶çµæ´»æ€§å’Œ/æˆ–ä»£ç é‡æ¯”ä½¿ç”¨å¤šé‡è°ƒåº¦æ—¶æ›´å°‘ã€‚å®åœ¨è§£ææ—¶ä¸è¡¨è¾¾å¼ä¸€èµ·å·¥ä½œï¼Œä¸èƒ½è®¿é—®å…¶è¾“å…¥çš„ç±»å‹ï¼Œè€Œç”Ÿæˆå‡½æ•°åœ¨å‚æ•°ç±»å‹å·²çŸ¥æ—¶å¾—åˆ°æ‰©å±•ï¼Œä½†å‡½æ•°å°šæœªç¼–è¯‘ã€‚\nç”Ÿæˆå‡½æ•°å£°æ˜ä¸æ˜¯æ‰§è¡Œä¸€äº›è®¡ç®—æˆ–åŠ¨ä½œï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªå¼•å·çš„è¡¨è¾¾å¼ï¼Œç„¶åå½¢æˆä¸å‚æ•°ç±»å‹ç›¸å¯¹åº”çš„æ–¹æ³•çš„ä¸»ä½“ã€‚å½“ä¸€ä¸ªç”Ÿæˆå‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå®ƒè¿”å›çš„è¡¨è¾¾å¼ä¼šè¢«ç¼–è¯‘ï¼Œç„¶åè¿è¡Œã€‚ä¸ºäº†æé«˜æ•ˆç‡ï¼Œé€šå¸¸ä¼šå¯¹ç»“æœè¿›è¡Œç¼“å­˜ã€‚è€Œä¸ºäº†ä½¿ä¹‹å¯æ¨æ–­ï¼Œåªæœ‰æœ‰é™çš„è¯­è¨€å­é›†å¯ä»¥ä½¿ç”¨ã€‚å› æ­¤ï¼Œç”Ÿæˆå‡½æ•°æä¾›äº†ä¸€ç§çµæ´»çš„æ–¹å¼ï¼Œå°†å·¥ä½œä»è¿è¡Œæ—¶è½¬ç§»åˆ°ç¼–è¯‘æ—¶ï¼Œä½†ä»£ä»·æ˜¯å¯¹å…è®¸çš„æ„é€ æœ‰æ›´å¤§çš„é™åˆ¶ã€‚\nåœ¨å®šä¹‰ç”Ÿæˆå‡½æ•°æ—¶ï¼Œä¸æ™®é€šå‡½æ•°æœ‰äº”ä¸ªä¸»è¦åŒºåˆ«ã€‚\nä½ ç”¨ @generated å®æ¥æ³¨é‡Šå‡½æ•°å£°æ˜ã€‚è¿™åœ¨ASTä¸­æ·»åŠ äº†ä¸€äº›ä¿¡æ¯ï¼Œè®©ç¼–è¯‘å™¨çŸ¥é“è¿™æ˜¯ä¸€ä¸ªç”Ÿæˆå‡½æ•°ã€‚ åœ¨ç”Ÿæˆå‡½æ•°çš„ä¸»ä½“ä¸­ï¼Œä½ åªèƒ½è®¿é—®å‚æ•°çš„ç±»å‹ï¼Œè€Œä¸èƒ½è®¿é—®å®ƒä»¬çš„å€¼ã€‚ ä½ ä¸æ˜¯è®¡ç®—ä¸€äº›ä¸œè¥¿æˆ–æ‰§è¡Œä¸€äº›æ“ä½œï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªå¼•å·çš„è¡¨è¾¾å¼ï¼Œå½“å®ƒè¢«è¯„ä¼°æ—¶ï¼Œå°±ä¼šæ‰§è¡Œä½ æƒ³è¦çš„ä¸œè¥¿ã€‚ ç”Ÿæˆå‡½æ•°åªå…è®¸è°ƒç”¨åœ¨ç”Ÿæˆå‡½æ•°å®šä¹‰ä¹‹å‰å®šä¹‰çš„å‡½æ•°ã€‚(å¦‚æœä¸éµå®ˆè¿™ä¸€ç‚¹ï¼Œå¯èƒ½ä¼šå¾—åˆ°å¼•ç”¨æœªæ¥ä¸–ç•Œæ—¶ä»£å‡½æ•°çš„MethodErrorsã€‚) ç”Ÿæˆçš„å‡½æ•°ä¸å¾—çªå˜æˆ–è§‚å¯Ÿä»»ä½•éå¸¸æ€çš„å…¨å±€çŠ¶æ€ï¼ˆåŒ…æ‹¬ï¼Œä¾‹å¦‚ï¼ŒIOã€é”ã€éæœ¬åœ°å­—å…¸æˆ–ä½¿ç”¨hasmethodï¼‰ã€‚è¿™æ„å‘³ç€å®ƒä»¬åªèƒ½è¯»å–å…¨å±€å¸¸é‡ï¼Œä¸èƒ½æœ‰ä»»ä½•å‰¯ä½œç”¨ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒä»¬å¿…é¡»æ˜¯å®Œå…¨çº¯ç²¹çš„ã€‚ç”±äºå®ç°ä¸Šçš„é™åˆ¶ï¼Œè¿™ä¹Ÿæ„å‘³ç€å®ƒä»¬ç›®å‰ä¸èƒ½å®šä¹‰é—­åŒ…æˆ–ç”Ÿæˆå™¨ã€‚ ç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜è¿™ä¸€ç‚¹æ˜¯æœ€ç®€å•çš„ã€‚æˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªç”Ÿæˆå‡½æ•°fooå£°æ˜ä¸º\njulia\u0026gt; @generated function foo(x) Core.println(x) return :(x * x) end foo (generic function with 1 method) è¯·æ³¨æ„ï¼Œå‡½æ•°ä½“è¿”å›çš„æ˜¯ä¸€ä¸ªå¼•å·è¡¨è¾¾å¼ï¼Œå³:(x * x)ï¼Œè€Œä¸ä»…ä»…æ˜¯x * xçš„å€¼ã€‚\nä»è°ƒç”¨è€…çš„è§’åº¦æ¥çœ‹ï¼Œè¿™å’Œæ­£åˆ™å‡½æ•°æ˜¯ä¸€æ ·çš„ï¼›äº‹å®ä¸Šï¼Œä½ ä¸å¿…çŸ¥é“ä½ è°ƒç”¨çš„æ˜¯æ­£åˆ™å‡½æ•°è¿˜æ˜¯ç”Ÿæˆå‡½æ•°ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹fooæ˜¯å¦‚ä½•è¡¨ç°çš„ã€‚\njulia\u0026gt; x = foo(2); # note: output is from println() statement in the body Int64 julia\u0026gt; x # now we print x 4 julia\u0026gt; y = foo(\u0026#34;bar\u0026#34;); String julia\u0026gt; y \u0026#34;barbar\u0026#34; æ‰€ä»¥ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼Œåœ¨ç”Ÿæˆå‡½æ•°çš„ä¸»ä½“ä¸­ï¼Œxæ˜¯ä¼ é€’çš„å‚æ•°çš„ç±»å‹ï¼Œè€Œç”Ÿæˆå‡½æ•°è¿”å›çš„å€¼ï¼Œæ˜¯æˆ‘ä»¬ä»å®šä¹‰ä¸­è¿”å›çš„å¼•ç”¨è¡¨è¾¾å¼çš„è¯„ä¼°ç»“æœï¼Œç°åœ¨çš„å€¼æ˜¯xã€‚\nå¦‚æœæˆ‘ä»¬ç”¨å·²ç»ä½¿ç”¨è¿‡çš„ç±»å‹å†æ¬¡è¯„ä¼°fooï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ\njulia\u0026gt; foo(4) 16 æ³¨æ„ï¼Œæ²¡æœ‰æ‰“å°å‡ºInt64çš„ç»“æœã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œåªé’ˆå¯¹ç‰¹å®šçš„å‚æ•°ç±»å‹é›†æ‰§è¡Œäº†ä¸€æ¬¡ç”Ÿæˆå‡½æ•°çš„ä¸»ä½“ï¼Œç»“æœè¢«ç¼“å­˜ã€‚ä¹‹åï¼Œå¯¹äºæœ¬ä¾‹æ¥è¯´ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ç”Ÿæˆå‡½æ•°è¿”å›çš„è¡¨è¾¾å¼è¢«é‡æ–°ç”¨ä½œæ–¹æ³•ä½“ã€‚ä½†æ˜¯ï¼Œå®é™…çš„ç¼“å­˜è¡Œä¸ºæ˜¯ä¸€ç§å®ç°å®šä¹‰çš„æ€§èƒ½ä¼˜åŒ–ï¼Œæ‰€ä»¥è¿‡äºä¾èµ–è¿™ç§è¡Œä¸ºæ˜¯æ— æ•ˆçš„ã€‚\nç”Ÿæˆå‡½æ•°çš„æ¬¡æ•°å¯èƒ½åªæœ‰ä¸€æ¬¡ï¼Œä½†ä¹Ÿå¯èƒ½æ›´é¢‘ç¹ï¼Œæˆ–è€…çœ‹èµ·æ¥æ ¹æœ¬æ²¡æœ‰å‘ç”Ÿã€‚å› æ­¤ï¼Œä½ æ°¸è¿œä¸åº”è¯¥å†™ä¸€ä¸ªæœ‰å‰¯ä½œç”¨çš„ç”Ÿæˆå‡½æ•°\u0026ndash;å‰¯ä½œç”¨ä½•æ—¶å‘ç”Ÿï¼Œå¤šä¹…å‘ç”Ÿä¸€æ¬¡ï¼Œéƒ½æ˜¯æ²¡æœ‰å®šä¹‰çš„ã€‚(è¿™å¯¹å®æ¥è¯´ä¹Ÿæ˜¯å¦‚æ­¤\u0026ndash;å°±åƒå¯¹å®ä¸€æ ·ï¼Œåœ¨ç”Ÿæˆå‡½æ•°ä¸­ä½¿ç”¨evalæ˜¯ä¸€ä¸ªæ ‡å¿—ï¼Œè¡¨æ˜ä½ åšäº†ä¸€äº›é”™è¯¯çš„äº‹æƒ…ã€‚) ç„¶è€Œï¼Œä¸å®ä¸åŒçš„æ˜¯ï¼Œè¿è¡Œæ—¶ç³»ç»Ÿæ— æ³•æ­£ç¡®å¤„ç†å¯¹evalçš„è°ƒç”¨ï¼Œæ‰€ä»¥ä¸å…è®¸ä½¿ç”¨å®ƒã€‚\nåŒæ ·é‡è¦çš„æ˜¯çœ‹@ç”Ÿæˆå‡½æ•°å¦‚ä½•ä¸æ–¹æ³•é‡æ–°å®šä¹‰äº¤äº’ã€‚æŒ‰ç…§æ­£ç¡®çš„@ç”Ÿæˆå‡½æ•°ä¸èƒ½è§‚å¯Ÿä»»ä½•å¯çªå˜çš„çŠ¶æ€æˆ–å¼•èµ·ä»»ä½•å…¨å±€çŠ¶æ€çš„çªå˜çš„åŸåˆ™ï¼Œæˆ‘ä»¬çœ‹åˆ°ä»¥ä¸‹è¡Œä¸ºã€‚è§‚å¯Ÿç”Ÿæˆå‡½æ•°ä¸èƒ½è°ƒç”¨ä»»ä½•åœ¨ç”Ÿæˆå‡½æ•°æœ¬èº«å®šä¹‰ä¹‹å‰æ²¡æœ‰å®šä¹‰çš„æ–¹æ³•ã€‚\næœ€åˆf(x)æœ‰ä¸€ä¸ªå®šä¹‰\njulia\u0026gt; f(x) = \u0026#34;original definition\u0026#34;; å®šä¹‰å…¶ä»–ä½¿ç”¨f(x)çš„æ“ä½œã€‚\njulia\u0026gt; g(x) = f(x); julia\u0026gt; @generated gen1(x) = f(x); julia\u0026gt; @generated gen2(x) = :(f(x)); ç°åœ¨æˆ‘ä»¬ä¸ºf(x)æ·»åŠ ä¸€äº›æ–°çš„å®šä¹‰ã€‚\njulia\u0026gt; f(x::Int) = \u0026#34;definition for Int\u0026#34;; julia\u0026gt; f(x::Type{Int}) = \u0026#34;definition for Type{Int}\u0026#34;; å¹¶æ¯”è¾ƒè¿™äº›ç»“æœæœ‰ä½•ä¸åŒã€‚\njulia\u0026gt; f(1) \u0026#34;definition for Int\u0026#34; julia\u0026gt; g(1) \u0026#34;definition for Int\u0026#34; julia\u0026gt; gen1(1) \u0026#34;original definition\u0026#34; julia\u0026gt; gen2(1) \u0026#34;definition for Int\u0026#34; ç”Ÿæˆå‡½æ•°çš„æ¯ä¸ªæ–¹æ³•éƒ½æœ‰è‡ªå·±çš„å®šä¹‰å‡½æ•°è§†å›¾ã€‚\njulia\u0026gt; @generated gen1(x::Real) = f(x); julia\u0026gt; gen1(1) \u0026#34;definition for Type{Int}\u0026#34; ä¸Šé¢çš„ç”Ÿæˆå‡½æ•°fooä¾‹å­å¹¶æ²¡æœ‰åšä»»ä½•æ™®é€šå‡½æ•°foo(x) = x * xä¸èƒ½åšçš„äº‹æƒ…ï¼ˆé™¤äº†åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶æ‰“å°ç±»å‹ï¼Œå¹¶äº§ç”Ÿè¾ƒé«˜çš„å¼€é”€ï¼‰ã€‚ç„¶è€Œï¼Œç”Ÿæˆå‡½æ•°çš„å¼ºå¤§ä¹‹å¤„åœ¨äºå®ƒèƒ½å¤Ÿæ ¹æ®ä¼ é€’ç»™å®ƒçš„ç±»å‹è®¡ç®—ä¸åŒçš„å¼•å·è¡¨è¾¾å¼ã€‚\njulia\u0026gt; @generated function bar(x) if x \u0026lt;: Integer return :(x ^ 2) else return :(x) end end bar (generic function with 1 method) julia\u0026gt; bar(4) 16 julia\u0026gt; bar(\u0026#34;baz\u0026#34;) \u0026#34;baz\u0026#34; (å½“ç„¶ï¼Œè¿™ä¸ªäººä¸ºçš„ä¾‹å­å¯ä»¥æ›´å®¹æ˜“åœ°ä½¿ç”¨å¤šä¸ªè°ƒåº¦æ¥å®ç°\u0026hellip;)\næ»¥ç”¨è¿™ä¸€ç‚¹å°†ç ´åè¿è¡Œæ—¶ç³»ç»Ÿå¹¶å¯¼è‡´æœªå®šä¹‰çš„è¡Œä¸ºã€‚\njulia\u0026gt; @generated function baz(x) if rand() \u0026lt; .9 return :(x^2) else return :(\u0026#34;boo!\u0026#34;) end end baz (generic function with 1 method) ç”±äºç”Ÿæˆçš„å‡½æ•°ä¸»ä½“æ˜¯éç¡®å®šçš„ï¼Œæ‰€ä»¥å®ƒçš„è¡Œä¸ºä»¥åŠæ‰€æœ‰åç»­ä»£ç çš„è¡Œä¸ºéƒ½æ˜¯æœªå®šä¹‰çš„ã€‚\nä¸è¦æŠ„è¢­è¿™äº›ä¾‹å­!\nè¿™äº›ä¾‹å­å¸Œæœ›å¯¹è¯´æ˜ç”Ÿæˆå‡½æ•°çš„å·¥ä½œæ–¹å¼æœ‰æ‰€å¸®åŠ©ï¼ŒåŒ…æ‹¬åœ¨å®šä¹‰ç«¯å’Œè°ƒç”¨ç«¯ï¼›ä½†æ˜¯ï¼Œä¸è¦å¤åˆ¶å®ƒä»¬ï¼ŒåŸå› å¦‚ä¸‹ã€‚\nfooå‡½æ•°æœ‰å‰¯ä½œç”¨ (å¯¹Core.printlnçš„è°ƒç”¨), è€Œè¿™äº›å‰¯ä½œç”¨ç©¶ç«Ÿä½•æ—¶å‘ç”Ÿ, å¤šä¹…å‘ç”Ÿä¸€æ¬¡, æˆ–å‘ç”Ÿå¤šå°‘æ¬¡, éƒ½æ˜¯æ²¡æœ‰å®šä¹‰çš„ barå‡½æ•°è§£å†³äº†ä¸€ä¸ªé—®é¢˜ï¼Œè€Œè¿™ä¸ªé—®é¢˜æœ€å¥½ç”¨å¤šé‡è°ƒåº¦æ¥è§£å†³\u0026ndash;å®šä¹‰bar(x) = xå’Œbar(x::Integer) = x ^ 2ä¼šåšåŒæ ·çš„äº‹æƒ…ï¼Œä½†å®ƒæ—¢ç®€å•åˆå¿«é€Ÿã€‚ bazå‡½æ•°æ˜¯ç—…æ€çš„ è¯·æ³¨æ„ï¼Œåœ¨ç”Ÿæˆçš„å‡½æ•°ä¸­ä¸åº”è¯¥å°è¯•çš„æ“ä½œé›†æ˜¯æ²¡æœ‰é™åˆ¶çš„ï¼Œè¿è¡Œæ—¶ç³»ç»Ÿç›®å‰åªèƒ½æ£€æµ‹åˆ°æ— æ•ˆæ“ä½œçš„ä¸€ä¸ªå­é›†ã€‚è¿˜æœ‰è®¸å¤šå…¶ä»–çš„æ“ä½œä¼šåœ¨ä¸é€šçŸ¥çš„æƒ…å†µä¸‹ç®€å•åœ°ç ´åè¿è¡Œæ—¶ç³»ç»Ÿï¼Œé€šå¸¸ä»¥å¾®å¦™çš„æ–¹å¼ä¸åå®šä¹‰æ²¡æœ‰æ˜æ˜¾çš„è”ç³»ã€‚å› ä¸ºå‡½æ•°ç”Ÿæˆå™¨æ˜¯åœ¨æ¨ç†è¿‡ç¨‹ä¸­è¿è¡Œçš„ï¼Œå®ƒå¿…é¡»å°Šé‡è¯¥ä»£ç çš„æ‰€æœ‰é™åˆ¶ã€‚\nä¸€äº›ä¸åº”è¯¥å°è¯•çš„æ“ä½œåŒ…æ‹¬ã€‚\nç¼“å­˜æœ¬åœ°æŒ‡é’ˆ ä»¥ä»»ä½•æ–¹å¼ä¸Core.Compilerçš„å†…å®¹æˆ–æ–¹æ³•è¿›è¡Œäº¤äº’ã€‚ è§‚å¯Ÿä»»ä½•å¯å˜çŠ¶æ€ã€‚\nå¯¹ç”Ÿæˆçš„å‡½æ•°çš„æ¨ç†å¯ä»¥åœ¨ä»»ä½•æ—¶å€™è¿è¡Œï¼ŒåŒ…æ‹¬åœ¨æ‚¨çš„ä»£ç è¯•å›¾è§‚å¯Ÿæˆ–çªå˜æ­¤çŠ¶æ€æ—¶ã€‚ å ç”¨ä»»ä½•é”ã€‚ä½ è°ƒç”¨çš„Cä»£ç å¯ä»¥åœ¨å†…éƒ¨ä½¿ç”¨é”ï¼Œï¼ˆä¾‹å¦‚ï¼Œè°ƒç”¨mallocæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œå³ä½¿å¤§å¤šæ•°å®ç°åœ¨å†…éƒ¨éœ€è¦é”ï¼‰ï¼Œä½†ä¸è¦è¯•å›¾åœ¨æ‰§è¡ŒJuliaä»£ç æ—¶æŒæœ‰æˆ–è·å–ä»»ä½•é”ã€‚ è°ƒç”¨åœ¨ç”Ÿæˆå‡½æ•°ä¸»ä½“ä¹‹åå®šä¹‰çš„ä»»ä½•å‡½æ•°ã€‚å¯¹äºå¢é‡åŠ è½½çš„é¢„ç¼–è¯‘æ¨¡å—ï¼Œè¿™ä¸ªæ¡ä»¶æ˜¯æ”¾å®½çš„ï¼Œå…è®¸è°ƒç”¨æ¨¡å—ä¸­çš„ä»»ä½•å‡½æ•°ã€‚ å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å¯¹ç”Ÿæˆå‡½æ•°çš„å·¥ä½œåŸç†æœ‰äº†æ›´å¥½çš„ç†è§£ï¼Œè®©æˆ‘ä»¬ç”¨å®ƒä»¬æ¥æ„å»ºä¸€äº›æ›´é«˜çº§çš„ï¼ˆæœ‰æ•ˆçš„ï¼‰åŠŸèƒ½\u0026hellip;\nä¸€ä¸ªé«˜çº§çš„ä¾‹å­\nèŒ±è‰äºšçš„åŸºç¡€åº“æœ‰ä¸€ä¸ªå†…éƒ¨çš„sub2indå‡½æ•°ï¼Œç”¨æ¥è®¡ç®—ä¸€ä¸ªçº¿æ€§ç´¢å¼•åˆ°nç»´æ•°ç»„ä¸­ï¼ŒåŸºäºnä¸ªå¤šçº¿æ€§ç´¢å¼•çš„é›†åˆï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯è®¡ç®—å¯ä»¥ç”¨A[i]æ¥ç´¢å¼•åˆ°æ•°ç»„Aä¸­çš„ç´¢å¼•iï¼Œè€Œä¸æ˜¯A[x,y,z,\u0026hellip;]ã€‚ä¸€ç§å¯èƒ½çš„å®ç°æ–¹å¼å¦‚ä¸‹ã€‚\njulia\u0026gt; function sub2ind_loop(dims::NTuple{N}, I::Integer...) where N ind = I[N] - 1 for i = N-1ğŸ‘1 ind = I[i]-1 + dims[i]*ind end return ind + 1 end sub2ind_loop (generic function with 1 method) julia\u0026gt; sub2ind_loop((3, 5), 1, 2) 4 åŒæ ·çš„äº‹æƒ…ä¹Ÿå¯ä»¥ç”¨é€’å½’æ¥å®Œæˆã€‚\njulia\u0026gt; sub2ind_rec(dims::Tuple{}) = 1; julia\u0026gt; sub2ind_rec(dims::Tuple{}, i1::Integer, I::Integer...) = i1 == 1 ? sub2ind_rec(dims, I...) : throw(BoundsError()); julia\u0026gt; sub2ind_rec(dims::Tuple{Integer, Vararg{Integer}}, i1::Integer) = i1; julia\u0026gt; sub2ind_rec(dims::Tuple{Integer, Vararg{Integer}}, i1::Integer, I::Integer...) = i1 + dims[1] * (sub2ind_rec(Base.tail(dims), I...) - 1); julia\u0026gt; sub2ind_rec((3, 5), 1, 2) 4 è¿™ä¸¤ç§å®ç°è™½ç„¶ä¸åŒï¼Œä½†æœ¬è´¨ä¸Šéƒ½æ˜¯ä¸€æ ·çš„ï¼šåœ¨æ•°ç»„çš„ç»´åº¦ä¸Šè¿›è¡Œè¿è¡Œæ—¶å¾ªç¯ï¼Œå°†æ¯ä¸ªç»´åº¦çš„åç§»é‡æ”¶é›†åˆ°æœ€åçš„ç´¢å¼•ä¸­ã€‚\nç„¶è€Œï¼Œæˆ‘ä»¬åœ¨å¾ªç¯ä¸­æ‰€éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯éƒ½åµŒå…¥åœ¨å‚æ•°çš„ç±»å‹ä¿¡æ¯ä¸­ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç”Ÿæˆå‡½æ•°å°†è¿­ä»£ç§»åŠ¨åˆ°ç¼–è¯‘æ—¶ï¼›ç”¨ç¼–è¯‘å™¨çš„è¯´æ³•ï¼Œæˆ‘ä»¬ä½¿ç”¨ç”Ÿæˆå‡½æ•°æ‰‹åŠ¨å±•å¼€å¾ªç¯ã€‚èº«ä½“å˜å¾—å‡ ä¹ç›¸åŒï¼Œä½†æˆ‘ä»¬ä¸æ˜¯è®¡ç®—çº¿æ€§æŒ‡æ•°ï¼Œè€Œæ˜¯å»ºç«‹ä¸€ä¸ªè®¡ç®—æŒ‡æ•°çš„è¡¨è¾¾å¼ã€‚\njulia\u0026gt; @generated function sub2ind_gen(dims::NTuple{N}, I::Integer...) where N ex = :(I[$N] - 1) for i = (N - 1)ğŸ‘1 ex = :(I[$i] - 1 + dims[$i] * $ex) end return :($ex + 1) end sub2ind_gen (generic function with 1 method) julia\u0026gt; sub2ind_gen((3, 5), 1, 2) 4 è¿™å°†äº§ç”Ÿä»€ä¹ˆä»£ç å‘¢ï¼Ÿ\nä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯å°†ä¸»ä½“æå–åˆ°å¦ä¸€ä¸ªï¼ˆå¸¸è§„ï¼‰å‡½æ•°ä¸­ã€‚\njulia\u0026gt; @generated function sub2ind_gen(dims::NTuple{N}, I::Integer...) where N return sub2ind_gen_impl(dims, I...) end sub2ind_gen (generic function with 1 method) julia\u0026gt; function sub2ind_gen_impl(dims::Type{T}, I...) where T \u0026lt;: NTuple{N,Any} where N length(I) == N || return :(error(\u0026#34;partial indexing is unsupported\u0026#34;)) ex = :(I[$N] - 1) for i = (N - 1)ğŸ‘1 ex = :(I[$i] - 1 + dims[$i] * $ex) end return :($ex + 1) end sub2ind_gen_impl (generic function with 1 method) ç°åœ¨æˆ‘ä»¬å¯ä»¥æ‰§è¡Œsub2ind_gen_implå¹¶æ£€æŸ¥å®ƒè¿”å›çš„è¡¨è¾¾å¼ã€‚\njulia\u0026gt; sub2ind_gen_impl(Tuple{Int,Int}, Int, Int) :(((I[1] - 1) + dims[1] * (I[2] - 1)) + 1) æ‰€ä»¥ï¼Œè¿™é‡Œè¦ç”¨åˆ°çš„æ–¹æ³•ä½“æ ¹æœ¬ä¸åŒ…å«å¾ªç¯\u0026ndash;åªæ˜¯ç´¢å¼•åˆ°ä¸¤ä¸ªå…ƒç»„ï¼Œä¹˜æ³•å’ŒåŠ /å‡æ³•ã€‚æ‰€æœ‰çš„å¾ªç¯éƒ½æ˜¯åœ¨ç¼–è¯‘æ—¶è¿›è¡Œçš„ï¼Œæˆ‘ä»¬å®Œå…¨é¿å…äº†æ‰§è¡Œè¿‡ç¨‹ä¸­çš„å¾ªç¯ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯¹æ¯ä¸ªç±»å‹åªè¿›è¡Œä¸€æ¬¡å¾ªç¯ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œæ¯Nä¸ªç±»å‹åªå¾ªç¯ä¸€æ¬¡ï¼ˆé™¤éåœ¨å‡½æ•°ç”Ÿæˆä¸€æ¬¡ä»¥ä¸Šçš„è¾¹ç¼˜æƒ…å†µä¸‹\u0026ndash;è§ä¸Šé¢çš„å…è´£å£°æ˜ï¼‰ã€‚\nå¯é€‰ç”Ÿæˆçš„å‡½æ•°\nç”Ÿæˆå‡½æ•°å¯ä»¥åœ¨è¿è¡Œæ—¶å®ç°é«˜æ•ˆç‡ï¼Œä½†ä¹Ÿæœ‰ç¼–è¯‘æ—¶é—´æˆæœ¬ï¼šæ¯ä¸€ä¸ªå…·ä½“å‚æ•°ç±»å‹çš„ç»„åˆéƒ½å¿…é¡»ç”Ÿæˆä¸€ä¸ªæ–°çš„å‡½æ•°ä½“ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼ŒJuliaèƒ½å¤Ÿç¼–è¯‘ \u0026ldquo;é€šç”¨ \u0026ldquo;ç‰ˆæœ¬çš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°å°†é€‚ç”¨äºä»»ä½•å‚æ•°ï¼Œä½†å¯¹äºç”Ÿæˆå‡½æ•°ï¼Œè¿™æ˜¯ä¸å¯èƒ½çš„ã€‚è¿™æ„å‘³ç€å¤§é‡ä½¿ç”¨ç”Ÿæˆå‡½æ•°çš„ç¨‹åºå¯èƒ½æ— æ³•é™æ€ç¼–è¯‘ã€‚\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¯­è¨€æä¾›äº†ç¼–å†™æ­£å¸¸çš„ã€éç”Ÿæˆå‡½æ•°çš„æ›¿ä»£å®ç°çš„è¯­æ³•ã€‚åº”ç”¨åˆ°ä¸Šé¢çš„sub2indä¾‹å­ä¸­ï¼Œä¼šæ˜¯è¿™æ ·çš„ã€‚\nfunction sub2ind_gen(dims::NTuple{N}, I::Integer...) where N if N != length(I) throw(ArgumentError(\u0026#34;Number of dimensions must match number of indices.\u0026#34;)) end if @generated ex = :(I[$N] - 1) for i = (N - 1)ğŸ‘1 ex = :(I[$i] - 1 + dims[$i] * $ex) end return :($ex + 1) else ind = I[N] - 1 for i = (N - 1)ğŸ‘1 ind = I[i] - 1 + dims[i]*ind end return ind + 1 end end åœ¨å†…éƒ¨ï¼Œè¿™æ®µä»£ç åˆ›å»ºäº†å‡½æ•°çš„ä¸¤ä¸ªå®ç°ï¼šä¸€ä¸ªæ˜¯ç”Ÿæˆçš„ï¼Œå…¶ä¸­ä½¿ç”¨äº†if @generatedä¸­çš„ç¬¬ä¸€ä¸ªå—ï¼Œå¦ä¸€ä¸ªæ˜¯æ­£å¸¸çš„ï¼Œå…¶ä¸­ä½¿ç”¨äº† elseå—ã€‚åœ¨if @generatedå—çš„thenéƒ¨åˆ†å†…éƒ¨ï¼Œä»£ç çš„è¯­ä¹‰ä¸å…¶ä»–ç”Ÿæˆå‡½æ•°ç›¸åŒï¼šå‚æ•°åæŒ‡çš„æ˜¯ç±»å‹ï¼Œä»£ç åº”è¯¥è¿”å›ä¸€ä¸ªè¡¨è¾¾å¼ã€‚å¯èƒ½ä¼šå‡ºç°å¤šä¸ªif @ç”Ÿæˆå—ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”Ÿæˆçš„å®ç°ä½¿ç”¨æ‰€æœ‰çš„thenå—ï¼Œè€Œå¤‡ç”¨çš„å®ç°ä½¿ç”¨æ‰€æœ‰çš„elseå—ã€‚\næ³¨æ„ï¼Œæˆ‘ä»¬åœ¨å‡½æ•°çš„é¡¶éƒ¨æ·»åŠ äº†ä¸€ä¸ªé”™è¯¯æ£€æŸ¥ã€‚è¿™æ®µä»£ç åœ¨ä¸¤ä¸ªç‰ˆæœ¬ä¸­éƒ½æ˜¯é€šç”¨çš„ï¼Œå¹¶ä¸”åœ¨ä¸¤ä¸ªç‰ˆæœ¬ä¸­éƒ½æ˜¯è¿è¡Œæ—¶ä»£ç ï¼ˆå®ƒå°†è¢«å¼•ç”¨å¹¶ä½œä¸ºç”Ÿæˆç‰ˆæœ¬çš„è¡¨è¾¾å¼è¿”å›ï¼‰ã€‚è¿™æ„å‘³ç€å±€éƒ¨å˜é‡çš„å€¼å’Œç±»å‹åœ¨ä»£ç ç”Ÿæˆæ—¶æ˜¯ä¸å¯ç”¨çš„\u0026ndash;ä»£ç ç”Ÿæˆä»£ç åªèƒ½çœ‹åˆ°å‚æ•°çš„ç±»å‹ã€‚\nåœ¨è¿™ç§é£æ ¼çš„å®šä¹‰ä¸­ï¼Œä»£ç ç”ŸæˆåŠŸèƒ½æœ¬è´¨ä¸Šæ˜¯ä¸€ç§å¯é€‰çš„ä¼˜åŒ–ã€‚ç¼–è¯‘å™¨åœ¨æ–¹ä¾¿çš„æƒ…å†µä¸‹ä¼šä½¿ç”¨å®ƒï¼Œä½†å…¶ä»–æƒ…å†µä¸‹å¯èƒ½ä¼šé€‰æ‹©ä½¿ç”¨æ­£å¸¸çš„å®ç°æ¥ä»£æ›¿ã€‚è¿™ç§é£æ ¼æ˜¯é¦–é€‰ï¼Œå› ä¸ºå®ƒå…è®¸ç¼–è¯‘å™¨åšå‡ºæ›´å¤šçš„å†³å®šï¼Œå¹¶ä»¥æ›´å¤šçš„æ–¹å¼ç¼–è¯‘ç¨‹åºï¼Œè€Œä¸”æ­£å¸¸ä»£ç æ¯”ä»£ç ç”Ÿæˆä»£ç æ›´æ˜“è¯»ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨å“ªç§å®ç°å–å†³äºç¼–è¯‘å™¨çš„å®ç°ç»†èŠ‚ï¼Œæ‰€ä»¥ä¸¤ç§å®ç°çš„è¡Œä¸ºå¿…é¡»å®Œå…¨ç›¸åŒã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2020-12-29-metaprogramming/","tags":["Julia","Julia å®˜æ–¹æ–‡æ¡£"],"title":"å…ƒç¼–ç¨‹"},{"categories":["Flink"],"contents":"FlinkCEP æ˜¯åœ¨ Flink ä¹‹ä¸Šå®ç°çš„å¤æ‚äº‹ä»¶å¤„ç†ï¼ˆCEPï¼‰åº“ã€‚å®ƒå…è®¸ä½ åœ¨æ— å°½çš„äº‹ä»¶æµä¸­æ£€æµ‹äº‹ä»¶æ¨¡å¼, è®©ä½ æœ‰æœºä¼šæŒæ¡æ•°æ®ä¸­çš„é‡è¦å†…å®¹ã€‚\næœ¬é¡µä»‹ç»äº† Flink CEP ä¸­å¯ç”¨çš„ API è°ƒç”¨ã€‚æˆ‘ä»¬é¦–å…ˆä»‹ç» Pattern API, å®ƒå…è®¸ä½ æŒ‡å®šä½ æƒ³åœ¨ä½ çš„æµä¸­æ£€æµ‹çš„æ¨¡å¼, ç„¶åä»‹ç»ä½ å¦‚ä½•æ£€æµ‹å¹¶å¯¹åŒ¹é…çš„äº‹ä»¶åºåˆ—é‡‡å–è¡ŒåŠ¨ã€‚ç„¶å, æˆ‘ä»¬å°†ä»‹ç» CEP åº“åœ¨å¤„ç†äº‹ä»¶æ—¶é—´çš„å»¶è¿Ÿæ—¶åšå‡ºçš„å‡è®¾, ä»¥åŠå¦‚ä½•å°†ä½ çš„å·¥ä½œä»æ—§ç‰ˆ Flink è¿ç§»åˆ° Flink-1.3ã€‚\nå…¥é—¨ å¦‚æœä½ æƒ³ç›´æ¥è¿›å…¥, è®¾ç½®ä¸€ä¸ª Flink ç¨‹åº, å¹¶å°† FlinkCEP ä¾èµ–å…³ç³»æ·»åŠ åˆ°é¡¹ç›®çš„ pom.xml ä¸­ã€‚\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.flink\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flink-cep-scala_2.11\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.12.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; ä¿¡æ¯ï¼šFlinkCEP ä¸æ˜¯äºŒè¿›åˆ¶å‘è¡Œç‰ˆçš„ä¸€éƒ¨åˆ†ã€‚è¯·åœ¨è¿™é‡ŒæŸ¥çœ‹å¦‚ä½•ä¸å®ƒé“¾æ¥è¿›è¡Œé›†ç¾¤æ‰§è¡Œã€‚\nç°åœ¨ä½ å¯ä»¥å¼€å§‹ä½¿ç”¨æ¨¡å¼ API ç¼–å†™ä½ çš„ç¬¬ä¸€ä¸ª CEP ç¨‹åºäº†ã€‚\næ³¨æ„: ä½ æƒ³åº”ç”¨æ¨¡å¼åŒ¹é…çš„ DataStream ä¸­çš„äº‹ä»¶å¿…é¡»å®ç°é€‚å½“çš„ equals() å’Œ hashCode() æ–¹æ³•, å› ä¸º FlinkCEP ä½¿ç”¨å®ƒä»¬æ¥æ¯”è¾ƒå’ŒåŒ¹é…äº‹ä»¶ã€‚\nval input: DataStream[Event] = ... val pattern = Pattern.begin[Event](\u0026#34;start\u0026#34;).where(_.getId == 42) .next(\u0026#34;middle\u0026#34;).subtype(classOf[SubEvent]).where(_.getVolume \u0026gt;= 10.0) .followedBy(\u0026#34;end\u0026#34;).where(_.getName == \u0026#34;end\u0026#34;) val patternStream = CEP.pattern(input, pattern) val result: DataStream[Alert] = patternStream.process( new PatternProcessFunction[Event, Alert]() { override def processMatch( `match`: util.Map[String, util.List[Event]], ctx: PatternProcessFunction.Context, out: Collector[Alert]): Unit = { out.collect(createAlertFrom(pattern)) } }) Pattern API æ¨¡å¼ API å…è®¸ä½ å®šä¹‰ä½ æƒ³ä»è¾“å…¥æµä¸­æå–çš„å¤æ‚æ¨¡å¼åºåˆ—ã€‚\næ¯ä¸ªå¤æ‚æ¨¡å¼åºåˆ—ç”±å¤šä¸ªç®€å•æ¨¡å¼ç»„æˆ, å³å¯»æ‰¾å…·æœ‰ç›¸åŒå±æ€§çš„å•ä¸ªäº‹ä»¶çš„æ¨¡å¼ã€‚ä»ç°åœ¨å¼€å§‹, æˆ‘ä»¬å°†æŠŠè¿™äº›ç®€å•æ¨¡å¼ç§°ä¸ºæ¨¡å¼, è€Œæœ€ç»ˆæˆ‘ä»¬è¦åœ¨æµä¸­å¯»æ‰¾çš„å¤æ‚æ¨¡å¼åºåˆ—, å°±æ˜¯æ¨¡å¼åºåˆ—ã€‚ä½ å¯ä»¥æŠŠæ¨¡å¼åºåˆ—çœ‹æˆæ˜¯è¿™æ ·çš„æ¨¡å¼å›¾, æ ¹æ®ç”¨æˆ·æŒ‡å®šçš„æ¡ä»¶, ä»ä¸€ä¸ªæ¨¡å¼è¿‡æ¸¡åˆ°ä¸‹ä¸€ä¸ªæ¨¡å¼, ä¾‹å¦‚ event.getName().equals(\u0026ldquo;end\u0026rdquo;)ã€‚ä¸€ä¸ªåŒ¹é…æ˜¯ä¸€ä¸ªè¾“å…¥äº‹ä»¶çš„åºåˆ—, å®ƒé€šè¿‡æœ‰æ•ˆçš„æ¨¡å¼è½¬æ¢åºåˆ—, è®¿é—®å¤æ‚æ¨¡å¼å›¾çš„æ‰€æœ‰æ¨¡å¼ã€‚\næ³¨æ„: æ¯ä¸ªæ¨¡å¼å¿…é¡»æœ‰ä¸€ä¸ªå”¯ä¸€çš„åç§°, ä½ ä»¥åç”¨å®ƒæ¥è¯†åˆ«åŒ¹é…äº‹ä»¶ã€‚\næ³¨æ„: æ¨¡å¼åç§°ä¸èƒ½åŒ…å«å­—ç¬¦ \u0026ldquo;:\u0026quot;ã€‚\nåœ¨æœ¬èŠ‚çš„å…¶ä½™éƒ¨åˆ†, æˆ‘ä»¬å°†é¦–å…ˆä»‹ç»å¦‚ä½•å®šä¹‰ å•ä¸ªæ¨¡å¼, ç„¶åä»‹ç»å¦‚ä½•å°†å•ä¸ªæ¨¡å¼ç»„åˆæˆ å¤æ‚æ¨¡å¼ã€‚\nå•ä¸ªæ¨¡å¼ æ¨¡å¼å¯ä»¥æ˜¯å•ä¸ªæ¨¡å¼, ä¹Ÿå¯ä»¥æ˜¯å¾ªç¯æ¨¡å¼ã€‚å•å…ƒæ¨¡å¼åªæ¥å—ä¸€ä¸ªäº‹ä»¶, è€Œå¾ªç¯æ¨¡å¼å¯ä»¥æ¥å—å¤šä¸ªäº‹ä»¶ã€‚åœ¨æ¨¡å¼åŒ¹é…ç¬¦å·ä¸­, æ¨¡å¼ \u0026ldquo;a b+ c?d\u0026rdquo;(æˆ– \u0026ldquo;a\u0026rdquo;, åé¢è·Ÿç€ä¸€ä¸ªæˆ–å¤šä¸ª \u0026ldquo;b\u0026rdquo;, å¯é€‰åœ°è·Ÿç€ä¸€ä¸ª \u0026ldquo;c\u0026rdquo;, åé¢è·Ÿç€ä¸€ä¸ª \u0026ldquo;d\u0026rdquo;), aã€c? å’Œ d æ˜¯å•ä¸ªæ¨¡å¼, è€Œ b+ æ˜¯å¾ªç¯æ¨¡å¼ã€‚é»˜è®¤æƒ…å†µä¸‹, æ¨¡å¼æ˜¯ä¸€ä¸ªå•ä¸ªæ¨¡å¼, ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨é‡è¯å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªå¾ªç¯æ¨¡å¼ã€‚æ¯ä¸ªæ¨¡å¼å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ¡ä»¶, åŸºäºè¿™äº›æ¡ä»¶, å®ƒå¯ä»¥æ¥å—äº‹ä»¶ã€‚\né‡è¯ åœ¨ FlinkCEP ä¸­, ä½ å¯ä»¥ä½¿ç”¨è¿™äº›æ–¹æ³•æ¥æŒ‡å®šå¾ªç¯æ¨¡å¼ï¼špattern.oneOrMore(), ç”¨äºæœŸæœ›ç»™å®šäº‹ä»¶å‡ºç°ä¸€æ¬¡æˆ–å¤šæ¬¡çš„æ¨¡å¼(ä¾‹å¦‚å‰é¢æåˆ°çš„ b+)ï¼›ä»¥åŠ pattern.times(#ofTimes), ç”¨äºæœŸæœ›ç»™å®šäº‹ä»¶å‡ºç°çš„ç‰¹å®šæ¬¡æ•°çš„æ¨¡å¼, ä¾‹å¦‚ 4 ä¸ª aï¼›ä»¥åŠ pattern.times(#fromTimes, #toTimes), ç”¨äºæœŸæœ›ç»™å®šäº‹ä»¶çš„ç‰¹å®šæœ€å°å‡ºç°æ¬¡æ•°å’Œæœ€å¤§å‡ºç°æ¬¡æ•°çš„æ¨¡å¼, ä¾‹å¦‚ 2-4 ä¸ª aã€‚\nä½ å¯ä»¥ä½¿ç”¨ pattern.greedy() æ–¹æ³•ä½¿å¾ªç¯æ¨¡å¼å˜å¾—è´ªå©ª, ä½†ä½ è¿˜ä¸èƒ½ä½¿åˆ†ç»„æ¨¡å¼å˜å¾—è´ªå©ªã€‚ä½ å¯ä»¥ä½¿ç”¨ pattern.option() æ–¹æ³•ä½¿æ‰€æœ‰æ¨¡å¼, ä¸ç®¡æ˜¯å¦å¾ªç¯, éƒ½æ˜¯å¯é€‰çš„ã€‚\nå¯¹äºåä¸º start çš„æ¨¡å¼, ä»¥ä¸‹æ˜¯æœ‰æ•ˆçš„é‡è¯ã€‚\n// expecting 4 occurrences start.times(4) // expecting 0 or 4 occurrences start.times(4).optional() // expecting 2, 3 or 4 occurrences start.times(2, 4) // expecting 2, 3 or 4 occurrences and repeating as many as possible start.times(2, 4).greedy() // expecting 0, 2, 3 or 4 occurrences start.times(2, 4).optional() // expecting 0, 2, 3 or 4 occurrences and repeating as many as possible start.times(2, 4).optional().greedy() // expecting 1 or more occurrences start.oneOrMore() // expecting 1 or more occurrences and repeating as many as possible start.oneOrMore().greedy() // expecting 0 or more occurrences start.oneOrMore().optional() // expecting 0 or more occurrences and repeating as many as possible start.oneOrMore().optional().greedy() // expecting 2 or more occurrences start.timesOrMore(2) // expecting 2 or more occurrences and repeating as many as possible start.timesOrMore(2).greedy() // expecting 0, 2 or more occurrences start.timesOrMore(2).optional() // expecting 0, 2 or more occurrences and repeating as many as possible start.timesOrMore(2).optional().greedy() æ¡ä»¶\nå¯¹äºæ¯ä¸ªæ¨¡å¼, ä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªæ¡ä»¶, ä¼ å…¥çš„äº‹ä»¶å¿…é¡»æ»¡è¶³è¿™ä¸ªæ¡ä»¶æ‰èƒ½è¢«\u0026quot;æ¥å—\u0026quot;åˆ°æ¨¡å¼ä¸­, ä¾‹å¦‚, å®ƒçš„å€¼åº”è¯¥å¤§äº 5, æˆ–è€…å¤§äºä¹‹å‰æ¥å—çš„äº‹ä»¶çš„å¹³å‡å€¼ã€‚ä½ å¯ä»¥é€šè¿‡ pattern.where()ã€pattern.or() æˆ– pattern.until() æ–¹æ³•æ¥æŒ‡å®šäº‹ä»¶å±æ€§çš„æ¡ä»¶ã€‚è¿™äº›æ¡ä»¶å¯ä»¥æ˜¯ IterativeConditions æˆ– SimpleConditionsã€‚\nè¿­ä»£æ¡ä»¶ã€‚è¿™æ˜¯æœ€é€šç”¨çš„æ¡ä»¶ç±»å‹ã€‚ä½ å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æŒ‡å®šä¸€ä¸ªæ¡ä»¶, è¯¥æ¡ä»¶åŸºäºä¹‹å‰æ¥å—çš„äº‹ä»¶çš„å±æ€§æˆ–å…¶ä¸­ä¸€ä¸ªå­é›†çš„ç»Ÿè®¡é‡æ¥æ¥å—åç»­äº‹ä»¶ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªè¿­ä»£æ¡ä»¶çš„ä»£ç , å¦‚æœä¸€ä¸ªåä¸º \u0026ldquo;middle\u0026rdquo; çš„æ¨¡å¼çš„åç§°ä»¥ \u0026ldquo;foo\u0026rdquo; å¼€å¤´, å¹¶ä¸”å¦‚æœè¯¥æ¨¡å¼ä¹‹å‰æ¥å—çš„äº‹ä»¶çš„ä»·æ ¼åŠ ä¸Šå½“å‰äº‹ä»¶çš„ä»·æ ¼ä¹‹å’Œä¸è¶…è¿‡ 5.0 çš„å€¼, åˆ™æ¥å—è¯¥æ¨¡å¼çš„ä¸‹ä¸€ä¸ªäº‹ä»¶ã€‚è¿­ä»£æ¡ä»¶å¯ä»¥å‘æŒ¥å¼ºå¤§çš„ä½œç”¨, å°¤å…¶æ˜¯ä¸å¾ªç¯æ¨¡å¼ç›¸ç»“åˆ, ä¾‹å¦‚ oneOrMore()ã€‚\nmiddle.oneOrMore() .subtype(classOf[SubEvent]) .where( (value, ctx) =\u0026gt; { lazy val sum = ctx.getEventsForPattern(\u0026#34;middle\u0026#34;).map(_.getPrice).sum value.getName.startsWith(\u0026#34;foo\u0026#34;) \u0026amp;\u0026amp; sum + value.getPrice \u0026lt; 5.0 } ) æ³¨æ„ï¼šè°ƒç”¨ ctx.getEventsForPattern(\u0026hellip;) å¯ä»¥ä¸ºç»™å®šçš„æ½œåœ¨åŒ¹é…æ‰¾åˆ°æ‰€æœ‰ä¹‹å‰æ¥å—çš„äº‹ä»¶ã€‚è¿™ä¸ªæ“ä½œçš„æˆæœ¬å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒ, æ‰€ä»¥åœ¨å®ç°ä½ çš„æ¡ä»¶æ—¶, å°½é‡å‡å°‘å®ƒçš„ä½¿ç”¨ã€‚\næè¿°çš„ä¸Šä¸‹æ–‡ä½¿äººä»¬ä¹Ÿå¯ä»¥è®¿é—®äº‹ä»¶çš„æ—¶é—´ç‰¹å¾ã€‚æ›´å¤šä¿¡æ¯è¯·çœ‹æ—¶é—´ä¸Šä¸‹æ–‡ã€‚\nç®€å•æ¡ä»¶ã€‚è¿™ç§ç±»å‹çš„æ¡ä»¶æ‰©å±•äº†å‰é¢æåˆ°çš„ IterativeCondition ç±», ä»…æ ¹æ®äº‹ä»¶æœ¬èº«çš„å±æ€§æ¥å†³å®šæ˜¯å¦æ¥å—ä¸€ä¸ªäº‹ä»¶ã€‚\nstart.where(event =\u0026gt; event.getName.startsWith(\u0026#34;foo\u0026#34;)) æœ€å, ä½ è¿˜å¯ä»¥é€šè¿‡ pattern.subtype(subClass) æ–¹æ³•å°†æ¥å—çš„äº‹ä»¶ç±»å‹é™åˆ¶ä¸ºåˆå§‹äº‹ä»¶ç±»å‹çš„ä¸€ä¸ªå­ç±»å‹ï¼ˆè¿™é‡Œæ˜¯ Eventï¼‰ã€‚\nstart.subtype(classOf[SubEvent]).where(subEvent =\u0026gt; ... /* some condition */) ç»„åˆæ¡ä»¶ã€‚å¦‚ä¸Šæ‰€ç¤º, ä½ å¯ä»¥å°†å­ç±»å‹æ¡ä»¶ä¸å…¶ä»–æ¡ä»¶ç»“åˆèµ·æ¥ã€‚è¿™å¯¹æ¯ä¸ªæ¡ä»¶éƒ½é€‚ç”¨ã€‚ä½ å¯ä»¥é€šè¿‡ä¾æ¬¡è°ƒç”¨ where() æ¥ä»»æ„ç»„åˆæ¡ä»¶ã€‚æœ€åçš„ç»“æœå°†æ˜¯å„ä¸ªæ¡ä»¶çš„ç»“æœçš„é€»è¾‘ ANDã€‚è¦ä½¿ç”¨ OR ç»„åˆæ¡ä»¶, å¯ä»¥ä½¿ç”¨ or() æ–¹æ³•, å¦‚ä¸‹æ‰€ç¤ºã€‚\npattern.where(event =\u0026gt; ... /* some condition */).or(event =\u0026gt; ... /* or condition */) åœæ­¢æ¡ä»¶ï¼šå¦‚æœæ˜¯å¾ªç¯æ¨¡å¼(oneOrMore() å’Œ oneOrMore().option()), ä½ ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªåœæ­¢æ¡ä»¶, ä¾‹å¦‚, æ¥å—å€¼å¤§äº 5 çš„äº‹ä»¶, ç›´åˆ°å€¼çš„æ€»å’Œå°äº 50ã€‚\nä¸ºäº†æ›´å¥½åœ°ç†è§£å®ƒ, è¯·çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚ç»™å®šï¼š\nåƒ \u0026ldquo;(a+ until b)\u0026rdquo; (ä¸€ä¸ªæˆ–å¤šä¸ª \u0026ldquo;a\u0026rdquo; ç›´åˆ° \u0026ldquo;b\u0026rdquo;) è¿™æ ·çš„æ¨¡å¼\nè¾“å…¥äº‹ä»¶çš„åºåˆ— \u0026ldquo;a1\u0026rdquo; \u0026ldquo;c\u0026rdquo; \u0026ldquo;a2\u0026rdquo; \u0026ldquo;b\u0026rdquo; \u0026ldquo;a3\u0026rdquo;\nè¯¥åº“å°†è¾“å‡ºç»“æœ: {a1 a2} {a1} {a2} {a3}.\næ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ {a1 a2 a3} æˆ– {a2 a3} ç”±äºåœæ­¢æ¡ä»¶æ²¡æœ‰è¿”å›ã€‚\n where(æ¡ä»¶) - å®šä¹‰å½“å‰æ¨¡å¼çš„æ¡ä»¶ã€‚è¦åŒ¹é…æ¨¡å¼, ä¸€ä¸ªäº‹ä»¶å¿…é¡»æ»¡è¶³æ¡ä»¶ã€‚å¤šä¸ªè¿ç»­çš„ where() å­å¥ä¼šå¯¼è‡´å…¶æ¡ä»¶è¢« AND åŒ–ã€‚  pattern.where(event =\u0026gt; ... /* some condition */)  or(æ¡ä»¶) - æ·»åŠ ä¸€ä¸ªæ–°çš„æ¡ä»¶, è¯¥æ¡ä»¶ä¸ç°æœ‰çš„æ¡ä»¶ç›¸åŒ¹é…ã€‚ä¸€ä¸ªäº‹ä»¶åªæœ‰åœ¨é€šè¿‡è‡³å°‘ä¸€ä¸ªæ¡ä»¶çš„æƒ…å†µä¸‹æ‰èƒ½ä¸æ¨¡å¼åŒ¹é…ã€‚  pattern.where(event =\u0026gt; ... /* some condition */) .or(event =\u0026gt; ... /* alternative condition */)  until(æ¡ä»¶) - æŒ‡å®šå¾ªç¯æ¨¡å¼çš„åœæ­¢æ¡ä»¶ã€‚æ„æ€æ˜¯å¦‚æœå‘ç”Ÿäº†ä¸ç»™å®šæ¡ä»¶ç›¸åŒ¹é…çš„äº‹ä»¶, åˆ™ä¸ä¼šå†æ¥å—æ›´å¤šçš„äº‹ä»¶è¿›å…¥æ¨¡å¼ã€‚  ä»…ä¸ oneOrMore() ç»“åˆä½¿ç”¨ã€‚\næ³¨æ„ï¼šå®ƒå…è®¸åœ¨äº‹ä»¶æ¡ä»¶ä¸‹å¯¹ç›¸åº”çš„æ¨¡å¼è¿›è¡Œæ¸…æ´—çŠ¶æ€ã€‚\npattern.oneOrMore().until(event =\u0026gt; ... /* some condition */)  subtype(subClass)\t- ä¸ºå½“å‰æ¨¡å¼å®šä¹‰ä¸€ä¸ªå­ç±»å‹æ¡ä»¶ã€‚åªæœ‰å½“ä¸€ä¸ªäº‹ä»¶å±äºè¿™ä¸ªå­ç±»å‹æ—¶, å®ƒæ‰èƒ½ä¸æ¨¡å¼ç›¸åŒ¹é…ã€‚  pattern.subtype(classOf[SubEvent])  oneOrMore() - æŒ‡å®šè¯¥æ¨¡å¼æœŸæœ›åŒ¹é…äº‹ä»¶è‡³å°‘å‡ºç°ä¸€æ¬¡ã€‚  é»˜è®¤æƒ…å†µä¸‹, ä½¿ç”¨çš„æ˜¯æ”¾å®½çš„å†…éƒ¨è¿ç»­ï¼ˆåœ¨åç»­äº‹ä»¶ä¹‹é—´ï¼‰ã€‚å…³äºå†…éƒ¨è¿ç»­æ€§çš„æ›´å¤šä¿¡æ¯, è¯·å‚è§ consecutiveã€‚\næ³¨æ„ï¼šå»ºè®®ä½¿ç”¨ until() æˆ– within() æ¥å¯ç”¨çŠ¶æ€æ¸…é™¤ã€‚\npattern.oneOrMore()  timesOrMore(#times) - æŒ‡å®šè¯¥æ¨¡å¼æœŸæœ›ä¸€ä¸ªåŒ¹é…äº‹ä»¶è‡³å°‘å‡ºç° #times æ¬¡ã€‚  é»˜è®¤æƒ…å†µä¸‹, ä½¿ç”¨çš„æ˜¯æ”¾å®½çš„å†…éƒ¨è¿ç»­ï¼ˆåœ¨åç»­äº‹ä»¶ä¹‹é—´ï¼‰ã€‚å…³äºå†…éƒ¨ç›¸é‚»æ€§çš„æ›´å¤šä¿¡æ¯, è¯·å‚è§ consecutiveã€‚\npattern.timesOrMore(2)  times(#ofTimes) - æŒ‡å®šè¯¥æ¨¡å¼æœŸæœ›åŒ¹é…äº‹ä»¶çš„å‡†ç¡®å‡ºç°æ¬¡æ•°ã€‚  é»˜è®¤æƒ…å†µä¸‹, ä½¿ç”¨çš„æ˜¯æ”¾å®½çš„å†…éƒ¨è¿ç»­æ€§ï¼ˆåœ¨åç»­äº‹ä»¶ä¹‹é—´ï¼‰ã€‚å…³äºå†…éƒ¨ç›¸é‚»æ€§çš„æ›´å¤šä¿¡æ¯, è¯·å‚è§ consecutiveã€‚\npattern.times(2)  times(#fromTimes, #toTimes) - æŒ‡å®šè¯¥æ¨¡å¼æœŸæœ›åŒ¹é…äº‹ä»¶çš„ #fromTimes å’Œ #toTimes ä¹‹é—´å‡ºç°ã€‚  é»˜è®¤æƒ…å†µä¸‹, ä½¿ç”¨çš„æ˜¯æ”¾å®½çš„å†…éƒ¨è¿ç»­æ€§ï¼ˆåœ¨åç»­äº‹ä»¶ä¹‹é—´ï¼‰ã€‚å…³äºå†…éƒ¨ç›¸é‚»æ€§çš„æ›´å¤šä¿¡æ¯, è¯·å‚è§ consecutiveã€‚\npattern.times(2, 4)  optional() - æŒ‡å®šè¯¥æ¨¡å¼æ˜¯å¯é€‰çš„, å³å®ƒå¯èƒ½æ ¹æœ¬ä¸ä¼šå‡ºç°ã€‚è¿™é€‚ç”¨äºä¸Šè¿°æ‰€æœ‰é‡è¯ã€‚  pattern.oneOrMore().optional()  greedy() - æŒ‡å®šè¯¥æ¨¡å¼æ˜¯è´ªå©ªçš„, å³ä¼šå°½å¯èƒ½å¤šçš„é‡å¤ã€‚è¿™åªé€‚ç”¨äºé‡è¯, ç›®å‰ä¸æ”¯æŒç»„æ¨¡å¼ã€‚  pattern.oneOrMore().greedy() ç»„åˆæ¨¡å¼ ç°åœ¨ä½ å·²ç»çœ‹åˆ°äº†å•ä¸ªæ¨¡å¼çš„æ ·å­, ç°åœ¨æ˜¯æ—¶å€™çœ‹çœ‹å¦‚ä½•å°†å®ƒä»¬ç»„åˆæˆä¸€ä¸ªå®Œæ•´çš„æ¨¡å¼åºåˆ—äº†ã€‚\nä¸€ä¸ªæ¨¡å¼åºåˆ—å¿…é¡»ä»ä¸€ä¸ªåˆå§‹æ¨¡å¼å¼€å§‹, å¦‚ä¸‹æ‰€ç¤ºã€‚\nval start : Pattern[Event, _] = Pattern.begin(\u0026#34;start\u0026#34;) ä¸‹ä¸€æ­¥, ä½ å¯ä»¥é€šè¿‡æŒ‡å®šå®ƒä»¬ä¹‹é—´æ‰€éœ€çš„æ¯—è¿æ¡ä»¶, å°†æ›´å¤šçš„æ¨¡å¼é™„åŠ åˆ°ä½ çš„æ¨¡å¼åºåˆ—ä¸­ã€‚FlinkCEP æ”¯æŒä»¥ä¸‹å½¢å¼çš„äº‹ä»¶ä¹‹é—´çš„ç›¸é‚»æ€§ã€‚\n ä¸¥æ ¼ç›¸é‚»: å¸Œæœ›æ‰€æœ‰åŒ¹é…çš„äº‹ä»¶ä¸¥æ ¼åœ°ä¸€ä¸ªæ¥ä¸€ä¸ªå‡ºç°, ä¸­é—´æ²¡æœ‰ä»»ä½•éåŒ¹é…çš„äº‹ä»¶ã€‚ Relaxed Contiguity: å¿½ç•¥åŒ¹é…äº‹ä»¶ä¹‹é—´å‡ºç°çš„éåŒ¹é…äº‹ä»¶ã€‚ éå†³å®šæ€§çš„æ¾å¼›ç›¸é‚»æ€§ï¼ˆNon-Deterministic Relaxed Contiguityï¼‰ã€‚è¿›ä¸€æ­¥æ”¾å®½ç›¸é‚»æ€§, å…è®¸å¿½ç•¥ä¸€äº›åŒ¹é…äº‹ä»¶çš„é¢å¤–åŒ¹é…ã€‚  è¦åœ¨è¿ç»­æ¨¡å¼ä¹‹é—´åº”ç”¨å®ƒä»¬, ä½ å¯ä»¥ä½¿ç”¨:\n next(), ç”¨äºä¸¥æ ¼ç›¸é‚», followedBy(), ç”¨äºæ¾æ•£ç›¸é‚», å’Œ followedByAny(), ç”¨äºéç¡®å®šæ€§çš„æ¾æ•£ç›¸é‚»ã€‚  æˆ–\n notNext(), å¦‚æœä½ ä¸å¸Œæœ›ä¸€ä¸ªäº‹ä»¶ç±»å‹ç›´æ¥è·Ÿéšå¦ä¸€ä¸ªäº‹ä»¶ç±»å‹ notFollowedBy(), å¦‚æœä½ ä¸æƒ³è®©ä¸€ä¸ªäº‹ä»¶ç±»å‹ä½äºä¸¤ä¸ªå…¶ä»–äº‹ä»¶ç±»å‹ä¹‹é—´çš„ä»»ä½•åœ°æ–¹ã€‚  æ³¨æ„ï¼šæ¨¡å¼åºåˆ—ä¸èƒ½ä»¥ notFollowedBy() ç»“æŸã€‚\næ³¨æ„ï¼š NOT æ¨¡å¼ä¸èƒ½åœ¨å‰é¢åŠ ä¸Šä¸€ä¸ªå¯é€‰æ¨¡å¼ã€‚\n// strict contiguity val strict: Pattern[Event, _] = start.next(\u0026#34;middle\u0026#34;).where(...) // relaxed contiguity val relaxed: Pattern[Event, _] = start.followedBy(\u0026#34;middle\u0026#34;).where(...) // non-deterministic relaxed contiguity val nonDetermin: Pattern[Event, _] = start.followedByAny(\u0026#34;middle\u0026#34;).where(...) // NOT pattern with strict contiguity val strictNot: Pattern[Event, _] = start.notNext(\u0026#34;not\u0026#34;).where(...) // NOT pattern with relaxed contiguity val relaxedNot: Pattern[Event, _] = start.notFollowedBy(\u0026#34;not\u0026#34;).where(...) æ¾æ•£æ¯—è¿æ„å‘³ç€åªæœ‰ç¬¬ä¸€ä¸ªåç»­çš„åŒ¹é…äº‹ä»¶æ‰ä¼šè¢«åŒ¹é…, è€Œå¯¹äºéç¡®å®šæ€§çš„æ¾æ•£æ¯—è¿, åŒä¸€å¼€å¤´ä¼šå‘å‡ºå¤šä¸ªåŒ¹é…ã€‚ä¸¾ä¸ªä¾‹å­, ä¸€ä¸ªæ¨¡å¼ \u0026ldquo;a b\u0026rdquo;, ç»™å®šäº‹ä»¶åºåˆ— \u0026ldquo;a\u0026rdquo;, \u0026ldquo;c\u0026rdquo;, \u0026ldquo;b1\u0026rdquo;, \u0026ldquo;b2\u0026rdquo;, å°†å¾—åˆ°ä»¥ä¸‹ç»“æœã€‚\n\u0026ldquo;a\u0026rdquo; å’Œ \u0026ldquo;b\u0026rdquo; ä¹‹é—´æœ‰ä¸¥æ ¼çš„æ¯—è¿æ€§ã€‚{} (ä¸åŒ¹é…), \u0026ldquo;a\u0026rdquo; åé¢çš„ \u0026ldquo;c\u0026rdquo; ä¼šå¯¼è‡´ \u0026ldquo;a\u0026rdquo; è¢«ä¸¢å¼ƒã€‚\n\u0026ldquo;a\u0026rdquo; å’Œ \u0026ldquo;b\u0026rdquo; ä¹‹é—´çš„æ¾æ•£ç›¸é‚»æ€§ã€‚{a b1}, å› ä¸ºæ¾æ•£è¿ç»­æ€§è¢«çœ‹ä½œæ˜¯ \u0026ldquo;è·³è¿‡éåŒ¹é…äº‹ä»¶, ç›´åˆ°ä¸‹ä¸€ä¸ªåŒ¹é…äº‹ä»¶\u0026rdquo;ã€‚\n\u0026ldquo;a\u0026rdquo; å’Œ \u0026ldquo;b\u0026rdquo; ä¹‹é—´çš„éç¡®å®šæ€§æ¾æ•£ç›¸é‚»æ€§ã€‚{a b1}, {a b2}, å› ä¸ºè¿™æ˜¯æœ€ä¸€èˆ¬çš„å½¢å¼ã€‚\nä¹Ÿå¯ä»¥å®šä¹‰ä¸€ä¸ªæ—¶é—´çº¦æŸ, è®©æ¨¡å¼æœ‰æ•ˆã€‚ä¾‹å¦‚, ä½ å¯ä»¥é€šè¿‡ pattern.within() æ–¹æ³•å®šä¹‰ä¸€ä¸ªæ¨¡å¼åº”è¯¥åœ¨ 10 ç§’å†…å‘ç”Ÿã€‚å¤„ç†æ—¶é—´å’Œäº‹ä»¶æ—¶é—´éƒ½æ”¯æŒæ—¶é—´æ¨¡å¼ã€‚\næ³¨æ„: æ¨¡å¼åºåˆ—åªèƒ½æœ‰ä¸€ä¸ªæ—¶é—´çº¦æŸã€‚å¦‚æœåœ¨ä¸åŒçš„å•ä¸ªæ¨¡å¼ä¸Šå®šä¹‰äº†å¤šä¸ªè¿™æ ·çš„çº¦æŸ, é‚£ä¹ˆå°±é‡‡ç”¨æœ€å°çš„çº¦æŸã€‚\nnext.within(Time.seconds(10)) å¾ªç¯æ¨¡å¼ä¸­çš„ç›¸é‚»æ€§\nä½ å¯ä»¥åœ¨å¾ªç¯æ¨¡å¼ä¸­åº”ç”¨ä¸ä¸Šä¸€èŠ‚è®¨è®ºçš„ç›¸åŒçš„ç›¸é‚»æ€§æ¡ä»¶ã€‚ç›¸é‚»æ€§å°†è¢«åº”ç”¨åœ¨è¿™æ ·ä¸€ä¸ªæ¨¡å¼ä¸­çš„å…ƒç´ ä¹‹é—´ã€‚ä¸ºäº†ä¸¾ä¾‹è¯´æ˜, æ¨¡å¼åºåˆ— \u0026ldquo;a b+ c\u0026rdquo;ï¼ˆ\u0026ldquo;a\u0026rdquo; åé¢è·Ÿç€ä¸€ä¸ªæˆ–å¤šä¸ª \u0026ldquo;b\u0026rdquo; çš„ä»»æ„ï¼ˆéç¡®å®šçš„æ¾æ•£çš„ï¼‰åºåˆ—, åé¢è·Ÿç€ä¸€ä¸ª \u0026ldquo;c\u0026rdquo;ï¼‰, è¾“å…¥ \u0026ldquo;a\u0026rdquo;ã€\u0026ldquo;b1\u0026rdquo;ã€\u0026ldquo;d1\u0026rdquo;ã€\u0026ldquo;b2\u0026rdquo;ã€\u0026ldquo;d2\u0026rdquo;ã€\u0026ldquo;b3\u0026rdquo;ã€\u0026ldquo;c\u0026rdquo;, ä¼šæœ‰ä»¥ä¸‹ç»“æœã€‚\nä¸¥æ ¼ç›¸é‚»æ€§ï¼š{a b3 c} - \u0026ldquo;b1\u0026rdquo; åé¢çš„ \u0026ldquo;d1\u0026rdquo; ä¼šå¯¼è‡´ \u0026ldquo;b1\u0026rdquo; è¢«ä¸¢å¼ƒ, \u0026ldquo;b2\u0026rdquo; ä¹Ÿä¼šå› ä¸º \u0026ldquo;d2\u0026rdquo; è€Œè¢«ä¸¢å¼ƒã€‚\næ”¾å®½ç›¸é‚»æ€§ï¼š{a b1 c}, {a b1 b2 c}, {a b1 b2 b3 c}, {a b2 c}, {a b2 b3 c}, {a b3 c} - \u0026ldquo;d\u0026rdquo; è¢«å¿½ç•¥ã€‚\néç¡®å®šæ€§çš„æ¾å¼›ç›¸é‚»æ€§ï¼š{a b1 c}, {a b1 b2 c}, {a b1 b3 c}, {a b1 b2 b3 c}, {a b2 c}, {a b2 b3 c}, {a b3 c} - æ³¨æ„{a b1 b3 c}, è¿™æ˜¯ \u0026ldquo;b\u0026rdquo; ä¹‹é—´æ¾å¼›ç›¸é‚»æ€§çš„ç»“æœã€‚\nå¯¹äºå¾ªç¯æ¨¡å¼(ä¾‹å¦‚ oneOrMore() å’Œ times()), é»˜è®¤æ˜¯æ”¾å®½æ¯—è¿æ€§ã€‚å¦‚æœä½ æƒ³è¦ä¸¥æ ¼çš„ç›¸é‚»æ€§, ä½ å¿…é¡»é€šè¿‡ä½¿ç”¨ continuous() è°ƒç”¨æ¥æ˜ç¡®æŒ‡å®š, å¦‚æœä½ æƒ³è¦éç¡®å®šæ€§çš„æ¾å¼›ç›¸é‚»æ€§, ä½ å¯ä»¥ä½¿ç”¨ allowCombinations() è°ƒç”¨ã€‚\n consecutive()  ä¸ oneOrMore() å’Œ times() ä¸€èµ·ä½¿ç”¨, å¹¶åœ¨åŒ¹é…çš„äº‹ä»¶ä¹‹é—´æ–½åŠ ä¸¥æ ¼çš„æ¯—è¿æ€§, å³ä»»ä½•ä¸åŒ¹é…çš„å…ƒç´ éƒ½ä¼šä¸­æ–­åŒ¹é…ï¼ˆå¦‚ next()ï¼‰ã€‚\nå¦‚æœä¸åº”ç”¨, åˆ™ä½¿ç”¨å®½æ¾çš„è¿ç»­æ€§ï¼ˆå¦‚ followedBy()ï¼‰ã€‚\nä¾‹å¦‚, åƒè¿™æ ·çš„æ¨¡å¼ã€‚\nPattern.begin(\u0026#34;start\u0026#34;).where(_.getName().equals(\u0026#34;c\u0026#34;)) .followedBy(\u0026#34;middle\u0026#34;).where(_.getName().equals(\u0026#34;a\u0026#34;)) .oneOrMore().consecutive() .followedBy(\u0026#34;end1\u0026#34;).where(_.getName().equals(\u0026#34;b\u0026#34;)) å°†ä¸ºä¸€ä¸ªè¾“å…¥åºåˆ—ç”Ÿæˆä»¥ä¸‹åŒ¹é…ã€‚C D A1 A2 A3 D A4 B\nä¸è¿ç»­åº”ç”¨ã€‚{C A1 B}, {C A1 A2 B}, {C A1 A2 A3 B}ã€‚\nä¸è¿ç»­åº”ç”¨ã€‚{C A1 B}, {C A1 A2 B}, {C A1 A2 A3 B}, {C A1 A2 A3 A4 B}ã€‚\n allowCombinations()  ä¸ oneOrMore()å’Œ times()ä¸€èµ·ä½¿ç”¨, å¹¶åœ¨åŒ¹é…çš„äº‹ä»¶ä¹‹é—´æ–½åŠ éç¡®å®šæ€§çš„æ¾æ•£ç›¸é‚»æ€§ï¼ˆå¦‚ followedByAny()ï¼‰ã€‚\nå¦‚æœä¸åº”ç”¨, åˆ™ä½¿ç”¨æ¾æ•£çš„ç›¸é‚»æ€§ï¼ˆå¦‚ followedBy()ï¼‰ã€‚\nä¾‹å¦‚, åƒè¿™æ ·çš„æ¨¡å¼ã€‚\nPattern.begin(\u0026#34;start\u0026#34;).where(_.getName().equals(\u0026#34;c\u0026#34;)) .followedBy(\u0026#34;middle\u0026#34;).where(_.getName().equals(\u0026#34;a\u0026#34;)) .oneOrMore().allowCombinations() .followedBy(\u0026#34;end1\u0026#34;).where(_.getName().equals(\u0026#34;b\u0026#34;)) å°†ä¸ºä¸€ä¸ªè¾“å…¥åºåˆ—ç”Ÿæˆä»¥ä¸‹åŒ¹é…ã€‚C D A1 A2 A3 D A4 B\nå¯ç”¨ç»„åˆã€‚{C A1 B}ã€{C A1 A2 B}ã€{C A1 A3 B}ã€{C A1 A4 B}ã€{C A1 A2 A3 B}ã€{C A1 A2 A4 B}ã€{C A1 A3 A4 B}ã€{C A1 A2 A3 A4 B}ã€{C A1 A2 A3 A4 B}ã€‚\nä¸å¯ç”¨ç»„åˆã€‚{C A1 B}, {C A1 A2 B}, {C A1 A2 A3 B}, {C A1 A2 A3 A4 B}ã€‚\næ¨¡å¼ç»„ ä¹Ÿå¯ä»¥å®šä¹‰ä¸€ä¸ªæ¨¡å¼åºåˆ—ä½œä¸º beginã€followByã€followByAny å’Œ next çš„æ¡ä»¶ã€‚è¯¥æ¨¡å¼åºåˆ—å°†è¢«è§†ä¸ºé€»è¾‘ä¸Šçš„åŒ¹é…æ¡ä»¶, å¹¶å°†è¿”å›ä¸€ä¸ª GroupPattern, å¹¶ä¸”å¯ä»¥å¯¹ GroupPattern åº”ç”¨ oneOrMore()ã€times(#ofTimes)ã€times(#fromTimesã€#toTimes)ã€optional()ã€continuous()ã€allowCombinations()ã€‚\nval start: Pattern[Event, _] = Pattern.begin( Pattern.begin[Event](\u0026#34;start\u0026#34;).where(...).followedBy(\u0026#34;start_middle\u0026#34;).where(...) ) // strict contiguity val strict: Pattern[Event, _] = start.next( Pattern.begin[Event](\u0026#34;next_start\u0026#34;).where(...).followedBy(\u0026#34;next_middle\u0026#34;).where(...) ).times(3) // relaxed contiguity val relaxed: Pattern[Event, _] = start.followedBy( Pattern.begin[Event](\u0026#34;followedby_start\u0026#34;).where(...).followedBy(\u0026#34;followedby_middle\u0026#34;).where(...) ).oneOrMore() // non-deterministic relaxed contiguity val nonDetermin: Pattern[Event, _] = start.followedByAny( Pattern.begin[Event](\u0026#34;followedbyany_start\u0026#34;).where(...).followedBy(\u0026#34;followedbyany_middle\u0026#34;).where(...) ).optional()  begin(#name) - å®šä¹‰ä¸€ä¸ªèµ·å§‹æ¨¡å¼ã€‚  val start = Pattern.begin[Event](\u0026#34;start\u0026#34;)  begin(#pattern_sequence) - å®šä¹‰ä¸€ä¸ªèµ·å§‹æ¨¡å¼ã€‚  val start = Pattern.begin( Pattern.begin[Event](\u0026#34;start\u0026#34;).where(...).followedBy(\u0026#34;middle\u0026#34;).where(...) )  next(#name) - æ·»åŠ ä¸€ä¸ªæ–°çš„æ¨¡å¼ã€‚ä¸€ä¸ªåŒ¹é…äº‹ä»¶å¿…é¡»ç›´æ¥æ¥æ›¿å‰ä¸€ä¸ªåŒ¹é…äº‹ä»¶ï¼ˆä¸¥æ ¼ç›¸é‚»ï¼‰ã€‚  val next = start.next(\u0026#34;middle\u0026#34;)  next(#pattern_sequence) - æ·»åŠ ä¸€ä¸ªæ–°çš„æ¨¡å¼ã€‚ä¸€ä¸ªåŒ¹é…äº‹ä»¶çš„åºåˆ—å¿…é¡»ç›´æ¥æ¥æ›¿å‰ä¸€ä¸ªåŒ¹é…äº‹ä»¶ï¼ˆä¸¥æ ¼ç›¸é‚»ï¼‰ã€‚  val next = start.next( Pattern.begin[Event](\u0026#34;start\u0026#34;).where(...).followedBy(\u0026#34;middle\u0026#34;).where(...) )  followedBy(#name) - æ·»åŠ ä¸€ä¸ªæ–°çš„æ¨¡å¼ã€‚å…¶ä»–äº‹ä»¶å¯ä»¥å‘ç”Ÿåœ¨ä¸€ä¸ªåŒ¹é…äº‹ä»¶å’Œä¸Šä¸€ä¸ªåŒ¹é…äº‹ä»¶ä¹‹é—´ï¼ˆæ¾æ•£çš„ç›¸é‚»æ€§ï¼‰ã€‚  val followedBy = start.followedBy(\u0026#34;middle\u0026#34;)  followedBy(#pattern_sequence)\t- æ·»åŠ ä¸€ä¸ªæ–°çš„æ¨¡å¼ã€‚å…¶ä»–äº‹ä»¶å¯ä»¥å‘ç”Ÿåœ¨ä¸€ç³»åˆ—åŒ¹é…äº‹ä»¶å’Œå‰ä¸€ä¸ªåŒ¹é…äº‹ä»¶ä¹‹é—´ï¼ˆæ”¾æ¾çš„ç›¸é‚»æ€§ï¼‰ã€‚  val followedBy = start.followedBy( Pattern.begin[Event](\u0026#34;start\u0026#34;).where(...).followedBy(\u0026#34;middle\u0026#34;).where(...) )  followedByAny(#name) - æ·»åŠ ä¸€ä¸ªæ–°çš„æ¨¡å¼ã€‚åœ¨ä¸€ä¸ªåŒ¹é…äº‹ä»¶å’Œä¸Šä¸€ä¸ªåŒ¹é…äº‹ä»¶ä¹‹é—´å¯ä»¥å‘ç”Ÿå…¶ä»–äº‹ä»¶, å¹¶ä¸”å¯¹æ¯ä¸€ä¸ªå¤‡é€‰åŒ¹é…äº‹ä»¶éƒ½ä¼šå‘ˆç°å¤‡é€‰åŒ¹é…ï¼ˆéç¡®å®šæ€§çš„æ¾æ•£æ¯—è¿æ€§ï¼‰ã€‚  val followedByAny = start.followedByAny(\u0026#34;middle\u0026#34;)  followedByAny(#pattern_sequence) - æ·»åŠ ä¸€ä¸ªæ–°çš„æ¨¡å¼ã€‚åœ¨ä¸€ä¸ªåŒ¹é…äº‹ä»¶åºåˆ—å’Œå‰ä¸€ä¸ªåŒ¹é…äº‹ä»¶ä¹‹é—´å¯ä»¥å‘ç”Ÿå…¶ä»–äº‹ä»¶, å¹¶ä¸”å°†ä¸ºæ¯ä¸€ä¸ªå¯ä¾›é€‰æ‹©çš„åŒ¹é…äº‹ä»¶åºåˆ—å‘ˆç°å¤‡é€‰åŒ¹é…ï¼ˆéç¡®å®šæ€§çš„æ¾æ•£æ¯—è¿æ€§ï¼‰ã€‚  val followedByAny = start.followedByAny( Pattern.begin[Event](\u0026#34;start\u0026#34;).where(...).followedBy(\u0026#34;middle\u0026#34;).where(...) ) notNext() - æ·»åŠ ä¸€ä¸ªæ–°çš„å¦å®šæ¨¡å¼ã€‚ä¸€ä¸ªåŒ¹é…ï¼ˆè´Ÿå€¼ï¼‰äº‹ä»¶å¿…é¡»ç›´æ¥æ¥æ›¿å‰ä¸€ä¸ªåŒ¹é…äº‹ä»¶ï¼ˆä¸¥æ ¼çš„ç›¸é‚»æ€§ï¼‰, ä»¥ä½¿éƒ¨åˆ†åŒ¹é…è¢«ä¸¢å¼ƒã€‚\nval notNext = start.notNext(\u0026#34;not\u0026#34;)  notFollowedBy() - æ·»åŠ ä¸€ä¸ªæ–°çš„è´Ÿæ¨¡å¼ã€‚å³ä½¿åœ¨åŒ¹é…ï¼ˆè´Ÿå€¼ï¼‰äº‹ä»¶å’Œå‰ä¸€ä¸ªåŒ¹é…äº‹ä»¶ä¹‹é—´å‘ç”Ÿäº†å…¶ä»–äº‹ä»¶, éƒ¨åˆ†åŒ¹é…äº‹ä»¶åºåˆ—ä¹Ÿä¼šè¢«ä¸¢å¼ƒï¼ˆæ¾æ•£çš„ç›¸é‚»æ€§ï¼‰ã€‚  val notFollowedBy = start.notFollowedBy(\u0026#34;not\u0026#34;) within(time) - å®šä¹‰äº‹ä»¶åºåˆ—åŒ¹é…æ¨¡å¼çš„æœ€å¤§æ—¶é—´é—´éš”ã€‚å¦‚æœä¸€ä¸ªæœªå®Œæˆçš„äº‹ä»¶åºåˆ—è¶…è¿‡äº†è¿™ä¸ªæ—¶é—´, å®ƒå°†è¢«ä¸¢å¼ƒã€‚\npattern.within(Time.seconds(10)) After Match Skip Strategy å¯¹äºä¸€ä¸ªç»™å®šçš„æ¨¡å¼, åŒä¸€ä¸ªäº‹ä»¶å¯èƒ½ä¼šè¢«åˆ†é…ç»™å¤šä¸ªæˆåŠŸçš„åŒ¹é…ã€‚è¦æ§åˆ¶ä¸€ä¸ªäº‹ä»¶å°†è¢«åˆ†é…åˆ°å¤šå°‘ä¸ªåŒ¹é…ä¸­, ä½ éœ€è¦æŒ‡å®šåä¸º AfterMatchSkipStrategy çš„è·³è¿‡ç­–ç•¥ã€‚æœ‰äº”ç§ç±»å‹çš„è·³è¿‡ç­–ç•¥, å¦‚ä¸‹æ‰€ç¤ºã€‚\n NO_SKIP: æ¯ä¸€ä¸ªå¯èƒ½çš„åŒ¹é…éƒ½ä¼šè¢«å‘å‡ºã€‚ SKIP_TO_NEXTï¼šä¸¢å¼ƒæ¯ä¸€ä¸ªå±€éƒ¨çš„åŒ¹é…, ä»ç›¸åŒçš„äº‹ä»¶å¼€å§‹, å‘å°„åŒ¹é…å¼€å§‹ã€‚ SKIP_PAST_LAST_EVENT: ä¸¢å¼ƒæ¯ä¸€ä¸ªåœ¨åŒ¹é…å¼€å§‹åä½†ç»“æŸå‰å¼€å§‹çš„éƒ¨åˆ†åŒ¹é…ã€‚ SKIP_TO_FIRST: ä¸¢å¼ƒæ¯ä¸ªåœ¨åŒ¹é…å¼€å§‹åä½†åœ¨ PatternName çš„ç¬¬ä¸€ä¸ªäº‹ä»¶å‘ç”Ÿä¹‹å‰å¼€å§‹çš„éƒ¨åˆ†åŒ¹é…ã€‚ SKIP_TO_LAST: ä¸¢å¼ƒåœ¨åŒ¹é…å¼€å§‹åä½†åœ¨ PatternName çš„æœ€åä¸€ä¸ªäº‹ä»¶å‘ç”Ÿä¹‹å‰å¼€å§‹çš„æ¯ä¸€ä¸ªéƒ¨åˆ†åŒ¹é…ã€‚  æ³¨æ„, å½“ä½¿ç”¨ SKIP_TO_FIRST å’Œ SKIP_TO_LAST è·³è¿‡ç­–ç•¥æ—¶, è¿˜åº”è¯¥æŒ‡å®šä¸€ä¸ªæœ‰æ•ˆçš„ PatternNameã€‚\nä¾‹å¦‚, å¯¹äºç»™å®šçš„æ¨¡å¼ b+ c å’Œæ•°æ®æµ b1 b2 b3 c, è¿™å››ç§è·³è¿‡ç­–ç•¥çš„åŒºåˆ«å¦‚ä¸‹ã€‚\n   Skip Strategy ç»“æœ æè¿°     NO_SKIP b1 b2 b3 c b2 b3 c b3 c æ‰¾åˆ°åŒ¹é…çš„ b1 b2 b3 c å, åŒ¹é…è¿‡ç¨‹ä¸ä¼šä¸¢å¼ƒä»»ä½•ç»“æœã€‚   SKIP_TO_NEXT b1 b2 b3 c b2 b3 c b3 c æ‰¾åˆ°åŒ¹é…çš„ b1 b2 b3 c å, åŒ¹é…è¿‡ç¨‹ä¸ä¼šä¸¢å¼ƒä»»ä½•ç»“æœ, å› ä¸ºæ²¡æœ‰å…¶ä»–åŒ¹é…å¯ä»¥ä» b1 å¼€å§‹ã€‚   SKIP_PAST_LAST_EVENT b1 b2 b3 c åœ¨æ‰¾åˆ°åŒ¹é…çš„ b1 b2 b3 c å, åŒ¹é…è¿‡ç¨‹å°†æ”¾å¼ƒæ‰€æœ‰å¼€å§‹çš„éƒ¨åˆ†åŒ¹é…ã€‚   SKIP_TO_FIRST[b] b1 b2 b3 c b2 b3 c b3 c æ‰¾åˆ°åŒ¹é…çš„ b1 b2 b3 c å, åŒ¹é…è¿‡ç¨‹ä¼šå°è¯•ä¸¢å¼ƒæ‰€æœ‰åœ¨ b1 ä¹‹å‰å¼€å§‹çš„éƒ¨åˆ†åŒ¹é…, ä½†æ²¡æœ‰è¿™æ ·çš„åŒ¹é…ã€‚å› æ­¤, æ²¡æœ‰ä»»ä½•åŒ¹é…ç»“æœä¼šè¢«ä¸¢å¼ƒã€‚   SKIP_TO_LAST[b] b1 b2 b3 c b3 c æ‰¾åˆ°åŒ¹é…çš„ b1 b2 b3 c å, åŒ¹é…è¿‡ç¨‹ä¼šå°è¯•ä¸¢å¼ƒæ‰€æœ‰åœ¨ b3 ä¹‹å‰å¼€å§‹çš„éƒ¨åˆ†åŒ¹é…ã€‚æœ‰ä¸€ä¸ªè¿™æ ·çš„åŒ¹é… b2 b3 cã€‚    è¿˜å¯ä»¥çœ‹çœ‹å¦ä¸€ä¸ªä¾‹å­, ä»¥æ›´å¥½åœ°äº†è§£ NO_SKIP å’Œ SKIP_TO_FIRST çš„åŒºåˆ«ï¼šæ¨¡å¼: (a | b | c) (b | c) c+.greedy d å’Œåºåˆ—: a b c1 c2 c3 d é‚£ä¹ˆç»“æœå°†æ˜¯:\n   Skip Strategy ç»“æœ æè¿°     NO_SKIP a b c1 c2 c3 d b c1 c2 c3 d c1 c2 c3 d æ‰¾åˆ°åŒ¹é…çš„ a b c1 c2 c3 d å, åŒ¹é…è¿‡ç¨‹ä¸ä¼šä¸¢å¼ƒä»»ä½•ç»“æœã€‚   SKIP_TO_FIRST[c*] a b c1 c2 c3 d c1 c2 c3 d åœ¨æ‰¾åˆ°åŒ¹é…çš„ a b c1 c2 c3 d å, åŒ¹é…è¿‡ç¨‹å°†ä¸¢å¼ƒæ‰€æœ‰åœ¨ c1 ä¹‹å‰å¼€å§‹çš„éƒ¨åˆ†åŒ¹é…, æœ‰ä¸€ä¸ªè¿™æ ·çš„åŒ¹é… b c1 c2 c3 dã€‚æœ‰ä¸€ä¸ªè¿™æ ·çš„åŒ¹é… b c1 c2 c3 dã€‚    ä¸ºäº†æ›´å¥½åœ°ç†è§£ NO_SKIP å’Œ SKIP_TO_NEXT çš„åŒºåˆ«, è¯·çœ‹ä¸‹é¢çš„ä¾‹å­: Pattern: a b+ å’Œåºåˆ—: a b1 b2 b3 é‚£ä¹ˆç»“æœå°†æ˜¯:\n   Skip Strategy ç»“æœ æè¿°     NO_SKIP a b1 a b1 b2 a b1 b2 b3 æ‰¾åˆ°åŒ¹é…çš„ b1 å, åŒ¹é…è¿‡ç¨‹ä¸ä¼šä¸¢å¼ƒä»»ä½•ç»“æœã€‚   SKIP_TO_NEXT a b1 åœ¨æ‰¾åˆ°åŒ¹é…çš„ b1 å, åŒ¹é…è¿‡ç¨‹å°†ä¸¢å¼ƒä» a å¼€å§‹çš„æ‰€æœ‰éƒ¨åˆ†åŒ¹é…, è¿™æ„å‘³ç€æ—¢ä¸èƒ½ç”Ÿæˆ b1 b2, ä¹Ÿä¸èƒ½ç”Ÿæˆ b1 b2 b3ã€‚    è¦æŒ‡å®šä½¿ç”¨å“ªç§è·³è¿‡ç­–ç•¥, åªéœ€è°ƒç”¨ AfterMatchSkipStrategy æ¥åˆ›å»ºä¸€ä¸ª AfterMatchSkipStrategyã€‚\n   åŠŸèƒ½ æè¿°     AfterMatchSkipStrategy.noSkip() åˆ›å»ºä¸€ä¸ª NO_SKIP è·³è¿‡ç­–ç•¥   AfterMatchSkipStrategy.skipToNext() åˆ›å»ºä¸€ä¸ª SKIP_TO_NEXT è·³è¿‡ç­–ç•¥ã€‚   AfterMatchSkipStrategy.skipPastLastEvent() åˆ›å»ºä¸€ä¸ª SKIP_PAST_LAST_EVENT è·³è¿‡ç­–ç•¥ã€‚   AfterMatchSkipStrategy.skipToFirst(patternName) ç”¨å¼•ç”¨çš„æ¨¡å¼å patternName åˆ›å»ºä¸€ä¸ª SKIP_TO_FIRST è·³è¿‡ç­–ç•¥ã€‚   AfterMatchSkipStrategy.skipToLast(patternName) ç”¨å¼•ç”¨çš„æ¨¡å¼å patternName åˆ›å»ºä¸€ä¸ª SKIP_TO_LAST è·³è¿‡ç­–ç•¥ã€‚    ç„¶åé€šè¿‡è°ƒç”¨è·³è¿‡ç­–ç•¥æ¥åº”ç”¨äºæ¨¡å¼ã€‚\nval skipStrategy = ... Pattern.begin(\u0026#34;patternName\u0026#34;, skipStrategy) æ³¨æ„ å¯¹äº SKIP_TO_FIRST/LAST æœ‰ä¸¤ä¸ªé€‰é¡¹æ¥å¤„ç†æ²¡æœ‰å…ƒç´ æ˜ å°„åˆ°æŒ‡å®šå˜é‡çš„æƒ…å†µã€‚é»˜è®¤æƒ…å†µä¸‹, å°†ä½¿ç”¨ NO_SKIP ç­–ç•¥ã€‚å¦ä¸€ä¸ªé€‰é¡¹æ˜¯åœ¨è¿™ç§æƒ…å†µä¸‹æŠ›å‡ºå¼‚å¸¸ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¯ç”¨è¿™ä¸ªé€‰é¡¹\nAfterMatchSkipStrategy.skipToFirst(patternName).throwExceptionOnMiss() æ£€æµ‹æ¨¡å¼ åœ¨æŒ‡å®šäº†ä½ è¦å¯»æ‰¾çš„æ¨¡å¼åºåˆ—å, ç°åœ¨æ˜¯æ—¶å€™å°†å…¶åº”ç”¨åˆ°ä½ çš„è¾“å…¥æµä¸­ä»¥æ£€æµ‹æ½œåœ¨çš„åŒ¹é…ã€‚è¦é’ˆå¯¹ä½ çš„æ¨¡å¼åºåˆ—è¿è¡Œäº‹ä»¶æµ, ä½ å¿…é¡»åˆ›å»ºä¸€ä¸ª PatternStreamã€‚ç»™å®šä¸€ä¸ªè¾“å…¥æµè¾“å…¥ã€ä¸€ä¸ªæ¨¡å¼æ¨¡å¼å’Œä¸€ä¸ªå¯é€‰çš„æ¯”è¾ƒå™¨æ¯”è¾ƒå™¨, ç”¨äºåœ¨ EventTime çš„æƒ…å†µä¸‹å¯¹å…·æœ‰ç›¸åŒæ—¶é—´æˆ³çš„äº‹ä»¶æˆ–åœ¨åŒä¸€æ—¶åˆ»åˆ°è¾¾çš„äº‹ä»¶è¿›è¡Œæ’åº, ä½ å¯ä»¥é€šè¿‡è°ƒç”¨åˆ›å»º PatternStreamã€‚\nval input : DataStream[Event] = ... val pattern : Pattern[Event, _] = ... var comparator : EventComparator[Event] = ... // optional  val patternStream: PatternStream[Event] = CEP.pattern(input, pattern, comparator) è¾“å…¥æµå¯ä»¥æ˜¯ keyed çš„, ä¹Ÿå¯ä»¥æ˜¯ non-keyed çš„, è¿™å–å†³äºä½ çš„ä½¿ç”¨æƒ…å†µã€‚\næ³¨æ„: åœ¨ non-keyed æµä¸Šåº”ç”¨æ¨¡å¼å°†å¯¼è‡´ä½œä¸šçš„å¹¶è¡Œåº¦ç­‰äº 1ã€‚\nä»æ¨¡å¼ä¸­é€‰æ‹© ä¸€æ—¦ä½ è·å¾—äº†ä¸€ä¸ª PatternStream, ä½ å°±å¯ä»¥å¯¹æ£€æµ‹åˆ°çš„äº‹ä»¶åºåˆ—è¿›è¡Œè½¬æ¢ã€‚å»ºè®®çš„æ–¹æ³•æ˜¯é€šè¿‡ PatternProcessFunction æ¥å®ç°ã€‚\nPatternProcessFunction æœ‰ä¸€ä¸ª processMatch æ–¹æ³•, å®ƒå¯¹æ¯ä¸ªåŒ¹é…çš„äº‹ä»¶åºåˆ—éƒ½ä¼šè¢«è°ƒç”¨ã€‚å®ƒä»¥ Map\u0026lt;String, List\u0026lt;IN\u0026gt;\u0026gt; çš„å½¢å¼æ¥æ”¶åŒ¹é…, å…¶ä¸­é”®æ˜¯ä½ çš„æ¨¡å¼åºåˆ—ä¸­æ¯ä¸ªæ¨¡å¼çš„åç§°, å€¼æ˜¯è¯¥æ¨¡å¼çš„æ‰€æœ‰æ¥å—äº‹ä»¶çš„åˆ—è¡¨ï¼ˆIN æ˜¯ä½ çš„è¾“å…¥å…ƒç´ çš„ç±»å‹ï¼‰ã€‚ç»™å®šæ¨¡å¼çš„äº‹ä»¶æ˜¯æŒ‰æ—¶é—´æˆ³æ’åºçš„ã€‚è¿”å›æ¯ä¸ªæ¨¡å¼æ‰€æ¥å—çš„äº‹ä»¶åˆ—è¡¨çš„åŸå› æ˜¯, å½“ä½¿ç”¨å¾ªç¯æ¨¡å¼(ä¾‹å¦‚ oneToMany() å’Œ times())æ—¶, ä¸€ä¸ªç»™å®šæ¨¡å¼å¯èƒ½ä¼šæ¥å—å¤šä¸ªäº‹ä»¶ã€‚\nclass MyPatternProcessFunction\u0026lt;IN, OUT\u0026gt; extends PatternProcessFunction\u0026lt;IN, OUT\u0026gt; { @Override public void processMatch(Map\u0026lt;String, List\u0026lt;IN\u0026gt;\u0026gt; match, Context ctx, Collector\u0026lt;OUT\u0026gt; out) throws Exception; IN startEvent = match.get(\u0026#34;start\u0026#34;).get(0); IN endEvent = match.get(\u0026#34;end\u0026#34;).get(0); out.collect(OUT(startEvent, endEvent)); } } PatternProcessFunction æä¾›äº†å¯¹ Context å¯¹è±¡çš„è®¿é—®ã€‚é€šè¿‡å®ƒ, æˆ‘ä»¬å¯ä»¥è®¿é—®ä¸æ—¶é—´ç›¸å…³çš„ç‰¹æ€§, å¦‚å½“å‰å¤„ç†æ—¶é—´æˆ–å½“å‰åŒ¹é…çš„æ—¶é—´æˆ³ï¼ˆè¿™æ˜¯åˆ†é…ç»™åŒ¹é…çš„æœ€åä¸€ä¸ªå…ƒç´ çš„æ—¶é—´æˆ³ï¼‰ã€‚æ›´å¤šä¿¡æ¯è¯·çœ‹æ—¶é—´ä¸Šä¸‹æ–‡ã€‚é€šè¿‡è¿™ä¸ªä¸Šä¸‹æ–‡, æˆ‘ä»¬è¿˜å¯ä»¥å°†ç»“æœå‘é€åˆ°ä¸€ä¸ªä¾§è¾“å‡ºã€‚\nå¤„ç†è¶…æ—¶çš„éƒ¨åˆ†æ¨¡å¼ å½“ä¸€ä¸ªæ¨¡å¼é€šè¿‡ within å…³é”®å­—é™„åŠ äº†ä¸€ä¸ªçª—å£é•¿åº¦æ—¶, éƒ¨åˆ†äº‹ä»¶åºåˆ—æœ‰å¯èƒ½å› ä¸ºè¶…è¿‡çª—å£é•¿åº¦è€Œè¢«ä¸¢å¼ƒã€‚è¦å¯¹ä¸€ä¸ªè¶…æ—¶çš„éƒ¨åˆ†åŒ¹é…é‡‡å–è¡ŒåŠ¨, å¯ä»¥ä½¿ç”¨ TimedOutPartialMatchHandler æ¥å£ã€‚è¯¥æ¥å£åº”è¯¥ä»¥æ··æ­çš„æ–¹å¼ä½¿ç”¨ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨ä½ çš„ PatternProcessFunction ä¸­é¢å¤–å®ç°è¿™ä¸ªæ¥å£ã€‚TimedOutPartialMatchHandler æä¾›äº†é¢å¤–çš„ processTimedOutMatch æ–¹æ³•, è¯¥æ–¹æ³•å°†ä¸ºæ¯ä¸ªè¶…æ—¶éƒ¨åˆ†åŒ¹é…è°ƒç”¨ã€‚\nclass MyPatternProcessFunction\u0026lt;IN, OUT\u0026gt; extends PatternProcessFunction\u0026lt;IN, OUT\u0026gt; implements TimedOutPartialMatchHandler\u0026lt;IN\u0026gt; { @Override public void processMatch(Map\u0026lt;String, List\u0026lt;IN\u0026gt;\u0026gt; match, Context ctx, Collector\u0026lt;OUT\u0026gt; out) throws Exception; ... } @Override public void processTimedOutMatch(Map\u0026lt;String, List\u0026lt;IN\u0026gt;\u0026gt; match, Context ctx) throws Exception; IN startEvent = match.get(\u0026#34;start\u0026#34;).get(0); ctx.output(outputTag, T(startEvent)); } } æ³¨æ„: processTimedOutMatch ä¸ç»™äººè®¿é—®ä¸»è¾“å‡ºçš„æœºä¼šã€‚ä½†ä½ ä»ç„¶å¯ä»¥é€šè¿‡ Context å¯¹è±¡, é€šè¿‡ä¾§è¾“å‡ºæ¥å‘å‡ºç»“æœã€‚\næ–¹ä¾¿çš„ API å‰é¢æåˆ°çš„ PatternProcessFunction æ˜¯åœ¨ Flink 1.8 ä¸­å¼•å…¥çš„, ä»é‚£æ—¶èµ·, å®ƒå°±æ˜¯æ¨èçš„ä¸åŒ¹é…äº¤äº’çš„æ–¹å¼ã€‚äººä»¬ä»ç„¶å¯ä»¥ä½¿ç”¨è€å¼çš„ API, æ¯”å¦‚ select/flatSelect, å†…éƒ¨ä¼šè¢«ç¿»è¯‘æˆ PatternProcessFunctionã€‚\nval patternStream: PatternStream[Event] = CEP.pattern(input, pattern) val outputTag = OutputTag[String](\u0026#34;side-output\u0026#34;) val result: SingleOutputStreamOperator[ComplexEvent] = patternStream.flatSelect(outputTag){ (pattern: Map[String, Iterable[Event]], timestamp: Long, out: Collector[TimeoutEvent]) =\u0026gt; out.collect(TimeoutEvent()) } { (pattern: mutable.Map[String, Iterable[Event]], out: Collector[ComplexEvent]) =\u0026gt; out.collect(ComplexEvent()) } val timeoutResult: DataStream[TimeoutEvent] = result.getSideOutput(outputTag) åœ¨ CEP åº“ä¸­çš„æ—¶é—´ å¤„ç†äº‹ä»¶æ—¶é—´çš„å»¶è¿Ÿ åœ¨ CEP ä¸­, å¤„ç†å…ƒç´ çš„é¡ºåºå¾ˆé‡è¦ã€‚ä¸ºäº†ä¿è¯å…ƒç´ åœ¨äº‹ä»¶æ—¶é—´å·¥ä½œæ—¶ä»¥æ­£ç¡®çš„é¡ºåºè¿›è¡Œå¤„ç†, ä¸€ä¸ªä¼ å…¥çš„å…ƒç´ æœ€åˆä¼šè¢«æ”¾åœ¨ä¸€ä¸ªç¼“å†²åŒºä¸­, åœ¨è¿™ä¸ªç¼“å†²åŒºä¸­, å…ƒç´ æ ¹æ®å…¶æ—¶é—´æˆ³æŒ‰å‡åºæ’åº, å½“ä¸€ä¸ªæ°´å°åˆ°è¾¾æ—¶, è¿™ä¸ªç¼“å†²åŒºä¸­æ‰€æœ‰æ—¶é—´æˆ³å°äºæ°´å°çš„å…ƒç´ éƒ½ä¼šè¢«å¤„ç†ã€‚è¿™æ„å‘³ç€æ°´å°ä¹‹é—´çš„å…ƒç´ æ˜¯æŒ‰äº‹ä»¶æ—¶é—´é¡ºåºå¤„ç†çš„ã€‚\næ³¨æ„: å½“åœ¨äº‹ä»¶æ—¶é—´å†…å·¥ä½œæ—¶, è¯¥åº“å‡å®šæ°´å°çš„æ­£ç¡®æ€§ã€‚\nä¸ºäº†ä¿è¯æ°´å°ä¹‹é—´çš„å…ƒç´ æŒ‰äº‹ä»¶æ—¶é—´é¡ºåºå¤„ç†, Flink çš„ CEP åº“å‡è®¾æ°´å°çš„æ­£ç¡®æ€§, å¹¶å°†æ—¶é—´æˆ³å°äºæœ€åçœ‹åˆ°çš„æ°´å°çš„å…ƒç´ è§†ä¸ºè¿Ÿåˆ°å…ƒç´ ã€‚è¿Ÿåˆ°çš„å…ƒç´ ä¸ä¼šè¢«è¿›ä¸€æ­¥å¤„ç†ã€‚å¦å¤–, ä½ å¯ä»¥æŒ‡å®šä¸€ä¸ª sideOutput æ ‡ç­¾æ¥æ”¶é›†æœ€åä¸€æ¬¡çœ‹åˆ°çš„æ°´å°ä¹‹åçš„è¿Ÿåˆ°å…ƒç´ , ä½ å¯ä»¥è¿™æ ·ä½¿ç”¨ã€‚\nval patternStream: PatternStream[Event] = CEP.pattern(input, pattern) val lateDataOutputTag = OutputTag[String](\u0026#34;late-data\u0026#34;) val result: SingleOutputStreamOperator[ComplexEvent] = patternStream .sideOutputLateData(lateDataOutputTag) .select{ pattern: Map[String, Iterable[ComplexEvent]] =\u0026gt; ComplexEvent() } val lateData: DataStream[String] = result.getSideOutput(lateDataOutputTag) æ—¶é—´ä¸Šä¸‹æ–‡ åœ¨ PatternProcessFunction ä»¥åŠ IterativeCondition ä¸­, ç”¨æˆ·å¯ä»¥è®¿é—®ä¸€ä¸ªå®ç° TimeContext çš„ä¸Šä¸‹æ–‡, å¦‚ä¸‹æ‰€ç¤ºã€‚\n/** * Enables access to time related characteristics such as current processing time or timestamp of * currently processed element. Used in {@link PatternProcessFunction} and * {@link org.apache.flink.cep.pattern.conditions.IterativeCondition} */ @PublicEvolving public interface TimeContext { /** * Timestamp of the element currently being processed. * * \u0026lt;p\u0026gt;In case of {@link org.apache.flink.streaming.api.TimeCharacteristic#ProcessingTime} this * will be set to the time when event entered the cep operator. */ long timestamp(); /** Returns the current processing time. */ long currentProcessingTime(); } è¿™ä¸ªä¸Šä¸‹æ–‡è®©ç”¨æˆ·å¯ä»¥è®¿é—®å¤„ç†äº‹ä»¶çš„æ—¶é—´ç‰¹å¾ï¼ˆåœ¨ IterativeCondition çš„æƒ…å†µä¸‹æ˜¯ä¼ å…¥è®°å½•, åœ¨ PatternProcessFunction çš„æƒ…å†µä¸‹æ˜¯åŒ¹é…ï¼‰ã€‚è°ƒç”¨ TimeContext#currentProcessingTime æ€»æ˜¯ç»™ä½ å½“å‰å¤„ç†æ—¶é—´çš„å€¼, è¿™ä¸ªè°ƒç”¨åº”è¯¥æ¯”è°ƒç”¨ System.currentTimeMillis()æ›´å¯å–ã€‚\nåœ¨ TimeContext#timestamp() çš„æƒ…å†µä¸‹, è¿”å›çš„å€¼ç­‰äº EventTime ä¸­åˆ†é…çš„æ—¶é—´æˆ³ã€‚åœ¨ ProcessingTime ä¸­, è¿™å°†ç­‰äºæ‰€è¿°äº‹ä»¶è¿›å…¥ cep è¿ç®—ç¬¦çš„æ—¶é—´ç‚¹(æˆ–è€…åœ¨ PatternProcessFunction çš„æƒ…å†µä¸‹ç”ŸæˆåŒ¹é…æ—¶)ã€‚è¿™æ„å‘³ç€è¯¥å€¼å°†åœ¨å¯¹è¯¥æ–¹æ³•çš„å¤šæ¬¡è°ƒç”¨ä¸­ä¿æŒä¸€è‡´ã€‚\nä¾‹å­ ä¸‹é¢çš„ä¾‹å­æ˜¯åœ¨äº‹ä»¶çš„é”®æ§æ•°æ®æµä¸Šæ£€æµ‹æ¨¡å¼ start, middle(name = \u0026ldquo;error\u0026rdquo;) -\u0026gt; end(name = \u0026ldquo;critical\u0026rdquo;)ã€‚è¿™äº›äº‹ä»¶é€šè¿‡å…¶ id è¿›è¡Œ keyed, ä¸€ä¸ªæœ‰æ•ˆçš„æ¨¡å¼å¿…é¡»åœ¨ 10 ç§’å†…å‡ºç°ã€‚æ•´ä¸ªå¤„ç†è¿‡ç¨‹æ˜¯ä»¥äº‹ä»¶æ—¶é—´æ¥å®Œæˆçš„ã€‚\nval env : StreamExecutionEnvironment = ... val input : DataStream[Event] = ... val partitionedInput = input.keyBy(event =\u0026gt; event.getId) val pattern = Pattern.begin[Event](\u0026#34;start\u0026#34;) .next(\u0026#34;middle\u0026#34;).where(_.getName == \u0026#34;error\u0026#34;) .followedBy(\u0026#34;end\u0026#34;).where(_.getName == \u0026#34;critical\u0026#34;) .within(Time.seconds(10)) val patternStream = CEP.pattern(partitionedInput, pattern) val alerts = patternStream.select(createAlert(_)) ä»æ—§ç‰ˆæœ¬(1.3 å‰)è¿ç§»åˆ° 1.4 ä»¥ä¸Šç‰ˆæœ¬ è¿ç§»åˆ° 1.4+ ç‰ˆæœ¬ åœ¨ Flink-1.4 ä¸­, CEP åº“ä¸ \u0026lt;= Flink 1.2 çš„å‘åå…¼å®¹æ€§è¢«å–æ¶ˆã€‚ä¸å¹¸çš„æ˜¯, æ— æ³•æ¢å¤æ›¾ç»åœ¨ 1.2.x ä¸‹è¿è¡Œçš„ CEP ä½œä¸šã€‚\nè¿ç§»åˆ° 1.3.x Flink-1.3 ä¸­çš„ CEP åº“æœ‰å¾ˆå¤šæ–°çš„ç‰¹æ€§, è¿™å¯¼è‡´äº† API çš„ä¸€äº›å˜åŒ–ã€‚åœ¨è¿™é‡Œ, æˆ‘ä»¬æè¿°äº†ä¸ºäº†èƒ½å¤Ÿåœ¨ Flink-1.3 ä¸­è¿è¡Œ, ä½ éœ€è¦å¯¹ä½ çš„æ—§ CEP ä½œä¸šè¿›è¡Œçš„ä¿®æ”¹ã€‚åœ¨åšäº†è¿™äº›æ”¹å˜å¹¶é‡æ–°ç¼–è¯‘ä½ çš„ä½œä¸šå, ä½ å°†èƒ½å¤Ÿä»æ—§ç‰ˆä½œä¸šçš„ä¿å­˜ç‚¹æ¢å¤æ‰§è¡Œ, ä¹Ÿå°±æ˜¯è¯´, ä¸éœ€è¦é‡æ–°å¤„ç†ä½ è¿‡å»çš„æ•°æ®ã€‚\næ‰€éœ€çš„æ›´æ”¹æ˜¯:\n  æ”¹å˜ä½ çš„æ¡ä»¶ï¼ˆåœ¨ where(\u0026hellip;) å­å¥ä¸­çš„æ¡ä»¶ï¼‰æ¥æ‰©å±• SimpleCondition ç±», è€Œä¸æ˜¯å®ç° FilterFunction æ¥å£ã€‚\n  æ”¹å˜ä½ çš„å‡½æ•°ä½œä¸ºå‚æ•°æä¾›ç»™ select(\u0026hellip;) å’Œ flatSelect(\u0026hellip;) æ–¹æ³•, ä»¥æœŸæœ›ä¸æ¯ä¸ªæ¨¡å¼ç›¸å…³è”çš„äº‹ä»¶åˆ—è¡¨(Java ä¸­ä¸º List, Scala ä¸­ä¸º Iterable)ã€‚è¿™æ˜¯å› ä¸ºå¢åŠ äº†å¾ªç¯æ¨¡å¼å, å¤šä¸ªè¾“å…¥äº‹ä»¶å¯ä»¥åŒ¹é…ä¸€ä¸ªï¼ˆå¾ªç¯ï¼‰æ¨¡å¼ã€‚\n  Flink 1.1 å’Œ 1.2 ä¸­çš„ followBy() æš—ç¤ºäº†éç¡®å®šæ€§çš„æ¾æ•£æ¯—è¿æ€§ï¼ˆè§è¿™é‡Œï¼‰ã€‚åœ¨ Flink 1.3 ä¸­, è¿™ä¸€ç‚¹å‘ç”Ÿäº†å˜åŒ–, followBy() æ„å‘³ç€æ¾æ•£æ¯—è¿, è€Œ followByAny() åº”è¯¥åœ¨éœ€è¦éç¡®å®šæ€§æ¾æ•£æ¯—è¿çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚\n  ","permalink":"https://ohmyweekly.github.io/notes/2020-12-20-flink-cep-complex-event-processing-for-flink/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£"],"title":"FlinkCEP - Flink çš„å¤æ‚äº‹ä»¶å¤„ç†"},{"categories":["Flink"],"contents":"æ‰§è¡Œæ¨¡å¼(æµ/æ‰¹) DataStream API æ”¯æŒä¸åŒçš„è¿è¡Œæ—¶æ‰§è¡Œæ¨¡å¼ï¼Œä½ å¯ä»¥æ ¹æ®ç”¨ä¾‹çš„è¦æ±‚å’Œä½œä¸šçš„ç‰¹ç‚¹ä»ä¸­é€‰æ‹©ã€‚\nDataStream API æœ‰ä¸€ç§\u0026quot;ç»å…¸\u0026quot;çš„æ‰§è¡Œè¡Œä¸ºï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º STREAMING æ‰§è¡Œæ¨¡å¼ã€‚è¿™åº”è¯¥ç”¨äºéœ€è¦è¿ç»­å¢é‡å¤„ç†å¹¶é¢„è®¡æ— é™æœŸä¿æŒåœ¨çº¿çš„æ— è¾¹ç•Œä½œä¸šã€‚\næ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ç§æ‰¹å¼æ‰§è¡Œæ¨¡å¼ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º BATCH æ‰§è¡Œæ¨¡å¼ã€‚è¿™ç§æ‰§è¡Œä½œä¸šçš„æ–¹å¼æ›´å®¹æ˜“è®©äººè”æƒ³åˆ°æ‰¹å¤„ç†æ¡†æ¶ï¼Œå¦‚ MapReduceã€‚è¿™åº”è¯¥ç”¨äºæœ‰è¾¹ç•Œçš„ä½œä¸šï¼Œå¯¹äºè¿™äº›ä½œä¸šï¼Œä½ æœ‰ä¸€ä¸ªå·²çŸ¥çš„å›ºå®šè¾“å…¥ï¼Œå¹¶ä¸”ä¸ä¼šè¿ç»­è¿è¡Œã€‚\nApache Flink å¯¹æµå’Œæ‰¹å¤„ç†çš„ç»Ÿä¸€æ–¹æ³•æ„å‘³ç€ï¼Œæ— è®ºé…ç½®ä½•ç§æ‰§è¡Œæ¨¡å¼ï¼Œåœ¨æœ‰ç•Œè¾“å…¥ä¸Šæ‰§è¡Œçš„ DataStream åº”ç”¨éƒ½ä¼šäº§ç”Ÿç›¸åŒçš„æœ€ç»ˆç»“æœã€‚é‡è¦çš„æ˜¯è¦æ³¨æ„è¿™é‡Œçš„ final æ˜¯ä»€ä¹ˆæ„æ€ï¼šåœ¨ streaming æ¨¡å¼ä¸‹æ‰§è¡Œçš„ä½œä¸šå¯èƒ½ä¼šäº§ç”Ÿå¢é‡æ›´æ–°ï¼ˆæƒ³æƒ³æ•°æ®åº“ä¸­çš„ upsertsï¼‰ï¼Œè€Œ batch ä½œä¸šåœ¨æœ€ååªä¼šäº§ç”Ÿä¸€ä¸ªæœ€ç»ˆç»“æœã€‚å¦‚æœè§£é‡Šæ­£ç¡®çš„è¯ï¼Œæœ€ç»ˆçš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯åˆ°è¾¾é‚£é‡Œçš„æ–¹å¼å¯èƒ½æ˜¯ä¸åŒçš„ã€‚\né€šè¿‡å¯ç”¨ BATCH æ‰§è¡Œï¼Œæˆ‘ä»¬å…è®¸ Flink åº”ç”¨é¢å¤–çš„ä¼˜åŒ–ï¼Œè€Œè¿™äº›ä¼˜åŒ–åªæœ‰åœ¨æˆ‘ä»¬çŸ¥é“æˆ‘ä»¬çš„è¾“å…¥æ˜¯æœ‰è¾¹ç•Œçš„æƒ…å†µä¸‹æ‰èƒ½è¿›è¡Œã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„ join/aggregation ç­–ç•¥ï¼Œæ­¤å¤–è¿˜å¯ä»¥ä½¿ç”¨ä¸åŒçš„ shuffle å®ç°ï¼Œå…è®¸æ›´é«˜æ•ˆçš„ä»»åŠ¡è°ƒåº¦å’Œæ•…éšœæ¢å¤è¡Œä¸ºã€‚ä¸‹é¢æˆ‘ä»¬å°†ä»‹ç»ä¸€äº›æ‰§è¡Œè¡Œä¸ºçš„ç»†èŠ‚ã€‚\nä»€ä¹ˆæ—¶å€™å¯ä»¥/åº”è¯¥ä½¿ç”¨ BATCH æ‰§è¡Œæ¨¡å¼ï¼Ÿ BATCH æ‰§è¡Œæ¨¡å¼åªèƒ½ç”¨äºæœ‰è¾¹ç•Œçš„ Job/Link ç¨‹åºã€‚è¾¹ç•Œæ€§æ˜¯æ•°æ®æºçš„ä¸€ä¸ªå±æ€§ï¼Œå®ƒå‘Šè¯‰æˆ‘ä»¬åœ¨æ‰§è¡Œä¹‹å‰ï¼Œæ¥è‡ªè¯¥æ•°æ®æºçš„æ‰€æœ‰è¾“å…¥æ˜¯å¦éƒ½æ˜¯å·²çŸ¥çš„ï¼Œæˆ–è€…æ˜¯å¦ä¼šæœ‰æ–°çš„æ•°æ®å‡ºç°ï¼Œå¯èƒ½æ˜¯æ— é™çš„ã€‚è€Œä¸€ä¸ªä½œä¸šï¼Œå¦‚æœå®ƒçš„æ‰€æœ‰æºéƒ½æ˜¯æœ‰ç•Œçš„ï¼Œåˆ™æ˜¯æœ‰ç•Œçš„ï¼Œå¦åˆ™å°±æ˜¯æ— ç•Œçš„ã€‚\nå¦ä¸€æ–¹é¢ï¼ŒSTREAMING æ‰§è¡Œæ¨¡å¼æ—¢å¯ä»¥ç”¨äºæœ‰ç•Œä½œä¸šï¼Œä¹Ÿå¯ä»¥ç”¨äºæ— ç•Œä½œä¸šã€‚\nä½œä¸ºç»éªŒæ³•åˆ™ï¼Œå½“ä½ çš„ç¨‹åºæ˜¯æœ‰ç•Œçš„æ—¶å€™ï¼Œä½ åº”è¯¥ä½¿ç”¨ BATCH æ‰§è¡Œæ¨¡å¼ï¼Œå› ä¸ºè¿™æ ·ä¼šæ›´æœ‰æ•ˆç‡ã€‚å½“ä½ çš„ç¨‹åºæ˜¯æ— è¾¹ç•Œçš„æ—¶å€™ï¼Œä½ å¿…é¡»ä½¿ç”¨ STREAMING æ‰§è¡Œæ¨¡å¼ï¼Œå› ä¸ºåªæœ‰è¿™ç§æ¨¡å¼è¶³å¤Ÿé€šç”¨ï¼Œèƒ½å¤Ÿå¤„ç†è¿ç»­çš„æ•°æ®æµã€‚\nä¸€ä¸ªæ˜æ˜¾çš„ä¾‹å¤–æƒ…å†µæ˜¯ï¼Œå½“ä½ æƒ³ä½¿ç”¨ä¸€ä¸ªæœ‰ç•Œä½œä¸šæ¥å¼•å¯¼ä¸€äº›ä½œä¸šçŠ¶æ€ï¼Œç„¶åä½ æƒ³åœ¨ä¸€ä¸ªæ— ç•Œä½œä¸šä¸­ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡ä½¿ç”¨ STREAMING æ¨¡å¼è¿è¡Œä¸€ä¸ªæœ‰ç•Œä½œä¸šï¼Œå–ä¸€ä¸ªä¿å­˜ç‚¹ï¼Œç„¶ååœ¨ä¸€ä¸ªæ— ç•Œä½œä¸šä¸Šæ¢å¤è¯¥ä¿å­˜ç‚¹ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸ç‰¹æ®Šçš„ç”¨ä¾‹ï¼Œå½“æˆ‘ä»¬å…è®¸å°†ä¿å­˜ç‚¹ä½œä¸º BATCH æ‰§è¡Œä½œä¸šçš„é¢å¤–è¾“å‡ºæ—¶ï¼Œè¿™ä¸ªç”¨ä¾‹å¯èƒ½å¾ˆå¿«å°±ä¼šè¿‡æ—¶ã€‚\nå¦ä¸€ä¸ªå¯èƒ½ä½¿ç”¨ STREAMING æ¨¡å¼è¿è¡Œæœ‰è¾¹ç•Œä½œä¸šçš„æƒ…å†µæ˜¯ä¸ºæœ€ç»ˆå°†åœ¨æ— è¾¹ç•Œæºä¸­è¿è¡Œçš„ä»£ç ç¼–å†™æµ‹è¯•æ—¶ã€‚å¯¹äºæµ‹è¯•æ¥è¯´ï¼Œåœ¨è¿™äº›æƒ…å†µä¸‹ä½¿ç”¨æœ‰ç•Œæºå¯èƒ½æ›´è‡ªç„¶ã€‚\né…ç½® BATCH æ‰§è¡Œæ¨¡å¼ æ‰§è¡Œæ¨¡å¼å¯ä»¥é€šè¿‡ execute.runtim-mode è®¾ç½®æ¥é…ç½®ã€‚æœ‰ä¸‰ç§å¯èƒ½çš„å€¼:\n STREAMING: ç»å…¸çš„ DataStream æ‰§è¡Œæ¨¡å¼(é»˜è®¤) BATCH: åœ¨ DataStream API ä¸Šè¿›è¡Œæ‰¹é‡å¼æ‰§è¡Œ AUTOMATICï¼šè®©ç³»ç»Ÿæ ¹æ®æºçš„è¾¹ç•Œæ€§æ¥å†³å®š  è¿™å¯ä»¥é€šè¿‡ bin/flink run ... çš„å‘½ä»¤è¡Œå‚æ•°è¿›è¡Œé…ç½®ï¼Œæˆ–è€…åœ¨åˆ›å»º/é…ç½® StreamExecutionEnvironment æ—¶è¿›è¡Œç¼–ç¨‹ã€‚\nä¸‹é¢æ˜¯å¦‚ä½•é€šè¿‡å‘½ä»¤è¡Œé…ç½®æ‰§è¡Œæ¨¡å¼:\n$ bin/flink run -Dexecution.runtime-mode=BATCH examples/streaming/WordCount.jar è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨ä»£ç ä¸­é…ç½®æ‰§è¡Œæ¨¡å¼:\nStreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); env.setRuntimeMode(RuntimeExecutionMode.BATCH);  æ³¨æ„ï¼šæˆ‘ä»¬å»ºè®®ç”¨æˆ·ä¸è¦åœ¨ç¨‹åºä¸­è®¾ç½®è¿è¡Œæ¨¡å¼ï¼Œè€Œæ˜¯åœ¨æäº¤åº”ç”¨ç¨‹åºæ—¶ä½¿ç”¨å‘½ä»¤è¡Œè¿›è¡Œè®¾ç½®ã€‚ä¿æŒåº”ç”¨ç¨‹åºä»£ç çš„å…é…ç½®å¯ä»¥è®©ç¨‹åºæ›´åŠ çµæ´»ï¼Œå› ä¸ºåŒä¸€ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥åœ¨ä»»ä½•æ‰§è¡Œæ¨¡å¼ä¸‹æ‰§è¡Œã€‚\n æ‰§è¡Œè¡Œä¸º æœ¬èŠ‚æ¦‚è¿°äº† BATCH æ‰§è¡Œæ¨¡å¼çš„æ‰§è¡Œè¡Œä¸ºï¼Œå¹¶ä¸ STREAMING æ‰§è¡Œæ¨¡å¼è¿›è¡Œäº†å¯¹æ¯”ã€‚è¯¦ç»†å†…å®¹è¯·å‚è€ƒä»‹ç»è¯¥åŠŸèƒ½çš„ FLIP-134 å’Œ FLIP-140ã€‚\nä»»åŠ¡è°ƒåº¦å’Œç½‘ç»œæ´—ç‰Œ(Shuffle) Flink ä½œä¸š(job)ç”±ä¸åŒçš„æ“ä½œ(operation)ç»„æˆï¼Œè¿™äº›æ“ä½œåœ¨æ•°æ®æµå›¾ä¸­è¿æ¥åœ¨ä¸€èµ·ã€‚ç³»ç»Ÿå†³å®šå¦‚ä½•åœ¨ä¸åŒçš„è¿›ç¨‹/æœºå™¨ï¼ˆTaskManagerï¼‰ä¸Šå®‰æ’è¿™äº›æ“ä½œçš„æ‰§è¡Œï¼Œä»¥åŠå¦‚ä½•åœ¨å®ƒä»¬ä¹‹é—´æ´—ç‰Œï¼ˆå‘é€ï¼‰æ•°æ®ã€‚\nå¤šä¸ªæ“ä½œ/è¿ç®—ç¬¦å¯ä»¥ä½¿ç”¨ä¸€ç§ç§°ä¸ºé“¾å¼çš„åŠŸèƒ½é“¾åœ¨ä¸€èµ·ã€‚Flink è®¤ä¸ºä½œä¸ºè°ƒåº¦å•ä½çš„ä¸€ç»„ä¸€ä¸ªæˆ–å¤šä¸ªï¼ˆé“¾å¼ï¼‰è¿ç®—ç¬¦(operators )è¢«ç§°ä¸ºä»»åŠ¡(task)ã€‚é€šå¸¸ï¼Œå­ä»»åŠ¡(subtask)ä¸€è¯ç”¨æ¥æŒ‡åœ¨å¤šä¸ª TaskManager ä¸Šå¹¶è¡Œè¿è¡Œçš„å•ä¸ªä»»åŠ¡å®ä¾‹ï¼Œä½†æˆ‘ä»¬åœ¨è¿™é‡Œåªä½¿ç”¨ä»»åŠ¡(task)ä¸€è¯ã€‚\nä»»åŠ¡è°ƒåº¦å’Œç½‘ç»œæ´—ç‰Œå¯¹äº BATCH å’Œ STREAMING æ‰§è¡Œæ¨¡å¼çš„å·¥ä½œæ–¹å¼ä¸åŒã€‚ä¸»è¦æ˜¯ç”±äºæˆ‘ä»¬çŸ¥é“æˆ‘ä»¬çš„è¾“å…¥æ•°æ®åœ¨ BATCH æ‰§è¡Œæ¨¡å¼ä¸‹æ˜¯æœ‰è¾¹ç•Œçš„ï¼Œè¿™ä½¿å¾— Flink å¯ä»¥ä½¿ç”¨æ›´é«˜æ•ˆçš„æ•°æ®ç»“æ„å’Œç®—æ³•ã€‚\næˆ‘ä»¬å°†ç”¨è¿™ä¸ªä¾‹å­æ¥è§£é‡Šä»»åŠ¡è°ƒåº¦å’Œç½‘ç»œä¼ è¾“çš„å·®å¼‚ã€‚\nStreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); DataStreamSource\u0026lt;String\u0026gt; source = env.fromElements(...); source.name(\u0026#34;source\u0026#34;) .map(...).name(\u0026#34;map1\u0026#34;) .map(...).name(\u0026#34;map2\u0026#34;) .rebalance() .map(...).name(\u0026#34;map3\u0026#34;) .map(...).name(\u0026#34;map4\u0026#34;) .keyBy((value) -\u0026gt; value) .map(...).name(\u0026#34;map5\u0026#34;) .map(...).name(\u0026#34;map6\u0026#34;) .sinkTo(...).name(\u0026#34;sink\u0026#34;); æš—ç¤ºæ“ä½œä¹‹é—´1å¯¹1è¿æ¥æ¨¡å¼çš„æ“ä½œï¼Œå¦‚ map()ã€flatMap() æˆ– filter()ï¼Œå¯ä»¥ç›´æ¥å°†æ•°æ®è½¬å‘åˆ°ä¸‹ä¸€ä¸ªæ“ä½œï¼Œè¿™ä½¿å¾—è¿™äº›æ“ä½œå¯ä»¥é“¾åœ¨ä¸€èµ·ã€‚è¿™æ„å‘³ç€ Flink é€šå¸¸ä¸ä¼šåœ¨å®ƒä»¬ä¹‹é—´æ’å…¥ç½‘ç»œæ´—ç‰Œã€‚\nè€Œ keyBy() æˆ– rebalance() ç­‰æ“ä½œåˆ™éœ€è¦åœ¨ä¸åŒçš„ä»»åŠ¡å¹¶è¡Œå®ä¾‹ä¹‹é—´è¿›è¡Œæ•°æ®æ´—ç‰Œã€‚è¿™å°±ä¼šå¼•èµ·ç½‘ç»œæ´—ç‰Œã€‚\nå¯¹äºä¸Šé¢çš„ä¾‹å­ï¼ŒFlink ä¼šæŠŠæ“ä½œåˆ†ç»„ä¸ºè¿™æ ·çš„ä»»åŠ¡ã€‚\n Task1: source, map1 å’Œ map2 Task2: map3, map4 Task3: map5, map6 å’Œ sink  è€Œæˆ‘ä»¬åœ¨ä»»åŠ¡1å’Œ2ï¼Œä»¥åŠä»»åŠ¡2å’Œ3ä¹‹é—´è¿›è¡Œç½‘ç»œæ´—ç‰Œã€‚è¿™æ˜¯è¯¥ä½œä¸šçš„å¯è§†åŒ–è¡¨ç¤ºã€‚\nSTREAMING æ‰§è¡Œæ¨¡å¼ åœ¨ STREAMING æ‰§è¡Œæ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰ä»»åŠ¡éœ€è¦ä¸€ç›´åœ¨çº¿/è¿è¡Œã€‚è¿™ä½¿å¾— Flink å¯ä»¥é€šè¿‡æ•´ä¸ªç®¡é“ç«‹å³å¤„ç†æ–°çš„è®°å½•ï¼Œè€Œæˆ‘ä»¬éœ€è¦çš„æ˜¯è¿ç»­å’Œä½å»¶è¿Ÿçš„æµå¤„ç†ã€‚è¿™ä¹Ÿæ„å‘³ç€åˆ†é…ç»™ä¸€ä¸ªä»»åŠ¡çš„ TaskManagers éœ€è¦æœ‰è¶³å¤Ÿçš„èµ„æºæ¥åŒæ—¶è¿è¡Œæ‰€æœ‰çš„ä»»åŠ¡ã€‚\nç½‘ç»œæ´—ç‰Œæ˜¯æµæ°´çº¿å¼çš„ï¼Œè¿™æ„å‘³ç€è®°å½•ä¼šè¢«ç«‹å³å‘é€åˆ°ä¸‹æ¸¸ä»»åŠ¡ï¼Œå¹¶åœ¨ç½‘ç»œå±‚ä¸Šè¿›è¡Œä¸€äº›ç¼“å†²ã€‚åŒæ ·ï¼Œè¿™ä¹Ÿæ˜¯éœ€è¦çš„ï¼Œå› ä¸ºå½“å¤„ç†è¿ç»­çš„æ•°æ®æµæ—¶ï¼Œåœ¨ä»»åŠ¡ï¼ˆæˆ–ä»»åŠ¡çš„ç®¡é“ï¼‰ä¹‹é—´æ²¡æœ‰è‡ªç„¶çš„æ•°æ®ç‚¹ï¼ˆæ—¶é—´ç‚¹ï¼‰å¯ä»¥ç‰©åŒ–ã€‚è¿™ä¸ BATCH æ‰§è¡Œæ¨¡å¼å½¢æˆäº†é²œæ˜çš„å¯¹æ¯”ï¼Œåœ¨ BATCH æ‰§è¡Œæ¨¡å¼ä¸‹ï¼Œä¸­é—´çš„ç»“æœå¯ä»¥è¢«å…·ä½“åŒ–ï¼Œå¦‚ä¸‹æ‰€è¿°ã€‚\nBATCH æ‰§è¡Œæ¨¡å¼ åœ¨ BATCH æ‰§è¡Œæ¨¡å¼ä¸‹ï¼Œä¸€ä¸ªä½œä¸šçš„ä»»åŠ¡å¯ä»¥è¢«åˆ†ç¦»æˆå¯ä»¥ä¸€ä¸ªæ¥ä¸€ä¸ªæ‰§è¡Œçš„é˜¶æ®µã€‚æˆ‘ä»¬ä¹‹æ‰€ä»¥èƒ½åšåˆ°è¿™ä¸€ç‚¹ï¼Œæ˜¯å› ä¸ºè¾“å…¥æ˜¯æœ‰è¾¹ç•Œçš„ï¼Œå› æ­¤ Flink å¯ä»¥åœ¨è¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µä¹‹å‰å®Œå…¨å¤„ç†ç®¡é“çš„ä¸€ä¸ªé˜¶æ®µã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå·¥ä½œä¼šæœ‰ä¸‰ä¸ªé˜¶æ®µï¼Œå¯¹åº”ç€è¢«æ´—ç‰Œéšœç¢åˆ†å¼€çš„ä¸‰ä¸ªä»»åŠ¡ã€‚\nåˆ†é˜¶æ®µå¤„ç†å¹¶ä¸æ˜¯åƒä¸Šé¢é’ˆå¯¹ STREAMING æ¨¡å¼æ‰€è§£é‡Šçš„é‚£æ ·ï¼Œç«‹å³å‘ä¸‹æ¸¸ä»»åŠ¡å‘é€è®°å½•ï¼Œè€Œæ˜¯éœ€è¦ Flink å°†ä»»åŠ¡çš„ä¸­é—´ç»“æœç‰©åŒ–åˆ°ä¸€äº›éæ°¸ç»­å­˜å‚¨ä¸­ï¼Œè®©ä¸‹æ¸¸ä»»åŠ¡åœ¨ä¸Šæ¸¸ä»»åŠ¡å·²ç»ä¸‹çº¿åå†è¯»å–ã€‚è¿™å°†å¢åŠ å¤„ç†çš„å»¶è¿Ÿï¼Œä½†ä¹Ÿä¼šå¸¦æ¥å…¶ä»–æœ‰è¶£çš„ç‰¹æ€§ã€‚é¦–å…ˆï¼Œè¿™å…è®¸ Flink åœ¨æ•…éšœå‘ç”Ÿæ—¶å›æº¯åˆ°æœ€æ–°çš„å¯ç”¨ç»“æœï¼Œè€Œä¸æ˜¯é‡æ–°å¯åŠ¨æ•´ä¸ªä»»åŠ¡ã€‚å¦ä¸€ä¸ªå‰¯ä½œç”¨æ˜¯ï¼ŒBATCH ä½œä¸šå¯ä»¥åœ¨æ›´å°‘çš„èµ„æºä¸Šæ‰§è¡Œï¼ˆå°± TaskManagers çš„å¯ç”¨æ§½è€Œè¨€ï¼‰ï¼Œå› ä¸ºç³»ç»Ÿå¯ä»¥ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°é¡ºåºæ‰§è¡Œä»»åŠ¡ã€‚\nTaskManagers å°†è‡³å°‘åœ¨ä¸‹æ¸¸ä»»åŠ¡æ²¡æœ‰æ¶ˆè€—å®ƒä»¬çš„æƒ…å†µä¸‹ä¿ç•™ä¸­é—´ç»“æœã€‚(ä»æŠ€æœ¯ä¸Šè®²ï¼Œå®ƒä»¬å°†è¢«ä¿ç•™åˆ°æ¶ˆè€—çš„æµæ°´çº¿åŒºåŸŸäº§ç”Ÿå®ƒä»¬çš„è¾“å‡ºä¸ºæ­¢)ã€‚åœ¨è¿™ä¹‹åï¼Œåªè¦ç©ºé—´å…è®¸ï¼Œå®ƒä»¬å°±ä¼šè¢«ä¿ç•™ï¼Œä»¥ä¾¿åœ¨å¤±è´¥çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å›æº¯åˆ°å‰é¢æåˆ°çš„ç»“æœã€‚\nçŠ¶æ€åç«¯/çŠ¶æ€ åœ¨ STREAMING æ¨¡å¼ä¸‹ï¼ŒFlink ä½¿ç”¨ StateBackend æ¥æ§åˆ¶çŠ¶æ€çš„å­˜å‚¨æ–¹å¼å’Œæ£€æŸ¥ç‚¹çš„å·¥ä½œæ–¹å¼ã€‚\nåœ¨ BATCH æ¨¡å¼ä¸‹ï¼Œé…ç½®çš„çŠ¶æ€åç«¯è¢«å¿½ç•¥ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œkeyed æ“ä½œçš„è¾“å…¥æŒ‰é”®åˆ†ç»„ï¼ˆä½¿ç”¨æ’åºï¼‰ï¼Œç„¶åæˆ‘ä»¬ä¾æ¬¡å¤„ç†ä¸€ä¸ªé”®çš„æ‰€æœ‰è®°å½•ã€‚è¿™æ ·å°±å¯ä»¥åŒæ—¶åªä¿ç•™ä¸€ä¸ªé”®çš„çŠ¶æ€ã€‚å½“è½¬åˆ°ä¸‹ä¸€ä¸ªé”®æ—¶ï¼Œä¸€ä¸ªç»™å®šé”®çš„çŠ¶æ€å°†è¢«ä¸¢å¼ƒã€‚\nå…³äºè¿™æ–¹é¢çš„èƒŒæ™¯ä¿¡æ¯ï¼Œè¯·å‚è§ FLIP-140ã€‚\näº‹ä»¶æ—¶é—´/æ°´å° åœ¨æ”¯æŒäº‹ä»¶æ—¶é—´æ–¹é¢ï¼ŒFlink çš„æµè¿è¡Œæ—¶å»ºç«‹åœ¨ä¸€ä¸ªæ‚²è§‚çš„å‡è®¾ä¸Šï¼Œå³äº‹ä»¶å¯èƒ½ä¼šå‡ºç°é¡ºåºå¤–ï¼Œå³ä¸€ä¸ªæ—¶é—´æˆ³tçš„äº‹ä»¶å¯èƒ½ä¼šåœ¨ä¸€ä¸ªæ—¶é—´æˆ³t+1çš„äº‹ä»¶ä¹‹åå‡ºç°ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œç³»ç»Ÿæ°¸è¿œæ— æ³•ç¡®å®šåœ¨ç»™å®šçš„æ—¶é—´æˆ³Tä¸‹ï¼Œæœªæ¥ä¸ä¼šå†æœ‰æ—¶é—´æˆ³ t\u0026lt;T çš„å…ƒç´ å‡ºç°ã€‚ä¸ºäº†æ‘Šå¹³è¿™ç§å¤±åºæ€§å¯¹æœ€ç»ˆç»“æœçš„å½±å“ï¼ŒåŒæ—¶ä½¿ç³»ç»Ÿå®ç”¨ï¼Œåœ¨ STREAMING æ¨¡å¼ä¸‹ï¼ŒFlink ä½¿ç”¨äº†ä¸€ç§åä¸º Watermarks çš„å¯å‘å¼æ–¹æ³•ã€‚ä¸€ä¸ªå¸¦æœ‰æ—¶é—´æˆ³Tçš„æ°´å°æ ‡å¿—ç€æ²¡æœ‰æ—¶é—´æˆ³ t\u0026lt;T çš„å…ƒç´ ä¼šè·Ÿéšã€‚\nåœ¨ BATCH æ¨¡å¼ä¸‹ï¼Œè¾“å…¥çš„æ•°æ®é›†æ˜¯äº‹å…ˆå·²çŸ¥çš„ï¼Œä¸éœ€è¦è¿™æ ·çš„å¯å‘å¼ï¼Œå› ä¸ºè‡³å°‘å¯ä»¥æŒ‰ç…§æ—¶é—´æˆ³å¯¹å…ƒç´ è¿›è¡Œæ’åºï¼Œä»è€ŒæŒ‰ç…§æ—¶é—´é¡ºåºè¿›è¡Œå¤„ç†ã€‚å¯¹äºç†Ÿæ‚‰æµçš„è¯»è€…æ¥è¯´ï¼Œåœ¨ BATCH ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾\u0026quot;å®Œç¾çš„æ°´å°\u0026quot;ã€‚\né‰´äºä¸Šè¿°æƒ…å†µï¼Œåœ¨ BATCH æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨è¾“å…¥çš„æœ«å°¾æœ‰ä¸€ä¸ªä¸æ¯ä¸ªé”®ç›¸å…³çš„ MAX_WATERMARKï¼Œå¦‚æœè¾“å…¥æµæ²¡æœ‰é”®ï¼Œåˆ™åœ¨è¾“å…¥çš„æœ«å°¾æœ‰ä¸€ä¸ªã€‚åŸºäºè¿™ä¸ªæ–¹æ¡ˆï¼Œæ‰€æœ‰æ³¨å†Œçš„å®šæ—¶å™¨éƒ½ä¼šåœ¨æ—¶é—´ç»“æŸæ—¶è§¦å‘ï¼Œç”¨æˆ·å®šä¹‰çš„ WatermarkAssigners æˆ– WatermarkStrategies ä¼šè¢«å¿½ç•¥ã€‚\nå¤„ç†æ—¶é—´ å¤„ç†æ—¶é—´æ˜¯æŒ‡åœ¨å¤„ç†è®°å½•çš„å…·ä½“å®ä¾‹ä¸Šï¼Œå¤„ç†è®°å½•çš„æœºå™¨ä¸Šçš„æŒ‚é’Ÿæ—¶é—´ã€‚æ ¹æ®è¿™ä¸ªå®šä¹‰ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼ŒåŸºäºå¤„ç†æ—¶é—´çš„è®¡ç®—ç»“æœæ˜¯ä¸å¯é‡å¤çš„ã€‚è¿™æ˜¯å› ä¸ºåŒä¸€æ¡è®°å½•è¢«å¤„ç†ä¸¤æ¬¡ï¼Œä¼šæœ‰ä¸¤ä¸ªä¸åŒçš„æ—¶é—´æˆ³ã€‚\nå°½ç®¡å¦‚æ­¤ï¼Œåœ¨ STREAMING æ¨¡å¼ä¸‹ä½¿ç”¨å¤„ç†æ—¶é—´è¿˜æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚åŸå› ä¸æµåª’ä½“ç®¡é“ç»å¸¸å®æ—¶æ‘„å–å…¶æ— é™åˆ¶çš„è¾“å…¥æœ‰å…³ï¼Œæ‰€ä»¥äº‹ä»¶æ—¶é—´å’Œå¤„ç†æ—¶é—´ä¹‹é—´å­˜åœ¨ç›¸å…³æ€§ã€‚æ­¤å¤–ï¼Œç”±äºä¸Šè¿°åŸå› ï¼Œåœ¨ STREAMING æ¨¡å¼ä¸‹ï¼Œäº‹ä»¶æ—¶é—´çš„1hå¾€å¾€å¯ä»¥å‡ ä¹æ˜¯1hçš„å¤„ç†æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯æŒ‚é’Ÿæ—¶é—´ã€‚æ‰€ä»¥ä½¿ç”¨å¤„ç†æ—¶é—´å¯ä»¥ç”¨äºæ—©æœŸï¼ˆä¸å®Œå…¨ï¼‰å‘å°„ï¼Œç»™å‡ºé¢„æœŸç»“æœçš„æç¤ºã€‚\nåœ¨æ‰¹å¤„ç†ä¸–ç•Œä¸­ï¼Œè¿™ç§ç›¸å…³æ€§å¹¶ä¸å­˜åœ¨ï¼Œå› ä¸ºåœ¨æ‰¹å¤„ç†ä¸–ç•Œä¸­ï¼Œè¾“å…¥çš„æ•°æ®é›†æ˜¯é™æ€çš„ï¼Œæ˜¯é¢„å…ˆçŸ¥é“çš„ã€‚é‰´äºæ­¤ï¼Œåœ¨ BATCH æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬å…è®¸ç”¨æˆ·è¯·æ±‚å½“å‰çš„å¤„ç†æ—¶é—´ï¼Œå¹¶æ³¨å†Œå¤„ç†æ—¶é—´è®¡æ—¶å™¨ï¼Œä½†ä¸äº‹ä»¶æ—¶é—´çš„æƒ…å†µä¸€æ ·ï¼Œæ‰€æœ‰çš„è®¡æ—¶å™¨éƒ½è¦åœ¨è¾“å…¥ç»“æŸæ—¶å‘å°„ã€‚\nåœ¨æ¦‚å¿µä¸Šï¼Œæˆ‘ä»¬å¯ä»¥æƒ³è±¡ï¼Œåœ¨ä½œä¸šæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå¤„ç†æ—¶é—´ä¸ä¼šæå‰ï¼Œå½“æ•´ä¸ªè¾“å…¥å¤„ç†å®Œæ¯•åï¼Œæˆ‘ä»¬ä¼šå¿«è¿›åˆ°æ—¶é—´ç»“æŸã€‚\næ•…éšœæ¢å¤ åœ¨ STREAMING æ‰§è¡Œæ¨¡å¼ä¸‹ï¼ŒFlink ä½¿ç”¨æ£€æŸ¥ç‚¹è¿›è¡Œæ•…éšœæ¢å¤ã€‚è¯·çœ‹ä¸€ä¸‹æ£€æŸ¥ç‚¹æ–‡æ¡£ï¼Œäº†è§£å…³äºè¿™ä¸ªå’Œå¦‚ä½•é…ç½®å®ƒçš„å®è·µæ–‡æ¡£ã€‚å…³äºé€šè¿‡çŠ¶æ€å¿«ç…§è¿›è¡Œå®¹é”™ï¼Œä¹Ÿæœ‰ä¸€ä¸ªæ¯”è¾ƒå…¥é—¨çš„ç« èŠ‚ï¼Œä»æ›´é«˜çš„å±‚é¢è§£é‡Šäº†è¿™äº›æ¦‚å¿µã€‚\nCheckpointing ç”¨äºæ•…éšœæ¢å¤çš„ç‰¹ç‚¹ä¹‹ä¸€æ˜¯ï¼ŒFlink åœ¨å‘ç”Ÿæ•…éšœæ—¶ï¼Œä¼šä»æ£€æŸ¥ç‚¹é‡æ–°å¯åŠ¨æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ã€‚è¿™å¯èƒ½æ¯”æˆ‘ä»¬åœ¨ BATCH æ¨¡å¼ä¸‹æ‰€è¦åšçš„äº‹æƒ…æ›´æ˜‚è´µï¼ˆå¦‚ä¸‹æ–‡æ‰€è§£é‡Šï¼‰ï¼Œè¿™ä¹Ÿæ˜¯å¦‚æœä½ çš„ä»»åŠ¡å…è®¸çš„è¯åº”è¯¥ä½¿ç”¨ BATCH æ‰§è¡Œæ¨¡å¼çš„åŸå› ä¹‹ä¸€ã€‚\nåœ¨ BATCH æ‰§è¡Œæ¨¡å¼ä¸‹ï¼ŒFlink ä¼šå°è¯•å¹¶å›æº¯åˆ°ä¹‹å‰çš„å¤„ç†é˜¶æ®µï¼Œå¯¹äºè¿™äº›é˜¶æ®µï¼Œä»ç„¶æœ‰ä¸­é—´ç»“æœã€‚æ½œåœ¨åœ°ï¼Œåªæœ‰å¤±è´¥çš„ä»»åŠ¡ï¼ˆæˆ–å®ƒä»¬åœ¨å›¾ä¸­çš„å‰è¾ˆï¼‰æ‰éœ€è¦é‡æ–°å¯åŠ¨ï¼Œä¸ä»æ£€æŸ¥ç‚¹é‡æ–°å¯åŠ¨æ‰€æœ‰ä»»åŠ¡ç›¸æ¯”ï¼Œå¯ä»¥æé«˜ä½œä¸šçš„å¤„ç†æ•ˆç‡å’Œæ•´ä½“å¤„ç†æ—¶é—´ã€‚\né‡è¦çš„è€ƒè™‘å› ç´  ä¸ç»å…¸çš„ STREAMING æ‰§è¡Œæ¨¡å¼ç›¸æ¯”ï¼Œåœ¨ BATCH æ¨¡å¼ä¸‹ï¼Œæœ‰äº›ä¸œè¥¿å¯èƒ½æ— æ³•æŒ‰ç…§é¢„æœŸå·¥ä½œã€‚ä¸€äº›åŠŸèƒ½çš„å·¥ä½œæ–¹å¼ä¼šç•¥æœ‰ä¸åŒï¼Œè€Œå…¶ä»–åŠŸèƒ½åˆ™ä¸æ”¯æŒã€‚\nBATCH æ¨¡å¼ä¸‹çš„è¡Œä¸ºå˜åŒ–ã€‚\n \u0026ldquo;æ»šåŠ¨\u0026quot;æ“ä½œï¼Œå¦‚ reduce() æˆ– sum()ï¼Œä¼šå¯¹ STREAMING æ¨¡å¼ä¸‹æ¯ä¸€æ¡æ–°è®°å½•å‘å‡ºå¢é‡æ›´æ–°ã€‚åœ¨ BATCH æ¨¡å¼ä¸‹ï¼Œè¿™äº›æ“ä½œä¸æ˜¯\u0026quot;æ»šåŠ¨\u0026rdquo;ã€‚å®ƒä»¬åªå‘å‡ºæœ€ç»ˆç»“æœã€‚  BATCH æ¨¡å¼ä¸‹ä¸æ”¯æŒçš„:\n Checkpointing å’Œä»»ä½•ä¾èµ–äº checkpointing çš„æ“ä½œéƒ½ä¸å·¥ä½œã€‚ å¹¿æ’­çŠ¶æ€ è¿­ä»£  è‡ªå®šä¹‰æ“ä½œç¬¦åº”è°¨æ…æ‰§è¡Œï¼Œå¦åˆ™å¯èƒ½ä¼šæœ‰ä¸æ°å½“çš„è¡Œä¸ºã€‚æ›´å¤šç»†èŠ‚è¯·å‚è§ä¸‹é¢çš„è¡¥å……è¯´æ˜ã€‚\næ£€æŸ¥ç‚¹ å¦‚ä¸Šæ‰€è¿°ï¼Œæ‰¹å¤„ç†ç¨‹åºçš„æ•…éšœæ¢å¤ä¸ä½¿ç”¨æ£€æŸ¥ç‚¹ã€‚\né‡è¦çš„æ˜¯è¦è®°ä½ï¼Œå› ä¸ºæ²¡æœ‰æ£€æŸ¥ç‚¹ï¼ŒæŸäº›åŠŸèƒ½å¦‚ CheckpointListenerï¼Œä»¥åŠå› æ­¤ï¼ŒKafka çš„ EXACTLY_ONCE æ¨¡å¼æˆ– StreamingFileSink çš„ OnCheckpointRollingPolicy å°†æ— æ³•å·¥ä½œã€‚å¦‚æœä½ éœ€è¦ä¸€ä¸ªåœ¨ BATCH æ¨¡å¼ä¸‹å·¥ä½œçš„äº‹åŠ¡å‹æ¥æ”¶å™¨ï¼Œè¯·ç¡®ä¿å®ƒä½¿ç”¨ FLIP-143 ä¸­æå‡ºçš„ç»Ÿä¸€æ¥æ”¶å™¨ APIã€‚\nä½ ä»ç„¶å¯ä»¥ä½¿ç”¨æ‰€æœ‰çš„çŠ¶æ€åŸè¯­ï¼Œåªæ˜¯ç”¨äºæ•…éšœæ¢å¤çš„æœºåˆ¶ä¼šæœ‰æ‰€ä¸åŒã€‚\nå¹¿æ’­çŠ¶æ€ å¼•å…¥è¿™ä¸ªç‰¹æ€§æ˜¯ä¸ºäº†è®©ç”¨æˆ·å®ç°è¿™æ ·çš„ç”¨ä¾‹ï¼šä¸€ä¸ª\u0026quot;æ§åˆ¶\u0026quot;æµéœ€è¦è¢«å¹¿æ’­åˆ°æ‰€æœ‰ä¸‹æ¸¸ä»»åŠ¡ï¼Œè€Œå¹¿æ’­çš„å…ƒç´ ï¼Œä¾‹å¦‚è§„åˆ™ï¼Œéœ€è¦åº”ç”¨åˆ°å¦ä¸€ä¸ªæµçš„æ‰€æœ‰è¾“å…¥å…ƒç´ ã€‚\nåœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒFlink ä¸æä¾›å…³äºè¯»å–è¾“å…¥çš„é¡ºåºçš„ä¿è¯ã€‚åƒä¸Šé¢è¿™æ ·çš„ç”¨ä¾‹åœ¨æµåª’ä½“ä¸–ç•Œä¸­æ˜¯æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºåœ¨è¿™ä¸ªä¸–ç•Œä¸­ï¼Œä½œä¸šé¢„è®¡ä¼šè¿è¡Œå¾ˆé•¿æ—¶é—´ï¼Œè€Œè¾“å…¥æ•°æ®æ˜¯äº‹å…ˆä¸çŸ¥é“çš„ã€‚åœ¨è¿™äº›è®¾ç½®ä¸­ï¼Œéœ€æ±‚å¯èƒ½ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œæ”¹å˜ï¼Œè¿™å–å†³äºè¾“å…¥çš„æ•°æ®ã€‚\nä½†åœ¨æ‰¹å¤„ç†ä¸–ç•Œä¸­ï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™ç§ç”¨ä¾‹æ²¡æœ‰å¤ªå¤§æ„ä¹‰ï¼Œå› ä¸ºè¾“å…¥ï¼ˆåŒ…æ‹¬å…ƒç´ å’Œæ§åˆ¶æµï¼‰æ˜¯é™æ€çš„ï¼Œè€Œä¸”æ˜¯é¢„å…ˆçŸ¥é“çš„ã€‚\næˆ‘ä»¬è®¡åˆ’åœ¨æœªæ¥ä¸ºBATCHå¤„ç†æ”¯æŒè¿™ç§æ¨¡å¼çš„å˜åŒ–ï¼Œå³å®Œå…¨å…ˆå¤„ç†å¹¿æ’­ç«¯ã€‚\nç¼–å†™è‡ªå®šä¹‰æ“ä½œç¬¦  æ³¨æ„ï¼šè‡ªå®šä¹‰æ“ä½œç¬¦æ˜¯ Apache Flink çš„ä¸€ç§é«˜çº§ä½¿ç”¨æ¨¡å¼ã€‚å¯¹äºå¤§å¤šæ•°çš„ä½¿ç”¨æƒ…å†µï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨(keyed-)è¿‡ç¨‹å‡½æ•°æ¥ä»£æ›¿ã€‚\n åœ¨ç¼–å†™è‡ªå®šä¹‰æ“ä½œç¬¦æ—¶ï¼Œè®°ä½ BATCH æ‰§è¡Œæ¨¡å¼çš„å‡è®¾æ˜¯å¾ˆé‡è¦çš„ã€‚å¦åˆ™ï¼Œä¸€ä¸ªåœ¨ STREAMING æ¨¡å¼ä¸‹è¿è¡Œè‰¯å¥½çš„æ“ä½œç¬¦å¯èƒ½ä¼šåœ¨ BATCH æ¨¡å¼ä¸‹äº§ç”Ÿé”™è¯¯çš„ç»“æœã€‚æ“ä½œç¬¦æ°¸è¿œä¸ä¼šè¢«é™å®šåœ¨ä¸€ä¸ªç‰¹å®šçš„é”®ä¸Šï¼Œè¿™æ„å‘³ç€ä»–ä»¬çœ‹åˆ°äº† Flink è¯•å›¾åˆ©ç”¨çš„ BATCH å¤„ç†çš„ä¸€äº›å±æ€§ã€‚\né¦–å…ˆä½ ä¸åº”è¯¥åœ¨ä¸€ä¸ªæ“ä½œç¬¦å†…ç¼“å­˜æœ€åçœ‹åˆ°çš„æ°´å°ã€‚åœ¨ BATCH æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬ä¼šé€ä¸ªé”®å¤„ç†è®°å½•ã€‚å› æ­¤ï¼Œæ°´å°ä¼šåœ¨æ¯ä¸ªé”®ä¹‹é—´ä» MAX_VALUE åˆ‡æ¢åˆ° MIN_VALUEã€‚ä½ ä¸åº”è¯¥è®¤ä¸ºæ°´å°åœ¨ä¸€ä¸ªæ“ä½œç¬¦ä¸­æ€»æ˜¯ä¸Šå‡çš„ã€‚å‡ºäºåŒæ ·çš„åŸå› ï¼Œå®šæ—¶å™¨å°†é¦–å…ˆæŒ‰é”®çš„é¡ºåºå‘å°„ï¼Œç„¶åæŒ‰æ¯ä¸ªé”®å†…çš„æ—¶é—´æˆ³é¡ºåºå‘å°„ã€‚æ­¤å¤–ï¼Œä¸æ”¯æŒæ‰‹åŠ¨æ›´æ”¹é”®çš„æ“ä½œã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2020-12-10-execution-mode/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£"],"title":"æ‰§è¡Œæ¨¡å¼(æ‰¹/æµ)"},{"categories":["Flink"],"contents":"åº”ç”¨æ„ä»¶ Stateful Functions ä¸ºæ„å»ºäº‹ä»¶é©±åŠ¨åº”ç”¨ç¨‹åºæä¾›äº†ä¸€ä¸ªæ¡†æ¶ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†è§£é‡Š Stateful Function æ¶æ„çš„é‡è¦æ–¹é¢ã€‚\näº‹ä»¶è¾“å…¥ æœ‰çŠ¶æ€å‡½æ•°åº”ç”¨æ­£å¥½ååœ¨äº‹ä»¶é©±åŠ¨çš„é¢†åŸŸï¼Œæ‰€ä»¥è‡ªç„¶è¦ä»æŠŠäº‹ä»¶æ‘„å…¥ç³»ç»Ÿå¼€å§‹ã€‚\nåœ¨æœ‰çŠ¶æ€å‡½æ•°ä¸­ï¼Œå°†è®°å½•æ‘„å…¥ç³»ç»Ÿçš„ç»„ä»¶ç§°ä¸ºäº‹ä»¶å…¥å£ã€‚è¿™å¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ï¼Œä» Kafka ä¸»é¢˜ï¼Œåˆ° messsage é˜Ÿåˆ—ï¼Œå†åˆ° http è¯·æ±‚ - ä»»ä½•èƒ½å¤Ÿå°†æ•°æ®å¼•å…¥ç³»ç»Ÿå¹¶è§¦å‘åˆå§‹å‡½æ•°å¼€å§‹è®¡ç®—çš„ä¸œè¥¿ã€‚\næœ‰çŠ¶æ€å‡½æ•° è¯¥å›¾çš„æ ¸å¿ƒæ˜¯å‘½åçš„æœ‰çŠ¶æ€å‡½æ•°ã€‚\næŠŠè¿™äº›å‡½æ•°çœ‹ä½œæ˜¯ä½ çš„æœåŠ¡çš„æ„ä»¶ã€‚å®ƒä»¬å¯ä»¥ä»»æ„åœ°ç›¸äº’å‘é€æ¶ˆæ¯ï¼Œè¿™ä¹Ÿæ˜¯è¿™ä¸ªæ¡†æ¶æ‘†è„±ä¼ ç»Ÿçš„æµå¤„ç†è§‚ç‚¹çš„ä¸€ç§æ–¹å¼ã€‚è¿™äº›å‡½æ•°å¯ä»¥ä»¥ä»»æ„çš„ã€å¯èƒ½æ˜¯å¾ªç¯çš„ã€ç”šè‡³æ˜¯å¾€è¿”çš„æ–¹å¼ç›¸äº’é€šä¿¡ï¼Œè€Œä¸æ˜¯å»ºç«‹ä¸€ä¸ªé™æ€çš„æ•°æ®æµ DAGã€‚\nå¦‚æœä½ ç†Ÿæ‚‰ actor ç¼–ç¨‹ï¼Œè¿™åœ¨ç»„ä»¶ä¹‹é—´åŠ¨æ€æ¶ˆæ¯çš„èƒ½åŠ›ä¸Šç¡®å®æœ‰æŸäº›ç›¸ä¼¼ä¹‹å¤„ã€‚ç„¶è€Œï¼Œä¹Ÿæœ‰ä¸€äº›æ˜¾è‘—çš„åŒºåˆ«ã€‚\næŒç»­çŠ¶æ€ é¦–å…ˆæ˜¯æ‰€æœ‰å‡½æ•°éƒ½æœ‰æœ¬åœ°åµŒå…¥çš„çŠ¶æ€ï¼Œå³æ‰€è°“çš„æŒä¹…åŒ–çŠ¶æ€ã€‚\nApache Flink çš„æ ¸å¿ƒä¼˜åŠ¿ä¹‹ä¸€å°±æ˜¯å®ƒèƒ½å¤Ÿæä¾›å®¹é”™çš„æœ¬åœ°çŠ¶æ€ã€‚å½“åœ¨ä¸€ä¸ªå‡½æ•°å†…éƒ¨ï¼Œå½“å®ƒåœ¨æ‰§è¡Œä¸€äº›è®¡ç®—æ—¶ï¼Œä½ æ€»æ˜¯åœ¨æœ¬åœ°å˜é‡ä¸­å¤„ç†æœ¬åœ°çŠ¶æ€ã€‚\nå®¹é”™ å¯¹äºçŠ¶æ€å’Œæ¶ˆæ¯ä¼ é€’ï¼ŒStateful Functions èƒ½å¤Ÿæä¾›ç”¨æˆ·ä»ç°ä»£æ•°æ®å¤„ç†æ¡†æ¶ä¸­æœŸæœ›çš„ç²¾ç¡®çš„ä¸€æ¬¡ä¿è¯ã€‚\nåœ¨å¤±è´¥çš„æƒ…å†µä¸‹ï¼Œæ•´ä¸ªä¸–ç•Œçš„çŠ¶æ€ï¼ˆåŒ…æ‹¬æŒä¹…åŒ–çš„çŠ¶æ€å’Œæ¶ˆæ¯ï¼‰éƒ½ä¼šè¢«å›æ»šï¼Œä»¥æ¨¡æ‹Ÿå®Œå…¨æ— æ•…éšœçš„æ‰§è¡Œã€‚\nè¿™äº›ä¿è¯æ˜¯åœ¨ä¸éœ€è¦æ•°æ®åº“çš„æƒ…å†µä¸‹æä¾›çš„ï¼Œç›¸åï¼ŒStateful Function åˆ©ç”¨äº† Apache Flink çš„æˆç†Ÿå¿«ç…§æœºåˆ¶ã€‚\näº‹ä»¶å‡ºå£ æœ€åï¼Œåº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡äº‹ä»¶å‡ºå£å‘å¤–éƒ¨ç³»ç»Ÿè¾“å‡ºæ•°æ®ã€‚\nå½“ç„¶ï¼Œå‡½æ•°æ‰§è¡Œä»»æ„è®¡ç®—ï¼Œå¯ä»¥éšå¿ƒæ‰€æ¬²ï¼Œè¿™åŒ…æ‹¬è¿›è¡Œ RPC è°ƒç”¨å’Œè¿æ¥åˆ°å…¶ä»–ç³»ç»Ÿã€‚é€šè¿‡ä½¿ç”¨äº‹ä»¶å‡ºå£ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥åˆ©ç”¨å»ºç«‹åœ¨ Apache Flink è¿æ¥å™¨ç”Ÿæ€ç³»ç»Ÿä¹‹ä¸Šçš„é¢„å»ºé›†æˆã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2020-12-02-application-building-block/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£"],"title":"Application Building Blocks"},{"categories":["Flink"],"contents":"é€»è¾‘å‡½æ•° æœ‰çŠ¶æ€å‡½æ•°æ˜¯ä»¥é€»è¾‘æ–¹å¼åˆ†é…çš„ï¼Œè¿™æ„å‘³ç€ç³»ç»Ÿå¯ä»¥ç”¨æœ‰é™çš„èµ„æºæ”¯æŒæ— é™åˆ¶çš„å®ä¾‹æ•°é‡ã€‚é€»è¾‘å®ä¾‹åœ¨ä¸è¢«ä¸»åŠ¨è°ƒç”¨æ—¶ä¸ä½¿ç”¨CPUã€å†…å­˜æˆ–çº¿ç¨‹ï¼Œæ‰€ä»¥ç†è®ºä¸Šæ²¡æœ‰å¯ä»¥åˆ›å»ºçš„å®ä¾‹æ•°é‡ä¸Šé™ã€‚æˆ‘ä»¬é¼“åŠ±ç”¨æˆ·æ ¹æ®å¯¹å…¶åº”ç”¨æœ€åˆç†çš„æƒ…å†µï¼Œå°½å¯èƒ½åœ°å¯¹å…¶åº”ç”¨è¿›è¡Œç»†åŒ–å»ºæ¨¡ï¼Œè€Œä¸æ˜¯å›´ç»•èµ„æºé™åˆ¶æ¥è®¾è®¡åº”ç”¨ã€‚\nå‡½æ•°åœ°å€ åœ¨æœ¬åœ°ç¯å¢ƒä¸­ï¼Œå¯¹è±¡çš„åœ°å€å’Œå¯¹å®ƒçš„å¼•ç”¨æ˜¯ä¸€æ ·çš„ã€‚ä½†æ˜¯åœ¨æœ‰çŠ¶æ€å‡½æ•°åº”ç”¨ç¨‹åºä¸­ï¼Œå‡½æ•°å®ä¾‹æ˜¯è™šæ‹Ÿçš„ï¼Œå®ƒä»¬çš„è¿è¡Œä½ç½®ä¸ä¼šæš´éœ²ç»™ç”¨æˆ·ã€‚ç›¸åï¼Œåœ°å€æ˜¯ç”¨æ¥å¼•ç”¨ç³»ç»Ÿä¸­ç‰¹å®šçš„æœ‰çŠ¶æ€å‡½æ•°çš„ã€‚\nä¸€ä¸ªåœ°å€ç”±ä¸¤ä¸ªç»„ä»¶ç»„æˆï¼Œä¸€ä¸ªæ˜¯ FunctionTypeï¼Œä¸€ä¸ªæ˜¯ IDã€‚å‡½æ•°ç±»å‹ç±»ä¼¼äºé¢å‘å¯¹è±¡è¯­è¨€ä¸­çš„ç±»ï¼Œå®ƒå£°æ˜äº†åœ°å€æ‰€å¼•ç”¨çš„å‡½æ•°ç±»å‹ã€‚ID æ˜¯ä¸€ä¸ªä¸»é”®ï¼Œå®ƒå°†å‡½æ•°è°ƒç”¨çš„èŒƒå›´é™å®šåœ¨å‡½æ•°ç±»å‹çš„ä¸€ä¸ªç‰¹å®šå®ä¾‹ä¸Šã€‚\nå½“ä¸€ä¸ªå‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œæ‰€æœ‰çš„æ“ä½œ\u0026ndash;åŒ…æ‹¬å¯¹æŒä¹…åŒ–çŠ¶æ€çš„è¯»å’Œå†™ - éƒ½ä¼šè¢«é™å®šåœ¨å½“å‰åœ°å€ä¸Šã€‚\nä¾‹å¦‚ï¼Œæƒ³è±¡æœ‰ä¸€ä¸ªæœ‰çŠ¶æ€å‡½æ•°åº”ç”¨ç¨‹åºæ¥è·Ÿè¸ªä»“åº“çš„åº“å­˜ã€‚ä¸€ä¸ªå¯èƒ½çš„å®ç°å¯ä»¥åŒ…æ‹¬ä¸€ä¸ªåº“å­˜å‡½æ•°ï¼Œå®ƒå¯ä»¥è·Ÿè¸ªä¸€ä¸ªç‰¹å®šç‰©å“çš„åº“å­˜å•ä½æ•°é‡ï¼›è¿™å°†æ˜¯å‡½æ•°ç±»å‹ã€‚ç„¶åï¼Œä»“åº“ç®¡ç†çš„æ¯ä¸ª SKU éƒ½ä¼šæœ‰ä¸€ä¸ªè¯¥ç±»å‹çš„é€»è¾‘å®ä¾‹ã€‚å¦‚æœæ˜¯æœè£…ï¼Œå¯èƒ½ä¼šæœ‰ä¸€ä¸ªè¡¬è¡«çš„å®ä¾‹å’Œå¦ä¸€ä¸ªè£¤å­çš„å®ä¾‹ï¼›\u0026ldquo;è¡¬è¡«\u0026quot;å’Œ \u0026ldquo;è£¤å­\u0026quot;å°†æ˜¯ä¸¤ä¸ª IDã€‚æ¯ä¸ªå®ä¾‹éƒ½å¯ä»¥ç‹¬ç«‹åœ°è¿›è¡Œäº¤äº’å’Œæ¶ˆæ¯ä¼ é€’ã€‚åº”ç”¨ç¨‹åºå¯ä»¥æ ¹æ®åº“å­˜ä¸­ç‰©å“çš„ç±»å‹è‡ªç”±åˆ›å»ºå®ä¾‹ã€‚\nå‡½æ•°ç”Ÿå‘½å‘¨æœŸ é€»è¾‘å‡½æ•°æ—¢ä¸è¢«åˆ›å»ºä¹Ÿä¸è¢«é”€æ¯ï¼Œè€Œæ˜¯åœ¨åº”ç”¨ç¨‹åºçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­å§‹ç»ˆå­˜åœ¨ã€‚å½“åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œæ¡†æ¶çš„æ¯ä¸ªå¹¶è¡Œå·¥ä½œè€…å°†ä¸ºæ¯ä¸ªå‡½æ•°ç±»å‹åˆ›å»ºä¸€ä¸ªç‰©ç†å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡å°†ç”¨äºæ‰§è¡Œè¯¥ç±»å‹çš„æ‰€æœ‰é€»è¾‘å®ä¾‹ï¼Œè¯¥ç±»å‹çš„é€»è¾‘å®ä¾‹ç”±è¯¥ç‰¹å®šçš„ worker è¿è¡Œã€‚ç¬¬ä¸€æ¬¡å‘ä¸€ä¸ªåœ°å€å‘é€æ¶ˆæ¯æ—¶ï¼Œå®ƒå°†åƒè¯¥å®ä¾‹ä¸€ç›´å­˜åœ¨ä¸€æ ·ï¼Œå…¶æŒä¹…åŒ–çŠ¶æ€ä¸ºç©ºã€‚\næ¸…é™¤ä¸€ä¸ªç±»å‹çš„æ‰€æœ‰æŒä¹…åŒ–çŠ¶æ€ä¸é”€æ¯å®ƒæ˜¯ä¸€æ ·çš„ã€‚å¦‚æœä¸€ä¸ªå®ä¾‹æ²¡æœ‰çŠ¶æ€ï¼Œä¹Ÿæ²¡æœ‰ä¸»åŠ¨è¿è¡Œï¼Œé‚£ä¹ˆå®ƒå°±ä¸å ç”¨ CPUï¼Œä¸å ç”¨çº¿ç¨‹ï¼Œä¹Ÿä¸å ç”¨å†…å­˜ã€‚\nä¸€ä¸ªå®ä¾‹åœ¨å…¶ä¸€ä¸ªæˆ–å¤šä¸ªæŒä¹…åŒ–å€¼ä¸­å­˜å‚¨äº†æ•°æ®ï¼Œå®ƒåªå ç”¨å­˜å‚¨è¯¥æ•°æ®æ‰€éœ€çš„èµ„æºã€‚çŠ¶æ€å­˜å‚¨ç”± Apache Flink è¿è¡Œæ—¶ç®¡ç†ï¼Œå¹¶å­˜å‚¨åœ¨é…ç½®çš„çŠ¶æ€åç«¯ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2020-12-02-logical-functions/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£"],"title":"Logical Functions"},{"categories":["Flink"],"contents":"Python æ¼”ç»ƒ Stateful Functions ä¸ºæ„å»ºå¥å£®çš„ã€æœ‰çŠ¶æ€çš„äº‹ä»¶é©±åŠ¨çš„åº”ç”¨ç¨‹åºæä¾›äº†ä¸€ä¸ªå¹³å°ã€‚å®ƒæä¾›äº†å¯¹çŠ¶æ€å’Œæ—¶é—´çš„ç²¾ç»†æ§åˆ¶ï¼Œè¿™ä½¿å¾—é«˜çº§ç³»ç»Ÿçš„å®ç°æˆä¸ºå¯èƒ½ã€‚åœ¨æœ¬æ­¥éª¤æŒ‡å—ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Stateful Functions API æ„å»ºæœ‰çŠ¶æ€çš„åº”ç”¨ç¨‹åºã€‚\nä½ è¦æ„å»ºä»€ä¹ˆï¼Ÿ å°±åƒè½¯ä»¶ä¸­æ‰€æœ‰ä¼Ÿå¤§çš„ä»‹ç»ä¸€æ ·ï¼Œè¿™ä¸ªæ¼”ç»ƒå°†ä»å¼€å¤´å¼€å§‹ï¼šæ‰“æ‹›å‘¼ã€‚è¯¥åº”ç”¨ç¨‹åºå°†è¿è¡Œä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†æ¥å—ä¸€ä¸ªè¯·æ±‚å¹¶ä»¥é—®å€™è¯­è¿›è¡Œå“åº”ã€‚å®ƒä¸ä¼šè¯•å›¾æ¶µç›–æ‰€æœ‰å¤æ‚çš„åº”ç”¨ç¨‹åºå¼€å‘ï¼Œè€Œæ˜¯ä¸“æ³¨äºæ„å»ºä¸€ä¸ªæœ‰çŠ¶æ€çš„å‡½æ•° - è¿™æ˜¯ä½ å®ç°ä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹ã€‚\nå…ˆå†³æ¡ä»¶ è¿™ä¸ªæ¼”ç»ƒå‡è®¾æ‚¨å¯¹ Python æœ‰ä¸€å®šçš„äº†è§£ï¼Œä½†å³ä½¿æ‚¨æ¥è‡ªä¸åŒçš„ç¼–ç¨‹è¯­è¨€ï¼Œæ‚¨ä¹Ÿåº”è¯¥èƒ½å¤Ÿè·Ÿä¸Šã€‚\nå¸®åŠ©ï¼Œæˆ‘å¡ä½äº† å¦‚æœä½ è¢«å¡ä½äº†ï¼Œè¯·æŸ¥çœ‹ç¤¾åŒºæ”¯æŒèµ„æºã€‚ç‰¹åˆ«æ˜¯ Apache Flink çš„ç”¨æˆ·é‚®ä»¶åˆ—è¡¨ï¼Œä¸€ç›´è¢«è®¤ä¸ºæ˜¯ Apache é¡¹ç›®ä¸­æœ€æ´»è·ƒçš„ä¸€ä¸ªï¼Œä¹Ÿæ˜¯å¿«é€Ÿè·å¾—å¸®åŠ©çš„å¥½æ–¹æ³•ã€‚\nå¦‚ä½•è·Ÿè¿› å¦‚æœä½ æƒ³è·Ÿä¸Šï¼Œä½ éœ€è¦ä¸€å°è£…æœ‰ Python 3 ä»¥åŠ Docker çš„ç”µè„‘ã€‚\n æ³¨æ„ï¼šä¸ºäº†ç®€æ´èµ·è§ï¼Œæœ¬æ¼”ç»ƒä¸­çš„æ¯ä¸ªä»£ç å—å¯èƒ½ä¸åŒ…å«å®Œæ•´çš„å‘¨è¾¹ç±»ã€‚å®Œæ•´çš„ä»£ç å¯ä»¥åœ¨æœ¬é¡µåº•éƒ¨æ‰¾åˆ°ã€‚\n ä½ å¯ä»¥é€šè¿‡ç‚¹å‡»è¿™é‡Œä¸‹è½½ä¸€ä¸ªåŒ…å«éª¨æ¶é¡¹ç›®çš„ zip æ–‡ä»¶ã€‚\nè§£å‹åŒ…åï¼Œä½ ä¼šå‘ç°ä¸€äº›æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶åŒ…æ‹¬ dockerfiles å’Œæ•°æ®ç”Ÿæˆå™¨ï¼Œç”¨äºåœ¨æœ¬åœ°è‡ªåŒ…å«ç¯å¢ƒä¸­è¿è¡Œæ­¤æ¼”ç»ƒã€‚\n$ tree statefun-walkthrough statefun-walkthrough â”œâ”€â”€ Dockerfile â”œâ”€â”€ docker-compose.yml â”œâ”€â”€ generator â”‚ â”œâ”€â”€ Dockerfile â”‚ â”œâ”€â”€ event-generator.py â”‚ â””â”€â”€ messages_pb2.py â”œâ”€â”€ greeter â”‚ â”œâ”€â”€ Dockerfile â”‚ â”œâ”€â”€ greeter.py â”‚ â”œâ”€â”€ messages.proto â”‚ â”œâ”€â”€ messages_pb2.py â”‚ â””â”€â”€ requirements.txt â””â”€â”€ module.yaml ä»äº‹ä»¶å¼€å§‹ Stateful Functions æ˜¯ä¸€ä¸ªäº‹ä»¶é©±åŠ¨çš„ç³»ç»Ÿï¼Œæ‰€ä»¥å¼€å‘ä»å®šä¹‰æˆ‘ä»¬çš„äº‹ä»¶å¼€å§‹ã€‚é—®å€™è€…åº”ç”¨ç¨‹åºå°†ä½¿ç”¨åè®®ç¼“å†²åŒºå®šä¹‰å…¶äº‹ä»¶ã€‚å½“ä¸€ä¸ªç‰¹å®šç”¨æˆ·çš„é—®å€™è¯·æ±‚è¢«æ‘„å…¥æ—¶ï¼Œå®ƒå°†è¢«è·¯ç”±åˆ°ç›¸åº”çš„å‡½æ•°ã€‚å“åº”å°†è¿”å›ä¸€ä¸ªé€‚å½“çš„é—®å€™ã€‚ç¬¬ä¸‰ç§ç±»å‹ï¼ŒSeenCountï¼Œæ˜¯ä¸€ä¸ªå®ç”¨ç±»ï¼ŒåæœŸå°†ç”¨äºå¸®åŠ©ç®¡ç†ç”¨æˆ·åˆ°ç›®å‰ä¸ºæ­¢è¢«çœ‹åˆ°çš„æ¬¡æ•°ã€‚\nsyntax = \u0026quot;proto3\u0026quot;; package example; // External request sent by a user who wants to be greeted message GreetRequest { // The name of the user to greet string name = 1; } // A customized response sent to the user message GreetResponse { // The name of the user being greeted string name = 1; // The users customized greeting string greeting = 2; } // An internal message used to store state message SeenCount { // The number of times a users has been seen so far int64 seen = 1; } æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªå‡½æ•° åœ¨åº•å±‚ï¼Œæ¶ˆæ¯æ˜¯ä½¿ç”¨æœ‰çŠ¶æ€çš„å‡½æ•°æ¥å¤„ç†çš„ï¼Œä¹Ÿå°±æ˜¯ä»»ä½•ç»‘å®šåˆ° StatefulFunction è¿è¡Œæ—¶çš„ä¸¤ä¸ªå‚æ•°å‡½æ•°ã€‚å‡½æ•°ç”¨ @function.bind è£…é¥°å™¨ç»‘å®šåˆ°è¿è¡Œæ—¶ã€‚å½“ç»‘å®šä¸€ä¸ªå‡½æ•°æ—¶ï¼Œå®ƒä¼šè¢«æ³¨è§£ä¸ºä¸€ä¸ªå‡½æ•°ç±»å‹ã€‚è¿™æ˜¯åœ¨å‘è¿™ä¸ªå‡½æ•°å‘é€æ¶ˆæ¯æ—¶ç”¨æ¥å¼•ç”¨å®ƒçš„åç§°ã€‚\nå½“ä½ æ‰“å¼€æ–‡ä»¶ greeter/greeter.py æ—¶ï¼Œä½ åº”è¯¥çœ‹åˆ°ä»¥ä¸‹ä»£ç ã€‚\nfrom statefun import StatefulFunctions functions = StatefulFunctions() @functions.bind(\u0026#34;example/greeter\u0026#34;) def greet(context, greet_request): pass ä¸€ä¸ªæœ‰çŠ¶æ€å‡½æ•°éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œå³ä¸Šä¸‹æ–‡å’Œæ¶ˆæ¯ã€‚ä¸Šä¸‹æ–‡æä¾›äº†å¯¹æœ‰çŠ¶æ€å‡½æ•°è¿è¡Œæ—¶åŠŸèƒ½çš„è®¿é—®ï¼Œå¦‚çŠ¶æ€ç®¡ç†å’Œæ¶ˆæ¯ä¼ é€’ã€‚æ‚¨å°†åœ¨æœ¬æ¼”ç»ƒä¸­æ¢ç´¢å…¶ä¸­çš„ä¸€äº›åŠŸèƒ½ã€‚\nå¦ä¸€ä¸ªå‚æ•°æ˜¯ä¼ é€’ç»™è¿™ä¸ªå‡½æ•°çš„è¾“å…¥æ¶ˆæ¯ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯æ˜¯ä»¥ protobuf Any çš„å½¢å¼ä¼ é€’çš„ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°åªæ¥å—ä¸€ä¸ªå·²çŸ¥çš„ç±»å‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ Python 3 ç±»å‹è¯­æ³•è¦†ç›–æ¶ˆæ¯ç±»å‹ã€‚è¿™æ ·æ‚¨å°±ä¸éœ€è¦å¯¹æ¶ˆæ¯è¿›è¡Œæ‹†åŒ…æˆ–æ£€æŸ¥ç±»å‹ã€‚\nfrom messages_pb2 import GreetRequest from statefun import StatefulFunctions functions = StatefulFunctions() @functions.bind(\u0026#34;example/greeter\u0026#34;) def greet(context, greet_request: GreetRequest): pass å‘é€å›å¤ æœ‰çŠ¶æ€å‡½æ•°æ¥å—æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥å°†æ¶ˆæ¯å‘é€å‡ºå»ã€‚æ¶ˆæ¯å¯ä»¥è¢«å‘é€åˆ°å…¶ä»–å‡½æ•°ï¼Œä»¥åŠå¤–éƒ¨ç³»ç»Ÿï¼ˆæˆ–å‡ºå£ï¼‰ã€‚\nä¸€ä¸ªæµè¡Œçš„å¤–éƒ¨ç³»ç»Ÿæ˜¯ Apache Kafkaã€‚ç¬¬ä¸€æ­¥ï¼Œè®©æˆ‘ä»¬æ›´æ–° greeter/greeter.py ä¸­çš„å‡½æ•°ï¼Œé€šè¿‡å‘ Kafka ä¸»é¢˜å‘é€é—®å€™è¯­æ¥å“åº”æ¯ä¸ªè¾“å…¥ã€‚\nfrom messages_pb2 import GreetRequest, GreetResponse from statefun import StatefulFunctions functions = StatefulFunctions() @functions.bind(\u0026#34;example/greeter\u0026#34;) def greet(context, greet_request: GreetRequest): response = GreetResponse() response.name = greet_request.name response.greeting = \u0026#34;Hello {}\u0026#34;.format(greet_request.name) egress_message = kafka_egress_record(topic=\u0026#34;greetings\u0026#34;, key=greet_request.name, value=response) context.pack_and_send_egress(\u0026#34;example/greets\u0026#34;, egress_message) å¯¹äºæ¯æ¡æ¶ˆæ¯ï¼Œéƒ½ä¼šæ„é€ ä¸€ä¸ªå“åº”ï¼Œå¹¶å‘é€åˆ°ä¸€ä¸ªåä¸º greetings çš„ Kafka ä¸»é¢˜ï¼Œè¯¥ä¸»é¢˜æŒ‰åç§°åˆ†åŒºã€‚egress_message è¢«å‘é€åˆ°ä¸€ä¸ªåä¸º example/greets çš„å‡ºå£ã€‚è¿™ä¸ªæ ‡è¯†ç¬¦æŒ‡å‘ä¸€ä¸ªç‰¹å®šçš„ Kafka é›†ç¾¤ï¼Œå¹¶åœ¨ä¸‹é¢çš„éƒ¨ç½²ä¸­è¿›è¡Œé…ç½®ã€‚\nä¸€ä¸ªæœ‰çŠ¶æ€çš„ Hello è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å¼€ç«¯ï¼Œä½†å¹¶æ²¡æœ‰å±•ç°å‡ºæœ‰çŠ¶æ€å‡½æ•°çš„çœŸæ­£å¨åŠ› - ä¸çŠ¶æ€ä¸€èµ·å·¥ä½œã€‚å‡è®¾ä½ æƒ³æ ¹æ®æ¯ä¸ªç”¨æˆ·å‘é€è¯·æ±‚çš„æ¬¡æ•°ï¼Œä¸ºä»–ä»¬ç”Ÿæˆä¸ªæ€§åŒ–çš„å“åº”ã€‚\ndef compute_greeting(name, seen): \u0026#34;\u0026#34;\u0026#34; Compute a personalized greeting, based on the number of times this @name had been seen before. \u0026#34;\u0026#34;\u0026#34; templates = [\u0026#34;\u0026#34;, \u0026#34;Welcome %s\u0026#34;, \u0026#34;Nice to see you again %s\u0026#34;, \u0026#34;Third time is a charm %s\u0026#34;] if seen \u0026lt; len(templates): greeting = templates[seen] % name else: greeting = \u0026#34;Nice to see you at the %d-nth time %s!\u0026#34; % (seen, name) response = GreetResponse() response.name = name response.greeting = greeting return response ä¸ºäº†\u0026quot;è®°ä½\u0026quot;å¤šæ¡é—®å€™ä¿¡æ¯ï¼Œä½ éœ€è¦å°†ä¸€ä¸ªæŒä¹…åŒ–çš„å€¼åŸŸï¼ˆ seen_count ï¼‰å…³è”åˆ° Greet å‡½æ•°ã€‚å¯¹äºæ¯ä¸ªç”¨æˆ·ï¼Œå‡½æ•°ç°åœ¨å¯ä»¥è·Ÿè¸ªä»–ä»¬è¢«çœ‹åˆ°çš„æ¬¡æ•°ã€‚\n@functions.bind(\u0026#34;example/greeter\u0026#34;) def greet(context, greet_request: GreetRequest): state = context.state(\u0026#39;seen_count\u0026#39;).unpack(SeenCount) if not state: state = SeenCount() state.seen = 1 else: state.seen += 1 context.state(\u0026#39;seen_count\u0026#39;).pack(state) response = compute_greeting(greet_request.name, state.seen) egress_message = kafka_egress_record(topic=\u0026#34;greetings\u0026#34;, key=greet_request.name, value=response) context.pack_and_send_egress(\u0026#34;example/greets\u0026#34;, egress_message) çŠ¶æ€ seen_count å§‹ç»ˆæ˜¯å½“å‰åç§°çš„èŒƒå›´ï¼Œå› æ­¤å®ƒå¯ä»¥ç‹¬ç«‹åœ°è·Ÿè¸ªæ¯ä¸ªç”¨æˆ·ã€‚\nè¿æ¥åœ¨ä¸€èµ· æœ‰çŠ¶æ€çš„ Function åº”ç”¨ç¨‹åºä½¿ç”¨ http ä¸ Apache Flink è¿è¡Œæ—¶è¿›è¡Œé€šä¿¡ã€‚Python SDK æä¾›äº†ä¸€ä¸ª RequestReplyHandlerï¼Œå®ƒå¯ä»¥åŸºäº RESTful HTTP POSTS è‡ªåŠ¨åˆ†é…å‡½æ•°è°ƒç”¨ã€‚RequestReplyHandler å¯ä»¥ä½¿ç”¨ä»»ä½• HTTP æ¡†æ¶æš´éœ²ã€‚\nä¸€ä¸ªæµè¡Œçš„ Python web æ¡†æ¶æ˜¯ Flaskã€‚å®ƒå¯ä»¥ç”¨æ¥å¿«é€Ÿã€è½»æ¾åœ°å°†åº”ç”¨ç¨‹åºæš´éœ²ç»™ Apache Flink è¿è¡Œæ—¶ã€‚\nfrom statefun import StatefulFunctions from statefun import RequestReplyHandler functions = StatefulFunctions() @functions.bind(\u0026#34;example/greeter\u0026#34;) def greeter(context, message: GreetRequest): pass handler = RequestReplyHandler(functions) # Serve the endpoint from flask import request from flask import make_response from flask import Flask app = Flask(__name__) @app.route(\u0026#39;/statefun\u0026#39;, methods=[\u0026#39;POST\u0026#39;]) def handle(): response_data = handler(request.data) response = make_response(response_data) response.headers.set(\u0026#39;Content-Type\u0026#39;, \u0026#39;application/octet-stream\u0026#39;) return response if __name__ == \u0026#34;__main__\u0026#34;: app.run() é…ç½®è¿è¡Œæ—¶ æœ‰çŠ¶æ€å‡½æ•°è¿è¡Œæ—¶é€šè¿‡å‘ Flask æœåŠ¡å™¨è¿›è¡Œ http è°ƒç”¨æ¥å‘ greeter å‡½æ•°å‘å‡ºè¯·æ±‚ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œå®ƒéœ€è¦çŸ¥é“å®ƒå¯ä»¥ä½¿ç”¨ä»€ä¹ˆç«¯ç‚¹æ¥åˆ°è¾¾æœåŠ¡å™¨ã€‚è¿™ä¹Ÿæ˜¯é…ç½®æˆ‘ä»¬è¿æ¥åˆ°è¾“å…¥å’Œè¾“å‡º Kafka ä¸»é¢˜çš„å¥½æ—¶æœºã€‚é…ç½®åœ¨ä¸€ä¸ªåä¸º module.yaml çš„æ–‡ä»¶ä¸­ã€‚\nversion:\u0026#34;1.0\u0026#34;module:meta:type:remotespec:functions:- function:meta:kind:httptype:example/greeterspec:endpoint:http://python-worker:8000/statefunstates:- seen_countmaxNumBatchRequests:500timeout:2miningresses:- ingress:meta:type:statefun.kafka.io/routable-protobuf-ingressid:example/namesspec:address:kafka-broker:9092consumerGroupId:my-group-idtopics:- topic:namestypeUrl:com.googleapis/example.GreetRequesttargets:- example/greeteregresses:- egress:meta:type:statefun.kafka.io/generic-egressid:example/greetsspec:address:kafka-broker:9092deliverySemantic:type:exactly-oncetransactionTimeoutMillis:100000è¿™ä¸ªé…ç½®åšäº†ä¸€äº›æœ‰è¶£çš„äº‹æƒ…ã€‚\né¦–å…ˆæ˜¯å£°æ˜æˆ‘ä»¬çš„å‡½æ•° example/greeterã€‚å®ƒåŒ…æ‹¬å®ƒå¯ä»¥åˆ°è¾¾çš„ç«¯ç‚¹ä»¥åŠå‡½æ•°å¯ä»¥è®¿é—®çš„çŠ¶æ€ã€‚\ningress æ˜¯å°† GreetRequest æ¶ˆæ¯è·¯ç”±åˆ°å‡½æ•°çš„è¾“å…¥ Kafka ä¸»é¢˜ã€‚é™¤äº† broker åœ°å€å’Œæ¶ˆè´¹è€…ç»„ç­‰åŸºæœ¬å±æ€§ï¼Œå®ƒè¿˜åŒ…å«ä¸€ä¸ªç›®æ ‡åˆ—è¡¨ã€‚è¿™äº›æ˜¯æ¯ä¸ªæ¶ˆæ¯å°†è¢«å‘é€åˆ°çš„å‡½æ•°ã€‚\nå‡ºå£æ˜¯è¾“å‡ºçš„ Kafka é›†ç¾¤ã€‚å®ƒåŒ…å« broker ç‰¹å®šçš„é…ç½®ï¼Œä½†å…è®¸æ¯ä¸ªæ¶ˆæ¯è·¯ç”±åˆ°ä»»ä½•ä¸»é¢˜ã€‚\néƒ¨ç½² ç°åœ¨å·²ç»æ„å»ºäº† greeter åº”ç”¨ç¨‹åºï¼Œæ˜¯æ—¶å€™éƒ¨ç½²äº†ã€‚éƒ¨ç½² Stateful Function åº”ç”¨ç¨‹åºæœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨ç¤¾åŒºæä¾›çš„åŸºç¡€æ˜ åƒå¹¶åŠ è½½ä½ çš„æ¨¡å—ã€‚åŸºç¡€é•œåƒæä¾›äº† Stateful Function è¿è¡Œæ—¶ï¼Œå®ƒå°†ä½¿ç”¨æä¾›çš„ module.yaml æ¥ä¸ºè¿™ä¸ªç‰¹å®šçš„å·¥ä½œè¿›è¡Œé…ç½®ã€‚è¿™å¯ä»¥åœ¨æ ¹ç›®å½•ä¸‹çš„ Docker æ–‡ä»¶ä¸­æ‰¾åˆ°ã€‚\nFROM flink-statefun:2.2.0 RUN mkdir -p /opt/statefun/modules/greeter ADD module.yaml /opt/statefun/modules/greeter ç°åœ¨æ‚¨å¯ä»¥ä½¿ç”¨æä¾›çš„ Docker è®¾ç½®åœ¨æœ¬åœ°è¿è¡Œæ­¤åº”ç”¨ç¨‹åºã€‚\n$ docker-compose up -d é‚£ä¹ˆï¼Œè¦æƒ³åœ¨è¡ŒåŠ¨ä¸­çœ‹åˆ°ä¾‹å­ï¼Œå°±çœ‹çœ‹è¯é¢˜é—®å€™å‡ºæ¥çš„å†…å®¹ã€‚\ndocker-compose logs -f event-generator æƒ³æ›´è¿›ä¸€æ­¥ï¼Ÿ è¿™ä¸ª Greeter æ°¸è¿œä¸ä¼šå¿˜è®°ä¸€ä¸ªç”¨æˆ·ã€‚è¯•ç€ä¿®æ”¹è¿™ä¸ªå‡½æ•°ï¼Œä½¿å®ƒèƒ½å¤Ÿä¸ºä»»ä½•æ²¡æœ‰ä¸ç³»ç»Ÿäº¤äº’çš„ç”¨æˆ·èŠ±è¶…è¿‡60ç§’çš„æ—¶é—´é‡ç½® seen_countã€‚\næŸ¥çœ‹ Python SDK é¡µé¢ä»¥è·å¾—æ›´å¤šå…³äºå¦‚ä½•å®ç°è¿™ä¸€åŠŸèƒ½çš„ä¿¡æ¯ã€‚\nå®Œæ•´åº”ç”¨ from messages_pb2 import SeenCount, GreetRequest, GreetResponse from statefun import StatefulFunctions from statefun import RequestReplyHandler from statefun import kafka_egress_record functions = StatefulFunctions() @functions.bind(\u0026#34;example/greeter\u0026#34;) def greet(context, greet_request: GreetRequest): state = context.state(\u0026#39;seen_count\u0026#39;).unpack(SeenCount) if not state: state = SeenCount() state.seen = 1 else: state.seen += 1 context.state(\u0026#39;seen_count\u0026#39;).pack(state) response = compute_greeting(greet_request.name, state.seen) egress_message = kafka_egress_record(topic=\u0026#34;greetings\u0026#34;, key=greet_request.name, value=response) context.pack_and_send_egress(\u0026#34;example/greets\u0026#34;, egress_message) def compute_greeting(name, seen): \u0026#34;\u0026#34;\u0026#34; Compute a personalized greeting, based on the number of times this @name had been seen before. \u0026#34;\u0026#34;\u0026#34; templates = [\u0026#34;\u0026#34;, \u0026#34;Welcome %s\u0026#34;, \u0026#34;Nice to see you again %s\u0026#34;, \u0026#34;Third time is a charm %s\u0026#34;] if seen \u0026lt; len(templates): greeting = templates[seen] % name else: greeting = \u0026#34;Nice to see you at the %d-nth time %s!\u0026#34; % (seen, name) response = GreetResponse() response.name = name response.greeting = greeting return response handler = RequestReplyHandler(functions) # # Serve the endpoint # from flask import request from flask import make_response from flask import Flask app = Flask(__name__) @app.route(\u0026#39;/statefun\u0026#39;, methods=[\u0026#39;POST\u0026#39;]) def handle(): response_data = handler(request.data) response = make_response(response_data) response.headers.set(\u0026#39;Content-Type\u0026#39;, \u0026#39;application/octet-stream\u0026#39;) return response if __name__ == \u0026#34;__main__\u0026#34;: app.run() ","permalink":"https://ohmyweekly.github.io/notes/2020-12-02-python-walkthrough/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£"],"title":"Python æ¼”ç»ƒ"},{"categories":["Flink"],"contents":"SDK æœ‰çŠ¶æ€å‡½æ•°åº”ç”¨ç¨‹åºç”±ä¸€ä¸ªæˆ–å¤šä¸ªæ¨¡å—ç»„æˆã€‚ä¸€ä¸ªæ¨¡å—æ˜¯ä¸€ä¸ªç”±è¿è¡Œæ—¶åŠ è½½çš„å‡½æ•°æ†ç»‘ï¼Œå¹¶æä¾›ç»™æ¶ˆæ¯ã€‚æ¥è‡ªæ‰€æœ‰åŠ è½½æ¨¡å—çš„å‡½æ•°éƒ½æ˜¯å¤šè·¯å¤ç”¨çš„ï¼Œå¹¶ä¸”å¯ä»¥è‡ªç”±åœ°ç›¸äº’å‘é€æ¶ˆæ¯ã€‚\næœ‰çŠ¶æ€å‡½æ•°æ”¯æŒä¸¤ç§ç±»å‹çš„æ¨¡å—ã€‚è¿œç¨‹æ¨¡å—å’ŒåµŒå…¥å¼æ¨¡å—ã€‚\nè¿œç¨‹æ¨¡å— è¿œç¨‹æ¨¡å—ä½œä¸º Apache FlinkÂ® è¿è¡Œæ—¶çš„å¤–éƒ¨è¿›ç¨‹è¿è¡Œï¼›åœ¨åŒä¸€å®¹å™¨ä¸­ï¼Œä½œä¸º sidecarï¼Œä½¿ç”¨æ— æœåŠ¡å™¨å¹³å°æˆ–å…¶ä»–å¤–éƒ¨ä½ç½®ã€‚è¿™ç§æ¨¡å—ç±»å‹å¯ä»¥æ”¯æŒä»»ä½•æ•°é‡çš„è¯­è¨€ SDKã€‚è¿œç¨‹æ¨¡å—é€šè¿‡ YAML é…ç½®æ–‡ä»¶åœ¨ç³»ç»Ÿä¸­æ³¨å†Œã€‚\næŠ€æœ¯æŒ‡æ ‡ ä¸€ä¸ªè¿œç¨‹æ¨¡å—é…ç½®ç”±ä¸€ä¸ªå…ƒéƒ¨åˆ†å’Œä¸€ä¸ªè§„èŒƒéƒ¨åˆ†ç»„æˆã€‚meta åŒ…å«äº†æ¨¡å—çš„è¾…åŠ©ä¿¡æ¯ï¼›è€Œ spec åˆ™æè¿°äº†æ¨¡å—ä¸­åŒ…å«çš„åŠŸèƒ½å¹¶å®šä¹‰äº†å®ƒä»¬çš„æŒä¹…å€¼ã€‚\nå®šä¹‰å‡½æ•° module.spec.functions å£°æ˜äº†ä¸€ä¸ªç”±è¿œç¨‹æ¨¡å—å®ç°çš„å‡½æ•°å¯¹è±¡åˆ—è¡¨ã€‚ä¸€ä¸ªå‡½æ•°é€šè¿‡ä¸€äº›å±æ€§æ¥æè¿°ã€‚\n function.meta.kind  ç”¨äºä¸è¿œç¨‹åŠŸèƒ½é€šä¿¡çš„åè®®ã€‚ æ‰€æ”¯æŒçš„å€¼ - http   function.meta.type  å‡½æ•°ç±»å‹é‚£ä¸ª, è¢«å®šä¹‰ä¸º \u0026lt;namespace\u0026gt;/\u0026lt;name\u0026gt;ã€‚   function.spec.endpoint  å‡½æ•°å¯åˆ°è¾¾çš„ç«¯ç‚¹ã€‚ æ‰€æ”¯æŒçš„ schemes: http, https. ä½¿ç”¨ http+unix æˆ– https+unix æ–¹æ¡ˆæ”¯æŒé€šè¿‡ UNIX åŸŸå¥—æ¥å­—è¿›è¡Œä¼ è¾“ã€‚ å½“ä½¿ç”¨ UNIX åŸŸå¥—æ¥å­—æ—¶ï¼Œç«¯ç‚¹æ ¼å¼æ˜¯: http+unix://\u0026lt;socket-file-path\u0026gt;/\u0026lt;serve-url-path\u0026gt;ã€‚ä¾‹å¦‚, http+unix:///uds.sock/path/of/urlã€‚   function.spec.states  åœ¨è¿œç¨‹å‡½æ•°ä¸­å£°æ˜çš„æŒä¹…åŒ–å€¼çš„åˆ—è¡¨ æ¯ä¸ªæ¡ç›®ç”± name å±æ€§å’Œå¯é€‰çš„ expireAfter å±æ€§ç»„æˆã€‚ expireAfter çš„é»˜è®¤å€¼ä¸º 0ï¼Œè¡¨ç¤ºçŠ¶æ€è¿‡æœŸè¢«ç¦ç”¨ã€‚   function.spec.maxNumBatchRequests  åœ¨è°ƒç”¨ç³»ç»ŸèƒŒå‹ä¹‹å‰ï¼Œä¸€ä¸ªå‡½æ•°å¯ä»¥å¤„ç†çš„ç‰¹å®šåœ°å€çš„æœ€å¤§è®°å½•æ•°ã€‚ é»˜è®¤å€¼ï¼š1000   function.spec.timeout  è¿è¡Œæ—¶åœ¨å¤±è´¥å‰ç­‰å¾…è¿œç¨‹å‡½æ•°è¿”å›çš„æœ€é•¿æ—¶é—´ã€‚è¿™æ¶µç›–äº†æ•´ä¸ªè°ƒç”¨è¿‡ç¨‹ï¼ŒåŒ…æ‹¬è¿æ¥åˆ°å‡½æ•°ç«¯ç‚¹ã€ç¼–å†™è¯·æ±‚ã€å‡½æ•°å¤„ç†å’Œè¯»å–å“åº”ã€‚ é»˜è®¤å€¼ï¼š1åˆ†é’Ÿ   function.spec.connectTimeout  è¿è¡Œæ—¶ç­‰å¾…è¿æ¥åˆ°è¿œç¨‹å‡½æ•°ç«¯ç‚¹çš„æœ€é•¿æ—¶é—´ã€‚ é»˜è®¤å€¼ï¼š10ç§’ã€‚   function.spec.readTimeout  è¿è¡Œæ—¶ç­‰å¾…å•ä¸ªè¯»IOæ“ä½œçš„æœ€å¤§æ—¶é—´ï¼Œå¦‚è¯»å–è°ƒç”¨å“åº”ã€‚ é»˜è®¤å€¼ï¼š10ç§’ã€‚   function.spec.writeTimeout  è¿è¡Œæ—¶ç­‰å¾…å•ä¸ªå†™IOæ“ä½œçš„æœ€å¤§æ—¶é—´ï¼Œæ¯”å¦‚å†™è°ƒç”¨è¯·æ±‚ã€‚ é»˜è®¤å€¼ï¼š10ç§’ã€‚    å®Œæ•´ç¤ºä¾‹ version:\u0026#34;2.0\u0026#34;module:meta:type:remotespec:functions:- function:meta:kind:httptype:example/greeterspec:endpoint:http://\u0026lt;host-name\u0026gt;/statefunstates:- name:seen_countexpireAfter:5minmaxNumBatchRequests:500timeout:2minåµŒå…¥å¼æ¨¡å— åµŒå…¥å¼æ¨¡å—ä¸ Apache FlinkÂ® è¿è¡Œæ—¶å…±å­˜ï¼Œå¹¶åµŒå…¥å…¶ä¸­ã€‚\nè¿™ç§æ¨¡å—ç±»å‹åªæ”¯æŒåŸºäº JVM çš„è¯­è¨€ï¼Œå¹¶é€šè¿‡å®ç° StatefulFunctionModule æ¥å£æ¥å®šä¹‰ã€‚åµŒå…¥æ¨¡å—æä¾›äº†ä¸€ä¸ªå•ä¸€çš„é…ç½®æ–¹æ³•ï¼Œæœ‰çŠ¶æ€çš„å‡½æ•°æ ¹æ®å…¶å‡½æ•°ç±»å‹ä¸ç³»ç»Ÿç»‘å®šã€‚è¿è¡Œæ—¶é…ç½®å¯ä»¥é€šè¿‡ globalConfiguration æ¥å®ç°ï¼Œå®ƒæ˜¯åº”ç”¨ç¨‹åº flink-conf.yaml ä¸­å‰ç¼€ statefun.module.global-config ä¸‹çš„æ‰€æœ‰é…ç½®ä»¥åŠä»¥ --key value å½¢å¼ä¼ é€’çš„ä»»ä½•å‘½ä»¤è¡Œå‚æ•°çš„è”åˆã€‚\npackage org.apache.flink.statefun.docs; import java.util.Map; import org.apache.flink.statefun.sdk.spi.StatefulFunctionModule; public class BasicFunctionModule implements StatefulFunctionModule { public void configure(Map\u0026lt;String, String\u0026gt; globalConfiguration, Binder binder) { // Declare the user function and bind it to its type \tbinder.bindFunctionProvider(FnWithDependency.TYPE, new CustomProvider()); // Stateful functions that do not require any configuration \t// can declare their provider using java 8 lambda syntax \tbinder.bindFunctionProvider(Identifiers.HELLO_TYPE, unused -\u0026gt; new FnHelloWorld()); } } åµŒå…¥å¼æ¨¡å—åˆ©ç”¨ Java çš„æœåŠ¡æä¾›è€…æ¥å£ï¼ˆSPIï¼‰è¿›è¡Œå‘ç°ã€‚è¿™æ„å‘³ç€æ¯ä¸ª JAR éƒ½åº”è¯¥åœ¨ META_INF/services èµ„æºç›®å½•ä¸‹åŒ…å«ä¸€ä¸ªæ–‡ä»¶ org.apache.flink.statefun.sdk.spi.StatefulFunctionModuleï¼Œè¯¥æ–‡ä»¶åˆ—å‡ºäº†å®ƒæä¾›çš„æ‰€æœ‰å¯ç”¨æ¨¡å—ã€‚\norg.apache.flink.statefun.docs.BasicFunctionModule ","permalink":"https://ohmyweekly.github.io/notes/2020-12-02-sdk/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£"],"title":"Sdk"},{"categories":["Flink"],"contents":"åˆ†å¸ƒå¼æ¶æ„ ä¸€ä¸ªæœ‰çŠ¶æ€çš„ Functions éƒ¨ç½²æ˜¯ç”±å‡ ä¸ªç»„ä»¶äº¤äº’åœ¨ä¸€èµ·ç»„æˆçš„ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†æè¿°è¿™äº›ç»„ä»¶åŠå…¶ç›¸äº’ä¹‹é—´çš„å…³ç³»å’Œ Apache Flink è¿è¡Œæ—¶ã€‚\né«˜å±‚è§†å›¾ ä¸€ä¸ª Stateful Functions éƒ¨ç½²ç”±ä¸€ç»„ Apache Flink Stateful Functions è¿›ç¨‹å’Œå¯é€‰çš„æ‰§è¡Œè¿œç¨‹å‡½æ•°çš„å„ç§éƒ¨ç½²ç»„æˆã€‚\nFlink Worker è¿›ç¨‹ï¼ˆTaskManagersï¼‰ä»å…¥å£ç³»ç»Ÿï¼ˆKafkaã€Kinesis ç­‰ï¼‰æ¥æ”¶äº‹ä»¶å¹¶å°†å…¶è·¯ç”±åˆ°ç›®æ ‡å‡½æ•°ã€‚å®ƒä»¬è°ƒç”¨å‡½æ•°å¹¶å°†äº§ç”Ÿçš„æ¶ˆæ¯è·¯ç”±åˆ°ä¸‹ä¸€ä¸ªå„è‡ªçš„ç›®æ ‡å‡½æ•°ã€‚æŒ‡å®šç”¨äºå‡ºå£çš„æ¶ˆæ¯è¢«å†™å…¥å‡ºå£ç³»ç»Ÿï¼ˆåŒæ ·ï¼ŒKafkaã€Kinesis\u0026hellip;ï¼‰ã€‚\nç»„æˆéƒ¨åˆ† ç¹é‡çš„å·¥ä½œç”± Apache Flink è¿›ç¨‹å®Œæˆï¼Œå®ƒç®¡ç†çŠ¶æ€ï¼Œå¤„ç†æ¶ˆæ¯ä¼ é€’ï¼Œå¹¶è°ƒç”¨æœ‰çŠ¶æ€çš„å‡½æ•°ã€‚Flink é›†ç¾¤é€šå¸¸ç”±ä¸€ä¸ªä¸»è¿›ç¨‹å’Œå¤šä¸ªå·¥ä½œè€…ï¼ˆTaskManagersï¼‰ç»„æˆã€‚\né™¤äº† Apache Flink è¿›ç¨‹ï¼Œå®Œæ•´çš„éƒ¨ç½²è¿˜éœ€è¦ ZooKeeperï¼ˆç”¨äºä¸»ç«™æ•…éšœè½¬ç§»ï¼‰å’Œæ‰¹é‡å­˜å‚¨ï¼ˆS3ã€HDFSã€NASã€GCSã€Azure Blob Storeç­‰ï¼‰æ¥å­˜å‚¨ Flink çš„æ£€æŸ¥ç‚¹ã€‚è€Œéƒ¨ç½²æ—¶ä¸éœ€è¦æ•°æ®åº“ï¼ŒFlink è¿›ç¨‹ä¹Ÿä¸éœ€è¦æŒä¹…åŒ–å·ã€‚\né€»è¾‘åŒä½ï¼Œç‰©ç†åˆ†ç¦» è®¸å¤šæµå¤„ç†å™¨çš„ä¸€ä¸ªæ ¸å¿ƒåŸåˆ™æ˜¯ï¼Œåº”ç”¨é€»è¾‘å’Œåº”ç”¨çŠ¶æ€å¿…é¡»æ˜¯å…±ä½çš„ã€‚è¿™ç§æ–¹æ³•æ˜¯å®ƒä»¬å¼€ç®±å³ç”¨çš„ä¸€è‡´æ€§çš„åŸºç¡€ã€‚Stateful Functions é‡‡ç”¨äº†ä¸€ç§ç‹¬ç‰¹çš„æ–¹æ³•ï¼Œåœ¨é€»è¾‘ä¸Šå°†çŠ¶æ€å’Œè®¡ç®—å…±ç½®ï¼Œä½†å…è®¸åœ¨ç‰©ç†ä¸Šå°†å®ƒä»¬åˆ†å¼€ã€‚\n  é€»è¾‘ä¸Šçš„å…±ç½®ã€‚æ¶ˆæ¯ä¼ é€’ã€çŠ¶æ€è®¿é—®/æ›´æ–°å’Œå‡½æ•°è°ƒç”¨è¢«ç´§å¯†åœ°ç®¡ç†åœ¨ä¸€èµ·ï¼Œä¸ Flink çš„ DataStream API çš„æ–¹å¼ç›¸åŒã€‚çŠ¶æ€æŒ‰é”®åˆ†ç‰‡ï¼Œæ¶ˆæ¯æŒ‰é”®è·¯ç”±åˆ°çŠ¶æ€ã€‚æ¯ä¸ª key ä¸€æ¬¡æœ‰ä¸€ä¸ªå†™å…¥å™¨ï¼Œä¹Ÿæ˜¯å¯¹å‡½æ•°è°ƒç”¨è¿›è¡Œè°ƒåº¦ã€‚\n  ç‰©ç†åˆ†ç¦»ã€‚å‡½æ•°å¯ä»¥è¿œç¨‹æ‰§è¡Œï¼Œæ¶ˆæ¯å’ŒçŠ¶æ€è®¿é—®ä½œä¸ºè°ƒç”¨è¯·æ±‚çš„ä¸€éƒ¨åˆ†ã€‚è¿™æ ·ï¼Œå‡½æ•°å°±å¯ä»¥åƒæ— çŠ¶æ€è¿›ç¨‹ä¸€æ ·ç‹¬ç«‹ç®¡ç†ã€‚\n  å‡½æ•°çš„éƒ¨ç½²é£æ ¼ æœ‰çŠ¶æ€çš„å‡½æ•°æœ¬èº«å¯ä»¥ä»¥ä¸åŒçš„æ–¹å¼éƒ¨ç½²ï¼Œè¿™äº›æ–¹å¼å¯ä»¥ç›¸äº’äº¤æ¢æŸäº›ç‰¹æ€§ï¼šä¸€æ–¹é¢æ˜¯æ¾æ•£çš„è€¦åˆå’Œç‹¬ç«‹çš„æ‰©å±•ï¼Œå¦ä¸€æ–¹é¢æ˜¯æ€§èƒ½å¼€é”€ã€‚æ¯ä¸ªå‡½æ•°æ¨¡å—å¯ä»¥æ˜¯ä¸åŒçš„ç§ç±»ï¼Œæ‰€ä»¥æœ‰äº›å‡½æ•°å¯ä»¥è¿œç¨‹è¿è¡Œï¼Œè€Œæœ‰äº›å‡½æ•°å¯ä»¥åµŒå…¥å¼è¿è¡Œã€‚\nè¿œç¨‹å‡½æ•° è¿œç¨‹åŠŸèƒ½é‡‡ç”¨ä¸Šè¿°ç‰©ç†åˆ†ç¦»çš„åŸåˆ™ï¼ŒåŒæ—¶ä¿æŒé€»è¾‘ä¸Šçš„åŒä½ã€‚çŠ¶æ€/æ¶ˆæ¯å±‚ï¼ˆå³ Flink è¿›ç¨‹ï¼‰å’ŒåŠŸèƒ½å±‚æ˜¯ç‹¬ç«‹éƒ¨ç½²ã€ç®¡ç†å’Œæ‰©å±•çš„ã€‚\nåŠŸèƒ½è°ƒç”¨é€šè¿‡ HTTP/gRPC åè®®å‘ç”Ÿï¼Œå¹¶é€šè¿‡æœåŠ¡å°†è°ƒç”¨è¯·æ±‚è·¯ç”±åˆ°ä»»ä½•å¯ç”¨çš„ç«¯ç‚¹ï¼Œä¾‹å¦‚ Kubernetesï¼ˆè´Ÿè½½å¹³è¡¡ï¼‰æœåŠ¡ã€Lambda çš„ AWS è¯·æ±‚ç½‘å…³ç­‰ã€‚å› ä¸ºè°ƒç”¨æ˜¯è‡ªè¶³çš„ï¼ˆåŒ…å«æ¶ˆæ¯ã€çŠ¶æ€ã€è®¿é—®è®¡æ—¶å™¨ç­‰ï¼‰ï¼Œæ‰€ä»¥ç›®æ ‡å‡½æ•°å¯ä»¥åƒä»»ä½•æ— çŠ¶æ€çš„åº”ç”¨ç¨‹åºä¸€æ ·å¯¹å¾…ã€‚\nè¯¦æƒ…è¯·å‚è€ƒ Python SDK å’Œè¿œç¨‹æ¨¡å—çš„æ–‡æ¡£ã€‚\nå…±ç½®å‡½æ•° éƒ¨ç½²å‡½æ•°çš„å¦ä¸€ç§æ–¹å¼æ˜¯ä¸ Flink JVM è¿›ç¨‹å…±å¤„ã€‚åœ¨è¿™æ ·çš„è®¾ç½®ä¸­ï¼Œæ¯ä¸ª Flink TaskManager å°†ä¸ååœ¨\u0026quot;æ—è¾¹\u0026quot;çš„ä¸€ä¸ª Function è¿›ç¨‹å¯¹è¯ã€‚ä¸€ç§å¸¸è§çš„æ–¹å¼æ˜¯ä½¿ç”¨ Kubernetes è¿™æ ·çš„ç³»ç»Ÿï¼Œéƒ¨ç½²ç”± Flink å®¹å™¨å’Œ Function ä¾§è½¦å®¹å™¨ç»„æˆçš„ podï¼›ä¸¤è€…é€šè¿‡ pod-local ç½‘ç»œè¿›è¡Œé€šä¿¡ã€‚\nè¿™ç§æ¨¡å¼æ”¯æŒä¸åŒçš„è¯­è¨€ï¼ŒåŒæ—¶é¿å…äº†è¦é€šè¿‡ Service/LoadBalancer æ¥è·¯ç”±è°ƒç”¨ï¼Œä½†å®ƒä¸èƒ½ç‹¬ç«‹æ‰©å±•çŠ¶æ€å’Œè®¡ç®—éƒ¨åˆ†ã€‚\nè¿™ç§éƒ¨ç½²æ–¹å¼ç±»ä¼¼äº Flink çš„ Table API å’Œ API Beam çš„å¯ç§»æ¤å±‚éƒ¨ç½²å’Œæ‰§è¡Œé JVM å‡½æ•°çš„æ–¹å¼ã€‚\nåµŒå…¥å¼å‡½æ•° åµŒå…¥å¼å‡½æ•°ç±»ä¼¼äº Stateful Functions 1.0 çš„æ‰§è¡Œæ¨¡å¼ï¼Œä¹Ÿç±»ä¼¼äº Flink çš„ Java/Scala æµå¤„ç† APIã€‚å‡½æ•°åœ¨ JVM ä¸­è¿è¡Œï¼Œç›´æ¥è°ƒç”¨æ¶ˆæ¯å’ŒçŠ¶æ€è®¿é—®ã€‚è¿™æ˜¯æœ€æœ‰æ€§èƒ½çš„æ–¹å¼ï¼Œä¸è¿‡ä»£ä»·æ˜¯åªæ”¯æŒ JVM è¯­è¨€ã€‚å‡½æ•°çš„æ›´æ–°æ„å‘³ç€æ›´æ–° Flink é›†ç¾¤ã€‚\næŒ‰ç…§æ•°æ®åº“çš„ç±»æ¯”ï¼ŒåµŒå…¥å¼ Functions æœ‰ç‚¹åƒå­˜å‚¨ç¨‹åºï¼Œä½†æ–¹å¼æ›´æœ‰åŸåˆ™ã€‚è¿™é‡Œçš„å‡½æ•°æ˜¯å®ç°æ ‡å‡†æ¥å£çš„æ™®é€š Java/Scala/Kotlin å‡½æ•°ï¼Œå¯ä»¥åœ¨ä»»ä½• IDE ä¸­å¼€å‘/æµ‹è¯•ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2020-12-02-distributed-architecture/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£"],"title":"åˆ†å¸ƒå¼æ¶æ„"},{"categories":["PySpark"],"contents":"Koalas æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œå®ƒä¸º pandas æä¾›äº†ä¸€ä¸ª drop-in çš„æ›¿ä»£å“ï¼Œå¯ä»¥é«˜æ•ˆåœ°æ‰©å±•åˆ°æ•°ç™¾ä¸ªå·¥äººèŠ‚ç‚¹ï¼Œç”¨äºæ—¥å¸¸çš„æ•°æ®ç§‘å­¦å’Œæœºå™¨å­¦ä¹ ã€‚è‡ªå»å¹´é¦–æ¬¡æ¨å‡ºä»¥æ¥ï¼Œç»è¿‡ä¸€å¹´å¤šçš„å¼€å‘ï¼ŒKoalas 1.0 å·²ç»å‘å¸ƒã€‚\npandas æ˜¯æ•°æ®ç§‘å­¦å®¶ä¸­å¸¸ç”¨çš„ Python åŒ…ï¼Œä½†å®ƒå¹¶ä¸èƒ½æ‰©å±•åˆ°å¤§æ•°æ®ã€‚å½“ä»–ä»¬çš„æ•°æ®å˜å¾—åºå¤§æ—¶ï¼Œä»–ä»¬å¿…é¡»ä»ä¸€å¼€å§‹å°±é€‰æ‹©å’Œå­¦ä¹ å¦ä¸€ä¸ªç³»ç»Ÿï¼Œå¦‚ Apache Sparkï¼Œä»¥é‡‡ç”¨å’Œè½¬æ¢ä»–ä»¬ç°æœ‰çš„å·¥ä½œè´Ÿè½½ã€‚ Koalas é€šè¿‡æä¾› pandas ç­‰æ•ˆçš„ API æ¥å¡«è¡¥è¿™ä¸ªç©ºç™½ï¼Œè¿™äº› API å¯ä»¥åœ¨ Apache Spark ä¸Šå·¥ä½œã€‚å…¶ä¸­å¾ˆå¤šåœ¨ä¹‹å‰çš„åšæ–‡ä¸­å·²ç»ä»‹ç»è¿‡ï¼Œå…¶ä¸­è¿˜åŒ…æ‹¬ä½¿ç”¨ Koalas æ—¶çš„æœ€ä½³å®è·µã€‚\nKoalas ä¸ä»…å¯¹ pandas ç”¨æˆ·æœ‰ç”¨ï¼Œå¯¹ PySpark ç”¨æˆ·ä¹Ÿå¾ˆæœ‰ç”¨ï¼Œå› ä¸º Koalas æ”¯æŒå¾ˆå¤š PySpark éš¾ä»¥å®ç°çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼ŒSpark ç”¨æˆ·å¯ä»¥é€šè¿‡ Koalas ç»˜å›¾ API ç›´æ¥ä» PySpark DataFrame ä¸­ç»˜åˆ¶æ•°æ®ï¼Œç±»ä¼¼äº pandasã€‚PySpark DataFrame æ›´ç¬¦åˆ SQL æ ‡å‡†ï¼Œè€Œ Koalas DataFrame æ›´æ¥è¿‘ Python æœ¬èº«ï¼Œè¿™ä¸ºåœ¨æŸäº›æƒ…å†µä¸‹ä½¿ç”¨ Python æä¾›äº†æ›´ç›´è§‚çš„å·¥ä½œæ–¹å¼ã€‚åœ¨ Koalas æ–‡æ¡£ä¸­ï¼Œæœ‰å„ç§ pandas å¯¹åº”çš„ API å®ç°ã€‚\nåœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘ä»¬é‡ç‚¹ä»‹ç» PySpark ç”¨æˆ·å¦‚ä½•åˆ©ç”¨è‡ªå·±çš„çŸ¥è¯†å’Œ PySpark ä¸ Koalas ä¹‹é—´çš„åŸç”Ÿäº¤äº’ï¼Œæ›´å¿«åœ°ç¼–å†™ä»£ç ã€‚æˆ‘ä»¬åŒ…å«äº†è®¸å¤šè‡ªå¸¦çš„ä¾‹å­ï¼Œå¦‚æœä½ å®‰è£…äº†å¸¦ Koalas çš„ Sparkï¼Œæˆ–è€…ä½ æ­£åœ¨ä½¿ç”¨ Databricks Runtimeï¼Œä½ å¯ä»¥è¿è¡Œè¿™äº›ä¾‹å­ã€‚ä» Databricks Runtime 7.1 å¼€å§‹ï¼ŒKoalas å°±è¢«æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œæ‰€ä»¥æ‚¨æ— éœ€æ‰‹åŠ¨å®‰è£…å°±å¯ä»¥è¿è¡Œã€‚\nKoalas å’Œ PySpark DataFrames åœ¨æ·±ç©¶ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ Koalas å’Œ PySpark DataFrames çš„ä¸€èˆ¬åŒºåˆ«ã€‚\nä»å¤–è§‚ä¸Šçœ‹ï¼Œå®ƒä»¬æ˜¯ä¸åŒçš„ã€‚Koalas DataFrames æ— ç¼åœ°æ²¿ç”¨äº† pandas DataFrames çš„ç»“æ„ï¼Œå¹¶åœ¨åº•å±‚ä¸‹å®ç°äº†ä¸€ä¸ªç´¢å¼•/æ ‡è¯†ç¬¦ã€‚è€Œ PySpark DataFrame åˆ™æ›´è¶‹å‘äºç¬¦åˆå…³ç³»å‹æ•°æ®åº“ä¸­çš„å…³ç³»/è¡¨ï¼Œå¹¶ä¸”æ²¡æœ‰å”¯ä¸€çš„è¡Œæ ‡è¯†ç¬¦ã€‚\nåœ¨å†…éƒ¨ï¼ŒKoalas DataFrames æ˜¯å»ºç«‹åœ¨ PySpark DataFrames ä¸Šçš„ã€‚Koalas å°† pandas APIs ç¿»è¯‘æˆ Spark SQL çš„é€»è¾‘è®¡åˆ’ã€‚è¯¥è®¡åˆ’ç”±å¤æ‚è€Œå¼ºå¤§çš„ Spark SQL å¼•æ“ä¼˜åŒ–å’Œæ‰§è¡Œï¼ŒSpark ç¤¾åŒºä¸æ–­å¯¹å…¶è¿›è¡Œæ”¹è¿›ã€‚Koalas è¿˜æ²¿ç”¨ Spark çš„æ‡’æƒ°è¯„ä¼°è¯­ä¹‰ï¼Œä»¥å®ç°æ€§èƒ½çš„æœ€å¤§åŒ–ã€‚ä¸ºäº†å®ç° pandas DataFrame ç»“æ„å’Œ pandas ä¸°å¯Œçš„ APIï¼Œéœ€è¦éšå¼æ’åºï¼ŒKoalas DataFrames çš„å†…éƒ¨å…ƒæ•°æ®è¡¨ç¤º pandas ç­‰ä»·çš„ç´¢å¼•å’Œåˆ—æ ‡ç­¾æ˜ å°„åˆ° PySpark DataFrame ä¸­çš„åˆ—ã€‚\nå³ä½¿ Koalas åˆ©ç”¨ PySpark ä½œä¸ºæ‰§è¡Œå¼•æ“ï¼Œä½†ä¸ PySpark ç›¸æ¯”ï¼Œä½ ä»ç„¶å¯èƒ½é¢ä¸´è½»å¾®çš„æ€§èƒ½ä¸‹é™ã€‚æ­£å¦‚åœ¨ Virgin Hyperloop One çš„è¿ç§»ç»éªŒä¸­æ‰€è®¨è®ºçš„ï¼Œä¸»è¦åŸå› é€šå¸¸æ˜¯:\n ä½¿ç”¨äº†é»˜è®¤ç´¢å¼•ã€‚æ„å»ºé»˜è®¤ç´¢å¼•çš„å¼€é”€å–å†³äºæ•°æ®å¤§å°ã€é›†ç¾¤ç»„æˆç­‰ã€‚å› æ­¤ï¼Œæ€»æ˜¯å¸Œæœ›é¿å…ä½¿ç”¨é»˜è®¤ç´¢å¼•ã€‚å…³äºè¿™ä¸€ç‚¹å°†åœ¨ä¸‹é¢çš„å…¶ä»–ç« èŠ‚ä¸­è¯¦ç»†è®¨è®ºã€‚ PySpark å’Œ pandas ä¸­çš„ä¸€äº› API åç§°ç›¸åŒï¼Œä½†è¯­ä¹‰ä¸åŒã€‚ä¾‹å¦‚ï¼ŒKoalas DataFrame å’Œ PySpark DataFrame éƒ½æœ‰ count APIã€‚å‰è€…ç»Ÿè®¡æ¯åˆ—/è¡Œçš„é NA/null æ¡ç›®æ•°ï¼Œåè€…ç»Ÿè®¡æ£€ç´¢åˆ°çš„è¡Œæ•°ï¼ŒåŒ…æ‹¬åŒ…å« null çš„è¡Œã€‚  \u0026gt;\u0026gt;\u0026gt; ks.DataFrame({\u0026#39;a\u0026#39;: [1, 2, 3], \u0026#39;b\u0026#39;: [4, 5, 6]}).count() a 3 b 3 \u0026gt;\u0026gt;\u0026gt; spark.createDataFrame( ... [[1, 4], [2, 5], [3, 6]], schema=[\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;]).count() 3 ä» PySpark DataFrames è½¬æ¢åˆ° PySpark DataFrames å¯¹äºä¸€ä¸ª PySpark ç”¨æˆ·æ¥è¯´ï¼Œå¾ˆé«˜å…´çŸ¥é“ä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨ Koalas DataFrame å’Œ PySpark DataFrame ä¹‹é—´æ¥å›åˆ‡æ¢ï¼Œä»¥åŠåœ¨åº•å±‚å‘ç”Ÿäº†ä»€ä¹ˆï¼Œè¿™æ ·ä½ å°±ä¸éœ€è¦å®³æ€•è¿›å…¥ Koalas ä¸–ç•Œï¼Œåœ¨ Spark ä¸Šåº”ç”¨é«˜æ‰©å±•æ€§çš„ pandas APIã€‚\n to_koalas()  å½“å¯¼å…¥ Koalas åŒ…æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å°† to_koalas()æ–¹æ³•é™„åŠ åˆ° PySpark DataFrames ä¸­ã€‚ä½ å¯ä»¥ç®€å•åœ°ä½¿ç”¨è¿™ä¸ªæ–¹æ³•å°† PySpark DataFrames è½¬æ¢ä¸º Koalas DataFramesã€‚\nå‡è®¾ä½ æœ‰ä¸€ä¸ª PySpark DataFrameã€‚\n\u0026gt;\u0026gt;\u0026gt; sdf = spark.createDataFrame([(1, 10.0, \u0026#39;a\u0026#39;), (2, 20.0, \u0026#39;b\u0026#39;), (3, 30.0, \u0026#39;c\u0026#39;)],schema=[\u0026#39;x\u0026#39;, \u0026#39;y\u0026#39;, \u0026#39;z\u0026#39;]) \u0026gt;\u0026gt;\u0026gt; sdf.show() +---+----+---+ | x| y| z| +---+----+---+ | 1|10.0| a| | 2|20.0| b| | 3|30.0| c| +---+----+---+ é¦–å…ˆï¼Œå¯¼å…¥ Koalas åŒ…ã€‚ä¼ ç»Ÿä¸Šä½¿ç”¨ ks ä½œä¸ºåŒ…çš„åˆ«åã€‚\n\u0026gt;\u0026gt;\u0026gt; import databricks.koalas as ks å¦‚ä¸Šæ‰€è¿°ï¼Œç”¨ to_koalas()æ–¹æ³•å°† Spark DataFrame è½¬æ¢ä¸º Koalas DataFrameã€‚\n\u0026gt;\u0026gt;\u0026gt; kdf = sdf.to_koalas() \u0026gt;\u0026gt;\u0026gt; kdf x y z 0 1 10.0 a 1 2 20.0 b 2 3 30.0 c kdf æ˜¯ä¸€ä¸ªç”± PySpark DataFrame åˆ›å»ºçš„ Koalas DataFrameã€‚å½“çœŸæ­£éœ€è¦æ•°æ®æ—¶ï¼Œè®¡ç®—ä¼šè¢«æ‡’æƒ°åœ°æ‰§è¡Œï¼Œä¾‹å¦‚æ˜¾ç¤ºæˆ–å­˜å‚¨è®¡ç®—çš„æ•°æ®ï¼Œä¸ PySpark ç›¸åŒã€‚\n to_spark()  æ¥ä¸‹æ¥ï¼Œä½ è¿˜åº”è¯¥çŸ¥é“å¦‚ä½•ä» Koalas å›åˆ° PySpark DataFrameã€‚ä½ å¯ä»¥åœ¨ Koalas DataFrame ä¸Šä½¿ç”¨ to_spark()æ–¹æ³•ã€‚\n\u0026gt;\u0026gt;\u0026gt; sdf_from_kdf = kdf.to_spark() \u0026gt;\u0026gt;\u0026gt; sdf_from_kdf.show() +---+----+---+ | x| y| z| +---+----+---+ | 1|10.0| a| | 2|20.0| b| | 3|30.0| c| +---+----+---+ ç°åœ¨ä½ åˆæœ‰äº†ä¸€ä¸ª PySpark DataFrameã€‚è¯·æ³¨æ„ï¼Œç°åœ¨å·²ç»æ²¡æœ‰ Koalas DataFrame ä¸­åŒ…å«çš„ç´¢å¼•åˆ—äº†ã€‚ä¸‹é¢å°†è®¨è®ºå¤„ç†ç´¢å¼•çš„æœ€ä½³å®è·µã€‚\nç´¢å¼•å’Œ index_col å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒKoalas å†…éƒ¨ç®¡ç†äº†å‡ åˆ—ä½œä¸º \u0026ldquo;ç´¢å¼• \u0026ldquo;åˆ—ï¼Œä»¥è¡¨ç¤º pandas çš„ç´¢å¼•ã€‚è¿™äº› \u0026ldquo;ç´¢å¼• \u0026ldquo;åˆ—ç”¨äºé€šè¿‡ loc/iloc ç´¢å¼•å™¨è®¿é—®è¡Œï¼Œæˆ–è€…ç”¨äº sort_index()æ–¹æ³•ä¸­ï¼Œè€Œä¸æŒ‡å®šæ’åºé”®åˆ—ï¼Œç”šè‡³ç”¨äºç»“åˆä¸¤ä¸ªä»¥ä¸Š DataFrame æˆ– Series çš„æ“ä½œæ—¶åŒ¹é…ç›¸åº”çš„è¡Œï¼Œä¾‹å¦‚ df1+df2ï¼Œç­‰ç­‰ã€‚\nå¦‚æœ PySpark DataFrame ä¸­å·²ç»æœ‰è¿™æ ·çš„åˆ—ï¼Œå¯ä»¥ä½¿ç”¨ index_col å‚æ•°æ¥æŒ‡å®šç´¢å¼•åˆ—ã€‚\n\u0026gt;\u0026gt;\u0026gt; kdf_with_index_col = sdf.to_koalas(index_col=\u0026#39;x\u0026#39;) # or index_col=[\u0026#39;x\u0026#39;] \u0026gt;\u0026gt;\u0026gt; kdf_with_index_col y z x 1 10.0 a 2 20.0 b 3 30.0 c è¿™æ—¶ï¼Œåˆ— x ä¸è¢«è§†ä¸ºå¸¸è§„åˆ—ä¹‹ä¸€ï¼Œè€Œæ˜¯ç´¢å¼•ã€‚\nå¦‚æœä½ æœ‰å¤šä¸ªåˆ—ä½œä¸ºç´¢å¼•ï¼Œä½ å¯ä»¥ä¼ é€’åˆ—ååˆ—è¡¨ã€‚\n\u0026gt;\u0026gt;\u0026gt; sdf.to_koalas(index_col=[\u0026#39;x\u0026#39;, \u0026#39;y\u0026#39;]) z x y 1 10.0 a 2 20.0 b 3 30.0 c å½“å›åˆ° PySpark DataFrame æ—¶ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ index_col å‚æ•°æ¥ä¿å­˜ç´¢å¼•åˆ—ã€‚\n\u0026gt;\u0026gt;\u0026gt; kdf_with_index_col.to_spark(index_col=\u0026#39;index\u0026#39;).show() # or index_col=[\u0026#39;index\u0026#39;] +-----+----+---+ |index| y| z| +-----+----+---+ | 1|10.0| a| | 2|20.0| b| | 3|30.0| c| +-----+----+---+ å¦åˆ™ï¼Œå°±ä¼šå¤±å»æŒ‡æ•°ï¼Œå¦‚ä¸‹å›¾ã€‚\n\u0026gt;\u0026gt;\u0026gt; kdf_with_index_col.to_spark().show() +----+---+ | y| z| +----+---+ |10.0| a| |20.0| b| |30.0| c| +----+---+ åˆ—åçš„æ•°é‡åº”ä¸ç´¢å¼•åˆ—çš„æ•°é‡ä¸€è‡´ã€‚\n\u0026gt;\u0026gt;\u0026gt; kdf.to_spark(index_col=[\u0026#39;index1\u0026#39;, \u0026#39;index2\u0026#39;]).show() Traceback (most recent call last): ... ValueError: length of index columns is 1; however, the length of the given \u0026#39;index_col\u0026#39; is 2. é»˜è®¤ç´¢å¼• æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œå¦‚æœä½ ä¸æŒ‡å®š index_col å‚æ•°ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„åˆ—ä½œä¸ºç´¢å¼•ã€‚\n\u0026gt;\u0026gt;\u0026gt; sdf.to_koalas() x y z 0 1 10.0 a 1 2 20.0 b 2 3 30.0 c åˆ—ä»å“ªé‡Œæ¥ï¼Ÿ\nç­”æ¡ˆæ˜¯ \u0026ldquo;é»˜è®¤ç´¢å¼•\u0026rdquo;ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®š index_col å‚æ•°ï¼ŒKoalas ä¼šè‡ªåŠ¨å°†ä¸€åˆ—ä½œä¸ºç´¢å¼•é™„åŠ åˆ° DataFrame ä¸­ã€‚æœ‰ä¸‰ç§ç±»å‹çš„é»˜è®¤ç´¢å¼•ã€‚\u0026ldquo;sequence\u0026rdquo;ã€\u0026ldquo;distributed-sequence \u0026ldquo;å’Œ \u0026ldquo;distributed\u0026rdquo;ã€‚æ¯ç§ç±»å‹éƒ½æœ‰å…¶ç‹¬ç‰¹çš„ç‰¹ç‚¹å’Œå±€é™æ€§ï¼Œæ¯”å¦‚æ€§èƒ½æƒ©ç½šã€‚ä¸ºäº†å‡å°‘æ€§èƒ½å¼€é”€ï¼Œå¼ºçƒˆå»ºè®®åœ¨ä» PySpark DataFrame è½¬æ¢æ—¶é€šè¿‡ index_col æŒ‡å®šç´¢å¼•åˆ—ã€‚\nå½“ Koalas ä¸çŸ¥é“å“ªä¸€åˆ—æ˜¯ç”¨æ¥åšç´¢å¼•æ—¶ï¼Œä¹Ÿä¼šä½¿ç”¨é»˜è®¤ç´¢å¼•ã€‚ä¾‹å¦‚ï¼Œreset_index()æ²¡æœ‰ä»»ä½•å‚æ•°ï¼Œå®ƒè¯•å›¾å°†æ‰€æœ‰çš„ç´¢å¼•æ•°æ®è½¬æ¢ä¸ºå¸¸è§„åˆ—ï¼Œå¹¶é‡æ–°åˆ›å»ºä¸€ä¸ªç´¢å¼•ã€‚\n\u0026gt;\u0026gt;\u0026gt; kdf_with_index_col.reset_index() x y z 0 1 10.0 a 1 2 20.0 b 2 3 30.0 c ä½ å¯ä»¥é€šè¿‡è®¾ç½® Koalas é€‰é¡¹ \u0026ldquo;compute.default_index_type\u0026rdquo; æ¥æ”¹å˜é»˜è®¤çš„ç´¢å¼•ç±»å‹ã€‚\nks.set_option(\u0026#39;compute.default_index_type\u0026#39;, \u0026#39;sequence\u0026#39;) æˆ–\nks.options.compute.default_index_type = \u0026#39;sequence\u0026#39; é¡ºåºå‹ ç›®å‰ Koalas ä¸­é»˜è®¤ä½¿ç”¨ \u0026ldquo;åºåˆ— \u0026ldquo;ç±»å‹ï¼Œå› ä¸ºå®ƒåƒ pandas ä¸€æ ·ä¿è¯äº†ç´¢å¼•çš„è¿ç»­é€’å¢ã€‚ä½†æ˜¯ï¼Œå®ƒå†…éƒ¨ä½¿ç”¨äº†ä¸€ä¸ªéåˆ†åŒºçª—å£å‡½æ•°ï¼Œè¿™æ„å‘³ç€æ‰€æœ‰çš„æ•°æ®éƒ½éœ€è¦æ”¶é›†åˆ°ä¸€ä¸ªèŠ‚ç‚¹ä¸­ã€‚å¦‚æœèŠ‚ç‚¹çš„å†…å­˜ä¸è¶³ï¼Œæ€§èƒ½ä¼šæ˜æ˜¾ä¸‹é™ï¼Œæˆ–è€…å‡ºç° OutOfMemoryErrorã€‚\n\u0026gt;\u0026gt;\u0026gt; ks.set_option(\u0026#39;compute.default_index_type\u0026#39;, \u0026#39;sequence\u0026#39;) \u0026gt;\u0026gt;\u0026gt; spark.range(5).to_koalas() id 0 0 1 1 2 2 3 3 4 4 åˆ†æ•£å¼ å½“ä½¿ç”¨ \u0026ldquo;åˆ†å¸ƒå¼-åºåˆ— \u0026ldquo;ç´¢å¼•æ—¶ï¼Œæ€§èƒ½æƒ©ç½šæ²¡æœ‰ \u0026ldquo;åºåˆ— \u0026ldquo;ç±»å‹é‚£ä¹ˆæ˜¾è‘—ã€‚å®ƒä»¥åˆ†å¸ƒå¼çš„æ–¹å¼è®¡ç®—å’Œç”Ÿæˆç´¢å¼•ï¼Œä½†å®ƒéœ€è¦å¦ä¸€ä¸ªé¢å¤–çš„ Spark Job æ¥å†…éƒ¨ç”Ÿæˆå…¨å±€åºåˆ—ã€‚å®ƒä¹Ÿä¸èƒ½ä¿è¯ç»“æœçš„è‡ªç„¶é¡ºåºã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå®ƒä¼šå˜æˆä¸€ä¸ªä¸æ–­å¢åŠ çš„æ•°å­—ã€‚\n\u0026gt;\u0026gt;\u0026gt; ks.set_option(\u0026#39;compute.default_index_type\u0026#39;, \u0026#39;distributed-sequence\u0026#39;) \u0026gt;\u0026gt;\u0026gt; spark.range(5).to_koalas() id 3 3 1 1 2 2 4 4 0 0 åˆ†æ•£å‹ \u0026ldquo;åˆ†å¸ƒå¼ \u0026ldquo;ç´¢å¼•å‡ ä¹æ²¡æœ‰æ€§èƒ½ä¸Šçš„æƒ©ç½šï¼Œè€Œä¸”æ€»æ˜¯åˆ›å»ºå•è°ƒå¢åŠ çš„æ•°å­—ã€‚å¦‚æœç´¢å¼•åªæ˜¯éœ€è¦ä½œä¸ºæ¯è¡Œçš„å”¯ä¸€æ•°å­—ï¼Œæˆ–è¡Œçš„é¡ºåºï¼Œè¿™ç§ç´¢å¼•ç±»å‹å°†æ˜¯æœ€ä½³é€‰æ‹©ã€‚ä½†æ˜¯ï¼Œè¿™äº›æ•°å­—æœ‰ä¸€ä¸ªä¸ç¡®å®šçš„é—´éš™ã€‚è¿™æ„å‘³ç€è¿™ç§ç´¢å¼•ç±»å‹ä¸å¤ªå¯èƒ½è¢«ç”¨ä½œç»“åˆä¸¤ä¸ªä»¥ä¸Š DataFrames æˆ– Series çš„æ“ä½œçš„ç´¢å¼•ã€‚\n\u0026gt;\u0026gt;\u0026gt; ks.set_option(\u0026#39;compute.default_index_type\u0026#39;, \u0026#39;distributed\u0026#39;) \u0026gt;\u0026gt;\u0026gt; spark.range(5).to_koalas() id 17179869184 0 34359738368 1 60129542144 2 77309411328 3 94489280512 4 æ¯”è¾ƒ æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œæ¯ç§ç´¢å¼•ç±»å‹éƒ½æœ‰å…¶ç‹¬ç‰¹çš„ç‰¹å¾ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚è€ƒè™‘åˆ°ä½ çš„å·¥ä½œè´Ÿè½½ï¼Œåº”è¯¥è°¨æ…é€‰æ‹©é»˜è®¤çš„ç´¢å¼•ç±»å‹ã€‚\n   åˆ†å¸ƒå¼è®¡ç®— Map ç«¯æ“ä½œ è¿ç»­é€’å¢ æ€§èƒ½     sequence No, åœ¨å•ä¸ª worker èŠ‚ç‚¹ä¸­ No, éœ€è¦ shuffle Yes   distributed-sequence Yes Yes, ä½†éœ€è¦å¦ä¸€ä¸ª Spark job Yes, åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹   distributed Yes Yes No    å‚è§ Koalas æ–‡æ¡£ä¸­çš„é»˜è®¤ç´¢å¼•ç±»å‹ã€‚\nä½¿ç”¨ Spark I/O åœ¨ pandas ä¸­ï¼Œæœ‰å¾ˆå¤šå‡½æ•°å¯ä»¥è¯»å†™æ•°æ®ï¼Œåœ¨ Koalas ä¸­ä¹Ÿæ˜¯å¦‚æ­¤ã€‚\nä¸‹é¢æ˜¯ pandas ä¸­çš„å‡½æ•°åˆ—è¡¨ï¼ŒKoalas åœ¨ä¸‹é¢ä½¿ç”¨äº† Spark I/Oã€‚\n DataFrame.to_csv / ks.read_csv DataFrame.to_json / ks.read_json DataFrame.to_parquet / ks.read_parquet ks.read_sql_table ks.read_sql_query  API å’Œå®ƒä»¬çš„å‚æ•°æ²¿ç”¨äº† pandas å¯¹åº”çš„ APIã€‚ä¸è¿‡ï¼Œç›®å‰åœ¨è¡Œä¸ºä¸Šæœ‰ç»†å¾®çš„å·®åˆ«ã€‚ä¾‹å¦‚ï¼Œpandas çš„ read_csv å¯ä»¥é€šè¿‡ http åè®®è¯»å–æ–‡ä»¶ï¼Œä½† Koalas ä»ç„¶ä¸æ”¯æŒï¼Œå› ä¸ºåº•å±‚çš„ Spark å¼•æ“æœ¬èº«å¹¶ä¸æ”¯æŒã€‚\nè¿™äº› Koalas å‡½æ•°è¿˜æœ‰ index_col å‚æ•°ï¼Œç”¨æ¥æŒ‡å®šå“ªäº›åˆ—åº”è¯¥è¢«ç”¨ä½œç´¢å¼•ï¼Œæˆ–è€…ç´¢å¼•åˆ—ååº”è¯¥æ˜¯ä»€ä¹ˆï¼Œç±»ä¼¼äºä¸Šé¢ä»‹ç»çš„ to_koalas()æˆ– to_spark()å‡½æ•°ã€‚å¦‚æœä½ ä¸æŒ‡å®šï¼Œå°±ä¼šé™„åŠ é»˜è®¤çš„ç´¢å¼•ï¼Œæˆ–è€…ç´¢å¼•åˆ—ä¸¢å¤±ã€‚\nä¾‹å¦‚ï¼Œå¦‚æœä½ ä¸æŒ‡å®š index_col å‚æ•°ï¼Œé»˜è®¤ç´¢å¼•å°±ä¼šè¢«é™„åŠ ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º\u0026ndash;ä¸ºäº†ç®€å•èµ·è§ï¼Œä½¿ç”¨äº†åˆ†å¸ƒå¼é»˜è®¤ç´¢å¼•ã€‚\n\u0026gt;\u0026gt;\u0026gt; kdf.to_csv(\u0026#39;/path/to/test.csv\u0026#39;) \u0026gt;\u0026gt;\u0026gt; kdf_read_csv = ks.read_csv(\u0026#39;/path/to/test.csv\u0026#39;) \u0026gt;\u0026gt;\u0026gt; kdf_read_csv x y z 0 2 20.0 b 8589934592 3 30.0 c 17179869184 1 10.0 a è€Œå¦‚æœæŒ‡å®š index_col å‚æ•°ï¼ŒæŒ‡å®šçš„åˆ—å°±ä¼šå˜æˆä¸€ä¸ªç´¢å¼•ã€‚\n\u0026gt;\u0026gt;\u0026gt; kdf.to_csv(\u0026#39;/path/to/test.csv\u0026#39;, index_col=\u0026#39;index\u0026#39;) \u0026gt;\u0026gt;\u0026gt; kdf_read_csv_with_index_col = ks.read_csv(\u0026#34;/path/to/test.csv\u0026#34;, index_col=\u0026#39;index\u0026#39;) \u0026gt;\u0026gt;\u0026gt; kdf_read_csv_with_index_col x y z index 2 3 30.0 c 1 2 20.0 b 0 1 10.0 a æ­¤å¤–ï¼Œæ¯ä¸ªå‡½æ•°éƒ½éœ€è¦å…³é”®å­—å‚æ•°æ¥è®¾ç½® Spark ä¸­ DataFrameWriter å’Œ DataFrameReader çš„é€‰é¡¹ã€‚ç»™å®šçš„é”®ç›´æ¥ä¼ é€’ç»™å®ƒä»¬çš„é€‰é¡¹å¹¶é…ç½®è¡Œä¸ºã€‚å½“ pandas-origin å‚æ•°ä¸è¶³ä»¥æ“ä½œä½ çš„æ•°æ®ï¼Œä½† PySpark æ”¯æŒç¼ºå¤±çš„åŠŸèƒ½æ—¶ï¼Œè¿™å¾ˆæœ‰ç”¨ã€‚\n\u0026gt;\u0026gt;\u0026gt; # nullValue is the option specific to Sparkâ€™s CSV I/O. \u0026gt;\u0026gt;\u0026gt; ks.read_csv(\u0026#39;/path/to/test.csv\u0026#39;, index_col=\u0026#39;index\u0026#39;, nullValue=\u0026#39;b\u0026#39;) x y z index 2 3 30.0 c 1 2 20.0 None 0 1 10.0 a Koalas ç‰¹å®šçš„ I/O åŠŸèƒ½ é™¤äº†ä»¥ä¸Šæ¥è‡ª pandas çš„åŠŸèƒ½å¤–ï¼ŒKoalas è¿˜æœ‰è‡ªå·±çš„åŠŸèƒ½ã€‚\n DataFrame.to_table / ks.read_table DataFrame.to_spark_io / ks.read_spark_io DataFrame.to_delta / ks.read_delta  é¦–å…ˆï¼ŒDataFrame.to_table å’Œ ks.read_table æ˜¯åªéœ€æŒ‡å®šè¡¨åå°±å¯ä»¥å†™å…¥å’Œè¯»å– Spark è¡¨ã€‚è¿™åˆ†åˆ«ç±»ä¼¼äº Spark ä¸­çš„ DataFrameWriter.saveAsTable å’Œ DataFrameReader.tableã€‚\nå…¶æ¬¡ï¼ŒDataFrame.to_spark_io å’Œ ks.read_spark_io æ˜¯ç”¨äºä¸€èˆ¬çš„ Spark I/Oã€‚ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œæœ‰å‡ ä¸ªå¯é€‰çš„å‚æ•°ï¼Œå…¶ä»–éƒ½æ˜¯å…³é”®å­—å‚æ•°ã€‚ä½ å¯ä»¥è‡ªç”±è®¾ç½® Spark ä¸­ DataFrameWriter.save å’Œ DataFrameReader.load ä½¿ç”¨çš„é€‰é¡¹ã€‚\n\u0026gt;\u0026gt;\u0026gt; # \u0026#39;compression\u0026#39; is a Spark specific option. \u0026gt;\u0026gt;\u0026gt; kdf.to_spark_io(\u0026#39;/path/to/test.orc\u0026#39;, format=\u0026#39;orc\u0026#39;, index_col=\u0026#39;index\u0026#39;, compression=\u0026#34;snappy\u0026#34;) \u0026gt;\u0026gt;\u0026gt; kdf_read_spark_io = ks.read_spark_io(\u0026#39;/path/to/test.orc\u0026#39;, format=\u0026#39;orc\u0026#39;, index_col=\u0026#39;index\u0026#39;) \u0026gt;\u0026gt;\u0026gt; kdf_read_spark_io x y z index 1 2 20.0 b 0 1 10.0 a 2 3 30.0 c ä¸Šä¾‹ä¸­çš„ ORC æ ¼å¼åœ¨ pandas ä¸­æ˜¯ä¸æ”¯æŒçš„ï¼Œä½† Koalas å¯ä»¥å†™å’Œè¯»ï¼Œå› ä¸ºåº•å±‚çš„ Spark I/O æ”¯æŒå®ƒã€‚\næœ€åï¼Œå¦‚æœä½ å®‰è£…äº† Delta Lakeï¼ŒKoalas ä¹Ÿå¯ä»¥å†™å’Œè¯» Delta è¡¨ã€‚\nDelta Lake æ˜¯ä¸€ä¸ªå¼€æºçš„å­˜å‚¨å±‚ï¼Œä¸ºæ•°æ®æ¹–å¸¦æ¥äº†å¯é æ€§ã€‚Delta Lake æä¾›äº† ACID äº‹åŠ¡ã€å¯æ‰©å±•çš„å…ƒæ•°æ®å¤„ç†ï¼Œå¹¶ç»Ÿä¸€äº†æµå¼å’Œæ‰¹å¤„ç†æ•°æ®ã€‚\nä¸å…¶ä»–æ–‡ä»¶æºä¸åŒçš„æ˜¯ï¼Œread_delta å‡½æ•°å¯ä»¥è®©ç”¨æˆ·æŒ‡å®šè¡¨çš„ç‰ˆæœ¬æ¥è¿›è¡Œæ—¶é—´æ—…è¡Œã€‚\n\u0026gt;\u0026gt;\u0026gt; kdf.to_delta(\u0026#39;/path/to/test.delta\u0026#39;, index_col=\u0026#39;index\u0026#39;) \u0026gt;\u0026gt;\u0026gt; kdf_read_delta = ks.read_delta(\u0026#39;/path/to/test.delta\u0026#39;, index_col=\u0026#39;index\u0026#39;) \u0026gt;\u0026gt;\u0026gt; kdf_read_delta x y z index 0 1 10.0 a 1 2 20.0 b 2 3 30.0 c \u0026gt;\u0026gt;\u0026gt; # Update the data and overwrite the Delta table \u0026gt;\u0026gt;\u0026gt; kdf[\u0026#39;x\u0026#39;] = kdf[\u0026#39;x\u0026#39;] + 10 \u0026gt;\u0026gt;\u0026gt; kdf[\u0026#39;y\u0026#39;] = kdf[\u0026#39;y\u0026#39;] * 10 \u0026gt;\u0026gt;\u0026gt; kdf[\u0026#39;x\u0026#39;] = kdf[\u0026#39;x\u0026#39;] * 2 \u0026gt;\u0026gt;\u0026gt; kdf.to_delta(\u0026#39;/path/to/test.delta\u0026#39;, index_col=\u0026#39;index\u0026#39;) \u0026gt;\u0026gt;\u0026gt; # Read the latest data \u0026gt;\u0026gt;\u0026gt; ks.read_delta(\u0026#39;/path/to/test.delta\u0026#39;, index_col=\u0026#39;index\u0026#39;) x y z index 0 22 100.0 a 1 24 200.0 b 2 26 300.0 c \u0026gt;\u0026gt;\u0026gt; # Read the data of version 0 \u0026gt;\u0026gt;\u0026gt; ks.read_delta(\u0026#39;/path/to/test.delta\u0026#39;, version=0, index_col=\u0026#39;index\u0026#39;) x y z index 0 1 10.0 a 1 2 20.0 b 2 3 30.0 c è¯¦æƒ…è¯·çœ‹ Delta Lakeã€‚\nSpark accessor Koalas ä¸ºç”¨æˆ·æä¾›äº† spark æ¥å…¥å™¨ï¼Œè®©ç”¨æˆ·æ›´å®¹æ˜“åœ°åˆ©ç”¨ç°æœ‰çš„ PySpark APIã€‚\nSeries.spark.transform å’Œ Series.spark.apply Series.spark accessor æœ‰å˜æ¢å’Œåº”ç”¨å‡½æ•°æ¥å¤„ç†åº•å±‚çš„ Spark Column å¯¹è±¡ã€‚\nä¾‹å¦‚ï¼Œå‡è®¾ä½ æœ‰ä»¥ä¸‹ Koalas DataFrameã€‚\n\u0026gt;\u0026gt;\u0026gt; kdf = ks.DataFrame({\u0026#39;a\u0026#39;: [1, 2, 3, 4]]}) \u0026gt;\u0026gt;\u0026gt; kdf a 0 1 1 2 2 3 3 4 ä½ å¯ä»¥ä½¿ç”¨ astype å‡½æ•°æ¥é“¸é€ ç±»å‹ï¼Œä½†å¦‚æœä½ è¿˜ä¸ä¹ æƒ¯ï¼Œä½ å¯ä»¥ä½¿ç”¨ Series.spark.transform å‡½æ•°æ¥é“¸é€  Spark åˆ—ã€‚\n\u0026gt;\u0026gt;\u0026gt; import numpy as np \u0026gt;\u0026gt;\u0026gt; from pyspark.sql.types import DoubleType \u0026gt;\u0026gt;\u0026gt; \u0026gt;\u0026gt;\u0026gt; kdf[\u0026#39;a_astype_double\u0026#39;] = kdf.a.astype(np.float64) \u0026gt;\u0026gt;\u0026gt; kdf[\u0026#39;a_cast_double\u0026#39;] = kdf.a.spark.transform(lambda scol: scol.cast(DoubleType())) \u0026gt;\u0026gt;\u0026gt; kdf[[\u0026#39;a\u0026#39;, \u0026#39;a_astype_double\u0026#39;, \u0026#39;a_cast_double\u0026#39;]] a a_astype_double a_cast_double 0 1 1.0 1.0 1 2 2.0 2.0 2 3 3.0 3.0 3 4 4.0 4.0 ä¼ é€’ç»™ Series.spark.transform å‡½æ•°çš„ç”¨æˆ·å‡½æ•°å–ç”¨ Spark çš„ Column å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ PySpark å‡½æ•°å¯¹å…¶è¿›è¡Œæ“ä½œã€‚\nä¹Ÿå¯ä»¥åœ¨ transform/apply å‡½æ•°ä¸­ä½¿ç”¨ pyspark.sql.function çš„å‡½æ•°ã€‚\n\u0026gt;\u0026gt;\u0026gt; from pyspark.sql import functions as F \u0026gt;\u0026gt;\u0026gt; \u0026gt;\u0026gt;\u0026gt; kdf[\u0026#39;a_sqrt\u0026#39;] = kdf.a.spark.transform(lambda scol: F.sqrt(scol)) \u0026gt;\u0026gt;\u0026gt; kdf[\u0026#39;a_log\u0026#39;] = kdf.a.spark.transform(lambda scol: F.log(scol)) \u0026gt;\u0026gt;\u0026gt; kdf[[\u0026#39;a\u0026#39;, \u0026#39;a_sqrt\u0026#39;, \u0026#39;a_log\u0026#39;]] a a_sqrt a_log 0 1 1.000000 0.000000 1 2 1.414214 0.693147 2 3 1.732051 1.098612 3 4 2.000000 1.386294 Series.spark.transform çš„ç”¨æˆ·å‡½æ•°åº”è¯¥è¿”å›ä¸å…¶è¾“å…¥ç›¸åŒé•¿åº¦çš„ Spark åˆ—ï¼Œè€Œ Series.spark.apply çš„ç”¨æˆ·å‡½æ•°å¯ä»¥è¿”å›ä¸åŒé•¿åº¦çš„ Spark åˆ—ï¼Œæ¯”å¦‚è°ƒç”¨èšåˆå‡½æ•°ã€‚\n\u0026gt;\u0026gt;\u0026gt; kdf.a.spark.apply(lambda scol: F.collect_list(scol)) 0 [1, 2, 3, 4] Name: a, dtype: object DataFrame.spark.apply åŒæ ·ï¼ŒDataFrame.spark accessor ä¹Ÿæœ‰ä¸€ä¸ª apply å‡½æ•°ã€‚ç”¨æˆ·å‡½æ•°æ¥å—å¹¶è¿”å›ä¸€ä¸ª Spark DataFrameï¼Œå¹¶å¯ä»¥åº”ç”¨ä»»ä½•è½¬æ¢ã€‚å¦‚æœä½ æƒ³åœ¨ Spark DataFrame ä¸­ä¿ç•™ç´¢å¼•åˆ—ï¼Œä½ å¯ä»¥è®¾ç½® index_col å‚æ•°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨æˆ·å‡½æ•°å¿…é¡»åœ¨è¿”å›çš„ Spark DataFrame ä¸­åŒ…å«ä¸€ä¸ªåŒåçš„åˆ—ã€‚\n\u0026gt;\u0026gt;\u0026gt; kdf.spark.apply(lambda sdf: sdf.selectExpr(\u0026#34;index * 10 as index\u0026#34;, \u0026#34;a + 1 as a\u0026#34;), index_col=\u0026#34;index\u0026#34;) a index 0 2 10 3 20 4 30 5 å¦‚æœä½ çœç•¥ index_colï¼Œå®ƒå°†ä½¿ç”¨é»˜è®¤çš„ç´¢å¼•ã€‚\n\u0026gt;\u0026gt;\u0026gt; kdf.spark.apply(lambda sdf: sdf.selectExpr(\u0026#34;a + 1 as a\u0026#34;)) a 17179869184 2 42949672960 3 68719476736 4 94489280512 5 Spark schema ä½ å¯ä»¥é€šè¿‡ DataFrame.spark.schema å’Œ DataFrame.spark.print_schema æŸ¥çœ‹å½“å‰çš„åº•å±‚ Spark æ¨¡å¼ã€‚å¦‚æœä½ æƒ³çŸ¥é“åŒ…æ‹¬ç´¢å¼•åˆ—åœ¨å†…çš„æ¨¡å¼ï¼Œå®ƒä»¬éƒ½éœ€è¦ index_col å‚æ•°ã€‚\n\u0026gt;\u0026gt;\u0026gt; import numpy as np \u0026gt;\u0026gt;\u0026gt; import pandas as pd \u0026gt;\u0026gt;\u0026gt; \u0026gt;\u0026gt;\u0026gt; kdf = ks.DataFrame({\u0026#39;a\u0026#39;: list(\u0026#39;abc\u0026#39;), ... \u0026#39;b\u0026#39;: list(range(1, 4)), ... \u0026#39;c\u0026#39;: np.arange(3, 6).astype(\u0026#39;i1\u0026#39;), ... \u0026#39;d\u0026#39;: np.arange(4.0, 7.0, dtype=\u0026#39;float64\u0026#39;), ... \u0026#39;e\u0026#39;: [True, False, True], ... \u0026#39;f\u0026#39;: pd.date_range(\u0026#39;20130101\u0026#39;, periods=3)}, ... columns=[\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;, \u0026#39;c\u0026#39;, \u0026#39;d\u0026#39;, \u0026#39;e\u0026#39;, \u0026#39;f\u0026#39;]) \u0026gt;\u0026gt;\u0026gt; # Print the schema out in Sparkâ€™s DDL formatted string \u0026gt;\u0026gt;\u0026gt; kdf.spark.schema().simpleString() \u0026#39;struct\u0026lt;a:string,b:bigint,c:tinyint,d:double,e:boolean,f:timestamp\u0026gt;\u0026#39; \u0026gt;\u0026gt;\u0026gt; kdf.spark.schema(index_col=\u0026#39;index\u0026#39;).simpleString() \u0026#39;struct\u0026lt;index:bigint,a:string,b:bigint,c:tinyint,d:double,e:boolean,f:timestamp\u0026gt;\u0026#39; \u0026gt;\u0026gt;\u0026gt; # Print out the schema as same as Sparkâ€™s DataFrame.printSchema() \u0026gt;\u0026gt;\u0026gt; kdf.spark.print_schema() root |-- a: string (nullable = false) |-- b: long (nullable = false) |-- c: byte (nullable = false) |-- d: double (nullable = false) |-- e: boolean (nullable = false) |-- f: timestamp (nullable = false) \u0026gt;\u0026gt;\u0026gt; kdf.spark.print_schema(index_col=\u0026#39;index\u0026#39;) root |-- index: long (nullable = false) |-- a: string (nullable = false) |-- b: long (nullable = false) |-- c: byte (nullable = false) |-- d: double (nullable = false) |-- e: boolean (nullable = false) |-- f: timestamp (nullable = false) è§£é‡Š Spark è®¡åˆ’ å¦‚æœä½ æƒ³çŸ¥é“å½“å‰çš„ Spark è®¡åˆ’ï¼Œä½ å¯ä»¥ä½¿ç”¨ DataFrame.spark.explain()ã€‚\n\u0026gt;\u0026gt;\u0026gt; # Same as Sparkâ€™s DataFrame.explain() \u0026gt;\u0026gt;\u0026gt; kdf.spark.explain() == Physical Plan == Scan ExistingRDD[...] \u0026gt;\u0026gt;\u0026gt; kdf.spark.explain(True) == Parsed Logical Plan == ... == Analyzed Logical Plan == ... == Optimized Logical Plan == ... == Physical Plan == Scan ExistingRDD[...] \u0026gt;\u0026gt;\u0026gt; # New style of mode introduced from Spark 3.0. \u0026gt;\u0026gt;\u0026gt; kdf.spark.explain(mode=\u0026#34;extended\u0026#34;) == Parsed Logical Plan == ... == Analyzed Logical Plan == ... == Optimized Logical Plan == ... == Physical Plan == Scan ExistingRDD[...] ç¼“å­˜ spark è®¿é—®å™¨è¿˜æä¾›äº†ç¼“å­˜ç›¸å…³çš„å‡½æ•°ï¼Œcacheã€persistã€unpersist å’Œ store_level å±æ€§ã€‚ä½ å¯ä»¥ä½¿ç”¨ cache å‡½æ•°ä½œä¸ºä¸Šä¸‹æ–‡ç®¡ç†å™¨æ¥è§£é™¤ç¼“å­˜çš„ persistã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ã€‚\n\u0026gt;\u0026gt;\u0026gt; from pyspark import StorageLevel \u0026gt;\u0026gt;\u0026gt; \u0026gt;\u0026gt;\u0026gt; with kdf.spark.cache() as cached: ... print(cached.spark.storage_level) ... Disk Memory Deserialized 1x Replicated \u0026gt;\u0026gt;\u0026gt; with kdf.spark.persist(StorageLevel.MEMORY_ONLY) as cached: ... print(cached.spark.storage_level) ... Memory Serialized 1x Replicated å½“ä¸Šä¸‹æ–‡å®Œæˆåï¼Œç¼“å­˜ä¼šè‡ªåŠ¨æ¸…é™¤ã€‚å¦‚æœä½ æƒ³ä¿ç•™å®ƒçš„ç¼“å­˜ï¼Œä½ å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æ–¹æ³•æ¥åšã€‚\n\u0026gt;\u0026gt;\u0026gt; cached = kdf.spark.cache() \u0026gt;\u0026gt;\u0026gt; print(cached.spark.storage_level) Disk Memory Deserialized 1x Replicated å½“ä¸å†éœ€è¦å®ƒæ—¶ï¼Œä½ å¿…é¡»æ˜¾å¼è°ƒç”¨ DataFrame.spark.unpersist()æ¥ä»ç¼“å­˜ä¸­åˆ é™¤å®ƒã€‚\n\u0026gt;\u0026gt;\u0026gt; cached.spark.unpersist() æç¤º åœ¨ Koalas ä¸­ï¼Œæœ‰ä¸€äº›ç±»ä¼¼äº join çš„æ“ä½œï¼Œæ¯”å¦‚åˆå¹¶ã€åŠ å…¥å’Œæ›´æ–°ã€‚è™½ç„¶å®é™…çš„ join æ–¹æ³•å–å†³äºåº•å±‚çš„ Spark è®¡åˆ’å™¨ï¼Œä½†ä½ ä»ç„¶å¯ä»¥ç”¨ ks.broadcast()å‡½æ•°æˆ– DataFrame.spark.hint()æ–¹æ³•æŒ‡å®šä¸€ä¸ªæç¤ºã€‚\n\u0026gt;\u0026gt;\u0026gt; kdf1 = ks.DataFrame({\u0026#39;key\u0026#39;: [\u0026#39;foo\u0026#39;, \u0026#39;bar\u0026#39;, \u0026#39;baz\u0026#39;, \u0026#39;foo\u0026#39;], ... \u0026#39;value\u0026#39;: [1, 2, 3, 5]}, ... columns=[\u0026#39;key\u0026#39;, \u0026#39;value\u0026#39;]) \u0026gt;\u0026gt;\u0026gt; kdf2 = ks.DataFrame({\u0026#39;key\u0026#39;: [\u0026#39;foo\u0026#39;, \u0026#39;bar\u0026#39;, \u0026#39;baz\u0026#39;, \u0026#39;foo\u0026#39;], ... \u0026#39;value\u0026#39;: [5, 6, 7, 8]}, ... columns=[\u0026#39;key\u0026#39;, \u0026#39;value\u0026#39;]) \u0026gt;\u0026gt;\u0026gt; kdf1.merge(kdf2, on=\u0026#39;key\u0026#39;).explain() == Physical Plan == ... ... SortMergeJoin ... ... \u0026gt;\u0026gt;\u0026gt; kdf1.merge(ks.broadcast(kdf2), on=\u0026#39;key\u0026#39;).explain() == Physical Plan == ... ... BroadcastHashJoin ... ... \u0026gt;\u0026gt;\u0026gt; kdf1.merge(kdf2.spark.hint(\u0026#39;broadcast\u0026#39;), on=\u0026#39;key\u0026#39;).explain() == Physical Plan == ... ... BroadcastHashJoin ... ... ç‰¹åˆ«æ˜¯ï¼Œå¦‚æœåº•å±‚ Spark æ˜¯ 3.0 æˆ–ä»¥ä¸Šç‰ˆæœ¬ï¼ŒDataFrame.spark.hint()æ›´æœ‰ç”¨ï¼Œå› ä¸º Spark 3.0 ä¸­æä¾›äº†æ›´å¤šçš„æç¤ºã€‚\nç»“æŸè¯­ Koalas DataFrame ä¸ PySpark DataFrame ç›¸ä¼¼ï¼Œå› ä¸º Koalas å†…éƒ¨ä½¿ç”¨ PySpark DataFrameã€‚åœ¨å¤–éƒ¨ï¼ŒKoalas DataFrame çš„å·¥ä½œæ–¹å¼å°±åƒ pandas DataFrame ä¸€æ ·ã€‚\nä¸ºäº†å¡«è¡¥è¿™ä¸ªç©ºç™½ï¼ŒKoalas æœ‰è®¸å¤šåŠŸèƒ½ï¼Œå¯¹äºç†Ÿæ‚‰ PySpark çš„ç”¨æˆ·æ¥è¯´ï¼Œå¯ä»¥è½»æ¾åœ°ä½¿ç”¨ Koalas å’Œ PySpark DataFrameã€‚è™½ç„¶åœ¨è½¬æ¢è¿‡ç¨‹ä¸­éœ€è¦é¢å¤–çš„æ³¨æ„å¤„ç†ç´¢å¼•ï¼Œä½† Koalas ä¸º PySpark ç”¨æˆ·æä¾›äº†ä¸¤ç§ DataFrame ä¹‹é—´çš„ç®€å•è½¬æ¢ï¼Œä¸º PySpark æä¾›äº†è¯»/å†™çš„è¾“å…¥/è¾“å‡º APIï¼Œå¹¶æä¾›äº† spark è®¿é—®å™¨ä»¥æš´éœ² PySpark å‹å¥½çš„åŠŸèƒ½ï¼Œå¦‚ç¼“å­˜å’Œå†…éƒ¨æ¢ç´¢ DataFrameã€‚æ­¤å¤–ï¼Œspark è®¿é—®å™¨è¿˜æä¾›äº†ä¸€ç§è‡ªç„¶çš„æ–¹å¼æ¥ç©å¼„ Koalas ç³»åˆ—å’Œ PySpark åˆ—ã€‚\nPySpark ç”¨æˆ·å¯ä»¥ä» Koalas ä¸­è·ç›Šï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚è¯·åœ¨ Databricks Runtime ä¸­è¯•ç”¨è¿™äº›ç¤ºä¾‹å¹¶äº†è§£æ›´å¤šä¿¡æ¯ã€‚\né˜…è¯»æ›´å¤š è¦äº†è§£æ›´å¤šå…³äº Koalas çš„ä¿¡æ¯ï¼Œè¯·çœ‹ä»¥ä¸‹èµ„æºã€‚\n è¯•è¯•é™„å¸¦çš„ç¬”è®°æœ¬ åœ¨ Apache Spark ä¸Šé˜…è¯»ä¹‹å‰çš„åšå®¢ã€Šä» pandas åˆ° Koalas çš„ 10 åˆ†é’Ÿã€‹ã€‚ Spark+AI å³°ä¼š 2020 æ¼”è®² \u0026ldquo;Koalas: Pandas on Apache Spark\u0026rdquo; Spark+AI å³°ä¼š 2020 æ¼”è®² \u0026ldquo;Koalas: ä» Pandas è½»æ¾è¿‡æ¸¡åˆ° Apache Spark\u0026rdquo;  åŸæ–‡é“¾æ¥: https://databricks.com/blog/2020/08/11/interoperability-between-koalas-and-apache-spark.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-10-04-interoperability-between-koalas-and-apache-spark/","tags":["PySpark","Koalas"],"title":"Koalas å’Œ Apache Spark ä¹‹é—´çš„äº’æ“ä½œæ€§"},{"categories":["rakulang"],"contents":"è´ªå©ª junction çš„å¥‡é—»å¼‚äº‹ è¯´æ˜ Raku çš„ junction æ˜¯å¦‚ä½•è´ªå©ªçš„è®¾è®¡ï¼Œä»¥åŠä¸€ä¸ªå»ºè®®ã€‚\nRaku æœ‰ä¸€ä¸ªæ•´æ´çš„åŠŸèƒ½ï¼Œå«åš Junctionã€‚åœ¨è¿™ç¯‡çŸ­æ–‡ä¸­ï¼Œæˆ‘æƒ³å¼ºè°ƒä¸€ä¸‹ junction ä¸å‡½æ•°äº¤äº’çš„ä¸€ä¸ªç‰¹æ®Šåæœï¼šå®ƒä»¬æ˜¯è´ªå©ªçš„ï¼Œæˆ‘çš„æ„æ€æ˜¯å®ƒä»¬ä¼šæ— æ„ä¸­æŠŠå‡½æ•°çš„å…¶ä»–å‚æ•°å˜æˆ junctionã€‚ä¸ºäº†è¯´æ˜è¿™ç§è¡Œä¸ºï¼Œæˆ‘å°†ä½¿ç”¨ä¸€ä¸ªé—­åŒ…åˆ›å»ºä¸€ä¸ª pair æ•°æ®ç»“æ„ï¼Œå®ƒå¯ä»¥æ¥å—ä¸¤ä¸ªä¸åŒç±»å‹çš„å€¼ã€‚\nenum RGB \u0026lt;R G B\u0026gt;; # Pair Constructor: the arguments of pair() are captured # in a closure that is returned sub pair(\\x, \\y) { sub (\u0026amp;p){ p(x, y) } } æ‰€ä»¥ pair æ¥å—ä¸¤ä¸ªä»»æ„ç±»å‹çš„å‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªä»¥å‡½æ•°ä¸ºå‚æ•°çš„é—­åŒ…ã€‚æˆ‘ä»¬å°†ä½¿ç”¨è¿™ä¸ªå‡½æ•°æ¥è®¿é—®å­˜å‚¨åœ¨ pair ä¸­çš„å€¼ã€‚æˆ‘å°†æŠŠè¿™äº›è®¿é—®(accessor)å‡½æ•°ç§°ä¸º fst å’Œ sndã€‚\n# Accessors to get the values from the closure my sub fst (\u0026amp;p) {p( sub (\\x,\\y){x})} my sub snd (\u0026amp;p) {p( sub (\\x,\\y){y})} åšå®é™…é€‰æ‹©çš„å‡½æ•°æ˜¯ç”± fst å’Œ snd è¿”å›çš„åŒ¿åå­ç¨‹åºï¼Œè¿™çº¯ç²¹æ˜¯ä¸ºäº†è®©æˆ‘å¯ä»¥å°†å®ƒä»¬åº”ç”¨äº pairï¼Œè€Œä¸æ˜¯å¿…é¡»å°†å®ƒä»¬ä½œä¸ºå‚æ•°ä¼ é€’ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ï¼Œä¸€ä¸ª Int å’Œä¸€ä¸ª RGB çš„ pairã€‚\nmy \\p1 = pair 42, R; if ( 42 == fst p1) { say snd p1;\t#=\u0026gt;says \u0026#34;R\u0026#34; } æ‰€ä»¥æˆ‘ä»¬ç”¨ä¸¤ä¸ªå€¼è°ƒç”¨ pair æ¥åˆ›å»ºä¸€ä¸ª pairï¼Œå¹¶ä½¿ç”¨ fst å’Œ snd æ¥è®¿é—® pair ä¸­çš„å€¼ã€‚è¿™æ˜¯ä¸€ä¸ªä¸å¯å˜çš„æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥ä¸å¯èƒ½è¿›è¡Œæ›´æ–°ã€‚\nç°åœ¨è®©æˆ‘ä»¬ä½¿ç”¨ junction ä½œä¸ºå…¶ä¸­ä¸€ä¸ªå‚æ•°ã€‚\n# Example instance with a \u0026#39;one\u0026#39;-type junction my Junction \\p1j = pair (42^43),R; if ( 42 == fst p1j) { say snd p1j; #=\u0026gt;one(R, R) } è¿™é‡Œå‘ç”Ÿçš„æƒ…å†µæ˜¯ï¼ŒåŸå§‹å‚æ•° R å·²ç»ä¸å¯é€†è½¬åœ°å˜æˆäº†ä¸è‡ªå·±çš„ junctionï¼Œå°½ç®¡æˆ‘ä»¬ä»æœªæ˜ç¡®åœ°åœ¨ R ä¸Šåˆ›å»ºè¿‡ junctionï¼Œä½†è¿˜æ˜¯å‘ç”Ÿäº†è¿™ç§æƒ…å†µã€‚è¿™æ˜¯å°† junction ç±»å‹åº”ç”¨äºå‡½æ•°çš„ç»“æœï¼Œå®ƒä¸æ˜¯ä¸€ä¸ª bugï¼Œåªæ˜¯ junction è¡Œä¸ºçš„ä¸€ä¸ªå½±å“ã€‚æ›´è¯¦ç»†çš„è§£é‡Šï¼Œè¯·çœ‹æˆ‘çš„æ–‡ç« \u0026quot;é‡æ„ Raku çš„ Junction\u0026quot;ã€‚\nRaku å…³äº junction çš„æ–‡æ¡£ä¸­è¯´ï¼Œä½ ä¸åº”è¯¥çœŸæ­£å°è¯•ä» junction ä¸­è·å–å€¼ã€‚\n\u0026ldquo;Junction æ˜¯ç”¨æ¥ä½œä¸ºå¸ƒå°”ä¸Šä¸‹æ–‡ä¸­çš„åŒ¹é…å™¨ï¼Œä¸æ”¯æŒ junction çš„è‡ªçœã€‚å¦‚æœä½ è§‰å¾—æœ‰è‡ªçœ junction çš„å†²åŠ¨ï¼Œè¯·ä½¿ç”¨ Set æˆ–ç›¸å…³ç±»å‹ä»£æ›¿ã€‚\u0026rdquo;\nç„¶è€Œï¼Œæœ‰ä¸€ä¸ª FAQ å‹‰å¼ºåœ°å‘Šè¯‰ä½ å¦‚ä½•åšã€‚FAQ å†æ¬¡è­¦å‘Šä¸è¦è¿™æ ·åšã€‚\n\u0026ldquo;å¦‚æœä½ æƒ³ä» junction ä¸­æå–å€¼ï¼ˆç‰¹å¾æ€ï¼‰ï¼Œä½ å¯èƒ½åšé”™äº†ä»€ä¹ˆï¼Œåº”è¯¥ç”¨ Set æ¥ä»£æ›¿ã€‚\u0026rdquo;\nç„¶è€Œï¼Œæ­£å¦‚æˆ‘æ‰€ä¸¾çš„ä¾‹å­æ‰€è¯æ˜çš„é‚£æ ·ï¼Œä» junction ä¸­æ¢å¤å€¼æ˜¯æœ‰æ˜ç¡®çš„ç”¨ä¾‹çš„ã€‚å½“ç„¶ï¼Œä»…ä»…å› ä¸ºå¦ä¸€ä¸ªå€¼æ°å¥½æ˜¯ junctionï¼Œå­˜å‚¨åœ¨ pair ä¸­çš„å…¶ä¸­ä¸€ä¸ªå€¼å°±å˜å¾—ä¸å¯è®¿é—®ï¼Œè¿™ä¸æ˜¯æˆ‘ä»¬çš„æœ¬æ„ã€‚\nå› æ­¤ï¼Œæˆ‘å»ºè®®å¢åŠ ä¸€ä¸ªæŠ˜å (collapse)å‡½æ•°ï¼Œå…è®¸å°†è¿™äº›æ— æ„ä¸­å‡ºç°çš„ junction å€¼æŠ˜å æˆå®ƒä»¬çš„åŸå§‹å€¼ã€‚\nif ( 42 == fst p1j) { say collapse(snd p1j); #=\u0026gt;says \u0026#39;R\u0026#39; } è¯¥å‡½æ•°çš„å®ç°å–è‡ªä¸Šè¿°å¸¸è§é—®é¢˜ï¼Œå¹¶å¢åŠ äº†ä¸€ä¸ªæ£€æŸ¥ï¼Œä»¥ç¡®ä¿ junction ä¸Šçš„æ‰€æœ‰å€¼éƒ½ç›¸åŒã€‚\nsub collapse(Junction \\j) { my @vvs; -\u0026gt; Any \\s {push @vvs, s }.(j); my $v = shift @vvs; my @ts = grep {!($_ ~~ $v)}, @vvs; if (@ts.elems==0) { $v } else { die \u0026#34;Can\u0026#39;t collapse this Junction: elements are not identical: {$v,@vvs}\u0026#34;; } } å¦‚æœèƒ½æŠŠè¿™ä¸ªåŠŸèƒ½ä½œä¸ºä¸€ä¸ª collapse æ–¹æ³•æ·»åŠ åˆ° Junction ç±»ä¸­å°±æ›´å¥½äº†ã€‚\nåŸæ–‡é“¾æ¥: https://gist.github.com/wimvanderbauwhede/85fb4b88ec53a0b8149e6c05740adcf8\n","permalink":"https://ohmyweekly.github.io/notes/2020-10-04-the-strange-case-of-the-greedy-junction/","tags":["Raku","Junction"],"title":"è´ªå©ª Junction çš„å¥‡é—»å¼‚äº‹"},{"categories":["rakulang"],"contents":"é‡æ„ Raku çš„ Junction Raku ä¸­çš„ junction å¾ˆé…·ï¼Œä½†ä¹ä¸€çœ‹å®ƒä»¬å¹¶æ²¡æœ‰éµå¾ªé™æ€ç±»å‹åŒ–çš„è§„åˆ™ã€‚æˆ‘å¯¹å®ƒä»¬çš„å½¢å¼åŒ–ç±»å‹è¯­ä¹‰å¾ˆå¥½å¥‡ï¼Œæ‰€ä»¥æˆ‘ä»åŠŸèƒ½ã€é™æ€ç±»å‹çš„è§’åº¦å¯¹ junction è¿›è¡Œäº†è§£æ„å’Œé‡æ„ã€‚\nRaku ä¸­çš„ Junction Raku æœ‰ä¸€ä¸ªæ•´æ´çš„åŠŸèƒ½å«åš Junctionã€‚Junction æ˜¯ä¸€ä¸ªæ— åºçš„å¤åˆå€¼ã€‚å½“ä½¿ç”¨ junction ä»£æ›¿å€¼æ—¶ï¼Œä¼šå¯¹æ¯ä¸ªç»“ç‚¹(junction)å…ƒç´ è¿›è¡Œæ“ä½œï¼Œç»“æœæ˜¯æ‰€æœ‰è¿™äº›æ“ä½œç¬¦çš„è¿”å›å€¼çš„ç»“ç‚¹(junction)ã€‚å½“åœ¨å¸ƒå°”ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ junction æ—¶ï¼Œç»“ç‚¹(junction)ä¼šæŠ˜å æˆä¸€ä¸ªå€¼ã€‚Junction çš„ç±»å‹å¯ä»¥æ˜¯ all(\u0026amp;)ã€any(|)ã€one(^) æˆ– none (ç©ºç»“ç‚¹)ã€‚\nä¾‹å¦‚:\nmy $j = 11|22; # short for any(11,22) if 33 == $j + 11 { say \u0026#39;yes\u0026#39;; } say so 3 == (1..30).one; #=\u0026gt;True say so (\u0026#34;a\u0026#34; ^ \u0026#34;b\u0026#34; ^ \u0026#34;c\u0026#34;) eq \u0026#34;a\u0026#34;; #= True å‡½æ•° so å¼ºåˆ¶ä½¿ç”¨å¸ƒå°”ä¸Šä¸‹æ–‡ã€‚\nJunction æœ‰ Junction ç±»å‹ï¼Œæˆ‘å¾ˆå¥½å¥‡ Junction çš„ç±»å‹è§„åˆ™ï¼Œå› ä¸ºä¹ä¸€çœ‹æœ‰äº›å¥‡æ€ªã€‚æ¯”æ–¹è¯´æˆ‘ä»¬æœ‰ä¸€ä¸ªå‡½æ•° sq ä» Int åˆ° Intã€‚\nsub sq(Int $x --\u0026gt; Int) { $x*$x } my Int $res = sq(11); # OK say $res; #=\u0026gt;121 ç°åœ¨è®©æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç±»å‹ä¸ºä»»ä½• Int å€¼çš„ Junctionã€‚\nmy Junction $j = 11 | 22; å½“æˆ‘ä»¬å°† sq åº”ç”¨äº $j æ—¶ï¼Œæˆ‘ä»¬æ²¡æœ‰å¾—åˆ°ä¸€ä¸ªç±»å‹é”™è¯¯ï¼Œå³ä½¿å‡½æ•°çš„ç±»å‹æ˜¯ :(Int --\u0026gt; Int)ï¼ŒJunction çš„ç±»å‹æ˜¯ Junctionã€‚ç›¸åï¼Œæˆ‘ä»¬å¾—åˆ°çš„æ˜¯ä¸€ä¸ªç»“æœçš„ Junctionã€‚\nsay sq($j); #=\u0026gt;any(121, 484) å¦‚æœæˆ‘ä»¬åƒä¹‹å‰ä¸€æ ·å°†å…¶èµ‹å€¼ç»™ä¸€ä¸ªç±»å‹ä¸º Int çš„å˜é‡ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªç±»å‹é”™è¯¯ã€‚\nmy Int $rj = sq($j); #=\u0026gt;Type check failed in assignment to $rj; expected Int but got Junction (any(121, 484)) å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œç°åœ¨è¿”å›å€¼çš„ç±»å‹ä¸º Junctionã€‚\nmy Junction $rj = sq(11|22); # OK æ‰€ä»¥ï¼ŒJunction ç±»å‹å¯ä»¥ä»£æ›¿ä»»ä½•å…¶ä»–ç±»å‹ï¼Œä½†è¿™æ ·ä¸€æ¥ï¼Œæ“ä½œä¹Ÿå˜æˆäº† Junctionã€‚\nå¦ä¸€æ–¹é¢ï¼ŒJunction æ˜¯ç”±å…¶ç»„æˆå€¼éšå¼ç±»å‹çš„ï¼Œå°½ç®¡å®ƒä»¬çœ‹èµ·æ¥æ˜¯ä¸é€æ˜çš„ Junction ç±»å‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªç”± Str å€¼ç»„æˆçš„ Junctionï¼Œå¹¶è¯•å›¾å°†è¿™ä¸ª Junction çš„å€¼ä¼ é€’åˆ° sq ä¸­ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªç±»å‹é”™è¯¯ã€‚\nmy $sj = \u0026#39;11\u0026#39; | \u0026#39;22\u0026#39;; say $sj.WHAT; #=\u0026gt;(Junction) my Junction $svj = sq($sj); #= Type check failed in binding to parameter \u0026#39;x\u0026#39;; expected Int but got Str (\u0026#34;11\u0026#34;) Junction ä¸éµå¾ªé™æ€ç±»å‹è§„åˆ™ è™½ç„¶è¿™æ ·åšæ˜¯æœ‰é“ç†çš„(å¦‚æœåŸå§‹å‡½æ•°æœŸæœ›ä½¿ç”¨ Intï¼Œæˆ‘ä»¬ä¸å¸Œæœ›å®ƒä¸ Str ä¸€èµ·å·¥ä½œ)ï¼Œä½†è¿™ç¡®å®è¿èƒŒäº†é™æ€ç±»å‹åŒ–çš„è§„åˆ™ï¼Œå³ä½¿æ˜¯å­ç±»å‹åŒ–ã€‚å¦‚æœä¸€ä¸ªå‚æ•°çš„ç±»å‹æ˜¯ Intï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ç±»å‹å›¾ä¸­ä½äºå®ƒçš„ä»»ä½•ç±»å‹æ¥ä»£æ›¿ã€‚ä½†æ˜¯ Int å’Œ Junction çš„ç®€åŒ–ç±»å‹å›¾å¦‚ä¸‹ã€‚\nInt -\u0026gt; Cool -\u0026gt; Any -\u0026gt; Mu \u0026lt;- Junction  æ‰€ä»¥ Junction æ°¸è¿œä¸æ˜¯ Any ä»¥ä¸‹ä»»ä½•ä¸œè¥¿çš„å­ç±»å‹ã€‚å› æ­¤ï¼Œå°† Junction æ”¾åœ¨ç±»å‹ä¸º Any æˆ–å…¶å­ç±»å‹çš„æ§½ä¸­åº”è¯¥æ˜¯ä¸€ä¸ªç±»å‹é”™è¯¯ã€‚\næ­¤å¤–ï¼Œç”±äº Junction ç±»å‹æ˜¯ä¸é€æ˜çš„ï¼ˆå³å®ƒä¸æ˜¯ä¸€ä¸ªå‚æ•°åŒ–çš„ç±»å‹ï¼‰ï¼Œå®ƒä¸åº”è¯¥æŒæœ‰ä»»ä½•å…³äº Junction å†…éƒ¨å€¼çš„ç±»å‹çš„ä¿¡æ¯ã€‚ç„¶è€Œå®ƒå´å¯¹è¿™äº›ä¸å¯è§ã€ä¸å¯è®¿é—®çš„å€¼è¿›è¡Œäº†ç±»å‹æ£€æŸ¥ã€‚\né‚£ä¹ˆè¿™é‡Œåˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ\nä¸€ä¸ªå·¥ä½œå‡è®¾ ä¸€ä¸ªå·¥ä½œå‡è®¾æ˜¯ï¼ŒJunction ç±»å‹å¹¶ä¸çœŸæ­£å–ä»£ä»»ä½•å…¶ä»–ç±»å‹ï¼šå®ƒåªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œä½¿å®ƒçœ‹èµ·æ¥å¦‚æ­¤ã€‚\né‡æ„ Junction çš„ç¬¬ä¸€éƒ¨åˆ†ï¼šç±»å‹ è®©æˆ‘ä»¬è¯•ç€é‡å»ºè¿™ä¸ªã€‚æˆ‘ä»¬çš„ç›®çš„æ˜¯æƒ³å‡ºä¸€ä¸ªæ•°æ®ç±»å‹å’Œä¸€äº›åŠ¨ä½œï¼Œä»¥å¤åˆ¶è§‚å¯Ÿåˆ°çš„ Raku Junction çš„è¡Œä¸ºã€‚é¦–å…ˆæˆ‘ä»¬è®¨è®ºä¸€ä¸‹ç±»å‹ï¼Œä¸ºäº†æ¸…æ™°èµ·è§ï¼Œä½¿ç”¨ Haskell ç¬¦å·ã€‚ç„¶åæˆ‘ä»‹ç» Raku ä¸­çš„å®ç°ã€‚è¿™ä¸ªå®ç°å°†åƒ Raku çš„åŸç”Ÿ Junction ä¸€æ ·ï¼Œä½†æ²¡æœ‰ç¥å¥‡çš„è¯­æ³•ç³–ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘è¯æ˜äº† Raku çš„ Junction æ¯•ç«Ÿéµå¾ªäº†æ­£ç¡®çš„ç±»å‹è§„åˆ™ã€‚\nJunction ç±»å‹ Junction æ˜¯ä¸€ä¸ªç”± Junction ç±»å‹ JType å’Œä¸€ç»„å€¼ç»„æˆçš„æ•°æ®ç»“æ„ã€‚ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘å°†è¿™ä¸ªå€¼é›†é™åˆ¶ä¸ºå•ä¸€ç±»å‹ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å› ä¸ºæ··åˆç±»å‹çš„ Junction å…¶å®æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚æˆ‘ä½¿ç”¨ä¸€ä¸ªåˆ—è¡¨æ¥æ¨¡æ‹Ÿè¿™ä¸ªé›†åˆï¼ŒåŒæ ·æ˜¯ä¸ºäº†æ–¹ä¾¿ã€‚å› ä¸º Junction å¯ä»¥åŒ…å«ä»»ä½•ç±»å‹çš„å€¼ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªå¤šæ€çš„ä»£æ•°æ•°æ®ç±»å‹ã€‚\ndata JType = JAny | JAll | JOne | JNone data Junction a = Junction JType [a] åº”ç”¨ç»“ç‚¹ å¯¹ä¸€ä¸ª Junction åšä»»ä½•äº‹æƒ…éƒ½æ„å‘³ç€å¯¹å®ƒåº”ç”¨ä¸€ä¸ªå‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥è€ƒè™‘ä¸‰ç§æƒ…å†µï¼Œæˆ‘ä¸ºæ¯ä¸€ç§æƒ…å†µä»‹ç»ä¸€ä¸ªç‰¹åˆ«å®šåˆ¶çš„æ“ä½œç¬¦ã€‚\n å°†é Junction å‡½æ•°åº”ç”¨äº Junction è¡¨è¾¾å¼  (â€¢ï¿®) :: (a -\u0026gt; b) -\u0026gt; Junction a -\u0026gt; Junction b  å°† Junction å‡½æ•°åº”ç”¨äºé Junction è¡¨è¾¾å¼ã€‚  (ï¿®â€¢) :: Junction (b -\u0026gt; c) -\u0026gt; b -\u0026gt; Junction c  å°† Junction å‡½æ•°åº”ç”¨äº Junction è¡¨è¾¾å¼ï¼Œåˆ›å»ºä¸€ä¸ªåµŒå¥— Junctionã€‚  (ï¿®ï¿®) :: Junction (b -\u0026gt; c) -\u0026gt; Junction b -\u0026gt; Junction (Junction c) ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨ Junction a å’Œ a ä¹‹é—´åˆ›å»ºè‡ªå®šä¹‰æ¯”è¾ƒè¿ç®—ç¬¦ã€‚\n-- and similar for /-, \u0026gt;, \u0026lt;, \u0026lt;=,\u0026gt;= (ï¿®==â€¢) :: Junction a -\u0026gt; a -\u0026gt; Bool æŠ˜å  Junction é‚£ä¹ˆæˆ‘ä»¬å°±æœ‰äº† soï¼Œå¸ƒå°”å¼ºåˆ¶å‡½æ•°ã€‚å®ƒçš„ä½œç”¨æ˜¯å°†ä¸€ä¸ªå¸ƒå°”çš„ Junction æŠ˜å æˆä¸€ä¸ªå¸ƒå°”ã€‚\nso :: Junction Bool -\u0026gt; Bool æœ€åæˆ‘ä»¬æœ‰ collapseï¼Œå®ƒä»ä¸€ä¸ª Junction è¿”å›å€¼ï¼Œå‰ææ˜¯å®ƒæ˜¯ä¸€ä¸ª Junctionï¼Œæ‰€æœ‰å­˜å‚¨çš„å€¼éƒ½æ˜¯ä¸€æ ·çš„ã€‚\ncollapse :: (Show a,Eq a) =\u0026gt; Junction a -\u0026gt; a è¿™ä¼¼ä¹æ˜¯ä¸€ä¸ªå¥‡æ€ªçš„å‡½æ•°ï¼Œä½†ç”±äº Junction çš„è¡Œä¸ºï¼Œå®ƒæ˜¯å¿…è¦çš„ã€‚æ­£å¦‚æˆ‘ä»¬å°†çœ‹åˆ°çš„ï¼Œä¸Šè¿°è¯­ä¹‰æ„å‘³ç€ Junction æ˜¯è´ªå©ªçš„ï¼šå¦‚æœä¸€ä¸ªå‡½æ•°çš„ä¸€ä¸ªå‚æ•°æ˜¯ Junctionï¼Œé‚£ä¹ˆæ‰€æœ‰å…¶ä»–å‚æ•°ä¹Ÿä¼šæˆä¸º Junctionï¼Œä½† Junction ä¸­çš„æ‰€æœ‰å€¼éƒ½æ˜¯ç›¸åŒçš„ã€‚æˆ‘å·²ç»åœ¨\u0026quot;è´ªå©ª Junction çš„å¥‡æ€ªæƒ…å†µ\u0026ldquo;ä¸­è®¨è®ºè¿‡è¿™ä¸ªé—®é¢˜ï¼Œä½†æˆ‘ä»¬ç°åœ¨å¯ä»¥å°†è¿™ç§è¡Œä¸ºå½¢å¼åŒ–ã€‚\né‡æ–°å®¡è§†è´ªå©ª Junction çš„å¥‡æ€ªæƒ…å†µ å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªä¸¤ä¸ªå‚æ•°çš„å‡½æ•° f :: a -\u0026gt; b -\u0026gt; cï¼Œæˆ‘ä»¬å¯¹ç¬¬ä¸€ä¸ªå‚æ•°åº”ç”¨ä¸€ä¸ªç»“ç‚¹ j :: Junction a åº”ç”¨åˆ°ç¬¬ä¸€ä¸ªå‚æ•° f â€¢ï¿® j ä¸Šï¼Œé‚£ä¹ˆç»“æœæ˜¯ä¸€ä¸ªéƒ¨åˆ†åº”ç”¨çš„å‡½æ•°ï¼ŒåŒ…è£¹åœ¨ä¸€ä¸ª Junction ä¸Šï¼šfp :: Junction b -\u0026gt; cã€‚å¦‚æœæˆ‘ä»¬ç°åœ¨æƒ³ç”¨ fp ï¿®â€¢ v å°†è¿™ä¸ªå‡½æ•°åº”ç”¨äºä¸€ä¸ªéç»“ç‚¹çš„å€¼ v :: bï¼Œé‚£ä¹ˆç»“æœå°±æ˜¯ Junction c ç±»å‹çš„ã€‚\nç°åœ¨ï¼Œè®©æˆ‘ä»¬è€ƒè™‘ç±»å‹ c æ˜¯ forall d . (a -\u0026gt; b -\u0026gt; d) -\u0026gt; d çš„ç‰¹æ®Šæƒ…å†µã€‚æ‰€ä»¥æˆ‘ä»¬æœ‰ Junction(forall d . (a-\u0026gt;b-\u0026gt;d) -\u0026gt; d)ã€‚è¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‡½æ•°å‚æ•°å¹¶è¿”å›è¯¥å‡½æ•°çš„è¿”å›ç±»å‹çš„ä¸œè¥¿ã€‚æˆ‘ä»¬ä½¿ç”¨ forallï¼Œæ‰€ä»¥ d å¯ä»¥æ˜¯ä»»ä½•ä¸œè¥¿ï¼Œä½†åœ¨å®è·µä¸­æˆ‘ä»¬å¸Œæœ›å®ƒæ˜¯ a æˆ– bã€‚\nå‡è®¾æˆ‘ä»¬å°†è¿™ä¸ªå‡½æ•°(ç§°å®ƒä¸º p)åº”ç”¨äº fst :: a-\u0026gt;b-\u0026gt;aï¼Œä½¿ç”¨ p ï¿®â€¢ fstï¼Œé‚£ä¹ˆæˆ‘ä»¬å¾—åˆ° Junction aã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬å°†å®ƒåº”ç”¨äº snd :: a-\u0026gt;b-\u0026gt;bï¼Œä½¿ç”¨ p ï¿®â€¢ sndï¼Œé‚£ä¹ˆæˆ‘ä»¬å¾—åˆ° Junction bã€‚\nè¿™å°±æ˜¯å½¢å¼ä¸ŠåŸºäºç±»å‹çš„åˆ†æï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸èƒ½ä»ä¸€ä¸ª pair ä¸­è¿”å›ä¸€ä¸ªé Junction çš„å€¼ï¼Œåœ¨\u0026rdquo;è´ªå©ª Junction çš„å¥‡æ€ªæƒ…å†µ\u0026ldquo;ä¸­å·²ç»è§£é‡Šè¿‡ã€‚è€Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬éœ€è¦ collapse å‡½æ•°çš„åŸå› ã€‚\né‡æ„ Junction çš„ç¬¬2éƒ¨åˆ†ï¼šRaku çš„å®ç°ã€‚ æˆ‘ä»¬ä»åˆ›å»º Junction ç±»å‹å¼€å§‹ï¼Œä¸ºå››ç§ Junction ç±»å‹ä½¿ç”¨ä¸€ä¸ªæšä¸¾ï¼Œä¸ºå®é™…çš„ Junction æ•°æ®ç±»å‹ä½¿ç”¨ä¸€ä¸ªè§’è‰²ã€‚\n# The types of Junctions enum JType \u0026lt;JAny JAll JOne JNone \u0026gt;; # The actual Junction type role Junction[\\jt, @vs] { has JType $.junction-type=jt; has @.values=@vs; } æ¥ä¸‹æ¥æ˜¯å››ç§ç±»å‹çš„ Junction çš„æ„é€ å‡½æ•°ï¼ˆä¸‹åˆ’çº¿ï¼Œé¿å…ä¸å†…å»ºå‡½æ•°çš„åç§°å†²çªï¼‰ã€‚\nour sub all_(@vs) { Junction[ JAll, @vs].new; } our sub any_(@vs) { Junction[ JAny, @vs].new; } our sub one_(@vs) { Junction[ JOne, @vs].new; } our sub none_(@vs) { Junction[ JNone, @vs].new; } å°†ä¸€ä¸ªï¼ˆå•å‚æ•°ï¼‰å‡½æ•°åº”ç”¨äº junction å‚æ•°ã€‚\nsub infix:\u0026lt;â—â—‹\u0026gt;( \u0026amp;f, \\j ) is export { my \\jt=j.junction-type; my @vs = j.values; Junction[ jt, map( {\u0026amp;f($_)}, @vs)].new; } è¦å°† Junction å†…çš„å‡½æ•°åº”ç”¨äºé Junction çš„å‚æ•°:\nsub infix:\u0026lt;â—‹â—\u0026gt;( \\jf, \\v ) is export { my \\jt=jf.junction-type; my @fs = jf.values; Junction[ jt, map( {$_( v)}, @fs)].new; } å°†ä¸€ä¸ªå‡½æ•°åº”ç”¨äºä¸¤ä¸ª junction å‚æ•°ï¼Œç›¸å½“äºå°†ä¸€ä¸ª junction å†…çš„å‡½æ•°åº”ç”¨äºä¸€ä¸ª junctionã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå¤æ‚çš„é—®é¢˜ã€‚Raku å¯¹åµŒå¥—æ–½åŠ äº†ä¸€ä¸ªæ’åºï¼Œå³æ‰€æœ‰çš„åµŒå¥—æ€»æ˜¯å¤–åµŒå¥—ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»æ£€æŸ¥ junction çš„ç±»å‹ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œæˆ‘ä»¬å¿…é¡»äº¤æ¢æ˜ å°„ã€‚\nsub infix:\u0026lt;â—‹â—‹\u0026gt;( \\jf, \\jv ) is export { my \\jft= jf.junction-type; my @fs = jf.values; my \\jvt = jv.junction-type; my @vs = jv.values; if (jvt == JAll and jft != JAll) { Junction[ jvt, map( sub (\\v){jf â—‹â— v}, @vs)].new; } else { Junction[ jft, map( sub (\u0026amp;f){ \u0026amp;f â—â—‹ jv}, @fs)].new; } } ä¸ºäº†å®Œæ•´ï¼Œè¿™é‡Œæ˜¯ â—‹==â— çš„å®šä¹‰ã€‚â—‹!=â—ã€â—‹\u0026gt;â— ç­‰çš„å®šä¹‰æ˜¯ç±»ä¼¼çš„ã€‚\nsub infix:\u0026lt;â—‹==â— \u0026gt;( \\j, \\v ) is export { sub (\\x){x==v} â—â—‹ j } æ¥ä¸‹æ¥æˆ‘ä»¬æœ‰ soï¼Œå®ƒæŠŠå¸ƒå°”å€¼çš„ junction å˜æˆäº†å¸ƒå°”å€¼ã€‚\nour sub so (\\jv) { my @vs = jv.values; given jv.junction-type { when JAny { elems(grep {$_}, @vs) \u0026gt;0} when JAll { elems(grep {!$_}, @vs)==0} when JOne { elems(grep {$_}, @vs)==1} when JOne { elems(grep {$_}, @vs)==0} } } æœ€åæˆ‘ä»¬æœ‰ collapseï¼Œæ­£å¦‚è´ªå©ª Junction çš„æ–‡ç« ä¸­æ‰€å®šä¹‰çš„é‚£æ ·ï¼Œ collapse è¿”å› Junction çš„å€¼ï¼Œåªè¦å®ƒä»¬éƒ½æ˜¯ä¸€æ ·çš„ã€‚\nour sub collapse( \\j ) { my \\jt=j.junction-type; my @vvs = j.values; my $v = shift @vvs; my @ts = grep {!($_ ~~ $v)}, @vvs; if (@ts.elems==0) { $v } else { die \u0026#34;Can\u0026#39;t collapse this Junction: elements are not identical: {$v,@vvs}\u0026#34;; } } Junction æ¸…ç† ç°åœ¨æˆ‘ä»¬å†æ¥çœ‹çœ‹æˆ‘ä»¬çš„å·¥ä½œå‡è¯´ï¼Œå°† Raku çš„ Junction ä¸Šçš„åŠ¨ä½œè§£é‡Šä¸ºä¸Šè¿°ç±»å‹å’Œæ“ä½œç¬¦çš„è¯­æ³•ç³–ã€‚\nsub sq(Int $x --\u0026gt; Int) { $x*$x } my Junction $j = 11 | 22; my Junction $rj = sq($j); å»è¯­æ³•å¡˜åè¿™å˜æˆäº†:\nmy Junction $j = any_ [11,22]; my Junction $rj = \u0026amp;sq â—â—‹ $j; ç±»ä¼¼åœ°,\nif ($j == 42) {...} å˜æˆäº†:\nif (so ($j â—‹==â— 42)) {...} å’Œå…¶ä»–å¸ƒå°”ä¸Šä¸‹æ–‡ç±»ä¼¼ã€‚\nå¦‚æœæˆ‘ä»¬ä»”ç»†çœ‹è´ªå©ª Junction æ–‡ç« ä¸­çš„ pair ä¾‹å­ï¼Œé‚£ä¹ˆå°† junction åº”ç”¨åˆ°ä¸€ä¸ªæœ‰å¤šä¸ªå‚æ•°çš„å‡½æ•°ä¸Š:\nmy Junction \\p1j = pair R,(42^43); å»è¯­æ³•å¡˜åå˜ä¸º:\nmy Junction \\p1j = \u0026amp;pair.assuming(R) â—â—‹ one_ [42,43]; æˆ‘ä»¬ä½¿ç”¨ .assuming() æ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦éƒ¨åˆ†åº”ç”¨ã€‚ä¸ç®¡æˆ‘ä»¬æ˜¯å…ˆåº”ç”¨é Junction å‚æ•°è¿˜æ˜¯ Junction å‚æ•°ï¼Œéƒ½æ²¡æœ‰å…³ç³»ã€‚\nmy \\p1jr = ( sub ($y){ \u0026amp;pair.assuming(*,$y) } â—â—‹ one_ [42,43] ) â—‹â— R; æœ€åï¼Œä¸¾ä¸€ä¸ªä¸¤ä¸ªå‚æ•°éƒ½æ˜¯ Junction çš„ä¾‹å­ã€‚ç”±äº â—‹â—‹ çš„å®šä¹‰ï¼Œåº”ç”¨çš„é¡ºåºå¹¶ä¸é‡è¦ã€‚\nsub m(\\x,\\y){x*y} my \\p4 = ( sub (\\x){ \u0026amp;m.assuming(x) } â—â—‹ any_ [11,22] ) â—‹â—‹ all_ [33,44]; my \\p4r = ( sub (\\x){ \u0026amp;m.assuming(*,x) } â—â—‹ all_ [33,44] ) â—‹â—‹ any_ [11,22]; ç»“è®º ä» Raku çš„ junction çš„ç¥å¥‡ç±»å‹è¡Œä¸ºå®é™…ä¸Šæ˜¯è¯­æ³•ç³–çš„å‡è®¾å‡ºå‘ï¼Œæˆ‘ä½¿ç”¨å¤šæ€ä»£æ•°æ•°æ®ç±»å‹é‡æ„äº† junction ç±»å‹å’Œå®ƒçš„åŠ¨ä½œï¼Œå¹¶è¡¨æ˜ Raku çš„è¡Œä¸ºä½œä¸ºè¯­æ³•ç³–çš„è§£é‡Šå¯¹äºæ‰€æå‡ºçš„å®ç°æ˜¯æˆç«‹çš„ã€‚æ¢å¥è¯è¯´ï¼ŒRaku çš„ Junction ç¡®å®éµå¾ªé™æ€ç±»å‹è§„åˆ™ã€‚\nåŸæ–‡é“¾æ¥: https://gist.github.com/wimvanderbauwhede/19cc1e8d04e9a477f58cfe7288a6172e\n","permalink":"https://ohmyweekly.github.io/notes/2020-10-04-reconstructing-raku-junctions/","tags":["Raku","Junction"],"title":"é‡æ„ Raku çš„ Junction"},{"categories":["git"],"contents":"è¿™ç¯‡åšæ–‡æ¶µç›–äº†æˆ‘æœ€å–œæ¬¢çš„ä¸€äº›è®¾ç½®ï¼Œç”¨äºé…ç½® ssh å®¢æˆ·ç«¯çš„è¡Œä¸ºï¼ˆå³åœ¨ ssh_config çš„ man é¡µé¢ä¸­çš„å†…å®¹ï¼‰ã€‚æ— è®ºä½ æ˜¯æƒ³æ·»åŠ ä¸€äº›é¢å¤–çš„å®‰å…¨çº¦æŸï¼Œå‡å°‘å¤±è´¥ï¼Œè¿˜æ˜¯é˜²æ­¢è…•éš§é“ï¼Œssh_config éƒ½æ˜¯ä¸€ä¸ªç»å¸¸æœªè¢«å……åˆ†åˆ©ç”¨çš„å¼ºå¤§å·¥å…·ã€‚\næœ¬æ–‡å°†ä»‹ç»ä¸€äº›ä¿®æ”¹ ssh_config æ–‡ä»¶çš„æœ‰ç”¨æ–¹æ³•ï¼Œä»¥è¾¾åˆ°æ›´é«˜çš„å®‰å…¨å’Œæ§åˆ¶ç¨‹åº¦ã€‚è¿™ç¯‡æ–‡ç« å¹¶ä¸æ˜¯å…³äºé€šè¿‡ sshd_config è¿›è¡ŒæœåŠ¡å™¨ç«¯é…ç½®ï¼Œåè€…å€¼å¾—å•ç‹¬å†™ä¸€ç¯‡æ–‡ç« ã€‚\nä»€ä¹ˆæ˜¯ ssh_config? ä¸€äº›å·¥ç¨‹å¸ˆå¯èƒ½ä¼šæƒŠè®¶äº ssh å®¢æˆ·ç«¯è¡Œä¸ºæœ‰å¤šå°‘æ˜¯å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æ¥é…ç½®çš„ã€‚å¦‚æœæ²¡æœ‰é…ç½®æ–‡ä»¶ï¼Œä¸º ssh æŒ‡å®šå‘½ä»¤è¡Œå‚æ•°å¾ˆå¿«å°±ä¼šå˜å¾—å¾ˆéº»çƒ¦ã€‚\nssh -i /users/virag/keys/us-west/ed25519 -p 1024 -l virag \\ myserver.aws-west.example.com è¿™å¥è¯å¤ªé•¿äº†ï¼Œä¸€æ¬¡éƒ½æ‰“ä¸å®Œï¼Œæ›´ä¸ç”¨è¯´ä¸€å¤©æ‰“å¤šæ¬¡äº†ã€‚å¦‚æœä½ è¦ç®¡ç†å¤šå°æœåŠ¡å™¨å’Œè™šæ‹Ÿæœºï¼Œåˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„ ~/.ssh/ssh_config æ˜¯ä¿®å‰ªå¸¸ç”¨ ssh å‘½ä»¤çš„å¥½æ–¹æ³•ã€‚\næˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–è¾‘ ssh_configï¼Œå°†ä¸Šé¢çš„ä¾‹å­ç¼©çŸ­ä¸º ssh myserverã€‚\nHost myserver Hostname myserver.aws-west.example.com User virag Port 1024 IdentityFile /users/virag/keys/us-west/ed25519 ä¼˜é›…è€Œç®€å•ã€‚ç°åœ¨æˆ‘ä»¬æœ‰äº†åŸºç¡€çŸ¥è¯†ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹è¿™é‡Œåˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆã€‚æˆ‘é€‰æ‹©çš„ ed25519 åœ¨æ¯”è¾ƒ SSH å¯†é’¥-RSAã€DSAã€ECDSA æˆ– EdDSA?\nssh_config å¦‚ä½•å·¥ä½œ ssh å®¢æˆ·ç«¯ä»ä¸‰ä¸ªåœ°æ–¹è¯»å–é…ç½®ï¼Œé¡ºåºå¦‚ä¸‹:\n ç³»ç»ŸèŒƒå›´å†…çš„ /etc/ssh/ssh_config åœ¨ ~/.ssh/ssh_config ä¸­çš„ç”¨æˆ·ç‰¹å®šé…ç½®ã€‚ ç›´æ¥æä¾›ç»™ ssh çš„å‘½ä»¤è¡Œæ ‡å¿—  è¿™æ„å‘³ç€å‘½ä»¤è¡Œæ ‡å¿—(#1)å¯ä»¥è¦†ç›–ç”¨æˆ·ç‰¹å®šçš„é…ç½®(#2)ï¼Œå¯ä»¥è¦†ç›–å…¨å±€é…ç½®(#3)\nå½“è¿æ¥å‚æ•°è¢«é‡å¤ä½¿ç”¨æ—¶ï¼Œé€šå¸¸åœ¨ ssh_config ä¸­å®šä¹‰è¿™äº›å‚æ•°æ¯”è¾ƒå®¹æ˜“ï¼Œå®ƒä»¬ä¼šåœ¨è¿æ¥æ—¶è‡ªåŠ¨åº”ç”¨ã€‚è™½ç„¶å®ƒä»¬é€šå¸¸æ˜¯åœ¨ç”¨æˆ·ç¬¬ä¸€æ¬¡è¿è¡Œ ssh æ—¶åˆ›å»ºçš„ï¼Œä½†ç›®å½•å’Œæ–‡ä»¶å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ‰‹åŠ¨åˆ›å»ºã€‚\ntouch ~/.ssh/ssh_config å›åˆ°ä¸Šé¢çš„ä¾‹å­ï¼Œä½ å¯èƒ½ä¼šæ³¨æ„åˆ° ssh_config æ˜¯ä»¥ä¸»æœºå¤´å¼€å§‹çš„æ®µè½æ¥ç»„ç»‡çš„ã€‚\nHost [alias] Option1 [Value] Option2 [Value] Option3 [Value] è™½ç„¶æŠ€æœ¯ä¸Šæ²¡æœ‰å¿…è¦ï¼Œä½†è¿™ç§ç¼©è¿›çš„æ ¼å¼å¾ˆå®¹æ˜“è¢«äººç±»é˜…è¯»ã€‚ç„¶è€Œï¼Œssh å®¢æˆ·ç«¯å¹¶ä¸å…³å¿ƒè¿™ç§æ ¼å¼åŒ–ï¼Œç›¸åï¼Œå®ƒå°†é€šè¿‡å°†å‘½ä»¤è¡Œä¸­è¾“å…¥çš„ ssh å‚æ•°ä¸æ‰€æœ‰ä¸»æœºå¤´åŒ¹é…æ¥è·å–é…ç½®å‚æ•°ã€‚é€šé…ç¬¦ä¹Ÿå¯ä»¥ä½œä¸ºä¸»æœºå¤´çš„ä¸€éƒ¨åˆ†ã€‚è€ƒè™‘ä¸€ä¸‹:\nHost myserver2 Hostname myserver2.aws-west.example.com Host myserver* Hostname myserver1.aws-west.example.com User virag Port 1024 ä½¿ç”¨ myserver1 çš„åˆ«åï¼Œæˆ‘ä»¬å¯ä»¥ä»ç¬¬äºŒèŠ‚ä¸­å¾—åˆ°æˆ‘ä»¬æ‰€æœŸæœ›çš„ä¸œè¥¿ã€‚\nHostname myserver1.aws-west.example.com User virag Port 1024 ä½† myserver2 ä¹Ÿæœ‰ç±»ä¼¼çš„é€‰é¡¹åˆ—è¡¨ã€‚\nHostname myserver2.aws-west.example.com User virag Port 1024 ssh å®¢æˆ·ç«¯é€šè¿‡æ¨¡å¼åŒ¹é…è·å–è¿™äº›ä¿¡æ¯ï¼Œå¹¶åœ¨å‘ä¸‹é¡ºåºè¯»å–æ–‡ä»¶æ—¶é”å®šå€¼ã€‚å› ä¸º myserver2 åŒæ—¶åŒ¹é…äº† myserver2 å’Œ myserver*ï¼Œæ‰€ä»¥å®ƒä¼šå…ˆä» myserver2 ä¸­è·å– Hostname å€¼ã€‚ç„¶åï¼Œå½“åˆ°äº†ç¬¬äºŒç§æ¨¡å¼åŒ¹é…æ—¶ï¼Œå°±ä¼šä½¿ç”¨ User å’Œ Port çš„å€¼ï¼Œä½† Hostname å­—æ®µå·²ç»è¢«å¡«æ»¡ã€‚è®©æˆ‘å†é‡å¤ä¸€éï¼Œssh æ¥å—æ¯ä¸ªé€‰é¡¹çš„ç¬¬ä¸€ä¸ªå€¼ã€‚\nå¸¸è§çš„ SSH é…ç½®é€‰é¡¹ åœ¨ man 5 ssh_config ä¸­ï¼Œæœ‰è¿‘ 100 ä¸ª ssh_config é€‰é¡¹ã€‚æˆ‘æ•´ç†äº†ä¸€ä»½æˆ‘ä¸ªäººä½¿ç”¨çš„æ¸…å•ï¼Œå…¶ä¸­è®¸å¤šé€‰é¡¹å°†åœ¨åé¢çš„æ–‡ç« ä¸­ä½¿ç”¨ã€‚\n  Port - è¿œç¨‹ ssh å®ˆæŠ¤è¿›ç¨‹è¿è¡Œçš„ç«¯å£ã€‚å¦‚æœå®ˆæŠ¤è¿›ç¨‹è¿è¡Œåœ¨é»˜è®¤çš„ 22 å·ç«¯å£ä¸Šï¼Œåˆ™ä¸éœ€è¦å®šä¹‰è¿™ä¸ªé€‰é¡¹ã€‚åœ¨ä¸åŒçš„ç«¯å£ä¸Šè¿è¡Œ ssh å®ˆæŠ¤è¿›ç¨‹è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åšæ³•ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥å‡å°‘åƒµå°¸æ¢æµ‹çš„æ•°é‡ã€‚\n  Hostname - ç”¨äºå»ºç«‹è¿æ¥çš„çœŸå®ä¸»æœºåï¼Œå¦‚ DNS æˆ– IP åœ°å€ã€‚è¿™å¯¹ç¼©çŸ­ä¸»æœºåå¾ˆæœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥è®©ä¸€ä¸ªæ–¹ä¾¿çš„ ssh mongo å¸¦ä½ åˆ° mongo-12.staging.example.comã€‚\n  ProxyJump - è¿™ä¸ªé€‰é¡¹å°†é€šè¿‡è¿æ¥çš„æœåŠ¡å™¨è¿›è¡Œéš§é“ç®€åŒ–ä¸ºä¸€ä¸ªæ ‡å¿—ï¼Œ-Jï¼Œç”¨ä¸€ä¸ªåˆ«åæ¥å‘½åä¸­é—´ä¸»æœºï¼ˆæœ¬åœ°å®¢æˆ·ç«¯å’Œæœ€ç»ˆç›®çš„åœ°ä¹‹é—´çš„ä¸»æœºï¼‰ã€‚è¿™åªé€‚ç”¨äºè¾ƒæ–°çš„å®¢æˆ·ç«¯ï¼ˆOpenSSH 7.3+ï¼‰ã€‚ä¸‹é¢æˆ‘å°†è¯¦ç»†ä»‹ç»è¿™ä¸ªã€‚\n  ForwardAgent \u0026amp; AddKeysToAgent - åœ¨ä¸»æœºä¹‹é—´è·³è½¬ï¼ˆå½“ä½ åœ¨å¦ä¸€ä¸ª ssh ä¼šè¯ä¸­å†æ¬¡é”®å…¥ ssh æ—¶ï¼‰éœ€è¦é‡å¤éªŒè¯ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œssh å‡­è¯å¿…é¡»å­˜å‚¨åœ¨ä¸­é—´æœåŠ¡å™¨ä¸Šï¼Œä½†è¿™ä¸æ˜¯ä¸€ä¸ªå®‰å…¨çš„åšæ³•ã€‚è¿™ä¸¤ä¸ªé€‰é¡¹å…è®¸å¦ä¸€ä¸ªé€šå¸¸è¢«ç§°ä¸º ssh-agent çš„è¿›ç¨‹è‡ªåŠ¨å°†ä½ çš„æœ¬åœ° ssh å‡­è¯åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶é€šè¿‡ä¸€ä¸ªå®‰å…¨è½¬å‘çš„ UNIX å¥—æ¥å­—å°†å…¶æä¾›ç»™ä¸­é—´æœºå™¨çš„ ssh å®¢æˆ·ç«¯ã€‚ForwardAgent å¯ä»¥å®ç°è¿™ç§è½¬å‘è¡Œä¸ºï¼Œè€Œ AddKeysToAgent åˆ™å¯ä»¥è‡ªåŠ¨å°†å¯†é’¥åŠ è½½åˆ°å†…å­˜ä¸­ã€‚æˆ‘å°†åœ¨ä¸‹é¢æä¾›æ›´å¤šç»†èŠ‚ã€‚\n  IdentityFile - è¿™ä¸ªé€‰é¡¹æŒ‡å®šäº† ssh å®¢æˆ·ç«¯åº”è¯¥å°è¯•éªŒè¯çš„å¯†é’¥çš„è·¯å¾„ã€‚è¿™å¹¶ä¸å¦¨ç¢ ssh å®¢æˆ·ç«¯å°è¯• ~/.ssh æˆ– ssh-agent ä¸­çš„å¯†é’¥ã€‚å¸¸ç”¨äºç”±äºæŸç§åŸå› ï¼Œå¯†é’¥æ²¡æœ‰å­˜å‚¨åœ¨é»˜è®¤ä½ç½®çš„æƒ…å†µä¸‹ã€‚\n  IdentitiesOnly - é€šå¸¸å’Œ IdentityFile ä¸€èµ·ä½¿ç”¨ï¼Œè¿™ä¸ªé€‰é¡¹ä¼šå‘Šè¯‰ ssh å®¢æˆ·ç«¯åˆ°åº•è¦æäº¤å“ªä¸ªå¯†é’¥ï¼Œå¹¶æ”¾å¼ƒ ~/.ssh æˆ– ssh-agent ä¸­çš„ä»»ä½•å¯†é’¥ã€‚å› ä¸ºå¦‚æœå°è¯•äº†å¤ªå¤šæ— æ•ˆçš„å¯†é’¥ï¼Œssh ä¼šæŠ›å‡ºä¸€ä¸ªè®¤è¯é”™è¯¯ï¼Œè¿™ä¸ªé€‰é¡¹å¯ä»¥å¸®åŠ©å®¢æˆ·ç«¯ç²¾ç¡®åœ°è¯†åˆ«è¦æäº¤çš„å¯†é’¥ã€‚å³ä½¿åœ¨ ssh_config ä¸­å¯ç”¨äº† IdentitiesOnlyï¼Œä»»ä½•åœ¨å‘½ä»¤è¡Œè¾“å…¥çš„èº«ä»½ä¿¡æ¯ä¹Ÿä¼šè¢«å°è¯•ã€‚\n  CertificateFile - è€ƒè™‘åˆ°å¯†é’¥åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šå·²ç»è¿‡æ—¶äº†ï¼Œè¿™ä¸ªé€‰é¡¹å¯ä»¥å’Œ IdentityFile ä¸€èµ·ä½¿ç”¨æ¥æŒ‡å®šè¦æäº¤çš„è¯ä¹¦ã€‚è¿™å¹¶ä¸æ€»æ˜¯å¿…è¦çš„ã€‚å½“è¯ä¹¦é¢å‘æœºæ„ç­¾ç½²ä¸€ä¸ªå¯†é’¥æ¥åˆ›å»ºè¯ä¹¦æ—¶ï¼Œ-cert.pub å°†è‡ªåŠ¨é™„åŠ åˆ°å¯†é’¥çš„æ–‡ä»¶åä¸­ã€‚åœ¨åŠ è½½å¯†é’¥ä¹‹å‰ï¼Œssh å®¢æˆ·ç«¯å°†é¦–å…ˆå°è¯•ä½¿ç”¨é¢„æœŸçš„å‘½åæƒ¯ä¾‹ä»æä¾›çš„æ–‡ä»¶åä¸­åŠ è½½è¯ä¹¦ã€‚ç„¶è€Œï¼Œå¦‚æœå¯†é’¥å’Œè¯ä¹¦æ–‡ä»¶åä¸éµå¾ªè¿™ç§æ¨¡å¼ï¼Œé‚£ä¹ˆå¿…é¡»ä½¿ç”¨ CertificateFileï¼Œå¦åˆ™å°†æ— æ³•æ‰¾åˆ°è¯ä¹¦ã€‚é˜…è¯»æ›´å¤šå…³äºä¸ºä»€ä¹ˆä½ åº”è¯¥ä½¿ç”¨è¯ä¹¦ã€‚\n  SetEnv \u0026amp; SendEnv - è¿™äº›é€‰é¡¹å…è®¸ ssh å®¢æˆ·ç«¯å‘æŒ‡å®šçš„ä¸»æœºå‘é€æœ¬åœ°ç¯å¢ƒå˜é‡ã€‚ä¸»æœºæœåŠ¡å™¨å¿…é¡»é€šè¿‡åœ¨ /etc/ssh/sshd_config ä¸­å°† AcceptEnv è®¾ç½®ä¸º Yes æ¥æ¥å—è¿™äº›ç¯å¢ƒå˜é‡ã€‚\n  ServerAliveInterval \u0026amp; ServerAliveCountMax -å¦‚æœ ssh å®¢æˆ·ç«¯åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…æ²¡æœ‰æ”¶åˆ°ä»»ä½•æ•°æ®ï¼Œå®ƒå°†è¯·æ±‚ä¸»æœºæœåŠ¡å™¨åšå‡ºå“åº”ã€‚è¿™å¯ä»¥é˜²æ­¢è´Ÿè½½å‡è¡¡å™¨å’ŒæœåŠ¡å™¨å› ä¸æ´»åŠ¨è€Œæ”¾å¼ƒè¿æ¥ã€‚\n  HostKeyAlias - ssh å®¢æˆ·ç«¯ä¼šè¢«æŒ‡ç¤ºä½¿ç”¨ ~/.ssh/known_hosts ä¸­çš„å¯†é’¥åˆ«åï¼Œè€Œä¸æ˜¯ HostNameã€‚è¿™å¯¹äºå…·æœ‰åŠ¨æ€å˜åŒ–çš„ IP åœ°å€çš„ä¸»æœºæˆ–åœ¨ä¸€å°ä¸»æœºä¸Šè¿è¡Œçš„å¤šä¸ªæœåŠ¡å™¨æ¥è¯´éå¸¸æœ‰ç”¨ã€‚\n  PreferredAuthentication - è¿™ä¸ªé€‰é¡¹å†³å®šäº†éªŒè¯æ–¹æ³•çš„å°è¯•é¡ºåºã€‚é»˜è®¤å€¼æ˜¯ gssapi-with-mic, hostbased, publickey, keyboard-interactive å’Œ passwordã€‚\n  ç»„ç»‡ä½ çš„ SSH é…ç½® åœ¨å‰é¢ä¸¤èŠ‚æ‰€å­¦å†…å®¹çš„åŸºç¡€ä¸Šè¿›è¡Œæ‰©å±•ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å½“æˆ‘ä»¬æ‹¥æœ‰ä¸€æ”¯è§„æ¨¡ä¸å¤§çš„èˆ°é˜Ÿæ—¶ï¼Œå¦‚ä½•ç»„ç»‡ ssh_configã€‚ä»¥ä¸‹é¢çš„åœºæ™¯ä¸ºä¾‹ã€‚\n Virag åœ¨å…­ä¸ªç¯å¢ƒä¸‹å·¥ä½œï¼š ä¸œå²¸å’Œè¥¿å²¸ AWS åŒºåŸŸçš„ Devã€Test å’Œ Prodã€‚ Virag æœ‰æ™®é€šç”¨æˆ·è®¿é—®å¼€å‘å’Œäº§å“ç¯å¢ƒçš„æƒé™ï¼Œä½†åœ¨æµ‹è¯•ç¯å¢ƒä¸­æ˜¯ root ç”¨æˆ·ã€‚ Prod ç¯å¢ƒæœ‰æ›´ä¸¥æ ¼çš„å®‰å…¨æ§åˆ¶  æˆ‘æ²¡æœ‰è®°ä½å‡ ä¸ª ssh å‘½ä»¤ç»„åˆï¼Œè€Œæ˜¯ç¼–è¾‘äº†æˆ‘çš„æœ¬åœ°é…ç½®æ–‡ä»¶ã€‚\nHost east-prod HostName east-prod.prod.example.com Host *-prod HostName west-prod.prod.example.com User virag PasswordAuthentication no PubKeyAuthentication yes IdentityFile /users/virag/keys/production/ed25519 Host east-test HostName east-test.test.example.com Host *-test HostName west-test.test.example.com User root Host east-dev HostName east-dev.east.example.com Host *-dev HostName west-dev.west.example.com User virag Host * !prod PreferredAuthentications publickey Host * HostName bastion.example.com User Default ServerAliveInternal 120 ServerAliveCountMax 5 å¦‚æœæˆ‘ä»¬è¿è¡Œ ssh east-testï¼Œæˆ‘ä»¬çš„å…¨éƒ¨é€‰é¡¹åˆ—è¡¨å°†æ˜¯ï¼š\nHostName east-test.test.example.com User root PreferredAuthentications publickey ServerAliveInternal 30 ServerAliveCountMax 5 å®¢æˆ·ç«¯é€šè¿‡ä¸ east-testã€*-testã€* !prod å’Œ * åŒ¹é…æ¥è·å–é¢„æœŸçš„é€‰é¡¹å€¼ã€‚ä½ å¯èƒ½ä¼šæ³¨æ„åˆ° Host * stanza å°†é€‚ç”¨äºä»»ä½• ssh å‚æ•°ã€‚æ¢å¥è¯è¯´ï¼ŒHost * å®šä¹‰äº†æ‰€æœ‰ç”¨æˆ·çš„å…¨å±€è®¾ç½®ã€‚è¿™å¯¹äºåº”ç”¨å®¢æˆ·ç«¯å¯ç”¨çš„å®‰å…¨æ§åˆ¶ç‰¹åˆ«æœ‰ç”¨ã€‚ä¸Šé¢ï¼Œæˆ‘ä»¬åªç”¨äº†ä¸¤ä¸ªï¼Œä½†æœ‰å‡ ä¸ªå…³é”®å­—ä¼šåŠ å¼ºå®‰å…¨ï¼Œå¦‚ CheckHostIPï¼ŒHashKnownHostsï¼ŒStrictHostKeyCheckingï¼Œä»¥åŠæ›´å¤šéšè—çš„å®çŸ³ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ã€‚å› ä¸º ssh å®¢æˆ·ç«¯æ˜¯æŒ‰é¡ºåºè§£é‡Šé€‰é¡¹çš„, é€šç”¨é…ç½®åº”è¯¥æ”¾åœ¨æ–‡ä»¶çš„åº•éƒ¨ã€‚å¦‚æœæ”¾åœ¨æœ€ä¸Šé¢ï¼Œåœ¨å®¢æˆ·ç«¯è¯»å–ä¸‹é¢çš„ç‰¹å®šä¸»æœºé€‰é¡¹ä¹‹å‰ï¼Œé€‰é¡¹å€¼å°±ä¼šè¢«å›ºå®šä¸‹æ¥ã€‚åœ¨ä¸Šé¢çš„æ¡ˆä¾‹ä¸­ï¼ŒæŠŠ Host * æ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ä¼šå¯¼è‡´ç”¨æˆ·ä¸º Defaultã€‚\nå¦‚æœå‡ºç°ä¸€æ¬¡æ€§çš„æƒ…å†µï¼Œä¸€å®šè¦è®°ä½ï¼Œåœ¨å‘½ä»¤è¡Œè¾“å…¥çš„é€‰é¡¹ä¼šè¦†ç›– ssh_config ä¸­çš„é€‰é¡¹ï¼šssh -o \u0026quot;User=root\u0026quot; devã€‚\nä½¿ç”¨ SSH ä»£ç† ssh è·³è½¬æœåŠ¡å™¨æ˜¯ç«™åœ¨å®¢æˆ·ç«¯å’Œå…¶ä½™ ssh é˜Ÿä¼ä¹‹é—´çš„ä»£ç†ã€‚è·³è·ƒä¸»æœºé€šè¿‡å¼ºåˆ¶æ‰€æœ‰çš„ ssh æµé‡é€šè¿‡ä¸€ä¸ªå•ä¸€çš„åŠ å›ºçš„ä½ç½®ï¼Œå¹¶æœ€å¤§é™åº¦åœ°å‡å°‘ä¸ªåˆ«èŠ‚ç‚¹çš„ ssh ç«¯ç‚¹åˆ°å¤–éƒ¨ä¸–ç•Œï¼Œä»è€Œå°†å¨èƒé™åˆ°æœ€ä½ã€‚\né…ç½®å¤šè·³è®¾ç½®çš„ä¸€ç§æ–¹æ³•æ˜¯åœ¨æˆ‘ä»¬çš„è·³è½¬æœåŠ¡å™¨ä¸Šå­˜å‚¨ç›®æ ‡æœåŠ¡å™¨çš„ç§é’¥ã€‚ä¸è¦è¿™æ ·åšã€‚è·³è·ƒæœåŠ¡å™¨é€šå¸¸æ˜¯ä¸€ä¸ªå¤šç”¨æˆ·ç¯å¢ƒï¼Œè¿™æ„å‘³ç€ä»»ä½•æ‹¥æœ‰é«˜æƒé™çš„å•æ–¹éƒ½å¯ä»¥ç ´åä»»ä½•ç§é’¥ã€‚è§£å†³è¿™ç§å®‰å…¨å¨èƒçš„æ–¹æ³•æ˜¯å¯ç”¨ä»£ç†è½¬å‘ï¼Œæˆ‘ä»¬åœ¨ AddKeysToAgent å’Œ ForwardAgent ä¸­ç®€å•åœ°æåˆ°äº†è¿™ä¸ªæ–¹æ³•ã€‚é‰´äºè¿™ç§æ–¹æ³•æ˜¯å¤šä¹ˆå¸¸è§ï¼Œå½“æˆ‘å»ºè®®ä¹Ÿä¸è¦è¿™æ ·åšæ—¶ï¼Œä½ å¯èƒ½ä¼šæ„Ÿåˆ°æƒŠè®¶ã€‚ä¸ºäº†äº†è§£åŸå› ï¼Œæˆ‘ä»¬æ¥æ·±å…¥äº†è§£ä¸€ä¸‹ã€‚\nä»£ç†è½¬å‘æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ ssh-agent æ˜¯ä¸€ä¸ªç‹¬ç«‹äº SSH çš„å¯†é’¥ç®¡ç†å™¨ã€‚å®ƒåœ¨å†…å­˜ä¸­ä¿å­˜ç”¨äºéªŒè¯çš„ç§é’¥å’Œè¯ä¹¦ã€‚å®ƒä¸å‘ç£ç›˜å†™å…¥æˆ–å¯¼å‡ºå¯†é’¥ã€‚ç›¸åï¼Œä»£ç†çš„è½¬å‘åŠŸèƒ½å…è®¸æˆ‘ä»¬çš„æœ¬åœ°ä»£ç†é€šè¿‡ç°æœ‰çš„ ssh è¿æ¥åˆ°è¾¾ï¼Œå¹¶é€šè¿‡ç¯å¢ƒå˜é‡åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šè¿›è¡Œè®¤è¯ã€‚åŸºæœ¬ä¸Šï¼Œå½“å®¢æˆ·ç«¯ ssh æ¥æ”¶åˆ°å¯†é’¥æŒ‘æˆ˜æ—¶ï¼Œä»£ç†ä¼šå°†è¿™äº›æŒ‘æˆ˜ä¸Šæ¸¸è½¬å‘åˆ°æˆ‘ä»¬æœ¬åœ°çš„æœºå™¨ä¸Šï¼Œé€šè¿‡æœ¬åœ°å­˜å‚¨çš„ç§é’¥æ„é€ æŒ‘æˆ˜å“åº”ï¼Œå¹¶è½¬å‘å›ä¸‹æ¸¸çš„ç›®çš„æœåŠ¡å™¨è¿›è¡Œè®¤è¯ã€‚æˆ‘ä¸ªäººåœ¨ç ”ç©¶çš„æ—¶å€™è§‰å¾—è¿™ç§ç›´è§‚çš„è§£é‡Šå¾ˆæœ‰å¸®åŠ©ã€‚\nåœ¨å¹•åï¼Œssh-agent ç»‘å®šåˆ°ä¸€ä¸ª unix-domain çš„ socket ä¸Šä¸å…¶ä»–ç¨‹åºé€šä¿¡ï¼ˆ$SSH_AUTH_SOCK ç¯å¢ƒå˜é‡ï¼‰ã€‚é—®é¢˜æ˜¯ï¼Œä»»ä½•åœ¨é“¾ä¸Šä»»ä½•åœ°æ–¹æ‹¥æœ‰ root æƒé™çš„äººéƒ½å¯ä»¥ä½¿ç”¨åˆ›å»ºçš„ socket æ¥åŠ«æŒæˆ‘ä»¬æœ¬åœ°çš„ ssh-agentã€‚å°½ç®¡å¥—æ¥å­—æ–‡ä»¶å—åˆ°æ“ä½œç³»ç»Ÿå¾ˆå¥½çš„ä¿æŠ¤ï¼Œä½†ä¸€ä¸ª root ç”¨æˆ·å¯ä»¥å†’å……å…¶ä»–ç”¨æˆ·ï¼Œå°† ssh å®¢æˆ·ç«¯æŒ‡å‘è‡ªå·±çš„æ¶æ„ä»£ç†ã€‚ä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œä½¿ç”¨ä»£ç†è½¬å‘å°±ç­‰äºåœ¨æ•´ä¸ªé“¾æ¡ä¸Šä¸ä»»ä½•ä¸€å°æœºå™¨ä¸Šçš„ root ç”¨æˆ·å…±äº«ç§é’¥ã€‚(æ·±å…¥é˜…è¯»ä½¿ç”¨ ssh-agent çš„é™·é˜±)\näº‹å®ä¸Šï¼Œå…³äº ForwardAgent çš„ man é¡µé¢ä¸Šå†™ç€ã€‚\n \u0026ldquo;ä»£ç†è½¬å‘åº”è°¨æ…å¯ç”¨ã€‚æœ‰èƒ½åŠ›ç»•è¿‡è¿œç¨‹ä¸»æœºï¼ˆå¯¹ä»£ç†çš„ Unix-domain å¥—æ¥å­—ï¼‰ä¸Šçš„æ–‡ä»¶æƒé™çš„ç”¨æˆ·å¯ä»¥é€šè¿‡è½¬å‘è¿æ¥è®¿é—®æœ¬åœ°ä»£ç†ã€‚æ”»å‡»è€…æ— æ³•ä»ä»£ç†ä¸­è·å–å¯†é’¥ææ–™ï¼Œç„¶è€Œä»–ä»¬å¯ä»¥å¯¹å¯†é’¥è¿›è¡Œæ“ä½œï¼Œä½¿ä»–ä»¬èƒ½å¤Ÿä½¿ç”¨åŠ è½½åˆ°ä»£ç†ä¸­çš„èº«ä»½è¿›è¡ŒéªŒè¯ã€‚\u0026rdquo;\n ä½¿ç”¨ ProxyJump ä»£æ›¿ ä¸ºäº†åœ¨è·³è½¬æœåŠ¡å™¨ä¸­å¯¼èˆªï¼Œæˆ‘ä»¬å…¶å®å¹¶ä¸éœ€è¦ä»£ç†è½¬å‘ã€‚ç°ä»£çš„æ–¹æ³•æ˜¯ä½¿ç”¨ ProxyJump æˆ–å…¶å‘½ä»¤è¡Œç­‰ä»·ç‰© -Jã€‚\nHost myserver HostName myserver.example.com User virag IdentityFile /users/virag/keys/ed25519 ProxyJump jump Host jump HostName jump.example.com User default ProxyJump æ²¡æœ‰é€šè¿‡ä»£ç†è½¬å‘å¯†é’¥æŒ‘æˆ˜å“åº”ï¼Œè€Œæ˜¯å°†æˆ‘ä»¬æœ¬åœ°å®¢æˆ·ç«¯çš„ stdin å’Œ stdout è½¬å‘åˆ°ç›®çš„ä¸»æœºã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨ jump.example.com ä¸Šè¿è¡Œ sshã€‚sshd ç›´æ¥è¿æ¥åˆ° myserver.example.comï¼Œå¹¶å°†è¯¥è¿æ¥çš„æ§åˆ¶æƒäº¤ç»™æˆ‘ä»¬çš„æœ¬åœ°å®¢æˆ·ç«¯ã€‚ä½œä¸ºä¸€ä¸ªé¢å¤–çš„å¥½å¤„ï¼Œç”±äºè·³è½¬æœåŠ¡å™¨åœ¨ ssh éš§é“å†…æ˜¯åŠ å¯†çš„ï¼Œæ‰€ä»¥å®ƒä¸èƒ½çœ‹åˆ°ä»»ä½•é€šè¿‡å®ƒçš„æµé‡ã€‚è®¾ç½®è·³è½¬æœåŠ¡å™¨è€Œä¸è®© ssh ç›´æ¥è®¿é—®å®ƒçš„èƒ½åŠ›æ˜¯å®‰å…¨å’Œæ­£ç¡®çš„ ssh è®¾ç½®çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ã€‚\nå¤šè·³çš„ä»£ç†è·³è½¬ è®©æˆ‘ä»¬æ¨¡æ‹Ÿä¸€ä¸ªæ›´å¤æ‚çš„åœºæ™¯ã€‚æˆ‘ä»¬æ­£è¯•å›¾ä»å®¶é‡Œè®¿é—®å…¬å¸ç½‘ç»œæ·±å¤„çš„ä¸€ä¸ªå…³é”®èµ„æºã€‚æˆ‘ä»¬å¿…é¡»é¦–å…ˆé€šè¿‡ä¸€ä¸ªå…·æœ‰åŠ¨æ€ IP çš„å¤–éƒ¨å ¡å’ä¸»æœºã€ä¸€ä¸ªå†…éƒ¨è·³è½¬ä¸»æœºï¼Œæœ€ååˆ°è¾¾èµ„æºã€‚æ¯å°æœåŠ¡å™¨å¿…é¡»é’ˆå¯¹æˆ‘ä»¬æœºå™¨ä¸Šçš„å”¯ä¸€æœ¬åœ°å¯†é’¥è¿›è¡ŒéªŒè¯ã€‚\nå¤šé‡è·³è½¬çš„ ssh ç¤ºæ„å›¾:\nå†ä¸€æ¬¡ï¼Œæˆ‘ä»¬çš„æœ¬åœ°é…ç½®æ–‡ä»¶å°†åŒ…å«æ‰§è¡Œ ssh myserver æ‰€éœ€çš„ä¸€åˆ‡ã€‚\nHost myserver HostName myserver.example.com User virag IdentityFile /users/virag/keys/myserver-cert.pub ProxyJump jump Host bastion #Used because HostName is unreliable as IP address changes frequently HostKeyAlias bastion.example User external Host jump HostName jump.example.com User internal IdentityFile /users/virag/keys/jump-cert.pub ProxyJump bastion ç°åœ¨æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬å¿…é¡»ç”¨å†…éƒ¨é…ç½®çš„ OpenSSH ç®¡ç†å…¨å›½å„åœ°å¤šä¸ªäº‘æä¾›å•†çš„å‡ ç™¾ä¸ªç¯å¢ƒã€‚(ä½ å¯èƒ½ä¼šå—¤ä¹‹ä»¥é¼»ï¼Œä½†æˆ‘ä»¬å·²ç»å¬è¿‡è¿™äº›æ•…äº‹äº†ï¼)ä»…ä»…ä¾é è¿è¡Œæ—¶å‘½ä»¤ï¼ŒåŒæ—¶å®£ç§°è¦ç»´æŠ¤å¯ä¿¡çš„å®‰å…¨ç¨‹åº¦æ˜¯ä¸å¯èƒ½çš„ã€‚åœ¨è¿™ç§è§„æ¨¡ä¸‹ï¼Œæœ‰æ•ˆåœ°ç®¡ç†ä¸€ä¸ªèˆ°é˜Ÿéœ€è¦æœ‰æ„è¯†åœ°æ¶æ„å­ç½‘ã€DNSã€ä»£ç†é“¾ã€å¯†é’¥ã€æ–‡ä»¶ç»“æ„ç­‰ï¼Œè¿™äº›å­ç½‘ã€DNSã€ä»£ç†é“¾ã€å¯†é’¥ã€æ–‡ä»¶ç»“æ„ç­‰éµå¾ªå¯é¢„æµ‹çš„æ¨¡å¼ï¼Œå¹¶ä¸”å¯ä»¥æŠ„å½•åˆ° ~/.ssh/ssh_config ä¸­ã€‚\nç»“æŸè¯­ ä»æœ¬æ–‡ä¸­å¾—åˆ°çš„æ›´å¹¿æ³›çš„å¯ç¤ºæ˜¯è®©ç”Ÿæ´»å˜å¾—ç®€å•ã€‚å³ä½¿æ˜¯æœ€ç®€å•çš„é…ç½®é€‰é¡¹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å·§å¦™çš„æ–¹å¼æ¥å®ç°ã€‚è¿™äº›å¯ä»¥è®©æˆ‘ä»¬ä¿æŒå¯¹å¼ºå¤§å®‰å…¨æ€§çš„æ‰¿è¯ºï¼Œå¹¶æœ€å¤§é™åº¦åœ°å‡å°‘äººä¸ºé”™è¯¯ã€‚\nå¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äº ssh è®¿é—®çš„æœ€ä½³å®è·µï¼Œä½ å¯ä»¥è€ƒè™‘ä»¥ä¸‹æ–‡ç« ã€‚\n å¦‚ä½•æ­£ç¡®ä½¿ç”¨ SSH Teleport: OpenSSH çš„ç°ä»£æ›¿ä»£å“  åŸæ–‡é“¾æ¥: https://gravitational.com/blog/ssh-config/\n","permalink":"https://ohmyweekly.github.io/notes/2020-10-01-ssh-configuration/","tags":["git","config"],"title":"SSH Configuration: ssh_config"},{"categories":["Flink"],"contents":"ä¸ºä½ çš„ Flink ç¨‹åºæ³¨å†Œä¸€ä¸ªè‡ªå®šä¹‰çš„åºåˆ—å™¨ å¦‚æœä½ åœ¨ Flink ç¨‹åºä¸­ä½¿ç”¨çš„è‡ªå®šä¹‰ç±»å‹ä¸èƒ½è¢« Flink ç±»å‹åºåˆ—åŒ–å™¨åºåˆ—åŒ–ï¼ŒFlink å°±ä¼šå›åˆ°ä½¿ç”¨é€šç”¨çš„ Kryo åºåˆ—åŒ–å™¨ã€‚ä½ å¯ä»¥ç”¨ Kryo æ³¨å†Œä½ è‡ªå·±çš„åºåˆ—åŒ–å™¨æˆ–åƒ Google Protobuf æˆ– Apache Thrift è¿™æ ·çš„åºåˆ—åŒ–ç³»ç»Ÿã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œåªéœ€åœ¨ Flink ç¨‹åºçš„ ExecutionConfig ä¸­æ³¨å†Œç±»å‹ç±»å’Œåºåˆ—åŒ–å™¨ã€‚\nfinal ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment(); // register the class of the serializer as serializer for a type env.getConfig().registerTypeWithKryoSerializer(MyCustomType.class, MyCustomSerializer.class); // register an instance as serializer for a type MySerializer mySerializer = new MySerializer(); env.getConfig().registerTypeWithKryoSerializer(MyCustomType.class, mySerializer); è¯·æ³¨æ„ï¼Œä½ çš„è‡ªå®šä¹‰åºåˆ—åŒ–å™¨å¿…é¡»æ‰©å±• Kryo çš„åºåˆ—åŒ–å™¨ç±»ã€‚åœ¨ Google Protobuf æˆ– Apache Thrift çš„æƒ…å†µä¸‹ï¼Œè¿™å·²ç»ä¸ºä½ å®Œæˆäº†ã€‚\nfinal ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment(); // register the Google Protobuf serializer with Kryo env.getConfig().registerTypeWithKryoSerializer(MyCustomType.class, ProtobufSerializer.class); // register the serializer included with Apache Thrift as the standard serializer // TBaseSerializer states it should be initialized as a default Kryo serializer env.getConfig().addDefaultKryoSerializer(MyCustomType.class, TBaseSerializer.class); ä¸ºäº†ä½¿ä¸Šé¢çš„ä¾‹å­æœ‰æ•ˆï¼Œä½ éœ€è¦åœ¨ Maven é¡¹ç›®æ–‡ä»¶(pom.xml)ä¸­åŠ å…¥å¿…è¦çš„ä¾èµ–å…³ç³»ã€‚åœ¨ä¾èµ–å…³ç³»éƒ¨åˆ†ï¼Œä¸º Apache Thrift æ·»åŠ ä»¥ä¸‹å†…å®¹ã€‚\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.twitter\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;chill-thrift\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.7.6\u0026lt;/version\u0026gt; \u0026lt;!-- exclusions for dependency conversion --\u0026gt; \u0026lt;exclusions\u0026gt; \u0026lt;exclusion\u0026gt; \u0026lt;groupId\u0026gt;com.esotericsoftware.kryo\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;kryo\u0026lt;/artifactId\u0026gt; \u0026lt;/exclusion\u0026gt; \u0026lt;/exclusions\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- libthrift is required by chill-thrift --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.thrift\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;libthrift\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.11.0\u0026lt;/version\u0026gt; \u0026lt;exclusions\u0026gt; \u0026lt;exclusion\u0026gt; \u0026lt;groupId\u0026gt;javax.servlet\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;servlet-api\u0026lt;/artifactId\u0026gt; \u0026lt;/exclusion\u0026gt; \u0026lt;exclusion\u0026gt; \u0026lt;groupId\u0026gt;org.apache.httpcomponents\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;httpclient\u0026lt;/artifactId\u0026gt; \u0026lt;/exclusion\u0026gt; \u0026lt;/exclusions\u0026gt; \u0026lt;/dependency\u0026gt; å¯¹äº Google Protobufï¼Œä½ éœ€è¦ä»¥ä¸‹ Maven ä¾èµ–ã€‚\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.twitter\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;chill-protobuf\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;0.7.6\u0026lt;/version\u0026gt; \u0026lt;!-- exclusions for dependency conversion --\u0026gt; \u0026lt;exclusions\u0026gt; \u0026lt;exclusion\u0026gt; \u0026lt;groupId\u0026gt;com.esotericsoftware.kryo\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;kryo\u0026lt;/artifactId\u0026gt; \u0026lt;/exclusion\u0026gt; \u0026lt;/exclusions\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- We need protobuf for chill-protobuf --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;com.google.protobuf\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;protobuf-java\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.7.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; è¯·æ ¹æ®éœ€è¦è°ƒæ•´ä¸¤ä¸ªåº“çš„ç‰ˆæœ¬ã€‚\nä½¿ç”¨ Kryo çš„ JavaSerializer çš„é—®é¢˜ã€‚ å¦‚æœä½ ä¸ºä½ çš„è‡ªå®šä¹‰ç±»å‹æ³¨å†Œäº† Kryo çš„ JavaSerializerï¼Œä½ å¯èƒ½ä¼šé‡åˆ° ClassNotFoundExceptionsï¼Œå³ä½¿ä½ çš„è‡ªå®šä¹‰ç±»å‹ç±»åŒ…å«åœ¨æäº¤çš„ç”¨æˆ·ä»£ç  jar ä¸­ã€‚è¿™æ˜¯ç”±äº Kryo çš„ JavaSerializer çš„ä¸€ä¸ªå·²çŸ¥é—®é¢˜ï¼Œå®ƒå¯èƒ½ä¼šé”™è¯¯åœ°ä½¿ç”¨é”™è¯¯çš„ classloaderã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ åº”è¯¥ä½¿ç”¨ org.apache.flink.api.java.typeutils.runtime.kryo.JavaSerializer æ¥ä»£æ›¿è§£å†³è¿™ä¸ªé—®é¢˜ã€‚è¿™æ˜¯ Flink ä¸­é‡æ–°å®ç°çš„ JavaSerializerï¼Œå®ƒå¯ä»¥ç¡®ä¿ä½¿ç”¨ç”¨æˆ·ä»£ç ç±»åŠ è½½å™¨ã€‚\næ›´å¤šç»†èŠ‚è¯·å‚è€ƒ FLINK-6025ã€‚\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/custom_serializers.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-25-custom-serializer/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£"],"title":"Custom Serializer"},{"categories":["Flink"],"contents":"Hive è¯»å†™ ä½¿ç”¨ HiveCatalog å’Œ Flink ä¸ Hive çš„è¿æ¥å™¨ï¼ŒFlink å¯ä»¥ä» Hive æ•°æ®ä¸­è¯»å–å’Œå†™å…¥æ•°æ®ï¼Œä½œä¸º Hive æ‰¹å¤„ç†å¼•æ“çš„æ›¿ä»£ã€‚è¯·åŠ¡å¿…æŒ‰ç…§è¯´æ˜åœ¨ä½ çš„åº”ç”¨ä¸­åŠ å…¥æ­£ç¡®çš„ä¾èµ–å…³ç³»ã€‚åŒæ—¶è¯·æ³¨æ„ï¼ŒHive è¿æ¥å™¨åªé€‚ç”¨äº blink plannerã€‚\nä» Hive è¯»å–æ•°æ® å‡è®¾ Hive åœ¨å…¶é»˜è®¤çš„æ•°æ®åº“ä¸­åŒ…å«ä¸€ä¸ªåä¸º people çš„å•è¡¨ï¼Œè¯¥è¡¨åŒ…å«å¤šæ¡è®°å½•ã€‚\nhive\u0026gt; show databases; OK default Time taken: 0.841 seconds, Fetched: 1 row(s) hive\u0026gt; show tables; OK Time taken: 0.087 seconds hive\u0026gt; CREATE TABLE mytable(name string, value double); OK Time taken: 0.127 seconds hive\u0026gt; SELECT * FROM mytable; OK Tom 4.72 John 8.0 Tom 24.2 Bob 3.14 Bob 4.72 Tom 34.9 Mary 4.79 Tiff 2.72 Bill 4.33 Mary 77.7 Time taken: 0.097 seconds, Fetched: 10 row(s) æ•°æ®å‡†å¤‡å¥½åï¼Œä½ å¯ä»¥è¿æ¥åˆ°ç°æœ‰çš„ Hive å®‰è£…å¹¶å¼€å§‹æŸ¥è¯¢ã€‚\nFlink SQL\u0026gt; show catalogs; myhive default_catalog # ------ Set the current catalog to be \u0026#39;myhive\u0026#39; catalog if you haven\u0026#39;t set it in the yaml file ------ Flink SQL\u0026gt; use catalog myhive; # ------ See all registered database in catalog \u0026#39;mytable\u0026#39; ------ Flink SQL\u0026gt; show databases; default # ------ See the previously registered table \u0026#39;mytable\u0026#39; ------ Flink SQL\u0026gt; show tables; mytable # ------ The table schema that Flink sees is the same that we created in Hive, two columns - name as string and value as double ------  Flink SQL\u0026gt; describe mytable; root |-- name: name |-- type: STRING |-- name: value |-- type: DOUBLE # ------ Select from hive table or hive view ------  Flink SQL\u0026gt; SELECT * FROM mytable; name value __________ __________ Tom 4.72 John 8.0 Tom 24.2 Bob 3.14 Bob 4.72 Tom 34.9 Mary 4.79 Tiff 2.72 Bill 4.33 Mary 77.7 æŸ¥è¯¢ Hive è§†å›¾ å¦‚æœä½ éœ€è¦æŸ¥è¯¢ Hive è§†å›¾ï¼Œè¯·æ³¨æ„ã€‚\nåœ¨æŸ¥è¯¢è¯¥ç›®å½•ä¸­çš„è§†å›¾ä¹‹å‰ï¼Œå¿…é¡»å…ˆä½¿ç”¨ Hive ç›®å½•ä½œä¸ºå½“å‰ç›®å½•ã€‚å¯ä»¥é€šè¿‡ Table API ä¸­çš„ tableEnv.useCatalog(...) æˆ–è€… SQL Client ä¸­çš„ USE CATALOG \u0026hellip;æ¥å®ç°ã€‚ Hive å’Œ Flink SQL æœ‰ä¸åŒçš„è¯­æ³•ï¼Œä¾‹å¦‚ï¼Œä¸åŒçš„ä¿ç•™å…³é”®å­—å’Œå­—å…ƒã€‚è¯·ç¡®ä¿è§†å›¾çš„æŸ¥è¯¢ä¸ Flink è¯­æ³•å…¼å®¹ã€‚\nå†™å…¥ Hive åŒæ ·ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ INSERT å­å¥å°†æ•°æ®å†™å…¥ hive ä¸­ã€‚\nè€ƒè™‘æœ‰ä¸€ä¸ªåä¸º \u0026ldquo;mytable \u0026ldquo;çš„ç¤ºä¾‹è¡¨ï¼Œè¡¨ä¸­æœ‰ä¸¤åˆ—ï¼šname å’Œ ageï¼Œç±»å‹ä¸º string å’Œ intã€‚\n# ------ INSERT INTO will append to the table or partition, keeping the existing data intact ------  Flink SQL\u0026gt; INSERT INTO mytable SELECT \u0026#39;Tom\u0026#39;, 25; # ------ INSERT OVERWRITE will overwrite any existing data in the table or partition ------  Flink SQL\u0026gt; INSERT OVERWRITE mytable SELECT \u0026#39;Tom\u0026#39;, 25; æˆ‘ä»¬ä¹Ÿæ”¯æŒåˆ†åŒºè¡¨ï¼Œè€ƒè™‘æœ‰ä¸€ä¸ªåä¸º myparttable çš„åˆ†åŒºè¡¨ï¼Œæœ‰å››åˆ—ï¼šnameã€ageã€my_type å’Œ my_dateï¼Œåœ¨ type ä¸­\u0026hellip;my_type å’Œ my_date æ˜¯åˆ†åŒºé”®ã€‚\n# ------ Insert with static partition ------  Flink SQL\u0026gt; INSERT OVERWRITE myparttable PARTITION (my_type=\u0026#39;type_1\u0026#39;, my_date=\u0026#39;2019-08-08\u0026#39;) SELECT \u0026#39;Tom\u0026#39;, 25; # ------ Insert with dynamic partition ------  Flink SQL\u0026gt; INSERT OVERWRITE myparttable SELECT \u0026#39;Tom\u0026#39;, 25, \u0026#39;type_1\u0026#39;, \u0026#39;2019-08-08\u0026#39;; # ------ Insert with static(my_type) and dynamic(my_date) partition ------  Flink SQL\u0026gt; INSERT OVERWRITE myparttable PARTITION (my_type=\u0026#39;type_1\u0026#39;) SELECT \u0026#39;Tom\u0026#39;, 25, \u0026#39;2019-08-08\u0026#39;; æ ¼å¼ æˆ‘ä»¬æµ‹è¯•äº†ä»¥ä¸‹è¡¨æ ¼å­˜å‚¨æ ¼å¼ï¼šæ–‡æœ¬ã€csvã€SequenceFileã€ORC å’Œ Parquetã€‚\nä¼˜åŒ– åˆ†åŒºä¿®å‰ª Flink ä½¿ç”¨åˆ†åŒºä¿®å‰ªä½œä¸ºä¸€ç§æ€§èƒ½ä¼˜åŒ–ï¼Œä»¥é™åˆ¶ Flink åœ¨æŸ¥è¯¢ Hive è¡¨æ—¶è¯»å–çš„æ–‡ä»¶å’Œåˆ†åŒºçš„æ•°é‡ã€‚å½“ä½ çš„æ•°æ®è¢«åˆ†åŒºåï¼Œå½“æŸ¥è¯¢ç¬¦åˆæŸäº›è¿‡æ»¤æ¡ä»¶æ—¶ï¼ŒFlink åªä¼šè¯»å– Hive è¡¨ä¸­çš„åˆ†åŒºå­é›†ã€‚\næŠ•å½±ä¸‹æ¨ Flink åˆ©ç”¨æŠ•å½±ä¸‹æ¨ï¼Œé€šè¿‡ä»è¡¨æ‰«æä¸­çœç•¥ä¸å¿…è¦çš„å­—æ®µï¼Œæœ€å¤§é™åº¦åœ°å‡å°‘ Flink å’Œ Hive è¡¨ä¹‹é—´çš„æ•°æ®ä¼ è¾“ã€‚\nå½“ä¸€ä¸ªè¡¨åŒ…å«è®¸å¤šåˆ—æ—¶ï¼Œå®ƒå°¤å…¶æœ‰åˆ©ã€‚\né™åˆ¶ä¸‹æ¨ å¯¹äºå¸¦æœ‰ LIMIT å­å¥çš„æŸ¥è¯¢ï¼ŒFlink ä¼šå°½å¯èƒ½åœ°é™åˆ¶è¾“å‡ºè®°å½•çš„æ•°é‡ï¼Œä»¥å‡å°‘è·¨ç½‘ç»œä¼ è¾“çš„æ•°æ®é‡ã€‚\nè¯»å–æ—¶çš„å‘é‡ä¼˜åŒ– å½“æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶ï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨ä¼˜åŒ–åŠŸèƒ½ã€‚\n æ ¼å¼ï¼š ORC æˆ– Parquetã€‚ æ²¡æœ‰å¤æ‚æ•°æ®ç±»å‹çš„åˆ—ï¼Œå¦‚ hive ç±»å‹: List, Map, Struct, Unionã€‚  è¿™ä¸ªåŠŸèƒ½é»˜è®¤æ˜¯å¼€å¯çš„ã€‚å¦‚æœå‡ºç°é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªé…ç½®é€‰é¡¹æ¥å…³é—­ Vectorized Optimizationã€‚\ntable.exec.hive.fallback-mapred-reader=true Source å¹¶è¡Œæ€§æ¨æ–­ é»˜è®¤æƒ…å†µä¸‹ï¼ŒFlink æ ¹æ®åˆ†å‰²æ¬¡æ•°æ¥æ¨æ–­ hive æºçš„å¹¶è¡Œåº¦ï¼Œåˆ†å‰²æ¬¡æ•°æ˜¯æ ¹æ®æ–‡ä»¶çš„æ•°é‡å’Œæ–‡ä»¶ä¸­çš„å—æ•°æ¥æ¨æ–­çš„ã€‚\nFlink å…è®¸ä½ çµæ´»é…ç½®å¹¶è¡Œåº¦æ¨æ–­çš„ç­–ç•¥ã€‚ä½ å¯ä»¥åœ¨ TableConfig ä¸­é…ç½®ä»¥ä¸‹å‚æ•°ï¼ˆæ³¨æ„ï¼Œè¿™äº›å‚æ•°ä¼šå½±å“ä½œä¸šçš„æ‰€æœ‰æºï¼‰ã€‚\n   Key Default Type Description     table.exec.hive.infer-source-parallelism true Boolean å¦‚æœä¸ºçœŸï¼Œåˆ™æ ¹æ®åˆ†å‰²æ•°æ¥æ¨æ–­æºçš„å¹¶è¡Œåº¦ï¼Œå¦‚æœä¸ºå‡ï¼Œåˆ™æ ¹æ®é…ç½®æ¥è®¾ç½®æºçš„å¹¶è¡Œåº¦ã€‚å¦‚æœä¸º falseï¼Œåˆ™é€šè¿‡é…ç½®æ¥è®¾ç½®æºçš„å¹¶è¡Œåº¦ã€‚   table.exec.hive.infer-source-parallelism.max 1000 Integer è®¾ç½®æºè¿ç®—ç¬¦çš„æœ€å¤§æ¨æ–­å¹¶è¡Œåº¦ã€‚    è·¯çº¿å›¾ æˆ‘ä»¬æ­£åœ¨è§„åˆ’å¹¶ç§¯æå¼€å‘æ”¯æŒåŠŸèƒ½ï¼Œå¦‚:\n ACID è¡¨ åˆ†æ¡¶è¡¨ æ›´å¤šæ ¼å¼  æ›´å¤šåŠŸèƒ½éœ€æ±‚è¯·è”ç³»ç¤¾åŒº https://flink.apache.org/community.html#mailing-lists\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/hive/hive_read_write.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-25-hive-read-and-write/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL","Hive"],"title":"Hive Read and Write"},{"categories":["Flink"],"contents":"Hive æµ ä¸€ä¸ªå…¸å‹çš„ hive ä½œä¸šæ˜¯å‘¨æœŸæ€§åœ°å®‰æ’æ‰§è¡Œçš„ï¼Œæ‰€ä»¥ä¼šæœ‰è¾ƒå¤§çš„å»¶è¿Ÿã€‚\nFlink æ”¯æŒä»¥æµå¼çš„å½¢å¼å†™å…¥ã€è¯»å–å’ŒåŠ å…¥ hive è¡¨ã€‚\næµå¼æ•°æ®æœ‰ä¸‰ç§ç±»å‹ã€‚\n å°†æµå¼æ•°æ®å†™å…¥ Hive è¡¨ã€‚ ä»¥æµçš„å½¢å¼å¢é‡è¯»å– Hive è¡¨ã€‚ æµå¼è¡¨ä½¿ç”¨ Temporal è¡¨è¿æ¥ Hive è¡¨ã€‚  æµå¼å†™å…¥ Hive è¡¨æ”¯æŒæµå¼å†™å…¥ï¼ŒåŸºäº Filesystem Streaming Sinkã€‚\nHive Streaming Sink é‡ç”¨ Filesystem Streaming Sinkï¼Œå°† Hadoop OutputFormat/RecordWriter æ•´åˆåˆ°æµå¼å†™å…¥ã€‚Hadoop RecordWriters æ˜¯ Bulk-encoded Formatsï¼ŒBulk Formats åœ¨æ¯ä¸ªæ£€æŸ¥ç‚¹ä¸Šæ»šåŠ¨æ–‡ä»¶ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œç°åœ¨åªæœ‰é‡å‘½åæäº¤è€…ï¼Œè¿™æ„å‘³ç€ S3 æ–‡ä»¶ç³»ç»Ÿä¸èƒ½æ”¯æŒç²¾ç¡®çš„ onceï¼Œå¦‚æœä½ æƒ³åœ¨ S3 æ–‡ä»¶ç³»ç»Ÿä¸­ä½¿ç”¨ Hive æµåª’ä½“æ±‡ï¼Œä½ å¯ä»¥åœ¨ TableConfig ä¸­æŠŠä»¥ä¸‹å‚æ•°é…ç½®ä¸º falseï¼Œä»¥ä½¿ç”¨ Flink åŸç”Ÿå†™å…¥å™¨ï¼ˆåªå¯¹ parquet å’Œ orc æœ‰æ•ˆï¼‰ï¼ˆæ³¨æ„è¿™äº›å‚æ•°ä¼šå½±å“æ‰€æœ‰ä½œä¸šçš„æ±‡ï¼‰ã€‚\n   Key Default Type Description     table.exec.hive.fallback-mapred-writer true Boolean å¦‚æœæ˜¯å‡çš„ï¼Œç”¨ flink native writer å†™ parquet å’Œ orc æ–‡ä»¶ï¼›å¦‚æœæ˜¯çœŸçš„ï¼Œç”¨ hadoop mapred record writer å†™ parquet å’Œ orc æ–‡ä»¶ã€‚    ä¸‹é¢å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨æµæ¥æ”¶å™¨å†™ä¸€ä¸ªæµå¼æŸ¥è¯¢ï¼Œå°†æ•°æ®ä» Kafka å†™åˆ°ä¸€ä¸ªæœ‰ partition-commit çš„ Hive è¡¨ä¸­ï¼Œå¹¶è¿è¡Œä¸€ä¸ªæ‰¹å¤„ç†æŸ¥è¯¢å°†è¿™äº›æ•°æ®è¯»å›ã€‚\nSETtable.sql-dialect=hive;CREATETABLEhive_table(user_idSTRING,order_amountDOUBLE)PARTITIONEDBY(dtSTRING,hrSTRING)STOREDASparquetTBLPROPERTIES(\u0026#39;partition.time-extractor.timestamp-pattern\u0026#39;=\u0026#39;$dt $hr:00:00\u0026#39;,\u0026#39;sink.partition-commit.trigger\u0026#39;=\u0026#39;partition-time\u0026#39;,\u0026#39;sink.partition-commit.delay\u0026#39;=\u0026#39;1 h\u0026#39;,\u0026#39;sink.partition-commit.policy.kind\u0026#39;=\u0026#39;metastore,success-file\u0026#39;);SETtable.sql-dialect=default;CREATETABLEkafka_table(user_idSTRING,order_amountDOUBLE,log_tsTIMESTAMP(3),WATERMARKFORlog_tsASlog_ts-INTERVAL\u0026#39;5\u0026#39;SECOND)WITH(...);-- streaming sql, insert into hive table INSERTINTOTABLEhive_tableSELECTuser_id,order_amount,DATE_FORMAT(log_ts,\u0026#39;yyyy-MM-dd\u0026#39;),DATE_FORMAT(log_ts,\u0026#39;HH\u0026#39;)FROMkafka_table;-- batch sql, select with partition pruning SELECT*FROMhive_tableWHEREdt=\u0026#39;2020-05-20\u0026#39;andhr=\u0026#39;12\u0026#39;;æµå¼è¯»å– ä¸ºäº†æé«˜ hive è¯»å–çš„å®æ—¶æ€§ï¼ŒFlink æ”¯æŒå®æ—¶ Hive è¡¨æµè¯»å–ã€‚\n åˆ†åŒºè¡¨ï¼Œç›‘æ§åˆ†åŒºçš„ç”Ÿæˆï¼Œå¹¶é€æ­¥è¯»å–æ–°åˆ†åŒºã€‚ éåˆ†åŒºè¡¨ï¼Œç›‘æ§æ–‡ä»¶å¤¹ä¸­æ–°æ–‡ä»¶çš„ç”Ÿæˆï¼Œå¹¶å¢é‡è¯»å–æ–°æ–‡ä»¶ã€‚  ç”šè‡³å¯ä»¥é‡‡ç”¨ 10 åˆ†é’Ÿçº§åˆ«çš„åˆ†åŒºç­–ç•¥ï¼Œåˆ©ç”¨ Flink çš„ Hive æµå¼è¯»å–å’Œ Hive æµå¼å†™å…¥ï¼Œå¤§å¤§æé«˜ Hive æ•°æ®ä»“åº“çš„å®æ—¶æ€§èƒ½ï¼Œè¾¾åˆ°å‡†å®æ—¶åˆ†é’Ÿçº§åˆ«ã€‚\n   Key Default Type Description     streaming-source.enable false Boolean æ˜¯å¦å¯ç”¨æµåª’ä½“æºã€‚æ³¨æ„ï¼šè¯·ç¡®ä¿æ¯ä¸ªåˆ†åŒº/æ–‡ä»¶éƒ½æ˜¯ä»¥åŸå­æ–¹å¼å†™å…¥ï¼Œå¦åˆ™è¯»è€…å¯èƒ½ä¼šå¾—åˆ°ä¸å®Œæ•´çš„æ•°æ®ã€‚è¯·ç¡®ä¿æ¯ä¸ªåˆ†åŒº/æ–‡ä»¶éƒ½åº”è¯¥ä»¥åŸå­æ–¹å¼å†™å…¥ï¼Œå¦åˆ™è¯»è€…å¯èƒ½ä¼šå¾—åˆ°ä¸å®Œæ•´çš„æ•°æ®ã€‚   streaming-source.monitor-interval 1 m Duration è¿ç»­ç›‘æ§åˆ†åŒº/æ–‡ä»¶çš„æ—¶é—´é—´éš”ã€‚   streaming-source.consume-order create-time String æµæºçš„æ¶ˆè€—é¡ºåºï¼Œæ”¯æŒ create-time å’Œ partition-timeã€‚create-time æ¯”è¾ƒçš„æ˜¯åˆ†åŒº/æ–‡ä»¶çš„åˆ›å»ºæ—¶é—´ï¼Œè¿™ä¸æ˜¯ Hive metaStore ä¸­çš„åˆ†åŒºåˆ›å»ºæ—¶é—´ï¼Œè€Œæ˜¯æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶å¤¹/æ–‡ä»¶ä¿®æ”¹æ—¶é—´ï¼›partition-time æ¯”è¾ƒçš„æ˜¯åˆ†åŒºåç§°æ‰€ä»£è¡¨çš„æ—¶é—´ï¼Œå¦‚æœåˆ†åŒºæ–‡ä»¶å¤¹ä»¥æŸç§æ–¹å¼å¾—åˆ°æ›´æ–°ï¼Œæ¯”å¦‚åœ¨æ–‡ä»¶å¤¹ä¸­æ·»åŠ æ–°æ–‡ä»¶ï¼Œå°±ä¼šå½±å“æ•°æ®çš„æ¶ˆè€—æ–¹å¼ã€‚å¯¹äºéåˆ†åŒºè¡¨ï¼Œè¿™ä¸ªå€¼åº”è¯¥ä¸€ç›´æ˜¯ \u0026ldquo;åˆ›å»ºæ—¶é—´\u0026rdquo;ã€‚   streaming-source.consume-start-offset 1970-00-00 String æµå¼æ¶ˆè´¹çš„èµ·å§‹åç§»é‡ã€‚å¦‚ä½•è§£æå’Œæ¯”è¾ƒåç§»é‡å–å†³äºä½ çš„é¡ºåºã€‚å¯¹äºåˆ›å»ºæ—¶é—´å’Œåˆ†åŒºæ—¶é—´ï¼Œåº”è¯¥æ˜¯ä¸€ä¸ªæ—¶é—´æˆ³å­—ç¬¦ä¸²ï¼ˆyyyy-[m]m-[d]d [hh:mm:ss]ï¼‰ã€‚å¯¹äºåˆ†åŒºæ—¶é—´ï¼Œå°†ä½¿ç”¨åˆ†åŒºæ—¶é—´æå–å™¨ä»åˆ†åŒºä¸­æå–æ—¶é—´ã€‚    æ³¨æ„:\n ç›‘æ§ç­–ç•¥æ˜¯ç°åœ¨æ‰«æä½ç½®è·¯å¾„ä¸­çš„æ‰€æœ‰ç›®å½•/æ–‡ä»¶ã€‚å¦‚æœåˆ†åŒºå¤ªå¤šï¼Œä¼šå‡ºç°æ€§èƒ½é—®é¢˜ã€‚ éåˆ†åŒºçš„æµå¼è¯»å–éœ€è¦å°†æ¯ä¸ªæ–‡ä»¶åŸå­åœ°æ”¾å…¥ç›®æ ‡ç›®å½•ä¸­ã€‚ åˆ†åŒºçš„æµå¼è¯»å–è¦æ±‚åœ¨ hive metastore çš„è§†å›¾ä¸­åŸå­åœ°æ·»åŠ æ¯ä¸ªåˆ†åŒºã€‚è¿™æ„å‘³ç€æ–°æ·»åŠ åˆ°ç°æœ‰åˆ†åŒºçš„æ•°æ®ä¸ä¼šè¢«æ¶ˆè€—æ‰ã€‚ æµè¯»å–ä¸æ”¯æŒ Flink DDL ä¸­çš„æ°´å°è¯­æ³•ã€‚æ‰€ä»¥å®ƒä¸èƒ½ç”¨äºçª—å£æ“ä½œç¬¦ã€‚  ä¸‹é¢å±•ç¤ºäº†å¦‚ä½•å¢é‡è¯»å– Hive è¡¨ã€‚\nSELECT*FROMhive_table/*+ OPTIONS(\u0026#39;streaming-source.enable\u0026#39;=\u0026#39;true\u0026#39;, \u0026#39;streaming-source.consume-start-offset\u0026#39;=\u0026#39;2020-05-20\u0026#39;) */;Hive è¡¨ä½œä¸ºä¸´æ—¶è¡¨ æ‚¨å¯ä»¥ä½¿ç”¨ Hive è¡¨ä½œä¸ºæ—¶æ€è¡¨ï¼Œå¹¶å°†æµå¼æ•°æ®åŠ å…¥å…¶ä¸­ã€‚è¯·æŒ‰ç…§ç¤ºä¾‹æ¥äº†è§£å¦‚ä½•è¿æ¥ä¸€ä¸ªæ—¶æ€è¡¨ã€‚\nåœ¨æ‰§è¡Œ join æ—¶ï¼ŒHive è¡¨å°†è¢«ç¼“å­˜åœ¨ TM å†…å­˜ä¸­ï¼Œå¹¶åœ¨ Hive è¡¨ä¸­æŸ¥æ‰¾æ¥è‡ªæµçš„æ¯ä¸€æ¡è®°å½•ï¼Œä»¥å†³å®šæ˜¯å¦æ‰¾åˆ°åŒ¹é…ã€‚ä½ ä¸éœ€è¦ä»»ä½•é¢å¤–çš„è®¾ç½®å°±å¯ä»¥ä½¿ç”¨ Hive è¡¨ä½œä¸ºæ—¶æ€è¡¨ã€‚ä½†å¯ä»¥é€‰æ‹©ç”¨ä»¥ä¸‹å±æ€§é…ç½® Hive è¡¨ç¼“å­˜çš„ TTLã€‚ç¼“å­˜è¿‡æœŸåï¼Œå°†å†æ¬¡æ‰«æ Hive è¡¨ä»¥åŠ è½½æœ€æ–°çš„æ•°æ®ã€‚\n   Key Default Type Description     lookup.join.cache.ttl 60 min Duration åœ¨æŸ¥æ‰¾è¿æ¥ä¸­æ„å»ºè¡¨çš„ç¼“å­˜ TTLï¼ˆä¾‹å¦‚ 10 åˆ†é’Ÿï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒTTL ä¸º 60 åˆ†é’Ÿã€‚    æ³¨æ„:\n æ¯ä¸ªåŠ å…¥å­ä»»åŠ¡éƒ½éœ€è¦ä¿ç•™è‡ªå·±çš„ Hive è¡¨çš„ç¼“å­˜ã€‚è¯·ç¡®ä¿ Hive è¡¨å¯ä»¥æ”¾å…¥ TM ä»»åŠ¡æ§½çš„å†…å­˜ä¸­ã€‚ ä½ åº”è¯¥ä¸º lookup.join.cache.ttl è®¾ç½®ä¸€ä¸ªç›¸å¯¹è¾ƒå¤§çš„å€¼ã€‚å¦‚æœä½ çš„ Hive è¡¨éœ€è¦å¤ªé¢‘ç¹çš„æ›´æ–°å’Œé‡è½½ï¼Œä½ å¯èƒ½ä¼šæœ‰æ€§èƒ½é—®é¢˜ã€‚ ç›®å‰ï¼Œæ¯å½“ç¼“å­˜éœ€è¦åˆ·æ–°æ—¶ï¼Œæˆ‘ä»¬åªæ˜¯ç®€å•åœ°åŠ è½½æ•´ä¸ª Hive è¡¨ã€‚æ²¡æœ‰åŠæ³•åŒºåˆ†æ–°æ•°æ®å’Œæ—§æ•°æ®ã€‚  åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/hive/hive_streaming.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-25-hive-streaming/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL","Hive"],"title":"Hive Streaming"},{"categories":["Flink"],"contents":"Hive å‡½æ•° é€šè¿‡ HiveModule ä½¿ç”¨ Hive å†…ç½®åŠŸèƒ½ HiveModule å°† Hive å†…ç½®å‡½æ•°ä½œä¸º Flink ç³»ç»Ÿï¼ˆå†…ç½®ï¼‰å‡½æ•°æä¾›ç»™ Flink SQL å’Œ Table API ç”¨æˆ·ã€‚\nå…·ä½“ä¿¡æ¯è¯·å‚è€ƒ HiveModuleã€‚\n Scala  val name = \u0026#34;myhive\u0026#34; val version = \u0026#34;2.3.4\u0026#34; tableEnv.loadModue(name, new HiveModule(version));  YAML  modules:- name:coretype:core- name:myhivetype:hive æ³¨æ„ï¼Œæ—§ç‰ˆæœ¬ä¸­çš„ä¸€äº› Hive å†…ç½®åŠŸèƒ½å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚æˆ‘ä»¬å»ºè®®ç”¨æˆ·ç»™è‡ªå·±çš„ Hive æ‰“ä¸Šè¡¥ä¸æ¥ä¿®å¤å®ƒä»¬ã€‚  Hive ç”¨æˆ·å®šä¹‰çš„å‡½æ•° ç”¨æˆ·å¯ä»¥åœ¨ Flink ä¸­ä½¿ç”¨ä»–ä»¬ç°æœ‰çš„ Hive ç”¨æˆ·å®šä¹‰å‡½æ•°ã€‚\næ”¯æŒçš„ UDF ç±»å‹åŒ…æ‹¬:\n UDF GenericUDF GenericUDTF UDAF GenericUDAFResolver2  åœ¨æŸ¥è¯¢è§„åˆ’å’Œæ‰§è¡Œæ—¶ï¼ŒHive çš„ UDF å’Œ GenericUDF ä¼šè‡ªåŠ¨ç¿»è¯‘æˆ Flink çš„ ScalarFunctionï¼ŒHive çš„ GenericUDTF ä¼šè‡ªåŠ¨ç¿»è¯‘æˆ Flink çš„ TableFunctionï¼ŒHive çš„ UDAF å’Œ GenericUDAFResolver2 ä¼šç¿»è¯‘æˆ Flink çš„ AggregateFunctionã€‚\nè¦ä½¿ç”¨ Hive çš„ç”¨æˆ·å®šä¹‰å‡½æ•°ï¼Œç”¨æˆ·å¿…é¡»åšåˆ°:\n è®¾ç½®ä¸€ä¸ªç”± Hive Metastore æ”¯æŒçš„ HiveCatalog ä½œä¸ºä¼šè¯çš„å½“å‰ç›®å½•ï¼Œå…¶ä¸­åŒ…å«è¯¥å‡½æ•°ã€‚ åœ¨ Flink çš„ classpath ä¸­åŠ å…¥ä¸€ä¸ªåŒ…å«è¯¥å‡½æ•°çš„ jarã€‚ ä½¿ç”¨ Blink è®¡åˆ’å™¨ã€‚  ä½¿ç”¨ Hive ç”¨æˆ·å®šä¹‰å‡½æ•° å‡è®¾æˆ‘ä»¬åœ¨ Hive Metastore ä¸­æ³¨å†Œäº†ä»¥ä¸‹ Hive å‡½æ•°ã€‚\n/** * Test simple udf. Registered under name \u0026#39;myudf\u0026#39; */ public class TestHiveSimpleUDF extends UDF { public IntWritable evaluate(IntWritable i) { return new IntWritable(i.get()); } public Text evaluate(Text text) { return new Text(text.toString()); } } /** * Test generic udf. Registered under name \u0026#39;mygenericudf\u0026#39; */ public class TestHiveGenericUDF extends GenericUDF { @Override public ObjectInspector initialize(ObjectInspector[] arguments) throws UDFArgumentException { checkArgument(arguments.length == 2); checkArgument(arguments[1] instanceof ConstantObjectInspector); Object constant = ((ConstantObjectInspector) arguments[1]).getWritableConstantValue(); checkArgument(constant instanceof IntWritable); checkArgument(((IntWritable) constant).get() == 1); if (arguments[0] instanceof IntObjectInspector || arguments[0] instanceof StringObjectInspector) { return arguments[0]; } else { throw new RuntimeException(\u0026#34;Not support argument: \u0026#34; + arguments[0]); } } @Override public Object evaluate(DeferredObject[] arguments) throws HiveException { return arguments[0].get(); } @Override public String getDisplayString(String[] children) { return \u0026#34;TestHiveGenericUDF\u0026#34;; } } /** * Test split udtf. Registered under name \u0026#39;mygenericudtf\u0026#39; */ public class TestHiveUDTF extends GenericUDTF { @Override public StructObjectInspector initialize(ObjectInspector[] argOIs) throws UDFArgumentException { checkArgument(argOIs.length == 2); // TEST for constant arguments \tcheckArgument(argOIs[1] instanceof ConstantObjectInspector); Object constant = ((ConstantObjectInspector) argOIs[1]).getWritableConstantValue(); checkArgument(constant instanceof IntWritable); checkArgument(((IntWritable) constant).get() == 1); return ObjectInspectorFactory.getStandardStructObjectInspector( Collections.singletonList(\u0026#34;col1\u0026#34;), Collections.singletonList(PrimitiveObjectInspectorFactory.javaStringObjectInspector)); } @Override public void process(Object[] args) throws HiveException { String str = (String) args[0]; for (String s : str.split(\u0026#34;,\u0026#34;)) { forward(s); forward(s); } } @Override public void close() { } } ä» Hive CLI ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»–ä»¬å·²ç»æ³¨å†Œäº†ã€‚\nhive\u0026gt; show functions; OK ...... mygenericudf myudf myudtf ç„¶åï¼Œç”¨æˆ·å¯ä»¥åœ¨ SQL ä¸­ä½¿ç”¨å®ƒä»¬ä½œä¸ºã€‚\nFlink SQL\u0026gt; select mygenericudf(myudf(name), 1) as a, mygenericudf(myudf(age), 1) as b, s from mysourcetable, lateral table(myudtf(name, 1)) as T(s); åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/hive/hive_functions.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-25-hive-functions/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL","Hive"],"title":"Hive å‡½æ•°"},{"categories":["Flink"],"contents":"Hive æ–¹è¨€ ä» 1.11.0 å¼€å§‹ï¼Œå½“ä½¿ç”¨ Hive æ–¹è¨€æ—¶ï¼ŒFlink å…è®¸ç”¨æˆ·ç”¨ Hive è¯­æ³•ç¼–å†™ SQL è¯­å¥ã€‚é€šè¿‡æä¾›ä¸ Hive è¯­æ³•çš„å…¼å®¹æ€§ï¼Œæˆ‘ä»¬æ—¨åœ¨æé«˜ä¸ Hive çš„äº’æ“ä½œæ€§ï¼Œå‡å°‘ç”¨æˆ·ä¸ºäº†æ‰§è¡Œä¸åŒçš„è¯­å¥è€Œéœ€è¦åœ¨ Flink å’Œ Hive ä¹‹é—´åˆ‡æ¢çš„æƒ…å†µã€‚\nä½¿ç”¨ Hive æ–¹è¨€ Flink ç›®å‰æ”¯æŒä¸¤ç§ SQL æ–¹è¨€ï¼šé»˜è®¤å’Œ Hiveã€‚åœ¨ä½¿ç”¨ Hive è¯­æ³•ç¼–å†™ä¹‹å‰ï¼Œéœ€è¦å…ˆåˆ‡æ¢åˆ° Hive æ–¹è¨€ã€‚ä¸‹é¢ä»‹ç»å¦‚ä½•é€šè¿‡ SQL Client å’Œ Table API æ¥è®¾ç½®æ–¹è¨€ã€‚åŒæ—¶æ³¨æ„ï¼Œä½ å¯ä»¥ä¸ºä½ æ‰§è¡Œçš„æ¯ä¸€æ¡è¯­å¥åŠ¨æ€åˆ‡æ¢æ–¹è¨€ã€‚ä¸éœ€è¦é‡æ–°å¯åŠ¨ä¼šè¯æ¥ä½¿ç”¨ä¸åŒçš„æ–¹è¨€ã€‚\nSQL å®¢æˆ·ç«¯ SQL æ–¹è¨€å¯ä»¥é€šè¿‡ table.sql-dialect å±æ€§æ¥æŒ‡å®šï¼Œå› æ­¤ä½ å¯ä»¥åœ¨ä½ çš„ SQL å®¢æˆ·ç«¯çš„ yaml æ–‡ä»¶çš„é…ç½®éƒ¨åˆ†è®¾ç½®åˆå§‹æ–¹è¨€ã€‚å› æ­¤ï¼Œä½ å¯ä»¥åœ¨ SQL å®¢æˆ·ç«¯çš„ yaml æ–‡ä»¶çš„é…ç½®éƒ¨åˆ†è®¾ç½®è¦ä½¿ç”¨çš„åˆå§‹æ–¹è¨€ã€‚\nexecution:planner:blinktype:batchresult-mode:tableconfiguration:table.sql-dialect:hiveä½ ä¹Ÿå¯ä»¥åœ¨ SQL å®¢æˆ·ç«¯å¯åŠ¨åè®¾ç½®æ–¹è¨€ã€‚\nFlink SQL\u0026gt; set table.sql-dialect=hive; -- to use hive dialect [INFO] Session property has been set. Flink SQL\u0026gt; set table.sql-dialect=default; -- to use default dialect [INFO] Session property has been set. Table API You can set dialect for your TableEnvironment with Table API.\nfrom pyflink.table import * settings = EnvironmentSettings.new_instance().in_batch_mode().use_blink_planner().build() t_env = BatchTableEnvironment.create(environment_settings=settings) # to use hive dialect t_env.get_config().set_sql_dialect(SqlDialect.HIVE) # to use default dialect t_env.get_config().set_sql_dialect(SqlDialect.DEFAULT) DDL æœ¬èŠ‚åˆ—å‡ºäº† Hive æ–¹è¨€æ”¯æŒçš„ DDLã€‚åœ¨è¿™é‡Œæˆ‘ä»¬å°†ä¸»è¦å…³æ³¨è¯­æ³•ã€‚å…³äºæ¯ä¸ª DDL è¯­å¥çš„è¯­ä¹‰ï¼Œä½ å¯ä»¥å‚è€ƒ Hive æ–‡æ¡£ã€‚\nDATABASE  Show  SHOWDATABASES; Create  CREATE(DATABASE|SCHEMA)[IFNOTEXISTS]database_name[COMMENTdatabase_comment][LOCATIONfs_path][WITHDBPROPERTIES(property_name=property_value,...)]; Alter  æ›´æ–°å±æ€§\nALTER(DATABASE|SCHEMA)database_nameSETDBPROPERTIES(property_name=property_value,...);æ›´æ–°æ‰€æœ‰è€…\nALTER(DATABASE|SCHEMA)database_nameSETOWNER[USER|ROLE]user_or_role;æ›´æ–°ä½ç½®\nALTER(DATABASE|SCHEMA)database_nameSETLOCATIONfs_path; Drop  DROP(DATABASE|SCHEMA)[IFEXISTS]database_name[RESTRICT|CASCADE]; Use  USEdatabase_name;TABLE  Show  SHOWTABLES; Create  CREATE[EXTERNAL]TABLE[IFNOTEXISTS]table_name[(col_namedata_type[column_constraint][COMMENTcol_comment],...[table_constraint])][COMMENTtable_comment][PARTITIONEDBY(col_namedata_type[COMMENTcol_comment],...)][[ROWFORMATrow_format][STOREDASfile_format]][LOCATIONfs_path][TBLPROPERTIES(property_name=property_value,...)]row_format::DELIMITED[FIELDSTERMINATEDBYchar[ESCAPEDBYchar]][COLLECTIONITEMSTERMINATEDBYchar][MAPKEYSTERMINATEDBYchar][LINESTERMINATEDBYchar][NULLDEFINEDASchar]|SERDEserde_name[WITHSERDEPROPERTIES(property_name=property_value,...)]file_format::SEQUENCEFILE|TEXTFILE|RCFILE|ORC|PARQUET|AVRO|INPUTFORMATinput_format_classnameOUTPUTFORMAToutput_format_classnamecolumn_constraint::NOTNULL[[ENABLE|DISABLE][VALIDATE|NOVALIDATE][RELY|NORELY]]table_constraint::[CONSTRAINTconstraint_name]PRIMARYKEY(col_name,...)[[ENABLE|DISABLE][VALIDATE|NOVALIDATE][RELY|NORELY]] Alter  é‡å‘½å\nALTER TABLE table_name RENAME TO new_table_name; æ›´æ–°å±æ€§\nALTERTABLEtable_nameSETTBLPROPERTIES(property_name=property_value,property_name=property_value,...);æ›´æ–°ä½ç½®\nALTERTABLEtable_name[PARTITIONpartition_spec]SETLOCATIONfs_path;partition_spec å¦‚æœå­˜åœ¨ï¼Œéœ€è¦æ˜¯ä¸€ä¸ªå®Œæ•´çš„è§„æ ¼ï¼Œå³æœ‰æ‰€æœ‰åˆ†åŒºåˆ—çš„å€¼ã€‚è€Œå½“å®ƒå­˜åœ¨æ—¶ï¼Œæ“ä½œå°†è¢«åº”ç”¨åˆ°ç›¸åº”çš„åˆ†åŒºè€Œä¸æ˜¯è¡¨ã€‚\næ›´æ–°æ–‡ä»¶æ ¼å¼\nALTERTABLEtable_name[PARTITIONpartition_spec]SETFILEFORMATfile_format;partition_spec å¦‚æœå­˜åœ¨ï¼Œéœ€è¦æ˜¯ä¸€ä¸ªå®Œæ•´çš„è§„æ ¼ï¼Œå³æœ‰æ‰€æœ‰åˆ†åŒºåˆ—çš„å€¼ã€‚è€Œå½“å®ƒå­˜åœ¨æ—¶ï¼Œæ“ä½œå°†è¢«åº”ç”¨åˆ°ç›¸åº”çš„åˆ†åŒºè€Œä¸æ˜¯è¡¨ã€‚\næ›´æ–° SerDe å±æ€§\nALTERTABLEtable_name[PARTITIONpartition_spec]SETSERDEserde_class_name[WITHSERDEPROPERTIESserde_properties];ALTERTABLEtable_name[PARTITIONpartition_spec]SETSERDEPROPERTIESserde_properties;serde_properties::(property_name=property_value,property_name=property_value,...)partition_spec å¦‚æœå­˜åœ¨ï¼Œéœ€è¦æ˜¯ä¸€ä¸ªå®Œæ•´çš„è§„æ ¼ï¼Œå³æœ‰æ‰€æœ‰åˆ†åŒºåˆ—çš„å€¼ã€‚è€Œå½“å®ƒå­˜åœ¨æ—¶ï¼Œæ“ä½œå°†è¢«åº”ç”¨åˆ°ç›¸åº”çš„åˆ†åŒºè€Œä¸æ˜¯è¡¨ã€‚\næ·»åŠ åˆ†åŒº\nALTERTABLEtable_nameADD[IFNOTEXISTS](PARTITIONpartition_spec[LOCATIONfs_path])+; Drop Partitions  ALTERTABLEtable_nameDROP[IFEXISTS]PARTITIONpartition_spec[,PARTITIONpartition_spec,...]; æ–°å¢/æ›¿æ¢ åˆ—  ALTERTABLEtable_nameADD|REPLACECOLUMNS(col_namedata_type[COMMENTcol_comment],...)[CASCADE|RESTRICT] Change Column  ALTERTABLEtable_nameCHANGE[COLUMN]col_old_namecol_new_namecolumn_type[COMMENTcol_comment][FIRST|AFTERcolumn_name][CASCADE|RESTRICT]; Drop  DROPTABLE[IFEXISTS]table_name;VIEW  Create  CREATEVIEW[IFNOTEXISTS]view_name[(column_name,...)][COMMENTview_comment][TBLPROPERTIES(property_name=property_value,...)]ASSELECT...; Alter  æ³¨æ„ï¼šæ”¹å˜è§†å›¾åªåœ¨è¡¨ API ä¸­å·¥ä½œï¼Œä½†ä¸æ”¯æŒé€šè¿‡ SQL å®¢æˆ·ç«¯ã€‚\né‡å‘½å\nALTERVIEWview_nameRENAMETOnew_view_name;æ›´æ–°å±æ€§\nALTERVIEWview_nameSETTBLPROPERTIES(property_name=property_value,...); Update As Select  ALTERVIEWview_nameASselect_statement; Drop  DROPVIEW[IFEXISTS]view_name;FUNCTION  Show  SHOWFUNCTIONS; Create  CREATEFUNCTIONfunction_nameASclass_name;Drop\nDROPFUNCTION[IFEXISTS]function_name;DML NSERT INSERT(INTO|OVERWRITE)[TABLE]table_name[PARTITIONpartition_spec]SELECT...;partition_specï¼Œå¦‚æœå­˜åœ¨çš„è¯ï¼Œå¯ä»¥æ˜¯å®Œæ•´è§„æ ¼æˆ–éƒ¨åˆ†è§„æ ¼ã€‚å¦‚æœ partition_spec æ˜¯éƒ¨åˆ†è§„æ ¼ï¼ŒåŠ¨æ€åˆ†åŒºåˆ—åå¯ä»¥çœç•¥ã€‚\nDQL ç›®å‰ï¼ŒHive æ–¹è¨€æ”¯æŒçš„ DQL è¯­æ³•ä¸ Flink SQL ç›¸åŒã€‚è¯¦æƒ…è¯·å‚è€ƒ Flink SQL æŸ¥è¯¢ã€‚è€Œä¸”å»ºè®®åˆ‡æ¢åˆ°é»˜è®¤æ–¹è¨€æ¥æ‰§è¡Œ DQLã€‚\næ³¨æ„äº‹é¡¹ ä»¥ä¸‹æ˜¯ä½¿ç”¨ Hive æ–¹è¨€çš„ä¸€äº›æ³¨æ„äº‹é¡¹ã€‚\n Hive æ–¹è¨€åªèƒ½ç”¨äºæ“ä½œ Hive è¡¨ï¼Œè€Œä¸æ˜¯é€šç”¨è¡¨ã€‚è€Œä¸” Hive æ–¹è¨€åº”è¯¥å’Œ HiveCatalog ä¸€èµ·ä½¿ç”¨ã€‚ è™½ç„¶æ‰€æœ‰çš„ Hive ç‰ˆæœ¬éƒ½æ”¯æŒç›¸åŒçš„è¯­æ³•ï¼Œä½†æ˜¯å¦æœ‰ç‰¹å®šçš„åŠŸèƒ½è¿˜æ˜¯å–å†³äºä½ ä½¿ç”¨çš„ Hive ç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œæ›´æ–°æ•°æ®åº“ä½ç½®åªåœ¨ Hive-2.4.0 æˆ–æ›´é«˜ç‰ˆæœ¬ä¸­æ”¯æŒã€‚ Hive å’Œ Calcite æœ‰ä¸åŒçš„ä¿ç•™å…³é”®å­—é›†ã€‚ä¾‹å¦‚ï¼Œåœ¨ Calcite ä¸­é»˜è®¤æ˜¯ä¿ç•™å…³é”®å­—ï¼Œè€Œåœ¨ Hive ä¸­æ˜¯éä¿ç•™å…³é”®å­—ã€‚å³ä½¿æ˜¯ Hive æ–¹è¨€ï¼Œä½ ä¹Ÿå¿…é¡»ç”¨åå¼•å·ï¼ˆ`ï¼‰æ¥å¼•ç”¨è¿™äº›å…³é”®å­—ï¼Œæ‰èƒ½å°†å®ƒä»¬ä½œä¸ºæ ‡è¯†ç¬¦ä½¿ç”¨ã€‚ ç”±äºæ‰©å±•æŸ¥è¯¢ä¸å…¼å®¹ï¼Œåœ¨ Flink ä¸­åˆ›å»ºçš„è§†å›¾ä¸èƒ½åœ¨ Hive ä¸­æŸ¥è¯¢ã€‚  åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/hive/hive_dialect.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-25-hive-dialect/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL","Hive"],"title":"Hive æ–¹è¨€"},{"categories":["Flink"],"contents":"Hive é›†æˆ Apache Hive å·²ç»ç¡®ç«‹äº†è‡ªå·±ä½œä¸ºæ•°æ®ä»“åº“ç”Ÿæ€ç³»ç»Ÿçš„ç„¦ç‚¹ã€‚å®ƒä¸ä»…æ˜¯å¤§æ•°æ®åˆ†æå’Œ ETL çš„ SQL å¼•æ“ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ•°æ®ç®¡ç†å¹³å°ï¼Œåœ¨è¿™é‡Œï¼Œæ•°æ®è¢«å‘ç°ã€å®šä¹‰å’Œå‘å±•ã€‚\nFlink ä¸ Hive æä¾›äº†ä¸¤æ–¹é¢çš„æ•´åˆã€‚\nç¬¬ä¸€æ˜¯åˆ©ç”¨ Hive çš„ Metastore ä½œä¸ºä¸€ä¸ªæŒä¹…æ€§ç›®å½•ï¼Œä¸ Flink çš„ HiveCatalog è¿›è¡Œè·¨ä¼šè¯å­˜å‚¨ Flink ç‰¹å®šçš„å…ƒæ•°æ®ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ä½¿ç”¨ HiveCatalog å°† Kafka æˆ– ElasticSearch è¡¨å­˜å‚¨åœ¨ Hive Metastore ä¸­ï¼Œå¹¶åœ¨ä»¥åçš„ SQL æŸ¥è¯¢ä¸­é‡å¤ä½¿ç”¨ã€‚\näºŒæ˜¯æä¾› Flink ä½œä¸ºè¯»å†™ Hive è¡¨çš„æ›¿ä»£å¼•æ“ã€‚\nHiveCatalog çš„è®¾è®¡æ˜¯ \u0026ldquo;å¼€ç®±å³ç”¨\u0026rdquo;ï¼Œä¸ç°æœ‰çš„ Hive å®‰è£…å…¼å®¹ã€‚æ‚¨ä¸éœ€è¦ä¿®æ”¹ç°æœ‰çš„ Hive Metastoreï¼Œä¹Ÿä¸éœ€è¦æ”¹å˜æ•°æ®ä½ç½®æˆ–è¡¨çš„åˆ†åŒºã€‚\næ”¯æŒçš„ Hive ç‰ˆæœ¬ Flink æ”¯æŒä»¥ä¸‹ Hive ç‰ˆæœ¬ã€‚\n 1.0  1.0.0 1.0.1   1.1  1.1.0 1.1.1   1.2  1.2.0 1.2.1 1.2.2   2.0  2.0.0 2.0.1   2.1  2.1.0 2.1.1   2.2  2.2.0   2.3  2.3.0 2.3.1 2.3.2 2.3.3 2.3.4 2.3.5 2.3.6   3.1  3.1.0 3.1.1 3.1.2    è¯·æ³¨æ„ Hive æœ¬èº«åœ¨ä¸åŒçš„ç‰ˆæœ¬æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œè¿™äº›é—®é¢˜ä¸æ˜¯ Flink é€ æˆçš„ã€‚\n 1.2.0 åŠä»¥åç‰ˆæœ¬æ”¯æŒ Hive å†…ç½®å‡½æ•°ã€‚ 3.1.0 åŠä»¥åç‰ˆæœ¬æ”¯æŒåˆ—çº¦æŸï¼Œå³ PRIMARY KEY å’Œ NOT NULLã€‚ åœ¨ 1.2.0 åŠä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œæ”¯æŒä¿®æ”¹è¡¨çš„ç»Ÿè®¡æ•°æ®ã€‚ åœ¨ 1.2.0 åŠä»¥åçš„ç‰ˆæœ¬ä¸­æ”¯æŒ DATE åˆ—ç»Ÿè®¡ã€‚ åœ¨ 2.0.x ä¸­ä¸æ”¯æŒå†™å…¥ ORC è¡¨ã€‚  ä¾èµ–æ€§ ä¸ºäº†ä¸ Hive é›†æˆï¼Œä½ éœ€è¦åœ¨ Flink å‘è¡Œç‰ˆçš„ /lib/ ç›®å½•ä¸‹æ·»åŠ ä¸€äº›é¢å¤–çš„ä¾èµ–å…³ç³»ï¼Œä»¥ä½¿é›†æˆå·¥ä½œåœ¨ Table API ç¨‹åºæˆ– SQL å®¢æˆ·ç«¯ä¸­ã€‚å¦å¤–ï¼Œä½ ä¹Ÿå¯ä»¥å°†è¿™äº›ä¾èµ–é¡¹æ”¾åœ¨ä¸€ä¸ªä¸“é—¨çš„æ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶åˆ†åˆ«ç”¨ -C æˆ– -l é€‰é¡¹å°†å®ƒä»¬æ·»åŠ åˆ° classpath ä¸­ï¼Œç”¨äº Table API ç¨‹åºæˆ– SQL Clientã€‚\nApache Hive æ˜¯å»ºç«‹åœ¨ Hadoop ä¸Šçš„ï¼Œæ‰€ä»¥é¦–å…ˆéœ€è¦ Hadoop ä¾èµ–ï¼Œè¯·å‚è€ƒæä¾› Hadoop ç±»ã€‚\næœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥æ·»åŠ  Hive ä¾èµ–ã€‚é¦–å…ˆæ˜¯ä½¿ç”¨ Flink çš„æ†ç»‘å¼ Hive jarsã€‚ä½ å¯ä»¥æ ¹æ®ä½ ä½¿ç”¨çš„ metastore çš„ç‰ˆæœ¬æ¥é€‰æ‹©æ†ç»‘çš„ Hive jarã€‚ç¬¬äºŒç§æ˜¯åˆ†åˆ«æ·»åŠ æ¯ä¸ªæ‰€éœ€çš„ jarã€‚å¦‚æœä½ ä½¿ç”¨çš„ Hive ç‰ˆæœ¬æ²¡æœ‰åœ¨è¿™é‡Œåˆ—å‡ºï¼Œç¬¬äºŒç§æ–¹å¼å°±ä¼šå¾ˆæœ‰ç”¨ã€‚\nä½¿ç”¨æ†ç»‘çš„ Hive jar ä¸‹è¡¨åˆ—å‡ºäº†æ‰€æœ‰å¯ç”¨çš„æ†ç»‘çš„ hive jarï¼Œä½ å¯ä»¥é€‰æ‹©ä¸€ä¸ªåˆ° Flink å‘è¡Œç‰ˆçš„ /lib/ ç›®å½•ä¸‹ã€‚\n   Metastore version Maven dependency SQL Client JAR     1.0.0 - 1.2.2 flink-sql-connector-hive-1.2.2 Download   2.0.0 - 2.2.0 flink-sql-connector-hive-2.2.0 Download   2.3.0 - 2.3.6 flink-sql-connector-hive-2.3.6 Download   3.0.0 - 3.1.2 flink-sql-connector-hive-3.1.2 Download    ç”¨æˆ·å®šä¹‰çš„ä¾èµ–æ€§ è¯·åœ¨ä¸‹é¢æ‰¾åˆ°ä¸åŒ Hive ä¸»è¦ç‰ˆæœ¬æ‰€éœ€çš„ä¾èµ–å…³ç³»ã€‚\n Hive 2.3.4  /flink-1.11.0 /lib // Flink's Hive connector.Contains flink-hadoop-compatibility and flink-orc jars flink-connector-hive_2.11-1.11.0.jar // Hive dependencies hive-exec-2.3.4.jar  Hive 1.0.0  /flink-1.11.0 /lib // Flink's Hive connector flink-connector-hive_2.11-1.11.0.jar // Hive dependencies hive-metastore-1.0.0.jar hive-exec-1.0.0.jar libfb303-0.9.0.jar // libfb303 is not packed into hive-exec in some versions, need to add it separately // Orc dependencies -- required by the ORC vectorized optimizations orc-core-1.4.3-nohive.jar aircompressor-0.8.jar // transitive dependency of orc-core  Hive 1.1.0  /flink-1.11.0 /lib // Flink's Hive connector flink-connector-hive_2.11-1.11.0.jar // Hive dependencies hive-metastore-1.1.0.jar hive-exec-1.1.0.jar libfb303-0.9.2.jar // libfb303 is not packed into hive-exec in some versions, need to add it separately // Orc dependencies -- required by the ORC vectorized optimizations orc-core-1.4.3-nohive.jar aircompressor-0.8.jar // transitive dependency of orc-core  Hive 1.2.1  /flink-1.11.0 /lib // Flink's Hive connector flink-connector-hive_2.11-1.11.0.jar // Hive dependencies hive-metastore-1.2.1.jar hive-exec-1.2.1.jar libfb303-0.9.2.jar // libfb303 is not packed into hive-exec in some versions, need to add it separately // Orc dependencies -- required by the ORC vectorized optimizations orc-core-1.4.3-nohive.jar aircompressor-0.8.jar // transitive dependency of orc-core  Hive 2.0.0  /flink-1.11.0 /lib // Flink's Hive connector flink-connector-hive_2.11-1.11.0.jar // Hive dependencies hive-exec-2.0.0.jar  Hive 2.1.0  /flink-1.11.0 /lib // Flink's Hive connector flink-connector-hive_2.11-1.11.0.jar // Hive dependencies hive-exec-2.1.0.jar  Hive 2.2.0  /flink-1.11.0 /lib // Flink's Hive connector flink-connector-hive_2.11-1.11.0.jar // Hive dependencies hive-exec-2.2.0.jar // Orc dependencies -- required by the ORC vectorized optimizations orc-core-1.4.3.jar aircompressor-0.8.jar // transitive dependency of orc-core  Hive 3.1.0  /flink-1.11.0 /lib // Flink's Hive connector flink-connector-hive_2.11-1.11.0.jar // Hive dependencies hive-exec-3.1.0.jar libfb303-0.9.3.jar // libfb303 is not packed into hive-exec in some versions, need to add it separately Program maven å¦‚æœä½ æ­£åœ¨æ„å»ºä½ è‡ªå·±çš„ç¨‹åºï¼Œä½ éœ€è¦åœ¨ä½ çš„ mvn æ–‡ä»¶ä¸­åŠ å…¥ä»¥ä¸‹ä¾èµ–å…³ç³»ã€‚å»ºè®®ä¸è¦åœ¨ç”Ÿæˆçš„ jar æ–‡ä»¶ä¸­åŒ…å«è¿™äº›ä¾èµ–å…³ç³»ã€‚ä½ åº”è¯¥åœ¨è¿è¡Œæ—¶æ·»åŠ ä¸Šé¢æ‰€è¯´çš„ä¾èµ–å…³ç³»ã€‚\n\u0026lt;!-- Flink Dependency --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.flink\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flink-connector-hive_2.11\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.11.0\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.flink\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flink-table-api-java-bridge_2.11\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.11.0\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- Hive Dependency --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.hive\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;hive-exec\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;${hive.version}\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; è¿æ¥åˆ° Hive é€šè¿‡è¡¨ç¯å¢ƒæˆ– YAML é…ç½®ï¼Œä½¿ç”¨ç›®å½•æ¥å£å’Œ HiveCatalog è¿æ¥åˆ°ç°æœ‰çš„ Hive å®‰è£…ã€‚\nå¦‚æœ hive-conf/hive-site.xml æ–‡ä»¶å­˜å‚¨åœ¨è¿œç¨‹å­˜å‚¨ç³»ç»Ÿä¸­ï¼Œç”¨æˆ·åº”å…ˆå°† hive é…ç½®æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ç¯å¢ƒä¸­ã€‚\nè¯·æ³¨æ„ï¼Œè™½ç„¶ HiveCatalog ä¸éœ€è¦ç‰¹å®šçš„è§„åˆ’å¸ˆï¼Œä½†è¯»/å†™ Hive è¡¨åªé€‚ç”¨äº blink è§„åˆ’å¸ˆã€‚å› æ­¤å¼ºçƒˆå»ºè®®æ‚¨åœ¨è¿æ¥ Hive ä»“åº“æ—¶ä½¿ç”¨ blink plannerã€‚\nHiveCatalog èƒ½å¤Ÿè‡ªåŠ¨æ£€æµ‹ä½¿ç”¨ä¸­çš„ Hive ç‰ˆæœ¬ã€‚å»ºè®®ä¸è¦æŒ‡å®š Hive ç‰ˆæœ¬ï¼Œé™¤éè‡ªåŠ¨æ£€æµ‹å¤±è´¥ã€‚\nä»¥ Hive 2.3.4 ç‰ˆæœ¬ä¸ºä¾‹ã€‚\nval settings = EnvironmentSettings.newInstance().inBatchMode().build() val tableEnv = TableEnvironment.create(settings) val name = \u0026#34;myhive\u0026#34; val defaultDatabase = \u0026#34;mydatabase\u0026#34; val hiveConfDir = \u0026#34;/opt/hive-conf\u0026#34; // a local path  val hive = new HiveCatalog(name, defaultDatabase, hiveConfDir) tableEnv.registerCatalog(\u0026#34;myhive\u0026#34;, hive) // set the HiveCatalog as the current catalog of the session tableEnv.useCatalog(\u0026#34;myhive\u0026#34;) DDL å»ºè®®ä½¿ç”¨ Hive æ–¹è¨€åœ¨ Flink ä¸­æ‰§è¡Œ DDL æ¥åˆ›å»º Hive è¡¨ã€è§†å›¾ã€åˆ†åŒºã€å‡½æ•°ã€‚\nDML Flink æ”¯æŒ DML å†™å…¥ Hive è¡¨ã€‚è¯·å‚è€ƒè¯»å†™ Hive è¡¨çš„ç»†èŠ‚ã€‚\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/hive/\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-25-hive-integration-overview/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL","Hive"],"title":"Hive é›†æˆ - æ¦‚è§ˆ"},{"categories":["Flink"],"contents":"HiveCatalog Hive Metastore ç»è¿‡å¤šå¹´çš„å‘å±•ï¼Œå·²ç»æˆä¸º Hadoop ç”Ÿæ€ç³»ç»Ÿä¸­äº‹å®ä¸Šçš„å…ƒæ•°æ®ä¸­å¿ƒã€‚å¾ˆå¤šå…¬å¸åœ¨ç”Ÿäº§ä¸­éƒ½æœ‰ä¸€ä¸ª Hive Metastore æœåŠ¡å®ä¾‹æ¥ç®¡ç†ä»–ä»¬æ‰€æœ‰çš„å…ƒæ•°æ®ï¼Œæ— è®ºæ˜¯ Hive å…ƒæ•°æ®è¿˜æ˜¯é Hive å…ƒæ•°æ®ï¼Œéƒ½æ˜¯çœŸç†çš„æ¥æºã€‚\nå¯¹äºåŒæ—¶éƒ¨ç½²äº† Hive å’Œ Flink çš„ç”¨æˆ·ï¼ŒHiveCatalog å¯ä»¥è®©ä»–ä»¬ä½¿ç”¨ Hive Metastore æ¥ç®¡ç† Flink çš„å…ƒæ•°æ®ã€‚\nå¯¹äºåªæœ‰ Flink éƒ¨ç½²çš„ç”¨æˆ·æ¥è¯´ï¼ŒHiveCatalog æ˜¯ Flink å¼€ç®±å³ç”¨çš„å”¯ä¸€æŒä¹…åŒ–ç›®å½•ã€‚å¦‚æœæ²¡æœ‰æŒä¹…åŒ–ç›®å½•ï¼Œç”¨æˆ·ä½¿ç”¨ Flink SQL CREATE DDL å¿…é¡»åœ¨æ¯ä¸ªä¼šè¯ä¸­åå¤åˆ›å»ºå…ƒå¯¹è±¡ï¼Œæ¯”å¦‚ Kafka è¡¨ï¼Œè¿™å°±æµªè´¹äº†å¾ˆå¤šæ—¶é—´ã€‚HiveCatalog å¡«è¡¥äº†è¿™ä¸€ç©ºç™½ï¼Œä½¿ç”¨æˆ·åªéœ€åˆ›å»ºä¸€æ¬¡è¡¨å’Œå…¶ä»–å…ƒå¯¹è±¡ï¼Œä»¥åå°±å¯ä»¥è·¨ä¼šè¯æ–¹ä¾¿åœ°å¼•ç”¨å’Œç®¡ç†å®ƒä»¬ã€‚\nè®¾ç½® HiveCatalog ä¾èµ–æ€§ åœ¨ Flink ä¸­è®¾ç½® HiveCatalog éœ€è¦ä¸ Flink-Hive é›†æˆç›¸åŒçš„ä¾èµ–å…³ç³»ã€‚\né…ç½® åœ¨ Flink ä¸­è®¾ç½® HiveCatalog éœ€è¦ä¸ Flink-Hive é›†æˆç›¸åŒçš„é…ç½®ã€‚\nå¦‚ä½•ä½¿ç”¨ HiveCatalog ä¸€æ—¦é…ç½®å¾—å½“ï¼ŒHiveCatalog åº”è¯¥å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚ç”¨æˆ·å¯ä»¥ç”¨ DDL åˆ›å»º Flink å…ƒå¯¹è±¡ï¼Œå¹¶åœ¨åˆ›å»ºåç«‹å³çœ‹åˆ°å®ƒä»¬ã€‚\nHiveCatalog å¯ä»¥ç”¨æ¥å¤„ç†ä¸¤ç§è¡¨ã€‚Hive å…¼å®¹è¡¨å’Œé€šç”¨è¡¨ã€‚Hive-compatible è¡¨æ˜¯æŒ‡é‚£äº›ä»¥ Hive å…¼å®¹çš„æ–¹å¼å­˜å‚¨çš„è¡¨ï¼Œåœ¨å­˜å‚¨å±‚çš„å…ƒæ•°æ®å’Œæ•°æ®æ–¹é¢éƒ½æ˜¯å¦‚æ­¤ã€‚å› æ­¤ï¼Œé€šè¿‡ Flink åˆ›å»ºçš„ Hive å…¼å®¹è¡¨å¯ä»¥ä» Hive ç«¯è¿›è¡ŒæŸ¥è¯¢ã€‚\nè€Œé€šç”¨è¡¨åˆ™æ˜¯é’ˆå¯¹ Flink çš„ã€‚å½“ä½¿ç”¨ HiveCatalog åˆ›å»ºé€šç”¨è¡¨æ—¶ï¼Œæˆ‘ä»¬åªæ˜¯ä½¿ç”¨ HMS æ¥æŒä¹…åŒ–å…ƒæ•°æ®ã€‚è™½ç„¶è¿™äº›è¡¨å¯¹ Hive æ˜¯å¯è§çš„ï¼Œä½† Hive ä¸å¤ªå¯èƒ½ç†è§£è¿™äº›å…ƒæ•°æ®ã€‚å› æ­¤åœ¨ Hive ä¸­ä½¿ç”¨è¿™æ ·çš„è¡¨ä¼šå¯¼è‡´æœªå®šä¹‰çš„è¡Œä¸ºã€‚\nFlink ä½¿ç”¨å±æ€§ \u0026ldquo;is_generic\u0026rdquo; æ¥åˆ¤æ–­ä¸€ä¸ªè¡¨æ˜¯ä¸ Hive å…¼å®¹è¿˜æ˜¯é€šç”¨ã€‚å½“ç”¨ HiveCatalog åˆ›å»ºä¸€ä¸ªè¡¨æ—¶ï¼Œå®ƒé»˜è®¤è¢«è®¤ä¸ºæ˜¯é€šç”¨çš„ã€‚å¦‚æœä½ æƒ³åˆ›å»ºä¸€ä¸ª Hive å…¼å®¹çš„è¡¨ï¼Œè¯·ç¡®ä¿åœ¨ä½ çš„è¡¨å±æ€§ä¸­æŠŠ is_generic è®¾ç½®ä¸º falseã€‚\nå¦‚ä¸Šæ‰€è¿°ï¼Œé€šç”¨è¡¨ä¸åº”è¯¥ä» Hive ä½¿ç”¨ã€‚åœ¨ Hive CLI ä¸­ï¼Œä½ å¯ä»¥è°ƒç”¨ describe FORMATTED å¯¹ä¸€ä¸ªè¡¨è¿›è¡Œæ£€æŸ¥ï¼Œé€šè¿‡æ£€æŸ¥ is_generic å±æ€§æ¥å†³å®šå®ƒæ˜¯å¦æ˜¯é€šç”¨çš„ã€‚é€šç”¨è¡¨ä¼šæœ‰ is_generic=trueã€‚\nä¾‹å­ æˆ‘ä»¬åœ¨è¿™é‡Œå°†é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­è¿›è¡Œè®²è§£ã€‚\nç¬¬ 1 æ­¥ï¼šè®¾ç½® Hive Metastoreã€‚\næœ‰ä¸€ä¸ª Hive Metastore åœ¨è¿è¡Œã€‚\nåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åœ¨æœ¬åœ°è·¯å¾„ /opt/hive-conf/hive-site.xml ä¸­è®¾ç½®ä¸€ä¸ªæœ¬åœ° Hive Metastore å’Œæˆ‘ä»¬çš„ hive-site.xml æ–‡ä»¶ã€‚æˆ‘ä»¬æœ‰å¦‚ä¸‹çš„ä¸€äº›é…ç½®ã€‚\n\u0026lt;configuration\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;javax.jdo.option.ConnectionURL\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;jdbc:mysql://localhost/metastore?createDatabaseIfNotExist=true\u0026lt;/value\u0026gt; \u0026lt;description\u0026gt;metadata is stored in a MySQL server\u0026lt;/description\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;javax.jdo.option.ConnectionDriverName\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;com.mysql.jdbc.Driver\u0026lt;/value\u0026gt; \u0026lt;description\u0026gt;MySQL JDBC driver class\u0026lt;/description\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;javax.jdo.option.ConnectionUserName\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;...\u0026lt;/value\u0026gt; \u0026lt;description\u0026gt;user name for connecting to mysql server\u0026lt;/description\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;javax.jdo.option.ConnectionPassword\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;...\u0026lt;/value\u0026gt; \u0026lt;description\u0026gt;password for connecting to mysql server\u0026lt;/description\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;hive.metastore.uris\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;thrift://localhost:9083\u0026lt;/value\u0026gt; \u0026lt;description\u0026gt;IP address (or fully-qualified domain name) and port of the metastore host\u0026lt;/description\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;property\u0026gt; \u0026lt;name\u0026gt;hive.metastore.schema.verification\u0026lt;/name\u0026gt; \u0026lt;value\u0026gt;true\u0026lt;/value\u0026gt; \u0026lt;/property\u0026gt; \u0026lt;/configuration\u0026gt; ç”¨ Hive Cli æµ‹è¯•è¿æ¥åˆ° HMSã€‚è¿è¡Œä¸€äº›å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æœ‰ä¸€ä¸ªåä¸º default çš„æ•°æ®åº“ï¼Œé‡Œé¢æ²¡æœ‰è¡¨ã€‚\nhive\u0026gt; show databases; OK default Time taken: 0.032 seconds, Fetched: 1 row(s) hive\u0026gt; show tables; OK Time taken: 0.028 seconds, Fetched: 0 row(s) æ­¥éª¤ 2ï¼šé…ç½® Flink é›†ç¾¤å’Œ SQL CLI\nå°†æ‰€æœ‰ Hive çš„ä¾èµ–å…³ç³»æ·»åŠ åˆ° Flink å‘è¡Œç‰ˆçš„ /lib ç›®å½•ä¸‹ï¼Œå¹¶ä¿®æ”¹ SQL CLI çš„ yaml é…ç½®æ–‡ä»¶ sql-cli-defaults.yaml å¦‚ä¸‹ã€‚\nexecution:planner:blinktype:streaming...current-catalog:myhive # set the HiveCatalog as the current catalog of the sessioncurrent-database:mydatabasecatalogs:- name:myhivetype:hivehive-conf-dir:/opt/hive-conf # contains hive-site.xmlç¬¬ä¸‰æ­¥ï¼šå»ºç«‹ Kafka é›†ç¾¤\nBootstrap ä¸€ä¸ªæœ¬åœ°çš„ Kafka 2.3.0 é›†ç¾¤ï¼Œä¸»é¢˜å‘½åä¸º \u0026ldquo;test\u0026rdquo;ï¼Œå¹¶ä»¥ name å’Œ age çš„å…ƒç»„å½¢å¼å‘ä¸»é¢˜äº§ç”Ÿä¸€äº›ç®€å•çš„æ•°æ®ã€‚\nlocalhost$ bin/kafka-console-producer.sh --broker-list localhost:9092 --topic test \u0026gt;tom,15 \u0026gt;john,21 è¿™äº›æ¶ˆæ¯å¯ä»¥é€šè¿‡å¯åŠ¨ Kafka æ§åˆ¶å°æ¶ˆè´¹è€…çœ‹åˆ°ã€‚\nlocalhost$ bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --from-beginning tom,15 john,21 ç¬¬å››æ­¥ï¼šå¯åŠ¨ SQL Clientï¼Œç”¨ Flink SQL DDL åˆ›å»ºä¸€ä¸ª Kafka è¡¨ã€‚\nå¯åŠ¨ Flink SQL Clientï¼Œé€šè¿‡ DDL åˆ›å»ºä¸€ä¸ªç®€å•çš„ Kafka 2.3.0 è¡¨ï¼Œå¹¶éªŒè¯å…¶æ¨¡å¼ã€‚\nFlinkSQL\u0026gt;CREATETABLEmykafka(nameString,ageInt)WITH(\u0026#39;connector.type\u0026#39;=\u0026#39;kafka\u0026#39;,\u0026#39;connector.version\u0026#39;=\u0026#39;universal\u0026#39;,\u0026#39;connector.topic\u0026#39;=\u0026#39;test\u0026#39;,\u0026#39;connector.properties.bootstrap.servers\u0026#39;=\u0026#39;localhost:9092\u0026#39;,\u0026#39;format.type\u0026#39;=\u0026#39;csv\u0026#39;,\u0026#39;update-mode\u0026#39;=\u0026#39;append\u0026#39;);[INFO]Tablehasbeencreated.FlinkSQL\u0026gt;DESCRIBEmykafka;root|-- name: STRING |-- age: INT éªŒè¯è¯¥è¡¨ä¹Ÿæ˜¯é€šè¿‡ Hive Cli å¯¹ Hive å¯è§çš„ï¼Œæ³¨æ„è¯¥è¡¨æœ‰å±æ€§ is_generic=trueã€‚\nhive\u0026gt; show tables; OK mykafka Time taken: 0.038 seconds, Fetched: 1 row(s) hive\u0026gt; describe formatted mykafka; OK # col_name data_type comment # Detailed Table Information Database: default Owner: null CreateTime: ...... LastAccessTime: UNKNOWN Retention: 0 Location: ...... Table Type: MANAGED_TABLE Table Parameters: flink.connector.properties.bootstrap.servers\tlocalhost:9092 flink.connector.topic\ttest flink.connector.type\tkafka flink.connector.version\tuniversal flink.format.type csv flink.generic.table.schema.0.data-type\tVARCHAR(2147483647) flink.generic.table.schema.0.name\tname flink.generic.table.schema.1.data-type\tINT flink.generic.table.schema.1.name\tage flink.update-mode append is_generic true transient_lastDdlTime\t...... # Storage Information SerDe Library: org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe InputFormat: org.apache.hadoop.mapred.TextInputFormat OutputFormat: org.apache.hadoop.hive.ql.io.IgnoreKeyTextOutputFormat Compressed: No Num Buckets: -1 Bucket Columns: [] Sort Columns: [] Storage Desc Params: serialization.format\t1 Time taken: 0.158 seconds, Fetched: 36 row(s) ç¬¬äº”æ­¥ï¼šè¿è¡Œ Flink SQL æŸ¥è¯¢ Kakfa è¡¨ã€‚\nåœ¨ Flink é›†ç¾¤ä¸­ï¼Œæ— è®ºæ˜¯å•æœºè¿˜æ˜¯ yarn-sessionï¼Œä» Flink SQL Client ä¸­è¿è¡Œä¸€ä¸ªç®€å•çš„é€‰æ‹©æŸ¥è¯¢ã€‚\nFlink SQL\u0026gt; select * from mykafka; åœ¨ Kafka ä¸»é¢˜ä¸­å¤šäº§ç”Ÿä¸€äº›ä¿¡æ¯ã€‚\nlocalhost$ bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic test --from-beginning tom,15 john,21 kitty,30 amy,24 kaiky,18 ä½ ç°åœ¨åº”è¯¥å¯ä»¥åœ¨ SQL Client ä¸­çœ‹åˆ° Flink äº§ç”Ÿçš„ç»“æœï¼Œå¦‚ã€‚\n SQL Query Result (Table) Refresh: 1 s Page: Last of 1 name age tom 15 john 21 kitty 30 amy 24 kaiky 18 æ”¯æŒçš„ç±»å‹ HiveCatalog æ”¯æŒé€šç”¨è¡¨çš„æ‰€æœ‰ Flink ç±»å‹ã€‚\nå¯¹äº Hive å…¼å®¹çš„è¡¨ï¼ŒHiveCatalog éœ€è¦å°† Flink æ•°æ®ç±»å‹æ˜ å°„åˆ°ç›¸åº”çš„ Hive ç±»å‹ï¼Œå¦‚ä¸‹è¡¨æ‰€è¿°ã€‚\n   Flink Data Type Hive Data Type     CHAR(p) CHAR(p)   VARCHAR(p) VARCHAR(p)   STRING STRING   BOOLEAN BOOLEAN   TINYINT TINYINT   SMALLINT SMALLINT   INT INT   BIGINT LONG   FLOAT FLOAT   DOUBLE DOUBLE   DECIMAL(p, s) DECIMAL(p, s)   DATE DATE   TIMESTAMP(9) TIMESTAMP   BYTES BINARY   ARRAY LIST   MAP\u0026lt;K, V\u0026gt; MAP\u0026lt;K, V\u0026gt;   ROW STRUCT    å…³äºç±»å‹æ˜ å°„éœ€è¦æ³¨æ„çš„åœ°æ–¹ã€‚\n Hive çš„ CHAR(p) æœ€å¤§é•¿åº¦ä¸º 255ã€‚ Hive çš„ VARCHAR(p) æœ€å¤§é•¿åº¦ä¸º 65535ã€‚ Hive çš„ MAP åªæ”¯æŒåŸºå…ƒé”®ç±»å‹ï¼Œè€Œ Flink çš„ MAP å¯ä»¥æ˜¯ä»»ä½•æ•°æ®ç±»å‹ã€‚ ä¸æ”¯æŒ Hive çš„ UNION ç±»å‹ã€‚ Hive çš„ TIMESTAMP çš„ç²¾åº¦æ€»æ˜¯ 9ï¼Œä¸æ”¯æŒå…¶ä»–ç²¾åº¦ã€‚è€Œ Hive çš„ UDF åˆ™å¯ä»¥å¤„ç†ç²¾åº¦\u0026lt;=9 çš„ TIMESTAMP å€¼ã€‚ Hive ä¸æ”¯æŒ Flink çš„ TIMESTAMP_WITH_TIME_ZONEã€TIMESTAMP_WITH_LOCAL_TIME_ZONE å’Œ MULTISETã€‚ Flink çš„ INTERVAL ç±»å‹è¿˜ä¸èƒ½æ˜ å°„åˆ° Hive çš„ INTERVAL ç±»å‹ã€‚  Scala Shell æ³¨æ„ï¼šç”±äºç›®å‰ Scala Shell å¹¶ä¸æ”¯æŒ blink plannerï¼Œæ‰€ä»¥ä¸å»ºè®®åœ¨ Scala Shell ä¸­ä½¿ç”¨ Hive è¿æ¥å™¨ã€‚\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/hive/hive_catalog.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-25-hivecatalog/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL"],"title":"HiveCatalog"},{"categories":["Flink"],"contents":"æµå¼èšåˆ SQL æ˜¯æ•°æ®åˆ†æä¸­ä½¿ç”¨æœ€å¹¿æ³›çš„è¯­è¨€ã€‚Flink çš„ Table API å’Œ SQL å¯ä»¥è®©ç”¨æˆ·ç”¨æ›´å°‘çš„æ—¶é—´å’Œç²¾åŠ›å®šä¹‰é«˜æ•ˆçš„æµåˆ†æåº”ç”¨ã€‚æ­¤å¤–ï¼ŒFlink Table API å’Œ SQL è¿˜è¿›è¡Œäº†æœ‰æ•ˆçš„ä¼˜åŒ–ï¼Œå®ƒé›†æˆäº†å¤§é‡çš„æŸ¥è¯¢ä¼˜åŒ–å’Œè°ƒæ•´åçš„è¿ç®—ç¬¦å®ç°ã€‚ä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„ä¼˜åŒ–éƒ½æ˜¯é»˜è®¤å¯ç”¨çš„ï¼Œæ‰€ä»¥å¯¹äºä¸€äº›å·¥ä½œè´Ÿè½½ï¼Œå¯ä»¥é€šè¿‡å¼€å¯ä¸€äº›é€‰é¡¹æ¥æé«˜æ€§èƒ½ã€‚\nåœ¨æœ¬é¡µé¢ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸€äº›æœ‰ç”¨çš„ä¼˜åŒ–é€‰é¡¹å’Œæµå¼èšåˆçš„å†…éƒ¨ç»“æ„ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ä¼šå¸¦æ¥å¾ˆå¤§çš„æ”¹å–„ã€‚\næ³¨æ„: ç›®å‰ï¼Œæœ¬é¡µé¢ä¸­æåˆ°çš„ä¼˜åŒ–é€‰é¡¹ä»…åœ¨ Blink è®¡åˆ’å™¨ä¸­æ”¯æŒã€‚\næ³¨æ„: ç›®å‰ï¼Œæµå¼èšåˆçš„ä¼˜åŒ–åªæ”¯æŒæ— è¾¹ç•Œèšåˆã€‚æœªæ¥å°†æ”¯æŒçª—å£èšåˆçš„ä¼˜åŒ–ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œæ— ç•Œèšåˆè¿ç®—ç¬¦å¯¹è¾“å…¥è®°å½•è¿›è¡Œé€ä¸€å¤„ç†ï¼Œå³ï¼šï¼ˆ1ï¼‰ä»çŠ¶æ€ä¸­è¯»å–ç´¯åŠ å™¨ï¼Œï¼ˆ2ï¼‰ç´¯åŠ /ç¼©å‡è®°å½•åˆ°ç´¯åŠ å™¨ï¼Œï¼ˆ3ï¼‰å°†ç´¯åŠ å™¨å†™å›çŠ¶æ€ï¼Œï¼ˆ4ï¼‰ä¸‹ä¸€æ¡è®°å½•å°†ä»ï¼ˆ1ï¼‰å¼€å§‹é‡æ–°åšå¤„ç†ã€‚è¿™ç§å¤„ç†æ¨¡å¼å¯èƒ½ä¼šå¢åŠ  StateBackend çš„å¼€é”€ï¼ˆå°¤å…¶æ˜¯å¯¹äº RocksDB StateBackendï¼‰ã€‚æ­¤å¤–ï¼Œåœ¨ç”Ÿäº§ä¸­å¾ˆå¸¸è§çš„æ•°æ®åæ–œä¹Ÿä¼šä½¿é—®é¢˜æ›´åŠ ä¸¥é‡ï¼Œå®¹æ˜“å‡ºç°ä½œä¸šèƒŒå‹çš„æƒ…å†µã€‚\nè¿·ä½ æ‰¹å¤„ç†(MiniBatch)èšåˆ è¿·ä½ æ‰¹å¤„ç†(mini-batch)èšåˆçš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†ä¸€æ†è¾“å…¥ç¼“å­˜åœ¨èšåˆè¿ç®—å™¨å†…éƒ¨çš„ç¼“å†²åŒºä¸­ã€‚å½“è§¦å‘å¤„ç†è¯¥æ†è¾“å…¥æ—¶ï¼Œæ¯ä¸ªé”®åªéœ€è¦ä¸€ä¸ªæ“ä½œæ¥è®¿é—®çŠ¶æ€ã€‚è¿™æ ·å¯ä»¥å¤§å¤§é™ä½çŠ¶æ€å¼€é”€ï¼Œè·å¾—æ›´å¥½çš„ååé‡ã€‚ä½†æ˜¯ï¼Œè¿™å¯èƒ½ä¼šå¢åŠ ä¸€äº›å»¶è¿Ÿï¼Œå› ä¸ºå®ƒç¼“å†²äº†ä¸€äº›è®°å½•ï¼Œè€Œä¸æ˜¯åœ¨ç¬é—´å¤„ç†å®ƒä»¬ã€‚è¿™å°±æ˜¯ååé‡å’Œå»¶è¿Ÿä¹‹é—´çš„æƒè¡¡ã€‚\nä¸‹å›¾è§£é‡Šäº†è¿·ä½ æ‰¹å¤„ç†èšåˆå¦‚ä½•å‡å°‘çŠ¶æ€æ“ä½œã€‚\nMiniBatch ä¼˜åŒ–é»˜è®¤ä¸ºç¦ç”¨ã€‚ä¸ºäº†å¯ç”¨æ­¤ä¼˜åŒ–ï¼Œæ‚¨åº”è¯¥è®¾ç½®é€‰é¡¹ table.exec.mini-batch.enabledã€table.exec.mini-batch.allow-latency å’Œ table.exec.mini-batch.sizeã€‚è¯·å‚é˜…é…ç½®é¡µé¢äº†è§£æ›´å¤šè¯¦æƒ…ã€‚\nä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•å¯ç”¨è¿™äº›é€‰é¡¹ã€‚\n// instantiate table environment val tEnv: TableEnvironment = ... // access flink configuration val configuration = tEnv.getConfig().getConfiguration() // set low-level key-value options configuration.setString(\u0026#34;table.exec.mini-batch.enabled\u0026#34;, \u0026#34;true\u0026#34;) // enable mini-batch optimization configuration.setString(\u0026#34;table.exec.mini-batch.allow-latency\u0026#34;, \u0026#34;5 s\u0026#34;) // use 5 seconds to buffer input records configuration.setString(\u0026#34;table.exec.mini-batch.size\u0026#34;, \u0026#34;5000\u0026#34;) // the maximum number of records can be buffered by each aggregate operator task Local-Global èšåˆ Local-Global æ˜¯ä¸ºäº†è§£å†³æ•°æ®åæ–œé—®é¢˜è€Œæå‡ºçš„ï¼Œå°†ä¸€ä¸ªåˆ†ç»„èšåˆåˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼Œå³å…ˆåœ¨ä¸Šæ¸¸åšå±€éƒ¨èšåˆï¼Œç„¶ååœ¨ä¸‹æ¸¸åšå…¨å±€èšåˆï¼Œè¿™ç±»ä¼¼äº MapReduce ä¸­çš„ Combine+Reduce æ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä»¥ä¸‹ SQLã€‚\nSELECTcolor,sum(id)FROMTGROUPBYcoloræœ‰å¯èƒ½æ•°æ®æµä¸­çš„è®°å½•æ˜¯å€¾æ–œçš„ï¼Œå› æ­¤ä¸€äº›èšåˆè¿ç®—ç¬¦å®ä¾‹è¦å¤„ç†çš„è®°å½•æ¯”å…¶ä»–å®ä¾‹å¤šå¾—å¤šï¼Œä»è€Œå¯¼è‡´çƒ­ç‚¹ã€‚æœ¬åœ°èšåˆå¯ä»¥å¸®åŠ©å°†ä¸€å®šæ•°é‡çš„å…·æœ‰ç›¸åŒé”®çš„è¾“å…¥ç´¯ç§¯åˆ°ä¸€ä¸ªç´¯ç§¯å™¨ä¸­ã€‚å…¨å±€èšåˆå°†åªæ¥æ”¶å‡å°‘çš„ç´¯åŠ å™¨ï¼Œè€Œä¸æ˜¯å¤§é‡çš„åŸå§‹è¾“å…¥ã€‚è¿™å¯ä»¥æ˜¾è‘—é™ä½ç½‘ç»œæ´—ç‰Œå’ŒçŠ¶æ€è®¿é—®çš„æˆæœ¬ã€‚æœ¬åœ°èšåˆæ¯æ¬¡ç§¯ç´¯çš„è¾“å…¥æ•°é‡æ˜¯åŸºäºå°æ‰¹é‡é—´éš”çš„ã€‚è¿™æ„å‘³ç€æœ¬åœ°-å…¨å±€èšåˆå–å†³äºè¿·ä½ æ‰¹é‡ä¼˜åŒ–çš„å¯ç”¨ã€‚\nä¸‹å›¾æ˜¾ç¤ºäº†æœ¬åœ°-å…¨å±€èšåˆå¦‚ä½•æé«˜æ€§èƒ½ã€‚\nä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•å¯ç”¨æœ¬åœ°-å…¨å±€èšåˆã€‚\n// instantiate table environment val tEnv: TableEnvironment = ... // access flink configuration val configuration = tEnv.getConfig().getConfiguration() // set low-level key-value options configuration.setString(\u0026#34;table.exec.mini-batch.enabled\u0026#34;, \u0026#34;true\u0026#34;) // local-global aggregation depends on mini-batch is enabled configuration.setString(\u0026#34;table.exec.mini-batch.allow-latency\u0026#34;, \u0026#34;5 s\u0026#34;) configuration.setString(\u0026#34;table.exec.mini-batch.size\u0026#34;, \u0026#34;5000\u0026#34;) configuration.setString(\u0026#34;table.optimizer.agg-phase-strategy\u0026#34;, \u0026#34;TWO_PHASE\u0026#34;) // enable two-phase, i.e. local-global aggregation Split Distinct èšåˆ Local-Global ä¼˜åŒ–å¯¹äºä¸€èˆ¬çš„èšåˆï¼Œå¦‚ SUMã€COUNTã€MAXã€MINã€AVGï¼Œå¯ä»¥æœ‰æ•ˆåœ°æ¶ˆé™¤æ•°æ®åæ–œã€‚ä½†åœ¨å¤„ç†ä¸åŒçš„èšåˆæ—¶ï¼Œå…¶æ€§èƒ½å¹¶ä¸ç†æƒ³ã€‚\nä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åˆ†æä»Šå¤©æœ‰å¤šå°‘ç‹¬ç‰¹çš„ç”¨æˆ·ç™»å½•ã€‚æˆ‘ä»¬å¯ä»¥æœ‰å¦‚ä¸‹æŸ¥è¯¢:\nSELECTday,COUNT(DISTINCTuser_id)FROMTGROUPBYdayå¦‚æœ distinct keyï¼ˆå³ user_idï¼‰çš„å€¼å¾ˆç¨€ç–ï¼Œcount distinct ä¸å¥½å‡å°‘è®°å½•ã€‚å³ä½¿å¯ç”¨äº†å±€éƒ¨-å…¨å±€ä¼˜åŒ–ï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¸®åŠ©ã€‚å› ä¸ºç´¯åŠ å™¨ä»ç„¶åŒ…å«äº†å‡ ä¹æ‰€æœ‰çš„åŸå§‹è®°å½•ï¼Œè€Œå…¨å±€èšåˆå°†æ˜¯ç“¶é¢ˆï¼ˆå¤§éƒ¨åˆ†é‡åº¦ç´¯åŠ å™¨æ˜¯ç”±ä¸€ä¸ªä»»åŠ¡å¤„ç†çš„ï¼Œå³åœ¨åŒä¸€å¤©ï¼‰ã€‚\nè¿™ä¸ªä¼˜åŒ–çš„æ€è·¯æ˜¯å°†ä¸åŒçš„èšåˆï¼ˆå¦‚ COUNT(DISTINCT col)ï¼‰åˆ†æˆä¸¤ä¸ªå±‚æ¬¡ã€‚ç¬¬ä¸€å±‚èšåˆç”±ç»„é”®å’Œä¸€ä¸ªé¢å¤–çš„æ¡¶é”®è¿›è¡Œæ´—ç‰Œã€‚æ¡¶é”®ä½¿ç”¨ HASH_CODE(distinct_key) % BUCKET_NUM è®¡ç®—ã€‚BUCKET_NUM é»˜è®¤ä¸º 1024ï¼Œå¯ä»¥é€šè¿‡ table.optimizer.distinct-agg.split.bucket-num é€‰é¡¹è¿›è¡Œé…ç½®ã€‚ç¬¬äºŒæ¬¡èšåˆæ˜¯æŒ‰åŸç»„é”®è¿›è¡Œæ´—ç‰Œï¼Œç”¨ SUM èšåˆä¸åŒæ¡¶çš„ COUNT DISTINCT å€¼ã€‚å› ä¸ºç›¸åŒçš„ distinct key åªä¼šåœ¨åŒä¸€ä¸ª bucket ä¸­è®¡ç®—ï¼Œæ‰€ä»¥è½¬æ¢æ˜¯ç­‰ä»·çš„ã€‚æ¡¶é”®èµ·åˆ°äº†é¢å¤–çš„ç»„é”®çš„ä½œç”¨ï¼Œåˆ†æ‹…ç»„é”®ä¸­çƒ­ç‚¹çš„è´Ÿæ‹…ã€‚æ¡¶é”®ä½¿å¾—å·¥ä½œå…·æœ‰å¯æ‰©å±•æ€§ï¼Œå¯ä»¥è§£å†³ distinct aggregations ä¸­çš„æ•°æ®åæ–œ/çƒ­ç‚¹é—®é¢˜ã€‚\næ‹†åˆ†ä¸åŒçš„èšåˆåï¼Œä¸Šé¢çš„æŸ¥è¯¢ä¼šè‡ªåŠ¨æ”¹å†™æˆä¸‹é¢çš„æŸ¥è¯¢:\nSELECTday,SUM(cnt)FROM(SELECTday,COUNT(DISTINCTuser_id)ascntFROMTGROUPBYday,MOD(HASH_CODE(user_id),1024))GROUPBYdayä¸‹å›¾æ˜¾ç¤ºäº†æ‹†åˆ†ä¸åŒçš„èšåˆå¦‚ä½•æé«˜æ€§èƒ½ï¼ˆå‡è®¾é¢œè‰²ä»£è¡¨å¤©æ•°ï¼Œå­—æ¯ä»£è¡¨ user_idï¼‰ã€‚\næ³¨ï¼šä»¥ä¸Šæ˜¯æœ€ç®€å•çš„ä¾‹å­ï¼Œå¯ä»¥ä»è¿™ä¸ªä¼˜åŒ–ä¸­å—ç›Šã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒFlink è¿˜æ”¯æŒæ‹†åˆ†æ›´å¤æ‚çš„èšåˆæŸ¥è¯¢ï¼Œä¾‹å¦‚ï¼Œå¤šä¸ªä¸åŒé”®çš„ä¸åŒèšåˆï¼ˆå¦‚ COUNT(DISTINCT a)ï¼ŒSUM(DISTINCT b)ï¼‰ï¼Œä»¥åŠä¸å…¶ä»–éä¸åŒèšåˆï¼ˆå¦‚ SUM, MAX, MIN, COUNTï¼‰ä¸€èµ·å·¥ä½œã€‚\næ³¨æ„ï¼Œç›®å‰ï¼Œåˆ†å‰²ä¼˜åŒ–ä¸æ”¯æŒåŒ…å«ç”¨æˆ·å®šä¹‰çš„ AggregateFunction çš„èšåˆã€‚\nä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•å¯ç”¨æ‹†åˆ†ä¸åŒçš„èšåˆä¼˜åŒ–ã€‚\n// instantiate table environment val tEnv: TableEnvironment = ... tEnv.getConfig // access high-level configuration  .getConfiguration // set low-level key-value options  .setString(\u0026#34;table.optimizer.distinct-agg.split.enabled\u0026#34;, \u0026#34;true\u0026#34;) // enable distinct agg split åœ¨ Distinct èšåˆä¸Šä½¿ç”¨ FILTER ä¿®é¥°ç¬¦ åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¯èƒ½éœ€è¦ä»ä¸åŒçš„ç»´åº¦æ¥è®¡ç®— UV(å”¯ä¸€è®¿å®¢)çš„æ•°é‡ï¼Œä¾‹å¦‚ï¼šAndroid çš„ UVã€iPhone çš„ UVã€Web çš„ UV ä»¥åŠæ€»çš„ UVã€‚å¾ˆå¤šç”¨æˆ·ä¼šé€‰æ‹© CASE WHEN æ¥æ”¯æŒï¼Œæ¯”å¦‚ã€‚\nSELECTday,COUNT(DISTINCTuser_id)AStotal_uv,COUNT(DISTINCTCASEWHENflagIN(\u0026#39;android\u0026#39;,\u0026#39;iphone\u0026#39;)THENuser_idELSENULLEND)ASapp_uv,COUNT(DISTINCTCASEWHENflagIN(\u0026#39;wap\u0026#39;,\u0026#39;other\u0026#39;)THENuser_idELSENULLEND)ASweb_uvFROMTGROUPBYdayä½†æ˜¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå»ºè®®ä½¿ç”¨ FILTER è¯­æ³•ï¼Œè€Œä¸æ˜¯ CASE WHENã€‚å› ä¸º FILTER æ›´ç¬¦åˆ SQL æ ‡å‡†ï¼Œä¼šå¾—åˆ°æ›´å¤šçš„æ€§èƒ½æå‡ã€‚FILTER æ˜¯ç”¨äºèšåˆå‡½æ•°ä¸Šçš„ä¿®é¥°ç¬¦ï¼Œç”¨äºé™åˆ¶èšåˆä¸­ä½¿ç”¨çš„å€¼ã€‚ç”¨ FILTER ä¿®é¥°ç¬¦æ›¿æ¢ä¸Šé¢çš„ä¾‹å­ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚\nSELECTday,COUNT(DISTINCTuser_id)AStotal_uv,COUNT(DISTINCTuser_id)FILTER(WHEREflagIN(\u0026#39;android\u0026#39;,\u0026#39;iphone\u0026#39;))ASapp_uv,COUNT(DISTINCTuser_id)FILTER(WHEREflagIN(\u0026#39;wap\u0026#39;,\u0026#39;other\u0026#39;))ASweb_uvFROMTGROUPBYdayFlink SQL ä¼˜åŒ–å™¨å¯ä»¥è¯†åˆ«åŒä¸€ä¸ªç‹¬ç«‹é”®ä¸Šçš„ä¸åŒè¿‡æ»¤å‚æ•°ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä¸‰ä¸ª COUNT DISTINCT éƒ½åœ¨ user_id åˆ—ä¸Šã€‚é‚£ä¹ˆ Flink å°±å¯ä»¥åªä½¿ç”¨ä¸€ä¸ªå…±äº«çŠ¶æ€å®ä¾‹è€Œä¸æ˜¯ä¸‰ä¸ªçŠ¶æ€å®ä¾‹æ¥å‡å°‘çŠ¶æ€è®¿é—®å’ŒçŠ¶æ€å¤§å°ã€‚åœ¨ä¸€äº›å·¥ä½œè´Ÿè½½ä¸­ï¼Œè¿™å¯ä»¥å¾—åˆ°æ˜¾è‘—çš„æ€§èƒ½æå‡ã€‚\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/tuning/streaming_aggregation_optimization.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-25-streaming-aggregation/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL"],"title":"Streaming Aggregation"},{"categories":["Flink"],"contents":"ç”¨æˆ·è‡ªå®šä¹‰æºå’Œæ¥æ”¶å™¨ åŠ¨æ€è¡¨æ˜¯ Flink çš„è¡¨ä¸ SQL API çš„æ ¸å¿ƒæ¦‚å¿µï¼Œç”¨äºç»Ÿä¸€å¤„ç†æœ‰ç•Œå’Œæ— ç•Œæ•°æ®ã€‚\nå› ä¸ºåŠ¨æ€è¡¨åªæ˜¯ä¸€ä¸ªé€»è¾‘æ¦‚å¿µï¼ŒFlink å¹¶ä¸æ‹¥æœ‰æ•°æ®æœ¬èº«ã€‚ç›¸åï¼ŒåŠ¨æ€è¡¨çš„å†…å®¹å­˜å‚¨åœ¨å¤–éƒ¨ç³»ç»Ÿï¼ˆå¦‚æ•°æ®åº“ã€é”®å€¼å­˜å‚¨ã€æ¶ˆæ¯é˜Ÿåˆ—ï¼‰æˆ–æ–‡ä»¶ä¸­ã€‚\nåŠ¨æ€æºå’ŒåŠ¨æ€æ±‡å¯ä»¥ç”¨æ¥ä»å¤–éƒ¨ç³»ç»Ÿè¯»å–å’Œå†™å…¥æ•°æ®ã€‚åœ¨æ–‡æ¡£ä¸­ï¼Œæºå’Œæ±‡é€šå¸¸è¢«æ€»ç»“ä¸ºè¿æ¥å™¨ä¸€è¯ã€‚\nFlink ä¸º Kafkaã€Hive å’Œä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿæä¾›äº†é¢„å®šä¹‰çš„è¿æ¥å™¨ã€‚æœ‰å…³å†…ç½®è¡¨æºå’Œæ±‡çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…è¿æ¥å™¨éƒ¨åˆ†ã€‚\næœ¬é¡µä¸»è¦ä»‹ç»å¦‚ä½•å¼€å‘ä¸€ä¸ªè‡ªå®šä¹‰çš„ã€ç”¨æˆ·å®šä¹‰çš„è¿æ¥å™¨ã€‚\næ³¨æ„: Flink 1.11 ä¸­å¼•å…¥äº†æ–°çš„è¡¨æºå’Œè¡¨æ±‡æ¥å£ï¼Œä½œä¸º FLIP-95 çš„ä¸€éƒ¨åˆ†ã€‚åŒæ—¶å·¥å‚æ¥å£ä¹Ÿè¢«é‡æ–°è®¾è®¡ã€‚FLIP-95 è¿˜æ²¡æœ‰å®Œå…¨å®ç°ã€‚è®¸å¤šèƒ½åŠ›æ¥å£è¿˜ä¸æ”¯æŒ(ä¾‹å¦‚ç”¨äºè¿‡æ»¤å™¨æˆ–åˆ†åŒºæ¨å€’)ã€‚å¦‚æœæœ‰å¿…è¦ï¼Œè¿˜è¯·çœ‹ä¸€ä¸‹æ—§ table source å’Œæ¥æ”¶å™¨çš„é¡µé¢ã€‚ä¸ºäº†å‘åå…¼å®¹ï¼Œè¿™äº›æ¥å£ä»ç„¶è¢«æ”¯æŒã€‚\næ¦‚è¿° åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œå®ç°è€…ä¸éœ€è¦ä»å¤´å¼€å§‹åˆ›å»ºä¸€ä¸ªæ–°çš„è¿æ¥å™¨ï¼Œè€Œæ˜¯å¸Œæœ›ç¨å¾®ä¿®æ”¹ç°æœ‰çš„è¿æ¥å™¨æˆ–æŒ‚å…¥ç°æœ‰çš„å †æ ˆã€‚åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œå®ç°è€…å¸Œæœ›åˆ›å»ºä¸“é—¨çš„è¿æ¥å™¨ã€‚\næœ¬èŠ‚å°†ä¸ºè¿™ä¸¤ç§ç”¨ä¾‹æä¾›å¸®åŠ©ã€‚å®ƒè§£é‡Šäº†è¡¨è¿æ¥å™¨çš„ä¸€èˆ¬æ¶æ„ï¼Œä» API ä¸­çš„çº¯å£°æ˜åˆ°å°†åœ¨é›†ç¾¤ä¸Šæ‰§è¡Œçš„è¿è¡Œæ—¶ä»£ç ã€‚\nå¡«å……çš„ç®­å¤´æ˜¾ç¤ºäº†åœ¨ç¿»è¯‘è¿‡ç¨‹ä¸­ï¼Œå¯¹è±¡å¦‚ä½•ä»ä¸€ä¸ªé˜¶æ®µè½¬æ¢åˆ°ä¸‹ä¸€ä¸ªé˜¶æ®µçš„å…¶ä»–å¯¹è±¡ã€‚\nå…ƒæ•°æ® è¡¨ API å’Œ SQL éƒ½æ˜¯å£°æ˜å¼ APIã€‚è¿™åŒ…æ‹¬è¡¨çš„å£°æ˜ã€‚å› æ­¤ï¼Œæ‰§è¡Œ CREATE TABLE è¯­å¥çš„ç»“æœæ˜¯æ›´æ–°ç›®æ ‡ç›®å½•ä¸­çš„å…ƒæ•°æ®ã€‚\nå¯¹äºå¤§å¤šæ•°ç›®å½•å®ç°æ¥è¯´ï¼Œå¤–éƒ¨ç³»ç»Ÿä¸­çš„ç‰©ç†æ•°æ®ä¸ä¼šå› ä¸ºè¿™æ ·çš„æ“ä½œè€Œè¢«ä¿®æ”¹ã€‚ç‰¹å®šäºè¿æ¥å™¨çš„ä¾èµ–å…³ç³»è¿˜ä¸å¿…å­˜åœ¨äº classpath ä¸­ã€‚åœ¨ WITH å­å¥ä¸­å£°æ˜çš„é€‰é¡¹æ—¢ä¸è¿›è¡ŒéªŒè¯ï¼Œä¹Ÿä¸è¿›è¡Œå…¶ä»–è§£é‡Šã€‚\nåŠ¨æ€è¡¨ï¼ˆé€šè¿‡ DDL åˆ›å»ºæˆ–ç”±ç›®å½•æä¾›ï¼‰çš„å…ƒæ•°æ®è¢«è¡¨ç¤ºä¸º CatalogTable çš„å®ä¾‹ã€‚è¡¨åå°†åœ¨å¿…è¦æ—¶åœ¨å†…éƒ¨è¢«è§£æä¸º CatalogTableã€‚\nè®¡åˆ’(Planning) å½“æ¶‰åŠåˆ°è¡¨ç¨‹åºçš„è§„åˆ’å’Œä¼˜åŒ–æ—¶ï¼Œéœ€è¦å°† CatalogTable è§£æä¸º DynamicTableSourceï¼ˆç”¨äºåœ¨ SELECT æŸ¥è¯¢ä¸­è¯»å–ï¼‰å’Œ DynamicTableSinkï¼ˆç”¨äºåœ¨ INSERT INTO è¯­å¥ä¸­å†™å…¥ï¼‰ã€‚\nDynamicTableSourceFactory å’Œ DynamicTableSinkFactory æä¾›äº†è¿æ¥å™¨ç‰¹æœ‰çš„é€»è¾‘ï¼Œç”¨äºå°† CatalogTable çš„å…ƒæ•°æ®ç¿»è¯‘æˆ DynamicTableSource å’Œ DynamicTableSink çš„å®ä¾‹ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå·¥å‚çš„ç›®çš„æ˜¯éªŒè¯é€‰é¡¹ï¼ˆå¦‚ç¤ºä¾‹ä¸­çš„ \u0026lsquo;port\u0026rsquo; = \u0026lsquo;5022\u0026rsquo;ï¼‰ï¼Œé…ç½®ç¼–ç /è§£ç æ ¼å¼ï¼ˆå¦‚æœéœ€è¦ï¼‰ï¼Œå¹¶åˆ›å»ºè¡¨è¿æ¥å™¨çš„å‚æ•°åŒ–å®ä¾‹ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼ŒDynamicTableSourceFactory å’Œ DynamicTableSinkFactory çš„å®ä¾‹æ˜¯é€šè¿‡ Java çš„æœåŠ¡æä¾›å•†æ¥å£ï¼ˆSPIï¼‰å‘ç°çš„ã€‚è¿æ¥å™¨é€‰é¡¹ï¼ˆå¦‚æœ¬ä¾‹ä¸­çš„\u0026rsquo;è¿æ¥å™¨'=\u0026lsquo;è‡ªå®šä¹‰\u0026rsquo;ï¼‰å¿…é¡»å¯¹åº”ä¸€ä¸ªæœ‰æ•ˆçš„å·¥å‚æ ‡è¯†ç¬¦ã€‚\nè™½ç„¶åœ¨ç±»çš„å‘½åä¸­å¯èƒ½å¹¶ä¸æ˜æ˜¾ï¼Œä½† DynamicTableSource å’Œ DynamicTableSink ä¹Ÿå¯ä»¥è¢«çœ‹ä½œæ˜¯æœ‰çŠ¶æ€çš„å·¥å‚ï¼Œæœ€ç»ˆäº§ç”Ÿå…·ä½“çš„è¿è¡Œæ—¶å®ç°æ¥è¯»å–/å†™å…¥å®é™…æ•°æ®ã€‚\nè§„åˆ’è€…ä½¿ç”¨æºå’Œæ±‡å®ä¾‹æ¥æ‰§è¡Œç‰¹å®šè¿æ¥å™¨çš„åŒå‘é€šä¿¡ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªæœ€ä½³çš„é€»è¾‘è®¡åˆ’ã€‚æ ¹æ®å¯é€‰å£°æ˜çš„èƒ½åŠ›æ¥å£ï¼ˆå¦‚ Supp SupportsProjectionPushDown æˆ– Supp SupportsOverwriteï¼‰ï¼Œè§„åˆ’è€…å¯èƒ½ä¼šå¯¹ä¸€ä¸ªå®ä¾‹è¿›è¡Œæ›´æ”¹ï¼Œä»è€Œå¯¹ç”Ÿæˆçš„è¿è¡Œæ—¶å®ç°è¿›è¡Œçªå˜ã€‚\nè¿è¡Œæ—¶ é€»è¾‘è§„åˆ’å®Œæˆåï¼Œè§„åˆ’å¸ˆå°†ä»è¡¨è¿æ¥å™¨ä¸­è·å–è¿è¡Œæ—¶å®ç°ã€‚è¿è¡Œæ—¶é€»è¾‘åœ¨ Flink çš„æ ¸å¿ƒè¿æ¥å™¨æ¥å£ä¸­å®ç°ï¼Œå¦‚ InputFormat æˆ– SourceFunctionã€‚\nè¿™äº›æ¥å£è¢«å¦ä¸€å±‚æŠ½è±¡å½’ä¸º ScanRuntimeProviderã€LookupRuntimeProvider å’Œ SinkRuntimeProvider çš„å­ç±»ã€‚\nä¾‹å¦‚ï¼ŒOutputFormatProvider(æä¾› org.apache.flink.api.common.io.OutputFormat) å’Œ SinkFunctionProvider(æä¾› org.apache.flink.streaming.api.function.sink.SinkFunction) éƒ½æ˜¯è§„åˆ’è€…å¯ä»¥å¤„ç†çš„ SinkRuntimeProvider çš„å…·ä½“å®ä¾‹ã€‚\næ‰©å±•ç‚¹ æœ¬èŠ‚è§£é‡Šäº†ç”¨äºæ‰©å±• Flink çš„è¡¨è¿æ¥å™¨çš„å¯ç”¨æ¥å£ã€‚\nåŠ¨æ€è¡¨å› ç´  åŠ¨æ€è¡¨å·¥å‚ç”¨äºæ ¹æ®ç›®å½•å’Œä¼šè¯ä¿¡æ¯ä¸ºå¤–éƒ¨å­˜å‚¨ç³»ç»Ÿé…ç½®åŠ¨æ€è¡¨è¿æ¥å™¨ã€‚\norg.apache.flink.table.fants.DynamicTableSourceFactory å¯ä»¥å®ç°æ¥æ„é€ ä¸€ä¸ª DynamicTableSourceã€‚\norg.apache.flink.table.fants.DynamicTableSinkFactory å¯ä»¥è¢«å®ç°æ¥æ„é€ ä¸€ä¸ª DynamicTableSinkã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨è¿æ¥å™¨é€‰é¡¹çš„å€¼ä½œä¸ºå·¥å‚æ ‡è¯†ç¬¦å’Œ Java çš„æœåŠ¡æä¾›è€…æ¥å£æ¥å‘ç°å·¥å‚ã€‚\nåœ¨ JAR æ–‡ä»¶ä¸­ï¼Œå¯ä»¥åœ¨æœåŠ¡æ–‡ä»¶ä¸­æ·»åŠ å¯¹æ–°å®ç°çš„å¼•ç”¨ã€‚\nMETA-INF/services/org.apache.flink.table.factory.Factoryã€‚\næ¡†æ¶å°†æ£€æŸ¥å•ä¸ªåŒ¹é…çš„å·¥å‚ï¼Œè¯¥å·¥å‚ç”±å·¥å‚æ ‡è¯†ç¬¦å’Œè¯·æ±‚çš„åŸºç±»ï¼ˆå¦‚ DynamicTableSourceFactoryï¼‰å”¯ä¸€è¯†åˆ«ã€‚\nå¦‚æœæœ‰å¿…è¦ï¼Œå·¥å‚å‘ç°è¿‡ç¨‹å¯ä»¥ç”±ç›®å½•å®ç°ç»•è¿‡ã€‚ä¸ºæ­¤ï¼Œç›®å½•éœ€è¦åœ¨ org.apache.flink.table.catalog.Catalog#getFactory ä¸­è¿”å›ä¸€ä¸ªå®ç°è¯·æ±‚çš„åŸºç±»çš„å®ä¾‹ã€‚\nåŠ¨æ€ Table Source æ ¹æ®å®šä¹‰ï¼ŒåŠ¨æ€è¡¨å¯ä»¥éšæ—¶é—´å˜åŒ–ã€‚\nå½“è¯»å–ä¸€ä¸ªåŠ¨æ€è¡¨æ—¶ï¼Œå…¶å†…å®¹å¯ä»¥è¢«è®¤ä¸ºæ˜¯ã€‚\n ä¸€ä¸ªå˜åŒ–æ—¥å¿—ï¼ˆæœ‰é™çš„æˆ–æ— é™çš„ï¼‰ï¼Œæ‰€æœ‰çš„å˜åŒ–éƒ½ä¼šè¢«æŒç»­æ¶ˆè€—ï¼Œç›´åˆ°å˜åŒ–æ—¥å¿—è€—å°½ã€‚è¿™ç”± ScanTableSource æ¥å£æ¥è¡¨ç¤ºã€‚ ä¸€ä¸ªæŒç»­å˜åŒ–çš„æˆ–éå¸¸å¤§çš„å¤–éƒ¨è¡¨ï¼Œå…¶å†…å®¹é€šå¸¸ä¸ä¼šè¢«å®Œå…¨è¯»å–ï¼Œè€Œæ˜¯åœ¨å¿…è¦æ—¶æŸ¥è¯¢å•ä¸ªå€¼ã€‚è¿™ç”± LookupTableSource æ¥å£æ¥è¡¨ç¤ºã€‚  ä¸€ä¸ªç±»å¯ä»¥åŒæ—¶å®ç°è¿™ä¸¤ä¸ªæ¥å£ã€‚è§„åˆ’å¸ˆæ ¹æ®æŒ‡å®šçš„æŸ¥è¯¢æ¥å†³å®šå®ƒä»¬çš„ç”¨é€”ã€‚\næ‰«æ Table Source ScanTableSource åœ¨è¿è¡Œæ—¶æ‰«ææ¥è‡ªå¤–éƒ¨å­˜å‚¨ç³»ç»Ÿçš„æ‰€æœ‰è¡Œï¼Œæ‰«æçš„è¡Œä¸ä¸€å®šåªåŒ…å«æ’å…¥ï¼Œä¹Ÿå¯ä»¥åŒ…å«æ›´æ–°å’Œåˆ é™¤ã€‚\næ‰«æçš„è¡Œä¸ä¸€å®šåªåŒ…å«æ’å…¥ï¼Œä¹Ÿå¯ä»¥åŒ…å«æ›´æ–°å’Œåˆ é™¤ã€‚å› æ­¤ï¼Œè¯¥è¡¨æºå¯ç”¨äºè¯»å–ï¼ˆæœ‰é™æˆ–æ— é™ï¼‰çš„å˜æ›´æ—¥å¿—ã€‚è¿”å›çš„å˜æ›´æ—¥å¿—æ¨¡å¼è¡¨ç¤ºè®¡åˆ’å‘˜åœ¨è¿è¡Œæ—¶å¯ä»¥é¢„æœŸçš„å˜æ›´é›†ã€‚\nå¯¹äºå¸¸è§„çš„æ‰¹å¤„ç†æ–¹æ¡ˆï¼Œæºå¯ä»¥å‘å‡ºåªæ’å…¥è¡Œçš„æœ‰ç•Œæµã€‚\nå¯¹äºå¸¸è§„çš„æµå¼æ–¹æ¡ˆï¼Œæºå¯ä»¥å‘å‡ºåªæ’å…¥è¡Œçš„æ— ç•Œæµã€‚\nå¯¹äºå˜åŒ–æ•°æ®æ•è·ï¼ˆCDCï¼‰åœºæ™¯ï¼Œæºå¯ä»¥å‘å‡ºæœ‰ç•Œæˆ–æ— ç•Œçš„æµï¼ŒåŒ…å«æ’å…¥ã€æ›´æ–°å’Œåˆ é™¤è¡Œã€‚\nTable Source å¯ä»¥å®ç°æ›´å¤šçš„èƒ½åŠ›æ¥å£ï¼Œå¦‚ Supp SupportsProjectionPushDownï¼Œå¯èƒ½åœ¨è§„åˆ’æœŸé—´çªå˜ä¸€ä¸ªå®ä¾‹ã€‚æ‰€æœ‰çš„èƒ½åŠ›éƒ½åˆ—åœ¨ org.apache.flink.table.connector.source.abilities åŒ…å’Œ org.apache.flink.table.connector.source.ScanTableSource çš„æ–‡æ¡£ä¸­ã€‚\nScanTableSource çš„è¿è¡Œæ—¶å®ç°å¿…é¡»äº§ç”Ÿå†…éƒ¨æ•°æ®ç»“æ„ã€‚å› æ­¤ï¼Œè®°å½•å¿…é¡»ä»¥ org.apache.flink.table.data.RowData çš„å½¢å¼å‘å‡ºã€‚æ¡†æ¶æä¾›äº†è¿è¡Œæ—¶è½¬æ¢å™¨ï¼Œè¿™æ ·ä¸€ä¸ªæºä»ç„¶å¯ä»¥åœ¨æ™®é€šçš„æ•°æ®ç»“æ„ä¸Šå·¥ä½œï¼Œå¹¶åœ¨æœ€åè¿›è¡Œè½¬æ¢ã€‚\næŸ¥è¯¢ Table Source LookupTableSource åœ¨è¿è¡Œæ—¶é€šè¿‡ä¸€ä¸ªæˆ–å¤šä¸ªé”®æ¥æŸ¥æ‰¾å¤–éƒ¨å­˜å‚¨ç³»ç»Ÿçš„è¡Œã€‚\nä¸ ScanTableSource ç›¸æ¯”ï¼ŒLookupTableSource ä¸éœ€è¦è¯»å–æ•´ä¸ªè¡¨ï¼Œå¯ä»¥åœ¨å¿…è¦çš„æ—¶å€™ä»å¤–éƒ¨è¡¨ï¼ˆå¯èƒ½æ˜¯ä¸æ–­å˜åŒ–çš„ï¼‰ä¸­æ‡’æƒ°åœ°è·å–å•ä¸ªå€¼ã€‚\nä¸ ScanTableSource ç›¸æ¯”ï¼ŒLookupTableSource ç›®å‰åªæ”¯æŒå‘å‡ºåªæ’å…¥çš„å˜åŒ–ã€‚\nä¸æ”¯æŒæ›´å¤šçš„èƒ½åŠ›ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è§ org.apache.flink.table.connector.source.LookupTableSource çš„æ–‡æ¡£ã€‚\nLookupTableSource çš„è¿è¡Œæ—¶å®ç°æ˜¯ä¸€ä¸ª TableFunction æˆ– AsyncTableFunctionã€‚è¯¥å‡½æ•°å°†åœ¨è¿è¡Œæ—¶è°ƒç”¨ç»™å®šçš„æŸ¥æ‰¾é”®çš„å€¼ã€‚\nåŠ¨æ€ Table Sink æ ¹æ®å®šä¹‰ï¼ŒåŠ¨æ€è¡¨å¯ä»¥éšæ—¶é—´å˜åŒ–ã€‚\nåœ¨ç¼–å†™åŠ¨æ€è¡¨æ—¶ï¼Œå¯ä»¥å§‹ç»ˆå°†å†…å®¹è§†ä¸ºä¸€ä¸ª changelogï¼ˆæœ‰é™æˆ–æ— é™ï¼‰ï¼Œå¯¹äºè¿™ä¸ª changelogï¼Œæ‰€æœ‰çš„å˜åŒ–éƒ½ä¼šè¢«è¿ç»­å†™å‡ºæ¥ï¼Œç›´åˆ° changelog ç”¨å®Œä¸ºæ­¢ã€‚è¿”å›çš„ changelog æ¨¡å¼è¡¨æ˜äº† sink åœ¨è¿è¡Œæ—¶æ¥å—çš„å˜åŒ–é›†ã€‚\nå¯¹äºå¸¸è§„çš„æ‰¹å¤„ç†æ–¹æ¡ˆï¼Œsink å¯ä»¥åªæ¥å—åªæ’å…¥çš„è¡Œï¼Œå¹¶å†™å‡ºæœ‰ç•Œæµã€‚\nå¯¹äºå¸¸è§„çš„æµå¼æ–¹æ¡ˆï¼Œsink å¯ä»¥åªæ¥å—åªæ’å…¥çš„è¡Œï¼Œå¹¶ä¸”å¯ä»¥å†™å‡ºæ— çº¦æŸçš„æµã€‚\nå¯¹äºå˜åŒ–æ•°æ®æ•è·ï¼ˆCDCï¼‰åœºæ™¯ï¼Œtable sink å¯ä»¥å†™å‡ºæœ‰ç•Œæµæˆ–æ— ç•Œæµï¼Œæœ‰æ’å…¥ã€æ›´æ–°å’Œåˆ é™¤è¡Œã€‚\nTable sink å¯ä»¥å®ç°æ›´å¤šçš„èƒ½åŠ›æ¥å£ï¼Œå¦‚ SupportsOverwriteï¼Œå¯èƒ½åœ¨è§„åˆ’æœŸé—´çªå˜ä¸€ä¸ªå®ä¾‹ã€‚æ‰€æœ‰çš„èƒ½åŠ›éƒ½åˆ—åœ¨ org.apache.flink.table.connector.sink.abilities åŒ…å’Œ org.apache.flink.table.connector.sink.DynamicTableSink çš„æ–‡æ¡£ä¸­ã€‚\nDynamicTableSink çš„è¿è¡Œæ—¶å®ç°å¿…é¡»æ¶ˆè€—å†…éƒ¨æ•°æ®ç»“æ„ã€‚å› æ­¤ï¼Œè®°å½•å¿…é¡»è¢«æ¥å—ä¸º org.apache.flink.table.data.RowDataã€‚è¯¥æ¡†æ¶æä¾›äº†è¿è¡Œæ—¶è½¬æ¢å™¨ï¼Œè¿™æ ·ä¸€ä¸ª sink ä»ç„¶å¯ä»¥åœ¨æ™®é€šçš„æ•°æ®ç»“æ„ä¸Šå·¥ä½œï¼Œå¹¶åœ¨å¼€å§‹æ—¶æ‰§è¡Œè½¬æ¢ã€‚\nç¼–ç /è§£ç æ ¼å¼ ä¸€äº›è¡¨è¿æ¥å™¨æ¥å—ä¸åŒçš„æ ¼å¼ï¼Œå¯¹é”®å’Œ/æˆ–å€¼è¿›è¡Œç¼–ç å’Œè§£ç ã€‚\næ ¼å¼çš„å·¥ä½œæ¨¡å¼ç±»ä¼¼äº DynamicTableSourceFactory-\u0026gt;DynamicTableSource-\u0026gt;ScanRuntimeProviderï¼Œå·¥å‚è´Ÿè´£ç¿»è¯‘é€‰é¡¹ï¼Œæºå¤´è´Ÿè´£åˆ›å»ºè¿è¡Œæ—¶é€»è¾‘ã€‚\nå› ä¸ºæ ¼å¼å¯èƒ½ä½äºä¸åŒçš„æ¨¡å—ä¸­ï¼Œæ‰€ä»¥ä½¿ç”¨ Java çš„æœåŠ¡æä¾›è€…æ¥å£å‘ç°å®ƒä»¬ï¼Œç±»ä¼¼äºè¡¨å·¥å‚ã€‚ä¸ºäº†å‘ç°æ ¼å¼å·¥å‚ï¼ŒåŠ¨æ€è¡¨å·¥å‚ä¼šæœç´¢ä¸å·¥å‚æ ‡è¯†ç¬¦å’Œè¿æ¥å™¨ç‰¹å®šåŸºç±»ç›¸å¯¹åº”çš„å·¥å‚ã€‚\nä¾‹å¦‚ï¼ŒKafka è¡¨æºéœ€è¦ä¸€ä¸ª DeserializationSchema ä½œä¸ºè§£ç æ ¼å¼çš„è¿è¡Œæ—¶æ¥å£ã€‚å› æ­¤ï¼ŒKafka è¡¨æºå·¥å‚ä½¿ç”¨ value.format é€‰é¡¹çš„å€¼æ¥å‘ç°ä¸€ä¸ª DeserializationFormatFactoryã€‚\nç›®å‰æ”¯æŒä»¥ä¸‹æ ¼å¼å·¥å‚ã€‚\n org.apache.flink.table.factories.DeserializationFormatFactory org.apache.flink.table.factories.SerializationFormatFactory  æ ¼å¼å·¥å‚å°†é€‰é¡¹ç¿»è¯‘æˆ EncodingFormat æˆ– DecodingFormatã€‚è¿™äº›æ¥å£æ˜¯å¦ä¸€ç§å·¥å‚ï¼Œä¸ºç»™å®šçš„æ•°æ®ç±»å‹äº§ç”Ÿä¸“é—¨çš„æ ¼å¼è¿è¡Œæ—¶é€»è¾‘ã€‚\nä¾‹å¦‚ï¼Œå¯¹äº Kafka table source å·¥å‚ï¼ŒDeserializationFormatFactory å°†è¿”å›ä¸€ä¸ª EncodingFormat\u0026lt;DeserializationSchema\u0026gt;ï¼Œå®ƒå¯ä»¥ä¼ é€’åˆ° Kafka è¡¨æºä¸­ã€‚\nå…¨æ ˆç¤ºä¾‹ æœ¬èŠ‚ç®€è¦ä»‹ç»äº†å¦‚ä½•å®ç°ä¸€ä¸ªæ‰«æè¡¨æºï¼Œå…¶è§£ç æ ¼å¼æ”¯æŒ changelog è¯­ä¹‰ã€‚è¿™ä¸ªä¾‹å­è¯´æ˜äº†æ‰€æœ‰æåˆ°çš„ç»„ä»¶å¦‚ä½•ä¸€èµ·å‘æŒ¥ä½œç”¨ã€‚å®ƒå¯ä»¥ä½œä¸ºä¸€ä¸ªå‚è€ƒå®ç°ã€‚\nç‰¹åˆ«æ˜¯ï¼Œå®ƒå±•ç¤ºäº†å¦‚ä½•\n åˆ›å»ºè§£æå’ŒéªŒè¯é€‰é¡¹çš„å·¥å‚ã€‚ å®ç°è¡¨è¿æ¥å™¨ã€‚ å®ç°å’Œå‘ç°è‡ªå®šä¹‰æ ¼å¼ã€‚ å¹¶ä½¿ç”¨æä¾›çš„å®ç”¨ç¨‹åºï¼Œå¦‚æ•°æ®ç»“æ„è½¬æ¢å™¨å’Œ FactoryUtilã€‚  Table Source ä½¿ç”¨ä¸€ä¸ªç®€å•çš„å•çº¿ç¨‹ SourceFunction æ¥æ‰“å¼€ä¸€ä¸ªç›‘å¬ä¼ å…¥å­—èŠ‚çš„å¥—æ¥å­—ã€‚åŸå§‹å­—èŠ‚ç”±ä¸€ä¸ªå¯æ’æ‹”çš„æ ¼å¼è§£ç æˆè¡Œã€‚è¯¥æ ¼å¼æœŸæœ›ä»¥ changelog æ ‡å¿—ä½œä¸ºç¬¬ä¸€åˆ—ã€‚\næˆ‘ä»¬å°†ä½¿ç”¨ä¸Šé¢æåˆ°çš„å¤§éƒ¨åˆ†æ¥å£æ¥å®ç°ä¸‹é¢çš„ DDLã€‚\nCREATETABLEUserScores(nameSTRING,scoreINT)WITH(\u0026#39;connector\u0026#39;=\u0026#39;socket\u0026#39;,\u0026#39;hostname\u0026#39;=\u0026#39;localhost\u0026#39;,\u0026#39;port\u0026#39;=\u0026#39;9999\u0026#39;,\u0026#39;byte-delimiter\u0026#39;=\u0026#39;10\u0026#39;,\u0026#39;format\u0026#39;=\u0026#39;changelog-csv\u0026#39;,\u0026#39;changelog-csv.column-delimiter\u0026#39;=\u0026#39;|\u0026#39;);ç”±äºè¯¥æ ¼å¼æ”¯æŒ changelog è¯­ä¹‰ï¼Œæˆ‘ä»¬èƒ½å¤Ÿåœ¨è¿è¡Œæ—¶æ‘„å–æ›´æ–°ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªèƒ½å¤ŸæŒç»­è¯„ä¼°å˜åŒ–æ•°æ®çš„æ›´æ–°è§†å›¾ã€‚\nSELECTname,SUM(score)FROMUserScoresGROUPBYname;ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨ç»ˆç«¯ä¸­æ‘„å–æ•°æ®ã€‚\n\u0026gt; nc -lk 9999 INSERT|Alice|12 INSERT|Bob|5 DELETE|Alice|12 INSERT|Alice|18 å·¥å‚ æœ¬èŠ‚è¯´æ˜äº†å¦‚ä½•å°†æ¥è‡ªç›®å½•çš„å…ƒæ•°æ®ç¿»è¯‘æˆå…·ä½“çš„è¿æ¥å™¨å®ä¾‹ã€‚\nè¿™ä¸¤ä¸ªå·¥å‚éƒ½è¢«æ·»åŠ åˆ° META-INF/services ç›®å½•ä¸­ã€‚\nSocketDynamicTableFactory\nSocketDynamicTableFactory å°†ç›®å½•è¡¨ç¿»è¯‘æˆè¡¨æºã€‚ç”±äºè¡¨æºéœ€è¦è§£ç æ ¼å¼ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä½¿ç”¨æä¾›çš„ FactoryUtil å‘ç°æ ¼å¼ã€‚\nimport org.apache.flink.api.common.serialization.DeserializationSchema; import org.apache.flink.configuration.ConfigOption; import org.apache.flink.configuration.ConfigOptions; import org.apache.flink.configuration.ReadableConfig; import org.apache.flink.table.connector.format.DecodingFormat; import org.apache.flink.table.connector.source.DynamicTableSource; import org.apache.flink.table.data.RowData; import org.apache.flink.table.factories.DeserializationFormatFactory; import org.apache.flink.table.factories.DynamicTableSourceFactory; import org.apache.flink.table.factories.FactoryUtil; import org.apache.flink.table.types.DataType; public class SocketDynamicTableFactory implements DynamicTableSourceFactory { // define all options statically  public static final ConfigOption\u0026lt;String\u0026gt; HOSTNAME = ConfigOptions.key(\u0026#34;hostname\u0026#34;) .stringType() .noDefaultValue(); public static final ConfigOption\u0026lt;Integer\u0026gt; PORT = ConfigOptions.key(\u0026#34;port\u0026#34;) .intType() .noDefaultValue(); public static final ConfigOption\u0026lt;Integer\u0026gt; BYTE_DELIMITER = ConfigOptions.key(\u0026#34;byte-delimiter\u0026#34;) .intType() .defaultValue(10); // corresponds to \u0026#39;\\n\u0026#39;  @Override public String factoryIdentifier() { return \u0026#34;socket\u0026#34;; // used for matching to `connector = \u0026#39;...\u0026#39;`  } @Override public Set\u0026lt;ConfigOption\u0026lt;?\u0026gt;\u0026gt; requiredOptions() { final Set\u0026lt;ConfigOption\u0026lt;?\u0026gt;\u0026gt; options = new HashSet\u0026lt;\u0026gt;(); options.add(HOSTNAME); options.add(PORT); options.add(FactoryUtil.FORMAT); // use pre-defined option for format  return options; } @Override public Set\u0026lt;ConfigOption\u0026lt;?\u0026gt;\u0026gt; optionalOptions() { final Set\u0026lt;ConfigOption\u0026lt;?\u0026gt;\u0026gt; options = new HashSet\u0026lt;\u0026gt;(); options.add(BYTE_DELIMITER); return options; } @Override public DynamicTableSource createDynamicTableSource(Context context) { // either implement your custom validation logic here ...  // or use the provided helper utility  final FactoryUtil.TableFactoryHelper helper = FactoryUtil.createTableFactoryHelper(this, context); // discover a suitable decoding format  final DecodingFormat\u0026lt;DeserializationSchema\u0026lt;RowData\u0026gt;\u0026gt; decodingFormat = helper.discoverDecodingFormat( DeserializationFormatFactory.class, FactoryUtil.FORMAT); // validate all options  helper.validate(); // get the validated options  final ReadableConfig options = helper.getOptions(); final String hostname = options.get(HOSTNAME); final int port = options.get(PORT); final byte byteDelimiter = (byte) (int) options.get(BYTE_DELIMITER); // derive the produced data type (excluding computed columns) from the catalog table  final DataType producedDataType = context.getCatalogTable().getSchema().toPhysicalRowDataType(); // create and return dynamic table source  return new SocketDynamicTableSource(hostname, port, byteDelimiter, decodingFormat, producedDataType); } } ChangelogCsvFormatFactory\nChangelogCsvFormatFactory å°†ç‰¹å®šæ ¼å¼çš„é€‰é¡¹ç¿»è¯‘æˆä¸€ç§æ ¼å¼ã€‚SocketDynamicTableFactory ä¸­çš„ FactoryUtil è´Ÿè´£ç›¸åº”åœ°è°ƒæ•´é€‰é¡¹é”®ï¼Œå¹¶å¤„ç†åƒ changelog-csv.column-delimiter é‚£æ ·çš„å‰ç¼€ã€‚\nå› ä¸ºè¿™ä¸ªå·¥å‚å®ç°äº† DeserializationFormatFactoryï¼Œæ‰€ä»¥å®ƒä¹Ÿå¯ä»¥ç”¨äºå…¶ä»–æ”¯æŒååºåˆ—åŒ–æ ¼å¼çš„è¿æ¥å™¨ï¼Œæ¯”å¦‚ Kafka è¿æ¥å™¨ã€‚\nimport org.apache.flink.api.common.serialization.DeserializationSchema; import org.apache.flink.configuration.ConfigOption; import org.apache.flink.configuration.ConfigOptions; import org.apache.flink.configuration.ReadableConfig; import org.apache.flink.table.connector.format.DecodingFormat; import org.apache.flink.table.data.RowData; import org.apache.flink.table.factories.FactoryUtil; import org.apache.flink.table.factories.DeserializationFormatFactory; import org.apache.flink.table.factories.DynamicTableFactory; public class ChangelogCsvFormatFactory implements DeserializationFormatFactory { // define all options statically  public static final ConfigOption\u0026lt;String\u0026gt; COLUMN_DELIMITER = ConfigOptions.key(\u0026#34;column-delimiter\u0026#34;) .stringType() .defaultValue(\u0026#34;|\u0026#34;); @Override public String factoryIdentifier() { return \u0026#34;changelog-csv\u0026#34;; } @Override public Set\u0026lt;ConfigOption\u0026lt;?\u0026gt;\u0026gt; requiredOptions() { return Collections.emptySet(); } @Override public Set\u0026lt;ConfigOption\u0026lt;?\u0026gt;\u0026gt; optionalOptions() { final Set\u0026lt;ConfigOption\u0026lt;?\u0026gt;\u0026gt; options = new HashSet\u0026lt;\u0026gt;(); options.add(COLUMN_DELIMITER); return options; } @Override public DecodingFormat\u0026lt;DeserializationSchema\u0026lt;RowData\u0026gt;\u0026gt; createDecodingFormat( DynamicTableFactory.Context context, ReadableConfig formatOptions) { // either implement your custom validation logic here ...  // or use the provided helper method  FactoryUtil.validateFactoryOptions(this, formatOptions); // get the validated options  final String columnDelimiter = formatOptions.get(COLUMN_DELIMITER); // create and return the format  return new ChangelogCsvFormat(columnDelimiter); } } Table Source å’Œè§£ç æ ¼å¼ æœ¬èŠ‚è¯´æ˜äº†å¦‚ä½•ä»è§„åˆ’å±‚çš„å®ä¾‹è½¬åŒ–ä¸ºè¿åˆ°é›†ç¾¤çš„è¿è¡Œæ—¶å®ä¾‹ã€‚\nSocketDynamicTableSource\nåœ¨è§„åˆ’è¿‡ç¨‹ä¸­ä¼šç”¨åˆ° SocketDynamicTableSourceã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰å®ç°ä»»ä½•å¯ç”¨çš„èƒ½åŠ›æ¥å£ã€‚å› æ­¤ï¼Œä¸»è¦çš„é€»è¾‘å¯ä»¥åœ¨ getScanRuntimeProvider(...) ä¸­æ‰¾åˆ°ï¼Œæˆ‘ä»¬åœ¨å…¶ä¸­å®ä¾‹åŒ–äº†æ‰€éœ€çš„ SourceFunction å’Œå…¶è¿è¡Œæ—¶çš„ DeserializationSchemaã€‚è¿™ä¸¤ä¸ªå®ä¾‹éƒ½è¢«å‚æ•°åŒ–ä¸ºè¿”å›å†…éƒ¨æ•°æ®ç»“æ„ï¼ˆå³ RowDataï¼‰ã€‚\nimport org.apache.flink.api.common.serialization.DeserializationSchema; import org.apache.flink.streaming.api.functions.source.SourceFunction; import org.apache.flink.table.connector.ChangelogMode; import org.apache.flink.table.connector.format.DecodingFormat; import org.apache.flink.table.connector.source.DynamicTableSource; import org.apache.flink.table.connector.source.ScanTableSource; import org.apache.flink.table.connector.source.SourceFunctionProvider; import org.apache.flink.table.data.RowData; import org.apache.flink.table.types.DataType; public class SocketDynamicTableSource implements ScanTableSource { private final String hostname; private final int port; private final byte byteDelimiter; private final DecodingFormat\u0026lt;DeserializationSchema\u0026lt;RowData\u0026gt;\u0026gt; decodingFormat; private final DataType producedDataType; public SocketDynamicTableSource( String hostname, int port, byte byteDelimiter, DecodingFormat\u0026lt;DeserializationSchema\u0026lt;RowData\u0026gt;\u0026gt; decodingFormat, DataType producedDataType) { this.hostname = hostname; this.port = port; this.byteDelimiter = byteDelimiter; this.decodingFormat = decodingFormat; this.producedDataType = producedDataType; } @Override public ChangelogMode getChangelogMode() { // in our example the format decides about the changelog mode  // but it could also be the source itself  return decodingFormat.getChangelogMode(); } @Override public ScanRuntimeProvider getScanRuntimeProvider(ScanContext runtimeProviderContext) { // create runtime classes that are shipped to the cluster  final DeserializationSchema\u0026lt;RowData\u0026gt; deserializer = decodingFormat.createRuntimeDecoder( runtimeProviderContext, producedDataType); final SourceFunction\u0026lt;RowData\u0026gt; sourceFunction = new SocketSourceFunction( hostname, port, byteDelimiter, deserializer); return SourceFunctionProvider.of(sourceFunction, false); } @Override public DynamicTableSource copy() { return new SocketDynamicTableSource(hostname, port, byteDelimiter, decodingFormat, producedDataType); } @Override public String asSummaryString() { return \u0026#34;Socket Table Source\u0026#34;; } } ChangelogCsvFormat\nChangelogCsvFormat æ˜¯ä¸€ç§è§£ç æ ¼å¼ï¼Œåœ¨è¿è¡Œæ—¶ä½¿ç”¨ DeserializationSchemaã€‚å®ƒæ”¯æŒå‘å‡º INSERT å’Œ DELETE æ›´æ”¹ã€‚\nimport org.apache.flink.api.common.serialization.DeserializationSchema; import org.apache.flink.api.common.typeinfo.TypeInformation; import org.apache.flink.table.connector.ChangelogMode; import org.apache.flink.table.connector.format.DecodingFormat; import org.apache.flink.table.connector.source.DynamicTableSource; import org.apache.flink.table.connector.source.DynamicTableSource.DataStructureConverter; import org.apache.flink.table.data.RowData; import org.apache.flink.table.types.DataType; import org.apache.flink.table.types.logical.LogicalType; import org.apache.flink.types.RowKind; public class ChangelogCsvFormat implements DecodingFormat\u0026lt;DeserializationSchema\u0026lt;RowData\u0026gt;\u0026gt; { private final String columnDelimiter; public ChangelogCsvFormat(String columnDelimiter) { this.columnDelimiter = columnDelimiter; } @Override @SuppressWarnings(\u0026#34;unchecked\u0026#34;) public DeserializationSchema\u0026lt;RowData\u0026gt; createRuntimeDecoder( DynamicTableSource.Context context, DataType producedDataType) { // create type information for the DeserializationSchema  final TypeInformation\u0026lt;RowData\u0026gt; producedTypeInfo = (TypeInformation\u0026lt;RowData\u0026gt;) context.createTypeInformation( producedDataType); // most of the code in DeserializationSchema will not work on internal data structures  // create a converter for conversion at the end  final DataStructureConverter converter = context.createDataStructureConverter(producedDataType); // use logical types during runtime for parsing  final List\u0026lt;LogicalType\u0026gt; parsingTypes = producedDataType.getLogicalType().getChildren(); // create runtime class  return new ChangelogCsvDeserializer(parsingTypes, converter, producedTypeInfo, columnDelimiter); } @Override public ChangelogMode getChangelogMode() { // define that this format can produce INSERT and DELETE rows  return ChangelogMode.newBuilder() .addContainedKind(RowKind.INSERT) .addContainedKind(RowKind.DELETE) .build(); } } è¿è¡Œæ—¶ ä¸ºäº†å®Œæ•´èµ·è§ï¼Œæœ¬èŠ‚è¯´æ˜äº† SourceFunction å’Œ DeserializationSchema çš„è¿è¡Œæ—¶é€»è¾‘ã€‚\nChangelogCsvDeserializer\nChangelogCsvDeserializer åŒ…å«äº†ä¸€ä¸ªç®€å•çš„è§£æé€»è¾‘ï¼Œç”¨äºå°†å­—èŠ‚è½¬æ¢ä¸ºå¸¦æœ‰è¡Œç§ç±»çš„æ•´æ•°è¡Œå’Œå­—ç¬¦ä¸²ã€‚æœ€åçš„è½¬æ¢æ­¥éª¤å°†è¿™äº›è½¬æ¢ä¸ºå†…éƒ¨æ•°æ®ç»“æ„ã€‚\nimport org.apache.flink.api.common.serialization.DeserializationSchema; import org.apache.flink.api.common.typeinfo.TypeInformation; import org.apache.flink.table.connector.RuntimeConverter.Context; import org.apache.flink.table.connector.source.DynamicTableSource.DataStructureConverter; import org.apache.flink.table.data.RowData; import org.apache.flink.table.types.logical.LogicalType; import org.apache.flink.table.types.logical.LogicalTypeRoot; import org.apache.flink.types.Row; import org.apache.flink.types.RowKind; public class ChangelogCsvDeserializer implements DeserializationSchema\u0026lt;RowData\u0026gt; { private final List\u0026lt;LogicalType\u0026gt; parsingTypes; private final DataStructureConverter converter; private final TypeInformation\u0026lt;RowData\u0026gt; producedTypeInfo; private final String columnDelimiter; public ChangelogCsvDeserializer( List\u0026lt;LogicalType\u0026gt; parsingTypes, DataStructureConverter converter, TypeInformation\u0026lt;RowData\u0026gt; producedTypeInfo, String columnDelimiter) { this.parsingTypes = parsingTypes; this.converter = converter; this.producedTypeInfo = producedTypeInfo; this.columnDelimiter = columnDelimiter; } @Override public TypeInformation\u0026lt;RowData\u0026gt; getProducedType() { // return the type information required by Flink\u0026#39;s core interfaces  return producedTypeInfo; } @Override public void open(InitializationContext context) { // converters must be open  converter.open(Context.create(ChangelogCsvDeserializer.class.getClassLoader())); } @Override public RowData deserialize(byte[] message) { // parse the columns including a changelog flag  final String[] columns = new String(message).split(Pattern.quote(columnDelimiter)); final RowKind kind = RowKind.valueOf(columns[0]); final Row row = new Row(kind, parsingTypes.size()); for (int i = 0; i \u0026lt; parsingTypes.size(); i++) { row.setField(i, parse(parsingTypes.get(i).getTypeRoot(), columns[i + 1])); } // convert to internal data structure  return (RowData) converter.toInternal(row); } private static Object parse(LogicalTypeRoot root, String value) { switch (root) { case INTEGER: return Integer.parseInt(value); case VARCHAR: return value; default: throw new IllegalArgumentException(); } } @Override public boolean isEndOfStream(RowData nextElement) { return false; } } SocketSourceFunction\nSocketSourceFunction æ‰“å¼€ä¸€ä¸ªå¥—æ¥å­—å¹¶æ¶ˆè€—å­—èŠ‚ã€‚å®ƒé€šè¿‡ç»™å®šçš„å­—èŠ‚å®šç•Œç¬¦ï¼ˆé»˜è®¤ä¸º \\nï¼‰åˆ†å‰²è®°å½•ï¼Œå¹¶å°†è§£ç å§”æ‰˜ç»™ä¸€ä¸ªå¯æ’æ‹”çš„ DeserializationSchemaã€‚æºå‡½æ•°åªèƒ½ä»¥ 1 çš„å¹¶è¡Œåº¦å·¥ä½œã€‚\nimport org.apache.flink.api.common.serialization.DeserializationSchema; import org.apache.flink.api.common.typeinfo.TypeInformation; import org.apache.flink.api.java.typeutils.ResultTypeQueryable; import org.apache.flink.configuration.Configuration; import org.apache.flink.streaming.api.functions.source.RichSourceFunction; import org.apache.flink.table.data.RowData; public class SocketSourceFunction extends RichSourceFunction\u0026lt;RowData\u0026gt; implements ResultTypeQueryable\u0026lt;RowData\u0026gt; { private final String hostname; private final int port; private final byte byteDelimiter; private final DeserializationSchema\u0026lt;RowData\u0026gt; deserializer; private volatile boolean isRunning = true; private Socket currentSocket; public SocketSourceFunction(String hostname, int port, byte byteDelimiter, DeserializationSchema\u0026lt;RowData\u0026gt; deserializer) { this.hostname = hostname; this.port = port; this.byteDelimiter = byteDelimiter; this.deserializer = deserializer; } @Override public TypeInformation\u0026lt;RowData\u0026gt; getProducedType() { return deserializer.getProducedType(); } @Override public void open(Configuration parameters) throws Exception { deserializer.open(() -\u0026gt; getRuntimeContext().getMetricGroup()); } @Override public void run(SourceContext\u0026lt;RowData\u0026gt; ctx) throws Exception { while (isRunning) { // open and consume from socket  try (final Socket socket = new Socket()) { currentSocket = socket; socket.connect(new InetSocketAddress(hostname, port), 0); try (InputStream stream = socket.getInputStream()) { ByteArrayOutputStream buffer = new ByteArrayOutputStream(); int b; while ((b = stream.read()) \u0026gt;= 0) { // buffer until delimiter  if (b != byteDelimiter) { buffer.write(b); } // decode and emit record  else { ctx.collect(deserializer.deserialize(buffer.toByteArray())); buffer.reset(); } } } } catch (Throwable t) { t.printStackTrace(); // print and continue  } Thread.sleep(1000); } } @Override public void cancel() { isRunning = false; try { currentSocket.close(); } catch (Throwable t) { // ignore  } } } åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/sourceSinks.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-25-user-defined-sources-and-sinks/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL"],"title":"User Defined Sources and Sinks"},{"categories":["Flink"],"contents":"æ•°æ®ç±»å‹å’Œåºåˆ—åŒ– Apache Flink ä»¥ç‹¬ç‰¹çš„æ–¹å¼å¤„ç†æ•°æ®ç±»å‹å’Œåºåˆ—åŒ–ï¼ŒåŒ…å«è‡ªå·±çš„ç±»å‹æè¿°ç¬¦ã€é€šç”¨ç±»å‹æå–å’Œç±»å‹åºåˆ—åŒ–æ¡†æ¶ã€‚æœ¬æ–‡æ¡£æè¿°äº†è¿™äº›æ¦‚å¿µå’Œå®ƒä»¬èƒŒåçš„åŸç†ã€‚\næ”¯æŒçš„æ•°æ®ç±»å‹ Flink å¯¹ DataSet æˆ– DataStream ä¸­çš„å…ƒç´ ç±»å‹è¿›è¡Œäº†ä¸€äº›é™åˆ¶ã€‚è¿™æ ·åšçš„åŸå› æ˜¯ç³»ç»Ÿåˆ†æç±»å‹ä»¥ç¡®å®šé«˜æ•ˆçš„æ‰§è¡Œç­–ç•¥ã€‚\næœ‰ä¸ƒç§ä¸åŒç±»åˆ«çš„æ•°æ®ç±»å‹ã€‚\n Java Tuples å’Œ Scala Case ç±» Java POJOs Primitive Types Regular Classes Values Hadoop Writables ç‰¹æ®Šç±»å‹  Tuples å’Œ Case ç±» Scala case ç±»ï¼ˆä»¥åŠ Scala tuplesï¼Œå®ƒæ˜¯ case ç±»çš„ä¸€ç§ç‰¹æ®Šç±»å‹ï¼‰ï¼Œæ˜¯åŒ…å«å›ºå®šæ•°é‡çš„å„ç§ç±»å‹çš„å­—æ®µçš„å¤åˆç±»å‹ã€‚å…ƒç»„å­—æ®µç”±å®ƒä»¬çš„ 1-offset åç§°å¯»å€ï¼Œä¾‹å¦‚ç¬¬ä¸€ä¸ªå­—æ®µä¸º _1ã€‚case ç±»å­—æ®µç”¨å®ƒä»¬çš„åå­—æ¥è®¿é—®ã€‚\ncase class WordCount(word: String, count: Int) val input = env.fromElements( WordCount(\u0026#34;hello\u0026#34;, 1), WordCount(\u0026#34;world\u0026#34;, 2)) // Case Class Data Set  input.keyBy(\u0026#34;word\u0026#34;)// key by field expression \u0026#34;word\u0026#34;  val input2 = env.fromElements((\u0026#34;hello\u0026#34;, 1), (\u0026#34;world\u0026#34;, 2)) // Tuple2 Data Set  input2.keyBy(0, 1) // key by field positions 0 and 1 POJOs å¦‚æœ Java å’Œ Scala ç±»æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼ŒFlink ä¼šå°†å…¶ä½œä¸ºä¸€ç§ç‰¹æ®Šçš„ POJO æ•°æ®ç±»å‹ã€‚\n  ç±»å¿…é¡»æ˜¯å…¬å…±çš„ã€‚\n  å®ƒå¿…é¡»æœ‰ä¸€ä¸ªæ²¡æœ‰å‚æ•°çš„å…¬å…±æ„é€ å‡½æ•°ï¼ˆé»˜è®¤æ„é€ å‡½æ•°ï¼‰ã€‚\n  æ‰€æœ‰å­—æ®µè¦ä¹ˆæ˜¯å…¬å…±çš„ï¼Œè¦ä¹ˆå¿…é¡»é€šè¿‡ getter å’Œ setter å‡½æ•°æ¥è®¿é—®ã€‚å¯¹äºä¸€ä¸ªåä¸º foo çš„å­—æ®µï¼Œgetter å’Œ setter æ–¹æ³•å¿…é¡»å‘½åä¸º getFoo() å’Œ  setFoo()ã€‚\n  å­—æ®µçš„ç±»å‹å¿…é¡»ç”±æ³¨å†Œçš„åºåˆ—å™¨æ”¯æŒã€‚\n  POJOs é€šå¸¸ç”¨ PojoTypeInfo è¡¨ç¤ºï¼Œå¹¶ç”¨ PojoSerializer åºåˆ—åŒ–ï¼ˆä½¿ç”¨ Kryo ä½œä¸ºå¯é…ç½®çš„å›é€€ï¼‰ã€‚ä¾‹å¤–çš„æƒ…å†µæ˜¯å½“ POJOs å®é™…ä¸Šæ˜¯ Avro ç±»å‹ï¼ˆAvro ç‰¹å®šè®°å½•ï¼‰æˆ–ä½œä¸º \u0026ldquo;Avro åå°„ç±»å‹ \u0026ldquo;äº§ç”Ÿã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒPOJO ç”± AvroTypeInfo è¡¨ç¤ºï¼Œå¹¶é€šè¿‡ AvroSerializer åºåˆ—åŒ–ã€‚å¦‚æœéœ€è¦ï¼Œæ‚¨ä¹Ÿå¯ä»¥æ³¨å†Œæ‚¨è‡ªå·±çš„è‡ªå®šä¹‰åºåˆ—åŒ–å™¨ï¼›æ›´å¤šä¿¡æ¯è¯·å‚è§åºåˆ—åŒ–ã€‚\nFlink åˆ†æ POJO ç±»å‹çš„ç»“æ„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒå­¦ä¹  POJO çš„å­—æ®µã€‚å› æ­¤ï¼ŒPOJO ç±»å‹æ¯”ä¸€èˆ¬ç±»å‹æ›´å®¹æ˜“ä½¿ç”¨ã€‚æ­¤å¤–ï¼ŒFlink å¯ä»¥æ¯”ä¸€èˆ¬ç±»å‹æ›´æœ‰æ•ˆåœ°å¤„ç† POJOã€‚\nä¸‹é¢çš„ä¾‹å­æ˜¾ç¤ºäº†ä¸€ä¸ªç®€å•çš„ POJOï¼Œå®ƒæœ‰ä¸¤ä¸ªå…¬å…±å­—æ®µã€‚\nclass WordWithCount(var word: String, var count: Int) { def this() { this(null, -1) } } val input = env.fromElements( new WordWithCount(\u0026#34;hello\u0026#34;, 1), new WordWithCount(\u0026#34;world\u0026#34;, 2)) // Case Class Data Set  input.keyBy(\u0026#34;word\u0026#34;)// key by field expression \u0026#34;word\u0026#34; åŸå§‹ç±»å‹ Flink æ”¯æŒæ‰€æœ‰çš„ Java å’Œ Scala åŸºå…ƒç±»å‹ï¼Œå¦‚ Integer, String å’Œ Doubleã€‚\né€šç”¨ç±»ç±»å‹ Flink æ”¯æŒå¤§å¤šæ•° Java å’Œ Scala ç±»ï¼ˆAPI å’Œè‡ªå®šä¹‰ï¼‰ã€‚é™åˆ¶é€‚ç”¨äºåŒ…å«ä¸èƒ½åºåˆ—åŒ–çš„å­—æ®µçš„ç±»ï¼Œå¦‚æ–‡ä»¶æŒ‡é’ˆã€I/O æµæˆ–å…¶ä»–æœ¬åœ°èµ„æºã€‚éµå¾ª Java Beans çº¦å®šçš„ç±»ä¸€èˆ¬éƒ½èƒ½å¾ˆå¥½åœ°å·¥ä½œã€‚\næ‰€æœ‰æ²¡æœ‰è¢«ç¡®å®šä¸º POJO ç±»å‹çš„ç±»ï¼ˆè§ä¸Šé¢çš„ POJO è¦æ±‚ï¼‰éƒ½è¢« Flink ä½œä¸ºä¸€èˆ¬ç±»ç±»å‹å¤„ç†ã€‚Flink å°†è¿™äº›æ•°æ®ç±»å‹è§†ä¸ºé»‘ç›’ï¼Œæ— æ³•è®¿é—®å®ƒä»¬çš„å†…å®¹ï¼ˆä¾‹å¦‚ï¼Œä¸ºäº†æœ‰æ•ˆçš„æ’åºï¼‰ã€‚ä¸€èˆ¬ç±»å‹ä½¿ç”¨åºåˆ—åŒ–æ¡†æ¶ Kryo è¿›è¡Œå»/åºåˆ—åŒ–ã€‚\nå€¼ Value ç±»å‹æ‰‹åŠ¨æè¿°å®ƒä»¬çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚å®ƒä»¬ä¸éœ€è¦é€šè¿‡ä¸€ä¸ªé€šç”¨çš„åºåˆ—åŒ–æ¡†æ¶ï¼Œè€Œæ˜¯é€šè¿‡å®ç° org.apache.flinktypes.Value æ¥å£çš„è¯»å†™æ–¹æ³•ï¼Œä¸ºè¿™äº›æ“ä½œæä¾›è‡ªå®šä¹‰ä»£ç ã€‚å½“é€šç”¨åºåˆ—åŒ–ä¼šéå¸¸ä½æ•ˆæ—¶ï¼Œä½¿ç”¨ Value ç±»å‹æ˜¯åˆç†çš„ã€‚ä¸€ä¸ªä¾‹å­æ˜¯ä¸€ä¸ªæ•°æ®ç±»å‹ï¼Œå®ƒå°†ä¸€ä¸ªç¨€ç–çš„å…ƒç´ å‘é‡å®ç°ä¸ºä¸€ä¸ªæ•°ç»„ã€‚çŸ¥é“æ•°ç»„å¤§éƒ¨åˆ†æ˜¯é›¶ï¼Œå°±å¯ä»¥å¯¹éé›¶å…ƒç´ ä½¿ç”¨ç‰¹æ®Šçš„ç¼–ç ï¼Œè€Œé€šç”¨åºåˆ—åŒ–ä¼šç®€å•åœ°å†™å…¥æ‰€æœ‰æ•°ç»„å…ƒç´ ã€‚\norg.apache.flinktypes.CopyableValue æ¥å£ä»¥ç±»ä¼¼çš„æ–¹å¼æ”¯æŒæ‰‹åŠ¨å†…éƒ¨å…‹éš†é€»è¾‘ã€‚\nFlink è‡ªå¸¦äº†é¢„å…ˆå®šä¹‰çš„ Value ç±»å‹ï¼Œå¯¹åº”åŸºæœ¬æ•°æ®ç±»å‹ã€‚ByteValueã€ShortValueã€IntValueã€LongValueã€FloatValueã€DoubleValueã€StringValueã€CharValueã€BooleanValueï¼‰ã€‚è¿™äº› Value ç±»å‹ä½œä¸ºåŸºæœ¬æ•°æ®ç±»å‹çš„å¯å˜ä½“ã€‚å®ƒä»¬çš„å€¼å¯ä»¥è¢«æ”¹å˜ï¼Œå…è®¸ç¨‹åºå‘˜é‡ç”¨å¯¹è±¡å¹¶å‡è½»åƒåœ¾æ”¶é›†å™¨çš„å‹åŠ›ã€‚\nHadoop å¯å†™ç±»å‹ ä½ å¯ä»¥ä½¿ç”¨å®ç° org.apache.hadoop.Writable æ¥å£çš„ç±»å‹ã€‚åœ¨ write() å’Œ readFields() æ–¹æ³•ä¸­å®šä¹‰çš„åºåˆ—åŒ–é€»è¾‘å°†è¢«ç”¨äºåºåˆ—åŒ–ã€‚\nç‰¹æ®Šç±»å‹ ä½ å¯ä»¥ä½¿ç”¨ç‰¹æ®Šç±»å‹ï¼ŒåŒ…æ‹¬ Scala çš„ Eitherã€Option å’Œ Tryã€‚Java API å¯¹ Either æœ‰è‡ªå·±çš„è‡ªå®šä¹‰å®ç°ã€‚ç±»ä¼¼äº Scala çš„ Eitherï¼Œå®ƒä»£è¡¨äº†ä¸¤ç§å¯èƒ½çš„ç±»å‹çš„å€¼ï¼Œå·¦æˆ–å³ã€‚Either å¯¹äºé”™è¯¯å¤„ç†æˆ–éœ€è¦è¾“å‡ºä¸¤ç§ä¸åŒç±»å‹è®°å½•çš„æ“ä½œç¬¦æ¥è¯´éå¸¸æœ‰ç”¨ã€‚\nç±»å‹æ“¦é™¤å’Œç±»å‹æ¨æ–­ã€‚ æ³¨æ„ï¼šæœ¬èŠ‚åªä¸ Java ç›¸å…³ã€‚\nJava ç¼–è¯‘å™¨åœ¨ç¼–è¯‘åä¼šä¸¢å¼ƒå¾ˆå¤šé€šç”¨ç±»å‹ä¿¡æ¯ã€‚è¿™åœ¨ Java ä¸­è¢«ç§°ä¸ºç±»å‹æ¸…é™¤ã€‚è¿™æ„å‘³ç€åœ¨è¿è¡Œæ—¶ï¼Œä¸€ä¸ªå¯¹è±¡çš„å®ä¾‹ä¸å†çŸ¥é“å®ƒçš„é€šç”¨ç±»å‹ã€‚ä¾‹å¦‚ï¼ŒDataStream\u0026lt;String\u0026gt; å’Œ DataStream\u0026lt;Long\u0026gt; çš„å®ä¾‹åœ¨ JVM çœ‹æ¥æ˜¯ä¸€æ ·çš„ã€‚\nFlink åœ¨å‡†å¤‡æ‰§è¡Œç¨‹åºæ—¶ï¼ˆè°ƒç”¨ç¨‹åºçš„ä¸»æ–¹æ³•æ—¶ï¼‰éœ€è¦ç±»å‹ä¿¡æ¯ã€‚Flink Java API è¯•å›¾é‡å»ºä»¥å„ç§æ–¹å¼æ‰”æ‰çš„ç±»å‹ä¿¡æ¯ï¼Œå¹¶å°†å…¶æ˜¾å¼å­˜å‚¨åœ¨æ•°æ®é›†å’Œè¿ç®—ç¬¦ä¸­ã€‚ä½ å¯ä»¥é€šè¿‡ DataStream.getType() æ¥æ£€ç´¢ç±»å‹ã€‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª TypeInformation çš„å®ä¾‹ï¼Œè¿™æ˜¯ Flink å†…éƒ¨è¡¨ç¤ºç±»å‹çš„æ–¹å¼ã€‚\nç±»å‹æ¨ç†æœ‰å…¶å±€é™æ€§ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹éœ€è¦ç¨‹åºå‘˜çš„ \u0026ldquo;é…åˆ\u0026rdquo;ã€‚ä¾‹å¦‚ä»é›†åˆä¸­åˆ›å»ºæ•°æ®é›†çš„æ–¹æ³•ï¼Œå¦‚ ExecutionEnvironment.fromCollection()ï¼Œä½ å¯ä»¥ä¼ é€’ä¸€ä¸ªæè¿°ç±»å‹çš„å‚æ•°ã€‚ä½†æ˜¯åƒ MapFunction\u0026lt;I, O\u0026gt; è¿™æ ·çš„é€šç”¨å‡½æ•°ä¹Ÿå¯èƒ½éœ€è¦é¢å¤–çš„ç±»å‹ä¿¡æ¯ã€‚\nResultTypeQueryable æ¥å£å¯ä»¥ç”±è¾“å…¥æ ¼å¼å’Œå‡½æ•°å®ç°ï¼Œä»¥æ˜ç¡®åœ°å‘Šè¯‰ API å®ƒä»¬çš„è¿”å›ç±»å‹ã€‚å‡½æ•°è¢«è°ƒç”¨çš„è¾“å…¥ç±»å‹é€šå¸¸å¯ä»¥é€šè¿‡å‰é¢æ“ä½œçš„ç»“æœç±»å‹æ¥æ¨æ–­ã€‚\nFlink ä¸­çš„ç±»å‹å¤„ç† Flink è¯•å›¾æ¨æ–­å‡ºå¾ˆå¤šå…³äºåˆ†å¸ƒå¼è®¡ç®—è¿‡ç¨‹ä¸­äº¤æ¢å’Œå­˜å‚¨çš„æ•°æ®ç±»å‹çš„ä¿¡æ¯ã€‚æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªæ•°æ®åº“ï¼Œæ¨æ–­è¡¨çš„æ¨¡å¼ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒFlink è‡ªå·±å°±èƒ½æ— ç¼åœ°æ¨æ–­å‡ºæ‰€æœ‰å¿…è¦çš„ä¿¡æ¯ã€‚æœ‰äº†ç±»å‹ä¿¡æ¯ï¼ŒFlink å°±å¯ä»¥åšä¸€äº›å¾ˆé…·çš„äº‹æƒ…ã€‚\n  Flink å¯¹æ•°æ®ç±»å‹äº†è§£å¾—è¶Šå¤šï¼Œåºåˆ—åŒ–å’Œæ•°æ®å¸ƒå±€æ–¹æ¡ˆå°±è¶Šå¥½ã€‚è¿™å¯¹äº Flink ä¸­çš„å†…å­˜ä½¿ç”¨èŒƒå¼ç›¸å½“é‡è¦ï¼ˆå°½å¯èƒ½åœ¨å †å†…/å †å¤–å¯¹åºåˆ—åŒ–æ•°æ®è¿›è¡Œå·¥ä½œï¼Œå¹¶ä½¿åºåˆ—åŒ–éå¸¸ä¾¿å®œï¼‰ã€‚\n  æœ€åï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™ä¹Ÿå…å»äº†ç”¨æˆ·å¯¹åºåˆ—åŒ–æ¡†æ¶çš„æ‹…å¿ƒï¼Œä¹Ÿå…å»äº†å¯¹ç±»å‹çš„æ³¨å†Œã€‚\n  ä¸€èˆ¬æ¥è¯´ï¼Œå…³äºæ•°æ®ç±»å‹çš„ä¿¡æ¯æ˜¯åœ¨é£è¡Œå‰é˜¶æ®µéœ€è¦çš„\u0026ndash;ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ç¨‹åºå¯¹ DataStream å’Œ DataSet è¿›è¡Œè°ƒç”¨æ—¶ï¼Œä»¥åŠåœ¨å¯¹ execute()ã€print()ã€count() æˆ– collect() è¿›è¡Œä»»ä½•è°ƒç”¨ä¹‹å‰ã€‚\næœ€å¸¸è§çš„é—®é¢˜ ç”¨æˆ·æœ€ç»å¸¸éœ€è¦ä¸ Flink çš„æ•°æ®ç±»å‹å¤„ç†è¿›è¡Œäº¤äº’çš„é—®é¢˜æ˜¯ã€‚\n  æ³¨å†Œå­ç±»å‹ã€‚å¦‚æœå‡½æ•°ç­¾ååªæè¿°äº†è¶…ç±»å‹ï¼Œä½†å®ƒä»¬åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å®é™…ä½¿ç”¨äº†è¿™äº›å­ç±»å‹ï¼Œé‚£ä¹ˆè®© Flink æ„è¯†åˆ°è¿™äº›å­ç±»å‹å¯èƒ½ä¼šæé«˜å¾ˆå¤šæ€§èƒ½ã€‚ä¸ºæ­¤ï¼Œå¯ä»¥åœ¨ StreamExecutionEnvironment æˆ– ExecutionEnvironment ä¸Šä¸ºæ¯ä¸ªå­ç±»å‹è°ƒç”¨ .registerType(clazz)ã€‚\n  æ³¨å†Œè‡ªå®šä¹‰åºåˆ—å™¨ã€‚Flink å¯¹äºé‚£äº›è‡ªå·±ä¸é€æ˜å¤„ç†çš„ç±»å‹åˆå›åˆ°äº† Kryoã€‚å¹¶éæ‰€æœ‰ç±»å‹éƒ½èƒ½è¢« Kryo æ— ç¼å¤„ç†ï¼ˆå› æ­¤ä¹Ÿèƒ½è¢« Flink å¤„ç†ï¼‰ã€‚ä¾‹å¦‚ï¼Œè®¸å¤š Google Guava é›†åˆç±»å‹åœ¨é»˜è®¤æƒ…å†µä¸‹ä¸èƒ½å¾ˆå¥½åœ°å·¥ä½œã€‚è§£å†³çš„åŠæ³•æ˜¯ä¸ºå¯¼è‡´é—®é¢˜çš„ç±»å‹æ³¨å†Œé¢å¤–çš„åºåˆ—å™¨ã€‚åœ¨ StreamExecutionEnvironment æˆ– ExecutionEnvironment ä¸Šè°ƒç”¨.getConfig().addDefaultKryoSerializer( clazz, serializer)ã€‚è®¸å¤šåº“ä¸­éƒ½æœ‰é¢å¤–çš„ Kryo åºåˆ—åŒ–å™¨ã€‚æœ‰å…³ä½¿ç”¨è‡ªå®šä¹‰åºåˆ—å™¨çš„æ›´å¤šç»†èŠ‚ï¼Œè¯·å‚è§è‡ªå®šä¹‰åºåˆ—å™¨ã€‚\n  æ·»åŠ ç±»å‹æç¤ºã€‚æœ‰æ—¶ï¼Œå½“ Flink å°½ç®¡ä½¿ç”¨äº†æ‰€æœ‰æŠ€å·§ä¹Ÿæ— æ³•æ¨æ–­å‡ºé€šç”¨ç±»å‹æ—¶ï¼Œç”¨æˆ·å¿…é¡»ä¼ é€’ä¸€ä¸ªç±»å‹æç¤ºã€‚è¿™ä¸€èˆ¬åªåœ¨ Java API ä¸­æ‰éœ€è¦ã€‚ç±»å‹æç¤ºä¸€èŠ‚å¯¹æ­¤è¿›è¡Œäº†æ›´è¯¦ç»†çš„æè¿°ã€‚\n  æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ª TypeInformationã€‚å¯¹äºä¸€äº› API è°ƒç”¨æ¥è¯´ï¼Œè¿™å¯èƒ½æ˜¯å¿…è¦çš„ï¼Œç”±äº Java çš„é€šç”¨ç±»å‹æ“¦é™¤ï¼ŒFlink ä¸å¯èƒ½æ¨æ–­å‡ºæ•°æ®ç±»å‹ã€‚è¯¦æƒ…è¯·çœ‹åˆ›å»º TypeInformation æˆ– TypeSerializerã€‚\n  Flink çš„ TypeInformation ç±» TypeInformation ç±»æ˜¯æ‰€æœ‰ç±»å‹æè¿°ç¬¦çš„åŸºç¡€ç±»ã€‚å®ƒæ­ç¤ºäº†ç±»å‹çš„ä¸€äº›åŸºæœ¬å±æ€§ï¼Œå¹¶ä¸”å¯ä»¥ç”Ÿæˆåºåˆ—å™¨ï¼Œåœ¨ç‰¹æ®ŠåŒ–ä¸­ï¼Œå¯ä»¥ç”Ÿæˆç±»å‹çš„æ¯”è¾ƒå™¨ã€‚(æ³¨æ„ï¼ŒFlink ä¸­çš„æ¯”è¾ƒå™¨çš„ä½œç”¨è¿œä¸æ­¢å®šä¹‰ä¸€ä¸ªé¡ºåº\u0026ndash;å®ƒä»¬åŸºæœ¬ä¸Šæ˜¯å¤„ç†é”®çš„å®ç”¨ç¨‹åº)\nåœ¨å†…éƒ¨ï¼ŒFlink å¯¹ç±»å‹åšäº†å¦‚ä¸‹åŒºåˆ†ã€‚\n  åŸºæœ¬ç±»å‹ã€‚æ‰€æœ‰çš„ Java åŸºå…ƒå’Œå®ƒä»¬çš„ç›’å­å½¢å¼ï¼ŒåŠ ä¸Š voidï¼ŒStringï¼ŒDateï¼ŒBigDecimal å’Œ BigIntegerã€‚\n  åŸºå…ƒæ•°ç»„å’Œå¯¹è±¡æ•°ç»„ï¼šåŸºæœ¬ç±»å‹ï¼šæ‰€æœ‰çš„ Java åŸºå…ƒå’Œå®ƒä»¬çš„ç›’å­å½¢å¼ï¼ŒåŠ ä¸Š voidã€Stringã€Dateã€BigDecimal å’Œ BigIntegerã€‚\n  å¤åˆå‹\n Flink Java Tuples(Flink Java API çš„ä¸€éƒ¨åˆ†)ï¼šæœ€å¤š 25 ä¸ªå­—æ®µï¼Œä¸æ”¯æŒ null å­—æ®µã€‚ Scala case ç±»ï¼ˆåŒ…æ‹¬ Scala tuplesï¼‰ï¼šä¸æ”¯æŒ null å­—æ®µã€‚ Rowï¼šå…·æœ‰ä»»æ„æ•°é‡å­—æ®µçš„å…ƒç»„ï¼Œæ”¯æŒ null å­—æ®µã€‚ POJOsï¼šéµå¾ªæŸç§ bean-like æ¨¡å¼çš„ç±»ã€‚    è¾…åŠ©ç±»å‹(Optionã€Eitherã€Listsã€Maps\u0026hellip;)\n  é€šç”¨ç±»å‹ã€‚è¿™äº›ç±»å‹ä¸ä¼šç”± Flink æœ¬èº«åºåˆ—åŒ–ï¼Œè€Œæ˜¯ç”± Kryo åºåˆ—åŒ–ã€‚\n  POJOs ç‰¹åˆ«å€¼å¾—å…³æ³¨ï¼Œå› ä¸ºå®ƒä»¬æ”¯æŒåˆ›å»ºå¤æ‚ç±»å‹å’Œåœ¨é”®çš„å®šä¹‰ä¸­ä½¿ç”¨å­—æ®µåï¼šdataSet.join(another).where(\u0026quot;name\u0026quot;).equalTo(\u0026quot;personName\u0026quot;)ã€‚å®ƒä»¬å¯¹è¿è¡Œæ—¶ä¹Ÿæ˜¯é€æ˜çš„ï¼Œå¯ä»¥è¢« Flink éå¸¸æœ‰æ•ˆåœ°å¤„ç†ã€‚\nPOJO ç±»å‹çš„è§„åˆ™ å¦‚æœæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼ŒFlink å°†æ•°æ®ç±»å‹è¯†åˆ«ä¸º POJO ç±»å‹ï¼ˆå¹¶å…è®¸ \u0026ldquo;æŒ‰åç§° \u0026ldquo;å­—æ®µå¼•ç”¨ï¼‰ã€‚\n ç±»æ˜¯å…¬å…±çš„å’Œç‹¬ç«‹çš„ï¼ˆæ²¡æœ‰éé™æ€çš„å†…éƒ¨ç±»ï¼‰ã€‚ è¯¥ç±»æœ‰ä¸€ä¸ªå…¬å…±çš„æ— å‚æ•°æ„é€ å‡½æ•°ã€‚ è¯¥ç±»ï¼ˆä»¥åŠæ‰€æœ‰è¶…çº§ç±»ï¼‰ä¸­æ‰€æœ‰éé™æ€ã€éç¬æ€çš„å­—æ®µè¦ä¹ˆæ˜¯å…¬å…±çš„ï¼ˆæ˜¯éæœ€ç»ˆçš„ï¼‰ï¼Œè¦ä¹ˆæœ‰ä¸€ä¸ªå…¬å…±çš„ getter- å’Œ setter- æ–¹æ³•ï¼Œéµå¾ª Java beans ä¸­ getter å’Œ setter çš„å‘½åæƒ¯ä¾‹ã€‚  è¯·æ³¨æ„ï¼Œå½“ç”¨æˆ·å®šä¹‰çš„æ•°æ®ç±»å‹ä¸èƒ½è¢«è¯†åˆ«ä¸º POJO ç±»å‹æ—¶ï¼Œå®ƒå¿…é¡»è¢«å¤„ç†ä¸º GenericType å¹¶é€šè¿‡ Kryo è¿›è¡Œåºåˆ—åŒ–ã€‚\nåˆ›å»ºä¸€ä¸ª TypeInformation æˆ– TypeSerializerã€‚ è¦ä¸ºä¸€ä¸ªç±»å‹åˆ›å»º TypeInformation å¯¹è±¡ï¼Œè¯·ä½¿ç”¨è¯­è¨€ç‰¹å®šçš„æ–¹å¼ã€‚\nåœ¨ Scala ä¸­ï¼ŒFlink ä½¿ç”¨åœ¨ç¼–è¯‘æ—¶è¿è¡Œçš„å®ï¼Œå¹¶æ•æ‰æ‰€æœ‰é€šç”¨ç±»å‹ä¿¡æ¯ï¼Œè€Œå®ƒä»ç„¶å¯ç”¨ã€‚\n// important: this import is needed to access the \u0026#39;createTypeInformation\u0026#39; macro function import org.apache.flink.streaming.api.scala._ val stringInfo: TypeInformation[String] = createTypeInformation[String] val tupleInfo: TypeInformation[(String, Double)] = createTypeInformation[(String, Double)] ä½ ä»ç„¶å¯ä»¥ä½¿ç”¨ä¸ Java ä¸­ç›¸åŒçš„æ–¹æ³•ä½œä¸ºåå¤‡ã€‚\nè¦åˆ›å»ºä¸€ä¸ª TypeSerializerï¼Œåªéœ€åœ¨ TypeInformation å¯¹è±¡ä¸Šè°ƒç”¨ typeInfo.createSerializer(config)ã€‚\nconfig å‚æ•°çš„ç±»å‹æ˜¯ ExecutionConfigï¼Œå¹¶æŒæœ‰ç¨‹åºæ³¨å†Œçš„è‡ªå®šä¹‰åºåˆ—å™¨çš„ä¿¡æ¯ã€‚åœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œå°½é‡ä¼ é€’ç¨‹åºçš„æ­£ç¡®çš„ ExecutionConfigã€‚ä½ é€šå¸¸å¯ä»¥é€šè¿‡è°ƒç”¨ getExecutionConfig() ä» DataStream æˆ– DataSet ä¸­è·å–å®ƒã€‚åœ¨å‡½æ•°å†…éƒ¨ï¼ˆæ¯”å¦‚ MapFunctionï¼‰ï¼Œä½ å¯ä»¥é€šè¿‡å°†å‡½æ•°å˜æˆ Rich Functionï¼Œç„¶åè°ƒç”¨ getRuntimeContext().getExecutionConfig() æ¥è·å–å®ƒã€‚\nScala API ä¸­çš„ç±»å‹ä¿¡æ¯ Scala é€šè¿‡ç±»å‹æ¸…å•å’Œç±»æ ‡ç­¾å¯¹è¿è¡Œæ—¶ç±»å‹ä¿¡æ¯æœ‰éå¸¸è¯¦ç»†çš„æ¦‚å¿µã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç±»å‹å’Œæ–¹æ³•å¯ä»¥è®¿é—®å…¶é€šç”¨å‚æ•°çš„ç±»å‹\u0026ndash;å› æ­¤ï¼ŒScala ç¨‹åºä¸ä¼šåƒ Java ç¨‹åºé‚£æ ·å—åˆ°ç±»å‹æ“¦é™¤çš„å½±å“ã€‚\næ­¤å¤–ï¼ŒScala å…è®¸é€šè¿‡ Scala Macros åœ¨ Scala ç¼–è¯‘å™¨ä¸­è¿è¡Œè‡ªå®šä¹‰ä»£ç \u0026ndash;è¿™æ„å‘³ç€æ¯å½“ä½ ç¼–è¯‘ä¸€ä¸ªé’ˆå¯¹ Flink çš„ Scala API ç¼–å†™çš„ Scala ç¨‹åºæ—¶ï¼Œä¸€äº› Flink ä»£ç å°±ä¼šè¢«æ‰§è¡Œã€‚\næˆ‘ä»¬åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ä½¿ç”¨å®æ¥æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·å‡½æ•°çš„å‚æ•°ç±»å‹å’Œè¿”å›ç±»å‹\u0026ndash;è¿™æ—¶å½“ç„¶æ‰€æœ‰çš„ç±»å‹ä¿¡æ¯éƒ½æ˜¯å®Œå…¨å¯ç”¨çš„ã€‚åœ¨å®ä¸­ï¼Œæˆ‘ä»¬ä¸ºå‡½æ•°çš„è¿”å›ç±»å‹ï¼ˆæˆ–å‚æ•°ç±»å‹ï¼‰åˆ›å»ºä¸€ä¸ª TypeInformationï¼Œå¹¶å°†å…¶ä½œä¸ºæ“ä½œçš„ä¸€éƒ¨åˆ†ã€‚\næ²¡æœ‰éšå¼å€¼çš„è¯æ®å‚æ•°é”™è¯¯ åœ¨ TypeInformation ä¸èƒ½è¢«åˆ›å»ºçš„æƒ…å†µä¸‹ï¼Œç¨‹åºç¼–è¯‘å¤±è´¥ï¼Œå¹¶å‡ºç° \u0026ldquo;could not find implicit value for evidence parameter of type TypeInformation\u0026rdquo; çš„é”™è¯¯ã€‚\nä¸€ä¸ªå¸¸è§çš„åŸå› æ˜¯ç”Ÿæˆ TypeInformation çš„ä»£ç æ²¡æœ‰è¢«å¯¼å…¥ã€‚è¯·ç¡®ä¿å¯¼å…¥æ•´ä¸ª flink.api.scala åŒ…ã€‚\nimport org.apache.flink.api.scala._ å¦ä¸€ä¸ªå¸¸è§çš„åŸå› æ˜¯é€šç”¨æ–¹æ³•ï¼Œå®ƒå¯ä»¥åœ¨ä¸‹é¢çš„ç« èŠ‚ä¸­è¿›è¡Œä¿®å¤ã€‚\né€šç”¨æ–¹æ³• è¯·è€ƒè™‘ä»¥ä¸‹æ¡ˆä¾‹ã€‚\ndef selectFirst[T](input: DataSet[(T, _)]) : DataSet[T] = { input.map { v =\u0026gt; v._1 } } val data : DataSet[(String, Long) = ... val result = selectFirst(data) å¯¹äºè¿™æ ·çš„é€šç”¨æ–¹æ³•ï¼Œæ¯æ¬¡è°ƒç”¨æ—¶ï¼Œå‡½æ•°å‚æ•°å’Œè¿”å›ç±»å‹çš„æ•°æ®ç±»å‹å¯èƒ½ä¸ä¸€æ ·ï¼Œåœ¨å®šä¹‰æ–¹æ³•çš„ç«™ç‚¹ä¸çŸ¥é“ã€‚ä¸Šé¢çš„ä»£ç ä¼šå¯¼è‡´ä¸€ä¸ªé”™è¯¯ï¼Œå³æ²¡æœ‰è¶³å¤Ÿçš„éšå«è¯æ®ã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¿…é¡»åœ¨è°ƒç”¨ç«™ç‚¹ç”Ÿæˆç±»å‹ä¿¡æ¯å¹¶ä¼ é€’ç»™æ–¹æ³•ã€‚Scala ä¸ºæ­¤æä¾›äº†éšå¼å‚æ•°ã€‚\nä¸‹é¢çš„ä»£ç å‘Šè¯‰ Scala å°† T çš„ç±»å‹ä¿¡æ¯å¸¦å…¥å‡½æ•°ä¸­ã€‚ç„¶åï¼Œç±»å‹ä¿¡æ¯å°†åœ¨æ–¹æ³•è¢«è°ƒç”¨çš„ç«™ç‚¹ç”Ÿæˆï¼Œè€Œä¸æ˜¯åœ¨æ–¹æ³•è¢«å®šä¹‰çš„ç«™ç‚¹ç”Ÿæˆã€‚\ndef selectFirst[T : TypeInformation](input: DataSet[(T, _)]) : DataSet[T] = { input.map { v =\u0026gt; v._1 } } Java API ä¸­çš„ç±»å‹ä¿¡æ¯ åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒJava ä¼šæ“¦é™¤é€šç”¨ç±»å‹ä¿¡æ¯ï¼Œè€Œ Flink è¯•å›¾é€šè¿‡åå°„æ¥é‡å»ºå°½å¯èƒ½å¤šçš„ç±»å‹ä¿¡æ¯ï¼Œä½¿ç”¨ Java ä¿ç•™çš„å°‘é‡ä¿¡æ¯ï¼ˆä¸»è¦æ˜¯å‡½æ•°ç­¾åå’Œå­ç±»ä¿¡æ¯ï¼‰ã€‚Flink è¯•å›¾é€šè¿‡åå°„æ¥é‡å»ºå°½å¯èƒ½å¤šçš„ç±»å‹ä¿¡æ¯ï¼Œä½¿ç”¨ Java ä¿ç•™çš„å°‘é‡ä¿¡æ¯ï¼ˆä¸»è¦æ˜¯å‡½æ•°ç­¾åå’Œå­ç±»ä¿¡æ¯ï¼‰ã€‚è¿™ä¸ªé€»è¾‘è¿˜åŒ…å«äº†ä¸€äº›ç®€å•çš„ç±»å‹æ¨ç†ï¼Œç”¨äºå‡½æ•°çš„è¿”å›ç±»å‹å–å†³äºå…¶è¾“å…¥ç±»å‹çš„æƒ…å†µã€‚\npublic class AppendOne\u0026lt;T\u0026gt; implements MapFunction\u0026lt;T, Tuple2\u0026lt;T, Long\u0026gt;\u0026gt; { public Tuple2\u0026lt;T, Long\u0026gt; map(T value) { return new Tuple2\u0026lt;T, Long\u0026gt;(value, 1L); } } åœ¨æœ‰äº›æƒ…å†µä¸‹ï¼ŒFlink æ— æ³•é‡å»ºæ‰€æœ‰çš„é€šç”¨ç±»å‹ä¿¡æ¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç”¨æˆ·å¿…é¡»é€šè¿‡ç±»å‹æç¤ºæ¥å¸®å¿™ã€‚\nJava API ä¸­çš„ç±»å‹æç¤º åœ¨ Flink æ— æ³•é‡å»ºè¢«æ“¦é™¤çš„é€šç”¨ç±»å‹ä¿¡æ¯çš„æƒ…å†µä¸‹ï¼ŒJava API æä¾›äº†æ‰€è°“çš„ç±»å‹æç¤ºã€‚ç±»å‹æç¤ºå‘Šè¯‰ç³»ç»Ÿä¸€ä¸ªå‡½æ•°äº§ç”Ÿçš„æ•°æ®æµæˆ–æ•°æ®é›†çš„ç±»å‹ã€‚\nDataSet\u0026lt;SomeType\u0026gt; result = dataSet .map(new MyGenericNonInferrableFunction\u0026lt;Long, SomeType\u0026gt;()) .returns(SomeType.class); returns è¯­å¥æŒ‡å®šäº§ç”Ÿçš„ç±»å‹ï¼Œåœ¨æœ¬ä¾‹ä¸­æ˜¯é€šè¿‡ä¸€ä¸ªç±»ã€‚æç¤ºæ”¯æŒç±»å‹å®šä¹‰ï¼Œé€šè¿‡:\n ç±»ï¼Œé€‚ç”¨äºéå‚æ•°åŒ–ç±»å‹(æ— å±ç±») TypeHint ä»¥ returns(new TypeHint\u0026lt;Tuple2\u0026lt;Integer, SomeType\u0026gt;\u0026gt;(){}) çš„å½¢å¼å­˜åœ¨ã€‚TypeHint ç±»å¯ä»¥æ•è·é€šç”¨ç±»å‹ä¿¡æ¯ï¼Œå¹¶å°†å…¶ä¿å­˜åˆ°è¿è¡Œæ—¶ï¼ˆé€šè¿‡åŒ¿åå­ç±»ï¼‰ã€‚  Java 8 lambdas çš„ç±»å‹æå–ã€‚ Java 8 lambdas çš„ç±»å‹æå–ä¸é lambdas çš„å·¥ä½œæ–¹å¼ä¸åŒï¼Œå› ä¸º lambdas ä¸ä¸æ‰©å±•å‡½æ•°æ¥å£çš„å®ç°ç±»ç›¸å…³è”ã€‚\nç›®å‰ï¼ŒFlink è¯•å›¾æ‰¾å‡ºå“ªä¸ªæ–¹æ³•å®ç°äº† lambdaï¼Œå¹¶ä½¿ç”¨ Java çš„é€šç”¨ç­¾åæ¥ç¡®å®šå‚æ•°ç±»å‹å’Œè¿”å›ç±»å‹ã€‚ç„¶è€Œï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ç¼–è¯‘å™¨éƒ½èƒ½ä¸º lambdas ç”Ÿæˆè¿™äº›ç­¾åï¼ˆåœ¨å†™è¿™ç¯‡æ–‡æ¡£æ—¶ï¼Œåªæœ‰ 4.5 ä»¥åçš„ Eclipse JDT ç¼–è¯‘å™¨èƒ½å¯é åœ°ç”Ÿæˆï¼‰ã€‚\nPOJO ç±»å‹çš„åºåˆ—åŒ– PojoTypeInfo æ­£åœ¨ä¸º POJO å†…éƒ¨çš„æ‰€æœ‰å­—æ®µåˆ›å»ºåºåˆ—å™¨ã€‚æ ‡å‡†ç±»å‹ï¼Œå¦‚ intã€longã€String ç­‰ï¼Œç”± Flink é™„å¸¦çš„åºåˆ—å™¨å¤„ç†ã€‚å¯¹äºæ‰€æœ‰å…¶ä»–ç±»å‹ï¼Œæˆ‘ä»¬å›åˆ°äº† Kryoã€‚\nå¦‚æœ Kryo ä¸èƒ½å¤„ç†ç±»å‹ï¼Œä½ å¯ä»¥è¦æ±‚ PojoTypeInfo ä½¿ç”¨ Avro æ¥åºåˆ—åŒ– POJOã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½ å¿…é¡»è°ƒç”¨\nfinal ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment(); env.getConfig().enableForceAvro(); è¯·æ³¨æ„ï¼ŒFlink æ˜¯ç”¨ Avro åºåˆ—åŒ–å™¨è‡ªåŠ¨åºåˆ—åŒ– Avro ç”Ÿæˆçš„ POJOã€‚\nå¦‚æœæ‚¨æƒ³è®©æ•´ä¸ª POJO ç±»å‹è¢« Kryo åºåˆ—åŒ–å™¨å¤„ç†ï¼Œè¯·è®¾ç½®\nfinal ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment(); env.getConfig().enableForceKryo(); å¦‚æœ Kryo æ— æ³•åºåˆ—åŒ–ä½ çš„ POJOï¼Œä½ å¯ä»¥åœ¨ Kryo ä¸­æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰åºåˆ—åŒ–å™¨ï¼Œä½¿ç”¨\nenv.getConfig().addDefaultKryoSerializer(Class\u0026lt;?\u0026gt; type, Class\u0026lt;? extends Serializer\u0026lt;?\u0026gt;\u0026gt; serializerClass) è¿™äº›æ–¹æ³•æœ‰ä¸åŒçš„å˜ä½“ã€‚\nç¦ç”¨ Kryo Fallback æœ‰äº›æƒ…å†µä¸‹ï¼Œç¨‹åºå¯èƒ½å¸Œæœ›æ˜ç¡®é¿å…ä½¿ç”¨ Kryo ä½œä¸ºé€šç”¨ç±»å‹çš„åå¤‡ã€‚æœ€å¸¸è§çš„æƒ…å†µæ˜¯å¸Œæœ›ç¡®ä¿æ‰€æœ‰ç±»å‹éƒ½èƒ½é€šè¿‡ Flink è‡ªå·±çš„åºåˆ—åŒ–å™¨æˆ–é€šè¿‡ç”¨æˆ·å®šä¹‰çš„è‡ªå®šä¹‰åºåˆ—åŒ–å™¨è¿›è¡Œæœ‰æ•ˆåºåˆ—åŒ–ã€‚\nä¸‹é¢çš„è®¾ç½®ä¼šåœ¨é‡åˆ°ä¼šé€šè¿‡ Kryo çš„æ•°æ®ç±»å‹æ—¶å¼•å‘å¼‚å¸¸ã€‚\nenv.getConfig().disableGenericTypes(); ä½¿ç”¨å·¥å‚å®šä¹‰ç±»å‹ä¿¡æ¯ ç±»å‹ä¿¡æ¯å·¥å‚å…è®¸å°†ç”¨æˆ·å®šä¹‰çš„ç±»å‹ä¿¡æ¯æ’å…¥åˆ° Flink ç±»å‹ç³»ç»Ÿä¸­ã€‚ä½ å¿…é¡»å®ç° org.apache.flink.api.common.typeinfo.TypeInfoFactory æ¥è¿”å›ä½ çš„è‡ªå®šä¹‰ç±»å‹ä¿¡æ¯ã€‚å¦‚æœç›¸åº”çš„ç±»å‹å·²ç»è¢« @org.apache.flink.api.common.typeinfo.TypeInfo æ³¨è§£ï¼Œé‚£ä¹ˆåœ¨ç±»å‹æå–é˜¶æ®µå°±ä¼šè°ƒç”¨è¿™ä¸ªå·¥å‚ã€‚\nç±»å‹ä¿¡æ¯å·¥å‚å¯ä»¥åœ¨ Java å’Œ Scala API ä¸­ä½¿ç”¨ã€‚\nåœ¨ç±»å‹çš„å±‚æ¬¡ç»“æ„ä¸­ï¼Œåœ¨å‘ä¸Šéå†æ—¶å°†é€‰æ‹©æœ€æ¥è¿‘çš„å·¥å‚ï¼Œç„¶è€Œï¼Œå†…ç½®å·¥å‚å…·æœ‰æœ€é«˜çš„ä¼˜å…ˆçº§ã€‚å·¥å‚ä¹Ÿæ¯” Flink çš„å†…ç½®ç±»å‹æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ï¼Œå› æ­¤ä½ åº”è¯¥çŸ¥é“ä½ åœ¨åšä»€ä¹ˆã€‚\nä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨ Java ä¸­ä½¿ç”¨å·¥å‚æ¥æ³¨é‡Šä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹ MyTuple å¹¶ä¸ºå…¶æä¾›è‡ªå®šä¹‰ç±»å‹ä¿¡æ¯ã€‚\næ³¨è§£çš„è‡ªå®šä¹‰ç±»å‹:\n@TypeInfo(MyTupleTypeInfoFactory.class) public class MyTuple\u0026lt;T0, T1\u0026gt; { public T0 myfield0; public T1 myfield1; } å·¥å‚ä¾›åº”è‡ªå®šä¹‰ç±»å‹ä¿¡æ¯:\npublic class MyTupleTypeInfoFactory extends TypeInfoFactory\u0026lt;MyTuple\u0026gt; { @Override public TypeInformation\u0026lt;MyTuple\u0026gt; createTypeInfo(Type t, Map\u0026lt;String, TypeInformation\u0026lt;?\u0026gt;\u0026gt; genericParameters) { return new MyTupleTypeInfo(genericParameters.get(\u0026#34;T0\u0026#34;), genericParameters.get(\u0026#34;T1\u0026#34;)); } } æ–¹æ³• createTypeInfo(Type, Map\u0026lt;String, TypeInformation\u0026lt;?\u0026gt;) ä¸ºå·¥å‚çš„ç›®æ ‡ç±»å‹åˆ›å»ºç±»å‹ä¿¡æ¯ã€‚å‚æ•°æä¾›äº†å…³äºç±»å‹æœ¬èº«çš„é™„åŠ ä¿¡æ¯ï¼Œä»¥åŠç±»å‹çš„é€šç”¨ç±»å‹å‚æ•°ï¼ˆå¦‚æœå¯ç”¨ï¼‰ã€‚\nå¦‚æœä½ çš„ç±»å‹åŒ…å«äº†å¯èƒ½éœ€è¦ä» Flink å‡½æ•°çš„è¾“å…¥ç±»å‹ä¸­å¯¼å‡ºçš„é€šç”¨å‚æ•°ï¼Œè¯·ç¡®ä¿åŒæ—¶å®ç° org.apache.flink.api.common.typeinfo.TypeInformation#getGenericParameters æ¥å®ç°é€šç”¨å‚æ•°åˆ°ç±»å‹ä¿¡æ¯çš„åŒå‘æ˜ å°„ã€‚\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/types_serialization.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-25-datatypes-serialization/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Serialization"],"title":"æ•°æ®ç±»å‹å’Œåºåˆ—åŒ–"},{"categories":["Flink"],"contents":"é…ç½® é»˜è®¤æƒ…å†µä¸‹ï¼ŒTable \u0026amp; SQL API æ˜¯é¢„å…ˆé…ç½®çš„ï¼Œå¯ä»¥åœ¨å¯æ¥å—çš„æ€§èƒ½ä¸‹äº§ç”Ÿå‡†ç¡®çš„ç»“æœã€‚\næ ¹æ®è¡¨ç¨‹åºçš„è¦æ±‚ï¼Œå¯èƒ½éœ€è¦è°ƒæ•´æŸäº›å‚æ•°è¿›è¡Œä¼˜åŒ–ã€‚ä¾‹å¦‚ï¼Œæ— çº¦æŸçš„æµç¨‹åºå¯èƒ½éœ€è¦ç¡®ä¿æ‰€éœ€çš„çŠ¶æ€å¤§å°æ˜¯æœ‰ä¸Šé™çš„ï¼ˆå‚è§æµæ¦‚å¿µï¼‰ã€‚\næ¦‚è¿° åœ¨æ¯ä¸ªè¡¨ç¯å¢ƒä¸­ï¼ŒTableConfig éƒ½æä¾›äº†é…ç½®å½“å‰ä¼šè¯çš„é€‰é¡¹ã€‚\nå¯¹äºå¸¸è§æˆ–é‡è¦çš„é…ç½®é€‰é¡¹ï¼ŒTableConfig æä¾›äº† getter å’Œ setter æ–¹æ³•ï¼Œå¹¶æä¾›äº†è¯¦ç»†çš„å†…è”æ–‡æ¡£ã€‚\nå¯¹äºæ›´é«˜çº§çš„é…ç½®ï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥è®¿é—®åº•å±‚çš„é”®å€¼æ˜ å°„ã€‚ä¸‹é¢çš„ç« èŠ‚åˆ—å‡ºäº†æ‰€æœ‰å¯ç”¨çš„é€‰é¡¹ï¼Œå¯ä»¥ç”¨æ¥è°ƒæ•´ Flink Table \u0026amp; SQL API ç¨‹åºã€‚\næ³¨æ„: ç”±äºåœ¨æ‰§è¡Œæ“ä½œæ—¶ï¼Œé€‰é¡¹ä¼šåœ¨ä¸åŒçš„æ—¶é—´ç‚¹è¢«è¯»å–ï¼Œå› æ­¤å»ºè®®åœ¨å®ä¾‹åŒ–è¡¨ç¯å¢ƒåå°½æ—©è®¾ç½®é…ç½®é€‰é¡¹ã€‚\n// instantiate table environment val tEnv: TableEnvironment = ... // access flink configuration val configuration = tEnv.getConfig().getConfiguration() // set low-level key-value options configuration.setString(\u0026#34;table.exec.mini-batch.enabled\u0026#34;, \u0026#34;true\u0026#34;) configuration.setString(\u0026#34;table.exec.mini-batch.allow-latency\u0026#34;, \u0026#34;5 s\u0026#34;) configuration.setString(\u0026#34;table.exec.mini-batch.size\u0026#34;, \u0026#34;5000\u0026#34;) æ³¨æ„ï¼šç›®å‰ï¼Œé”®å€¼é€‰é¡¹åªæ”¯æŒ Blink è®¡åˆ’å™¨ã€‚ç›®å‰ï¼Œé”®å€¼é€‰é¡¹åªæ”¯æŒ Blink è®¡åˆ’å™¨ã€‚\næ‰§è¡Œé€‰é¡¹ ä»¥ä¸‹é€‰é¡¹å¯ä»¥ç”¨æ¥è°ƒæ•´æŸ¥è¯¢æ‰§è¡Œçš„æ€§èƒ½ã€‚\n   Key Default Type Description     table.exec.async-lookup.buffer-capacity(Batch/Streaming) 100 Integer å¼‚æ­¥æŸ¥æ‰¾è¿æ¥å¯ä»¥è§¦å‘çš„æœ€å¤§å¼‚æ­¥ i/o æ“ä½œæ•°ã€‚   table.exec.async-lookup.timeout(Batch/Streaming) \u0026ldquo;3 min\u0026rdquo; String å¼‚æ­¥æ“ä½œå®Œæˆçš„å¼‚æ­¥è¶…æ—¶æ—¶é—´ã€‚   table.exec.disabled-operators(Batch) (none) String ä¸»è¦ç”¨äºæµ‹è¯•ã€‚ä¸€ä¸ªä»¥é€—å·åˆ†éš”çš„æ“ä½œç¬¦åç§°åˆ—è¡¨ï¼Œæ¯ä¸ªåç§°ä»£è¡¨ä¸€ç§è¢«ç¦ç”¨çš„æ“ä½œç¬¦ã€‚å¯ä»¥ç¦ç”¨çš„æ“ä½œç¬¦åŒ…æ‹¬ \u0026ldquo;NestedLoopJoin\u0026rdquo;ã€\u0026ldquo;ShuffleHashJoin\u0026rdquo;ã€\u0026ldquo;BroadcastHashJoin\u0026rdquo;ã€\u0026ldquo;SortMergeJoin\u0026rdquo;ã€\u0026ldquo;HashAgg\u0026rdquo;ã€\u0026ldquo;SortAgg\u0026rdquo;ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ²¡æœ‰ä»»ä½•æ“ä½œç¬¦è¢«ç¦ç”¨ã€‚   table.exec.mini-batch.allow-latency(Streaming) \u0026ldquo;-1 ms\u0026rdquo; String æœ€å¤§å»¶è¿Ÿå¯ä»¥ç”¨äº MiniBatch æ¥ç¼“å†²è¾“å…¥è®°å½•ã€‚MiniBatch æ˜¯ä¸€ç§ä¼˜åŒ–ï¼Œç”¨äºç¼“å†²è¾“å…¥è®°å½•ä»¥å‡å°‘çŠ¶æ€è®¿é—®ã€‚MiniBatch ä¼šåœ¨å…è®¸çš„å»¶è¿Ÿé—´éš”å’Œè¾¾åˆ°æœ€å¤§ç¼“å†²è®°å½•æ•°æ—¶è§¦å‘ã€‚æ³¨æ„ï¼šå¦‚æœ table.exec.mini-batch.enabled è¢«è®¾ç½®ä¸º trueï¼Œå…¶å€¼å¿…é¡»å¤§äºé›¶ã€‚   table.exec.mini-batch.enabled(Streaming) false Boolean æŒ‡å®šæ˜¯å¦å¯ç”¨ MiniBatch ä¼˜åŒ–ã€‚MiniBatch æ˜¯å¯¹è¾“å…¥è®°å½•è¿›è¡Œç¼“å†²ä»¥å‡å°‘çŠ¶æ€è®¿é—®çš„ä¼˜åŒ–ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªé…ç½®æ˜¯ç¦ç”¨çš„ã€‚è¦å¯ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œç”¨æˆ·åº”è¯¥å°†è¿™ä¸ªé…ç½®è®¾ç½®ä¸º trueã€‚æ³¨æ„ï¼šå¦‚æœå¯ç”¨äº† Mini-batchï¼Œå¿…é¡»è®¾ç½®\u0026rsquo;table.exec.mini-batch.allow-latency\u0026rsquo;å’Œ\u0026rsquo;table.exec.mini-batch.size'ã€‚   table.exec.mini-batch.size(Streaming) -1 Long MiniBatch å¯ä»¥ç¼“å†²çš„è¾“å…¥è®°å½•çš„æœ€å¤§æ•°é‡ã€‚MiniBatch æ˜¯å¯¹è¾“å…¥è®°å½•è¿›è¡Œç¼“å†²çš„ä¼˜åŒ–ï¼Œä»¥å‡å°‘çŠ¶æ€è®¿é—®ã€‚MiniBatch ä¼šåœ¨å…è®¸çš„å»¶è¿Ÿé—´éš”å’Œè¾¾åˆ°æœ€å¤§ç¼“å†²è®°å½•æ•°æ—¶è§¦å‘ã€‚æ³¨æ„ï¼šMiniBatch ç›®å‰åªé€‚ç”¨äºéçª—å£èšåˆã€‚å¦‚æœ table.exec.mini-batch.enabled è¢«è®¾ç½®ä¸º trueï¼Œå…¶å€¼å¿…é¡»ä¸ºæ­£ã€‚   table.exec.resource.default-parallelism(Batch/Streaming) -1 Integer ä¸ºæ‰€æœ‰æ“ä½œç¬¦ï¼ˆå¦‚ aggregationã€joinã€filterï¼‰è®¾ç½®é»˜è®¤çš„å¹¶è¡Œæ€§ï¼Œä»¥ä¾¿ä¸å¹¶è¡Œå®ä¾‹ä¸€èµ·è¿è¡Œã€‚è¿™ä¸ªé…ç½®çš„ä¼˜å…ˆçº§é«˜äº StreamExecutionEnvironment çš„å¹¶è¡Œæ€§ï¼ˆå®é™…ä¸Šï¼Œè¿™ä¸ªé…ç½®è¦†ç›–äº† StreamExecutionEnvironment çš„å¹¶è¡Œæ€§ï¼‰ã€‚å€¼ä¸º-1 è¡¨ç¤ºæ²¡æœ‰è®¾ç½®é»˜è®¤çš„å¹¶è¡Œæ€§ï¼Œé‚£ä¹ˆå®ƒå°†å›è½åˆ°ä½¿ç”¨ StreamExecutionEnvironment çš„å¹¶è¡Œæ€§ã€‚   table.exec.shuffle-mode(Batch) \u0026ldquo;ALL_EDGES_BLOCKING\u0026rdquo; String è®¾ç½®æ‰§è¡Œ shuffle çš„æ¨¡å¼ã€‚æ¥å—çš„å€¼æ˜¯, ALL_EDGES_BLOCKING: æ‰€æœ‰è¾¹ç¼˜éƒ½å°†ä½¿ç”¨é˜»å¡æ´—ç‰Œã€‚FORWARD_EDGES_PIPELINED: æ­£å‘è¾¹ç¼˜å°†ä½¿ç”¨æµæ°´çº¿æ´—ç‰Œï¼Œå…¶ä»–è¾¹ç¼˜å°†ä½¿ç”¨é˜»å¡æ´—ç‰Œã€‚POINTWISE_EDGES_PIPELINED: POINTWISE_EDGES_PIPELINED: ç‚¹å‘è¾¹ç¼˜å°†ä½¿ç”¨ç®¡é“å¼æ´—ç‰Œï¼Œå…¶ä»–è¾¹ç¼˜å°†è¢«é˜»æŒ¡ã€‚POINTWISE_EDGES_PIPELINED: ç‚¹å‘è¾¹ç¼˜åŒ…æ‹¬å‰å‘å’Œé‡æ–°ç¼©æ”¾è¾¹ç¼˜ã€‚ALL_EDGES_PIPELINED: æ‰€æœ‰çš„è¾¹ç¼˜éƒ½å°†ä½¿ç”¨ pipelined shuffleï¼Œå…¶ä»–çš„è¾¹ç¼˜åˆ™ä½¿ç”¨ blocksã€‚æ‰€æœ‰è¾¹ç¼˜éƒ½å°†ä½¿ç”¨æµæ°´çº¿æ´—ç‰Œã€‚batch: ä¸ ALL_EDGES_BLOCKING ç›¸åŒã€‚å·²åºŸå¼ƒã€‚pipelined: ä¸ ALL_EDGES_PIPELINED ç›¸åŒã€‚å·²è¢«å¼ƒç”¨ã€‚æ³¨æ„ï¼šBlocking shuffle æ„å‘³ç€æ•°æ®å°†åœ¨å‘é€åˆ°æ¶ˆè´¹è€…ä»»åŠ¡ä¹‹å‰è¢«å®Œå…¨ç”Ÿæˆã€‚Pipelined shuffle æ„å‘³ç€æ•°æ®ä¸€æ—¦è¢«ç”Ÿäº§å‡ºæ¥ï¼Œå°±ä¼šè¢«å‘é€åˆ°æ¶ˆè´¹è€…ä»»åŠ¡ä¸­ã€‚   table.exec.sink.not-null-enforcer(Batch/Streaming) ERROR Enum,å¯èƒ½çš„å€¼: [ERROR, DROP] è¡¨ä¸Šçš„ NOT NULL åˆ—çº¦æŸå¼ºåˆ¶è¦æ±‚ä¸èƒ½å°†ç©ºå€¼æ’å…¥åˆ°è¡¨ä¸­ã€‚Flink æ”¯æŒ \u0026ldquo;é”™è¯¯\u0026rdquo;ï¼ˆé»˜è®¤ï¼‰å’Œ \u0026ldquo;æ”¾å¼ƒ \u0026ldquo;æ‰§è¡Œè¡Œä¸ºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ NOT NULL åˆ—ä¸­å†™å…¥ç©ºå€¼æ—¶ï¼ŒFlink ä¼šæ£€æŸ¥å€¼å¹¶æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ã€‚ç”¨æˆ·å¯ä»¥å°†è¡Œä¸ºæ”¹ä¸º\u0026rsquo;drop'ï¼Œåœ¨ä¸å‡ºç°å¼‚å¸¸çš„æƒ…å†µä¸‹é»˜é»˜åœ°åˆ é™¤è¿™äº›è®°å½•ã€‚   table.exec.sort.async-merge-enabled(Batch) true Boolean æ˜¯å¦å¼‚æ­¥åˆå¹¶æ’åºåçš„ spill æ–‡ä»¶ã€‚   table.exec.sort.default-limit(Batch) -1 Integer å½“ç”¨æˆ·åœ¨ä¸‹å•åæ²¡æœ‰è®¾ç½®é™ä»·æ—¶ï¼Œé»˜è®¤é™ä»·ã€‚-1 è¡¨ç¤ºè¯¥é…ç½®è¢«å¿½ç•¥ã€‚   table.exec.sort.max-num-file-handles(Batch) 128 Integer å¤–éƒ¨åˆå¹¶æ’åºçš„æœ€å¤§æ‰‡å…¥é‡ã€‚å®ƒé™åˆ¶äº†æ¯ä¸ªæ“ä½œè€…çš„æ–‡ä»¶å¥æŸ„æ•°ã€‚å¦‚æœå¤ªå°ï¼Œå¯èƒ½ä¼šé€ æˆä¸­é—´åˆå¹¶ã€‚ä½†å¦‚æœå¤ªå¤§ï¼Œä¼šé€ æˆåŒæ—¶æ‰“å¼€çš„æ–‡ä»¶å¤ªå¤šï¼Œæ¶ˆè€—å†…å­˜ï¼Œå¯¼è‡´éšæœºè¯»å–ã€‚   table.exec.source.idle-timeout(Streaming) \u0026ldquo;-1 ms\u0026rdquo; String å½“ä¸€ä¸ªæºåœ¨è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°ä»»ä½•å…ƒç´ æ—¶ï¼Œå®ƒå°†è¢«æ ‡è®°ä¸ºæš‚æ—¶ç©ºé—²ã€‚è¿™æ ·ä¸‹æ¸¸ä»»åŠ¡å°±å¯ä»¥æå‰æ‰“æ°´å°ï¼Œè€Œä¸éœ€è¦åœ¨è¿™ä¸ªæºç©ºé—²æ—¶ç­‰å¾…å®ƒçš„æ°´å°ã€‚   table.exec.spill-compression.block-size(Batch) \u0026ldquo;64 kb\u0026rdquo; String æº¢å‡ºæ•°æ®æ—¶åšå‹ç¼©æ—¶ä½¿ç”¨çš„å†…å­˜å¤§å°ã€‚å†…å­˜è¶Šå¤§ï¼Œå‹ç¼©æ¯”è¶Šé«˜ï¼Œä½†ä½œä¸šä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜èµ„æºã€‚   table.exec.spill-compression.enabled(Batch) true Boolean æ˜¯å¦å‹ç¼©æº¢å‡ºæ•°æ®ã€‚ç›®å‰æˆ‘ä»¬åªæ”¯æŒå‹ç¼©æº¢å‡ºæ•°æ®çš„æ’åºå’Œå“ˆå¸Œ-agg å’Œå“ˆå¸Œ-join æ“ä½œç¬¦ã€‚   table.exec.window-agg.buffer-size-limit(Batch) 100000 Integer è®¾ç½®ç»„çª—å£ agg è¿ç®—ç¬¦ä¸­ä½¿ç”¨çš„çª—å£å…ƒç´ ç¼“å†²åŒºå¤§å°é™åˆ¶ã€‚    ä¼˜åŒ–é€‰é¡¹ ä»¥ä¸‹é€‰é¡¹å¯ä»¥ç”¨æ¥è°ƒæ•´æŸ¥è¯¢ä¼˜åŒ–å™¨çš„è¡Œä¸ºï¼Œä»¥è·å¾—æ›´å¥½çš„æ‰§è¡Œè®¡åˆ’ã€‚\n   Key Default Type Description     table.optimizer.agg-phase-strategy(Batch/Streaming) \u0026ldquo;AUTO\u0026rdquo; String èšåˆé˜¶æ®µçš„ç­–ç•¥ã€‚åªèƒ½è®¾ç½® AUTOã€TWO_PHASE æˆ– ONE_PHASEã€‚AUTOï¼šé›†åˆé˜¶æ®µæ— ç‰¹æ®Šæ‰§è¡Œå™¨ã€‚é€‰æ‹©ä¸¤é˜¶æ®µèšåˆè¿˜æ˜¯ä¸€é˜¶æ®µèšåˆå–å†³äºæˆæœ¬ã€‚TWO_PHASE: å¼ºåˆ¶ä½¿ç”¨ä¸¤çº§èšåˆï¼Œå…¶ä¸­åŒ…æ‹¬ localAggregate å’Œ globalAggregateã€‚è¯·æ³¨æ„ï¼Œå¦‚æœèšåˆè°ƒç”¨ä¸æ”¯æŒä¼˜åŒ–ä¸ºä¸¤é˜¶æ®µï¼Œæˆ‘ä»¬ä»å°†ä½¿ç”¨ä¸€ä¸ªé˜¶æ®µçš„èšåˆã€‚ONE_PHASE: å¼ºåˆ¶ä½¿ç”¨åªæœ‰ CompleteGlobalAggregate çš„å•é˜¶æ®µèšåˆã€‚   table.optimizer.distinct-agg.split.bucket-num(Streaming) 1024 Integer é…ç½®æ‹†åˆ†ä¸åŒèšåˆæ—¶çš„æ¡¶æ•°ã€‚è¿™ä¸ªæ•°å­—åœ¨ä¸€çº§èšåˆä¸­ç”¨äºè®¡ç®—ä¸€ä¸ªæ¡¶é”®\u0026rsquo;hash_code(distinct_key) % BUCKET_NUM'ï¼Œè¿™ä¸ªæ¡¶é”®åœ¨æ‹†åˆ†åä½œä¸ºä¸€ä¸ªé¢å¤–çš„ç»„é”®ä½¿ç”¨ã€‚   table.optimizer.distinct-agg.split.enabled(Streaming) false Boolean æŒ‡ç¤ºä¼˜åŒ–å™¨æ˜¯å¦å°† distinct aggregation(ä¾‹å¦‚ COUNT(DISTINCT col)ï¼ŒSUM(DISTINCT col))åˆ†æˆä¸¤çº§ã€‚ç¬¬ä¸€å±‚èšåˆç”±ä¸€ä¸ªé¢å¤–çš„ key è¿›è¡Œæ´—ç‰Œï¼Œè¿™ä¸ª key æ˜¯ç”¨ distinct_key å’Œ buckets æ•°é‡çš„ hashcode è®¡ç®—å‡ºæ¥çš„ã€‚å½“ distinct aggregation ä¸­å­˜åœ¨æ•°æ®å€¾æ–œæ—¶ï¼Œè¿™ç§ä¼˜åŒ–æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå¹¶æä¾›äº†æ‰©å±•ä½œä¸šçš„èƒ½åŠ›ã€‚é»˜è®¤ä¸º falseã€‚   table.optimizer.join-reorder-enabled(Batch/Streaming) false Boolean åœ¨ä¼˜åŒ–å™¨ä¸­å¯ç”¨è¿æ¥é‡æ’åºã€‚é»˜è®¤ä¸ºç¦ç”¨ã€‚   table.optimizer.join.broadcast-threshold(Batch) 1048576 Long é…ç½®åœ¨æ‰§è¡Œè¿æ¥æ—¶å°†å‘æ‰€æœ‰å·¥ä½œèŠ‚ç‚¹å¹¿æ’­çš„è¡¨çš„æœ€å¤§å­—èŠ‚æ•°ã€‚å°†æ­¤å€¼è®¾ç½®ä¸º-1ï¼Œåˆ™ç¦ç”¨å¹¿æ’­ã€‚   table.optimizer.reuse-source-enabled(Batch/Streaming) true Boolean å½“å®ƒä¸ºçœŸæ—¶ï¼Œä¼˜åŒ–å™¨å°†å°è¯•æ‰¾å‡ºé‡å¤çš„è¡¨æºå¹¶é‡ç”¨å®ƒä»¬ã€‚è¿™åªæœ‰åœ¨ table.optimizer.reuse-sub-plan-enabled ä¸ºçœŸæ—¶æ‰ä¼šç”Ÿæ•ˆã€‚   table.optimizer.reuse-sub-plan-enabled(Batch/Streaming) true Boolean å½“å®ƒä¸ºçœŸæ—¶ï¼Œä¼˜åŒ–å™¨å°†å°è¯•æ‰¾å‡ºé‡å¤çš„å­è®¡åˆ’å¹¶é‡ç”¨å®ƒä»¬ã€‚   table.optimizer.source.predicate-pushdown-enabled(Batch/Streaming) true Boolean å½“è¯¥å€¼ä¸ºçœŸæ—¶ï¼Œä¼˜åŒ–å™¨å°†å‘ä¸‹æ¨é€è°“è¯åˆ° FilterableTableSource ä¸­ã€‚é»˜è®¤å€¼ä¸º trueã€‚    Table é€‰é¡¹ ä»¥ä¸‹é€‰é¡¹å¯ç”¨äºè°ƒæ•´è¡¨è®¡åˆ’å™¨(planner)çš„è¡Œä¸º:\n   Key Default Type Description     table.dynamic-table-options.enabled(Batch/Streaming) false Boolean å¯ç”¨æˆ–ç¦ç”¨ OPTIONS æç¤ºï¼Œç”¨äºåŠ¨æ€æŒ‡å®šè¡¨é€‰é¡¹ï¼Œå¦‚æœç¦ç”¨ï¼Œåˆ™å¦‚æœæŒ‡å®šäº†ä»»ä½• OPTIONS æç¤ºï¼Œå°±ä¼šäº§ç”Ÿå¼‚å¸¸ã€‚   table.sql-dialect(Batch/Streaming) \u0026ldquo;default\u0026rdquo; String SQL æ–¹è¨€å®šä¹‰äº†å¦‚ä½•è§£æä¸€ä¸ª SQL æŸ¥è¯¢ã€‚ä¸åŒçš„ SQL æ–¹è¨€å¯èƒ½æ”¯æŒä¸åŒçš„ SQL è¯­æ³•ã€‚ç›®å‰æ”¯æŒçš„æ–¹è¨€æœ‰ï¼šé»˜è®¤å’Œ hiveã€‚    åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/config.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-25-configuration/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL"],"title":"é…ç½®"},{"categories":["Flink"],"contents":"ALTER è¯­å¥ ALTER è¯­å¥ç”¨äºä¿®æ”¹ç›®å½•ä¸­æ³¨å†Œçš„è¡¨/è§†å›¾/å‡½æ•°å®šä¹‰ã€‚\nFlink SQL ç›®å‰æ”¯æŒä»¥ä¸‹ ALTER è¯­å¥ã€‚\n ALTER TABLE ALTER DATABASE ALTER FUNCTION  è¿è¡Œ ALTER è¯­å¥ ALTER è¯­å¥å¯ä»¥ç”¨ TableEnvironment çš„ executeSql()æ–¹æ³•æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨ SQL CLI ä¸­æ‰§è¡Œã€‚executeSql()æ–¹æ³•åœ¨ ALTER æ“ä½œæˆåŠŸæ—¶è¿”å› \u0026ldquo;OK\u0026rdquo;ï¼Œå¦åˆ™å°†æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚\nä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨ TableEnvironment å’Œ SQL CLI ä¸­è¿è¡Œ ALTER è¯­å¥ã€‚\nval settings = EnvironmentSettings.newInstance()... val tableEnv = TableEnvironment.create(settings) // register a table named \u0026#34;Orders\u0026#34; tableEnv.executeSql(\u0026#34;CREATE TABLE Orders (`user` BIGINT, product STRING, amount INT) WITH (...)\u0026#34;); // a string array: [\u0026#34;Orders\u0026#34;] val tables = tableEnv.listTables() // or tableEnv.executeSql(\u0026#34;SHOW TABLES\u0026#34;).print()  // rename \u0026#34;Orders\u0026#34; to \u0026#34;NewOrders\u0026#34; tableEnv.executeSql(\u0026#34;ALTER TABLE Orders RENAME TO NewOrders;\u0026#34;) // a string array: [\u0026#34;NewOrders\u0026#34;] val tables = tableEnv.listTables() // or tableEnv.executeSql(\u0026#34;SHOW TABLES\u0026#34;).print() ALTER TABLE  Rename Table  ALTERTABLE[catalog_name.][db_name.]table_nameRENAMETOnew_table_nameå°†ç»™å®šçš„è¡¨åé‡å‘½åä¸ºå¦ä¸€ä¸ªæ–°è¡¨åã€‚\n è®¾ç½®æˆ–æ›´æ”¹è¡¨å±æ€§  ALTERTABLE[catalog_name.][db_name.]table_nameSET(key1=val1,key2=val2,...)è®¾ç½®æŒ‡å®šè¡¨æ ¼ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§ã€‚å¦‚æœæŸä¸ªå±æ€§å·²ç»åœ¨è¡¨ä¸­è¢«è®¾ç½®ï¼Œåˆ™ç”¨æ–°çš„å±æ€§è¦†ç›–æ—§çš„å€¼ã€‚\nALTER DATABASE ALTERDATABASE[catalog_name.]db_nameSET(key1=val1,key2=val2,...)åœ¨æŒ‡å®šçš„æ•°æ®åº“ä¸­è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§ã€‚å¦‚æœæŸä¸ªå±æ€§å·²ç»åœ¨æ•°æ®åº“ä¸­è¢«è®¾ç½®ï¼Œåˆ™ç”¨æ–°çš„å±æ€§è¦†ç›–æ—§çš„å€¼ã€‚\nALTER FUNCTION ALTER[TEMPORARY|TEMPORARYSYSTEM]FUNCTION[IFEXISTS][catalog_name.][db_name.]function_nameASidentifier[LANGUAGEJAVA|SCALA|PYTHON]ç”¨æ–°çš„æ ‡è¯†ç¬¦å’Œå¯é€‰çš„è¯­è¨€æ ‡ç­¾æ”¹å˜ä¸€ä¸ªç›®å½•å‡½æ•°ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°åœ¨ç›®å½•ä¸­ä¸å­˜åœ¨ï¼Œå°±ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚\nå¦‚æœè¯­è¨€æ ‡ç­¾æ˜¯ JAVA/SCALAï¼Œæ ‡è¯†ç¬¦æ˜¯ UDF çš„å®Œæ•´ classpathã€‚å…³äº Java/Scala UDF çš„å®ç°ï¼Œè¯·å‚è€ƒ User-defined Functions äº†è§£è¯¦æƒ…ã€‚\nå¦‚æœè¯­è¨€æ ‡ç­¾æ˜¯ PYTHONï¼Œæ ‡è¯†ç¬¦æ˜¯ UDF çš„å®Œå…¨é™å®šåï¼Œä¾‹å¦‚ pyflink.table.test.test_udf.addã€‚å…³äº Python UDF çš„å®ç°ï¼Œæ›´å¤šç»†èŠ‚è¯·å‚è€ƒ Python UDFsã€‚\nTEMPORARY\næ”¹å˜å…·æœ‰ç›®å½•å’Œæ•°æ®åº“å‘½åç©ºé—´çš„ä¸´æ—¶ç›®å½•åŠŸèƒ½ï¼Œå¹¶è¦†ç›–ç›®å½•åŠŸèƒ½ã€‚\nTEMPORARY SYSTEM\næ›´æ”¹æ²¡æœ‰å‘½åç©ºé—´çš„ä¸´æ—¶ç³»ç»Ÿå‡½æ•°ï¼Œå¹¶è¦†ç›–å†…ç½®å‡½æ•°ã€‚\nIF EXISTS\nå¦‚æœå‡½æ•°ä¸å­˜åœ¨ï¼Œå°±ä¸ä¼šå‘ç”Ÿä»»ä½•äº‹æƒ…ã€‚\nLANGUAGE JAVA|SCALA|PYTHON\nè¯­è¨€æ ‡ç­¾ï¼Œç”¨äºæŒ‡å¯¼ flink è¿è¡Œæ—¶å¦‚ä½•æ‰§è¡Œå‡½æ•°ã€‚ç›®å‰åªæ”¯æŒ JAVAã€SCALA å’Œ PYTHONï¼Œå‡½æ•°çš„é»˜è®¤è¯­è¨€æ˜¯ JAVAã€‚\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/sql/alter.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-alter-statements/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL","SQL"],"title":"Alter è¯­å¥"},{"categories":["Flink"],"contents":"Catalogs ç›®å½•æä¾›äº†å…ƒæ•°æ®ï¼Œå¦‚æ•°æ®åº“ã€è¡¨ã€åˆ†åŒºã€è§†å›¾ä»¥åŠè®¿é—®æ•°æ®åº“æˆ–å…¶ä»–å¤–éƒ¨ç³»ç»Ÿä¸­å­˜å‚¨çš„æ•°æ®æ‰€éœ€çš„åŠŸèƒ½å’Œä¿¡æ¯ã€‚\næ•°æ®å¤„ç†ä¸­æœ€å…³é”®çš„ä¸€ä¸ªæ–¹é¢æ˜¯ç®¡ç†å…ƒæ•°æ®ã€‚å®ƒå¯èƒ½æ˜¯çŸ­æš‚çš„å…ƒæ•°æ®ï¼Œå¦‚ä¸´æ—¶è¡¨ï¼Œæˆ–é’ˆå¯¹è¡¨ç¯å¢ƒæ³¨å†Œçš„ UDFã€‚æˆ–è€…æ˜¯æ°¸ä¹…æ€§çš„å…ƒæ•°æ®ï¼Œæ¯”å¦‚ Hive Metastore ä¸­çš„å…ƒæ•°æ®ã€‚ç›®å½•ä¸ºç®¡ç†å…ƒæ•°æ®æä¾›äº†ç»Ÿä¸€çš„ APIï¼Œå¹¶ä½¿å…¶å¯ä»¥ä»è¡¨ API å’Œ SQL æŸ¥è¯¢ä¸­è®¿é—®ã€‚\nCatalog ä½¿ç”¨æˆ·èƒ½å¤Ÿå¼•ç”¨æ•°æ®ç³»ç»Ÿä¸­ç°æœ‰çš„å…ƒæ•°æ®ï¼Œå¹¶è‡ªåŠ¨å°†å®ƒä»¬æ˜ å°„åˆ° Flink çš„ç›¸åº”å…ƒæ•°æ®ä¸­ã€‚ä¾‹å¦‚ï¼ŒFlink å¯ä»¥å°† JDBC è¡¨è‡ªåŠ¨æ˜ å°„åˆ° Flink è¡¨ï¼Œç”¨æˆ·ä¸å¿…åœ¨ Flink ä¸­æ‰‹åŠ¨é‡æ–°ç¼–å†™ DDLã€‚Catalog å¤§å¤§ç®€åŒ–äº†ç”¨æˆ·ç°æœ‰ç³»ç»Ÿä¸Šæ‰‹ Flink æ‰€éœ€çš„æ­¥éª¤ï¼Œå¤§å¤§æå‡äº†ç”¨æˆ·ä½“éªŒã€‚\nCatalog ç±»å‹ GenericInMemoryCatalog GenericInMemoryCatalog æ˜¯ä¸€ä¸ªç›®å½•çš„å†…å­˜å®ç°ã€‚æ‰€æœ‰å¯¹è±¡åªåœ¨ä¼šè¯çš„ç”Ÿå‘½å‘¨æœŸå†…å¯ç”¨ã€‚\nJdbcCatalog JdbcCatalog ä½¿ç”¨æˆ·èƒ½å¤Ÿé€šè¿‡ JDBC åè®®å°† Flink ä¸å…³ç³»å‹æ•°æ®åº“è¿æ¥èµ·æ¥ã€‚PostgresCatalog æ˜¯ç›®å‰ JDBC Catalog çš„å”¯ä¸€å®ç°ã€‚å…³äºè®¾ç½®ç›®å½•çš„æ›´å¤šç»†èŠ‚ï¼Œè¯·å‚è§ JdbcCatalog æ–‡æ¡£ã€‚\nHiveCatalog HiveCatalog æœ‰ä¸¤ä¸ªç›®çš„ï¼Œä¸€æ˜¯ä½œä¸ºçº¯ Flink å…ƒæ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨ï¼ŒäºŒæ˜¯ä½œä¸ºè¯»å†™ç°æœ‰ Hive å…ƒæ•°æ®çš„æ¥å£ã€‚Flink çš„ Hive æ–‡æ¡£æä¾›äº†è®¾ç½®ç›®å½•å’Œä¸ç°æœ‰ Hive å®‰è£…æ¥å£çš„å®Œæ•´ç»†èŠ‚ã€‚\nè­¦å‘Š: Hive Metastore å°†æ‰€æœ‰çš„å…ƒå¯¹è±¡åç§°éƒ½å­˜å‚¨ä¸ºå°å†™ã€‚è¿™ä¸ GenericInMemoryCatalog ä¸åŒï¼Œåè€…æ˜¯åŒºåˆ†å¤§å°å†™çš„ã€‚\nç”¨æˆ·å®šä¹‰çš„ Catalog ç›®å½•æ˜¯å¯æ’æ‹”çš„ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å®ç° Catalog æ¥å£æ¥å¼€å‘è‡ªå®šä¹‰ç›®å½•ã€‚è¦åœ¨ SQL CLI ä¸­ä½¿ç”¨è‡ªå®šä¹‰ç›®å½•ï¼Œç”¨æˆ·åº”è¯¥é€šè¿‡å®ç° CatalogFactory æ¥å£åŒæ—¶å¼€å‘ç›®å½•å’Œå®ƒå¯¹åº”çš„ç›®å½•å·¥å‚ã€‚\nç›®å½•å·¥å‚å®šä¹‰äº†ä¸€ç»„å±æ€§ï¼Œç”¨äºåœ¨ SQL CLI å¼•å¯¼æ—¶é…ç½®ç›®å½•ã€‚è¯¥å±æ€§é›†å°†è¢«ä¼ é€’ç»™å‘ç°æœåŠ¡ï¼ŒæœåŠ¡ä¼šå°è¯•å°†å±æ€§ä¸ CatalogFactory åŒ¹é…ï¼Œå¹¶å¯åŠ¨ç›¸åº”çš„ç›®å½•å®ä¾‹ã€‚\nå¦‚ä½•åˆ›å»ºå’Œæ³¨å†Œ Flink Table åˆ°ç›®å½•ä¸Š ä½¿ç”¨ SQL DDL ç”¨æˆ·å¯ä»¥ä½¿ç”¨ SQL DDL åœ¨ Table API å’Œ SQL ä¸­åˆ›å»ºç›®å½•ä¸­çš„è¡¨ã€‚\n Flink SQL  // the catalog should have been registered via yaml file Flink SQL\u0026gt; CREATE DATABASE mydb WITH (...); Flink SQL\u0026gt; CREATE TABLE mytable (name STRING, age INT) WITH (...); Flink SQL\u0026gt; SHOW TABLES; mytable è¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ Flink SQL CREATE DDLã€‚\n Scala  val tableEnv = ... // Create a HiveCatalog val catalog = new HiveCatalog(\u0026#34;myhive\u0026#34;, null, \u0026#34;\u0026lt;path_of_hive_conf\u0026gt;\u0026#34;) // Register the catalog tableEnv.registerCatalog(\u0026#34;myhive\u0026#34;, catalog) // Create a catalog database tableEnv.executeSql(\u0026#34;CREATE DATABASE mydb WITH (...)\u0026#34;) // Create a catalog table tableEnv.executeSql(\u0026#34;CREATE TABLE mytable (name STRING, age INT) WITH (...)\u0026#34;) tableEnv.listTables() // should return the tables in current catalog and database. For detailed information, please check out Flink SQL CREATE DDL.\nä½¿ç”¨ Java, Scala æˆ– Python ç”¨æˆ·å¯ä»¥ä½¿ç”¨ Javaã€Scala æˆ– Python æ¥ç¼–ç¨‹åˆ›å»ºç›®å½•è¡¨ã€‚\nimport org.apache.flink.table.api._ import org.apache.flink.table.catalog._ import org.apache.flink.table.catalog.hive.HiveCatalog import org.apache.flink.table.descriptors.Kafka val tableEnv = TableEnvironment.create(EnvironmentSettings.newInstance.build) // Create a HiveCatalog val catalog = new HiveCatalog(\u0026#34;myhive\u0026#34;, null, \u0026#34;\u0026lt;path_of_hive_conf\u0026gt;\u0026#34;) // Register the catalog tableEnv.registerCatalog(\u0026#34;myhive\u0026#34;, catalog) // Create a catalog database catalog.createDatabase(\u0026#34;mydb\u0026#34;, new CatalogDatabaseImpl(...)) // Create a catalog table val schema = TableSchema.builder() .field(\u0026#34;name\u0026#34;, DataTypes.STRING()) .field(\u0026#34;age\u0026#34;, DataTypes.INT()) .build() catalog.createTable( new ObjectPath(\u0026#34;mydb\u0026#34;, \u0026#34;mytable\u0026#34;), new CatalogTableImpl( schema, new Kafka() .version(\u0026#34;0.11\u0026#34;) .... .startFromEarlist() .toProperties(), \u0026#34;my comment\u0026#34; ), false ) val tables = catalog.listTables(\u0026#34;mydb\u0026#34;) // tables should contain \u0026#34;mytable\u0026#34; Catalog API æ³¨æ„ï¼šè¿™é‡Œåªåˆ—å‡ºäº†ç›®å½•ç¨‹åºçš„ APIï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ SQL DDL å®ç°è®¸å¤šç›¸åŒçš„åŠŸèƒ½ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡ SQL DDL å®ç°è®¸å¤šç›¸åŒçš„åŠŸèƒ½ã€‚è¯¦ç»†çš„ DDL ä¿¡æ¯ï¼Œè¯·å‚è€ƒ SQL CREATE DDLã€‚\næ•°æ®åº“æ“ä½œ // create database catalog.createDatabase(\u0026#34;mydb\u0026#34;, new CatalogDatabaseImpl(...), false); // drop database catalog.dropDatabase(\u0026#34;mydb\u0026#34;, false); // alter database catalog.alterDatabase(\u0026#34;mydb\u0026#34;, new CatalogDatabaseImpl(...), false); // get database catalog.getDatabase(\u0026#34;mydb\u0026#34;); // check if a database exist catalog.databaseExists(\u0026#34;mydb\u0026#34;); // list databases in a catalog catalog.listDatabases(); Table æ“ä½œ // create table catalog.createTable(new ObjectPath(\u0026#34;mydb\u0026#34;, \u0026#34;mytable\u0026#34;), new CatalogTableImpl(...), false); // drop table catalog.dropTable(new ObjectPath(\u0026#34;mydb\u0026#34;, \u0026#34;mytable\u0026#34;), false); // alter table catalog.alterTable(new ObjectPath(\u0026#34;mydb\u0026#34;, \u0026#34;mytable\u0026#34;), new CatalogTableImpl(...), false); // rename table catalog.renameTable(new ObjectPath(\u0026#34;mydb\u0026#34;, \u0026#34;mytable\u0026#34;), \u0026#34;my_new_table\u0026#34;); // get table catalog.getTable(\u0026#34;mytable\u0026#34;); // check if a table exist or not catalog.tableExists(\u0026#34;mytable\u0026#34;); // list tables in a database catalog.listTables(\u0026#34;mydb\u0026#34;); è§†å›¾æ“ä½œ // create view catalog.createTable(new ObjectPath(\u0026#34;mydb\u0026#34;, \u0026#34;myview\u0026#34;), new CatalogViewImpl(...), false); // drop view catalog.dropTable(new ObjectPath(\u0026#34;mydb\u0026#34;, \u0026#34;myview\u0026#34;), false); // alter view catalog.alterTable(new ObjectPath(\u0026#34;mydb\u0026#34;, \u0026#34;mytable\u0026#34;), new CatalogViewImpl(...), false); // rename view catalog.renameTable(new ObjectPath(\u0026#34;mydb\u0026#34;, \u0026#34;myview\u0026#34;), \u0026#34;my_new_view\u0026#34;, false); // get view catalog.getTable(\u0026#34;myview\u0026#34;); // check if a view exist or not catalog.tableExists(\u0026#34;mytable\u0026#34;); // list views in a database catalog.listViews(\u0026#34;mydb\u0026#34;); Partition æ“ä½œ // create view catalog.createPartition( new ObjectPath(\u0026#34;mydb\u0026#34;, \u0026#34;mytable\u0026#34;), new CatalogPartitionSpec(...), new CatalogPartitionImpl(...), false); // drop partition catalog.dropPartition(new ObjectPath(\u0026#34;mydb\u0026#34;, \u0026#34;mytable\u0026#34;), new CatalogPartitionSpec(...), false); // alter partition catalog.alterPartition( new ObjectPath(\u0026#34;mydb\u0026#34;, \u0026#34;mytable\u0026#34;), new CatalogPartitionSpec(...), new CatalogPartitionImpl(...), false); // get partition catalog.getPartition(new ObjectPath(\u0026#34;mydb\u0026#34;, \u0026#34;mytable\u0026#34;), new CatalogPartitionSpec(...)); // check if a partition exist or not catalog.partitionExists(new ObjectPath(\u0026#34;mydb\u0026#34;, \u0026#34;mytable\u0026#34;), new CatalogPartitionSpec(...)); // list partitions of a table catalog.listPartitions(new ObjectPath(\u0026#34;mydb\u0026#34;, \u0026#34;mytable\u0026#34;)); // list partitions of a table under a give partition spec catalog.listPartitions(new ObjectPath(\u0026#34;mydb\u0026#34;, \u0026#34;mytable\u0026#34;), new CatalogPartitionSpec(...)); // list partitions of a table by expression filter catalog.listPartitionsByFilter(new ObjectPath(\u0026#34;mydb\u0026#34;, \u0026#34;mytable\u0026#34;), Arrays.asList(epr1, ...)); Function æ“ä½œ // create function catalog.createFunction(new ObjectPath(\u0026#34;mydb\u0026#34;, \u0026#34;myfunc\u0026#34;), new CatalogFunctionImpl(...), false); // drop function catalog.dropFunction(new ObjectPath(\u0026#34;mydb\u0026#34;, \u0026#34;myfunc\u0026#34;), false); // alter function catalog.alterFunction(new ObjectPath(\u0026#34;mydb\u0026#34;, \u0026#34;myfunc\u0026#34;), new CatalogFunctionImpl(...), false); // get function catalog.getFunction(\u0026#34;myfunc\u0026#34;); // check if a function exist or not catalog.functionExists(\u0026#34;myfunc\u0026#34;); // list functions in a database catalog.listFunctions(\u0026#34;mydb\u0026#34;); ç›®å½•çš„ Table API å’Œ SQL æ³¨å†Œç›®å½• ç”¨æˆ·å¯ä»¥è®¿é—®ä¸€ä¸ªåä¸º default_catalog çš„é»˜è®¤å†…å­˜ç›®å½•ï¼Œè¿™ä¸ªç›®å½•æ€»æ˜¯é»˜è®¤åˆ›å»ºçš„ã€‚è¯¥ç›®å½•é»˜è®¤æœ‰ä¸€ä¸ªåä¸º default_database çš„å•ä¸€æ•°æ®åº“ã€‚ç”¨æˆ·ä¹Ÿå¯ä»¥åœ¨ç°æœ‰çš„ Flink ä¼šè¯ä¸­æ³¨å†Œé¢å¤–çš„ç›®å½•ã€‚\n Scala  tableEnv.registerCatalog(new CustomCatalog(\u0026#34;myCatalog\u0026#34;));  YAML  æ‰€æœ‰ä½¿ç”¨ YAML å®šä¹‰çš„ç›®å½•å¿…é¡»æä¾›ä¸€ä¸ª type å±æ€§ï¼ŒæŒ‡å®šç›®å½•çš„ç±»å‹ã€‚ä»¥ä¸‹ç±»å‹æ˜¯å¼€ç®±å³ç”¨çš„ã€‚\n   Catalog Type Value     GenericInMemory generic_in_memory   Hive hive    catalogs:- name:myCatalogtype:custom_cataloghive-conf-dir:...æ›´æ”¹å½“å‰ç›®å½•å’Œæ•°æ®åº“ Flink å°†å§‹ç»ˆæœç´¢å½“å‰ç›®å½•å’Œæ•°æ®åº“ä¸­çš„è¡¨ã€è§†å›¾å’Œ UDFã€‚\n Scala  tableEnv.useCatalog(\u0026#34;myCatalog\u0026#34;); tableEnv.useDatabase(\u0026#34;myDb\u0026#34;);  Flink SQL  Flink SQL\u0026gt; USE CATALOG myCatalog; Flink SQL\u0026gt; USE myDB; é€šè¿‡æä¾› catalog.database.object å½¢å¼çš„å®Œå…¨é™å®šåç§°ï¼Œå¯ä»¥è®¿é—®éå½“å‰ç›®å½•çš„å…ƒæ•°æ®ã€‚\n Scala  tableEnv.from(\u0026#34;not_the_current_catalog.not_the_current_db.my_table\u0026#34;);  Flink SQL  Flink SQL\u0026gt; SELECT * FROM not_the_current_catalog.not_the_current_db.my_table; åˆ—å‡ºå¯ç”¨çš„ç›®å½•  Scala  tableEnv.listCatalogs();  Flink SQL  Flink SQL\u0026gt; show catalogs; åˆ—å‡ºå¯ç”¨çš„æ•°æ®åº“  Scala  tableEnv.listDatabases();  Flink SQL  Flink SQL\u0026gt; show databases; åˆ—å‡ºå¯ç”¨çš„è¡¨  Scala  tableEnv.listTables();  Flink SQL  Flink SQL\u0026gt; show tables; åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/catalogs.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-catalogs/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL","Catalogs"],"title":"Catalogs"},{"categories":["Flink"],"contents":"CREATE è¯­å¥ CREATE è¯­å¥ç”¨äºåœ¨å½“å‰æˆ–æŒ‡å®šçš„ç›®å½•ä¸­æ³¨å†Œä¸€ä¸ªè¡¨/è§†å›¾/å‡½æ•°ã€‚æ³¨å†Œçš„è¡¨/è§†å›¾/å‡½æ•°å¯ä»¥åœ¨ SQL æŸ¥è¯¢ä¸­ä½¿ç”¨ã€‚\nFlink SQL ç›®å‰æ”¯æŒä»¥ä¸‹ CREATE è¯­å¥ã€‚\n CREATE TABLE CREATE DATABASE CREATE VIEW CREATE FUNCTION  è¿è¡Œä¸€æ¡ CREATE è¯­å¥ CREATE è¯­å¥å¯ä»¥ç”¨ TableEnvironment çš„ executeSql()æ–¹æ³•æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨ SQL CLI ä¸­æ‰§è¡Œã€‚executeSql()æ–¹æ³•å¯¹äºä¸€ä¸ªæˆåŠŸçš„ CREATE æ“ä½œä¼šè¿”å›\u0026rsquo;OK'ï¼Œå¦åˆ™ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚\nä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨ TableEnvironment å’Œ SQL CLI ä¸­è¿è¡Œ CREATE è¯­å¥ã€‚\n// Scala val settings = EnvironmentSettings.newInstance()... val tableEnv = TableEnvironment.create(settings) // SQL query with a registered table // register a table named \u0026#34;Orders\u0026#34; tableEnv.executeSql(\u0026#34;CREATE TABLE Orders (`user` BIGINT, product STRING, amount INT) WITH (...)\u0026#34;); // run a SQL query on the Table and retrieve the result as a new Table val result = tableEnv.sqlQuery( \u0026#34;SELECT product, amount FROM Orders WHERE product LIKE \u0026#39;%Rubber%\u0026#39;\u0026#34;); // Execute insert SQL with a registered table // register a TableSink tableEnv.executeSql(\u0026#34;CREATE TABLE RubberOrders(product STRING, amount INT) WITH (\u0026#39;connector.path\u0026#39;=\u0026#39;/path/to/file\u0026#39; ...)\u0026#34;); // run an insert SQL on the Table and emit the result to the TableSink tableEnv.executeSql( \u0026#34;INSERT INTO RubberOrders SELECT product, amount FROM Orders WHERE product LIKE \u0026#39;%Rubber%\u0026#39;\u0026#34;) Flink SQL\u0026gt; CREATE TABLE Orders (`user` BIGINT, product STRING, amount INT) WITH (...); [INFO] Table has been created. Flink SQL\u0026gt; CREATE TABLE RubberOrders (product STRING, amount INT) WITH (...); [INFO] Table has been created. Flink SQL\u0026gt; INSERT INTO RubberOrders SELECT product, amount FROM Orders WHERE product LIKE \u0026#39;%Rubber%\u0026#39;; [INFO] Submitting SQL update statement to the cluster... CREATE TABLE CREATETABLE[catalog_name.][db_name.]table_name({\u0026lt;column_definition\u0026gt;|\u0026lt;computed_column_definition\u0026gt;}[,...n][\u0026lt;watermark_definition\u0026gt;][\u0026lt;table_constraint\u0026gt;][,...n])[COMMENTtable_comment][PARTITIONEDBY(partition_column_name1,partition_column_name2,...)]WITH(key1=val1,key2=val2,...)[LIKEsource_table[(\u0026lt;like_options\u0026gt;)]]\u0026lt;column_definition\u0026gt;:column_namecolumn_type[\u0026lt;column_constraint\u0026gt;][COMMENTcolumn_comment]\u0026lt;column_constraint\u0026gt;:[CONSTRAINTconstraint_name]PRIMARYKEYNOTENFORCED\u0026lt;table_constraint\u0026gt;:[CONSTRAINTconstraint_name]PRIMARYKEY(column_name,...)NOTENFORCED\u0026lt;computed_column_definition\u0026gt;:column_nameAScomputed_column_expression[COMMENTcolumn_comment]\u0026lt;watermark_definition\u0026gt;:WATERMARKFORrowtime_column_nameASwatermark_strategy_expression\u0026lt;like_options\u0026gt;:{{INCLUDING|EXCLUDING}{ALL|CONSTRAINTS|PARTITIONS}|{INCLUDING|EXCLUDING|OVERWRITING}{GENERATED|OPTIONS|WATERMARKS}}[,...]ç”¨ç»™å®šçš„åç§°åˆ›å»ºä¸€ä¸ªè¡¨ã€‚å¦‚æœç›®å½•ä¸­å·²ç»å­˜åœ¨åŒåè¡¨ï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚\nè®¡ç®—åˆ—\nè®¡ç®—åˆ—æ˜¯ä½¿ç”¨ \u0026ldquo;column_name AS computed_column_expression\u0026rdquo; è¯­æ³•ç”Ÿæˆçš„è™šæ‹Ÿåˆ—ã€‚å®ƒæ˜¯ç”±ä¸€ä¸ªéæŸ¥è¯¢è¡¨è¾¾å¼ç”Ÿæˆçš„ï¼Œè¿™ä¸ªè¡¨è¾¾å¼ä½¿ç”¨åŒä¸€å¼ è¡¨ä¸­çš„å…¶ä»–åˆ—ï¼Œè€Œä¸æ˜¯å®é™…å­˜å‚¨åœ¨è¡¨ä¸­ã€‚ä¾‹å¦‚ï¼Œè®¡ç®—åˆ—å¯ä»¥å®šä¹‰ä¸º cost AS price * quantityã€‚è¡¨è¾¾å¼å¯ä»¥åŒ…å«ç‰©ç†åˆ—ã€å¸¸é‡ã€å‡½æ•°æˆ–å˜é‡çš„ä»»æ„ç»„åˆã€‚è¡¨è¾¾å¼ä¸èƒ½åŒ…å«å­æŸ¥è¯¢ã€‚\nè®¡ç®—åˆ—åœ¨ Flink ä¸­é€šå¸¸ç”¨äºåœ¨ CREATE TABLE è¯­å¥ä¸­å®šä¹‰æ—¶é—´å±æ€§ã€‚å¯ä»¥é€šè¿‡ proc AS PROCTIME() ä½¿ç”¨ç³»ç»Ÿ proctime() å‡½æ•°è½»æ¾å®šä¹‰ä¸€ä¸ªå¤„ç†æ—¶é—´å±æ€§ã€‚å¦ä¸€æ–¹é¢ï¼Œè®¡ç®—åˆ—å¯ä»¥ç”¨æ¥æ´¾ç”Ÿäº‹ä»¶æ—¶é—´åˆ—ï¼Œå› ä¸ºäº‹ä»¶æ—¶é—´åˆ—å¯èƒ½éœ€è¦ä»ç°æœ‰çš„å­—æ®µä¸­æ´¾ç”Ÿå‡ºæ¥ï¼Œæ¯”å¦‚åŸæ¥çš„å­—æ®µä¸æ˜¯ TIMESTAMP(3)ç±»å‹ï¼Œæˆ–è€…åµŒå¥—åœ¨ JSON å­—ç¬¦ä¸²ä¸­ã€‚\næ³¨æ„ï¼š\n åœ¨æºè¡¨ä¸Šå®šä¹‰çš„è®¡ç®—åˆ—æ˜¯åœ¨ä»æºè¡¨è¯»å–åè®¡ç®—å‡ºæ¥çš„ï¼Œå®ƒå¯ä»¥ç”¨åœ¨ä¸‹é¢çš„ SELECT æŸ¥è¯¢è¯­å¥ä¸­ã€‚ è®¡ç®—åˆ—ä¸èƒ½ä½œä¸º INSERT è¯­å¥çš„ç›®æ ‡ã€‚åœ¨ INSERT è¯­å¥ä¸­ï¼ŒSELECT å­å¥çš„æ¨¡å¼åº”è¯¥ä¸æ²¡æœ‰è®¡ç®—åˆ—çš„ç›®æ ‡è¡¨çš„æ¨¡å¼ç›¸åŒ¹é…ã€‚  WATERMARK\nWATERMARK å®šä¹‰äº†è¡¨çš„äº‹ä»¶æ—¶é—´å±æ€§ï¼Œå…¶å½¢å¼ä¸º WATERMARK FOR rowtime_column_name AS watermark_strategy_expressionã€‚\nrowtime_column_name å®šä¹‰äº†ä¸€ä¸ªç°æœ‰çš„åˆ—ï¼Œè¯¥åˆ—è¢«æ ‡è®°ä¸ºè¡¨çš„äº‹ä»¶æ—¶é—´å±æ€§ã€‚è¿™ä¸ªåˆ—çš„ç±»å‹å¿…é¡»æ˜¯ TIMESTAMP(3)ï¼Œå¹¶ä¸”æ˜¯æ¨¡å¼ä¸­çš„é¡¶å±‚åˆ—ã€‚å®ƒå¯ä»¥æ˜¯ä¸€ä¸ªè®¡ç®—åˆ—ã€‚\nwatermark_strategy_expression å®šä¹‰äº†æ°´å°ç”Ÿæˆç­–ç•¥ã€‚å®ƒå…è®¸ä»»æ„çš„éæŸ¥è¯¢è¡¨è¾¾å¼ï¼ŒåŒ…æ‹¬è®¡ç®—åˆ—ï¼Œæ¥è®¡ç®—æ°´å°ã€‚è¡¨è¾¾å¼çš„è¿”å›ç±»å‹å¿…é¡»æ˜¯ TIMESTAMP(3)ï¼Œå®ƒè¡¨ç¤ºè‡ª Epoch ä»¥æ¥çš„æ—¶é—´æˆ³ã€‚åªæœ‰å½“è¿”å›çš„æ°´å°æ˜¯éç©ºçš„ï¼Œå¹¶ä¸”å®ƒçš„å€¼å¤§äºä¹‹å‰å‘å‡ºçš„æœ¬åœ°æ°´å°æ—¶ï¼Œæ‰ä¼šå‘å‡ºæ°´å°ï¼ˆä»¥ä¿ç•™å‡æ°´å°çš„å¥‘çº¦ï¼‰ã€‚æ°´å°ç”Ÿæˆè¡¨è¾¾å¼ç”±æ¡†æ¶å¯¹æ¯æ¡è®°å½•è¿›è¡Œè¯„ä¼°ã€‚æ¡†æ¶å°†å®šæœŸå‘å°„æœ€å¤§çš„ç”Ÿæˆæ°´å°ã€‚å¦‚æœå½“å‰çš„æ°´å°ä»ç„¶ä¸ä¸Šä¸€ä¸ªæ°´å°ç›¸åŒï¼Œæˆ–è€…æ˜¯ç©ºçš„ï¼Œæˆ–è€…è¿”å›çš„æ°´å°å€¼å°äºä¸Šä¸€æ¬¡å‘å°„çš„æ°´å°å€¼ï¼Œé‚£ä¹ˆå°†ä¸ä¼šå‘å°„æ–°çš„æ°´å°ã€‚æ°´å°æ˜¯åœ¨ pipeline.auto-watermark-interval é…ç½®å®šä¹‰çš„æ—¶é—´é—´éš”å†…å‘å‡ºçš„ã€‚å¦‚æœæ°´å°é—´éš”ä¸º 0msï¼Œå¦‚æœç”Ÿæˆçš„æ°´å°ä¸æ˜¯ç©ºçš„ï¼Œå¹¶ä¸”å¤§äºæœ€åä¸€ä¸ªæ°´å°ï¼Œåˆ™æ¯æ¡è®°å½•éƒ½ä¼šå‘å‡ºæ°´å°ã€‚\nå½“ä½¿ç”¨äº‹ä»¶æ—¶é—´è¯­ä¹‰æ—¶ï¼Œè¡¨å¿…é¡»åŒ…å«äº‹ä»¶æ—¶é—´å±æ€§å’Œæ°´å°ç­–ç•¥ã€‚\nFlink æä¾›äº†å‡ ç§å¸¸ç”¨çš„æ°´å°ç­–ç•¥ã€‚\n  ä¸¥æ ¼çš„å‡åºæ—¶é—´æˆ³ã€‚WATERMARK FOR rowtime_column AS rowtime_columnã€‚\n  å‘å‡ºè¿„ä»Šä¸ºæ­¢è§‚å¯Ÿåˆ°çš„æœ€å¤§æ—¶é—´æˆ³çš„æ°´å°ã€‚æ—¶é—´æˆ³å°äºæœ€å¤§æ—¶é—´æˆ³çš„è¡Œä¸ä¼šè¿Ÿåˆ°ã€‚\n  å‡åºæ—¶é—´æˆ³ã€‚WATERMARK FOR rowtime_column AS rowtime_column - INTERVAL \u0026lsquo;0.001\u0026rsquo; SECOND.\n  å‘å‡ºè¿„ä»Šä¸ºæ­¢è§‚å¯Ÿåˆ°çš„æœ€å¤§æ—¶é—´æˆ³çš„æ°´å°å‡ 1ã€‚æ—¶é—´æˆ³ç­‰äºæˆ–å°äºæœ€å¤§æ—¶é—´æˆ³çš„è¡Œä¸ä¼šè¿Ÿåˆ°ã€‚\n  ç»‘å®šå‡ºé¡ºåºæ€§çš„æ—¶é—´æˆ³ã€‚WATERMARK FOR rowtime_column AS rowtime_column - INTERVAL \u0026lsquo;string\u0026rsquo; timeUnit.\n  å‘å‡ºæ°´å°ï¼Œæ°´å°æ˜¯æœ€å¤§è§‚å¯Ÿåˆ°çš„æ—¶é—´æˆ³å‡å»æŒ‡å®šçš„å»¶è¿Ÿï¼Œä¾‹å¦‚ï¼šWATERMARK FOR rowtime_column AS rowtime_column - INTERVAL \u0026lsquo;5\u0026rsquo; SECOND æ˜¯ 5 ç§’çš„å»¶è¿Ÿæ°´å°ç­–ç•¥ã€‚\nCREATETABLEOrders(userBIGINT,productSTRING,order_timeTIMESTAMP(3),WATERMARKFORorder_timeASorder_time-INTERVAL\u0026#39;5\u0026#39;SECOND)WITH(...);PRIMARYKEYPRIMARY KEY\nFlink åˆ©ç”¨ä¼˜åŒ–çš„ä¸€ä¸ªæç¤ºã€‚å®ƒå‘Šè¯‰æˆ‘ä»¬ä¸€ä¸ªè¡¨æˆ–è§†å›¾çš„ä¸€åˆ—æˆ–ä¸€ç»„åˆ—æ˜¯å”¯ä¸€çš„ï¼Œå®ƒä»¬ä¸åŒ…å«ç©ºå€¼ã€‚ä¸»é”®ä¸­çš„ä¸¤åˆ—éƒ½ä¸èƒ½ä¸ºç©ºã€‚å› æ­¤ï¼Œä¸»é”®å¯ä»¥å”¯ä¸€åœ°è¯†åˆ«è¡¨ä¸­çš„æŸä¸€è¡Œã€‚\nä¸»é”®çº¦æŸæ—¢å¯ä»¥å’Œåˆ—å®šä¹‰ä¸€èµ·å£°æ˜ï¼ˆåˆ—çº¦æŸï¼‰ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå•è¡Œï¼ˆè¡¨çº¦æŸï¼‰ã€‚å¯¹äºè¿™ä¸¤ç§æƒ…å†µï¼Œåªèƒ½å°†å…¶å£°æ˜ä¸ºä¸€ä¸ªå•å­ã€‚å¦‚æœä½ åŒæ—¶å®šä¹‰äº†å¤šä¸ªä¸»é”®çº¦æŸï¼Œå°±ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚\næœ‰æ•ˆæ€§æ£€æŸ¥\nSQL æ ‡å‡†è§„å®šï¼Œä¸€ä¸ªçº¦æŸå¯ä»¥æ˜¯ ENFORCED æˆ– NOT ENFORCEDã€‚è¿™æ§åˆ¶äº†çº¦æŸæ£€æŸ¥æ˜¯å¦ä¼šåœ¨è¾“å…¥/è¾“å‡ºæ•°æ®ä¸Šæ‰§è¡Œã€‚Flink å¹¶ä¸æ‹¥æœ‰æ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬è¦æ”¯æŒçš„å”¯ä¸€æ¨¡å¼æ˜¯ NOT ENFORCED æ¨¡å¼ã€‚ç”¨æˆ·è¦ç¡®ä¿æŸ¥è¯¢å¼ºåˆ¶æ‰§è¡Œå¯†é’¥çš„å®Œæ•´æ€§ã€‚\nFlink ä¼šå‡è®¾ä¸»é”®çš„æ­£ç¡®æ€§ï¼Œå‡è®¾åˆ—çš„ç©ºæ€§ä¸ä¸»é”®çš„åˆ—å¯¹é½ã€‚è¿æ¥å™¨åº”è¯¥ç¡®ä¿è¿™äº›æ˜¯å¯¹é½çš„ã€‚\næ³¨æ„äº‹é¡¹: åœ¨ CREATE TABLE è¯­å¥ä¸­ï¼Œåˆ›å»ºä¸»é”®çº¦æŸä¼šæ”¹å˜åˆ—çš„å¯ç©ºæ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæœ‰ä¸»é”®çº¦æŸçš„åˆ—æ˜¯ä¸å¯ç©ºçš„ã€‚\nPARTITIONED BY\næŒ‰æŒ‡å®šçš„åˆ—å¯¹åˆ›å»ºçš„è¡¨è¿›è¡Œåˆ†åŒºã€‚å¦‚æœè¯¥è¡¨è¢«ç”¨ä½œæ–‡ä»¶ç³»ç»Ÿæ±‡ï¼Œåˆ™ä¼šä¸ºæ¯ä¸ªåˆ†åŒºåˆ›å»ºä¸€ä¸ªç›®å½•ã€‚\nWITH OPTIONS\nè¡¨å±æ€§ç”¨äºåˆ›å»ºè¡¨æº/æ¥æ”¶å™¨ã€‚è¿™äº›å±æ€§é€šå¸¸ç”¨äºæŸ¥æ‰¾å’Œåˆ›å»ºåº•å±‚è¿æ¥å™¨ã€‚\nè¡¨è¾¾å¼ key1=val1 çš„é”®å’Œå€¼éƒ½åº”è¯¥æ˜¯å­—ç¬¦ä¸²æ–‡å­—ã€‚å…³äºä¸åŒè¿æ¥å™¨çš„æ‰€æœ‰æ”¯æŒçš„è¡¨å±æ€§ï¼Œè¯·å‚è§è¿æ¥åˆ°å¤–éƒ¨ç³»ç»Ÿä¸­çš„è¯¦ç»†ä¿¡æ¯ã€‚\næ³¨é‡Šï¼šè¡¨åå¯ä»¥æœ‰ä¸‰ç§æ ¼å¼ã€‚è¡¨åå¯ä»¥æœ‰ä¸‰ç§æ ¼å¼ã€‚\n catalog_name.db_name.table_name db_name.table_name table_nameã€‚  å¯¹äº catalog_name.db_name.table_nameï¼Œè¡¨å°†è¢«æ³¨å†Œåˆ°å…ƒå­˜å‚¨ä¸­ï¼Œç›®å½•åä¸º \u0026ldquo;catalog_name\u0026rdquo;ï¼Œæ•°æ®åº“åä¸º \u0026ldquo;db_name\u0026rdquo;ï¼›å¯¹äº db_name.table_nameï¼Œè¡¨å°†è¢«æ³¨å†Œåˆ°æ‰§è¡Œè¡¨ç¯å¢ƒçš„å½“å‰ç›®å½•ä¸­ï¼Œæ•°æ®åº“åä¸º \u0026ldquo;db_name\u0026rdquo;ï¼›å¯¹äº table_nameï¼Œè¡¨å°†è¢«æ³¨å†Œåˆ°æ‰§è¡Œè¡¨ç¯å¢ƒçš„å½“å‰ç›®å½•å’Œæ•°æ®åº“ä¸­ã€‚\næ³¨æ„äº‹é¡¹: ç”¨ CREATE TABLE è¯­å¥æ³¨å†Œçš„è¡¨æ—¢å¯ä»¥ä½œä¸ºè¡¨æºï¼Œä¹Ÿå¯ä»¥ä½œä¸ºè¡¨æ±‡ï¼Œåœ¨ DMLs ä¸­æ²¡æœ‰å¼•ç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬ä¸èƒ½å†³å®šå®ƒæ˜¯ä½œä¸ºè¡¨æºè¿˜æ˜¯è¡¨æ±‡ä½¿ç”¨ã€‚\nLIKE å­å¥\nLIKE å­å¥æ˜¯ SQL ç‰¹å¾çš„å˜ä½“/ç»„åˆï¼ˆç‰¹å¾ T171ï¼Œ\u0026ldquo;è¡¨å®šä¹‰ä¸­çš„ LIKE å­å¥\u0026quot;å’Œç‰¹å¾ T173ï¼Œ\u0026ldquo;è¡¨å®šä¹‰ä¸­çš„æ‰©å±• LIKE å­å¥\u0026rdquo;ï¼‰ã€‚è¯¥å­å¥å¯ç”¨äºæ ¹æ®ç°æœ‰è¡¨çš„å®šä¹‰åˆ›å»ºä¸€ä¸ªè¡¨ã€‚æ­¤å¤–ï¼Œç”¨æˆ·è¿˜å¯ä»¥æ‰©å±•åŸè¡¨æˆ–æ’é™¤å…¶ä¸­çš„æŸäº›éƒ¨åˆ†ã€‚ä¸ SQL æ ‡å‡†ä¸åŒçš„æ˜¯ï¼Œè¯¥å­å¥å¿…é¡»åœ¨ CREATE è¯­å¥çš„é¡¶å±‚å®šä¹‰ã€‚è¿™æ˜¯å› ä¸ºè¯¥å­å¥é€‚ç”¨äºå®šä¹‰çš„å¤šä¸ªéƒ¨åˆ†ï¼Œè€Œä¸ä»…ä»…æ˜¯æ¨¡å¼éƒ¨åˆ†ã€‚\nä½ å¯ä»¥ä½¿ç”¨è¯¥å­å¥æ¥é‡ç”¨ï¼ˆå¹¶å¯èƒ½è¦†ç›–ï¼‰æŸäº›è¿æ¥å™¨å±æ€§ï¼Œæˆ–è€…ä¸ºå¤–éƒ¨å®šä¹‰çš„è¡¨æ·»åŠ æ°´å°ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä¸º Apache Hive ä¸­å®šä¹‰çš„è¡¨æ·»åŠ æ°´å°ã€‚\nè¯·è€ƒè™‘ä¸‹é¢çš„ç¤ºä¾‹è¯­å¥ã€‚\nCREATETABLEOrders(userBIGINT,productSTRING,order_timeTIMESTAMP(3))WITH(\u0026#39;connector\u0026#39;=\u0026#39;kafka\u0026#39;,\u0026#39;scan.startup.mode\u0026#39;=\u0026#39;earliest-offset\u0026#39;);CREATETABLEOrders_with_watermark(-- Add watermark definition WATERMARKFORorder_timeASorder_time-INTERVAL\u0026#39;5\u0026#39;SECOND)WITH(-- Overwrite the startup-mode \u0026#39;scan.startup.mode\u0026#39;=\u0026#39;latest-offset\u0026#39;)LIKEOrders;ç”±æ­¤äº§ç”Ÿçš„ Orders_with_watermark è¡¨å°†ç­‰åŒäºç”¨ä»¥ä¸‹è¯­å¥åˆ›å»ºçš„è¡¨ã€‚\nCREATETABLEOrders_with_watermark(userBIGINT,productSTRING,order_timeTIMESTAMP(3),WATERMARKFORorder_timeASorder_time-INTERVAL\u0026#39;5\u0026#39;SECOND)WITH(\u0026#39;connector\u0026#39;=\u0026#39;kafka\u0026#39;,\u0026#39;scan.startup.mode\u0026#39;=\u0026#39;latest-offset\u0026#39;);å¯ä»¥ç”¨åŒç±»é€‰é¡¹æ§åˆ¶è¡¨åŠŸèƒ½çš„åˆå¹¶é€»è¾‘ã€‚\næ‚¨å¯ä»¥æ§åˆ¶ä»¥ä¸‹çš„åˆå¹¶è¡Œä¸º:\n CONSTRAINTS - ä¸»é”®å’Œå”¯ä¸€é”®ç­‰çº¦æŸæ¡ä»¶ã€‚ GENERATED-è®¡ç®—åˆ— OPTIONS - æè¿°è¿æ¥å™¨å’Œæ ¼å¼å±æ€§çš„è¿æ¥å™¨é€‰é¡¹ã€‚ PARTITIONS - è¡¨çš„åˆ†åŒº WATERMARKS - æ°´å°å£°æ˜  æœ‰ä¸‰ç§ä¸åŒçš„åˆå¹¶ç­–ç•¥ã€‚\n INCLUDING - åŒ…æ‹¬æºè¡¨çš„ç‰¹å¾ï¼Œå¯¹é‡å¤çš„æ¡ç›®å¤±è´¥ï¼Œä¾‹å¦‚ï¼Œå¦‚æœä¸¤ä¸ªè¡¨ä¸­éƒ½å­˜åœ¨ç›¸åŒé”®çš„é€‰é¡¹ã€‚ EXCLUDING - ä¸åŒ…å«æºè¡¨çš„ç»™å®šç‰¹å¾ã€‚ OVERWRITING - åŒ…æ‹¬æºè¡¨çš„ç‰¹å¾ï¼Œç”¨æ–°è¡¨çš„å±æ€§è¦†ç›–æºè¡¨çš„é‡å¤æ¡ç›®ï¼Œä¾‹å¦‚ï¼Œå¦‚æœä¸¤ä¸ªè¡¨ä¸­éƒ½å­˜åœ¨å…·æœ‰ç›¸åŒé”®çš„é€‰é¡¹ï¼Œåˆ™å°†ä½¿ç”¨å½“å‰è¯­å¥ä¸­çš„é€‰é¡¹ã€‚  æ­¤å¤–ï¼Œå¯ä»¥ä½¿ç”¨ INCLUDING/EXCLUDING ALL é€‰é¡¹æ¥æŒ‡å®šå¦‚æœæ²¡æœ‰å®šä¹‰ç‰¹å®šçš„ç­–ç•¥åº”è¯¥æ˜¯ä»€ä¹ˆï¼Œå³å¦‚æœä½¿ç”¨ EXCLUDING ALL INCLUDING WATERMARKSï¼Œåˆ™åªä»æºè¡¨ä¸­åŒ…å«æ°´å°ã€‚\nä¾‹å­ï¼š\n-- A source table stored in a filesystem CREATETABLEOrders_in_file(userBIGINT,productSTRING,order_time_stringSTRING,order_timeASto_timestamp(order_time))PARTITIONEDBYuserWITH(\u0026#39;connector\u0026#39;=\u0026#39;filesystem\u0026#39;\u0026#39;path\u0026#39;=\u0026#39;...\u0026#39;);-- A corresponding table we want to store in kafka CREATETABLEOrders_in_kafka(-- Add watermark definition WATERMARKFORorder_timeASorder_time-INTERVAL\u0026#39;5\u0026#39;SECOND)WITH(\u0026#39;connector\u0026#39;:\u0026#39;kafka\u0026#39;...)LIKEOrders_in_file(-- Exclude everything besides the computed columns which we need to generate the watermark for. -- We do not want to have the partitions or filesystem options as those do not apply to kafka. EXCLUDINGALLINCLUDINGGENERATED);å¦‚æœæ‚¨æ²¡æœ‰æä¾›åŒç±»é€‰é¡¹ï¼Œåˆ™é»˜è®¤ä½¿ç”¨ INCLUDING ALL OVERWRITING OPTIONSã€‚\næ³¨æ„: æ‚¨æ— æ³•æ§åˆ¶åˆå¹¶ç‰©ç†å­—æ®µçš„è¡Œä¸ºã€‚è¿™äº›å­—æ®µå°†è¢«åˆå¹¶ï¼Œå°±åƒæ‚¨åº”ç”¨ INCLUDING ç­–ç•¥ä¸€æ ·ã€‚\nCREATE CATALOG CREATECATALOGcatalog_nameWITH(key1=val1,key2=val2,...)ç”¨ç»™å®šçš„ç›®å½•å±æ€§åˆ›å»ºä¸€ä¸ªç›®å½•ã€‚å¦‚æœå·²ç»å­˜åœ¨åŒåçš„ç›®å½•ï¼Œåˆ™ä¼šäº§ç”Ÿå¼‚å¸¸ã€‚\nWITH OPTIONS\nç›®å½•å±æ€§ï¼Œç”¨äºå­˜å‚¨ä¸æœ¬ç›®å½•ç›¸å…³çš„é¢å¤–ä¿¡æ¯ã€‚è¡¨è¾¾å¼ key1=val1 çš„é”®å’Œå€¼éƒ½åº”è¯¥æ˜¯å­—ç¬¦ä¸²æ–‡å­—ã€‚\næ›´å¤šè¯¦æƒ…è¯·æŸ¥çœ‹ç›®å½•ã€‚\nCREATE DATABASE CREATEDATABASE[IFNOTEXISTS][catalog_name.]db_name[COMMENTdatabase_comment]WITH(key1=val1,key2=val2,...)ç”¨ç»™å®šçš„æ•°æ®åº“å±æ€§åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œå¦‚æœç›®å½•ä¸­å·²ç»å­˜åœ¨åŒåçš„æ•°æ®åº“ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚å¦‚æœç›®å½•ä¸­å·²ç»å­˜åœ¨ç›¸åŒåç§°çš„æ•°æ®åº“ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚\nIF NOT EXISTS\nå¦‚æœæ•°æ®åº“å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸ä¼šå‘ç”Ÿä»»ä½•äº‹æƒ…ã€‚\nWITH OPTIONS\næ•°æ®åº“å±æ€§ï¼Œç”¨äºå­˜å‚¨ä¸æœ¬æ•°æ®åº“ç›¸å…³çš„é¢å¤–ä¿¡æ¯ã€‚è¡¨è¾¾å¼ key1=val1 çš„é”®å’Œå€¼éƒ½åº”è¯¥æ˜¯å­—ç¬¦ä¸²æ–‡å­—ã€‚\nCREATE VIEW CREATE[TEMPORARY]VIEW[IFNOTEXISTS][catalog_name.][db_name.]view_name[{columnName[,columnName]*}][COMMENTview_comment]ASquery_expressionç”¨ç»™å®šçš„æŸ¥è¯¢è¡¨è¾¾å¼åˆ›å»ºä¸€ä¸ªè§†å›¾ï¼Œå¦‚æœç›®å½•ä¸­å·²ç»å­˜åœ¨åŒåçš„è§†å›¾ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚å¦‚æœç›®å½•ä¸­å·²ç»å­˜åœ¨åŒåçš„è§†å›¾ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚\nTEMPORARY\nåˆ›å»ºå…·æœ‰ç›®å½•å’Œæ•°æ®åº“å‘½åç©ºé—´å¹¶è¦†ç›–è§†å›¾çš„ä¸´æ—¶è§†å›¾ã€‚\nIF NOT EXISTS\nå¦‚æœè§†å›¾å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸ä¼šå‘ç”Ÿä»»ä½•äº‹æƒ…ã€‚\nCREATE FUNCTION CREATE[TEMPORARY|TEMPORARYSYSTEM]FUNCTION[IFNOTEXISTS][catalog_name.][db_name.]function_nameASidentifier[LANGUAGEJAVA|SCALA|PYTHON]åˆ›å»ºä¸€ä¸ªç›®å½•å‡½æ•°ï¼Œè¯¥å‡½æ•°å…·æœ‰ç›®å½•å’Œæ•°æ®åº“çš„åç§°ç©ºé—´ï¼Œå¹¶å¸¦æœ‰æ ‡è¯†ç¬¦å’Œå¯é€‰çš„è¯­è¨€æ ‡ç­¾ã€‚å¦‚æœç›®å½•ä¸­å·²ç»å­˜åœ¨åŒåå‡½æ•°ï¼Œåˆ™ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚\nå¦‚æœè¯­è¨€æ ‡ç­¾æ˜¯ JAVA/SCALAï¼Œæ ‡è¯†ç¬¦æ˜¯ UDF çš„å®Œæ•´ classpathã€‚å…³äº Java/Scala UDF çš„å®ç°ï¼Œè¯·å‚è€ƒ User-defined Functions äº†è§£è¯¦æƒ…ã€‚\nå¦‚æœè¯­è¨€æ ‡ç­¾æ˜¯ PYTHONï¼Œæ ‡è¯†ç¬¦æ˜¯ UDF çš„å®Œå…¨é™å®šåï¼Œä¾‹å¦‚ pyflink.table.test.test_udf.addã€‚å…³äº Python UDF çš„å®ç°ï¼Œæ›´å¤šç»†èŠ‚è¯·å‚è€ƒ Python UDFsã€‚\nTEMPORARY\nåˆ›å»ºå…·æœ‰ç›®å½•å’Œæ•°æ®åº“å‘½åç©ºé—´å¹¶è¦†ç›–ç›®å½•åŠŸèƒ½çš„ä¸´æ—¶ç›®å½•åŠŸèƒ½ã€‚\nTEMPORARY SYSTEM\nåˆ›å»ºæ²¡æœ‰å‘½åç©ºé—´å¹¶è¦†ç›–å†…ç½®å‡½æ•°çš„ä¸´æ—¶ç³»ç»Ÿå‡½æ•°ã€‚\nIF NOT EXISTS\nå¦‚æœå‡½æ•°å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸ä¼šå‘ç”Ÿä»»ä½•äº‹æƒ…ã€‚\nLANGUAGE JAVA|SCALA|PYTHON\nè¯­è¨€æ ‡ç­¾ï¼Œç”¨äºæŒ‡ç¤º Flink è¿è¡Œæ—¶å¦‚ä½•æ‰§è¡Œå‡½æ•°ã€‚ç›®å‰åªæ”¯æŒ JAVAã€SCALA å’Œ PYTHONï¼Œå‡½æ•°çš„é»˜è®¤è¯­è¨€æ˜¯ JAVAã€‚\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/sql/create.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-create-statements/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL"],"title":"Create è¯­å¥"},{"categories":["Flink"],"contents":"DataSet è½¬æ¢ æœ¬æ–‡æ¡£æ·±å…¥ä»‹ç»äº† DataSets ä¸Šå¯ç”¨çš„è½¬æ¢ã€‚å…³äº Flink Java API çš„ä¸€èˆ¬ä»‹ç»ï¼Œè¯·å‚è€ƒç¼–ç¨‹æŒ‡å—ã€‚\nå¯¹äºå¯†é›†ç´¢å¼•çš„æ•°æ®é›†ä¸­çš„å‹ç¼©å…ƒç´ ï¼Œè¯·å‚è€ƒå‹ç¼©å…ƒç´ æŒ‡å—ã€‚\nMap Map è½¬æ¢å°†ç”¨æˆ·å®šä¹‰çš„æ˜ å°„å‡½æ•°åº”ç”¨äº DataSet çš„æ¯ä¸ªå…ƒç´ ã€‚å®ƒå®ç°äº†ä¸€å¯¹ä¸€çš„æ˜ å°„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå‡½æ•°å¿…é¡»å‡†ç¡®åœ°è¿”å›ä¸€ä¸ªå…ƒç´ ã€‚\nä¸‹é¢çš„ä»£ç å°†ä¸€ä¸ªç”±æ•´æ•°å¯¹ç»„æˆçš„ DataSet è½¬åŒ–ä¸ºä¸€ä¸ªç”±æ•´æ•°ç»„æˆçš„ DataSetã€‚\nval intPairs: DataSet[(Int, Int)] = // [...] val intSums = intPairs.map { pair =\u0026gt; pair._1 + pair._2 } FlatMap FlatMap è½¬æ¢åœ¨ DataSet çš„æ¯ä¸ªå…ƒç´ ä¸Šåº”ç”¨äº†ä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„ flat-map å‡½æ•°ã€‚è¿™ç§æ˜ å°„å‡½æ•°çš„å˜ä½“å¯ä»¥ä¸ºæ¯ä¸ªè¾“å…¥å…ƒç´ è¿”å›ä»»æ„å¤šä¸ªç»“æœå…ƒç´ ï¼ˆåŒ…æ‹¬æ²¡æœ‰ï¼‰ã€‚\nä¸‹é¢çš„ä»£ç å°†ä¸€ä¸ªæ–‡æœ¬è¡Œçš„ DataSet è½¬æ¢ä¸ºä¸€ä¸ªå•è¯çš„ DataSetã€‚\nval textLines: DataSet[String] = // [...] val words = textLines.flatMap { _.split(\u0026#34; \u0026#34;) } MapPartition MapPartition åœ¨ä¸€æ¬¡å‡½æ•°è°ƒç”¨ä¸­è½¬æ¢ä¸€ä¸ªå¹¶è¡Œåˆ†åŒºã€‚map-partition å‡½æ•°ä»¥ Iterable çš„å½¢å¼è·å–åˆ†åŒºï¼Œå¹¶å¯ä»¥äº§ç”Ÿä»»æ„æ•°é‡çš„ç»“æœå€¼ã€‚æ¯ä¸ªåˆ†åŒºä¸­å…ƒç´ çš„æ•°é‡å–å†³äºå¹³è¡Œåº¦å’Œä¹‹å‰çš„æ“ä½œã€‚\nä¸‹é¢çš„ä»£ç å°†æ–‡æœ¬è¡Œçš„ DataSet è½¬æ¢ä¸ºæ¯ä¸ªåˆ†åŒºçš„è®¡æ•° DataSetã€‚\nval textLines: DataSet[String] = // [...] // Some is required because the return value must be a Collection. // There is an implicit conversion from Option to a Collection. val counts = texLines.mapPartition { in =\u0026gt; Some(in.size) } Filter è¿‡æ»¤å™¨è½¬æ¢å°†ç”¨æˆ·å®šä¹‰çš„è¿‡æ»¤å™¨å‡½æ•°åº”ç”¨äº DataSet çš„æ¯ä¸ªå…ƒç´ ï¼Œå¹¶ä¸”åªä¿ç•™é‚£äº›å‡½æ•°è¿”å›ä¸ºçœŸçš„å…ƒç´ ã€‚\nä»¥ä¸‹ä»£ç ä»æ•°æ®é›†ä¸­åˆ é™¤æ‰€æœ‰å°äºé›¶çš„æ•´æ•°ã€‚\nval intNumbers: DataSet[Int] = // [...] val naturalNumbers = intNumbers.filter { _ \u0026gt; 0 } é‡è¦ï¼šç³»ç»Ÿå‡è®¾å‡½æ•°ä¸ä¼šä¿®æ”¹åº”ç”¨è°“è¯çš„å…ƒç´ ã€‚è¿åè¿™ä¸ªå‡è®¾ä¼šå¯¼è‡´é”™è¯¯çš„ç»“æœã€‚\nå…ƒç»„æ•°æ®é›†çš„æŠ•å½±(Projection) Project è½¬æ¢åˆ é™¤æˆ–ç§»åŠ¨ Tuple DataSet çš„ Tuple å­—æ®µã€‚project(int...) æ–¹æ³•é€šè¿‡å…¶ç´¢å¼•é€‰æ‹©åº”è¯¥ä¿ç•™çš„ Tuple å­—æ®µï¼Œå¹¶å®šä¹‰å®ƒä»¬åœ¨è¾“å‡º Tuple ä¸­çš„é¡ºåºã€‚\næŠ•å½±(Projection)ä¸éœ€è¦å®šä¹‰ç”¨æˆ·å‡½æ•°ã€‚\nä¸‹é¢çš„ä»£ç æ˜¾ç¤ºäº†åœ¨ DataSet ä¸Šåº”ç”¨ Project è½¬æ¢çš„ä¸åŒæ–¹æ³•ã€‚\nDataSet\u0026lt;Tuple3\u0026lt;Integer, Double, String\u0026gt;\u0026gt; in = // [...] // converts Tuple3\u0026lt;Integer, Double, String\u0026gt; into Tuple2\u0026lt;String, Integer\u0026gt; DataSet\u0026lt;Tuple2\u0026lt;String, Integer\u0026gt;\u0026gt; out = in.project(2,0); # scala Not supported. åˆ†ç»„æ•°æ®é›†ä¸Šçš„å˜æ¢ reduce æ“ä½œå¯ä»¥å¯¹åˆ†ç»„çš„æ•°æ®é›†è¿›è¡Œæ“ä½œã€‚æŒ‡å®šç”¨äºåˆ†ç»„çš„é”®å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼è¿›è¡Œã€‚\n é”®è¡¨è¾¾å¼ é”®é€‰æ‹©å™¨å‡½æ•° ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µä½ç½®é”®ï¼ˆä»…é™å…ƒç»„æ•°æ®é›†ï¼‰ã€‚ case ç±»å­—æ®µ(ä»… case ç±»)  è¯·çœ‹ä¸€ä¸‹ reduce çš„ä¾‹å­ï¼Œçœ‹çœ‹å¦‚ä½•æŒ‡å®šåˆ†ç»„é”®ã€‚\næ¢ç®—åˆ†ç»„æ•°æ®é›† åº”ç”¨äºåˆ†ç»„æ•°æ®é›†çš„ Reduce è½¬æ¢ï¼Œä½¿ç”¨ç”¨æˆ·å®šä¹‰çš„ Reduce å‡½æ•°å°†æ¯ä¸ªåˆ†ç»„æ¢ç®—ä¸ºä¸€ä¸ªå…ƒç´ ã€‚å¯¹äºæ¯ä¸€ç»„è¾“å…¥å…ƒç´ ï¼Œä¸€ä¸ª Reduce å‡½æ•°å°†æˆå¯¹çš„å…ƒç´ è¿ç»­ç»„åˆæˆä¸€ä¸ªå…ƒç´ ï¼Œç›´åˆ°æ¯ç»„åªå‰©ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚\nè¯·æ³¨æ„ï¼Œå¯¹äºä¸€ä¸ª ReduceFunctionï¼Œè¿”å›å¯¹è±¡çš„é”®å­—æ®µåº”è¯¥ä¸è¾“å…¥å€¼ç›¸åŒ¹é…ã€‚è¿™æ˜¯å› ä¸º reduce æ˜¯éšå¼å¯ç»„åˆçš„ï¼Œå½“ä¼ é€’ç»™ reduce è¿ç®—ç¬¦æ—¶ï¼Œä» combine è¿ç®—ç¬¦å‘å‡ºçš„å¯¹è±¡åˆæ˜¯æŒ‰é”®åˆ†ç»„çš„ã€‚\nåœ¨æŒ‰é”®è¡¨è¾¾å¼åˆ†ç»„çš„æ•°æ®é›†ä¸Šè¿›è¡Œ Reduce æ“ä½œ é”®è¡¨è¾¾å¼æŒ‡å®šäº† DataSet ä¸­æ¯ä¸ªå…ƒç´ çš„ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µã€‚æ¯ä¸ªé”®è¡¨è¾¾å¼éƒ½æ˜¯ä¸€ä¸ªå…¬å…±å­—æ®µçš„åç§°æˆ–ä¸€ä¸ª getter æ–¹æ³•ã€‚ç‚¹å·å¯ä»¥ç”¨æ¥æ·±å…¥åˆ°å¯¹è±¡ä¸­ã€‚é”®è¡¨è¾¾å¼ \u0026quot;*\u0026quot; å¯ä»¥é€‰æ‹©æ‰€æœ‰å­—æ®µã€‚ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨é”®è¡¨è¾¾å¼å¯¹ POJO æ•°æ®é›†è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ä½¿ç”¨ reduce å‡½æ•°å¯¹å…¶è¿›è¡Œæ¢ç®—ã€‚\n// some ordinary POJO class WC(val word: String, val count: Int) { def this() { this(null, -1) } // [...] } val words: DataSet[WC] = // [...] val wordCounts = words.groupBy(\u0026#34;word\u0026#34;).reduce { (w1, w2) =\u0026gt; new WC(w1.word, w1.count + w2.count) } å¯¹æŒ‰é”®é€‰æ‹©å™¨åˆ†ç»„çš„æ•°æ®é›†è¿›è¡Œæ¢ç®— é”®é€‰æ‹©å™¨å‡½æ•°ä»æ•°æ®é›†çš„æ¯ä¸ªå…ƒç´ ä¸­æå–ä¸€ä¸ªé”®å€¼ã€‚æå–çš„é”®å€¼ç”¨äºå¯¹ DataSet è¿›è¡Œåˆ†ç»„ã€‚ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨é”®é€‰æ‹©å™¨å‡½æ•°å¯¹ POJO æ•°æ®é›†è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ä½¿ç”¨ reduce å‡½æ•°å¯¹å…¶è¿›è¡Œæ¢ç®—ã€‚\n// some ordinary POJO class WC(val word: String, val count: Int) { def this() { this(null, -1) } // [...] } val words: DataSet[WC] = // [...] val wordCounts = words.groupBy { _.word } reduce { (w1, w2) =\u0026gt; new WC(w1.word, w1.count + w2.count) } å¯¹æŒ‰å­—æ®µä½ç½®é”®åˆ†ç»„çš„æ•°æ®é›†è¿›è¡Œæ¢ç®—ï¼ˆä»…å…ƒç»„æ•°æ®é›†ï¼‰ å­—æ®µä½ç½®é”®æŒ‡å®šäº†ä¸€ä¸ª Tuple DataSet çš„ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µï¼Œè¿™äº›å­—æ®µè¢«ç”¨ä½œåˆ†ç»„é”®ã€‚ä¸‹é¢çš„ä»£ç æ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨å­—æ®µä½ç½®é”®å’Œåº”ç”¨ reduce å‡½æ•°ã€‚\nval tuples = DataSet[(String, Int, Double)] = // [...] // group on the first and second Tuple field val reducedTuples = tuples.groupBy(0, 1).reduce { ... } å¯¹æŒ‰ case ç±»å­—æ®µåˆ†ç»„çš„æ•°æ®é›†è¿›è¡Œæ¢ç®— å½“ä½¿ç”¨ Case Classes æ—¶ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å­—æ®µçš„åç§°æ¥æŒ‡å®šåˆ†ç»„é”®ã€‚\ncase class MyClass(val a: String, b: Int, c: Double) val tuples = DataSet[MyClass] = // [...] // group on the first and second field val reducedTuples = tuples.groupBy(\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;).reduce { ... } åœ¨åˆ†ç»„æ•°æ®é›†ä¸Šè¿›è¡Œåˆ†ç»„æ¢ç®— åº”ç”¨åœ¨åˆ†ç»„ DataSet ä¸Šçš„ GroupReduce è½¬æ¢ï¼Œä¼šå¯¹æ¯ä¸ªç»„è°ƒç”¨ç”¨æˆ·å®šä¹‰çš„ group-reduce å‡½æ•°ã€‚è¿™ä¸ Reduce ä¹‹é—´çš„åŒºåˆ«åœ¨äºï¼Œç”¨æˆ·å®šä¹‰çš„å‡½æ•°å¯ä»¥ä¸€æ¬¡æ€§è·å¾—æ•´ä¸ªç»„ã€‚è¯¥å‡½æ•°æ˜¯åœ¨ä¸€ä¸ªç»„çš„æ‰€æœ‰å…ƒç´ ä¸Šç”¨ä¸€ä¸ª Iterable è°ƒç”¨çš„ï¼Œå¹¶ä¸”å¯ä»¥è¿”å›ä»»æ„æ•°é‡çš„ç»“æœå…ƒç´ ã€‚\nåœ¨æŒ‰å­—æ®µä½ç½®é”®åˆ†ç»„çš„æ•°æ®é›†ä¸Šè¿›è¡Œåˆ†ç»„ Reduce(åªé€‚ç”¨äºå…ƒç»„æ•°æ®é›†) ä¸‹é¢çš„ä»£ç æ˜¾ç¤ºäº†å¦‚ä½•ä»ä¸€ä¸ªæŒ‰ Integer åˆ†ç»„çš„ DataSet ä¸­åˆ é™¤é‡å¤çš„å­—ç¬¦ä¸²ã€‚\nval input: DataSet[(Int, String)] = // [...] val output = input.groupBy(0).reduceGroup { (in, out: Collector[(Int, String)]) =\u0026gt; in.toSet foreach (out.collect) } å¯¹æŒ‰é”®è¡¨è¾¾å¼ã€é”®é€‰æ‹©å™¨å‡½æ•°æˆ– case ç±»å­—æ®µåˆ†ç»„çš„æ•°æ®é›†è¿›è¡Œåˆ†ç»„æ¢ç®— ç±»ä¼¼äº Reduce å˜æ¢ä¸­çš„é”®è¡¨è¾¾å¼ã€é”®é€‰æ‹©å™¨å‡½æ•°å’Œ case ç±»å­—æ®µçš„å·¥ä½œã€‚\nå¯¹æ’åºç»„è¿›è¡Œ GroupReduce ä¸€ä¸ª group-reduce å‡½æ•°ä½¿ç”¨ä¸€ä¸ª Iterable è®¿é—®ä¸€ä¸ªç»„çš„å…ƒç´ ã€‚å¯é€‰åœ°ï¼ŒIterable å¯ä»¥æŒ‰ç…§æŒ‡å®šçš„é¡ºåºè¾“å‡ºä¸€ä¸ªç»„çš„å…ƒç´ ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œè¿™æœ‰åŠ©äºé™ä½ç”¨æˆ·å®šä¹‰çš„ group-reduce å‡½æ•°çš„å¤æ‚æ€§ï¼Œå¹¶æé«˜å…¶æ•ˆç‡ã€‚\nä¸‹é¢çš„ä»£ç æ˜¾ç¤ºäº†å¦ä¸€ä¸ªä¾‹å­ï¼Œå¦‚ä½•åœ¨ä¸€ä¸ªç”±æ•´æ•°åˆ†ç»„å¹¶æŒ‰ String æ’åºçš„ DataSet ä¸­åˆ é™¤é‡å¤çš„ Stringã€‚\nval input: DataSet[(Int, String)] = // [...] val output = input.groupBy(0).sortGroup(1, Order.ASCENDING).reduceGroup { (in, out: Collector[(Int, String)]) =\u0026gt; var prev: (Int, String) = null for (t \u0026lt;- in) { if (prev == null || prev != t) out.collect(t) prev = t } } æ³¨æ„ï¼šå¦‚æœåœ¨ reduce æ“ä½œä¹‹å‰ï¼Œä½¿ç”¨è¿ç®—ç¬¦çš„åŸºäºæ’åºçš„æ‰§è¡Œç­–ç•¥å»ºç«‹äº†åˆ†ç»„ï¼Œé‚£ä¹ˆ GroupSort é€šå¸¸æ˜¯å…è´¹çš„ã€‚\nå¯ç»„åˆçš„ GroupReduceFunctions ä¸ reduce å‡½æ•°ä¸åŒï¼Œgroup-reduce å‡½æ•°æ˜¯ä¸å¯éšå¼ç»„åˆçš„ã€‚ä¸ºäº†ä½¿ä¸€ä¸ªåˆ†ç»„æ¢ç®—å‡½æ•°å¯ä»¥ç»„åˆï¼Œå®ƒå¿…é¡»å®ç° GroupCombineFunction æ¥å£ã€‚\né‡è¦ï¼šGroupCombineFunction æ¥å£çš„é€šç”¨è¾“å…¥å’Œè¾“å‡ºç±»å‹å¿…é¡»ç­‰äº GroupReduceFunction çš„é€šç”¨è¾“å…¥ç±»å‹ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚\n// Combinable GroupReduceFunction that computes two sums. class MyCombinableGroupReducer extends GroupReduceFunction[(String, Int), String] with GroupCombineFunction[(String, Int), (String, Int)] { override def reduce( in: java.lang.Iterable[(String, Int)], out: Collector[String]): Unit = { val r: (String, Int) = in.iterator.asScala.reduce( (a,b) =\u0026gt; (a._1, a._2 + b._2) ) // concat key and sum and emit  out.collect (r._1 + \u0026#34;-\u0026#34; + r._2) } override def combine( in: java.lang.Iterable[(String, Int)], out: Collector[(String, Int)]): Unit = { val r: (String, Int) = in.iterator.asScala.reduce( (a,b) =\u0026gt; (a._1, a._2 + b._2) ) // emit tuple with key and sum  out.collect(r) } } åœ¨åˆ†ç»„æ•°æ®é›†ä¸Šè¿›è¡Œåˆ†ç»„åˆå¹¶ GroupCombine å˜æ¢æ˜¯å¯ç»„åˆçš„ GroupReduceFunction ä¸­ combine æ­¥éª¤çš„æ³›åŒ–å½¢å¼ã€‚ä¸æ­¤ç›¸åï¼ŒGroupReduce å‡½æ•°ä¸­çš„ combine æ­¥éª¤åªå…è®¸ä»è¾“å…¥ç±»å‹ I åˆ°è¾“å‡ºç±»å‹ I çš„ç»„åˆã€‚è¿™æ˜¯å› ä¸º GroupReduce å‡½æ•°ä¸­çš„ reduce æ­¥éª¤æœŸæœ›è¾“å…¥ç±»å‹ Iã€‚\nåœ¨æŸäº›åº”ç”¨ä¸­ï¼Œå¸Œæœ›åœ¨æ‰§è¡Œé¢å¤–çš„è½¬æ¢ï¼ˆä¾‹å¦‚å‡å°‘æ•°æ®å¤§å°ï¼‰ä¹‹å‰ï¼Œå°†ä¸€ä¸ªæ•°æ®é›†åˆå¹¶æˆä¸­é—´æ ¼å¼ã€‚è¿™å¯ä»¥é€šè¿‡ä¸€ä¸ª CombineGroup è½¬æ¢æ¥å®ç°ï¼Œè€Œä¸”æˆæœ¬å¾ˆä½ã€‚\næ³¨æ„ï¼šå¯¹åˆ†ç»„æ•°æ®é›†çš„ GroupCombine æ˜¯åœ¨å†…å­˜ä¸­ä»¥è´ªå©ªçš„ç­–ç•¥æ‰§è¡Œçš„ï¼Œå®ƒå¯èƒ½ä¸ä¼šä¸€æ¬¡å¤„ç†æ‰€æœ‰æ•°æ®ï¼Œè€Œæ˜¯åˆ†å¤šä¸ªæ­¥éª¤è¿›è¡Œã€‚å®ƒä¹Ÿæ˜¯åœ¨å„ä¸ªåˆ†åŒºä¸Šæ‰§è¡Œçš„ï¼Œè€Œä¸åƒ GroupReduce å˜æ¢é‚£æ ·è¿›è¡Œæ•°æ®äº¤æ¢ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´éƒ¨åˆ†ç»“æœã€‚\nä¸‹é¢çš„ä¾‹å­æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ CombineGroup å˜æ¢æ¥å®ç°å¦ä¸€ç§ WordCountã€‚\nval input: DataSet[String] = [..] // The words received as input  val combinedWords: DataSet[(String, Int)] = input .groupBy(0) .combineGroup { (words, out: Collector[(String, Int)]) =\u0026gt; var key: String = null var count = 0 for (word \u0026lt;- words) { key = word count += 1 } out.collect((key, count)) } val output: DataSet[(String, Int)] = combinedWords .groupBy(0) .reduceGroup { (words, out: Collector[(String, Int)]) =\u0026gt; var key: String = null var sum = 0 for ((word, sum) \u0026lt;- words) { key = word sum += count } out.collect((key, sum)) } ä¸Šé¢çš„å¦ä¸€ç§ WordCount å®ç°æ¼”ç¤ºäº† GroupCombine å¦‚ä½•åœ¨æ‰§è¡Œ GroupReduce è½¬æ¢ä¹‹å‰ç»„åˆå•è¯ã€‚ä¸Šé¢çš„ä¾‹å­åªæ˜¯ä¸€ä¸ªæ¦‚å¿µè¯æ˜ã€‚è¯·æ³¨æ„ï¼Œç»„åˆæ­¥éª¤å¦‚ä½•æ”¹å˜ DataSet çš„ç±»å‹ï¼Œé€šå¸¸åœ¨æ‰§è¡Œ GroupReduce ä¹‹å‰éœ€è¦è¿›è¡Œé¢å¤–çš„ Map è½¬æ¢ã€‚\nåœ¨åˆ†ç»„å…ƒç»„æ•°æ®é›†ä¸Šè¿›è¡Œèšåˆ æœ‰ä¸€äº›å¸¸ç”¨çš„èšåˆæ“ä½œæ˜¯ç»å¸¸ä½¿ç”¨çš„ã€‚Aggregate è½¬æ¢æä¾›äº†ä»¥ä¸‹å†…ç½®çš„èšåˆå‡½æ•°ã€‚\n Sum, Min, Max.  Aggregate å˜æ¢åªèƒ½åº”ç”¨åœ¨ Tuple æ•°æ®é›†ä¸Šï¼Œå¹¶ä¸”åªæ”¯æŒå­—æ®µä½ç½®é”®è¿›è¡Œåˆ†ç»„ã€‚\nä¸‹é¢çš„ä»£ç æ˜¾ç¤ºäº†å¦‚ä½•åœ¨æŒ‰å­—æ®µä½ç½®é”®åˆ†ç»„çš„æ•°æ®é›†ä¸Šåº”ç”¨\u0026quot;èšåˆ\u0026quot;å˜æ¢ã€‚\nval input: DataSet[(Int, String, Double)] = // [...] val output = input.groupBy(1).aggregate(SUM, 0).and(MIN, 2) è¦åœ¨ä¸€ä¸ª DataSet ä¸Šåº”ç”¨å¤šä¸ªèšåˆï¼Œå¿…é¡»åœ¨ç¬¬ä¸€ä¸ªèšåˆä¹‹åä½¿ç”¨ .and() å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ .aggregary(SUM, 0).and(MIN, 2) ä¼šäº§ç”ŸåŸå§‹ DataSet çš„å­—æ®µ 0 å’Œå­—æ®µ 2 çš„æœ€å°å€¼ä¹‹å’Œã€‚ä¸æ­¤ç›¸åï¼Œ.aggregary(SUMï¼Œ0).aggregary(MINï¼Œ2) å°†åœ¨ä¸€ä¸ªèšåˆä¸Šåº”ç”¨ä¸€ä¸ªèšåˆã€‚åœ¨ç»™å®šçš„ç¤ºä¾‹ä¸­ï¼Œå®ƒå°†åœ¨è®¡ç®—å­—æ®µ 0 ä¸å­—æ®µ 1 åˆ†ç»„åäº§ç”Ÿå­—æ®µ 2 çš„æœ€å°å€¼ã€‚\næ³¨æ„ï¼šèšåˆå‡½æ•°é›†å°†åœ¨æœªæ¥å¾—åˆ°æ‰©å±•ã€‚\nå¯¹åˆ†ç»„å…ƒç»„æ•°æ®é›†çš„ MinBy / MaxBy å‡½æ•° MinBy (MaxBy) è½¬æ¢ä¸ºæ¯ç»„å…ƒç»„é€‰æ‹©ä¸€ä¸ªå…ƒç»„ã€‚è¢«é€‰æ‹©çš„å…ƒç»„æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡å®šå­—æ®µçš„å€¼æ˜¯æœ€å°ï¼ˆæœ€å¤§ï¼‰çš„å…ƒç»„ã€‚ç”¨äºæ¯”è¾ƒçš„å­—æ®µå¿…é¡»æ˜¯æœ‰æ•ˆçš„å…³é”®å­—æ®µï¼Œå³å¯æ¯”è¾ƒçš„å­—æ®µã€‚å¦‚æœå¤šä¸ªå…ƒç»„å…·æœ‰æœ€å°ï¼ˆæœ€å¤§ï¼‰å­—æ®µå€¼ï¼Œåˆ™è¿”å›è¿™äº›å…ƒç»„çš„ä»»æ„å…ƒç»„ã€‚\nä¸‹é¢çš„ä»£ç æ˜¾ç¤ºäº†å¦‚ä½•ä» DataSet\u0026lt;Tuple3\u0026lt;Integer, String, Double\u0026gt;\u0026gt; ä¸­é€‰æ‹©å…·æœ‰ç›¸åŒ String å€¼çš„æ¯ç»„å…ƒç»„çš„ Integer å’Œ Double å­—æ®µæœ€å°å€¼çš„å…ƒç»„ã€‚\nval input: DataSet[(Int, String, Double)] = // [...] val output: DataSet[(Int, String, Double)] = input .groupBy(1) // group DataSet on second field  .minBy(0, 2) // select tuple with minimum values for first and third field. æ¢ç®—æ•´ä¸ªæ•°æ®é›† Reduce è½¬æ¢å°†ç”¨æˆ·å®šä¹‰çš„ reduce å‡½æ•°åº”ç”¨äºä¸€ä¸ªæ•°æ®é›†çš„æ‰€æœ‰å…ƒç´ ã€‚éšåï¼Œreduce å‡½æ•°å°†å…ƒç´ å¯¹ç»„åˆæˆä¸€ä¸ªå…ƒç´ ï¼Œç›´åˆ°åªå‰©ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚\nä¸‹é¢çš„ä»£ç æ˜¾ç¤ºäº†å¦‚ä½•å¯¹ä¸€ä¸ªæ•´æ•°æ•°æ®é›†çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œæ±‚å’Œã€‚\nval intNumbers = env.fromElements(1,2,3) val sum = intNumbers.reduce (_ + _) ä½¿ç”¨ Reduce è½¬æ¢æ¢ç®—ä¸€ä¸ªå®Œæ•´çš„ DataSet æ„å‘³ç€æœ€åçš„ Reduce æ“ä½œä¸èƒ½å¹¶è¡Œå®Œæˆã€‚ç„¶è€Œï¼Œreduce å‡½æ•°æ˜¯å¯ä»¥è‡ªåŠ¨ç»„åˆçš„ï¼Œå› æ­¤ Reduce è½¬æ¢ä¸ä¼šé™åˆ¶å¤§å¤šæ•°ç”¨ä¾‹çš„å¯æ‰©å±•æ€§ã€‚\nå¯¹æ•´ä¸ªæ•°æ®é›†è¿›è¡Œåˆ†ç»„æ¢ç®— GroupReduce è½¬æ¢å°†ç”¨æˆ·å®šä¹‰çš„ group-reduce å‡½æ•°åº”ç”¨äº DataSet çš„æ‰€æœ‰å…ƒç´ ã€‚group-reduce å¯ä»¥éå† DataSet çš„æ‰€æœ‰å…ƒç´ ï¼Œå¹¶è¿”å›ä»»æ„æ•°é‡çš„ç»“æœå…ƒç´ ã€‚\nä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨ä¸€ä¸ªå®Œæ•´çš„ DataSet ä¸Šåº”ç”¨ GroupReduce è½¬æ¢ã€‚\nval input: DataSet[Int] = // [...] val output = input.reduceGroup(new MyGroupReducer()) æ³¨æ„ï¼šå¦‚æœ group-reduce å‡½æ•°ä¸å¯ç»„åˆï¼Œé‚£ä¹ˆåœ¨ä¸€ä¸ªå®Œæ•´çš„ DataSet ä¸Šçš„ GroupReduce è½¬æ¢ä¸èƒ½å¹¶è¡Œå®Œæˆã€‚å› æ­¤ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªéå¸¸è€—è´¹è®¡ç®—çš„æ“ä½œã€‚è¯·å‚é˜…ä¸Šé¢çš„\u0026quot;å¯ç»„åˆçš„ GroupReduceFunctions\u0026quot; éƒ¨åˆ†ï¼Œäº†è§£å¦‚ä½•å®ç°å¯ç»„åˆçš„ group-reduce å‡½æ•°ã€‚\nåœ¨å®Œæ•´çš„æ•°æ®é›†ä¸Šè¿›è¡Œåˆ†ç»„åˆå¹¶(GroupCombine) åœ¨ä¸€ä¸ªå®Œæ•´çš„ DataSet ä¸Šçš„ GroupCombine çš„å·¥ä½œåŸç†ç±»ä¼¼äºåœ¨ä¸€ä¸ªåˆ†ç»„çš„ DataSet ä¸Šçš„ GroupCombineã€‚åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šå¯¹æ•°æ®è¿›è¡Œåˆ†åŒºï¼Œç„¶åä»¥è´ªå©ªçš„æ–¹å¼è¿›è¡Œåˆå¹¶ï¼ˆå³åªæœ‰é€‚åˆå†…å­˜çš„æ•°æ®æ‰ä¼šä¸€æ¬¡æ€§åˆå¹¶ï¼‰ã€‚\nåœ¨å®Œæ•´çš„ Tuple æ•°æ®é›†ä¸Šè¿›è¡Œèšåˆ æœ‰ä¸€äº›å¸¸ç”¨çš„èšåˆæ“ä½œæ˜¯ç»å¸¸ä½¿ç”¨çš„ã€‚Aggregate è½¬æ¢æä¾›äº†ä»¥ä¸‹å†…ç½®çš„èšåˆå‡½æ•°ã€‚\n Sum, Min, å’Œ Max.  Aggregate å˜æ¢åªèƒ½åº”ç”¨äº Tuple æ•°æ®é›†ã€‚\nä¸‹é¢çš„ä»£ç æ˜¾ç¤ºäº†å¦‚ä½•åœ¨ä¸€ä¸ªå®Œæ•´çš„æ•°æ®é›†ä¸Šåº”ç”¨èšåˆè½¬æ¢ã€‚\nval input: DataSet[(Int, String, Double)] = // [...] val output = input.aggregate(SUM, 0).and(MIN, 2) æ³¨æ„ï¼šæ‰©å±•æ”¯æŒçš„èšåˆå‡½æ•°é›†æ˜¯æˆ‘ä»¬çš„è·¯çº¿å›¾ã€‚\nåœ¨å®Œæ•´çš„å…ƒç»„æ•°æ®é›†ä¸Šå®ç° MinBy / MaxBy MinBy (MaxBy) è½¬æ¢ä»ä¸€ä¸ªå…ƒç»„æ•°æ®é›†ä¸­é€‰æ‹©ä¸€ä¸ªå…ƒç»„ã€‚è¢«é€‰æ‹©çš„å…ƒç»„æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡å®šå­—æ®µçš„å€¼æ˜¯æœ€å°ï¼ˆæœ€å¤§ï¼‰çš„å…ƒç»„ã€‚ç”¨äºæ¯”è¾ƒçš„å­—æ®µå¿…é¡»æ˜¯æœ‰æ•ˆçš„é”®å­—æ®µï¼Œå³å¯æ¯”è¾ƒçš„å­—æ®µã€‚å¦‚æœå¤šä¸ªå…ƒç»„å…·æœ‰æœ€å°ï¼ˆæœ€å¤§ï¼‰å­—æ®µå€¼ï¼Œåˆ™è¿”å›è¿™äº›å…ƒç»„çš„ä»»æ„å…ƒç»„ã€‚\nä»¥ä¸‹ä»£ç æ˜¾ç¤ºäº†å¦‚ä½•ä» DataSet\u0026lt;Tuple3\u0026lt;Integer, String, Double\u0026gt;\u0026gt; ä¸­é€‰æ‹©å…·æœ‰ Integer å’Œ Double å­—æ®µæœ€å¤§å€¼çš„å…ƒç»„ã€‚\nval input: DataSet[(Int, String, Double)] = // [...] val output: DataSet[(Int, String, Double)] = input .maxBy(0, 2) // select tuple with maximum values for first and third field. Distinct Distinct è½¬æ¢è®¡ç®—æº DataSet ä¸­ä¸åŒå…ƒç´ çš„ DataSetã€‚ä¸‹é¢çš„ä»£ç ä» DataSet ä¸­åˆ é™¤æ‰€æœ‰é‡å¤çš„å…ƒç´ ã€‚\nval input: DataSet[(Int, String, Double)] = // [...] val output = input.distinct() ä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ”¹å˜ DataSet ä¸­å…ƒç´ çš„åŒºåˆ†æ–¹å¼ã€‚\n ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µä½ç½®é”®ï¼ˆä»…å…ƒç»„æ•°æ®é›†ï¼‰ã€‚ ä¸€ä¸ªé”®é€‰æ‹©å™¨å‡½æ•°ï¼Œæˆ– ä¸€ä¸ªé”®è¡¨è¾¾å¼  ç”¨å­—æ®µä½ç½®é”®å»é‡(Distinct) val input: DataSet[(Int, Double, String)] = // [...] val output = input.distinct(0,2) ç”¨ KeySelector å‡½æ•°å»é‡(Distinct) val input: DataSet[Int] = // [...] val output = input.distinct {x =\u0026gt; Math.abs(x)} ç”¨é”®è¡¨è¾¾å¼å»é‡(Distinct) // some ordinary POJO case class CustomType(aName : String, aNumber : Int) { } val input: DataSet[CustomType] = // [...] val output = input.distinct(\u0026#34;aName\u0026#34;, \u0026#34;aNumber\u0026#34;) ä¹Ÿå¯ä»¥ç”¨é€šé…ç¬¦è¡¨ç¤ºä½¿ç”¨æ‰€æœ‰å­—æ®µ:\n// some ordinary POJO val input: DataSet[CustomType] = // [...] val output = input.distinct(\u0026#34;_\u0026#34;) Join Join è½¬æ¢å°†ä¸¤ä¸ª DataSets è¿æ¥æˆä¸€ä¸ª DataSetã€‚ä¸¤ä¸ªæ•°æ®é›†çš„å…ƒç´ åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªé”®ä¸Šè¿›è¡Œè¿æ¥(join)ï¼Œè¿™äº›é”®å¯ä»¥é€šè¿‡ä½¿ç”¨\n é”®é€‰æ‹©å™¨å‡½æ•° ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µä½ç½®é”®ï¼ˆä»…é™ Tuple DataSetï¼‰ã€‚ case ç±»å­—æ®µ  æœ‰å‡ ç§ä¸åŒçš„æ–¹æ³•æ¥æ‰§è¡Œ Join è½¬æ¢ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚\né»˜è®¤çš„ Join (Join into Tuple2) é»˜è®¤çš„ Join å˜æ¢ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ Tuple DataSetï¼Œå®ƒæœ‰ä¸¤ä¸ªå­—æ®µã€‚æ¯ä¸ªå…ƒç»„åœ¨ç¬¬ä¸€ä¸ªå…ƒç»„å­—æ®µä¸­æŒæœ‰ç¬¬ä¸€ä¸ªè¾“å…¥ DataSet çš„ join å…ƒç´ ï¼Œåœ¨ç¬¬äºŒä¸ªå­—æ®µä¸­æŒæœ‰ç¬¬äºŒä¸ªè¾“å…¥ DataSet çš„åŒ¹é…å…ƒç´ ã€‚\nä¸‹é¢çš„ä»£ç æ˜¾ç¤ºäº†ä¸€ä¸ªä½¿ç”¨å­—æ®µä½ç½®é”®çš„é»˜è®¤ Join è½¬æ¢ã€‚\nval input1: DataSet[(Int, String)] = // [...] val input2: DataSet[(Double, Int)] = // [...] val result = input1.join(input2).where(0).equalTo(1) ç”¨ Join å‡½æ•°è¿æ¥ Join è½¬æ¢ä¹Ÿå¯ä»¥è°ƒç”¨ç”¨æˆ·å®šä¹‰çš„ join å‡½æ•°æ¥å¤„ç†è¿æ¥(joining)å…ƒç»„ã€‚join å‡½æ•°æ¥æ”¶ç¬¬ä¸€ä¸ªè¾“å…¥ DataSet çš„ä¸€ä¸ªå…ƒç´ å’Œç¬¬äºŒä¸ªè¾“å…¥ DataSet çš„ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶å‡†ç¡®è¿”å›ä¸€ä¸ªå…ƒç´ ã€‚\nä¸‹é¢çš„ä»£ç ä½¿ç”¨é”®é€‰æ‹©å™¨å‡½æ•°æ‰§è¡Œäº†ä¸€ä¸ªå¸¦æœ‰è‡ªå®šä¹‰ java å¯¹è±¡çš„ DataSet å’Œä¸€ä¸ª Tuple DataSet çš„è¿æ¥ï¼Œå¹¶å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ç”¨æˆ·å®šä¹‰çš„è¿æ¥(join)å‡½æ•°ã€‚\ncase class Rating(name: String, category: String, points: Int) val ratings: DataSet[Ratings] = // [...] val weights: DataSet[(String, Double)] = // [...]  val weightedRatings = ratings.join(weights).where(\u0026#34;category\u0026#34;).equalTo(0) { (rating, weight) =\u0026gt; (rating.name, rating.points * weight._2) } ç”¨ Flat-Join å‡½æ•°è¿æ¥ ç±»ä¼¼äº Map å’Œ FlatMapï¼ŒFlatJoin çš„è¡Œä¸ºæ–¹å¼ä¸ Join ç›¸åŒï¼Œä½†å®ƒä¸æ˜¯è¿”å›ä¸€ä¸ªå…ƒç´ ï¼Œè€Œæ˜¯å¯ä»¥è¿”å›ï¼ˆæ”¶é›†ï¼‰ã€é›¶ä¸ªã€ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ã€‚\ncase class Rating(name: String, category: String, points: Int) val ratings: DataSet[Ratings] = // [...] val weights: DataSet[(String, Double)] = // [...]  val weightedRatings = ratings.join(weights).where(\u0026#34;category\u0026#34;).equalTo(0) { (rating, weight, out: Collector[(String, Double)]) =\u0026gt; if (weight._2 \u0026gt; 0.1) out.collect(rating.name, rating.points * weight._2) } ç”¨ Projection (Java Only) è¿æ¥ Join å˜æ¢å¯ä»¥ä½¿ç”¨æŠ•å½±(projection)æ„é€ ç»“æœå…ƒç»„ï¼Œå¦‚ä¸‹æ‰€ç¤º:\nDataSet\u0026lt;Tuple3\u0026lt;Integer, Byte, String\u0026gt;\u0026gt; input1 = // [...] DataSet\u0026lt;Tuple2\u0026lt;Integer, Double\u0026gt;\u0026gt; input2 = // [...] DataSet\u0026lt;Tuple4\u0026lt;Integer, String, Double, Byte\u0026gt;\u0026gt; result = input1.join(input2) // key definition on first DataSet using a field position key  .where(0) // key definition of second DataSet using a field position key  .equalTo(0) // select and reorder fields of matching tuples  .projectFirst(0,2).projectSecond(1).projectFirst(1); // scala Not supported. ç”¨æ•°æ®é›†å¤§å°æç¤º Join ä¸ºäº†å¼•å¯¼ä¼˜åŒ–å™¨é€‰æ‹©æ­£ç¡®çš„æ‰§è¡Œç­–ç•¥ï¼Œä½ å¯ä»¥æç¤ºè¦è¿æ¥(join)çš„ DataSet çš„å¤§å°ï¼Œå¦‚ä¸‹æ‰€ç¤º:\nval input1: DataSet[(Int, String)] = // [...] val input2: DataSet[(Int, String)] = // [...]  // hint that the second DataSet is very small val result1 = input1.joinWithTiny(input2).where(0).equalTo(0) // hint that the second DataSet is very large val result1 = input1.joinWithHuge(input2).where(0).equalTo(0) Join ç®—æ³•æç¤º Flink è¿è¡Œæ—¶å¯ä»¥ä»¥å„ç§æ–¹å¼æ‰§è¡Œè¿æ¥(join)ã€‚æ¯ä¸€ç§å¯èƒ½çš„æ–¹å¼åœ¨ä¸åŒçš„æƒ…å†µä¸‹éƒ½ä¼šä¼˜äºå…¶ä»–æ–¹å¼ã€‚ç³»ç»Ÿä¼šå°è¯•è‡ªåŠ¨é€‰æ‹©ä¸€ç§åˆç†çš„æ–¹å¼ï¼Œä½†ä¹Ÿå…è®¸ä½ æ‰‹åŠ¨é€‰æ‹©ä¸€ç§ç­–ç•¥ï¼Œä»¥é˜²ä½ æƒ³å¼ºåˆ¶æ‰§è¡Œç‰¹å®šçš„è¿æ¥(join)æ–¹å¼ã€‚\nval input1: DataSet[SomeType] = // [...] val input2: DataSet[AnotherType] = // [...]  // hint that the second DataSet is very small val result1 = input1.join(input2, JoinHint.BROADCAST_HASH_FIRST).where(\u0026#34;id\u0026#34;).equalTo(\u0026#34;key\u0026#34;) æœ‰ä»¥ä¸‹æç¤º:\n  OPTIMIZER_CHOOSES: ç›¸å½“äºå®Œå…¨ä¸ç»™æç¤ºï¼Œè®©ç³»ç»Ÿæ¥é€‰æ‹©ã€‚\n  BROADCAST_HASH_FIRSTï¼šå¹¿æ’­ç¬¬ä¸€ä¸ªè¾“å…¥ï¼Œå¹¶æ®æ­¤å»ºç«‹ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œç”±ç¬¬äºŒä¸ªè¾“å…¥æ¢æµ‹ã€‚å¦‚æœç¬¬ä¸€ä¸ªè¾“å…¥çš„æ•°æ®éå¸¸å°ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç­–ç•¥ã€‚\n  BROADCAST_HASH_SECOND: å¹¿æ’­ç¬¬äºŒä¸ªè¾“å…¥ï¼Œå¹¶ä»ä¸­å»ºç«‹ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œç”±ç¬¬ä¸€ä¸ªè¾“å…¥æ¢æµ‹ã€‚å¦‚æœç¬¬äºŒä¸ªè¾“å…¥éå¸¸å°ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç­–ç•¥ã€‚\n  REPARTITION_HASH_FIRSTï¼šç³»ç»Ÿå¯¹æ¯ä¸ªè¾“å…¥è¿›è¡Œåˆ†åŒºï¼ˆæ´—ç‰Œï¼‰ï¼ˆé™¤éè¾“å…¥å·²ç»è¢«åˆ†åŒºï¼‰ï¼Œå¹¶ä»ç¬¬ä¸€ä¸ªè¾“å…¥å»ºç«‹ä¸€ä¸ªå“ˆå¸Œè¡¨ã€‚å¦‚æœç¬¬ä¸€ä¸ªè¾“å…¥æ¯”ç¬¬äºŒä¸ªè¾“å…¥å°ï¼Œä½†ä¸¤ä¸ªè¾“å…¥éƒ½å¾ˆå¤§ï¼Œè¿™ä¸ªç­–ç•¥å°±å¾ˆå¥½ã€‚æ³¨æ„ï¼šå¦‚æœæ— æ³•ä¼°è®¡å¤§å°ï¼Œä¹Ÿæ— æ³•é‡æ–°ä½¿ç”¨å·²æœ‰çš„åˆ†åŒºå’Œæ’åºï¼Œç³»ç»Ÿå°±ä¼šä½¿ç”¨è¿™ä¸ªé»˜è®¤çš„åå¤‡ç­–ç•¥ã€‚\n  REPARTITION_HASH_SECONDï¼šç³»ç»Ÿå¯¹æ¯ä¸ªè¾“å…¥è¿›è¡Œåˆ†åŒºï¼ˆæ´—ç‰Œï¼‰ï¼ˆé™¤éè¾“å…¥å·²ç»è¢«åˆ†åŒºï¼‰ï¼Œå¹¶ä»ç¬¬äºŒä¸ªè¾“å…¥å»ºç«‹ä¸€ä¸ªå“ˆå¸Œè¡¨ã€‚å¦‚æœç¬¬äºŒä¸ªè¾“å…¥æ¯”ç¬¬ä¸€ä¸ªè¾“å…¥å°ï¼Œä½†ä¸¤ä¸ªè¾“å…¥ä»ç„¶å¾ˆå¤§ï¼Œè¿™ä¸ªç­–ç•¥å°±å¾ˆå¥½ã€‚\n  REPARTITION_SORT_MERGEï¼šç³»ç»Ÿå¯¹æ¯ä¸ªè¾“å…¥è¿›è¡Œåˆ†åŒºï¼ˆæ´—ç‰Œï¼‰ï¼ˆé™¤éè¾“å…¥å·²ç»åˆ†åŒºï¼‰ï¼Œå¹¶å¯¹æ¯ä¸ªè¾“å…¥è¿›è¡Œæ’åºï¼ˆé™¤éå·²ç»æ’åºï¼‰ã€‚é€šè¿‡å¯¹æ’åºåçš„è¾“å…¥è¿›è¡Œæµå¼åˆå¹¶æ¥è¿æ¥(join)è¿™äº›è¾“å…¥ã€‚å¦‚æœä¸€ä¸ªæˆ–ä¸¤ä¸ªè¾“å…¥éƒ½å·²ç»è¢«æ’åºï¼Œè¿™ä¸ªç­–ç•¥å°±å¾ˆå¥½ã€‚\n  å¤–è¿æ¥ OuterJoin è½¬æ¢åœ¨ä¸¤ä¸ªæ•°æ®é›†ä¸Šæ‰§è¡Œå·¦ã€å³æˆ–å…¨å¤–è¿æ¥ã€‚å¤–è¿æ¥ä¸å¸¸è§„ï¼ˆå†…è¿æ¥ï¼‰ç±»ä¼¼ï¼Œåˆ›å»ºæ‰€æœ‰é”®å€¼ç›¸ç­‰çš„å…ƒç´ å¯¹ã€‚æ­¤å¤–ï¼Œå¦‚æœåœ¨å¦ä¸€ä¾§æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„é”®ï¼Œ\u0026ldquo;å¤–ä¾§\u0026quot;çš„è®°å½•ï¼ˆå·¦ã€å³ï¼Œæˆ–è€…åœ¨å®Œå…¨çš„æƒ…å†µä¸‹ä¸¤è€…éƒ½æœ‰ï¼‰å°†è¢«ä¿ç•™ã€‚åŒ¹é…çš„ä¸€å¯¹å…ƒç´ ï¼ˆæˆ–ä¸€ä¸ªå…ƒç´ å’Œå¦ä¸€ä¸ªè¾“å…¥çš„ç©ºå€¼ï¼‰è¢«äº¤ç»™ JoinFunction å°†è¿™å¯¹å…ƒç´ å˜æˆä¸€ä¸ªå…ƒç´ ï¼Œæˆ–äº¤ç»™ FlatJoinFunction å°†è¿™å¯¹å…ƒç´ å˜æˆä»»æ„å¤šä¸ªï¼ˆåŒ…æ‹¬æ— ï¼‰å…ƒç´ ã€‚\nä¸¤ä¸ª DataSets çš„å…ƒç´ éƒ½æ˜¯åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªé”®ä¸Šè¿æ¥çš„ï¼Œè¿™äº›é”®å¯ä»¥é€šè¿‡ä½¿ç”¨\n é”®é€‰æ‹©å™¨å‡½æ•° ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µä½ç½®é”®ï¼ˆä»…é™ Tuple DataSetï¼‰ã€‚ case ç±»å­—æ®µ  OuterJoins åªæ”¯æŒ Java å’Œ Scala DataSet APIã€‚\nç”¨ Join å‡½æ•°è¿›è¡Œå¤–è¿æ¥ OuterJoin è½¬æ¢è°ƒç”¨ä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„ join å‡½æ•°æ¥å¤„ç†è¿æ¥å…ƒç»„ã€‚join å‡½æ•°æ¥æ”¶ç¬¬ä¸€ä¸ªè¾“å…¥ DataSet çš„ä¸€ä¸ªå…ƒç´ å’Œç¬¬äºŒä¸ªè¾“å…¥ DataSet çš„ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶å‡†ç¡®åœ°è¿”å›ä¸€ä¸ªå…ƒç´ ã€‚æ ¹æ®å¤–è¿æ¥çš„ç±»å‹ï¼ˆå·¦ã€å³ã€å…¨ï¼‰ï¼Œè¿æ¥å‡½æ•°çš„ä¸¤ä¸ªè¾“å…¥å…ƒç´ ä¸­å¯ä»¥æœ‰ä¸€ä¸ªæ˜¯ç©ºçš„ã€‚\nä¸‹é¢çš„ä»£ç ä½¿ç”¨é”®é€‰æ‹©å™¨å‡½æ•°æ‰§è¡Œ DataSet ä¸è‡ªå®šä¹‰ java å¯¹è±¡å’Œ Tuple DataSet çš„å·¦å¤–è¿æ¥ï¼Œå¹¶å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ç”¨æˆ·å®šä¹‰çš„è¿æ¥å‡½æ•°ã€‚\ncase class Rating(name: String, category: String, points: Int) val movies: DataSet[(String, String)] = // [...] val ratings: DataSet[Ratings] = // [...]  val moviesWithPoints = movies.leftOuterJoin(ratings).where(0).equalTo(\u0026#34;name\u0026#34;) { (movie, rating) =\u0026gt; (movie._1, if (rating == null) -1 else rating.points) } ä½¿ç”¨ Flat-Join å‡½æ•°è¿›è¡Œå¤–è¿æ¥ ç±»ä¼¼äº Map å’Œ FlatMapï¼Œä¸€ä¸ªå¸¦æœ‰ flat-join å‡½æ•°çš„ OuterJoin çš„è¡Œä¸ºä¸å¸¦æœ‰ join å‡½æ•°çš„ OuterJoin ç›¸åŒï¼Œä½†å®ƒä¸æ˜¯è¿”å›ä¸€ä¸ªå…ƒç´ ï¼Œè€Œæ˜¯å¯ä»¥è¿”å›ï¼ˆæ”¶é›†ï¼‰ã€é›¶ä¸ªã€ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ã€‚\nNot supported. Join ç®—æ³•æç¤º Flink è¿è¡Œæ—¶å¯ä»¥ä»¥å„ç§æ–¹å¼æ‰§è¡Œå¤–è¿æ¥ã€‚æ¯ä¸€ç§å¯èƒ½çš„æ–¹å¼åœ¨ä¸åŒçš„æƒ…å†µä¸‹éƒ½ä¼šä¼˜äºå…¶ä»–æ–¹å¼ã€‚ç³»ç»Ÿè¯•å›¾è‡ªåŠ¨é€‰æ‹©ä¸€ç§åˆç†çš„æ–¹å¼ï¼Œä½†å…è®¸ä½ æ‰‹åŠ¨é€‰æ‹©ä¸€ç§ç­–ç•¥ï¼Œä»¥é˜²ä½ æƒ³å¼ºåˆ¶æ‰§è¡Œç‰¹å®šçš„å¤–è¿æ¥æ–¹å¼ã€‚\nval input1: DataSet[SomeType] = // [...] val input2: DataSet[AnotherType] = // [...]  // hint that the second DataSet is very small val result1 = input1.leftOuterJoin(input2, JoinHint.REPARTITION_SORT_MERGE).where(\u0026#34;id\u0026#34;).equalTo(\u0026#34;key\u0026#34;) val result2 = input1.rightOuterJoin(input2, JoinHint.BROADCAST_HASH_FIRST).where(\u0026#34;id\u0026#34;).equalTo(\u0026#34;key\u0026#34;) æœ‰ä»¥ä¸‹æç¤º:\n  OPTIMIZER_CHOOSES: ç›¸å½“äºå®Œå…¨ä¸ç»™æç¤ºï¼Œè®©ç³»ç»Ÿæ¥é€‰æ‹©ã€‚\n  BROADCAST_HASH_FIRSTï¼šå¹¿æ’­ç¬¬ä¸€ä¸ªè¾“å…¥ï¼Œå¹¶æ®æ­¤å»ºç«‹ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œç”±ç¬¬äºŒä¸ªè¾“å…¥æ¢æµ‹ã€‚å¦‚æœç¬¬ä¸€ä¸ªè¾“å…¥çš„æ•°æ®éå¸¸å°ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç­–ç•¥ã€‚\n  BROADCAST_HASH_SECOND: å¹¿æ’­ç¬¬äºŒä¸ªè¾“å…¥ï¼Œå¹¶ä»ä¸­å»ºç«‹ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œç”±ç¬¬ä¸€ä¸ªè¾“å…¥æ¢æµ‹ã€‚å¦‚æœç¬¬äºŒä¸ªè¾“å…¥éå¸¸å°ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç­–ç•¥ã€‚\n  REPARTITION_HASH_FIRSTï¼šç³»ç»Ÿå¯¹æ¯ä¸ªè¾“å…¥è¿›è¡Œåˆ†åŒºï¼ˆæ´—ç‰Œï¼‰ï¼ˆé™¤éè¾“å…¥å·²ç»è¢«åˆ†åŒºï¼‰ï¼Œå¹¶ä»ç¬¬ä¸€ä¸ªè¾“å…¥å»ºç«‹ä¸€ä¸ªå“ˆå¸Œè¡¨ã€‚å¦‚æœç¬¬ä¸€ä¸ªè¾“å…¥æ¯”ç¬¬äºŒä¸ªè¾“å…¥å°ï¼Œä½†ä¸¤ä¸ªè¾“å…¥ä»ç„¶å¾ˆå¤§ï¼Œè¿™ä¸ªç­–ç•¥å°±å¾ˆå¥½ã€‚\n  REPARTITION_HASH_SECONDï¼šç³»ç»Ÿå¯¹æ¯ä¸ªè¾“å…¥è¿›è¡Œåˆ†åŒºï¼ˆæ´—ç‰Œï¼‰ï¼ˆé™¤éè¾“å…¥å·²ç»è¢«åˆ†åŒºï¼‰ï¼Œå¹¶ä»ç¬¬äºŒä¸ªè¾“å…¥å»ºç«‹ä¸€ä¸ªå“ˆå¸Œè¡¨ã€‚å¦‚æœç¬¬äºŒä¸ªè¾“å…¥æ¯”ç¬¬ä¸€ä¸ªè¾“å…¥å°ï¼Œä½†ä¸¤ä¸ªè¾“å…¥ä»ç„¶å¾ˆå¤§ï¼Œè¿™ä¸ªç­–ç•¥å°±å¾ˆå¥½ã€‚\n  REPARTITION_SORT_MERGEï¼šç³»ç»Ÿå¯¹æ¯ä¸ªè¾“å…¥è¿›è¡Œåˆ†åŒºï¼ˆæ´—ç‰Œï¼‰ï¼ˆé™¤éè¾“å…¥å·²ç»åˆ†åŒºï¼‰ï¼Œå¹¶å¯¹æ¯ä¸ªè¾“å…¥è¿›è¡Œæ’åºï¼ˆé™¤éå·²ç»æ’åºï¼‰ã€‚é€šè¿‡å¯¹æ’åºåçš„è¾“å…¥è¿›è¡Œæµå¼åˆå¹¶æ¥è¿æ¥(join)è¿™äº›è¾“å…¥ã€‚å¦‚æœä¸€ä¸ªæˆ–ä¸¤ä¸ªè¾“å…¥éƒ½å·²ç»è¢«æ’åºï¼Œè¿™ä¸ªç­–ç•¥å°±å¾ˆå¥½ã€‚\n  æ³¨æ„ï¼šç›®å‰è¿˜ä¸æ˜¯æ‰€æœ‰çš„å¤–è¿æ¥ç±»å‹éƒ½æ”¯æŒæ‰€æœ‰çš„æ‰§è¡Œç­–ç•¥ã€‚\n  LeftOuterJoin æ”¯æŒ:\n OPTIMIZER_CHOOSES BROADCAST_HASH_SECOND REPARTITION_HASH_SECOND REPARTITION_SORT_MERGE    RightOuterJoin æ”¯æŒ:\n OPTIMIZER_CHOOSES BROADCAST_HASH_FIRST REPARTITION_HASH_FIRST REPARTITION_SORT_MERGE    FullOuterJoin æ”¯æŒ:\n OPTIMIZER_CHOOSES REPARTITION_SORT_MERGE    Cross Cross å˜æ¢å°†ä¸¤ä¸ª DataSets ç»„åˆæˆä¸€ä¸ª DataSetã€‚å®ƒå»ºç«‹äº†ä¸¤ä¸ªè¾“å…¥æ•°æ®é›†å…ƒç´ çš„æ‰€æœ‰ pairwise ç»„åˆï¼Œå³å»ºç«‹äº†ä¸€ä¸ªç¬›å¡å°”ç§¯ã€‚Cross å˜æ¢è¦ä¹ˆåœ¨æ¯å¯¹å…ƒç´ ä¸Šè°ƒç”¨ç”¨æˆ·å®šä¹‰çš„ cross å‡½æ•°ï¼Œè¦ä¹ˆè¾“å‡ºä¸€ä¸ª Tuple2ã€‚è¿™ä¸¤ç§æ¨¡å¼å¦‚ä¸‹æ‰€ç¤ºã€‚\næ³¨æ„ï¼šCross æ˜¯ä¸€ä¸ªæ½œåœ¨çš„è®¡ç®—å¯†é›†å‹æ“ä½œï¼Œç”šè‡³å¯ä»¥æŒ‘æˆ˜å¤§å‹è®¡ç®—é›†ç¾¤ã€‚\nä½¿ç”¨ç”¨æˆ·å®šä¹‰å‡½æ•°è¿›è¡Œäº¤å‰è¿ç®— Cross å˜æ¢å¯ä»¥è°ƒç”¨ä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„ cross å‡½æ•°ã€‚cross å‡½æ•°æ¥æ”¶ç¬¬ä¸€ä¸ªè¾“å…¥çš„ä¸€ä¸ªå…ƒç´ å’Œç¬¬äºŒä¸ªè¾“å…¥çš„ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶æ­£å¥½è¿”å›ä¸€ä¸ªç»“æœå…ƒç´ ã€‚\nä¸‹é¢çš„ä»£ç å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ cross å‡½æ•°å¯¹ä¸¤ä¸ª DataSets è¿›è¡Œäº¤å‰å˜æ¢ã€‚\ncase class Coord(id: Int, x: Int, y: Int) val coords1: DataSet[Coord] = // [...] val coords2: DataSet[Coord] = // [...]  val distances = coords1.cross(coords2) { (c1, c2) =\u0026gt; val dist = sqrt(pow(c1.x - c2.x, 2) + pow(c1.y - c2.y, 2)) (c1.id, c2.id, dist) } ç”¨æ•°æ®é›†å¤§å°æç¤ºäº¤å‰ ä¸ºäº†å¼•å¯¼ä¼˜åŒ–å™¨é€‰æ‹©æ­£ç¡®çš„æ‰§è¡Œç­–ç•¥ï¼Œä½ å¯ä»¥æç¤ºè¦äº¤å‰çš„ DataSet çš„å¤§å°ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚\nval input1: DataSet[(Int, String)] = // [...] val input2: DataSet[(Int, String)] = // [...]  // hint that the second DataSet is very small val result1 = input1.crossWithTiny(input2) // hint that the second DataSet is very large val result1 = input1.crossWithHuge(input2) CoGroup CoGroup è½¬æ¢è”åˆ(jointly)å¤„ç†ä¸¤ä¸ª DataSets çš„ç»„ã€‚ä¸¤ä¸ª DataSets æ ¹æ®å®šä¹‰çš„é”®è¿›è¡Œåˆ†ç»„ï¼Œå…±äº«åŒä¸€é”®çš„ä¸¤ä¸ª DataSets çš„ç»„è¢«ä¸€èµ·äº¤ç»™ç”¨æˆ·å®šä¹‰çš„å…±ç»„(co-group)å‡½æ•°ã€‚å¦‚æœå¯¹äºä¸€ä¸ªç‰¹å®šçš„é”®æ¥è¯´ï¼Œåªæœ‰ä¸€ä¸ª DataSet æœ‰ä¸€ä¸ªç»„ï¼Œé‚£ä¹ˆ co-group å‡½æ•°å°±ä¼šå’Œè¿™ä¸ªç»„ä»¥åŠä¸€ä¸ªç©ºç»„ä¸€èµ·è¢«è°ƒç”¨ã€‚å…±ç»„(co-group)å‡½æ•°å¯ä»¥åˆ†åˆ«è¿­ä»£ä¸¤ä¸ªç»„çš„å…ƒç´ ï¼Œå¹¶è¿”å›ä»»æ„æ•°é‡çš„ç»“æœå…ƒç´ ã€‚\nä¸ Reduceã€GroupReduce å’Œ Join ç±»ä¼¼ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„é”®é€‰æ‹©å™¨æ–¹æ³•æ¥å®šä¹‰é”®ã€‚\næ•°æ®é›†ä¸Šçš„ CoGroup val iVals: DataSet[(String, Int)] = // [...] val dVals: DataSet[(String, Double)] = // [...]  val output = iVals.coGroup(dVals).where(0).equalTo(0) { (iVals, dVals, out: Collector[Double]) =\u0026gt; val ints = iVals map { _._2 } toSet for (dVal \u0026lt;- dVals) { for (i \u0026lt;- ints) { out.collect(dVal._2 * i) } } } Union äº§ç”Ÿä¸¤ä¸ª DataSets çš„è”åˆ(union)ï¼Œè¿™ä¸¤ä¸ª DataSets å¿…é¡»æ˜¯åŒä¸€ç±»å‹ã€‚ä¸¤ä¸ªä»¥ä¸Š DataSets çš„è”åˆ(union)å¯ä»¥é€šè¿‡å¤šä¸ªè”åˆ(union)è°ƒç”¨æ¥å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚\nval vals1: DataSet[(String, Int)] = // [...] val vals2: DataSet[(String, Int)] = // [...] val vals3: DataSet[(String, Int)] = // [...]  val unioned = vals1.union(vals2).union(vals3) Rebalance å‡åŒ€åœ°é‡æ–°å¹³è¡¡ DataSet çš„å¹¶è¡Œåˆ†åŒºï¼Œä»¥æ¶ˆé™¤æ•°æ®å€¾æ–œã€‚\nval in: DataSet[String] = // [...] // rebalance DataSet and apply a Map transformation. val out = in.rebalance().map { ... } Hash-Partition åœ¨ç»™å®šçš„é”®ä¸Šå¯¹ DataSet è¿›è¡Œæ•£åˆ—åˆ†å‰²ã€‚é”®å¯ä»¥è¢«æŒ‡å®šä¸ºä½ç½®é”®ã€è¡¨è¾¾å¼é”®å’Œé”®é€‰æ‹©å™¨å‡½æ•°ï¼ˆå…³äºå¦‚ä½•æŒ‡å®šé”®ï¼Œè¯·å‚è§ Reduce ç¤ºä¾‹ï¼‰ã€‚\nval in: DataSet[(String, Int)] = // [...] // hash-partition DataSet by String value and apply a MapPartition transformation. val out = in.partitionByHash(0).mapPartition { ... } Range-Partition åœ¨ç»™å®šçš„é”®ä¸Š Range-partitions ä¸€ä¸ª DataSetã€‚é”®å¯ä»¥è¢«æŒ‡å®šä¸ºä½ç½®é”®ã€è¡¨è¾¾å¼é”®å’Œé”®é€‰æ‹©å™¨å‡½æ•°ï¼ˆå…³äºå¦‚ä½•æŒ‡å®šé”®ï¼Œè¯·å‚è§ Reduce ç¤ºä¾‹ï¼‰ã€‚\nval in: DataSet[(String, Int)] = // [...] // range-partition DataSet by String value and apply a MapPartition transformation. val out = in.partitionByRange(0).mapPartition { ... } Sort Partition æŒ‰ç…§æŒ‡å®šçš„é¡ºåºï¼Œåœ¨æŒ‡å®šçš„å­—æ®µä¸Šå¯¹ DataSet çš„æ‰€æœ‰åˆ†åŒºè¿›è¡Œæœ¬åœ°æ’åºã€‚å­—æ®µå¯ä»¥è¢«æŒ‡å®šä¸ºå­—æ®µè¡¨è¾¾å¼æˆ–å­—æ®µä½ç½®ï¼ˆå…³äºå¦‚ä½•æŒ‡å®šé”®ï¼Œè¯·å‚é˜… Reduce ç¤ºä¾‹ï¼‰ã€‚é€šè¿‡é“¾å¼ sortPartition() è°ƒç”¨ï¼Œå¯ä»¥åœ¨å¤šä¸ªå­—æ®µä¸Šå¯¹åˆ†åŒºè¿›è¡Œæ’åºã€‚\nval in: DataSet[(String, Int)] = // [...] // Locally sort partitions in ascending order on the second String field and // in descending order on the first String field. // Apply a MapPartition transformation on the sorted partitions. val out = in.sortPartition(1, Order.ASCENDING) .sortPartition(0, Order.DESCENDING) .mapPartition { ... } First-n è¿”å›ä¸€ä¸ª DataSet çš„å‰ n ä¸ªï¼ˆä»»æ„ï¼‰å…ƒç´ ã€‚First-n å¯ä»¥åº”ç”¨äºä¸€ä¸ªå¸¸è§„çš„ DataSetã€ä¸€ä¸ªåˆ†ç»„çš„ DataSet æˆ–ä¸€ä¸ªåˆ†ç»„æ’åºçš„ DataSetã€‚åˆ†ç»„é”®å¯ä»¥è¢«æŒ‡å®šä¸ºé”®é€‰æ‹©å™¨å‡½æ•°æˆ–å­—æ®µä½ç½®é”®ï¼ˆå…³äºå¦‚ä½•æŒ‡å®šé”®ï¼Œè¯·å‚è§ Reduce ç¤ºä¾‹ï¼‰ã€‚\nval in: DataSet[(String, Int)] = // [...] // Return the first five (arbitrary) elements of the DataSet val out1 = in.first(5) // Return the first two (arbitrary) elements of each String group val out2 = in.groupBy(0).first(2) // Return the first three elements of each String group ordered by the Integer field val out3 = in.groupBy(0).sortGroup(1, Order.ASCENDING).first(3) åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/batch/dataset_transformations.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-dataset-transformations/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataSet API"],"title":"Dataset å˜æ¢"},{"categories":["Flink"],"contents":"DROP è¯­å¥ DROP è¯­å¥ç”¨äºä»å½“å‰æˆ–æŒ‡å®šçš„ç›®å½•ä¸­åˆ é™¤ä¸€ä¸ªæ³¨å†Œçš„è¡¨/è§†å›¾/å‡½æ•°ã€‚\nFlink SQL ç›®å‰æ”¯æŒä»¥ä¸‹ DROP è¯­å¥ã€‚\n DROP TABLE DROP DATABASE DROP VIEW DROP FUNCTION  è¿è¡Œä¸€ä¸ª DROP è¯­å¥ DROP è¯­å¥å¯ä»¥ç”¨ TableEnvironment çš„ executeSql()æ–¹æ³•æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨ SQL CLI ä¸­æ‰§è¡Œã€‚executeSql()æ–¹æ³•å¯¹äºä¸€ä¸ªæˆåŠŸçš„ DROP æ“ä½œä¼šè¿”å›\u0026rsquo;OK'ï¼Œå¦åˆ™ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚\nä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨ TableEnvironment å’Œ SQL CLI ä¸­è¿è¡Œ DROP è¯­å¥ã€‚\nval settings = EnvironmentSettings.newInstance()... val tableEnv = TableEnvironment.create(settings) // register a table named \u0026#34;Orders\u0026#34; tableEnv.executeSql(\u0026#34;CREATE TABLE Orders (`user` BIGINT, product STRING, amount INT) WITH (...)\u0026#34;) // a string array: [\u0026#34;Orders\u0026#34;] val tables = tableEnv.listTables() // or tableEnv.executeSql(\u0026#34;SHOW TABLES\u0026#34;).print()  // drop \u0026#34;Orders\u0026#34; table from catalog tableEnv.executeSql(\u0026#34;DROP TABLE Orders\u0026#34;) // an empty string array val tables = tableEnv.listTables() // or tableEnv.executeSql(\u0026#34;SHOW TABLES\u0026#34;).print() DROP TABLE DROPTABLE[IFEXISTS][catalog_name.][db_name.]table_nameåˆ é™¤ä¸€ä¸ªç»™å®šè¡¨åçš„è¡¨ã€‚å¦‚æœè¦åˆ é™¤çš„è¡¨ä¸å­˜åœ¨ï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚\nIF EXISTS\nå¦‚æœè¯¥è¡¨ä¸å­˜åœ¨ï¼Œå°±ä¸ä¼šå‘ç”Ÿä»»ä½•äº‹æƒ…ã€‚\nDROP DATABASE DROPDATABASE[IFEXISTS][catalog_name.]db_name[(RESTRICT|CASCADE)]åˆ é™¤ä¸€ä¸ªç»™å®šæ•°æ®åº“åç§°çš„æ•°æ®åº“ï¼Œå¦‚æœè¦åˆ é™¤çš„æ•°æ®åº“ä¸å­˜åœ¨ï¼Œä¼šäº§ç”Ÿå¼‚å¸¸ã€‚å¦‚æœè¦åˆ é™¤çš„æ•°æ®åº“ä¸å­˜åœ¨ï¼Œåˆ™æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚\nIF EXISTS\nå¦‚æœæ•°æ®åº“ä¸å­˜åœ¨ï¼Œåˆ™ä¸ä¼šå‘ç”Ÿä»»ä½•äº‹æƒ…ã€‚\nRESTRICT\nä¸¢å¼ƒéç©ºæ•°æ®åº“ä¼šè§¦å‘å¼‚å¸¸ã€‚é»˜è®¤ä¸ºå¯ç”¨ã€‚\nCASCADE\nä¸¢å¼ƒä¸€ä¸ªéç©ºçš„æ•°æ®åº“ä¹Ÿä¼šä¸¢å¼ƒæ‰€æœ‰ç›¸å…³çš„è¡¨å’Œå‡½æ•°ã€‚\nDROP VIEW DROP[TEMPORARY]VIEW[IFEXISTS][catalog_name.][db_name.]view_nameä¸¢å¼ƒä¸€ä¸ªæœ‰ç›®å½•å’Œæ•°æ®åº“å‘½åç©ºé—´çš„è§†å›¾ã€‚å¦‚æœè¦åˆ é™¤çš„è§†å›¾ä¸å­˜åœ¨ï¼Œåˆ™ä¼šäº§ç”Ÿä¸€ä¸ªå¼‚å¸¸ã€‚\nTEMPORARY\nåˆ é™¤å…·æœ‰ç›®å½•å’Œæ•°æ®åº“å‘½åç©ºé—´çš„ä¸´æ—¶è§†å›¾ã€‚\nIF EXISTS\nå¦‚æœè§†å›¾ä¸å­˜åœ¨ï¼Œåˆ™ä¸ä¼šå‘ç”Ÿä»»ä½•äº‹æƒ…ã€‚\nç»´æŠ¤ä¾èµ–å…³ç³» Flink æ²¡æœ‰é€šè¿‡ CASCADE/RESTRICT å…³é”®å­—æ¥ç»´æŠ¤è§†å›¾çš„ä¾èµ–å…³ç³»ï¼Œå½“å‰çš„æ–¹å¼æ˜¯å½“ç”¨æˆ·è¯•å›¾åœ¨è¯¸å¦‚è§†å›¾çš„åº•å±‚è¡¨è¢«åˆ é™¤çš„æƒ…å†µä¸‹ä½¿ç”¨è§†å›¾æ—¶ï¼Œä¼šäº§ç”Ÿå»¶è¿Ÿé”™è¯¯æ¶ˆæ¯ã€‚\nDROP FUNCTION DROP[TEMPORARY|TEMPORARYSYSTEM]FUNCTION[IFEXISTS][catalog_name.][db_name.]function_name;åˆ é™¤ä¸€ä¸ªæœ‰ç›®å½•å’Œæ•°æ®åº“å‘½åç©ºé—´çš„ç›®å½•å‡½æ•°ã€‚å¦‚æœè¦æ”¾å¼ƒçš„å‡½æ•°ä¸å­˜åœ¨ï¼Œåˆ™ä¼šäº§ç”Ÿä¸€ä¸ªå¼‚å¸¸ã€‚\nTEMPORARY\nä¸¢å¼ƒå…·æœ‰ç›®å½•å’Œæ•°æ®åº“å‘½åç©ºé—´çš„ä¸´æ—¶ç›®å½•åŠŸèƒ½ã€‚\nTEMPORARY SYSTEM\nåˆ é™¤æ²¡æœ‰å‘½åç©ºé—´çš„ä¸´æ—¶ç³»ç»Ÿå‡½æ•°ã€‚\nIF EXISTS\nå¦‚æœå‡½æ•°ä¸å­˜åœ¨ï¼Œå°±ä¸ä¼šå‘ç”Ÿä»»ä½•äº‹æƒ…ã€‚\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/sql/drop.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-drop-statements/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL","SQL"],"title":"Drop è¯­å¥"},{"categories":["Flink"],"contents":"EXPLAIN è¯­å¥ EXPLAIN è¯­å¥ç”¨äºè§£é‡Šä¸€ä¸ªæŸ¥è¯¢æˆ– INSERT è¯­å¥çš„é€»è¾‘å’Œä¼˜åŒ–æŸ¥è¯¢è®¡åˆ’ã€‚\nè¿è¡Œ EXPLAIN è¯­å¥ EXPLAIN è¯­å¥å¯ä»¥ç”¨ TableEnvironment çš„ executeSql() æ–¹æ³•æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨ SQL CLI ä¸­æ‰§è¡Œã€‚executeSql() æ–¹æ³•åœ¨ EXPLAIN æ“ä½œæˆåŠŸåè¿”å›è§£é‡Šç»“æœï¼Œå¦åˆ™å°†æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚\nä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨ TableEnvironment å’Œ SQL CLI ä¸­è¿è¡Œ EXPLAIN è¯­å¥ã€‚\nval env = StreamExecutionEnvironment.getExecutionEnvironment() val tEnv = StreamTableEnvironment.create(env) // register a table named \u0026#34;Orders\u0026#34; tEnv.executeSql(\u0026#34;CREATE TABLE MyTable1 (count bigint, work VARCHAR(256) WITH (...)\u0026#34;) tEnv.executeSql(\u0026#34;CREATE TABLE MyTable2 (count bigint, work VARCHAR(256) WITH (...)\u0026#34;) // explain SELECT statement through TableEnvironment.explainSql() val explanation = tEnv.explainSql( \u0026#34;SELECT count, word FROM MyTable1 WHERE word LIKE \u0026#39;F%\u0026#39; \u0026#34; + \u0026#34;UNION ALL \u0026#34; + \u0026#34;SELECT count, word FROM MyTable2\u0026#34;) println(explanation) // explain SELECT statement through TableEnvironment.executeSql() val tableResult = tEnv.executeSql( \u0026#34;EXPLAIN PLAN FOR \u0026#34; + \u0026#34;SELECT count, word FROM MyTable1 WHERE word LIKE \u0026#39;F%\u0026#39; \u0026#34; + \u0026#34;UNION ALL \u0026#34; + \u0026#34;SELECT count, word FROM MyTable2\u0026#34;) tableResult.print() EXPLAIN çš„ç»“æœæ˜¯ï¼š\n== Abstract Syntax Tree == LogicalUnion(all=[true]) LogicalFilter(condition=[LIKE($1, _UTF-16LE'F%')]) FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[count, word]) FlinkLogicalTableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[count, word]) == Optimized Logical Plan == DataStreamUnion(all=[true], union all=[count, word]) DataStreamCalc(select=[count, word], where=[LIKE(word, _UTF-16LE'F%')]) TableSourceScan(table=[[default_catalog, default_database, MyTable1]], fields=[count, word]) TableSourceScan(table=[[default_catalog, default_database, MyTable2]], fields=[count, word]) == Physical Execution Plan == Stage 1 : Data Source content : collect elements with CollectionInputFormat Stage 2 : Data Source content : collect elements with CollectionInputFormat Stage 3 : Operator content : from: (count, word) ship_strategy : REBALANCE Stage 4 : Operator content : where: (LIKE(word, _UTF-16LE'F%')), select: (count, word) ship_strategy : FORWARD Stage 5 : Operator content : from: (count, word) ship_strategy : REBALANCE è¯­æ³• EXPLAINPLANFOR\u0026lt;query_statement_or_insert_statement\u0026gt;å…³äºæŸ¥è¯¢è¯­æ³•ï¼Œè¯·å‚è€ƒæŸ¥è¯¢é¡µé¢ã€‚å…³äº INSERTï¼Œè¯·å‚è€ƒ INSERT é¡µé¢ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-explan-statements/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL","SQL"],"title":"Explan è¯­å¥"},{"categories":["Flink"],"contents":"Flink DataSet API ç¼–ç¨‹æŒ‡å— Flink ä¸­çš„æ•°æ®é›†ç¨‹åºæ˜¯å¯¹æ•°æ®é›†å®ç°è½¬æ¢ï¼ˆå¦‚è¿‡æ»¤ã€æ˜ å°„ã€åŠ å…¥ã€åˆ†ç»„ï¼‰çš„å¸¸è§„ç¨‹åºã€‚æ•°æ®é›†æœ€åˆæ˜¯ä»æŸäº›æ¥æºåˆ›å»ºçš„ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡è¯»å–æ–‡ä»¶ï¼Œæˆ–ä»æœ¬åœ°é›†åˆä¸­åˆ›å»ºï¼‰ã€‚ç»“æœé€šè¿‡æ±‡è¿”å›ï¼Œä¾‹å¦‚å¯ä»¥å°†æ•°æ®å†™å…¥ï¼ˆåˆ†å¸ƒå¼ï¼‰æ–‡ä»¶ï¼Œæˆ–æ ‡å‡†è¾“å‡ºï¼ˆä¾‹å¦‚å‘½ä»¤è¡Œç»ˆç«¯ï¼‰ã€‚Flink ç¨‹åºå¯ä»¥åœ¨å„ç§ç¯å¢ƒä¸‹è¿è¡Œï¼Œç‹¬ç«‹è¿è¡Œï¼Œæˆ–è€…åµŒå…¥å…¶ä»–ç¨‹åºä¸­ã€‚æ‰§è¡Œå¯ä»¥å‘ç”Ÿåœ¨æœ¬åœ° JVM ä¸­ï¼Œä¹Ÿå¯ä»¥å‘ç”Ÿåœ¨è®¸å¤šæœºå™¨çš„é›†ç¾¤ä¸­ã€‚\nè¯·å‚è€ƒ DataStream API æ¦‚è¿°ï¼Œäº†è§£ Flink API çš„åŸºæœ¬æ¦‚å¿µã€‚è¯¥æ¦‚è¿°æ˜¯é’ˆå¯¹ DataStream API çš„ï¼Œä½†è¿™ä¸¤ä¸ª API çš„åŸºæœ¬æ¦‚å¿µæ˜¯ä¸€æ ·çš„ã€‚\nä¸ºäº†åˆ›å»ºä½ è‡ªå·±çš„ Flink DataSet ç¨‹åºï¼Œæˆ‘ä»¬é¼“åŠ±ä½ ä» Flink ç¨‹åºçš„éª¨æ¶å¼€å§‹ï¼Œå¹¶é€æ­¥æ·»åŠ ä½ è‡ªå·±çš„è½¬æ¢ã€‚å…¶ä½™éƒ¨åˆ†ä½œä¸ºé™„åŠ æ“ä½œå’Œé«˜çº§åŠŸèƒ½çš„å‚è€ƒã€‚\nç¨‹åºç¤ºä¾‹ ä¸‹é¢çš„ç¨‹åºæ˜¯ä¸€ä¸ªå®Œæ•´çš„ã€å¯ä»¥ä½¿ç”¨çš„ WordCount çš„ä¾‹å­ï¼Œä½ å¯ä»¥å¤åˆ¶å’Œç²˜è´´ä»£ç åœ¨æœ¬åœ°è¿è¡Œã€‚ä½ å¯ä»¥å¤åˆ¶å’Œç²˜è´´ä»£ç åœ¨æœ¬åœ°è¿è¡Œå®ƒã€‚ä½ åªéœ€è¦åœ¨ä½ çš„é¡¹ç›®ä¸­åŠ å…¥æ­£ç¡®çš„ Flink çš„åº“ï¼ˆå‚è§ä¸ Flink çš„é“¾æ¥éƒ¨åˆ†ï¼‰å¹¶æŒ‡å®šå¯¼å…¥ã€‚ç„¶åä½ å°±å¯ä»¥å¼€å§‹äº†\nimport org.apache.flink.api.scala._ object WordCount { def main(args: Array[String]) { val env = ExecutionEnvironment.getExecutionEnvironment val text = env.fromElements( \u0026#34;Who\u0026#39;s there?\u0026#34;, \u0026#34;I think I hear them. Stand, ho! Who\u0026#39;s there?\u0026#34;) val counts = text.flatMap { _.toLowerCase.split(\u0026#34;\\\\W+\u0026#34;) filter { _.nonEmpty } } .map { (_, 1) } .groupBy(0) .sum(1) counts.print() } } DataSet è½¬æ¢ æ•°æ®è½¬æ¢å°†ä¸€ä¸ªæˆ–å¤šä¸ª DataSet è½¬æ¢ä¸ºä¸€ä¸ªæ–°çš„ DataSetã€‚ç¨‹åºå¯ä»¥å°†å¤šä¸ªè½¬æ¢ç»„åˆæˆå¤æ‚çš„é›†åˆã€‚\næœ¬èŠ‚ç®€è¦ä»‹ç»äº†å¯ç”¨çš„è½¬æ¢ã€‚è½¬æ¢æ–‡æ¡£ä¸­æœ‰æ‰€æœ‰å˜æ¢çš„å®Œæ•´æè¿°å’Œç¤ºä¾‹ã€‚\n Map  æ¥å—ä¸€ä¸ªå…ƒç´ ï¼Œäº§ç”Ÿä¸€ä¸ªå…ƒç´ ã€‚\ndata.map { x =\u0026gt; x.toInt }  FlatMap  æ¥å—ä¸€ä¸ªå…ƒç´ å¹¶äº§ç”Ÿé›¶ã€ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ã€‚\ndata.flatMap { str =\u0026gt; str.split(\u0026#34; \u0026#34;) }  MapPartition  åœ¨ä¸€ä¸ªå‡½æ•°è°ƒç”¨ä¸­è½¬æ¢ä¸€ä¸ªå¹¶è¡Œåˆ†åŒºã€‚è¯¥å‡½æ•°ä»¥\u0026quot;è¿­ä»£å™¨\u0026quot;çš„å½¢å¼è·å–åˆ†åŒºï¼Œå¹¶å¯äº§ç”Ÿä»»æ„æ•°é‡çš„ç»“æœå€¼ã€‚æ¯ä¸ªåˆ†åŒºçš„å…ƒç´ æ•°é‡å–å†³äºå¹³è¡Œåº¦å’Œä¹‹å‰çš„æ“ä½œã€‚\ndata.mapPartition { in =\u0026gt; in map { (_, 1) } }  Filter  å¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œå¸ƒå°”å‡½æ•°è¯„ä¼°ï¼Œå¹¶ä¿ç•™é‚£äº›å‡½æ•°è¿”å›çœŸçš„å…ƒç´ ã€‚ é‡è¦ï¼šç³»ç»Ÿå‡è®¾å‡½æ•°ä¸ä¼šä¿®æ”¹åº”ç”¨è°“è¯çš„å…ƒç´ ã€‚è¿åè¿™ä¸ªå‡è®¾ä¼šå¯¼è‡´é”™è¯¯çš„ç»“æœã€‚\ndata.filter { _ \u0026gt; 1000 }  Reduce  é€šè¿‡é‡å¤å°†ä¸¤ä¸ªå…ƒç´ åˆå¹¶ä¸ºä¸€ä¸ªå…ƒç´ ï¼Œå°†ä¸€ç»„å…ƒç´ åˆå¹¶ä¸ºä¸€ä¸ªå…ƒç´ ã€‚æ¢ç®—å¯ä»¥åº”ç”¨äºä¸€ä¸ªå®Œæ•´çš„æ•°æ®é›†ï¼Œä¹Ÿå¯ä»¥åº”ç”¨äºä¸€ä¸ªåˆ†ç»„çš„æ•°æ®é›†ã€‚\ndata.reduce { _ + _ }  ReduceGroup  å°†ä¸€ç»„å…ƒç´ åˆå¹¶æˆä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ã€‚ReduceGroup å¯ä»¥åº”ç”¨åœ¨ä¸€ä¸ªå®Œæ•´çš„æ•°æ®é›†ä¸Šï¼Œä¹Ÿå¯ä»¥åº”ç”¨åœ¨ä¸€ä¸ªåˆ†ç»„çš„æ•°æ®é›†ä¸Šã€‚\ndata.reduceGroup { elements =\u0026gt; elements.sum }  Aggregate  å°†ä¸€ç»„å€¼èšåˆæˆä¸€ä¸ªå€¼ã€‚Aggregation å‡½æ•°å¯ä»¥è¢«è®¤ä¸ºæ˜¯å†…ç½®çš„ reduce å‡½æ•°ã€‚Aggregate å¯ä»¥åº”ç”¨äºä¸€ä¸ªå®Œæ•´çš„æ•°æ®é›†ï¼Œä¹Ÿå¯ä»¥åº”ç”¨äºä¸€ä¸ªåˆ†ç»„çš„æ•°æ®é›†ã€‚\nval input: DataSet[(Int, String, Double)] = // [...] val output: DataSet[(Int, String, Double)] = input.aggregate(SUM, 0).aggregate(MIN, 2) ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ç®€å†™è¯­æ³•æ¥è¿›è¡Œ minimum, maximum å’Œ sum çš„èšåˆã€‚\nval input: DataSet[(Int, String, Double)] = // [...] val output: DataSet[(Int, String, Double)] = input.sum(0).min(2)  Distinct  è¿”å›æ•°æ®é›†çš„ä¸åŒå…ƒç´ ã€‚å®ƒä»è¾“å…¥çš„ DataSet ä¸­åˆ é™¤å…ƒç´ çš„æ‰€æœ‰å­—æ®µæˆ–å­—æ®µå­é›†çš„é‡å¤æ¡ç›®ã€‚\ndata.distinct()  Join  é€šè¿‡åˆ›å»ºæ‰€æœ‰é”®å€¼ç›¸ç­‰çš„å…ƒç´ å¯¹æ¥è¿æ¥ä¸¤ä¸ªæ•°æ®é›†ã€‚å¯ä»¥é€‰æ‹©ä½¿ç”¨ JoinFunction å°†ä¸€å¯¹å…ƒç´ å˜æˆä¸€ä¸ªå…ƒç´ ï¼Œæˆ–è€…ä½¿ç”¨ FlatJoinFunction å°†ä¸€å¯¹å…ƒç´ å˜æˆä»»æ„å¤šä¸ªï¼ˆåŒ…æ‹¬æ— ï¼‰å…ƒç´ ã€‚è¯·å‚é˜…é”®éƒ¨åˆ†äº†è§£å¦‚ä½•å®šä¹‰è¿æ¥é”®ã€‚\n// In this case tuple fields are used as keys. \u0026#34;0\u0026#34; is the join field on the first tuple // \u0026#34;1\u0026#34; is the join field on the second tuple. val result = input1.join(input2).where(0).equalTo(1) ä½ å¯ä»¥é€šè¿‡ Join Hints æŒ‡å®šè¿è¡Œæ—¶æ‰§è¡Œè¿æ¥çš„æ–¹å¼ã€‚è¿™äº›æç¤ºæè¿°äº†è¿æ¥æ˜¯é€šè¿‡åˆ†åŒºè¿˜æ˜¯å¹¿æ’­è¿›è¡Œçš„ï¼Œä»¥åŠå®ƒæ˜¯ä½¿ç”¨åŸºäºæ’åºè¿˜æ˜¯åŸºäºæ•£åˆ—çš„ç®—æ³•ã€‚è¯·å‚è€ƒè½¬æ¢æŒ‡å—ï¼Œäº†è§£å¯èƒ½çš„æç¤ºåˆ—è¡¨å’Œç¤ºä¾‹ã€‚ å¦‚æœæ²¡æœ‰æŒ‡å®šæç¤ºï¼Œç³»ç»Ÿå°†å°è¯•å¯¹è¾“å…¥å¤§å°è¿›è¡Œä¼°è®¡ï¼Œå¹¶æ ¹æ®è¿™äº›ä¼°è®¡é€‰æ‹©æœ€ä½³ç­–ç•¥ã€‚\n// This executes a join by broadcasting the first data set // using a hash table for the broadcast data val result = input1.join(input2, JoinHint.BROADCAST_HASH_FIRST) .where(0).equalTo(1) è¯·æ³¨æ„ï¼Œè¿æ¥è½¬æ¢åªé€‚ç”¨äºç­‰ä»·è¿æ¥ã€‚å…¶ä»–çš„è¿æ¥ç±»å‹éœ€è¦ä½¿ç”¨ OuterJoin æˆ– CoGroup æ¥è¡¨è¾¾ã€‚\n OuterJoin  åœ¨ä¸¤ä¸ªæ•°æ®é›†ä¸Šæ‰§è¡Œå·¦è”æ¥ã€å³è”æ¥æˆ–å®Œå…¨å¤–è”æ¥ã€‚å¤–è”æ¥ä¸å¸¸è§„ï¼ˆå†…è”æ¥ï¼‰ç±»ä¼¼ï¼Œåˆ›å»ºæ‰€æœ‰é”®å€¼ç›¸åŒçš„å…ƒç´ å¯¹ã€‚æ­¤å¤–ï¼Œå¦‚æœåœ¨å¦ä¸€ä¾§æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„é”®ï¼Œ\u0026ldquo;å¤–ä¾§\u0026quot;çš„è®°å½•ï¼ˆå·¦ã€å³æˆ–å…¨è”æ¥æ—¶ä¸¤è€…éƒ½æœ‰ï¼‰å°†è¢«ä¿ç•™ã€‚åŒ¹é…çš„å…ƒç´ å¯¹ï¼ˆæˆ–ä¸€ä¸ªå…ƒç´ å’Œå¦ä¸€ä¸ªè¾“å…¥çš„ null å€¼ï¼‰è¢«äº¤ç»™ JoinFunction å°†è¿™å¯¹å…ƒç´ å˜æˆå•ä¸ªå…ƒç´ ï¼Œæˆ–äº¤ç»™ FlatJoinFunction å°†è¿™å¯¹å…ƒç´ å˜æˆä»»æ„å¤šä¸ªï¼ˆåŒ…æ‹¬æ— ï¼‰å…ƒç´ ã€‚è¯·å‚é˜…é”®éƒ¨åˆ†ï¼Œäº†è§£å¦‚ä½•å®šä¹‰è¿æ¥é”®ã€‚\nval joined = left.leftOuterJoin(right).where(0).equalTo(1) { (left, right) =\u0026gt; val a = if (left == null) \u0026#34;none\u0026#34; else left._1 (a, right) }  CoGroup  å‡å°‘æ“ä½œçš„äºŒç»´å˜ä½“ã€‚åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µä¸Šå¯¹æ¯ä¸ªè¾“å…¥è¿›è¡Œåˆ†ç»„ï¼Œç„¶åå°†åˆ†ç»„åˆå¹¶ã€‚æ¯ä¸€å¯¹ç»„éƒ½ä¼šè°ƒç”¨è½¬æ¢å‡½æ•°ã€‚è¯·å‚é˜…é”®éƒ¨åˆ†ï¼Œäº†è§£å¦‚ä½•å®šä¹‰ coGroup é”®ã€‚\ndata1.coGroup(data2).where(0).equalTo(1)  Cross  å»ºç«‹ä¸¤ä¸ªè¾“å…¥çš„ç¬›å¡å°”ä¹˜ç§¯ï¼ˆäº¤å‰ä¹˜ç§¯ï¼‰ï¼Œåˆ›å»ºæ‰€æœ‰å…ƒç´ å¯¹ã€‚å¯é€‰æ‹©ä½¿ç”¨äº¤å‰å‡½æ•°å°†ä¸€å¯¹å…ƒç´ å˜æˆä¸€ä¸ªå•ä¸€å…ƒç´ ã€‚\nval data1: DataSet[Int] = // [...] val data2: DataSet[String] = // [...] val result: DataSet[(Int, String)] = data1.cross(data2) æ³¨æ„ï¼šCross å¯èƒ½æ˜¯ä¸€ä¸ªéå¸¸è€—è´¹è®¡ç®—çš„æ“ä½œï¼Œç”šè‡³å¯ä»¥æŒ‘æˆ˜å¤§å‹è®¡ç®—é›†ç¾¤ï¼å»ºè®®ä½¿ç”¨ crossWithTiny() å’Œ crossWithHuge() æ¥æç¤ºç³»ç»Ÿæ•°æ®é›†çš„å¤§å°ã€‚\n  Union\n  äº§ç”Ÿä¸¤ä¸ªæ•°æ®é›†çš„å¹¶é›†ã€‚\n  data.union(data2)  Rebalance  å‡åŒ€åœ°é‡æ–°å¹³è¡¡æ•°æ®é›†çš„å¹¶è¡Œåˆ†åŒºï¼Œä»¥æ¶ˆé™¤æ•°æ®å€¾æ–œã€‚åªæœ‰ç±»ä¼¼äº Map çš„å˜æ¢æ‰å¯ä»¥è·Ÿéšé‡æ–°å¹³è¡¡(rebalance)å˜æ¢ã€‚\nval data1: DataSet[Int] = // [...] val result: DataSet[(Int, String)] = data1.rebalance().map(...)  Hash-Partition  åœ¨ç»™å®šçš„é”®ä¸Šå¯¹æ•°æ®é›†è¿›è¡Œæ•£åˆ—åˆ†åŒºã€‚é”®å¯ä»¥è¢«æŒ‡å®šä¸ºä½ç½®é”®ã€è¡¨è¾¾å¼é”®å’Œé”®é€‰æ‹©å‡½æ•°ã€‚\nval in: DataSet[(Int, String)] = // [...] val result = in.partitionByHash(0).mapPartition { ... }  Range-Partition  åœ¨ç»™å®šçš„é”®ä¸ŠæŒ‰ç…§èŒƒå›´åˆ†å‰²æ•°æ®é›†ã€‚é”®å¯ä»¥è¢«æŒ‡å®šä¸ºä½ç½®é”®ã€è¡¨è¾¾å¼é”®å’Œé”®é€‰æ‹©å‡½æ•°ã€‚\nval in: DataSet[(Int, String)] = // [...] val result = in.partitionByRange(0).mapPartition { ... }  è‡ªå®šä¹‰åˆ†åŒº  ä½¿ç”¨è‡ªå®šä¹‰çš„ Partitioner å‡½æ•°ï¼Œæ ¹æ®é”®å°†è®°å½•åˆ†é…åˆ°ç‰¹å®šçš„åˆ†åŒºã€‚é”®å¯ä»¥æŒ‡å®šä¸ºä½ç½®é”®ã€è¡¨è¾¾å¼é”®å’Œé”®é€‰æ‹©å‡½æ•°ã€‚ æ³¨æ„ï¼šæ­¤æ–¹æ³•ä»…é€‚ç”¨äºå•ä¸ªå­—æ®µé”®ã€‚\nval in: DataSet[(Int, String)] = // [...] val result = in .partitionCustom(partitioner, key).mapPartition { ... }  Sort Partition  æŒ‰ç…§æŒ‡å®šçš„é¡ºåºå¯¹æ•°æ®é›†çš„æ‰€æœ‰åˆ†åŒºè¿›è¡Œæœ¬åœ°æ’åºã€‚å­—æ®µå¯ä»¥æŒ‡å®šä¸ºå…ƒç»„ä½ç½®æˆ–å­—æ®µè¡¨è¾¾å¼ã€‚å¯¹å¤šä¸ªå­—æ®µçš„æ’åºæ˜¯é€šè¿‡é“¾å¼ sortPartition() è°ƒç”¨å®Œæˆçš„ã€‚\nval in: DataSet[(Int, String)] = // [...] val result = in.sortPartition(1, Order.ASCENDING).mapPartition { ... }  First-n  è¿”å›ä¸€ä¸ªæ•°æ®é›†çš„å‰ n ä¸ªï¼ˆä»»æ„ï¼‰å…ƒç´ ã€‚First-n å¯ä»¥åº”ç”¨äºä¸€ä¸ªå¸¸è§„æ•°æ®é›†ã€ä¸€ä¸ªåˆ†ç»„æ•°æ®é›†æˆ–ä¸€ä¸ªåˆ†ç»„æ’åºæ•°æ®é›†ã€‚åˆ†ç»„é”®å¯ä»¥æŒ‡å®šä¸ºé”®é€‰æ‹©å‡½æ•°ã€å…ƒç»„ä½ç½®æˆ– case ç±»å­—æ®µã€‚\nval in: DataSet[(Int, String)] = // [...] // regular data set val result1 = in.first(3) // grouped data set val result2 = in.groupBy(0).first(3) // grouped-sorted data set val result3 = in.groupBy(0).sortGroup(1, Order.ASCENDING).first(3) ä»¥ä¸‹è½¬æ¢å¯ç”¨äºå…ƒç»„çš„æ•°æ®é›†ã€‚\n MinBy / MaxBy  ä»ä¸€ç»„å…ƒç»„ä¸­é€‰æ‹©ä¸€ä¸ªå…ƒç»„ï¼Œè¿™äº›å…ƒç»„çš„ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µçš„å€¼æ˜¯æœ€å°çš„ï¼ˆæœ€å¤§çš„ï¼‰ã€‚ç”¨äºæ¯”è¾ƒçš„å­—æ®µå¿…é¡»æ˜¯æœ‰æ•ˆçš„é”®å­—æ®µï¼Œå³å¯æ¯”è¾ƒã€‚å¦‚æœå¤šä¸ªå…ƒç»„å…·æœ‰æœ€å°ï¼ˆæœ€å¤§ï¼‰å­—æ®µå€¼ï¼Œåˆ™è¿”å›è¿™äº›å…ƒç»„çš„ä»»æ„å…ƒç»„ã€‚MinBy (MaxBy)å¯ä»¥åº”ç”¨äºä¸€ä¸ªå®Œæ•´çš„æ•°æ®é›†æˆ–ä¸€ä¸ªåˆ†ç»„æ•°æ®é›†ã€‚\nval in: DataSet[(Int, Double, String)] = // [...] // a data set with a single tuple with minimum values for the Int and String fields. val out: DataSet[(Int, Double, String)] = in.minBy(0, 2) // a data set with one tuple for each group with the minimum value for the Double field. val out2: DataSet[(Int, Double, String)] = in.groupBy(2) .minBy(1) é€šè¿‡åŒ¿åæ¨¡å¼åŒ¹é…ä» tupleã€case ç±»å’Œé›†åˆä¸­æå–ï¼Œæ¯”å¦‚ä¸‹é¢ã€‚\nval data: DataSet[(Int, String, Double)] = // [...] data.map { case (id, name, temperature) =\u0026gt; // [...] } ä¸å— API å¼€ç®±å³ç”¨çš„æ”¯æŒã€‚è¦ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œä½ åº”è¯¥ä½¿ç”¨ Scala API æ‰©å±•ã€‚\nå˜æ¢çš„å¹¶è¡Œåº¦å¯ä»¥é€šè¿‡ setParallelism(int) æ¥å®šä¹‰ï¼Œè€Œ name(String) å¯ä»¥ç»™å˜æ¢æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„åç§°ï¼Œè¿™å¯¹è°ƒè¯•å¾ˆæœ‰å¸®åŠ©ã€‚æ•°æ®æºå’Œæ•°æ®æ¥æ”¶å™¨ä¹Ÿæ˜¯å¦‚æ­¤ã€‚\nwithParameters(Configuration) ä¼ é€’ Configuration å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å¯ä»¥ä»ç”¨æˆ·å‡½æ•°é‡Œé¢çš„ open() æ–¹æ³•è®¿é—®ã€‚\næŒ‡å®šé”® ä¸€äº›è½¬æ¢ï¼ˆjoinã€coGroupã€groupByï¼‰éœ€è¦åœ¨å…ƒç´ é›†åˆä¸Šå®šä¹‰ä¸€ä¸ªé”®ã€‚å…¶ä»–è½¬æ¢ï¼ˆReduceã€GroupReduceã€Aggregateï¼‰å…è®¸åœ¨åº”ç”¨ä¹‹å‰å°†æ•°æ®æŒ‰é”®åˆ†ç»„ã€‚\nä¸€ä¸ª DataSet è¢«åˆ†ç»„ä¸ºï¼š\nDataSet\u0026lt;...\u0026gt; input = // [...] DataSet\u0026lt;...\u0026gt; reduced = input .groupBy(/*define key here*/) .reduceGroup(/*do something*/); Flink çš„æ•°æ®æ¨¡å‹ä¸æ˜¯åŸºäºé”®å€¼å¯¹çš„ã€‚å› æ­¤ï¼Œä½ ä¸éœ€è¦å°†æ•°æ®é›†ç±»å‹ç‰©ç†åœ°æ‰“åŒ…æˆé”®å’Œå€¼ã€‚é”®æ˜¯\u0026quot;è™šæ‹Ÿçš„\u0026rdquo;ï¼šå®ƒä»¬è¢«å®šä¹‰ä¸ºå®é™…æ•°æ®ä¸Šçš„å‡½æ•°ï¼Œä»¥æŒ‡å¯¼åˆ†ç»„æ“ä½œç¬¦ã€‚\nä¸ºå…ƒç»„å®šä¹‰é”® æœ€ç®€å•çš„æƒ…å†µæ˜¯å¯¹ Tuple çš„ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µè¿›è¡Œåˆ†ç»„ã€‚\nval input: DataSet[(Int, String, Long)] = // [...] val keyed = input.groupBy(0) å…ƒç»„åœ¨ç¬¬ä¸€ä¸ªå­—æ®µï¼ˆæ•´æ•°ç±»å‹çš„å­—æ®µï¼‰ä¸Šè¿›è¡Œåˆ†ç»„ã€‚\nval input: DataSet[(Int, String, Long)] = // [...] val grouped = input.groupBy(0,1) åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†å…ƒç»„æ”¾åœ¨ä¸€ä¸ªç”±ç¬¬ä¸€ä¸ªå­—æ®µå’Œç¬¬äºŒä¸ªå­—æ®µç»„æˆçš„å¤åˆé”®ä¸Šã€‚\nå…³äºåµŒå¥— Tuple çš„è¯´æ˜ã€‚å¦‚æœä½ çš„ DataSet æœ‰ä¸€ä¸ªåµŒå¥—çš„å…ƒç»„ï¼Œæ¯”å¦‚ï¼š\nDataSet\u0026lt;Tuple3\u0026lt;Tuple2\u0026lt;Integer, Float\u0026gt;,String,Long\u0026gt;\u0026gt; ds; æŒ‡å®š groupBy(0) å°†ä½¿ç³»ç»Ÿä½¿ç”¨å®Œæ•´çš„ Tuple2 ä½œä¸ºé”®ï¼ˆä»¥ Integer å’Œ Float ä¸ºé”®ï¼‰ã€‚å¦‚æœè¦\u0026quot;å¯¼èˆª\u0026quot;åˆ°åµŒå¥—çš„ Tuple2 ä¸­ï¼Œå°±å¿…é¡»ä½¿ç”¨å­—æ®µè¡¨è¾¾å¼é”®ï¼Œä¸‹é¢å°†å¯¹å…¶è¿›è¡Œè¯´æ˜ã€‚\nä½¿ç”¨å­—æ®µè¡¨è¾¾å¼å®šä¹‰é”® ä½ å¯ä»¥ä½¿ç”¨åŸºäºå­—ç¬¦ä¸²çš„å­—æ®µè¡¨è¾¾å¼æ¥å¼•ç”¨åµŒå¥—çš„å­—æ®µï¼Œå¹¶ä¸ºåˆ†ç»„ã€æ’åºã€è¿æ¥(join)æˆ– coGrouping å®šä¹‰é”®ã€‚\nå­—æ®µè¡¨è¾¾å¼å¯ä»¥éå¸¸å®¹æ˜“åœ°é€‰æ‹©ï¼ˆåµŒå¥—çš„ï¼‰å¤åˆç±»å‹ä¸­çš„å­—æ®µï¼Œå¦‚ Tuple å’Œ POJO ç±»å‹ã€‚\nåœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæœ‰ä¸¤ä¸ªå­—æ®µ \u0026ldquo;word\u0026rdquo; å’Œ \u0026ldquo;count\u0026rdquo; çš„ WC POJOã€‚è¦æŒ‰å­—æ®µ word è¿›è¡Œåˆ†ç»„ï¼Œæˆ‘ä»¬åªéœ€å°†å…¶åç§°ä¼ é€’ç»™ groupBy() å‡½æ•°ã€‚\n// some ordinary POJO (Plain old Java Object) class WC(var word: String, var count: Int) { def this() { this(\u0026#34;\u0026#34;, 0L) } } val words: DataSet[WC] = // [...] val wordCounts = words.groupBy(\u0026#34;word\u0026#34;) // or, as a case class, which is less typing case class WC(word: String, count: Int) val words: DataSet[WC] = // [...] val wordCounts = words.groupBy(\u0026#34;word\u0026#34;) å­—æ®µè¡¨è¾¾å¼è¯­æ³•   é€šè¿‡å­—æ®µåé€‰æ‹© POJO å­—æ®µã€‚ä¾‹å¦‚ \u0026ldquo;user\u0026rdquo; æŒ‡çš„æ˜¯ POJO ç±»å‹çš„ \u0026ldquo;user\u0026rdquo; å­—æ®µã€‚\n  é€šè¿‡ 1-offset å­—æ®µåæˆ– 0-offset å­—æ®µç´¢å¼•æ¥é€‰æ‹© Tuple å­—æ®µã€‚ä¾‹å¦‚ \u0026ldquo;_1\u0026rdquo; å’Œ \u0026ldquo;5\u0026rdquo; åˆ†åˆ«æŒ‡ Scala Tuple ç±»å‹çš„ç¬¬ä¸€å’Œç¬¬å…­å­—æ®µã€‚\n  ä½ å¯ä»¥åœ¨ POJO å’Œ Tuple ä¸­é€‰æ‹©åµŒå¥—å­—æ®µã€‚ä¾‹å¦‚ \u0026ldquo;user.zip\u0026rdquo; æŒ‡çš„æ˜¯ POJO çš„ \u0026ldquo;zip\u0026rdquo; å­—æ®µï¼Œå®ƒå­˜å‚¨åœ¨ POJO ç±»å‹çš„ \u0026ldquo;user\u0026rdquo; å­—æ®µä¸­ã€‚æ”¯æŒ POJO å’Œ Tuple çš„ä»»æ„åµŒå¥—å’Œæ··åˆï¼Œå¦‚ \u0026ldquo;_2.user.zip\u0026rdquo; æˆ– \u0026ldquo;user._4.1.zip\u0026rdquo;ã€‚\nä½ å¯ä»¥ä½¿ç”¨ \u0026ldquo;_\u0026rdquo; é€šé…ç¬¦è¡¨è¾¾å¼é€‰æ‹©å®Œæ•´çš„ç±»å‹ã€‚è¿™ä¹Ÿé€‚ç”¨äºä¸æ˜¯ Tuple æˆ– POJO ç±»å‹çš„ç±»å‹ã€‚\nå­—æ®µè¡¨è¾¾å¼ç¤ºä¾‹:\nclass WC(var complex: ComplexNestedClass, var count: Int) { def this() { this(null, 0) } } class ComplexNestedClass( var someNumber: Int, someFloat: Float, word: (Long, Long, String), hadoopCitizen: IntWritable) { def this() { this(0, 0, (0, 0, \u0026#34;\u0026#34;), new IntWritable(0)) } } è¿™äº›éƒ½æ˜¯ä¸Šé¢ä¾‹å­ä»£ç çš„æœ‰æ•ˆå­—æ®µè¡¨è¾¾å¼ã€‚\n  \u0026ldquo;count\u0026rdquo;: WC ç±»ä¸­çš„è®¡æ•°å­—æ®µ\n  \u0026ldquo;complex\u0026rdquo;: é€’å½’é€‰æ‹© POJO ç±»å‹ ComplexNestedClass çš„ complex å­—æ®µçš„æ‰€æœ‰å­—æ®µã€‚\n  \u0026ldquo;complex.word._3\u0026rdquo;: é€‰æ‹©åµŒå¥—çš„ Tuple3 çš„æœ€åä¸€ä¸ªå­—æ®µã€‚\n  \u0026ldquo;complex.hadoopCitizen\u0026rdquo;: é€‰æ‹© Hadoop IntWritable ç±»å‹ã€‚\n  ä½¿ç”¨é”®é€‰æ‹©å‡½æ•°å®šä¹‰é”® å¦ä¸€ç§å®šä¹‰é”®çš„æ–¹æ³•æ˜¯\u0026quot;é”®é€‰æ‹©å™¨\u0026quot;å‡½æ•°ã€‚é”®é€‰æ‹©å™¨å‡½æ•°å°†ä¸€ä¸ªå…ƒç´ ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¿”å›è¯¥å…ƒç´ çš„é”®ã€‚é”®å¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„ï¼Œå¹¶ä¸”å¯ä»¥ä»ç¡®å®šæ€§è®¡ç®—ä¸­å¾—åˆ°ã€‚\nä¸‹é¢çš„ä¾‹å­æ˜¾ç¤ºäº†ä¸€ä¸ªç®€å•è¿”å›å¯¹è±¡å­—æ®µçš„é”®é€‰æ‹©å‡½æ•°ã€‚\n// some ordinary case class case class WC(word: String, count: Int) val words: DataSet[WC] = // [...] val keyed = words.groupBy( _.word ) æ•°æ®æº æ•°æ®æºåˆ›å»ºåˆå§‹æ•°æ®é›†ï¼Œä¾‹å¦‚ä»æ–‡ä»¶æˆ– Java é›†åˆä¸­åˆ›å»ºã€‚åˆ›å»ºæ•°æ®é›†çš„ä¸€èˆ¬æœºåˆ¶æ˜¯åœ¨ InputFormat åé¢æŠ½è±¡å‡ºæ¥çš„ã€‚Flink è‡ªå¸¦äº†å‡ ç§å†…ç½®çš„æ ¼å¼æ¥ä»å¸¸è§çš„æ–‡ä»¶æ ¼å¼åˆ›å»ºæ•°æ®é›†ã€‚å…¶ä¸­è®¸å¤šæ ¼å¼åœ¨ ExecutionEnvironment ä¸Šæœ‰å¿«æ·æ–¹æ³•ã€‚\nåŸºäºæ–‡ä»¶çš„:\n  readTextFile(path) / TextInputFormat - è¯»å–æ–‡ä»¶å¹¶ä»¥å­—ç¬¦ä¸²å½¢å¼è¿”å›ã€‚\n  readTextFileWithValue(path) / TextValueInputFormat - ä»¥è¡Œçš„æ–¹å¼è¯»å–æ–‡ä»¶å¹¶ä»¥ StringValues çš„å½¢å¼è¿”å›ã€‚StringValues æ˜¯å¯å˜å­—ç¬¦ä¸²ã€‚\n  readCsvFile(path) / CsvInputFormat - è§£æä»¥é€—å·ï¼ˆæˆ–å…¶ä»–å­—ç¬¦ï¼‰åˆ†éš”çš„æ–‡ä»¶ã€‚è¿”å›ä¸€ä¸ªç”± tupleã€case ç±»å¯¹è±¡æˆ– POJOs ç»„æˆçš„ DataSetã€‚æ”¯æŒåŸºæœ¬çš„ java ç±»å‹åŠå…¶å¯¹åº”çš„ Value ç±»å‹ä½œä¸ºå­—æ®µç±»å‹ã€‚\n  readFileOfPrimitives(path, delimiter) / PrimitiveInputFormat - ä½¿ç”¨ç»™å®šçš„å®šç•Œç¬¦ï¼Œè§£ææ–°è¡Œï¼ˆæˆ–å…¶ä»–å­—ç¬¦åºåˆ—ï¼‰å®šç•Œçš„åŸºå…ƒæ•°æ®ç±»å‹çš„æ–‡ä»¶ï¼Œå¦‚ String æˆ– Integerã€‚\n  readSequenceFile(Key, Value, path) / SequenceFileInputFormat - åˆ›å»ºä¸€ä¸ª JobConf å¹¶ä»æŒ‡å®šçš„è·¯å¾„è¯»å–æ–‡ä»¶ï¼Œæ–‡ä»¶ç±»å‹ä¸º SequenceFileInputFormatï¼ŒKey ç±»å’Œ Value ç±»ï¼Œå¹¶ä»¥ Tuple2\u0026lt;Key, Value\u0026gt; çš„å½¢å¼è¿”å›ã€‚\n  åŸºäºé›†åˆçš„:\n  fromCollection(Iterable) - ä»ä¸€ä¸ª Iterable åˆ›å»ºä¸€ä¸ªæ•°æ®é›†ã€‚Iterable è¿”å›çš„æ‰€æœ‰å…ƒç´ å¿…é¡»æ˜¯ç›¸åŒçš„ç±»å‹ã€‚\n  fromCollection(Iterator) - ä»ä¸€ä¸ª Iterator åˆ›å»ºä¸€ä¸ªæ•°æ®é›†ã€‚è¯¥ç±»æŒ‡å®šäº†è¿­ä»£å™¨è¿”å›çš„å…ƒç´ çš„æ•°æ®ç±»å‹ã€‚\n  fromElements(elements: _*) - ä»ç»™å®šçš„å¯¹è±¡åºåˆ—ä¸­åˆ›å»ºä¸€ä¸ªæ•°æ®é›†ã€‚æ‰€æœ‰å¯¹è±¡å¿…é¡»æ˜¯ç›¸åŒçš„ç±»å‹ã€‚\n  fromParallelCollection(SplittableIterator) - ä»è¿­ä»£å™¨ä¸­å¹¶è¡Œåˆ›å»ºä¸€ä¸ªæ•°æ®é›†ã€‚è¯¥ç±»æŒ‡å®šäº†è¿­ä»£å™¨è¿”å›çš„å…ƒç´ çš„æ•°æ®ç±»å‹ã€‚\n  generateSequence(from, to) - åœ¨ç»™å®šçš„åŒºé—´å†…å¹¶è¡Œç”Ÿæˆæ•°å­—åºåˆ—ã€‚\n  é€šç”¨çš„:\n  readFile(inputFormat, path) / FileInputFormat - æ¥å—ä¸€ä¸ªæ–‡ä»¶è¾“å…¥æ ¼å¼ã€‚\n  createInput(inputFormat) / InputFormat - æ¥å—ä¸€ä¸ªé€šç”¨çš„è¾“å…¥æ ¼å¼ã€‚\n  ç¤ºä¾‹:\nval env = ExecutionEnvironment.getExecutionEnvironment // read text file from local files system val localLines = env.readTextFile(\u0026#34;file:///path/to/my/textfile\u0026#34;) // read text file from an HDFS running at nnHost:nnPort val hdfsLines = env.readTextFile(\u0026#34;hdfs://nnHost:nnPort/path/to/my/textfile\u0026#34;) // read a CSV file with three fields val csvInput = env.readCsvFile[(Int, String, Double)](\u0026#34;hdfs:///the/CSV/file\u0026#34;) // read a CSV file with five fields, taking only two of them val csvInput = env.readCsvFile[(String, Double)]( \u0026#34;hdfs:///the/CSV/file\u0026#34;, includedFields = Array(0, 3)) // take the first and the fourth field  // CSV input can also be used with Case Classes case class MyCaseClass(str: String, dbl: Double) val csvInput = env.readCsvFile[MyCaseClass]( \u0026#34;hdfs:///the/CSV/file\u0026#34;, includedFields = Array(0, 3)) // take the first and the fourth field  // read a CSV file with three fields into a POJO (Person) with corresponding fields val csvInput = env.readCsvFile[Person]( \u0026#34;hdfs:///the/CSV/file\u0026#34;, pojoFields = Array(\u0026#34;name\u0026#34;, \u0026#34;age\u0026#34;, \u0026#34;zipcode\u0026#34;)) // create a set from some given elements val values = env.fromElements(\u0026#34;Foo\u0026#34;, \u0026#34;bar\u0026#34;, \u0026#34;foobar\u0026#34;, \u0026#34;fubar\u0026#34;) // generate a number sequence val numbers = env.generateSequence(1, 10000000) // read a file from the specified path of type SequenceFileInputFormat val tuples = env.createInput(HadoopInputs.readSequenceFile(classOf[IntWritable], classOf[Text], \u0026#34;hdfs://nnHost:nnPort/path/to/file\u0026#34;)) é…ç½® CSV è§£æ Flink ä¸º CSV è§£ææä¾›äº†è®¸å¤šé…ç½®é€‰é¡¹ã€‚\n  lineDelimiter: å­—ç¬¦ä¸²æŒ‡å®šå•ä¸ªè®°å½•çš„å®šç•Œç¬¦ã€‚é»˜è®¤çš„è¡Œå®šç•Œç¬¦æ˜¯æ–°è¡Œå­—ç¬¦ '/n'ã€‚\n  fieldDelimiter: å­—ç¬¦ä¸²æŒ‡å®šåˆ†éš”è®°å½•å­—æ®µçš„å®šç•Œç¬¦ã€‚é»˜è®¤çš„å­—æ®µå®šç•Œç¬¦æ˜¯é€—å·å­—ç¬¦ ','ã€‚\n  includeFields: Array[Int] å®šä¹‰ä»è¾“å…¥æ–‡ä»¶ä¸­è¯»å–å“ªäº›å­—æ®µï¼ˆä»¥åŠå¿½ç•¥å“ªäº›å­—æ®µï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå‰ n ä¸ªå­—æ®µï¼ˆç”± type() è°ƒç”¨ä¸­çš„ç±»å‹æ•°å®šä¹‰ï¼‰ä¼šè¢«è§£æã€‚\n  pojoFields: Array[String] æŒ‡å®š POJO çš„å­—æ®µï¼Œè¿™äº›å­—æ®µè¢«æ˜ å°„åˆ° CSV å­—æ®µã€‚CSV å­—æ®µçš„è§£æå™¨ä¼šæ ¹æ® POJO å­—æ®µçš„ç±»å‹å’Œé¡ºåºè‡ªåŠ¨åˆå§‹åŒ–ã€‚\n  parseQuotedStrings: å¯ç”¨å¼•å·å­—ç¬¦ä¸²è§£æçš„å­—ç¬¦ã€‚å¦‚æœå­—ç¬¦ä¸²å­—æ®µçš„ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯å¼•å·å­—ç¬¦ï¼Œé‚£ä¹ˆå­—ç¬¦ä¸²å°†è¢«è§£æä¸ºå¼•å·å­—ç¬¦ä¸²ï¼ˆå‰å¯¼æˆ–å°¾éƒ¨çš„ç©ºç™½ä¸è¢«ä¿®å‰ªï¼‰ã€‚å¼•å·å­—ç¬¦ä¸²ä¸­çš„å­—æ®µå®šç•Œç¬¦ä¼šè¢«å¿½ç•¥ã€‚å¦‚æœå¼•å·å­—ç¬¦ä¸²å­—æ®µçš„æœ€åä¸€ä¸ªå­—ç¬¦ä¸æ˜¯å¼•å·å­—ç¬¦ï¼Œåˆ™å¼•å·å­—ç¬¦ä¸²è§£æå¤±è´¥ã€‚å¦‚æœå¯ç”¨äº†å¼•å·å­—ç¬¦ä¸²è§£æï¼Œä¸”å­—æ®µçš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸æ˜¯å¼•å·å­—ç¬¦ä¸²ï¼Œåˆ™è¯¥å­—ç¬¦ä¸²å°†è¢«è§£æä¸ºæœªå¼•å·å­—ç¬¦ä¸²ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¼•å·å­—ç¬¦ä¸²è§£æè¢«ç¦ç”¨ã€‚\n  ignoreComments: å­—ç¬¦ä¸²æŒ‡å®šä¸€ä¸ªæ³¨è§£å‰ç¼€ã€‚æ‰€æœ‰ä»¥æŒ‡å®šæ³¨è§£å‰ç¼€å¼€å§‹çš„è¡Œéƒ½ä¸ä¼šè¢«è§£æå’Œå¿½ç•¥ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ²¡æœ‰è¡Œè¢«å¿½ç•¥ã€‚\n  lenientï¼šå¸ƒå°”å€¼ï¼Œå¯ç”¨å®½æ¾è§£æã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸èƒ½æ­£ç¡®è§£æçš„è¡Œä¼šè¢«å¿½ç•¥ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç¦ç”¨å®½æ¾è§£æï¼Œæ— æ•ˆè¡Œä¼šå¼•å‘å¼‚å¸¸ã€‚\n  ignoreFirstLine: Boolean é…ç½® InputFormat å¿½ç•¥è¾“å…¥æ–‡ä»¶çš„ç¬¬ä¸€è¡Œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ²¡æœ‰è¡Œè¢«å¿½ç•¥ã€‚\n  Input Path çš„é€’å½’éå† å¯¹äºåŸºäºæ–‡ä»¶çš„è¾“å…¥ï¼Œå½“è¾“å…¥è·¯å¾„æ˜¯ä¸€ä¸ªç›®å½•æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸ä¼šæšä¸¾åµŒå¥—æ–‡ä»¶ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œåªè¯»å–åŸºç¡€ç›®å½•å†…çš„æ–‡ä»¶ï¼Œè€Œå¿½ç•¥åµŒå¥—æ–‡ä»¶ã€‚åµŒå¥—æ–‡ä»¶çš„é€’å½’æšä¸¾å¯ä»¥é€šè¿‡ recursive.file.enumeration é…ç½®å‚æ•°å¯ç”¨ï¼Œå°±åƒä¸‹é¢çš„ä¾‹å­ã€‚\n// enable recursive enumeration of nested input files val env = ExecutionEnvironment.getExecutionEnvironment // create a configuration object val parameters = new Configuration // set the recursive enumeration parameter parameters.setBoolean(\u0026#34;recursive.file.enumeration\u0026#34;, true) // pass the configuration to the data source env.readTextFile(\u0026#34;file:///path/with.nested/files\u0026#34;).withParameters(parameters) è¯»å–å‹ç¼©æ–‡ä»¶ Flink ç›®å‰æ”¯æŒè¾“å…¥æ–‡ä»¶çš„é€æ˜è§£å‹ï¼Œå¦‚æœè¿™äº›æ–‡ä»¶è¢«æ ‡è®°ä¸ºé€‚å½“çš„æ–‡ä»¶æ‰©å±•åã€‚ç‰¹åˆ«æ˜¯ï¼Œè¿™æ„å‘³ç€æ— éœ€è¿›ä¸€æ­¥é…ç½®è¾“å…¥æ ¼å¼ï¼Œä»»ä½• FileInputFormat éƒ½æ”¯æŒå‹ç¼©ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰è¾“å…¥æ ¼å¼ã€‚è¯·æ³¨æ„ï¼Œå‹ç¼©æ–‡ä»¶å¯èƒ½ä¸ä¼šè¢«å¹¶è¡Œè¯»å–ï¼Œä»è€Œå½±å“ä½œä¸šçš„å¯æ‰©å±•æ€§ã€‚\nä¸‹è¡¨åˆ—å‡ºäº†å½“å‰æ”¯æŒçš„å‹ç¼©æ–¹æ³•ã€‚\n   å‹ç¼©æ–¹æ³• æ–‡ä»¶åç¼€ å¹¶è¡Œæ€§     DEFLATE .deflate no   GZip .gz, .gzip no   Bzip2 .bz2 no   XZ .xz no    æ•°æ®æ¥æ”¶å™¨ æ•°æ®æ¥æ”¶å™¨æ¶ˆè´¹ DataSet å¹¶ç”¨äºå­˜å‚¨æˆ–è¿”å›å®ƒä»¬ã€‚æ•°æ®æ¥æ”¶å™¨çš„æ“ä½œæ˜¯ç”¨ OutputFormat æ¥æè¿°çš„ã€‚Flink å¸¦æœ‰å„ç§å†…ç½®çš„è¾“å‡ºæ ¼å¼ï¼Œè¿™äº›æ ¼å¼è¢«å°è£…åœ¨å¯¹ DataSet çš„æ“ä½œåé¢ã€‚\n writeAsText() / TextOutputFormat \u0026ndash;å°†å…ƒç´ é€è¡Œå†™æˆ Stringsã€‚é€šè¿‡è°ƒç”¨æ¯ä¸ªå…ƒç´ çš„ toString() æ–¹æ³•è·å¾—å­—ç¬¦ä¸²ã€‚ writeAsCsv(...) / CsvOutputFormat - å°†å…ƒç»„å†™æˆé€—å·åˆ†éš”çš„å€¼æ–‡ä»¶ã€‚è¡Œå’Œå­—æ®µå®šç•Œç¬¦æ˜¯å¯é…ç½®çš„ã€‚æ¯ä¸ªå­—æ®µçš„å€¼æ¥è‡ªå¯¹è±¡çš„ toString() æ–¹æ³•ã€‚ print() / printToErr() - åœ¨æ ‡å‡†è¾“å‡º/æ ‡å‡†é”™è¯¯æµä¸Šæ‰“å°æ¯ä¸ªå…ƒç´ çš„ toString() å€¼ã€‚ write() / FileOutputFormat - ç”¨äºè‡ªå®šä¹‰æ–‡ä»¶è¾“å‡ºçš„æ–¹æ³•å’ŒåŸºç±»ã€‚æ”¯æŒè‡ªå®šä¹‰å¯¹è±¡åˆ°å­—èŠ‚çš„è½¬æ¢ã€‚ output()/ OutputFormat - æœ€é€šç”¨çš„è¾“å‡ºæ–¹æ³•ï¼Œç”¨äºéåŸºäºæ–‡ä»¶çš„æ•°æ®æ¥æ”¶å™¨ï¼ˆå¦‚å°†ç»“æœå­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼‰ã€‚  ä¸€ä¸ª DataSet å¯ä»¥è¢«è¾“å…¥åˆ°å¤šä¸ªæ“ä½œä¸­ã€‚ç¨‹åºå¯ä»¥å†™å…¥æˆ–æ‰“å°ä¸€ä¸ªæ•°æ®é›†ï¼ŒåŒæ—¶è¿˜å¯ä»¥å¯¹å…¶è¿›è¡Œé¢å¤–çš„è½¬æ¢ã€‚\nç¤ºä¾‹\næ ‡å‡†æ•°æ®æ¥æ”¶å™¨æ–¹æ³•:\n// text data val textData: DataSet[String] = // [...]  // write DataSet to a file on the local file system textData.writeAsText(\u0026#34;file:///my/result/on/localFS\u0026#34;) // write DataSet to a file on an HDFS with a namenode running at nnHost:nnPort textData.writeAsText(\u0026#34;hdfs://nnHost:nnPort/my/result/on/localFS\u0026#34;) // write DataSet to a file and overwrite the file if it exists textData.writeAsText(\u0026#34;file:///my/result/on/localFS\u0026#34;, WriteMode.OVERWRITE) // tuples as lines with pipe as the separator \u0026#34;a|b|c\u0026#34; val values: DataSet[(String, Int, Double)] = // [...] values.writeAsCsv(\u0026#34;file:///path/to/the/result/file\u0026#34;, \u0026#34;\\n\u0026#34;, \u0026#34;|\u0026#34;) // this writes tuples in the text formatting \u0026#34;(a, b, c)\u0026#34;, rather than as CSV lines values.writeAsText(\u0026#34;file:///path/to/the/result/file\u0026#34;) // this writes values as strings using a user-defined formatting values map { tuple =\u0026gt; tuple._1 + \u0026#34; - \u0026#34; + tuple._2 } .writeAsText(\u0026#34;file:///path/to/the/result/file\u0026#34;) æœ¬åœ°æ’åºè¾“å‡º æ•°æ®æ¥æ”¶å™¨çš„è¾“å‡ºå¯ä»¥ä½¿ç”¨å…ƒç»„å­—æ®µä½ç½®æˆ–å­—æ®µè¡¨è¾¾å¼å¯¹æŒ‡å®šå­—æ®µæŒ‰æŒ‡å®šé¡ºåºè¿›è¡Œæœ¬åœ°æ’åºã€‚è¿™é€‚ç”¨äºæ¯ä¸€ç§è¾“å‡ºæ ¼å¼ã€‚\nä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨è¯¥åŠŸèƒ½ã€‚\nval tData: DataSet[(Int, String, Double)] = // [...] val pData: DataSet[(BookPojo, Double)] = // [...] val sData: DataSet[String] = // [...]  // sort output on String field in ascending order tData.sortPartition(1, Order.ASCENDING).print() // sort output on Double field in descending and Int field in ascending order tData.sortPartition(2, Order.DESCENDING).sortPartition(0, Order.ASCENDING).print() // sort output on the \u0026#34;author\u0026#34; field of nested BookPojo in descending order pData.sortPartition(\u0026#34;_1.author\u0026#34;, Order.DESCENDING).writeAsText(...) // sort output on the full tuple in ascending order tData.sortPartition(\u0026#34;_\u0026#34;, Order.ASCENDING).writeAsCsv(...) // sort atomic type (String) output in descending order sData.sortPartition(\u0026#34;_\u0026#34;, Order.DESCENDING).writeAsText(...) ç›®å‰è¿˜ä¸æ”¯æŒå…¨å±€æ’åºè¾“å‡ºã€‚\nè¿­ä»£è¿ç®—ç¬¦ è¿­ä»£åœ¨ Flink ç¨‹åºä¸­å®ç°äº†å¾ªç¯ã€‚è¿­ä»£è¿ç®—ç¬¦å°è£…äº†ç¨‹åºçš„ä¸€éƒ¨åˆ†ï¼Œå¹¶åå¤æ‰§è¡Œï¼Œå°†ä¸€æ¬¡è¿­ä»£çš„ç»“æœï¼ˆéƒ¨åˆ†è§£ï¼‰åé¦ˆåˆ°ä¸‹ä¸€æ¬¡è¿­ä»£ä¸­ã€‚Flink ä¸­çš„è¿­ä»£æœ‰ä¸¤ç§ç±»å‹ã€‚BulkIteration å’Œ DeltaIterationã€‚\næœ¬èŠ‚æä¾›äº†å¦‚ä½•ä½¿ç”¨è¿™ä¸¤ç§è¿ç®—ç¬¦çš„å¿«é€Ÿç¤ºä¾‹ã€‚æŸ¥çœ‹è¿­ä»£ä»‹ç»é¡µé¢å¯ä»¥è·å¾—æ›´è¯¦ç»†çš„ä»‹ç»ã€‚\næ‰¹é‡è¿­ä»£ è¦åˆ›å»ºä¸€ä¸ª BulkIterationï¼Œè°ƒç”¨è¿­ä»£å¼€å§‹çš„ DataSet çš„ iterate(int) æ–¹æ³•ï¼ŒåŒæ—¶æŒ‡å®šä¸€ä¸ª step å‡½æ•°ã€‚step å‡½æ•°è·å–å½“å‰è¿­ä»£çš„è¾“å…¥ DataSetï¼Œå¹¶ä¸”å¿…é¡»è¿”å›ä¸€ä¸ªæ–°çš„ DataSetã€‚è¿­ä»£è°ƒç”¨çš„å‚æ•°æ˜¯æœ€å¤§çš„è¿­ä»£æ¬¡æ•°ï¼Œè¿­ä»£è¿‡åè¦åœæ­¢ã€‚\nè¿˜æœ‰ iterateWithTermination(int) å‡½æ•°ï¼Œæ¥å— step å‡½æ•°ï¼Œè¿”å›ä¸¤ä¸ª DataSetsã€‚è¿­ä»£æ­¥éª¤çš„ç»“æœå’Œä¸€ä¸ªç»ˆæ­¢æ ‡å‡†ã€‚ä¸€æ—¦ç»ˆæ­¢å‡†åˆ™ DataSet ä¸ºç©ºï¼Œå°±ä¼šåœæ­¢è¿­ä»£ã€‚\nä¸‹é¢çš„ä¾‹å­æ˜¯è¿­ä»£ä¼°è®¡æ•°å­— Piã€‚ç›®æ ‡æ˜¯è®¡ç®—éšæœºç‚¹çš„æ•°é‡ï¼Œè¿™äº›éšæœºç‚¹è½å…¥å•ä½åœ†ä¸­ã€‚åœ¨æ¯ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œéƒ½ä¼šæŒ‘é€‰ä¸€ä¸ªéšæœºç‚¹ã€‚å¦‚æœè¿™ä¸ªç‚¹ä½äºå•ä½åœ†å†…ï¼Œæˆ‘ä»¬å°±é€’å¢è®¡æ•°ã€‚ç„¶åï¼ŒPi çš„ä¼°è®¡å€¼æ˜¯æ‰€å¾—åˆ°çš„è®¡æ•°é™¤ä»¥è¿­ä»£æ¬¡æ•°ä¹˜ä»¥ 4ã€‚\nval env = ExecutionEnvironment.getExecutionEnvironment() // Create initial DataSet val initial = env.fromElements(0) val count = initial.iterate(10000) { iterationInput: DataSet[Int] =\u0026gt; val result = iterationInput.map { i =\u0026gt; val x = Math.random() val y = Math.random() i + (if (x * x + y * y \u0026lt; 1) 1 else 0) } result } val result = count map { c =\u0026gt; c / 10000.0 * 4 } result.print() env.execute(\u0026#34;Iterative Pi Example\u0026#34;) ä½ ä¹Ÿå¯ä»¥æŸ¥çœ‹ K-Means çš„ä¾‹å­ï¼Œå®ƒä½¿ç”¨ BulkIteration æ¥èšç±»ä¸€ç»„æœªæ ‡è®°çš„ç‚¹ã€‚\nå¢é‡è¿­ä»£ å¢é‡è¿­ä»£åˆ©ç”¨äº†æŸäº›ç®—æ³•åœ¨æ¯æ¬¡è¿­ä»£ä¸­ä¸æ”¹å˜è§£çš„æ¯ä¸ªæ•°æ®ç‚¹çš„äº‹å®ã€‚\né™¤äº†åœ¨æ¯æ¬¡è¿­ä»£ä¸­åé¦ˆçš„éƒ¨åˆ†è§£ï¼ˆç§°ä¸º worksetï¼‰ï¼Œdelta è¿­ä»£è¿˜ä¿æŒç€è·¨è¿­ä»£çš„çŠ¶æ€ï¼ˆç§°ä¸ºè§£é›†ï¼‰ï¼Œå¯ä»¥é€šè¿‡ delta æ›´æ–°ã€‚è¿­ä»£è®¡ç®—çš„ç»“æœæ˜¯æœ€åä¸€æ¬¡è¿­ä»£åçš„çŠ¶æ€ã€‚å…³äº delta è¿­ä»£çš„åŸºæœ¬åŸç†ï¼Œè¯·å‚è€ƒè¿­ä»£ç®€ä»‹ã€‚\nå®šä¹‰ DeltaIteration ä¸å®šä¹‰ BulkIteration ç±»ä¼¼ã€‚å¯¹äº delta è¿­ä»£ï¼Œä¸¤ä¸ªæ•°æ®é›†æ„æˆäº†æ¯æ¬¡è¿­ä»£çš„è¾“å…¥ï¼ˆå·¥ä½œé›†å’Œè§£é›†ï¼‰ï¼Œå¹¶ä¸”åœ¨æ¯æ¬¡è¿­ä»£ä¸­äº§ç”Ÿä¸¤ä¸ªæ•°æ®é›†ä½œä¸ºç»“æœï¼ˆæ–°å·¥ä½œé›†ï¼Œè§£é›† deltaï¼‰ã€‚\nè¦åˆ›å»ºä¸€ä¸ª DeltaIteration åœ¨åˆå§‹è§£é›†ä¸Šè°ƒç”¨ iterateDelta(initialWorksetï¼ŒmaxIterationsï¼Œkey)ã€‚step å‡½æ•°éœ€è¦ä¸¤ä¸ªå‚æ•°ã€‚(solutionSet, workset), å¹¶ä¸”å¿…é¡»è¿”å›ä¸¤ä¸ªå€¼: (solutionSetDelta, newWorkset).\nä¸‹é¢æ˜¯ä¸€ä¸ª delta è¿­ä»£è¯­æ³•çš„ä¾‹å­ã€‚\n// read the initial data sets val initialSolutionSet: DataSet[(Long, Double)] = // [...]  val initialWorkset: DataSet[(Long, Double)] = // [...]  val maxIterations = 100 val keyPosition = 0 val result = initialSolutionSet.iterateDelta(initialWorkset, maxIterations, Array(keyPosition)) { (solution, workset) =\u0026gt; val candidateUpdates = workset.groupBy(1).reduceGroup(new ComputeCandidateChanges()) val deltas = candidateUpdates.join(solution).where(0).equalTo(0)(new CompareChangesToCurrent()) val nextWorkset = deltas.filter(new FilterByThreshold()) (deltas, nextWorkset) } result.writeAsCsv(outputPath) env.execute() åœ¨å‡½æ•°ä¸­å¯¹æ•°æ®å¯¹è±¡è¿›è¡Œæ“ä½œ Flink çš„è¿è¡Œæ—¶ä»¥ Java å¯¹è±¡çš„å½¢å¼ä¸ç”¨æˆ·å‡½æ•°äº¤æ¢æ•°æ®ã€‚å‡½æ•°ä»è¿è¡Œæ—¶æ¥æ”¶è¾“å…¥å¯¹è±¡ä½œä¸ºæ–¹æ³•å‚æ•°ï¼Œå¹¶è¿”å›è¾“å‡ºå¯¹è±¡ä½œä¸ºç»“æœã€‚å› ä¸ºè¿™äº›å¯¹è±¡æ˜¯ç”±ç”¨æˆ·å‡½æ•°å’Œè¿è¡Œæ—¶ä»£ç è®¿é—®çš„ï¼Œæ‰€ä»¥ç†è§£å’Œéµå¾ªç”¨æˆ·ä»£ç å¦‚ä½•è®¿é—®ï¼Œå³è¯»å–å’Œä¿®æ”¹è¿™äº›å¯¹è±¡çš„è§„åˆ™æ˜¯éå¸¸é‡è¦çš„ã€‚\nç”¨æˆ·å‡½æ•°ä»¥å¸¸è§„æ–¹æ³•å‚æ•°ï¼ˆå¦‚ MapFunctionï¼‰æˆ–é€šè¿‡ Iterable å‚æ•°ï¼ˆå¦‚ GroupReduceFunctionï¼‰ä» Flink çš„è¿è¡Œæ—¶æ¥æ”¶å¯¹è±¡ã€‚æˆ‘ä»¬æŠŠè¿è¡Œæ—¶ä¼ é€’ç»™ç”¨æˆ·å‡½æ•°çš„å¯¹è±¡ç§°ä¸ºè¾“å…¥å¯¹è±¡ã€‚ç”¨æˆ·å‡½æ•°å¯ä»¥å°†å¯¹è±¡ä½œä¸ºæ–¹æ³•è¿”å›å€¼ï¼ˆåƒ MapFunctionï¼‰æˆ–é€šè¿‡ Collectorï¼ˆåƒ FlatMapFunctionï¼‰å‘å°„ç»™ Flink è¿è¡Œæ—¶ã€‚æˆ‘ä»¬å°†ç”¨æˆ·å‡½æ•°å‘è¿è¡Œæ—¶å‘å°„çš„å¯¹è±¡ç§°ä¸ºè¾“å‡ºå¯¹è±¡ã€‚\nFlink çš„ DataSet API å…·æœ‰ä¸¤ç§æ¨¡å¼ï¼Œå®ƒä»¬åœ¨ Flink çš„è¿è¡Œæ—¶å¦‚ä½•åˆ›å»ºæˆ–é‡ç”¨è¾“å…¥å¯¹è±¡æ–¹é¢æœ‰æ‰€ä¸åŒã€‚è¿™ç§è¡Œä¸ºä¼šå½±å“ç”¨æˆ·å‡½æ•°å¦‚ä½•ä¸è¾“å…¥å’Œè¾“å‡ºå¯¹è±¡äº¤äº’çš„ä¿è¯å’Œçº¦æŸã€‚ä¸‹é¢çš„ç« èŠ‚å®šä¹‰äº†è¿™äº›è§„åˆ™ï¼Œå¹¶ç»™å‡ºäº†ç¼–å†™å®‰å…¨ç”¨æˆ·å‡½æ•°ä»£ç çš„ç¼–ç æŒ‡å—ã€‚\nç¦ç”¨å¯¹è±¡é‡ç”¨(DEFAULT) é»˜è®¤æƒ…å†µä¸‹ï¼ŒFlink åœ¨ç¦ç”¨å¯¹è±¡é‡ç”¨æ¨¡å¼ä¸‹è¿è¡Œã€‚è¿™ç§æ¨¡å¼å¯ä»¥ä¿è¯å‡½æ•°åœ¨å‡½æ•°è°ƒç”¨ä¸­æ€»æ˜¯æ¥æ”¶æ–°çš„è¾“å…¥å¯¹è±¡ã€‚å¯¹è±¡é‡ç”¨ç¦ç”¨æ¨¡å¼èƒ½æä¾›æ›´å¥½çš„ä¿è¯ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿæ›´å®‰å…¨ã€‚ä½†æ˜¯ï¼Œå®ƒæœ‰ä¸€å®šçš„å¤„ç†å¼€é”€ï¼Œå¯èƒ½ä¼šå¼•èµ·è¾ƒé«˜çš„ Java åƒåœ¾æ”¶é›†æ´»åŠ¨ã€‚ä¸‹è¡¨è§£é‡Šäº†åœ¨ç¦ç”¨å¯¹è±¡é‡ç”¨æ¨¡å¼ä¸‹ï¼Œç”¨æˆ·å‡½æ•°å¦‚ä½•è®¿é—®è¾“å…¥å’Œè¾“å‡ºå¯¹è±¡ã€‚\n   æ“ä½œ ä¿è¯å’Œé™åˆ¶     è¯»å–è¾“å…¥å¯¹è±¡ åœ¨ä¸€ä¸ªæ–¹æ³•è°ƒç”¨ä¸­ï¼Œä¿è¯è¾“å…¥å¯¹è±¡çš„å€¼ä¸ä¼šæ”¹å˜ã€‚è¿™åŒ…æ‹¬ç”± Iterable æœåŠ¡çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œåœ¨ List æˆ– Map ä¸­æ”¶é›†ç”± Iterable æœåŠ¡çš„è¾“å…¥å¯¹è±¡æ˜¯å®‰å…¨çš„ã€‚è¯·æ³¨æ„ï¼Œåœ¨æ–¹æ³•è°ƒç”¨ç¦»å¼€åï¼Œå¯¹è±¡å¯èƒ½ä¼šè¢«ä¿®æ”¹ã€‚è·¨å‡½æ•°è°ƒç”¨è®°å¿†å¯¹è±¡æ˜¯ä¸å®‰å…¨çš„ã€‚   ä¿®æ”¹è¾“å…¥å¯¹è±¡ ä½ å¯ä»¥ä¿®æ”¹è¾“å…¥å¯¹è±¡ã€‚   å‘å°„è¾“å…¥å¯¹è±¡ ä½ å¯ä»¥å‘å°„è¾“å…¥å¯¹è±¡ã€‚è¾“å…¥å¯¹è±¡çš„å€¼å¯èƒ½åœ¨å‘å°„åå‘ç”Ÿå˜åŒ–ã€‚è¯»å–å‘å°„åçš„è¾“å…¥å¯¹è±¡æ˜¯ä¸å®‰å…¨çš„ã€‚   è¯»å–è¾“å‡ºå¯¹è±¡ ç»™äºˆæ”¶é›†å™¨çš„å¯¹è±¡æˆ–ä½œä¸ºæ–¹æ³•ç»“æœè¿”å›çš„å¯¹è±¡å¯èƒ½å·²ç»æ”¹å˜äº†å…¶å€¼ã€‚è¯»å–è¾“å‡ºå¯¹è±¡æ˜¯ä¸å®‰å…¨çš„ã€‚   ä¿®æ”¹è¾“å‡ºå¯¹è±¡ ä½ å¯ä»¥åœ¨å¯¹è±¡è¢«å‘å°„åå¯¹å…¶è¿›è¡Œä¿®æ”¹ï¼Œç„¶åå†æ¬¡å‘å°„ã€‚    å¯¹è±¡é‡ç”¨ç¦ç”¨ï¼ˆé»˜è®¤ï¼‰æ¨¡å¼çš„ç¼–ç å‡†åˆ™ã€‚\n ä¸è¦è·¨æ–¹æ³•è°ƒç”¨è®°å¿†å’Œè¯»å–è¾“å…¥å¯¹è±¡ã€‚ ä¸è¦åœ¨å‘å‡ºå¯¹è±¡åè¯»å–å¯¹è±¡ã€‚  å¯ç”¨å¯¹è±¡é‡ç”¨ åœ¨å¯ç”¨å¯¹è±¡é‡ç”¨æ¨¡å¼ä¸‹ï¼ŒFlink çš„è¿è¡Œæ—¶ä¼šå°½é‡å‡å°‘å¯¹è±¡å®ä¾‹åŒ–çš„æ•°é‡ã€‚è¿™å¯ä»¥æé«˜æ€§èƒ½ï¼Œå¹¶ä¸”å¯ä»¥å‡å°‘ Java åƒåœ¾æ”¶é›†çš„å‹åŠ›ã€‚é€šè¿‡è°ƒç”¨ ExecutionConfig.enableObjectReuse() æ¿€æ´»å¯¹è±¡é‡ç”¨å¯ç”¨æ¨¡å¼ã€‚ä¸‹è¡¨è§£é‡Šäº†åœ¨å¯ç”¨å¯¹è±¡é‡ç”¨æ¨¡å¼ä¸‹ï¼Œç”¨æˆ·å‡½æ•°å¦‚ä½•è®¿é—®è¾“å…¥å’Œè¾“å‡ºå¯¹è±¡ã€‚\n   æ“ä½œ ä¿è¯å’Œé™åˆ¶     è¯»å–ä½œä¸ºå¸¸è§„æ–¹æ³•å‚æ•°æ¥æ”¶çš„è¾“å…¥å¯¹è±¡ ä½œä¸ºå¸¸è§„æ–¹æ³•å‚æ•°æ¥æ”¶çš„è¾“å…¥å¯¹è±¡åœ¨ä¸€æ¬¡å‡½æ•°è°ƒç”¨ä¸­ä¸è¢«ä¿®æ”¹ã€‚å¯¹è±¡å¯èƒ½åœ¨æ–¹æ³•è°ƒç”¨ç»“æŸåè¢«ä¿®æ”¹ã€‚è·¨å‡½æ•°è°ƒç”¨è®°å¿†å¯¹è±¡æ˜¯ä¸å®‰å…¨çš„ã€‚   è¯»å–ä» Iterable å‚æ•°ä¸­æ¥æ”¶åˆ°çš„è¾“å…¥å¯¹è±¡ ä» Iterable ä¸­æ¥æ”¶åˆ°çš„è¾“å…¥å¯¹è±¡åªåœ¨è°ƒç”¨ next()æ–¹æ³•ä¹‹å‰æœ‰æ•ˆã€‚ä¸€ä¸ª Iterable æˆ– Iterator å¯ä»¥å¤šæ¬¡æœåŠ¡äºåŒä¸€ä¸ªå¯¹è±¡å®ä¾‹ã€‚è®°ä½ä» Iterable æ¥æ”¶çš„è¾“å…¥å¯¹è±¡æ˜¯ä¸å®‰å…¨çš„ï¼Œä¾‹å¦‚ï¼ŒæŠŠå®ƒä»¬æ”¾åœ¨ List æˆ– Map ä¸­ã€‚   ä¿®æ”¹è¾“å…¥å¯¹è±¡ é™¤äº† MapFunctionã€FlatMapFunctionã€MapPartitionFunctionã€GroupReduceFunctionã€GroupCombineFunctionã€CoGroupFunction å’Œ InputFormat.next(reuse)çš„è¾“å…¥å¯¹è±¡å¤–ï¼Œä½ ä¸å¾—ä¿®æ”¹è¾“å…¥å¯¹è±¡ã€‚   å‘å°„è¾“å…¥å¯¹è±¡ é™¤äº† MapFunctionã€FlatMapFunctionã€MapPartitionFunctionã€GroupReduceFunctionã€GroupCombineFunctionã€CoGroupFunction å’Œ InputFormat.next(é‡ç”¨)çš„è¾“å…¥å¯¹è±¡å¤–ï¼Œä½ ä¸å¾—å‘å°„è¾“å…¥å¯¹è±¡ã€‚   è¯»å–è¾“å‡ºå¯¹è±¡ ä¸€ä¸ªè¢«äº¤ç»™ Collector æˆ–ä½œä¸ºæ–¹æ³•ç»“æœè¿”å›çš„å¯¹è±¡å¯èƒ½å·²ç»æ”¹å˜äº†å®ƒçš„å€¼ã€‚è¯»å–è¾“å‡ºå¯¹è±¡æ˜¯ä¸å®‰å…¨çš„ã€‚   ä¿®æ”¹è¾“å‡ºå¯¹è±¡ ä½ å¯ä»¥ä¿®æ”¹ä¸€ä¸ªè¾“å‡ºå¯¹è±¡å¹¶å†æ¬¡å‘å‡ºå®ƒã€‚    å¯ç”¨å¯¹è±¡é‡ç”¨çš„ç¼–ç å‡†åˆ™ã€‚\n ä¸è®°å¿†ä» Iterable æ¥æ”¶çš„è¾“å…¥å¯¹è±¡ã€‚ ä¸è®°å¿†å’Œè¯»å–è·¨æ–¹æ³•è°ƒç”¨çš„è¾“å…¥å¯¹è±¡ã€‚ é™¤äº† MapFunctionã€FlatMapFunctionã€MapPartitionFunctionã€GroupReduceFunctionã€GroupCombineFunctionã€CoGroupFunction å’Œ InputFormat.next(reuse)çš„è¾“å…¥å¯¹è±¡å¤–ï¼Œä¸è¦ä¿®æ”¹æˆ–å‘å‡ºè¾“å…¥å¯¹è±¡ã€‚ ä¸ºäº†å‡å°‘å¯¹è±¡å®ä¾‹åŒ–ï¼Œä½ æ€»æ˜¯å¯ä»¥å‘å‡ºä¸€ä¸ªä¸“é—¨çš„è¾“å‡ºå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡è¢«åå¤ä¿®æ”¹ï¼Œä½†ä»ä¸è¯»å–ã€‚  è°ƒè¯• åœ¨åˆ†å¸ƒå¼é›†ç¾¤ä¸­çš„å¤§å‹æ•°æ®é›†ä¸Šè¿è¡Œæ•°æ®åˆ†æç¨‹åºä¹‹å‰ï¼Œæœ€å¥½ç¡®ä¿æ‰€å®ç°çš„ç®—æ³•èƒ½å¤ŸæŒ‰ç…§é¢„æœŸçš„æ–¹å¼è¿è¡Œã€‚å› æ­¤ï¼Œå®ç°æ•°æ®åˆ†æç¨‹åºé€šå¸¸æ˜¯ä¸€ä¸ªæ£€æŸ¥ç»“æœã€è°ƒè¯•å’Œæ”¹è¿›çš„æ¸è¿›è¿‡ç¨‹ã€‚\nFlink æä¾›äº†ä¸€äº›ä¸é”™çš„åŠŸèƒ½ï¼Œé€šè¿‡æ”¯æŒ IDE å†…çš„æœ¬åœ°è°ƒè¯•ã€æ³¨å…¥æµ‹è¯•æ•°æ®å’Œæ”¶é›†ç»“æœæ•°æ®ï¼Œå¤§å¤§ç®€åŒ–äº†æ•°æ®åˆ†æç¨‹åºçš„å¼€å‘è¿‡ç¨‹ã€‚æœ¬èŠ‚ç»™å¤§å®¶ä¸€äº›æç¤ºï¼Œå¦‚ä½•ç®€åŒ– Flink ç¨‹åºçš„å¼€å‘ã€‚\næœ¬åœ°æ‰§è¡Œç¯å¢ƒ LocalEnvironment åœ¨å®ƒåˆ›å»ºçš„åŒä¸€ä¸ª JVM è¿›ç¨‹ä¸­å¯åŠ¨ Flink ç³»ç»Ÿã€‚å¦‚æœä½ ä» IDE ä¸­å¯åŠ¨ LocalEnvironmentï¼Œä½ å¯ä»¥åœ¨ä»£ç ä¸­è®¾ç½®æ–­ç‚¹ï¼Œè½»æ¾è°ƒè¯•ä½ çš„ç¨‹åºã€‚\nLocalEnvironment çš„åˆ›å»ºå’Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ã€‚\nval env = ExecutionEnvironment.createLocalEnvironment() val lines = env.readTextFile(pathToTextFile) // build your program  env.execute() æ”¶é›†æ•°æ®æºå’Œæ¥æ”¶å™¨ ä¸ºåˆ†æç¨‹åºæä¾›è¾“å…¥å¹¶æ£€æŸ¥å…¶è¾“å‡ºï¼Œå¦‚æœé€šè¿‡åˆ›å»ºè¾“å…¥æ–‡ä»¶å’Œè¯»å–è¾“å‡ºæ–‡ä»¶æ¥å®Œæˆï¼Œæ˜¯å¾ˆéº»çƒ¦çš„ã€‚Flink å…·æœ‰ç‰¹æ®Šçš„æ•°æ®æºå’Œæ¥æ”¶å™¨ï¼Œè¿™äº›æ•°æ®æºå’Œæ¥æ”¶å™¨ç”± Java é›†åˆæ”¯æŒï¼Œä»¥æ–¹ä¾¿æµ‹è¯•ã€‚ä¸€æ—¦ç¨‹åºç»è¿‡æµ‹è¯•ï¼Œæºå’Œæ¥æ”¶å™¨å¯ä»¥å¾ˆå®¹æ˜“åœ°è¢«ä» HDFS ç­‰å¤–éƒ¨æ•°æ®å­˜å‚¨ä¸­è¯»å–/å†™å…¥çš„æºå’Œæ¥æ”¶å™¨æ‰€æ›¿ä»£ã€‚\né›†åˆæ•°æ®æºå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼ã€‚\nval env = ExecutionEnvironment.createLocalEnvironment() // Create a DataSet from a list of elements val myInts = env.fromElements(1, 2, 3, 4, 5) // Create a DataSet from any Collection val data: Seq[(String, Int)] = ... val myTuples = env.fromCollection(data) // Create a DataSet from an Iterator val longIt: Iterator[Long] = ... val myLongs = env.fromCollection(longIt) æ³¨ï¼šç›®å‰ï¼Œé›†åˆæ•°æ®æºè¦æ±‚æ•°æ®ç±»å‹å’Œè¿­ä»£å™¨å®ç° Serializableã€‚æ­¤å¤–ï¼Œé›†åˆæ•°æ®æºä¸èƒ½å¹¶è¡Œæ‰§è¡Œï¼ˆ parallelism = 1ï¼‰ã€‚\nè¯­ä¹‰æ³¨è§£ è¯­ä¹‰æ³¨è§£å¯ä»¥ç”¨æ¥ç»™ Flink æä¾›å…³äºå‡½æ•°è¡Œä¸ºçš„æç¤ºã€‚å®ƒä»¬å‘Šè¯‰ç³»ç»Ÿï¼Œå‡½æ•°è¯»å–å¹¶è¯„ä¼°äº†å‡½æ•°è¾“å…¥çš„å“ªäº›å­—æ®µï¼Œä»¥åŠå®ƒå°†å“ªäº›å­—æ®µä»è¾“å…¥è½¬å‘åˆ°è¾“å‡ºï¼Œè€Œæ²¡æœ‰è¿›è¡Œä¿®æ”¹ã€‚è¯­ä¹‰æ³¨è§£æ˜¯åŠ å¿«æ‰§è¡Œé€Ÿåº¦çš„æœ‰åŠ›æ‰‹æ®µï¼Œå› ä¸ºå®ƒä»¬å…è®¸ç³»ç»Ÿæ¨ç†å‡ºåœ¨å¤šä¸ªæ“ä½œä¸­é‡å¤ä½¿ç”¨æ’åºé¡ºåºæˆ–åˆ†åŒºçš„é—®é¢˜ã€‚ä½¿ç”¨è¯­ä¹‰æ³¨è§£æœ€ç»ˆå¯èƒ½ä¼šä½¿ç¨‹åºå…äºä¸å¿…è¦çš„æ•°æ®æ´—ç‰Œæˆ–ä¸å¿…è¦çš„æ’åºï¼Œå¹¶æ˜¾è‘—æé«˜ç¨‹åºçš„æ€§èƒ½ã€‚\næ³¨æ„ï¼šè¯­ä¹‰æ³¨è§£çš„ä½¿ç”¨æ˜¯å¯é€‰çš„ã€‚ç„¶è€Œï¼Œåœ¨æä¾›è¯­ä¹‰æ³¨è§£æ—¶ï¼Œä¿å®ˆåœ°ä½¿ç”¨è¯­ä¹‰æ³¨è§£æ˜¯ç»å¯¹å…³é”®çš„! ä¸æ­£ç¡®çš„è¯­ä¹‰æ³¨è§£å°†å¯¼è‡´ Flink å¯¹ä½ çš„ç¨‹åºåšå‡ºä¸æ­£ç¡®çš„å‡è®¾ï¼Œå¹¶å¯èƒ½æœ€ç»ˆå¯¼è‡´ä¸æ­£ç¡®çš„ç»“æœã€‚å¦‚æœä¸€ä¸ªæ“ä½œç¬¦çš„è¡Œä¸ºä¸æ˜¯æ˜ç¡®å¯é¢„æµ‹çš„ï¼Œå°±ä¸åº”è¯¥æä¾›æ³¨è§£ã€‚è¯·ä»”ç»†é˜…è¯»æ–‡æ¡£ã€‚\nç›®å‰æ”¯æŒä»¥ä¸‹è¯­ä¹‰æ³¨è§£ã€‚\nè½¬å‘å­—æ®µæ³¨è§£\nè½¬å‘å­—æ®µä¿¡æ¯å£°æ˜äº†æœªè¢«ä¿®æ”¹çš„è¾“å…¥å­—æ®µè¢«å‡½æ•°è½¬å‘åˆ°è¾“å‡ºä¸­çš„åŒä¸€ä½ç½®æˆ–å¦ä¸€ä½ç½®ã€‚è¯¥ä¿¡æ¯è¢«ä¼˜åŒ–å™¨ç”¨æ¥æ¨æ–­æ•°æ®å±æ€§ï¼ˆå¦‚æ’åºæˆ–åˆ†åŒºï¼‰æ˜¯å¦è¢«å‡½æ•°ä¿ç•™ã€‚å¯¹äºå¯¹è¾“å…¥å…ƒç´ ç»„è¿›è¡Œæ“ä½œçš„å‡½æ•°ï¼Œå¦‚ GroupReduceã€GroupCombineã€CoGroup å’Œ MapPartitionï¼Œæ‰€æœ‰è¢«å®šä¹‰ä¸ºè½¬å‘å­—æ®µçš„å­—æ®µå¿…é¡»æ€»æ˜¯ä»åŒä¸€ä¸ªè¾“å…¥å…ƒç´ è”åˆè½¬å‘ã€‚ç”±ç»„æ™ºå‡½æ•°å‘å‡ºçš„æ¯ä¸ªå…ƒç´ çš„è½¬å‘å­—æ®µå¯èƒ½æ¥æºäºå‡½æ•°çš„è¾“å…¥ç»„çš„ä¸åŒå…ƒç´ ã€‚\nå­—æ®µè½¬å‘ä¿¡æ¯ä½¿ç”¨å­—æ®µè¡¨è¾¾å¼æ¥æŒ‡å®šã€‚åœ¨è¾“å‡ºä¸­è½¬å‘åˆ°åŒä¸€ä½ç½®çš„å­—æ®µå¯ä»¥é€šè¿‡å…¶ä½ç½®æ¥æŒ‡å®šã€‚æŒ‡å®šçš„ä½ç½®å¿…é¡»å¯¹è¾“å…¥å’Œè¾“å‡ºçš„æ•°æ®ç±»å‹æœ‰æ•ˆï¼Œå¹¶å…·æœ‰ç›¸åŒçš„ç±»å‹ã€‚ä¾‹å¦‚å­—ç¬¦ä¸² \u0026ldquo;f2 \u0026ldquo;å£°æ˜ Java è¾“å…¥å…ƒç»„çš„ç¬¬ä¸‰ä¸ªå­—æ®µæ€»æ˜¯ç­‰äºè¾“å‡ºå…ƒç»„ä¸­çš„ç¬¬ä¸‰ä¸ªå­—æ®µã€‚\nå°†è¾“å…¥ä¸­çš„æºå­—æ®µå’Œè¾“å‡ºä¸­çš„ç›®æ ‡å­—æ®µæŒ‡å®šä¸ºå­—æ®µè¡¨è¾¾å¼ï¼Œå°±å¯ä»¥å£°æ˜æœªä¿®æ”¹çš„å­—æ®µè½¬å‘åˆ°è¾“å‡ºä¸­çš„å¦ä¸€ä¸ªä½ç½®ã€‚å­—ç¬¦ä¸² \u0026quot;f0-\u0026gt;f2\u0026quot; è¡¨ç¤ºå°† Java è¾“å…¥å…ƒç»„çš„ç¬¬ä¸€ä¸ªå­—æ®µä¸å˜çš„å¤åˆ¶åˆ° Java è¾“å‡ºå…ƒç»„çš„ç¬¬ä¸‰ä¸ªå­—æ®µã€‚é€šé…ç¬¦è¡¨è¾¾å¼ * å¯ä»¥ç”¨æ¥æŒ‡ä»£æ•´ä¸ªè¾“å…¥æˆ–è¾“å‡ºç±»å‹ï¼Œå³ \u0026quot;f0-\u0026gt;*\u0026quot; è¡¨ç¤ºä¸€ä¸ªå‡½æ•°çš„è¾“å‡ºæ€»æ˜¯ç­‰äºå…¶ Java è¾“å…¥å…ƒç»„çš„ç¬¬ä¸€ä¸ªå­—æ®µã€‚\nå¤šä¸ªè½¬å‘å­—æ®µå¯ä»¥åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ç”¨åˆ†å·éš”å¼€å£°æ˜ä¸º \u0026quot;f0; f2-\u0026gt;f1; f3-\u0026gt;f2\u0026quot;ï¼Œä¹Ÿå¯ä»¥åœ¨å•ç‹¬çš„å­—ç¬¦ä¸²ä¸­å£°æ˜ä¸º \u0026ldquo;f0\u0026rdquo;ã€\u0026ldquo;f2-\u0026gt;f1\u0026rdquo;ã€\u0026ldquo;f3-\u0026gt;f2\u0026rdquo;ã€‚å½“æŒ‡å®šè½¬å‘å­—æ®µæ—¶ï¼Œä¸è¦æ±‚æ‰€æœ‰çš„è½¬å‘å­—æ®µéƒ½å£°æ˜ï¼Œä½†æ‰€æœ‰çš„å£°æ˜å¿…é¡»æ­£ç¡®ã€‚\nè½¬å‘å­—æ®µä¿¡æ¯å¯ä»¥é€šè¿‡åœ¨å‡½æ•°ç±»å®šä¹‰ä¸Šé™„åŠ  Java æ³¨è§£æ¥å£°æ˜ï¼Œæˆ–è€…åœ¨è°ƒç”¨ DataSet ä¸Šçš„å‡½æ•°åå°†å…¶ä½œä¸ºæ“ä½œç¬¦å‚æ•°ä¼ é€’ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\nå‡½æ•°ç±»æ³¨è§£\n @ForwardedFields ç”¨äºå•è¾“å…¥çš„å‡½æ•°ï¼Œå¦‚ Map å’Œ Reduceã€‚ @ForwardedFieldsFirst ä»£è¡¨æœ‰ä¸¤ä¸ªè¾“å…¥çš„å‡½æ•°çš„ç¬¬ä¸€ä¸ªè¾“å…¥ï¼Œå¦‚ Join å’Œ CoGroupã€‚ @ForwardedFieldsSecond ä»£è¡¨æœ‰ä¸¤ä¸ªè¾“å…¥çš„å‡½æ•°çš„ç¬¬äºŒä¸ªè¾“å…¥ï¼Œå¦‚ Join å’Œ CoGroupã€‚  æ“ä½œç¬¦å‚æ•°\n data.map(myMapFnc).withForwardedFields() ç”¨äºå•è¾“å…¥çš„å‡½æ•°ï¼Œå¦‚ Map å’Œ Reduceã€‚ data1.join(data2).where().equalTo().with(myJoinFnc).withForwardFieldsFirst() ç”¨äºæœ‰ä¸¤ä¸ªè¾“å…¥çš„å‡½æ•°çš„ç¬¬ä¸€ä¸ªè¾“å…¥ï¼Œå¦‚ Join å’Œ CoGroupã€‚ data1.join(data2).where().equalTo().with(myJoinFnc).withForwardFieldsSecond() ç”¨äºæœ‰ä¸¤ä¸ªè¾“å…¥çš„å‡½æ•°çš„ç¬¬äºŒä¸ªè¾“å…¥ï¼Œå¦‚ Join å’Œ CoGroupã€‚  è¯·æ³¨æ„ï¼Œä¸å¯èƒ½è¦†ç›–é€šè¿‡æ“ä½œç¬¦å‚æ•°æŒ‡å®šä¸ºç±»æ³¨è§£çš„å­—æ®µå‰å‘ä¿¡æ¯ã€‚\nä¾‹å­ï¼šåœ¨å‡½æ•°çš„ç¬¬äºŒä¸ªè¾“å…¥ç«¯ï¼Œå¦‚ Join å’Œ CoGroupï¼Œè¯·æ³¨æ„ä¸èƒ½è¦†ç›–é€šè¿‡è¿ç®—ç¬¦å‚æ•°æŒ‡å®šçš„ç±»æ³¨è§£çš„å­—æ®µå‰å‘ä¿¡æ¯ã€‚\nä¸‹é¢çš„ä¾‹å­æ˜¾ç¤ºäº†å¦‚ä½•ä½¿ç”¨å‡½æ•°ç±»æ³¨è§£æ¥å£°æ˜è½¬å‘çš„å­—æ®µä¿¡æ¯ã€‚\n@ForwardedFields(\u0026#34;_1-\u0026gt;_3\u0026#34;) class MyMap extends MapFunction[(Int, Int), (String, Int, Int)]{ def map(value: (Int, Int)): (String, Int, Int) = { return (\u0026#34;foo\u0026#34;, value._2 / 2, value._1) } } éè½¬å‘å­—æ®µ\néè½¬å‘å­—æ®µä¿¡æ¯å£°æ˜äº†æ‰€æœ‰åœ¨å‡½æ•°è¾“å‡ºä¸­ä¸ä¿ç•™åœ¨åŒä¸€ä½ç½®çš„å­—æ®µã€‚æ‰€æœ‰å…¶ä»–å­—æ®µçš„å€¼éƒ½è¢«è®¤ä¸ºä¿ç•™åœ¨è¾“å‡ºçš„åŒä¸€ä½ç½®ã€‚å› æ­¤ï¼Œéè½¬å‘å­—æ®µä¿¡æ¯ä¸è½¬å‘å­—æ®µä¿¡æ¯æ˜¯ç›¸åçš„ã€‚åˆ†ç»„è¿ç®—ç¬¦ï¼ˆå¦‚ GroupReduceã€GroupCombineã€CoGroup å’Œ MapPartitionï¼‰çš„éè½¬å‘å­—æ®µä¿¡æ¯å¿…é¡»æ»¡è¶³ä¸è½¬å‘å­—æ®µä¿¡æ¯ç›¸åŒçš„è¦æ±‚ã€‚\né‡è¦ï¼šéè½¬å‘å­—æ®µä¿¡æ¯çš„è§„èŒƒæ˜¯å¯é€‰çš„ã€‚ä½†æ˜¯å¦‚æœä½¿ç”¨ï¼Œå¿…é¡»æŒ‡å®š ALL! éè½¬å‘å­—æ®µï¼Œå› ä¸ºæ‰€æœ‰å…¶ä»–å­—æ®µéƒ½è¢«è®¤ä¸ºæ˜¯åŸåœ°è½¬å‘çš„ã€‚å°†ä¸€ä¸ªè½¬å‘å­—æ®µå£°æ˜ä¸ºéè½¬å‘å­—æ®µæ˜¯å®‰å…¨çš„ã€‚\néè½¬å‘å­—æ®µè¢«æŒ‡å®šä¸ºå­—æ®µè¡¨è¾¾å¼çš„åˆ—è¡¨ã€‚è¿™ä¸ªåˆ—è¡¨æ—¢å¯ä»¥æ˜¯ç”±åˆ†å·åˆ†éš”çš„å­—æ®µè¡¨è¾¾å¼ç»„æˆçš„å•ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªå­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ \u0026ldquo;f1; f3\u0026rdquo; å’Œ \u0026ldquo;f1\u0026rdquo;ã€\u0026ldquo;f3\u0026rdquo; éƒ½å£°æ˜ Java å…ƒç»„çš„ç¬¬äºŒä¸ªå’Œç¬¬å››ä¸ªå­—æ®µä¸ä¿ç•™åœ¨åŸåœ°ï¼Œå…¶ä»–æ‰€æœ‰å­—æ®µéƒ½ä¿ç•™åœ¨åŸåœ°ã€‚éå‰å‘å­—æ®µä¿¡æ¯åªèƒ½ä¸ºè¾“å…¥å’Œè¾“å‡ºç±»å‹ç›¸åŒçš„å‡½æ•°æŒ‡å®šã€‚\néè½¬å‘å­—æ®µä¿¡æ¯æ˜¯ä½œä¸ºå‡½æ•°ç±»æ³¨è§£ä½¿ç”¨ä»¥ä¸‹æ³¨è§£æ¥æŒ‡å®šçš„ã€‚\n @NonForwardedFields ç”¨äºå•ä¸ªè¾“å…¥å‡½æ•°ï¼Œå¦‚ Map å’Œ Reduceã€‚ @NonForwardedFieldsFirst ç”¨äºæœ‰ä¸¤ä¸ªè¾“å…¥çš„å‡½æ•°çš„ç¬¬ä¸€ä¸ªè¾“å…¥ï¼Œå¦‚ Join å’Œ CoGroupã€‚ @NonForwardedFieldsSecond ç”¨äºå‡½æ•°çš„ç¬¬äºŒä¸ªè¾“å…¥ï¼Œå¦‚ Join å’Œ CoGroupã€‚  ä¾‹å­\nä¸‹é¢çš„ä¾‹å­æ˜¾ç¤ºäº†å¦‚ä½•å£°æ˜éè½¬å‘å­—æ®µä¿¡æ¯ã€‚\n@NonForwardedFields(\u0026#34;_2\u0026#34;) // second field is not forwarded class MyMap extends MapFunction[(Int, Int), (Int, Int)]{ def map(value: (Int, Int)): (Int, Int) = { return (value._1, value._2 / 2) } } è¯»å–å­—æ®µ\nè¯»å–å­—æ®µä¿¡æ¯å£°æ˜äº†æ‰€æœ‰è¢«å‡½æ•°è®¿é—®å’Œè¯„ä¼°çš„å­—æ®µï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰è¢«å‡½æ•°ç”¨æ¥è®¡ç®—ç»“æœçš„å­—æ®µã€‚ä¾‹å¦‚ï¼Œåœ¨æ¡ä»¶è¯­å¥ä¸­è¢«è¯„ä¼°çš„å­—æ®µæˆ–ç”¨äºè®¡ç®—çš„å­—æ®µå¿…é¡»åœ¨æŒ‡å®šè¯»å–å­—æ®µä¿¡æ¯æ—¶è¢«æ ‡è®°ä¸ºè¯»å–ã€‚ä»…ä»…æ˜¯æœªç»ä¿®æ”¹å°±è½¬å‘åˆ°è¾“å‡ºè€Œä¸è¯„ä¼°å…¶å€¼çš„å­—æ®µï¼Œæˆ–è€…æ ¹æœ¬æ²¡æœ‰è¢«è®¿é—®çš„å­—æ®µéƒ½ä¸è¢«è®¤ä¸ºæ˜¯è¯»ã€‚\né‡è¦ï¼šè¯»å–å­—æ®µä¿¡æ¯çš„æŒ‡å®šæ˜¯å¯é€‰çš„ã€‚ä½†æ˜¯å¦‚æœä½¿ç”¨ï¼Œå¿…é¡»æŒ‡å®š ALL! è¯»å–å­—æ®µã€‚å°†ä¸€ä¸ªéè¯»å­—æ®µå£°æ˜ä¸ºè¯»å­—æ®µæ˜¯å®‰å…¨çš„ã€‚\nè¯»å–å­—æ®µè¢«æŒ‡å®šä¸ºå­—æ®µè¡¨è¾¾å¼çš„åˆ—è¡¨ã€‚è¿™ä¸ªåˆ—è¡¨å¯ä»¥æ˜¯ä¸€ä¸ªç”±åˆ†å·åˆ†éš”çš„å­—æ®µè¡¨è¾¾å¼ç»„æˆçš„å•ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªå­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ \u0026ldquo;f1; f3\u0026rdquo; å’Œ \u0026ldquo;f1\u0026rdquo;ã€\u0026ldquo;f3\u0026rdquo; éƒ½å£°æ˜ Java å…ƒç»„çš„ç¬¬äºŒå’Œç¬¬å››å­—æ®µè¢«å‡½æ•°è¯»å–å’Œè¯„ä¼°ã€‚\nè¯»å–å­—æ®µä¿¡æ¯æ˜¯ä»¥å‡½æ•°ç±»æ³¨è§£çš„å½¢å¼æŒ‡å®šçš„ï¼Œä½¿ç”¨ä»¥ä¸‹æ³¨è§£ã€‚\n @ReadFields ç”¨äºå•è¾“å…¥å‡½æ•°ï¼Œå¦‚ Map å’Œ Reduceã€‚ @ReadFieldsFirst ç”¨äºæœ‰ä¸¤ä¸ªè¾“å…¥çš„å‡½æ•°çš„ç¬¬ä¸€ä¸ªè¾“å…¥ï¼Œå¦‚ Join å’Œ CoGroupã€‚ @ReadFieldsSecond ç”¨äºæœ‰ä¸¤ä¸ªè¾“å…¥çš„å‡½æ•°çš„ç¬¬äºŒä¸ªè¾“å…¥ï¼Œå¦‚ Join å’Œ CoGroupã€‚  ç¤ºä¾‹ï¼š\nä¸‹é¢çš„ä¾‹å­æ˜¾ç¤ºäº†å¦‚ä½•å£°æ˜è¯»å–å­—æ®µä¿¡æ¯ã€‚\n@ReadFields(\u0026#34;_1; _4\u0026#34;) // _1 and _4 are read and evaluated by the function. class MyMap extends MapFunction[(Int, Int, Int, Int), (Int, Int)]{ def map(value: (Int, Int, Int, Int)): (Int, Int) = { if (value._1 == 42) { return (value._1, value._2) } else { return (value._4 + 10, value._2) } } } å¹¿æ’­å˜é‡ å¹¿æ’­å˜é‡å…è®¸ä½ åœ¨æ“ä½œçš„å¸¸è§„è¾“å…¥ä¹‹å¤–ï¼Œå°†ä¸€ä¸ªæ•°æ®é›†æä¾›ç»™æ“ä½œçš„æ‰€æœ‰å¹¶è¡Œå®ä¾‹ã€‚è¿™å¯¹è¾…åŠ©æ•°æ®é›†æˆ–æ•°æ®ä¾èµ–æ€§å‚æ•°åŒ–å¾ˆæœ‰ç”¨ã€‚ç„¶åï¼Œè¯¥æ•°æ®é›†å°†ä½œä¸ºä¸€ä¸ªé›†åˆåœ¨æ“ä½œè€…å¤„è¢«è®¿é—®ã€‚\n å¹¿æ’­ï¼šå¹¿æ’­é›†é€šè¿‡ withBroadcastSet(DataSetï¼ŒString) æŒ‰åç§°æ³¨å†Œï¼Œå¹¶é€šè¿‡ è®¿é—®æ–¹å¼ï¼šé€šè¿‡ç›®æ ‡æ“ä½œè€…å¤„çš„ getRuntimeContext().getBroadcastVariable(String) è®¿é—®ã€‚  // 1. The DataSet to be broadcast val toBroadcast = env.fromElements(1, 2, 3) val data = env.fromElements(\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;) data.map(new RichMapFunction[String, String]() { var broadcastSet: Traversable[String] = null override def open(config: Configuration): Unit = { // 3. Access the broadcast DataSet as a Collection  broadcastSet = getRuntimeContext().getBroadcastVariable[String](\u0026#34;broadcastSetName\u0026#34;).asScala } def map(in: String): String = { ... } }).withBroadcastSet(toBroadcast, \u0026#34;broadcastSetName\u0026#34;) // 2. Broadcast the DataSet åœ¨æ³¨å†Œå’Œè®¿é—®å¹¿æ’­æ•°æ®é›†æ—¶ï¼Œç¡®ä¿åç§°ï¼ˆå‰é¢ä¾‹å­ä¸­çš„ broadcastSetNameï¼‰åŒ¹é…ã€‚å…³äºå®Œæ•´çš„ç¤ºä¾‹ç¨‹åºï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ KMeans ç®—æ³•ã€‚\næ³¨æ„ï¼šç”±äºå¹¿æ’­å˜é‡çš„å†…å®¹åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæ‰€ä»¥å®ƒä¸åº”è¯¥å˜å¾—å¤ªå¤§ã€‚å¯¹äºåƒæ ‡é‡å€¼è¿™æ ·ç®€å•çš„ä¸œè¥¿ï¼Œä½ å¯ä»¥ç®€å•åœ°å°†å‚æ•°ä½œä¸ºå‡½æ•°é—­åŒ…çš„ä¸€éƒ¨åˆ†ï¼Œæˆ–è€…ä½¿ç”¨ withParameters(...) æ–¹æ³•æ¥ä¼ é€’é…ç½®ã€‚\nåˆ†å¸ƒå¼ç¼“å­˜ Flink æä¾›äº†ä¸€ä¸ªç±»ä¼¼äº Apache Hadoop çš„åˆ†å¸ƒå¼ç¼“å­˜ï¼Œä»¥ä½¿ç”¨æˆ·å‡½æ•°çš„å¹¶è¡Œå®ä¾‹å¯ä»¥åœ¨æœ¬åœ°è®¿é—®æ–‡ä»¶ã€‚è¯¥åŠŸèƒ½å¯ç”¨äºå…±äº«åŒ…å«é™æ€å¤–éƒ¨æ•°æ®çš„æ–‡ä»¶ï¼Œå¦‚å­—å…¸æˆ–æœºå™¨å­¦ä¹ çš„å›å½’æ¨¡å‹ã€‚\nç¼“å­˜çš„å·¥ä½œåŸç†å¦‚ä¸‹ã€‚ç¨‹åºåœ¨å…¶ ExecutionEnvironment ä¸­ä»¥ç‰¹å®šçš„åç§°å°†æœ¬åœ°æˆ–è¿œç¨‹æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ HDFS æˆ– S3ï¼‰çš„æ–‡ä»¶æˆ–ç›®å½•æ³¨å†Œä¸ºç¼“å­˜æ–‡ä»¶ã€‚å½“ç¨‹åºæ‰§è¡Œæ—¶ï¼ŒFlink ä¼šè‡ªåŠ¨å°†è¯¥æ–‡ä»¶æˆ–ç›®å½•å¤åˆ¶åˆ°æ‰€æœ‰å·¥ä½œè€…çš„æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚ç”¨æˆ·å‡½æ•°å¯ä»¥æŸ¥æ‰¾æŒ‡å®šåç§°ä¸‹çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¹¶ä»å·¥ä½œè€…çš„æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­è®¿é—®å®ƒã€‚\nåˆ†å¸ƒå¼ç¼“å­˜çš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ã€‚\nåœ¨ ExecutionEnvironment ä¸­æ³¨å†Œæ–‡ä»¶æˆ–ç›®å½•ã€‚\nval env = ExecutionEnvironment.getExecutionEnvironment // register a file from HDFS env.registerCachedFile(\u0026#34;hdfs:///path/to/your/file\u0026#34;, \u0026#34;hdfsFile\u0026#34;) // register a local executable file (script, executable, ...) env.registerCachedFile(\u0026#34;file:///path/to/exec/file\u0026#34;, \u0026#34;localExecFile\u0026#34;, true) // define your program and execute ... val input: DataSet[String] = ... val result: DataSet[Integer] = input.map(new MyMapper()) ... env.execute() åœ¨ä¸€ä¸ªç”¨æˆ·å‡½æ•°ï¼ˆè¿™é‡Œæ˜¯ MapFunctionï¼‰ä¸­è®¿é—®ç¼“å­˜æ–‡ä»¶ã€‚è¯¥å‡½æ•°å¿…é¡»æ‰©å±•ä¸€ä¸ª RichFunction ç±»ï¼Œå› ä¸ºå®ƒéœ€è¦è®¿é—® RuntimeContextã€‚\n// extend a RichFunction to have access to the RuntimeContext class MyMapper extends RichMapFunction[String, Int] { override def open(config: Configuration): Unit = { // access cached file via RuntimeContext and DistributedCache  val myFile: File = getRuntimeContext.getDistributedCache.getFile(\u0026#34;hdfsFile\u0026#34;) // read the file (or navigate the directory)  ... } override def map(value: String): Int = { // use content of cached file  ... } } å‘å‡½æ•°ä¼ é€’å‚æ•° å¯ä»¥ä½¿ç”¨æ„é€ å‡½æ•°æˆ– withParameters(Configuration) æ–¹æ³•å°†å‚æ•°ä¼ é€’ç»™å‡½æ•°ã€‚å‚æ•°ä¼šè¢«åºåˆ—åŒ–ä¸ºå‡½æ•°å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¼ é€ç»™æ‰€æœ‰å¹¶è¡Œä»»åŠ¡å®ä¾‹ã€‚\né€šè¿‡æ„é€ å‡½æ•°\nval toFilter = env.fromElements(1, 2, 3) toFilter.filter(new MyFilter(2)) class MyFilter(limit: Int) extends FilterFunction[Int] { override def filter(value: Int): Boolean = { value \u0026gt; limit } } é€šè¿‡ withParameters(é…ç½®)\næœ¬æ–¹æ³•ä»¥ä¸€ä¸ª Configuration å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå®ƒå°†è¢«ä¼ é€’ç»™å¯Œå‡½æ•°çš„ open() æ–¹æ³•ã€‚é…ç½®å¯¹è±¡æ˜¯ä¸€ä¸ªä» String é”®åˆ°ä¸åŒå€¼ç±»å‹çš„ Mapã€‚\nval toFilter = env.fromElements(1, 2, 3) val c = new Configuration() c.setInteger(\u0026#34;limit\u0026#34;, 2) toFilter.filter(new RichFilterFunction[Int]() { var limit = 0 override def open(config: Configuration): Unit = { limit = config.getInteger(\u0026#34;limit\u0026#34;, 0) } def filter(in: Int): Boolean = { in \u0026gt; limit } }).withParameters(c) åœ¨å…¨å±€èŒƒå›´å†…é€šè¿‡ ExecutionConfig\nFlink è¿˜å…è®¸å°†è‡ªå®šä¹‰é…ç½®å€¼ä¼ é€’åˆ°ç¯å¢ƒçš„ ExecutionConfig æ¥å£ã€‚ç”±äºæ‰§è¡Œé…ç½®å¯ä»¥åœ¨æ‰€æœ‰ï¼ˆä¸°å¯Œçš„ï¼‰ç”¨æˆ·å‡½æ•°ä¸­è®¿é—®ï¼Œå› æ­¤è‡ªå®šä¹‰é…ç½®å°†åœ¨æ‰€æœ‰å‡½æ•°ä¸­å…¨å±€å¯ç”¨ã€‚\nè®¾ç½®ä¸€ä¸ªè‡ªå®šä¹‰çš„å…¨å±€é…ç½®ï¼š\nval env = ExecutionEnvironment.getExecutionEnvironment val conf = new Configuration() conf.setString(\u0026#34;mykey\u0026#34;, \u0026#34;myvalue\u0026#34;) env.getConfig.setGlobalJobParameters(conf) è¯·æ³¨æ„ï¼Œä½ ä¹Ÿå¯ä»¥ä¼ é€’ä¸€ä¸ªæ‰©å±• ExecutionConfig.GlobalJobParameters ç±»çš„è‡ªå®šä¹‰ç±»ä½œä¸ºå…¨å±€ä½œä¸šå‚æ•°ç»™æ‰§è¡Œé…ç½®ã€‚è¯¥æ¥å£å…è®¸å®ç° Map\u0026lt;String, String\u0026gt; toMap() æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°†åœ¨ web å‰ç«¯æ˜¾ç¤ºæ¥è‡ªé…ç½®çš„å€¼ã€‚\nä»å…¨å±€é…ç½®ä¸­è®¿é—®å€¼\nå…¨å±€å·¥ä½œå‚æ•°ä¸­çš„å¯¹è±¡åœ¨ç³»ç»Ÿä¸­çš„å¾ˆå¤šåœ°æ–¹éƒ½å¯ä»¥è®¿é—®ã€‚æ‰€æœ‰å®ç° RichFunction æ¥å£çš„ç”¨æˆ·å‡½æ•°éƒ½å¯ä»¥é€šè¿‡è¿è¡Œæ—¶ä¸Šä¸‹æ–‡è®¿é—®ã€‚\npublic static final class Tokenizer extends RichFlatMapFunction\u0026lt;String, Tuple2\u0026lt;String, Integer\u0026gt;\u0026gt; { private String mykey; @Override public void open(Configuration parameters) throws Exception { super.open(parameters); ExecutionConfig.GlobalJobParameters globalParams = getRuntimeContext().getExecutionConfig().getGlobalJobParameters(); Configuration globConf = (Configuration) globalParams; mykey = globConf.getString(\u0026#34;mykey\u0026#34;, null); } // ... more here ... åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/batch/\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-flink-dataset-api-programming-guide/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataSet API","Guide"],"title":"Flink Dataset API ç¼–ç¨‹æŒ‡å—"},{"categories":["Flink"],"contents":"Hadoop å…¼å®¹æ€§æµ‹è¯•ç‰ˆ Flink ä¸ Apache Hadoop MapReduce æ¥å£å…¼å®¹ï¼Œå› æ­¤å…è®¸é‡ç”¨ä¸º Hadoop MapReduce å®ç°çš„ä»£ç ã€‚\næ‚¨å¯ä»¥:\n åœ¨ Flink ç¨‹åºä¸­ä½¿ç”¨ Hadoop çš„å¯å†™æ•°æ®ç±»å‹ã€‚ ä½¿ç”¨ä»»ä½• Hadoop InputFormat ä½œä¸ºæ•°æ®æºã€‚ ä½¿ç”¨ä»»ä½• Hadoop è¾“å‡ºæ ¼å¼ä½œä¸ºæ•°æ®æ¥æ”¶å™¨ã€‚ å°† Hadoop Mapper ç”¨ä½œ FlatMapFunctionã€‚ ä½¿ç”¨ Hadoop Reducer ä½œä¸º GroupReduceFunctionã€‚  æœ¬æ–‡æ¡£å±•ç¤ºäº†å¦‚ä½•å°†ç°æœ‰çš„ Hadoop MapReduce ä»£ç ä¸ Flink ä¸€èµ·ä½¿ç”¨ã€‚ä» Hadoop æ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿè¯»å–ä»£ç ï¼Œè¯·å‚è€ƒè¿æ¥åˆ°å…¶ä»–ç³»ç»ŸæŒ‡å—ã€‚\né¡¹ç›®é…ç½® å¯¹ Hadoop è¾“å…¥/è¾“å‡ºæ ¼å¼çš„æ”¯æŒæ˜¯ flink-java å’Œ flink-scala Maven æ¨¡å—çš„ä¸€éƒ¨åˆ†ï¼Œè¿™äº›æ¨¡å—åœ¨ç¼–å†™ Flink ä½œä¸šæ—¶æ€»æ˜¯éœ€è¦çš„ã€‚è¿™äº›ä»£ç ä½äº org.apache.flink.api.java.hadoop å’Œ org.apache.flink.api.scala.hadoop ä¸­çš„ mapred å’Œ mapreduce API çš„é™„åŠ å­åŒ…ä¸­ã€‚\nå¯¹ Hadoop Mappers å’Œ Reducers çš„æ”¯æŒåŒ…å«åœ¨ flink-hadoop-compatibility Maven æ¨¡å—ä¸­ã€‚è¿™æ®µä»£ç ä½äº org.apache.flink.hadoopcompatibility åŒ…ä¸­ã€‚\nå¦‚æœæ‚¨æƒ³é‡ç”¨ Mappers å’Œ Reducersï¼Œè¯·åœ¨ pom.xml ä¸­æ·»åŠ ä»¥ä¸‹ä¾èµ–å…³ç³»ã€‚\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.flink\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flink-hadoop-compatibility_2.11\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.11.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; å¦è¯·å‚è§å¦‚ä½•é…ç½® hadoop ä¾èµ–å…³ç³»ã€‚\nä½¿ç”¨ Hadoop è¾“å…¥æ ¼å¼ è¦ä½¿ç”¨ Flink çš„ Hadoop InputFormatsï¼Œå¿…é¡»å…ˆä½¿ç”¨ HadoopInputs å®ç”¨ç¨‹åºç±»çš„ readHadoopFile æˆ– createHadoopInput æ¥åŒ…è£…æ ¼å¼ã€‚å‰è€…ç”¨äºä» FileInputFormat æ´¾ç”Ÿçš„è¾“å…¥æ ¼å¼ï¼Œè€Œåè€…å¿…é¡»ç”¨äºé€šç”¨çš„è¾“å…¥æ ¼å¼ã€‚é€šè¿‡ä½¿ç”¨ ExecutionEnvironmen#createInputï¼Œäº§ç”Ÿçš„ InputFormat å¯ä»¥ç”¨æ¥åˆ›å»ºæ•°æ®æºã€‚\nç”Ÿæˆçš„ DataSet åŒ…å« 2 ä¸ªå…ƒç»„ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå­—æ®µæ˜¯é”®ï¼Œç¬¬äºŒä¸ªå­—æ®µæ˜¯ä» Hadoop InputFormat ä¸­æ£€ç´¢çš„å€¼ã€‚\nä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Hadoop çš„ TextInputFormatã€‚\nval env = ExecutionEnvironment.getExecutionEnvironment val input: DataSet[(LongWritable, Text)] = env.createInput(HadoopInputs.readHadoopFile( new TextInputFormat, classOf[LongWritable], classOf[Text], textPath)) // Do something with the data. [...] ä½¿ç”¨ Hadoop è¾“å‡ºæ ¼å¼ Flink ä¸º Hadoop OutputFormat æä¾›äº†ä¸€ä¸ªå…¼å®¹æ€§å°è£…å™¨ï¼Œå®ƒæ”¯æŒä»»ä½•å®ç° org.apache.hadoop.mapred.OutputFormat æˆ–æ‰©å±• org.apache.hadoop.mapreduce.OutputFormat çš„ç±»ã€‚OutputFormat åŒ…è£…å™¨å¸Œæœ›å®ƒçš„è¾“å…¥æ•°æ®æ˜¯ä¸€ä¸ªåŒ…å«2ä¸ªkeyå’Œvalueçš„ DataSetã€‚è¿™äº›æ•°æ®å°†ç”± Hadoop OutputFormat å¤„ç†ã€‚\nä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Hadoop çš„ TextOutputFormatã€‚\n// Obtain your result to emit. val hadoopResult: DataSet[(Text, IntWritable)] = [...] val hadoopOF = new HadoopOutputFormat[Text,IntWritable]( new TextOutputFormat[Text, IntWritable], new JobConf) hadoopOF.getJobConf.set(\u0026#34;mapred.textoutputformat.separator\u0026#34;, \u0026#34; \u0026#34;) FileOutputFormat.setOutputPath(hadoopOF.getJobConf, new Path(resultPath)) hadoopResult.output(hadoopOF) ä½¿ç”¨ Hadoop Mappers å’Œ Reducers Hadoop Mappers åœ¨è¯­ä¹‰ä¸Šç­‰åŒäº Flink çš„ FlatMapFunctionsï¼ŒHadoop Reducers ç­‰åŒäº Flink çš„ GroupReduceFunctionsã€‚Flink ä¸º Hadoop MapReduce çš„ Mapper å’Œ Reducer æ¥å£çš„å®ç°æä¾›äº†å°è£…å™¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å¯ä»¥åœ¨å¸¸è§„çš„ Flink ç¨‹åºä¸­é‡ç”¨ä½ çš„ Hadoop Mapper å’Œ Reducerã€‚ç›®å‰ï¼Œåªæ”¯æŒ Hadoop çš„ mapred APIï¼ˆorg.apache.hadoop.mapredï¼‰çš„ Mapper å’Œ Reduce æ¥å£ã€‚\nåŒ…è£…å™¨å°†ä¸€ä¸ª DataSet\u0026lt;Tuple2\u0026lt;KEYIN,VALUEIN\u0026gt; ä½œä¸ºè¾“å…¥ï¼Œå¹¶äº§ç”Ÿä¸€ä¸ª DataSet\u0026lt;Tuple2\u0026lt;KEYOUT,VALUEOUT\u0026gt; ä½œä¸ºè¾“å‡ºï¼Œå…¶ä¸­ KEYIN å’Œ KEYOUT æ˜¯é”®ï¼ŒVALUEIN å’Œ VALUEOUT æ˜¯ Hadoop å‡½æ•°å¤„ç†çš„ Hadoop é”®å€¼å¯¹çš„å€¼ã€‚å¯¹äº Reducersï¼ŒFlink æä¾›äº†ä¸€ä¸ªåŒ…è£…å™¨ï¼Œç”¨äºå¸¦ï¼ˆHadoopReduceCombineFunctionï¼‰å’Œä¸å¸¦ Combinerï¼ˆHadoopReduceFunctionï¼‰çš„ GroupReduceFunctionã€‚åŒ…è£…å™¨æ¥å—ä¸€ä¸ªå¯é€‰çš„ JobConf å¯¹è±¡æ¥é…ç½® Hadoop Mapper æˆ– Reducerã€‚\nFlink çš„å‡½æ•°åŒ…è£…å™¨æœ‰:\n sorg.apache.flink.hadoopcompatibility.mapred.HadoopMapFunction, sorg.apache.flink.hadoopcompatibility.mapred.HadoopReduceFunction, å’Œ sorg.apache.flink.hadoopcompatibility.mapred.HadoopReduceCombineFunction.  å¹¶å¯ä½œä¸ºå¸¸è§„çš„ Flink FlatMapFunctions æˆ– GroupReduceFunctions ä½¿ç”¨ã€‚\nä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Hadoop Mapper å’Œ Reducer å‡½æ•°:\n// Obtain data to process somehow. DataSet\u0026lt;Tuple2\u0026lt;LongWritable, Text\u0026gt;\u0026gt; text = [...] DataSet\u0026lt;Tuple2\u0026lt;Text, LongWritable\u0026gt;\u0026gt; result = text // use Hadoop Mapper (Tokenizer) as MapFunction  .flatMap(new HadoopMapFunction\u0026lt;LongWritable, Text, Text, LongWritable\u0026gt;( new Tokenizer() )) .groupBy(0) // use Hadoop Reducer (Counter) as Reduce- and CombineFunction  .reduceGroup(new HadoopReduceCombineFunction\u0026lt;Text, LongWritable, Text, LongWritable\u0026gt;( new Counter(), new Counter() )); è¯·æ³¨æ„ï¼šReducer åŒ…è£…å™¨å·¥ä½œåœ¨ Flink çš„ groupBy() æ“ä½œæ‰€å®šä¹‰çš„ç»„ä¸Šã€‚å®ƒä¸è€ƒè™‘æ‚¨åœ¨ JobConf ä¸­è®¾ç½®çš„ä»»ä½•è‡ªå®šä¹‰åˆ†åŒºå™¨ã€æ’åºæˆ–åˆ†ç»„æ¯”è¾ƒå™¨ã€‚\nå®Œæ•´çš„ Hadoop WordCount ç¤ºä¾‹ ä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†ä½¿ç”¨ Hadoop æ•°æ®ç±»å‹ã€Input-å’Œ OutputFormats ä»¥åŠ Mapper å’Œ Reducer å®ç°çš„å®Œæ•´ WordCount å®ç°ã€‚\nExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment(); // Set up the Hadoop TextInputFormat. Job job = Job.getInstance(); HadoopInputFormat\u0026lt;LongWritable, Text\u0026gt; hadoopIF = new HadoopInputFormat\u0026lt;LongWritable, Text\u0026gt;( new TextInputFormat(), LongWritable.class, Text.class, job ); TextInputFormat.addInputPath(job, new Path(inputPath)); // Read data using the Hadoop TextInputFormat. DataSet\u0026lt;Tuple2\u0026lt;LongWritable, Text\u0026gt;\u0026gt; text = env.createInput(hadoopIF); DataSet\u0026lt;Tuple2\u0026lt;Text, LongWritable\u0026gt;\u0026gt; result = text // use Hadoop Mapper (Tokenizer) as MapFunction  .flatMap(new HadoopMapFunction\u0026lt;LongWritable, Text, Text, LongWritable\u0026gt;( new Tokenizer() )) .groupBy(0) // use Hadoop Reducer (Counter) as Reduce- and CombineFunction  .reduceGroup(new HadoopReduceCombineFunction\u0026lt;Text, LongWritable, Text, LongWritable\u0026gt;( new Counter(), new Counter() )); // Set up the Hadoop TextOutputFormat. HadoopOutputFormat\u0026lt;Text, LongWritable\u0026gt; hadoopOF = new HadoopOutputFormat\u0026lt;Text, LongWritable\u0026gt;( new TextOutputFormat\u0026lt;Text, LongWritable\u0026gt;(), job ); hadoopOF.getConfiguration().set(\u0026#34;mapreduce.output.textoutputformat.separator\u0026#34;, \u0026#34; \u0026#34;); TextOutputFormat.setOutputPath(job, new Path(outputPath)); // Emit data using the Hadoop TextOutputFormat. result.output(hadoopOF); // Execute Program env.execute(\u0026#34;Hadoop WordCount\u0026#34;); åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/batch/hadoop_compatibility.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-hadoop-compatibility-beta/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataSet API"],"title":"Hadoop çš„å…¼å®¹æ€§"},{"categories":["Flink"],"contents":"INSERT è¯­å¥ INSERT è¯­å¥ç”¨äºå‘è¡¨ä¸­æ·»åŠ è¡Œã€‚\nè¿è¡Œ INSERT è¯­å¥ å•æ¡ INSERT è¯­å¥å¯ä»¥é€šè¿‡ TableEnvironment çš„ executeSql() æ–¹æ³•æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨ SQL CLI ä¸­æ‰§è¡Œã€‚INSERT è¯­å¥çš„ executeSql() æ–¹æ³•ä¼šç«‹å³æäº¤ä¸€ä¸ª Flink ä½œä¸šï¼Œå¹¶è¿”å›ä¸€ä¸ªä¸æäº¤çš„ä½œä¸šç›¸å…³è”çš„ TableResult å®ä¾‹ã€‚å¤šä¸ª INSERT è¯­å¥å¯ä»¥é€šè¿‡ StatementSet çš„ addInsertSql() æ–¹æ³•æ‰§è¡Œï¼ŒStatementSet å¯ä»¥ç”± TableEnvironment.createStatementSet() æ–¹æ³•åˆ›å»ºã€‚addInsertSql() æ–¹æ³•æ˜¯ä¸€ç§æ‡’æƒ°çš„æ‰§è¡Œæ–¹å¼ï¼Œå®ƒä»¬åªæœ‰åœ¨è°ƒç”¨ StatementSet.execute() æ—¶æ‰ä¼šè¢«æ‰§è¡Œã€‚\nä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨ TableEnvironment ä¸­è¿è¡Œä¸€æ¡ INSERT è¯­å¥ï¼Œä»¥åŠåœ¨ SQL CLI ä¸­ï¼Œåœ¨ StatementSet ä¸­è¿è¡Œå¤šæ¡ INSERT è¯­å¥ã€‚\nFlink SQL\u0026gt; CREATE TABLE Orders (`user` BIGINT, product STRING, amount INT) WITH (...); [INFO] Table has been created. Flink SQL\u0026gt; CREATE TABLE RubberOrders(product STRING, amount INT) WITH (...); Flink SQL\u0026gt; SHOW TABLES; Orders RubberOrders Flink SQL\u0026gt; INSERT INTO RubberOrders SELECT product, amount FROM Orders WHERE product LIKE \u0026#39;%Rubber%\u0026#39;; [INFO] Submitting SQL update statement to the cluster... [INFO] Table update statement has been successfully submitted to the cluster: val settings = EnvironmentSettings.newInstance()... val tEnv = TableEnvironment.create(settings) // register a source table named \u0026#34;Orders\u0026#34; and a sink table named \u0026#34;RubberOrders\u0026#34; tEnv.executeSql(\u0026#34;CREATE TABLE Orders (`user` BIGINT, product STRING, amount INT) WITH (...)\u0026#34;) tEnv.executeSql(\u0026#34;CREATE TABLE RubberOrders(product STRING, amount INT) WITH (...)\u0026#34;) // run a single INSERT query on the registered source table and emit the result to registered sink table val tableResult1 = tEnv.executeSql( \u0026#34;INSERT INTO RubberOrders SELECT product, amount FROM Orders WHERE product LIKE \u0026#39;%Rubber%\u0026#39;\u0026#34;) // get job status through TableResult println(tableResult1.getJobClient().get().getJobStatus()) //---------------------------------------------------------------------------- // register another sink table named \u0026#34;GlassOrders\u0026#34; for multiple INSERT queries tEnv.executeSql(\u0026#34;CREATE TABLE GlassOrders(product VARCHAR, amount INT) WITH (...)\u0026#34;) // run multiple INSERT queries on the registered source table and emit the result to registered sink tables val stmtSet = tEnv.createStatementSet() // only single INSERT query can be accepted by `addInsertSql` method stmtSet.addInsertSql( \u0026#34;INSERT INTO RubberOrders SELECT product, amount FROM Orders WHERE product LIKE \u0026#39;%Rubber%\u0026#39;\u0026#34;) stmtSet.addInsertSql( \u0026#34;INSERT INTO GlassOrders SELECT product, amount FROM Orders WHERE product LIKE \u0026#39;%Glass%\u0026#39;\u0026#34;) // execute all statements together val tableResult2 = stmtSet.execute() // get job status through TableResult println(tableResult2.getJobClient().get().getJobStatus()) Insert from select queries æŸ¥è¯¢ç»“æœå¯ä»¥é€šè¿‡ä½¿ç”¨æ’å…¥å­å¥æ’å…¥åˆ°è¡¨ä¸­ã€‚\nè¯­æ³• INSERT{INTO|OVERWRITE}[catalog_name.][db_name.]table_name[PARTITIONpart_spec]select_statementpart_spec:(part_col_name1=val1[,part_col_name2=val2,...])OVERWRITE\nINSERT OVERWRITE å°†è¦†ç›–è¡¨æˆ–åˆ†åŒºä¸­çš„ä»»ä½•ç°æœ‰æ•°æ®ã€‚å¦åˆ™ï¼Œå°†è¿½åŠ æ–°æ•°æ®ã€‚\nPARTITION\nPARTITION å­å¥åº”åŒ…å«æœ¬æ¬¡æ’å…¥çš„é™æ€åˆ†åŒºåˆ—ã€‚\nä¾‹å­ -- Creates a partitioned table CREATETABLEcountry_page_view(userSTRING,cntINT,dateSTRING,countrySTRING)PARTITIONEDBY(date,country)WITH(...)-- Appends rows into the static partition (date=\u0026#39;2019-8-30\u0026#39;, country=\u0026#39;China\u0026#39;) INSERTINTOcountry_page_viewPARTITION(date=\u0026#39;2019-8-30\u0026#39;,country=\u0026#39;China\u0026#39;)SELECTuser,cntFROMpage_view_source;-- Appends rows into partition (date, country), where date is static partition with value \u0026#39;2019-8-30\u0026#39;, -- country is dynamic partition whose value is dynamic determined by each row. INSERTINTOcountry_page_viewPARTITION(date=\u0026#39;2019-8-30\u0026#39;)SELECTuser,cnt,countryFROMpage_view_source;-- Overwrites rows into static partition (date=\u0026#39;2019-8-30\u0026#39;, country=\u0026#39;China\u0026#39;) INSERTOVERWRITEcountry_page_viewPARTITION(date=\u0026#39;2019-8-30\u0026#39;,country=\u0026#39;China\u0026#39;)SELECTuser,cntFROMpage_view_source;-- Overwrites rows into partition (date, country), where date is static partition with value \u0026#39;2019-8-30\u0026#39;, -- country is dynamic partition whose value is dynamic determined by each row. INSERTOVERWRITEcountry_page_viewPARTITION(date=\u0026#39;2019-8-30\u0026#39;)SELECTuser,cnt,countryFROMpage_view_source;Insert values into tables INSERT\u0026hellip;VALUES è¯­å¥å¯ä»¥ç”¨æ¥ç›´æ¥ä» SQL ä¸­å‘è¡¨ä¸­æ’å…¥æ•°æ®ã€‚\nè¯­æ³• INSERT{INTO|OVERWRITE}[catalog_name.][db_name.]table_nameVALUESvalues_row[,values_row...]values_row::(val1[,val2,...])OVERWRITE\nINSERT OVERWRITE å°†è¦†ç›–è¡¨ä¸­çš„ä»»ä½•ç°æœ‰æ•°æ®ã€‚å¦åˆ™ï¼Œå°†è¿½åŠ æ–°æ•°æ®ã€‚\nä¾‹å­ CREATETABLEstudents(nameSTRING,ageINT,gpaDECIMAL(3,2))WITH(...);INSERTINTOstudentsVALUES(\u0026#39;fred flintstone\u0026#39;,35,1.28),(\u0026#39;barney rubble\u0026#39;,32,2.32);åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/sql/insert.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-insert-statements/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL","SQL"],"title":"Insert è¯­å¥"},{"categories":["Flink"],"contents":"Java Lambda è¡¨è¾¾å¼ Java 8 å¼•å…¥äº†ä¸€äº›æ–°çš„è¯­è¨€åŠŸèƒ½ï¼Œæ—¨åœ¨å®ç°æ›´å¿«ã€æ›´æ¸…æ™°çš„ç¼–ç ã€‚å…¶ä¸­æœ€é‡è¦çš„åŠŸèƒ½æ˜¯æ‰€è°“çš„\u0026quot;Lambda è¡¨è¾¾å¼\u0026quot;ï¼Œå®ƒæ‰“å¼€äº†å‡½æ•°å¼ç¼–ç¨‹çš„å¤§é—¨ã€‚Lambda è¡¨è¾¾å¼å…è®¸ä»¥ä¸€ç§ç›´æ¥çš„æ–¹å¼å®ç°å’Œä¼ é€’å‡½æ•°ï¼Œè€Œæ— éœ€å£°æ˜é¢å¤–çš„ï¼ˆåŒ¿åï¼‰ç±»ã€‚\næ³¨æ„ Flink æ”¯æŒå¯¹ Java API çš„æ‰€æœ‰æ“ä½œç¬¦ä½¿ç”¨ lambda è¡¨è¾¾å¼ï¼Œä½†æ˜¯ï¼Œæ¯å½“ lambda è¡¨è¾¾å¼ä½¿ç”¨ Java å±çš„æ—¶å€™ï¼Œä½ éœ€è¦æ˜ç¡®åœ°å£°æ˜ç±»å‹ä¿¡æ¯ã€‚\næœ¬æ–‡æ¡£å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ lambda è¡¨è¾¾å¼å¹¶æè¿°äº†å½“å‰çš„é™åˆ¶ã€‚å…³äº Flink API çš„ä¸€èˆ¬ä»‹ç»ï¼Œè¯·å‚è€ƒ DataSteam API æ¦‚è¿°ã€‚\nä¾‹å­å’Œé™åˆ¶ ä¸‹é¢çš„ä¾‹å­è¯´æ˜äº†å¦‚ä½•å®ç°ä¸€ä¸ªç®€å•çš„å†…è” map() å‡½æ•°ï¼Œè¯¥å‡½æ•°ä½¿ç”¨ lambda è¡¨è¾¾å¼å¯¹å…¶è¾“å…¥è¿›è¡Œå¹³æ–¹åŒ–ã€‚map() å‡½æ•°çš„è¾“å…¥ i å’Œè¾“å‡ºå‚æ•°çš„ç±»å‹ä¸éœ€è¦å£°æ˜ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ç”± Java ç¼–è¯‘å™¨æ¨æ–­çš„ã€‚\nenv.fromElements(1, 2, 3) // returns the squared i .map(i -\u0026gt; i*i) .print(); Flink å¯ä»¥ä»æ–¹æ³•ç­¾å OUT map(IN value) çš„å®ç°ä¸­è‡ªåŠ¨æå–ç»“æœç±»å‹ä¿¡æ¯ï¼Œå› ä¸º OUT ä¸æ˜¯é€šç”¨çš„ï¼Œè€Œæ˜¯ Integerã€‚\né—æ†¾çš„æ˜¯ï¼Œåƒ flatMap() è¿™æ ·ç­¾åä¸º void flatMap(IN value, Collector\u0026lt;OUT\u0026gt; out) çš„å‡½æ•°è¢« Java ç¼–è¯‘å™¨ç¼–è¯‘æˆ void flatMap(IN value, Collector out)ã€‚è¿™ä½¿å¾— Flink æ— æ³•è‡ªåŠ¨æ¨æ–­è¾“å‡ºç±»å‹çš„ç±»å‹ä¿¡æ¯ã€‚\nFlink å¾ˆå¯èƒ½ä¼šæŠ›å‡ºä¸€ä¸ªç±»ä¼¼ä¸‹é¢çš„å¼‚å¸¸ã€‚\norg.apache.flink.api.common.functions.InvalidTypesException: The generic type parameters of 'Collector' are missing. In many cases lambda methods don't provide enough information for automatic type extraction when Java generics are involved. An easy workaround is to use an (anonymous) class instead that implements the 'org.apache.flink.api.common.functions.FlatMapFunction' interface. Otherwise the type has to be specified explicitly using type information. åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦æ˜ç¡®æŒ‡å®šç±»å‹ä¿¡æ¯ï¼Œå¦åˆ™è¾“å‡ºå°†è¢«è§†ä¸ºç±»å‹ä¸º Objectï¼Œå¯¼è‡´åºåˆ—åŒ–æ•ˆç‡ä½ä¸‹ã€‚\nimport org.apache.flink.api.common.typeinfo.Types; import org.apache.flink.api.java.DataSet; import org.apache.flink.util.Collector; DataSet\u0026lt;Integer\u0026gt; input = env.fromElements(1, 2, 3); // collector type must be declared input.flatMap((Integer number, Collector\u0026lt;String\u0026gt; out) -\u0026gt; { StringBuilder builder = new StringBuilder(); for(int i = 0; i \u0026lt; number; i++) { builder.append(\u0026#34;a\u0026#34;); out.collect(builder.toString()); } }) // provide type information explicitly .returns(Types.STRING) // prints \u0026#34;a\u0026#34;, \u0026#34;a\u0026#34;, \u0026#34;aa\u0026#34;, \u0026#34;a\u0026#34;, \u0026#34;aa\u0026#34;, \u0026#34;aaa\u0026#34; .print(); å½“ä½¿ç”¨å…·æœ‰é€šç”¨è¿”å›ç±»å‹çš„ map() å‡½æ•°æ—¶ï¼Œä¹Ÿä¼šå‡ºç°ç±»ä¼¼çš„é—®é¢˜ã€‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œä¸€ä¸ªæ–¹æ³•ç­¾å Tuple2\u0026lt;Integer, Integer\u0026gt; map(Integer value) è¢«æ“¦é™¤ä¸º Tuple2 map(Integer value)ã€‚\nimport org.apache.flink.api.common.functions.MapFunction; import org.apache.flink.api.java.tuple.Tuple2; env.fromElements(1, 2, 3) .map(i -\u0026gt; Tuple2.of(i, i)) // no information about fields of Tuple2  .print(); ä¸€èˆ¬æ¥è¯´ï¼Œè¿™äº›é—®é¢˜å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼è§£å†³ã€‚\nimport org.apache.flink.api.common.typeinfo.Types; import org.apache.flink.api.java.tuple.Tuple2; // use the explicit \u0026#34;.returns(...)\u0026#34; env.fromElements(1, 2, 3) .map(i -\u0026gt; Tuple2.of(i, i)) .returns(Types.TUPLE(Types.INT, Types.INT)) .print(); // use a class instead env.fromElements(1, 2, 3) .map(new MyTuple2Mapper()) .print(); public static class MyTuple2Mapper extends MapFunction\u0026lt;Integer, Tuple2\u0026lt;Integer, Integer\u0026gt;\u0026gt; { @Override public Tuple2\u0026lt;Integer, Integer\u0026gt; map(Integer i) { return Tuple2.of(i, i); } } // use an anonymous class instead env.fromElements(1, 2, 3) .map(new MapFunction\u0026lt;Integer, Tuple2\u0026lt;Integer, Integer\u0026gt;\u0026gt; { @Override public Tuple2\u0026lt;Integer, Integer\u0026gt; map(Integer i) { return Tuple2.of(i, i); } }) .print(); // or in this example use a tuple subclass instead env.fromElements(1, 2, 3) .map(i -\u0026gt; new DoubleTuple(i, i)) .print(); public static class DoubleTuple extends Tuple2\u0026lt;Integer, Integer\u0026gt; { public DoubleTuple(int f0, int f1) { this.f0 = f0; this.f1 = f1; } } åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/java_lambdas.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-java-lambda-expressions/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataStream API"],"title":"Java Lambda è¡¨è¾¾å¼"},{"categories":["Flink"],"contents":"çª—å£è¿æ¥(Join) çª—å£è¿æ¥(window join)å°†ä¸¤ä¸ªæµçš„å…ƒç´ è¿æ¥èµ·æ¥ï¼Œè¿™ä¸¤ä¸ªæµæœ‰ä¸€ä¸ªå…±åŒçš„é”®ï¼Œå¹¶ä¸”ä½äºåŒä¸€ä¸ªçª—å£ä¸­ã€‚è¿™äº›çª—å£å¯ä»¥é€šè¿‡ä½¿ç”¨çª—å£åˆ†é…å™¨æ¥å®šä¹‰ï¼Œå¹¶å¯¹ä¸¤ä¸ªæµçš„å…ƒç´ è¿›è¡Œè¯„ä¼°ã€‚\nç„¶åï¼Œæ¥è‡ªåŒæ–¹çš„å…ƒç´ è¢«ä¼ é€’åˆ°ä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„ JoinFunction æˆ– FlatJoinFunction ä¸­ï¼Œç”¨æˆ·å¯ä»¥å‘å‡ºç¬¦åˆåŠ å…¥æ ‡å‡†çš„ç»“æœã€‚\nä¸€èˆ¬çš„ç”¨æ³•å¯ä»¥å½’çº³ä¸ºä»¥ä¸‹å‡ ç‚¹ã€‚\nstream.join(otherStream) .where(\u0026lt;KeySelector\u0026gt;) .equalTo(\u0026lt;KeySelector\u0026gt;) .window(\u0026lt;WindowAssigner\u0026gt;) .apply(\u0026lt;JoinFunction\u0026gt;) å…³äºè¯­ä¹‰çš„ä¸€äº›è¯´æ˜:\n ä¸¤ä¸ªæµä¸­å…ƒç´ çš„æˆå¯¹ç»„åˆçš„åˆ›å»ºå°±åƒä¸€ä¸ªå†…éƒ¨è¿æ¥ï¼Œè¿™æ„å‘³ç€ä¸€ä¸ªæµä¸­çš„å…ƒç´ å¦‚æœæ²¡æœ‰å¦ä¸€ä¸ªæµä¸­çš„ç›¸åº”å…ƒç´ ä¸ä¹‹è¿æ¥ï¼Œå°±ä¸ä¼šå‘å‡ºã€‚ é‚£äº›è¢«åŠ å…¥çš„å…ƒç´ å°†ä»¥å„è‡ªçª—å£ä¸­æœ€å¤§çš„æ—¶é—´æˆ³ä½œä¸ºå®ƒä»¬çš„æ—¶é—´æˆ³ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªä»¥ [5, 10) ä¸ºè¾¹ç•Œçš„çª—å£å°†å¯¼è‡´åŠ å…¥çš„å…ƒç´ ä»¥9ä½œä¸ºå®ƒä»¬çš„æ—¶é—´æˆ³ã€‚  åœ¨ä¸‹é¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€äº›ç¤ºä¾‹æ€§çš„åœºæ™¯æ¥æ¦‚è¿°ä¸åŒç±»å‹çš„çª—å£è¿æ¥æ˜¯å¦‚ä½•è¿›è¡Œçš„ã€‚\næ»šåŠ¨çª—å£è¿æ¥ å½“æ‰§è¡Œæ»šåŠ¨çª—å£è¿æ¥æ—¶ï¼Œæ‰€æœ‰å…·æœ‰å…±åŒçš„é”®å’Œå…±åŒçš„æ»šåŠ¨çª—å£çš„å…ƒç´ éƒ½ä¼šä»¥æˆå¯¹ç»„åˆçš„æ–¹å¼è¿›è¡Œè¿æ¥ï¼Œå¹¶ä¼ é€’ç»™ JoinFunction æˆ– FlatJoinFunctionã€‚å› ä¸ºè¿™è¡¨ç°å¾—åƒä¸€ä¸ªå†…è¿æ¥ï¼Œæ‰€ä»¥ä¸€ä¸ªæµçš„å…ƒç´ å¦‚æœåœ¨å…¶æ»šåŠ¨çª—å£ä¸­æ²¡æœ‰æ¥è‡ªå¦ä¸€ä¸ªæµçš„å…ƒç´ ï¼Œå°±ä¸ä¼šè¢«å‘å‡ºå»ï¼è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦æŠŠä¸€ä¸ªæµçš„å…ƒç´ åŠ å…¥åˆ°æ»šåŠ¨çª—å£ä¸­ã€‚\nå¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå¤§å°ä¸º2æ¯«ç§’çš„æ»šåŠ¨çª—å£ï¼Œå…¶ç»“æœæ˜¯ [0,1]ï¼Œ[2,3]ï¼Œ\u0026hellip;å½¢å¼çš„çª—å£ã€‚å›¾ä¸­æ˜¾ç¤ºäº†æ¯ä¸ªçª—å£ä¸­æ‰€æœ‰å…ƒç´ çš„é…å¯¹ç»„åˆï¼Œè¿™äº›å…ƒç´ å°†è¢«ä¼ é€’ç»™ JoinFunctionã€‚è¯·æ³¨æ„ï¼Œåœ¨ç¿»æ»šçª—å£ [6,7] ä¸­ï¼Œæ²¡æœ‰ä»»ä½•å…ƒç´ å‘å‡ºï¼Œå› ä¸ºç»¿è‰²æµä¸­æ²¡æœ‰å…ƒç´ å­˜åœ¨ï¼Œè¦ä¸æ©™è‰²å…ƒç´ â‘¥å’Œâ‘¦è¿æ¥ã€‚\nimport org.apache.flink.streaming.api.windowing.assigners.SlidingEventTimeWindows; import org.apache.flink.streaming.api.windowing.time.Time; ... val orangeStream: DataStream[Integer] = ... val greenStream: DataStream[Integer] = ... orangeStream.join(greenStream) .where(elem =\u0026gt; /* select key */) .equalTo(elem =\u0026gt; /* select key */) .window(TumblingEventTimeWindows.of(Time.milliseconds(2))) .apply { (e1, e2) =\u0026gt; e1 + \u0026#34;,\u0026#34; + e2 } æ»‘åŠ¨çª—è¿æ¥ åœ¨æ‰§è¡Œæ»‘åŠ¨çª—å£è¿æ¥æ—¶ï¼Œæ‰€æœ‰å…·æœ‰å…±åŒé”®å’Œå…±åŒæ»‘åŠ¨çª—å£çš„å…ƒç´ éƒ½ä¼šä»¥æˆå¯¹ç»„åˆçš„æ–¹å¼è¿æ¥ï¼Œå¹¶ä¼ é€’ç»™ JoinFunction æˆ– FlatJoinFunctionã€‚ä¸€ä¸ªæµçš„å…ƒç´ å¦‚æœåœ¨å½“å‰çš„æ»‘åŠ¨çª—å£ä¸­æ²¡æœ‰æ¥è‡ªå¦ä¸€ä¸ªæµçš„å…ƒç´ ï¼Œåˆ™ä¸ä¼šè¢«å‘å‡º! è¯·æ³¨æ„ï¼Œæœ‰äº›å…ƒç´ å¯èƒ½åœ¨ä¸€ä¸ªæ»‘åŠ¨çª—å£ä¸­è¢«åŠ å…¥ï¼Œä½†åœ¨å¦ä¸€ä¸ªæ»‘åŠ¨çª—å£ä¸­å´æ²¡æœ‰!\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å¤§å°ä¸ºä¸¤æ¯«ç§’çš„æ»‘åŠ¨çª—å£ï¼Œå¹¶å°†å®ƒä»¬æ»‘åŠ¨ä¸€æ¯«ç§’ï¼Œç»“æœæ˜¯æ»‘åŠ¨çª—å£ [-1ï¼Œ0]ï¼Œ[0ï¼Œ1]ï¼Œ[1ï¼Œ2]ï¼Œ[2ï¼Œ3]ï¼Œ\u0026hellip;ã€‚xè½´ä¸‹é¢çš„åŠ å…¥å…ƒç´ å°±æ˜¯æ¯ä¸ªæ»‘åŠ¨çª—å£ä¼ é€’ç»™ JoinFunction çš„å…ƒç´ ã€‚è¿™é‡Œä½ ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œä¾‹å¦‚æ©™è‰²çš„â‘¡ä¸ç»¿è‰²çš„â‘¢åœ¨çª—å£ [2,3] ä¸­è¿æ¥ï¼Œä½†ä¸çª—å£ [1,2] ä¸­çš„ä»»ä½•å…ƒç´ éƒ½æ²¡æœ‰è¿æ¥ã€‚\nimport org.apache.flink.streaming.api.windowing.assigners.SlidingEventTimeWindows; import org.apache.flink.streaming.api.windowing.time.Time; ... val orangeStream: DataStream[Integer] = ... val greenStream: DataStream[Integer] = ... orangeStream.join(greenStream) .where(elem =\u0026gt; /* select key */) .equalTo(elem =\u0026gt; /* select key */) .window(SlidingEventTimeWindows.of(Time.milliseconds(2) /* size */, Time.milliseconds(1) /* slide */)) .apply { (e1, e2) =\u0026gt; e1 + \u0026#34;,\u0026#34; + e2 } ä¼šè®®çª—å£è¿æ¥ å½“æ‰§è¡Œä¼šè¯çª—å£è¿æ¥æ—¶ï¼Œæ‰€æœ‰å…·æœ‰ç›¸åŒé”®çš„å…ƒç´ ï¼Œå½“\u0026quot;ç»„åˆ\u0026quot;æ»¡è¶³ä¼šè¯æ ‡å‡†æ—¶ï¼Œå°†ä»¥æˆå¯¹ç»„åˆçš„æ–¹å¼è¿æ¥ï¼Œå¹¶ä¼ é€’ç»™ JoinFunction æˆ– FlatJoinFunctionã€‚åŒæ ·ï¼Œè¿™ä¹Ÿæ˜¯æ‰§è¡Œå†…éƒ¨è¿æ¥ï¼Œæ‰€ä»¥å¦‚æœæœ‰ä¸€ä¸ªä¼šè¯çª—å£åªåŒ…å«æ¥è‡ªä¸€ä¸ªæµçš„å…ƒç´ ï¼Œå°±ä¸ä¼šæœ‰è¾“å‡ºã€‚\nåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªä¼šè¯çª—å£åŠ å…¥ï¼Œå…¶ä¸­æ¯ä¸ªä¼šè¯è¢«è‡³å°‘1msçš„é—´éš™æ‰€åˆ†å‰²ã€‚æœ‰ä¸‰ä¸ªä¼šè¯ï¼Œåœ¨å‰ä¸¤ä¸ªä¼šè¯ä¸­ï¼Œä¸¤ä¸ªæµä¸­çš„åŠ å…¥å…ƒç´ éƒ½ä¼šä¼ é€’ç»™ JoinFunctionã€‚åœ¨ç¬¬ä¸‰ä¸ªä¼šè¯ä¸­ï¼Œç»¿è‰²æµä¸­æ²¡æœ‰å…ƒç´ ï¼Œæ‰€ä»¥â‘§å’Œâ‘¨æ²¡æœ‰åŠ å…¥ï¼åœ¨ç¬¬ä¸‰ä¸ªä¼šè¯ä¸­ï¼Œç»¿è‰²æµä¸­æ²¡æœ‰å…ƒç´ ã€‚\nimport org.apache.flink.streaming.api.windowing.assigners.EventTimeSessionWindows; import org.apache.flink.streaming.api.windowing.time.Time; ... val orangeStream: DataStream[Integer] = ... val greenStream: DataStream[Integer] = ... orangeStream.join(greenStream) .where(elem =\u0026gt; /* select key */) .equalTo(elem =\u0026gt; /* select key */) .window(EventTimeSessionWindows.withGap(Time.milliseconds(1))) .apply { (e1, e2) =\u0026gt; e1 + \u0026#34;,\u0026#34; + e2 } é—´éš”è¿æ¥ é—´éš”è¿æ¥å°†ä¸¤ä¸ªæµçš„å…ƒç´ ï¼ˆæˆ‘ä»¬æš‚ä¸”ç§°å®ƒä»¬ä¸ºAå’ŒBï¼‰ç”¨ä¸€ä¸ªå…±åŒçš„é”®è¿æ¥èµ·æ¥ï¼ŒæµBä¸­çš„å…ƒç´ çš„æ—¶é—´æˆ³ä¸æµAä¸­å…ƒç´ çš„æ—¶é—´æˆ³å¤„äºä¸€ä¸ªç›¸å¯¹çš„æ—¶é—´é—´éš”ã€‚\nè¿™ä¹Ÿå¯ä»¥æ›´æ­£å¼åœ°è¡¨è¾¾ä¸º b.timestampâˆˆ[a.timestamp + lowerBound; a.timestamp + upperBound] æˆ– a.timestamp + lowerBound \u0026lt;= b.timestamp \u0026lt;= a.timestamp + upperBoundã€‚\nå…¶ä¸­aå’Œbæ˜¯Aå’ŒBçš„å…ƒç´ ï¼Œå®ƒä»¬æœ‰ä¸€ä¸ªå…±åŒçš„é”®ã€‚ä¸‹ç•Œå’Œä¸Šç•Œéƒ½å¯ä»¥æ˜¯è´Ÿçš„æˆ–æ­£çš„ï¼Œåªè¦ä¸‹ç•Œæ€»æ˜¯å°äºæˆ–ç­‰äºä¸Šç•Œã€‚åŒºé—´è¿æ¥ç›®å‰åªæ‰§è¡Œå†…è¿æ¥ã€‚\nå½“ä¸€å¯¹å…ƒç´ ä¼ é€’ç»™ ProcessJoinFunction æ—¶ï¼Œå®ƒä»¬å°†è¢«åˆ†é…ä¸ºä¸¤ä¸ªå…ƒç´ ä¸­è¾ƒå¤§çš„æ—¶é—´æˆ³ï¼ˆå¯ä»¥é€šè¿‡ ProcessJoinFunction.Context è®¿é—®ï¼‰ã€‚\næ³¨æ„ï¼šé—´éš”è¿æ¥ç›®å‰åªæ”¯æŒäº‹ä»¶æ—¶é—´ã€‚\nåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†ä¸¤ä¸ªæµ\u0026quot;æ©™è‰²\u0026quot;å’Œ\u0026quot;ç»¿è‰²\u0026quot;è¿æ¥èµ·æ¥ï¼Œä¸‹ç•Œä¸º-2æ¯«ç§’ï¼Œä¸Šç•Œä¸º+1æ¯«ç§’ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›è¾¹ç•Œæ˜¯åŒ…å®¹çš„ï¼Œä½†å¯ä»¥åº”ç”¨ .lowerBoundExclusive() å’Œ .upperBoundExclusive æ¥æ”¹å˜è¡Œä¸ºã€‚\nå†æ¬¡ä½¿ç”¨æ›´æ­£å¼çš„ç¬¦å·ï¼Œè¿™å°†è¢«ç¿»è¯‘ä¸º:\norangeElem.ts + lowerBound \u0026lt;= greenElem.ts \u0026lt;= orangeElem.ts + upperBound as indicated by the triangles.\nimport org.apache.flink.streaming.api.functions.co.ProcessJoinFunction; import org.apache.flink.streaming.api.windowing.time.Time; ... val orangeStream: DataStream[Integer] = ... val greenStream: DataStream[Integer] = ... orangeStream .keyBy(elem =\u0026gt; /* select key */) .intervalJoin(greenStream.keyBy(elem =\u0026gt; /* select key */)) .between(Time.milliseconds(-2), Time.milliseconds(1)) .process(new ProcessJoinFunction[Integer, Integer, String] { override def processElement(left: Integer, right: Integer, ctx: ProcessJoinFunction[Integer, Integer, String]#Context, out: Collector[String]): Unit = { out.collect(left + \u0026#34;,\u0026#34; + right); } }); }); åŸæ–‡è¿æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/stream/operators/joining.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-joining/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataStream API","Operators","Joining"],"title":"Joining"},{"categories":["Flink"],"contents":"æ“ä½œç¬¦ æ“ä½œç¬¦å°†ä¸€ä¸ªæˆ–å¤šä¸ª DataStream è½¬æ¢ä¸ºä¸€ä¸ªæ–°çš„ DataStreamã€‚ç¨‹åºå¯ä»¥å°†å¤šä¸ªå˜æ¢ç»„åˆæˆå¤æ‚çš„æ•°æ®æµæ‹“æ‰‘ã€‚\næœ¬èŠ‚ç»™å‡ºäº†åŸºæœ¬å˜æ¢çš„æè¿°ï¼Œåº”ç”¨è¿™äº›å˜æ¢åçš„æœ‰æ•ˆç‰©ç†åˆ†åŒºï¼Œä»¥åŠå¯¹ Flink çš„æ“ä½œç¬¦é“¾çš„è§è§£ã€‚\nDataStream è½¬æ¢  Map  DataStream â†’ DataStream\næ¥å—ä¸€ä¸ªå…ƒç´ å¹¶äº§ç”Ÿä¸€ä¸ªå…ƒç´ ã€‚ä¸€ä¸ªå°†è¾“å…¥æµçš„å€¼ç¿»å€çš„ map å‡½æ•°:\ndataStream.map { x =\u0026gt; x * 2 }  FlatMap  DataStream â†’ DataStream\næ¥å—ä¸€ä¸ªå…ƒç´ å¹¶äº§ç”Ÿé›¶ä¸ªã€ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ã€‚ä¸€ä¸ªå°†å¥å­åˆ†å‰²æˆå•è¯çš„ flatMap å‡½æ•°:\ndataStream.flatMap { str =\u0026gt; str.split(\u0026#34; \u0026#34;) }  Filter  DataStream â†’ DataStream\nè¯„ä¼°æ¯ä¸ªå…ƒç´ çš„å¸ƒå°”å‡½æ•°ï¼Œå¹¶ä¿ç•™é‚£äº›å‡½æ•°è¿”å›å€¼ä¸ºçœŸçš„å…ƒç´ ã€‚ä¸€ä¸ªè¿‡æ»¤æ‰é›¶å€¼çš„ filter:\ndataStream.filter { _ != 0 }  KeyBy  DataStream â†’ KeyedStream\nåœ¨é€»è¾‘ä¸Šå°†ä¸€ä¸ªæµåˆ’åˆ†ä¸ºäº’æ–¥çš„åˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºåŒ…å«ç›¸åŒé”®çš„å…ƒç´ ã€‚åœ¨å†…éƒ¨ï¼Œè¿™æ˜¯é€šè¿‡å“ˆå¸Œåˆ†åŒºå®ç°çš„ã€‚å…³äºå¦‚ä½•æŒ‡å®šé”®ï¼Œè¯·å‚è§ keysã€‚è¿™ä¸ªè½¬æ¢ä¼šè¿”å›ä¸€ä¸ª KeyedStream:\ndataStream.keyBy(\u0026#34;someKey\u0026#34;) // Key by field \u0026#34;someKey\u0026#34; dataStream.keyBy(0) // Key by the first element of a Tuple  Reduce  KeyedStream â†’ DataStream\nåœ¨ keyed æ•°æ®æµä¸Šè¿›è¡Œ\u0026quot;æ»šåŠ¨\u0026quot;æ¢ç®—(reduce)ã€‚å°†å½“å‰å…ƒç´ ä¸æœ€åä¸€ä¸ªæ¢ç®—çš„å€¼åˆå¹¶ï¼Œå¹¶å‘å‡ºæ–°çš„å€¼ã€‚\nä¸€ä¸ªåˆ›å»ºéƒ¨åˆ†å’Œ(sum)æµçš„ reduce å‡½æ•°:\nkeyedStream.reduce { _ + _ }  Fold  KeyedStream â†’ DataStream\nåœ¨ä¸€ä¸ªå¸¦æœ‰åˆå§‹å€¼çš„ keyed æ•°æ®æµä¸Šè¿›è¡Œ\u0026quot;æ»šåŠ¨\u0026quot;æŠ˜å ã€‚å°†å½“å‰å…ƒç´ ä¸æœ€åä¸€ä¸ªæŠ˜å çš„å€¼ç»“åˆèµ·æ¥ï¼Œå¹¶å‘å‡ºæ–°çš„å€¼ã€‚\nä¸€ä¸ªæŠ˜å å‡½æ•°ï¼Œå½“åº”ç”¨äºåºåˆ—(1,2,3,4,5)æ—¶ï¼Œå‘å‡ºåºåˆ— \u0026ldquo;start-1\u0026rdquo;ã€\u0026ldquo;start-1-2\u0026rdquo;ã€\u0026ldquo;start-1-2-3\u0026rdquo;ã€\u0026hellip;\nval result: DataStream[String] = keyedStream.fold(\u0026#34;start\u0026#34;)((str, i) =\u0026gt; { str + \u0026#34;-\u0026#34; + i })  Aggregations  KeyedStream â†’ DataStream\nåœ¨ keyed æ•°æ®æµä¸Šè¿›è¡Œæ»šåŠ¨èšåˆã€‚min å’Œ minBy çš„åŒºåˆ«åœ¨äº min è¿”å›æœ€å°å€¼ï¼Œè€Œ minBy åˆ™è¿”å›è¯¥å­—æ®µä¸­å…·æœ‰æœ€å°å€¼çš„å…ƒç´ ï¼ˆmax å’Œ maxBy ä¹Ÿä¸€æ ·ï¼‰ã€‚\nkeyedStream.sum(0) keyedStream.sum(\u0026#34;key\u0026#34;) keyedStream.min(0) keyedStream.min(\u0026#34;key\u0026#34;) keyedStream.max(0) keyedStream.max(\u0026#34;key\u0026#34;) keyedStream.minBy(0) keyedStream.minBy(\u0026#34;key\u0026#34;) keyedStream.maxBy(0) keyedStream.maxBy(\u0026#34;key\u0026#34;)  Window  KeyedStream â†’ WindowedStream\nå¯ä»¥åœ¨å·²ç»åˆ†åŒºçš„ KeyedStream ä¸Šå®šä¹‰ Windowã€‚çª—å£æ ¹æ®ä¸€äº›ç‰¹å¾ï¼ˆä¾‹å¦‚ï¼Œæœ€è¿‘5ç§’å†…åˆ°è¾¾çš„æ•°æ®ï¼‰å¯¹æ¯ä¸ªé”®ä¸­çš„æ•°æ®è¿›è¡Œåˆ†ç»„ã€‚å…³äºçª—å£çš„æè¿°ï¼Œè¯·å‚è§çª—å£ã€‚\ndataStream.keyBy(0).window(TumblingEventTimeWindows.of(Time.seconds(5))) // Last 5 seconds of data  WindowAll  DataStream â†’ AllWindowedStream\nå¯ä»¥åœ¨å¸¸è§„çš„ DataStream ä¸Šå®šä¹‰çª—å£ã€‚çª—å£æ ¹æ®ä¸€äº›ç‰¹å¾ï¼ˆä¾‹å¦‚ï¼Œåœ¨è¿‡å»5ç§’å†…åˆ°è¾¾çš„æ•°æ®ï¼‰å¯¹æ‰€æœ‰æµäº‹ä»¶è¿›è¡Œåˆ†ç»„ã€‚å…³äºçª—å£çš„å®Œæ•´æè¿°ï¼Œè¯·å‚è§çª—å£ã€‚\nè­¦å‘Šï¼šåœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¹¶è¡Œçš„è½¬æ¢ã€‚æ‰€æœ‰çš„è®°å½•å°†è¢«æ”¶é›†åœ¨ windowAll æ“ä½œç¬¦çš„ä¸€ä¸ªä»»åŠ¡(task)ä¸­ã€‚\ndataStream.windowAll(TumblingEventTimeWindows.of(Time.seconds(5))) // Last 5 seconds of data  Window Apply  WindowedStream â†’ DataStream\nAllWindowedStream â†’ DataStream\nå°†ä¸€èˆ¬å‡½æ•°åº”ç”¨äºæ•´ä¸ªçª—å£ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªæ‰‹åŠ¨æ±‚å’Œçª—å£å…ƒç´ çš„å‡½æ•°ã€‚\næ³¨æ„ï¼šå¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ windowAll è½¬æ¢ï¼Œæ‚¨éœ€è¦ä½¿ç”¨ AllWindowFunction æ¥ä»£æ›¿ã€‚\nwindowedStream.apply { WindowFunction } // applying an AllWindowFunction on non-keyed window stream allWindowedStream.apply { AllWindowFunction }  Window Reduce  WindowedStream â†’ DataStream\nå¯¹çª—å£åº”ç”¨å‡½æ•°å¼çš„ reduce  å‡½æ•°ï¼Œå¹¶è¿”å›æ¢ç®—åçš„å€¼:\nwindowedStream.reduce { _ + _ }  Window Fold  WindowedStream â†’ DataStream\nå¯¹çª—å£åº”ç”¨åŠŸèƒ½ fold å‡½æ•°å¹¶è¿”å›æŠ˜å åçš„å€¼ã€‚ç¤ºä¾‹å‡½æ•°åº”ç”¨äºåºåˆ— (1,2,3,4,5) æ—¶ï¼Œå°†åºåˆ—æŠ˜å æˆå­—ç¬¦ä¸² \u0026ldquo;start-1-2-3-4-5\u0026rdquo;:\nval result: DataStream[String] = windowedStream.fold(\u0026#34;start\u0026#34;, (str, i) =\u0026gt; { str + \u0026#34;-\u0026#34; + i })  çª—å£ä¸Šçš„èšåˆ  WindowedStream â†’ DataStream\nèšåˆä¸€ä¸ªçª—å£çš„å†…å®¹ã€‚min å’Œ minBy çš„åŒºåˆ«åœ¨äº min è¿”å›æœ€å°å€¼ï¼Œè€Œ minBy è¿”å›åœ¨è¯¥å­—æ®µä¸­å…·æœ‰æœ€å°å€¼çš„å…ƒç´ ï¼ˆmax å’Œ maxBy ç›¸åŒï¼‰ã€‚\nwindowedStream.sum(0) windowedStream.sum(\u0026#34;key\u0026#34;) windowedStream.min(0) windowedStream.min(\u0026#34;key\u0026#34;) windowedStream.max(0) windowedStream.max(\u0026#34;key\u0026#34;) windowedStream.minBy(0) windowedStream.minBy(\u0026#34;key\u0026#34;) windowedStream.maxBy(0) windowedStream.maxBy(\u0026#34;key\u0026#34;)  Union  DataStream* â†’ DataStream\nè”åˆä¸¤ä¸ªæˆ–å¤šä¸ªæ•°æ®æµï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æµï¼ŒåŒ…å«æ‰€æœ‰æµçš„æ‰€æœ‰å…ƒç´ ã€‚æ³¨æ„ï¼šå¦‚æœä½ æŠŠä¸€ä¸ªæ•°æ®æµå’Œå®ƒè‡ªå·±è”åˆèµ·æ¥ï¼Œä½ å°†åœ¨ç”Ÿæˆçš„æ•°æ®æµä¸­å¾—åˆ°æ¯ä¸ªå…ƒç´ ä¸¤æ¬¡ã€‚\ndataStream.union(otherStream1, otherStream2, ...)  Window Join  DataStream,DataStream â†’ DataStream\nåœ¨ä¸€ä¸ªç»™å®šçš„é”®å’Œä¸€ä¸ªå…¬å…±çª—å£ä¸Šè¿æ¥(join)ä¸¤ä¸ªæ•°æ®æµã€‚\ndataStream.join(otherStream) .where(\u0026lt;key selector\u0026gt;).equalTo(\u0026lt;key selector\u0026gt;) .window(TumblingEventTimeWindows.of(Time.seconds(3))) .apply { ... }  Window CoGroup  DataStream,DataStream â†’ DataStream\nåœ¨ä¸€ä¸ªç»™å®šçš„é”®å’Œä¸€ä¸ªå…±åŒçš„çª—å£ä¸Šå°†ä¸¤ä¸ªæ•°æ®æµä¸²è”(Cogroups)èµ·æ¥ã€‚\ndataStream.coGroup(otherStream) .where(0).equalTo(1) .window(TumblingEventTimeWindows.of(Time.seconds(3))) .apply {}  Connect  DataStream,DataStream â†’ ConnectedStreams\n\u0026ldquo;è¿æ¥\u0026rdquo;(connect)ä¸¤ä¸ªæ•°æ®æµï¼Œä¿ç•™å…¶ç±»å‹ï¼Œå…è®¸ä¸¤ä¸ªæ•°æ®æµä¹‹é—´å…±äº«çŠ¶æ€ã€‚\nsomeStream : DataStream[Int] = ... otherStream : DataStream[String] = ... val connectedStreams = someStream.connect(otherStream)  CoMap, CoFlatMap  ConnectedStreams â†’ DataStream\nç±»ä¼¼äºè¿æ¥(connected)æ•°æ®æµä¸Šçš„ map å’Œ flatMap:\nconnectedStreams.map( (_ : Int) =\u0026gt; true, (_ : String) =\u0026gt; false ) connectedStreams.flatMap( (_ : Int) =\u0026gt; true, (_ : String) =\u0026gt; false )  Split  DataStream â†’ SplitStream\næ ¹æ®æŸç§æ ‡å‡†ï¼Œå°†æµåˆ†æˆä¸¤ä¸ªæˆ–å¤šä¸ªæµã€‚\nval split = someDataStream.split( (num: Int) =\u0026gt; (num % 2) match { case 0 =\u0026gt; List(\u0026#34;even\u0026#34;) case 1 =\u0026gt; List(\u0026#34;odd\u0026#34;) } )  Select  SplitStream â†’ DataStream\nä»åˆ†å‰²æµä¸­é€‰æ‹©ä¸€ä¸ªæˆ–å¤šä¸ªæµã€‚\nval even = split select \u0026#34;even\u0026#34; val odd = split select \u0026#34;odd\u0026#34; val all = split.select(\u0026#34;even\u0026#34;,\u0026#34;odd\u0026#34;)  Iterate  DataStream â†’ IterativeStream â†’ DataStream\nåœ¨æµ(flow)ä¸­åˆ›å»ºä¸€ä¸ª\u0026quot;åé¦ˆ\u0026quot;å¾ªç¯ï¼Œå°†ä¸€ä¸ªæ“ä½œç¬¦çš„è¾“å‡ºé‡å®šå‘åˆ°ä¹‹å‰çš„æŸä¸ªæ“ä½œç¬¦ã€‚è¿™å¯¹äºå®šä¹‰æŒç»­æ›´æ–°æ¨¡å‹çš„ç®—æ³•ç‰¹åˆ«æœ‰ç”¨ã€‚ä¸‹é¢çš„ä»£ç ä»ä¸€ä¸ªæµ(stream)å¼€å§‹ï¼Œè¿ç»­åº”ç”¨è¿­ä»£ä½“ã€‚å¤§äº0çš„å…ƒç´ è¢«é€å›åé¦ˆé€šé“ï¼Œå…¶ä½™å…ƒç´ è¢«è½¬å‘åˆ°ä¸‹æ¸¸ã€‚å‚è§è¿­ä»£çš„å®Œæ•´æè¿°ã€‚\ninitialStream.iterate { iteration =\u0026gt; { val iterationBody = iteration.map {/*do something*/} (iterationBody.filter(_ \u0026gt; 0), iterationBody.filter(_ \u0026lt;= 0)) } } é€šè¿‡åŒ¿åæ¨¡å¼åŒ¹é…ä» tupleã€case ç±»å’Œé›†åˆä¸­æå–ï¼Œæ¯”å¦‚ä¸‹é¢:\nval data: DataStream[(Int, String, Double)] = // [...] data.map { case (id, name, temperature) =\u0026gt; // [...] } ä¸å— API å¼€ç®±å³ç”¨çš„æ”¯æŒã€‚è¦ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ï¼Œä½ åº”è¯¥ä½¿ç”¨ Scala API æ‰©å±•ã€‚\nä»¥ä¸‹è½¬æ¢å¯ç”¨äº Tuples çš„æ•°æ®æµ:\n Project  DataStream â†’ DataStream\nä»å…ƒç»„ä¸­é€‰æ‹©ä¸€ä¸ªå­—æ®µçš„å­é›†ã€‚\nDataStream\u0026lt;Tuple3\u0026lt;Integer, Double, String\u0026gt;\u0026gt; in = // [...] DataStream\u0026lt;Tuple2\u0026lt;String, Integer\u0026gt;\u0026gt; out = in.project(2,0); ç‰©ç†åˆ†åŒº Flink è¿˜å¯ä»¥é€šè¿‡ä»¥ä¸‹å‡½æ•°å¯¹è½¬æ¢åçš„å‡†ç¡®æµåˆ†åŒºè¿›è¡Œä½çº§æ§åˆ¶ï¼ˆå¦‚æœéœ€è¦ï¼‰ã€‚\n è‡ªå®šä¹‰åˆ†åŒº  DataStream â†’ DataStream\nä½¿ç”¨ç”¨æˆ·å®šä¹‰çš„ Partitioner ä¸ºæ¯ä¸ªå…ƒç´ é€‰æ‹©ç›®æ ‡ä»»åŠ¡ã€‚\ndataStream.partitionCustom(partitioner, \u0026#34;someKey\u0026#34;) dataStream.partitionCustom(partitioner, 0)  éšæœºåˆ†åŒº  DataStream â†’ DataStream\nå°†å…ƒç´ æŒ‰ç…§å‡åŒ€åˆ†å¸ƒéšæœºåˆ†åŒºã€‚\ndataStream.shuffle()  Rebalancing (å¾ªç¯åˆ†åŒº)  DataStream â†’ DataStream\nå¯¹å…ƒç´ è¿›è¡Œå¾ªç¯åˆ†åŒºï¼Œä½¿æ¯ä¸ªåˆ†åŒºçš„è´Ÿè½½ç›¸ç­‰ã€‚åœ¨æ•°æ®å€¾æ–œçš„æƒ…å†µä¸‹ï¼Œå¯¹æ€§èƒ½ä¼˜åŒ–å¾ˆæœ‰ç”¨ã€‚\ndataStream.rebalance()  Rescaling  DataStream â†’ DataStream\nå°†å…ƒç´ ï¼Œè½®å›åˆ†åŒºåˆ°ä¸‹æ¸¸æ“ä½œçš„å­é›†ã€‚å¦‚æœä½ æƒ³æ‹¥æœ‰ç®¡é“ï¼Œä¾‹å¦‚ï¼Œä»æºçš„æ¯ä¸ªå¹¶è¡Œå®ä¾‹å‘å‡ ä¸ªæ˜ å°„å™¨(mappers)çš„å­é›†æ‰‡å‡ºï¼Œä»¥åˆ†é…è´Ÿè½½ï¼Œä½†åˆä¸æƒ³è¿›è¡Œ rebalance() ä¼šå¼•èµ·çš„å®Œå…¨å†å¹³è¡¡ï¼Œé‚£ä¹ˆè¿™å°±å¾ˆæœ‰ç”¨ã€‚è¿™å°†åªéœ€è¦æœ¬åœ°æ•°æ®ä¼ è¾“ï¼Œè€Œä¸æ˜¯é€šè¿‡ç½‘ç»œä¼ è¾“æ•°æ®ï¼Œè¿™å–å†³äºå…¶ä»–é…ç½®å€¼ï¼Œå¦‚ TaskManagers çš„æ§½æ•°(slots)ã€‚\nä¸Šæ¸¸æ“ä½œå‘å…¶å‘é€å…ƒç´ çš„ä¸‹æ¸¸æ“ä½œå­é›†å–å†³äºä¸Šæ¸¸å’Œä¸‹æ¸¸æ“ä½œçš„å¹¶è¡Œç¨‹åº¦ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸Šæ¸¸æ“ä½œçš„å¹¶è¡Œåº¦ä¸º2ï¼Œä¸‹æ¸¸æ“ä½œçš„å¹¶è¡Œåº¦ä¸º4ï¼Œé‚£ä¹ˆä¸€ä¸ªä¸Šæ¸¸æ“ä½œå°†å‘ä¸¤ä¸ªä¸‹æ¸¸æ“ä½œåˆ†å‘å…ƒç´ ï¼Œè€Œå¦ä¸€ä¸ªä¸Šæ¸¸æ“ä½œå°†å‘å¦å¤–ä¸¤ä¸ªä¸‹æ¸¸æ“ä½œåˆ†å‘ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä¸‹æ¸¸æ“ä½œå…·æœ‰å¹¶è¡Œåº¦2ï¼Œè€Œä¸Šæ¸¸æ“ä½œå…·æœ‰å¹¶è¡Œåº¦4ï¼Œé‚£ä¹ˆä¸¤ä¸ªä¸Šæ¸¸æ“ä½œå°†åˆ†é…ç»™ä¸€ä¸ªä¸‹æ¸¸æ“ä½œï¼Œè€Œå…¶ä»–ä¸¤ä¸ªä¸Šæ¸¸æ“ä½œå°†åˆ†é…ç»™å…¶ä»–ä¸‹æ¸¸æ“ä½œã€‚\nåœ¨ä¸åŒçš„å¹¶è¡Œåº¦ä¸æ˜¯å½¼æ­¤çš„å€æ•°çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæˆ–å‡ ä¸ªä¸‹æ¸¸æ“ä½œå°†ä»ä¸Šæ¸¸æ“ä½œä¸­è·å¾—ä¸åŒæ•°é‡çš„è¾“å…¥ã€‚\nè¯·çœ‹æ­¤å›¾ï¼Œå¯ä»¥ç›´è§‚åœ°çœ‹åˆ°ä¸Šä¾‹ä¸­çš„è¿æ¥(connection)æ¨¡å¼ã€‚\ndataStream.rescale()  Broadcasting  DataStream â†’ DataStream\nå°†å…ƒç´ å¹¿æ’­åˆ°æ¯ä¸ªåˆ†åŒºã€‚\ndataStream.broadcast() ä»»åŠ¡é“¾å’Œèµ„æºç»„ é“¾å¼çš„ä¸¤ä¸ªåç»­å˜æ¢æ„å‘³ç€å°†å®ƒä»¬å…±åŒæ”¾ç½®åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­ä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚å¦‚æœå¯èƒ½çš„è¯ï¼ŒFlink é»˜è®¤ä¼šå°†æ“ä½œç¬¦é“¾èµ·æ¥ï¼ˆä¾‹å¦‚ï¼Œä¸¤ä¸ªåç»­çš„ map å˜æ¢ï¼‰ã€‚å¦‚æœéœ€è¦çš„è¯ï¼ŒAPI æä¾›äº†å¯¹é“¾å¼æ“ä½œçš„ç²¾ç»†æ§åˆ¶ã€‚\nå¦‚æœä½ æƒ³åœ¨æ•´ä¸ªä½œä¸š(job)ä¸­ç¦ç”¨é“¾ï¼Œè¯·ä½¿ç”¨ StreamExecutionEnvironment.disableOperatorChaining()ã€‚å¯¹äºæ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œä»¥ä¸‹å‡½æ•°æ˜¯å¯ç”¨çš„ã€‚è¯·æ³¨æ„ï¼Œè¿™äº›å‡½æ•°åªèƒ½åœ¨ DataStream è½¬æ¢ä¹‹åä½¿ç”¨ï¼Œå› ä¸ºå®ƒä»¬å¼•ç”¨äº†ä¹‹å‰çš„è½¬æ¢ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ someStream.map(...).startNewChain()ï¼Œä½†ä½ ä¸èƒ½ä½¿ç”¨ someStream.startNewChain()ã€‚\nèµ„æºç»„æ˜¯ Flink ä¸­çš„ä¸€ä¸ªæ§½ï¼Œå‚è§ slotsã€‚å¦‚æœéœ€è¦ï¼Œä½ å¯ä»¥åœ¨å•ç‹¬çš„æ§½ä¸­æ‰‹åŠ¨éš”ç¦»æ“ä½œç¬¦ã€‚\n Start new chain  å¼€å§‹ä¸€ä¸ªæ–°çš„é“¾ï¼Œä»è¿™ä¸ªæ“ä½œç¬¦å¼€å§‹ã€‚ä¸¤ä¸ªæ˜ å°„å™¨(mappers)å°†è¢«è¿é”ï¼Œfilter å°†ä¸ä¼šè¢«è¿é”åˆ°ç¬¬ä¸€ä¸ªæ˜ å°„å™¨(mapper)ã€‚\nsomeStream.filter(...).map(...).startNewChain().map(...)  Disable chaining  ä¸å°† map è¿ç®—ç¬¦è¿é”åŒ–ã€‚\nsomeStream.map(...).disableChaining()  Set slot sharing group  è®¾ç½®æ“ä½œçš„æ§½ä½å…±äº«ç»„ã€‚Flink ä¼šå°†å…·æœ‰ç›¸åŒæ§½ä½å…±äº«ç»„çš„æ“ä½œæ”¾å…¥åŒä¸€ä¸ªæ§½ä½ï¼Œè€Œå°†æ²¡æœ‰æ§½ä½å…±äº«ç»„çš„æ“ä½œä¿ç•™åœ¨å…¶ä»–æ§½ä½ã€‚è¿™å¯ä»¥ç”¨æ¥éš”ç¦»æ§½ä½ã€‚å¦‚æœæ‰€æœ‰çš„è¾“å…¥æ“ä½œéƒ½åœ¨åŒä¸€ä¸ªæ§½å…±äº«ç»„ä¸­ï¼Œæ§½å…±äº«ç»„å°±ä¼šä»è¾“å…¥æ“ä½œä¸­ç»§æ‰¿ã€‚ç¼ºçœæ§½å…±äº«ç»„çš„åç§°æ˜¯ \u0026ldquo;default\u0026rdquo;ï¼Œæ“ä½œå¯ä»¥é€šè¿‡è°ƒç”¨ slotSharingGroup(\u0026quot;default\u0026quot;) æ¥æ˜ç¡®åœ°æ”¾å…¥è¿™ä¸ªç»„ã€‚\nsomeStream.filter(...).slotSharingGroup(\u0026#34;name\u0026#34;) åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/stream/operators/\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-operators/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataStream API","Operator"],"title":"Operators"},{"categories":["Flink"],"contents":"ProcessFunction ProcessFunction æ˜¯ä¸€ç§ä½çº§çš„æµå¤„ç†æ“ä½œï¼Œå¯ä»¥è®¿é—®æ‰€æœ‰ï¼ˆéå¾ªç¯ï¼‰æµåº”ç”¨çš„åŸºæœ¬æ„ä»¶ã€‚\n äº‹ä»¶ï¼ˆæµå…ƒç´ ï¼‰ çŠ¶æ€ï¼ˆå®¹é”™ï¼Œä¸€è‡´ï¼Œåªåœ¨ keyed æµä¸Šï¼‰ã€‚ å®šæ—¶å™¨(äº‹ä»¶æ—¶é—´å’Œå¤„ç†æ—¶é—´ï¼Œä»…åœ¨ keyed æµä¸Š)  ProcessFunction å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ª FlatMapFunctionï¼Œå®ƒå¯ä»¥è®¿é—® keyed çŠ¶æ€å’Œå®šæ—¶å™¨ã€‚å®ƒé€šè¿‡å¯¹è¾“å…¥æµä¸­æ”¶åˆ°çš„æ¯ä¸ªäº‹ä»¶è¿›è¡Œè°ƒç”¨æ¥å¤„ç†äº‹ä»¶ã€‚\nå¯¹äºå®¹é”™çŠ¶æ€ï¼ŒProcessFunction æä¾›äº†å¯¹ Flink çš„ keyed çŠ¶æ€çš„è®¿é—®ï¼Œé€šè¿‡ RuntimeContext è®¿é—®ï¼Œç±»ä¼¼äºå…¶ä»–æœ‰çŠ¶æ€å‡½æ•°è®¿é—® keyed çŠ¶æ€çš„æ–¹å¼ã€‚\nå®šæ—¶å™¨å…è®¸åº”ç”¨ç¨‹åºå¯¹å¤„ç†æ—¶é—´å’Œäº‹ä»¶æ—¶é—´çš„å˜åŒ–åšå‡ºååº”ã€‚æ¯æ¬¡è°ƒç”¨å‡½æ•° processElement(...) éƒ½ä¼šå¾—åˆ°ä¸€ä¸ª Context å¯¹è±¡ï¼Œå®ƒå¯ä»¥è®¿é—®å…ƒç´ çš„äº‹ä»¶æ—¶é—´æ—¶é—´æˆ³ï¼Œä»¥åŠ TimerServiceã€‚TimerService å¯ä»¥ç”¨æ¥ä¸ºæœªæ¥çš„äº‹ä»¶/å¤„ç†æ—¶é—´å®ä¾‹æ³¨å†Œå›è°ƒã€‚å¯¹äºäº‹ä»¶æ—¶é—´å®šæ—¶å™¨ï¼Œå½“å½“å‰æ°´å°æå‰åˆ°æˆ–è¶…è¿‡å®šæ—¶å™¨çš„æ—¶é—´æˆ³æ—¶ï¼Œå°±ä¼šè°ƒç”¨ onTimer(...) æ–¹æ³•ï¼›è€Œå¯¹äºå¤„ç†æ—¶é—´å®šæ—¶å™¨ï¼Œå½“æŒ‚é’Ÿæ—¶é—´è¾¾åˆ°æŒ‡å®šæ—¶é—´æ—¶ï¼Œå°±ä¼šè°ƒç”¨ onTimer(...)ã€‚åœ¨è¯¥è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰çš„çŠ¶æ€åˆä¼šè¢«é™å®šåœ¨åˆ›å»ºå®šæ—¶å™¨çš„é”®ä¸Šï¼Œå…è®¸å®šæ—¶å™¨å¯¹ keyed çŠ¶æ€è¿›è¡Œæ“ä½œã€‚\næ³¨æ„ï¼šå¦‚æœä½ æƒ³è®¿é—® keyed çŠ¶æ€å’Œå®šæ—¶å™¨ï¼Œä½ å¿…é¡»åœ¨ keyed æµä¸Šåº”ç”¨ ProcessFunctionã€‚\nstream.keyBy(...).process(new MyProcessFunction()) ä½çº§è¿æ¥(join) ä¸ºäº†å®ç°å¯¹ä¸¤ä¸ªè¾“å…¥çš„ä½çº§æ“ä½œï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨ CoProcessFunction æˆ– KeyedCoProcessFunctionã€‚è¯¥å‡½æ•°ä¸ä¸¤ä¸ªä¸åŒçš„è¾“å…¥ç»‘å®šï¼Œå¹¶ä»ä¸¤ä¸ªä¸åŒçš„è¾“å…¥ä¸­è·å–å¯¹ processElement1(...) å’Œ processElement2(...) è®°å½•çš„å•ç‹¬è°ƒç”¨ã€‚\nå®ç°ä½çº§è”æ¥(join)é€šå¸¸éµå¾ªè¿™ç§æ¨¡å¼ã€‚\n ä¸ºä¸€ä¸ªè¾“å…¥ï¼ˆæˆ–ä¸¤ä¸ªè¾“å…¥ï¼‰åˆ›å»ºä¸€ä¸ªçŠ¶æ€å¯¹è±¡ã€‚ ä»å…¶è¾“å…¥ä¸­æ¥æ”¶åˆ°å…ƒç´ æ—¶æ›´æ–°çŠ¶æ€ åœ¨æ¥æ”¶åˆ°å¦ä¸€ä¸ªè¾“å…¥çš„å…ƒç´ åï¼Œæ¢æµ‹çŠ¶æ€å¹¶äº§ç”ŸåŠ å…¥çš„ç»“æœã€‚  ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½ä¼šå°†å®¢æˆ·æ•°æ®åŠ å…¥åˆ°é‡‘èäº¤æ˜“ä¸­ï¼ŒåŒæ—¶ä¸ºå®¢æˆ·æ•°æ®ä¿ç•™çŠ¶æ€ã€‚å¦‚æœä½ å…³å¿ƒåœ¨é¢å¯¹å¤±åºäº‹ä»¶æ—¶æ˜¯å¦æœ‰å®Œæ•´çš„ã€ç¡®å®šæ€§çš„åŠ å…¥ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå½“å®¢æˆ·æ•°æ®æµçš„æ°´å°å·²ç»è¶…è¿‡è¯¥äº¤æ˜“çš„æ—¶é—´æ—¶ï¼Œä½ å¯ä»¥ä¸ºè¯¥äº¤æ˜“è¯„ä¼°å¹¶å‘å‡ºåŠ å…¥ã€‚\nä¾‹å­ åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼ŒKeyedProcessFunction ç»´æŠ¤æ¯ä¸ªé”®çš„è®¡æ•°ï¼Œå¹¶ä¸”æ¯å½“ä¸€åˆ†é’Ÿè¿‡å»ï¼ˆä»¥äº‹ä»¶æ—¶é—´ä¸ºå•ä½ï¼‰ï¼Œè¯¥é”®æ²¡æœ‰æ›´æ–°æ—¶ï¼Œå°±ä¼šå‘å‡ºä¸€ä¸ªé”®/è®¡æ•°å¯¹ã€‚\n è®¡æ•°ã€é”®å’Œæœ€åä¿®æ”¹æ—¶é—´æˆ³éƒ½å­˜å‚¨åœ¨ä¸€ä¸ª ValueState ä¸­ï¼Œè¿™ä¸ª ValueState éšå¼åœ°è¢«é”®æ‰€é™å®šã€‚ å¯¹äºæ¯æ¡è®°å½•ï¼ŒKeyedProcessFunction éƒ½ä¼šé€’å¢è®¡æ•°å™¨å¹¶è®¾ç½®æœ€åä¿®æ”¹æ—¶é—´æˆ³ã€‚ è¯¥å‡½æ•°è¿˜å°†åœ¨æœªæ¥ä¸€åˆ†é’Ÿå†…ï¼ˆä»¥äº‹ä»¶æ—¶é—´ä¸ºå•ä½ï¼‰å®‰æ’ä¸€æ¬¡å›è°ƒã€‚ åœ¨æ¯æ¬¡å›è°ƒæ—¶ï¼Œå®ƒéƒ½ä¼šå°†å›è°ƒçš„äº‹ä»¶æ—¶é—´æˆ³ä¸å­˜å‚¨çš„è®¡æ•°çš„æœ€åä¿®æ”¹æ—¶é—´è¿›è¡Œæ ¸å¯¹ï¼Œå¦‚æœä¸¤è€…åŒ¹é…ï¼ˆå³åœ¨è¯¥åˆ†é’Ÿå†…æ²¡æœ‰è¿›ä¸€æ­¥çš„æ›´æ–°å‘ç”Ÿï¼‰ï¼Œåˆ™å‘å‡º key/countã€‚  æ³¨æ„: è¿™ä¸ªç®€å•çš„ä¾‹å­å¯ä»¥ç”¨ä¼šè¯çª—å£æ¥å®ç°ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨ KeyedProcessFunction æ¥è¯´æ˜å®ƒæä¾›çš„åŸºæœ¬æ¨¡å¼ã€‚\nimport org.apache.flink.api.common.state.ValueState import org.apache.flink.api.common.state.ValueStateDescriptor import org.apache.flink.api.java.tuple.Tuple import org.apache.flink.streaming.api.functions.KeyedProcessFunction import org.apache.flink.util.Collector // the source data stream val stream: DataStream[Tuple2[String, String]] = ... // apply the process function onto a keyed stream val result: DataStream[Tuple2[String, Long]] = stream .keyBy(0) .process(new CountWithTimeoutFunction()) /** * The data type stored in the state */ case class CountWithTimestamp(key: String, count: Long, lastModified: Long) /** * The implementation of the ProcessFunction that maintains the count and timeouts */ class CountWithTimeoutFunction extends KeyedProcessFunction[Tuple, (String, String), (String, Long)] { /** The state that is maintained by this process function */ lazy val state: ValueState[CountWithTimestamp] = getRuntimeContext .getState(new ValueStateDescriptor[CountWithTimestamp](\u0026#34;myState\u0026#34;, classOf[CountWithTimestamp])) override def processElement( value: (String, String), ctx: KeyedProcessFunction[Tuple, (String, String), (String, Long)]#Context, out: Collector[(String, Long)]): Unit = { // initialize or retrieve/update the state  val current: CountWithTimestamp = state.value match { case null =\u0026gt; CountWithTimestamp(value._1, 1, ctx.timestamp) case CountWithTimestamp(key, count, lastModified) =\u0026gt; CountWithTimestamp(key, count + 1, ctx.timestamp) } // write the state back  state.update(current) // schedule the next timer 60 seconds from the current event time  ctx.timerService.registerEventTimeTimer(current.lastModified + 60000) } override def onTimer( timestamp: Long, ctx: KeyedProcessFunction[Tuple, (String, String), (String, Long)]#OnTimerContext, out: Collector[(String, Long)]): Unit = { state.value match { case CountWithTimestamp(key, count, lastModified) if (timestamp == lastModified + 60000) =\u0026gt; out.collect((key, count)) case _ =\u0026gt; } } } æ³¨æ„ï¼šåœ¨ Flink 1.4.0 ä¹‹å‰ï¼Œå½“ä»å¤„ç†æ—¶é—´è®¡æ—¶å™¨è°ƒç”¨æ—¶ï¼ŒProcessFunction.onTimer() æ–¹æ³•å°†å½“å‰å¤„ç†æ—¶é—´è®¾ç½®ä¸ºäº‹ä»¶æ—¶é—´æˆ³ã€‚è¿™ç§è¡Œä¸ºéå¸¸å¾®å¦™ï¼Œå¯èƒ½ä¸ä¼šè¢«ç”¨æˆ·å‘ç°ã€‚å—¯ï¼Œè¿™æ˜¯æœ‰å®³çš„ï¼Œå› ä¸ºå¤„ç†æ—¶é—´æ—¶é—´æˆ³æ˜¯ä¸ç¡®å®šçš„ï¼Œè€Œä¸”ä¸ä¸æ°´å°å¯¹é½ã€‚æ­¤å¤–ï¼Œç”¨æˆ·å®ç°çš„é€»è¾‘ä¾èµ–äºè¿™ä¸ªé”™è¯¯çš„æ—¶é—´æˆ³ææœ‰å¯èƒ½æ˜¯æ— æ„ä¸­çš„é”™è¯¯ã€‚æ‰€ä»¥æˆ‘ä»¬å†³å®šä¿®å¤å®ƒã€‚å‡çº§åˆ° 1.4.0 åï¼Œä½¿ç”¨è¿™ä¸ªé”™è¯¯çš„äº‹ä»¶æ—¶é—´æ—¶é—´æˆ³çš„ Flink ä½œä¸šå°†å¤±è´¥ï¼Œç”¨æˆ·åº”è¯¥å°†ä»–ä»¬çš„ä½œä¸šè°ƒæ•´ä¸ºæ­£ç¡®çš„é€»è¾‘ã€‚\nKeyedProcessFunction KeyedProcessFunction ä½œä¸º ProcessFunction çš„æ‰©å±•ï¼Œåœ¨å…¶ onTimer(...) æ–¹æ³•ä¸­æä¾›äº†å¯¹å®šæ—¶å™¨é”®çš„è®¿é—®ã€‚\noverride def onTimer(timestamp: Long, ctx: OnTimerContext, out: Collector[OUT]): Unit = { var key = ctx.getCurrentKey // ... } å®šæ—¶å™¨ ä¸¤ç§ç±»å‹çš„å®šæ—¶å™¨ï¼ˆå¤„ç†æ—¶é—´å’Œäº‹ä»¶æ—¶é—´ï¼‰éƒ½ç”± TimerService å†…éƒ¨ç»´æŠ¤ï¼Œå¹¶æ’é˜Ÿæ‰§è¡Œã€‚\nTimerService å¯¹æ¯ä¸ªé”®å’Œæ—¶é—´æˆ³çš„å®šæ—¶å™¨è¿›è¡Œé‡å¤å¤åˆ¶ï¼Œå³æ¯ä¸ªé”®å’Œæ—¶é—´æˆ³æœ€å¤šåªæœ‰ä¸€ä¸ªå®šæ—¶å™¨ã€‚å¦‚æœåŒä¸€ä¸ªæ—¶é—´æˆ³æ³¨å†Œäº†å¤šä¸ªå®šæ—¶å™¨ï¼ŒonTimer() æ–¹æ³•å°†åªè¢«è°ƒç”¨ä¸€æ¬¡ã€‚\næ³¨æ„ Flink åŒæ­¥è°ƒç”¨ onTimer() å’Œ processElement()ã€‚å› æ­¤ï¼Œç”¨æˆ·ä¸å¿…æ‹…å¿ƒçŠ¶æ€çš„å¹¶å‘ä¿®æ”¹ã€‚\nå®¹é”™æ€§ å®šæ—¶å™¨æ˜¯å®¹é”™çš„ï¼Œå¹¶ä¸åº”ç”¨ç¨‹åºçš„çŠ¶æ€ä¸€èµ·æ£€æŸ¥ç‚¹ã€‚åœ¨æ•…éšœæ¢å¤æˆ–ä»ä¿å­˜ç‚¹å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶ï¼Œå®šæ—¶å™¨å°†è¢«æ¢å¤ã€‚\næ³¨æ„: åœ¨æ¢å¤ä¹‹å‰åº”è¯¥å¯åŠ¨çš„æ£€æŸ¥ç‚¹å¤„ç†æ—¶é—´å®šæ—¶å™¨å°†ç«‹å³å¯åŠ¨ã€‚è¿™å¯èƒ½å‘ç”Ÿåœ¨åº”ç”¨ç¨‹åºä»æ•…éšœä¸­æ¢å¤æˆ–ä»ä¿å­˜ç‚¹å¯åŠ¨æ—¶ã€‚\næ³¨æ„: å®šæ—¶å™¨æ€»æ˜¯å¼‚æ­¥æ£€æŸ¥ç‚¹ï¼Œé™¤äº† RocksDB åç«¯/ä¸å¢é‡å¿«ç…§/ä¸åŸºäºå †çš„å®šæ—¶å™¨çš„ç»„åˆï¼ˆå°†ç”¨FLINK-10026è§£å†³ï¼‰ã€‚æ³¨æ„ï¼Œå¤§é‡çš„å®šæ—¶å™¨ä¼šå¢åŠ æ£€æŸ¥ç‚¹æ—¶é—´ï¼Œå› ä¸ºå®šæ—¶å™¨æ˜¯æ£€æŸ¥ç‚¹çŠ¶æ€çš„ä¸€éƒ¨åˆ†ã€‚è¯·å‚é˜… \u0026ldquo;å®šæ—¶å™¨å‡èš \u0026ldquo;éƒ¨åˆ†ï¼Œäº†è§£å¦‚ä½•å‡å°‘å®šæ—¶å™¨æ•°é‡çš„å»ºè®®ã€‚\nå®šæ—¶å™¨å‡èš ç”±äº Flink å¯¹æ¯ä¸ªé”®å’Œæ—¶é—´æˆ³åªç»´æŠ¤ä¸€ä¸ªå®šæ—¶å™¨ï¼Œæ‚¨å¯ä»¥é€šè¿‡é™ä½å®šæ—¶å™¨åˆ†è¾¨ç‡æ¥å‡èšå®šæ—¶å™¨çš„æ•°é‡ã€‚\nå¯¹äº1ç§’çš„å®šæ—¶å™¨åˆ†è¾¨ç‡ï¼ˆäº‹ä»¶æˆ–å¤„ç†æ—¶é—´ï¼‰ï¼Œæ‚¨å¯ä»¥å°†ç›®æ ‡æ—¶é—´å››èˆäº”å…¥åˆ°æ•´ç§’ã€‚å®šæ—¶å™¨æœ€å¤šä¼šæå‰1ç§’å‘å°„ï¼Œä½†ä¸ä¼šæ™šäºè¦æ±‚çš„æ¯«ç§’ç²¾åº¦ã€‚å› æ­¤ï¼Œæ¯ä¸ªé”®å’Œç§’æœ€å¤šæœ‰ä¸€ä¸ªå®šæ—¶å™¨ã€‚\nval coalescedTime = ((ctx.timestamp + timeout) / 1000) * 1000 ctx.timerService.registerProcessingTimeTimer(coalescedTime) ç”±äºäº‹ä»¶æ—¶é—´å®šæ—¶å™¨åªåœ¨æœ‰æ°´å°å‡ºç°æ—¶æ‰ä¼šå¯åŠ¨ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨å½“å‰çš„æ°´å°æ¥å®‰æ’å’Œå‡èšè¿™äº›å®šæ—¶å™¨ä¸ä¸‹ä¸€ä¸ªæ°´å°ã€‚\nval coalescedTime = ctx.timerService.currentWatermark + 1 ctx.timerService.registerEventTimeTimer(coalescedTime) å®šæ—¶å™¨ä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼åœæ­¢æˆ–åˆ é™¤ã€‚\nåœæ­¢ä¸€ä¸ªå¤„ç†æ—¶é—´çš„å®šæ—¶å™¨ã€‚\nval timestampOfTimerToStop = ... ctx.timerService.deleteProcessingTimeTimer(timestampOfTimerToStop) åœæ­¢äº‹ä»¶æ—¶é—´å®šæ—¶å™¨ã€‚\nval timestampOfTimerToStop = ... ctx.timerService.deleteEventTimeTimer(timestampOfTimerToStop) æ³¨æ„: å¦‚æœæ²¡æœ‰æ³¨å†Œç»™å®šæ—¶é—´æˆ³çš„å®šæ—¶å™¨ï¼Œåœæ­¢å®šæ—¶å™¨æ²¡æœ‰æ•ˆæœã€‚\nåŸæ–‡è¿æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/stream/operators/process_function.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-process-function/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£"],"title":"Process Function"},{"categories":["Flink"],"contents":"Scala API æ‰©å±• ä¸ºäº†åœ¨ Scala å’Œ Java API ä¹‹é—´ä¿æŒç›¸å½“ç¨‹åº¦çš„ä¸€è‡´æ€§ï¼Œä¸€äº›å…è®¸åœ¨ Scala ä¸­è¿›è¡Œé«˜çº§è¡¨è¾¾çš„åŠŸèƒ½è¢«ä»æ ‡å‡† API ä¸­çœç•¥äº†ï¼ŒåŒ…æ‹¬æ‰¹å¤„ç†å’Œæµå¼å¤„ç†ã€‚\nå¦‚æœä½ æƒ³äº«å—å®Œæ•´çš„ Scala ä½“éªŒï¼Œä½ å¯ä»¥é€‰æ‹©åŠ å…¥é€šè¿‡éšå¼è½¬æ¢æ¥å¢å¼º Scala API çš„æ‰©å±•ã€‚\nè¦ä½¿ç”¨æ‰€æœ‰å¯ç”¨çš„æ‰©å±•ï¼Œæ‚¨åªéœ€ä¸º DataSet API æ·»åŠ ä¸€ä¸ªç®€å•çš„å¯¼å…¥å³å¯ã€‚\nimport org.apache.flink.api.scala.extensions._ æˆ–è€… DataStream API:\nimport org.apache.flink.streaming.api.scala.extensions._ å¦å¤–ï¼Œä½ ä¹Ÿå¯ä»¥æŒ‰é¡ºåºå¯¼å…¥å•ä¸ªæ‰©å±•ï¼Œåªä½¿ç”¨ä½ å–œæ¬¢çš„æ‰©å±•ã€‚\næ¥å—éƒ¨åˆ†å‡½æ•° é€šå¸¸æƒ…å†µä¸‹ï¼ŒDataSet å’Œ DataStream API éƒ½ä¸æ¥å—åŒ¿åæ¨¡å¼åŒ¹é…å‡½æ•°æ¥è§£æ„ tupleã€case ç±»æˆ–é›†åˆï¼Œæ¯”å¦‚ä¸‹é¢ã€‚\nval data: DataSet[(Int, String, Double)] = // [...] data.map { case (id, name, temperature) =\u0026gt; // [...]  // The previous line causes the following compilation error:  // \u0026#34;The argument types of an anonymous function must be fully known. (SLS 8.5)\u0026#34; } è¯¥æ‰©å±•åœ¨ DataSet å’Œ DataStream Scala API ä¸­å¼•å…¥äº†æ–°çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•åœ¨æ‰©å±•çš„ API ä¸­å…·æœ‰ä¸€å¯¹ä¸€çš„å¯¹åº”å…³ç³»ã€‚è¿™äº›ä»£ç†æ–¹æ³•ç¡®å®æ”¯æŒåŒ¿åæ¨¡å¼åŒ¹é…å‡½æ•°ã€‚\nDataSet API  mapWith\tæ–¹æ³•å’ŒåŸæ¥çš„ map (DataSet)  data.mapWith { case (_, value) =\u0026gt; value.toString }  mapPartitionWith æ–¹æ³•å’ŒåŸæ¥çš„\tmapPartition (DataSet)  data.mapPartitionWith { case head #:: _ =\u0026gt; head }  flatMapWith\tæ–¹æ³•å’ŒåŸæ¥çš„ flatMap (DataSet)  data.flatMapWith { case (_, name, visitTimes) =\u0026gt; visitTimes.map(name -\u0026gt; _) }  filterWith æ–¹æ³•å’ŒåŸæ¥çš„\tfilter (DataSet)  data.filterWith { case Train(_, isOnTime) =\u0026gt; isOnTime }  reduceWith æ–¹æ³•å’ŒåŸæ¥çš„\treduce (DataSet, GroupedDataSet)  data.reduceWith { case ((_, amount1), (_, amount2)) =\u0026gt; amount1 + amount2 }  reduceGroupWith\tæ–¹æ³•å’ŒåŸæ¥çš„ reduceGroup (GroupedDataSet)  data.reduceGroupWith { case id #:: value #:: _ =\u0026gt; id -\u0026gt; value }  groupingBy æ–¹æ³•å’ŒåŸæ¥çš„\tgroupBy (DataSet)  data.groupingBy { case (id, _, _) =\u0026gt; id }  sortGroupWith\tæ–¹æ³•å’ŒåŸæ¥çš„ sortGroup (GroupedDataSet)  grouped.sortGroupWith(Order.ASCENDING) { case House(_, value) =\u0026gt; value }  combineGroupWith æ–¹æ³•å’ŒåŸæ¥çš„\tcombineGroup (GroupedDataSet)  grouped.combineGroupWith { case header #:: amounts =\u0026gt; amounts.sum }  projecting æ–¹æ³•å’ŒåŸæ¥çš„\tapply (JoinDataSet, CrossDataSet)  data1.join(data2). whereClause(case (pk, _) =\u0026gt; pk). isEqualTo(case (_, fk) =\u0026gt; fk). projecting { case ((pk, tx), (products, fk)) =\u0026gt; tx -\u0026gt; products } data1.cross(data2).projecting { case ((a, _), (_, b) =\u0026gt; a -\u0026gt; b }  projecting æ–¹æ³•å’ŒåŸæ¥çš„\tapply (CoGroupDataSet)  data1.coGroup(data2). whereClause(case (pk, _) =\u0026gt; pk). isEqualTo(case (_, fk) =\u0026gt; fk). projecting { case (head1 #:: _, head2 #:: _) =\u0026gt; head1 -\u0026gt; head2 } } DataStream API  mapWith\tæ–¹æ³•å’ŒåŸæ¥çš„ map (DataStream)  data.mapWith { case (_, value) =\u0026gt; value.toString }  flatMapWith\tæ–¹æ³•å’ŒåŸæ¥çš„ flatMap (DataStream)  data.flatMapWith { case (_, name, visits) =\u0026gt; visits.map(name -\u0026gt; _) }  filterWith æ–¹æ³•å’ŒåŸæ¥çš„\tfilter (DataStream)  data.filterWith { case Train(_, isOnTime) =\u0026gt; isOnTime }  keyingBy æ–¹æ³•å’ŒåŸæ¥çš„\tkeyBy (DataStream)  data.keyingBy { case (id, _, _) =\u0026gt; id }  mapWith æ–¹æ³•å’ŒåŸæ¥çš„ map (ConnectedDataStream)  data.mapWith( map1 = case (_, value) =\u0026gt; value.toString, map2 = case (_, _, value, _) =\u0026gt; value + 1 )  flatMapWith\tæ–¹æ³•å’ŒåŸæ¥çš„ flatMap (ConnectedDataStream)  data.flatMapWith( flatMap1 = case (_, json) =\u0026gt; parse(json), flatMap2 = case (_, _, json, _) =\u0026gt; parse(json) )  keyingBy æ–¹æ³•å’ŒåŸæ¥çš„\tkeyBy (ConnectedDataStream)  data.keyingBy( key1 = case (_, timestamp) =\u0026gt; timestamp, key2 = case (id, _, _) =\u0026gt; id )  reduceWith æ–¹æ³•å’ŒåŸæ¥çš„ reduce (KeyedStream, WindowedStream)  data.reduceWith { case ((_, sum1), (_, sum2) =\u0026gt; sum1 + sum2 }  foldWith æ–¹æ³•å’ŒåŸæ¥çš„\tfold (KeyedStream, WindowedStream)  data.foldWith(User(bought = 0)) { case (User(b), (_, items)) =\u0026gt; User(b + items.size) }  applyWith\tæ–¹æ³•å’ŒåŸæ¥çš„ apply (WindowedStream)  data.applyWith(0)( foldFunction = case (sum, amount) =\u0026gt; sum + amount windowFunction = case (k, w, sum) =\u0026gt; // [...] )  projecting æ–¹æ³•å’ŒåŸæ¥çš„\tapply (JoinedStream)  data1.join(data2). whereClause(case (pk, _) =\u0026gt; pk). isEqualTo(case (_, fk) =\u0026gt; fk). projecting { case ((pk, tx), (products, fk)) =\u0026gt; tx -\u0026gt; products } å…³äºæ¯ä¸ªæ–¹æ³•çš„è¯­ä¹‰çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒ DataSet å’Œ DataStream API æ–‡æ¡£ã€‚\nè¦ä¸“é—¨ä½¿ç”¨è¿™ä¸ªæ‰©å±•ï¼Œå¯ä»¥æ·»åŠ ä»¥ä¸‹å¯¼å…¥ã€‚\nimport org.apache.flink.api.scala.extensions.acceptPartialFunctions å¯¹äº DataSet æ‰©å±•å’Œ\nimport org.apache.flink.streaming.api.scala.extensions.acceptPartialFunctions ä¸‹é¢çš„ä»£ç æ®µå±•ç¤ºäº†ä¸€ä¸ªæœ€å°çš„ä¾‹å­ï¼Œè¯´æ˜å¦‚ä½•ä¸€èµ·ä½¿ç”¨è¿™äº›æ‰©å±•æ–¹æ³•ï¼ˆä¸ DataSet API ä¸€èµ·ï¼‰ã€‚\nobject Main { import org.apache.flink.api.scala.extensions._ case class Point(x: Double, y: Double) def main(args: Array[String]): Unit = { val env = ExecutionEnvironment.getExecutionEnvironment val ds = env.fromElements(Point(1, 2), Point(3, 4), Point(5, 6)) ds.filterWith { case Point(x, _) =\u0026gt; x \u0026gt; 1 }.reduceWith { case (Point(x1, y1), (Point(x2, y2))) =\u0026gt; Point(x1 + y1, x2 + y2) }.mapWith { case Point(x, y) =\u0026gt; (x, y) }.flatMapWith { case (x, y) =\u0026gt; Seq(\u0026#34;x\u0026#34; -\u0026gt; x, \u0026#34;y\u0026#34; -\u0026gt; y) }.groupingBy { case (id, value) =\u0026gt; id } } } åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/scala_api_extensions.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-scala-api-extensions/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataStream API"],"title":"Scala API æ‰©å±•"},{"categories":["Flink"],"contents":"SHOW è¯­å¥ SHOW è¯­å¥ç”¨äºåˆ—å‡ºæ‰€æœ‰ç›®å½•ï¼Œæˆ–åˆ—å‡ºå½“å‰ç›®å½•ä¸­çš„æ‰€æœ‰æ•°æ®åº“ï¼Œæˆ–åˆ—å‡ºå½“å‰ç›®å½•å’Œå½“å‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨/è§†å›¾ï¼Œæˆ–åˆ—å‡ºå½“å‰ç›®å½•å’Œå½“å‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰å‡½æ•°ï¼ŒåŒ…æ‹¬ä¸´æ—¶ç³»ç»Ÿå‡½æ•°ã€ç³»ç»Ÿå‡½æ•°ã€ä¸´æ—¶ç›®å½•å‡½æ•°å’Œç›®å½•å‡½æ•°ã€‚\nFlink SQL ç›®å‰æ”¯æŒä»¥ä¸‹ SHOW è¯­å¥ã€‚\n SHOW CATALOGS SHOW DATABASES SHOW TABLES SHOW VIEWS SHOW FUNCTIONS  è¿è¡Œ SHOW è¯­å¥ SHOW è¯­å¥å¯ä»¥ç”¨ TableEnvironment çš„ executeSql()æ–¹æ³•æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨ SQL CLI ä¸­æ‰§è¡Œã€‚executeSql()æ–¹æ³•ä¼šå¯¹æˆåŠŸçš„ SHOW æ“ä½œè¿”å›å¯¹è±¡ï¼Œå¦åˆ™ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚\nä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨ TableEnvironment å’Œ SQL CLI ä¸­è¿è¡Œ SHOW è¯­å¥ã€‚\nFlink SQL\u0026gt; SHOW CATALOGS; default_catalog Flink SQL\u0026gt; SHOW DATABASES; default_database Flink SQL\u0026gt; CREATE TABLE my_table (...) WITH (...); [INFO] Table has been created. Flink SQL\u0026gt; SHOW TABLES; my_table Flink SQL\u0026gt; CREATE VIEW my_view AS ...; [INFO] View has been created. Flink SQL\u0026gt; SHOW VIEWS; my_view Flink SQL\u0026gt; SHOW FUNCTIONS; mod sha256 ... val env = StreamExecutionEnvironment.getExecutionEnvironment() val tEnv = StreamTableEnvironment.create(env) // show catalogs tEnv.executeSql(\u0026#34;SHOW CATALOGS\u0026#34;).print() // +-----------------+ // | catalog name | // +-----------------+ // | default_catalog | // +-----------------+  // show databases tEnv.executeSql(\u0026#34;SHOW DATABASES\u0026#34;).print() // +------------------+ // | database name | // +------------------+ // | default_database | // +------------------+  // create a table tEnv.executeSql(\u0026#34;CREATE TABLE my_table (...) WITH (...)\u0026#34;) // show tables tEnv.executeSql(\u0026#34;SHOW TABLES\u0026#34;).print() // +------------+ // | table name | // +------------+ // | my_table | // +------------+  // create a view tEnv.executeSql(\u0026#34;CREATE VIEW my_view AS ...\u0026#34;) // show views tEnv.executeSql(\u0026#34;SHOW VIEWS\u0026#34;).print() // +-----------+ // | view name | // +-----------+ // | my_view | // +-----------+  // show functions tEnv.executeSql(\u0026#34;SHOW FUNCTIONS\u0026#34;).print() // +---------------+ // | function name | // +---------------+ // | mod | // | sha256 | // | ... | // +---------------+ SHOW CATALOGS SHOWCATALOGSæ˜¾ç¤ºæ‰€æœ‰ç›®å½•ã€‚\nSHOW DATABASES SHOWDATABASESæ˜¾ç¤ºå½“å‰ç›®å½•ä¸­çš„æ‰€æœ‰æ•°æ®åº“ã€‚\nSHOW TABLES SHOWTABLESæ˜¾ç¤ºå½“å‰ç›®å½•å’Œå½“å‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨ã€‚\nSHOW VIEWS SHOWVIEWSæ˜¾ç¤ºå½“å‰ç›®å½•å’Œå½“å‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰è§†å›¾ã€‚\nSHOW FUNCTIONS SHOWFUNCTIONSæ˜¾ç¤ºå½“å‰ç›®å½•å’Œå½“å‰æ•°æ®åº“ä¸­çš„æ‰€æœ‰åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä¸´æ—¶ç³»ç»ŸåŠŸèƒ½ã€ç³»ç»ŸåŠŸèƒ½ã€ä¸´æ—¶ç›®å½•åŠŸèƒ½å’Œç›®å½•åŠŸèƒ½ã€‚\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/sql/show.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-show-statements/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL","SQL"],"title":"Show è¯­å¥"},{"categories":["Flink"],"contents":"SQL æœ¬é¡µä»‹ç»äº† Flink æ”¯æŒçš„ SQL è¯­è¨€ï¼ŒåŒ…æ‹¬æ•°æ®å®šä¹‰è¯­è¨€ï¼ˆDDLï¼‰ã€æ•°æ®æ“ä½œè¯­è¨€ï¼ˆDMLï¼‰å’ŒæŸ¥è¯¢è¯­è¨€ã€‚Flink çš„ SQL æ”¯æŒæ˜¯åŸºäº Apache Calciteï¼Œå®ƒå®ç°äº† SQL æ ‡å‡†ã€‚\næœ¬é¡µåˆ—å‡ºäº†ç›®å‰ Flink SQL æ”¯æŒçš„æ‰€æœ‰è¯­å¥ã€‚\n SELECT (Queries) CREATE TABLE, DATABASE, VIEW, FUNCTION DROP TABLE, DATABASE, VIEW, FUNCTION ALTER TABLE, DATABASE, FUNCTION INSERT SQL HINTS DESCRIBE EXPLAIN USE SHOW  æ•°æ®ç±»å‹ è¯·çœ‹å…³äºæ•°æ®ç±»å‹çš„ä¸“é—¨é¡µé¢ã€‚\né€šç”¨ç±»å‹å’Œ(åµŒå¥—çš„)å¤åˆç±»å‹(ä¾‹å¦‚ POJOsã€tupleã€è¡Œã€Scala case ç±»)ä¹Ÿå¯ä»¥æ˜¯è¡Œçš„å­—æ®µã€‚\nå…·æœ‰ä»»æ„åµŒå¥—çš„å¤åˆç±»å‹çš„å­—æ®µå¯ä»¥ç”¨å€¼è®¿é—®å‡½æ•°æ¥è®¿é—®ã€‚\né€šç”¨ç±»å‹è¢«å½“ä½œä¸€ä¸ªé»‘ç›’å­ï¼Œå¯ä»¥é€šè¿‡ç”¨æˆ·å®šä¹‰çš„å‡½æ•°è¿›è¡Œä¼ é€’æˆ–å¤„ç†ã€‚\nå¯¹äº DDLï¼Œæˆ‘ä»¬æ”¯æŒé¡µé¢æ•°æ®ç±»å‹ä¸­å®šä¹‰çš„å®Œæ•´æ•°æ®ç±»å‹ã€‚\næ³¨æ„äº‹é¡¹: æœ‰äº›æ•°æ®ç±»å‹åœ¨ SQL æŸ¥è¯¢ä¸­è¿˜ä¸æ”¯æŒï¼ˆå³åœ¨æŠ•é€’è¡¨è¾¾å¼æˆ–å­—å…ƒä¸­ï¼‰ã€‚ä¾‹å¦‚ï¼šSTRING, BYTES, RAW, WITHOUT TIME ZONE çš„ TIME(p), WITH LOCAL TIME ZONE çš„ TIME(p), WITHOUT TIME ZONE çš„ TIMESTAMP(p), WITH LOCAL TIME ZONE çš„ TIMESTAMP(p), ARRAY, MULTISET, ROWã€‚\nä¿ç•™å…³é”®è¯ è™½ç„¶å¹¶ä¸æ˜¯æ¯ä¸€ä¸ª SQL åŠŸèƒ½éƒ½å·²å®ç°ï¼Œä½†æœ‰äº›å­—ç¬¦ä¸²ç»„åˆå·²ç»è¢«ä¿ç•™ä¸ºå…³é”®å­—ï¼Œä¾›å°†æ¥ä½¿ç”¨ã€‚å¦‚æœä½ æƒ³ä½¿ç”¨ä¸‹é¢çš„ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå­—æ®µåï¼Œè¯·ç¡®ä¿åœ¨å®ƒä»¬å‘¨å›´åŠ ä¸Šåå¼•å·ï¼ˆä¾‹å¦‚valueï¼Œcountï¼‰ã€‚\nA, ABS, ABSOLUTE, ACTION, ADA, ADD, ADMIN, AFTER, ALL, ALLOCATE, ALLOW, ALTER, ALWAYS, AND, ANY, ARE, ARRAY, AS, ASC, ASENSITIVE, ASSERTION, ASSIGNMENT, ASYMMETRIC, AT, ATOMIC, ATTRIBUTE, ATTRIBUTES, AUTHORIZATION, AVG, BEFORE, BEGIN, BERNOULLI, BETWEEN, BIGINT, BINARY, BIT, BLOB, BOOLEAN, BOTH, BREADTH, BY, BYTES, C, CALL, CALLED, CARDINALITY, CASCADE, CASCADED, CASE, CAST, CATALOG, CATALOG_NAME, CEIL, CEILING, CENTURY, CHAIN, CHAR, CHARACTER, CHARACTERISTICS, CHARACTERS, CHARACTER_LENGTH, CHARACTER_SET_CATALOG, CHARACTER_SET_NAME, CHARACTER_SET_SCHEMA, CHAR_LENGTH, CHECK, CLASS_ORIGIN, CLOB, CLOSE, COALESCE, COBOL, COLLATE, COLLATION, COLLATION_CATALOG, COLLATION_NAME, COLLATION_SCHEMA, COLLECT, COLUMN, COLUMN_NAME, COMMAND_FUNCTION, COMMAND_FUNCTION_CODE, COMMIT, COMMITTED, CONDITION, CONDITION_NUMBER, CONNECT, CONNECTION, CONNECTION_NAME, CONSTRAINT, CONSTRAINTS, CONSTRAINT_CATALOG, CONSTRAINT_NAME, CONSTRAINT_SCHEMA, CONSTRUCTOR, CONTAINS, CONTINUE, CONVERT, CORR, CORRESPONDING, COUNT, COVAR_POP, COVAR_SAMP, CREATE, CROSS, CUBE, CUME_DIST, CURRENT, CURRENT_CATALOG, CURRENT_DATE, CURRENT_DEFAULT_TRANSFORM_GROUP, CURRENT_PATH, CURRENT_ROLE, CURRENT_SCHEMA, CURRENT_TIME, CURRENT_TIMESTAMP, CURRENT_TRANSFORM_GROUP_FOR_TYPE, CURRENT_USER, CURSOR, CURSOR_NAME, CYCLE, DATA, DATABASE, DATE, DATETIME_INTERVAL_CODE, DATETIME_INTERVAL_PRECISION, DAY, DEALLOCATE, DEC, DECADE, DECIMAL, DECLARE, DEFAULT, DEFAULTS, DEFERRABLE, DEFERRED, DEFINED, DEFINER, DEGREE, DELETE, DENSE_RANK, DEPTH, DEREF, DERIVED, DESC, DESCRIBE, DESCRIPTION, DESCRIPTOR, DETERMINISTIC, DIAGNOSTICS, DISALLOW, DISCONNECT, DISPATCH, DISTINCT, DOMAIN, DOUBLE, DOW, DOY, DROP, DYNAMIC, DYNAMIC_FUNCTION, DYNAMIC_FUNCTION_CODE, EACH, ELEMENT, ELSE, END, END-EXEC, EPOCH, EQUALS, ESCAPE, EVERY, EXCEPT, EXCEPTION, EXCLUDE, EXCLUDING, EXEC, EXECUTE, EXISTS, EXP, EXPLAIN, EXTEND, EXTERNAL, EXTRACT, FALSE, FETCH, FILTER, FINAL, FIRST, FIRST_VALUE, FLOAT, FLOOR, FOLLOWING, FOR, FOREIGN, FORTRAN, FOUND, FRAC_SECOND, FREE, FROM, FULL, FUNCTION, FUSION, G, GENERAL, GENERATED, GET, GLOBAL, GO, GOTO, GRANT, GRANTED, GROUP, GROUPING, HAVING, HIERARCHY, HOLD, HOUR, IDENTITY, IMMEDIATE, IMPLEMENTATION, IMPORT, IN, INCLUDING, INCREMENT, INDICATOR, INITIALLY, INNER, INOUT, INPUT, INSENSITIVE, INSERT, INSTANCE, INSTANTIABLE, INT, INTEGER, INTERSECT, INTERSECTION, INTERVAL, INTO, INVOKER, IS, ISOLATION, JAVA, JOIN, K, KEY, KEY_MEMBER, KEY_TYPE, LABEL, LANGUAGE, LARGE, LAST, LAST_VALUE, LATERAL, LEADING, LEFT, LENGTH, LEVEL, LIBRARY, LIKE, LIMIT, LN, LOCAL, LOCALTIME, LOCALTIMESTAMP, LOCATOR, LOWER, M, MAP, MATCH, MATCHED, MAX, MAXVALUE, MEMBER, MERGE, MESSAGE_LENGTH, MESSAGE_OCTET_LENGTH, MESSAGE_TEXT, METHOD, MICROSECOND, MILLENNIUM, MIN, MINUTE, MINVALUE, MOD, MODIFIES, MODULE, MONTH, MORE, MULTISET, MUMPS, NAME, NAMES, NATIONAL, NATURAL, NCHAR, NCLOB, NESTING, NEW, NEXT, NO, NONE, NORMALIZE, NORMALIZED, NOT, NULL, NULLABLE, NULLIF, NULLS, NUMBER, NUMERIC, OBJECT, OCTETS, OCTET_LENGTH, OF, OFFSET, OLD, ON, ONLY, OPEN, OPTION, OPTIONS, OR, ORDER, ORDERING, ORDINALITY, OTHERS, OUT, OUTER, OUTPUT, OVER, OVERLAPS, OVERLAY, OVERRIDING, PAD, PARAMETER, PARAMETER_MODE, PARAMETER_NAME, PARAMETER_ORDINAL_POSITION, PARAMETER_SPECIFIC_CATALOG, PARAMETER_SPECIFIC_NAME, PARAMETER_SPECIFIC_SCHEMA, PARTIAL, PARTITION, PASCAL, PASSTHROUGH, PATH, PERCENTILE_CONT, PERCENTILE_DISC, PERCENT_RANK, PLACING, PLAN, PLI, POSITION, POWER, PRECEDING, PRECISION, PREPARE, PRESERVE, PRIMARY, PRIOR, PRIVILEGES, PROCEDURE, PUBLIC, QUARTER, RANGE, RANK, RAW, READ, READS, REAL, RECURSIVE, REF, REFERENCES, REFERENCING, REGR_AVGX, REGR_AVGY, REGR_COUNT, REGR_INTERCEPT, REGR_R2, REGR_SLOPE, REGR_SXX, REGR_SXY, REGR_SYY, RELATIVE, RELEASE, REPEATABLE, RESET, RESTART, RESTRICT, RESULT, RETURN, RETURNED_CARDINALITY, RETURNED_LENGTH, RETURNED_OCTET_LENGTH, RETURNED_SQLSTATE, RETURNS, REVOKE, RIGHT, ROLE, ROLLBACK, ROLLUP, ROUTINE, ROUTINE_CATALOG, ROUTINE_NAME, ROUTINE_SCHEMA, ROW, ROWS, ROW_COUNT, ROW_NUMBER, SAVEPOINT, SCALE, SCHEMA, SCHEMA_NAME, SCOPE, SCOPE_CATALOGS, SCOPE_NAME, SCOPE_SCHEMA, SCROLL, SEARCH, SECOND, SECTION, SECURITY, SELECT, SELF, SENSITIVE, SEQUENCE, SERIALIZABLE, SERVER, SERVER_NAME, SESSION, SESSION_USER, SET, SETS, SIMILAR, SIMPLE, SIZE, SMALLINT, SOME, SOURCE, SPACE, SPECIFIC, SPECIFICTYPE, SPECIFIC_NAME, SQL, SQLEXCEPTION, SQLSTATE, SQLWARNING, SQL_TSI_DAY, SQL_TSI_FRAC_SECOND, SQL_TSI_HOUR, SQL_TSI_MICROSECOND, SQL_TSI_MINUTE, SQL_TSI_MONTH, SQL_TSI_QUARTER, SQL_TSI_SECOND, SQL_TSI_WEEK, SQL_TSI_YEAR, SQRT, START, STATE, STATEMENT, STATIC, STDDEV_POP, STDDEV_SAMP, STREAM, STRING, STRUCTURE, STYLE, SUBCLASS_ORIGIN, SUBMULTISET, SUBSTITUTE, SUBSTRING, SUM, SYMMETRIC, SYSTEM, SYSTEM_USER, TABLE, TABLESAMPLE, TABLE_NAME, TEMPORARY, THEN, TIES, TIME, TIMESTAMP, TIMESTAMPADD, TIMESTAMPDIFF, TIMEZONE_HOUR, TIMEZONE_MINUTE, TINYINT, TO, TOP_LEVEL_COUNT, TRAILING, TRANSACTION, TRANSACTIONS_ACTIVE, TRANSACTIONS_COMMITTED, TRANSACTIONS_ROLLED_BACK, TRANSFORM, TRANSFORMS, TRANSLATE, TRANSLATION, TREAT, TRIGGER, TRIGGER_CATALOG, TRIGGER_NAME, TRIGGER_SCHEMA, TRIM, TRUE, TYPE, UESCAPE, UNBOUNDED, UNCOMMITTED, UNDER, UNION, UNIQUE, UNKNOWN, UNNAMED, UNNEST, UPDATE, UPPER, UPSERT, USAGE, USER, USER_DEFINED_TYPE_CATALOG, USER_DEFINED_TYPE_CODE, USER_DEFINED_TYPE_NAME, USER_DEFINED_TYPE_SCHEMA, USING, VALUE, VALUES, VARBINARY, VARCHAR, VARYING, VAR_POP, VAR_SAMP, VERSION, VIEW, WEEK, WHEN, WHENEVER, WHERE, WIDTH_BUCKET, WINDOW, WITH, WITHIN, WITHOUT, WORK, WRAPPER, WRITE, XML, YEAR, ZONE ","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-sql-overview/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL"],"title":"SQL"},{"categories":["Flink"],"contents":"SQL Client Flink çš„ Table \u0026amp; SQL API ä½¿å¾—å®ƒå¯ä»¥ä½¿ç”¨ SQL è¯­è¨€ç¼–å†™çš„æŸ¥è¯¢ï¼Œä½†æ˜¯è¿™äº›æŸ¥è¯¢éœ€è¦åµŒå…¥åˆ°ä¸€ä¸ªç”¨ Java æˆ– Scala ç¼–å†™çš„è¡¨ç¨‹åºä¸­ã€‚è€Œä¸”ï¼Œè¿™äº›ç¨‹åºåœ¨æäº¤ç»™é›†ç¾¤ä¹‹å‰éœ€è¦ç”¨æ„å»ºå·¥å…·æ‰“åŒ…ã€‚è¿™æˆ–å¤šæˆ–å°‘é™åˆ¶äº† Flink å¯¹ Java/Scala ç¨‹åºå‘˜çš„ä½¿ç”¨ã€‚\nSQL Client æ—¨åœ¨æä¾›ä¸€ç§ç®€å•çš„æ–¹å¼æ¥ç¼–å†™ã€è°ƒè¯•å’Œæäº¤è¡¨ç¨‹åºåˆ° Flink é›†ç¾¤ï¼Œè€Œä¸éœ€è¦ä»»ä½•ä¸€è¡Œ Java æˆ– Scala ä»£ç ã€‚SQL Client CLI å…è®¸åœ¨å‘½ä»¤è¡Œä¸Šä»è¿è¡Œçš„åˆ†å¸ƒå¼åº”ç”¨ä¸­æ£€ç´¢å’Œå¯è§†åŒ–å®æ—¶ç»“æœã€‚\nå…¥é—¨ æœ¬èŠ‚ä»‹ç»å¦‚ä½•ä»å‘½ä»¤è¡Œè®¾ç½®å’Œè¿è¡Œç¬¬ä¸€ä¸ª Flink SQL ç¨‹åºã€‚\nSQL Client è¢«æ†ç»‘åœ¨å¸¸è§„çš„ Flink å‘è¡Œç‰ˆä¸­ï¼Œå› æ­¤å¯ä»¥å¼€ç®±å³è¿è¡Œã€‚å®ƒåªéœ€è¦ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ Flink é›†ç¾¤ï¼Œåœ¨é‚£é‡Œå¯ä»¥æ‰§è¡Œè¡¨ç¨‹åºã€‚å…³äºè®¾ç½® Flink é›†ç¾¤çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§é›†ç¾¤å’Œéƒ¨ç½²éƒ¨åˆ†ã€‚å¦‚æœä½ åªæ˜¯æƒ³è¯•ç”¨ SQL Clientï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ç”¨ä¸€ä¸ª worker å¯åŠ¨ä¸€ä¸ªæœ¬åœ°é›†ç¾¤ã€‚\n./bin/start-cluster.sh å¯åŠ¨ SQL å®¢æˆ·ç«¯ CLI SQL Client è„šæœ¬ä¹Ÿä½äº Flink çš„äºŒè¿›åˆ¶ç›®å½•ä¸­ã€‚åœ¨æœªæ¥ï¼Œç”¨æˆ·å°†æœ‰ä¸¤ç§å¯åŠ¨ SQL Client CLI çš„å¯èƒ½æ€§ï¼Œä¸€æ˜¯é€šè¿‡å¯åŠ¨ä¸€ä¸ªåµŒå…¥å¼çš„ç‹¬ç«‹è¿›ç¨‹ï¼ŒäºŒæ˜¯é€šè¿‡è¿æ¥åˆ°ä¸€ä¸ªè¿œç¨‹ SQL Client ç½‘å…³ã€‚ç›®å‰åªæ”¯æŒåµŒå…¥å¼æ¨¡å¼ã€‚ä½ å¯ä»¥é€šè¿‡è°ƒç”¨æ¥å¯åŠ¨ CLIã€‚\n./bin/sql-client.sh embedded é»˜è®¤æƒ…å†µä¸‹ï¼ŒSQL å®¢æˆ·ç«¯å°†ä»ä½äº ./conf/sql-client-defaults.yaml çš„ç¯å¢ƒæ–‡ä»¶ä¸­è¯»å–å…¶é…ç½®ã€‚æœ‰å…³ç¯å¢ƒæ–‡ä»¶ç»“æ„çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§é…ç½®éƒ¨åˆ†ã€‚\nè¿è¡Œ SQL æŸ¥è¯¢ ä¸€æ—¦å¯åŠ¨ CLIï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ HELP å‘½ä»¤åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„ SQL è¯­å¥ã€‚ä¸ºäº†éªŒè¯ä½ çš„è®¾ç½®å’Œé›†ç¾¤è¿æ¥ï¼Œä½ å¯ä»¥è¾“å…¥ç¬¬ä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œç„¶åæŒ‰å›è½¦é”®æ‰§è¡Œã€‚\nSELECT\u0026#39;Hello World\u0026#39;;è¿™ä¸ªæŸ¥è¯¢ä¸éœ€è¦è¡¨æº(table source)ï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªå•è¡Œç»“æœã€‚CLI å°†ä»é›†ç¾¤ä¸­æ£€ç´¢ç»“æœï¼Œå¹¶å°†å…¶å¯è§†åŒ–ã€‚æ‚¨å¯ä»¥æŒ‰Qé”®å…³é—­ç»“æœè§†å›¾ã€‚\nCLI æ”¯æŒä¸‰ç§æ¨¡å¼æ¥ç»´æŠ¤å’Œå¯è§†åŒ–ç»“æœã€‚\ntable æ¨¡å¼å°†ç»“æœåœ¨å†…å­˜ä¸­å…·ä½“åŒ–ï¼Œå¹¶ä»¥å¸¸è§„çš„ã€åˆ†é¡µçš„è¡¨æ ¼è¡¨ç¤ºæ–¹å¼å°†å…¶å¯è§†åŒ–ã€‚å¯ä»¥é€šè¿‡åœ¨ CLI ä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯ç”¨è¯¥æ¨¡å¼ã€‚\nSET execution.result-mode=table; changelog æ¨¡å¼ä¸å°†ç»“æœå…·ä½“åŒ–ï¼Œè€Œæ˜¯å°†ç”±æ’å…¥(+)å’Œæ”¶å›(-)ç»„æˆçš„è¿ç»­æŸ¥è¯¢æ‰€äº§ç”Ÿçš„ç»“æœæµå¯è§†åŒ–ã€‚\nSET execution.result-mode=changelog; tableau æ¨¡å¼æ›´åƒæ˜¯ä¼ ç»Ÿçš„æ–¹å¼ï¼Œå°†ç»“æœä»¥ tableau çš„å½¢å¼ç›´æ¥æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚æ˜¾ç¤ºå†…å®¹ä¼šå—åˆ°æŸ¥è¯¢æ‰§è¡Œç±»å‹(execute.type)çš„å½±å“ã€‚\nSET execution.result-mode=tableau; è¯·æ³¨æ„ï¼Œå½“æ‚¨ä½¿ç”¨æ­¤æ¨¡å¼è¿›è¡Œæµå¼æŸ¥è¯¢æ—¶ï¼Œç»“æœå°†åœ¨æ§åˆ¶å°ä¸­è¿ç»­æ‰“å°ã€‚å¦‚æœè¿™ä¸ªæŸ¥è¯¢çš„è¾“å…¥æ•°æ®æ˜¯æœ‰è¾¹ç•Œçš„ï¼Œé‚£ä¹ˆåœ¨Flinkå¤„ç†å®Œæ‰€æœ‰è¾“å…¥æ•°æ®åï¼Œä½œä¸šå°±ä¼šç»ˆæ­¢ï¼Œæ‰“å°ä¹Ÿä¼šè‡ªåŠ¨åœæ­¢ã€‚å¦åˆ™ï¼Œå¦‚æœä½ æƒ³ç»ˆæ­¢ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„æŸ¥è¯¢ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹åªè¦è¾“å…¥CTRL-Cé”®ï¼Œä½œä¸šå’Œæ‰“å°å°±ä¼šåœæ­¢ã€‚\nä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æŸ¥è¯¢æ¥æŸ¥çœ‹æ‰€æœ‰çš„ç»“æœæ¨¡å¼ã€‚\nSELECTname,COUNT(*)AScntFROM(VALUES(\u0026#39;Bob\u0026#39;),(\u0026#39;Alice\u0026#39;),(\u0026#39;Greg\u0026#39;),(\u0026#39;Bob\u0026#39;))ASNameTable(name)GROUPBYname;è¿™ä¸ªæŸ¥è¯¢æ‰§è¡Œä¸€ä¸ªæœ‰ç•Œå­—æ•°çš„ä¾‹å­ã€‚\nåœ¨ changelog æ¨¡å¼ä¸‹ï¼Œå¯è§†åŒ–çš„ changelog åº”è¯¥ç±»ä¼¼äºã€‚\n+ Bob, 1 + Alice, 1 + Greg, 1 - Bob, 1 + Bob, 2 åœ¨ table æ¨¡å¼ä¸‹ï¼Œå¯è§†åŒ–çš„ç»“æœè¡¨ä¼šæŒç»­æ›´æ–°ï¼Œç›´åˆ°è¡¨ç¨‹åºç»“æŸã€‚\nBob, 2 Alice, 1 Greg, 1 åœ¨tableauæ¨¡å¼ä¸‹ï¼Œå¦‚æœä½ åœ¨æµæ¨¡å¼ä¸‹è¿è¡ŒæŸ¥è¯¢ï¼Œæ˜¾ç¤ºçš„ç»“æœå°†æ˜¯ã€‚\n+-----+----------------------+----------------------+ | +/- | name | cnt | +-----+----------------------+----------------------+ | + | Bob | 1 | | + | Alice | 1 | | + | Greg | 1 | | - | Bob | 1 | | + | Bob | 2 | +-----+----------------------+----------------------+ Received a total of 5 rows è€Œå¦‚æœä½ åœ¨æ‰¹å¤„ç†æ¨¡å¼ä¸‹è¿è¡ŒæŸ¥è¯¢ï¼Œæ˜¾ç¤ºçš„ç»“æœå°†æ˜¯ã€‚\n+-------+-----+ | name | cnt | +-------+-----+ | Alice | 1 | | Bob | 2 | | Greg | 1 | +-------+-----+ 3 rows in set åœ¨ SQL æŸ¥è¯¢çš„åŸå‹è®¾è®¡è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰è¿™äº›ç»“æœæ¨¡å¼éƒ½æ˜¯æœ‰ç”¨çš„ã€‚åœ¨æ‰€æœ‰è¿™äº›æ¨¡å¼ä¸­ï¼Œç»“æœéƒ½å­˜å‚¨åœ¨ SQL å®¢æˆ·ç«¯çš„ Java å †å†…å­˜ä¸­ã€‚ä¸ºäº†ä¿æŒCLIç•Œé¢çš„å“åº”æ€§ï¼Œchangelog æ¨¡å¼åªæ˜¾ç¤ºæœ€æ–°çš„1000ä¸ªå˜åŒ–ã€‚è¡¨æ¨¡å¼å…è®¸æµè§ˆæ›´å¤§çš„ç»“æœï¼Œè¿™äº›ç»“æœä»…å—å¯ç”¨ä¸»å†…å­˜å’Œé…ç½®çš„æœ€å¤§è¡Œæ•°ï¼ˆmax-table-result-rowsï¼‰çš„é™åˆ¶ã€‚\næ³¨æ„ï¼šåœ¨æ‰¹å¤„ç†ç¯å¢ƒä¸­æ‰§è¡Œçš„æŸ¥è¯¢ï¼Œåªèƒ½ä½¿ç”¨tableæˆ–tableauç»“æœæ¨¡å¼è¿›è¡Œæ£€ç´¢ã€‚\nåœ¨å®šä¹‰äº†ä¸€ä¸ªæŸ¥è¯¢åï¼Œå¯ä»¥å°†å…¶ä½œä¸ºä¸€ä¸ªé•¿æœŸè¿è¡Œçš„ã€åˆ†ç¦»çš„ Flink ä½œä¸šæäº¤ç»™é›†ç¾¤ã€‚ä¸ºæ­¤ï¼Œéœ€è¦ä½¿ç”¨ INSERT INTO è¯­å¥æŒ‡å®šå­˜å‚¨ç»“æœçš„ç›®æ ‡ç³»ç»Ÿã€‚é…ç½®éƒ¨åˆ†è§£é‡Šäº†å¦‚ä½•å£°æ˜ table source ä»¥è¯»å–æ•°æ®ï¼Œå¦‚ä½•å£°æ˜ table sink ä»¥å†™å…¥æ•°æ®ï¼Œä»¥åŠå¦‚ä½•é…ç½®å…¶ä»–è¡¨ç¨‹åºå±æ€§ã€‚\né…ç½® SQL Client å¯ä»¥é€šè¿‡ä»¥ä¸‹å¯é€‰çš„CLIå‘½ä»¤æ¥å¯åŠ¨ã€‚è¿™äº›å‘½ä»¤å°†åœ¨åé¢çš„æ®µè½ä¸­è¯¦ç»†è®¨è®ºã€‚\n./bin/sql-client.sh embedded --help Mode \u0026quot;embedded\u0026quot; submits Flink jobs from the local machine. Syntax: embedded [OPTIONS] \u0026quot;embedded\u0026quot; mode options: -d,--defaults \u0026lt;environment file\u0026gt; The environment properties with which every new session is initialized. Properties might be overwritten by session properties. -e,--environment \u0026lt;environment file\u0026gt; The environment properties to be imported into the session. It might overwrite default environment properties. -h,--help Show the help message with descriptions of all options. -hist,--history \u0026lt;History file path\u0026gt; The file which you want to save the command history into. If not specified, we will auto-generate one under your user's home directory. -j,--jar \u0026lt;JAR file\u0026gt; A JAR file to be imported into the session. The file might contain user-defined classes needed for the execution of statements such as functions, table sources, or sinks. Can be used multiple times. -l,--library \u0026lt;JAR directory\u0026gt; A JAR file directory with which every new session is initialized. The files might contain user-defined classes needed for the execution of statements such as functions, table sources, or sinks. Can be used multiple times. -pyarch,--pyArchives \u0026lt;arg\u0026gt; Add python archive files for job. The archive files will be extracted to the working directory of python UDF worker. Currently only zip-format is supported. For each archive file, a target directory be specified. If the target directory name is specified, the archive file will be extracted to a name can directory with the specified name. Otherwise, the archive file will be extracted to a directory with the same name of the archive file. The files uploaded via this option are accessible via relative path. '#' could be used as the separator of the archive file path and the target directory name. Comma (',') could be used as the separator to specify multiple archive files. This option can be used to upload the virtual environment, the data files used in Python UDF (e.g.: --pyArchives file:///tmp/py37.zip,file:///tmp/data .zip#data --pyExecutable py37.zip/py37/bin/python). The data files could be accessed in Python UDF, e.g.: f = open('data/data.txt', 'r'). -pyexec,--pyExecutable \u0026lt;arg\u0026gt; Specify the path of the python interpreter used to execute the python UDF worker (e.g.: --pyExecutable /usr/local/bin/python3). The python UDF worker depends on Python 3.5+, Apache Beam (version == 2.19.0), Pip (version \u0026gt;= 7.1.0) and SetupTools (version \u0026gt;= 37.0.0). Please ensure that the specified environment meets the above requirements. -pyfs,--pyFiles \u0026lt;pythonFiles\u0026gt; Attach custom python files for job. These files will be added to the PYTHONPATH of both the local client and the remote python UDF worker. The standard python resource file suffixes such as .py/.egg/.zip or directory are all supported. Comma (',') could be used as the separator to specify multiple files (e.g.: --pyFiles file:///tmp/myresource.zip,hdfs:///$n amenode_address/myresource2.zip). -pyreq,--pyRequirements \u0026lt;arg\u0026gt; Specify a requirements.txt file which defines the third-party dependencies. These dependencies will be installed and added to the PYTHONPATH of the python UDF worker. A directory which contains the installation packages of these dependencies could be specified optionally. Use '#' as the separator if the optional parameter exists (e.g.: --pyRequirements file:///tmp/requirements.txt#file:/// tmp/cached_dir). -s,--session \u0026lt;session identifier\u0026gt; The identifier for a session. 'default' is the default identifier. -u,--update \u0026lt;SQL update statement\u0026gt; Experimental (for testing only!): Instructs the SQL Client to immediately execute the given update statement after starting up. The process is shut down after the statement has been submitted to the cluster and returns an appropriate return code. Currently, this feature is only supported for INSERT INTO statements that declare the target sink table. ç¯å¢ƒæ–‡ä»¶ ä¸€ä¸ªSQLæŸ¥è¯¢éœ€è¦ä¸€ä¸ªé…ç½®ç¯å¢ƒæ¥æ‰§è¡Œã€‚æ‰€è°“çš„ç¯å¢ƒæ–‡ä»¶å®šä¹‰äº†å¯ç”¨çš„ç›®å½•(catalogs)ã€table source å’Œ sinkã€ç”¨æˆ·å®šä¹‰çš„å‡½æ•°ä»¥åŠæ‰§è¡Œå’Œéƒ¨ç½²æ‰€éœ€çš„å…¶ä»–å±æ€§ã€‚\næ¯ä¸ªç¯å¢ƒæ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªå¸¸è§„çš„ YAML æ–‡ä»¶ã€‚ä¸‹é¢æ˜¯è¿™æ ·ä¸€ä¸ªæ–‡ä»¶çš„ä¾‹å­ã€‚\n# Define tables here such as sources, sinks, views, or temporal tables.tables:- name:MyTableSourcetype:source-tableupdate-mode:appendconnector:type:filesystempath:\u0026#34;/path/to/something.csv\u0026#34;format:type:csvfields:- name:MyField1data-type:INT- name:MyField2data-type:VARCHARline-delimiter:\u0026#34;\\n\u0026#34;comment-prefix:\u0026#34;#\u0026#34;schema:- name:MyField1data-type:INT- name:MyField2data-type:VARCHAR- name:MyCustomViewtype:viewquery:\u0026#34;SELECT MyField2 FROM MyTableSource\u0026#34;# Define user-defined functions here.functions:- name:myUDFfrom:classclass:foo.bar.AggregateUDFconstructor:- 7.6- false# Define available catalogscatalogs:- name:catalog_1type:hiveproperty-version:1hive-conf-dir:...- name:catalog_2type:hiveproperty-version:1default-database:mydb2hive-conf-dir:...# Properties that change the fundamental execution behavior of a table program.execution:planner: blink # optional:either \u0026#39;blink\u0026#39; (default) or \u0026#39;old\u0026#39;type: streaming # required:execution mode either \u0026#39;batch\u0026#39; or \u0026#39;streaming\u0026#39;result-mode: table # required:either \u0026#39;table\u0026#39; or \u0026#39;changelog\u0026#39;max-table-result-rows: 1000000 # optional:maximum number of maintained rows in# \u0026#39;table\u0026#39; mode (1000000 by default, smaller 1 means unlimited)time-characteristic: event-time # optional:\u0026#39;processing-time\u0026#39;or \u0026#39;event-time\u0026#39; (default)parallelism: 1 # optional:Flink\u0026#39;s parallelism (1 by default)periodic-watermarks-interval: 200 # optional:interval for periodic watermarks (200 ms by default)max-parallelism: 16 # optional:Flink\u0026#39;s maximum parallelism (128 by default)min-idle-state-retention: 0 # optional:table program\u0026#39;s minimum idle state timemax-idle-state-retention: 0 # optional:table program\u0026#39;s maximum idle state timecurrent-catalog: catalog_1 # optional:name of the current catalog of the session (\u0026#39;default_catalog\u0026#39; by default)current-database: mydb1 # optional:name of the current database of the current catalog# (default database of the current catalog by default)restart-strategy: # optional:restart strategytype:fallback # \u0026#34;fallback\u0026#34; to global restart strategy by default# Configuration options for adjusting and tuning table programs.# A full list of options and their default values can be found# on the dedicated \u0026#34;Configuration\u0026#34; page.configuration:table.optimizer.join-reorder-enabled:truetable.exec.spill-compression.enabled:truetable.exec.spill-compression.block-size:128kb# Properties that describe the cluster to which table programs are submitted to.deployment:response-timeout:5000è¿™ä»½é…ç½®:\n å®šä¹‰äº†ä¸€ä¸ªè¡¨æº MyTableSource çš„ç¯å¢ƒï¼Œè¯¥è¡¨æºä» CSV æ–‡ä»¶ä¸­è¯»å–ã€‚ å®šä¹‰äº†ä¸€ä¸ªè§†å›¾ MyCustomViewï¼Œè¯¥è§†å›¾ä½¿ç”¨ SQL æŸ¥è¯¢å£°æ˜äº†ä¸€ä¸ªè™šæ‹Ÿè¡¨ã€‚ å®šä¹‰äº†ä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„å‡½æ•° myUDFï¼Œå¯ä»¥ä½¿ç”¨ç±»åå’Œä¸¤ä¸ªæ„é€ å‡½æ•°å‚æ•°æ¥å®ä¾‹åŒ–ã€‚ è¿æ¥ä¸¤ä¸ª Hive ç›®å½•ï¼Œå¹¶ä½¿ç”¨ catalog_1 ä½œä¸ºå½“å‰ç›®å½•ï¼Œmydb1 ä½œä¸ºç›®å½•çš„å½“å‰æ•°æ®åº“ã€‚ åœ¨æµå¼æ¨¡å¼ä¸‹ä½¿ç”¨ blink plannerï¼Œè¿è¡Œå…·æœ‰äº‹ä»¶æ—¶é—´ç‰¹æ€§å’Œå¹¶è¡Œåº¦ä¸º1çš„è¯­å¥ã€‚ åœ¨ table ç»“æœæ¨¡å¼ä¸‹è¿è¡Œæ¢ç´¢æ€§æŸ¥è¯¢ã€‚ å¹¶é€šè¿‡é…ç½®é€‰é¡¹å›´ç»•è¿æ¥é‡æ’åºå’Œæº¢å‡ºè¿›è¡Œä¸€äº› planner è°ƒæ•´ã€‚  æ ¹æ®ä½¿ç”¨æƒ…å†µï¼Œä¸€ä¸ªé…ç½®å¯ä»¥è¢«åˆ†å‰²æˆå¤šä¸ªæ–‡ä»¶ã€‚å› æ­¤ï¼Œå¯ä»¥ä¸ºä¸€èˆ¬ç›®çš„åˆ›å»ºç¯å¢ƒæ–‡ä»¶ï¼ˆä½¿ç”¨ --defaults åˆ›å»ºé»˜è®¤ç¯å¢ƒæ–‡ä»¶ï¼‰ï¼Œä¹Ÿå¯ä»¥ä¸ºæ¯ä¸ªä¼šè¯åˆ›å»ºç¯å¢ƒæ–‡ä»¶ï¼ˆä½¿ç”¨ --environment åˆ›å»ºä¼šè¯ç¯å¢ƒæ–‡ä»¶ï¼‰ã€‚æ¯ä¸€ä¸ª CLI ä¼šè¯éƒ½ä¼šç”¨é»˜è®¤å±æ€§å’Œä¼šè¯å±æ€§æ¥åˆå§‹åŒ–ã€‚ä¾‹å¦‚ï¼Œdefaults ç¯å¢ƒæ–‡ä»¶å¯ä»¥æŒ‡å®šåœ¨æ¯ä¸ªä¼šè¯ä¸­åº”è¯¥å¯ä»¥æŸ¥è¯¢çš„æ‰€æœ‰ table sourceï¼Œè€Œ session ç¯å¢ƒæ–‡ä»¶åªå£°æ˜ç‰¹å®šçš„çŠ¶æ€ä¿ç•™æ—¶é—´å’Œå¹¶è¡Œåº¦ã€‚åœ¨å¯åŠ¨CLIåº”ç”¨ç¨‹åºæ—¶ï¼Œå¯ä»¥åŒæ—¶ä¼ é€’é»˜è®¤ç¯å¢ƒæ–‡ä»¶å’Œä¼šè¯ç¯å¢ƒæ–‡ä»¶ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šé»˜è®¤ç¯å¢ƒæ–‡ä»¶ï¼ŒSQL Client ä¼šåœ¨ Flink çš„é…ç½®ç›®å½•ä¸‹æœç´¢ ./conf/sql-client-defaults.yamlã€‚\næ³¨æ„ï¼šåœ¨ CLI ä¼šè¯ä¸­è®¾ç½®çš„å±æ€§ï¼ˆä¾‹å¦‚ä½¿ç”¨SETå‘½ä»¤ï¼‰å…·æœ‰æœ€é«˜ä¼˜å…ˆæƒã€‚\nCLI commands \u0026gt; session environment file \u0026gt; defaults environment file é‡å¯ç­–ç•¥ é‡å¯ç­–ç•¥æ§åˆ¶ Flink ä½œä¸šåœ¨å‘ç”Ÿæ•…éšœæ—¶å¦‚ä½•é‡å¯ã€‚ä¸ Flink é›†ç¾¤çš„å…¨å±€é‡å¯ç­–ç•¥ç±»ä¼¼ï¼Œå¯ä»¥åœ¨ç¯å¢ƒæ–‡ä»¶ä¸­å£°æ˜ä¸€ä¸ªæ›´ç²¾ç»†çš„é‡å¯é…ç½®ã€‚\næ”¯æŒä»¥ä¸‹ç­–ç•¥ã€‚\nexecution:# falls back to the global strategy defined in flink-conf.yamlrestart-strategy:type:fallback# job fails directly and no restart is attemptedrestart-strategy:type:none# attempts a given number of times to restart the jobrestart-strategy:type:fixed-delayattempts: 3 # retries before job is declared as failed (default:Integer.MAX_VALUE)delay: 10000 # delay in ms between retries (default:10s)# attempts as long as the maximum number of failures per time interval is not exceededrestart-strategy:type:failure-ratemax-failures-per-interval: 1 # retries in interval until failing (default:1)failure-rate-interval:60000# measuring interval in ms for failure ratedelay: 10000 # delay in ms between retries (default:10s)ä¾èµ–æ€§ SQL Client ä¸éœ€è¦ä½¿ç”¨ Maven æˆ– SBT è®¾ç½®ä¸€ä¸ª Java é¡¹ç›®ã€‚ç›¸åï¼Œä½ å¯ä»¥å°†ä¾èµ–å…³ç³»ä½œä¸ºå¸¸è§„çš„ JAR æ–‡ä»¶ä¼ é€’ç»™é›†ç¾¤ã€‚ä½ å¯ä»¥å•ç‹¬æŒ‡å®šæ¯ä¸ª JAR æ–‡ä»¶ï¼ˆä½¿ç”¨ --jarï¼‰æˆ–å®šä¹‰æ•´ä¸ªåº“ç›®å½•ï¼ˆä½¿ç”¨ --libraryï¼‰ã€‚å¯¹äºè¿æ¥åˆ°å¤–éƒ¨ç³»ç»Ÿï¼ˆå¦‚ Apache Kafkaï¼‰çš„è¿æ¥å™¨å’Œç›¸åº”çš„æ•°æ®æ ¼å¼ï¼ˆå¦‚JSONï¼‰ï¼ŒFlink æä¾›äº†ç°æˆçš„ JAR bundlesã€‚è¿™äº› JAR æ–‡ä»¶å¯ä»¥ä» Maven ä¸­å¤®ä»“åº“ä¸ºæ¯ä¸ªç‰ˆæœ¬ä¸‹è½½ã€‚\næ‰€æä¾›çš„ SQL JAR çš„å®Œæ•´åˆ—è¡¨å’Œå…³äºå¦‚ä½•ä½¿ç”¨å®ƒä»¬çš„æ–‡æ¡£å¯ä»¥åœ¨è¿æ¥åˆ°å¤–éƒ¨ç³»ç»Ÿé¡µé¢ä¸Šæ‰¾åˆ°ã€‚\nä¸‹é¢çš„ä¾‹å­æ˜¾ç¤ºäº†ä¸€ä¸ªç¯å¢ƒæ–‡ä»¶ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªä» Apache Kafka è¯»å– JSON æ•°æ®çš„ table sourceã€‚\ntables:- name:TaxiRidestype:source-tableupdate-mode:appendconnector:property-version:1type:kafkaversion:\u0026#34;0.11\u0026#34;topic:TaxiRidesstartup-mode:earliest-offsetproperties:bootstrap.servers:localhost:9092group.id:testGroupformat:property-version:1type:jsonschema:\u0026#34;ROW\u0026lt;rideId LONG, lon FLOAT, lat FLOAT, rideTime TIMESTAMP\u0026gt;\u0026#34;schema:- name:rideIddata-type:BIGINT- name:londata-type:FLOAT- name:latdata-type:FLOAT- name:rowTimedata-type:TIMESTAMP(3)rowtime:timestamps:type:\u0026#34;from-field\u0026#34;from:\u0026#34;rideTime\u0026#34;watermarks:type:\u0026#34;periodic-bounded\u0026#34;delay:\u0026#34;60000\u0026#34;- name:procTimedata-type:TIMESTAMP(3)proctime:trueç”±æ­¤äº§ç”Ÿçš„ TaxiRide è¡¨çš„æ¨¡å¼(schema)åŒ…å«äº† JSON æ¨¡å¼(schema)çš„å¤§éƒ¨åˆ†å­—æ®µã€‚æ­¤å¤–ï¼Œå®ƒè¿˜å¢åŠ äº†ä¸€ä¸ªè¡Œæ—¶é—´å±æ€§ rowTime å’Œå¤„ç†æ—¶é—´å±æ€§ procTimeã€‚\nconnector å’Œ format éƒ½å…è®¸å®šä¹‰ä¸€ä¸ªå±æ€§ç‰ˆæœ¬ï¼ˆç›®å‰æ˜¯ç‰ˆæœ¬1ï¼‰ï¼Œä»¥ä¾¿äºå°†æ¥å‘åå…¼å®¹ã€‚\nç”¨æˆ·å®šä¹‰çš„å‡½æ•° SQL Client å…è®¸ç”¨æˆ·åˆ›å»ºè‡ªå®šä¹‰çš„ã€ç”¨æˆ·å®šä¹‰çš„å‡½æ•°ï¼Œä»¥ä¾¿åœ¨ SQL æŸ¥è¯¢ä¸­ä½¿ç”¨ã€‚ç›®å‰ï¼Œè¿™äº›å‡½æ•°è¢«é™åˆ¶åœ¨ Java/Scala ç±»æˆ– Python æ–‡ä»¶ä¸­ä»¥ç¼–ç¨‹æ–¹å¼å®šä¹‰ã€‚\nä¸ºäº†æä¾›ä¸€ä¸ª Java/Scala ç”¨æˆ·å®šä¹‰çš„å‡½æ•°ï¼Œä½ éœ€è¦é¦–å…ˆå®ç°å’Œç¼–è¯‘ä¸€ä¸ªæ‰©å±• ScalarFunctionã€AggregateFunction æˆ– TableFunction çš„å‡½æ•°ç±»ï¼ˆè§ç”¨æˆ·å®šä¹‰çš„å‡½æ•°ï¼‰ã€‚ç„¶åå¯ä»¥å°†ä¸€ä¸ªæˆ–å¤šä¸ªå‡½æ•°æ‰“åŒ…åˆ° SQL Client çš„ä¾èµ– JAR ä¸­ã€‚\nä¸ºäº†æä¾›ä¸€ä¸ª Python ç”¨æˆ·å®šä¹‰å‡½æ•°ï¼Œä½ éœ€è¦ç¼–å†™ä¸€ä¸ª Python å‡½æ•°ï¼Œå¹¶ç”¨ pyflink.table.udf.udf æˆ– pyflink.table.udf.udtf è£…é¥°å™¨æ¥è£…é¥°å®ƒ(è§ Python UDFs)ã€‚ç„¶åå¯ä»¥å°†ä¸€ä¸ªæˆ–å¤šä¸ªå‡½æ•°æ”¾å…¥ä¸€ä¸ª Python æ–‡ä»¶ä¸­ã€‚Python æ–‡ä»¶å’Œç›¸å…³çš„ä¾èµ–å…³ç³»éœ€è¦é€šè¿‡ç¯å¢ƒæ–‡ä»¶ä¸­çš„é…ç½® (å‚è§ Python é…ç½®) æˆ–å‘½ä»¤è¡Œé€‰é¡¹ (å‚è§å‘½ä»¤è¡Œç”¨æ³•) æ¥æŒ‡å®šã€‚\næ‰€æœ‰å‡½æ•°åœ¨è¢«è°ƒç”¨ä¹‹å‰å¿…é¡»åœ¨ç¯å¢ƒæ–‡ä»¶ä¸­å£°æ˜ã€‚å¯¹äºå‡½æ•°åˆ—è¡¨ä¸­çš„æ¯ä¸€é¡¹ï¼Œå¿…é¡»æŒ‡å®š\n æ³¨å†Œè¯¥å‡½æ•°çš„åç§°ã€‚ å‡½æ•°çš„æºï¼Œä½¿ç”¨ from (æš‚æ—¶é™åˆ¶ä¸º class (Java/Scala UDF) æˆ– python (Python UDF))ã€‚  Java/Scala UDF å¿…é¡»æŒ‡å®š:\n classï¼Œè¡¨ç¤ºå‡½æ•°çš„å®Œå…¨é™å®šç±»åå’Œä¸€ä¸ªå¯é€‰çš„å®ä¾‹åŒ–æ„é€ å‚æ•°åˆ—è¡¨ã€‚  Python çš„ UDF å¿…é¡»æŒ‡å®š:\n fully-qualified-name: è¡¨ç¤ºå®Œå…¨é™å®šçš„åç§°ï¼Œå³å‡½æ•°çš„\u0026quot;[æ¨¡å—å].[å¯¹è±¡å]\u0026quot;ã€‚  functions:- name: java_udf # required:name of the functionfrom: class # required:source of the functionclass: ... # required:fully qualified class name of the functionconstructor: # optional:constructor parameters of the function class- ... # optional:a literal parameter with implicit type- class: ... # optional:full class name of the parameterconstructor: # optional:constructor parameters of the parameter\u0026#39;s class- type: ... # optional:type of the literal parametervalue: ... # optional:value of the literal parameter- name: python_udf # required:name of the functionfrom: python # required:source of the function fully-qualified-name: ... # required:fully qualified class name of the function å¯¹äº Java/Scala UDFï¼Œè¯·ç¡®ä¿æŒ‡å®šå‚æ•°çš„é¡ºåºå’Œç±»å‹ä¸¥æ ¼åŒ¹é…ä½ çš„å‡½æ•°ç±»çš„ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚\næ„é€ å‡½æ•°å‚æ•° æ ¹æ®ç”¨æˆ·å®šä¹‰çš„å‡½æ•°ï¼Œåœ¨ SQL è¯­å¥ä¸­ä½¿ç”¨å®ƒä¹‹å‰ï¼Œå¯èƒ½éœ€è¦å¯¹å®ç°è¿›è¡Œå‚æ•°åŒ–ã€‚\nå¦‚å‰é¢çš„ä¾‹å­æ‰€ç¤ºï¼Œåœ¨å£°æ˜ç”¨æˆ·å®šä¹‰å‡½æ•°æ—¶ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸‰ç§æ–¹å¼ä¹‹ä¸€ä½¿ç”¨æ„é€ å‡½æ•°å‚æ•°æ¥é…ç½®ç±»ã€‚\nä¸€ä¸ªéšå«ç±»å‹çš„å­—é¢å€¼ã€‚SQL Client ä¼šæ ¹æ®å­—é¢å€¼æœ¬èº«è‡ªåŠ¨æ¨å¯¼å‡ºç±»å‹ã€‚ç›®å‰ï¼Œè¿™é‡Œåªæ”¯æŒ BOOLEANã€INTã€DOUBLE å’Œ VARCHAR çš„å€¼ã€‚å¦‚æœè‡ªåŠ¨æ¨å¯¼æ²¡æœ‰è¾¾åˆ°é¢„æœŸçš„æ•ˆæœï¼ˆä¾‹å¦‚ï¼Œä½ éœ€è¦ä¸€ä¸ª VARCHAR falseï¼‰ï¼Œè¯·ä½¿ç”¨æ˜¾å¼ç±»å‹ä»£æ›¿ã€‚\n- true # -\u0026gt; BOOLEAN (case sensitive) - 42 # -\u0026gt; INT - 1234.222 # -\u0026gt; DOUBLE - foo # -\u0026gt; VARCHAR ä¸€ä¸ªå…·æœ‰æ˜ç¡®ç±»å‹çš„å­—é¢å€¼ã€‚æ˜ç¡®å£°æ˜å‚æ•°çš„ type å’Œ value å±æ€§ï¼Œä»¥ä¿è¯ç±»å‹å®‰å…¨ã€‚\n- type: DECIMAL value: 11111111111111111 ä¸‹è¡¨è¯´æ˜äº†æ”¯æŒçš„ Java å‚æ•°ç±»å‹å’Œç›¸åº”çš„ SQL ç±»å‹å­—ç¬¦ä¸²ã€‚\n   Java type SQL type     java.math.BigDecimal DECIMAL   java.lang.Boolean BOOLEAN   java.lang.Byte TINYINT   java.lang.Double DOUBLE   java.lang.Float REAL, FLOAT   java.lang.Integer INTEGER, INT   java.lang.Long BIGINT   java.lang.Short SMALLINT   java.lang.String VARCHAR    ç›®å‰è¿˜ä¸æ”¯æŒæ›´å¤šçš„ç±»å‹ï¼ˆå¦‚ TIMESTAMP æˆ– ARRAYï¼‰ã€åŸè¯­ç±»å‹å’Œ nullã€‚\nä¸€ä¸ªï¼ˆåµŒå¥—çš„ï¼‰ç±»å®ä¾‹ã€‚é™¤äº†å­—é¢å€¼ï¼Œä½ è¿˜å¯ä»¥é€šè¿‡æŒ‡å®š class å’Œ constructor å‡½æ•°å±æ€§ï¼Œä¸ºæ„é€ å‡½æ•°å‚æ•°åˆ›å»ºï¼ˆåµŒå¥—ï¼‰ç±»å®ä¾‹ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥é€’å½’æ‰§è¡Œï¼Œç›´åˆ°æ‰€æœ‰çš„æ„é€ å‚æ•°éƒ½ç”¨å­—é¢å€¼è¡¨ç¤ºã€‚\n- class:foo.bar.paramClassconstructor:- StarryName- class:java.lang.Integerconstructor:- class:java.lang.Stringconstructor:- type:VARCHARvalue:3Catalogs Catalogs å¯ä»¥å®šä¹‰ä¸ºä¸€ç»„ YAML å±æ€§ï¼Œåœ¨å¯åŠ¨ SQL Client æ—¶è‡ªåŠ¨æ³¨å†Œåˆ°ç¯å¢ƒä¸­ã€‚\nç”¨æˆ·å¯ä»¥åœ¨ SQL CLI ä¸­æŒ‡å®šè¦ä½¿ç”¨å“ªä¸ªç›®å½•(catalog)ä½œä¸ºå½“å‰ç›®å½•(catalog)ï¼Œä»¥åŠè¦ä½¿ç”¨è¯¥ç›®å½•(catalog)çš„å“ªä¸ªæ•°æ®åº“ä½œä¸ºå½“å‰æ•°æ®åº“ã€‚\ncatalogs:- name:catalog_1type:hiveproperty-version:1default-database:mydb2hive-conf-dir:\u0026lt;path of Hive conf directory\u0026gt;- name:catalog_2type:hiveproperty-version:1hive-conf-dir:\u0026lt;path of Hive conf directory\u0026gt;execution:...current-catalog:catalog_1current-database:mydb1å…³äºç›®å½•çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ç›®å½•ã€‚\nåˆ†ç¦»å¼ SQL æŸ¥è¯¢ ä¸ºäº†å®šä¹‰ç«¯åˆ°ç«¯ SQL ç®¡é“ï¼ŒSQL çš„ INSERT INTO è¯­å¥å¯ä»¥ç”¨äºå‘ Flink é›†ç¾¤æäº¤é•¿æœŸè¿è¡Œçš„ã€åˆ†ç¦»çš„æŸ¥è¯¢ã€‚è¿™äº›æŸ¥è¯¢å°†å…¶ç»“æœäº§ç”Ÿåˆ°å¤–éƒ¨ç³»ç»Ÿä¸­ï¼Œè€Œä¸æ˜¯ SQL Clientã€‚è¿™å…è®¸å¤„ç†æ›´é«˜çš„å¹¶è¡Œæ€§å’Œæ›´å¤§çš„æ•°æ®é‡ã€‚CLI æœ¬èº«å¯¹æäº¤åçš„åˆ†ç¦»æŸ¥è¯¢æ²¡æœ‰ä»»ä½•æ§åˆ¶ã€‚\nINSERTINTOMyTableSinkSELECT*FROMMyTableSourceè¡¨æ¥æ”¶å™¨ MyTableSink å¿…é¡»åœ¨ç¯å¢ƒæ–‡ä»¶ä¸­å£°æ˜ã€‚æœ‰å…³æ”¯æŒçš„å¤–éƒ¨ç³»ç»ŸåŠå…¶é…ç½®çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§è¿æ¥é¡µé¢ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ª Apache Kafka è¡¨æ¥æ”¶å™¨çš„ä¾‹å­ã€‚\ntables:- name:MyTableSinktype:sink-tableupdate-mode:appendconnector:property-version:1type:kafkaversion:\u0026#34;0.11\u0026#34;topic:OutputTopicproperties:bootstrap.servers:localhost:9092group.id:testGroupformat:property-version:1type:jsonderive-schema:trueschema:- name:rideIddata-type:BIGINT- name:londata-type:FLOAT- name:latdata-type:FLOAT- name:rideTimedata-type:TIMESTAMP(3)SQL å®¢æˆ·ç«¯ç¡®ä¿è¯­å¥æˆåŠŸæäº¤åˆ°é›†ç¾¤ã€‚ä¸€æ—¦æäº¤æŸ¥è¯¢ï¼ŒCLI å°†æ˜¾ç¤ºæœ‰å…³ Flink ä½œä¸šçš„ä¿¡æ¯ã€‚\n[INFO] Table update statement has been successfully submitted to the cluster: Cluster ID: StandaloneClusterId Job ID: 6f922fe5cba87406ff23ae4a7bb79044 Web interface: http://localhost:8081 æ³¨æ„: SQL å®¢æˆ·ç«¯åœ¨æäº¤åä¸ä¼šè·Ÿè¸ªæ­£åœ¨è¿è¡Œçš„ Flink ä½œä¸šçš„çŠ¶æ€ã€‚CLI è¿›ç¨‹å¯ä»¥åœ¨æäº¤åè¢«å…³é—­ï¼Œè€Œä¸å½±å“åˆ†ç¦»æŸ¥è¯¢ã€‚Flink çš„é‡å¯ç­–ç•¥ç…§é¡¾åˆ°äº†å®¹é”™ã€‚å¯ä»¥ä½¿ç”¨ Flink çš„ Web ç•Œé¢ã€å‘½ä»¤è¡Œæˆ– REST API æ¥å–æ¶ˆæŸ¥è¯¢ã€‚\nSQL è§†å›¾ è§†å›¾å…è®¸ä» SQL æŸ¥è¯¢ä¸­å®šä¹‰è™šæ‹Ÿè¡¨ã€‚è§†å›¾å®šä¹‰ä¼šè¢«ç«‹å³è§£æå’ŒéªŒè¯ã€‚ç„¶è€Œï¼Œå®é™…çš„æ‰§è¡Œå‘ç”Ÿåœ¨æäº¤ä¸€èˆ¬çš„ INSERT INTO æˆ– SELECT è¯­å¥æœŸé—´è®¿é—®è§†å›¾æ—¶ã€‚\nè§†å›¾å¯ä»¥åœ¨ç¯å¢ƒæ–‡ä»¶ä¸­å®šä¹‰ï¼Œä¹Ÿå¯ä»¥åœ¨ CLI ä¼šè¯ä¸­å®šä¹‰ã€‚\nä¸‹é¢çš„ä¾‹å­æ˜¾ç¤ºäº†å¦‚ä½•åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å®šä¹‰å¤šä¸ªè§†å›¾ã€‚è§†å›¾æ˜¯æŒ‰ç…§å®ƒä»¬åœ¨ç¯å¢ƒæ–‡ä»¶ä¸­å®šä¹‰çš„é¡ºåºæ³¨å†Œçš„ã€‚æ”¯æŒè¯¸å¦‚è§†å›¾ A ä¾èµ–äºè§†å›¾ B ä¾èµ–äºè§†å›¾ C çš„å¼•ç”¨é“¾ã€‚\ntables:- name:MyTableSource# ...- name:MyRestrictedViewtype:viewquery:\u0026#34;SELECT MyField2 FROM MyTableSource\u0026#34;- name:MyComplexViewtype:viewquery:\u0026gt;SELECT MyField2 + 42, CAST(MyField1 AS VARCHAR) FROM MyTableSource WHERE MyField2 \u0026gt; 200ä¸ table source å’Œ sink ç±»ä¼¼ï¼Œä¼šè¯ç¯å¢ƒæ–‡ä»¶ä¸­å®šä¹‰çš„è§†å›¾å…·æœ‰æœ€é«˜ä¼˜å…ˆçº§ã€‚\nè§†å›¾ä¹Ÿå¯ä»¥åœ¨ CLI ä¼šè¯ä¸­ä½¿ç”¨ CREATE VIEW è¯­å¥åˆ›å»ºã€‚\nCREATEVIEWMyNewViewASSELECTMyField2FROMMyTableSource;åœ¨ CLI ä¼šè¯ä¸­åˆ›å»ºçš„è§†å›¾ä¹Ÿå¯ä»¥ä½¿ç”¨ DROP VIEW è¯­å¥å†æ¬¡åˆ é™¤ã€‚\nDROPVIEWMyNewView;æ³¨æ„: CLI ä¸­è§†å›¾çš„å®šä¹‰ä»…é™äºä¸Šè¿°è¯­æ³•ã€‚åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ï¼Œå°†æ”¯æŒä¸ºè§†å›¾å®šä¹‰æ¨¡å¼æˆ–åœ¨è¡¨åä¸­è½¬ä¹‰ç©ºæ ¼ã€‚\nä¸´æ—¶è¡¨ ä¸´æ—¶è¡¨å…è®¸å¯¹å˜åŒ–çš„å†å²è¡¨è¿›è¡Œï¼ˆå‚æ•°åŒ–çš„ï¼‰æŸ¥çœ‹ï¼Œè¯¥è¡¨åœ¨ç‰¹å®šçš„æ—¶é—´ç‚¹è¿”å›ä¸€ä¸ªè¡¨çš„å†…å®¹ã€‚è¿™å¯¹äºå°†ä¸€ä¸ªè¡¨ä¸å¦ä¸€ä¸ªè¡¨åœ¨ç‰¹å®šæ—¶é—´æˆ³çš„å†…å®¹è¿æ¥èµ·æ¥ç‰¹åˆ«æœ‰ç”¨ã€‚æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨ä¸´æ—¶è¡¨è¿æ¥é¡µé¢ä¸­æ‰¾åˆ°ã€‚\nä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•å®šä¹‰ä¸€ä¸ªä¸´æ—¶è¡¨ SourceTemporalTableã€‚\ntables:# Define the table source (or view) that contains updates to a temporal table- name:HistorySourcetype:source-tableupdate-mode:appendconnector:# ...format:# ...schema:- name:integerFielddata-type:INT- name:stringFielddata-type:STRING- name:rowtimeFielddata-type:TIMESTAMP(3)rowtime:timestamps:type:from-fieldfrom:rowtimeFieldwatermarks:type:from-source# Define a temporal table over the changing history table with time attribute and primary key- name:SourceTemporalTabletype:temporal-tablehistory-table:HistorySourceprimary-key:integerFieldtime-attribute:rowtimeField # could also be a proctime fieldå¦‚ç¤ºä¾‹ä¸­æ‰€ç¤ºï¼Œtable sourceã€è§†å›¾å’Œä¸´æ—¶è¡¨çš„å®šä¹‰å¯ä»¥ç›¸äº’æ··åˆã€‚å®ƒä»¬æŒ‰ç…§åœ¨ç¯å¢ƒæ–‡ä»¶ä¸­å®šä¹‰çš„é¡ºåºè¿›è¡Œæ³¨å†Œã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªä¸´æ—¶è¡¨å¯ä»¥å¼•ç”¨ä¸€ä¸ªè§†å›¾ï¼Œè¯¥è§†å›¾å¯ä»¥ä¾èµ–äºå¦ä¸€ä¸ªè§†å›¾æˆ– table sourceã€‚\né™åˆ¶å’Œæœªæ¥ ç›®å‰çš„ SQL Client åªæ”¯æŒåµŒå…¥å¼æ¨¡å¼ã€‚æœªæ¥ï¼Œç¤¾åŒºè®¡åˆ’é€šè¿‡æä¾›åŸºäº REST çš„ SQL Client ç½‘å…³æ¥æ‰©å±•å…¶åŠŸèƒ½ï¼Œè¯¦è§ FLIP-24 å’Œ FLIP-91ã€‚\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/sqlClient.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-sql-client/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL"],"title":"SQL å®¢æˆ·ç«¯"},{"categories":["Flink"],"contents":"SQL æç¤º SQL æç¤ºå¯ä»¥ä¸ SQL è¯­å¥ä¸€èµ·ä½¿ç”¨ï¼Œä»¥æ”¹å˜æ‰§è¡Œè®¡åˆ’ã€‚æœ¬ç« è§£é‡Šäº†å¦‚ä½•ä½¿ç”¨æç¤ºæ¥å¼ºåˆ¶å„ç§æ–¹æ³•ã€‚\nä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªæç¤ºå¯ä»¥ç”¨æ¥ã€‚\nå¼ºåˆ¶æ‰§è¡Œè®¡åˆ’å™¨ï¼šæ²¡æœ‰å®Œç¾çš„è®¡åˆ’å™¨ï¼Œæ‰€ä»¥å®ç°æç¤ºè®©ç”¨æˆ·æ›´å¥½åœ°æ§åˆ¶æ‰§è¡Œæ˜¯æœ‰æ„ä¹‰çš„ã€‚ Append meta data(æˆ–ç»Ÿè®¡)ï¼šä¸€äº›ç»Ÿè®¡ï¼Œæ¯”å¦‚\u0026quot;æ‰«æçš„è¡¨ç´¢å¼•\u0026quot;å’Œ \u0026ldquo;ä¸€äº› shuffle é”®çš„ skew info\u0026rdquo;ï¼Œå¯¹äºæŸ¥è¯¢æ¥è¯´æ˜¯æœ‰äº›åŠ¨æ€çš„ï¼Œç”¨æç¤ºæ¥é…ç½®å®ƒä»¬ä¼šéå¸¸æ–¹ä¾¿ï¼Œå› ä¸ºæˆ‘ä»¬ä» planner å¾—åˆ°çš„è§„åˆ’å…ƒæ•°æ®å¾€å¾€ä¸æ˜¯é‚£ä¹ˆå‡†ç¡®ã€‚ è¿ç®—ç¬¦èµ„æºçº¦æŸï¼šå¯¹äºå¾ˆå¤šæƒ…å†µï¼Œæˆ‘ä»¬ä¼šç»™æ‰§è¡Œè¿ç®—ç¬¦ä¸€ä¸ªé»˜è®¤çš„èµ„æºé…ç½®ï¼Œæ¯”å¦‚æœ€å°å¹¶è¡Œæˆ–ç®¡ç†å†…å­˜ï¼ˆè€—è´¹èµ„æºçš„ UDFï¼‰æˆ–ç‰¹æ®Šçš„èµ„æºéœ€æ±‚ï¼ˆGPU æˆ– SSD ç£ç›˜ï¼‰ç­‰ç­‰ï¼Œç”¨æç¤ºå¯¹æ¯ä¸ªæŸ¥è¯¢ï¼ˆè€Œä¸æ˜¯ Jobï¼‰çš„èµ„æºè¿›è¡Œé…ç½®ä¼šéå¸¸çµæ´»ã€‚\nåŠ¨æ€è¡¨é€‰é¡¹ åŠ¨æ€è¡¨é€‰é¡¹å…è®¸åŠ¨æ€æŒ‡å®šæˆ–è¦†ç›–è¡¨é€‰é¡¹ï¼Œä¸ SQL DDL æˆ–è¿æ¥ API å®šä¹‰çš„é™æ€è¡¨é€‰é¡¹ä¸åŒï¼Œè¿™äº›é€‰é¡¹å¯ä»¥åœ¨æ¯ä¸ªæŸ¥è¯¢ä¸­çš„æ¯ä¸ªè¡¨èŒƒå›´å†…çµæ´»æŒ‡å®šã€‚\nå› æ­¤ï¼Œå®ƒéå¸¸é€‚ç”¨äºäº¤äº’å¼ç»ˆç«¯çš„ä¸´æ—¶æŸ¥è¯¢ï¼Œä¾‹å¦‚ï¼Œåœ¨ SQL-CLI ä¸­ï¼Œåªéœ€æ·»åŠ ä¸€ä¸ªåŠ¨æ€é€‰é¡¹ /*+ OPTIONS('csv.ignore-parse-errors'='true') */ï¼Œå°±å¯ä»¥æŒ‡å®šå¿½ç•¥ CSV æºçš„è§£æé”™è¯¯ã€‚\næ³¨æ„ï¼šåŠ¨æ€è¡¨é€‰é¡¹é»˜è®¤æ˜¯ç¦æ­¢ä½¿ç”¨çš„ï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šæ”¹å˜æŸ¥è¯¢çš„è¯­ä¹‰ã€‚æ‚¨éœ€è¦å°†é…ç½®é€‰é¡¹ table.dynamic-table-options.enabled æ˜¾å¼åœ°è®¾ç½®ä¸º trueï¼ˆé»˜è®¤ä¸º falseï¼‰ï¼Œæœ‰å…³å¦‚ä½•è®¾ç½®é…ç½®é€‰é¡¹çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…é…ç½®ã€‚\nè¯­æ³• ä¸ºäº†ä¸ç ´å SQL çš„å…¼å®¹æ€§ï¼Œæˆ‘ä»¬ä½¿ç”¨ Oracle é£æ ¼çš„ SQL æç¤ºè¯­æ³•ã€‚\ntable_path /*+ OPTIONS(key=val [, key=val]*) */ key: stringLiteral val: stringLiteral ä¾‹å­ CREATETABLEkafka_table1(idBIGINT,nameSTRING,ageINT)WITH(...);CREATETABLEkafka_table2(idBIGINT,nameSTRING,ageINT)WITH(...);-- override table options in query source selectid,namefromkafka_table1/*+ OPTIONS(\u0026#39;scan.startup.mode\u0026#39;=\u0026#39;earliest-offset\u0026#39;) */;-- override table options in join select*fromkafka_table1/*+ OPTIONS(\u0026#39;scan.startup.mode\u0026#39;=\u0026#39;earliest-offset\u0026#39;) */t1joinkafka_table2/*+ OPTIONS(\u0026#39;scan.startup.mode\u0026#39;=\u0026#39;earliest-offset\u0026#39;) */t2ont1.id=t2.id;-- override table options for INSERT target table insertintokafka_table1/*+ OPTIONS(\u0026#39;sink.partitioner\u0026#39;=\u0026#39;round-robin\u0026#39;) */select*fromkafka_table2;åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/sql/hints.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-sql-hints/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL","SQL"],"title":"SQL æç¤º"},{"categories":["Flink"],"contents":"Table API è¡¨ API æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„å…³ç³»å‹ APIï¼Œç”¨äºæµå¤„ç†å’Œæ‰¹å¤„ç†ã€‚Table API æŸ¥è¯¢å¯ä»¥åœ¨æ‰¹å¤„ç†æˆ–æµå¤„ç†è¾“å…¥ä¸Šè¿è¡Œï¼Œæ— éœ€ä¿®æ”¹ã€‚Table API æ˜¯ SQL è¯­è¨€çš„è¶…çº§é›†ï¼Œæ˜¯ä¸“é—¨ä¸º Apache Flink å·¥ä½œè€Œè®¾è®¡çš„ã€‚Table API æ˜¯ Scalaã€Java å’Œ Python çš„è¯­è¨€é›†æˆ APIã€‚Table API æŸ¥è¯¢ä¸æ˜¯åƒ SQL é‚£æ ·ä»¥å­—ç¬¦ä¸²å€¼çš„æ–¹å¼æŒ‡å®šæŸ¥è¯¢ï¼Œè€Œæ˜¯ä»¥è¯­è¨€åµŒå…¥çš„æ–¹å¼åœ¨ Javaã€Scala æˆ– Python ä¸­å®šä¹‰æŸ¥è¯¢ï¼Œå¹¶æ”¯æŒè‡ªåŠ¨å®Œæˆå’Œè¯­æ³•éªŒè¯ç­‰ IDEã€‚\nTable API ä¸ Flink çš„ SQL é›†æˆå…±äº«è®¸å¤šæ¦‚å¿µå’Œéƒ¨åˆ† APIã€‚è¯·çœ‹é€šç”¨æ¦‚å¿µå’Œ APIï¼Œäº†è§£å¦‚ä½•æ³¨å†Œè¡¨æˆ–åˆ›å»ºè¡¨å¯¹è±¡ã€‚æµæ¦‚å¿µé¡µé¢è®¨è®ºäº†æµçš„å…·ä½“æ¦‚å¿µï¼Œå¦‚åŠ¨æ€è¡¨å’Œæ—¶é—´å±æ€§ã€‚\nä¸‹é¢çš„ä¾‹å­å‡è®¾ä¸€ä¸ªåä¸º Orders çš„æ³¨å†Œè¡¨å…·æœ‰å±æ€§ï¼ˆa, b, c, rowtimeï¼‰ã€‚rowtime å­—æ®µåœ¨æµå¼ä¸­æ˜¯ä¸€ä¸ªé€»è¾‘æ—¶é—´å±æ€§ï¼Œåœ¨æ‰¹å¤„ç†ä¸­æ˜¯ä¸€ä¸ªå¸¸è§„çš„æ—¶é—´æˆ³å­—æ®µã€‚\næ¦‚è¿°å’Œç¤ºä¾‹ Table API å¯ç”¨äº Scalaã€Java å’Œ Pythonã€‚Scala Table API åˆ©ç”¨çš„æ˜¯ Scala è¡¨è¾¾å¼ï¼ŒJava Table API æ—¢æ”¯æŒ Expression DSLï¼Œä¹Ÿæ”¯æŒè§£æå¹¶è½¬æ¢ä¸ºç­‰ä»·è¡¨è¾¾å¼çš„å­—ç¬¦ä¸²ï¼ŒPython Table API ç›®å‰åªæ”¯æŒè§£æå¹¶è½¬æ¢ä¸ºç­‰ä»·è¡¨è¾¾å¼çš„å­—ç¬¦ä¸²ã€‚\nä¸‹é¢çš„ä¾‹å­æ˜¾ç¤ºäº† Scalaã€Java å’Œ Python Table API ä¹‹é—´çš„å·®å¼‚ã€‚è¡¨ç¨‹åºæ˜¯åœ¨æ‰¹å¤„ç†ç¯å¢ƒä¸­æ‰§è¡Œçš„ã€‚å®ƒæ‰«æ Orders è¡¨ï¼ŒæŒ‰å­—æ®µ a åˆ†ç»„ï¼Œå¹¶è®¡ç®—æ¯ç»„çš„ç»“æœè¡Œã€‚\né€šè¿‡å¯¼å…¥ org.apache.flink.table.api._ã€org.apache.flink.api.scala._ å’Œ org.apache.flink.table.api.bridge.scala._ï¼ˆç”¨äºæ¡¥æ¥åˆ°/æ¥è‡ª DataStreamï¼‰æ¥å¯ç”¨ Scala Table APIã€‚\nä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº† Scala Table API ç¨‹åºæ˜¯å¦‚ä½•æ„é€ çš„ã€‚è¡¨å­—æ®µä½¿ç”¨ Scala çš„å­—ç¬¦ä¸²æ’å€¼ï¼Œä½¿ç”¨ç¾å…ƒå­—ç¬¦ï¼ˆ$ï¼‰å¼•ç”¨ã€‚\nimport org.apache.flink.api.scala._ import org.apache.flink.table.api._ import org.apache.flink.table.api.bridge.scala._ // environment configuration val env = ExecutionEnvironment.getExecutionEnvironment val tEnv = BatchTableEnvironment.create(env) // register Orders table in table environment // ...  // specify table program val orders = tEnv.from(\u0026#34;Orders\u0026#34;) // schema (a, b, c, rowtime)  val result = orders .groupBy($\u0026#34;a\u0026#34;) .select($\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;.count as \u0026#34;cnt\u0026#34;) .toDataSet[Row] // conversion to DataSet  .print() ä¸‹ä¸€ä¸ªä¾‹å­æ˜¾ç¤ºäº†ä¸€ä¸ªæ›´å¤æ‚çš„ Table API ç¨‹åºã€‚è¯¥ç¨‹åºå†æ¬¡æ‰«æ Orders è¡¨ï¼Œè¿‡æ»¤ç©ºå€¼ï¼Œå¯¹ç±»å‹ä¸º String çš„å­—æ®µ a è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ï¼Œå¹¶ä¸ºæ¯ä¸ªå°æ—¶å’Œäº§å“ a è®¡ç®—å¹³å‡è®¡è´¹é‡‘é¢ bã€‚å®ƒè¿‡æ»¤ç©ºå€¼ï¼Œå¯¹ç±»å‹ä¸º String çš„å­—æ®µ a è¿›è¡Œæ ‡å‡†åŒ–ï¼Œå¹¶ä¸ºæ¯ä¸ªå°æ—¶å’Œäº§å“ a è®¡ç®—å¹³å‡è´¦å•é‡‘é¢ bã€‚\n// environment configuration // ...  // specify table program val orders: Table = tEnv.from(\u0026#34;Orders\u0026#34;) // schema (a, b, c, rowtime)  val result: Table = orders .filter($\u0026#34;a\u0026#34;.isNotNull \u0026amp;\u0026amp; $\u0026#34;b\u0026#34;.isNotNull \u0026amp;\u0026amp; $\u0026#34;c\u0026#34;.isNotNull) .select($\u0026#34;a\u0026#34;.lowerCase() as \u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;, $\u0026#34;rowtime\u0026#34;) .window(Tumble over 1.hour on $\u0026#34;rowtime\u0026#34; as \u0026#34;hourlyWindow\u0026#34;) .groupBy($\u0026#34;hourlyWindow\u0026#34;, $\u0026#34;a\u0026#34;) .select($\u0026#34;a\u0026#34;, $\u0026#34;hourlyWindow\u0026#34;.end as \u0026#34;hour\u0026#34;, $\u0026#34;b\u0026#34;.avg as \u0026#34;avgBillingAmount\u0026#34;) ç”±äºè¡¨ API æ˜¯é’ˆå¯¹æ‰¹å¤„ç†å’Œæµæ•°æ®çš„ç»Ÿä¸€ APIï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªç¤ºä¾‹ç¨‹åºéƒ½å¯ä»¥åœ¨æ‰¹å¤„ç†å’Œæµè¾“å…¥ä¸Šæ‰§è¡Œï¼Œè€Œä¸éœ€è¦å¯¹è¡¨ç¨‹åºæœ¬èº«è¿›è¡Œä»»ä½•ä¿®æ”¹ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œè€ƒè™‘åˆ°æµå¼è®°å½•ä¸ä¼šè¿Ÿåˆ°ï¼Œç¨‹åºä¼šäº§ç”Ÿç›¸åŒçš„ç»“æœï¼ˆè¯¦è§æµæ¦‚å¿µï¼‰ã€‚\næ“ä½œ è¡¨ API æ”¯æŒä»¥ä¸‹æ“ä½œã€‚è¯·æ³¨æ„ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„æ“ä½œéƒ½èƒ½åœ¨æ‰¹å¤„ç†å’Œæµå¼å¤„ç†ä¸­ä½¿ç”¨ï¼Œå®ƒä»¬éƒ½æœ‰ç›¸åº”çš„æ ‡ç­¾ã€‚\nScan, Projection å’Œ Filter  From(Batch/Streaming)  ç±»ä¼¼äº SQL æŸ¥è¯¢ä¸­çš„ FROM å­å¥ã€‚æ‰§è¡Œå¯¹æ³¨å†Œçš„è¡¨çš„æ‰«æã€‚\nval orders: Table = tableEnv.from(\u0026#34;Orders\u0026#34;)  Values(Batch/Streaming)  ç±»ä¼¼äº SQL æŸ¥è¯¢ä¸­çš„ VALUES å­å¥ã€‚ä»æä¾›çš„è¡Œä¸­äº§ç”Ÿä¸€ä¸ªå†…è”è¡¨ã€‚\nä½ å¯ä»¥ä½¿ç”¨ row(...) è¡¨è¾¾å¼æ¥åˆ›å»ºå¤åˆè¡Œã€‚\nval table = tEnv.fromValues( row(1, \u0026#34;ABC\u0026#34;), row(2L, \u0026#34;ABCDE\u0026#34;) ) å°†äº§ç”Ÿä¸€ä¸ªæ¨¡å¼(schema)å¦‚ä¸‹çš„è¡¨ã€‚\nroot |-- f0: BIGINT NOT NULL // original types INT and BIGINT are generalized to BIGINT |-- f1: VARCHAR(5) NOT NULL // original types CHAR(3) and CHAR(5) are generalized // to VARCHAR(5). VARCHAR is used instead of CHAR so that // no padding is applied è¯¥æ–¹æ³•å°†ä»è¾“å…¥çš„è¡¨è¾¾å¼ä¸­è‡ªåŠ¨å¾—å‡ºç±»å‹ï¼Œå¦‚æœæŸä¸ªä½ç½®çš„ç±»å‹ä¸åŒï¼Œè¯¥æ–¹æ³•å°†å°è¯•ä¸ºæ‰€æœ‰ç±»å‹æ‰¾åˆ°å…±åŒçš„è¶…çº§ç±»å‹ã€‚å¦‚æœæŸä¸ªä½ç½®çš„ç±»å‹ä¸åŒï¼Œæ–¹æ³•å°†å°è¯•ä¸ºæ‰€æœ‰ç±»å‹æ‰¾åˆ°ä¸€ä¸ªå…±åŒçš„è¶…çº§ç±»å‹ã€‚å¦‚æœä¸€ä¸ªå…±åŒçš„è¶…çº§ç±»å‹ä¸å­˜åœ¨ï¼Œå°†æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚\næ‚¨ä¹Ÿå¯ä»¥æ˜ç¡®åœ°æŒ‡å®šè¯·æ±‚çš„ç±»å‹ã€‚è¿™å¯èƒ½å¯¹åˆ†é…æ›´å¤šçš„é€šç”¨ç±»å‹ï¼ˆå¦‚ DECIMALï¼‰æˆ–ä¸ºåˆ—å‘½åå¾ˆæœ‰å¸®åŠ©ã€‚\nval table = tEnv.fromValues( DataTypes.ROW( DataTypes.FIELD(\u0026#34;id\u0026#34;, DataTypes.DECIMAL(10, 2)), DataTypes.FIELD(\u0026#34;name\u0026#34;, DataTypes.STRING()) ), row(1, \u0026#34;ABC\u0026#34;), row(2L, \u0026#34;ABCDE\u0026#34;) ) å°†äº§ç”Ÿä¸€ä¸ªæ¨¡å¼(schema)å¦‚ä¸‹çš„è¡¨ã€‚\nroot |-- id: DECIMAL(10, 2) |-- name: STRING  Select(Batch/Streaming)  ç±»ä¼¼äº SQL SELECT è¯­å¥ã€‚æ‰§è¡Œé€‰æ‹©æ“ä½œã€‚\nval orders: Table = tableEnv.from(\u0026#34;Orders\u0026#34;) val result = orders.select($\u0026#34;a\u0026#34;, $\u0026#34;c\u0026#34; as \u0026#34;d\u0026#34;) ä½ å¯ä»¥ä½¿ç”¨æ˜Ÿå·ï¼ˆ*ï¼‰ä½œä¸ºé€šé…ç¬¦ï¼Œé€‰æ‹©è¡¨ä¸­æ‰€æœ‰çš„åˆ—ã€‚\nval orders: Table = tableEnv.from(\u0026#34;Orders\u0026#34;) val result = orders.select($\u0026#34;*\u0026#34;)  As(Batch/Streaming)  é‡æ–°å‘½åå­—æ®µã€‚\nval orders: Table = tableEnv.from(\u0026#34;Orders\u0026#34;).as(\u0026#34;x\u0026#34;, \u0026#34;y\u0026#34;, \u0026#34;z\u0026#34;, \u0026#34;t\u0026#34;)  Where / Filter(Batch/Streaming)  ç±»ä¼¼äº SQL WHERE å­å¥ã€‚è¿‡æ»¤æ‰æ²¡æœ‰é€šè¿‡è¿‡æ»¤è°“è¯çš„è®°å½•ã€‚\nval orders: Table = tableEnv.from(\u0026#34;Orders\u0026#34;) val result = orders.filter($\u0026#34;a\u0026#34; % 2 === 0) æˆ–:\nval orders: Table = tableEnv.from(\u0026#34;Orders\u0026#34;) val result = orders.where($\u0026#34;b\u0026#34; === \u0026#34;red\u0026#34;) åˆ—æ“ä½œ  AddColumns(Batch/Streaming)  æ‰§è¡Œå­—æ®µæ·»åŠ æ“ä½œã€‚å¦‚æœæ·»åŠ çš„å­—æ®µå·²ç»å­˜åœ¨ï¼Œå®ƒå°†æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚\nval orders = tableEnv.from(\u0026#34;Orders\u0026#34;); val result = orders.addColumns(concat($\u0026#34;c\u0026#34;, \u0026#34;Sunny\u0026#34;))  AddOrReplaceColumns(Batch/Streaming)  æ‰§è¡Œå­—æ®µæ·»åŠ æ“ä½œã€‚å¦‚æœæ·»åŠ çš„åˆ—åä¸ç°æœ‰çš„åˆ—åç›¸åŒï¼Œé‚£ä¹ˆç°æœ‰çš„å­—æ®µå°†è¢«æ›¿æ¢ã€‚æ­¤å¤–ï¼Œå¦‚æœæ·»åŠ çš„å­—æ®µåä¸ç°æœ‰å­—æ®µåé‡å¤ï¼Œåˆ™ä½¿ç”¨æœ€åä¸€ä¸ªå­—æ®µåã€‚\nval orders = tableEnv.from(\u0026#34;Orders\u0026#34;); val result = orders.addOrReplaceColumns(concat($\u0026#34;c\u0026#34;, \u0026#34;Sunny\u0026#34;) as \u0026#34;desc\u0026#34;)  DropColumns(Batch/Streaming)  æ‰§è¡Œå­—æ®µåˆ é™¤æ“ä½œã€‚å­—æ®µè¡¨è¾¾å¼åº”è¯¥æ˜¯å­—æ®µå¼•ç”¨è¡¨è¾¾å¼ï¼Œå¹¶ä¸”åªèƒ½åˆ é™¤ç°æœ‰çš„å­—æ®µã€‚\nval orders = tableEnv.from(\u0026#34;Orders\u0026#34;); val result = orders.dropColumns($\u0026#34;b\u0026#34;, $\u0026#34;c\u0026#34;)  RenameColumns(Batch/Streaming)  æ‰§è¡Œå­—æ®µé‡å‘½åæ“ä½œã€‚å­—æ®µè¡¨è¾¾å¼åº”ä¸ºåˆ«åè¡¨è¾¾å¼ï¼Œä¸”åªèƒ½å¯¹ç°æœ‰å­—æ®µè¿›è¡Œé‡å‘½åã€‚\nval orders = tableEnv.from(\u0026#34;Orders\u0026#34;); val result = orders.renameColumns($\u0026#34;b\u0026#34; as \u0026#34;b2\u0026#34;, $\u0026#34;c\u0026#34; as \u0026#34;c2\u0026#34;) èšåˆ(Aggregations)  GroupBy èšåˆ(Batch/Streaming/Result Updating)  ç±»ä¼¼äº SQL çš„ GROUP BY å­å¥ã€‚å°†åˆ†ç»„é”®ä¸Šçš„è¡Œä¸ä¸‹é¢çš„è¿è¡Œèšåˆæ“ä½œç¬¦è¿›è¡Œåˆ†ç»„ï¼Œä»¥åˆ†ç»„æ–¹å¼èšåˆè¡Œã€‚\nval orders: Table = tableEnv.from(\u0026#34;Orders\u0026#34;) val result = orders.groupBy($\u0026#34;a\u0026#34;).select($\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;.sum().as(\u0026#34;d\u0026#34;)) æ³¨æ„ï¼šå¯¹äºæµå¼æŸ¥è¯¢ï¼Œè®¡ç®—æŸ¥è¯¢ç»“æœæ‰€éœ€çš„çŠ¶æ€å¯èƒ½ä¼šæ— é™å¢é•¿ï¼Œè¿™å–å†³äºèšåˆçš„ç±»å‹å’Œä¸åŒåˆ†ç»„é”®çš„æ•°é‡ã€‚è¯·æä¾›æœ‰æ•ˆçš„ä¿ç•™æ—¶é—´é—´éš”çš„æŸ¥è¯¢é…ç½®ï¼Œä»¥é˜²æ­¢çŠ¶æ€å¤§å°è¿‡å¤§ã€‚è¯¦è§æŸ¥è¯¢é…ç½®ã€‚\n GroupBy çª—å£èšåˆ(Batch/Streaming)  åœ¨åˆ†ç»„çª—å£å’Œå¯èƒ½çš„ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†ç»„é”®ä¸Šå¯¹ä¸€ä¸ªè¡¨è¿›è¡Œåˆ†ç»„å’Œèšåˆã€‚\nval orders: Table = tableEnv.from(\u0026#34;Orders\u0026#34;) val result: Table = orders .window(Tumble over 5.minutes on $\u0026#34;rowtime\u0026#34; as \u0026#34;w\u0026#34;) // define window  .groupBy($\u0026#34;a\u0026#34;, $\u0026#34;w\u0026#34;) // group by key and window  .select($\u0026#34;a\u0026#34;, $\u0026#34;w\u0026#34;.start, $\u0026#34;w\u0026#34;.end, $\u0026#34;w\u0026#34;.rowtime, $\u0026#34;b\u0026#34;.sum as \u0026#34;d\u0026#34;) // access window properties and aggregate  Over çª—å£èšåˆ(Streaming)  ç±»ä¼¼äº SQL OVER å­å¥ã€‚æ ¹æ®å‰åè®°å½•çš„çª—å£(èŒƒå›´)ï¼Œä¸ºæ¯æ¡è®°å½•è®¡ç®— OVER çª—å£æ±‡æ€»ã€‚æ›´å¤šç»†èŠ‚è¯·å‚è§ over çª—å£éƒ¨åˆ†ã€‚\nval orders: Table = tableEnv.from(\u0026#34;Orders\u0026#34;) val result: Table = orders // define window  .window( Over partitionBy $\u0026#34;a\u0026#34; orderBy $\u0026#34;rowtime\u0026#34; preceding UNBOUNDED_RANGE following CURRENT_RANGE as \u0026#34;w\u0026#34;) .select($\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;.avg over $\u0026#34;w\u0026#34;, $\u0026#34;b\u0026#34;.max().over($\u0026#34;w\u0026#34;), $\u0026#34;b\u0026#34;.min().over($\u0026#34;w\u0026#34;)) // sliding aggregate æ³¨æ„ï¼šæ‰€æœ‰çš„èšåˆå¿…é¡»å®šä¹‰åœ¨åŒä¸€ä¸ªçª—å£ä¸Šï¼Œå³ç›¸åŒçš„åˆ†åŒºã€æ’åºå’ŒèŒƒå›´ã€‚ç›®å‰ï¼Œåªæ”¯æŒå¯¹ CURRENT ROW èŒƒå›´çš„ PRECEDINGï¼ˆUNBOUNDED å’Œ boundedï¼‰çª—å£ã€‚è¿˜ä¸æ”¯æŒå¸¦ FOLLOWING çš„èŒƒå›´ã€‚ORDER BY å¿…é¡»åœ¨å•ä¸ªæ—¶é—´å±æ€§ä¸ŠæŒ‡å®šã€‚\n Distinct èšåˆ(Batch Streaming/Result Updating)  ç±»ä¼¼äº SQL çš„ DISTINCT AGGREGATION å­å¥ï¼Œå¦‚ COUNT(DISTINCT a)ã€‚Distinct èšåˆå£°æ˜ä¸€ä¸ªèšåˆå‡½æ•°ï¼ˆå†…ç½®çš„æˆ–ç”¨æˆ·å®šä¹‰çš„ï¼‰åªåº”ç”¨åœ¨ä¸åŒçš„è¾“å…¥å€¼ä¸Šï¼ŒDistinct å¯ä»¥åº”ç”¨äº GroupBy èšåˆï¼ŒGroupBy çª—å£èšåˆå’Œ Over çª—å£èšåˆã€‚Distinct å¯ä»¥åº”ç”¨äº GroupBy èšåˆã€GroupBy çª—å£èšåˆå’Œ Over çª—å£èšåˆã€‚\nval orders: Table = tableEnv.from(\u0026#34;Orders\u0026#34;); // Distinct aggregation on group by val groupByDistinctResult = orders .groupBy($\u0026#34;a\u0026#34;) .select($\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;.sum.distinct as \u0026#34;d\u0026#34;) // Distinct aggregation on time window group by val groupByWindowDistinctResult = orders .window(Tumble over 5.minutes on $\u0026#34;rowtime\u0026#34; as \u0026#34;w\u0026#34;).groupBy($\u0026#34;a\u0026#34;, $\u0026#34;w\u0026#34;) .select($\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;.sum.distinct as \u0026#34;d\u0026#34;) // Distinct aggregation on over window val result = orders .window(Over partitionBy $\u0026#34;a\u0026#34; orderBy $\u0026#34;rowtime\u0026#34; preceding UNBOUNDED_RANGE as $\u0026#34;w\u0026#34;) .select($\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;.avg.distinct over $\u0026#34;w\u0026#34;, $\u0026#34;b\u0026#34;.max over $\u0026#34;w\u0026#34;, $\u0026#34;b\u0026#34;.min over $\u0026#34;w\u0026#34;) ç”¨æˆ·è‡ªå®šä¹‰çš„èšåˆå‡½æ•°ä¹Ÿå¯ä»¥ä¸ DISTINCT ä¿®é¥°ç¬¦ä¸€èµ·ä½¿ç”¨ã€‚å¦‚æœåªè®¡ç®—ä¸åŒå€¼çš„èšåˆç»“æœï¼Œåªéœ€åœ¨èšåˆå‡½æ•°ä¸­æ·»åŠ  distinct ä¿®é¥°ç¬¦å³å¯ã€‚\nval orders: Table = tEnv.from(\u0026#34;Orders\u0026#34;); // Use distinct aggregation for user-defined aggregate functions val myUdagg = new MyUdagg(); orders.groupBy($\u0026#34;users\u0026#34;).select($\u0026#34;users\u0026#34;, myUdagg.distinct($\u0026#34;points\u0026#34;) as \u0026#34;myDistinctResult\u0026#34;); æ³¨æ„ï¼šå¯¹äºæµå¼æŸ¥è¯¢ï¼Œè®¡ç®—æŸ¥è¯¢ç»“æœæ‰€éœ€çš„çŠ¶æ€å¯èƒ½ä¼šæ ¹æ®ä¸åŒå­—æ®µçš„æ•°é‡è€Œæ— é™å¢é•¿ã€‚è¯·æä¾›ä¸€ä¸ªæœ‰æ•ˆçš„ä¿ç•™æ—¶é—´é—´éš”çš„æŸ¥è¯¢é…ç½®ï¼Œä»¥é˜²æ­¢è¿‡å¤§çš„çŠ¶æ€å¤§å°ã€‚è¯¦æƒ…è¯·çœ‹æŸ¥è¯¢é…ç½®ã€‚\n Distinct(Batch Streaming/Result Updating)  ç±»ä¼¼äº SQL çš„ DISTINCT å­å¥ã€‚è¿”å›å…·æœ‰ä¸åŒå€¼ç»„åˆçš„è®°å½•ã€‚\nval orders: Table = tableEnv.from(\u0026#34;Orders\u0026#34;) val result = orders.distinct() æ³¨æ„ï¼šå¯¹äºæµå¼æŸ¥è¯¢ï¼Œè®¡ç®—æŸ¥è¯¢ç»“æœæ‰€éœ€çš„çŠ¶æ€å¯èƒ½ä¼šæ ¹æ®ä¸åŒå­—æ®µçš„æ•°é‡è€Œæ— é™å¢é•¿ã€‚è¯·æä¾›ä¸€ä¸ªæœ‰æ•ˆçš„ä¿ç•™æ—¶é—´é—´éš”çš„æŸ¥è¯¢é…ç½®ï¼Œä»¥é˜²æ­¢è¿‡å¤§çš„çŠ¶æ€å¤§å°ã€‚å¦‚æœå¯ç”¨äº†çŠ¶æ€æ¸…æ´—åŠŸèƒ½ï¼ŒDistinct å¿…é¡»å‘å‡ºæ¶ˆæ¯ï¼Œä»¥é˜²æ­¢ä¸‹æ¸¸æ“ä½œè€…è¿‡æ—©åœ°é©±é€çŠ¶æ€ï¼Œä»è€Œä½¿ Distinct åŒ…å«ç»“æœæ›´æ–°ã€‚è¯¦è§æŸ¥è¯¢é…ç½®ã€‚\nJoins  Inner Join(Batch/Streaming)  ç±»ä¼¼äº SQL JOIN å­å¥ã€‚è¿æ¥ä¸¤ä¸ªè¡¨ã€‚ä¸¤ä¸ªè¡¨å¿…é¡»æœ‰ä¸åŒçš„å­—æ®µåï¼Œå¹¶ä¸”å¿…é¡»é€šè¿‡ join æ“ä½œç¬¦æˆ–ä½¿ç”¨ where æˆ– filter æ“ä½œç¬¦å®šä¹‰è‡³å°‘ä¸€ä¸ªå¹³ç­‰è¿æ¥è°“è¯ã€‚\nval left = ds1.toTable(tableEnv, $\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;, $\u0026#34;c\u0026#34;) val right = ds2.toTable(tableEnv, $\u0026#34;d\u0026#34;, $\u0026#34;e\u0026#34;, $\u0026#34;f\u0026#34;) val result = left.join(right).where($\u0026#34;a\u0026#34; === $\u0026#34;d\u0026#34;).select($\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;, $\u0026#34;e\u0026#34;) æ³¨æ„ï¼šå¯¹äºæµå¼æŸ¥è¯¢ï¼Œè®¡ç®—æŸ¥è¯¢ç»“æœæ‰€éœ€çš„çŠ¶æ€å¯èƒ½ä¼šæ ¹æ®ä¸åŒè¾“å…¥è¡Œçš„æ•°é‡è€Œæ— é™å¢é•¿ã€‚è¯·æä¾›ä¸€ä¸ªå…·æœ‰æœ‰æ•ˆä¿ç•™æ—¶é—´é—´éš”çš„æŸ¥è¯¢é…ç½®ï¼Œä»¥é˜²æ­¢çŠ¶æ€å¤§å°è¿‡å¤§ã€‚è¯¦æƒ…è¯·çœ‹æŸ¥è¯¢é…ç½®ã€‚\n Outer Join(Batch/Streaming/Result Updating)  ç±»ä¼¼äº SQL LEFT/RIGHT/FULL OUTER JOIN å­å¥ã€‚è¿æ¥ä¸¤ä¸ªè¡¨ã€‚ä¸¤ä¸ªè¡¨å¿…é¡»æœ‰ä¸åŒçš„å­—æ®µåï¼Œå¹¶ä¸”å¿…é¡»å®šä¹‰è‡³å°‘ä¸€ä¸ªå¹³ç­‰è¿æ¥è°“è¯ã€‚\nval left = tableEnv.fromDataSet(ds1, $\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;, $\u0026#34;c\u0026#34;) val right = tableEnv.fromDataSet(ds2, $\u0026#34;d\u0026#34;, $\u0026#34;e\u0026#34;, $\u0026#34;f\u0026#34;) val leftOuterResult = left.leftOuterJoin(right, $\u0026#34;a\u0026#34; === $\u0026#34;d\u0026#34;).select($\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;, $\u0026#34;e\u0026#34;) val rightOuterResult = left.rightOuterJoin(right, $\u0026#34;a\u0026#34; === $\u0026#34;d\u0026#34;).select($\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;, $\u0026#34;e\u0026#34;) val fullOuterResult = left.fullOuterJoin(right, $\u0026#34;a\u0026#34; === $\u0026#34;d\u0026#34;).select($\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;, $\u0026#34;e\u0026#34;) æ³¨æ„ï¼šå¯¹äºæµå¼æŸ¥è¯¢ï¼Œè®¡ç®—æŸ¥è¯¢ç»“æœæ‰€éœ€çš„çŠ¶æ€å¯èƒ½ä¼šæ ¹æ®ä¸åŒè¾“å…¥è¡Œçš„æ•°é‡è€Œæ— é™å¢é•¿ã€‚è¯·æä¾›ä¸€ä¸ªå…·æœ‰æœ‰æ•ˆä¿ç•™æ—¶é—´é—´éš”çš„æŸ¥è¯¢é…ç½®ï¼Œä»¥é˜²æ­¢çŠ¶æ€å¤§å°è¿‡å¤§ã€‚è¯¦æƒ…è¯·çœ‹æŸ¥è¯¢é…ç½®ã€‚\n Interval Join(Batch/Streaming)  æ³¨ï¼šåŒºé—´è¿æ¥æ˜¯å¸¸è§„è¿æ¥çš„ä¸€ä¸ªå­é›†ï¼Œå¯ä»¥ç”¨æµå¼å¤„ç†ã€‚\nä¸€ä¸ªåŒºé—´è¿æ¥è‡³å°‘éœ€è¦ä¸€ä¸ªç­‰ä»·è¿æ¥è°“è¯å’Œä¸€ä¸ªè¿æ¥æ¡ä»¶ï¼Œä»¥é™åˆ¶åŒæ–¹çš„æ—¶é—´ã€‚è¿™æ ·çš„æ¡ä»¶å¯ä»¥ç”±ä¸¤ä¸ªåˆé€‚çš„èŒƒå›´è°“è¯ï¼ˆ\u0026lt;ï¼Œ\u0026lt;=ï¼Œ\u0026gt;=ï¼Œ\u0026gt;ï¼‰æˆ–ä¸€ä¸ªæ¯”è¾ƒä¸¤ä¸ªè¾“å…¥è¡¨çš„ç›¸åŒç±»å‹çš„æ—¶é—´å±æ€§ï¼ˆå³å¤„ç†æ—¶é—´æˆ–äº‹ä»¶æ—¶é—´ï¼‰çš„å•ä¸€å¹³ç­‰è°“è¯æ¥å®šä¹‰ã€‚\nä¾‹å¦‚ï¼Œä»¥ä¸‹è°“è¯æ˜¯æœ‰æ•ˆçš„åŒºé—´è¿æ¥æ¡ä»¶ã€‚\n$\u0026#34;ltime\u0026#34; === $\u0026#34;rtime\u0026#34; $\u0026#34;ltime\u0026#34; \u0026gt;= $\u0026#34;rtime\u0026#34; \u0026amp;\u0026amp; $\u0026#34;ltime\u0026#34; \u0026lt; $\u0026#34;rtime\u0026#34; + 10.minutes val left = ds1.toTable(tableEnv, $\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;, $\u0026#34;c\u0026#34;, $\u0026#34;ltime\u0026#34;.rowtime) val right = ds2.toTable(tableEnv, $\u0026#34;d\u0026#34;, $\u0026#34;e\u0026#34;, $\u0026#34;f\u0026#34;, $\u0026#34;rtime\u0026#34;.rowtime) val result = left.join(right) .where($\u0026#34;a\u0026#34; === $\u0026#34;d\u0026#34; \u0026amp;\u0026amp; $\u0026#34;ltime\u0026#34; \u0026gt;= $\u0026#34;rtime\u0026#34; - 5.minutes \u0026amp;\u0026amp; $\u0026#34;ltime\u0026#34; \u0026lt; $\u0026#34;rtime\u0026#34; + 10.minutes) .select($\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;, $\u0026#34;e\u0026#34;, $\u0026#34;ltime\u0026#34;)  Inner Join with Table Function (UDTF)(Batch/Streaming)  ç”¨è¡¨æ ¼å‡½æ•°çš„ç»“æœè¿æ¥ä¸€ä¸ªè¡¨æ ¼ã€‚å·¦è¡¨ï¼ˆå¤–è¡¨ï¼‰çš„æ¯æ¡è®°å½•éƒ½ä¸ç›¸åº”çš„è¡¨å‡½æ•°è°ƒç”¨æ‰€äº§ç”Ÿçš„æ‰€æœ‰è®°å½•åˆå¹¶ã€‚å¦‚æœå·¦ï¼ˆå¤–ï¼‰è¡¨çš„è¡¨å‡½æ•°è°ƒç”¨è¿”å›çš„ç»“æœæ˜¯ç©ºçš„ï¼Œåˆ™æ”¾å¼ƒè¯¥è¡¨çš„æŸè¡Œã€‚\n// instantiate User-Defined Table Function val split: TableFunction[_] = new MySplitUDTF() // join val result: Table = table .joinLateral(split($\u0026#34;c\u0026#34;) as (\u0026#34;s\u0026#34;, \u0026#34;t\u0026#34;, \u0026#34;v\u0026#34;)) .select($\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;, $\u0026#34;s\u0026#34;, $\u0026#34;t\u0026#34;, $\u0026#34;v\u0026#34;)  Left Outer Join with Table Function (UDTF)(Batch/Streaming)  ç”¨è¡¨æ ¼å‡½æ•°çš„ç»“æœè¿æ¥ä¸€ä¸ªè¡¨æ ¼ã€‚å·¦è¡¨ï¼ˆå¤–è¡¨ï¼‰çš„æ¯ä¸€è¡Œéƒ½ä¸ç›¸åº”çš„è¡¨å‡½æ•°è°ƒç”¨æ‰€äº§ç”Ÿçš„æ‰€æœ‰è¡Œç›¸è¿æ¥ã€‚å¦‚æœè¡¨å‡½æ•°è°ƒç”¨è¿”å›çš„ç»“æœä¸ºç©ºï¼Œåˆ™ä¿ç•™ç›¸åº”çš„å¤–ä¾§è¡Œï¼Œå¹¶å°†ç»“æœç”¨ç©ºå€¼å¡«å……ã€‚\næ³¨æ„ï¼šç›®å‰ï¼Œè¡¨å‡½æ•°å·¦å¤–ä¾§è¿æ¥çš„è°“è¯åªèƒ½æ˜¯ç©ºæˆ–å­—é¢ä¸ºçœŸã€‚\n// instantiate User-Defined Table Function val split: TableFunction[_] = new MySplitUDTF() // join val result: Table = table .leftOuterJoinLateral(split($\u0026#34;c\u0026#34;) as (\u0026#34;s\u0026#34;, \u0026#34;t\u0026#34;, \u0026#34;v\u0026#34;)) .select($\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;, $\u0026#34;s\u0026#34;, $\u0026#34;t\u0026#34;, $\u0026#34;v\u0026#34;)  Join with Temporal Table(Streaming)  æ—¶é—´è¡¨æ˜¯è·Ÿè¸ªå…¶éšæ—¶é—´å˜åŒ–çš„è¡¨ã€‚\næ—¶é—´è¡¨å‡½æ•°æä¾›äº†å¯¹æ—¶é—´è¡¨åœ¨ç‰¹å®šæ—¶é—´ç‚¹çš„çŠ¶æ€çš„è®¿é—®ã€‚ç”¨æ—¶æ€è¡¨å‡½æ•°è¿æ¥è¡¨çš„è¯­æ³•ä¸å¸¦è¡¨å‡½æ•°çš„å†…éƒ¨è¿æ¥ä¸­çš„è¯­æ³•ç›¸åŒã€‚\nç›®å‰åªæ”¯æŒä¸æ—¶æ€è¡¨çš„å†…è”æ¥ã€‚\nval ratesHistory = tableEnv.from(\u0026#34;RatesHistory\u0026#34;) // register temporal table function with a time attribute and primary key val rates = ratesHistory.createTemporalTableFunction($\u0026#34;r_proctime\u0026#34;, $\u0026#34;r_currency\u0026#34;) // join with \u0026#34;Orders\u0026#34; based on the time attribute and key val orders = tableEnv.from(\u0026#34;Orders\u0026#34;) val result = orders .joinLateral(rates($\u0026#34;o_rowtime\u0026#34;), $\u0026#34;r_currency\u0026#34; === $\u0026#34;o_currency\u0026#34;) æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹æ›´è¯¦ç»†çš„æ—¶é—´è¡¨æ¦‚å¿µè¯´æ˜ã€‚\né›†åˆæ“ä½œ  Union(Batch)  ç±»ä¼¼äº SQL UNION å­å¥ã€‚å°†ä¸¤ä¸ªè¡¨è”åˆèµ·æ¥ï¼Œå»é™¤é‡å¤è®°å½•ï¼Œä¸¤ä¸ªè¡¨å¿…é¡»æœ‰ç›¸åŒçš„å­—æ®µç±»å‹ã€‚\nval left = ds1.toTable(tableEnv, $\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;, $\u0026#34;c\u0026#34;) val right = ds2.toTable(tableEnv, $\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;, $\u0026#34;c\u0026#34;) val result = left.union(right)  UnionAll(Batch/Streaming)  ç±»ä¼¼äº SQL UNION ALL å­å¥ã€‚è”åˆä¸¤ä¸ªè¡¨ï¼Œä¸¤ä¸ªè¡¨çš„å­—æ®µç±»å‹å¿…é¡»ç›¸åŒã€‚\nval left = ds1.toTable(tableEnv, $\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;, $\u0026#34;c\u0026#34;) val right = ds2.toTable(tableEnv, $\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;, $\u0026#34;c\u0026#34;) val result = left.unionAll(right)  Intersect(Batch)  ç±»ä¼¼äº SQL INTERSECT å­å¥ã€‚Intersect å­å¥è¿”å›çš„æ˜¯ä¸¤ä¸ªè¡¨ä¸­éƒ½å­˜åœ¨çš„è®°å½•ã€‚å¦‚æœä¸€æ¡è®°å½•åœ¨ä¸€ä¸ªè¡¨æˆ–ä¸¤ä¸ªè¡¨ä¸­å­˜åœ¨ä¸€æ¬¡ä»¥ä¸Šï¼Œåˆ™åªè¿”å›ä¸€æ¬¡ï¼Œå³ç»“æœè¡¨æ²¡æœ‰é‡å¤è®°å½•ã€‚ä¸¤ä¸ªè¡¨çš„å­—æ®µç±»å‹å¿…é¡»ç›¸åŒã€‚\nval left = ds1.toTable(tableEnv, $\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;, $\u0026#34;c\u0026#34;) val right = ds2.toTable(tableEnv, $\u0026#34;e\u0026#34;, $\u0026#34;f\u0026#34;, $\u0026#34;g\u0026#34;) val result = left.intersect(right)  IntersectAll(Batch)  ç±»ä¼¼äº SQL çš„ INTERSECT ALL å­å¥ã€‚IntersectAll å­å¥è¿”å›ä¸¤ä¸ªè¡¨ä¸­éƒ½å­˜åœ¨çš„è®°å½•ã€‚å¦‚æœä¸€æ¡è®°å½•åœ¨ä¸¤å¼ è¡¨ä¸­éƒ½å­˜åœ¨ä¸€æ¬¡ä»¥ä¸Šï¼Œé‚£ä¹ˆå°±ä¼šæŒ‰ç…§å®ƒåœ¨ä¸¤å¼ è¡¨ä¸­å­˜åœ¨çš„æ¬¡æ•°æ¥è¿”å›ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¾—åˆ°çš„è¡¨å¯èƒ½æœ‰é‡å¤çš„è®°å½•ã€‚ä¸¤ä¸ªè¡¨çš„å­—æ®µç±»å‹å¿…é¡»ç›¸åŒã€‚\nval left = ds1.toTable(tableEnv, $\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;, $\u0026#34;c\u0026#34;) val right = ds2.toTable(tableEnv, $\u0026#34;e\u0026#34;, $\u0026#34;f\u0026#34;, $\u0026#34;g\u0026#34;) val result = left.intersectAll(right)  Minus(Batch)  ç±»ä¼¼äº SQL EXCEPT å­å¥ã€‚Minus è¿”å›å·¦è¡¨ä¸­ä¸å­˜åœ¨äºå³è¡¨ä¸­çš„è®°å½•ã€‚å·¦è¡¨ä¸­çš„é‡å¤è®°å½•åªè¿”å›ä¸€æ¬¡ï¼Œå³åˆ é™¤é‡å¤è®°å½•ã€‚ä¸¤ä¸ªè¡¨çš„å­—æ®µç±»å‹å¿…é¡»ç›¸åŒã€‚\nval left = ds1.toTable(tableEnv, $\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;, $\u0026#34;c\u0026#34;) val right = ds2.toTable(tableEnv, $\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;, $\u0026#34;c\u0026#34;) val result = left.minus(right)  MinusAll(Batch)  ç±»ä¼¼äº SQL EXCEPT ALL å­å¥ã€‚MinusAll å­å¥è¿”å›å³è¡¨ä¸­ä¸å­˜åœ¨çš„è®°å½•ã€‚ä¸€æ¡è®°å½•åœ¨å·¦è¡¨ä¸­å‡ºç° n æ¬¡ï¼Œåœ¨å³è¡¨ä¸­å‡ºç° m æ¬¡ï¼Œåˆ™è¿”å›(n - m)æ¬¡ï¼Œå³åˆ é™¤å³è¡¨ä¸­å­˜åœ¨çš„é‡å¤è®°å½•ã€‚ä¸¤ä¸ªè¡¨çš„å­—æ®µç±»å‹å¿…é¡»ç›¸åŒã€‚\nval left = ds1.toTable(tableEnv, $\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;, $\u0026#34;c\u0026#34;) val right = ds2.toTable(tableEnv, $\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;, $\u0026#34;c\u0026#34;) val result = left.minusAll(right)  In(Batch/Streaming)  ç±»ä¼¼äº SQL çš„ IN å­å¥ã€‚å¦‚æœä¸€ä¸ªè¡¨è¾¾å¼å­˜åœ¨äºç»™å®šçš„è¡¨å­æŸ¥è¯¢ä¸­ï¼ŒIn å­å¥è¿”å› trueã€‚å­æŸ¥è¯¢è¡¨å¿…é¡»ç”±ä¸€åˆ—ç»„æˆã€‚è¯¥åˆ—å¿…é¡»ä¸è¡¨è¾¾å¼å…·æœ‰ç›¸åŒçš„æ•°æ®ç±»å‹ã€‚\nval left = ds1.toTable(tableEnv, $\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;, $\u0026#34;c\u0026#34;) val right = ds2.toTable(tableEnv, $\u0026#34;a\u0026#34;) val result = left.select($\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;, $\u0026#34;c\u0026#34;).where($\u0026#34;a\u0026#34;.in(right)) æ³¨æ„ï¼šå¯¹äºæµå¼æŸ¥è¯¢ï¼Œè¯¥æ“ä½œè¢«é‡å†™ä¸ºåŠ å…¥å’Œåˆ†ç»„æ“ä½œã€‚è®¡ç®—æŸ¥è¯¢ç»“æœæ‰€éœ€çš„çŠ¶æ€å¯èƒ½ä¼šæ ¹æ®ä¸åŒè¾“å…¥è¡Œçš„æ•°é‡è€Œæ— é™å¢é•¿ã€‚è¯·æä¾›æœ‰æ•ˆçš„ä¿ç•™æ—¶é—´é—´éš”çš„æŸ¥è¯¢é…ç½®ï¼Œä»¥é˜²æ­¢çŠ¶æ€å¤§å°è¿‡å¤§ã€‚è¯¦æƒ…è¯·çœ‹æŸ¥è¯¢é…ç½®ã€‚\nOrderBy, Offset å’Œ Fetch  Order By(Batch)  ç±»ä¼¼äº SQL ORDER BY å­å¥ã€‚è¿”å›æ‰€æœ‰å¹³è¡Œåˆ†åŒºçš„å…¨å±€æ’åºè®°å½•ã€‚\nval in = ds.toTable(tableEnv, $\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;, $\u0026#34;c\u0026#34;) val result = in.orderBy($\u0026#34;a\u0026#34;.asc)  Offset å’Œ Fetch(Batch)  ç±»ä¼¼äº SQL çš„ OFFSET å’Œ FETCH å­å¥ã€‚Offset å’Œ Fetch é™åˆ¶äº†æ’åºç»“æœä¸­è¿”å›çš„è®°å½•æ•°é‡ã€‚Offset å’Œ Fetch åœ¨æŠ€æœ¯ä¸Šæ˜¯ Order By æ“ä½œç¬¦çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤å¿…é¡»åœ¨å®ƒå‰é¢ã€‚\nval in = ds.toTable(tableEnv, $\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;, $\u0026#34;c\u0026#34;) // returns the first 5 records from the sorted result val result1: Table = in.orderBy($\u0026#34;a\u0026#34;.asc).fetch(5) // skips the first 3 records and returns all following records from the sorted result val result2: Table = in.orderBy($\u0026#34;a\u0026#34;.asc).offset(3) // skips the first 10 records and returns the next 5 records from the sorted result val result3: Table = in.orderBy($\u0026#34;a\u0026#34;.asc).offset(10).fetch(5) Insert  Insert Into(Batch/Streaming)  ç±»ä¼¼äº SQL æŸ¥è¯¢ä¸­çš„ INSERT INTO å­å¥ï¼Œè¯¥æ–¹æ³•æ‰§è¡Œæ’å…¥åˆ°ä¸€ä¸ªæ³¨å†Œçš„è¾“å‡ºè¡¨ä¸­ã€‚executeInsert() æ–¹æ³•å°†ç«‹å³æäº¤ä¸€ä¸ªæ‰§è¡Œæ’å…¥æ“ä½œçš„ Flink ä½œä¸šã€‚\nè¾“å‡ºè¡¨å¿…é¡»åœ¨ TableEnvironment ä¸­æ³¨å†Œï¼ˆè§è¿æ¥å™¨è¡¨ï¼‰ã€‚æ­¤å¤–ï¼Œæ³¨å†Œè¡¨çš„æ¨¡å¼å¿…é¡»ä¸æŸ¥è¯¢çš„æ¨¡å¼ç›¸åŒ¹é…ã€‚\nval orders: Table = tableEnv.from(\u0026#34;Orders\u0026#34;) orders.executeInsert(\u0026#34;OutOrders\u0026#34;) Group çª—å£ åˆ†ç»„çª—å£æ ¹æ®æ—¶é—´æˆ–è¡Œæ•°é—´éš”å°†åˆ†ç»„è¡Œæ±‡æ€»æˆæœ‰é™çš„ç»„ï¼Œæ¯ç»„è¯„ä¼°ä¸€æ¬¡æ±‡æ€»å‡½æ•°ã€‚å¯¹äºæ‰¹å¤„ç†è¡¨æ¥è¯´ï¼Œçª—å£æ˜¯æŒ‰æ—¶é—´é—´éš”å¯¹è®°å½•è¿›è¡Œåˆ†ç»„çš„ä¾¿æ·æ·å¾„ã€‚\nçª—å£æ˜¯ä½¿ç”¨ window(w: GroupWindow)å­å¥å®šä¹‰çš„ï¼Œå¹¶ä¸”éœ€è¦ä¸€ä¸ªåˆ«åï¼Œè¿™ä¸ªåˆ«åæ˜¯ä½¿ç”¨ as å­å¥æŒ‡å®šçš„ã€‚ä¸ºäº†é€šè¿‡çª—å£å¯¹è¡¨è¿›è¡Œåˆ†ç»„ï¼Œå¿…é¡»åœ¨ groupBy(\u0026hellip;)å­å¥ä¸­åƒå¸¸è§„åˆ†ç»„å±æ€§ä¸€æ ·å¼•ç”¨çª—å£åˆ«åã€‚ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨è¡¨ä¸Šå®šä¹‰çª—å£èšåˆã€‚\nval table = input .window([w: GroupWindow] as $\u0026#34;w\u0026#34;) // define window with alias w  .groupBy($\u0026#34;w\u0026#34;) // group the table by window w  .select($\u0026#34;b\u0026#34;.sum) // aggregate åœ¨æµå¼ç¯å¢ƒä¸­ï¼Œåªæœ‰å½“çª—å£èšåˆé™¤çª—å£å¤–è¿˜å¯¹ä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§è¿›è¡Œåˆ†ç»„æ—¶ï¼Œæ‰èƒ½å¹¶è¡Œè®¡ç®—ï¼Œå³ groupBy(\u0026hellip;)å­å¥å¼•ç”¨äº†ä¸€ä¸ªçª—å£åˆ«åå’Œè‡³å°‘ä¸€ä¸ªé™„åŠ å±æ€§ã€‚ä»…å¼•ç”¨çª—å£åˆ«åçš„ groupBy(\u0026hellip;) å­å¥ï¼ˆå¦‚ä¸Šé¢çš„ä¾‹å­ï¼‰åªèƒ½ç”±å•ä¸ªéå¹¶è¡Œä»»åŠ¡æ¥è¯„ä¼°ã€‚ä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•å®šä¹‰å…·æœ‰é™„åŠ åˆ†ç»„å±æ€§çš„çª—å£èšåˆã€‚\nval table = input .window([w: GroupWindow] as $\u0026#34;w\u0026#34;) // define window with alias w  .groupBy($\u0026#34;w\u0026#34;, $\u0026#34;a\u0026#34;) // group the table by attribute a and window w  .select($\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;.sum) // aggregate çª—å£å±æ€§ï¼Œå¦‚æ—¶é—´çª—å£çš„å¼€å§‹ã€ç»“æŸæˆ–è¡Œæ—¶é—´æˆ³ï¼Œå¯ä»¥åœ¨é€‰æ‹©è¯­å¥ä¸­ä½œä¸ºçª—å£åˆ«åçš„å±æ€§ï¼Œåˆ†åˆ«æ·»åŠ ä¸º w.startã€w.end å’Œ w.rowtimeã€‚çª—å£å¼€å§‹æ—¶é—´å’Œè¡Œæ—¶é—´æ—¶é—´æˆ³æ˜¯åŒ…å«çš„çª—å£ä¸‹ç•Œå’Œä¸Šç•Œã€‚ç›¸åï¼Œçª—å£ç»“æŸæ—¶é—´æˆ³æ˜¯ä¸“å±çš„ä¸Šå±‚çª—å£è¾¹ç•Œã€‚ä¾‹å¦‚ä¸€ä¸ªä»ä¸‹åˆ 2 ç‚¹å¼€å§‹çš„ 30 åˆ†é’Ÿçš„ç¿»æ»šçª—å£ï¼Œå…¶èµ·å§‹æ—¶é—´æˆ³ä¸º 14:00:00.000ï¼Œè¡Œæ—¶æ—¶é—´æˆ³ä¸º 14:29:59.999ï¼Œç»“æŸæ—¶é—´æˆ³ä¸º 14:30:00.000ã€‚\nval table = input .window([w: GroupWindow] as $\u0026#34;w\u0026#34;) // define window with alias w  .groupBy($\u0026#34;w\u0026#34;, $\u0026#34;a\u0026#34;) // group the table by attribute a and window w  .select($\u0026#34;a\u0026#34;, $\u0026#34;w\u0026#34;.start, $\u0026#34;w\u0026#34;.end, $\u0026#34;w\u0026#34;.rowtime, $\u0026#34;b\u0026#34;.count) // aggregate and add window start, end, and rowtime timestamps çª—å£å‚æ•°å®šä¹‰äº†å¦‚ä½•å°†è¡Œæ˜ å°„åˆ°çª—å£ã€‚Window ä¸æ˜¯ä¸€ä¸ªç”¨æˆ·å¯ä»¥å®ç°çš„æ¥å£ã€‚ç›¸åï¼ŒTable API æä¾›äº†ä¸€ç»„å…·æœ‰ç‰¹å®šè¯­ä¹‰çš„é¢„å®šä¹‰ Window ç±»ï¼Œå®ƒä»¬è¢«ç¿»è¯‘æˆåº•å±‚çš„ DataStream æˆ– DataSet æ“ä½œã€‚ä¸‹é¢åˆ—å‡ºäº†æ”¯æŒçš„çª—å£å®šä¹‰ã€‚\næ»šåŠ¨çª—å£ æ»šåŠ¨çª—å£å°†è¡Œåˆ†é…åˆ°å›ºå®šé•¿åº¦çš„éé‡å çš„è¿ç»­çª—å£ã€‚ä¾‹å¦‚ï¼Œ5 åˆ†é’Ÿçš„æ»šåŠ¨çª—å£ä»¥ 5 åˆ†é’Ÿçš„é—´éš”å°†è¡Œåˆ†ç»„ã€‚æ»šåŠ¨çª—å£å¯ä»¥åœ¨äº‹ä»¶æ—¶é—´ã€å¤„ç†æ—¶é—´æˆ–è¡Œæ•°ä¸Šå®šä¹‰ã€‚\næ»šåŠ¨çª—å£å¯ä»¥é€šè¿‡ä½¿ç”¨ Tumble ç±»æ¥å®šä¹‰ï¼Œå…·ä½“å¦‚ä¸‹ã€‚\n   æ–¹æ³• æè¿°     over å®šä¹‰çª—å£çš„é•¿åº¦ï¼Œå¯ä»¥æ˜¯æ—¶é—´æˆ–è¡Œæ•°é—´éš”ã€‚   on è¦å¯¹å…¶è¿›è¡Œåˆ†ç»„ï¼ˆæ—¶é—´é—´éš”ï¼‰æˆ–æ’åºï¼ˆè¡Œæ•°ï¼‰çš„æ—¶é—´å±æ€§ã€‚å¯¹äºæ‰¹å¤„ç†æŸ¥è¯¢ï¼Œè¿™å¯èƒ½æ˜¯ä»»ä½• Long æˆ– Timestamp å±æ€§ã€‚å¯¹äºæµå¼æŸ¥è¯¢ï¼Œè¿™å¿…é¡»æ˜¯ä¸€ä¸ªå£°æ˜çš„äº‹ä»¶æ—¶é—´æˆ–å¤„ç†æ—¶é—´æ—¶é—´å±æ€§ã€‚   as ä¸ºçª—å£æŒ‡å®šä¸€ä¸ªåˆ«åã€‚è¯¥åˆ«åç”¨äºåœ¨ä¸‹é¢çš„ groupBy()å­å¥ä¸­å¼•ç”¨çª—å£ï¼Œå¹¶åœ¨ select()å­å¥ä¸­é€‰æ‹©çª—å£å±æ€§ï¼Œå¦‚çª—å£å¼€å§‹ã€ç»“æŸæˆ–è¡Œæ—¶é—´æˆ³ã€‚    // Tumbling Event-time Window .window(Tumble over 10.minutes on $\u0026#34;rowtime\u0026#34; as $\u0026#34;w\u0026#34;) // Tumbling Processing-time Window (assuming a processing-time attribute \u0026#34;proctime\u0026#34;) .window(Tumble over 10.minutes on $\u0026#34;proctime\u0026#34; as $\u0026#34;w\u0026#34;) // Tumbling Row-count Window (assuming a processing-time attribute \u0026#34;proctime\u0026#34;) .window(Tumble over 10.rows on $\u0026#34;proctime\u0026#34; as $\u0026#34;w\u0026#34;) Slide (æ»‘åŠ¨çª—å£) æ»‘åŠ¨çª—å£æœ‰ä¸€ä¸ªå›ºå®šçš„å°ºå¯¸ï¼Œå¹¶æŒ‰æŒ‡å®šçš„æ»‘åŠ¨é—´éš”æ»‘åŠ¨ï¼Œå¦‚æœæ»‘åŠ¨é—´éš”å°äºçª—å£å°ºå¯¸ï¼Œæ»‘åŠ¨çª—å£å°±ä¼šé‡å ã€‚å¦‚æœæ»‘åŠ¨é—´éš”å°äºçª—å£å¤§å°ï¼Œæ»‘åŠ¨çª—å£å°±ä¼šé‡å ã€‚å› æ­¤ï¼Œè¡Œå¯ä»¥åˆ†é…ç»™å¤šä¸ªçª—å£ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª 15 åˆ†é’Ÿå¤§å°å’Œ 5 åˆ†é’Ÿæ»‘åŠ¨é—´éš”çš„æ»‘åŠ¨çª—å£å°†æ¯è¡Œåˆ†é…åˆ° 3 ä¸ªä¸åŒçš„ 15 åˆ†é’Ÿå¤§å°çš„çª—å£ï¼Œè¿™äº›çª—å£ä»¥ 5 åˆ†é’Ÿçš„é—´éš”è¿›è¡Œè¯„ä¼°ã€‚æ»‘åŠ¨çª—å£å¯ä»¥åœ¨äº‹ä»¶æ—¶é—´ã€å¤„ç†æ—¶é—´æˆ–è¡Œæ•°ä¸Šå®šä¹‰ã€‚\næ»‘åŠ¨çª—å£æ˜¯é€šè¿‡ä½¿ç”¨ Slide ç±»æ¥å®šä¹‰çš„ï¼Œå…·ä½“å¦‚ä¸‹ã€‚\n   æ–¹æ³• æè¿°     over å®šä¹‰çª—å£çš„é•¿åº¦ï¼Œå¯ä»¥æ˜¯æ—¶é—´æˆ–è¡Œæ•°é—´éš”ã€‚   every å®šä¹‰æ»‘åŠ¨é—´éš”ï¼Œå¯ä»¥æ˜¯æ—¶é—´é—´éš”æˆ–è¡Œæ•°é—´éš”ã€‚ç¼©æ”¾é—´éš”çš„ç±»å‹å¿…é¡»ä¸å°ºå¯¸é—´éš”ç›¸åŒã€‚   on è¦å¯¹å…¶è¿›è¡Œåˆ†ç»„ï¼ˆæ—¶é—´é—´éš”ï¼‰æˆ–æ’åºï¼ˆè¡Œæ•°ï¼‰çš„æ—¶é—´å±æ€§ã€‚å¯¹äºæ‰¹å¤„ç†æŸ¥è¯¢ï¼Œè¿™å¯èƒ½æ˜¯ä»»ä½• Long æˆ– Timestamp å±æ€§ã€‚å¯¹äºæµå¼æŸ¥è¯¢ï¼Œè¿™å¿…é¡»æ˜¯ä¸€ä¸ªå£°æ˜çš„äº‹ä»¶æ—¶é—´æˆ–å¤„ç†æ—¶é—´æ—¶é—´å±æ€§ã€‚   as ä¸ºçª—å£æŒ‡å®šä¸€ä¸ªåˆ«åã€‚è¯¥åˆ«åç”¨äºåœ¨ä¸‹é¢çš„ groupBy()å­å¥ä¸­å¼•ç”¨çª—å£ï¼Œå¹¶åœ¨ select()å­å¥ä¸­é€‰æ‹©çª—å£å±æ€§ï¼Œå¦‚çª—å£å¼€å§‹ã€ç»“æŸæˆ–è¡Œæ—¶é—´æˆ³ã€‚    // Sliding Event-time Window .window(Slide over 10.minutes every 5.minutes on $\u0026#34;rowtime\u0026#34; as $\u0026#34;w\u0026#34;) // Sliding Processing-time window (assuming a processing-time attribute \u0026#34;proctime\u0026#34;) .window(Slide over 10.minutes every 5.minutes on $\u0026#34;proctime\u0026#34; as $\u0026#34;w\u0026#34;) // Sliding Row-count window (assuming a processing-time attribute \u0026#34;proctime\u0026#34;) .window(Slide over 10.rows every 5.rows on $\u0026#34;proctime\u0026#34; as $\u0026#34;w\u0026#34;) Session (ä¼šè¯çª—å£) ä¼šè¯çª—å£æ²¡æœ‰å›ºå®šçš„å¤§å°ï¼Œä½†å®ƒä»¬çš„ç•Œé™æ˜¯ç”±ä¸æ´»åŠ¨çš„æ—¶é—´é—´éš”æ¥å®šä¹‰çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåœ¨å®šä¹‰çš„é—´éš™æœŸæ²¡æœ‰äº‹ä»¶å‡ºç°ï¼Œä¼šè¯çª—å£å°±ä¼šè¢«å…³é—­ã€‚ä¾‹å¦‚ï¼Œæœ‰ 30 åˆ†é’Ÿé—´éš”çš„ä¼šè¯çª—å£åœ¨ 30 åˆ†é’Ÿä¸æ´»åŠ¨åè§‚å¯Ÿåˆ°ä¸€è¡Œæ—¶å¼€å§‹ï¼ˆå¦åˆ™è¯¥è¡Œå°†è¢«æ·»åŠ åˆ°ç°æœ‰çš„çª—å£ä¸­ï¼‰ï¼Œå¦‚æœåœ¨ 30 åˆ†é’Ÿå†…æ²¡æœ‰è¡Œè¢«æ·»åŠ ï¼Œåˆ™å…³é—­ã€‚ä¼šè¯çª—å£å¯ä»¥åœ¨äº‹ä»¶æ—¶é—´æˆ–å¤„ç†æ—¶é—´å·¥ä½œã€‚\né€šè¿‡ä½¿ç”¨ Session ç±»å®šä¹‰ä¼šè¯çª—å£ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚\n   æ–¹æ³• æè¿°     withGap å°†ä¸¤ä¸ªçª—å£ä¹‹é—´çš„é—´éš”å®šä¹‰ä¸ºæ—¶é—´é—´éš”ã€‚   on è¦å¯¹å…¶è¿›è¡Œåˆ†ç»„ï¼ˆæ—¶é—´é—´éš”ï¼‰æˆ–æ’åºï¼ˆè¡Œæ•°ï¼‰çš„æ—¶é—´å±æ€§ã€‚å¯¹äºæ‰¹å¤„ç†æŸ¥è¯¢ï¼Œè¿™å¯èƒ½æ˜¯ä»»ä½• Long æˆ– Timestamp å±æ€§ã€‚å¯¹äºæµå¼æŸ¥è¯¢ï¼Œè¿™å¿…é¡»æ˜¯ä¸€ä¸ªå£°æ˜çš„äº‹ä»¶æ—¶é—´æˆ–å¤„ç†æ—¶é—´æ—¶é—´å±æ€§ã€‚   as ä¸ºçª—å£æŒ‡å®šä¸€ä¸ªåˆ«åã€‚è¯¥åˆ«åç”¨äºåœ¨ä¸‹é¢çš„ groupBy()å­å¥ä¸­å¼•ç”¨çª—å£ï¼Œå¹¶åœ¨ select()å­å¥ä¸­é€‰æ‹©çª—å£å±æ€§ï¼Œå¦‚çª—å£å¼€å§‹ã€ç»“æŸæˆ–è¡Œæ—¶é—´æˆ³ã€‚    // Session Event-time Window .window(Session withGap 10.minutes on $\u0026#34;rowtime\u0026#34; as $\u0026#34;w\u0026#34;) // Session Processing-time Window (assuming a processing-time attribute \u0026#34;proctime\u0026#34;) .window(Session withGap 10.minutes on $\u0026#34;proctime\u0026#34; as $\u0026#34;w\u0026#34;) Over çª—å£ Over çª—å£èšåˆæ˜¯ä»æ ‡å‡† SQLï¼ˆover å­å¥ï¼‰ä¸­å¾—çŸ¥çš„ï¼Œå¹¶åœ¨æŸ¥è¯¢çš„ SELECT å­å¥ä¸­å®šä¹‰ã€‚ä¸ç»„çª—å£ä¸åŒçš„æ˜¯ï¼Œç»„çª—å£æ˜¯åœ¨ GROUP BY å­å¥ä¸­æŒ‡å®šçš„ï¼Œover çª—å£ä¸æŠ˜å è¡Œã€‚ç›¸åï¼Œover çª—å£èšåˆè®¡ç®—çš„æ˜¯æ¯æ¡è¾“å…¥è¡Œåœ¨å…¶ç›¸é‚»è¡Œçš„èŒƒå›´å†…çš„èšåˆã€‚\nOver çª—å£æ˜¯ä½¿ç”¨ window(w: OverWindow*)å­å¥æ¥å®šä¹‰çš„(åœ¨ Python API ä¸­ä½¿ç”¨ over_window(*OverWindow))ï¼Œå¹¶ä¸”åœ¨ select()æ–¹æ³•ä¸­é€šè¿‡åˆ«åæ¥å¼•ç”¨ã€‚ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨è¡¨ä¸Šå®šä¹‰ä¸€ä¸ª over çª—å£èšåˆã€‚\nval table = input .window([w: OverWindow] as $\u0026#34;w\u0026#34;) // define over window with alias w  .select($\u0026#34;a\u0026#34;, $\u0026#34;b\u0026#34;.sum over $\u0026#34;w\u0026#34;, $\u0026#34;c\u0026#34;.min over $\u0026#34;w\u0026#34;) // aggregate over the over window w OverWindow å®šä¹‰äº†è®¡ç®—æ±‡æ€»çš„è¡Œçš„èŒƒå›´ã€‚OverWindow ä¸æ˜¯ä¸€ä¸ªç”¨æˆ·å¯ä»¥å®ç°çš„æ¥å£ã€‚ç›¸åï¼ŒTable API æä¾›äº† Over ç±»æ¥é…ç½® over çª—å£çš„å±æ€§ã€‚Over çª—å£å¯ä»¥åœ¨äº‹ä»¶æ—¶é—´æˆ–å¤„ç†æ—¶é—´ä¸Šå®šä¹‰ï¼Œä¹Ÿå¯ä»¥åœ¨æŒ‡å®šä¸ºæ—¶é—´é—´éš”æˆ–è¡Œæ•°çš„èŒƒå›´ä¸Šå®šä¹‰ã€‚æ”¯æŒçš„ over çª—å£å®šä¹‰æ˜¯ä»¥ Overï¼ˆå’Œå…¶ä»–ç±»ï¼‰ä¸Šçš„æ–¹æ³•æš´éœ²å‡ºæ¥çš„ï¼Œä¸‹é¢åˆ—å‡ºäº†è¿™äº›æ–¹æ³•ã€‚\n   æ–¹æ³• Required æè¿°     partitionBy Optional å®šä¹‰è¾“å…¥çš„ä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§çš„åˆ†åŒºã€‚æ¯ä¸ªåˆ†åŒºéƒ½è¢«å•ç‹¬æ’åºï¼Œèšåˆå‡½æ•°è¢«åˆ†åˆ«åº”ç”¨åˆ°æ¯ä¸ªåˆ†åŒºã€‚æ³¨æ„ï¼šåœ¨æµç¯å¢ƒä¸­ï¼Œåªæœ‰å½“çª—å£åŒ…å« partitionBy å­å¥æ—¶ï¼Œæ‰èƒ½å¹¶è¡Œè®¡ç®— over window aggregatesã€‚å¦‚æœæ²¡æœ‰ partitionBy(\u0026hellip;)ï¼Œæµå°±ä¼šè¢«ä¸€ä¸ªå•ä¸€çš„ã€éå¹¶è¡Œçš„ä»»åŠ¡å¤„ç†ã€‚   orderBy Required å®šä¹‰æ¯ä¸ªåˆ†åŒºä¸­è¡Œçš„é¡ºåºï¼Œä»è€Œå®šä¹‰èšåˆå‡½æ•°åº”ç”¨åˆ°è¡Œçš„é¡ºåºã€‚æ³¨æ„ï¼šå¯¹äºæµå¼æŸ¥è¯¢ï¼Œè¿™å¿…é¡»æ˜¯ä¸€ä¸ªå£°æ˜çš„äº‹ä»¶æ—¶é—´æˆ–å¤„ç†æ—¶é—´æ—¶é—´å±æ€§ã€‚ç›®å‰ï¼Œåªæ”¯æŒå•ä¸ªæ’åºå±æ€§ã€‚   preceding Optional å®šä¹‰åŒ…å«åœ¨çª—å£ä¸­å¹¶åœ¨å½“å‰è¡Œä¹‹å‰çš„è¡Œçš„é—´éš”ã€‚è¿™ä¸ªé—´éš”å¯ä»¥æŒ‡å®šä¸ºæ—¶é—´é—´éš”æˆ–è¡Œæ•°é—´éš”ã€‚æœ‰è¾¹ç•Œçš„çª—å£ç”¨é—´éš”çš„å¤§å°æ¥æŒ‡å®šï¼Œä¾‹å¦‚ï¼Œæ—¶é—´é—´éš”ä¸º 10.åˆ†é’Ÿï¼Œè¡Œæ•°é—´éš”ä¸º 10.è¡Œã€‚æ— è¾¹ç•Œçš„çª—å£ç”¨ä¸€ä¸ªå¸¸æ•°æ¥æŒ‡å®šï¼Œä¾‹å¦‚ï¼Œæ—¶é—´é—´éš”ä¸º UNBOUNDED_RANGEï¼Œè¡Œæ•°é—´éš”ä¸º UNBOUNDED_ROWã€‚æœªç»‘å®šçš„çª—å£ä»åˆ†åŒºçš„ç¬¬ä¸€è¡Œå¼€å§‹ã€‚å¦‚æœçœç•¥äº†å‰é¢çš„å­å¥ï¼ŒUNBOUNDED_RANGE å’Œ CURRENT_RANGE è¢«ç”¨ä½œçª—å£çš„é»˜è®¤å‰åã€‚   following Optional å®šä¹‰åŒ…å«åœ¨çª—å£ä¸­å¹¶è·Ÿéšå½“å‰è¡Œçš„è¡Œçš„çª—å£é—´éš”ã€‚è¿™ä¸ªé—´éš”å¿…é¡»ä¸å‰ä¸€ä¸ªé—´éš”çš„å•ä½ï¼ˆæ—¶é—´æˆ–è¡Œæ•°ï¼‰ç›¸åŒã€‚ç›®å‰ï¼Œä¸æ”¯æŒåœ¨å½“å‰è¡Œä¹‹åæ·»åŠ è¡Œçš„çª—å£ã€‚æ‚¨å¯ä»¥æŒ‡å®šä¸¤ä¸ªå¸¸é‡ä¸­çš„ä¸€ä¸ªã€‚CURRENT_ROW å°†çª—å£çš„ä¸Šç•Œè®¾ç½®ä¸ºå½“å‰è¡Œã€‚CURRENT_RANGE å°†çª—å£çš„ä¸Šç•Œè®¾ç½®ä¸ºå½“å‰è¡Œçš„æ’åºé”®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰ä¸å½“å‰è¡Œå…·æœ‰ç›¸åŒæ’åºé”®çš„è¡Œéƒ½åŒ…å«åœ¨çª—å£ä¸­ã€‚å¦‚æœçœç•¥ä¸‹é¢çš„å­å¥ï¼Œæ—¶é—´é—´éš”çª—å£çš„ä¸Šç•Œå®šä¹‰ä¸º CURRENT_RANGEï¼Œè¡Œæ•°é—´éš”çª—å£çš„ä¸Šç•Œå®šä¹‰ä¸º CURRENT_ROWã€‚   as Required ä¸º over çª—å£æŒ‡å®šä¸€ä¸ªåˆ«åã€‚è¯¥åˆ«åç”¨äºåœ¨ä¸‹é¢çš„ select()å­å¥ä¸­å¼•ç”¨ over çª—å£ã€‚    æ³¨æ„ï¼šç›®å‰ï¼Œåœ¨åŒä¸€ä¸ª select()è°ƒç”¨ä¸­ï¼Œæ‰€æœ‰çš„èšåˆå‡½æ•°éƒ½å¿…é¡»åœ¨åŒä¸€ä¸ª over çª—å£ä¸­è®¡ç®—ã€‚\nUnbounded Over Windows // Unbounded Event-time over window (assuming an event-time attribute \u0026#34;rowtime\u0026#34;) .window(Over partitionBy $\u0026#34;a\u0026#34; orderBy $\u0026#34;rowtime\u0026#34; preceding UNBOUNDED_RANGE as \u0026#34;w\u0026#34;) // Unbounded Processing-time over window (assuming a processing-time attribute \u0026#34;proctime\u0026#34;) .window(Over partitionBy $\u0026#34;a\u0026#34; orderBy $\u0026#34;proctime\u0026#34; preceding UNBOUNDED_RANGE as \u0026#34;w\u0026#34;) // Unbounded Event-time Row-count over window (assuming an event-time attribute \u0026#34;rowtime\u0026#34;) .window(Over partitionBy $\u0026#34;a\u0026#34; orderBy $\u0026#34;rowtime\u0026#34; preceding UNBOUNDED_ROW as \u0026#34;w\u0026#34;) // Unbounded Processing-time Row-count over window (assuming a processing-time attribute \u0026#34;proctime\u0026#34;) .window(Over partitionBy $\u0026#34;a\u0026#34; orderBy $\u0026#34;proctime\u0026#34; preceding UNBOUNDED_ROW as \u0026#34;w\u0026#34;) Bounded Over Windows // Bounded Event-time over window (assuming an event-time attribute \u0026#34;rowtime\u0026#34;) .window(Over partitionBy $\u0026#34;a\u0026#34; orderBy $\u0026#34;rowtime\u0026#34; preceding 1.minutes as \u0026#34;w\u0026#34;) // Bounded Processing-time over window (assuming a processing-time attribute \u0026#34;proctime\u0026#34;) .window(Over partitionBy $\u0026#34;a\u0026#34; orderBy $\u0026#34;proctime\u0026#34; preceding 1.minutes as \u0026#34;w\u0026#34;) // Bounded Event-time Row-count over window (assuming an event-time attribute \u0026#34;rowtime\u0026#34;) .window(Over partitionBy $\u0026#34;a\u0026#34; orderBy $\u0026#34;rowtime\u0026#34; preceding 10.rows as \u0026#34;w\u0026#34;) // Bounded Processing-time Row-count over window (assuming a processing-time attribute \u0026#34;proctime\u0026#34;) .window(Over partitionBy $\u0026#34;a\u0026#34; orderBy $\u0026#34;proctime\u0026#34; preceding 10.rows as \u0026#34;w\u0026#34;) åŸºäºè¡Œçš„æ“ä½œ åŸºäºè¡Œçš„æ“ä½œäº§ç”Ÿå¤šåˆ—çš„è¾“å‡ºã€‚\n Map(Batch/Streaming)  ä½¿ç”¨ç”¨æˆ·å®šä¹‰çš„æ ‡é‡å‡½æ•°æˆ–å†…ç½®çš„æ ‡é‡å‡½æ•°æ‰§è¡Œ map æ“ä½œã€‚å¦‚æœè¾“å‡ºç±»å‹æ˜¯å¤åˆç±»å‹ï¼Œåˆ™è¾“å‡ºå°†è¢«æ‰å¹³åŒ–ã€‚\nclass MyMapFunction extends ScalarFunction { def eval(a: String): Row = { Row.of(a, \u0026#34;pre-\u0026#34; + a) } override def getResultType(signature: Array[Class[_]]): TypeInformation[_] = Types.ROW(Types.STRING, Types.STRING) } val func = new MyMapFunction() val table = input .map(func($\u0026#34;c\u0026#34;)).as(\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;)  FlatMap(Batch/Streaming)  ç”¨è¡¨æ ¼å‡½æ•°æ‰§è¡Œ flatMap æ“ä½œã€‚\nclass MyFlatMapFunction extends TableFunction[Row] { def eval(str: String): Unit = { if (str.contains(\u0026#34;#\u0026#34;)) { str.split(\u0026#34;#\u0026#34;).foreach({ s =\u0026gt; val row = new Row(2) row.setField(0, s) row.setField(1, s.length) collect(row) }) } } override def getResultType: TypeInformation[Row] = { Types.ROW(Types.STRING, Types.INT) } } val func = new MyFlatMapFunction val table = input .flatMap(func($\u0026#34;c\u0026#34;)).as(\u0026#34;a\u0026#34;, \u0026#34;b\u0026#34;)  Aggregate(Batch/Streaming/Result Updating)  ç”¨ä¸€ä¸ªèšåˆå‡½æ•°æ‰§è¡Œä¸€ä¸ªèšåˆæ“ä½œã€‚å¿…é¡»ç”¨ select è¯­å¥å…³é—­\u0026quot;èšåˆ\u0026quot;ï¼Œselect è¯­å¥ä¸æ”¯æŒèšåˆå‡½æ•°ã€‚å¦‚æœè¾“å‡ºç±»å‹æ˜¯å¤åˆç±»å‹ï¼Œèšåˆçš„è¾“å‡ºå°†è¢«æ‰å¹³åŒ–ã€‚\ncase class MyMinMaxAcc(var min: Int, var max: Int) class MyMinMax extends AggregateFunction[Row, MyMinMaxAcc] { def accumulate(acc: MyMinMaxAcc, value: Int): Unit = { if (value \u0026lt; acc.min) { acc.min = value } if (value \u0026gt; acc.max) { acc.max = value } } override def createAccumulator(): MyMinMaxAcc = MyMinMaxAcc(0, 0) def resetAccumulator(acc: MyMinMaxAcc): Unit = { acc.min = 0 acc.max = 0 } override def getValue(acc: MyMinMaxAcc): Row = { Row.of(Integer.valueOf(acc.min), Integer.valueOf(acc.max)) } override def getResultType: TypeInformation[Row] = { new RowTypeInfo(Types.INT, Types.INT) } } val myAggFunc = new MyMinMax val table = input .groupBy($\u0026#34;key\u0026#34;) .aggregate(myAggFunc($\u0026#34;a\u0026#34;) as (\u0026#34;x\u0026#34;, \u0026#34;y\u0026#34;)) .select($\u0026#34;key\u0026#34;, $\u0026#34;x\u0026#34;, $\u0026#34;y\u0026#34;)  Group çª—å£èšåˆ(Batch/Streaming)  åœ¨åˆ†ç»„çª—å£å’Œå¯èƒ½çš„ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†ç»„é”®ä¸Šå¯¹ä¸€ä¸ªè¡¨è¿›è¡Œåˆ†ç»„å’Œèšåˆã€‚ä½ å¿…é¡»ç”¨ select è¯­å¥å…³é—­\u0026quot;èšåˆ\u0026quot;ã€‚è€Œä¸”é€‰æ‹©è¯­å¥ä¸æ”¯æŒ \u0026ldquo;*\u0026rdquo; æˆ–èšåˆå‡½æ•°ã€‚\nval myAggFunc = new MyMinMax val table = input .window(Tumble over 5.minutes on $\u0026#34;rowtime\u0026#34; as \u0026#34;w\u0026#34;) // define window  .groupBy($\u0026#34;key\u0026#34;, $\u0026#34;w\u0026#34;) // group by key and window  .aggregate(myAggFunc($\u0026#34;a\u0026#34;) as (\u0026#34;x\u0026#34;, \u0026#34;y\u0026#34;)) .select($\u0026#34;key\u0026#34;, $\u0026#34;x\u0026#34;, $\u0026#34;y\u0026#34;, $\u0026#34;w\u0026#34;.start, $\u0026#34;w\u0026#34;.end) // access window properties and aggregate results  FlatAggregate(Streaming/Result Updating)  ç±»ä¼¼äº GroupBy èšåˆã€‚å°†åˆ†ç»„é”®ä¸Šçš„è¡Œä¸ä¸‹é¢çš„è¿è¡Œè¡¨èšåˆè¿ç®—ç¬¦è¿›è¡Œåˆ†ç»„ï¼Œå°†è¡Œè¿›è¡Œåˆ†ç»„ã€‚ä¸ AggregateFunction çš„ä¸åŒä¹‹å¤„åœ¨äºï¼ŒTableAggregateFunction å¯ä»¥ä¸ºä¸€ä¸ªç»„è¿”å› 0 æ¡æˆ–å¤šæ¡è®°å½•ã€‚ä½ å¿…é¡»ç”¨ select è¯­å¥å…³é—­ \u0026ldquo;flatAggregate\u0026rdquo;ã€‚è€Œ select è¯­å¥ä¸æ”¯æŒèšåˆå‡½æ•°ã€‚\nä¸ä½¿ç”¨ emitValue è¾“å‡ºç»“æœï¼Œè¿˜å¯ä»¥ä½¿ç”¨ emitUpdateWithRetract æ–¹æ³•ã€‚ä¸ emitValue ä¸åŒçš„æ˜¯ï¼ŒemitUpdateWithRetract ç”¨äºè¾“å‡ºå·²ç»æ›´æ–°çš„å€¼ã€‚è¿™ä¸ªæ–¹æ³•ä»¥å›ç¼©æ¨¡å¼å¢é‡è¾“å‡ºæ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦æœ‰æ›´æ–°ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨å‘é€æ–°çš„æ›´æ–°è®°å½•ä¹‹å‰å›ç¼©æ—§çš„è®°å½•ã€‚å¦‚æœåœ¨è¡¨èšåˆå‡½æ•°ä¸­å®šä¹‰äº† emitUpdateWithRetract æ–¹æ³•ï¼Œé‚£ä¹ˆ emitUpdateWithRetract æ–¹æ³•å°†ä¼˜å…ˆäº emitValue æ–¹æ³•ä½¿ç”¨ï¼Œå› ä¸ºè¯¥æ–¹æ³•è¢«è§†ä¸ºæ¯” emitValue æ›´æœ‰æ•ˆï¼Œå› ä¸ºå®ƒå¯ä»¥å¢é‡è¾“å‡ºå€¼ã€‚è¯¦è§è¡¨èšåˆå‡½æ•°ã€‚\nimport java.lang.{Integer =\u0026gt; JInteger} import org.apache.flink.table.api.Types import org.apache.flink.table.functions.TableAggregateFunction /** * Accumulator for top2. */ class Top2Accum { var first: JInteger = _ var second: JInteger = _ } /** * The top2 user-defined table aggregate function. */ class Top2 extends TableAggregateFunction[JTuple2[JInteger, JInteger], Top2Accum] { override def createAccumulator(): Top2Accum = { val acc = new Top2Accum acc.first = Int.MinValue acc.second = Int.MinValue acc } def accumulate(acc: Top2Accum, v: Int) { if (v \u0026gt; acc.first) { acc.second = acc.first acc.first = v } else if (v \u0026gt; acc.second) { acc.second = v } } def merge(acc: Top2Accum, its: JIterable[Top2Accum]): Unit = { val iter = its.iterator() while (iter.hasNext) { val top2 = iter.next() accumulate(acc, top2.first) accumulate(acc, top2.second) } } def emitValue(acc: Top2Accum, out: Collector[JTuple2[JInteger, JInteger]]): Unit = { // emit the value and rank  if (acc.first != Int.MinValue) { out.collect(JTuple2.of(acc.first, 1)) } if (acc.second != Int.MinValue) { out.collect(JTuple2.of(acc.second, 2)) } } } val top2 = new Top2 val orders: Table = tableEnv.from(\u0026#34;Orders\u0026#34;) val result = orders .groupBy($\u0026#34;key\u0026#34;) .flatAggregate(top2($\u0026#34;a\u0026#34;) as ($\u0026#34;v\u0026#34;, $\u0026#34;rank\u0026#34;)) .select($\u0026#34;key\u0026#34;, $\u0026#34;v\u0026#34;, $\u0026#34;rank\u0026#34;) æ³¨æ„ï¼šå¯¹äºæµå¼æŸ¥è¯¢ï¼Œè®¡ç®—æŸ¥è¯¢ç»“æœæ‰€éœ€çš„çŠ¶æ€å¯èƒ½ä¼šæ— é™å¢é•¿ï¼Œè¿™å–å†³äºèšåˆçš„ç±»å‹å’Œä¸åŒåˆ†ç»„é”®çš„æ•°é‡ã€‚è¯·æä¾›å…·æœ‰æœ‰æ•ˆä¿ç•™æ—¶é—´é—´éš”çš„æŸ¥è¯¢é…ç½®ï¼Œä»¥é˜²æ­¢çŠ¶æ€å¤§å°è¿‡å¤§ã€‚è¯¦æƒ…è¯·å‚è§æŸ¥è¯¢é…ç½®ã€‚\n Group Window FlatAggregate(Streaming)  åœ¨åˆ†ç»„çª—å£å’Œå¯èƒ½ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†ç»„é”®ä¸Šå¯¹ä¸€ä¸ªè¡¨è¿›è¡Œåˆ†ç»„å’Œèšåˆã€‚ä½ å¿…é¡»ç”¨ select è¯­å¥å…³é—­ \u0026ldquo;flatAggregate\u0026rdquo;ã€‚è€Œ select è¯­å¥ä¸æ”¯æŒèšåˆå‡½æ•°ã€‚\nval top2 = new Top2 val orders: Table = tableEnv.from(\u0026#34;Orders\u0026#34;) val result = orders .window(Tumble over 5.minutes on $\u0026#34;rowtime\u0026#34; as \u0026#34;w\u0026#34;) // define window  .groupBy($\u0026#34;a\u0026#34;, $\u0026#34;w\u0026#34;) // group by key and window  .flatAggregate(top2($\u0026#34;b\u0026#34;) as ($\u0026#34;v\u0026#34;, $\u0026#34;rank\u0026#34;)) .select($\u0026#34;a\u0026#34;, w.start, $\u0026#34;w\u0026#34;.end, $\u0026#34;w\u0026#34;.rowtime, $\u0026#34;v\u0026#34;, $\u0026#34;rank\u0026#34;) // access window properties and aggregate results æ•°æ®ç±»å‹ è¯·çœ‹å…³äºæ•°æ®ç±»å‹çš„ä¸“é—¨é¡µé¢ã€‚\né€šç”¨ç±»å‹å’Œ(åµŒå¥—çš„)å¤åˆç±»å‹(ä¾‹å¦‚ POJOsã€tupleã€è¡Œã€Scala case ç±»)ä¹Ÿå¯ä»¥æ˜¯è¡Œçš„å­—æ®µã€‚\nå…·æœ‰ä»»æ„åµŒå¥—çš„å¤åˆç±»å‹çš„å­—æ®µå¯ä»¥ç”¨å€¼è®¿é—®å‡½æ•°æ¥è®¿é—®ã€‚\né€šç”¨ç±»å‹è¢«è§†ä¸ºä¸€ä¸ªé»‘ç›’ï¼Œå¯ä»¥é€šè¿‡ç”¨æˆ·å®šä¹‰çš„å‡½æ•°è¿›è¡Œä¼ é€’æˆ–å¤„ç†ã€‚\nè¡¨è¾¾å¼è¯­æ³• å‰é¢å‡ èŠ‚ä¸­çš„ä¸€äº›æ“ä½œç¬¦éƒ½æœŸæœ›æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨è¾¾å¼ã€‚è¡¨è¾¾å¼å¯ä»¥ä½¿ç”¨å†…åµŒçš„ Scala DSL æˆ–ä½œä¸ºå­—ç¬¦ä¸²æ¥æŒ‡å®šã€‚è¯·å‚è€ƒä¸Šé¢çš„ä¾‹å­æ¥äº†è§£å¦‚ä½•æŒ‡å®šè¡¨è¾¾å¼ã€‚\nè¿™æ˜¯è¡¨è¾¾å¼çš„ EBNF è¯­æ³•ã€‚\nexpressionList = expression , { \u0026quot;,\u0026quot; , expression } ; expression = overConstant | alias ; alias = logic | ( logic , \u0026quot;as\u0026quot; , fieldReference ) | ( logic , \u0026quot;as\u0026quot; , \u0026quot;(\u0026quot; , fieldReference , { \u0026quot;,\u0026quot; , fieldReference } , \u0026quot;)\u0026quot; ) ; logic = comparison , [ ( \u0026quot;\u0026amp;\u0026amp;\u0026quot; | \u0026quot;||\u0026quot; ) , comparison ] ; comparison = term , [ ( \u0026quot;=\u0026quot; | \u0026quot;==\u0026quot; | \u0026quot;===\u0026quot; | \u0026quot;!=\u0026quot; | \u0026quot;!==\u0026quot; | \u0026quot;\u0026gt;\u0026quot; | \u0026quot;\u0026gt;=\u0026quot; | \u0026quot;\u0026lt;\u0026quot; | \u0026quot;\u0026lt;=\u0026quot; ) , term ] ; term = product , [ ( \u0026quot;+\u0026quot; | \u0026quot;-\u0026quot; ) , product ] ; product = unary , [ ( \u0026quot;*\u0026quot; | \u0026quot;/\u0026quot; | \u0026quot;%\u0026quot;) , unary ] ; unary = [ \u0026quot;!\u0026quot; | \u0026quot;-\u0026quot; | \u0026quot;+\u0026quot; ] , composite ; composite = over | suffixed | nullLiteral | prefixed | atom ; suffixed = interval | suffixAs | suffixCast | suffixIf | suffixDistinct | suffixFunctionCall | timeIndicator ; prefixed = prefixAs | prefixCast | prefixIf | prefixDistinct | prefixFunctionCall ; interval = timeInterval | rowInterval ; timeInterval = composite , \u0026quot;.\u0026quot; , (\u0026quot;year\u0026quot; | \u0026quot;years\u0026quot; | \u0026quot;quarter\u0026quot; | \u0026quot;quarters\u0026quot; | \u0026quot;month\u0026quot; | \u0026quot;months\u0026quot; | \u0026quot;week\u0026quot; | \u0026quot;weeks\u0026quot; | \u0026quot;day\u0026quot; | \u0026quot;days\u0026quot; | \u0026quot;hour\u0026quot; | \u0026quot;hours\u0026quot; | \u0026quot;minute\u0026quot; | \u0026quot;minutes\u0026quot; | \u0026quot;second\u0026quot; | \u0026quot;seconds\u0026quot; | \u0026quot;milli\u0026quot; | \u0026quot;millis\u0026quot;) ; rowInterval = composite , \u0026quot;.\u0026quot; , \u0026quot;rows\u0026quot; ; suffixCast = composite , \u0026quot;.cast(\u0026quot; , dataType , \u0026quot;)\u0026quot; ; prefixCast = \u0026quot;cast(\u0026quot; , expression , dataType , \u0026quot;)\u0026quot; ; dataType = \u0026quot;BYTE\u0026quot; | \u0026quot;SHORT\u0026quot; | \u0026quot;INT\u0026quot; | \u0026quot;LONG\u0026quot; | \u0026quot;FLOAT\u0026quot; | \u0026quot;DOUBLE\u0026quot; | \u0026quot;BOOLEAN\u0026quot; | \u0026quot;STRING\u0026quot; | \u0026quot;DECIMAL\u0026quot; | \u0026quot;SQL_DATE\u0026quot; | \u0026quot;SQL_TIME\u0026quot; | \u0026quot;SQL_TIMESTAMP\u0026quot; | \u0026quot;INTERVAL_MONTHS\u0026quot; | \u0026quot;INTERVAL_MILLIS\u0026quot; | ( \u0026quot;MAP\u0026quot; , \u0026quot;(\u0026quot; , dataType , \u0026quot;,\u0026quot; , dataType , \u0026quot;)\u0026quot; ) | ( \u0026quot;PRIMITIVE_ARRAY\u0026quot; , \u0026quot;(\u0026quot; , dataType , \u0026quot;)\u0026quot; ) | ( \u0026quot;OBJECT_ARRAY\u0026quot; , \u0026quot;(\u0026quot; , dataType , \u0026quot;)\u0026quot; ) ; suffixAs = composite , \u0026quot;.as(\u0026quot; , fieldReference , \u0026quot;)\u0026quot; ; prefixAs = \u0026quot;as(\u0026quot; , expression, fieldReference , \u0026quot;)\u0026quot; ; suffixIf = composite , \u0026quot;.?(\u0026quot; , expression , \u0026quot;,\u0026quot; , expression , \u0026quot;)\u0026quot; ; prefixIf = \u0026quot;?(\u0026quot; , expression , \u0026quot;,\u0026quot; , expression , \u0026quot;,\u0026quot; , expression , \u0026quot;)\u0026quot; ; suffixDistinct = composite , \u0026quot;distinct.()\u0026quot; ; prefixDistinct = functionIdentifier , \u0026quot;.distinct\u0026quot; , [ \u0026quot;(\u0026quot; , [ expression , { \u0026quot;,\u0026quot; , expression } ] , \u0026quot;)\u0026quot; ] ; suffixFunctionCall = composite , \u0026quot;.\u0026quot; , functionIdentifier , [ \u0026quot;(\u0026quot; , [ expression , { \u0026quot;,\u0026quot; , expression } ] , \u0026quot;)\u0026quot; ] ; prefixFunctionCall = functionIdentifier , [ \u0026quot;(\u0026quot; , [ expression , { \u0026quot;,\u0026quot; , expression } ] , \u0026quot;)\u0026quot; ] ; atom = ( \u0026quot;(\u0026quot; , expression , \u0026quot;)\u0026quot; ) | literal | fieldReference ; fieldReference = \u0026quot;*\u0026quot; | identifier ; nullLiteral = \u0026quot;nullOf(\u0026quot; , dataType , \u0026quot;)\u0026quot; ; timeIntervalUnit = \u0026quot;YEAR\u0026quot; | \u0026quot;YEAR_TO_MONTH\u0026quot; | \u0026quot;MONTH\u0026quot; | \u0026quot;QUARTER\u0026quot; | \u0026quot;WEEK\u0026quot; | \u0026quot;DAY\u0026quot; | \u0026quot;DAY_TO_HOUR\u0026quot; | \u0026quot;DAY_TO_MINUTE\u0026quot; | \u0026quot;DAY_TO_SECOND\u0026quot; | \u0026quot;HOUR\u0026quot; | \u0026quot;HOUR_TO_MINUTE\u0026quot; | \u0026quot;HOUR_TO_SECOND\u0026quot; | \u0026quot;MINUTE\u0026quot; | \u0026quot;MINUTE_TO_SECOND\u0026quot; | \u0026quot;SECOND\u0026quot; ; timePointUnit = \u0026quot;YEAR\u0026quot; | \u0026quot;MONTH\u0026quot; | \u0026quot;DAY\u0026quot; | \u0026quot;HOUR\u0026quot; | \u0026quot;MINUTE\u0026quot; | \u0026quot;SECOND\u0026quot; | \u0026quot;QUARTER\u0026quot; | \u0026quot;WEEK\u0026quot; | \u0026quot;MILLISECOND\u0026quot; | \u0026quot;MICROSECOND\u0026quot; ; over = composite , \u0026quot;over\u0026quot; , fieldReference ; overConstant = \u0026quot;current_row\u0026quot; | \u0026quot;current_range\u0026quot; | \u0026quot;unbounded_row\u0026quot; | \u0026quot;unbounded_row\u0026quot; ; timeIndicator = fieldReference , \u0026quot;.\u0026quot; , ( \u0026quot;proctime\u0026quot; | \u0026quot;rowtime\u0026quot; ) ; å­—ç¬¦ã€‚åœ¨è¿™é‡Œï¼Œliteral æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ Java å­—å…ƒã€‚å­—ç¬¦ä¸²çš„å­—å…ƒå¯ä»¥ä½¿ç”¨å•å¼•å·æˆ–åŒå¼•å·æ¥æŒ‡å®šã€‚å¤åˆ¶å¼•å·è¿›è¡Œè½¬ä¹‰ï¼ˆä¾‹å¦‚ \u0026lsquo;It\u0026rsquo;s me.\u0026rsquo; æˆ– \u0026ldquo;I \u0026ldquo;\u0026ldquo;like \u0026ldquo;dog.\u0026quot;ï¼‰ã€‚\nç©ºç¬¦ã€‚ç©ºç¬¦å¿…é¡»æœ‰ä¸€ä¸ªç±»å‹ã€‚ä½¿ç”¨ nullOf(type)(ä¾‹å¦‚ nullOf(INT))æ¥åˆ›å»ºä¸€ä¸ªç©ºå€¼ã€‚\nå­—æ®µå¼•ç”¨ã€‚fieldReference æŒ‡å®šæ•°æ®ä¸­çš„ä¸€åˆ—ï¼ˆå¦‚æœä½¿ç”¨ *ï¼Œåˆ™æŒ‡å®šæ‰€æœ‰åˆ—ï¼‰ï¼ŒfunctionIdentifier æŒ‡å®šä¸€ä¸ªæ”¯æŒçš„æ ‡é‡å‡½æ•°ã€‚åˆ—åå’Œå‡½æ•°åéµå¾ª Java æ ‡è¯†ç¬¦è¯­æ³•ã€‚\nå‡½æ•°è°ƒç”¨ã€‚ä½œä¸ºå­—ç¬¦ä¸²æŒ‡å®šçš„è¡¨è¾¾å¼ä¹Ÿå¯ä»¥ä½¿ç”¨å‰ç¼€ç¬¦å·ä»£æ›¿åç¼€ç¬¦å·æ¥è°ƒç”¨è¿ç®—ç¬¦å’Œå‡½æ•°ã€‚\nå°æ•°ã€‚å¦‚æœéœ€è¦å¤„ç†ç²¾ç¡®çš„æ•°å€¼æˆ–å¤§çš„å°æ•°ï¼ŒTable API ä¹Ÿæ”¯æŒ Java çš„ BigDecimal ç±»å‹ã€‚åœ¨ Scala Table API ä¸­ï¼Œå°æ•°å¯ä»¥é€šè¿‡ BigDecimal(\u0026ldquo;123456\u0026rdquo;)æ¥å®šä¹‰ï¼Œè€Œåœ¨ Java ä¸­ï¼Œå¯ä»¥é€šè¿‡é™„åŠ ä¸€ä¸ª \u0026ldquo;p\u0026rdquo; æ¥è¡¨ç¤ºç²¾ç¡®ï¼Œä¾‹å¦‚ 123456pã€‚\næ—¶é—´è¡¨ç¤ºæ³•ã€‚ä¸ºäº†å¤„ç†æ—¶é—´å€¼ï¼ŒTable API æ”¯æŒ Java SQL çš„ Date, Time å’Œ Timestamp ç±»å‹ã€‚åœ¨ Scala Table API ä¸­ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ java.sql.Date.valueOf(\u0026ldquo;2016-06-27\u0026rdquo;)ã€java.sql.Time.valueOf(\u0026ldquo;10:10:42\u0026rdquo;) æˆ– java.sql.Timestamp.valueOf(\u0026ldquo;2016-06-27 10:10:42.123\u0026rdquo;) æ¥å®šä¹‰å­—ç¬¦ã€‚Java å’Œ Scala Table API è¿˜æ”¯æŒè°ƒç”¨ \u0026ldquo;2016-06-27\u0026rdquo;.toDate()ã€\u0026ldquo;10:10:42\u0026rdquo;.toTime() å’Œ \u0026ldquo;2016-06-27 10:10:42.123\u0026rdquo;.toTimestamp() æ¥å°† Strings è½¬æ¢ä¸ºæ—¶é—´ç±»å‹ã€‚æ³¨æ„ï¼šç”±äº Java çš„æ—¶æ€ SQL ç±»å‹ä¾èµ–äºæ—¶åŒºï¼Œè¯·ç¡®ä¿ Flink å®¢æˆ·ç«¯å’Œæ‰€æœ‰çš„ TaskManagers ä½¿ç”¨ç›¸åŒçš„æ—¶åŒºã€‚\næ—¶é—´é—´éš”ã€‚æ—¶é—´é—´éš”å¯ä»¥ç”¨æœˆæ•°ï¼ˆTypes.INTERVAL_MONTHSï¼‰æˆ–æ¯«ç§’æ•°ï¼ˆTypes.INTERVAL_MILLISï¼‰è¡¨ç¤ºã€‚åŒä¸€ç±»å‹çš„æ—¶é—´é—´éš”å¯ä»¥åŠ å‡(ä¾‹å¦‚ï¼š1.å°æ—¶+10.åˆ†é’Ÿ)ã€‚å¯ä»¥å°†æ¯«ç§’çš„æ—¶é—´é—´éš”åŠ åˆ°æ—¶é—´ç‚¹ä¸Šï¼ˆå¦‚ \u0026ldquo;2016-08-10\u0026rdquo;.toDate + 5.daysï¼‰ã€‚\nScala è¡¨è¾¾å¼ã€‚Scala è¡¨è¾¾å¼ä½¿ç”¨éšå¼è½¬æ¢ã€‚å› æ­¤ï¼Œç¡®ä¿åœ¨ä½ çš„ç¨‹åºä¸­æ·»åŠ é€šé…ç¬¦ import org.apache.flink.table.api._ã€‚å¦‚æœä¸€ä¸ªå­—è¯æ²¡æœ‰è¢«å½“ä½œè¡¨è¾¾å¼ï¼Œå¯ä»¥ä½¿ç”¨.toExpr å¦‚ 3.toExpr æ¥å¼ºåˆ¶è½¬æ¢ä¸€ä¸ªå­—è¯ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-table-api/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL"],"title":"Table API"},{"categories":["Flink"],"contents":"Table API å’Œ SQL Apache Flink å…·æœ‰ä¸¤ä¸ªå…³ç³»å‹ API - Table API å’Œ SQL - ç”¨äºç»Ÿä¸€çš„æµå’Œæ‰¹å¤„ç†ã€‚Table API æ˜¯ Scala å’Œ Java çš„è¯­è¨€é›†æˆæŸ¥è¯¢ APIï¼Œå®ƒå…è®¸ç”¨éå¸¸ç›´è§‚çš„æ–¹å¼ä»å…³ç³»è¿ç®—ç¬¦ï¼ˆå¦‚é€‰æ‹©ã€è¿‡æ»¤å’Œè¿æ¥ï¼‰ç»„æˆæŸ¥è¯¢ã€‚Flink çš„ SQL æ”¯æŒæ˜¯åŸºäº Apache Calciteï¼Œå®ƒå®ç°äº† SQL æ ‡å‡†ã€‚æ— è®ºè¾“å…¥æ˜¯æ‰¹å¤„ç†è¾“å…¥ï¼ˆDataSetï¼‰è¿˜æ˜¯æµè¾“å…¥ï¼ˆDataStreamï¼‰ï¼Œåœ¨ä»»ä¸€æ¥å£ä¸­æŒ‡å®šçš„æŸ¥è¯¢éƒ½å…·æœ‰ç›¸åŒçš„è¯­ä¹‰ï¼Œå¹¶æŒ‡å®šç›¸åŒçš„ç»“æœã€‚\nè¡¨ API å’Œ SQL æ¥å£ä¸ Flink çš„ DataStream å’Œ DataSet API ç´§å¯†é›†æˆã€‚ä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨æ‰€æœ‰ API å’Œå»ºç«‹åœ¨ API åŸºç¡€ä¸Šçš„åº“ä¹‹é—´åˆ‡æ¢ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ CEP åº“ ä» DataStream ä¸­æå–æ¨¡å¼ï¼Œéšåä½¿ç”¨ Table API æ¥åˆ†ææ¨¡å¼ï¼Œæˆ–è€…æ‚¨å¯èƒ½ä¼šåœ¨é¢„å¤„ç†æ•°æ®ä¸Šè¿è¡Œ Gelly å›¾ç®—æ³•ä¹‹å‰ï¼Œä½¿ç”¨ SQL æŸ¥è¯¢æ‰«æã€è¿‡æ»¤å’Œèšåˆä¸€ä¸ªæ‰¹å¤„ç†è¡¨ã€‚\nè¯·æ³¨æ„ï¼ŒTable API å’Œ SQL çš„åŠŸèƒ½è¿˜ä¸å®Œå–„ï¼Œæ­£åœ¨ç§¯æå¼€å‘ä¸­ã€‚å¹¶éæ‰€æœ‰çš„æ“ä½œéƒ½è¢« [Table API, SQL] å’Œ [stream, batch] è¾“å…¥çš„æ¯ä¸ªç»„åˆæ‰€æ”¯æŒã€‚\nä¾èµ–ç»“æ„ ä» Flink 1.9 å¼€å§‹ï¼ŒFlink ä¸ºè¯„ä¼° Table \u0026amp; SQL API ç¨‹åºæä¾›äº†ä¸¤ç§ä¸åŒçš„è§„åˆ’å™¨å®ç°ï¼šBlink planner å’Œ Flink 1.9 ä¹‹å‰çš„æ—§ plannerã€‚Planner è´Ÿè´£å°†å…³ç³»è¿ç®—ç¬¦è½¬åŒ–ä¸ºå¯æ‰§è¡Œçš„ã€ä¼˜åŒ–çš„ Flink ä½œä¸šã€‚è¿™ä¸¤ç§ planner éƒ½æœ‰ä¸åŒçš„ä¼˜åŒ–è§„åˆ™å’Œè¿è¡Œæ—¶ç±»ã€‚å®ƒä»¬åœ¨æ”¯æŒçš„åŠŸèƒ½é›†ä¸Šä¹Ÿå¯èƒ½æœ‰æ‰€ä¸åŒã€‚\næ³¨æ„: å¯¹äºç”Ÿäº§ç”¨ä¾‹ï¼Œæˆ‘ä»¬æ¨è blink plannerï¼Œå®ƒä» 1.11 å¼€å§‹æˆä¸ºé»˜è®¤ plannerã€‚\næ‰€æœ‰çš„ Table API å’Œ SQL ç»„ä»¶éƒ½æ†ç»‘åœ¨ flink-table æˆ– flink-table-blink Maven æ„ä»¶ä¸­ã€‚\nä»¥ä¸‹æ˜¯ä¸å¤§å¤šæ•°é¡¹ç›®ç›¸å…³çš„ä¾èµ–å…³ç³»ã€‚\n flink-table-common: ä¸€ä¸ªé€šç”¨æ¨¡å—ï¼Œç”¨äºé€šè¿‡è‡ªå®šä¹‰å‡½æ•°ã€æ ¼å¼ç­‰æ‰©å±•è¡¨ç”Ÿæ€ç³»ç»Ÿã€‚ flink-table-api-java: ä½¿ç”¨ Java ç¼–ç¨‹è¯­è¨€çš„çº¯è¡¨ç¨‹åºçš„ Table \u0026amp; SQL APIï¼ˆå¤„äºæ—©æœŸå¼€å‘é˜¶æ®µï¼Œä¸æ¨èï¼ï¼‰ã€‚ flink-table-api-scala: Table å’Œ SQL APIï¼Œç”¨äºä½¿ç”¨ Java ç¼–ç¨‹è¯­è¨€çš„çº¯è¡¨ç¨‹åºï¼ˆå¤„äºæ—©æœŸå¼€å‘é˜¶æ®µï¼Œä¸æ¨èï¼‰ã€‚ flink-table-api-java-bridge: ä½¿ç”¨ Java ç¼–ç¨‹è¯­è¨€æ”¯æŒ DataStream/DataSet API çš„ Table \u0026amp; SQL APIã€‚ flink-table-api-scala-bridge: ä½¿ç”¨ Scala ç¼–ç¨‹è¯­è¨€ï¼Œæ”¯æŒ DataStream/DataSet API çš„è¡¨å’Œ SQL APIã€‚ flink-table-planner: è¡¨ç¨‹åº planner å’Œè¿è¡Œæ—¶ã€‚è¿™æ˜¯åœ¨ 1.9 ç‰ˆæœ¬ä¹‹å‰ Flink å”¯ä¸€çš„ plannerã€‚ä» Flink 1.11 å¼€å§‹ï¼Œä¸å†æ¨èä½¿ç”¨å®ƒã€‚ flink-table-planner-link: æ–°çš„ Blink è®¡åˆ’å™¨ï¼Œä» Flink 1.11 å¼€å§‹æˆä¸ºé»˜è®¤çš„ã€‚ flink-table-runtim-blink: æ–°çš„ Blink è¿è¡Œæ—¶ã€‚ flink-table-uber: å°†ä¸Šé¢çš„ API æ¨¡å—åŠ ä¸Šæ—§çš„è§„åˆ’å™¨æ‰“åŒ…æˆä¸€ä¸ªé€‚ç”¨äºå¤§å¤šæ•° Table \u0026amp; SQL API ä½¿ç”¨æ¡ˆä¾‹çš„å‘è¡Œç‰ˆã€‚uber JAR æ–‡ä»¶ flink-table-*.jar é»˜è®¤ä½äº Flink ç‰ˆæœ¬çš„ /lib ç›®å½•ä¸‹ã€‚ flink-table-uber-blink: å°†ä¸Šé¢çš„ API æ¨¡å—åŠ ä¸Š Blink çš„ç‰¹å®šæ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªé€‚ç”¨äºå¤§å¤šæ•° Table \u0026amp; SQL API ç”¨ä¾‹çš„å‘è¡Œç‰ˆã€‚uber JAR æ–‡ä»¶ flink-table-blink-*.jar é»˜è®¤ä½äº Flink ç‰ˆæœ¬çš„ /lib ç›®å½•ä¸‹ã€‚  å…³äºå¦‚ä½•åœ¨è¡¨ç¨‹åºä¸­åˆ‡æ¢æ–°æ—§ Blink plannerï¼Œè¯·å‚è§é€šç”¨ API é¡µé¢ã€‚\nè¡¨ç¨‹åºä¾èµ– æ ¹æ®ç›®æ ‡ç¼–ç¨‹è¯­è¨€çš„ä¸åŒï¼Œæ‚¨éœ€è¦å°† Java æˆ– Scala API æ·»åŠ åˆ°é¡¹ç›®ä¸­ï¼Œä»¥ä¾¿ä½¿ç”¨ Table API å’Œ SQL æ¥å®šä¹‰ç®¡é“ã€‚\n\u0026lt;!-- Either... --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.flink\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flink-table-api-java-bridge_2.11\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.11.0\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- or... --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.flink\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flink-table-api-scala-bridge_2.11\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.11.0\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; æ­¤å¤–ï¼Œå¦‚æœä½ æƒ³åœ¨ IDE ä¸­æœ¬åœ°è¿è¡Œ Table API å’Œ SQL ç¨‹åºï¼Œä½ å¿…é¡»æ·»åŠ ä»¥ä¸‹ä¸€ç»„æ¨¡å—ï¼Œè¿™å–å†³äºä½ æƒ³ä½¿ç”¨çš„è®¡åˆ’å™¨ã€‚\n\u0026lt;!-- Either... (for the old planner that was available before Flink 1.9) --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.flink\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flink-table-planner_2.11\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.11.0\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;!-- or.. (for the new Blink planner) --\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.flink\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flink-table-planner-blink_2.11\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.11.0\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; åœ¨å†…éƒ¨ï¼Œè¡¨ç”Ÿæ€ç³»ç»Ÿçš„éƒ¨åˆ†å†…å®¹æ˜¯åœ¨ Scala ä¸­å®ç°çš„ã€‚å› æ­¤ï¼Œè¯·ç¡®ä¿ä¸ºæ‰¹å¤„ç†å’Œæµåº”ç”¨æ·»åŠ ä»¥ä¸‹ä¾èµ–å…³ç³»ã€‚\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.flink\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flink-streaming-scala_2.11\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.11.0\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; æ‰©å±•ä¾èµ–æ€§ å¦‚æœä½ æƒ³å®ç°ä¸ Kafka äº¤äº’çš„è‡ªå®šä¹‰æ ¼å¼æˆ–ä¸€ç»„ç”¨æˆ·å®šä¹‰çš„å‡½æ•°ï¼Œä¸‹é¢çš„ä¾èµ–å°±è¶³å¤Ÿäº†ï¼Œå¯ä»¥ç”¨äº SQL å®¢æˆ·ç«¯çš„ JAR æ–‡ä»¶ã€‚\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.flink\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flink-table-common\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.11.0\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; ç›®å‰ï¼Œè¯¥æ¨¡å—åŒ…æ‹¬ä»¥ä¸‹æ‰©å±•ç‚¹ï¼š\n SerializationSchemaFactory DeserializationSchemaFactory ScalarFunction TableFunction AggregateFunction  ä¸‹ä¸€æ­¥æ€ä¹ˆèµ°ï¼Ÿ  æ¦‚å¿µä¸é€šç”¨ API: Table API å’Œ SQL çš„å…±äº«æ¦‚å¿µå’Œ APIã€‚ æ•°æ®ç±»å‹: åˆ—å‡ºäº†é¢„å…ˆå®šä¹‰çš„æ•°æ®ç±»å‹åŠå…¶å±æ€§ã€‚ æµæ¦‚å¿µ: è¡¨ API æˆ– SQL çš„æµç‰¹å®šæ–‡æ¡£ï¼Œå¦‚æ—¶é—´å±æ€§çš„é…ç½®å’Œæ›´æ–°ç»“æœçš„å¤„ç†ã€‚ è¿æ¥åˆ°å¤–éƒ¨ç³»ç»Ÿ: å¯ç”¨çš„è¿æ¥å™¨å’Œæ ¼å¼ï¼Œç”¨äºå‘å¤–éƒ¨ç³»ç»Ÿè¯»å†™æ•°æ®ã€‚ Table APIã€‚æ”¯æŒçš„æ“ä½œå’Œè¡¨ API çš„ APIã€‚ SQLã€‚æ”¯æŒ SQL çš„æ“ä½œå’Œè¯­æ³•ã€‚ å†…ç½®å‡½æ•°: è¡¨ API å’Œ SQL ä¸­æ”¯æŒçš„å‡½æ•°ã€‚ SQL å®¢æˆ·ç«¯: ç©è½¬ Flink SQLï¼Œå¹¶å‘é›†ç¾¤æäº¤è¡¨æ ¼ç¨‹åºï¼Œæ— éœ€ç¼–ç¨‹çŸ¥è¯†ã€‚  åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-table-api-and-sql/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL"],"title":"Table API å’Œ SQL"},{"categories":["Flink"],"contents":"USE è¯­å¥ USE è¯­å¥ç”¨äºè®¾ç½®å½“å‰æ•°æ®åº“æˆ–ç›®å½•ã€‚\nè¿è¡Œ USE è¯­å¥ USE è¯­å¥å¯ä»¥é€šè¿‡ TableEnvironment çš„ executeSql() æ–¹æ³•æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨ SQL CLI ä¸­æ‰§è¡Œã€‚executeSql() æ–¹æ³•ä¼šå¯¹ä¸€ä¸ªæˆåŠŸçš„ USE æ“ä½œè¿”å› \u0026lsquo;OK\u0026rsquo;ï¼Œ å¦åˆ™ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚\nä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨ TableEnvironment å’Œ SQL CLI ä¸­è¿è¡Œä¸€æ¡ USE è¯­å¥ã€‚\nval env = StreamExecutionEnvironment.getExecutionEnvironment() val tEnv = StreamTableEnvironment.create(env) // create a catalog tEnv.executeSql(\u0026#34;CREATE CATALOG cat1 WITH (...)\u0026#34;) tEnv.executeSql(\u0026#34;SHOW CATALOGS\u0026#34;).print() // +-----------------+ // | catalog name | // +-----------------+ // | default_catalog | // | cat1 | // +-----------------+  // change default catalog tEnv.executeSql(\u0026#34;USE CATALOG cat1\u0026#34;) tEnv.executeSql(\u0026#34;SHOW DATABASES\u0026#34;).print() // databases are empty // +---------------+ // | database name | // +---------------+ // +---------------+  // create a database tEnv.executeSql(\u0026#34;CREATE DATABASE db1 WITH (...)\u0026#34;) tEnv.executeSql(\u0026#34;SHOW DATABASES\u0026#34;).print() // +---------------+ // | database name | // +---------------+ // | db1 | // +---------------+  // change default database tEnv.executeSql(\u0026#34;USE db1\u0026#34;) USE CATLOAG USECATALOGcatalog_nameè®¾ç½®å½“å‰ç›®å½•ã€‚æ‰€æœ‰æ²¡æœ‰æ˜ç¡®æŒ‡å®šç›®å½•çš„åç»­å‘½ä»¤å°†ä½¿ç”¨è¿™ä¸ªç›®å½•ã€‚å¦‚æœæ‰€æä¾›çš„ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚é»˜è®¤çš„å½“å‰ç›®å½•æ˜¯default_catalogã€‚\nUSE USE[catalog_name.]database_nameè®¾ç½®å½“å‰æ•°æ®åº“ã€‚æ‰€æœ‰æ²¡æœ‰æ˜ç¡®æŒ‡å®šæ•°æ®åº“çš„åç»­å‘½ä»¤å°†ä½¿ç”¨è¿™ä¸ªæ•°æ®åº“ã€‚å¦‚æœæä¾›çš„æ•°æ®åº“ä¸å­˜åœ¨ï¼Œåˆ™ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚é»˜è®¤çš„å½“å‰æ•°æ®åº“æ˜¯default_databaseã€‚\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/sql/use.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-use-statements/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL","SQL"],"title":"Use è¯­å¥"},{"categories":["Flink"],"contents":"æ—¶é—´è¡¨ æ—¶é—´è¡¨ä»£è¡¨äº†å¯¹å˜åŒ–è¡¨çš„ï¼ˆå‚æ•°åŒ–ï¼‰è§†å›¾çš„æ¦‚å¿µï¼Œè¯¥è§†å›¾è¿”å›ä¸€ä¸ªè¡¨åœ¨ç‰¹å®šæ—¶é—´ç‚¹çš„å†…å®¹ã€‚\nå˜åŒ–è¡¨å¯ä»¥æ˜¯è·Ÿè¸ªå˜åŒ–çš„å˜åŒ–å†å²è¡¨ï¼ˆå¦‚æ•°æ®åº“å˜åŒ–æ—¥å¿—ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯å°†å˜åŒ–å…·ä½“åŒ–çš„å˜åŒ–ç»´åº¦è¡¨ï¼ˆå¦‚æ•°æ®åº“è¡¨ï¼‰ã€‚\nå¯¹äºå˜åŒ–çš„å†å²è¡¨ï¼ŒFlink å¯ä»¥è·Ÿè¸ªå˜åŒ–ï¼Œå¹¶å…è®¸åœ¨æŸ¥è¯¢ä¸­çš„æŸä¸ªæ—¶é—´ç‚¹è®¿é—®è¡¨çš„å†…å®¹ã€‚åœ¨ Flink ä¸­ï¼Œè¿™ç§è¡¨ç”¨ Temporal Table Function æ¥è¡¨ç¤ºã€‚\nå¯¹äºå˜åŒ–çš„ç»´åº¦è¡¨ï¼ŒFlink å…è®¸åœ¨æŸ¥è¯¢å†…çš„å¤„ç†æ—¶é—´ç‚¹è®¿é—®è¡¨çš„å†…å®¹ã€‚åœ¨ Flink ä¸­ï¼Œè¿™ç§è¡¨æ˜¯ç”±ä¸€ä¸ª Temporal Table æ¥è¡¨ç¤ºçš„ã€‚\nåŠ¨æœº ä¸ä¸æ–­å˜åŒ–çš„å†å²è¡¨ç›¸å…³è” å‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹è¡¨æ ¼ RatesHistoryã€‚\nSELECT*FROMRatesHistory;rowtimecurrencyrate=====================09:00USDollar10209:00Euro11409:00Yen110:45Euro11611:15Euro11911:49Pounds108RatesHistory ä»£è¡¨äº†ä¸€ä¸ªä¸æ–­å¢é•¿çš„å¯¹æ—¥å…ƒï¼ˆæ±‡ç‡ä¸º 1ï¼‰çš„è´§å¸æ±‡ç‡é™„åŠ è¡¨ã€‚ä¾‹å¦‚ï¼Œä» 09:00 åˆ° 10:45ï¼Œæ¬§å…ƒå¯¹æ—¥å…ƒçš„æ±‡ç‡æ˜¯ 114ï¼Œä» 10:45 åˆ° 11:15 æ˜¯ 116ã€‚ä» 10:45 åˆ° 11:15 æ˜¯ 116ã€‚\nè€ƒè™‘åˆ°æˆ‘ä»¬å¸Œæœ›è¾“å‡º 10:58 æ—¶çš„æ‰€æœ‰å½“å‰æ±‡ç‡ï¼Œæˆ‘ä»¬å°†éœ€è¦ä»¥ä¸‹ SQL æŸ¥è¯¢æ¥è®¡ç®—ç»“æœè¡¨ã€‚\nSELECT*FROMRatesHistoryASrWHEREr.rowtime=(SELECTMAX(rowtime)FROMRatesHistoryASr2WHEREr2.currency=r.currencyANDr2.rowtime\u0026lt;=TIME\u0026#39;10:58\u0026#39;);ç›¸å…³å­æŸ¥è¯¢ç¡®å®šç›¸åº”è´§å¸çš„æœ€å¤§æ—¶é—´ä½äºæˆ–ç­‰äºæœŸæœ›æ—¶é—´ã€‚å¤–å±‚æŸ¥è¯¢åˆ—å‡ºå…·æœ‰æœ€å¤§æ—¶é—´æˆ³çš„æ±‡ç‡ã€‚\nä¸‹è¡¨æ˜¾ç¤ºäº†è¿™ç§è®¡ç®—çš„ç»“æœã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œ10:45 çš„æ¬§å…ƒæ›´æ–°è¢«è€ƒè™‘åœ¨å†…ï¼Œç„¶è€Œï¼Œ11:15 çš„æ¬§å…ƒæ›´æ–°å’Œæ–°è¾“å…¥çš„è‹±é•‘åœ¨ 10:58 çš„è¡¨æ ¼ä¸­æ²¡æœ‰è¢«è€ƒè™‘ã€‚\nrowtime currency rate ======= ======== ====== 09:00 US Dollar 102 09:00 Yen 1 10:45 Euro 116 Temporal Tables çš„æ¦‚å¿µæ—¨åœ¨ç®€åŒ–æ­¤ç±»æŸ¥è¯¢ï¼ŒåŠ å¿«å…¶æ‰§è¡Œé€Ÿåº¦ï¼Œå¹¶å‡å°‘ Flink çš„çŠ¶æ€ä½¿ç”¨ã€‚Temporal Table æ˜¯ä¸€ä¸ªå…³äº append-only è¡¨çš„å‚æ•°åŒ–è§†å›¾ï¼Œå®ƒå°† append-only è¡¨çš„è¡Œè§£é‡Šä¸ºè¡¨çš„ changelogï¼Œå¹¶æä¾›è¯¥è¡¨åœ¨ç‰¹å®šæ—¶é—´ç‚¹çš„ç‰ˆæœ¬ã€‚å°† append-only è¡¨è§£é‡Šä¸ºå˜æ›´æ—¥å¿—éœ€è¦æŒ‡å®šä¸€ä¸ªä¸»é”®å±æ€§å’Œä¸€ä¸ªæ—¶é—´æˆ³å±æ€§ã€‚ä¸»é”®å†³å®šå“ªäº›è¡Œä¼šè¢«è¦†ç›–ï¼Œæ—¶é—´æˆ³å†³å®šè¡Œçš„æœ‰æ•ˆæ—¶é—´ã€‚\nåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œcurrency æ˜¯ RatesHistory è¡¨çš„ä¸»é”®ï¼Œrowtime æ˜¯æ—¶é—´æˆ³å±æ€§ã€‚\nåœ¨ Flink ä¸­ï¼Œè¿™æ˜¯ç”±ä¸€ä¸ª Temporal Table Function æ¥è¡¨ç¤ºçš„ã€‚\nä¸å˜åŒ–çš„ç»´åº¦è¡¨ç›¸å…³è” å¦ä¸€æ–¹é¢ï¼Œæœ‰äº›ç”¨ä¾‹éœ€è¦åŠ å…¥ä¸€ä¸ªä¸æ–­å˜åŒ–çš„ç»´åº¦è¡¨ï¼Œè€Œè¿™ä¸ªè¡¨æ˜¯ä¸€ä¸ªå¤–éƒ¨æ•°æ®åº“è¡¨ã€‚\nè®©æˆ‘ä»¬å‡è®¾ LatestRates æ˜¯ä¸€å¼ è¡¨ï¼ˆä¾‹å¦‚å­˜å‚¨åœ¨ï¼‰ï¼Œå®ƒæ˜¯ä»¥æœ€æ–°çš„é€Ÿç‡æ¥ç‰©åŒ–çš„ã€‚LatestRates æ˜¯ç‰©åŒ–çš„å†å² RatesHistoryã€‚é‚£ä¹ˆ LatestRates è¡¨åœ¨æ—¶é—´ 10:58 æ—¶çš„å†…å®¹å°†æ˜¯ã€‚\n10:58\u0026gt;SELECT*FROMLatestRates;currencyrate==============USDollar102Yen1Euro11612:00 æ—¶ LatestRates è¡¨çš„å†…å®¹å°†æ˜¯ï¼š\n12:00\u0026gt;SELECT*FROMLatestRates;currencyrate==============USDollar102Yen1Euro119Pounds108åœ¨ Flink ä¸­ï¼Œè¿™ç”¨ä¸€ä¸ªæ—¶é—´è¡¨æ¥è¡¨ç¤ºã€‚\næ—¶é—´è¡¨å‡½æ•° ä¸ºäº†è®¿é—®æ—¶æ€è¡¨ä¸­çš„æ•°æ®ï¼Œå¿…é¡»ä¼ é€’ä¸€ä¸ªæ—¶é—´å±æ€§ï¼Œè¯¥å±æ€§å†³å®šäº†å°†è¿”å›çš„è¡¨çš„ç‰ˆæœ¬ã€‚Flink ä½¿ç”¨è¡¨å‡½æ•°çš„ SQL è¯­æ³•æ¥æä¾›ä¸€ç§è¡¨è¾¾æ–¹å¼ã€‚\nä¸€æ—¦å®šä¹‰å¥½ï¼Œä¸€ä¸ªæ—¶æ€è¡¨å‡½æ•°å°±ä¼šæ¥å—ä¸€ä¸ªå•ä¸€çš„æ—¶é—´å‚æ•° timeAttributeï¼Œå¹¶è¿”å›ä¸€ç»„è¡Œã€‚è¿™ä¸ªé›†åˆåŒ…å«äº†æ‰€æœ‰ç°æœ‰ä¸»é”®ç›¸å¯¹äºç»™å®šæ—¶é—´å±æ€§çš„æœ€æ–°ç‰ˆæœ¬çš„è¡Œã€‚\nå‡è®¾æˆ‘ä»¬åŸºäº RatesHistory è¡¨å®šä¹‰äº†ä¸€ä¸ªæ—¶æ€è¡¨å‡½æ•° Rates(timeAttribute)ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹å¼æŸ¥è¯¢è¿™æ ·çš„å‡½æ•°ã€‚\nSELECT*FROMRates(\u0026#39;10:15\u0026#39;);rowtimecurrencyrate=====================09:00USDollar10209:00Euro11409:00Yen1SELECT*FROMRates(\u0026#39;11:00\u0026#39;);rowtimecurrencyrate=====================09:00USDollar10210:45Euro11609:00Yen1æ¯æ¬¡æŸ¥è¯¢ Rates(timeAttribute) éƒ½ä¼šè¿”å›ç»™å®šæ—¶é—´å±æ€§çš„ Rates çš„çŠ¶æ€ã€‚\næ³¨æ„ï¼šç›®å‰ï¼ŒFlink ä¸æ”¯æŒç›´æ¥æŸ¥è¯¢å¸¦æœ‰æ’å®šæ—¶é—´å±æ€§å‚æ•°çš„æ—¶æ€è¡¨å‡½æ•°ã€‚ç›®å‰ï¼Œæ—¶æ€è¡¨å‡½æ•°åªèƒ½ç”¨äºè¿æ¥ã€‚ä¸Šé¢çš„ä¾‹å­æ˜¯ç”¨æ¥æä¾›å¯¹å‡½æ•° Rates(timeAttribute) è¿”å›å†…å®¹çš„ç›´è§‚è®¤è¯†ã€‚\nå…³äºå¦‚ä½•ä½¿ç”¨æ—¶æ€è¡¨è¿›è¡Œè”æ¥çš„æ›´å¤šä¿¡æ¯ï¼Œè¿˜è¯·å‚è§å…³äºè¿ç»­æŸ¥è¯¢çš„è¿æ¥é¡µé¢ã€‚\nå®šä¹‰æ—¶æ€è¡¨å‡½æ•° ä¸‹é¢çš„ä»£ç ç‰‡æ®µè¯´æ˜äº†å¦‚ä½•ä»ä¸€ä¸ªä»…æœ‰è¿½åŠ çš„è¡¨åˆ›å»ºä¸€ä¸ªæ—¶æ€è¡¨å‡½æ•°ã€‚\n// Get the stream and table environments. val env = StreamExecutionEnvironment.getExecutionEnvironment val tEnv = StreamTableEnvironment.create(env) // Provide a static data set of the rates history table. val ratesHistoryData = new mutable.MutableList[(String, Long)] ratesHistoryData.+=((\u0026#34;US Dollar\u0026#34;, 102L)) ratesHistoryData.+=((\u0026#34;Euro\u0026#34;, 114L)) ratesHistoryData.+=((\u0026#34;Yen\u0026#34;, 1L)) ratesHistoryData.+=((\u0026#34;Euro\u0026#34;, 116L)) ratesHistoryData.+=((\u0026#34;Euro\u0026#34;, 119L)) // Create and register an example table using above data set. // In the real setup, you should replace this with your own table. val ratesHistory = env .fromCollection(ratesHistoryData) .toTable(tEnv, \u0026#39;r_currency, \u0026#39;r_rate, \u0026#39;r_proctime.proctime) tEnv.createTemporaryView(\u0026#34;RatesHistory\u0026#34;, ratesHistory) // Create and register TemporalTableFunction. // Define \u0026#34;r_proctime\u0026#34; as the time attribute and \u0026#34;r_currency\u0026#34; as the primary key. val rates = ratesHistory.createTemporalTableFunction($\u0026#34;r_proctime\u0026#34;, $\u0026#34;r_currency\u0026#34;) // \u0026lt;==== (1) tEnv.registerFunction(\u0026#34;Rates\u0026#34;, rates) // \u0026lt;==== (2) ç¬¬(1)è¡Œåˆ›å»ºäº†ä¸€ä¸ª Rates æ—¶æ€è¡¨å‡½æ•°ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Table API ä¸­çš„å‡½æ•° Ratesã€‚\nç¬¬(2)è¡Œåœ¨æˆ‘ä»¬çš„è¡¨ç¯å¢ƒä¸­ä»¥ Rates çš„åä¹‰æ³¨å†Œè¿™ä¸ªå‡½æ•°ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨ SQL ä¸­ä½¿ç”¨ Rates å‡½æ•°ã€‚\næ—¶æ€è¡¨ æ³¨æ„: è¿™åªåœ¨ Blink planner ä¸­æ”¯æŒã€‚\nä¸ºäº†è®¿é—®æ—¶é—´è¡¨ä¸­çš„æ•°æ®ï¼Œç›®å‰å¿…é¡»å®šä¹‰ä¸€ä¸ª LookupableTableSource çš„ TableSourceã€‚Flink ä½¿ç”¨ SQL:2011 ä¸­æå‡ºçš„ SQL è¯­æ³• FOR SYSTEM_TIME AS OF æ¥æŸ¥è¯¢æ—¶é—´è¡¨ã€‚\nå‡è®¾æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸º LatestRates çš„æ—¶æ€è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„æ–¹å¼æŸ¥è¯¢è¿™æ ·çš„è¡¨ã€‚\nSELECT*FROMLatestRatesFORSYSTEM_TIMEASOFTIME\u0026#39;10:15\u0026#39;;currencyrate==============USDollar102Euro114Yen1SELECT*FROMLatestRatesFORSYSTEM_TIMEASOFTIME\u0026#39;11:00\u0026#39;;currencyrate==============USDollar102Euro116Yen1æ³¨æ„ï¼šç›®å‰ï¼ŒFlink ä¸æ”¯æŒç›´æ¥æŸ¥è¯¢æ—¶é—´æ’å®šçš„æ—¶æ€è¡¨ã€‚ç›®å‰ï¼Œæ—¶æ€è¡¨åªèƒ½ç”¨åœ¨ join ä¸­ã€‚ä¸Šé¢çš„ä¾‹å­æ˜¯ç”¨æ¥æä¾›ä¸€ä¸ªç›´è§‚çš„æ—¶é—´è¡¨ LatestRates è¿”å›çš„å†…å®¹ã€‚\næ›´å¤šå…³äºå¦‚ä½•ä½¿ç”¨æ—¶æ€è¡¨è¿›è¡Œè¿æ¥çš„ä¿¡æ¯ï¼Œè¯·å‚è§å…³äºè¿ç»­æŸ¥è¯¢çš„è¿æ¥é¡µé¢ã€‚\nå®šä¹‰æ—¶æ€è¡¨ // Get the stream and table environments. val env = StreamExecutionEnvironment.getExecutionEnvironment val settings = EnvironmentSettings.newInstance().build() val tEnv = StreamTableEnvironment.create(env, settings) // or val tEnv = TableEnvironment.create(settings)  // Define an HBase table with DDL, then we can use it as a temporal table in sql // Column \u0026#39;currency\u0026#39; is the rowKey in HBase table tEnv.executeSql( s\u0026#34;\u0026#34;\u0026#34; |CREATE TABLE LatestRates ( | currency STRING, | fam1 ROW\u0026lt;rate DOUBLE\u0026gt; |) WITH ( | \u0026#39;connector\u0026#39; = \u0026#39;hbase-1.4\u0026#39;, | \u0026#39;table-name\u0026#39; = \u0026#39;Rates\u0026#39;, | \u0026#39;zookeeper.quorum\u0026#39; = \u0026#39;localhost:2181\u0026#39; |) |\u0026#34;\u0026#34;\u0026#34;.stripMargin) ä¹Ÿè¯·å‚è§å¦‚ä½•å®šä¹‰ LookupableTableSource çš„é¡µé¢ã€‚\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/streaming/temporal_tables.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-temporal-tables/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL"],"title":"ä¸´æ—¶è¡¨"},{"categories":["Flink"],"contents":"Side Output é™¤äº† DataStream æ“ä½œäº§ç”Ÿçš„ä¸»æµ(main stream)å¤–ï¼Œè¿˜å¯ä»¥äº§ç”Ÿä»»æ„æ•°é‡çš„é™„åŠ ä¾§è¾“å‡ºç»“æœæµã€‚ç»“æœæµä¸­çš„æ•°æ®ç±»å‹ä¸å¿…ä¸ä¸»æµä¸­çš„æ•°æ®ç±»å‹ç›¸åŒ¹é…ï¼Œä¸åŒä¾§è¾“å‡ºçš„ç±»å‹ä¹Ÿå¯ä»¥ä¸åŒã€‚å½“æ‚¨è¦åˆ†å‰²æ•°æ®æµæ—¶ï¼Œè¿™ç§æ“ä½œéå¸¸æœ‰ç”¨ï¼Œé€šå¸¸æ‚¨å¿…é¡»å¤åˆ¶æ•°æ®æµï¼Œç„¶åä»æ¯ä¸ªæ•°æ®æµä¸­è¿‡æ»¤æ‰æ‚¨ä¸æƒ³è¦çš„æ•°æ®ã€‚\nåœ¨ä½¿ç”¨ä¾§è¾“å‡ºæ—¶ï¼Œé¦–å…ˆéœ€è¦å®šä¹‰ä¸€ä¸ª OutputTagï¼Œç”¨æ¥è¯†åˆ«ä¾§è¾“å‡ºæµã€‚\nval outputTag = OutputTag[String](\u0026#34;side-output\u0026#34;) è¯·æ³¨æ„ OutputTag æ˜¯å¦‚ä½•æ ¹æ®ä¾§è¾“å‡ºæµæ‰€åŒ…å«çš„å…ƒç´ ç±»å‹è¿›è¡Œç±»å‹åŒ–çš„ã€‚\nå¯ä»¥é€šè¿‡ä»¥ä¸‹å‡½æ•°å‘ä¾§è¾“å‡ºå‘é€æ•°æ®ã€‚\n ProcessFunction KeyedProcessFunction CoProcessFunction KeyedCoProcessFunction ProcessWindowFunction ProcessAllWindowFunction  ä½ å¯ä»¥ä½¿ç”¨ Context å‚æ•°ï¼ˆåœ¨ä¸Šé¢çš„å‡½æ•°ä¸­æš´éœ²ç»™ç”¨æˆ·ï¼‰å‘ä¸€ä¸ªç”± OutputTag æ ‡è¯†çš„ä¾§è¾“å‡ºå‘é€æ•°æ®ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä» ProcessFunction ä¸­å‘å°„ä¾§è¾“å‡ºæ•°æ®çš„ä¾‹å­ã€‚\nval input: DataStream[Int] = ... val outputTag = OutputTag[String](\u0026#34;side-output\u0026#34;) val mainDataStream = input .process(new ProcessFunction[Int, Int] { override def processElement( value: Int, ctx: ProcessFunction[Int, Int]#Context, out: Collector[Int]): Unit = { // emit data to regular output  out.collect(value) // emit data to side output  ctx.output(outputTag, \u0026#34;sideout-\u0026#34; + String.valueOf(value)) } }) ä¸ºäº†æ£€ç´¢ä¾§è¾“å‡ºæµï¼Œä½ å¯ä»¥åœ¨ DataStream æ“ä½œçš„ç»“æœä¸Šä½¿ç”¨ getSideOutput(OutputTag)ã€‚è¿™å°†ç»™ä½ ä¸€ä¸ª DataStreamï¼Œå®ƒçš„ç±»å‹æ˜¯ä¾§è¾“å‡ºæµçš„ç»“æœã€‚\nval outputTag = OutputTag[String](\u0026#34;side-output\u0026#34;) val mainDataStream = ... val sideOutputStream: DataStream[String] = mainDataStream.getSideOutput(outputTag) åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/stream/side_output.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-side-outputs/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataStream API","Side Outputs"],"title":"ä¾§è¾“å‡º"},{"categories":["Flink"],"contents":"å‡½æ•° Flink Table API \u0026amp; SQL ä½¿ç”¨æˆ·èƒ½å¤Ÿé€šè¿‡å‡½æ•°è¿›è¡Œæ•°æ®è½¬æ¢ã€‚\nå‡½æ•°çš„ç±»å‹ Flink ä¸­çš„å‡½æ•°æœ‰ä¸¤ä¸ªç»´åº¦æ¥åˆ†ç±»ã€‚\nä¸€ä¸ªç»´åº¦æ˜¯ç³»ç»Ÿï¼ˆæˆ–å†…ç½®ï¼‰å‡½æ•° v.s. ç›®å½•å‡½æ•°ã€‚ç³»ç»Ÿå‡½æ•°æ²¡æœ‰å‘½åç©ºé—´ï¼Œå¯ä»¥åªç”¨åå­—æ¥å¼•ç”¨ã€‚ç›®å½•å‡½æ•°å±äºç›®å½•å’Œæ•°æ®åº“ï¼Œå› æ­¤å®ƒä»¬æœ‰ç›®å½•å’Œæ•°æ®åº“çš„å‘½åç©ºé—´ï¼Œå®ƒä»¬å¯ä»¥ç”¨å®Œå…¨/éƒ¨åˆ†é™å®šåï¼ˆcatalog.db.func æˆ– db.funcï¼‰æˆ–è€…åªç”¨å‡½æ•°åæ¥å¼•ç”¨ã€‚\nå¦ä¸€ä¸ªç»´åº¦æ˜¯ä¸´æ—¶å‡½æ•° v.s. æŒä¹…åŒ–å‡½æ•°ã€‚ä¸´æ—¶å‡½æ•°æ˜¯ä¸ç¨³å®šçš„ï¼Œåªå­˜åœ¨äºä¸€ä¸ªä¼šè¯çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œå®ƒä»¬æ€»æ˜¯ç”±ç”¨æˆ·åˆ›å»ºçš„ã€‚è€ŒæŒä¹…æ€§å‡½æ•°åˆ™æ˜¯åœ¨ä¼šè¯çš„ç”Ÿå‘½å‘¨æœŸå†…å­˜åœ¨çš„ï¼Œå®ƒä»¬è¦ä¹ˆæ˜¯ç”±ç³»ç»Ÿæä¾›çš„ï¼Œè¦ä¹ˆæ˜¯åœ¨ç›®å½•ä¸­æŒä¹…å­˜åœ¨çš„ã€‚\nè¿™ä¸¤ä¸ªç»´åº¦ç»™ Flink ç”¨æˆ·æä¾›äº†4ç±»å‡½æ•°ã€‚\n ä¸´æ—¶ç³»ç»Ÿå‡½æ•° ç³»ç»Ÿå‡½æ•° ä¸´æ—¶ç›®å½•å‡½æ•° ç›®å½•å‡½æ•°  å¼•ç”¨å‡½æ•° åœ¨ Flink ä¸­ï¼Œç”¨æˆ·æœ‰ä¸¤ç§å¼•ç”¨å‡½æ•°çš„æ–¹å¼ - ç²¾ç¡®å¼•ç”¨å‡½æ•°æˆ–æ¨¡æ£±ä¸¤å¯çš„å¼•ç”¨å‡½æ•°ã€‚\nç²¾ç¡®çš„å‡½æ•°å¼•ç”¨ ç²¾ç¡®çš„å‡½æ•°å¼•ç”¨ä½¿ç”¨æˆ·èƒ½å¤Ÿä¸“é—¨ä½¿ç”¨ç›®å½•å‡½æ•°ï¼Œå¹¶ä¸”è·¨ç›®å½•å’Œè·¨æ•°æ®åº“ï¼Œä¾‹å¦‚ä» mytable ä¸­é€‰æ‹© mycatalog.mydb.myfunc(x)ï¼Œä» mytable ä¸­é€‰æ‹© mydb.myfunc(x)ã€‚\nè¿™åªä» Flink 1.10 å¼€å§‹æ”¯æŒã€‚\næ¨¡æ£±ä¸¤å¯çš„å‡½æ•°å¼•ç”¨ åœ¨æ¨¡æ£±ä¸¤å¯çš„å‡½æ•°å¼•ç”¨ä¸­ï¼Œç”¨æˆ·åªéœ€åœ¨ SQL æŸ¥è¯¢ä¸­æŒ‡å®šå‡½æ•°åç§°å³å¯ï¼Œä¾‹å¦‚ï¼šselect myfunc(x) from mytableã€‚\nå‡½æ•°è§£æé¡ºåº åªæœ‰å½“æœ‰ä¸åŒç±»å‹ä½†åç§°ç›¸åŒçš„å‡½æ•°æ—¶ï¼Œè§£æé¡ºåºæ‰æ˜¯é‡è¦çš„ï¼Œæ¯”å¦‚æœ‰ä¸‰ä¸ªå‡½æ•°éƒ½åä¸º \u0026ldquo;myfunc\u0026rdquo;ï¼Œä½†åˆ†åˆ«æ˜¯ä¸´æ—¶ç›®å½•ã€ç›®å½•å’Œç³»ç»Ÿå‡½æ•°ã€‚å¦‚æœæ²¡æœ‰å‡½æ•°åå†²çªï¼Œåˆ™å‡½æ•°å°†è¢«è§£æä¸ºå”¯ä¸€çš„ä¸€ä¸ªã€‚\nç²¾ç¡®çš„å‡½æ•°å¼•ç”¨ å› ä¸ºç³»ç»Ÿå‡½æ•°æ²¡æœ‰å‘½åç©ºé—´ï¼Œæ‰€ä»¥ Flink ä¸­çš„ç²¾ç¡®å‡½æ•°å¼•ç”¨å¿…é¡»æŒ‡å‘ä¸´æ—¶ç›®å½•å‡½æ•°æˆ–ç›®å½•å‡½æ•°ã€‚\nå…¶è§£æé¡ºåºæ˜¯ï¼š\n ä¸´æ—¶ç›®å½•å‡½æ•° ç›®å½•å‡½æ•°  å«ç³Šä¸æ¸…çš„å‡½æ•°å‚è€ƒ è§£æé¡ºåºæ˜¯:\n ä¸´æ—¶ç³»ç»Ÿå‡½æ•° ç³»ç»Ÿå‡½æ•° ä¸´æ—¶ç›®å½•å‡½æ•°ï¼Œåœ¨å½“å‰ç›®å½•å’Œå½“å‰æ•°æ®åº“ä¸­çš„ä¼šè¯ã€‚ ç›®å½•å‡½æ•°ï¼Œåœ¨å½“å‰ç›®å½•å’Œå½“å‰æ•°æ®åº“ä¸­çš„ä¼šè¯ã€‚  åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/functions/\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-functions/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL","Function"],"title":"å‡½æ•°"},{"categories":["Flink"],"contents":"åŠ¨æ€è¡¨ SQL å’Œå…³ç³»ä»£æ•°åœ¨è®¾è®¡æ—¶å¹¶æ²¡æœ‰è€ƒè™‘åˆ°æµæ•°æ®ã€‚å› æ­¤ï¼Œå…³ç³»ä»£æ•°ï¼ˆå’Œ SQLï¼‰å’Œæµå¤„ç†ä¹‹é—´å‡ ä¹æ²¡æœ‰æ¦‚å¿µä¸Šçš„å·®è·ã€‚\næœ¬é¡µè®¨è®ºäº†è¿™äº›å·®å¼‚ï¼Œå¹¶è§£é‡Šäº† Flink å¦‚ä½•åœ¨æ— ç•Œæ•°æ®ä¸Šå®ç°ä¸å¸¸è§„æ•°æ®åº“å¼•æ“åœ¨æœ‰ç•Œæ•°æ®ä¸Šç›¸åŒçš„è¯­ä¹‰ã€‚\næ•°æ®æµçš„å…³ç³»æŸ¥è¯¢ ä¸‹è¡¨æ¯”è¾ƒäº†ä¼ ç»Ÿçš„å…³ç³»ä»£æ•°å’Œæµå¤„ç†åœ¨è¾“å…¥æ•°æ®ã€æ‰§è¡Œå’Œè¾“å‡ºç»“æœæ–¹é¢çš„æƒ…å†µã€‚\n   å…³ç³»ä»£æ•°/SQL æµå¤„ç†     å…³ç³»ï¼ˆæˆ–è¡¨ï¼‰æ˜¯æœ‰ç•Œï¼ˆå¤šï¼‰å…ƒç»„çš„é›†åˆã€‚ æµæ˜¯ä¸€ä¸ªæ— é™çš„å…ƒç»„åºåˆ—ã€‚   åœ¨æ‰¹æ•°æ®ä¸Šæ‰§è¡Œçš„æŸ¥è¯¢ï¼ˆå¦‚å…³ç³»æ•°æ®åº“ä¸­çš„è¡¨ï¼‰å¯ä»¥è®¿é—®å®Œæ•´çš„è¾“å…¥æ•°æ®ã€‚ æµå¼æŸ¥è¯¢åœ¨å¯åŠ¨æ—¶ä¸èƒ½è®¿é—®æ‰€æœ‰çš„æ•°æ®ï¼Œå¿…é¡»\u0026quot;ç­‰å¾…\u0026quot;æ•°æ®æµè¿›æ¥ã€‚   æ‰¹é‡æŸ¥è¯¢åœ¨äº§ç”Ÿä¸€ä¸ªå›ºå®šå¤§å°çš„ç»“æœåå°±ä¼šç»ˆæ­¢ã€‚ æµå¼æŸ¥è¯¢æ ¹æ®æ¥æ”¶åˆ°çš„è®°å½•ä¸æ–­åœ°æ›´æ–°å…¶ç»“æœï¼Œå¹¶ä¸”æ°¸è¿œä¸ä¼šå®Œæˆã€‚    å°½ç®¡å­˜åœ¨è¿™äº›å·®å¼‚ï¼Œä½†ç”¨å…³ç³»æŸ¥è¯¢å’Œ SQL å¤„ç†æµå¹¶ä¸æ˜¯ä¸å¯èƒ½çš„ã€‚å…ˆè¿›çš„å…³ç³»æ•°æ®åº“ç³»ç»Ÿæä¾›äº†ä¸€ç§å«åšç‰©åŒ–è§†å›¾çš„åŠŸèƒ½ã€‚ç‰©åŒ–è§†å›¾è¢«å®šä¹‰ä¸ºä¸€ä¸ª SQL æŸ¥è¯¢ï¼Œå°±åƒä¸€ä¸ªæ™®é€šçš„è™šæ‹Ÿè§†å›¾ä¸€æ ·ã€‚ä¸è™šæ‹Ÿè§†å›¾ä¸åŒï¼Œç‰©åŒ–è§†å›¾ä¼šç¼“å­˜æŸ¥è¯¢çš„ç»“æœï¼Œè¿™æ ·åœ¨è®¿é—®è§†å›¾æ—¶å°±ä¸éœ€è¦å¯¹æŸ¥è¯¢è¿›è¡Œè¯„ä¼°ã€‚ç¼“å­˜çš„ä¸€ä¸ªå¸¸è§æŒ‘æˆ˜æ˜¯é˜²æ­¢ç¼“å­˜æä¾›è¿‡æ—¶çš„ç»“æœã€‚å½“å…¶å®šä¹‰æŸ¥è¯¢çš„åŸºè¡¨è¢«ä¿®æ”¹æ—¶ï¼Œä¸€ä¸ªç‰©åŒ–è§†å›¾å°±ä¼šè¿‡æ—¶ã€‚æ€¥åˆ‡çš„è§†å›¾ç»´æŠ¤æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œå®ƒå¯ä»¥åœ¨æ›´æ–°åŸºè¡¨æ—¶ç«‹å³æ›´æ–°ä¸€ä¸ªç‰©åŒ–è§†å›¾ã€‚\nå¦‚æœæˆ‘ä»¬è€ƒè™‘ä»¥ä¸‹å‡ ç‚¹ï¼Œæ€¥åˆ‡çš„è§†å›¾ç»´æŠ¤å’Œæµä¸Šçš„ SQL æŸ¥è¯¢ä¹‹é—´çš„è”ç³»å°±ä¼šå˜å¾—å¾ˆæ˜æ˜¾ã€‚\n æ•°æ®åº“è¡¨æ˜¯ä¸€ä¸ª INSERTã€UPDATE å’Œ DELETE DML è¯­å¥æµçš„ç»“æœï¼Œé€šå¸¸ç§°ä¸º changelog æµã€‚ ç‰©åŒ–è§†å›¾è¢«å®šä¹‰ä¸ºä¸€ä¸ª SQL æŸ¥è¯¢ã€‚ä¸ºäº†æ›´æ–°è§†å›¾ï¼ŒæŸ¥è¯¢ä¸æ–­å¤„ç†è§†å›¾çš„åŸºç¡€å…³ç³»çš„ changelog æµã€‚ ç‰©åŒ–è§†å›¾æ˜¯æµå¼ SQL æŸ¥è¯¢çš„ç»“æœã€‚  è€ƒè™‘åˆ°è¿™äº›è¦ç‚¹ï¼Œæˆ‘ä»¬åœ¨ä¸‹ä¸€èŠ‚ä»‹ç»ä»¥ä¸‹åŠ¨æ€è¡¨çš„æ¦‚å¿µã€‚\nåŠ¨æ€è¡¨ä¸è¿ç»­æŸ¥è¯¢ åŠ¨æ€è¡¨æ˜¯ Flink çš„è¡¨ API å’Œ SQL æ”¯æŒæµæ•°æ®çš„æ ¸å¿ƒæ¦‚å¿µã€‚ä¸ä»£è¡¨æ‰¹å¤„ç†æ•°æ®çš„é™æ€è¡¨ç›¸æ¯”ï¼ŒåŠ¨æ€è¡¨æ˜¯éšæ—¶é—´å˜åŒ–çš„ã€‚å®ƒä»¬å¯ä»¥åƒé™æ€æ‰¹å¤„ç†è¡¨ä¸€æ ·è¢«æŸ¥è¯¢ã€‚æŸ¥è¯¢åŠ¨æ€è¡¨ä¼šäº§ç”Ÿä¸€ä¸ªè¿ç»­æŸ¥è¯¢ã€‚ä¸€ä¸ªè¿ç»­æŸ¥è¯¢æ°¸è¿œä¸ä¼šç»ˆæ­¢ï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªåŠ¨æ€è¡¨ä½œä¸ºç»“æœã€‚æŸ¥è¯¢ä¸æ–­åœ°æ›´æ–°å®ƒçš„ï¼ˆåŠ¨æ€ï¼‰ç»“æœè¡¨ï¼Œä»¥åæ˜ å…¶ï¼ˆåŠ¨æ€ï¼‰è¾“å…¥è¡¨çš„å˜åŒ–ã€‚æœ¬è´¨ä¸Šï¼Œå¯¹åŠ¨æ€è¡¨çš„è¿ç»­æŸ¥è¯¢ä¸å®šä¹‰ç‰©åŒ–è§†å›¾çš„æŸ¥è¯¢éå¸¸ç›¸ä¼¼ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿ç»­æŸ¥è¯¢çš„ç»“æœåœ¨è¯­ä¹‰ä¸Šæ€»æ˜¯ç­‰åŒäºåœ¨è¾“å…¥è¡¨çš„å¿«ç…§ä¸Šä»¥æ‰¹å¤„ç†æ¨¡å¼æ‰§è¡Œç›¸åŒæŸ¥è¯¢çš„ç»“æœã€‚\nä¸‹å›¾ç›´è§‚åœ°å±•ç¤ºäº†æµã€åŠ¨æ€è¡¨å’Œè¿ç»­æŸ¥è¯¢çš„å…³ç³»ã€‚\n ä¸€ä¸ªæµè¢«è½¬æ¢ä¸ºä¸€ä¸ªåŠ¨æ€è¡¨ã€‚ å¯¹åŠ¨æ€è¡¨è¿›è¡Œè¿ç»­æŸ¥è¯¢ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„åŠ¨æ€è¡¨ã€‚ äº§ç”Ÿçš„åŠ¨æ€è¡¨åˆè¢«è½¬æ¢å›æµã€‚  æ³¨æ„ï¼šåŠ¨æ€è¡¨é¦–å…ˆæ˜¯ä¸€ä¸ªé€»è¾‘æ¦‚å¿µã€‚åŠ¨æ€è¡¨åœ¨æŸ¥è¯¢æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸ä¸€å®šï¼ˆå®Œå…¨ï¼‰å®ä½“åŒ–ã€‚\nåœ¨ä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†è§£é‡ŠåŠ¨æ€è¡¨å’Œè¿ç»­æŸ¥è¯¢çš„æ¦‚å¿µï¼Œå…¶ç‚¹å‡»äº‹ä»¶æµçš„æ¨¡å¼å¦‚ä¸‹ã€‚\n[ user: VARCHAR, // the name of the user cTime: TIMESTAMP, // the time when the URL was accessed url: VARCHAR // the URL that was accessed by the user ] åœ¨æµä¸Šå®šä¹‰ä¸€ä¸ªè¡¨ ä¸ºäº†ç”¨å…³ç³»æŸ¥è¯¢æ¥å¤„ç†ä¸€ä¸ªæµï¼Œå¿…é¡»æŠŠå®ƒè½¬æ¢æˆä¸€ä¸ªè¡¨ã€‚ä»æ¦‚å¿µä¸Šè®²ï¼Œæµçš„æ¯ä¸€æ¡è®°å½•éƒ½è¢«è§£é‡Šä¸ºå¯¹ç”Ÿæˆçš„è¡¨è¿›è¡Œ INSERT ä¿®æ”¹ã€‚ä»æœ¬è´¨ä¸Šè®²ï¼Œæˆ‘ä»¬æ˜¯ä»ä¸€ä¸ªä»…æœ‰ INSERT çš„ changelog æµå»ºç«‹ä¸€ä¸ªè¡¨ã€‚\nä¸‹å›¾ç›´è§‚åœ°å±•ç¤ºäº†ç‚¹å‡»äº‹ä»¶æµï¼ˆå·¦æ‰‹è¾¹ï¼‰æ˜¯å¦‚ä½•è½¬æ¢ä¸ºè¡¨ï¼ˆå³æ‰‹è¾¹ï¼‰çš„ã€‚éšç€æ›´å¤šçš„ç‚¹å‡»æµè®°å½•è¢«æ’å…¥ï¼Œç”Ÿæˆçš„è¡¨åœ¨ä¸æ–­å¢é•¿ã€‚\næ³¨æ„ï¼šä¸€ä¸ªå®šä¹‰åœ¨æµä¸Šçš„è¡¨åœ¨å†…éƒ¨æ˜¯ä¸è¢«å®ç°çš„ã€‚\nè¿ç»­æŸ¥è¯¢ è¿ç»­æŸ¥è¯¢æ˜¯åœ¨åŠ¨æ€è¡¨ä¸Šè¿›è¡Œè¯„ä¼°ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæ–°çš„åŠ¨æ€è¡¨ä½œä¸ºç»“æœã€‚ä¸æ‰¹å¤„ç†æŸ¥è¯¢ä¸åŒï¼Œè¿ç»­æŸ¥è¯¢æ°¸è¿œä¸ä¼šç»ˆæ­¢ï¼Œå¹¶æ ¹æ®è¾“å…¥è¡¨çš„æ›´æ–°æ›´æ–°å…¶ç»“æœè¡¨ã€‚åœ¨ä»»ä½•æ—¶é—´ç‚¹ä¸Šï¼Œè¿ç»­æŸ¥è¯¢çš„ç»“æœåœ¨è¯­ä¹‰ä¸Šç­‰åŒäºåœ¨è¾“å…¥è¡¨çš„å¿«ç…§ä¸Šä»¥æ‰¹å¤„ç†æ¨¡å¼æ‰§è¡Œç›¸åŒæŸ¥è¯¢çš„ç»“æœã€‚\nåœ¨ä¸‹é¢æˆ‘ä»¬å±•ç¤ºäº†åœ¨ç‚¹å‡»äº‹ä»¶æµä¸Šå®šä¹‰çš„ç‚¹å‡»è¡¨ä¸Šçš„ä¸¤ä¸ªæŸ¥è¯¢ç¤ºä¾‹ã€‚\nç¬¬ä¸€ä¸ªæŸ¥è¯¢æ˜¯ä¸€ä¸ªç®€å•çš„ GROUP-BY COUNT èšåˆæŸ¥è¯¢ã€‚å®ƒå¯¹ç”¨æˆ·å­—æ®µçš„ç‚¹å‡»è¡¨è¿›è¡Œåˆ†ç»„ï¼Œå¹¶ç»Ÿè®¡è®¿é—®çš„ URL æ•°é‡ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†å½“ç‚¹å‡»è¡¨æ›´æ–°äº†æ›´å¤šçš„è¡Œæ—¶ï¼ŒæŸ¥è¯¢æ˜¯å¦‚ä½•éšç€æ—¶é—´çš„æ¨ç§»è¿›è¡Œè¯„ä¼°çš„ã€‚\næŸ¥è¯¢å¼€å§‹æ—¶ï¼Œç‚¹å‡»è¡¨ï¼ˆå·¦ä¾§ï¼‰ä¸ºç©ºã€‚å½“ç¬¬ä¸€æ¡è®°å½•è¢«æ’å…¥åˆ° clicks è¡¨ä¸­æ—¶ï¼ŒæŸ¥è¯¢å¼€å§‹è®¡ç®—ç»“æœè¡¨ã€‚æ’å…¥ç¬¬ä¸€è¡Œ [Mary, ./home] åï¼Œç»“æœè¡¨ï¼ˆå³ä¾§ï¼Œé¡¶éƒ¨ï¼‰ç”±ä¸€æ¡è¡Œ [Mary, 1] ç»„æˆã€‚å½“ç¬¬äºŒæ¡è®°å½• [Bob, ./cart] æ’å…¥ç‚¹å‡»è¡¨åï¼ŒæŸ¥è¯¢æ›´æ–°ç»“æœè¡¨ï¼Œæ’å…¥ä¸€æ¡æ–°çš„è®°å½• [Bob, 1]ã€‚ç¬¬ä¸‰æ¡è®°å½• [Mary, ./prod?id=1] äº§ç”Ÿå¯¹å·²ç»è®¡ç®—å¥½çš„ç»“æœè¡Œçš„æ›´æ–°ï¼Œè¿™æ · [Mary, 1] å°±æ›´æ–°ä¸º [Mary, 2]ã€‚æœ€åï¼ŒæŸ¥è¯¢å°†ç¬¬ä¸‰æ¡è®°å½• [Lizï¼Œ1] æ’å…¥åˆ°ç»“æœè¡¨ä¸­ï¼Œè¿™æ—¶ç¬¬å››æ¡è®°å½•è¢«è¿½åŠ åˆ°ç‚¹å‡»è¡¨ä¸­ã€‚\nç¬¬äºŒä¸ªæŸ¥è¯¢ä¸ç¬¬ä¸€ä¸ªæŸ¥è¯¢ç±»ä¼¼ï¼Œä½†å°†ç‚¹å‡»è¡¨é™¤äº†ç”¨æˆ·å±æ€§ä¹Ÿåˆ†ç»„åœ¨ä¸€ä¸ªå°æ—¶æ»šåŠ¨çª—å£ä¸Šï¼Œç„¶åå†ç»Ÿè®¡ URL çš„æ•°é‡ï¼ˆçª—å£ç­‰åŸºäºæ—¶é—´çš„è®¡ç®—æ˜¯åŸºäºç‰¹æ®Šçš„æ—¶é—´å±æ€§ï¼Œåé¢ä¼šè®¨è®ºï¼‰ã€‚åŒæ ·ï¼Œå›¾ä¸­æ˜¾ç¤ºäº†ä¸åŒæ—¶é—´ç‚¹çš„è¾“å…¥å’Œè¾“å‡ºï¼Œä»¥ç›´è§‚åœ°æ˜¾ç¤ºåŠ¨æ€è¡¨çš„å˜åŒ–æ€§è´¨ã€‚\nå’Œä»¥å‰ä¸€æ ·ï¼Œè¾“å…¥è¡¨çš„ç‚¹å‡»ç‡åœ¨å·¦è¾¹æ˜¾ç¤ºã€‚æŸ¥è¯¢æ¯éš”ä¸€å°æ—¶æŒç»­è®¡ç®—ç»“æœå¹¶æ›´æ–°ç»“æœè¡¨ã€‚clicks è¡¨åŒ…å«å››æ¡è®°å½•ï¼Œæ—¶é—´æˆ³ï¼ˆcTimeï¼‰åœ¨ 12:00:00 å’Œ 12:59:59 ä¹‹é—´ã€‚æŸ¥è¯¢ä»è¿™ä¸ªè¾“å…¥ä¸­è®¡ç®—å‡ºä¸¤æ¡ç»“æœè¡Œï¼ˆæ¯ä¸ªç”¨æˆ·ä¸€æ¡ï¼‰ï¼Œå¹¶å°†å®ƒä»¬è¿½åŠ åˆ°ç»“æœè¡¨ä¸­ã€‚å¯¹äº 13:00:00 å’Œ 13:59:59 ä¹‹é—´çš„ä¸‹ä¸€ä¸ªçª—å£ï¼Œç‚¹å‡»è¡¨åŒ…å«ä¸‰æ¡è®°å½•ï¼Œç»“æœæ˜¯å¦å¤–ä¸¤æ¡è®°å½•è¢«è¿½åŠ åˆ°ç»“æœè¡¨ä¸­ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ›´å¤šçš„è¡Œè¢«è¿½åŠ åˆ°ç‚¹å‡»è¡¨ä¸­ï¼Œç»“æœè¡¨ä¼šè¢«æ›´æ–°ã€‚\næ›´æ–°å’Œè¿½åŠ æŸ¥è¯¢ è™½ç„¶è¿™ä¸¤ä¸ªä¾‹å­æŸ¥è¯¢çœ‹èµ·æ¥å¾ˆç›¸ä¼¼ï¼ˆéƒ½æ˜¯è®¡ç®—ä¸€ä¸ªåˆ†ç»„è®¡æ•°åˆè®¡ï¼‰ï¼Œä½†å®ƒä»¬åœ¨ä¸€ä¸ªé‡è¦æ–¹é¢æœ‰æ‰€ä¸åŒã€‚\n ç¬¬ä¸€ä¸ªæŸ¥è¯¢æ›´æ–°äº†ä¹‹å‰å‘å‡ºçš„ç»“æœï¼Œå³å®šä¹‰ç»“æœè¡¨çš„ changelog æµåŒ…å«äº† INSERT å’Œ UPDATE å˜åŒ–ã€‚ ç¬¬äºŒä¸ªæŸ¥è¯¢åªå¯¹ç»“æœè¡¨è¿›è¡Œè¿½åŠ ï¼Œå³ç»“æœè¡¨çš„ changelog æµåªåŒ…å« insert æ›´æ”¹ã€‚  æŸ¥è¯¢äº§ç”Ÿçš„æ˜¯åªè¿½åŠ è¡¨è¿˜æ˜¯æ›´æ–°è¡¨æœ‰ä¸€å®šçš„å½±å“ã€‚\n äº§ç”Ÿæ›´æ–°å˜åŒ–çš„æŸ¥è¯¢é€šå¸¸è¦ç»´æŠ¤æ›´å¤šçš„çŠ¶æ€ï¼ˆè§ä¸‹èŠ‚ï¼‰ã€‚ å°†ä»…æœ‰é™„å½•çš„è¡¨è½¬æ¢ä¸ºæµä¸æ›´æ–°è¡¨çš„è½¬æ¢æ˜¯ä¸åŒçš„ï¼ˆå‚è§è¡¨åˆ°æµçš„è½¬æ¢éƒ¨åˆ†ï¼‰ã€‚  æŸ¥è¯¢é™åˆ¶ è®¸å¤šï¼ˆä½†ä¸æ˜¯å…¨éƒ¨ï¼‰è¯­ä¹‰æœ‰æ•ˆçš„æŸ¥è¯¢å¯ä»¥ä½œä¸ºæµä¸Šçš„è¿ç»­æŸ¥è¯¢æ¥è¯„ä¼°ã€‚æœ‰äº›æŸ¥è¯¢çš„è®¡ç®—æˆæœ¬å¤ªé«˜ï¼Œè¦ä¹ˆæ˜¯ç”±äºå®ƒä»¬éœ€è¦ç»´æŠ¤çš„çŠ¶æ€å¤§å°ï¼Œè¦ä¹ˆæ˜¯ç”±äºè®¡ç®—æ›´æ–°å¤ªè´µã€‚\n çŠ¶æ€å¤§å°ã€‚è¿ç»­æŸ¥è¯¢æ˜¯åœ¨æ— è¾¹ç•Œçš„æµä¸Šè¿›è¡Œè¯„ä¼°çš„ï¼Œé€šå¸¸åº”è¯¥è¿è¡Œæ•°å‘¨æˆ–æ•°æœˆã€‚å› æ­¤ï¼Œä¸€ä¸ªè¿ç»­æŸ¥è¯¢å¤„ç†çš„æ•°æ®æ€»é‡å¯èƒ½éå¸¸å¤§ã€‚å¿…é¡»æ›´æ–°ä¹‹å‰å‘å‡ºçš„ç»“æœçš„æŸ¥è¯¢éœ€è¦ç»´æŠ¤æ‰€æœ‰å‘å‡ºçš„è¡Œï¼Œä»¥ä¾¿èƒ½å¤Ÿæ›´æ–°å®ƒä»¬ã€‚ä¾‹å¦‚ï¼Œç¬¬ä¸€ä¸ªç¤ºä¾‹æŸ¥è¯¢éœ€è¦å­˜å‚¨æ¯ä¸ªç”¨æˆ·çš„ URL è®¡æ•°ï¼Œä»¥ä¾¿èƒ½å¤Ÿå¢åŠ è®¡æ•°ï¼Œå¹¶åœ¨è¾“å…¥è¡¨æ”¶åˆ°æ–°è¡Œæ—¶å‘å‡ºæ–°ç»“æœã€‚å¦‚æœåªè·Ÿè¸ªæ³¨å†Œç”¨æˆ·ï¼Œéœ€è¦ç»´æŠ¤çš„è®¡æ•°æ•°é‡å¯èƒ½ä¸ä¼šå¤ªé«˜ã€‚ä½†æ˜¯ï¼Œå¦‚æœéæ³¨å†Œç”¨æˆ·è¢«åˆ†é…äº†ä¸€ä¸ªå”¯ä¸€çš„ç”¨æˆ·åï¼Œé‚£ä¹ˆéœ€è¦ç»´æŠ¤çš„æ¬¡æ•°ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œå¢åŠ ï¼Œæœ€ç»ˆå¯èƒ½ä¼šå¯¼è‡´æŸ¥è¯¢å¤±è´¥ã€‚  SELECTuser,COUNT(url)FROMclicksGROUPBYuser; è®¡ç®—æ›´æ–°ã€‚æœ‰äº›æŸ¥è¯¢éœ€è¦é‡æ–°è®¡ç®—å’Œæ›´æ–°å¤§éƒ¨åˆ†å‘å‡ºçš„ç»“æœè¡Œï¼Œå³ä½¿åªå¢åŠ æˆ–æ›´æ–°ä¸€æ¡è¾“å…¥è®°å½•ã€‚æ˜¾ç„¶ï¼Œè¿™ç§æŸ¥è¯¢å¹¶ä¸é€‚åˆä½œä¸ºè¿ç»­æŸ¥è¯¢æ¥æ‰§è¡Œã€‚ä¸€ä¸ªä¾‹å­æ˜¯ä¸‹é¢çš„æŸ¥è¯¢ï¼Œå®ƒæ ¹æ®æœ€åä¸€æ¬¡ç‚¹å‡»çš„æ—¶é—´ä¸ºæ¯ä¸ªç”¨æˆ·è®¡ç®—ä¸€ä¸ª rankã€‚åªè¦ç‚¹å‡»è¡¨æ”¶åˆ°ä¸€æ¡æ–°çš„è®°å½•ï¼Œè¯¥ç”¨æˆ·çš„ lastAction å°±ä¼šè¢«æ›´æ–°ï¼Œå¿…é¡»è®¡ç®—æ–°çš„ rankã€‚ä½†æ˜¯ç”±äºä¸¤è¡Œä¸èƒ½æœ‰ç›¸åŒçš„ rankï¼Œæ‰€ä»¥æ‰€æœ‰æ’åè¾ƒä½çš„è¡Œä¹Ÿéœ€è¦æ›´æ–°ã€‚  SELECTuser,RANK()OVER(ORDERBYlastLogin)FROM(SELECTuser,MAX(cTime)ASlastActionFROMclicksGROUPBYuser);æŸ¥è¯¢é…ç½®é¡µé¢è®¨è®ºäº†æ§åˆ¶è¿ç»­æŸ¥è¯¢æ‰§è¡Œçš„å‚æ•°ã€‚æœ‰äº›å‚æ•°å¯ç”¨äºä»¥ç»´æŠ¤çŠ¶æ€çš„å¤§å°æ¥æ¢å–ç»“æœçš„å‡†ç¡®æ€§ã€‚\nè¡¨åˆ°æµçš„è½¬æ¢ åŠ¨æ€è¡¨å¯ä»¥åƒæ™®é€šçš„æ•°æ®åº“è¡¨ä¸€æ ·ï¼Œé€šè¿‡ INSERTã€UPDATE å’Œ DELETE çš„ä¿®æ”¹ä¸æ–­åœ°è¿›è¡Œä¿®æ”¹ã€‚å®ƒå¯èƒ½æ˜¯ä¸€å¼ åªæœ‰ä¸€è¡Œçš„è¡¨ï¼Œä¸æ–­åœ°æ›´æ–°ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€å¼ åªæœ‰æ’å…¥çš„è¡¨ï¼Œæ²¡æœ‰ UPDATE å’Œ DELETE çš„ä¿®æ”¹ï¼Œæˆ–è€…æ˜¯ä»‹äºä¸¤è€…ä¹‹é—´çš„ä»»ä½•è¡¨ã€‚\nå½“æŠŠåŠ¨æ€è¡¨è½¬æ¢ä¸ºæµæˆ–å†™å…¥å¤–éƒ¨ç³»ç»Ÿæ—¶ï¼Œéœ€è¦å¯¹è¿™äº›å˜åŒ–è¿›è¡Œç¼–ç ã€‚Flink çš„è¡¨ API å’Œ SQL æ”¯æŒä¸‰ç§æ–¹å¼æ¥ç¼–ç åŠ¨æ€è¡¨çš„å˜åŒ–ã€‚\n  åªæ·»åŠ æµã€‚ä¸€ä¸ªåªè¢« INSERT ä¿®æ”¹çš„åŠ¨æ€è¡¨ï¼Œå¯ä»¥é€šè¿‡å‘å‡ºæ’å…¥çš„è¡Œæ¥è½¬æ¢æˆæµã€‚\n  æ’¤å›æµã€‚ç¼©å›æµæ˜¯æŒ‡æœ‰ä¸¤ç§æ¶ˆæ¯çš„æµï¼Œå³æ·»åŠ æ¶ˆæ¯å’Œç¼©å›æ¶ˆæ¯ã€‚é€šè¿‡å°† INSERT å˜æ›´ç¼–ç ä¸ºæ·»åŠ æ¶ˆæ¯ï¼Œå°† DELETE å˜æ›´ç¼–ç ä¸ºå›æ’¤æ¶ˆæ¯ï¼Œå°† UPDATE å˜æ›´ç¼–ç ä¸ºæ›´æ–°ï¼ˆä¸Šä¸€æ¡ï¼‰è¡Œçš„å›æ’¤æ¶ˆæ¯å’Œæ›´æ–°ï¼ˆæ–°ä¸€æ¡ï¼‰è¡Œçš„æ·»åŠ æ¶ˆæ¯ï¼Œå°±å¯ä»¥å°†ä¸€å¼ åŠ¨æ€è¡¨è½¬æ¢ä¸ºå›æ’¤æµã€‚ä¸‹å›¾ç›´è§‚åœ°å±•ç¤ºäº†åŠ¨æ€è¡¨è½¬æ¢ä¸ºå›æ’¤æµçš„è¿‡ç¨‹ã€‚\n   Upsert æµã€‚Upsert æµæ˜¯ä¸€ä¸ªæœ‰ä¸¤ç§æ¶ˆæ¯ç±»å‹çš„æµï¼Œå³ upsert æ¶ˆæ¯å’Œåˆ é™¤æ¶ˆæ¯ã€‚ä¸€ä¸ªåŠ¨æ€è¡¨è¢«è½¬æ¢ä¸º upsert æµéœ€è¦ä¸€ä¸ªï¼ˆå¯èƒ½æ˜¯å¤åˆçš„ï¼‰å”¯ä¸€é”®ã€‚é€šè¿‡å°† INSERT å’Œ UPDATE æ›´æ”¹ç¼–ç ä¸º upsert æ¶ˆæ¯ï¼Œå°† DELETE æ›´æ”¹ç¼–ç ä¸º delete æ¶ˆæ¯ï¼Œå°†å…·æœ‰å”¯ä¸€é”®çš„åŠ¨æ€è¡¨è½¬æ¢ä¸ºæµã€‚æ¶ˆè€—æµçš„æ“ä½œè€…éœ€è¦çŸ¥é“å”¯ä¸€é”®å±æ€§ï¼Œä»¥ä¾¿æ­£ç¡®åº”ç”¨æ¶ˆæ¯ã€‚ä¸ retract æµçš„ä¸»è¦åŒºåˆ«åœ¨äº update å˜æ›´ç”¨ä¸€æ¡æ¶ˆæ¯è¿›è¡Œç¼–ç ï¼Œå› æ­¤æ•ˆç‡æ›´é«˜ã€‚ä¸‹å›¾ç›´è§‚åœ°å±•ç¤ºäº†åŠ¨æ€è¡¨è½¬æ¢ä¸º update æµçš„è¿‡ç¨‹ã€‚  å°†åŠ¨æ€è¡¨è½¬æ¢ä¸º DataStream çš„ API åœ¨é€šç”¨æ¦‚å¿µé¡µé¢ä¸Šè®¨è®ºã€‚è¯·æ³¨æ„ï¼Œåœ¨å°†åŠ¨æ€è¡¨è½¬æ¢ä¸º DataStream æ—¶ï¼Œåªæ”¯æŒè¿½åŠ å’Œæ”¶å›æµã€‚åœ¨ TableSources å’Œ TableSinks é¡µé¢ä¸Šè®¨è®ºäº†å°†åŠ¨æ€è¡¨å‘å°„åˆ°å¤–éƒ¨ç³»ç»Ÿçš„ TableSink æ¥å£ã€‚\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/streaming/dynamic_tables.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-dynamic-tables/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL"],"title":"åŠ¨æ€è¡¨"},{"categories":["Flink"],"contents":"æ³¨æ„ï¼šå¯æŸ¥è¯¢çŠ¶æ€çš„å®¢æˆ·ç«¯ API ç›®å‰å¤„äºä¸æ–­å‘å±•çš„çŠ¶æ€ï¼Œå¯¹æ‰€æä¾›æ¥å£çš„ç¨³å®šæ€§ä¸åšä¿è¯ã€‚åœ¨å³å°†åˆ°æ¥çš„ Flink ç‰ˆæœ¬ä¸­ï¼Œå®¢æˆ·ç«¯çš„ API å¾ˆå¯èƒ½ä¼šæœ‰çªç ´æ€§çš„å˜åŒ–ã€‚\nç®€è€Œè¨€ä¹‹ï¼Œè¿™ä¸ªåŠŸèƒ½å°† Flink çš„ managed keyed (partitioned) stateï¼ˆå‚è§ Working with Stateï¼‰æš´éœ²ç»™å¤–ç•Œï¼Œå¹¶å…è®¸ç”¨æˆ·ä» Flink å¤–éƒ¨æŸ¥è¯¢ä½œä¸šçš„çŠ¶æ€ã€‚å¯¹äºæŸäº›åœºæ™¯æ¥è¯´ï¼Œå¯æŸ¥è¯¢çŠ¶æ€æ¶ˆé™¤äº†ä¸å¤–éƒ¨ç³»ç»Ÿï¼ˆå¦‚é”®å€¼å­˜å‚¨ï¼‰è¿›è¡Œåˆ†å¸ƒå¼æ“ä½œ/äº¤æ˜“çš„éœ€æ±‚ï¼Œè€Œè¿™å¾€å¾€æ˜¯å®è·µä¸­çš„ç“¶é¢ˆã€‚æ­¤å¤–ï¼Œè¯¥åŠŸèƒ½å¯¹äºè°ƒè¯•ç›®çš„å¯èƒ½ç‰¹åˆ«æœ‰ç”¨ã€‚\næ³¨æ„äº‹é¡¹: å½“æŸ¥è¯¢ä¸€ä¸ªçŠ¶æ€å¯¹è±¡æ—¶ï¼Œè¯¥å¯¹è±¡æ˜¯åœ¨æ²¡æœ‰ä»»ä½•åŒæ­¥æˆ–å¤åˆ¶çš„æƒ…å†µä¸‹ä»ä¸€ä¸ªå¹¶å‘çº¿ç¨‹è®¿é—®çš„ã€‚è¿™æ˜¯ä¸€ä¸ªè®¾è®¡ä¸Šçš„é€‰æ‹©ï¼Œå› ä¸ºä¸Šè¿°ä»»ä½•ä¸€ç§æƒ…å†µéƒ½ä¼šå¯¼è‡´ä½œä¸šå»¶è¿Ÿçš„å¢åŠ ï¼Œè¿™æ˜¯æˆ‘ä»¬æƒ³è¦é¿å…çš„ã€‚å› ä¸ºä»»ä½•ä½¿ç”¨ Java å †ç©ºé—´çš„çŠ¶æ€åç«¯ï¼Œå¦‚ MemoryStateBackend æˆ– FsStateBackendï¼Œåœ¨æ£€ç´¢å€¼æ—¶éƒ½ä¸ä¼šä½¿ç”¨å‰¯æœ¬ï¼Œè€Œæ˜¯ç›´æ¥å¼•ç”¨å­˜å‚¨çš„å€¼ï¼Œæ‰€ä»¥è¯»-ä¿®æ”¹-å†™æ¨¡å¼æ˜¯ä¸å®‰å…¨çš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´å¯æŸ¥è¯¢çŠ¶æ€æœåŠ¡å™¨å› å¹¶å‘ä¿®æ”¹è€Œå¤±è´¥ã€‚RocksDBStateBackend åˆ™å¯ä»¥é¿å…è¿™äº›é—®é¢˜ã€‚\næ¶æ„ åœ¨å±•ç¤ºå¦‚ä½•ä½¿ç”¨å¯æŸ¥è¯¢çŠ¶æ€ä¹‹å‰ï¼Œå…ˆç®€å•ä»‹ç»ä¸€ä¸‹æ„æˆå®ƒçš„å®ä½“ã€‚Queryable State åŠŸèƒ½ç”±ä¸‰ä¸ªä¸»è¦å®ä½“ç»„æˆã€‚\n QueryableStateClientï¼Œå®ƒï¼ˆå¯èƒ½ï¼‰è¿è¡Œåœ¨ Flink é›†ç¾¤ä¹‹å¤–ï¼Œå¹¶æäº¤ç”¨æˆ·æŸ¥è¯¢ã€‚ QueryableStateClientProxyï¼Œå®ƒè¿è¡Œåœ¨æ¯ä¸ª TaskManager ä¸Šï¼ˆå³ Flink é›†ç¾¤å†…éƒ¨ï¼‰ï¼Œè´Ÿè´£æ¥æ”¶å®¢æˆ·ç«¯çš„æŸ¥è¯¢ï¼Œä»£è¡¨ä»–ä»è´Ÿè´£çš„ TaskManager ä¸­è·å–æ‰€è¯·æ±‚çš„çŠ¶æ€ï¼Œå¹¶å°†å…¶è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œä»¥åŠ QueryableStateServerï¼Œå®ƒè¿è¡Œåœ¨æ¯ä¸ª TaskManager ä¸Šï¼Œè´Ÿè´£ä¸ºæœ¬åœ°å­˜å‚¨çš„çŠ¶æ€æä¾›æœåŠ¡ã€‚  å®¢æˆ·ç«¯è¿æ¥åˆ°å…¶ä¸­ä¸€ä¸ªä»£ç†ï¼Œå¹¶å‘é€ä¸€ä¸ªä¸ç‰¹å®šé”® k ç›¸å…³è”çš„çŠ¶æ€çš„è¯·æ±‚ã€‚æ­£å¦‚åœ¨ä½¿ç”¨çŠ¶æ€ä¸­æ‰€è¿°ï¼Œkeyed state è¢«ç»„ç»‡åœ¨é”®ç»„(Key Groups)ä¸­ï¼Œæ¯ä¸ª TaskManager éƒ½è¢«åˆ†é…äº†ä¸€äº›è¿™æ ·çš„é”®ç»„(Key Groups)ã€‚ä¸ºäº†å‘ç°å“ªä¸ª TaskManager è´Ÿè´£æŒæœ‰ k çš„é”®ç»„ï¼Œä»£ç†å°†è¯¢é—® JobManagerã€‚æ ¹æ®ç­”æ¡ˆï¼Œä»£ç†å°†æŸ¥è¯¢è¿è¡Œåœ¨è¯¥ TaskManager ä¸Šçš„ QueryableStateServerï¼Œä»¥è·å–ä¸ k ç›¸å…³è”çš„çŠ¶æ€ï¼Œå¹¶å°†å“åº”è½¬å‘åˆ°å®¢æˆ·ç«¯ã€‚\næ¿€æ´»å¯æŸ¥è¯¢çŠ¶æ€ è¦åœ¨ Flink é›†ç¾¤ä¸Šå¯ç”¨å¯æŸ¥è¯¢çŠ¶æ€ï¼Œä½ éœ€è¦åšä»¥ä¸‹å·¥ä½œã€‚\n å°† flink-queryable-state-runtime_2.11-1.11.0.jar ä» Flink å‘è¡Œç‰ˆçš„ opt/ æ–‡ä»¶å¤¹ä¸­å¤åˆ¶åˆ° lib/ æ–‡ä»¶å¤¹ä¸­ã€‚ è®¾ç½®å±æ€§ queryable-state.enable ä¸º trueã€‚è¯·å‚é˜…é…ç½®æ–‡æ¡£äº†è§£è¯¦æƒ…å’Œé™„åŠ å‚æ•°ã€‚  è¦éªŒè¯æ‚¨çš„ç¾¤é›†æ˜¯å¦åœ¨å¯ç”¨å¯æŸ¥è¯¢çŠ¶æ€åè¿è¡Œï¼Œè¯·æ£€æŸ¥ä»»ä½• TaskManager çš„æ—¥å¿—ä¸­çš„è¡Œã€‚\u0026ldquo;Started the Queryable State Proxy Server @ \u0026hellip;\u0026quot;ã€‚\nä½¿çŠ¶æ€å¯æŸ¥è¯¢ ç°åœ¨ä½ å·²ç»åœ¨é›†ç¾¤ä¸Šæ¿€æ´»äº†å¯æŸ¥è¯¢çŠ¶æ€ï¼Œç°åœ¨æ˜¯æ—¶å€™çœ‹çœ‹å¦‚ä½•ä½¿ç”¨å®ƒäº†ã€‚ä¸ºäº†ä½¿ä¸€ä¸ªçŠ¶æ€å¯¹å¤–ç•Œå¯è§ï¼Œå®ƒéœ€è¦é€šè¿‡ä½¿ç”¨ä»¥ä¸‹æ–¹å¼æ˜ç¡®åœ°æˆä¸ºå¯æŸ¥è¯¢çŠ¶æ€ã€‚\n QueryableStateStream, ä¸€ä¸ªæ–¹ä¾¿çš„å¯¹è±¡ï¼Œå®ƒä½œä¸ºä¸€ä¸ªæ¥æ”¶å™¨(sink)ï¼Œå¹¶æŠŠå®ƒçš„ä¼ å…¥å€¼ä½œä¸ºå¯æŸ¥è¯¢çš„çŠ¶æ€æä¾›ï¼Œæˆ–è€…æ˜¯ stateDescriptor.setQueryable(String queryableStateName) æ–¹æ³•ï¼Œä½¿å¾—çŠ¶æ€æè¿°ç¬¦æ‰€ä»£è¡¨çš„ keyed stateï¼Œå¯ä»¥æŸ¥è¯¢ã€‚  ä¸‹é¢çš„ç« èŠ‚å°†è§£é‡Šè¿™ä¸¤ç§æ–¹æ³•çš„ä½¿ç”¨ã€‚\nå¯æŸ¥è¯¢çš„çŠ¶æ€æµ åœ¨ KeyedStream ä¸Šè°ƒç”¨ .asQueryableState(stateName, stateDescriptor) ä¼šè¿”å›ä¸€ä¸ª QueryableStateStreamï¼Œå®ƒå°†å…¶å€¼ä½œä¸ºå¯æŸ¥è¯¢çŠ¶æ€æä¾›ã€‚æ ¹æ®çŠ¶æ€çš„ç±»å‹ï¼ŒasQueryableState() æ–¹æ³•æœ‰ä»¥ä¸‹å‡ ç§å˜ä½“ã€‚\n// ValueState QueryableStateStream asQueryableState( String queryableStateName, ValueStateDescriptor stateDescriptor) // Shortcut for explicit ValueStateDescriptor variant QueryableStateStream asQueryableState(String queryableStateName) // FoldingState QueryableStateStream asQueryableState( String queryableStateName, FoldingStateDescriptor stateDescriptor) // ReducingState QueryableStateStream asQueryableState( String queryableStateName, ReducingStateDescriptor stateDescriptor) æ³¨æ„ï¼šæ²¡æœ‰å¯æŸ¥è¯¢çš„ ListState æ¥æ”¶å™¨ï¼Œå› ä¸ºè¿™ä¼šå¯¼è‡´ä¸€ä¸ªä¸æ–­å¢é•¿çš„åˆ—è¡¨ï¼Œå¯èƒ½æ— æ³•æ¸…ç†ï¼Œå› æ­¤æœ€ç»ˆä¼šæ¶ˆè€—è¿‡å¤šçš„å†…å­˜ã€‚\nè¿”å›çš„ QueryableStateStream å¯ä»¥è¢«çœ‹ä½œæ˜¯ä¸€ä¸ªæ¥æ”¶å™¨(sink)ï¼Œä¸èƒ½è¢«è¿›ä¸€æ­¥è½¬æ¢ã€‚åœ¨å†…éƒ¨ï¼Œä¸€ä¸ª QueryableStateStream ä¼šè¢«ç¿»è¯‘æˆä¸€ä¸ªæ“ä½œç¬¦ï¼Œå®ƒä½¿ç”¨æ‰€æœ‰ä¼ å…¥çš„è®°å½•æ¥æ›´æ–°å¯æŸ¥è¯¢çŠ¶æ€å®ä¾‹ã€‚æ›´æ–°é€»è¾‘æ˜¯ç”± asQueryableState è°ƒç”¨ä¸­æä¾›çš„ StateDescriptor çš„ç±»å‹æš—ç¤ºçš„ã€‚åœ¨åƒä¸‹é¢è¿™æ ·çš„ç¨‹åºä¸­ï¼Œkeyed stream çš„æ‰€æœ‰è®°å½•å°†é€šè¿‡ ValueState.update(value) æ¥æ›´æ–°çŠ¶æ€å®ä¾‹:\nstream.keyBy(0).asQueryableState(\u0026#34;query-name\u0026#34;) è¿™å°±åƒ Scala API çš„ flatMapWithState ä¸€æ ·ã€‚\nç®¡ç†çš„ Keyed State é€šè¿‡ StateDescriptor.setQueryable(String queryableStateName) ä½¿ç›¸åº”çš„çŠ¶æ€æè¿°ç¬¦æˆä¸ºå¯æŸ¥è¯¢çš„çŠ¶æ€ï¼Œå¯ä»¥ä½¿æ“ä½œç¬¦çš„æ‰˜ç®¡é”®æ§çŠ¶æ€(å‚è§ä½¿ç”¨ Managed Keyed State))æˆä¸ºå¯æŸ¥è¯¢çš„çŠ¶æ€ï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­ã€‚\nValueStateDescriptor\u0026lt;Tuple2\u0026lt;Long, Long\u0026gt;\u0026gt; descriptor = new ValueStateDescriptor\u0026lt;\u0026gt;( \u0026#34;average\u0026#34;, // the state name  TypeInformation.of(new TypeHint\u0026lt;Tuple2\u0026lt;Long, Long\u0026gt;\u0026gt;() {})); // type information  descriptor.setQueryable(\u0026#34;query-name\u0026#34;); // queryable state name æ³¨æ„ï¼šqueryableStateName å‚æ•°å¯ä»¥ä»»æ„é€‰æ‹©ï¼Œå¹¶ä¸”åªç”¨äºæŸ¥è¯¢ã€‚å®ƒä¸ä¸€å®šè¦ä¸çŠ¶æ€æœ¬èº«çš„åç§°ç›¸åŒã€‚\nè¿™ä¸ªå˜ä½“å¯¹äºå“ªç§ç±»å‹çš„çŠ¶æ€å¯ä»¥è¢«æŸ¥è¯¢æ²¡æœ‰é™åˆ¶ã€‚è¿™æ„å‘³ç€å®ƒå¯ä»¥ç”¨äºä»»ä½• ValueStateã€ReduceStateã€ListStateã€MapStateã€AggregatingState ä»¥åŠç›®å‰å·²è¢«åºŸå¼ƒçš„ FoldingStateã€‚\næŸ¥è¯¢çŠ¶æ€ åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä½ å·²ç»è®¾ç½®äº†ä½ çš„é›†ç¾¤ä»¥å¯æŸ¥è¯¢çš„çŠ¶æ€è¿è¡Œï¼Œå¹¶ä¸”ä½ å·²ç»å°†ä½ çš„ï¼ˆéƒ¨åˆ†ï¼‰çŠ¶æ€å£°æ˜ä¸ºå¯æŸ¥è¯¢ã€‚ç°åœ¨æ˜¯æ—¶å€™çœ‹çœ‹å¦‚ä½•æŸ¥è¯¢è¿™ä¸ªçŠ¶æ€äº†ã€‚\nä¸ºæ­¤ï¼Œä½ å¯ä»¥ä½¿ç”¨ QueryableStateClient è¾…åŠ©ç±»ã€‚å®ƒå¯ä»¥åœ¨ flink-queryable-state-client jar ä¸­æ‰¾åˆ°ï¼Œå®ƒå¿…é¡»å’Œ flink-core ä¸€èµ·è¢«æ˜¾å¼åœ°åŒ…å«åœ¨é¡¹ç›®çš„ pom.xml ä¸­ä½œä¸ºä¾èµ–ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.flink\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flink-core\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.11.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.flink\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flink-queryable-state-client-java\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.11.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; æ›´å¤šçš„å†…å®¹ï¼Œå¯ä»¥æŸ¥çœ‹å¦‚ä½•è®¾ç½® Flink ç¨‹åºã€‚\nQueryableStateClient ä¼šå°†ä½ çš„æŸ¥è¯¢æäº¤ç»™å†…éƒ¨ä»£ç†ï¼Œç„¶åä»£ç†ä¼šå¤„ç†ä½ çš„æŸ¥è¯¢å¹¶è¿”å›æœ€ç»ˆç»“æœã€‚åˆå§‹åŒ–å®¢æˆ·ç«¯çš„å”¯ä¸€è¦æ±‚æ˜¯æä¾›ä¸€ä¸ªæœ‰æ•ˆçš„ TaskManager ä¸»æœºåï¼ˆè®°ä½æ¯ä¸ª TaskManager ä¸Šéƒ½æœ‰ä¸€ä¸ªå¯æŸ¥è¯¢çŠ¶æ€ä»£ç†è¿è¡Œï¼‰å’Œä»£ç†ç›‘å¬çš„ç«¯å£ã€‚æ›´å¤šå…³äºå¦‚ä½•é…ç½®ä»£ç†å’ŒçŠ¶æ€æœåŠ¡å™¨ç«¯å£çš„ä¿¡æ¯è¯·å‚è§é…ç½®éƒ¨åˆ†ã€‚\nQueryableStateClient client = new QueryableStateClient(tmHostname, proxyPort) å®¢æˆ·ç«¯å‡†å¤‡å¥½åï¼Œè¦æŸ¥è¯¢ä¸€ä¸ªç±»å‹ä¸º V çš„çŠ¶æ€ï¼Œä¸ç±»å‹ä¸º K çš„é”®ç›¸å…³è”ï¼Œå¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³•ã€‚\nCompletableFuture\u0026lt;S\u0026gt; getKvState( JobID jobId, String queryableStateName, K key, TypeInformation\u0026lt;K\u0026gt; keyTypeInfo, StateDescriptor\u0026lt;S, V\u0026gt; stateDescriptor) ä»¥ä¸Šè¿”å›ä¸€ä¸ª CompletableFutureï¼Œæœ€ç»ˆæŒæœ‰ ID ä¸º jobID çš„ä½œä¸šçš„ queryableStateName æ‰€æ ‡è¯†çš„å¯æŸ¥è¯¢çŠ¶æ€å®ä¾‹çš„çŠ¶æ€å€¼ã€‚key æ˜¯ä½ å¯¹å…¶çŠ¶æ€æ„Ÿå…´è¶£çš„é”®ï¼ŒkeyTypeInfo å°†å‘Šè¯‰ Flink å¦‚ä½•åºåˆ—åŒ–/è§£åºåˆ—åŒ–å®ƒã€‚æœ€åï¼ŒstateDescriptor åŒ…å«äº†å…³äºæ‰€è¯·æ±‚çš„çŠ¶æ€çš„å¿…è¦ä¿¡æ¯ï¼Œå³å®ƒçš„ç±»å‹ï¼ˆValueã€Reduce ç­‰ï¼‰å’Œå¦‚ä½•åºåˆ—åŒ–/è§£åºåˆ—åŒ–å®ƒçš„å¿…è¦ä¿¡æ¯ã€‚\nç»†å¿ƒçš„è¯»è€…ä¼šæ³¨æ„åˆ°ï¼Œè¿”å›çš„ future åŒ…å«ä¸€ä¸ª S ç±»å‹çš„å€¼ï¼Œå³ä¸€ä¸ªåŒ…å«å®é™…å€¼çš„ State å¯¹è±¡ã€‚è¿™å¯ä»¥æ˜¯ Flink æ”¯æŒçš„ä»»ä½•ä¸€ç§çŠ¶æ€ç±»å‹ã€‚ValueStateï¼ŒReduceStateï¼ŒListStateï¼ŒMapStateï¼ŒAggregatingStateï¼Œä»¥åŠç›®å‰å·²ç»åºŸå¼ƒçš„ FoldingStateã€‚\næ³¨æ„ï¼šè¿™äº›çŠ¶æ€å¯¹è±¡ä¸å…è®¸å¯¹åŒ…å«çš„çŠ¶æ€è¿›è¡Œä¿®æ”¹ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥è·å–çŠ¶æ€çš„å®é™…å€¼ï¼Œä¾‹å¦‚ä½¿ç”¨ valueState.get()ï¼Œæˆ–è€…è¿­ä»£åŒ…å«çš„ \u0026lt;Kï¼ŒV\u0026gt; æ¡ç›®ï¼Œä¾‹å¦‚ä½¿ç”¨ mapState.entry()ï¼Œä½†æ‚¨ä¸èƒ½ä¿®æ”¹å®ƒä»¬ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨è¿”å›çš„åˆ—è¡¨çŠ¶æ€ä¸Šè°ƒç”¨ add() æ–¹æ³•ä¼šæŠ›å‡ºä¸€ä¸ª UnsupportedOperationExceptionã€‚\næ³¨æ„ï¼šå®¢æˆ·ç«¯æ˜¯å¼‚æ­¥çš„ï¼Œå¯ä»¥è¢«å¤šä¸ªçº¿ç¨‹å…±äº«ã€‚åœ¨æœªä½¿ç”¨æ—¶éœ€è¦é€šè¿‡ QueryableStateClient.shutdown() æ¥å…³é—­å®ƒï¼Œä»¥é‡Šæ”¾èµ„æºã€‚\nä¾‹å­ ä¸‹é¢çš„ä¾‹å­æ‰©å±•äº† CountWindowAverage çš„ä¾‹å­(è¯·çœ‹ä½¿ç”¨ Managed Keyed State)ï¼Œä½¿å…¶å¯æŸ¥è¯¢ï¼Œå¹¶å±•ç¤ºäº†å¦‚ä½•æŸ¥è¯¢è¿™ä¸ªå€¼ã€‚\npublic class CountWindowAverage extends RichFlatMapFunction\u0026lt;Tuple2\u0026lt;Long, Long\u0026gt;, Tuple2\u0026lt;Long, Long\u0026gt;\u0026gt; { private transient ValueState\u0026lt;Tuple2\u0026lt;Long, Long\u0026gt;\u0026gt; sum; // a tuple containing the count and the sum  @Override public void flatMap(Tuple2\u0026lt;Long, Long\u0026gt; input, Collector\u0026lt;Tuple2\u0026lt;Long, Long\u0026gt;\u0026gt; out) throws Exception { Tuple2\u0026lt;Long, Long\u0026gt; currentSum = sum.value(); currentSum.f0 += 1; currentSum.f1 += input.f1; sum.update(currentSum); if (currentSum.f0 \u0026gt;= 2) { out.collect(new Tuple2\u0026lt;\u0026gt;(input.f0, currentSum.f1 / currentSum.f0)); sum.clear(); } } @Override public void open(Configuration config) { ValueStateDescriptor\u0026lt;Tuple2\u0026lt;Long, Long\u0026gt;\u0026gt; descriptor = new ValueStateDescriptor\u0026lt;\u0026gt;( \u0026#34;average\u0026#34;, // the state name  TypeInformation.of(new TypeHint\u0026lt;Tuple2\u0026lt;Long, Long\u0026gt;\u0026gt;() {})); // type information  descriptor.setQueryable(\u0026#34;query-name\u0026#34;); sum = getRuntimeContext().getState(descriptor); } } Once used in a job, you can retrieve the job ID and then query any keyâ€™s current state from this operator: QueryableStateClient client = new QueryableStateClient(tmHostname, proxyPort); // the state descriptor of the state to be fetched. ValueStateDescriptor\u0026lt;Tuple2\u0026lt;Long, Long\u0026gt;\u0026gt; descriptor = new ValueStateDescriptor\u0026lt;\u0026gt;( \u0026#34;average\u0026#34;, TypeInformation.of(new TypeHint\u0026lt;Tuple2\u0026lt;Long, Long\u0026gt;\u0026gt;() {})); CompletableFuture\u0026lt;ValueState\u0026lt;Tuple2\u0026lt;Long, Long\u0026gt;\u0026gt;\u0026gt; resultFuture = client.getKvState(jobId, \u0026#34;query-name\u0026#34;, key, BasicTypeInfo.LONG_TYPE_INFO, descriptor); // now handle the returned value resultFuture.thenAccept(response -\u0026gt; { try { Tuple2\u0026lt;Long, Long\u0026gt; res = response.get(); } catch (Exception e) { e.printStackTrace(); } }); é…ç½® ä»¥ä¸‹é…ç½®å‚æ•°ä¼šå½±å“å¯æŸ¥è¯¢çŠ¶æ€æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯çš„è¡Œä¸ºï¼Œå®ƒä»¬è¢«å®šä¹‰åœ¨ QueryableStateOptions ä¸­ã€‚\nçŠ¶æ€æœåŠ¡å™¨  queryable-state.server.portsï¼šå¯æŸ¥è¯¢çŠ¶æ€æœåŠ¡å™¨çš„æœåŠ¡å™¨ç«¯å£èŒƒå›´ã€‚å¦‚æœåœ¨åŒä¸€å°æœºå™¨ä¸Šè¿è¡Œå¤šä¸ª task managerï¼Œè¿™å¯¹é¿å…ç«¯å£å†²çªå¾ˆæœ‰ç”¨ã€‚æŒ‡å®šçš„èŒƒå›´å¯ä»¥æ˜¯ï¼šä¸€ä¸ªç«¯å£: \u0026ldquo;9123\u0026rdquo;ï¼Œä¸€ä¸ªç«¯å£èŒƒå›´: \u0026ldquo;50100-50200\u0026rdquo;ï¼Œæˆ–è€…ä¸€ä¸ªèŒƒå›´å’Œæˆ–ç‚¹çš„åˆ—è¡¨: \u0026ldquo;50100-50200,50300-50400,51234\u0026rdquo;ã€‚é»˜è®¤ç«¯å£ä¸º 9067ã€‚ queryable-state.server.network-threads: æ¥æ”¶çŠ¶æ€æœåŠ¡å™¨ä¼ å…¥è¯·æ±‚çš„ç½‘ç»œï¼ˆäº‹ä»¶å¾ªç¯ï¼‰çº¿ç¨‹æ•°ï¼ˆ0 =\u0026gt; #slotsï¼‰ã€‚ queryable-state.server.query-threads: ä¸ºçŠ¶æ€æœåŠ¡å™¨å¤„ç†/æœåŠ¡ä¼ å…¥è¯·æ±‚çš„çº¿ç¨‹æ•°ï¼ˆ0 =\u0026gt; #slotsï¼‰ã€‚  ä»£ç†  queryable-state.proxy.portsï¼šå¯æŸ¥è¯¢çŠ¶æ€ä»£ç†æœåŠ¡å™¨çš„ç«¯å£èŒƒå›´ã€‚å¦‚æœåœ¨åŒä¸€å°æœºå™¨ä¸Šè¿è¡Œå¤šä¸ª task managerï¼Œè¿™å¯¹é¿å…ç«¯å£å†²çªå¾ˆæœ‰ç”¨ã€‚æŒ‡å®šçš„èŒƒå›´å¯ä»¥æ˜¯ï¼šä¸€ä¸ªç«¯å£: \u0026ldquo;9123\u0026rdquo;ï¼Œä¸€ä¸ªç«¯å£èŒƒå›´: \u0026ldquo;50100-50200\u0026rdquo;ï¼Œæˆ–è€…ä¸€ä¸ªèŒƒå›´å’Œæˆ–ç‚¹çš„åˆ—è¡¨: \u0026ldquo;50100-50200,50300-50400,51234\u0026rdquo;ã€‚é»˜è®¤ç«¯å£ä¸º 9069ã€‚ queryable-state.proxy.network-threadsï¼šä¸ºå®¢æˆ·ç«¯ä»£ç†æ¥æ”¶ä¼ å…¥è¯·æ±‚çš„ç½‘ç»œï¼ˆäº‹ä»¶å¾ªç¯ï¼‰çº¿ç¨‹æ•°ï¼ˆ0 =\u0026gt; #slotsï¼‰ã€‚ queryable-state.proxy.query-threadsï¼šä¸ºå®¢æˆ·ç«¯ä»£ç†å¤„ç†/æœåŠ¡ä¼ å…¥è¯·æ±‚çš„çº¿ç¨‹æ•°ï¼ˆ0 =\u0026gt; #slotsï¼‰ã€‚  é™åˆ¶æ¡ä»¶  å¯æŸ¥è¯¢çŠ¶æ€çš„ç”Ÿå‘½å‘¨æœŸä¸ä»»åŠ¡çš„ç”Ÿå‘½å‘¨æœŸç»‘å®šï¼Œä¾‹å¦‚ï¼Œä»»åŠ¡åœ¨å¯åŠ¨æ—¶æ³¨å†Œå¯æŸ¥è¯¢çŠ¶æ€ï¼Œåœ¨å¤„ç½®æ—¶å–æ¶ˆæ³¨å†Œã€‚åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›å°†å…¶è§£è€¦ï¼Œä»¥ä¾¿åœ¨ä»»åŠ¡å®Œæˆåå…è®¸æŸ¥è¯¢ï¼Œå¹¶é€šè¿‡çŠ¶æ€å¤åˆ¶åŠ å¿«æ¢å¤é€Ÿåº¦ã€‚ å…³äºå¯ç”¨ KvState çš„é€šçŸ¥æ˜¯é€šè¿‡ä¸€ä¸ªç®€å•çš„å‘Šè¯‰å‘ç”Ÿçš„ã€‚å°†æ¥åº”è¯¥æ”¹è¿›è¿™ä¸ªåŠŸèƒ½ï¼Œä½¿å…¶æ›´åŠ å¼ºå¤§ï¼ŒåŒ…æ‹¬è¯¢é—®å’Œç¡®è®¤ã€‚ æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¼šè·Ÿè¸ªæŸ¥è¯¢çš„ç»Ÿè®¡æ•°æ®ã€‚ç›®å‰é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›æ•°æ®æ˜¯è¢«ç¦ç”¨çš„ï¼Œå› ä¸ºå®ƒä»¬ä¸ä¼šæš´éœ²åœ¨ä»»ä½•åœ°æ–¹ã€‚ä¸€æ—¦æœ‰æ›´å¥½çš„æ”¯æŒé€šè¿‡ Metrics ç³»ç»Ÿå‘å¸ƒè¿™äº›æ•°å­—ï¼Œæˆ‘ä»¬åº”è¯¥å¯ç”¨ç»Ÿè®¡ã€‚  åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/stream/state/queryable_state.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-21-queryable-state-beta/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataStream API"],"title":"å¯æŸ¥è¯¢çŠ¶æ€"},{"categories":["Flink"],"contents":"å¤„ç†åº”ç”¨ç¨‹åºå‚æ•° å‡ ä¹æ‰€æœ‰çš„ Flink åº”ç”¨ï¼ŒåŒ…æ‹¬æ‰¹å¤„ç†å’Œæµå¼åº”ç”¨ï¼Œéƒ½ä¾èµ–äºå¤–éƒ¨é…ç½®å‚æ•°ï¼Œå®ƒä»¬ç”¨äºæŒ‡å®šè¾“å…¥å’Œè¾“å‡ºæºï¼ˆå¦‚è·¯å¾„æˆ–åœ°å€ï¼‰ã€ç³»ç»Ÿå‚æ•°ï¼ˆå¹¶è¡Œæ€§ã€è¿è¡Œæ—¶é…ç½®ï¼‰å’Œåº”ç”¨ç‰¹å®šå‚æ•°ï¼ˆé€šå¸¸åœ¨ç”¨æˆ·å‡½æ•°ä¸­ä½¿ç”¨ï¼‰ã€‚å®ƒä»¬ç”¨äºæŒ‡å®šè¾“å…¥å’Œè¾“å‡ºæºï¼ˆå¦‚è·¯å¾„æˆ–åœ°å€ï¼‰ã€ç³»ç»Ÿå‚æ•°ï¼ˆå¹¶è¡Œæ€§ã€è¿è¡Œæ—¶é…ç½®ï¼‰å’Œåº”ç”¨ç¨‹åºç‰¹å®šå‚æ•°ï¼ˆé€šå¸¸åœ¨ç”¨æˆ·å‡½æ•°ä¸­ä½¿ç”¨ï¼‰ã€‚\nFlink æä¾›äº†ä¸€ä¸ªåä¸º ParameterTool çš„ç®€å•å·¥å…·ï¼Œä¸ºè§£å†³è¿™äº›é—®é¢˜æä¾›ä¸€äº›åŸºæœ¬çš„å·¥å…·ã€‚è¯·æ³¨æ„ï¼Œä½ ä¸ä¸€å®šè¦ä½¿ç”¨è¿™é‡Œæè¿°çš„ ParameterToolã€‚å…¶ä»–æ¡†æ¶å¦‚ Commons CLIå’Œargparse4j ä¹Ÿèƒ½å¾ˆå¥½åœ°ä¸ Flink ä¸€èµ·å·¥ä½œã€‚\nå°†ä½ çš„é…ç½®å€¼å¯¼å…¥ ParameterTool ä¹‹ä¸­\nParameterTool æä¾›äº†ä¸€ç»„é¢„å®šä¹‰çš„é™æ€æ–¹æ³•æ¥è¯»å–é…ç½®ã€‚è¯¥å·¥å…·å†…éƒ¨æœŸå¾…çš„æ˜¯ä¸€ä¸ª Map\u0026lt;Stringï¼ŒString\u0026gt;ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“å°†å…¶ä¸è‡ªå·±çš„é…ç½®é£æ ¼æ•´åˆåœ¨ä¸€èµ·ã€‚\nä» .properties æ–‡ä»¶ä¸­\nä¸‹é¢çš„æ–¹æ³•å°†è¯»å–ä¸€ä¸ªå±æ€§æ–‡ä»¶å¹¶æä¾›é”®/å€¼å¯¹ã€‚\nString propertiesFilePath = \u0026#34;/home/sam/flink/myjob.properties\u0026#34;; ParameterTool parameter = ParameterTool.fromPropertiesFile(propertiesFilePath); File propertiesFile = new File(propertiesFilePath); ParameterTool parameter = ParameterTool.fromPropertiesFile(propertiesFile); InputStream propertiesFileInputStream = new FileInputStream(file); ParameterTool parameter = ParameterTool.fromPropertiesFile(propertiesFileInputStream); ä»å‘½ä»¤è¡Œå‚æ•°æ¥çœ‹\nè¿™å°±å…è®¸ä»å‘½ä»¤è¡Œä¸­è·å– --input hdfs://mydata --elements 42 è¿™æ ·çš„å‚æ•°ã€‚\npublic static void main(String[] args) { ParameterTool parameter = ParameterTool.fromArgs(args); // .. regular code .. ä»ç³»ç»Ÿå±æ€§\nå½“å¯åŠ¨ JVM æ—¶ï¼Œä½ å¯ä»¥å°†ç³»ç»Ÿå±æ€§ä¼ é€’ç»™å®ƒã€‚-Dinput=hdfs://mydataã€‚ä½ ä¹Ÿå¯ä»¥ä»è¿™äº›ç³»ç»Ÿå±æ€§ä¸­åˆå§‹åŒ– ParameterToolã€‚\nParameterTool parameter = ParameterTool.fromSystemProperties(); åœ¨ Flink ç¨‹åºä¸­ä½¿ç”¨å‚æ•°\nç°åœ¨æˆ‘ä»¬å·²ç»ä»æŸä¸ªåœ°æ–¹å¾—åˆ°äº†å‚æ•°ï¼ˆè§ä¸Šæ–‡ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥å„ç§æ–¹å¼ä½¿ç”¨å®ƒä»¬ã€‚\nç›´æ¥ä» ParameterTool ä¸­ä½¿ç”¨\nParameterTool æœ¬èº«æœ‰è®¿é—®å€¼çš„æ–¹æ³•ã€‚\nParameterTool parameters = // ... parameter.getRequired(\u0026#34;input\u0026#34;); parameter.get(\u0026#34;output\u0026#34;, \u0026#34;myDefaultValue\u0026#34;); parameter.getLong(\u0026#34;expectedCount\u0026#34;, -1L); parameter.getNumberOfParameters() // .. there are more methods available. ä½ å¯ä»¥åœ¨å®¢æˆ·ç«¯æäº¤åº”ç”¨ç¨‹åºçš„ main() æ–¹æ³•ä¸­ç›´æ¥ä½¿ç”¨è¿™äº›æ–¹æ³•çš„è¿”å›å€¼ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥è¿™æ ·è®¾ç½®ä¸€ä¸ªæ“ä½œç¬¦çš„å¹¶è¡Œæ€§ã€‚\nParameterTool parameters = ParameterTool.fromArgs(args); int parallelism = parameters.get(\u0026#34;mapParallelism\u0026#34;, 2); DataSet\u0026lt;Tuple2\u0026lt;String, Integer\u0026gt;\u0026gt; counts = text.flatMap(new Tokenizer()).setParallelism(parallelism); ç”±äº ParameterTool æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œæ‰€ä»¥ä½ å¯ä»¥æŠŠå®ƒä¼ é€’ç»™å‡½æ•°æœ¬èº«ã€‚\nParameterTool parameters = ParameterTool.fromArgs(args); DataSet\u0026lt;Tuple2\u0026lt;String, Integer\u0026gt;\u0026gt; counts = text.flatMap(new Tokenizer(parameters)); ç„¶ååœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨å®ƒä»å‘½ä»¤è¡Œè·å–å€¼ã€‚\nå…¨å±€æ³¨å†Œå‚æ•°\nåœ¨ ExecutionConfig ä¸­æ³¨å†Œä¸ºå…¨å±€ä½œä¸šå‚æ•°çš„å‚æ•°å¯ä»¥ä½œä¸ºé…ç½®å€¼ä» JobManager Web ç•Œé¢å’Œç”¨æˆ·å®šä¹‰çš„æ‰€æœ‰åŠŸèƒ½ä¸­è®¿é—®ã€‚\nå…¨å±€æ³¨å†Œå‚æ•°ã€‚\nParameterTool parameters = ParameterTool.fromArgs(args); // set up the execution environment final ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment(); env.getConfig().setGlobalJobParameters(parameters); åœ¨ä»»ä½•ä¸°å¯Œçš„ç”¨æˆ·åŠŸèƒ½ä¸­è®¿é—®å®ƒä»¬ã€‚\npublic static final class Tokenizer extends RichFlatMapFunction\u0026lt;String, Tuple2\u0026lt;String, Integer\u0026gt;\u0026gt; { @Override public void flatMap(String value, Collector\u0026lt;Tuple2\u0026lt;String, Integer\u0026gt;\u0026gt; out) { ParameterTool parameters = (ParameterTool) getRuntimeContext().getExecutionConfig().getGlobalJobParameters(); parameters.getRequired(\u0026#34;input\u0026#34;); // .. do more .. åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/application_parameters.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-handling-application-parameters/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataStream API","Parameters"],"title":"å¤„ç†åº”ç”¨ç¨‹åºå‚æ•°"},{"categories":["Flink"],"contents":"å®éªŒç‰¹æ€§ æœ¬èŠ‚ä»‹ç» DataStream API ä¸­çš„å®éªŒæ€§åŠŸèƒ½ã€‚å®éªŒæ€§åŠŸèƒ½ä»åœ¨ä¸æ–­å‘å±•ï¼Œå¯èƒ½æ˜¯ä¸ç¨³å®šçš„ã€ä¸å®Œæ•´çš„ï¼Œæˆ–è€…åœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­ä¼šæœ‰å¾ˆå¤§çš„å˜åŒ–ã€‚\nå°†é¢„å…ˆåˆ†å‰²çš„æ•°æ®æµé‡æ–°è§£é‡Šä¸º keyed æµ æˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªé¢„åˆ†åŒºçš„æ•°æ®æµé‡æ–°è§£é‡Šä¸ºä¸€ä¸ª keyed æµï¼Œä»¥é¿å…æ´—ç‰Œã€‚\nè­¦å‘Šï¼šé‡æ–°è§£é‡Šçš„æ•°æ®æµå¿…é¡»å·²ç»è¢«é¢„åˆ†åŒºäº†ï¼Œå…¶æ–¹å¼ä¸ Flink çš„ keyBy åœ¨æ´—ç‰Œä¸­å¯¹æ•°æ®çš„åˆ†åŒºæ–¹å¼å®Œå…¨ç›¸åŒï¼Œå³é”®ç»„åˆ†é…ã€‚\nä¸€ä¸ªç”¨ä¾‹æ˜¯ä¸¤ä¸ªä½œä¸šä¹‹é—´çš„ç‰©åŒ–æ´—ç‰Œï¼šç¬¬ä¸€ä¸ªä½œä¸šæ‰§è¡Œ keyBy æ´—ç‰Œï¼Œå¹¶å°†æ¯ä¸ªè¾“å‡ºç‰©åŒ–ä¸ºä¸€ä¸ªåˆ†åŒºã€‚ç¬¬äºŒä¸ªä½œä¸šæœ‰æºï¼Œå¯¹äºæ¯ä¸ªå¹¶è¡Œå®ä¾‹ï¼Œä»ç¬¬ä¸€ä¸ªä½œä¸šåˆ›å»ºçš„ç›¸åº”åˆ†åŒºä¸­è¯»å–ã€‚ç°åœ¨å¯ä»¥å°†è¿™äº›æºé‡æ–°è§£é‡Šä¸º keyed æµï¼Œä¾‹å¦‚åº”ç”¨çª—å£åŒ–ã€‚è¯·æ³¨æ„ï¼Œè¿™ä¸ªæŠ€å·§ä½¿å¾—ç¬¬äºŒä¸ªä½œä¸šçš„å¹¶è¡Œæ€§å¾ˆå°´å°¬ï¼Œè¿™å¯¹ç»†ç²’åº¦çš„æ¢å¤æ–¹æ¡ˆå¾ˆæœ‰å¸®åŠ©ã€‚\nè¿™ä¸ªé‡æ–°è§£é‡Šçš„åŠŸèƒ½æ˜¯é€šè¿‡ DataStreamUtils æš´éœ²çš„ã€‚\nstatic \u0026lt;T, K\u0026gt; KeyedStream\u0026lt;T, K\u0026gt; reinterpretAsKeyedStream( DataStream\u0026lt;T\u0026gt; stream, KeySelector\u0026lt;T, K\u0026gt; keySelector, TypeInformation\u0026lt;K\u0026gt; typeInfo) ç»™å®šä¸€ä¸ªåŸºæµ(base stream)ã€ä¸€ä¸ªé”®é€‰æ‹©å™¨å’Œç±»å‹ä¿¡æ¯ï¼Œè¯¥æ–¹æ³•ä»åŸºæµåˆ›å»ºä¸€ä¸ª keyed æµã€‚\nä»£ç ç¤ºä¾‹:\nval env = StreamExecutionEnvironment.getExecutionEnvironment env.setParallelism(1) val source = ... new DataStreamUtils(source).reinterpretAsKeyedStream((in) =\u0026gt; in) .timeWindow(Time.seconds(1)) .reduce((a, b) =\u0026gt; a + b) .addSink(new DiscardingSink[Int]) env.execute() åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/stream/experimental.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-experimental-features/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataStream API"],"title":"å®éªŒç‰¹æ€§"},{"categories":["Flink"],"contents":"åœ¨æœ¬èŠ‚ä¸­ï¼Œæ‚¨å°†äº†è§£å¦‚ä½•åœ¨å®è·µä¸­ä½¿ç”¨å¹¿æ’­çŠ¶æ€ã€‚è¯·å‚è€ƒ Stateful Stream Processing æ¥äº†è§£æœ‰çŠ¶æ€æµå¤„ç†èƒŒåçš„æ¦‚å¿µã€‚\næä¾›çš„ API ä¸ºäº†å±•ç¤ºæ‰€æä¾›çš„ APIï¼Œæˆ‘ä»¬å°†åœ¨ä»‹ç»å®ƒä»¬çš„å…¨éƒ¨åŠŸèƒ½ä¹‹å‰å…ˆä¸¾ä¸€ä¸ªä¾‹å­ã€‚ä½œä¸ºæˆ‘ä»¬çš„è¿è¡Œç¤ºä¾‹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¿™æ ·çš„æƒ…å†µï¼šæˆ‘ä»¬æœ‰ä¸€ä¸ªä¸åŒé¢œè‰²å’Œå½¢çŠ¶çš„å¯¹è±¡æµï¼Œæˆ‘ä»¬å¸Œæœ›æ‰¾åˆ°ç›¸åŒé¢œè‰²çš„å¯¹è±¡å¯¹ï¼Œå¹¶éµå¾ªç‰¹å®šçš„æ¨¡å¼ï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªçŸ©å½¢å’Œä¸€ä¸ªä¸‰è§’å½¢ã€‚æˆ‘ä»¬å‡è®¾æœ‰è¶£çš„æ¨¡å¼é›†ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œæ¼”å˜ã€‚\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç¬¬ä¸€ä¸ªæµå°†åŒ…å«å…·æœ‰ Color å’Œ Shape å±æ€§çš„ Item ç±»å‹çš„å…ƒç´ ã€‚å¦ä¸€ä¸ªæµå°†åŒ…å« Rulesã€‚\nä» Items æµå¼€å§‹ï¼Œæˆ‘ä»¬åªéœ€è¦æŒ‰ Color keyByï¼Œå› ä¸ºæˆ‘ä»¬æƒ³è¦ç›¸åŒé¢œè‰²çš„å¯¹ã€‚è¿™å°†ç¡®ä¿ç›¸åŒé¢œè‰²çš„å…ƒç´ æœ€ç»ˆä¼šå‡ºç°åœ¨åŒä¸€ä¸ªç‰©ç†æœºä¸Šã€‚\n// key the items by color KeyedStream\u0026lt;Item, Color\u0026gt; colorPartitionedStream = itemStream .keyBy(new KeySelector\u0026lt;Item, Color\u0026gt;(){...}); ç»§ç»­è®¨è®ºè§„åˆ™ï¼ŒåŒ…å«è§„åˆ™çš„æµåº”è¯¥è¢«å¹¿æ’­åˆ°æ‰€æœ‰ä¸‹æ¸¸ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡åº”è¯¥å°†å®ƒä»¬å­˜å‚¨åœ¨æœ¬åœ°ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥æ ¹æ®æ‰€æœ‰ä¼ å…¥çš„é¡¹ç›®è¯„ä¼°å®ƒä»¬ã€‚ä¸‹é¢çš„ä»£ç æ®µå°†i)å¹¿æ’­è§„åˆ™æµï¼Œii)ä½¿ç”¨æä¾›çš„ MapStateDescriptorï¼Œå®ƒå°†åˆ›å»ºè§„åˆ™å°†è¢«å­˜å‚¨çš„å¹¿æ’­çŠ¶æ€ã€‚\n// a map descriptor to store the name of the rule (string) and the rule itself. MapStateDescriptor\u0026lt;String, Rule\u0026gt; ruleStateDescriptor = new MapStateDescriptor\u0026lt;\u0026gt;( \u0026#34;RulesBroadcastState\u0026#34;, BasicTypeInfo.STRING_TYPE_INFO, TypeInformation.of(new TypeHint\u0026lt;Rule\u0026gt;() {})); // broadcast the rules and create the broadcast state BroadcastStream\u0026lt;Rule\u0026gt; ruleBroadcastStream = ruleStream .broadcast(ruleStateDescriptor); æœ€åï¼Œä¸ºäº†æ ¹æ®ä» Item æµä¼ å…¥çš„å…ƒç´ æ¥è¯„ä¼° Rulesï¼Œæˆ‘ä»¬éœ€è¦ã€‚\n è¿æ¥(connect)ä¸¤ä¸ªæµï¼Œå¹¶ä¸” æŒ‡å®šæˆ‘ä»¬çš„åŒ¹é…æ£€æµ‹é€»è¾‘ã€‚  å°†ä¸€ä¸ªæµï¼ˆkeyed or non-keyedï¼‰ä¸ BroadcastStream è¿æ¥èµ·æ¥ï¼Œå¯ä»¥é€šè¿‡åœ¨éå¹¿æ’­æµä¸Šè°ƒç”¨ connect() æ¥å®Œæˆï¼Œå¹¶å°† BroadcastStream ä½œä¸ºä¸€ä¸ªå‚æ•°ã€‚è¿™å°†è¿”å›ä¸€ä¸ª BroadcastConnectedStreamï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ª Stream ä¸Šè°ƒç”¨ä¸€ä¸ªç‰¹æ®Šç±»å‹çš„ CoProcessFunction æ¥å¤„ç†ã€‚è¯¥å‡½æ•°å°†åŒ…å«æˆ‘ä»¬çš„åŒ¹é…é€»è¾‘ã€‚è¯¥å‡½æ•°çš„å…·ä½“ç±»å‹å–å†³äºéå¹¿æ’­æµçš„ç±»å‹ã€‚\n å¦‚æœå®ƒæ˜¯ keyedï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°å°±æ˜¯ KeyedBroadcastProcessFunctionã€‚ å¦‚æœæ˜¯ non-keyed,ï¼Œé‚£ä¹ˆè¯¥å‡½æ•°å°±æ˜¯ä¸€ä¸ª BroadcastProcessFunctionã€‚  é‰´äºæˆ‘ä»¬çš„éå¹¿æ’­æµæ˜¯ keyed çš„ï¼Œä¸‹é¢çš„ä»£ç æ®µåŒ…å«äº†ä¸Šè¿°è°ƒç”¨ã€‚\næ³¨æ„ï¼š è¿æ¥(connect)åº”è¯¥è¢«è°ƒç”¨åœ¨éå¹¿æ’­æµä¸Šï¼Œ ä»¥ BroadcastStream ä½œä¸ºå‚æ•°ã€‚\nDataStream\u0026lt;String\u0026gt; output = colorPartitionedStream .connect(ruleBroadcastStream) .process( // type arguments in our KeyedBroadcastProcessFunction represent:  // 1. the key of the keyed stream  // 2. the type of elements in the non-broadcast side  // 3. the type of elements in the broadcast side  // 4. the type of the result, here a string  new KeyedBroadcastProcessFunction\u0026lt;Color, Item, Rule, String\u0026gt;() { // my matching logic  } ); BroadcastProcessFunction å’Œ KeyedBroadcastProcessFunction ä¸ CoProcessFunction ä¸€æ ·ï¼Œè¿™äº›å‡½æ•°æœ‰ä¸¤ä¸ªå¤„ç†æ–¹æ³•è¦å®ç°ï¼›processBroadcastElement() è´Ÿè´£å¤„ç†å¹¿æ’­æµä¸­çš„ä¼ å…¥å…ƒç´ ï¼ŒprocessElement() ç”¨äºå¤„ç†éå¹¿æ’­æµã€‚è¿™äº›æ–¹æ³•çš„å®Œæ•´ç­¾åå¦‚ä¸‹:\npublic abstract class BroadcastProcessFunction\u0026lt;IN1, IN2, OUT\u0026gt; extends BaseBroadcastProcessFunction { public abstract void processElement(IN1 value, ReadOnlyContext ctx, Collector\u0026lt;OUT\u0026gt; out) throws Exception; public abstract void processBroadcastElement(IN2 value, Context ctx, Collector\u0026lt;OUT\u0026gt; out) throws Exception; } public abstract class KeyedBroadcastProcessFunction\u0026lt;KS, IN1, IN2, OUT\u0026gt; { public abstract void processElement(IN1 value, ReadOnlyContext ctx, Collector\u0026lt;OUT\u0026gt; out) throws Exception; public abstract void processBroadcastElement(IN2 value, Context ctx, Collector\u0026lt;OUT\u0026gt; out) throws Exception; public void onTimer(long timestamp, OnTimerContext ctx, Collector\u0026lt;OUT\u0026gt; out) throws Exception; } é¦–å…ˆéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°åœ¨å¤„ç†å¹¿æ’­ç«¯å…ƒç´ æ—¶éƒ½éœ€è¦å®ç° processBroadcastElement() æ–¹æ³•ï¼Œåœ¨å¤„ç†éå¹¿æ’­ç«¯å…ƒç´ æ—¶éœ€è¦å®ç° processElement() æ–¹æ³•ã€‚\nè¿™ä¸¤ä¸ªæ–¹æ³•åœ¨æä¾›çš„ä¸Šä¸‹æ–‡ä¸­æœ‰æ‰€ä¸åŒã€‚éå¹¿æ’­ä¾§æœ‰ä¸€ä¸ª ReadOnlyContextï¼Œè€Œå¹¿æ’­ä¾§æœ‰ä¸€ä¸ª Contextã€‚\nè¿™ä¸¤ä¸ªä¸Šä¸‹æ–‡ï¼ˆä»¥ä¸‹æšä¸¾ä¸­çš„ ctxï¼‰:\n æä¾›å¯¹å¹¿æ’­çŠ¶æ€çš„è®¿é—®ï¼šctx.getBroadcastState(MapStateDescriptor\u0026lt;K, V\u0026gt; stateDescriptor)ã€‚ å…è®¸æŸ¥è¯¢å…ƒç´ çš„æ—¶é—´æˆ³ï¼šctx.timestamp()ã€‚ è·å–å½“å‰æ°´å°ï¼šctx.currentWatermark()ã€‚ è·å–å½“å‰å¤„ç†æ—¶é—´ï¼šctx.currentProcessingTime()ï¼Œä»¥åŠ å°†å…ƒç´ å‘å°„åˆ°ä¾§è¾“å‡ºï¼šctx.output(OutputTag\u0026lt;X\u0026gt; outputTag, X value)ã€‚  getBroadcastState() ä¸­çš„ stateDescriptor åº”è¯¥å’Œä¸Šé¢çš„ .broadcast(ruleStateDescriptor) ä¸­çš„ stateDescriptor æ˜¯ä¸€æ ·çš„ã€‚\nåŒºåˆ«åœ¨äºå„è‡ªå¯¹å¹¿æ’­çŠ¶æ€çš„è®¿é—®ç±»å‹ã€‚å¹¿æ’­ç«¯å¯¹å…¶æœ‰è¯»å†™è®¿é—®æƒï¼Œè€Œéå¹¿æ’­ç«¯åˆ™åªæœ‰è¯»çš„è®¿é—®æƒï¼ˆå› æ­¤æ‰æœ‰è¿™äº›åå­—ï¼‰ã€‚åŸå› æ˜¯åœ¨ Flink ä¸­ï¼Œä¸å­˜åœ¨è·¨ä»»åŠ¡é€šä¿¡ã€‚æ‰€ä»¥ï¼Œä¸ºäº†ä¿è¯å¹¿æ’­çŠ¶æ€ä¸­çš„å†…å®¹åœ¨æˆ‘ä»¬æ“ä½œç¬¦çš„æ‰€æœ‰å¹¶è¡Œå®ä¾‹ä¸­éƒ½æ˜¯ç›¸åŒçš„ï¼Œæˆ‘ä»¬åªç»™å¹¿æ’­ä¾§è¯»å†™è®¿é—®æƒï¼Œè€Œå¹¿æ’­ä¾§åœ¨æ‰€æœ‰ä»»åŠ¡ä¸­çœ‹åˆ°çš„å…ƒç´ éƒ½æ˜¯ç›¸åŒçš„ï¼Œå¹¶ä¸”æˆ‘ä»¬è¦æ±‚è¯¥ä¾§æ¯ä¸ªä¼ å…¥å…ƒç´ çš„è®¡ç®—åœ¨æ‰€æœ‰ä»»åŠ¡ä¸­éƒ½æ˜¯ç›¸åŒçš„ã€‚å¿½ç•¥è¿™ä¸ªè§„åˆ™ä¼šæ‰“ç ´çŠ¶æ€çš„ä¸€è‡´æ€§ä¿è¯ï¼Œå¯¼è‡´ç»“æœä¸ä¸€è‡´ï¼Œè€Œä¸”å¾€å¾€éš¾ä»¥è°ƒè¯•ã€‚\næ³¨æ„ processBroadcastElement() ä¸­å®ç°çš„é€»è¾‘å¿…é¡»åœ¨æ‰€æœ‰å¹¶è¡Œå®ä¾‹ä¸­å…·æœ‰ç›¸åŒçš„ç¡®å®šæ€§è¡Œä¸º!\næœ€åï¼Œç”±äº KeyedBroadcastProcessFunction æ˜¯åœ¨ keyed stream ä¸Šè¿è¡Œçš„ï¼Œå®ƒæš´éœ²äº†ä¸€äº› BroadcastProcessFunction æ— æ³•å®ç°çš„åŠŸèƒ½ã€‚é‚£å°±æ˜¯\n processElement() æ–¹æ³•ä¸­çš„ ReadOnlyContext å…è®¸è®¿é—® Flink çš„åº•å±‚å®šæ—¶å™¨æœåŠ¡ï¼Œå®ƒå…è®¸æ³¨å†Œäº‹ä»¶å’Œ/æˆ–å¤„ç†æ—¶é—´å®šæ—¶å™¨ã€‚å½“ä¸€ä¸ªå®šæ—¶å™¨å‘å°„æ—¶ï¼Œ onTimer() (å¦‚ä¸Šæ‰€ç¤º)è¢«è°ƒç”¨ä¸€ä¸ª OnTimerContextï¼Œå®ƒæš´éœ²äº†ä¸ ReadOnlyContext ç›¸åŒçš„åŠŸèƒ½ï¼Œå†åŠ ä¸Š   èƒ½å¤Ÿè¯¢é—®å‘å°„çš„å®šæ—¶å™¨æ˜¯äº‹ä»¶è¿˜æ˜¯å¤„ç†æ—¶é—´, å’Œ æ¥æŸ¥è¯¢ä¸å®šæ—¶å™¨ç›¸å…³è”çš„é”®ã€‚  processBroadcastElement() æ–¹æ³•ä¸­çš„ Context åŒ…å« applyToKeyedState(StateDescriptor\u0026lt;S, VS\u0026gt; stateDescriptor, KeyedStateFunction\u0026lt;KS, S\u0026gt; function) æ–¹æ³•ã€‚è¿™å…è®¸æ³¨å†Œä¸€ä¸ª KeyedStateFunctionï¼Œä»¥åº”ç”¨äºä¸æä¾›çš„ stateDescriptor ç›¸å…³è”çš„æ‰€æœ‰é”®çš„æ‰€æœ‰çŠ¶æ€ã€‚  æ³¨æ„ã€‚æ³¨å†Œå®šæ—¶å™¨åªèƒ½åœ¨ KeyedBroadcastProcessFunction çš„ processElement() å¤„è¿›è¡Œï¼Œè€Œä¸”åªèƒ½åœ¨é‚£é‡Œè¿›è¡Œã€‚åœ¨ processBroadcastElement() æ–¹æ³•ä¸­æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºæ²¡æœ‰é”®ä¸å¹¿æ’­å…ƒç´ ç›¸å…³è”ã€‚\nå›åˆ°æˆ‘ä»¬åŸæ¥çš„ä¾‹å­ï¼Œæˆ‘ä»¬çš„ KeyedBroadcastProcessFunction å¯ä»¥æ˜¯å¦‚ä¸‹çš„æ ·å­ã€‚\nnew KeyedBroadcastProcessFunction\u0026lt;Color, Item, Rule, String\u0026gt;() { // store partial matches, i.e. first elements of the pair waiting for their second element  // we keep a list as we may have many first elements waiting  private final MapStateDescriptor\u0026lt;String, List\u0026lt;Item\u0026gt;\u0026gt; mapStateDesc = new MapStateDescriptor\u0026lt;\u0026gt;( \u0026#34;items\u0026#34;, BasicTypeInfo.STRING_TYPE_INFO, new ListTypeInfo\u0026lt;\u0026gt;(Item.class)); // identical to our ruleStateDescriptor above  private final MapStateDescriptor\u0026lt;String, Rule\u0026gt; ruleStateDescriptor = new MapStateDescriptor\u0026lt;\u0026gt;( \u0026#34;RulesBroadcastState\u0026#34;, BasicTypeInfo.STRING_TYPE_INFO, TypeInformation.of(new TypeHint\u0026lt;Rule\u0026gt;() {})); @Override public void processBroadcastElement(Rule value, Context ctx, Collector\u0026lt;String\u0026gt; out) throws Exception { ctx.getBroadcastState(ruleStateDescriptor).put(value.name, value); } @Override public void processElement(Item value, ReadOnlyContext ctx, Collector\u0026lt;String\u0026gt; out) throws Exception { final MapState\u0026lt;String, List\u0026lt;Item\u0026gt;\u0026gt; state = getRuntimeContext().getMapState(mapStateDesc); final Shape shape = value.getShape(); for (Map.Entry\u0026lt;String, Rule\u0026gt; entry : ctx.getBroadcastState(ruleStateDescriptor).immutableEntries()) { final String ruleName = entry.getKey(); final Rule rule = entry.getValue(); List\u0026lt;Item\u0026gt; stored = state.get(ruleName); if (stored == null) { stored = new ArrayList\u0026lt;\u0026gt;(); } if (shape == rule.second \u0026amp;\u0026amp; !stored.isEmpty()) { for (Item i : stored) { out.collect(\u0026#34;MATCH: \u0026#34; + i + \u0026#34; - \u0026#34; + value); } stored.clear(); } // there is no else{} to cover if rule.first == rule.second  if (shape.equals(rule.first)) { stored.add(value); } if (stored.isEmpty()) { state.remove(ruleName); } else { state.put(ruleName, stored); } } } } é‡è¦çš„è€ƒè™‘å› ç´  åœ¨ä»‹ç»å®Œæä¾›çš„ API ä¹‹åï¼Œæœ¬èŠ‚é‡ç‚¹ä»‹ç»ä½¿ç”¨å¹¿æ’­çŠ¶æ€æ—¶éœ€è¦æ³¨æ„çš„é‡è¦äº‹é¡¹ã€‚è¿™äº›äº‹é¡¹æ˜¯\n  æ²¡æœ‰è·¨ä»»åŠ¡é€šä¿¡ã€‚å¦‚å‰æ‰€è¿°ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆåªæœ‰ (Keyed)-BroadcastProcessFunction çš„å¹¿æ’­ç«¯å¯ä»¥ä¿®æ”¹å¹¿æ’­çŠ¶æ€çš„å†…å®¹çš„åŸå› ã€‚æ­¤å¤–ï¼Œç”¨æˆ·å¿…é¡»ç¡®ä¿æ‰€æœ‰çš„ä»»åŠ¡å¯¹æ¯ä¸€ä¸ªä¼ å…¥å…ƒç´ éƒ½ä»¥åŒæ ·çš„æ–¹å¼ä¿®æ”¹å¹¿æ’­çŠ¶æ€çš„å†…å®¹ã€‚å¦åˆ™ï¼Œä¸åŒçš„ä»»åŠ¡å¯èƒ½æœ‰ä¸åŒçš„å†…å®¹ï¼Œå¯¼è‡´ç»“æœä¸ä¸€è‡´ã€‚\n  ä¸åŒä»»åŠ¡çš„å¹¿æ’­çŠ¶æ€ä¸­äº‹ä»¶çš„é¡ºåºå¯èƒ½ä¸åŒã€‚è™½ç„¶å¹¿æ’­æµçš„å…ƒç´ ä¿è¯äº†æ‰€æœ‰å…ƒç´ å°†ï¼ˆæœ€ç»ˆï¼‰è¿›å…¥æ‰€æœ‰ä¸‹æ¸¸ä»»åŠ¡ï¼Œä½†å…ƒç´ å¯èƒ½ä¼šä»¥ä¸åŒçš„é¡ºåºåˆ°è¾¾æ¯ä¸ªä»»åŠ¡ã€‚å› æ­¤ï¼Œæ¯ä¸ªä¼ å…¥å…ƒç´ çš„çŠ¶æ€æ›´æ–°å¿…é¡»ä¸ä¾èµ–äºä¼ å…¥äº‹ä»¶çš„é¡ºåºã€‚\n  æ‰€æœ‰çš„ä»»åŠ¡éƒ½ä¼šå¯¹å…¶å¹¿æ’­çŠ¶æ€è¿›è¡Œ checkpointã€‚è™½ç„¶å½“ checkpoint å‘ç”Ÿæ—¶ï¼Œæ‰€æœ‰ä»»åŠ¡çš„å¹¿æ’­çŠ¶æ€ä¸­éƒ½æœ‰ç›¸åŒçš„å…ƒç´ ï¼ˆcheckpoint å±éšœä¸ä¼šè¶…è¿‡å…ƒç´ ï¼‰ï¼Œä½†æ‰€æœ‰ä»»åŠ¡éƒ½ä¼š checkpoint ä»–ä»¬çš„å¹¿æ’­çŠ¶æ€ï¼Œè€Œä¸ä»…ä»…æ˜¯å…¶ä¸­ä¸€ä¸ªã€‚è¿™æ˜¯ä¸€ä¸ªè®¾è®¡å†³å®šï¼Œä»¥é¿å…åœ¨è¿˜åŸè¿‡ç¨‹ä¸­è®©æ‰€æœ‰ä»»åŠ¡ä»åŒä¸€ä¸ªæ–‡ä»¶ä¸­è¯»å–ï¼ˆä»è€Œé¿å…çƒ­ç‚¹ï¼‰ï¼Œå°½ç®¡å®ƒçš„ä»£ä»·æ˜¯å°†æ£€æŸ¥ç‚¹çŠ¶æ€çš„å¤§å°å¢åŠ äº†pçš„ç³»æ•°ï¼ˆ=å¹¶è¡Œæ€§ï¼‰ã€‚Flink ä¿è¯åœ¨æ¢å¤/ç¼©æ”¾æ—¶ï¼Œä¸ä¼šæœ‰é‡å¤å’Œä¸¢å¤±çš„æ•°æ®ã€‚åœ¨ä»¥ç›¸åŒæˆ–æ›´å°çš„å¹¶è¡Œåº¦è¿›è¡Œæ¢å¤æ—¶ï¼Œæ¯ä¸ªä»»åŠ¡è¯»å–å…¶æ£€æŸ¥ç‚¹çŠ¶æ€ã€‚æ‰©å®¹åï¼Œæ¯ä¸ªä»»åŠ¡è¯»å–è‡ªå·±çš„çŠ¶æ€ï¼Œå…¶ä½™ä»»åŠ¡ï¼ˆp_new-p_oldï¼‰ä»¥å¾ªç¯çš„æ–¹å¼è¯»å–ä¹‹å‰ä»»åŠ¡çš„æ£€æŸ¥ç‚¹ã€‚\n  æ²¡æœ‰ RocksDB çŠ¶æ€åç«¯ã€‚å¹¿æ’­çŠ¶æ€åœ¨è¿è¡Œæ—¶ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå†…å­˜ä¾›åº”ä¹Ÿåº”ç›¸åº”è¿›è¡Œã€‚è¿™å¯¹æ‰€æœ‰çš„æ“ä½œç¬¦çŠ¶æ€éƒ½é€‚ç”¨ã€‚\n  åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/stream/state/broadcast_state.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-21-the-broadcast-state-pattern/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataStream API"],"title":"å¹¿æ’­çŠ¶æ€æ¨¡å¼"},{"categories":["Flink"],"contents":"Batch ç¤ºä¾‹ ä¸‹é¢çš„ç¤ºä¾‹ç¨‹åºå±•ç¤ºäº† Flink çš„ä¸åŒåº”ç”¨ï¼Œä»ç®€å•çš„å•è¯è®¡æ•°åˆ°å›¾å½¢ç®—æ³•ã€‚è¿™äº›ä»£ç æ ·æœ¬è¯´æ˜äº† Flink çš„ DataSet API çš„ä½¿ç”¨ã€‚\nä»¥ä¸‹å’Œæ›´å¤šä¾‹å­çš„å®Œæ•´æºä»£ç å¯ä»¥åœ¨ Flink æºç åº“çš„ flink-examples-batch æ¨¡å—ä¸­æ‰¾åˆ°ã€‚\nè¿è¡Œä¸€ä¸ªä¾‹å­ ä¸ºäº†è¿è¡Œä¸€ä¸ª Flink å®ä¾‹ï¼Œæˆ‘ä»¬å‡è®¾ä½ æœ‰ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ Flink å®ä¾‹ã€‚å¯¼èˆªä¸­çš„ \u0026ldquo;Quickstart\u0026rdquo; å’Œ \u0026ldquo;Setup\u0026rdquo; é€‰é¡¹å¡æè¿°äº†å¯åŠ¨ Flink çš„å„ç§æ–¹æ³•ã€‚\næœ€ç®€å•çš„æ–¹æ³•æ˜¯è¿è¡Œ ./bin/start-cluster.shï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒç”¨ä¸€ä¸ª JobManager å’Œä¸€ä¸ª TaskManager å¯åŠ¨ä¸€ä¸ªæœ¬åœ°é›†ç¾¤ã€‚\nFlink çš„æ¯ä¸ªäºŒè¿›åˆ¶ç‰ˆæœ¬éƒ½åŒ…å«ä¸€ä¸ªä¾‹å­ç›®å½•ï¼Œå…¶ä¸­æœ‰æœ¬é¡µæ¯ä¸ªä¾‹å­çš„ jar æ–‡ä»¶ã€‚\nè¦è¿è¡Œ WordCount ç¤ºä¾‹ï¼Œè¯·å‘å‡ºä»¥ä¸‹å‘½ä»¤ã€‚\n./bin/flink run ./examples/batch/WordCount.jar å…¶ä»–çš„ä¾‹å­ä¹Ÿå¯ä»¥ç”¨ç±»ä¼¼çš„æ–¹å¼å¯åŠ¨ã€‚\nè¯·æ³¨æ„ï¼Œè®¸å¤šä¾‹å­åœ¨è¿è¡Œæ—¶æ²¡æœ‰ä¼ é€’ä»»ä½•å‚æ•°ï¼Œè€Œæ˜¯ä½¿ç”¨å†…ç½®çš„æ•°æ®ã€‚è¦ä½¿ç”¨çœŸå®æ•°æ®è¿è¡Œ WordCountï¼Œä½ å¿…é¡»ä¼ é€’æ•°æ®çš„è·¯å¾„ã€‚\n./bin/flink run ./examples/batch/WordCount.jar --input /path/to/some/text/data --output /path/to/result è¯·æ³¨æ„ï¼Œéæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿéœ€è¦ä¸€ä¸ªæ¨¡å¼å‰ç¼€ï¼Œå¦‚ hdfs://ã€‚\nWordCount WordCount æ˜¯å¤§æ•°æ®å¤„ç†ç³»ç»Ÿä¸­çš„ \u0026ldquo;Hello World\u0026rdquo;ã€‚å®ƒè®¡ç®—æ–‡æœ¬é›†åˆä¸­çš„å•è¯é¢‘ç‡ã€‚è¯¥ç®—æ³•åˆ†ä¸¤æ­¥å·¥ä½œã€‚é¦–å…ˆï¼Œæ–‡æœ¬è¢«åˆ†å‰²æˆå•ä¸ªå•è¯ã€‚ç¬¬äºŒï¼Œå¯¹å•è¯è¿›è¡Œåˆ†ç»„å’Œè®¡æ•°ã€‚\nval env = ExecutionEnvironment.getExecutionEnvironment // get input data val text = env.readTextFile(\u0026#34;/path/to/file\u0026#34;) val counts = text.flatMap { _.toLowerCase.split(\u0026#34;\\\\W+\u0026#34;) filter { _.nonEmpty } } .map { (_, 1) } .groupBy(0) .sum(1) counts.writeAsCsv(outputPath, \u0026#34;\\n\u0026#34;, \u0026#34; \u0026#34;) WordCount çš„ä¾‹å­å®ç°äº†ä¸Šé¢æè¿°çš„ç®—æ³•ï¼Œè¾“å…¥å‚æ•°ï¼š--input \u0026lt;path\u0026gt; --output \u0026lt;path\u0026gt;ã€‚ä½œä¸ºæµ‹è¯•æ•°æ®ï¼Œä»»ä½•æ–‡æœ¬æ–‡ä»¶éƒ½å¯ä»¥ã€‚\né¡µé¢æ’å PageRank ç®—æ³•è®¡ç®—ç”±é“¾æ¥å®šä¹‰çš„å›¾ä¸­é¡µé¢çš„\u0026quot;é‡è¦æ€§\u0026quot;ï¼Œè¿™äº›é“¾æ¥ä»ä¸€ä¸ªé¡µé¢æŒ‡å‘å¦ä¸€ä¸ªé¡µé¢ã€‚å®ƒæ˜¯ä¸€ç§è¿­ä»£å›¾ç®—æ³•ï¼Œè¿™æ„å‘³ç€å®ƒåå¤åº”ç”¨ç›¸åŒçš„è®¡ç®—ã€‚åœ¨æ¯ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œæ¯ä¸ªé¡µé¢å°†å…¶å½“å‰çš„æ’ååˆ†å¸ƒåœ¨æ‰€æœ‰çš„é‚»å±…ä¸Šï¼Œå¹¶è®¡ç®—å…¶æ–°çš„æ’åï¼Œä½œä¸ºå®ƒä»é‚»å±…é‚£é‡Œå¾—åˆ°çš„æ’åçš„ç´¯åŠ å’Œã€‚PageRank ç®—æ³•æ˜¯ç”± Google æœç´¢å¼•æ“æ¨å¹¿çš„ï¼Œå®ƒåˆ©ç”¨ç½‘é¡µçš„é‡è¦æ€§æ¥å¯¹æœç´¢æŸ¥è¯¢çš„ç»“æœè¿›è¡Œæ’åã€‚\nåœ¨è¿™ä¸ªç®€å•çš„ä¾‹å­ä¸­ï¼ŒPageRank çš„å®ç°æ–¹å¼æ˜¯æ‰¹é‡è¿­ä»£å’Œå›ºå®šçš„è¿­ä»£æ¬¡æ•°ã€‚\n// User-defined types case class Link(sourceId: Long, targetId: Long) case class Page(pageId: Long, rank: Double) case class AdjacencyList(sourceId: Long, targetIds: Array[Long]) // set up execution environment val env = ExecutionEnvironment.getExecutionEnvironment // read the pages and initial ranks by parsing a CSV file val pages = env.readCsvFile[Page](pagesInputPath) // the links are encoded as an adjacency list: (page-id, Array(neighbor-ids)) val links = env.readCsvFile[Link](linksInputPath) // assign initial ranks to pages val pagesWithRanks = pages.map(p =\u0026gt; Page(p, 1.0 / numPages)) // build adjacency list from link input val adjacencyLists = links // initialize lists  .map(e =\u0026gt; AdjacencyList(e.sourceId, Array(e.targetId))) // concatenate lists  .groupBy(\u0026#34;sourceId\u0026#34;).reduce { (l1, l2) =\u0026gt; AdjacencyList(l1.sourceId, l1.targetIds ++ l2.targetIds) } // start iteration val finalRanks = pagesWithRanks.iterateWithTermination(maxIterations) { currentRanks =\u0026gt; val newRanks = currentRanks // distribute ranks to target pages  .join(adjacencyLists).where(\u0026#34;pageId\u0026#34;).equalTo(\u0026#34;sourceId\u0026#34;) { (page, adjacent, out: Collector[Page]) =\u0026gt; for (targetId \u0026lt;- adjacent.targetIds) { out.collect(Page(targetId, page.rank / adjacent.targetIds.length)) } } // collect ranks and sum them up  .groupBy(\u0026#34;pageId\u0026#34;).aggregate(SUM, \u0026#34;rank\u0026#34;) // apply dampening factor  .map { p =\u0026gt; Page(p.pageId, (p.rank * DAMPENING_FACTOR) + ((1 - DAMPENING_FACTOR) / numPages)) } // terminate if no rank update was significant  val termination = currentRanks.join(newRanks).where(\u0026#34;pageId\u0026#34;).equalTo(\u0026#34;pageId\u0026#34;) { (current, next, out: Collector[Int]) =\u0026gt; // check for significant update  if (math.abs(current.rank - next.rank) \u0026gt; EPSILON) out.collect(1) } (newRanks, termination) } val result = finalRanks // emit result result.writeAsCsv(outputPath, \u0026#34;\\n\u0026#34;, \u0026#34; \u0026#34;) PageRank ç¨‹åºå®ç°äº†ä¸Šè¿°ç¤ºä¾‹ã€‚å®ƒéœ€è¦ä»¥ä¸‹å‚æ•°æ‰èƒ½è¿è¡Œã€‚--pages \u0026lt;path\u0026gt; --links \u0026lt;path\u0026gt; --output \u0026lt;path\u0026gt; --numPages \u0026lt;n\u0026gt; --iterations \u0026lt;n\u0026gt;ã€‚\nè¾“å…¥æ–‡ä»¶æ˜¯çº¯æ–‡æœ¬æ–‡ä»¶ï¼Œå¿…é¡»æŒ‰ä»¥ä¸‹æ ¼å¼è¿›è¡Œã€‚\n é¡µæ•°ç”¨ä¸€ä¸ªï¼ˆé•¿ï¼‰ID è¡¨ç¤ºï¼Œç”¨æ¢è¡Œå­—ç¬¦åˆ†éš”ã€‚  ä¾‹å¦‚ \u0026ldquo;1/n2/n12/n42/n63/n\u0026rdquo; ç»™å‡ºäº† 5 ä¸ª ID ä¸º 1ã€2ã€12ã€42 å’Œ 63 çš„é¡µé¢ã€‚   é“¾æ¥ç”¨é¡µé¢ ID å¯¹è¡¨ç¤ºï¼Œç”¨ç©ºæ ¼åˆ†éš”ã€‚é“¾æ¥ç”¨æ¢è¡Œç¬¦åˆ†éš”ã€‚  ä¾‹å¦‚ \u0026ldquo;1 2\\n2 12\\n1 12\\n42 63\\n\u0026rdquo; ç»™å‡ºäº†å››ä¸ª(å®šå‘)é“¾æ¥(1)-\u0026gt;(2)ï¼Œ(2)-\u0026gt;(12)ï¼Œ(1)-\u0026gt;(12)å’Œ(42)-\u0026gt;(63)ã€‚    å¯¹äºè¿™ä¸ªç®€å•çš„å®ç°ï¼Œè¦æ±‚æ¯ä¸ªé¡µé¢è‡³å°‘æœ‰ä¸€ä¸ªå…¥ç«™é“¾æ¥å’Œä¸€ä¸ªå‡ºç«™é“¾æ¥ï¼ˆä¸€ä¸ªé¡µé¢å¯ä»¥æŒ‡å‘è‡ªå·±ï¼‰ã€‚\nè¿æ¥çš„ç»„ä»¶ Connected Components ç®—æ³•é€šè¿‡ç»™åŒä¸€è¿æ¥éƒ¨åˆ†ä¸­çš„æ‰€æœ‰é¡¶ç‚¹åˆ†é…ç›¸åŒçš„ç»„ä»¶ IDï¼Œæ¥è¯†åˆ«è¾ƒå¤§å›¾ä¸­ç›¸äº’è¿æ¥çš„éƒ¨åˆ†ã€‚ä¸ PageRank ç±»ä¼¼ï¼ŒConnected Components æ˜¯ä¸€ç§è¿­ä»£ç®—æ³•ã€‚åœ¨æ¯ä¸€æ­¥ä¸­ï¼Œæ¯ä¸ªé¡¶ç‚¹å°†å…¶å½“å‰çš„ç»„ä»¶ ID ä¼ æ’­ç»™æ‰€æœ‰çš„é‚»å±…ã€‚å¦‚æœä¸€ä¸ªé¡¶ç‚¹æ¥å—æ¥è‡ªé‚»å±…çš„ç»„ä»¶ IDï¼Œå¦‚æœå®ƒå°äºè‡ªå·±çš„ç»„ä»¶ IDã€‚\næœ¬å®ç°ä½¿ç”¨å¢é‡è¿­ä»£ã€‚æ²¡æœ‰æ”¹å˜ç»„ä»¶ ID çš„é¡¶ç‚¹ä¸å‚ä¸ä¸‹ä¸€æ­¥ã€‚è¿™äº§ç”Ÿäº†æ›´å¥½çš„æ€§èƒ½ï¼Œå› ä¸ºåé¢çš„è¿­ä»£é€šå¸¸åªå¤„ç†ä¸€äº›ç¦»ç¾¤çš„é¡¶ç‚¹ã€‚\n// set up execution environment val env = ExecutionEnvironment.getExecutionEnvironment // read vertex and edge data // assign the initial components (equal to the vertex id) val vertices = getVerticesDataSet(env).map { id =\u0026gt; (id, id) } // undirected edges by emitting for each input edge the input edges itself and an inverted // version val edges = getEdgesDataSet(env).flatMap { edge =\u0026gt; Seq(edge, (edge._2, edge._1)) } // open a delta iteration val verticesWithComponents = vertices.iterateDelta(vertices, maxIterations, Array(0)) { (s, ws) =\u0026gt; // apply the step logic: join with the edges  val allNeighbors = ws.join(edges).where(0).equalTo(0) { (vertex, edge) =\u0026gt; (edge._2, vertex._2) } // select the minimum neighbor  val minNeighbors = allNeighbors.groupBy(0).min(1) // update if the component of the candidate is smaller  val updatedComponents = minNeighbors.join(s).where(0).equalTo(0) { (newVertex, oldVertex, out: Collector[(Long, Long)]) =\u0026gt; if (newVertex._2 \u0026lt; oldVertex._2) out.collect(newVertex) } // delta and new workset are identical  (updatedComponents, updatedComponents) } verticesWithComponents.writeAsCsv(outputPath, \u0026#34;\\n\u0026#34;, \u0026#34; \u0026#34;) ConnectedComponents ç¨‹åºå®ç°äº†ä¸Šé¢çš„ä¾‹å­ã€‚å®ƒéœ€è¦ä»¥ä¸‹å‚æ•°æ‰èƒ½è¿è¡Œ: --vertices \u0026lt;path\u0026gt; --edges \u0026lt;path\u0026gt; --output \u0026lt;path\u0026gt; --iterations \u0026lt;n\u0026gt;ã€‚\nè¾“å…¥æ–‡ä»¶æ˜¯çº¯æ–‡æœ¬æ–‡ä»¶ï¼Œå¿…é¡»æŒ‰å¦‚ä¸‹æ ¼å¼ç¼–å†™ã€‚\n é¡¶ç‚¹ç”¨ ID è¡¨ç¤ºï¼Œå¹¶ç”¨æ¢è¡Œç¬¦éš”å¼€ã€‚  ä¾‹å¦‚ \u0026ldquo;1/n2/n12/n42/n63/n\u0026rdquo; ç»™å‡ºäº†äº”ä¸ªé¡¶ç‚¹ï¼Œåˆ†åˆ«æ˜¯(1)ã€(2)ã€(12)ã€(42)å’Œ(63)ã€‚   è¾¹ç¼˜ç”¨ä¸€å¯¹é¡¶ç‚¹ ID è¡¨ç¤ºï¼Œè¿™äº›é¡¶ç‚¹ ID ç”¨ç©ºæ ¼å­—ç¬¦åˆ†éš”ã€‚è¾¹ç¼˜ç”¨æ¢è¡Œç¬¦éš”å¼€ã€‚  ä¾‹å¦‚ï¼Œ\u0026ldquo;1 2/n2 12/n1 12/n42 63/n\u0026rdquo; ç»™å‡ºäº†å››ä¸ª(éç›´æ¥)è”ç³»(1)-(2)ã€(2)-(12)ã€(1)-(12)å’Œ(42)-(63)ã€‚    åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/batch/examples.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-batch-examples/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataSet API"],"title":"æ‰¹å¤„ç†ä¾‹å­"},{"categories":["Flink"],"contents":"æ³¨ï¼šè¿™æè¿°äº†æ–°çš„æ•°æ®æº API ï¼Œä½œä¸º FLIP-27 çš„ä¸€éƒ¨åˆ†åœ¨ Flink 1.11 ä¸­å¼•å…¥ã€‚è¿™ä¸ªæ–°çš„ API ç›®å‰å¤„äº BETA çŠ¶æ€ã€‚ å¤§å¤šæ•°ç°æœ‰çš„æºè¿æ¥å™¨è¿˜æ²¡æœ‰ï¼ˆæˆªè‡³ Flink 1.11 ï¼‰ä½¿ç”¨è¿™ä¸ªæ–°çš„ API å®ç°ï¼Œè€Œæ˜¯ä½¿ç”¨ä»¥å‰çš„ API ï¼ŒåŸºäº SourceFunction ã€‚ æœ¬é¡µä»‹ç»äº† Flink çš„æ•°æ®æº API åŠå…¶èƒŒåçš„æ¦‚å¿µå’Œæ¶æ„ã€‚å¦‚æœä½ å¯¹ Flink ä¸­çš„æ•°æ®æºæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œæˆ–è€…ä½ æƒ³å®ç°ä¸€ä¸ªæ–°çš„æ•°æ®æºï¼Œè¯·é˜…è¯»æœ¬é¡µé¢ã€‚\nå¦‚æœæ‚¨æ­£åœ¨å¯»æ‰¾é¢„å®šä¹‰çš„æºè¿æ¥å™¨ï¼Œè¯·æŸ¥çœ‹è¿æ¥å™¨æ–‡æ¡£ã€‚\næ•°æ®æºæ¦‚å¿µ æ ¸å¿ƒéƒ¨ä»¶\nä¸€ä¸ªæ•°æ®æºæœ‰ä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ã€‚Splitã€SplitEnumerator å’Œ SourceReaderã€‚\n  Split æ˜¯æ•°æ®æºæ‰€æ¶ˆè€—çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼Œå°±åƒä¸€ä¸ªæ–‡ä»¶æˆ–ä¸€ä¸ªæ—¥å¿—åˆ†åŒºã€‚Split æ˜¯æºåˆ†é…å·¥ä½œå’Œå¹¶è¡Œè¯»å–æ•°æ®çš„ç²’åº¦ã€‚\n  SourceReader è¯·æ±‚ Split å¹¶è¿›è¡Œå¤„ç†ï¼Œä¾‹å¦‚è¯»å– Split æ‰€ä»£è¡¨çš„æ–‡ä»¶æˆ–æ—¥å¿—åˆ†åŒºã€‚SourceReader åœ¨ SourceOperators çš„ Task Manager ä¸Šå¹¶è¡Œè¿è¡Œï¼Œå¹¶äº§ç”Ÿäº‹ä»¶/è®°å½•çš„å¹¶è¡Œæµã€‚\n  SplitEnumerator ç”Ÿæˆ Split å¹¶å°†å®ƒä»¬åˆ†é…ç»™ SourceReader ã€‚å®ƒä½œä¸ºå•ä¸ªå®ä¾‹åœ¨ä»»åŠ¡ç®¡ç†å™¨ä¸Šè¿è¡Œï¼Œè´Ÿè´£ç»´æŠ¤å¾…å¤„ç†çš„ Split çš„ç§¯å‹ï¼Œå¹¶ä»¥å¹³è¡¡çš„æ–¹å¼å°†å®ƒä»¬åˆ†é…ç»™è¯»è€…ã€‚\n  Source ç±»æ˜¯å°†ä¸Šè¿°ä¸‰ä¸ªç»„ä»¶è”ç³»åœ¨ä¸€èµ·çš„ API å…¥å£ç‚¹ã€‚\nç»Ÿä¸€çš„è·¨æµå’Œæ‰¹å¤„ç†\næ•°æ®æº API ä»¥ç»Ÿä¸€çš„æ–¹å¼æ”¯æŒæ— ç•Œæµæºå’Œæœ‰ç•Œæ‰¹å¤„ç†æºã€‚\nè¿™ä¸¤ç§æƒ…å†µçš„åŒºåˆ«å¾ˆå°ï¼šåœ¨æœ‰ç•Œ/æ‰¹å¤„ç†çš„æƒ…å†µä¸‹ï¼Œæšä¸¾å™¨ç”Ÿæˆä¸€ç»„å›ºå®šçš„ split ï¼Œè€Œä¸”æ¯ä¸ª split å¿…ç„¶æ˜¯æœ‰é™çš„ã€‚åœ¨æ— ç•Œæµçš„æƒ…å†µä¸‹ï¼Œè¿™ä¸¤ç§æƒ…å†µä¸­çš„ä¸€ç§æ˜¯ä¸æ­£ç¡®çš„ï¼ˆ split ä¸æ˜¯æœ‰é™çš„ï¼Œæˆ–è€…æšä¸¾å™¨ä¸æ–­äº§ç”Ÿæ–°çš„ split ï¼‰ã€‚\nä¾‹å­ ä¸‹é¢æ˜¯ä¸€äº›ç®€åŒ–çš„æ¦‚å¿µæ€§ä¾‹å­ï¼Œä»¥è¯´æ˜åœ¨æµå¼å’Œæ‰¹å¤„ç†æƒ…å†µä¸‹ï¼Œæ•°æ®æºç»„ä»¶å¦‚ä½•äº¤äº’ã€‚\nè¯·æ³¨æ„ï¼Œè¿™å¹¶ä¸èƒ½å‡†ç¡®åœ°æè¿° Kafka å’Œ File æºçš„å®ç°æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼›éƒ¨åˆ†å†…å®¹æ˜¯ç®€åŒ–çš„ï¼Œç”¨äºè¯´æ˜ç›®çš„ã€‚\nç»‘å®šçš„æ–‡ä»¶æº\næºæœ‰ä¸€ä¸ªè¦è¯»å–çš„ç›®å½•çš„ URI/è·¯å¾„ï¼Œä»¥åŠä¸€ä¸ªå®šä¹‰å¦‚ä½•è§£ææ–‡ä»¶çš„æ ¼å¼ã€‚\n Split æ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œæˆ–è€…ä¸€ä¸ªæ–‡ä»¶çš„ä¸€ä¸ªåŒºåŸŸï¼ˆå¦‚æœæ•°æ®æ ¼å¼æ”¯æŒåˆ†å‰²æ–‡ä»¶ï¼‰ã€‚ SplitEnumerator åˆ—å‡ºäº†ç»™å®šç›®å½•è·¯å¾„ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ã€‚å®ƒå°† Split åˆ†é…ç»™ä¸‹ä¸€ä¸ªè¯·æ±‚ Split çš„è¯»è€…ã€‚ä¸€æ—¦æ‰€æœ‰çš„ Split éƒ½åˆ†é…å®Œæ¯•ï¼Œå®ƒå°±ä¼šç”¨ NoMoreSplits æ¥å“åº”è¯·æ±‚ã€‚ SourceReader è¯·æ±‚ä¸€ä¸ª Split ï¼Œå¹¶è¯»å–è¢«åˆ†é…çš„ Split ï¼ˆæ–‡ä»¶æˆ–æ–‡ä»¶åŒºåŸŸï¼‰ï¼Œå¹¶ä½¿ç”¨ç»™å®šçš„æ ¼å¼è¿›è¡Œè§£æã€‚å¦‚æœå®ƒæ²¡æœ‰å¾—åˆ°å¦ä¸€ä¸ª Split ï¼Œè€Œæ˜¯å¾—åˆ°ä¸€ä¸ª NoMoreSplits æ¶ˆæ¯ï¼Œå®ƒå°±ç»“æŸäº†ã€‚  éç»‘å®šæµæ–‡ä»¶æº\nè¿™ä¸ªæºçš„å·¥ä½œæ–¹å¼å’Œä¸Šé¢æè¿°çš„ä¸€æ ·ï¼Œé™¤äº† SplitEnumerator ä»ä¸å“åº” NoMoreSplits ï¼Œè€Œæ˜¯å‘¨æœŸæ€§åœ°åˆ—å‡ºç»™å®š URI/Path ä¸‹çš„å†…å®¹ä»¥æ£€æŸ¥æ–°æ–‡ä»¶ã€‚ä¸€æ—¦å‘ç°æ–°æ–‡ä»¶ï¼Œå®ƒå°±ä¼šä¸ºå®ƒä»¬ç”Ÿæˆæ–°çš„ Splits ï¼Œå¹¶å¯ä»¥å°†å®ƒä»¬åˆ†é…ç»™å¯ç”¨çš„ SourceReadersã€‚\næ— ç•Œæµ Kafka æº\nè¯¥æºæœ‰ä¸€ä¸ª Kafka Topic ï¼ˆæˆ– Topic åˆ—è¡¨æˆ– Topic regex ï¼‰å’Œä¸€ä¸ª Deserializer æ¥è§£æè®°å½•ã€‚\n ä¸€ä¸ª Split å°±æ˜¯ä¸€ä¸ª Kafka Topic åˆ†åŒºã€‚ SplitEnumerator è¿æ¥åˆ° brokers ï¼Œä»¥åˆ—å‡ºæ‰€æœ‰æ¶‰åŠè®¢é˜…çš„ä¸»é¢˜åˆ†åŒºã€‚æšä¸¾å™¨å¯ä»¥é€‰æ‹©é‡å¤è¿™ä¸ªæ“ä½œæ¥å‘ç°æ–°æ·»åŠ çš„ä¸»é¢˜/åˆ†åŒºã€‚ SourceReader ä½¿ç”¨ KafkaConsumer è¯»å–åˆ†é…çš„ split ï¼ˆä¸»é¢˜åˆ†åŒºï¼‰ï¼Œå¹¶ä½¿ç”¨æä¾›çš„ Deserializer ååºåˆ—åŒ–è®°å½•ã€‚åˆ†å‰²(Topic Partitions) æ²¡æœ‰ç»ˆç‚¹ï¼Œæ‰€ä»¥è¯»å–å™¨æ°¸è¿œä¸ä¼šåˆ°è¾¾æ•°æ®çš„ç»ˆç‚¹ã€‚  ç»‘å®šçš„ Kafka æº\nå’Œä¸Šé¢ä¸€æ ·ï¼Œåªæ˜¯æ¯ä¸ª Split ï¼ˆä¸»é¢˜åˆ†åŒºï¼‰æœ‰ä¸€ä¸ªå®šä¹‰çš„ç»“æŸåç§»é‡ã€‚ä¸€æ—¦ SourceReader è¾¾åˆ°ä¸€ä¸ª Split çš„ç»“æŸåç§»é‡ï¼Œå®ƒå°±ä¼šå®Œæˆè¯¥ Split ã€‚ä¸€æ—¦æ‰€æœ‰åˆ†é…çš„ Split ç»“æŸï¼Œ SourceReader å°±ç»“æŸäº†ã€‚\næ•°æ®æº API æœ¬èŠ‚ä»‹ç»äº† FLIP-27 ä¸­æ–°å¼•å…¥çš„ Source API çš„ä¸»è¦æ¥å£ï¼Œå¹¶ä¸ºå¼€å‘è€…æä¾›äº† Source å¼€å‘çš„æŠ€å·§ã€‚\nSource Source API æ˜¯ä¸€ä¸ªå·¥å‚é£æ ¼çš„æ¥å£ï¼Œç”¨äºåˆ›å»ºä»¥ä¸‹ç»„ä»¶ã€‚\n Split Enumerator æºè¯»å–å™¨ åˆ†ç¦»å¼åºåˆ—å™¨ æšä¸¾å™¨æ£€æŸ¥ç‚¹åºåˆ—å™¨  é™¤æ­¤ä¹‹å¤–ï¼Œ Source è¿˜æä¾›äº†æºçš„è¾¹ç•Œå±æ€§ï¼Œè¿™æ · Flink å¯ä»¥é€‰æ‹©åˆé€‚çš„æ¨¡å¼æ¥è¿è¡Œ Flink ä½œä¸šã€‚\nSource çš„å®ç°åº”è¯¥æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œå› ä¸º Source å®ä¾‹åœ¨è¿è¡Œæ—¶è¢«åºåˆ—åŒ–å¹¶ä¸Šä¼ åˆ° Flink é›†ç¾¤ã€‚\nSplitEnumerator SplitEnumerator æœ‰æœ›æˆä¸º Source çš„\u0026quot;å¤§è„‘\u0026quot;ã€‚SplitEnumerator çš„å…¸å‹å®ç°ä¼šåšä»¥ä¸‹å·¥ä½œã€‚\n SourceReader æ³¨å†Œå¤„ç† SourceReader å¤±è´¥å¤„ç†  å½“ SourceReader å¤±è´¥æ—¶ï¼Œå°†è°ƒç”¨ addSplitsBack() æ–¹æ³•ã€‚SplitEnumerator åº”è¯¥æ”¶å›æœªè¢«å¤±è´¥çš„ SourceReader æ‰¿è®¤çš„åˆ†å‰²åˆ†é…ã€‚   SourceEvent å¤„ç†  SourceEvents æ˜¯åœ¨ SplitEnumerator å’Œ SourceReader ä¹‹é—´å‘é€çš„è‡ªå®šä¹‰äº‹ä»¶ã€‚å®ç°å¯ä»¥åˆ©ç”¨è¿™ç§æœºåˆ¶æ¥è¿›è¡Œå¤æ‚çš„åè°ƒã€‚   åˆ†å‰²å‘ç°å’Œåˆ†é…  SplitEnumerator å¯ä»¥æ ¹æ®å„ç§äº‹ä»¶å°† split åˆ†é…ç»™ SourceReaders ï¼ŒåŒ…æ‹¬å‘ç°æ–°çš„ split ã€æ–°çš„ SourceReader æ³¨å†Œã€ SourceReader å¤±è´¥ç­‰ã€‚    SplitEnumerator å¯ä»¥å€ŸåŠ© SplitEnumeratorContext å®Œæˆä¸Šè¿°å·¥ä½œï¼Œ SplitEnumeratorContext æ˜¯åœ¨åˆ›å»ºæˆ–æ¢å¤ SplitEnumerator æ—¶æä¾›ç»™ Source çš„ã€‚SplitEnumeratorContext å…è®¸ SplitEnumerator æ£€ç´¢è¯»å–å™¨çš„å¿…è¦ä¿¡æ¯å¹¶æ‰§è¡Œåè°ƒåŠ¨ä½œã€‚Source å®ç°åº”è¯¥å°† SplitEnumeratorContext ä¼ é€’ç»™ SplitEnumerator å®ä¾‹ã€‚\nè™½ç„¶ SplitEnumerator å®ç°å¯ä»¥é€šè¿‡åªåœ¨å®ƒçš„æ–¹æ³•è¢«è°ƒç”¨æ—¶é‡‡å–åè°ƒåŠ¨ä½œçš„è¢«åŠ¨æ–¹å¼å¾ˆå¥½åœ°å·¥ä½œï¼Œä½†ä¸€äº› SplitEnumerator å®ç°å¯èƒ½å¸Œæœ›ä¸»åŠ¨é‡‡å–è¡ŒåŠ¨ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª SplitEnumerator å¯èƒ½å¸Œæœ›å®šæœŸè¿è¡Œ split discovery ï¼Œå¹¶å°†æ–°çš„ split åˆ†é…ç»™ SourceReaders ã€‚è¿™æ ·çš„å®ç°å¯èƒ½ä¼šå‘ç°è°ƒç”¨ Async() æ–¹æ³• SplitEnumeratorContext å¾ˆæ–¹ä¾¿ã€‚ä¸‹é¢çš„ä»£ç ç‰‡æ®µå±•ç¤ºäº† SplitEnumerator å®ç°å¦‚ä½•åœ¨ä¸ç»´æŠ¤è‡ªå·±çš„çº¿ç¨‹çš„æƒ…å†µä¸‹å®ç°è¿™ä¸€ç‚¹ã€‚\nclass MySplitEnumerator implements SplitEnumerator\u0026lt;MySplit\u0026gt; { private final long DISCOVER_INTERVAL = 60_000L; /** * A method to discover the splits. */ private List\u0026lt;MySplit\u0026gt; discoverSplits() {...} @Override public void start() { ... enumContext.callAsync(this::discoverSplits, splits -\u0026gt; { Map\u0026lt;Integer, List\u0026lt;MockSourceSplit\u0026gt;\u0026gt; assignments = new HashMap\u0026lt;\u0026gt;(); int parallelism = enumContext.currentParallelism(); for (MockSourceSplit split : splits) { int owner = split.splitId().hashCode() % parallelism; assignments.computeIfAbsent(owner, new ArrayList\u0026lt;\u0026gt;()).add(split); } enumContext.assignSplits(new SplitsAssignment\u0026lt;\u0026gt;(assignments)); }, 0L, DISCOVER_INTERVAL); ... } ... } SourceReader SourceReader æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ Task Manager ä¸­çš„ç»„ä»¶ï¼Œç”¨äºæ¶ˆè€—æ¥è‡ª Splits çš„è®°å½•ã€‚\nSourceReader æš´éœ²äº†ä¸€ä¸ªåŸºäºæ‹‰çš„æ¶ˆè´¹æ¥å£ã€‚ä¸€ä¸ª Flink ä»»åŠ¡åœ¨å¾ªç¯ä¸­ä¸æ–­è°ƒç”¨ pollNext(ReaderOutput) æ¥è½®è¯¢ SourceReader çš„è®°å½•ã€‚pollNext(ReaderOutput) æ–¹æ³•çš„è¿”å›å€¼è¡¨ç¤ºæºé˜…è¯»å™¨çš„çŠ¶æ€ã€‚\n MORE_AVAILABLE - SourceReader ç«‹å³æœ‰æ›´å¤šçš„è®°å½•å¯ç”¨ã€‚ NOTHING_AVAILABLE - SourceReader æ­¤æ—¶æ²¡æœ‰æ›´å¤šçš„è®°å½•å¯ç”¨ï¼Œä½†å°†æ¥å¯èƒ½ä¼šæœ‰æ›´å¤šçš„è®°å½•ã€‚ END_OF_INPUT - SourceReader å·²ç»ç”¨å®Œäº†æ‰€æœ‰çš„è®°å½•ï¼Œè¾¾åˆ°äº†æ•°æ®çš„ç»ˆç‚¹ã€‚è¿™æ„å‘³ç€ SourceReader å¯ä»¥è¢«å…³é—­ã€‚  ä¸ºäº†ä¿è¯æ€§èƒ½ï¼Œä¼šç»™ pollNext(ReaderOutput) æ–¹æ³•æä¾›ä¸€ä¸ª ReaderOutput ï¼Œæ‰€ä»¥å¦‚æœæœ‰å¿…è¦ï¼Œ SourceReader å¯ä»¥åœ¨ä¸€æ¬¡è°ƒç”¨ pollNext() çš„è¿‡ç¨‹ä¸­å‘å‡ºå¤šæ¡è®°å½•ã€‚ä¾‹å¦‚ï¼Œæœ‰æ—¶å¤–éƒ¨ç³»ç»Ÿçš„å·¥ä½œç²’åº¦æ˜¯å—ã€‚ä¸€ä¸ªå—å¯èƒ½åŒ…å«å¤šæ¡è®°å½•ï¼Œä½†æºç åªèƒ½åœ¨å—çš„è¾¹ç•Œå¤„è¿›è¡Œæ£€æŸ¥ç‚¹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ SourceReader å¯ä»¥ä¸€æ¬¡å°†ä¸€ä¸ªå—ä¸­çš„æ‰€æœ‰è®°å½•æ’æ”¾åˆ° ReaderOutput ã€‚ä½†æ˜¯ï¼Œé™¤éå¿…è¦ï¼Œ SourceReader çš„å®ç°åº”è¯¥é¿å…åœ¨ä¸€æ¬¡ pollNext(ReaderOutput) çš„è°ƒç”¨ä¸­å‘å°„å¤šæ¡è®°å½•ã€‚è¿™æ˜¯å› ä¸ºä» SourceReader ä¸­è¿›è¡Œè½®è¯¢çš„ä»»åŠ¡çº¿ç¨‹æ˜¯åœ¨äº‹ä»¶å¾ªç¯ä¸­å·¥ä½œçš„ï¼Œä¸èƒ½é˜»å¡ã€‚\nSourceReader çš„æ‰€æœ‰çŠ¶æ€éƒ½åº”è¯¥ç»´æŠ¤åœ¨ SourceSplits é‡Œé¢ï¼Œè¿™äº›çŠ¶æ€åœ¨ snapshotState() è°ƒç”¨æ—¶è¿”å›ã€‚è¿™æ ·åšå¯ä»¥åœ¨éœ€è¦æ—¶å°† SourceSplits é‡æ–°åˆ†é…ç»™å…¶ä»– SourceReaders ã€‚\nåœ¨åˆ›å»º SourceReader æ—¶ï¼Œä¼šå‘ Source æä¾›ä¸€ä¸ª SourceReaderContext ã€‚é¢„è®¡ Source å°†æŠŠä¸Šä¸‹æ–‡ä¼ é€’ç»™ SourceReader å®ä¾‹ã€‚SourceReader å¯ä»¥é€šè¿‡ SourceReaderContext å‘å…¶ SplitEnumerator å‘é€ SourceEvent ã€‚Source çš„ä¸€ä¸ªå…¸å‹çš„è®¾è®¡æ¨¡å¼æ˜¯è®© SourceReaders å‘ SplitEnumerator æŠ¥å‘Šå®ƒä»¬çš„æœ¬åœ°ä¿¡æ¯ï¼Œ SplitEnumerator æœ‰ä¸€ä¸ªå…¨å±€è§†å›¾æ¥åšå†³ç­–ã€‚\nSourceReader API æ˜¯ä¸€ä¸ªä½çº§çš„ API ï¼Œå®ƒå…è®¸ç”¨æˆ·æ‰‹åŠ¨å¤„ç† split ï¼Œå¹¶æœ‰è‡ªå·±çš„çº¿ç¨‹æ¨¡å‹æ¥è·å–å’Œäº¤æ¥è®°å½•ã€‚ä¸ºäº†æ–¹ä¾¿ SourceReader çš„å®ç°ï¼Œ Flink æä¾›äº†ä¸€ä¸ª SourceReaderBase ç±»ï¼Œå¤§å¤§å‡å°‘äº†ç¼–å†™ SourceReader çš„å·¥ä½œé‡ã€‚å¼ºçƒˆå»ºè®®è¿æ¥å™¨å¼€å‘äººå‘˜åˆ©ç”¨ SourceReaderBase ï¼Œè€Œä¸æ˜¯ä»å¤´å¼€å§‹ç¼–å†™ SourceReaders ã€‚æ›´å¤šç»†èŠ‚è¯·æŸ¥çœ‹ Split Reader API éƒ¨åˆ†ã€‚\nä½¿ç”¨ Source ä¸ºäº†ä» Source åˆ›å»º DataStream ï¼Œéœ€è¦å°† Source ä¼ é€’ç»™ StreamExecutionEnvironmentã€‚ä¾‹å¦‚:\nval env = StreamExecutionEnvironment.getExecutionEnvironment() val mySource = new MySource(...) val stream = env.fromSource( mySource, WatermarkStrategy.noWatermarks(), \u0026#34;MySourceName\u0026#34;) ... Split è¯»å–å™¨ API æ ¸å¿ƒçš„ SourceReader API æ˜¯å®Œå…¨å¼‚æ­¥çš„ï¼Œéœ€è¦å®ç°è€…æ‰‹åŠ¨ç®¡ç†å¼‚æ­¥æ‹†åˆ†è¯»å–ã€‚ç„¶è€Œï¼Œåœ¨å®è·µä¸­ï¼Œå¤§å¤šæ•° Source ä½¿ç”¨æ‰§è¡Œé˜»å¡æ“ä½œï¼Œæ¯”å¦‚åœ¨å®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ KafkaConsumer ï¼‰ä¸Šé˜»å¡ poll() è°ƒç”¨ï¼Œæˆ–è€…åœ¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ˆ HDFS ï¼Œ S3 ï¼Œ\u0026hellip;ï¼‰ä¸Šé˜»å¡ I/O æ“ä½œã€‚ä¸ºäº†ä¸å¼‚æ­¥çš„ Source API å…¼å®¹ï¼Œè¿™äº›é˜»å¡ï¼ˆåŒæ­¥ï¼‰æ“ä½œéœ€è¦å‘ç”Ÿåœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­ï¼Œçº¿ç¨‹å°†æ•°æ®äº¤ç»™å¼‚æ­¥éƒ¨åˆ†çš„é˜…è¯»å™¨ã€‚\nSplitReader æ˜¯ç”¨äºç®€å•çš„åŸºäºåŒæ­¥è¯»å–/è½®è¯¢çš„æºç å®ç°çš„é«˜çº§ API ï¼Œæ¯”å¦‚æ–‡ä»¶è¯»å–ã€ Kafka ç­‰ã€‚\næ ¸å¿ƒæ˜¯ SourceReaderBase ç±»ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ª SplitReader å¹¶åˆ›å»ºè¿è¡Œ SplitReader çš„ fetcher çº¿ç¨‹ï¼Œæ”¯æŒä¸åŒçš„æ¶ˆè´¹çº¿ç¨‹æ¨¡å‹ã€‚\nSplitReader SplitReader API åªæœ‰ä¸‰ä¸ªæ–¹æ³•ã€‚\n ä¸€ä¸ªé˜»å¡è·å–æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ª RecordsWithSplitIds ã€‚ ä¸€ç§éé˜»å¡æ–¹æ³•ï¼Œç”¨äºå¤„ç†æ‹†åˆ†å˜åŒ–ã€‚ ä¸€ä¸ªéé˜»å¡çš„å”¤é†’æ–¹æ³•ï¼Œç”¨äºå”¤é†’é˜»å¡çš„è·å–æ“ä½œã€‚  SplitReader åªä¸“æ³¨äºä»å¤–éƒ¨ç³»ç»Ÿè¯»å–è®°å½•ï¼Œå› æ­¤æ¯” SourceReader ç®€å•å¾—å¤šã€‚è¯¦æƒ…è¯·æŸ¥çœ‹è¯¥ç±»çš„ Java æ–‡æ¡£ã€‚\nSourceReaderBase SourceReader çš„å®ç°å¾ˆå¸¸è§ï¼Œå®ƒåšäº†ä»¥ä¸‹å·¥ä½œã€‚\n æ‹¥æœ‰ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œä»¥é˜»å¡çš„æ–¹å¼ä»å¤–éƒ¨ç³»ç»Ÿçš„åˆ†å‰²å¤„è·å–æ•°æ®ã€‚ å¤„ç†å†…éƒ¨è·å–çº¿ç¨‹å’Œå…¶ä»–æ–¹æ³•è°ƒç”¨ä¹‹é—´çš„åŒæ­¥ï¼Œå¦‚ pollNext(ReaderOutput) ã€‚ ç»´æŠ¤æ¯ä¸ª split çš„æ°´å°ï¼Œä»¥ä¾¿è¿›è¡Œæ°´å°å¯¹é½ã€‚ ç»´æŠ¤æ¯ä¸ªåˆ†èº«çš„çŠ¶æ€ï¼Œä»¥ä¾¿æ£€æŸ¥ç‚¹ã€‚  ä¸ºäº†å‡å°‘ç¼–å†™ä¸€ä¸ªæ–°çš„ SourceReader çš„å·¥ä½œï¼Œ Flink æä¾›äº†ä¸€ä¸ª SourceReaderBase ç±»ä½œä¸º SourceReader çš„åŸºç¡€å®ç°ã€‚SourceReaderBase å¼€ç®±å³å®Œæˆäº†ä¸Šè¿°æ‰€æœ‰å·¥ä½œã€‚å¦‚æœè¦ç¼–å†™ä¸€ä¸ªæ–°çš„ SourceReader ï¼Œåªéœ€è¦è®© SourceReader å®ç°ç»§æ‰¿ SourceReaderBase ï¼Œå¡«å……ä¸€äº›æ–¹æ³•ï¼Œç„¶åå®ç°ä¸€ä¸ªé«˜çº§çš„ SplitReader å°±å¯ä»¥äº†ã€‚\nSplitFetcherManager SourceReaderBase æ”¯æŒä¸€äº›å¼€ç®±å³ç”¨çš„çº¿ç¨‹æ¨¡å‹ï¼Œè¿™å–å†³äºä¸ä¹‹åˆä½œçš„ SplitFetcherManager çš„è¡Œä¸ºã€‚SplitFetcherManager å¸®åŠ©åˆ›å»ºå’Œç»´æŠ¤ä¸€ä¸ª SplitFetcher æ± ï¼Œæ¯ä¸ª SplitFetcher ç”¨ä¸€ä¸ª SplitReader æ¥è·å–ã€‚å®ƒè¿˜å†³å®šäº†å¦‚ä½•å°† split åˆ†é…ç»™æ¯ä¸ª split fetcher ã€‚\nä¸¾ä¸ªä¾‹å­ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸€ä¸ª SplitFetcherManager å¯èƒ½æœ‰å›ºå®šæ•°é‡çš„çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹ä»åˆ†é…ç»™ SourceReader çš„ä¸€äº› split ä¸­è·å–ã€‚\nä¸‹é¢çš„ä»£ç ç‰‡æ®µå®ç°äº†è¿™ä¸ªçº¿ç¨‹æ¨¡å‹ã€‚\n/** * A SplitFetcherManager that has a fixed size of split fetchers and assign splits * to the split fetchers based on the hash code of split IDs. */ public class FixedSizeSplitFetcherManager\u0026lt;E, SplitT extends SourceSplit\u0026gt; extends SplitFetcherManager\u0026lt;E, SplitT\u0026gt; { private final int numFetchers; public FixedSizeSplitFetcherManager( int numFetchers, FutureNotifier futureNotifier, FutureCompletingBlockingQueue\u0026lt;RecordsWithSplitIds\u0026lt;E\u0026gt;\u0026gt; elementsQueue, Supplier\u0026lt;SplitReader\u0026lt;E, SplitT\u0026gt;\u0026gt; splitReaderSupplier) { super(futureNotifier, elementsQueue, splitReaderSupplier); this.numFetchers = numFetchers; // Create numFetchers split fetchers.  for (int i = 0; i \u0026lt; numFetchers; i++) { startFetcher(createSplitFetcher()); } } @Override public void addSplits(List\u0026lt;SplitT\u0026gt; splitsToAdd) { // Group splits by their owner fetchers.  Map\u0026lt;Integer, List\u0026lt;SplitT\u0026gt;\u0026gt; splitsByFetcherIndex = new HashMap\u0026lt;\u0026gt;(); splitsToAdd.forEach(split -\u0026gt; { int ownerFetcherIndex = split.hashCode() % numFetchers; splitsByFetcherIndex .computeIfAbsent(ownerFetcherIndex, s -\u0026gt; new ArrayList\u0026lt;\u0026gt;()) .add(split); }); // Assign the splits to their owner fetcher.  splitsByFetcherIndex.forEach((fetcherIndex, splitsForFetcher) -\u0026gt; { fetchers.get(fetcherIndex).addSplits(splitsForFetcher); }); } } è€Œä½¿ç”¨è¿™ä¸ªçº¿ç¨‹æ¨¡å‹çš„ SourceReader å¯ä»¥åˆ›å»ºå¦‚ä¸‹ã€‚\npublic class FixedFetcherSizeSourceReader\u0026lt;E, T, SplitT extends SourceSplit, SplitStateT\u0026gt; extends SourceReaderBase\u0026lt;E, T, SplitT, SplitStateT\u0026gt; { public FixedFetcherSizeSourceReader( FutureNotifier futureNotifier, FutureCompletingBlockingQueue\u0026lt;RecordsWithSplitIds\u0026lt;E\u0026gt;\u0026gt; elementsQueue, Supplier\u0026lt;SplitReader\u0026lt;E, SplitT\u0026gt;\u0026gt; splitFetcherSupplier, RecordEmitter\u0026lt;E, T, SplitStateT\u0026gt; recordEmitter, Configuration config, SourceReaderContext context) { super( futureNotifier, elementsQueue, new FixedSizeSplitFetcherManager\u0026lt;\u0026gt;( config.getInteger(SourceConfig.NUM_FETCHERS), futureNotifier, elementsQueue, splitFetcherSupplier), recordEmitter, config, context); } @Override protected void onSplitFinished(Collection\u0026lt;String\u0026gt; finishedSplitIds) { // Do something in the callback for the finished splits.  } @Override protected SplitStateT initializedState(SplitT split) { ... } @Override protected SplitT toSplitType(String splitId, SplitStateT splitState) { ... } } æ˜¾ç„¶ï¼Œ SourceReader çš„å®ç°ä¹Ÿå¯ä»¥åœ¨ SplitFetcherManager å’Œ SourceReaderBase ä¹‹ä¸Šè½»æ¾å®ç°è‡ªå·±çš„çº¿ç¨‹æ¨¡å‹ã€‚\näº‹ä»¶æ—¶é—´å’Œæ°´å° äº‹ä»¶æ—¶é—´åˆ†é…å’Œæ°´å°ç”Ÿæˆä½œä¸ºæ•°æ®æºçš„ä¸€éƒ¨åˆ†å‘ç”Ÿã€‚ç¦»å¼€æºè¯»å–å™¨çš„äº‹ä»¶æµå…·æœ‰äº‹ä»¶æ—¶é—´æˆ³ï¼Œå¹¶ä¸”ï¼ˆåœ¨æµæ‰§è¡ŒæœŸé—´ï¼‰åŒ…å«æ°´å°ã€‚æœ‰å…³äº‹ä»¶æ—¶é—´å’Œæ°´å°çš„ä»‹ç»ï¼Œè¯·å‚è§åŠæ—¶æµå¤„ç†ã€‚\né‡è¦äº‹é¡¹ åŸºäºä¼ ç»Ÿ SourceFunction çš„åº”ç”¨ç¨‹åºé€šå¸¸ä¼šåœ¨åé¢å•ç‹¬çš„æ­¥éª¤ä¸­é€šè¿‡ stream.assignTimestampsAndWatermarks(WatermarkStrategy) ç”Ÿæˆæ—¶é—´æˆ³å’Œæ°´å°ã€‚è¿™ä¸ªå‡½æ•°ä¸åº”è¯¥è¢«ç”¨äºæ–°çš„æºï¼Œå› ä¸ºæ—¶é—´æˆ³å°†è¢«åˆ†é…ï¼Œå¹¶ä¸”å®ƒå°†è¦†ç›–ä¹‹å‰çš„åˆ†å‰²æ„ŸçŸ¥æ°´å°ã€‚\nAPI åœ¨ DataStream API åˆ›å»ºæœŸé—´ï¼Œ WatermarkStrategy è¢«ä¼ é€’ç»™ Sourceï¼Œå¹¶åˆ›å»º TimestampAssigner å’Œ WatermarkGeneratorã€‚\nenvironment.fromSource( Source\u0026lt;OUT, ?, ?\u0026gt; source, WatermarkStrategy\u0026lt;OUT\u0026gt; timestampsAndWatermarks, String sourceName) TimestampAssigner å’Œ WatermarkGenerator ä½œä¸º ReaderOutput(æˆ– SourceOutput) çš„ä¸€éƒ¨åˆ†é€æ˜åœ°è¿è¡Œï¼Œå› æ­¤æºç å®ç°è€…ä¸å¿…å®ç°ä»»ä½•æ—¶é—´æˆ³æå–å’Œæ°´å°ç”Ÿæˆä»£ç ã€‚\näº‹ä»¶æ—¶é—´æˆ³ äº‹ä»¶æ—¶é—´æˆ³çš„åˆ†é…æœ‰ä¸¤ä¸ªæ­¥éª¤ã€‚\n  SourceReader å¯ä»¥é€šè¿‡è°ƒç”¨ SourceOutput.collect(event, timestamp) å°†æºè®°å½•æ—¶é—´æˆ³é™„åŠ åˆ°äº‹ä»¶ä¸Šã€‚è¿™åªä¸åŸºäºè®°å½•ä¸”æœ‰æ—¶é—´æˆ³çš„æ•°æ®æºæœ‰å…³ï¼Œå¦‚ Kafka ã€ Kinesis ã€ Pulsar æˆ– Pravega ã€‚ä¸åŸºäºè®°å½•ä¸”æœ‰æ—¶é—´æˆ³çš„æ•°æ®æºï¼ˆå¦‚æ–‡ä»¶ï¼‰æ²¡æœ‰æºè®°å½•æ—¶é—´æˆ³ã€‚è¿™ä¸€æ­¥æ˜¯æºè¿æ¥å™¨å®ç°çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯ç”±ä½¿ç”¨æºçš„åº”ç”¨ç¨‹åºå‚æ•°åŒ–ã€‚\n  ç”±åº”ç”¨ç¨‹åºé…ç½®çš„ TimestampAssigner åˆ†é…æœ€ç»ˆçš„æ—¶é—´æˆ³ã€‚TimestampAssigner çœ‹åˆ°åŸå§‹æºè®°å½•æ—¶é—´æˆ³å’Œäº‹ä»¶ã€‚åˆ†é…è€…å¯ä»¥ä½¿ç”¨æºè®°å½•æ—¶é—´æˆ³æˆ–è®¿é—®äº‹ä»¶çš„ä¸€ä¸ªå­—æ®µè·å¾—æœ€ç»ˆçš„äº‹ä»¶æ—¶é—´æˆ³ã€‚\n  è¿™ç§ä¸¤æ­¥æ³•å…è®¸ç”¨æˆ·åŒæ—¶å¼•ç”¨æºç³»ç»Ÿçš„æ—¶é—´æˆ³å’Œäº‹ä»¶æ•°æ®ä¸­çš„æ—¶é—´æˆ³ä½œä¸ºäº‹ä»¶æ—¶é—´æˆ³ã€‚\næ³¨æ„ï¼šå½“ä½¿ç”¨æ²¡æœ‰æºè®°å½•æ—¶é—´æˆ³çš„æ•°æ®æºï¼ˆå¦‚æ–‡ä»¶ï¼‰ï¼Œå¹¶é€‰æ‹©æºè®°å½•æ—¶é—´æˆ³ä½œä¸ºæœ€ç»ˆçš„äº‹ä»¶æ—¶é—´æˆ³æ—¶ï¼Œäº‹ä»¶å°†å¾—åˆ°ä¸€ä¸ªé»˜è®¤çš„æ—¶é—´æˆ³ï¼Œç­‰äº LONG_MIN ï¼ˆ=-9,223,372,036,854,775,808 ï¼‰ã€‚\næ°´å°ç”Ÿæˆ æ°´å°ç”Ÿæˆå™¨ä»…åœ¨æµå¼æ‰§è¡ŒæœŸé—´æ¿€æ´»ã€‚æ‰¹é‡æ‰§è¡Œä¼šåœç”¨æ°´å°ç”Ÿæˆå™¨ï¼›ä¸‹é¢æè¿°çš„æ‰€æœ‰ç›¸å…³æ“ä½œéƒ½å°†æˆä¸ºæœ‰æ•ˆçš„æ— æ“ä½œã€‚\næ•°æ®æº API æ”¯æŒæ¯æ¬¡æ‹†åˆ†å•ç‹¬è¿è¡Œæ°´å°ç”Ÿæˆå™¨ã€‚è¿™ä½¿å¾— Flink å¯ä»¥å•ç‹¬è§‚å¯Ÿæ¯ä¸ªåˆ†ä½“çš„äº‹ä»¶æ—¶é—´è¿›åº¦ï¼Œè¿™å¯¹äºæ­£ç¡®å¤„ç†äº‹ä»¶æ—¶é—´åæ–œå’Œé˜²æ­¢ç©ºé—²åˆ†åŒºæ‹–ç´¯æ•´ä¸ªåº”ç”¨çš„äº‹ä»¶æ—¶é—´è¿›åº¦éå¸¸é‡è¦ã€‚\nå½“ä½¿ç”¨ Split Reader API å®ç°ä¸€ä¸ªæºè¿æ¥å™¨æ—¶ï¼Œä¼šè‡ªåŠ¨å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚æ‰€æœ‰åŸºäº Split Reader API çš„å®ç°éƒ½å…·æœ‰å¼€ç®±å³ç”¨çš„ split-aware æ°´å°ã€‚\nå¯¹äºä¸€ä¸ªä½çº§åˆ«çš„ SourceReader API çš„å®ç°æ¥è¯´ï¼Œè¦ä½¿ç”¨ split-aware æ°´å°çš„ç”Ÿæˆï¼Œè¯¥å®ç°å¿…é¡»å°†ä¸åŒçš„ split äº‹ä»¶è¾“å‡ºåˆ°ä¸åŒçš„è¾“å‡ºä¸­ï¼š Split-local SourceOutputs ã€‚åˆ†å‰²æœ¬åœ°è¾“å‡ºå¯ä»¥é€šè¿‡ createOutputForSplit(splitId) å’Œ releaseOutputForSplit(splitId) æ–¹æ³•åœ¨ä¸» ReaderOutput ä¸Šåˆ›å»ºå’Œé‡Šæ”¾ã€‚è¯¦æƒ…è¯·å‚è€ƒè¯¥ç±»å’Œæ–¹æ³•çš„ JavaDocs ã€‚\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/stream/sources.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-data-sources/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataStream API","Data Sources"],"title":"æ•°æ®æº"},{"categories":["Flink"],"contents":"Zipping æ•°æ®é›†ä¸­çš„å…ƒç´  åœ¨æŸäº›ç®—æ³•ä¸­ï¼Œäººä»¬å¯èƒ½éœ€è¦ä¸ºæ•°æ®é›†å…ƒç´ åˆ†é…å”¯ä¸€çš„æ ‡è¯†ç¬¦ã€‚æœ¬æ–‡æ¡£ä»‹ç»äº†å¦‚ä½•å°† DataSetUtils ç”¨äºè¯¥ç›®çš„ã€‚\nä½¿ç”¨å¯†é›†ç´¢å¼•è¿›è¡Œ Zip zipWithIndex ç»™å…ƒç´ åˆ†é…è¿ç»­çš„æ ‡ç­¾ï¼Œæ¥æ”¶ä¸€ä¸ªæ•°æ®é›†ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„ï¼ˆå”¯ä¸€idï¼Œåˆå§‹å€¼ï¼‰2-tuplesçš„æ•°æ®é›†ã€‚è¿™ä¸ªè¿‡ç¨‹éœ€è¦ä¸¤æ¬¡ä¼ é€’ï¼Œå…ˆè®¡æ•°å†ç»™å…ƒç´ è´´æ ‡ç­¾ï¼Œè€Œä¸”ç”±äºè®¡æ•°çš„åŒæ­¥æ€§ï¼Œä¸èƒ½é‡‡ç”¨æµæ°´çº¿æ–¹å¼ã€‚å¤‡é€‰çš„ zipWithUniqueId ä»¥æµæ°´çº¿çš„æ–¹å¼å·¥ä½œï¼Œå½“å”¯ä¸€çš„æ ‡ç­¾å·²ç»è¶³å¤Ÿæ—¶ï¼Œé¦–é€‰ zipã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç ã€‚\nimport org.apache.flink.api.scala._ val env: ExecutionEnvironment = ExecutionEnvironment.getExecutionEnvironment env.setParallelism(2) val input: DataSet[String] = env.fromElements(\u0026#34;A\u0026#34;, \u0026#34;B\u0026#34;, \u0026#34;C\u0026#34;, \u0026#34;D\u0026#34;, \u0026#34;E\u0026#34;, \u0026#34;F\u0026#34;, \u0026#34;G\u0026#34;, \u0026#34;H\u0026#34;) val result: DataSet[(Long, String)] = input.zipWithIndex result.writeAsCsv(resultPath, \u0026#34;\\n\u0026#34;, \u0026#34;,\u0026#34;) env.execute() å¯ä»¥å¾—åˆ°å…ƒç»„: (0,G), (1,H), (2,A), (3,B), (4,C), (5,D), (6,E), (7,F)\nå¸¦æœ‰å”¯ä¸€æ ‡è¯†ç¬¦çš„ Zip åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œäººä»¬å¯èƒ½ä¸éœ€è¦åˆ†é…è¿ç»­çš„æ ‡ç­¾ï¼ŒzipWithUniqueId ä»¥æµæ°´çº¿çš„æ–¹å¼å·¥ä½œï¼ŒåŠ å¿«äº†æ ‡ç­¾åˆ†é…è¿‡ç¨‹ã€‚è¯¥æ–¹æ³•æ¥æ”¶ä¸€ä¸ªæ•°æ®é›†ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¿”å›ä¸€ä¸ªç”±ï¼ˆå”¯ä¸€idï¼Œåˆå§‹å€¼ï¼‰2-tuplesç»„æˆçš„æ–°æ•°æ®é›†ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç ã€‚\nimport org.apache.flink.api.scala._ val env: ExecutionEnvironment = ExecutionEnvironment.getExecutionEnvironment env.setParallelism(2) val input: DataSet[String] = env.fromElements(\u0026#34;A\u0026#34;, \u0026#34;B\u0026#34;, \u0026#34;C\u0026#34;, \u0026#34;D\u0026#34;, \u0026#34;E\u0026#34;, \u0026#34;F\u0026#34;, \u0026#34;G\u0026#34;, \u0026#34;H\u0026#34;) val result: DataSet[(Long, String)] = input.zipWithUniqueId result.writeAsCsv(resultPath, \u0026#34;\\n\u0026#34;, \u0026#34;,\u0026#34;) env.execute() å¯ä»¥å¾—åˆ°å…ƒç»„: (0,G), (1,A), (2,H), (3,B), (5,C), (7,D), (9,E), (11,F)\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/batch/zip_elements_guide.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-zipping-elements-in-a-dataset/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataSet API"],"title":"æ•°æ®é›†ä¸­çš„ zipping å…ƒç´ "},{"categories":["Flink"],"contents":"æ—¶é—´å±æ€§ Flink èƒ½å¤Ÿæ ¹æ®ä¸åŒçš„æ—¶é—´æ¦‚å¿µæ¥å¤„ç†æµæ•°æ®ã€‚\n å¤„ç†æ—¶é—´æ˜¯æŒ‡æ­£åœ¨æ‰§è¡Œç›¸åº”æ“ä½œçš„æœºå™¨çš„ç³»ç»Ÿæ—¶é—´ï¼ˆä¹Ÿç§°ä¸º\u0026quot;æŒ‚é’Ÿæ—¶é—´\u0026quot;ï¼‰ã€‚ äº‹ä»¶æ—¶é—´æŒ‡çš„æ˜¯åŸºäºæ—¶é—´æˆ³å¯¹æµåª’ä½“æ•°æ®çš„å¤„ç†ï¼Œæ—¶é—´æˆ³é™„åŠ åœ¨æ¯ä¸€è¡Œä¸Šã€‚æ—¶é—´æˆ³å¯ä»¥ç¼–ç äº‹ä»¶å‘ç”Ÿçš„æ—¶é—´ã€‚ æ‘„å–æ—¶é—´æ˜¯äº‹ä»¶è¿›å…¥ Flink çš„æ—¶é—´ï¼›åœ¨å†…éƒ¨ï¼Œå®ƒçš„å¤„ç†æ–¹å¼ä¸äº‹ä»¶æ—¶é—´ç±»ä¼¼ã€‚  å…³äº Flink ä¸­æ—¶é—´å¤„ç†çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§å…³äºäº‹ä»¶æ—¶é—´å’Œæ°´å°çš„ä»‹ç»ã€‚\næœ¬é¡µè§£é‡Šäº†å¦‚ä½•åœ¨ Flink çš„è¡¨ API å’Œ SQL ä¸­ä¸ºåŸºäºæ—¶é—´çš„æ“ä½œå®šä¹‰æ—¶é—´å±æ€§ã€‚\næ—¶é—´å±æ€§ä»‹ç» Table API å’Œ SQL ä¸­çš„çª—å£ç­‰åŸºäºæ—¶é—´çš„æ“ä½œéƒ½éœ€è¦æ—¶é—´æ¦‚å¿µåŠå…¶æ¥æºçš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œè¡¨å¯ä»¥æä¾›é€»è¾‘æ—¶é—´å±æ€§ï¼Œç”¨äºæŒ‡ç¤ºæ—¶é—´å’Œåœ¨è¡¨ç¨‹åºä¸­è®¿é—®ç›¸åº”çš„æ—¶é—´æˆ³ã€‚\næ—¶é—´å±æ€§å¯ä»¥æˆä¸ºæ¯ä¸ªè¡¨æ¨¡å¼çš„ä¸€éƒ¨åˆ†ã€‚å®ƒä»¬æ˜¯åœ¨ä» CREATE TABLE DDL æˆ– DataStream åˆ›å»ºè¡¨æ—¶å®šä¹‰çš„ï¼Œæˆ–è€…æ˜¯åœ¨ä½¿ç”¨ TableSource æ—¶é¢„å…ˆå®šä¹‰çš„ã€‚ä¸€æ—¦åœ¨å¼€å§‹æ—¶å®šä¹‰äº†æ—¶é—´å±æ€§ï¼Œå®ƒå°±å¯ä»¥ä½œä¸ºä¸€ä¸ªå­—æ®µè¢«å¼•ç”¨ï¼Œå¹¶ä¸”å¯ä»¥åœ¨åŸºäºæ—¶é—´çš„æ“ä½œä¸­ä½¿ç”¨ã€‚\nåªè¦æ—¶é—´å±æ€§æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œåªæ˜¯ä»æŸ¥è¯¢çš„ä¸€ä¸ªéƒ¨åˆ†è½¬å‘åˆ°å¦ä¸€ä¸ªéƒ¨åˆ†ï¼Œå®ƒä»ç„¶æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ—¶é—´å±æ€§ã€‚æ—¶é—´å±æ€§çš„è¡Œä¸ºå°±åƒå¸¸è§„çš„æ—¶é—´æˆ³ä¸€æ ·ï¼Œå¯ä»¥è¢«è®¿é—®è¿›è¡Œè®¡ç®—ã€‚å¦‚æœåœ¨è®¡ç®—ä¸­ä½¿ç”¨äº†æ—¶é—´å±æ€§ï¼Œå®ƒå°†è¢«å…·ä½“åŒ–å¹¶æˆä¸ºå¸¸è§„æ—¶é—´æˆ³ã€‚å¸¸è§„æ—¶é—´æˆ³ä¸ä¸ Flink çš„æ—¶é—´å’Œæ°´å°ç³»ç»Ÿåˆä½œï¼Œå› æ­¤ä¸èƒ½å†ç”¨äºåŸºäºæ—¶é—´çš„æ“ä½œã€‚\nè¡¨ç¨‹åºè¦æ±‚å·²ç»ä¸ºæµç¯å¢ƒæŒ‡å®šäº†ç›¸åº”çš„æ—¶é—´ç‰¹å¾ã€‚\nval env = StreamExecutionEnvironment.getExecutionEnvironment env.setStreamTimeCharacteristic(TimeCharacteristic.ProcessingTime) // default  // alternatively: // env.setStreamTimeCharacteristic(TimeCharacteristic.IngestionTime) // env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime) å¤„ç†æ—¶é—´ å¤„ç†æ—¶é—´å…è®¸è¡¨ç¨‹åºæ ¹æ®æœ¬åœ°æœºå™¨çš„æ—¶é—´äº§ç”Ÿç»“æœã€‚å®ƒæ˜¯æœ€ç®€å•çš„æ—¶é—´æ¦‚å¿µï¼Œä½†ä¸æä¾›ç¡®å®šæ€§ã€‚å®ƒæ—¢ä¸éœ€è¦æå–æ—¶é—´æˆ³ï¼Œä¹Ÿä¸éœ€è¦ç”Ÿæˆæ°´å°ã€‚\næœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥å®šä¹‰å¤„ç†æ—¶é—´å±æ€§ã€‚\nåœ¨åˆ›å»ºè¡¨ DDL ä¸­å®šä¹‰ å¤„ç†æ—¶é—´å±æ€§æ˜¯åœ¨åˆ›å»ºè¡¨ DDL ä¸­ä½¿ç”¨ç³»ç»Ÿ PROCTIME()å‡½æ•°å®šä¹‰ä¸ºè®¡ç®—åˆ—ã€‚å…³äºè®¡ç®—åˆ—çš„æ›´å¤šä¿¡æ¯è¯·å‚è§ CREATE TABLE DDLã€‚\nCREATETABLEuser_actions(user_nameSTRING,dataSTRING,user_action_timeASPROCTIME()-- declare an additional field as a processing time attribute )WITH(...);SELECTTUMBLE_START(user_action_time,INTERVAL\u0026#39;10\u0026#39;MINUTE),COUNT(DISTINCTuser_name)FROMuser_actionsGROUPBYTUMBLE(user_action_time,INTERVAL\u0026#39;10\u0026#39;MINUTE);åœ¨ DataStream-to-Table è½¬æ¢æœŸé—´ å¤„ç†æ—¶é—´å±æ€§æ˜¯åœ¨æ¨¡å¼å®šä¹‰è¿‡ç¨‹ä¸­ç”¨ .proctime å±æ€§å®šä¹‰çš„ã€‚æ—¶é—´å±æ€§åªèƒ½é€šè¿‡ä¸€ä¸ªé¢å¤–çš„é€»è¾‘å­—æ®µæ¥æ‰©å±•ç‰©ç†æ¨¡å¼ã€‚å› æ­¤ï¼Œå®ƒåªèƒ½åœ¨æ¨¡å¼å®šä¹‰çš„æœ€åå®šä¹‰ã€‚\nval stream: DataStream[(String, String)] = ... // declare an additional logical field as a processing time attribute val table = tEnv.fromDataStream(stream, $\u0026#34;UserActionTimestamp\u0026#34;, $\u0026#34;user_name\u0026#34;, $\u0026#34;data\u0026#34;, $\u0026#34;user_action_time\u0026#34;.proctime) val windowedTable = table.window(Tumble over 10.minutes on $\u0026#34;user_action_time\u0026#34; as \u0026#34;userActionWindow\u0026#34;) ä½¿ç”¨ Table Source å¤„ç†æ—¶é—´å±æ€§ç”±å®ç° DefinedProctimeAttribute æ¥å£çš„ TableSource å®šä¹‰ã€‚é€»è¾‘æ—¶é—´å±æ€§é™„åŠ åˆ°ç”± TableSource çš„è¿”å›ç±»å‹å®šä¹‰çš„ç‰©ç†æ¨¡å¼ä¸­ã€‚\n// define a table source with a processing attribute class UserActionSource extends StreamTableSource[Row] with DefinedProctimeAttribute { override def getReturnType = { val names = Array[String](\u0026#34;user_name\u0026#34; , \u0026#34;data\u0026#34;) val types = Array[TypeInformation[_]](Types.STRING, Types.STRING) Types.ROW(names, types) } override def getDataStream(execEnv: StreamExecutionEnvironment): DataStream[Row] = { // create stream \tval stream = ... stream } override def getProctimeAttribute = { // field with this name will be appended as a third field \t\u0026#34;user_action_time\u0026#34; } } // register table source tEnv.registerTableSource(\u0026#34;user_actions\u0026#34;, new UserActionSource) val windowedTable = tEnv .from(\u0026#34;user_actions\u0026#34;) .window(Tumble over 10.minutes on $\u0026#34;user_action_time\u0026#34; as \u0026#34;userActionWindow\u0026#34;) äº‹ä»¶æ—¶é—´ äº‹ä»¶æ—¶é—´å…è®¸è¡¨æ ¼ç¨‹åºæ ¹æ®æ¯æ¡è®°å½•ä¸­åŒ…å«çš„æ—¶é—´äº§ç”Ÿç»“æœã€‚è¿™ä½¿å¾—å³ä½¿åœ¨äº‹ä»¶å¤±åºæˆ–äº‹ä»¶è¿Ÿåˆ°çš„æƒ…å†µä¸‹ï¼Œä¹Ÿèƒ½å¾—åˆ°ä¸€è‡´çš„ç»“æœã€‚å½“ä»æŒä¹…å­˜å‚¨ä¸­è¯»å–è®°å½•æ—¶ï¼Œå®ƒè¿˜èƒ½ä¿è¯è¡¨ç¨‹åºçš„ç»“æœå¯é‡æ”¾ã€‚\næ­¤å¤–ï¼Œäº‹ä»¶æ—¶é—´å…è®¸åœ¨æ‰¹å¤„ç†å’Œæµç¯å¢ƒä¸­å¯¹è¡¨ç¨‹åºè¿›è¡Œç»Ÿä¸€çš„è¯­æ³•ã€‚æµå¼ç¯å¢ƒä¸­çš„æ—¶é—´å±æ€§å¯ä»¥æ˜¯æ‰¹å¤„ç†ç¯å¢ƒä¸­è®°å½•çš„å¸¸è§„å­—æ®µã€‚\nä¸ºäº†å¤„ç†å¤±åºäº‹ä»¶ï¼ŒåŒºåˆ†æµå¼ç¯å¢ƒä¸­äº‹ä»¶çš„å‡†æ—¶å’Œè¿Ÿåˆ°ï¼ŒFlink éœ€è¦ä»äº‹ä»¶ä¸­æå–æ—¶é—´æˆ³ï¼Œå¹¶åœ¨æ—¶é—´ä¸Šåšå‡ºæŸç§è¿›å±•ï¼ˆæ‰€è°“çš„æ°´å°ï¼‰ã€‚\näº‹ä»¶æ—¶é—´å±æ€§æ—¢å¯ä»¥åœ¨åˆ›å»ºè¡¨ DDL ä¸­å®šä¹‰ï¼Œä¹Ÿå¯ä»¥åœ¨ DataStream åˆ°è¡¨çš„è½¬æ¢è¿‡ç¨‹ä¸­å®šä¹‰ï¼Œæˆ–è€…ä½¿ç”¨ TableSource å®šä¹‰ã€‚\nåœ¨åˆ›å»ºè¡¨ DDL ä¸­å®šä¹‰ äº‹ä»¶æ—¶é—´å±æ€§æ˜¯åœ¨ CREATE TABLE DDL ä¸­ä½¿ç”¨ WATERMARK è¯­å¥å®šä¹‰çš„ã€‚æ°´å°è¯­å¥åœ¨ç°æœ‰çš„äº‹ä»¶æ—¶é—´å­—æ®µä¸Šå®šä¹‰äº†ä¸€ä¸ªæ°´å°ç”Ÿæˆè¡¨è¾¾å¼ï¼Œå°†äº‹ä»¶æ—¶é—´å­—æ®µæ ‡è®°ä¸ºäº‹ä»¶æ—¶é—´å±æ€§ã€‚å…³äºæ°´å°è¯­å¥å’Œæ°´å°ç­–ç•¥çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ CREATE TABLE DDLã€‚\nCREATETABLEuser_actions(user_nameSTRING,dataSTRING,user_action_timeTIMESTAMP(3),-- declare user_action_time as event time attribute and use 5 seconds delayed watermark strategy WATERMARKFORuser_action_timeASuser_action_time-INTERVAL\u0026#39;5\u0026#39;SECOND)WITH(...);SELECTTUMBLE_START(user_action_time,INTERVAL\u0026#39;10\u0026#39;MINUTE),COUNT(DISTINCTuser_name)FROMuser_actionsGROUPBYTUMBLE(user_action_time,INTERVAL\u0026#39;10\u0026#39;MINUTE);åœ¨ DataStream-to-Table è½¬æ¢æœŸé—´ äº‹ä»¶æ—¶é—´å±æ€§æ˜¯åœ¨æ¨¡å¼å®šä¹‰æœŸé—´ç”¨ .rowtime å±æ€§å®šä¹‰çš„ã€‚æ—¶é—´æˆ³å’Œæ°´å°å¿…é¡»åœ¨è¢«è½¬æ¢çš„ DataStream ä¸­è¢«åˆ†é…ã€‚\nåœ¨å°† DataStream è½¬æ¢ä¸ºè¡¨æ—¶ï¼Œæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥å®šä¹‰æ—¶é—´å±æ€§ã€‚æ ¹æ®æŒ‡å®šçš„.rowtime å­—æ®µåæ˜¯å¦å­˜åœ¨äº DataStream çš„æ¨¡å¼ä¸­ï¼Œæ—¶é—´æˆ³å­—æ®µè¦ä¹ˆæ˜¯\n ä½œä¸ºä¸€ä¸ªæ–°çš„å­—æ®µæ·»åŠ åˆ°æ¨¡å¼ä¸­ï¼Œæˆ– æ›¿æ¢ä¸€ä¸ªç°æœ‰çš„å­—æ®µã€‚  æ— è®ºå“ªç§æƒ…å†µï¼Œäº‹ä»¶æ—¶é—´æˆ³å­—æ®µéƒ½å°†æŒæœ‰ DataStream äº‹ä»¶æ—¶é—´æˆ³çš„å€¼ã€‚\n// Option 1:  // extract timestamp and assign watermarks based on knowledge of the stream val stream: DataStream[(String, String)] = inputStream.assignTimestampsAndWatermarks(...) // declare an additional logical field as an event time attribute val table = tEnv.fromDataStream(stream, $\u0026#34;user_name\u0026#34;, $\u0026#34;data\u0026#34;, $\u0026#34;user_action_time\u0026#34;.rowtime) // Option 2:  // extract timestamp from first field, and assign watermarks based on knowledge of the stream val stream: DataStream[(Long, String, String)] = inputStream.assignTimestampsAndWatermarks(...) // the first field has been used for timestamp extraction, and is no longer necessary // replace first field with a logical event time attribute val table = tEnv.fromDataStream(stream, $\u0026#34;user_action_time\u0026#34;.rowtime, $\u0026#34;user_name\u0026#34;, $\u0026#34;data\u0026#34;) // Usage:  val windowedTable = table.window(Tumble over 10.minutes on $\u0026#34;user_action_time\u0026#34; as \u0026#34;userActionWindow\u0026#34;) ä½¿ç”¨ TableSource äº‹ä»¶æ—¶é—´å±æ€§ç”±ä¸€ä¸ªå®ç° DefinedRowtimeAttributes æ¥å£çš„ TableSource å®šä¹‰ã€‚getRowtimeAttributeDescriptors() æ–¹æ³•è¿”å›ä¸€ä¸ª RowtimeAttributeDescriptor åˆ—è¡¨ï¼Œç”¨äºæè¿°æ—¶é—´å±æ€§çš„æœ€ç»ˆåç§°ï¼Œä¸€ä¸ªç”¨äºå¯¼å‡ºå±æ€§å€¼çš„æ—¶é—´æˆ³æå–å™¨ï¼Œä»¥åŠä¸å±æ€§ç›¸å…³çš„æ°´å°ç­–ç•¥ã€‚\nè¯·ç¡®ä¿ getDataStream() æ–¹æ³•è¿”å›çš„ DataStream ä¸å®šä¹‰çš„æ—¶é—´å±æ€§ä¸€è‡´ã€‚åªæœ‰å½“å®šä¹‰äº† StreamRecordTimestamp æ—¶é—´æˆ³æå–å™¨æ—¶ï¼Œæ‰ä¼šè€ƒè™‘ DataStream çš„æ—¶é—´æˆ³ï¼ˆç”± TimestampAssigner åˆ†é…çš„æ—¶é—´æˆ³ï¼‰ã€‚åªæœ‰å®šä¹‰äº† PreserveWatermarks æ°´å°ç­–ç•¥ï¼ŒDataStream çš„æ°´å°æ‰ä¼šè¢«ä¿ç•™ã€‚å¦åˆ™ï¼Œåªæœ‰ TableSource çš„ rowtime å±æ€§çš„å€¼æ˜¯ç›¸å…³çš„ã€‚\n// define a table source with a rowtime attribute class UserActionSource extends StreamTableSource[Row] with DefinedRowtimeAttributes { override def getReturnType = { val names = Array[String](\u0026#34;user_name\u0026#34; , \u0026#34;data\u0026#34;, \u0026#34;user_action_time\u0026#34;) val types = Array[TypeInformation[_]](Types.STRING, Types.STRING, Types.LONG) Types.ROW(names, types) } override def getDataStream(execEnv: StreamExecutionEnvironment): DataStream[Row] = { // create stream \t// ... \t// assign watermarks based on the \u0026#34;user_action_time\u0026#34; attribute \tval stream = inputStream.assignTimestampsAndWatermarks(...) stream } override def getRowtimeAttributeDescriptors: util.List[RowtimeAttributeDescriptor] = { // Mark the \u0026#34;user_action_time\u0026#34; attribute as event-time attribute. \t// We create one attribute descriptor of \u0026#34;user_action_time\u0026#34;. \tval rowtimeAttrDescr = new RowtimeAttributeDescriptor( \u0026#34;user_action_time\u0026#34;, new ExistingField(\u0026#34;user_action_time\u0026#34;), new AscendingTimestamps) val listRowtimeAttrDescr = Collections.singletonList(rowtimeAttrDescr) listRowtimeAttrDescr } } // register the table source tEnv.registerTableSource(\u0026#34;user_actions\u0026#34;, new UserActionSource) val windowedTable = tEnv .from(\u0026#34;user_actions\u0026#34;) .window(Tumble over 10.minutes on $\u0026#34;user_action_time\u0026#34; as \u0026#34;userActionWindow\u0026#34;) åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/streaming/time_attributes.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-time-attributes/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL"],"title":"æ—¶é—´å±æ€§"},{"categories":["Flink"],"contents":"æœ¬åœ°æ‰§è¡Œ Flink å¯ä»¥åœ¨ä¸€å°æœºå™¨ä¸Šè¿è¡Œï¼Œç”šè‡³åœ¨ä¸€å° Java è™šæ‹Ÿæœºä¸­è¿è¡Œã€‚è¿™ä½¿å¾—ç”¨æˆ·å¯ä»¥åœ¨æœ¬åœ°æµ‹è¯•å’Œè°ƒè¯• Flink ç¨‹åºã€‚æœ¬èŠ‚å°†å¯¹æœ¬åœ°æ‰§è¡Œæœºåˆ¶è¿›è¡Œæ¦‚è¿°ã€‚\næœ¬åœ°ç¯å¢ƒå’Œæ‰§è¡Œå™¨å…è®¸ä½ åœ¨æœ¬åœ° Java è™šæ‹Ÿæœºä¸­è¿è¡Œ Flink ç¨‹åºï¼Œæˆ–è€…ä½œä¸ºç°æœ‰ç¨‹åºçš„ä¸€éƒ¨åˆ†åœ¨ä»»ä½• JVM ä¸­è¿è¡Œã€‚å¤§å¤šæ•°ä¾‹å­å¯ä»¥é€šè¿‡ç®€å•åœ°ç‚¹å‡» IDE çš„\u0026quot;è¿è¡Œ\u0026quot;æŒ‰é’®åœ¨æœ¬åœ°å¯åŠ¨ã€‚\nFlink ä¸­æ”¯æŒä¸¤ç§ä¸åŒçš„æœ¬åœ°æ‰§è¡Œã€‚LocalExecutionEnvironment æ˜¯å¯åŠ¨å®Œæ•´çš„ Flink è¿è¡Œæ—¶ï¼ŒåŒ…æ‹¬ä¸€ä¸ª JobManager å’Œä¸€ä¸ª TaskManagerã€‚è¿™äº›åŒ…æ‹¬å†…å­˜ç®¡ç†å’Œæ‰€æœ‰åœ¨é›†ç¾¤æ¨¡å¼ä¸‹æ‰§è¡Œçš„å†…éƒ¨ç®—æ³•ã€‚\nCollectionEnvironment æ˜¯åœ¨ Java é›†åˆä¸Šæ‰§è¡Œ Flink ç¨‹åºã€‚è¿™ç§æ¨¡å¼ä¸ä¼šå¯åŠ¨å®Œæ•´çš„ Flink è¿è¡Œæ—¶ï¼Œæ‰€ä»¥æ‰§è¡Œçš„å¼€é”€éå¸¸ä½ï¼Œè€Œä¸”æ˜¯è½»é‡çº§çš„ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª DataSet.map() è½¬æ¢å°†é€šè¿‡å°† map() å‡½æ•°åº”ç”¨äº Java åˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ æ¥æ‰§è¡Œã€‚\nè°ƒè¯• å¦‚æœä½ åœ¨æœ¬åœ°è¿è¡Œ Flink ç¨‹åºï¼Œä½ ä¹Ÿå¯ä»¥åƒå…¶ä»– Java ç¨‹åºä¸€æ ·è°ƒè¯•ä½ çš„ç¨‹åºã€‚ä½ å¯ä»¥ä½¿ç”¨ System.out.println() æ¥å†™å‡ºä¸€äº›å†…éƒ¨å˜é‡ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è°ƒè¯•å™¨ã€‚å¯ä»¥åœ¨ map()ã€reduce() å’Œå…¶ä»–æ‰€æœ‰æ–¹æ³•ä¸­è®¾ç½®æ–­ç‚¹ã€‚ä¹Ÿè¯·å‚è€ƒ Java API æ–‡æ¡£ä¸­çš„è°ƒè¯•éƒ¨åˆ†ï¼Œäº†è§£ Java API ä¸­çš„æµ‹è¯•å’Œæœ¬åœ°è°ƒè¯•å·¥å…·çš„æŒ‡å—ã€‚\nMaven ä¾èµ– å¦‚æœä½ æ˜¯åœ¨ Maven é¡¹ç›®ä¸­å¼€å‘ç¨‹åºï¼Œä½ å¿…é¡»ä½¿ç”¨è¿™ä¸ªä¾èµ–å…³ç³»æ·»åŠ  flink-clients æ¨¡å—ã€‚\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.flink\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flink-clients_2.11\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.11.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; æœ¬åœ°ç¯å¢ƒ LocalEnvironment æ˜¯ Flink ç¨‹åºæœ¬åœ°æ‰§è¡Œçš„ä¸€ä¸ªå¥æŸ„ã€‚ä½¿ç”¨å®ƒå¯ä»¥åœ¨æœ¬åœ° JVM ä¸­è¿è¡Œç¨‹åº\u0026ndash;ç‹¬ç«‹æˆ–åµŒå…¥å…¶ä»–ç¨‹åºä¸­ã€‚\næœ¬åœ°ç¯å¢ƒæ˜¯é€šè¿‡ ExecutionEnvironment.createLocalEnvironment() æ–¹æ³•å®ä¾‹åŒ–çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå°†ä½¿ç”¨ä¸ä½ çš„æœºå™¨æœ‰å¤šå°‘ CPU æ ¸ï¼ˆç¡¬ä»¶ä¸Šä¸‹æ–‡ï¼‰ä¸€æ ·å¤šçš„æœ¬åœ°çº¿ç¨‹æ¥æ‰§è¡Œã€‚æ‚¨ä¹Ÿå¯ä»¥æŒ‡å®šæ‰€éœ€çš„å¹¶è¡Œåº¦ã€‚æœ¬åœ°ç¯å¢ƒå¯ä»¥é…ç½®ä¸ºä½¿ç”¨ enableLogging()/disableLogging() å°†æ—¥å¿—è®°å½•åˆ°æ§åˆ¶å°ã€‚\nåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè°ƒç”¨ ExecutionEnvironment.getExecutionEnvironment() æ˜¯æ›´å¥½çš„æ–¹æ³•ã€‚å½“ç¨‹åºåœ¨æœ¬åœ°ï¼ˆå‘½ä»¤è¡Œæ¥å£ä¹‹å¤–ï¼‰å¯åŠ¨æ—¶ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª LocalEnvironmentï¼Œå½“ç¨‹åºè¢«å‘½ä»¤è¡Œæ¥å£è°ƒç”¨æ—¶ï¼Œè¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªé¢„é…ç½®çš„é›†ç¾¤æ‰§è¡Œç¯å¢ƒã€‚\npublic static void main(String[] args) throws Exception { ExecutionEnvironment env = ExecutionEnvironment.createLocalEnvironment(); DataSet\u0026lt;String\u0026gt; data = env.readTextFile(\u0026#34;file:///path/to/file\u0026#34;); data .filter(new FilterFunction\u0026lt;String\u0026gt;() { public boolean filter(String value) { return value.startsWith(\u0026#34;http://\u0026#34;); } }) .writeAsText(\u0026#34;file:///path/to/result\u0026#34;); JobExecutionResult res = env.execute(); } åœ¨æ‰§è¡Œç»“æŸåè¿”å›çš„ JobExecutionResult å¯¹è±¡ï¼ŒåŒ…å«äº†ç¨‹åºè¿è¡Œæ—¶é—´å’Œç´¯åŠ å™¨ç»“æœã€‚\nLocalEnvironment è¿˜å…è®¸å‘ Flink ä¼ é€’è‡ªå®šä¹‰é…ç½®å€¼ã€‚\nConfiguration conf = new Configuration(); conf.setFloat(ConfigConstants.TASK_MANAGER_MEMORY_FRACTION_KEY, 0.5f); final ExecutionEnvironment env = ExecutionEnvironment.createLocalEnvironment(conf); æ³¨æ„ï¼šæœ¬åœ°æ‰§è¡Œç¯å¢ƒä¸å¯åŠ¨ä»»ä½• Web å‰ç«¯æ¥ç›‘æ§æ‰§è¡Œã€‚\næ”¶é›†ç¯å¢ƒ ä½¿ç”¨ CollectionEnvironment åœ¨ Java é›†åˆä¸Šæ‰§è¡Œæ˜¯ä¸€ç§æ‰§è¡Œ Flink ç¨‹åºçš„ä½å¼€é”€æ–¹æ³•ã€‚è¿™ç§æ¨¡å¼çš„å…¸å‹ç”¨ä¾‹æ˜¯è‡ªåŠ¨æµ‹è¯•ã€è°ƒè¯•å’Œä»£ç é‡ç”¨ã€‚\nç”¨æˆ·å¯ä»¥ä½¿ç”¨ä¸ºæ‰¹å¤„ç†è€Œå®ç°çš„ç®—æ³•ï¼Œä¹Ÿå¯ä»¥ç”¨äºäº¤äº’æ€§æ›´å¼ºçš„æƒ…å†µã€‚Flink ç¨‹åºçš„ä¸€ä¸ªç¨å¾®æ”¹å˜çš„å˜ä½“å¯ä»¥ç”¨äº Java åº”ç”¨æœåŠ¡å™¨ä¸­å¤„ç†ä¼ å…¥çš„è¯·æ±‚ã€‚\nåŸºäºé›†åˆæ‰§è¡Œçš„éª¨æ¶:\npublic static void main(String[] args) throws Exception { // initialize a new Collection-based execution environment  final ExecutionEnvironment env = new CollectionEnvironment(); DataSet\u0026lt;User\u0026gt; users = env.fromCollection( /* get elements from a Java Collection */); /* Data Set transformations ... */ // retrieve the resulting Tuple2 elements into a ArrayList.  Collection\u0026lt;...\u0026gt; result = new ArrayList\u0026lt;...\u0026gt;(); resultDataSet.output(new LocalCollectionOutputFormat\u0026lt;...\u0026gt;(result)); // kick off execution.  env.execute(); // Do some work with the resulting ArrayList (=Collection).  for(... t : result) { System.err.println(\u0026#34;Result = \u0026#34;+t); } } flink-examples-batch æ¨¡å—åŒ…å«ä¸€ä¸ªå®Œæ•´çš„ä¾‹å­ï¼Œå«åš CollectionExecutionExampleã€‚\nè¯·æ³¨æ„ï¼ŒåŸºäºé›†åˆçš„ Flink ç¨‹åºçš„æ‰§è¡Œåªå¯èƒ½åœ¨å°æ•°æ®ä¸Šæ‰§è¡Œï¼Œå°æ•°æ®é€‚åˆ JVM å †ã€‚åœ¨é›†åˆä¸Šçš„æ‰§è¡Œä¸æ˜¯å¤šçº¿ç¨‹çš„ï¼Œåªä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹ã€‚\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/local_execution.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-local-execution/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataSet API"],"title":"æœ¬åœ°æ‰§è¡Œ"},{"categories":["Flink"],"contents":"æŸ¥è¯¢ SELECT è¯­å¥å’Œ VALUES è¯­å¥æ˜¯ç”¨ TableEnvironment çš„ sqlQuery()æ–¹æ³•æŒ‡å®šçš„ã€‚è¯¥æ–¹æ³•å°† SELECT è¯­å¥ï¼ˆæˆ– VALUES è¯­å¥ï¼‰çš„ç»“æœä½œä¸ºä¸€ä¸ªè¡¨è¿”å›ã€‚è¡¨å¯ä»¥åœ¨åç»­çš„ SQL å’Œ Table API æŸ¥è¯¢ä¸­ä½¿ç”¨ï¼Œå¯ä»¥è½¬æ¢ä¸º DataSet æˆ– DataStreamï¼Œä¹Ÿå¯ä»¥å†™å…¥ TableSinkã€‚SQL å’Œ Table API æŸ¥è¯¢å¯ä»¥æ— ç¼æ··åˆï¼Œå¹¶è¿›è¡Œæ•´ä½“ä¼˜åŒ–ï¼Œè½¬åŒ–ä¸ºä¸€ä¸ªç¨‹åºã€‚\nä¸ºäº†åœ¨ SQL æŸ¥è¯¢ä¸­è®¿é—®ä¸€ä¸ªè¡¨ï¼Œå¿…é¡»åœ¨ TableEnvironment ä¸­æ³¨å†Œã€‚è¡¨å¯ä»¥ä» TableSourceã€Tableã€CREATE TABLE è¯­å¥ã€DataStream æˆ– DataSet ä¸­æ³¨å†Œã€‚å¦å¤–ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥åœ¨ TableEnvironment ä¸­æ³¨å†Œç›®å½•æ¥æŒ‡å®šæ•°æ®æºçš„ä½ç½®ã€‚\nä¸ºäº†æ–¹ä¾¿èµ·è§ï¼ŒTable.toString()ä¼šè‡ªåŠ¨åœ¨å…¶ TableEnvironment ä¸­ä»¥å”¯ä¸€çš„åç§°æ³¨å†Œè¡¨ï¼Œå¹¶è¿”å›åç§°ã€‚æ‰€ä»¥ï¼ŒTable å¯¹è±¡å¯ä»¥ç›´æ¥å†…è”åˆ° SQL æŸ¥è¯¢ä¸­ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚\næ³¨æ„ï¼šåŒ…å«ä¸æ”¯æŒçš„ SQL ç‰¹æ€§çš„æŸ¥è¯¢ä¼šå¯¼è‡´ TableExceptionã€‚æ‰¹é‡è¡¨å’Œæµå¼è¡¨çš„ SQL æ”¯æŒçš„åŠŸèƒ½åœ¨ä¸‹é¢çš„ç« èŠ‚ä¸­åˆ—å‡ºã€‚\næŒ‡å®šæŸ¥è¯¢ ä¸‹é¢çš„ä¾‹å­æ˜¾ç¤ºäº†å¦‚ä½•åœ¨æ³¨å†Œè¡¨å’Œå†…è”è¡¨ä¸ŠæŒ‡å®š SQL æŸ¥è¯¢ã€‚\nval env = StreamExecutionEnvironment.getExecutionEnvironment val tableEnv = StreamTableEnvironment.create(env) // read a DataStream from an external source val ds: DataStream[(Long, String, Integer)] = env.addSource(...) // SQL query with an inlined (unregistered) table val table = ds.toTable(tableEnv, $\u0026#34;user\u0026#34;, $\u0026#34;product\u0026#34;, $\u0026#34;amount\u0026#34;) val result = tableEnv.sqlQuery( s\u0026#34;SELECT SUM(amount) FROM $tableWHERE product LIKE \u0026#39;%Rubber%\u0026#39;\u0026#34;) // SQL query with a registered table // register the DataStream under the name \u0026#34;Orders\u0026#34; tableEnv.createTemporaryView(\u0026#34;Orders\u0026#34;, ds, $\u0026#34;user\u0026#34;, $\u0026#34;product\u0026#34;, $\u0026#34;amount\u0026#34;) // run a SQL query on the Table and retrieve the result as a new Table val result2 = tableEnv.sqlQuery( \u0026#34;SELECT product, amount FROM Orders WHERE product LIKE \u0026#39;%Rubber%\u0026#39;\u0026#34;) // create and register a TableSink val schema = new Schema() .field(\u0026#34;product\u0026#34;, DataTypes.STRING()) .field(\u0026#34;amount\u0026#34;, DataTypes.INT()) tableEnv.connect(new FileSystem(\u0026#34;/path/to/file\u0026#34;)) .withFormat(...) .withSchema(schema) .createTemporaryTable(\u0026#34;RubberOrders\u0026#34;) // run an INSERT SQL on the Table and emit the result to the TableSink tableEnv.executeSql( \u0026#34;INSERT INTO RubberOrders SELECT product, amount FROM Orders WHERE product LIKE \u0026#39;%Rubber%\u0026#39;\u0026#34;) æ‰§è¡ŒæŸ¥è¯¢ å¯ä»¥é€šè¿‡ TableEnvironment.executeSql()æ–¹æ³•æ‰§è¡Œ SELECT è¯­å¥æˆ– VALUES è¯­å¥ï¼Œå°†å†…å®¹æ”¶é›†åˆ°æœ¬åœ°ã€‚è¯¥æ–¹æ³•å°† SELECT è¯­å¥ï¼ˆæˆ– VALUES è¯­å¥ï¼‰çš„ç»“æœä½œä¸º TableResult è¿”å›ã€‚ä¸ SELECT è¯­å¥ç±»ä¼¼ï¼Œå¯ä»¥ä½¿ç”¨ Table.execute()æ–¹æ³•æ‰§è¡Œ Table å¯¹è±¡ï¼Œå°†æŸ¥è¯¢çš„å†…å®¹æ”¶é›†åˆ°æœ¬åœ°å®¢æˆ·ç«¯ã€‚TableResult.collect()æ–¹æ³•è¿”å›ä¸€ä¸ªå¯å…³é—­çš„è¡Œè¿­ä»£å™¨ã€‚é™¤éæ”¶é›†å®Œæ‰€æœ‰çš„ç»“æœæ•°æ®ï¼Œå¦åˆ™é€‰æ‹©ä½œä¸šä¸ä¼šç»“æŸã€‚æˆ‘ä»¬åº”è¯¥é€šè¿‡ CloseableIterator#close()æ–¹æ³•ä¸»åŠ¨å…³é—­ä½œä¸šï¼Œé¿å…èµ„æºæ³„éœ²ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ TableResult.print()æ–¹æ³•å°†é€‰æ‹©ç»“æœæ‰“å°åˆ°å®¢æˆ·ç«¯æ§åˆ¶å°ã€‚TableResult ä¸­çš„ç»“æœæ•°æ®åªèƒ½è¢«è®¿é—®ä¸€æ¬¡ã€‚å› æ­¤ï¼Œcollect()å’Œ print()ä¸èƒ½ç›¸ç»§è¢«è°ƒç”¨ã€‚\nå¯¹äºæµå¼ä½œä¸šï¼ŒTableResult.collect()æ–¹æ³•æˆ– TableResult.print()æ–¹æ³•å¯ä»¥ä¿è¯ç«¯åˆ°ç«¯çš„ç²¾ç¡®ä¸€æ¬¡è®°å½•ä¼ é€’ã€‚è¿™éœ€è¦å¯ç”¨æ£€æŸ¥ç‚¹æœºåˆ¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ£€æŸ¥ç‚¹æœºåˆ¶æ˜¯è¢«ç¦ç”¨çš„ã€‚è¦å¯ç”¨æ£€æŸ¥ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ TableConfig è®¾ç½®æ£€æŸ¥ç‚¹å±æ€§ï¼ˆè¯¦è§æ£€æŸ¥ç‚¹é…ç½®ï¼‰ã€‚æ‰€ä»¥ä¸€æ¡ç»“æœè®°å½•åªæœ‰åœ¨å…¶å¯¹åº”çš„æ£€æŸ¥ç‚¹å®Œæˆåæ‰èƒ½è¢«å®¢æˆ·ç«¯è®¿é—®ã€‚\næ³¨æ„äº‹é¡¹ å¯¹äºæµåª’ä½“æ¨¡å¼ï¼Œç°åœ¨åªæ”¯æŒåªè¿½åŠ æŸ¥è¯¢ã€‚\nval env = StreamExecutionEnvironment.getExecutionEnvironment() val tableEnv = StreamTableEnvironment.create(env, settings) // enable checkpointing tableEnv.getConfig.getConfiguration.set( ExecutionCheckpointingOptions.CHECKPOINTING_MODE, CheckpointingMode.EXACTLY_ONCE) tableEnv.getConfig.getConfiguration.set( ExecutionCheckpointingOptions.CHECKPOINTING_INTERVAL, Duration.ofSeconds(10)) tableEnv.executeSql(\u0026#34;CREATE TABLE Orders (`user` BIGINT, product STRING, amount INT) WITH (...)\u0026#34;) // execute SELECT statement val tableResult1 = tableEnv.executeSql(\u0026#34;SELECT * FROM Orders\u0026#34;) val it = tableResult1.collect() try while (it.hasNext) { val row = it.next // handle row } finally it.close() // close the iterator to avoid resource leak  // execute Table val tableResult2 = tableEnv.sqlQuery(\u0026#34;SELECT * FROM Orders\u0026#34;).execute() tableResult2.print() è¯­æ³• Flink ä½¿ç”¨ Apache Calcite è§£æ SQLï¼Œå®ƒæ”¯æŒæ ‡å‡†çš„ ANSI SQLã€‚\nä¸‹é¢çš„ BNF-è¯­æ³•æè¿°äº†åœ¨æ‰¹å¤„ç†å’Œæµå¼æŸ¥è¯¢ä¸­æ”¯æŒçš„ SQL ç‰¹æ€§çš„è¶…é›†ã€‚æ“ä½œéƒ¨åˆ†æ˜¾ç¤ºäº†æ”¯æŒçš„ç‰¹æ€§çš„ä¾‹å­ï¼Œå¹¶æŒ‡å‡ºå“ªäº›ç‰¹æ€§åªæ”¯æŒæ‰¹å¤„ç†æˆ–æµå¼æŸ¥è¯¢ã€‚\nquery: values | { select | selectWithoutFrom | query UNION [ ALL ] query | query EXCEPT query | query INTERSECT query } [ ORDER BY orderItem [, orderItem ]* ] [ LIMIT { count | ALL } ] [ OFFSET start { ROW | ROWS } ] [ FETCH { FIRST | NEXT } [ count ] { ROW | ROWS } ONLY] orderItem: expression [ ASC | DESC ] select: SELECT [ ALL | DISTINCT ] { * | projectItem [, projectItem ]* } FROM tableExpression [ WHERE booleanExpression ] [ GROUP BY { groupItem [, groupItem ]* } ] [ HAVING booleanExpression ] [ WINDOW windowName AS windowSpec [, windowName AS windowSpec ]* ] selectWithoutFrom: SELECT [ ALL | DISTINCT ] { * | projectItem [, projectItem ]* } projectItem: expression [ [ AS ] columnAlias ] | tableAlias . * tableExpression: tableReference [, tableReference ]* | tableExpression [ NATURAL ] [ LEFT | RIGHT | FULL ] JOIN tableExpression [ joinCondition ] joinCondition: ON booleanExpression | USING '(' column [, column ]* ')' tableReference: tablePrimary [ matchRecognize ] [ [ AS ] alias [ '(' columnAlias [, columnAlias ]* ')' ] ] tablePrimary: [ TABLE ] [ [ catalogName . ] schemaName . ] tableName [ dynamicTableOptions ] | LATERAL TABLE '(' functionName '(' expression [, expression ]* ')' ')' | UNNEST '(' expression ')' dynamicTableOptions: /*+ OPTIONS(key=val [, key=val]*) */ key: stringLiteral val: stringLiteral values: VALUES expression [, expression ]* groupItem: expression | '(' ')' | '(' expression [, expression ]* ')' | CUBE '(' expression [, expression ]* ')' | ROLLUP '(' expression [, expression ]* ')' | GROUPING SETS '(' groupItem [, groupItem ]* ')' windowRef: windowName | windowSpec windowSpec: [ windowName ] '(' [ ORDER BY orderItem [, orderItem ]* ] [ PARTITION BY expression [, expression ]* ] [ RANGE numericOrIntervalExpression {PRECEDING} | ROWS numericExpression {PRECEDING} ] ')' matchRecognize: MATCH_RECOGNIZE '(' [ PARTITION BY expression [, expression ]* ] [ ORDER BY orderItem [, orderItem ]* ] [ MEASURES measureColumn [, measureColumn ]* ] [ ONE ROW PER MATCH ] [ AFTER MATCH ( SKIP TO NEXT ROW | SKIP PAST LAST ROW | SKIP TO FIRST variable | SKIP TO LAST variable | SKIP TO variable ) ] PATTERN '(' pattern ')' [ WITHIN intervalLiteral ] DEFINE variable AS condition [, variable AS condition ]* ')' measureColumn: expression AS alias pattern: patternTerm [ '|' patternTerm ]* patternTerm: patternFactor [ patternFactor ]* patternFactor: variable [ patternQuantifier ] patternQuantifier: '*' | '*?' | '+' | '+?' | '?' | '??' | '{' { [ minRepeat ], [ maxRepeat ] } '}' ['?'] | '{' repeat '}' Flink SQL å¯¹æ ‡è¯†ç¬¦ï¼ˆè¡¨åã€å±æ€§åã€å‡½æ•°åï¼‰ä½¿ç”¨äº†ç±»ä¼¼ Java çš„è¯æ±‡ç­–ç•¥ã€‚\næ— è®ºæ ‡è¯†ç¬¦æ˜¯å¦è¢«å¼•ç”¨ï¼Œå®ƒä»¬çš„å¤§å°å†™éƒ½ä¼šè¢«ä¿ç•™ã€‚ ä¹‹åï¼Œæ ‡è¯†ç¬¦ä¼šè¢«å¤§å°å†™æ•æ„Ÿåœ°åŒ¹é…ã€‚ ä¸ Java ä¸åŒçš„æ˜¯ï¼Œå›æ ‡å…è®¸æ ‡è¯†ç¬¦åŒ…å«éå­—æ¯æ•°å­—å­—ç¬¦ï¼ˆä¾‹å¦‚ï¼š\u0026ldquo;SELECT a ASmy fieldFROM t\u0026rdquo;ï¼‰ã€‚ å­—ç¬¦ä¸²å¿…é¡»ç”¨å•å¼•å·æ‹¬èµ·æ¥ï¼ˆä¾‹å¦‚ï¼ŒSELECT \u0026lsquo;Hello World\u0026rsquo;ï¼‰ã€‚é‡å¤ä¸€ä¸ªå•å¼•å·è¿›è¡Œè½¬ä¹‰ï¼ˆä¾‹å¦‚ï¼ŒSELECT \u0026lsquo;It\u0026rsquo;s me.'ï¼‰ã€‚å­—ç¬¦ä¸²ä¸­æ”¯æŒ Unicode å­—ç¬¦ã€‚å¦‚æœéœ€è¦æ˜ç¡®çš„ unicode ç ç‚¹ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹è¯­æ³•ã€‚\nä½¿ç”¨åæ–œæ ï¼ˆ\\ï¼‰ä½œä¸ºè½¬ä¹‰å­—ç¬¦ï¼ˆé»˜è®¤ï¼‰ã€‚SELECT U\u0026amp;'\\263A\u0026rsquo; ä½¿ç”¨è‡ªå®šä¹‰è½¬ä¹‰å­—ç¬¦ã€‚SELECT U\u0026amp;'#263A' UESCAPE \u0026lsquo;#'ã€‚\nOperations Scan, Projection å’Œ Filter  Scan / Select / As(Batch/Streaming)  SELECT*FROMOrdersSELECTa,cASdFROMOrders Where / Filter(Batch/Streaming)  SELECT*FROMOrdersWHEREb=\u0026#39;red\u0026#39;SELECT*FROMOrdersWHEREa%2=0 ç”¨æˆ·å®šä¹‰æ ‡é‡å‡½æ•° (Scalar UDF)(Batch/Streaming)  UDF å¿…é¡»åœ¨ TableEnvironment ä¸­æ³¨å†Œã€‚å…³äºå¦‚ä½•æŒ‡å®šå’Œæ³¨å†Œæ ‡é‡ UDF çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§ UDF æ–‡æ¡£ã€‚\nSELECTPRETTY_PRINT(user)FROMOrdersèšåˆ  GroupBy èšåˆ(Batch/Streaming/Result Updating)  æ³¨æ„ï¼šæµè¡¨ä¸Šçš„ GroupBy ä¼šäº§ç”Ÿæ›´æ–°ç»“æœã€‚è¯¦æƒ…è¯·å‚è§åŠ¨æ€è¡¨æµæ¦‚å¿µé¡µé¢ã€‚\nSELECTa,SUM(b)asdFROMOrdersGROUPBYa GroupBy çª—å£èšåˆ(Batch/Streaming)  ä½¿ç”¨åˆ†ç»„çª—å£æ¥è®¡ç®—æ¯ä¸ªç»„çš„å•ä¸€ç»“æœè¡Œã€‚æ›´å¤šç»†èŠ‚è¯·å‚è§åˆ†ç»„çª—å£éƒ¨åˆ†ã€‚\nSELECTuser,SUM(amount)FROMOrdersGROUPBYTUMBLE(rowtime,INTERVAL\u0026#39;1\u0026#39;DAY),user Over çª—å£èšåˆ(Streaming)  æ³¨æ„ï¼šæ‰€æœ‰çš„èšåˆå¿…é¡»å®šä¹‰åœ¨åŒä¸€ä¸ªçª—å£ä¸Šï¼Œå³ç›¸åŒçš„åˆ†åŒºã€æ’åºå’ŒèŒƒå›´ã€‚ç›®å‰ï¼Œåªæ”¯æŒå¯¹ CURRENT ROW èŒƒå›´çš„ PRECEDINGï¼ˆUNBOUNDED å’Œ boundedï¼‰çª—å£ã€‚è¿˜ä¸æ”¯æŒå¸¦ FOLLOWING çš„èŒƒå›´ã€‚ORDER BY å¿…é¡»åœ¨å•ä¸ªæ—¶é—´å±æ€§ä¸ŠæŒ‡å®šã€‚\nSELECTCOUNT(amount)OVER(PARTITIONBYuserORDERBYproctimeROWSBETWEEN2PRECEDINGANDCURRENTROW)FROMOrdersSELECTCOUNT(amount)OVERw,SUM(amount)OVERwFROMOrdersWINDOWwAS(PARTITIONBYuserORDERBYproctimeROWSBETWEEN2PRECEDINGANDCURRENTROW) Distinct(Batch/Streaming/Result Updating)  SELECTDISTINCTusersFROMOrdersæ³¨æ„ï¼šå¯¹äºæµå¼æŸ¥è¯¢ï¼Œè®¡ç®—æŸ¥è¯¢ç»“æœæ‰€éœ€çš„çŠ¶æ€å¯èƒ½ä¼šæ ¹æ®ä¸åŒå­—æ®µçš„æ•°é‡è€Œæ— é™å¢é•¿ã€‚è¯·æä¾›ä¸€ä¸ªæœ‰æ•ˆçš„ä¿ç•™æ—¶é—´é—´éš”çš„æŸ¥è¯¢é…ç½®ï¼Œä»¥é˜²æ­¢è¿‡å¤§çš„çŠ¶æ€å¤§å°ã€‚è¯¦æƒ…è¯·çœ‹æŸ¥è¯¢é…ç½®ã€‚\n Grouping sets, Rollup, Cube(Batch/Streaming/Result Updating)  SELECTSUM(amount)FROMOrdersGROUPBYGROUPINGSETS((user),(product))æ³¨ï¼šæµå¼æ¨¡å¼åˆ†ç»„é›†ã€Rollup å’Œ Cube ä»…åœ¨ Blink è®¡åˆ’å™¨ä¸­æ”¯æŒã€‚\n Having(Batch/Streaming)  SELECTSUM(amount)FROMOrdersGROUPBYusersHAVINGSUM(amount)\u0026gt;50 ç”¨æˆ·å®šä¹‰èšåˆå‡½æ•° (UDAGG)(Batch/Streaming)  UDAGG å¿…é¡»åœ¨ TableEnvironment ä¸­æ³¨å†Œã€‚å…³äºå¦‚ä½•æŒ‡å®šå’Œæ³¨å†Œ UDAGG çš„ç»†èŠ‚ï¼Œè¯·å‚è§ UDF æ–‡æ¡£ã€‚\nSELECTMyAggregate(amount)FROMOrdersGROUPBYusersJoins  Inner Equi-join(Batch/Streaming)  ç›®å‰ï¼Œåªæ”¯æŒç­‰ä»·è¿æ¥ï¼Œå³è‡³å°‘æœ‰ä¸€ä¸ªå¸¦æœ‰å¹³ç­‰è°“è¯çš„å…±è½­æ¡ä»¶çš„è¿æ¥ï¼Œä¸æ”¯æŒä»»æ„çš„äº¤å‰è¿æ¥æˆ–Î¸è¿æ¥ã€‚ä¸æ”¯æŒä»»æ„çš„äº¤å‰è¿æ¥æˆ–Î¸è¿æ¥ã€‚\næ³¨æ„ï¼šè¿æ¥çš„é¡ºåºæ²¡æœ‰è¢«ä¼˜åŒ–ã€‚è¡¨çš„è¿æ¥é¡ºåºæ˜¯æŒ‰ç…§ FROM å­å¥ä¸­æŒ‡å®šçš„é¡ºåºè¿›è¡Œçš„ã€‚ç¡®ä¿æŒ‡å®šè¡¨çš„é¡ºåºä¸ä¼šäº§ç”Ÿäº¤å‰è¿æ¥ï¼ˆç¬›å¡å°”ä¹˜ç§¯ï¼‰ï¼Œå› ä¸ºäº¤å‰è¿æ¥ä¸æ”¯æŒï¼Œä¼šå¯¼è‡´æŸ¥è¯¢å¤±è´¥ã€‚\nSELECT*FROMOrdersINNERJOINProductONOrders.productId=Product.idæ³¨æ„ï¼šå¯¹äºæµå¼æŸ¥è¯¢ï¼Œè®¡ç®—æŸ¥è¯¢ç»“æœæ‰€éœ€çš„çŠ¶æ€å¯èƒ½ä¼šæ ¹æ®ä¸åŒè¾“å…¥è¡Œçš„æ•°é‡è€Œæ— é™å¢é•¿ã€‚è¯·æä¾›ä¸€ä¸ªå…·æœ‰æœ‰æ•ˆä¿ç•™æ—¶é—´é—´éš”çš„æŸ¥è¯¢é…ç½®ï¼Œä»¥é˜²æ­¢çŠ¶æ€å¤§å°è¿‡å¤§ã€‚è¯¦æƒ…è¯·çœ‹æŸ¥è¯¢é…ç½®ã€‚\n Outer Equi-join(Batch/Streaming/Result Updating)  ç›®å‰ï¼Œåªæ”¯æŒ equi-joins è¿æ¥ï¼Œå³è‡³å°‘æœ‰ä¸€ä¸ªå¸¦æœ‰å¹³ç­‰è°“è¯çš„å…±è½­æ¡ä»¶çš„è¿æ¥ï¼Œä¸æ”¯æŒä»»æ„çš„äº¤å‰è¿æ¥æˆ–Î¸è¿æ¥ã€‚ä¸æ”¯æŒä»»æ„çš„äº¤å‰è¿æ¥æˆ–Î¸è¿æ¥ã€‚\næ³¨æ„ï¼šè¿æ¥çš„é¡ºåºæ²¡æœ‰è¢«ä¼˜åŒ–ã€‚è¡¨çš„è¿æ¥é¡ºåºæ˜¯æŒ‰ç…§ FROM å­å¥ä¸­æŒ‡å®šçš„é¡ºåºè¿›è¡Œçš„ã€‚ç¡®ä¿æŒ‡å®šè¡¨çš„é¡ºåºä¸ä¼šäº§ç”Ÿäº¤å‰è¿æ¥ï¼ˆç¬›å¡å°”ä¹˜ç§¯ï¼‰ï¼Œå› ä¸ºäº¤å‰è¿æ¥ä¸æ”¯æŒï¼Œä¼šå¯¼è‡´æŸ¥è¯¢å¤±è´¥ã€‚\nSELECT*FROMOrdersLEFTJOINProductONOrders.productId=Product.idSELECT*FROMOrdersRIGHTJOINProductONOrders.productId=Product.idSELECT*FROMOrdersFULLOUTERJOINProductONOrders.productId=Product.idæ³¨æ„ï¼šå¯¹äºæµå¼æŸ¥è¯¢ï¼Œè®¡ç®—æŸ¥è¯¢ç»“æœæ‰€éœ€çš„çŠ¶æ€å¯èƒ½ä¼šæ ¹æ®ä¸åŒè¾“å…¥è¡Œçš„æ•°é‡è€Œæ— é™å¢é•¿ã€‚è¯·æä¾›ä¸€ä¸ªå…·æœ‰æœ‰æ•ˆä¿ç•™æ—¶é—´é—´éš”çš„æŸ¥è¯¢é…ç½®ï¼Œä»¥é˜²æ­¢çŠ¶æ€å¤§å°è¿‡å¤§ã€‚è¯¦æƒ…è¯·çœ‹æŸ¥è¯¢é…ç½®ã€‚\n Interval Join(Batch/Streaming)  æ³¨ï¼šåŒºé—´è¿æ¥æ˜¯å¸¸è§„è¿æ¥çš„ä¸€ä¸ªå­é›†ï¼Œå¯ä»¥ç”¨æµå¼å¤„ç†ã€‚\nä¸€ä¸ªåŒºé—´è¿æ¥è‡³å°‘éœ€è¦ä¸€ä¸ªç­‰ä»·è¿æ¥è°“è¯å’Œä¸€ä¸ªè¿æ¥æ¡ä»¶ï¼Œä»¥é™åˆ¶åŒæ–¹çš„æ—¶é—´ã€‚è¿™æ ·çš„æ¡ä»¶å¯ä»¥ç”±ä¸¤ä¸ªåˆé€‚çš„èŒƒå›´è°“è¯ï¼ˆ\u0026lt;ï¼Œ\u0026lt;=ï¼Œ\u0026gt;=ï¼Œ\u0026gt;ï¼‰ã€ä¸€ä¸ª BETWEEN è°“è¯æˆ–ä¸€ä¸ªæ¯”è¾ƒä¸¤ä¸ªè¾“å…¥è¡¨çš„ç›¸åŒç±»å‹çš„æ—¶é—´å±æ€§ï¼ˆå³å¤„ç†æ—¶é—´æˆ–äº‹ä»¶æ—¶é—´ï¼‰çš„å•ä¸€å¹³ç­‰è°“è¯æ¥å®šä¹‰ã€‚\nä¾‹å¦‚ï¼Œä»¥ä¸‹è°“è¯æ˜¯æœ‰æ•ˆçš„åŒºé—´è¿æ¥æ¡ä»¶ã€‚\n ltime = rtime ltime \u0026gt;= rtime AND ltime \u0026lt; rtime + INTERVAL \u0026lsquo;10\u0026rsquo; MINUTE ltime BETWEEN rtime - INTERVAL \u0026lsquo;10\u0026rsquo; SECOND AND rtime + INTERVAL \u0026lsquo;5\u0026rsquo; SECOND  SELECT*FROMOrderso,ShipmentssWHEREo.id=s.orderIdANDo.ordertimeBETWEENs.shiptime-INTERVAL\u0026#39;4\u0026#39;HOURANDs.shiptimeä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœåœ¨æ”¶åˆ°è®¢å• 4 å°æ—¶åæ‰å‘è´§ï¼Œé‚£ä¹ˆå°±ä¼šå°†æ‰€æœ‰çš„è®¢å•ä¸å…¶å¯¹åº”çš„è´§ç‰©åŠ å…¥ã€‚\n å°†æ•°ç»„æ‰©å±•ä¸ºå…³ç³»(Batch/Streaming)  è¿˜ä¸æ”¯æŒ Unnesting With ORDINALITYã€‚\nSELECTusers,tagFROMOrdersCROSSJOINUNNEST(tags)ASt(tag) Join with Table Function (UDTF)(Batch/Streaming)  ç”¨è¡¨æ ¼å‡½æ•°çš„ç»“æœè¿æ¥ä¸€ä¸ªè¡¨æ ¼ã€‚å·¦è¡¨ï¼ˆå¤–è¡¨ï¼‰çš„æ¯ä¸€è¡Œéƒ½ä¸è¡¨å‡½æ•°çš„ç›¸åº”è°ƒç”¨æ‰€äº§ç”Ÿçš„æ‰€æœ‰è¡Œç›¸è¿æ¥ã€‚\nç”¨æˆ·å®šä¹‰è¡¨å‡½æ•°ï¼ˆUDTFï¼‰å¿…é¡»åœ¨ä¹‹å‰æ³¨å†Œã€‚å…³äºå¦‚ä½•æŒ‡å®šå’Œæ³¨å†Œ UDTF çš„ç»†èŠ‚ï¼Œè¯·å‚è§ UDF æ–‡æ¡£ã€‚\nInner Join\nå·¦è¡¨ï¼ˆå¤–è¡¨ï¼‰çš„ä¸€è¡Œï¼Œå¦‚æœå®ƒçš„è¡¨å‡½æ•°è°ƒç”¨è¿”å›ä¸€ä¸ªç©ºçš„ç»“æœï¼Œå°±ä¼šè¢«åˆ é™¤ã€‚\nSELECTusers,tagFROMOrders,LATERALTABLE(unnest_udtf(tags))tAStagLeft Outer Join\nå¦‚æœè¡¨å‡½æ•°è°ƒç”¨è¿”å›çš„ç»“æœä¸ºç©ºï¼Œåˆ™ä¿ç•™ç›¸åº”çš„å¤–è¡Œï¼Œå¹¶å°†ç»“æœç”¨ç©ºå€¼å¡«å……ã€‚\nSELECTusers,tagFROMOrdersLEFTJOINLATERALTABLE(unnest_udtf(tags))tAStagONTRUEæ³¨æ„ï¼šç›®å‰ï¼Œåªæœ‰å­—é¢æ„ä¹‰ä¸Šçš„ \u0026ldquo;TRUE \u0026ldquo;è¢«æ”¯æŒä¸ºé’ˆå¯¹æ¨ªå‘è¡¨çš„å·¦å¤–è¿æ¥çš„è°“è¯ã€‚\n Join with Temporal Table Function(Streaming)  æ—¶é—´è¡¨æ˜¯è·Ÿè¸ªéšæ—¶é—´å˜åŒ–çš„è¡¨ã€‚\næ—¶é—´è¡¨å‡½æ•°æä¾›äº†å¯¹æ—¶é—´è¡¨åœ¨ç‰¹å®šæ—¶é—´ç‚¹çš„çŠ¶æ€çš„è®¿é—®ã€‚ä½¿ç”¨æ—¶æ€è¡¨å‡½æ•°è¿æ¥è¡¨çš„è¯­æ³•ä¸ä½¿ç”¨è¡¨å‡½æ•°è¿æ¥ç›¸åŒã€‚\næ³¨æ„ï¼šç›®å‰åªæ”¯æŒä¸æ—¶æ€è¡¨çš„å†…éƒ¨è¿æ¥ã€‚\nå‡è®¾ Rates æ˜¯ä¸€ä¸ªæ—¶é—´è¡¨å‡½æ•°ï¼Œè¿æ¥å¯ä»¥ç”¨ SQL è¡¨è¾¾å¦‚ä¸‹ã€‚\nSELECTo_amount,r_rateFROMOrders,LATERALTABLE(Rates(o_proctime))WHEREr_currency=o_currencyæ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹æ›´è¯¦ç»†çš„æ—¶é—´è¡¨æ¦‚å¿µè¯´æ˜ã€‚\n Join with Temporal Table(Batch/Streaming)  æ—¶é—´è¡¨æ˜¯è·Ÿè¸ªéšæ—¶é—´å˜åŒ–çš„è¡¨ã€‚æ—¶é—´è¡¨æä¾›äº†å¯¹æ—¶é—´è¡¨åœ¨ç‰¹å®šæ—¶é—´ç‚¹çš„ç‰ˆæœ¬çš„è®¿é—®ã€‚\nåªæ”¯æŒä¸å¤„ç†æ—¶é—´çš„æ—¶æ€è¡¨è¿›è¡Œå†…è”å’Œå·¦è”ã€‚\nä¸‹é¢çš„ä¾‹å­å‡è®¾ LatestRates æ˜¯ä¸€ä¸ªæ—¶é—´è¡¨ï¼Œå®ƒæ˜¯ä»¥æœ€æ–°çš„é€Ÿç‡æ¥å…·ä½“åŒ–çš„ã€‚\nSELECTo.amout,o.currency,r.rate,o.amount*r.rateFROMOrdersASoJOINLatestRatesFORSYSTEM_TIMEASOFo.proctimeASrONr.currency=o.currencyæ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹æ›´è¯¦ç»†çš„æ—¶é—´è¡¨æ¦‚å¿µæè¿°ã€‚\nä»…æ”¯æŒ Blink è®¡åˆ’å™¨ã€‚\né›†åˆè¿ç®—  Union(Batch)  SELECT*FROM((SELECTuserFROMOrdersWHEREa%2=0)UNION(SELECTuserFROMOrdersWHEREb=0)) UnionAll(Batch/Streaming)  SELECT*FROM((SELECTuserFROMOrdersWHEREa%2=0)UNIONALL(SELECTuserFROMOrdersWHEREb=0)) Intersect / Except(Batch)  SELECT*FROM((SELECTuserFROMOrdersWHEREa%2=0)INTERSECT(SELECTuserFROMOrdersWHEREb=0))SELECT*FROM((SELECTuserFROMOrdersWHEREa%2=0)EXCEPT(SELECTuserFROMOrdersWHEREb=0)) In(Batch/Streaming)  å¦‚æœç»™å®šè¡¨çš„å­æŸ¥è¯¢ä¸­å­˜åœ¨è¡¨è¾¾å¼ï¼Œåˆ™è¿”å› trueã€‚å­æŸ¥è¯¢è¡¨å¿…é¡»ç”±ä¸€åˆ—ç»„æˆã€‚è¯¥åˆ—å¿…é¡»ä¸è¡¨è¾¾å¼å…·æœ‰ç›¸åŒçš„æ•°æ®ç±»å‹ã€‚\nSELECTuser,amountFROMOrdersWHEREproductIN(SELECTproductFROMNewProducts)æ³¨æ„ï¼šå¯¹äºæµå¼æŸ¥è¯¢ï¼Œè¯¥æ“ä½œè¢«é‡å†™ä¸ºåŠ å…¥å’Œåˆ†ç»„æ“ä½œã€‚è®¡ç®—æŸ¥è¯¢ç»“æœæ‰€éœ€çš„çŠ¶æ€å¯èƒ½ä¼šæ ¹æ®ä¸åŒè¾“å…¥è¡Œçš„æ•°é‡è€Œæ— é™å¢é•¿ã€‚è¯·æä¾›æœ‰æ•ˆçš„ä¿ç•™æ—¶é—´é—´éš”çš„æŸ¥è¯¢é…ç½®ï¼Œä»¥é˜²æ­¢çŠ¶æ€å¤§å°è¿‡å¤§ã€‚è¯¦æƒ…è¯·çœ‹æŸ¥è¯¢é…ç½®ã€‚\n Exists(Batch/Streaming)  å¦‚æœå­æŸ¥è¯¢è‡³å°‘è¿”å›ä¸€æ¡è®°å½•ï¼Œåˆ™è¿”å› trueã€‚åªæœ‰å½“æ“ä½œå¯ä»¥è¢«é‡å†™æˆè”æ¥å’Œåˆ†ç»„æ“ä½œæ—¶æ‰æ”¯æŒã€‚\nSELECTuser,amountFROMOrdersWHEREproductEXISTS(SELECTproductFROMNewProducts)æ³¨æ„ï¼šå¯¹äºæµå¼æŸ¥è¯¢ï¼Œè¯¥æ“ä½œè¢«é‡å†™ä¸ºåŠ å…¥å’Œåˆ†ç»„æ“ä½œã€‚è®¡ç®—æŸ¥è¯¢ç»“æœæ‰€éœ€çš„çŠ¶æ€å¯èƒ½ä¼šæ ¹æ®ä¸åŒè¾“å…¥è¡Œçš„æ•°é‡è€Œæ— é™å¢é•¿ã€‚è¯·æä¾›æœ‰æ•ˆçš„ä¿ç•™æ—¶é—´é—´éš”çš„æŸ¥è¯¢é…ç½®ï¼Œä»¥é˜²æ­¢çŠ¶æ€å¤§å°è¿‡å¤§ã€‚è¯¦æƒ…è¯·çœ‹æŸ¥è¯¢é…ç½®ã€‚\nOrderBy å’Œ Limit  Order By  æ‰¹é‡æµæ³¨ï¼šæµæŸ¥è¯¢çš„ç»“æœå¿…é¡»ä¸»è¦æŒ‰å‡åºæ—¶é—´å±æ€§è¿›è¡Œæ’åºã€‚æ”¯æŒå…¶ä»–æ’åºå±æ€§ã€‚\nSELECT*FROMOrdersORDERBYorderTime Limit(Batch)  æ³¨æ„ï¼šLIMIT å­å¥éœ€è¦ä¸€ä¸ª ORDER BY å­å¥ã€‚\nSELECT*FROMOrdersORDERBYorderTimeLIMIT3Top-N æ³¨æ„ Top-N åªåœ¨ Blink planner ä¸­æ”¯æŒã€‚\nTop-N æŸ¥è¯¢è¦æ±‚æŒ‰åˆ—æ’åºçš„ N ä¸ªæœ€å°æˆ–æœ€å¤§çš„å€¼ã€‚æœ€å°å€¼å’Œæœ€å¤§å€¼é›†éƒ½è¢«è®¤ä¸ºæ˜¯ Top-N æŸ¥è¯¢ã€‚å½“éœ€è¦ä»æ‰¹å¤„ç†/æµå¤„ç†è¡¨ä¸­åªæ˜¾ç¤º N æ¡æœ€åº•å±‚æˆ–æœ€ä¸Šå±‚çš„è®°å½•æ—¶ï¼ŒTop-N æŸ¥è¯¢éå¸¸æœ‰ç”¨ã€‚è¿™ä¸ªç»“æœé›†å¯ä»¥ç”¨äºè¿›ä¸€æ­¥åˆ†æã€‚\nFlink ä½¿ç”¨ OVER çª—å£å­å¥å’Œè¿‡æ»¤æ¡ä»¶çš„ç»„åˆæ¥è¡¨è¾¾ Top-N æŸ¥è¯¢ã€‚å€ŸåŠ© OVER window PARTITION BY å­å¥çš„å¼ºå¤§åŠŸèƒ½ï¼ŒFlink è¿˜æ”¯æŒæ¯ç»„ Top-Nã€‚ä¾‹å¦‚ï¼Œæ¯ä¸ªç±»åˆ«ä¸­å®æ—¶é”€å”®é‡æœ€å¤§çš„å‰äº”ä¸ªäº§å“ã€‚å¯¹äºæ‰¹å¤„ç†è¡¨å’Œæµå¤„ç†è¡¨çš„ SQLï¼Œéƒ½æ”¯æŒ Top-N æŸ¥è¯¢ã€‚\nä¸‹é¢æ˜¯ TOP-N è¯­å¥çš„è¯­æ³•ã€‚\nSELECT[column_list]FROM(SELECT[column_list],ROW_NUMBER()OVER([PARTITIONBYcol1[,col2...]]ORDERBYcol1[asc|desc][,col2[asc|desc]...])ASrownumFROMtable_name)WHERErownum\u0026lt;=N[ANDconditions]å‚æ•°è¯´æ˜:\n ROW_NUMBER()ã€‚æ ¹æ®åˆ†åŒºå†…è¡Œçš„é¡ºåºï¼Œç»™æ¯ä¸€è¡Œåˆ†é…ä¸€ä¸ªå”¯ä¸€çš„ã€è¿ç»­çš„æ•°å­—ï¼Œä» 1 å¼€å§‹ã€‚ç›®å‰ï¼Œæˆ‘ä»¬åªæ”¯æŒ ROW_NUMBER ä½œä¸º over window å‡½æ•°ã€‚åœ¨æœªæ¥ï¼Œæˆ‘ä»¬å°†æ”¯æŒ RANK()å’Œ DENSE_RANK()ã€‚ PARTITION BY col1[ï¼Œcol2\u0026hellip;]ã€‚æŒ‡å®šåˆ†åŒºåˆ—ã€‚æ¯ä¸ªåˆ†åŒºå°†æœ‰ä¸€ä¸ª Top-N çš„ç»“æœã€‚ ORDER BY col1[asc|desc][ï¼Œcol2[asc|desc]\u0026hellip;]ï¼šæŒ‡å®šæ’åºåˆ—ã€‚æŒ‡å®šæ’åºåˆ—ã€‚ä¸åŒåˆ—çš„æ’åºæ–¹å‘å¯ä»¥ä¸åŒã€‚ WHERE rownum \u0026lt;= Nï¼šä¸ºäº†è®© Flink è¯†åˆ«è¿™ä¸ªæŸ¥è¯¢æ˜¯ Top-N æŸ¥è¯¢ï¼Œéœ€è¦ rownum \u0026lt;= Nã€‚N ä»£è¡¨å°†ä¿ç•™ N æ¡æœ€å°æˆ–æœ€å¤§çš„è®°å½•ã€‚ [AND æ¡ä»¶]ã€‚åœ¨ where å­å¥ä¸­å¯ä»¥è‡ªç”±æ·»åŠ å…¶ä»–æ¡ä»¶ï¼Œä½†å…¶ä»–æ¡ä»¶åªèƒ½ä¸ rownum \u0026lt;= N ä½¿ç”¨ AND è¿æ¥ç»„åˆã€‚  æµæ¨¡å¼ä¸‹çš„æ³¨æ„ç‚¹: TopN æŸ¥è¯¢æ˜¯ç»“æœæ›´æ–°ã€‚Flink SQL ä¼šæ ¹æ®é¡ºåºé”®å¯¹è¾“å…¥çš„æ•°æ®æµè¿›è¡Œæ’åºï¼Œæ‰€ä»¥å¦‚æœå‰ N æ¡è®°å½•å‘ç”Ÿäº†å˜åŒ–ï¼Œå˜åŒ–åçš„è®°å½•ä¼šä½œä¸ºå›æ’¤/æ›´æ–°è®°å½•å‘é€åˆ°ä¸‹æ¸¸ã€‚å»ºè®®ä½¿ç”¨æ”¯æŒæ›´æ–°çš„å­˜å‚¨ä½œä¸º Top-N æŸ¥è¯¢çš„æ±‡ã€‚å¦å¤–ï¼Œå¦‚æœ Top N è®°å½•éœ€è¦å­˜å‚¨åœ¨å¤–éƒ¨å­˜å‚¨ä¸­ï¼Œç»“æœè¡¨åº”è¯¥ä¸ Top-N æŸ¥è¯¢çš„å”¯ä¸€é”®ç›¸åŒã€‚\nTop-N æŸ¥è¯¢çš„å”¯ä¸€é”®æ˜¯åˆ†åŒºåˆ—å’Œ rownum åˆ—çš„ç»„åˆã€‚Top-N æŸ¥è¯¢ä¹Ÿå¯ä»¥å¾—å‡ºä¸Šæ¸¸çš„å”¯ä¸€é”®ã€‚ä»¥ä¸‹é¢çš„å·¥ä½œä¸ºä¾‹ï¼Œå‡è®¾ product_id æ˜¯ ShopSales çš„å”¯ä¸€é”®ï¼Œé‚£ä¹ˆ Top-N æŸ¥è¯¢çš„å”¯ä¸€é”®æ˜¯[categoryï¼Œrownum]å’Œ[product_id]ã€‚\nä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨æµè¡¨ä¸Šä½¿ç”¨ Top-N æŒ‡å®š SQL æŸ¥è¯¢ã€‚è¿™ä¸ªä¾‹å­æ˜¯ä¸ºäº†å¾—åˆ°æˆ‘ä»¬ä¸Šé¢æåˆ°çš„ \u0026ldquo;æ¯ä¸ªç±»åˆ«å®æ—¶é”€é‡æœ€å¤§çš„å‰äº”ä¸ªäº§å“\u0026rdquo;ã€‚\nval env = StreamExecutionEnvironment.getExecutionEnvironment val tableEnv = TableEnvironment.getTableEnvironment(env) // read a DataStream from an external source val ds: DataStream[(String, String, String, Long)] = env.addSource(...) // register the DataStream under the name \u0026#34;ShopSales\u0026#34; tableEnv.createTemporaryView(\u0026#34;ShopSales\u0026#34;, ds, $\u0026#34;product_id\u0026#34;, $\u0026#34;category\u0026#34;, $\u0026#34;product_name\u0026#34;, $\u0026#34;sales\u0026#34;) // select top-5 products per category which have the maximum sales. val result1 = tableEnv.sqlQuery( \u0026#34;\u0026#34;\u0026#34; |SELECT * |FROM ( | SELECT *, | ROW_NUMBER() OVER (PARTITION BY category ORDER BY sales DESC) as row_num | FROM ShopSales) |WHERE row_num \u0026lt;= 5 \u0026#34;\u0026#34;\u0026#34;.stripMargin) æ— æ’åè¾“å‡ºä¼˜åŒ– å¦‚ä¸Šæ‰€è¿°ï¼Œrownum å­—æ®µå°†ä½œä¸ºå”¯ä¸€é”®çš„ä¸€ä¸ªå­—æ®µå†™å…¥ç»“æœè¡¨ï¼Œè¿™å¯èƒ½å¯¼è‡´å¾ˆå¤šè®°å½•è¢«å†™å…¥ç»“æœè¡¨ã€‚ä¾‹å¦‚ï¼Œå½“æ’å 9 çš„è®°å½•ï¼ˆæ¯”å¦‚äº§å“-1001ï¼‰æ›´æ–°ï¼Œå…¶æ’åå‡çº§ä¸º 1 æ—¶ï¼Œæ’å 1~9 çš„æ‰€æœ‰è®°å½•éƒ½ä¼šä½œä¸ºæ›´æ–°æ¶ˆæ¯è¾“å‡ºåˆ°ç»“æœè¡¨ã€‚å¦‚æœç»“æœè¡¨æ¥æ”¶çš„æ•°æ®è¿‡å¤šï¼Œå°±ä¼šæˆä¸º SQL ä½œä¸šçš„ç“¶é¢ˆã€‚\nä¼˜åŒ–çš„æ–¹å¼æ˜¯åœ¨ Top-N æŸ¥è¯¢çš„å¤–ä¾§ SELECT å­å¥ä¸­çœç•¥ rownum å­—æ®µã€‚è¿™æ ·åšæ˜¯åˆç†çš„ï¼Œå› ä¸º Top N è®°å½•çš„æ•°é‡é€šå¸¸ä¸å¤šï¼Œå› æ­¤æ¶ˆè´¹è€…å¯ä»¥è‡ªå·±å¿«é€Ÿæ’åºã€‚å¦‚æœæ²¡æœ‰ rownum å­—æ®µï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œåªéœ€è¦å°†æ”¹å˜çš„è®°å½•ï¼ˆproduct-1001ï¼‰å‘é€åˆ°ä¸‹æ¸¸ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å¾ˆå¤šç»“æœè¡¨çš„ IOã€‚\nä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•ç”¨è¿™ç§æ–¹å¼ä¼˜åŒ–ä¸Šé¢çš„ Top-N ä¾‹å­ã€‚\nval env = StreamExecutionEnvironment.getExecutionEnvironment val tableEnv = TableEnvironment.getTableEnvironment(env) // read a DataStream from an external source val ds: DataStream[(String, String, String, Long)] = env.addSource(...) // register the DataStream under the name \u0026#34;ShopSales\u0026#34; tableEnv.createTemporaryView(\u0026#34;ShopSales\u0026#34;, ds, $\u0026#34;product_id\u0026#34;, $\u0026#34;category\u0026#34;, $\u0026#34;product_name\u0026#34;, $\u0026#34;sales\u0026#34;) // select top-5 products per category which have the maximum sales. val result1 = tableEnv.sqlQuery( \u0026#34;\u0026#34;\u0026#34; |SELECT product_id, category, product_name, sales -- omit row_num field in the output |FROM ( | SELECT *, | ROW_NUMBER() OVER (PARTITION BY category ORDER BY sales DESC) as row_num | FROM ShopSales) |WHERE row_num \u0026lt;= 5 \u0026#34;\u0026#34;\u0026#34;.stripMargin) æµæ¨¡å¼ä¸‹çš„æ³¨æ„ç‚¹: ä¸ºäº†å°†ä¸Šè¿°æŸ¥è¯¢è¾“å‡ºåˆ°å¤–éƒ¨å­˜å‚¨ä¸­ï¼Œå¹¶å¾—åˆ°æ­£ç¡®çš„ç»“æœï¼Œå¤–éƒ¨å­˜å‚¨å¿…é¡»ä¸ Top-N æŸ¥è¯¢å…·æœ‰ç›¸åŒçš„å”¯ä¸€é”®ï¼Œåœ¨ä¸Šé¢çš„ç¤ºä¾‹æŸ¥è¯¢ä¸­ï¼Œå¦‚æœ product_id æ˜¯æŸ¥è¯¢çš„å”¯ä¸€é”®ï¼Œé‚£ä¹ˆå¤–éƒ¨è¡¨ä¹Ÿåº”è¯¥ä»¥ product_id ä½œä¸ºå”¯ä¸€é”®ã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹æŸ¥è¯¢ä¸­ï¼Œå¦‚æœ product_id æ˜¯æŸ¥è¯¢çš„å”¯ä¸€é”®ï¼Œé‚£ä¹ˆå¤–éƒ¨è¡¨ä¹Ÿåº”è¯¥ä»¥ product_id ä½œä¸ºå”¯ä¸€é”®ã€‚\né‡å¤æ•°æ®åˆ é™¤ æ³¨æ„ é‡å¤æ•°æ®åˆ é™¤åªåœ¨ Blink planner ä¸­æ”¯æŒã€‚\né‡å¤æ•°æ®åˆ é™¤å°±æ˜¯åˆ é™¤ä¸€ç»„åˆ—ä¸Šé‡å¤çš„è¡Œï¼Œåªä¿ç•™ç¬¬ä¸€æ¡æˆ–æœ€åä¸€æ¡ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¸Šæ¸¸ ETL ä½œä¸šå¹¶ä¸æ˜¯ç«¯åˆ°ç«¯å®Œå…¨å¯¹æ¥çš„ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´åœ¨æ•…éšœåˆ‡æ¢æ—¶ï¼Œsink ä¸­æœ‰é‡å¤çš„è®°å½•ã€‚ä½†æ˜¯ï¼Œé‡å¤çš„è®°å½•ä¼šå½±å“åˆ°ä¸‹æ¸¸åˆ†æä½œä¸šï¼ˆå¦‚ SUMã€COUNTï¼‰çš„æ­£ç¡®æ€§ã€‚æ‰€ä»¥åœ¨è¿›ä¸€æ­¥åˆ†æä¹‹å‰éœ€è¦è¿›è¡Œé‡å¤æ•°æ®åˆ é™¤ã€‚\nFlink ä½¿ç”¨ ROW_NUMBER()æ¥åˆ é™¤é‡å¤è®°å½•ï¼Œå°±åƒ Top-N æŸ¥è¯¢çš„æ–¹å¼ä¸€æ ·ã€‚ç†è®ºä¸Šï¼Œé‡å¤æ•°æ®åˆ é™¤æ˜¯ Top-N çš„ä¸€ä¸ªç‰¹ä¾‹ï¼ŒN ä¸º 1ï¼ŒæŒ‰å¤„ç†æ—¶é—´æˆ–äº‹ä»¶æ—¶é—´æ’åºã€‚\nä¸‹é¢æ˜¯é‡å¤æ•°æ®åˆ é™¤è¯­å¥çš„è¯­æ³•ã€‚\nSELECT[column_list]FROM(SELECT[column_list],ROW_NUMBER()OVER([PARTITIONBYcol1[,col2...]]ORDERBYtime_attr[asc|desc])ASrownumFROMtable_name)WHERErownum=1å‚æ•°è¯´æ˜:\n ROW_NUMBER()ã€‚ä¸ºæ¯ä¸€è¡ŒæŒ‡å®šä¸€ä¸ªå”¯ä¸€çš„ã€è¿ç»­çš„ç¼–å·ï¼Œä» 1 å¼€å§‹ã€‚ PARTITION BY col1[ï¼Œcol2\u0026hellip;]: æŒ‡å®šåˆ†åŒºåˆ—ï¼Œå³é‡å¤å¤åˆ¶é”®ã€‚ ORDER BY time_attr[asc|desc]ã€‚æŒ‡å®šæ’åºåˆ—ï¼Œå¿…é¡»æ˜¯æ—¶é—´å±æ€§ã€‚ç›®å‰åªæ”¯æŒ proctime å±æ€§ã€‚æœªæ¥å°†æ”¯æŒ Rowtime å±æ€§ã€‚ç”¨ ASC æ’åºè¡¨ç¤ºä¿ç•™ç¬¬ä¸€è¡Œï¼Œç”¨ DESC æ’åºè¡¨ç¤ºä¿ç•™æœ€åä¸€è¡Œã€‚ WHERE rownum = 1ï¼šä¸ºäº†è®© Flink è¯†åˆ«è¿™ä¸ªæŸ¥è¯¢æ˜¯é‡å¤æ•°æ®åˆ é™¤ï¼Œéœ€è¦ rownum = 1ã€‚  ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨æµè¡¨ä¸ŠæŒ‡å®šä½¿ç”¨é‡å¤æ•°æ®åˆ é™¤çš„ SQL æŸ¥è¯¢ã€‚\nval env = StreamExecutionEnvironment.getExecutionEnvironment val tableEnv = TableEnvironment.getTableEnvironment(env) // read a DataStream from an external source val ds: DataStream[(String, String, String, Int)] = env.addSource(...) // register the DataStream under the name \u0026#34;Orders\u0026#34; tableEnv.createTemporaryView(\u0026#34;Orders\u0026#34;, ds, $\u0026#34;order_id\u0026#34;, $\u0026#34;user\u0026#34;, $\u0026#34;product\u0026#34;, $\u0026#34;number\u0026#34;, $\u0026#34;proctime\u0026#34;.proctime) // remove duplicate rows on order_id and keep the first occurrence row, // because there shouldn\u0026#39;t be two orders with the same order_id. val result1 = tableEnv.sqlQuery( \u0026#34;\u0026#34;\u0026#34; |SELECT order_id, user, product, number |FROM ( | SELECT *, | ROW_NUMBER() OVER (PARTITION BY order_id ORDER BY proctime DESC) as row_num | FROM Orders) |WHERE row_num = 1 \u0026#34;\u0026#34;\u0026#34;.stripMargin) Group Windows ç»„çª—å£æ˜¯åœ¨ SQL æŸ¥è¯¢çš„ GROUP BY å­å¥ä¸­å®šä¹‰çš„ã€‚å°±åƒä½¿ç”¨å¸¸è§„çš„ GROUP BY å­å¥çš„æŸ¥è¯¢ä¸€æ ·ï¼Œä½¿ç”¨åŒ…å«ç»„çª—å£å‡½æ•°çš„ GROUP BY å­å¥çš„æŸ¥è¯¢æ˜¯ä¸ºæ¯ä¸ªç»„è®¡ç®—ä¸€æ¡ç»“æœè¡Œã€‚åœ¨æ‰¹å¤„ç†è¡¨å’Œæµå¼è¡¨ä¸Šçš„ SQL æ”¯æŒä»¥ä¸‹ç»„çª—å£å‡½æ•°ã€‚\n   åˆ†ç»„çª—å£å‡½æ•° æè¿°     TUMBLE(time_attr, interval) å®šä¹‰ä¸€ä¸ªæ»šåŠ¨æ—¶é—´çª—å£ã€‚æ»šåŠ¨æ—¶é—´çª—å£å°†è¡Œåˆ†é…åˆ°å…·æœ‰å›ºå®šæŒç»­æ—¶é—´ï¼ˆé—´éš”ï¼‰çš„éé‡å çš„è¿ç»­çª—å£ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª 5 åˆ†é’Ÿçš„æ—¶é—´çª—å£å¯ä»¥å°†è¡Œä»¥ 5 åˆ†é’Ÿçš„é—´éš”è¿›è¡Œåˆ†ç»„ã€‚æ»šåŠ¨çª—å£å¯ä»¥åœ¨äº‹ä»¶æ—¶é—´ï¼ˆæµ+æ‰¹æ¬¡ï¼‰æˆ–å¤„ç†æ—¶é—´ï¼ˆæµï¼‰ä¸Šå®šä¹‰ã€‚   HOP(time_attr, interval, interval) å®šä¹‰ä¸€ä¸ªè·³è½¬æ—¶é—´çª—å£ï¼ˆåœ¨è¡¨ API ä¸­ç§°ä¸ºæ»‘åŠ¨çª—å£ï¼‰ã€‚è·³è·ƒæ—¶é—´çª—å£æœ‰ä¸€ä¸ªå›ºå®šçš„æŒç»­æ—¶é—´ï¼ˆç¬¬äºŒä¸ªé—´éš”å‚æ•°ï¼‰ï¼Œå¹¶æŒ‰æŒ‡å®šçš„è·³è·ƒé—´éš”ï¼ˆç¬¬ä¸€ä¸ªé—´éš”å‚æ•°ï¼‰è¿›è¡Œè·³è½¬ã€‚å¦‚æœè·³è½¬é—´éš”å°äºçª—å£å¤§å°ï¼Œåˆ™è·³è½¬çª—å£æ˜¯é‡å çš„ã€‚å› æ­¤ï¼Œå¯ä»¥å°†è¡Œåˆ†é…åˆ°å¤šä¸ªçª—å£ã€‚ä¾‹å¦‚ï¼Œ15 åˆ†é’Ÿå¤§å°çš„è·³è½¬çª—å£å’Œ 5 åˆ†é’Ÿçš„è·³è½¬é—´éš”å°†æ¯è¡Œåˆ†é…ç»™ 3 ä¸ª 15 åˆ†é’Ÿå¤§å°çš„ä¸åŒçª—å£ï¼Œè¿™äº›çª—å£ä»¥ 5 åˆ†é’Ÿçš„é—´éš”è¿›è¡Œè¯„ä¼°ã€‚æ»šåŠ¨çª—å£å¯ä»¥åœ¨äº‹ä»¶æ—¶é—´ï¼ˆæµ+æ‰¹å¤„ç†ï¼‰æˆ–å¤„ç†æ—¶é—´ï¼ˆæµï¼‰ä¸Šå®šä¹‰ã€‚   SESSION(time_attr, interval) å®šä¹‰ä¸€ä¸ªä¼šè¯æ—¶é—´çª—å£ã€‚ä¼šè¯æ—¶é—´çª—å£æ²¡æœ‰å›ºå®šçš„æŒç»­æ—¶é—´ï¼Œä½†å…¶è¾¹ç•Œç”±ä¸æ´»åŠ¨çš„æ—¶é—´é—´éš”å®šä¹‰ï¼Œå³å¦‚æœåœ¨å®šä¹‰çš„é—´éš™æœŸå†…æ²¡æœ‰äº‹ä»¶å‡ºç°ï¼Œåˆ™ä¼šè¯çª—å£å…³é—­ã€‚ä¾‹å¦‚ï¼Œæœ‰ 30 åˆ†é’Ÿé—´éš™çš„ä¼šè¯çª—å£åœ¨ 30 åˆ†é’Ÿä¸æ´»åŠ¨åè§‚å¯Ÿåˆ°ä¸€è¡Œæ—¶å¼€å§‹ï¼ˆå¦åˆ™è¯¥è¡Œå°†è¢«æ·»åŠ åˆ°ç°æœ‰çš„çª—å£ä¸­ï¼‰ï¼Œå¦‚æœåœ¨ 30 åˆ†é’Ÿå†…æ²¡æœ‰è¡Œè¢«æ·»åŠ ï¼Œåˆ™å…³é—­ã€‚ä¼šè¯çª—å£å¯ä»¥åœ¨äº‹ä»¶æ—¶é—´ï¼ˆæµ+æ‰¹å¤„ç†ï¼‰æˆ–å¤„ç†æ—¶é—´ï¼ˆæµï¼‰ä¸Šå·¥ä½œã€‚    æ—¶é—´å±æ€§ å¯¹äºæµè¡¨çš„ SQL æŸ¥è¯¢ï¼Œç»„çª—å£å‡½æ•°çš„ time_attr å‚æ•°å¿…é¡»å¼•ç”¨ä¸€ä¸ªæœ‰æ•ˆçš„æ—¶é—´å±æ€§ï¼Œè¯¥å±æ€§æŒ‡å®šè¡Œçš„å¤„ç†æ—¶é—´æˆ–äº‹ä»¶æ—¶é—´ã€‚è¯·å‚é˜…æ—¶é—´å±æ€§çš„æ–‡æ¡£ï¼Œäº†è§£å¦‚ä½•å®šä¹‰æ—¶é—´å±æ€§ã€‚\nå¯¹äºæ‰¹å¤„ç†è¡¨ä¸Šçš„ SQLï¼Œç»„çª—å£å‡½æ•°çš„ time_attr å‚æ•°å¿…é¡»æ˜¯ç±»å‹ä¸º TIMESTAMP çš„å±æ€§ã€‚\né€‰æ‹©ç»„çª—å£çš„å¼€å§‹å’Œç»“æŸæ—¶é—´æˆ³ å¯ä»¥é€šè¿‡ä»¥ä¸‹è¾…åŠ©åŠŸèƒ½é€‰æ‹©ç»„çª—å£çš„å¼€å§‹å’Œç»“æŸæ—¶é—´æˆ³ä»¥åŠæ—¶é—´å±æ€§ã€‚\n   Auxiliary å‡½æ•° Description     TUMBLE_START(time_attr, interval),HOP_START(time_attr, interval, interval),SESSION_START(time_attr, interval) è¿”å›å¯¹åº”çš„æ»šåŠ¨ã€è·³è·ƒæˆ–ä¼šè¯çª—å£çš„åŒ…å®¹ä¸‹ç•Œçš„æ—¶é—´æˆ³ã€‚   TUMBLE_END(time_attr, interval),HOP_END(time_attr, interval, interval),SESSION_END(time_attr, interval) è¿”å›å¯¹åº”çš„ç¿»æ»šã€è·³è·ƒæˆ–ä¼šè¯çª—å£çš„ä¸“å±ä¸Šç•Œçš„æ—¶é—´æˆ³ã€‚æ³¨æ„ï¼šåœ¨åç»­çš„åŸºäºæ—¶é—´çš„æ“ä½œä¸­ï¼Œå¦‚åŒºé—´è¿æ¥å’Œåˆ†ç»„çª—å£æˆ– over çª—å£èšåˆä¸­ï¼Œä¸èƒ½å°†ä¸“å±ä¸Šç•Œæ—¶é—´æˆ³ä½œä¸ºè¡Œæ—¶é—´å±æ€§ä½¿ç”¨ã€‚   TUMBLE_ROWTIME(time_attr, interval),HOP_ROWTIME(time_attr, interval, interval),SESSION_ROWTIME(time_attr, interval) è¿”å›å¯¹åº”çš„ç¿»æ»šã€è·³è·ƒæˆ–ä¼šè¯çª—å£çš„åŒ…å®¹ä¸Šç•Œçš„æ—¶é—´æˆ³ã€‚äº§ç”Ÿçš„å±æ€§æ˜¯ä¸€ä¸ªè¡Œæ—¶é—´å±æ€§ï¼Œå¯ä»¥ç”¨äºåç»­çš„åŸºäºæ—¶é—´çš„æ“ä½œï¼Œå¦‚åŒºé—´è¿æ¥å’Œåˆ†ç»„çª—å£æˆ–çª—å£èšåˆã€‚   TUMBLE_PROCTIME(time_attr, interval),HOP_PROCTIME(time_attr, interval, interval),SESSION_PROCTIME(time_attr, interval) è¿”å›ä¸€ä¸ª proctime å±æ€§ï¼Œè¯¥å±æ€§å¯ç”¨äºåç»­åŸºäºæ—¶é—´çš„æ“ä½œï¼Œå¦‚åŒºé—´è¿æ¥å’Œåˆ†ç»„çª—å£æˆ–è¿‡çª—å£èšåˆã€‚    æ³¨æ„ï¼šåœ¨è°ƒç”¨è¾…åŠ©å‡½æ•°æ—¶ï¼Œå¿…é¡»ä½¿ç”¨ä¸ GROUP BY å­å¥ä¸­çš„ç»„çª—å£å‡½æ•°å®Œå…¨ç›¸åŒçš„å‚æ•°ã€‚\nä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨æµå¼è¡¨ä¸Šä½¿ç”¨ç»„çª—å£æŒ‡å®š SQL æŸ¥è¯¢ã€‚\nval env = StreamExecutionEnvironment.getExecutionEnvironment val tableEnv = StreamTableEnvironment.create(env) // read a DataStream from an external source val ds: DataStream[(Long, String, Int)] = env.addSource(...) // register the DataStream under the name \u0026#34;Orders\u0026#34; tableEnv.createTemporaryView(\u0026#34;Orders\u0026#34;, ds, $\u0026#34;user\u0026#34;, $\u0026#34;product\u0026#34;, $\u0026#34;amount\u0026#34;, $\u0026#34;proctime\u0026#34;.proctime, $\u0026#34;rowtime\u0026#34;.rowtime) // compute SUM(amount) per day (in event-time) val result1 = tableEnv.sqlQuery( \u0026#34;\u0026#34;\u0026#34; |SELECT | user, | TUMBLE_START(rowtime, INTERVAL \u0026#39;1\u0026#39; DAY) as wStart, | SUM(amount) | FROM Orders | GROUP BY TUMBLE(rowtime, INTERVAL \u0026#39;1\u0026#39; DAY), user \u0026#34;\u0026#34;\u0026#34;.stripMargin) // compute SUM(amount) per day (in processing-time) val result2 = tableEnv.sqlQuery( \u0026#34;SELECT user, SUM(amount) FROM Orders GROUP BY TUMBLE(proctime, INTERVAL \u0026#39;1\u0026#39; DAY), user\u0026#34;) // compute every hour the SUM(amount) of the last 24 hours in event-time val result3 = tableEnv.sqlQuery( \u0026#34;SELECT product, SUM(amount) FROM Orders GROUP BY HOP(rowtime, INTERVAL \u0026#39;1\u0026#39; HOUR, INTERVAL \u0026#39;1\u0026#39; DAY), product\u0026#34;) // compute SUM(amount) per session with 12 hour inactivity gap (in event-time) val result4 = tableEnv.sqlQuery( \u0026#34;\u0026#34;\u0026#34; |SELECT | user, | SESSION_START(rowtime, INTERVAL \u0026#39;12\u0026#39; HOUR) AS sStart, | SESSION_END(rowtime, INTERVAL \u0026#39;12\u0026#39; HOUR) AS sEnd, | SUM(amount) | FROM Orders | GROUP BY SESSION(rowtime(), INTERVAL \u0026#39;12\u0026#39; HOUR), user \u0026#34;\u0026#34;\u0026#34;.stripMargin) æ¨¡å¼è¯†åˆ«  MATCH_RECOGNIZE(Streaming)  æ ¹æ® MATCH_RECOGNIZE ISO æ ‡å‡†åœ¨æµè¡¨ä¸­æœç´¢ç»™å®šæ¨¡å¼ã€‚è¿™ä½¿å¾—åœ¨ SQL æŸ¥è¯¢ä¸­è¡¨è¾¾å¤æ‚äº‹ä»¶å¤„ç†ï¼ˆCEPï¼‰é€»è¾‘æˆä¸ºå¯èƒ½ã€‚\næ›´è¯¦ç»†çš„æè¿°ï¼Œè¯·å‚è§æ£€æµ‹è¡¨ä¸­æ¨¡å¼çš„ä¸“é—¨é¡µé¢ã€‚\nSELECTT.aid,T.bid,T.cidFROMMyTableMATCH_RECOGNIZE(PARTITIONBYuseridORDERBYproctimeMEASURESA.idASaid,B.idASbid,C.idAScidPATTERN(ABC)DEFINEAASname=\u0026#39;a\u0026#39;,BASname=\u0026#39;b\u0026#39;,CASname=\u0026#39;c\u0026#39;)AST","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-queries/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL"],"title":"æŸ¥è¯¢"},{"categories":["Flink"],"contents":"æŸ¥è¯¢é…ç½® è¡¨ API å’Œ SQL æŸ¥è¯¢å…·æœ‰ç›¸åŒçš„è¯­ä¹‰ï¼Œæ— è®ºå…¶è¾“å…¥æ˜¯æœ‰é™çš„è¡Œé›†è¿˜æ˜¯æ— é™åˆ¶çš„è¡¨å˜åŒ–æµã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œå¯¹æµè¾“å…¥çš„è¿ç»­æŸ¥è¯¢èƒ½å¤Ÿè®¡ç®—å‡ºä¸ç¦»çº¿è®¡ç®—ç»“æœç›¸åŒçš„å‡†ç¡®ç»“æœã€‚ç„¶è€Œï¼Œå¯¹äºä¸€äº›è¿ç»­æŸ¥è¯¢ï¼Œä½ å¿…é¡»é™åˆ¶å®ƒä»¬æ‰€ç»´æŒçš„çŠ¶æ€çš„å¤§å°ï¼Œä»¥é¿å…åœ¨æ‘„å–æ— çº¦æŸçš„è¾“å…¥æµæ—¶è€—å°½å­˜å‚¨ã€‚è¿™å–å†³äºè¾“å…¥æ•°æ®çš„ç‰¹æ€§å’ŒæŸ¥è¯¢æœ¬èº«æ˜¯å¦éœ€è¦é™åˆ¶çŠ¶æ€å¤§å°ï¼Œä»¥åŠå®ƒæ˜¯å¦å’Œå¦‚ä½•å½±å“è®¡ç®—ç»“æœçš„å‡†ç¡®æ€§ã€‚\nFlink çš„ Table API å’Œ SQL æ¥å£æä¾›äº†å‚æ•°æ¥è°ƒæ•´è¿ç»­æŸ¥è¯¢çš„å‡†ç¡®æ€§å’Œèµ„æºæ¶ˆè€—ã€‚è¿™äº›å‚æ•°æ˜¯é€šè¿‡ TableConfig å¯¹è±¡æŒ‡å®šçš„ï¼Œå¯ä»¥ä» TableEnvironment ä¸­è·å¾—ã€‚\nval env = StreamExecutionEnvironment.getExecutionEnvironment val tableEnv = StreamTableEnvironment.create(env) // obtain query configuration from TableEnvironment val tConfig: TableConfig = tableEnv.getConfig // set query parameters tConfig.setIdleStateRetentionTime(Time.hours(12), Time.hours(24)) // define query val result: Table = ??? // create TableSink val sink: TableSink[Row] = ??? // register TableSink tableEnv.registerTableSink( \u0026#34;outputTable\u0026#34;, // table name  Array[String](...), // field names  Array[TypeInformation[_]](...), // field types  sink) // table sink  // emit result Table via a TableSink result.executeInsert(\u0026#34;outputTable\u0026#34;) // convert result Table into a DataStream[Row] val stream: DataStream[Row] = result.toAppendStream[Row] ä¸‹é¢æˆ‘ä»¬ä»‹ç» TableConfig çš„å‚æ•°ï¼Œä»¥åŠå®ƒä»¬å¦‚ä½•å½±å“æŸ¥è¯¢çš„å‡†ç¡®æ€§å’Œèµ„æºæ¶ˆè€—ã€‚\né—²ç½®çŠ¶æ€ä¿ç•™æ—¶é—´ è®¸å¤šæŸ¥è¯¢åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªé”®å±æ€§ä¸Šèšåˆæˆ–è¿æ¥è®°å½•ã€‚å½“è¿™æ ·çš„æŸ¥è¯¢åœ¨ä¸€ä¸ªæµä¸Šæ‰§è¡Œæ—¶ï¼Œè¿ç»­æŸ¥è¯¢éœ€è¦æ”¶é›†è®°å½•æˆ–ç»´æŠ¤æ¯ä¸ªé”®çš„éƒ¨åˆ†ç»“æœã€‚å¦‚æœè¾“å…¥æµçš„é”®åŸŸæ˜¯ä¸æ–­å˜åŒ–çš„ï¼Œå³æ´»è·ƒçš„é”®å€¼æ˜¯éšç€æ—¶é—´çš„æ¨ç§»è€Œå˜åŒ–çš„ï¼Œé‚£ä¹ˆéšç€è§‚å¯Ÿåˆ°è¶Šæ¥è¶Šå¤šä¸åŒçš„é”®ï¼Œè¿ç»­æŸ¥è¯¢ä¼šç§¯ç´¯è¶Šæ¥è¶Šå¤šçš„çŠ¶æ€ã€‚ç„¶è€Œï¼Œå¾€å¾€é”®åœ¨ä¸€æ®µæ—¶é—´åå°±ä¼šå˜å¾—ä¸æ´»è·ƒï¼Œå…¶ç›¸åº”çš„çŠ¶æ€ä¹Ÿå°±å˜å¾—é™ˆæ—§æ— ç”¨ã€‚\nä¾‹å¦‚ä¸‹é¢çš„æŸ¥è¯¢è®¡ç®—æ¯èŠ‚è¯¾çš„ç‚¹å‡»æ¬¡æ•°ã€‚\nSELECTsessionId,COUNT(*)FROMclicksGROUPBYsessionId;sessionId å±æ€§è¢«ç”¨ä½œåˆ†ç»„é”®ï¼Œè¿ç»­æŸ¥è¯¢ä¼šå¯¹å®ƒè§‚å¯Ÿåˆ°çš„æ¯ä¸ª sessionId è¿›è¡Œè®¡æ•°ã€‚sessionId å±æ€§æ˜¯éšç€æ—¶é—´çš„æ¨ç§»è€Œä¸æ–­å˜åŒ–çš„ï¼ŒsessionId å€¼åªæœ‰åœ¨ä¼šè¯ç»“æŸä¹‹å‰æ‰æ˜¯æœ‰æ•ˆçš„ï¼Œå³åœ¨æœ‰é™çš„æ—¶é—´å†…ã€‚ç„¶è€Œï¼Œè¿ç»­æŸ¥è¯¢æ— æ³•çŸ¥é“ sessionId çš„è¿™ä¸€å±æ€§ï¼Œå®ƒæœŸæœ›æ¯ä¸ª sessionId å€¼éƒ½èƒ½åœ¨ä»»ä½•æ—¶é—´ç‚¹å‡ºç°ã€‚å®ƒä¸ºæ¯ä¸€ä¸ªè§‚å¯Ÿåˆ°çš„ sessionId å€¼ç»´æŒä¸€ä¸ªè®¡æ•°ã€‚å› æ­¤ï¼Œéšç€è§‚å¯Ÿåˆ°çš„ sessionId å€¼è¶Šæ¥è¶Šå¤šï¼ŒæŸ¥è¯¢çš„æ€»çŠ¶æ€å¤§å°ä¹Ÿåœ¨ä¸æ–­å¢åŠ ã€‚\né—²ç½®çŠ¶æ€ä¿ç•™æ—¶é—´å‚æ•°å®šä¹‰äº†ä¸€ä¸ªé”®çš„çŠ¶æ€åœ¨è¢«ç§»é™¤ä¹‹å‰ä¸è¢«æ›´æ–°çš„ä¿ç•™æ—¶é—´ã€‚å¯¹äºå‰é¢çš„ç¤ºä¾‹æŸ¥è¯¢ï¼Œåªè¦åœ¨é…ç½®çš„æ—¶é—´æ®µå†…æ²¡æœ‰æ›´æ–°ï¼ŒsessionId çš„è®¡æ•°å°±ä¼šè¢«åˆ é™¤ã€‚\né€šè¿‡åˆ é™¤ä¸€ä¸ªé”®çš„çŠ¶æ€ï¼Œè¿ç»­æŸ¥è¯¢å°±ä¼šå®Œå…¨å¿˜è®°å®ƒä»¥å‰è§è¿‡è¿™ä¸ªé”®ã€‚å¦‚æœå¤„ç†ä¸€æ¡å¸¦æœ‰é”®çš„è®°å½•ï¼Œå…¶çŠ¶æ€åœ¨ä¹‹å‰å·²ç»è¢«åˆ é™¤ï¼Œåˆ™è¯¥è®°å½•å°†è¢«è§†ä¸ºå¸¦æœ‰ç›¸åº”é”®çš„ç¬¬ä¸€æ¡è®°å½•ã€‚å¯¹äºä¸Šé¢çš„ä¾‹å­æ¥è¯´ï¼Œè¿™æ„å‘³ç€ä¸€ä¸ª sessionId çš„è®¡æ•°å°†é‡æ–°å¼€å§‹ä¸º 0ã€‚\næœ‰ä¸¤ä¸ªå‚æ•°å¯ä»¥é…ç½®ç©ºé—²çŠ¶æ€ä¿ç•™æ—¶é—´ã€‚\n æœ€å°ç©ºé—²çŠ¶æ€ä¿ç•™æ—¶é—´å®šä¹‰äº†ä¸€ä¸ªéæ´»åŠ¨é”®çš„çŠ¶æ€åœ¨è¢«ç§»é™¤ä¹‹å‰è‡³å°‘ä¿ç•™å¤šé•¿æ—¶é—´ã€‚ æœ€å¤§ç©ºé—²çŠ¶æ€ä¿ç•™æ—¶é—´å®šä¹‰äº†éæ´»åŠ¨é”®çš„çŠ¶æ€åœ¨è¢«åˆ é™¤å‰æœ€å¤šä¿ç•™å¤šé•¿æ—¶é—´ã€‚  å‚æ•°æŒ‡å®šå¦‚ä¸‹:\nval tConfig: TableConfig = ??? // set idle state retention time: min = 12 hours, max = 24 hours tConfig.setIdleStateRetentionTime(Time.hours(12), Time.hours(24)) æ¸…ç†çŠ¶æ€éœ€è¦é¢å¤–çš„è®°è´¦ï¼Œå¯¹äº minTime å’Œ maxTime çš„è¾ƒå¤§å·®å¼‚ï¼Œè®°è´¦æˆæœ¬è¾ƒä½ã€‚minTime å’Œ maxTime ä¹‹é—´çš„å·®å¼‚å¿…é¡»è‡³å°‘ä¸º 5 åˆ†é’Ÿã€‚\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/streaming/query_configuration.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-query-configuration/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL"],"title":"æŸ¥è¯¢é…ç½®"},{"categories":["Flink"],"contents":"Flink ä¸­çš„æ¯ä¸€ä¸ªå‡½æ•°å’Œæ“ä½œç¬¦éƒ½å¯ä»¥æ˜¯æœ‰çŠ¶æ€çš„ï¼ˆè¯¦æƒ…è¯·çœ‹ä½¿ç”¨çŠ¶æ€ï¼‰ã€‚æœ‰çŠ¶æ€çš„å‡½æ•°åœ¨å•ä¸ªå…ƒç´ /äº‹ä»¶çš„å¤„ç†è¿‡ç¨‹ä¸­å­˜å‚¨æ•°æ®ï¼Œä½¿å¾—çŠ¶æ€æˆä¸ºä»»ä½•ç±»å‹çš„æ›´å¤æ‚æ“ä½œçš„å…³é”®æ„å»ºæ¨¡å—ã€‚\nä¸ºäº†ä½¿çŠ¶æ€å…·æœ‰å®¹é”™æ€§ï¼ŒFlink éœ€è¦å¯¹çŠ¶æ€è¿›è¡Œ checkpointã€‚æ£€æŸ¥ç‚¹å…è®¸ Flink æ¢å¤æµä¸­çš„çŠ¶æ€å’Œä½ç½®ï¼Œä½¿åº”ç”¨ç¨‹åºå…·æœ‰ä¸æ— æ•…éšœæ‰§è¡Œç›¸åŒçš„è¯­ä¹‰ã€‚\nå…³äºæµå¼å®¹é”™çš„æ–‡æ¡£è¯¦ç»†æè¿°äº† Flink çš„æµå¼å®¹é”™æœºåˆ¶èƒŒåçš„æŠ€æœ¯ã€‚\nå‰ææ¡ä»¶ Flink çš„æ£€æŸ¥ç‚¹æœºåˆ¶ä¸æµå’ŒçŠ¶æ€çš„æŒä¹…å­˜å‚¨äº¤äº’ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå®ƒéœ€è¦:\n ä¸€ä¸ªèƒ½åœ¨ä¸€å®šæ—¶é—´å†…é‡æ”¾è®°å½•(replay records)çš„æŒä¹…ï¼ˆæˆ–è€ç”¨ï¼‰æ•°æ®æºã€‚è¿™ç§æºçš„ä¾‹å­æ˜¯æŒä¹…æ€§æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚ Apache Kafkaã€RabbitMQã€Amazon Kinesisã€Google PubSubï¼‰æˆ–æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ HDFSã€S3ã€GFSã€NFSã€Ceph\u0026hellip;ï¼‰ã€‚ çŠ¶æ€çš„æŒä¹…æ€§å­˜å‚¨ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ HDFSã€S3ã€GFSã€NFSã€Ceph\u0026hellip;ï¼‰ã€‚  å¯ç”¨å’Œé…ç½®æ£€æŸ¥ç‚¹ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ£€æŸ¥ç‚¹è¢«ç¦ç”¨ã€‚è¦å¯ç”¨æ£€æŸ¥ç‚¹ï¼Œåœ¨ StreamExecutionEnvironment ä¸Šè°ƒç”¨ enableCheckpointing(n)ï¼Œå…¶ä¸­ n æ˜¯æ£€æŸ¥ç‚¹é—´éš”ï¼Œå•ä½ä¸ºæ¯«ç§’ã€‚\næ£€æŸ¥ç‚¹çš„å…¶ä»–å‚æ•°åŒ…æ‹¬:\n  exactly-once vs. at-least-onceï¼šä½ å¯ä»¥é€‰æ‹©å‘ enableCheckpointing(n) æ–¹æ³•ä¼ é€’ä¸€ä¸ªæ¨¡å¼ï¼Œä»¥ä¾¿åœ¨ä¸¤ä¸ªä¿è¯çº§åˆ«ä¹‹é—´è¿›è¡Œé€‰æ‹©ã€‚å¯¹äºå¤§å¤šæ•°åº”ç”¨æ¥è¯´ï¼Œexactly-once æ˜¯æ¯”è¾ƒå¥½çš„ã€‚At-least-once å¯èƒ½é€‚ç”¨äºæŸäº›è¶…ä½å»¶è¿Ÿï¼ˆæŒç»­å‡ æ¯«ç§’ï¼‰çš„åº”ç”¨ã€‚\n  æ£€æŸ¥ç‚¹è¶…æ—¶ã€‚å¦‚æœä¸€ä¸ªæ­£åœ¨è¿›è¡Œä¸­çš„æ£€æŸ¥ç‚¹æ²¡æœ‰å®Œæˆï¼Œé‚£ä¹ˆå®ƒè¢«ä¸­æ­¢çš„æ—¶é—´ã€‚\n  æ£€æŸ¥ç‚¹ä¹‹é—´çš„æœ€å°æ—¶é—´ã€‚ä¸ºäº†ç¡®ä¿æµåº”ç”¨åœ¨æ£€æŸ¥ç‚¹ä¹‹é—´æœ‰ä¸€å®šçš„è¿›åº¦ï¼Œå¯ä»¥å®šä¹‰æ£€æŸ¥ç‚¹ä¹‹é—´éœ€è¦ç»è¿‡å¤šå°‘æ—¶é—´ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¿™ä¸ªå€¼è®¾ç½®ä¸º5000ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªæ£€æŸ¥ç‚¹å°†åœ¨ä¸Šä¸€ä¸ªæ£€æŸ¥ç‚¹å®Œæˆåä¸æ—©äº5ç§’å¼€å§‹ï¼Œæ— è®ºæ£€æŸ¥ç‚¹æŒç»­æ—¶é—´å’Œæ£€æŸ¥ç‚¹é—´éš”å¦‚ä½•ã€‚è¯·æ³¨æ„ï¼Œè¿™æ„å‘³ç€æ£€æŸ¥ç‚¹é—´éš”æ°¸è¿œä¸ä¼šå°äºè¿™ä¸ªå‚æ•°ã€‚\n  é€šè¿‡å®šä¹‰\u0026quot;æ£€æŸ¥ç‚¹ä¹‹é—´çš„æ—¶é—´\u0026quot;(time between checkpoints)é€šå¸¸æ¯”æ£€æŸ¥ç‚¹é—´éš”æ›´å®¹æ˜“é…ç½®åº”ç”¨ç¨‹åºï¼Œå› ä¸º\u0026quot;æ£€æŸ¥ç‚¹ä¹‹é—´çš„æ—¶é—´\u0026quot;ä¸å®¹æ˜“å—åˆ°æ£€æŸ¥ç‚¹æœ‰æ—¶å¯èƒ½æ¯”å¹³å‡æ—¶é—´é•¿çš„äº‹å®çš„å½±å“ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœç›®æ ‡å­˜å‚¨ç³»ç»Ÿæš‚æ—¶ç¼“æ…¢ï¼‰ã€‚\nè¯·æ³¨æ„ï¼Œè¿™ä¸ªå€¼ä¹Ÿæ„å‘³ç€å¹¶å‘æ£€æŸ¥ç‚¹çš„æ•°é‡ä¸º1ã€‚\n å¹¶å‘æ£€æŸ¥ç‚¹çš„æ•°é‡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ä¸€ä¸ªæ£€æŸ¥ç‚¹ä»åœ¨è¿›è¡Œæ—¶ï¼Œç³»ç»Ÿä¸ä¼šè§¦å‘å¦ä¸€ä¸ªæ£€æŸ¥ç‚¹ã€‚è¿™å¯ä»¥ç¡®ä¿æ‹“æ‰‘ä¸ä¼šåœ¨æ£€æŸ¥ç‚¹ä¸ŠèŠ±è´¹å¤ªå¤šæ—¶é—´ï¼Œè€Œä½¿å¤„ç†æµçš„å·¥ä½œæ²¡æœ‰è¿›å±•ã€‚å¯ä»¥å…è®¸å¤šä¸ªé‡å çš„æ£€æŸ¥ç‚¹ï¼Œè¿™å¯¹äºé‚£äº›æœ‰ä¸€å®šå¤„ç†å»¶è¿Ÿï¼ˆä¾‹å¦‚å› ä¸ºå‡½æ•°è°ƒç”¨å¤–éƒ¨æœåŠ¡ï¼Œéœ€è¦ä¸€äº›æ—¶é—´æ¥å“åº”ï¼‰ï¼Œä½†ä»ç„¶å¸Œæœ›åšéå¸¸é¢‘ç¹çš„æ£€æŸ¥ç‚¹ï¼ˆ100sæ¯«ç§’ï¼‰ï¼Œä»¥ä¾¿åœ¨æ•…éšœæ—¶é‡æ–°å¤„ç†å¾ˆå°‘çš„ç®¡é“æ¥è¯´æ˜¯å¾ˆæœ‰æ„æ€çš„ã€‚  å½“å®šä¹‰äº†æ£€æŸ¥ç‚¹ä¹‹é—´çš„æœ€å°æ—¶é—´æ—¶ï¼Œä¸èƒ½ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚\n  å¤–éƒ¨åŒ–æ£€æŸ¥ç‚¹ã€‚æ‚¨å¯ä»¥é…ç½®å‘¨æœŸæ€§æ£€æŸ¥ç‚¹ï¼Œä½¿å…¶åœ¨å¤–éƒ¨æŒä¹…åŒ–ã€‚å¤–éƒ¨åŒ–çš„æ£€æŸ¥ç‚¹ä¼šå°†å®ƒä»¬çš„å…ƒæ•°æ®å†™å…¥æŒä¹…åŒ–å­˜å‚¨ä¸­ï¼Œå½“ä½œä¸šå¤±è´¥æ—¶ä¸ä¼šè‡ªåŠ¨æ¸…ç†ã€‚è¿™æ ·ä¸€æ¥ï¼Œå¦‚æœä½ çš„å·¥ä½œå¤±è´¥äº†ï¼Œä½ èº«è¾¹å°±ä¼šæœ‰ä¸€ä¸ªæ£€æŸ¥ç‚¹æ¥æ¢å¤ã€‚å…³äºå¤–éƒ¨åŒ–æ£€æŸ¥ç‚¹çš„éƒ¨ç½²è¯´æ˜ä¸­æœ‰æ›´å¤šç»†èŠ‚ã€‚\n  Fail/checkpoint é”™è¯¯æ—¶ç»§ç»­æ‰§è¡Œä»»åŠ¡ã€‚è¿™å†³å®šäº†å¦‚æœåœ¨æ‰§è¡Œä»»åŠ¡çš„æ£€æŸ¥ç‚¹è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œä»»åŠ¡æ˜¯å¦ä¼šå¤±è´¥ã€‚è¿™æ˜¯é»˜è®¤è¡Œä¸ºã€‚å¦å¤–ï¼Œå½“ç¦ç”¨è¯¥åŠŸèƒ½æ—¶ï¼Œä»»åŠ¡å°†ç®€å•åœ°æ‹’ç»å‘æ£€æŸ¥ç‚¹åè°ƒå™¨æä¾›æ£€æŸ¥ç‚¹å¹¶ç»§ç»­è¿è¡Œã€‚\n  æ›´å–œæ¬¢ç”¨äºæ¢å¤çš„æ£€æŸ¥ç‚¹ã€‚è¿™å†³å®šäº†å³ä½¿æœ‰æ›´è¿‘çš„ä¿å­˜ç‚¹å¯ç”¨æ—¶ï¼Œä»»åŠ¡æ˜¯å¦ä¼šå›é€€åˆ°æœ€æ–°çš„æ£€æŸ¥ç‚¹ï¼Œä»¥å‡å°‘æ¢å¤æ—¶é—´ã€‚\n  ä¸å¯¹é½çš„æ£€æŸ¥ç‚¹ã€‚ä½ å¯ä»¥å¯ç”¨ä¸å¯¹é½çš„æ£€æŸ¥ç‚¹ï¼Œä»¥å¤§å¤§å‡å°‘èƒŒå‹ä¸‹çš„æ£€æŸ¥ç‚¹æ—¶é—´ã€‚ä»…é€‚ç”¨äºç²¾ç¡®çš„ä¸€æ¬¡æ£€æŸ¥ç‚¹ï¼Œä¸”å¹¶å‘æ£€æŸ¥ç‚¹æ•°é‡ä¸º1ã€‚\n  val env = StreamExecutionEnvironment.getExecutionEnvironment() // start a checkpoint every 1000 ms env.enableCheckpointing(1000) // é«˜çº§é€‰é¡¹:  // è®¾ç½®æ¨¡å¼ä¸º exactly-once (è¿™æ˜¯é»˜è®¤çš„) env.getCheckpointConfig.setCheckpointingMode(CheckpointingMode.EXACTLY_ONCE) // make sure 500 ms of progress happen between checkpoints env.getCheckpointConfig.setMinPauseBetweenCheckpoints(500) // checkpoints have to complete within one minute, or are discarded env.getCheckpointConfig.setCheckpointTimeout(60000) // prevent the tasks from failing if an error happens in their checkpointing, the checkpoint will just be declined. env.getCheckpointConfig.setFailTasksOnCheckpointingErrors(false) // allow only one checkpoint to be in progress at the same time env.getCheckpointConfig.setMaxConcurrentCheckpoints(1) // enables the experimental unaligned checkpoints env.getCheckpointConfig.enableUnalignedCheckpoints() ç›¸å…³é…ç½®é€‰é¡¹ æ›´å¤šçš„å‚æ•°å’Œ/æˆ–é»˜è®¤å€¼å¯ä»¥é€šè¿‡ conf/flink-conf.yaml æ¥è®¾ç½®ï¼ˆå‚è§é…ç½®çš„å®Œæ•´æŒ‡å—ï¼‰ã€‚\n   é”® é»˜è®¤å€¼ ç±»å‹ æè¿°     state.backend (none) String ç”¨äºå­˜å‚¨å’Œ checkpoint çŠ¶æ€çš„çŠ¶æ€åç«¯ã€‚   state.backend.async true Boolean çŠ¶æ€åç«¯æ˜¯å¦åº”è¯¥åœ¨å¯èƒ½çš„æƒ…å†µä¸‹ä½¿ç”¨å¼‚æ­¥å¿«ç…§æ–¹æ³•çš„é€‰é¡¹ï¼Œå¯é…ç½®ã€‚æœ‰äº›çŠ¶æ€åç«¯å¯èƒ½ä¸æ”¯æŒå¼‚æ­¥å¿«ç…§ï¼Œæˆ–è€…åªæ”¯æŒå¼‚æ­¥å¿«ç…§ï¼Œè€Œå¿½ç•¥è¿™ä¸ªé€‰é¡¹ã€‚   state.backend.fs.memory-threshold 20 kb MemorySize çŠ¶æ€æ•°æ®æ–‡ä»¶çš„æœ€å°å°ºå¯¸ã€‚å°äºè¿™ä¸ªå¤§å°çš„æ‰€æœ‰çŠ¶æ€å—éƒ½å†…åµŒå­˜å‚¨åœ¨æ ¹æ£€æŸ¥ç‚¹å…ƒæ•°æ®æ–‡ä»¶ä¸­ã€‚è¯¥é…ç½®çš„æœ€å¤§å†…å­˜é˜ˆå€¼ä¸º1MBã€‚   state.backend.fs.write-buffer-size 4096 Integer å†™å…¥æ–‡ä»¶ç³»ç»Ÿçš„æ£€æŸ¥ç‚¹æµçš„é»˜è®¤å†™ç¼“å†²åŒºå¤§å°ã€‚å®é™…çš„å†™ç¼“å†²åŒºå¤§å°æ˜¯ç”±è¿™ä¸ªé€‰é¡¹å’Œé€‰é¡¹ \u0026lsquo;state.backend.fs.memory-threshold\u0026rsquo; çš„æœ€å¤§å€¼å†³å®šçš„ã€‚   state.backend.incremental false Boolean å¦‚æœå¯èƒ½ï¼ŒçŠ¶æ€åç«¯æ˜¯å¦åº”è¯¥åˆ›å»ºå¢é‡æ£€æŸ¥ç‚¹ã€‚å¯¹äºå¢é‡æ£€æŸ¥ç‚¹ï¼Œåªå­˜å‚¨ä¸å‰ä¸€ä¸ªæ£€æŸ¥ç‚¹çš„å·®å¼‚ï¼Œè€Œä¸æ˜¯å®Œæ•´çš„æ£€æŸ¥ç‚¹çŠ¶æ€ã€‚ä¸€æ—¦å¯ç”¨ï¼Œåœ¨ Web UI ä¸­æ˜¾ç¤ºçš„çŠ¶æ€å¤§å°æˆ–ä» rest API ä¸­è·å–çš„çŠ¶æ€å¤§å°åªä»£è¡¨ delta æ£€æŸ¥ç‚¹å¤§å°ï¼Œè€Œä¸æ˜¯å®Œæ•´çš„æ£€æŸ¥ç‚¹å¤§å°ã€‚ä¸€äº›çŠ¶æ€åç«¯å¯èƒ½ä¸æ”¯æŒå¢é‡æ£€æŸ¥ç‚¹è€Œå¿½ç•¥è¿™ä¸ªé€‰é¡¹ã€‚   state.backend.local-recovery false Boolean è¿™ä¸ªé€‰é¡¹å¯ä»¥é…ç½®è¿™ä¸ªçŠ¶æ€åç«¯çš„æœ¬åœ°æ¢å¤ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæœ¬åœ°æ¢å¤æ˜¯è¢«åœç”¨çš„ã€‚æœ¬åœ°æ¢å¤ç›®å‰åªè¦†ç›– keyed state åç«¯ã€‚ç›®å‰ï¼ŒMemoryStateBackend ä¸æ”¯æŒæœ¬åœ°æ¢å¤ï¼Œå¿½ç•¥æ­¤é€‰é¡¹ã€‚   state.checkpoints.dir (none) String åœ¨ Flink æ”¯æŒçš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œç”¨äºå­˜å‚¨æ£€æŸ¥ç‚¹æ•°æ®æ–‡ä»¶å’Œå…ƒæ•°æ®çš„é»˜è®¤ç›®å½•ã€‚è¯¥å­˜å‚¨è·¯å¾„å¿…é¡»å¯ä»¥ä»æ‰€æœ‰å‚ä¸è¿›ç¨‹/èŠ‚ç‚¹ï¼ˆå³æ‰€æœ‰ TaskManager å’Œ JobManagerï¼‰è®¿é—®ã€‚   state.checkpoints.num-retained 1 Integer ä¿ç•™å·²å®Œæˆçš„æ£€æŸ¥ç‚¹çš„æœ€å¤§æ•°é‡ã€‚   state.savepoints.dir (none) String ä¿å­˜ç‚¹çš„é»˜è®¤ç›®å½•ã€‚ç”±å°†ä¿å­˜ç‚¹å†™å…¥æ–‡ä»¶ç³»ç»Ÿçš„çŠ¶æ€åç«¯ï¼ˆMemoryStateBackend, FsStateBackend, RocksDBStateBackendï¼‰ä½¿ç”¨ã€‚   taskmanager.state.local.root-dirs (none) String é…ç½®å‚æ•°ï¼Œå®šä¹‰æœ¬åœ°æ¢å¤ä¸­å­˜å‚¨åŸºäºæ–‡ä»¶çš„çŠ¶æ€çš„æ ¹ç›®å½•ã€‚æœ¬åœ°æ¢å¤ç›®å‰åªè¦†ç›– keyed state åç«¯ã€‚ç›®å‰ï¼ŒMemoryStateBackend ä¸æ”¯æŒæœ¬åœ°æ¢å¤ï¼Œå¿½ç•¥è¿™ä¸ªé€‰é¡¹ã€‚    é€‰æ‹©çŠ¶æ€åç«¯ Flink çš„æ£€æŸ¥ç‚¹æœºåˆ¶åœ¨å®šæ—¶å™¨å’Œæœ‰çŠ¶æ€çš„æ“ä½œç¬¦ä¸­å­˜å‚¨æ‰€æœ‰çŠ¶æ€çš„ä¸€è‡´å¿«ç…§ï¼ŒåŒ…æ‹¬è¿æ¥å™¨ã€çª—å£å’Œä»»ä½•ç”¨æˆ·å®šä¹‰çš„çŠ¶æ€ã€‚æ£€æŸ¥ç‚¹å­˜å‚¨çš„ä½ç½®ï¼ˆä¾‹å¦‚ï¼ŒJobManagerå†…å­˜ã€æ–‡ä»¶ç³»ç»Ÿã€æ•°æ®åº“ï¼‰å–å†³äºé…ç½®çš„çŠ¶æ€åç«¯ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼ŒçŠ¶æ€ä¿å­˜åœ¨ TaskManager çš„å†…å­˜ä¸­ï¼Œæ£€æŸ¥ç‚¹ä¿å­˜åœ¨ JobManager çš„å†…å­˜ä¸­ã€‚ä¸ºäº†æ­£ç¡®åœ°æŒä¹…åŒ–å¤§çŠ¶æ€ï¼ŒFlink æ”¯æŒå„ç§æ–¹æ³•åœ¨å…¶ä»–çŠ¶æ€åç«¯å­˜å‚¨å’Œæ£€æŸ¥ç‚¹çŠ¶æ€ã€‚çŠ¶æ€åç«¯çš„é€‰æ‹©å¯ä»¥é€šè¿‡ StreamExecutionEnvironment.setStateBackend(...) è¿›è¡Œé…ç½®ã€‚\næœ‰å…³å¯ç”¨çš„çŠ¶æ€åç«¯ä»¥åŠä½œä¸šèŒƒå›´(job-wide)å’Œé›†ç¾¤èŒƒå›´(cluster-wide)é…ç½®é€‰é¡¹çš„æ›´å¤šç»†èŠ‚ï¼Œè¯·å‚è§çŠ¶æ€åç«¯ã€‚\nè¿­ä»£ä½œä¸šä¸­çš„çŠ¶æ€æ£€æŸ¥ç‚¹ Flink ç›®å‰åªä¸ºæ²¡æœ‰è¿­ä»£çš„ä½œä¸šæä¾›å¤„ç†ä¿è¯ã€‚åœ¨è¿­ä»£ä½œä¸šä¸Šå¯ç”¨æ£€æŸ¥ç‚¹ä¼šå¯¼è‡´å¼‚å¸¸ã€‚ä¸ºäº†åœ¨è¿­ä»£ç¨‹åºä¸Šå¼ºåˆ¶æ£€æŸ¥ç‚¹ï¼Œç”¨æˆ·éœ€è¦åœ¨å¯ç”¨æ£€æŸ¥ç‚¹æ—¶è®¾ç½®ä¸€ä¸ªç‰¹æ®Šæ ‡å¿—ï¼šenv.enableCheckpointing(interval, CheckpointingMode.EXACTLY_ONCE, force = true)ã€‚\nè¯·æ³¨æ„ï¼Œå¾ªç¯è¾¹ç¼˜ä¸­é£è¡Œä¸­çš„è®°å½•ï¼ˆä»¥åŠä¸ä¹‹ç›¸å…³çš„çŠ¶æ€å˜åŒ–ï¼‰å°†åœ¨å¤±è´¥æ—¶ä¸¢å¤±ã€‚\né‡æ–°å¯åŠ¨ç­–ç•¥ Flink æ”¯æŒä¸åŒçš„é‡å¯ç­–ç•¥ï¼Œè¿™äº›ç­–ç•¥å¯ä»¥æ§åˆ¶ä½œä¸š(job)åœ¨å‘ç”Ÿæ•…éšœæ—¶å¦‚ä½•é‡å¯ã€‚æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…é‡å¯ç­–ç•¥ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-21-checkpointing/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataStream API"],"title":"æ£€æŸ¥ç‚¹"},{"categories":["Flink"],"contents":"æ£€æµ‹è¡¨æ ¼ä¸­çš„æ¨¡å¼ æœç´¢ä¸€ç»„äº‹ä»¶æ¨¡å¼æ˜¯ä¸€ä¸ªå¸¸è§çš„ç”¨ä¾‹ï¼Œç‰¹åˆ«æ˜¯åœ¨æ•°æ®æµçš„æƒ…å†µä¸‹ã€‚Flink è‡ªå¸¦å¤æ‚äº‹ä»¶å¤„ç†ï¼ˆCEPï¼‰åº“ï¼Œå¯ä»¥åœ¨äº‹ä»¶æµä¸­è¿›è¡Œæ¨¡å¼æ£€æµ‹ã€‚æ­¤å¤–ï¼ŒFlink çš„ SQL API æä¾›äº†ä¸€ç§å…³ç³»å‹çš„æŸ¥è¯¢è¡¨è¾¾æ–¹å¼ï¼Œæœ‰å¤§é‡çš„å†…ç½®å‡½æ•°å’ŒåŸºäºè§„åˆ™çš„ä¼˜åŒ–ï¼Œå¯ä»¥å¼€ç®±å³ç”¨ã€‚\n2016 å¹´ 12 æœˆï¼Œå›½é™…æ ‡å‡†åŒ–ç»„ç»‡ï¼ˆISOï¼‰å‘å¸ƒäº†æ–°ç‰ˆæœ¬çš„ SQL æ ‡å‡†ï¼Œå…¶ä¸­åŒ…æ‹¬ SQL ä¸­çš„è¡Œæ¨¡å¼è¯†åˆ«ï¼ˆISO/IEC TR 19075-5:2016ï¼‰ã€‚å®ƒå…è®¸ Flink ä½¿ç”¨ MATCH_RECOGNIZE å­å¥æ•´åˆ CEP å’Œ SQL APIï¼Œç”¨äº SQL ä¸­çš„å¤æ‚äº‹ä»¶å¤„ç†ã€‚\nMATCH_RECOGNIZE å­å¥å¯ä»¥å®ç°ä»¥ä¸‹ä»»åŠ¡ã€‚\nå¯¹ä½¿ç”¨ partition by å’Œ order by å­å¥çš„æ•°æ®è¿›è¡Œé€»è¾‘åˆ†åŒºå’Œæ’åºã€‚ ä½¿ç”¨ PATTERN å­å¥å®šä¹‰è¦å¯»æ‰¾çš„è¡Œçš„æ¨¡å¼ã€‚è¿™äº›æ¨¡å¼ä½¿ç”¨ç±»ä¼¼äºæ­£åˆ™è¡¨è¾¾å¼çš„è¯­æ³•ã€‚ è¡Œæ¨¡å¼å˜é‡çš„é€»è¾‘æˆåˆ†åœ¨ DEFINE å­å¥ä¸­æŒ‡å®šã€‚ åœ¨ MEASURES å­å¥ä¸­å®šä¹‰æªæ–½ï¼Œè¿™äº›æªæ–½æ˜¯åœ¨ SQL æŸ¥è¯¢çš„å…¶ä»–éƒ¨åˆ†ä¸­å¯ç”¨çš„è¡¨è¾¾å¼ã€‚ ä¸‹é¢çš„ä¾‹å­è¯´æ˜äº†åŸºæœ¬æ¨¡å¼è¯†åˆ«çš„è¯­æ³•ã€‚\nSELECTT.aid,T.bid,T.cidFROMMyTableMATCH_RECOGNIZE(PARTITIONBYuseridORDERBYproctimeMEASURESA.idASaid,B.idASbid,C.idAScidPATTERN(ABC)DEFINEAASname=\u0026#39;a\u0026#39;,BASname=\u0026#39;b\u0026#39;,CASname=\u0026#39;c\u0026#39;)ASTæœ¬é¡µå°†æ›´è¯¦ç»†åœ°è§£é‡Šæ¯ä¸ªå…³é”®å­—ï¼Œå¹¶å°†è¯´æ˜æ›´å¤æ‚çš„ä¾‹å­ã€‚\næ³¨æ„ Flink å¯¹ MATCH_RECOGNIZE å­å¥çš„å®ç°æ˜¯å®Œæ•´æ ‡å‡†çš„ä¸€ä¸ªå­é›†ã€‚åªæœ‰é‚£äº›åœ¨ä¸‹é¢çš„ç« èŠ‚ä¸­è®°å½•çš„åŠŸèƒ½å¾—åˆ°äº†æ”¯æŒã€‚æ ¹æ®ç¤¾åŒºåé¦ˆï¼Œå¯èƒ½ä¼šæ”¯æŒæ›´å¤šçš„åŠŸèƒ½ï¼Œä¹Ÿè¯·çœ‹ä¸€ä¸‹å·²çŸ¥çš„é™åˆ¶ã€‚\nä»‹ç»å’Œç¤ºä¾‹ å®‰è£…æŒ‡å— æ¨¡å¼è¯†åˆ«åŠŸèƒ½å†…éƒ¨ä½¿ç”¨äº† Apache Flink çš„ CEP åº“ã€‚ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨ MATCH_RECOGNIZE å­å¥ï¼Œéœ€è¦å°†è¯¥åº“ä½œä¸ºä¸€ä¸ªä¾èµ–é¡¹æ·»åŠ åˆ°ä½ çš„ Maven é¡¹ç›®ä¸­ã€‚\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.flink\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flink-cep_2.11\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.11.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; å¦å¤–ï¼Œä½ ä¹Ÿå¯ä»¥å°†ä¾èµ–å…³ç³»æ·»åŠ åˆ°é›†ç¾¤ classpath ä¸­ï¼ˆæ›´å¤šä¿¡æ¯è¯·å‚è§ä¾èµ–å…³ç³»éƒ¨åˆ†ï¼‰ã€‚\nå¦‚æœä½ æƒ³åœ¨ SQL å®¢æˆ·ç«¯ä¸­ä½¿ç”¨ MATCH_RECOGNIZE å­å¥ï¼Œä½ ä¸éœ€è¦åšä»»ä½•äº‹æƒ…ï¼Œå› ä¸ºæ‰€æœ‰çš„ä¾èµ–å…³ç³»éƒ½æ˜¯é»˜è®¤çš„ã€‚\nSQL è¯­ä¹‰ æ¯ä¸ª MATCH_RECOGNIZE æŸ¥è¯¢éƒ½ç”±ä»¥ä¸‹å­å¥ç»„æˆã€‚\nPARTITION BY - å®šä¹‰è¡¨çš„é€»è¾‘åˆ†åŒºï¼›ç±»ä¼¼äº GROUP BY æ“ä½œã€‚\nMEASURES - å®šä¹‰å­å¥çš„è¾“å‡ºï¼›ç±»ä¼¼äº SELECT å­å¥ã€‚ ONE ROW PER MATCH - è¾“å‡ºæ¨¡å¼ï¼Œå®šä¹‰æ¯æ¬¡åŒ¹é…åº”è¯¥äº§ç”Ÿå¤šå°‘è¡Œã€‚ AFTER MATCH SKIP\u0026ndash;æŒ‡å®šä¸‹ä¸€ä¸ªåŒ¹é…åº”è¯¥ä»å“ªé‡Œå¼€å§‹ï¼›è¿™ä¹Ÿæ˜¯æ§åˆ¶ä¸€ä¸ªäº‹ä»¶å¯ä»¥å±äºå¤šå°‘ä¸ªä¸åŒåŒ¹é…çš„æ–¹æ³•ã€‚ PATTERN - å…è®¸ä½¿ç”¨ç±»ä¼¼äºæ­£åˆ™è¡¨è¾¾å¼çš„è¯­æ³•æ¥æ„å»ºæœç´¢çš„æ¨¡å¼ã€‚ DEFINE - è¿™ä¸€éƒ¨åˆ†å®šä¹‰äº†æ¨¡å¼å˜é‡å¿…é¡»æ»¡è¶³çš„æ¡ä»¶ã€‚ æ³¨æ„ ç›®å‰ï¼ŒMATCH_RECOGNIZE å­å¥åªèƒ½åº”ç”¨äºè¿½åŠ è¡¨ã€‚æ­¤å¤–ï¼Œå®ƒä¹Ÿæ€»æ˜¯äº§ç”Ÿä¸€ä¸ªè¿½åŠ è¡¨ã€‚\nä¾‹å­ åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å‡è®¾å·²ç»æ³¨å†Œäº†ä¸€ä¸ª Ticker è¡¨ã€‚è¯¥è¡¨åŒ…å«è‚¡ç¥¨åœ¨æŸä¸€ç‰¹å®šæ—¶é—´ç‚¹çš„ä»·æ ¼ã€‚\nè¯¥è¡¨çš„æ¨¡å¼å¦‚ä¸‹ï¼š\nTicker |-- symbol: String # symbol of the stock |-- price: Long # price of the stock |-- tax: Long # tax liability of the stock |-- rowtime: TimeIndicatorTypeInfo(rowtime) # point in time when the change to those values happened ä¸ºäº†ç®€åŒ–ï¼Œæˆ‘ä»¬åªè€ƒè™‘å•åªè‚¡ç¥¨ ACME çš„ä¼ å…¥æ•°æ®ã€‚ä¸€ä¸ªè¡Œæƒ…å¯ä»¥ç±»ä¼¼äºä¸‹è¡¨ï¼Œå…¶ä¸­è¡Œæ˜¯è¿ç»­è¿½åŠ çš„ã€‚\nsymbol rowtime price tax ====== ==================== ======= ======= 'ACME' '01-Apr-11 10:00:00' 12 1 'ACME' '01-Apr-11 10:00:01' 17 2 'ACME' '01-Apr-11 10:00:02' 19 1 'ACME' '01-Apr-11 10:00:03' 21 3 'ACME' '01-Apr-11 10:00:04' 25 2 'ACME' '01-Apr-11 10:00:05' 18 1 'ACME' '01-Apr-11 10:00:06' 15 1 'ACME' '01-Apr-11 10:00:07' 14 2 'ACME' '01-Apr-11 10:00:08' 24 2 'ACME' '01-Apr-11 10:00:09' 25 2 'ACME' '01-Apr-11 10:00:10' 19 1 ç°åœ¨çš„ä»»åŠ¡æ˜¯å¯»æ‰¾å•ä¸€è¡Œæƒ…çš„ä»·æ ¼ä¸æ–­ä¸‹é™çš„æ—¶æœŸã€‚ä¸ºæ­¤ï¼Œå¯ä»¥å†™ä¸€ä¸ªç±»ä¼¼çš„æŸ¥è¯¢ã€‚\nSELECT*FROMTickerMATCH_RECOGNIZE(PARTITIONBYsymbolORDERBYrowtimeMEASURESSTART_ROW.rowtimeASstart_tstamp,LAST(PRICE_DOWN.rowtime)ASbottom_tstamp,LAST(PRICE_UP.rowtime)ASend_tstampONEROWPERMATCHAFTERMATCHSKIPTOLASTPRICE_UPPATTERN(START_ROWPRICE_DOWN+PRICE_UP)DEFINEPRICE_DOWNAS(LAST(PRICE_DOWN.price,1)ISNULLANDPRICE_DOWN.price\u0026lt;START_ROW.price)ORPRICE_DOWN.price\u0026lt;LAST(PRICE_DOWN.price,1),PRICE_UPASPRICE_UP.price\u0026gt;LAST(PRICE_DOWN.price,1))MR;è¯¥æŸ¥è¯¢æŒ‰ç¬¦å·åˆ—å¯¹ Ticker è¡¨è¿›è¡Œåˆ†åŒºï¼Œå¹¶æŒ‰è¡Œæ—¶é—´å±æ€§è¿›è¡Œæ’åºã€‚\nPATTERN å­å¥æŒ‡å®šæˆ‘ä»¬æ„Ÿå…´è¶£çš„æ¨¡å¼æ˜¯ä»¥ START_ROW äº‹ä»¶ä¸ºèµ·ç‚¹ï¼Œç„¶åæ˜¯ä¸€ä¸ªæˆ–å¤šä¸ª PRICE_DOWN äº‹ä»¶ï¼Œæœ€åæ˜¯ PRICE_UP äº‹ä»¶ã€‚å¦‚æœèƒ½æ‰¾åˆ°è¿™æ ·çš„æ¨¡å¼ï¼Œä¸‹ä¸€ä¸ªæ¨¡å¼åŒ¹é…å°†åœ¨æœ€åä¸€ä¸ª PRICE_UP äº‹ä»¶ä¸­å¯»æ‰¾ï¼Œå¦‚ AFTER MATCH SKIP TO LAST å­å¥æ‰€ç¤ºã€‚\nDEFINE å­å¥æŒ‡å®šäº† PRICE_DOWN å’Œ PRICE_UP äº‹ä»¶éœ€è¦æ»¡è¶³çš„æ¡ä»¶ã€‚è™½ç„¶ START_ROW æ¨¡å¼å˜é‡å¹¶ä¸å­˜åœ¨ï¼Œä½†å®ƒæœ‰ä¸€ä¸ªéšå«çš„æ¡ä»¶ï¼Œè¿™ä¸ªæ¡ä»¶æ€»æ˜¯è¢«è¯„ä¼°ä¸º TRUEã€‚\næ¨¡å¼å˜é‡ PRICE_DOWN è¢«å®šä¹‰ä¸ºä»·æ ¼å°äºæ»¡è¶³ PRICE_DOWN æ¡ä»¶çš„æœ€åä¸€è¡Œçš„ä»·æ ¼ã€‚å¯¹äºåˆå§‹æƒ…å†µæˆ–è€…æ²¡æœ‰æ»¡è¶³ PRICE_DOWN æ¡ä»¶çš„æœ€åä¸€è¡Œï¼Œè¿™ä¸€è¡Œçš„ä»·æ ¼åº”è¯¥å°äºæ¨¡å¼ä¸­å‰ä¸€è¡Œçš„ä»·æ ¼ï¼ˆç”± START_ROW å¼•ç”¨ï¼‰ã€‚\næ¨¡å¼å˜é‡ PRICE_UP è¢«å®šä¹‰ä¸ºä»·æ ¼å¤§äºæ»¡è¶³ PRICE_DOWN æ¡ä»¶çš„æœ€åä¸€è¡Œçš„ä»·æ ¼çš„è¡Œã€‚\nè¯¥æŸ¥è¯¢ä¸ºè‚¡ç¥¨ä»·æ ¼è¿ç»­ä¸‹è·Œçš„æ¯ä¸ªæ—¶æœŸäº§ç”Ÿä¸€æ¡æ±‡æ€»è¡Œã€‚\nè¾“å‡ºè¡Œçš„å…·ä½“è¡¨ç¤ºæ–¹æ³•åœ¨æŸ¥è¯¢çš„ MEASURES éƒ¨åˆ†å®šä¹‰ã€‚è¾“å‡ºè¡Œçš„æ•°é‡ç”± ONE ROW PER MATCH è¾“å‡ºæ¨¡å¼å®šä¹‰ã€‚\n symbol start_tstamp bottom_tstamp end_tstamp ========= ================== ================== ================== ACME 01-APR-11 10:00:04 01-APR-11 10:00:07 01-APR-11 10:00:08 ç»“æœä¸€è¡Œæè¿°äº†ä» 01-APR-11 10:00:04 å¼€å§‹çš„ä»·æ ¼ä¸‹é™æœŸï¼Œåœ¨ 01-APR-11 10:00:07 è¾¾åˆ°æœ€ä½ä»·ï¼Œåœ¨ 01-APR-11 10:00:08 å†æ¬¡ä¸Šæ¶¨ã€‚\nåˆ†å‰² å¯ä»¥åœ¨åˆ†åŒºæ•°æ®ä¸­å¯»æ‰¾æ¨¡å¼ï¼Œä¾‹å¦‚ï¼Œå•ä¸ªè‚¡ç¥¨æˆ–ç‰¹å®šç”¨æˆ·çš„è¶‹åŠ¿ã€‚è¿™å¯ä»¥ä½¿ç”¨ partition by å­å¥æ¥è¡¨è¾¾ã€‚è¯¥å­å¥ç±»ä¼¼äºä½¿ç”¨ GROUP BY è¿›è¡Œèšåˆã€‚\næ³¨æ„ å¼ºçƒˆå»ºè®®å¯¹è¾“å…¥çš„æ•°æ®è¿›è¡Œåˆ†åŒºï¼Œå¦åˆ™ MATCH_RECOGNIZE å­å¥å°†è¢«ç¿»è¯‘æˆä¸€ä¸ªéå¹³è¡Œæ“ä½œç¬¦ï¼Œä»¥ç¡®ä¿å…¨å±€æ’åºã€‚\näº‹ä»¶çš„é¡ºåº Apache Flink å…è®¸æ ¹æ®æ—¶é—´æ¥æœç´¢æ¨¡å¼ï¼›æ— è®ºæ˜¯å¤„ç†æ—¶é—´è¿˜æ˜¯äº‹ä»¶æ—¶é—´ã€‚\nåœ¨äº‹ä»¶æ—¶é—´çš„æƒ…å†µä¸‹ï¼Œäº‹ä»¶åœ¨è¢«ä¼ é€’åˆ°å†…éƒ¨æ¨¡å¼çŠ¶æ€æœºä¹‹å‰ä¼šè¢«æ’åºã€‚å› æ­¤ï¼Œäº§ç”Ÿçš„è¾“å‡ºå°†æ˜¯æ­£ç¡®çš„ï¼Œä¸ç®¡è¡Œè¢«é™„åŠ åˆ°è¡¨ä¸­çš„é¡ºåºå¦‚ä½•ã€‚ç›¸åï¼Œæ¨¡å¼æ˜¯æŒ‰ç…§æ¯è¡ŒåŒ…å«çš„æ—¶é—´æ‰€æŒ‡å®šçš„é¡ºåºæ¥è¯„ä¼°çš„ã€‚\nMATCH_RECOGNIZE å­å¥å‡è®¾æ—¶é—´å±æ€§ä»¥å‡åºä½œä¸º ORDER BY å­å¥çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚\nå¯¹äº Ticker è¡¨çš„ä¾‹å­ï¼Œåƒ ORDER BY rowtime ASC, price DESC è¿™æ ·çš„å®šä¹‰æ˜¯æœ‰æ•ˆçš„ï¼Œä½†æ˜¯ ORDER BY price, rowtime æˆ–è€… ORDER BY rowtime DESC, price ASC æ˜¯æ— æ•ˆçš„ã€‚\nå®šä¹‰å’Œæµ‹é‡ DEFINE å’Œ MEASURES å…³é”®å­—çš„å«ä¹‰ç±»ä¼¼äºç®€å• SQL æŸ¥è¯¢ä¸­çš„ WHERE å’Œ SELECT å­å¥ã€‚\nMEASURES å­å¥å®šä¹‰äº†åŒ¹é…æ¨¡å¼çš„è¾“å‡ºä¸­ä¼šåŒ…å«å“ªäº›å†…å®¹ã€‚å®ƒå¯ä»¥æŠ•å°„åˆ—å’Œå®šä¹‰è¯„ä¼°çš„è¡¨è¾¾å¼ã€‚äº§ç”Ÿçš„è¡Œæ•°å–å†³äºè¾“å‡ºæ¨¡å¼çš„è®¾ç½®ã€‚\nDEFINE å­å¥æŒ‡å®šäº†è¡Œå¿…é¡»æ»¡è¶³çš„æ¡ä»¶ï¼Œä»¥ä¾¿å°†å…¶åˆ†ç±»åˆ°ç›¸åº”çš„æ¨¡å¼å˜é‡ã€‚å¦‚æœæ²¡æœ‰ä¸ºæ¨¡å¼å˜é‡å®šä¹‰æ¡ä»¶ï¼Œé‚£ä¹ˆå°†ä½¿ç”¨ä¸€ä¸ªé»˜è®¤æ¡ä»¶ï¼Œè¯¥æ¡ä»¶å¯¹æ¯æ¡è®°å½•çš„è¯„ä»·ä¸ºçœŸã€‚\nå…³äºè¿™äº›å­å¥ä¸­å¯ä»¥ä½¿ç”¨çš„è¡¨è¾¾å¼çš„æ›´è¯¦ç»†è§£é‡Šï¼Œè¯·çœ‹äº‹ä»¶æµå¯¼èˆªéƒ¨åˆ†ã€‚\nèšåˆ èšåˆå¯ä»¥åœ¨ DEFINE å’Œ MEASURES å­å¥ä¸­ä½¿ç”¨ã€‚åŒæ—¶æ”¯æŒå†…ç½®å’Œè‡ªå®šä¹‰çš„ç”¨æˆ·å®šä¹‰å‡½æ•°ã€‚\nèšåˆå‡½æ•°è¢«åº”ç”¨äºæ˜ å°„åˆ°åŒ¹é…çš„è¡Œçš„æ¯ä¸ªå­é›†ã€‚ä¸ºäº†äº†è§£è¿™äº›å­é›†æ˜¯å¦‚ä½•è¢«è¯„ä¼°çš„ï¼Œè¯·çœ‹ä¸€ä¸‹äº‹ä»¶æµå¯¼èˆªéƒ¨åˆ†ã€‚\nä¸‹é¢è¿™ä¸ªä¾‹å­çš„ä»»åŠ¡æ˜¯æ‰¾åˆ°ä¸€ä¸ªè‚¡ç¥¨å¹³å‡ä»·æ ¼ä¸ä½äºæŸä¸ªé˜ˆå€¼çš„æœ€é•¿æ—¶é—´æ®µã€‚å®ƒæ˜¾ç¤ºäº† MATCH_RECOGNIZE å¯ä»¥å¦‚ä½•é€šè¿‡èšåˆæ¥è¡¨è¾¾ã€‚è¿™ä¸ªä»»åŠ¡å¯ä»¥ç”¨ä¸‹é¢çš„æŸ¥è¯¢æ¥æ‰§è¡Œã€‚\nSELECT*FROMTickerMATCH_RECOGNIZE(PARTITIONBYsymbolORDERBYrowtimeMEASURESFIRST(A.rowtime)ASstart_tstamp,LAST(A.rowtime)ASend_tstamp,AVG(A.price)ASavgPriceONEROWPERMATCHAFTERMATCHSKIPPASTLASTROWPATTERN(A+B)DEFINEAASAVG(A.price)\u0026lt;15)MR;ç»™å®šè¿™ä¸ªæŸ¥è¯¢å’Œä»¥ä¸‹è¾“å…¥å€¼ï¼š\nsymbol rowtime price tax ====== ==================== ======= ======= 'ACME' '01-Apr-11 10:00:00' 12 1 'ACME' '01-Apr-11 10:00:01' 17 2 'ACME' '01-Apr-11 10:00:02' 13 1 'ACME' '01-Apr-11 10:00:03' 16 3 'ACME' '01-Apr-11 10:00:04' 25 2 'ACME' '01-Apr-11 10:00:05' 2 1 'ACME' '01-Apr-11 10:00:06' 4 1 'ACME' '01-Apr-11 10:00:07' 10 2 'ACME' '01-Apr-11 10:00:08' 15 2 'ACME' '01-Apr-11 10:00:09' 25 2 'ACME' '01-Apr-11 10:00:10' 25 1 'ACME' '01-Apr-11 10:00:11' 30 1 åªè¦äº‹ä»¶çš„å¹³å‡ä»·æ ¼ä¸è¶…è¿‡ 15ï¼ŒæŸ¥è¯¢å°±ä¼šå°†äº‹ä»¶ç´¯ç§¯ä¸ºæ¨¡å¼å˜é‡ A çš„ä¸€éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œè¿™æ ·çš„è¶…é™äº‹ä»¶å‘ç”Ÿåœ¨ 01-4-11 10:00:04ã€‚æ¥ä¸‹æ¥çš„æ—¶æœŸåœ¨ 01-4-11 10:00:11 å†æ¬¡è¶…è¿‡ 15 çš„å¹³å‡ä»·æ ¼ã€‚å› æ­¤ï¼Œæ‰€è¿°æŸ¥è¯¢çš„ç»“æœå°†æ˜¯ï¼šã€‚\n symbol start_tstamp end_tstamp avgPrice ========= ================== ================== ============ ACME 01-APR-11 10:00:00 01-APR-11 10:00:03 14.5 ACME 01-APR-11 10:00:05 01-APR-11 10:00:10 13.5 æ³¨æ„ èšåˆå¯ä»¥åº”ç”¨äºè¡¨è¾¾å¼ï¼Œä½†åªæœ‰å½“å®ƒä»¬å¼•ç”¨ä¸€ä¸ªå•ä¸€çš„æ¨¡å¼å˜é‡æ—¶æ‰å¯ä»¥ã€‚å› æ­¤ SUM(A.price * A.tax)æ˜¯æœ‰æ•ˆçš„ï¼Œä½†æ˜¯ AVG(A.price * B.tax)ä¸æ˜¯ã€‚\næ³¨æ„ä¸æ”¯æŒ DISTINCT èšåˆã€‚\nå®šä¹‰ä¸€ä¸ªæ¨¡å¼ MATCH_RECOGNIZE å­å¥å…è®¸ç”¨æˆ·åœ¨äº‹ä»¶æµä¸­æœç´¢æ¨¡å¼ï¼Œä½¿ç”¨ä¸€ç§å¼ºå¤§çš„ã€å¯Œæœ‰è¡¨ç°åŠ›çš„è¯­æ³•ï¼Œè¿™ç§è¯­æ³•ä¸å¹¿æ³›ä½¿ç”¨çš„æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•æœ‰äº›ç›¸ä¼¼ã€‚\næ¯ä¸ªæ¨¡å¼éƒ½æ˜¯ç”±åŸºæœ¬çš„æ„ä»¶æ„æˆçš„ï¼Œç§°ä¸ºæ¨¡å¼å˜é‡ï¼Œå¯ä»¥å¯¹å…¶åº”ç”¨è¿ç®—ç¬¦ï¼ˆé‡åŒ–ç¬¦å’Œå…¶ä»–ä¿®é¥°ç¬¦ï¼‰ã€‚æ•´ä¸ªæ¨¡å¼å¿…é¡»ç”¨æ‹¬å·æ‹¬èµ·æ¥ã€‚\nä¸€ä¸ªæ¨¡å¼çš„ä¾‹å­å¯ä»¥æ˜¯è¿™æ ·çš„ã€‚\nPATTERN (A B+ C* D) æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ“ä½œç¬¦ã€‚\nå¹¶é›† \u0026ndash; åƒ(A B)è¿™æ ·çš„æ¨¡å¼æ„å‘³ç€ A å’Œ B ä¹‹é—´çš„ç›¸é‚»æ€§æ˜¯ä¸¥æ ¼çš„ï¼Œå› æ­¤ï¼Œä¸­é—´ä¸èƒ½æœ‰æ²¡æœ‰æ˜ å°„åˆ° A æˆ– B çš„è¡Œã€‚ å®šé‡ç¬¦\u0026ndash;ä¿®æ”¹å¯ä»¥æ˜ å°„åˆ°æ¨¡å¼å˜é‡çš„è¡Œæ•°ã€‚\n* â€” 0 or more rows + â€” 1 or more rows ? â€” 0 or 1 rows { n } â€” exactly n rows (n \u0026gt; 0) { n, } â€” n or more rows (n â‰¥ 0) { n, m } â€” between n and m (inclusive) rows (0 â‰¤ n â‰¤ m, 0 \u0026lt; m) { , m } â€” between 0 and m (inclusive) rows (m \u0026gt; 0) æ³¨æ„ ä¸æ”¯æŒå¯èƒ½äº§ç”Ÿç©ºåŒ¹é…çš„æ¨¡å¼ã€‚è¿™ç±»æ¨¡å¼çš„ä¾‹å­æœ‰ PATTERN (A*)ã€PATTERN (A?B*)ã€PATTERN (A{0,} B{0,} C*)ç­‰ã€‚\nè´ªå©ªå’Œä¸æƒ…æ„¿çš„é‡åŒ–å™¨ æ¯ä¸ªé‡åŒ–å™¨å¯ä»¥æ˜¯è´ªå©ªçš„ï¼ˆé»˜è®¤è¡Œä¸ºï¼‰æˆ–å‹‰å¼ºçš„ã€‚è´ªå©ªçš„é‡åŒ–å™¨è¯•å›¾åŒ¹é…å°½å¯èƒ½å¤šçš„è®°å½•ï¼Œè€Œä¸æƒ…æ„¿çš„é‡åŒ–å™¨è¯•å›¾åŒ¹é…å°½å¯èƒ½å°‘çš„è®°å½•ã€‚\nä¸ºäº†è¯´æ˜ä¸¤è€…çš„åŒºåˆ«ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ä¸‹é¢çš„ç¤ºä¾‹ï¼Œåœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œä¸€ä¸ªè´ªå©ªçš„é‡åŒ–å™¨è¢«åº”ç”¨äº B å˜é‡ã€‚\nSELECT*FROMTickerMATCH_RECOGNIZE(PARTITIONBYsymbolORDERBYrowtimeMEASURESC.priceASlastPriceONEROWPERMATCHAFTERMATCHSKIPPASTLASTROWPATTERN(AB*C)DEFINEAASA.price\u0026gt;10,BASB.price\u0026lt;15,CASC.price\u0026gt;12)é‰´äºæˆ‘ä»¬æœ‰ä»¥ä¸‹è¾“å…¥ã€‚\n symbol tax price rowtime ======= ===== ======== ===================== XYZ 1 10 2018-09-17 10:00:02 XYZ 2 11 2018-09-17 10:00:03 XYZ 1 12 2018-09-17 10:00:04 XYZ 2 13 2018-09-17 10:00:05 XYZ 1 14 2018-09-17 10:00:06 XYZ 2 16 2018-09-17 10:00:07 ä¸Šè¿°æ¨¡å¼å°†äº§ç”Ÿä»¥ä¸‹è¾“å‡ºã€‚\n symbol lastPrice ======== =========== XYZ 16 åŒæ ·çš„æŸ¥è¯¢ï¼Œå°† B* ä¿®æ”¹ä¸º B* å—ï¼Œå³ B*åº”è¯¥æ˜¯ä¸æ„¿æ„çš„ï¼Œä¼šäº§ç”Ÿã€‚\n symbol lastPrice ======== =========== XYZ 13 XYZ 16 æ¨¡å¼å˜é‡ B åªåŒ¹é…åˆ°ä»·æ ¼ä¸º 12 çš„è¡Œï¼Œè€Œä¸æ˜¯åæ‰ä»·æ ¼ä¸º 12ã€13ã€14 çš„è¡Œã€‚\næ³¨æ„ å¯¹äºä¸€ä¸ªæ¨¡å¼çš„æœ€åä¸€ä¸ªå˜é‡ï¼Œä¸å¯èƒ½ä½¿ç”¨è´ªå©ªçš„é‡åŒ–ç¬¦ã€‚å› æ­¤ï¼Œåƒï¼ˆA B*ï¼‰è¿™æ ·çš„æ¨¡å¼æ˜¯ä¸å…è®¸çš„ã€‚è¿™å¯ä»¥é€šè¿‡å¼•å…¥ä¸€ä¸ªäººä¸ºçš„çŠ¶æ€ï¼ˆå¦‚ Cï¼‰æ¥è½»æ¾è§£å†³ï¼Œè¿™ä¸ªçŠ¶æ€å…·æœ‰ B çš„å¦å®šæ¡ä»¶ï¼Œæ‰€ä»¥ä½ å¯ä»¥ä½¿ç”¨è¿™æ ·çš„æŸ¥è¯¢ã€‚\nPATTERN (A B* C) DEFINE A AS condA(), B AS condB(), C AS NOT condB() æ³¨æ„ ç›®å‰ä¸æ”¯æŒå¯é€‰çš„å‹‰å¼ºé‡åŒ–ç¬¦(A??æˆ– A{0,1}?)ã€‚\næ—¶é—´é™åˆ¶ ç‰¹åˆ«æ˜¯å¯¹äºæµå¼ä½¿ç”¨æ¡ˆä¾‹ï¼Œé€šå¸¸è¦æ±‚ä¸€ä¸ªæ¨¡å¼åœ¨ç»™å®šçš„æ—¶é—´å†…å®Œæˆã€‚è¿™å…è®¸é™åˆ¶ Flink å¿…é¡»åœ¨å†…éƒ¨ç»´æŠ¤çš„æ•´ä½“çŠ¶æ€å¤§å°ï¼Œå³ä½¿åœ¨è´ªå©ªçš„é‡åŒ–å™¨çš„æƒ…å†µä¸‹ã€‚\nå› æ­¤ï¼ŒFlink SQL æ”¯æŒé¢å¤–çš„ï¼ˆéæ ‡å‡† SQLï¼‰WITHIN å­å¥æ¥å®šä¹‰æ¨¡å¼çš„æ—¶é—´çº¦æŸã€‚è¯¥å­å¥å¯ä»¥å®šä¹‰åœ¨ PATTERN å­å¥ä¹‹åï¼Œå¹¶ä»¥æ¯«ç§’ä¸ºé—´éš”è¿›è¡Œè§£æã€‚\nå¦‚æœä¸€ä¸ªæ½œåœ¨åŒ¹é…çš„ç¬¬ä¸€ä¸ªäº‹ä»¶å’Œæœ€åä¸€ä¸ªäº‹ä»¶ä¹‹é—´çš„æ—¶é—´é•¿äºç»™å®šçš„å€¼ï¼Œè¿™æ ·çš„åŒ¹é…å°†ä¸ä¼šè¢«è¿½åŠ åˆ°ç»“æœè¡¨ä¸­ã€‚\næ³¨æ„ ä¸€èˆ¬é¼“åŠ±ä½¿ç”¨ within å­å¥ï¼Œå› ä¸ºå®ƒæœ‰åŠ©äº Flink è¿›è¡Œæœ‰æ•ˆçš„å†…å­˜ç®¡ç†ã€‚ä¸€æ—¦è¾¾åˆ°é˜ˆå€¼ï¼Œåº•å±‚çŠ¶æ€å¯ä»¥è¢«ä¿®å‰ªã€‚\næ³¨æ„ ç„¶è€Œï¼ŒWITHIN å­å¥ä¸æ˜¯ SQL æ ‡å‡†çš„ä¸€éƒ¨åˆ†ã€‚æ¨èçš„å¤„ç†æ—¶é—´é™åˆ¶çš„æ–¹å¼å¯èƒ½ä¼šåœ¨æœªæ¥å‘ç”Ÿå˜åŒ–ã€‚\nåœ¨ä¸‹é¢çš„æŸ¥è¯¢ç¤ºä¾‹ä¸­è¯´æ˜äº† WITHIN å­å¥çš„ä½¿ç”¨ã€‚\nSELECT*FROMTickerMATCH_RECOGNIZE(PARTITIONBYsymbolORDERBYrowtimeMEASURESC.rowtimeASdropTime,A.price-C.priceASdropDiffONEROWPERMATCHAFTERMATCHSKIPPASTLASTROWPATTERN(AB*C)WITHININTERVAL\u0026#39;1\u0026#39;HOURDEFINEBASB.price\u0026gt;A.price-10CASC.price\u0026lt;A.price-10)æŸ¥è¯¢æ£€æµ‹åˆ°åœ¨ 1 å°æ—¶çš„æ—¶é—´é—´éš”å†…å‘ç”Ÿçš„ä»·æ ¼ä¸‹è·Œ 10ã€‚\nå‡è®¾è¯¥æŸ¥è¯¢ç”¨äºåˆ†æä»¥ä¸‹è¡Œæƒ…æ•°æ®ã€‚\nsymbol rowtime price tax ====== ==================== ======= ======= 'ACME' '01-Apr-11 10:00:00' 20 1 'ACME' '01-Apr-11 10:20:00' 17 2 'ACME' '01-Apr-11 10:40:00' 18 1 'ACME' '01-Apr-11 11:00:00' 11 3 'ACME' '01-Apr-11 11:20:00' 14 2 'ACME' '01-Apr-11 11:40:00' 9 1 'ACME' '01-Apr-11 12:00:00' 15 1 'ACME' '01-Apr-11 12:20:00' 14 2 'ACME' '01-Apr-11 12:40:00' 24 2 'ACME' '01-Apr-11 13:00:00' 1 2 'ACME' '01-Apr-11 13:20:00' 19 1 æŸ¥è¯¢å°†äº§ç”Ÿä»¥ä¸‹ç»“æœã€‚\nsymbol dropTime dropDiff ====== ==================== ============= 'ACME' '01-Apr-11 13:00:00' 14 ç»“æœè¡Œè¡¨ç¤ºä»·æ ¼ä» 15ï¼ˆåœ¨ 4 æœˆ 1 æ—¥ 12:00:00ï¼‰ä¸‹é™åˆ° 1ï¼ˆåœ¨ 4 æœˆ 1 æ—¥ 13:00:00ï¼‰ã€‚dropDiff åˆ—åŒ…å«äº†ä»·æ ¼å·®ã€‚\nè¯·æ³¨æ„ï¼Œå³ä½¿ä»·æ ¼ä¹Ÿä»¥æ›´é«˜çš„æ•°å€¼ä¸‹é™ï¼Œä¾‹å¦‚ï¼Œä¸‹é™ 11ï¼ˆåœ¨ 01-Apr-11 10:00:00 å’Œ 01-Apr-11 11:40:00 ä¹‹é—´ï¼‰ï¼Œè¿™ä¸¤ä¸ªäº‹ä»¶ä¹‹é—´çš„æ—¶é—´å·®å¤§äº 1 å°æ—¶ã€‚å› æ­¤ï¼Œå®ƒä»¬ä¸ä¼šäº§ç”ŸåŒ¹é…ã€‚\nè¾“å‡ºæ¨¡å¼ è¾“å‡ºæ¨¡å¼æè¿°äº†æ¯æ‰¾åˆ°ä¸€ä¸ªåŒ¹é…çš„è®°å½•åº”è¯¥å‘å‡ºå¤šå°‘è¡Œã€‚SQL æ ‡å‡†æè¿°äº†ä¸¤ç§æ¨¡å¼ã€‚\nALL ROWS PER MATCH ONE ROW PER MATCH. ç›®å‰ï¼Œå”¯ä¸€æ”¯æŒçš„è¾“å‡ºæ¨¡å¼æ˜¯ ONE ROW PER MATCHï¼Œå¯¹äºæ¯ä¸€ä¸ªæ‰¾åˆ°çš„åŒ¹é…é¡¹ï¼Œæ€»ä¼šäº§ç”Ÿä¸€ä¸ªè¾“å‡ºæ±‡æ€»è¡Œã€‚\nè¾“å‡ºè¡Œçš„æ¨¡å¼å°†æ˜¯[åˆ†åŒºåˆ—]+[æªæ–½åˆ—]æŒ‰è¯¥ç‰¹å®šé¡ºåºçš„è¿æ¥ã€‚\nä¸‹é¢çš„ä¾‹å­æ˜¾ç¤ºäº†ä¸€ä¸ªå®šä¹‰ä¸ºæŸ¥è¯¢çš„è¾“å‡ºã€‚\nSELECT*FROMTickerMATCH_RECOGNIZE(PARTITIONBYsymbolORDERBYrowtimeMEASURESFIRST(A.price)ASstartPrice,LAST(A.price)AStopPrice,B.priceASlastPriceONEROWPERMATCHPATTERN(A+B)DEFINEAASLAST(A.price,1)ISNULLORA.price\u0026gt;LAST(A.price,1),BASB.price\u0026lt;LAST(A.price))å¯¹äºä»¥ä¸‹è¾“å…¥è¡Œï¼š\n symbol tax price rowtime ======== ===== ======== ===================== XYZ 1 10 2018-09-17 10:00:02 XYZ 2 12 2018-09-17 10:00:03 XYZ 1 13 2018-09-17 10:00:04 XYZ 2 11 2018-09-17 10:00:05 æŸ¥è¯¢å°†äº§ç”Ÿä»¥ä¸‹è¾“å‡ºã€‚\n symbol startPrice topPrice lastPrice ======== ============ ========== =========== XYZ 10 13 11 æ¨¡å¼è¯†åˆ«æ˜¯æŒ‰ç¬¦å·åˆ—è¿›è¡Œåˆ†åŒºçš„ã€‚å°½ç®¡åœ¨ MEASURES å­å¥ä¸­æ²¡æœ‰æ˜ç¡®æåˆ°ï¼Œä½†åœ¨ç»“æœçš„å¼€å¤´ä¼šæ·»åŠ åˆ†åŒºåˆ—ã€‚\næ¨¡å¼å¯¼èˆª DEFINE å’Œ MEASURES å­å¥å…è®¸åœ¨ï¼ˆå¯èƒ½ï¼‰åŒ¹é…æ¨¡å¼çš„è¡Œåˆ—è¡¨ä¸­è¿›è¡Œå¯¼èˆªã€‚\næœ¬èŠ‚å°†è®¨è®ºè¿™ç§ç”¨äºå£°æ˜æ¡ä»¶æˆ–äº§ç”Ÿè¾“å‡ºç»“æœçš„å¯¼èˆªã€‚\næ¨¡å¼å˜é‡å¼•ç”¨ æ¨¡å¼å˜é‡å¼•ç”¨å…è®¸å¼•ç”¨æ˜ å°„åˆ° DEFINE æˆ– MEASURES å­å¥ä¸­ç‰¹å®šæ¨¡å¼å˜é‡çš„ä¸€ç»„è¡Œã€‚\nä¾‹å¦‚ï¼Œè¡¨è¾¾å¼ A.price æè¿°äº†è¿„ä»Šä¸ºæ­¢æ˜ å°„åˆ° A çš„ä¸€ç»„è¡Œï¼Œå†åŠ ä¸Šå½“å‰è¡Œï¼Œå¦‚æœæˆ‘ä»¬å°è¯•å°†å½“å‰è¡Œä¸ A è¿›è¡ŒåŒ¹é…ã€‚å¦‚æœ DEFINE/MEASURES å­å¥ä¸­çš„è¡¨è¾¾å¼éœ€è¦å•è¡Œï¼ˆä¾‹å¦‚ A.price æˆ– A.price\u0026gt;10ï¼‰ï¼Œåˆ™é€‰æ‹©å±äºç›¸åº”é›†åˆçš„æœ€åä¸€ä¸ªå€¼ã€‚\nå¦‚æœæ²¡æœ‰æŒ‡å®šæ¨¡å¼å˜é‡ï¼ˆä¾‹å¦‚ SUM(price)ï¼‰ï¼Œè¡¨è¾¾å¼ä¼šå¼•ç”¨é»˜è®¤çš„æ¨¡å¼å˜é‡*ï¼Œå®ƒå¼•ç”¨æ¨¡å¼ä¸­çš„æ‰€æœ‰å˜é‡ã€‚æ¢å¥è¯è¯´ï¼Œå®ƒåˆ›å»ºäº†ä¸€ä¸ªè¿„ä»Šä¸ºæ­¢æ˜ å°„åˆ°ä»»ä½•å˜é‡çš„æ‰€æœ‰è¡ŒåŠ ä¸Šå½“å‰è¡Œçš„åˆ—è¡¨ã€‚\nä¾‹å­\nè¦æƒ³äº†è§£æ›´é€å½»çš„ä¾‹å­ï¼Œå¯ä»¥çœ‹çœ‹ä¸‹é¢çš„æ¨¡å¼å’Œç›¸åº”çš„æ¡ä»¶ã€‚\nPATTERN (A B+) DEFINE A AS A.price \u0026gt; 10, B AS B.price \u0026gt; A.price AND SUM(price) \u0026lt; 100 AND SUM(B.price) \u0026lt; 80 ä¸‹è¡¨æè¿°äº†å¦‚ä½•è¯„ä¼°æ¯ä¸ªä¼ å…¥äº‹ä»¶çš„è¿™äº›æ¡ä»¶ã€‚\nè¯¥è¡¨ç”±ä»¥ä¸‹å‡ æ ç»„æˆï¼š\n# - the row identifier that uniquely identifies an incoming row in the lists [A.price]/[B.price]/[price]. price - the price of the incoming row. [A.price]/[B.price]/[price] - describe lists of rows which are used in the DEFINE clause to evaluate conditions. Classifier - the classifier of the current row which indicates the pattern variable the row is mapped to. A.price/B.price/SUM(price)/SUM(B.price) - describes the result after those expressions have been evaluated. #\tprice\tClassifier\t[A.price]\t[B.price]\t[price]\tA.price\tB.price\tSUM(price)\tSUM(B.price) #1\t10\t-\u0026gt; A\t#1\t-\t-\t10\t-\t-\t- #2\t15\t-\u0026gt; B\t#1\t#2\t#1, #2\t10\t15\t25\t15 #3\t20\t-\u0026gt; B\t#1\t#2, #3\t#1, #2, #3\t10\t20\t45\t35 #4\t31\t-\u0026gt; B\t#1\t#2, #3, #4\t#1, #2, #3, #4\t10\t31\t76\t66 #5\t35\t#1\t#2, #3, #4, #5\t#1, #2, #3, #4, #5\t10\t35\t111\t101 ä»è¡¨ä¸­å¯ä»¥çœ‹å‡ºï¼Œç¬¬ä¸€è¡Œè¢«æ˜ å°„åˆ°æ¨¡å¼å˜é‡ Aï¼Œéšåçš„è¡Œè¢«æ˜ å°„åˆ°æ¨¡å¼å˜é‡ Bï¼Œä½†æ˜¯æœ€åä¸€è¡Œä¸æ»¡è¶³ B çš„æ¡ä»¶ï¼Œå› ä¸ºæ‰€æœ‰æ˜ å°„è¡Œçš„ SUM(ä»·æ ¼)å’Œ B ä¸­æ‰€æœ‰è¡Œçš„æ€»å’Œè¶…è¿‡äº†æŒ‡å®šçš„é˜ˆå€¼ã€‚\né€»è¾‘åç§» é€»è¾‘åç§»å¯ä»¥åœ¨æ˜ å°„åˆ°ç‰¹å®šæ¨¡å¼å˜é‡çš„äº‹ä»¶ä¸­è¿›è¡Œå¯¼èˆªã€‚è¿™å¯ä»¥ç”¨ä¸¤ä¸ªç›¸åº”çš„å‡½æ•°æ¥è¡¨ç¤ºã€‚\nåç§»å‡½æ•° æè¿° LAST(variable.field, n) è¿”å›äº‹ä»¶ä¸­è¢«æ˜ å°„åˆ°å˜é‡ç¬¬ n ä¸ªæœ€åå…ƒç´ çš„å­—æ®µçš„å€¼ã€‚ä»æ˜ å°„åˆ°çš„æœ€åä¸€ä¸ªå…ƒç´ å¼€å§‹è®¡ç®—ã€‚\nFIRST(variable.field, n) è¿”å›äº‹ä»¶ä¸­è¢«æ˜ å°„åˆ°å˜é‡ç¬¬ n ä¸ªå…ƒç´ çš„å­—æ®µå€¼ã€‚ä»æ˜ å°„åˆ°çš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹è®¡ç®—ã€‚\nç¤ºä¾‹\nä¸ºäº†æ›´é€å½»çš„ä¸¾ä¾‹ï¼Œå¯ä»¥çœ‹çœ‹ä¸‹é¢çš„æ¨¡å¼å’Œç›¸åº”çš„æ¡ä»¶ã€‚\nPATTERN (A B+) DEFINE A AS A.price \u0026gt; 10, B AS (LAST(B.price, 1) IS NULL OR B.price \u0026gt; LAST(B.price, 1)) AND (LAST(B.price, 2) IS NULL OR B.price \u0026gt; 2 * LAST(B.price, 2)) ä¸‹è¡¨æè¿°äº†å¦‚ä½•è¯„ä¼°æ¯ä¸ªä¼ å…¥äº‹ä»¶çš„è¿™äº›æ¡ä»¶ã€‚\nè¯¥è¡¨ç”±ä»¥ä¸‹å‡ æ ç»„æˆï¼š\nprice - the price of the incoming row. Classifier - the classifier of the current row which indicates the pattern variable the row is mapped to. LAST(B.price, 1)/LAST(B.price, 2) - describes the result after those expressions have been evaluated. price\tClassifier\tLAST(B.price, 1)\tLAST(B.price, 2)\tComment 10\t-\u0026gt; A\t15\t-\u0026gt; B\tnull\tnull\tNotice that LAST(A.price, 1) is null because there is still nothing mapped to B. 20\t-\u0026gt; B\t15\tnull\t31\t-\u0026gt; B\t20\t15\t35\t31\t20\tNot mapped because 35 \u0026lt; 2 * 20. ä½¿ç”¨é»˜è®¤çš„æ¨¡å¼å˜é‡ä¸é€»è¾‘åç§»é‡ä¹Ÿå¯èƒ½æ˜¯æœ‰æ„ä¹‰çš„ã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåç§»é‡ä¼šè€ƒè™‘åˆ°ç›®å‰ä¸ºæ­¢æ˜ å°„çš„æ‰€æœ‰è¡Œã€‚\nPATTERN (A B? C) DEFINE B AS B.price \u0026lt; 20, C AS LAST(price, 1) \u0026lt; C.price price\tClassifier\tLAST(price, 1)\tComment 10\t-\u0026gt; A\t15\t-\u0026gt; B\t20\t-\u0026gt; C\t15\tLAST(price, 1) is evaluated as the price of the row mapped to the B variable. å¦‚æœç¬¬äºŒè¡Œæ²¡æœ‰æ˜ å°„åˆ° B å˜é‡ï¼Œæˆ‘ä»¬ä¼šæœ‰ä»¥ä¸‹ç»“æœã€‚\nprice\tClassifier\tLAST(price, 1)\tComment 10\t-\u0026gt; A\t20\t-\u0026gt; C\t10\tLAST(price, 1) is evaluated as the price of the row mapped to the A variable. ä¹Ÿå¯ä»¥åœ¨ first/last å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸­ä½¿ç”¨å¤šä¸ªæ¨¡å¼å˜é‡å¼•ç”¨ã€‚è¿™æ ·ï¼Œå°±å¯ä»¥å†™ä¸€ä¸ªè®¿é—®å¤šåˆ—çš„è¡¨è¾¾å¼ã€‚ä½†æ˜¯ï¼Œæ‰€æœ‰è¿™äº›è¡¨è¾¾å¼å¿…é¡»ä½¿ç”¨åŒä¸€ä¸ªæ¨¡å¼å˜é‡ã€‚æ¢å¥è¯è¯´ï¼ŒLAST/FIRST å‡½æ•°çš„å€¼å¿…é¡»åœ¨å•è¡Œä¸­è®¡ç®—ã€‚\nå› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨ LAST(A.price * A.tax)ï¼Œä½†ä¸å…è®¸ä½¿ç”¨ LAST(A.price * B.tax)è¿™æ ·çš„è¡¨è¾¾å¼ã€‚\nåŒ¹é…åç­–ç•¥ AFTER MATCH SKIP å­å¥æŒ‡å®šäº†åœ¨æ‰¾åˆ°å®Œæ•´åŒ¹é…åï¼Œåœ¨å“ªé‡Œå¼€å§‹ä¸€ä¸ªæ–°çš„åŒ¹é…è¿‡ç¨‹ã€‚\næœ‰å››ç§ä¸åŒçš„ç­–ç•¥ã€‚\nSKIP PAST LAST ROW - åœ¨å½“å‰åŒ¹é…çš„æœ€åä¸€è¡Œä¹‹åçš„ä¸‹ä¸€è¡Œæ¢å¤æ¨¡å¼åŒ¹é…ã€‚ SKIP TO NEXT ROW - ä»åŒ¹é…èµ·å§‹è¡Œåçš„ä¸‹ä¸€è¡Œå¼€å§‹ç»§ç»­æœç´¢æ–°çš„åŒ¹é…ã€‚ SKIP TO LAST å˜é‡\u0026ndash;åœ¨æ˜ å°„åˆ°æŒ‡å®šæ¨¡å¼å˜é‡çš„æœ€åä¸€è¡Œæ¢å¤æ¨¡å¼åŒ¹é…ã€‚ SKIP TO FIRST å˜é‡\u0026ndash;åœ¨è¢«æ˜ å°„åˆ°æŒ‡å®šæ¨¡å¼å˜é‡çš„ç¬¬ä¸€è¡Œæ¢å¤æ¨¡å¼åŒ¹é…ã€‚ è¿™ä¹Ÿæ˜¯ä¸€ç§æŒ‡å®šä¸€ä¸ªäº‹ä»¶å¯ä»¥å±äºå¤šå°‘ä¸ªåŒ¹é…çš„æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ SKIP PAST LAST ROW ç­–ç•¥ï¼Œæ¯ä¸ªäº‹ä»¶æœ€å¤šåªèƒ½å±äºä¸€ä¸ªåŒ¹é…ã€‚\nä¾‹å­\nä¸ºäº†æ›´å¥½åœ°ç†è§£è¿™äº›ç­–ç•¥ä¹‹é—´çš„å·®å¼‚ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ä¸‹é¢çš„ä¾‹å­ã€‚\nå¯¹äºä»¥ä¸‹è¾“å…¥è¡Œã€‚\n symbol tax price rowtime ======== ===== ======= ===================== XYZ 1 7 2018-09-17 10:00:01 XYZ 2 9 2018-09-17 10:00:02 XYZ 1 10 2018-09-17 10:00:03 XYZ 2 5 2018-09-17 10:00:04 XYZ 2 17 2018-09-17 10:00:05 XYZ 2 14 2018-09-17 10:00:06 æˆ‘ä»¬ç”¨ä¸åŒçš„ç­–ç•¥è¯„ä¼°ä»¥ä¸‹æŸ¥è¯¢ã€‚\nSELECT*FROMTickerMATCH_RECOGNIZE(PARTITIONBYsymbolORDERBYrowtimeMEASURESSUM(A.price)ASsumPrice,FIRST(rowtime)ASstartTime,LAST(rowtime)ASendTimeONEROWPERMATCH[AFTERMATCHSTRATEGY]PATTERN(A+C)DEFINEAASSUM(A.price)\u0026lt;30)æŸ¥è¯¢è¿”å›æ˜ å°„åˆ° A çš„æ‰€æœ‰è¡Œçš„ä»·æ ¼æ€»å’Œï¼Œä»¥åŠæ•´ä½“åŒ¹é…çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªæ—¶é—´æˆ³ã€‚\næ ¹æ®ä½¿ç”¨çš„ AFTER MATCH ç­–ç•¥ï¼ŒæŸ¥è¯¢ä¼šäº§ç”Ÿä¸åŒçš„ç»“æœã€‚\nAFTER MATCH SKIP PAST ROW(è·³è¿‡æœ€åä¸€è¡Œ)\n symbol sumPrice startTime endTime ======== ========== ===================== ===================== XYZ 26 2018-09-17 10:00:01 2018-09-17 10:00:04 XYZ 17 2018-09-17 10:00:05 2018-09-17 10:00:06 ç¬¬ä¸€ä¸ªç»“æœä¸ 1 å·ï¼Œ2 å·ï¼Œ3 å·ï¼Œ4 å·è¡Œç›¸åŒ¹é…ã€‚\nç¬¬äºŒä¸ªç»“æœä¸#5, #6 è¡Œç›¸åŒ¹é…ã€‚\nåŒ¹é…åè·³è½¬åˆ°ä¸‹ä¸€è¡Œã€‚\n symbol sumPrice startTime endTime ======== ========== ===================== ===================== XYZ 26 2018-09-17 10:00:01 2018-09-17 10:00:04 XYZ 24 2018-09-17 10:00:02 2018-09-17 10:00:05 XYZ 15 2018-09-17 10:00:03 2018-09-17 10:00:05 XYZ 22 2018-09-17 10:00:04 2018-09-17 10:00:06 XYZ 17 2018-09-17 10:00:05 2018-09-17 10:00:06 åŒæ ·ï¼Œç¬¬ä¸€ä¸ªç»“æœå¯¹ 1 å·ã€2 å·ã€3 å·ã€4 å·è¡Œè¿›è¡ŒåŒ¹é…ã€‚\nä¸ä¹‹å‰çš„ç­–ç•¥ç›¸æ¯”ï¼Œæ¥ä¸‹æ¥çš„åŒ¹é…ä¸­åˆåŒ…å«äº† 2 å·è¡Œçš„åŒ¹é…ã€‚å› æ­¤ï¼Œç¬¬äºŒä¸ªç»“æœä¸è¡Œ#2ï¼Œ#3ï¼Œ#4ï¼Œ#5 ç›¸åŒ¹é…ã€‚\nç¬¬ä¸‰ä¸ªç»“æœä¸ 3 å·ï¼Œ4 å·ï¼Œ5 å·è¡Œç›¸åŒ¹é…ã€‚\nç¬¬å››ä¸ªç»“æœä¸è¡Œ#4ï¼Œ#5ï¼Œ#6 ç›¸åŒ¹é…ã€‚\næœ€åä¸€ä¸ªç»“æœä¸è¡Œ#5ï¼Œ#6 åŒ¹é…ã€‚\nåŒ¹é…åè·³è½¬åˆ°æœ€åä¸€è¡Œã€‚\n symbol sumPrice startTime endTime ======== ========== ===================== ===================== XYZ 26 2018-09-17 10:00:01 2018-09-17 10:00:04 XYZ 15 2018-09-17 10:00:03 2018-09-17 10:00:05 XYZ 22 2018-09-17 10:00:04 2018-09-17 10:00:06 XYZ 17 2018-09-17 10:00:05 2018-09-17 10:00:06 åŒæ ·ï¼Œç¬¬ä¸€ä¸ªç»“æœé’ˆå¯¹ 1 å·ã€2 å·ã€3 å·ã€4 å·è¡Œè¿›è¡ŒåŒ¹é…ã€‚\nä¸ä¹‹å‰çš„ç­–ç•¥ç›¸æ¯”ï¼Œæ¥ä¸‹æ¥çš„åŒ¹é…åªåŒ…æ‹¬ 3 å·è¡Œï¼ˆæ˜ å°„åˆ° A è¡Œï¼‰ï¼Œå†æ¬¡è¿›è¡ŒåŒ¹é…ã€‚å› æ­¤ï¼Œç¬¬äºŒä¸ªç»“æœä¸è¡Œ#3ï¼Œ#4ï¼Œ#5 ç›¸åŒ¹é…ã€‚\nç¬¬ä¸‰ä¸ªç»“æœä¸#4ï¼Œ#5ï¼Œ#6 è¡Œç›¸åŒ¹é…ã€‚\næœ€åä¸€ä¸ªç»“æœä¸è¡Œ#5,#6 åŒ¹é…ï¼Œå› æ­¤ç¬¬ä¸‰ä¸ªç»“æœä¸è¡Œ#4,#5,#6 åŒ¹é…ã€‚\nåŒ¹é…åè·³è½¬åˆ°ç¬¬ä¸€è¡Œ Aã€‚\nè¿™ä¸ªç»„åˆä¼šäº§ç”Ÿä¸€ä¸ªè¿è¡Œæ—¶å¼‚å¸¸ï¼Œå› ä¸ºæˆ‘ä»¬æ€»æ˜¯è¯•å›¾åœ¨ä¸Šä¸€ä¸ªæ¯”èµ›å¼€å§‹çš„åœ°æ–¹å¼€å§‹ä¸€ä¸ªæ–°çš„æ¯”èµ›ã€‚è¿™å°†äº§ç”Ÿä¸€ä¸ªæ— é™å¾ªç¯ï¼Œå› æ­¤æ˜¯è¢«ç¦æ­¢çš„ã€‚\næˆ‘ä»¬å¿…é¡»è®°ä½ï¼Œåœ¨ä½¿ç”¨ SKIP TO FIRST/LAST å˜é‡ç­–ç•¥çš„æƒ…å†µä¸‹ï¼Œæœ‰å¯èƒ½æ²¡æœ‰è®°å½•æ˜ å°„åˆ°è¯¥å˜é‡ä¸Šï¼ˆä¾‹å¦‚æ¨¡å¼ A*ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†æŠ›å‡ºä¸€ä¸ªè¿è¡Œæ—¶å¼‚å¸¸ï¼Œå› ä¸ºæ ‡å‡†è¦æ±‚æœ‰ä¸€æ¡æœ‰æ•ˆçš„è®°å½•æ¥ç»§ç»­åŒ¹é…ã€‚\næ—¶é—´å±æ€§ ä¸ºäº†åœ¨ MATCH_RECOGNIZE ä¹‹ä¸Šåº”ç”¨ä¸€äº›åç»­çš„æŸ¥è¯¢ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨æ—¶é—´å±æ€§ã€‚ä¸ºäº†é€‰æ‹©è¿™äº›å±æ€§ï¼Œæœ‰ä¸¤ä¸ªå‡½æ•°å¯ç”¨ã€‚\nåŠŸèƒ½æè¿° MATCH_ROWTIME() è¿”å›è¢«æ˜ å°„åˆ°ç»™å®šæ¨¡å¼çš„æœ€åä¸€è¡Œçš„æ—¶é—´æˆ³ã€‚\næ‰€å¾—åˆ°çš„å±æ€§æ˜¯ä¸€ä¸ª rowtime å±æ€§ï¼Œå®ƒå¯ä»¥è¢«ç”¨äºåç»­çš„åŸºäºæ—¶é—´çš„æ“ä½œï¼Œå¦‚åŒºé—´è¿æ¥å’Œç»„çª—å£æˆ–çª—å£èšåˆã€‚\nMATCH_PROCTIME() è¿”å›ä¸€ä¸ª proctime å±æ€§ï¼Œè¯¥å±æ€§å¯ç”¨äºåç»­åŸºäºæ—¶é—´çš„æ“ä½œï¼Œå¦‚åŒºé—´è¿æ¥å’Œç»„çª—å£æˆ–çª—å£èšåˆã€‚\næ§åˆ¶å†…å­˜æ¶ˆè€— åœ¨ç¼–å†™ MATCH_RECOGNIZE æŸ¥è¯¢æ—¶ï¼Œå†…å­˜æ¶ˆè€—æ˜¯ä¸€ä¸ªé‡è¦çš„è€ƒè™‘å› ç´ ï¼Œå› ä¸ºæ½œåœ¨çš„åŒ¹é…ç©ºé—´æ˜¯ä»¥ç±»ä¼¼å¹¿åº¦ä¼˜å…ˆçš„æ–¹å¼å»ºç«‹çš„ã€‚è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œå¿…é¡»ç¡®ä¿æ¨¡å¼èƒ½å¤Ÿå®Œæˆã€‚æœ€å¥½æ˜¯æœ‰åˆç†æ•°é‡çš„è¡Œæ˜ å°„åˆ°åŒ¹é…ä¸­ï¼Œå› ä¸ºå®ƒä»¬å¿…é¡»é€‚åº”å†…å­˜ã€‚\nä¾‹å¦‚ï¼Œæ¨¡å¼ä¸èƒ½æœ‰ä¸€ä¸ªæ²¡æœ‰ä¸Šé™çš„é‡åŒ–å™¨ï¼Œæ¥å—æ¯ä¸€è¡Œã€‚è¿™æ ·çš„æ¨¡å¼å¯ä»¥æ˜¯è¿™æ ·çš„ã€‚\nPATTERN (A B+ C) DEFINE A as A.price \u0026gt; 10, C as C.price \u0026gt; 20 è¯¥æŸ¥è¯¢å°†æŠŠæ¯ä¸€æ¡è¿›å…¥çš„è®°å½•æ˜ å°„åˆ° B å˜é‡ä¸Šï¼Œå› æ­¤æ°¸è¿œä¸ä¼šç»“æŸã€‚è¿™ä¸ªæŸ¥è¯¢å¯ä»¥é€šè¿‡å¦å®š C çš„æ¡ä»¶æ¥è§£å†³ã€‚\nPATTERN (A B+ C) DEFINE A as A.price \u0026gt; 10, B as B.price \u0026lt;= 20, C as C.price \u0026gt; 20 æˆ–è€…é€šè¿‡ä½¿ç”¨å‹‰å¼ºçš„å®šé‡å™¨ã€‚\nPATTERN (A B+? C) DEFINE A as A.price \u0026gt; 10, C as C.price \u0026gt; 20 æ³¨æ„ è¯·æ³¨æ„ï¼ŒMATCH_RECOGNIZE å­å¥ä¸ä½¿ç”¨é…ç½®çš„çŠ¶æ€ä¿ç•™æ—¶é—´ã€‚äººä»¬å¯èƒ½å¸Œæœ›ä½¿ç”¨ WITHIN å­å¥æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚\nå·²çŸ¥é™åˆ¶ Flink å¯¹ MATCH_RECOGNIZE å­å¥çš„å®ç°æ˜¯ä¸€é¡¹æŒç»­çš„åŠªåŠ›ï¼Œç›®å‰è¿˜ä¸æ”¯æŒ SQL æ ‡å‡†çš„ä¸€äº›åŠŸèƒ½ã€‚\nä¸æ”¯æŒçš„åŠŸèƒ½åŒ…æ‹¬\næ¨¡å¼è¡¨è¾¾å¼ã€‚ æ¨¡å¼ç»„\u0026ndash;è¿™æ„å‘³ç€ï¼Œä¾‹å¦‚é‡åŒ–ç¬¦ä¸èƒ½åº”ç”¨äºæ¨¡å¼çš„å­åºåˆ—ã€‚å› æ­¤ï¼Œï¼ˆA (B C)+ï¼‰ä¸æ˜¯æœ‰æ•ˆçš„æ¨¡å¼ã€‚ æ”¹å˜\u0026ndash;åƒ PATTERN((A B | C D) E)è¿™æ ·çš„æ¨¡å¼ï¼Œè¿™æ„å‘³ç€åœ¨å¯»æ‰¾ E è¡Œä¹‹å‰å¿…é¡»å…ˆæ‰¾åˆ°ä¸€ä¸ªå­åºåˆ— A B æˆ– C Dã€‚ PERMUTE è¿ç®—ç¬¦\u0026ndash;ç›¸å½“äºå®ƒæ‰€åº”ç”¨çš„æ‰€æœ‰å˜é‡çš„æ’åˆ—ç»„åˆï¼Œä¾‹å¦‚ PATTERN(PERMUTE (A, B, C))=PATTERN(A B C | A C B | B A C | B A C | C B A | C B A)ã€‚ é”š - ^, $ï¼Œè¡¨ç¤ºä¸€ä¸ªåˆ†åŒºçš„å¼€å§‹/ç»“æŸï¼Œè¿™äº›åœ¨æµåª’ä½“ç¯å¢ƒä¸­æ²¡æœ‰æ„ä¹‰ï¼Œå°†ä¸è¢«æ”¯æŒã€‚ æ’é™¤ - PATTERN ({- A -} B) æ„å‘³ç€ A å°†è¢«æŸ¥æ‰¾ï¼Œä½†ä¸ä¼šå‚ä¸è¾“å‡ºã€‚è¿™åªå¯¹ ALL ROWS PER MATCH æ¨¡å¼æœ‰æ•ˆã€‚ ä¸æƒ…æ„¿çš„å¯é€‰é‡åŒ–ç¬¦\u0026ndash;PATTERN A?? åªæ”¯æŒè´ªå©ªçš„å¯é€‰é‡åŒ–ç¬¦ã€‚ ALL ROWS PER MATCH è¾“å‡ºæ¨¡å¼\u0026ndash;å®ƒä¸ºæ¯ä¸€æ¡å‚ä¸åˆ›å»ºå‘ç°åŒ¹é…çš„è®°å½•äº§ç”Ÿä¸€æ¡è¾“å‡ºè¡Œã€‚è¿™ä¹Ÿæ„å‘³ç€ã€‚ MEASURES å­å¥å”¯ä¸€æ”¯æŒçš„è¯­ä¹‰æ˜¯ FINALã€‚ CLASSIFIER å‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›æŸè¡Œè¢«æ˜ å°„åˆ°çš„æ¨¡å¼å˜é‡ï¼Œç›®å‰è¿˜ä¸æ”¯æŒã€‚ SUBSET - å…è®¸åˆ›å»ºæ¨¡å¼å˜é‡çš„é€»è¾‘ç»„ï¼Œå¹¶åœ¨ DEFINE å’Œ MEASURES å­å¥ä¸­ä½¿ç”¨è¿™äº›ç»„ã€‚ ç‰©ç†åç§»\u0026ndash;PREV/NEXTï¼Œå®ƒç´¢å¼•æ‰€æœ‰çœ‹åˆ°çš„äº‹ä»¶ï¼Œè€Œä¸æ˜¯åªç´¢å¼•é‚£äº›è¢«æ˜ å°„åˆ°æ¨¡å¼å˜é‡çš„äº‹ä»¶ï¼ˆå¦‚é€»è¾‘åç§»æƒ…å†µï¼‰ã€‚ æå–æ—¶é—´å±æ€§\u0026ndash;ç›®å‰æ²¡æœ‰å¯èƒ½ä¸ºåç»­åŸºäºæ—¶é—´çš„æ“ä½œè·å–æ—¶é—´å±æ€§ã€‚ MATCH_RECOGNIZE åªæ”¯æŒ SQLã€‚åœ¨ Table API ä¸­æ²¡æœ‰ç­‰ä»·ç‰©ã€‚ èšåˆã€‚ ä¸æ”¯æŒä¸åŒçš„èšåˆã€‚\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/streaming/match_recognize.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-detecting-patterns-in-tables/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL"],"title":"æ£€æµ‹è¡¨ä¸­çš„æ¨¡å¼"},{"categories":["Flink"],"contents":"æ¦‚å¿µå’Œé€šç”¨ API Table API å’Œ SQL è¢«é›†æˆåœ¨ä¸€ä¸ªè”åˆ API ä¸­ã€‚è¿™ä¸ª API çš„æ ¸å¿ƒæ¦‚å¿µæ˜¯ä¸€ä¸ª Tableï¼Œä½œä¸ºæŸ¥è¯¢çš„è¾“å…¥å’Œè¾“å‡ºã€‚æœ¬æ–‡æ¡£ä»‹ç»äº†å…·æœ‰ Table API å’Œ SQL æŸ¥è¯¢çš„ç¨‹åºçš„å¸¸ç”¨ç»“æ„ï¼Œå¦‚ä½•æ³¨å†Œ Tableï¼Œå¦‚ä½•æŸ¥è¯¢ Tableï¼Œå¦‚ä½•å‘å‡º Tableã€‚\nä¸¤ç§ Planners çš„ä¸»è¦åŒºåˆ«  Blink å°†æ‰¹å¤„ç†ä½œä¸šè§†ä¸ºæµå¼ä½œä¸šçš„ä¸€ç§ç‰¹æ®Šæƒ…å†µã€‚å› æ­¤ï¼Œä¹Ÿä¸æ”¯æŒ Table å’Œ DataSet ä¹‹é—´çš„è½¬æ¢ï¼Œæ‰¹å¤„ç†ä½œä¸šä¸ä¼šè¢«ç¿»è¯‘æˆ DateSet ç¨‹åºï¼Œè€Œæ˜¯ç¿»è¯‘æˆ DataStream ç¨‹åºï¼Œå’Œæµä½œä¸šä¸€æ ·ã€‚ Blink è®¡åˆ’å™¨ä¸æ”¯æŒ BatchTableSourceï¼Œè¯·ä½¿ç”¨æœ‰ç•Œçš„ StreamTableSource ä»£æ›¿ã€‚ æ—§è®¡åˆ’å™¨å’Œ Blink è®¡åˆ’å™¨çš„ FilterableTableSource çš„å®ç°æ˜¯ä¸å…¼å®¹çš„ã€‚æ—§çš„è§„åˆ’è€…ä¼šå°† PlannerExpressions æ¨é€åˆ° FilterableTableSource ä¸­ï¼Œè€Œ Blink è§„åˆ’è€…ä¼šå°† Expressions æ¨é€ä¸‹å»ã€‚ åŸºäºå­—ç¬¦ä¸²çš„é”®å€¼é…ç½®é€‰é¡¹(è¯¦æƒ…è¯·çœ‹é…ç½®æ–‡æ¡£)åªç”¨äº Blink è§„åˆ’å™¨ã€‚ PlannerConfig åœ¨ä¸¤ä¸ªè§„åˆ’å™¨ä¸­çš„å®ç°(CalciteConfig)æ˜¯ä¸åŒçš„ã€‚ Blink è§„åˆ’å¸ˆå°†åœ¨ TableEnvironment å’Œ StreamTableEnvironment ä¸ŠæŠŠå¤šä¸ªæ±‡ä¼˜åŒ–æˆä¸€ä¸ª DAGã€‚æ—§çš„è§„åˆ’å™¨æ€»æ˜¯ä¼šå°†æ¯ä¸ªæ±‡ä¼˜åŒ–æˆä¸€ä¸ªæ–°çš„ DAGï¼Œå…¶ä¸­æ‰€æœ‰çš„ DAG æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚ ç°åœ¨è€çš„è®¡åˆ’å™¨ä¸æ”¯æŒç›®å½•ç»Ÿè®¡ï¼Œè€Œ Blink è®¡åˆ’å™¨æ”¯æŒã€‚  Table API å’Œ SQL ç¨‹åºçš„ç»“æ„ æ‰€æœ‰ç”¨äºæ‰¹å¤„ç†å’Œæµå¤„ç†çš„ Table API å’Œ SQL ç¨‹åºéƒ½éµå¾ªç›¸åŒçš„æ¨¡å¼ã€‚ä¸‹é¢çš„ä»£ç ç¤ºä¾‹æ˜¾ç¤ºäº† Table API å’Œ SQL ç¨‹åºçš„å…±åŒç»“æ„ã€‚\n// create a TableEnvironment for specific planner batch or streaming val tableEnv = ... // see \u0026#34;Create a TableEnvironment\u0026#34; section  // create a Table tableEnv.connect(...).createTemporaryTable(\u0026#34;table1\u0026#34;) // register an output Table tableEnv.connect(...).createTemporaryTable(\u0026#34;outputTable\u0026#34;) // create a Table from a Table API query val tapiResult = tableEnv.from(\u0026#34;table1\u0026#34;).select(...) // create a Table from a SQL query val sqlResult = tableEnv.sqlQuery(\u0026#34;SELECT ... FROM table1 ...\u0026#34;) // emit a Table API result Table to a TableSink, same for SQL result val tableResult = tapiResult.executeInsert(\u0026#34;outputTable\u0026#34;) tableResult... æ³¨æ„ï¼šè¡¨ API å’Œ SQL æŸ¥è¯¢å¯ä»¥å¾ˆå®¹æ˜“åœ°ä¸ DataStream æˆ– DataSet ç¨‹åºé›†æˆå¹¶åµŒå…¥å…¶ä¸­ã€‚è¯·æŸ¥çœ‹ä¸ DataStream å’Œ DataSet API çš„é›†æˆéƒ¨åˆ†ï¼Œäº†è§£å¦‚ä½•å°† DataStream å’Œ DataSets è½¬æ¢ä¸ºè¡¨ï¼Œåä¹‹äº¦ç„¶ã€‚\nåˆ›å»ºä¸€ä¸ª TableEnvironment TableEnvironment æ˜¯ Table API å’Œ SQL é›†æˆçš„æ ¸å¿ƒæ¦‚å¿µã€‚å®ƒè´Ÿè´£\n åœ¨å†…éƒ¨ç›®å½•(catalog)ä¸­æ³¨å†Œä¸€ä¸ª Table ç™»è®°ç›®å½•(catalog) åŠ è½½å¯æ’æ‹”æ¨¡å— æ‰§è¡Œ SQL æŸ¥è¯¢ æ³¨å†Œä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„ï¼ˆæ ‡é‡ã€è¡¨æˆ–èšåˆï¼‰å‡½æ•° å°† DataStream æˆ– DataSet è½¬æ¢ä¸º Table æŒæœ‰å¯¹ ExecutionEnvironment æˆ– StreamExecutionEnvironment çš„å¼•ç”¨ã€‚  ä¸€ä¸ª Table æ€»æ˜¯ç»‘å®šåœ¨ä¸€ä¸ªç‰¹å®šçš„ TableEnvironment ä¸Šã€‚åœ¨åŒä¸€ä¸ªæŸ¥è¯¢ä¸­ï¼Œä¸å¯èƒ½å°†ä¸åŒ TableEnvironments çš„è¡¨ç»„åˆèµ·æ¥ï¼Œä¾‹å¦‚ï¼Œå°†å®ƒä»¬è¿æ¥æˆ–è”åˆèµ·æ¥ã€‚\né€šè¿‡è°ƒç”¨é™æ€çš„ BatchTableEnvironment.create() æˆ– StreamTableEnvironment.create() æ–¹æ³•åˆ›å»ºä¸€ä¸ª TableEnvironmentï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ª StreamExecutionEnvironment æˆ– ExecutionEnvironment å’Œä¸€ä¸ªå¯é€‰çš„ TableConfigã€‚TableConfig å¯ä»¥ç”¨æ¥é…ç½® TableEnvironment æˆ–è‡ªå®šä¹‰æŸ¥è¯¢ä¼˜åŒ–å’Œç¿»è¯‘è¿‡ç¨‹ï¼ˆå‚è§ Query Optimizationï¼‰ã€‚\nç¡®ä¿é€‰æ‹©ä¸ä½ çš„ç¼–ç¨‹è¯­è¨€ç›¸åŒ¹é…çš„ç‰¹å®šè§„åˆ’å™¨ BatchTableEnvironment/StreamTableEnvironmentã€‚\nå¦‚æœè¿™ä¸¤ä¸ªè§„åˆ’å™¨ jar éƒ½åœ¨ classpath ä¸Šï¼ˆé»˜è®¤è¡Œä¸ºï¼‰ï¼Œä½ åº”è¯¥æ˜ç¡®è®¾ç½®åœ¨å½“å‰ç¨‹åºä¸­ä½¿ç”¨å“ªä¸ªè§„åˆ’å™¨ã€‚\n// ********************** // FLINK STREAMING QUERY // ********************** import org.apache.flink.streaming.api.scala.StreamExecutionEnvironment import org.apache.flink.table.api.EnvironmentSettings import org.apache.flink.table.api.bridge.scala.StreamTableEnvironment val fsSettings = EnvironmentSettings.newInstance().useOldPlanner().inStreamingMode().build() val fsEnv = StreamExecutionEnvironment.getExecutionEnvironment val fsTableEnv = StreamTableEnvironment.create(fsEnv, fsSettings) // or val fsTableEnv = TableEnvironment.create(fsSettings)  // ****************** // FLINK BATCH QUERY // ****************** import org.apache.flink.api.scala.ExecutionEnvironment import org.apache.flink.table.api.bridge.scala.BatchTableEnvironment val fbEnv = ExecutionEnvironment.getExecutionEnvironment val fbTableEnv = BatchTableEnvironment.create(fbEnv) // ********************** // BLINK STREAMING QUERY // ********************** import org.apache.flink.streaming.api.scala.StreamExecutionEnvironment import org.apache.flink.table.api.EnvironmentSettings import org.apache.flink.table.api.bridge.scala.StreamTableEnvironment val bsEnv = StreamExecutionEnvironment.getExecutionEnvironment val bsSettings = EnvironmentSettings.newInstance().useBlinkPlanner().inStreamingMode().build() val bsTableEnv = StreamTableEnvironment.create(bsEnv, bsSettings) // or val bsTableEnv = TableEnvironment.create(bsSettings)  // ****************** // BLINK BATCH QUERY // ****************** import org.apache.flink.table.api.{EnvironmentSettings, TableEnvironment} val bbSettings = EnvironmentSettings.newInstance().useBlinkPlanner().inBatchMode().build() val bbTableEnv = TableEnvironment.create(bbSettings) æ³¨æ„ï¼šå¦‚æœåœ¨ /lib ç›®å½•ä¸‹åªæœ‰ä¸€ä¸ª planner jarï¼Œå¯ä»¥ä½¿ç”¨ AnyPlanner(python çš„ use_any_planner) æ¥åˆ›å»ºç‰¹å®šçš„ç¯å¢ƒè®¾ç½®ã€‚\nåœ¨ç›®å½•(Catalog)ä¸­åˆ›å»ºè¡¨ ä¸€ä¸ª TableEnvironment ç»´æŠ¤ç€ä¸€ä¸ªè¡¨çš„ç›®å½•å›¾ï¼Œè¿™äº›è¡¨æ˜¯ç”¨ä¸€ä¸ªæ ‡è¯†ç¬¦åˆ›å»ºçš„ã€‚æ¯ä¸ªæ ‡è¯†ç¬¦ç”± 3 éƒ¨åˆ†ç»„æˆï¼šç›®å½•åã€æ•°æ®åº“åå’Œå¯¹è±¡åã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šç›®å½•æˆ–æ•°æ®åº“ï¼Œå°†ä½¿ç”¨å½“å‰çš„é»˜è®¤å€¼ï¼ˆå‚è§Table æ ‡è¯†ç¬¦å±•å¼€éƒ¨åˆ†çš„ä¾‹å­ï¼‰ã€‚\nè¡¨å¯ä»¥æ˜¯è™šæ‹Ÿçš„ï¼ˆVIEWSï¼‰æˆ–å¸¸è§„çš„ï¼ˆTABLESï¼‰ã€‚VIEWS å¯ä»¥ä»ç°æœ‰çš„ Table å¯¹è±¡åˆ›å»ºï¼Œé€šå¸¸æ˜¯ Table API æˆ– SQL æŸ¥è¯¢çš„ç»“æœã€‚TABLES æè¿°å¤–éƒ¨æ•°æ®ï¼Œå¦‚æ–‡ä»¶ã€æ•°æ®åº“è¡¨æˆ–æ¶ˆæ¯é˜Ÿåˆ—ã€‚\nä¸´æ—¶è¡¨ä¸æ°¸ä¹…è¡¨ è¡¨å¯ä»¥æ˜¯ä¸´æ—¶çš„ï¼Œä¸å•ä¸ª Flink ä¼šè¯çš„ç”Ÿå‘½å‘¨æœŸæŒ‚é’©ï¼Œä¹Ÿå¯ä»¥æ˜¯æ°¸ä¹…çš„ï¼Œåœ¨å¤šä¸ª Flink ä¼šè¯å’Œé›†ç¾¤ä¸­å¯è§ã€‚\næ°¸ä¹…è¡¨éœ€è¦ä¸€ä¸ªç›®å½•ï¼ˆå¦‚ Hive Metastoreï¼‰æ¥ç»´æŠ¤è¡¨çš„å…ƒæ•°æ®ã€‚ä¸€æ—¦åˆ›å»ºäº†æ°¸ä¹…è¡¨ï¼Œå®ƒå¯¹è¿æ¥åˆ°ç›®å½•çš„ä»»ä½• Flink ä¼šè¯éƒ½æ˜¯å¯è§çš„ï¼Œå¹¶å°†ç»§ç»­å­˜åœ¨ï¼Œç›´åˆ°è¡¨è¢«æ˜¾å¼æ”¾å¼ƒã€‚\nå¦ä¸€æ–¹é¢ï¼Œä¸´æ—¶è¡¨æ€»æ˜¯å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¹¶ä¸”åªåœ¨å®ƒä»¬åˆ›å»ºçš„ Flink ä¼šè¯çš„æŒç»­æ—¶é—´å†…å­˜åœ¨ã€‚è¿™äº›è¡¨å¯¹å…¶ä»–ä¼šè¯ä¸å¯è§ã€‚å®ƒä»¬ä¸ç»‘å®šåˆ°ä»»ä½•ç›®å½•æˆ–æ•°æ®åº“ï¼Œä½†å¯ä»¥åœ¨ä¸€ä¸ªç›®å½•æˆ–æ•°æ®åº“çš„å‘½åç©ºé—´ä¸­åˆ›å»ºã€‚å¦‚æœç›¸åº”çš„æ•°æ®åº“è¢«åˆ é™¤ï¼Œä¸´æ—¶è¡¨ä¸ä¼šè¢«åˆ é™¤ã€‚\nShadowing å¯ä»¥ç”¨ä¸ç°æœ‰æ°¸ä¹…è¡¨ç›¸åŒçš„æ ‡è¯†ç¬¦ç™»è®°ä¸€ä¸ªä¸´æ—¶è¡¨ã€‚åªè¦ä¸´æ—¶è¡¨å­˜åœ¨ï¼Œä¸´æ—¶è¡¨å°±ä¼šå¯¹æ°¸ä¹…è¡¨äº§ç”Ÿé®ç›–ï¼Œä½¿æ°¸ä¹…è¡¨æ— æ³•è®¿é—®ã€‚æ‰€æœ‰ä½¿ç”¨è¯¥æ ‡è¯†ç¬¦çš„æŸ¥è¯¢éƒ½å°†é’ˆå¯¹ä¸´æ—¶è¡¨æ‰§è¡Œã€‚\nè¿™å¯èƒ½å¯¹å®éªŒå¾ˆæœ‰ç”¨ã€‚å®ƒå…è®¸é¦–å…ˆå¯¹ä¸´æ—¶è¡¨è¿è¡Œå®Œå…¨ç›¸åŒçš„æŸ¥è¯¢ï¼Œä¾‹å¦‚ï¼Œåªæœ‰ä¸€ä¸ªæ•°æ®å­é›†ï¼Œæˆ–è€…æ•°æ®è¢«æ··æ·†äº†ã€‚ä¸€æ—¦éªŒè¯äº†æŸ¥è¯¢çš„æ­£ç¡®æ€§ï¼Œå°±å¯ä»¥é’ˆå¯¹çœŸæ­£çš„ç”Ÿäº§è¡¨è¿è¡Œã€‚\nåˆ›å»ºä¸€ä¸ª Table è™šæ‹Ÿè¡¨ è¡¨ API å¯¹è±¡å¯¹åº”äº SQL æœ¯è¯­ä¸­çš„ VIEWï¼ˆè™šæ‹Ÿè¡¨ï¼‰ã€‚å®ƒå°è£…äº†ä¸€ä¸ªé€»è¾‘æŸ¥è¯¢è®¡åˆ’ã€‚å®ƒå¯ä»¥åœ¨ä¸€ä¸ªç›®å½•ä¸­åˆ›å»ºï¼Œå…·ä½“å¦‚ä¸‹ã€‚\n// get a TableEnvironment val tableEnv = ... // see \u0026#34;Create a TableEnvironment\u0026#34; section  // table is the result of a simple projection query val projTable: Table = tableEnv.from(\u0026#34;X\u0026#34;).select(...) // register the Table projTable as table \u0026#34;projectedTable\u0026#34; tableEnv.createTemporaryView(\u0026#34;projectedTable\u0026#34;, projTable) æ³¨æ„ï¼šTable å¯¹è±¡ä¸å…³ç³»å‹æ•°æ®åº“ç³»ç»Ÿä¸­çš„ VIEW ç±»ä¼¼ï¼Œå³å®šä¹‰ Table çš„æŸ¥è¯¢ä¸è¿›è¡Œä¼˜åŒ–ï¼Œä½†å½“å¦ä¸€ä¸ªæŸ¥è¯¢å¼•ç”¨æ³¨å†Œçš„ Table æ—¶ï¼Œä¼šè¢«å†…è”ã€‚å¦‚æœå¤šä¸ªæŸ¥è¯¢å¼•ç”¨åŒä¸€ä¸ªæ³¨å†Œè¡¨ï¼Œåˆ™ä¼šå¯¹æ¯ä¸ªå¼•ç”¨æŸ¥è¯¢è¿›è¡Œå†…è”ï¼Œå¹¶æ‰§è¡Œå¤šæ¬¡ï¼Œå³æ³¨å†Œè¡¨çš„ç»“æœä¸ä¼šè¢«å…±äº«ã€‚\nè¿æ¥å™¨è¡¨ ä¹Ÿå¯ä»¥ä»è¿æ¥å™¨å£°æ˜ä¸­åˆ›å»ºä¸€ä¸ªå…³ç³»å‹æ•°æ®åº“ä¸­å·²çŸ¥çš„ TABLEã€‚è¿æ¥å™¨æè¿°çš„æ˜¯å­˜å‚¨è¡¨æ•°æ®çš„å¤–éƒ¨ç³»ç»Ÿã€‚è¿™é‡Œå¯ä»¥å£°æ˜ Apacha Kafka æˆ–æ™®é€šæ–‡ä»¶ç³»ç»Ÿç­‰å­˜å‚¨ç³»ç»Ÿã€‚\nDDL tableEnvironment .connect(...) .withFormat(...) .withSchema(...) .inAppendMode() .createTemporaryTable(\u0026#34;MyTable\u0026#34;) æ‰©å±• Table æ ‡è¯†ç¬¦ è¡¨æ€»æ˜¯ç”¨ç›®å½•(catalog)ã€æ•°æ®åº“ã€è¡¨åä¸‰éƒ¨åˆ†ç»„æˆçš„æ ‡è¯†ç¬¦è¿›è¡Œæ³¨å†Œã€‚\nç”¨æˆ·å¯ä»¥å°†å…¶ä¸­çš„ä¸€ä¸ªç›®å½•å’Œä¸€ä¸ªæ•°æ®åº“è®¾ç½®ä¸º\u0026quot;å½“å‰ç›®å½•\u0026quot;å’Œ\u0026quot;å½“å‰æ•°æ®åº“\u0026quot;ã€‚å…¶ä¸­ï¼Œä¸Šè¿° 3 éƒ¨åˆ†æ ‡è¯†ç¬¦ä¸­çš„å‰ä¸¤éƒ¨åˆ†å¯ä»¥é€‰æ‹©ï¼Œå¦‚æœä¸æä¾›ï¼Œåˆ™å¼•ç”¨å½“å‰ç›®å½•å’Œå½“å‰æ•°æ®åº“ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡è¡¨ API æˆ– SQL åˆ‡æ¢å½“å‰ç›®å½•å’Œå½“å‰æ•°æ®åº“ã€‚\næ ‡è¯†ç¬¦éµå¾ª SQL çš„è¦æ±‚ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å¯ä»¥ç”¨åå¼•å·ç¬¦(`)è¿›è¡Œè½¬ä¹‰ã€‚\n// get a TableEnvironment val tEnv: TableEnvironment = ...; tEnv.useCatalog(\u0026#34;custom_catalog\u0026#34;) tEnv.useDatabase(\u0026#34;custom_database\u0026#34;) val table: Table = ...; // register the view named \u0026#39;exampleView\u0026#39; in the catalog named \u0026#39;custom_catalog\u0026#39; // in the database named \u0026#39;custom_database\u0026#39; tableEnv.createTemporaryView(\u0026#34;exampleView\u0026#34;, table) // register the view named \u0026#39;exampleView\u0026#39; in the catalog named \u0026#39;custom_catalog\u0026#39; // in the database named \u0026#39;other_database\u0026#39; tableEnv.createTemporaryView(\u0026#34;other_database.exampleView\u0026#34;, table) // register the view named \u0026#39;example.View\u0026#39; in the catalog named \u0026#39;custom_catalog\u0026#39; // in the database named \u0026#39;custom_database\u0026#39; tableEnv.createTemporaryView(\u0026#34;`example.View`\u0026#34;, table) // register the view named \u0026#39;exampleView\u0026#39; in the catalog named \u0026#39;other_catalog\u0026#39; // in the database named \u0026#39;other_database\u0026#39; tableEnv.createTemporaryView(\u0026#34;other_catalog.other_database.exampleView\u0026#34;, table) æŸ¥è¯¢ä¸€ä¸ª Table Table API Table API æ˜¯ Scala å’Œ Java çš„è¯­è¨€é›†æˆæŸ¥è¯¢ APIã€‚ä¸ SQL ä¸åŒçš„æ˜¯ï¼ŒæŸ¥è¯¢ä¸æ˜¯æŒ‡å®šä¸º Stringsï¼Œè€Œæ˜¯åœ¨å®¿ä¸»è¯­è¨€ä¸­ä¸€æ­¥æ­¥ç»„æˆã€‚\nè¯¥ API åŸºäº Table ç±»ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªè¡¨ï¼ˆæµå¼æˆ–æ‰¹å¤„ç†ï¼‰ï¼Œå¹¶æä¾›äº†åº”ç”¨å…³ç³»æ“ä½œçš„æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„ Table å¯¹è±¡ï¼Œè¯¥å¯¹è±¡è¡¨ç¤ºå¯¹è¾“å…¥çš„ Table åº”ç”¨å…³ç³»æ“ä½œçš„ç»“æœã€‚æœ‰äº›å…³ç³»æ“ä½œç”±å¤šä¸ªæ–¹æ³•è°ƒç”¨ç»„æˆï¼Œå¦‚ table.groupBy(...).select()ï¼Œå…¶ä¸­ groupBy(...) æŒ‡å®šè¡¨çš„åˆ†ç»„ï¼Œselect(...) æ˜¯è¡¨çš„åˆ†ç»„ä¸Šçš„æŠ•å½±ã€‚\nTable API æ–‡æ¡£æè¿°äº†æµå¼è¡¨å’Œæ‰¹å¤„ç†è¡¨ä¸Šæ”¯æŒçš„æ‰€æœ‰ Table API æ“ä½œã€‚\nä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºäº†ä¸€ä¸ªç®€å•çš„ Table API èšåˆæŸ¥è¯¢ã€‚\n// get a TableEnvironment val tableEnv = ... // see \u0026#34;Create a TableEnvironment\u0026#34; section  // register Orders table  // scan registered Orders table val orders = tableEnv.from(\u0026#34;Orders\u0026#34;) // compute revenue for all customers from France val revenue = orders .filter($\u0026#34;cCountry\u0026#34; === \u0026#34;FRANCE\u0026#34;) .groupBy($\u0026#34;cID\u0026#34;, $\u0026#34;cName\u0026#34;) .select($\u0026#34;cID\u0026#34;, $\u0026#34;cName\u0026#34;, $\u0026#34;revenue\u0026#34;.sum AS \u0026#34;revSum\u0026#34;) // emit or convert Table // execute query æ³¨æ„ï¼šScala Table API ä½¿ç”¨ä»¥ç¾å…ƒç¬¦å·ï¼ˆ$ï¼‰å¼€å¤´çš„ Scala å­—ç¬¦ä¸²æ’å€¼æ¥å¼•ç”¨ Table çš„å±æ€§ã€‚Table API ä½¿ç”¨ Scala implicitsã€‚è¯·ç¡®ä¿å¯¼å…¥\n org.apache.flink.table.api._ - ç”¨äºéšå¼è¡¨è¾¾å¼è½¬æ¢ org.apache.flink.api.scala._ å’Œ org.apache.flink.table.api.bridge.scala._ï¼Œå¦‚æœä½ æƒ³ä» DataStream è½¬æ¢åˆ° DataStreamã€‚  SQL Flink çš„ SQL é›†æˆæ˜¯åŸºäº Apache Calciteï¼Œå®ƒå®ç°äº† SQL æ ‡å‡†ã€‚SQL æŸ¥è¯¢è¢«æŒ‡å®šä¸ºå¸¸è§„ Stringsã€‚\nSQL æ–‡æ¡£æè¿°äº† Flink å¯¹æµå’Œæ‰¹å¤„ç†è¡¨çš„ SQL æ”¯æŒã€‚\nä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•æŒ‡å®šä¸€ä¸ªæŸ¥è¯¢å¹¶å°†ç»“æœä»¥è¡¨çš„å½¢å¼è¿”å›ã€‚\n// get a TableEnvironment val tableEnv = ... // see \u0026#34;Create a TableEnvironment\u0026#34; section  // register Orders table  // compute revenue for all customers from France val revenue = tableEnv.sqlQuery(\u0026#34;\u0026#34;\u0026#34; |SELECT cID, cName, SUM(revenue) AS revSum |FROM Orders |WHERE cCountry = \u0026#39;FRANCE\u0026#39; |GROUP BY cID, cName \u0026#34;\u0026#34;\u0026#34;.stripMargin) // emit or convert Table // execute query ä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºäº†å¦‚ä½•æŒ‡å®šä¸€ä¸ªæ›´æ–°æŸ¥è¯¢ï¼Œå°†å…¶ç»“æœæ’å…¥åˆ°æ³¨å†Œè¡¨ä¸­ã€‚\n// get a TableEnvironment val tableEnv = ... // see \u0026#34;Create a TableEnvironment\u0026#34; section  // register \u0026#34;Orders\u0026#34; table // register \u0026#34;RevenueFrance\u0026#34; output table  // compute revenue for all customers from France and emit to \u0026#34;RevenueFrance\u0026#34; tableEnv.executeSql(\u0026#34;\u0026#34;\u0026#34; |INSERT INTO RevenueFrance |SELECT cID, cName, SUM(revenue) AS revSum |FROM Orders |WHERE cCountry = \u0026#39;FRANCE\u0026#39; |GROUP BY cID, cName \u0026#34;\u0026#34;\u0026#34;.stripMargin) æ··åˆ Table API å’Œ SQL è¡¨ API å’Œ SQL æŸ¥è¯¢å¯ä»¥å¾ˆå®¹æ˜“åœ°æ··åˆï¼Œå› ä¸ºä¸¤è€…éƒ½è¿”å› Table å¯¹è±¡ã€‚\n å¯ä»¥åœ¨ SQL æŸ¥è¯¢è¿”å›çš„ Table å¯¹è±¡ä¸Šå®šä¹‰ Table API æŸ¥è¯¢ã€‚ é€šè¿‡åœ¨ TableEnvironment ä¸­æ³¨å†Œç”Ÿæˆçš„ Tableå¹¶åœ¨ SQL æŸ¥è¯¢çš„ FROM å­å¥ä¸­å¼•ç”¨å®ƒï¼Œå¯ä»¥åœ¨ Table API æŸ¥è¯¢çš„ç»“æœä¸Šå®šä¹‰ä¸€ä¸ª SQL æŸ¥è¯¢ã€‚  å‘å‡ºä¸€ä¸ªè¡¨ ä¸€ä¸ª Table æ˜¯é€šè¿‡å°†å…¶å†™å…¥ TableSink è€Œå‘å‡ºçš„ã€‚TableSink æ˜¯ä¸€ä¸ªé€šç”¨æ¥å£ï¼Œå®ƒæ”¯æŒå¤šç§æ–‡ä»¶æ ¼å¼ï¼ˆå¦‚ CSVã€Apache Parquetã€Apache Avroï¼‰ã€å­˜å‚¨ç³»ç»Ÿï¼ˆå¦‚ JDBCã€Apache HBaseã€Apache Cassandraã€Elasticsearchï¼‰æˆ–æ¶ˆæ¯ç³»ç»Ÿï¼ˆå¦‚ Apache Kafkaã€RabbitMQï¼‰ã€‚\næ‰¹é‡è¡¨åªèƒ½å†™å…¥ BatchTableSinkï¼Œè€Œæµå¼è¡¨åˆ™éœ€è¦ AppendStreamTableSinkã€RetractStreamTableSink æˆ– UpsertStreamTableSinkã€‚\nè¯·å‚é˜…æœ‰å…³ Table Sources \u0026amp; Sink çš„æ–‡æ¡£ï¼Œä»¥äº†è§£å¯ç”¨çš„ Sink çš„è¯¦ç»†ä¿¡æ¯ä»¥åŠå¦‚ä½•å®ç°è‡ªå®šä¹‰ TableSink çš„è¯´æ˜ã€‚\nTable.executeInsert(String tableName) æ–¹æ³•å°† Table æ’æ”¾åˆ°ä¸€ä¸ªæ³¨å†Œçš„ TableSink ä¸­ã€‚è¯¥æ–¹æ³•é€šè¿‡åç§°ä»ç›®å½•ä¸­æŸ¥æ‰¾ TableSinkï¼Œå¹¶éªŒè¯ Table çš„æ¨¡å¼ä¸ TableSink çš„æ¨¡å¼æ˜¯å¦ç›¸åŒã€‚\nä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•å‘å°„ Tableã€‚\n// get a TableEnvironment val tableEnv = ... // see \u0026#34;Create a TableEnvironment\u0026#34; section  // create an output Table val schema = new Schema() .field(\u0026#34;a\u0026#34;, DataTypes.INT()) .field(\u0026#34;b\u0026#34;, DataTypes.STRING()) .field(\u0026#34;c\u0026#34;, DataTypes.LONG()) tableEnv.connect(new FileSystem(\u0026#34;/path/to/file\u0026#34;)) .withFormat(new Csv().fieldDelimiter(\u0026#39;|\u0026#39;).deriveSchema()) .withSchema(schema) .createTemporaryTable(\u0026#34;CsvSinkTable\u0026#34;) // compute a result Table using Table API operators and/or SQL queries val result: Table = ... // emit the result Table to the registered TableSink result.executeInsert(\u0026#34;CsvSinkTable\u0026#34;) ç¿»è¯‘å’Œæ‰§è¡ŒæŸ¥è¯¢ ä¸¤ä¸ªè§„åˆ’å™¨ç¿»è¯‘å’Œæ‰§è¡ŒæŸ¥è¯¢çš„è¡Œä¸ºæ˜¯ä¸åŒçš„ã€‚\n Blink è®¡åˆ’å™¨  è¡¨ API å’Œ SQL æŸ¥è¯¢æ— è®ºå…¶è¾“å…¥æ˜¯æµå¼è¿˜æ˜¯æ‰¹å¤„ç†ï¼Œéƒ½ä¼šè¢«ç¿»è¯‘æˆ DataStream ç¨‹åºã€‚ä¸€ä¸ªæŸ¥è¯¢åœ¨å†…éƒ¨è¡¨ç¤ºä¸ºä¸€ä¸ªé€»è¾‘æŸ¥è¯¢è®¡åˆ’ï¼Œå¹¶åˆ†ä¸¤ä¸ªé˜¶æ®µè¿›è¡Œç¿»è¯‘ã€‚\n é€»è¾‘è®¡åˆ’çš„ä¼˜åŒ–ã€‚ ç¿»è¯‘æˆ DataStream ç¨‹åºã€‚  Table API æˆ– SQL æŸ¥è¯¢è¢«ç¿»è¯‘æ—¶:\n TableEnvironment.executeSql() è¢«è°ƒç”¨ã€‚è¿™ä¸ªæ–¹æ³•ç”¨äºæ‰§è¡Œç»™å®šçš„è¯­å¥ï¼Œä¸€æ—¦è¿™ä¸ªæ–¹æ³•è¢«è°ƒç”¨ï¼Œsql æŸ¥è¯¢å°±ä¼šç«‹å³è¢«ç¿»è¯‘ã€‚ Table.executeInsert() è¢«è°ƒç”¨ã€‚è¯¥æ–¹æ³•ç”¨äºå°†è¡¨çš„å†…å®¹æ’å…¥åˆ°ç»™å®šçš„ sink è·¯å¾„ä¸­ï¼Œä¸€æ—¦è°ƒç”¨è¯¥æ–¹æ³•ï¼ŒTable API ç«‹å³è¢«ç¿»è¯‘ã€‚ è°ƒç”¨ Table.execute()ã€‚è¯¥æ–¹æ³•ç”¨äºå°†è¡¨å†…å®¹æ”¶é›†åˆ°æœ¬åœ°å®¢æˆ·ç«¯ï¼Œä¸€æ—¦è°ƒç”¨è¯¥æ–¹æ³•ï¼ŒTable API ç«‹å³è¢«ç¿»è¯‘ã€‚ StatementSet.execute() è¢«è°ƒç”¨ã€‚ä¸€ä¸ª Tableï¼ˆé€šè¿‡ StatementSet.addInsert() å‘ sink å‘å‡ºï¼‰æˆ–ä¸€ä¸ª INSERT è¯­å¥ï¼ˆé€šè¿‡ StatementSet.addInsertSql() æŒ‡å®šï¼‰å°†é¦–å…ˆåœ¨ StatementSet ä¸­è¢«ç¼“å†²ã€‚ä¸€æ—¦ StatementSet.execute() è¢«è°ƒç”¨ï¼Œå®ƒä»¬å°±ä¼šè¢«ç¿»è¯‘ã€‚æ‰€æœ‰æ¥æ”¶å™¨å°†è¢«ä¼˜åŒ–æˆä¸€ä¸ª DAGã€‚ å½“ä¸€ä¸ªè¡¨è¢«è½¬æ¢ä¸º DataStream æ—¶ï¼Œå®ƒå°±ä¼šè¢«ç¿»è¯‘ï¼ˆå‚è§ä¸ DataStream å’Œ DataSet API çš„é›†æˆï¼‰ã€‚ä¸€æ—¦ç¿»è¯‘å®Œæ¯•ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå¸¸è§„çš„ DataStream ç¨‹åºï¼Œå¹¶åœ¨è°ƒç”¨ StreamExecutionEnvironment.execut()æ—¶è¢«æ‰§è¡Œã€‚ æ³¨æ„: ä» 1.11 ç‰ˆæœ¬å¼€å§‹ï¼ŒsqlUpdate() æ–¹æ³•å’Œ insertInto() æ–¹æ³•å·²è¢«åºŸå¼ƒã€‚å¦‚æœ Table ç¨‹åºæ˜¯ç”±è¿™ä¸¤ä¸ªæ–¹æ³•æ„å»ºçš„ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨ StreamTableEnvironment.execution() æ–¹æ³•ä»£æ›¿ StreamExecutionEnvironment.execution() æ–¹æ³•æ¥æ‰§è¡Œã€‚  ä¸ DataStream å’Œ DataSet API çš„é›†æˆ ä¸¤ç§æµä¸Šçš„è®¡åˆ’å™¨éƒ½å¯ä»¥ä¸ DataStream API é›†æˆï¼Œåªæœ‰è€çš„è®¡åˆ’å™¨å¯ä»¥ä¸ DataSet API é›†æˆï¼Œæ‰¹å¤„ç†çš„ Blink è®¡åˆ’å™¨ä¸èƒ½ä¸ä¸¤è€…ç»“åˆã€‚åªæœ‰æ—§çš„è®¡åˆ’å™¨å¯ä»¥ä¸ DataSet API é›†æˆï¼Œæ‰¹å¤„ç†çš„ Blink è®¡åˆ’å™¨ä¸èƒ½ä¸ä¸¤è€…ç»“åˆã€‚æ³¨ï¼šä¸‹é¢è®¨è®ºçš„ DataSet API åªé€‚ç”¨äºæ‰¹å¤„ç†çš„æ—§ç‰ˆè§„åˆ’å™¨ã€‚\nTable API å’Œ SQL æŸ¥è¯¢å¯ä»¥å¾ˆå®¹æ˜“åœ°ä¸ DataStream å’Œ DataSet ç¨‹åºé›†æˆå¹¶åµŒå…¥å…¶ä¸­ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥æŸ¥è¯¢ä¸€ä¸ªå¤–éƒ¨è¡¨ï¼ˆä¾‹å¦‚æ¥è‡ª RDBMSï¼‰ï¼Œåšä¸€äº›é¢„å¤„ç†ï¼Œå¦‚è¿‡æ»¤ã€æŠ•å½±ã€èšåˆæˆ–åŠ å…¥å…ƒæ•°æ®ï¼Œç„¶åç”¨ DataStream æˆ– DataSet APIï¼ˆä»¥åŠå»ºç«‹åœ¨è¿™äº› API ä¹‹ä¸Šçš„ä»»ä½•åº“ï¼Œå¦‚ CEP æˆ– Gellyï¼‰è¿›ä¸€æ­¥å¤„ç†æ•°æ®ã€‚åä¹‹ï¼Œä¹Ÿå¯ä»¥åœ¨ DataStream æˆ– DataSet ç¨‹åºçš„ç»“æœä¸Šåº”ç”¨ Table API æˆ– SQL æŸ¥è¯¢ã€‚\nè¿™ç§äº¤äº’å¯ä»¥é€šè¿‡å°† DataStream æˆ– DataSet è½¬æ¢ä¸ºè¡¨æ¥å®ç°ï¼Œåä¹‹äº¦ç„¶ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†æè¿°è¿™äº›è½¬æ¢æ˜¯å¦‚ä½•å®Œæˆçš„ã€‚\nScala éšå¼è½¬æ¢ Scala Table API ä¸º DataSetã€DataStream å’Œ Table ç±»æä¾›äº†éšå¼è½¬æ¢çš„åŠŸèƒ½ã€‚è¿™äº›è½¬æ¢æ˜¯é€šè¿‡å¯¼å…¥åŒ… org.apache.flink.table.api.bridge.scala._ æ¥å®ç°çš„ï¼Œæ­¤å¤–è¿˜å¯ä»¥å¯¼å…¥ org.apache.flink.api.scala._ æ¥å®ç° Scala DataStream APIã€‚\nä» DataStream æˆ– DataSet åˆ›å»ºè§†å›¾ DataStream æˆ– DataSet å¯ä»¥ä½œä¸ºè§†å›¾åœ¨ TableEnvironment ä¸­æ³¨å†Œã€‚ç”±æ­¤äº§ç”Ÿçš„è§†å›¾çš„æ¨¡å¼å–å†³äºæ³¨å†Œçš„ DataStream æˆ– DataSet çš„æ•°æ®ç±»å‹ã€‚è¯·æŸ¥çœ‹æœ‰å…³æ•°æ®ç±»å‹åˆ°è¡¨æ¨¡å¼çš„æ˜ å°„éƒ¨åˆ†ä»¥äº†è§£è¯¦æƒ…ã€‚\næ³¨æ„ï¼šä» DataStream æˆ– DataSet åˆ›å»ºçš„è§†å›¾åªèƒ½æ³¨å†Œä¸ºä¸´æ—¶è§†å›¾ã€‚\n// get TableEnvironment // registration of a DataSet is equivalent val tableEnv: StreamTableEnvironment = ... // see \u0026#34;Create a TableEnvironment\u0026#34; section  val stream: DataStream[(Long, String)] = ... // register the DataStream as View \u0026#34;myTable\u0026#34; with fields \u0026#34;f0\u0026#34;, \u0026#34;f1\u0026#34; tableEnv.createTemporaryView(\u0026#34;myTable\u0026#34;, stream) // register the DataStream as View \u0026#34;myTable2\u0026#34; with fields \u0026#34;myLong\u0026#34;, \u0026#34;myString\u0026#34; tableEnv.createTemporaryView(\u0026#34;myTable2\u0026#34;, stream, \u0026#39;myLong, \u0026#39;myString) å°† DataStream æˆ– DataSet è½¬æ¢ä¸º Table ä¸éœ€è¦åœ¨ TableEnvironment ä¸­æ³¨å†Œä¸€ä¸ª DataStream æˆ– DataSetï¼Œä¹Ÿå¯ä»¥ç›´æ¥å°†å…¶è½¬æ¢ä¸º Tableã€‚å¦‚æœä½ æƒ³åœ¨ Table API æŸ¥è¯¢ä¸­ä½¿ç”¨ Tableï¼Œè¿™å¾ˆæ–¹ä¾¿ã€‚\n// get TableEnvironment // registration of a DataSet is equivalent val tableEnv = ... // see \u0026#34;Create a TableEnvironment\u0026#34; section  val stream: DataStream[(Long, String)] = ... // convert the DataStream into a Table with default fields \u0026#34;_1\u0026#34;, \u0026#34;_2\u0026#34; val table1: Table = tableEnv.fromDataStream(stream) // convert the DataStream into a Table with fields \u0026#34;myLong\u0026#34;, \u0026#34;myString\u0026#34; val table2: Table = tableEnv.fromDataStream(stream, $\u0026#34;myLong\u0026#34;, $\u0026#34;myString\u0026#34;) å°† Table è½¬æ¢ä¸º DataStream æˆ– DataSet Table å¯ä»¥è¢«è½¬æ¢ä¸º DataStream æˆ– DataSetã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥åœ¨è¡¨ API æˆ– SQL æŸ¥è¯¢çš„ç»“æœä¸Šè¿è¡Œè‡ªå®šä¹‰ DataStream æˆ– DataSet ç¨‹åºã€‚\nå½“å°† Table è½¬æ¢ä¸º DataStream æˆ– DataSet æ—¶ï¼Œæ‚¨éœ€è¦æŒ‡å®šç”Ÿæˆçš„ DataStream æˆ– DataSet çš„æ•°æ®ç±»å‹ï¼Œå³è¡¨çš„è¡Œè¦è½¬æ¢ä¸ºçš„æ•°æ®ç±»å‹ã€‚é€šå¸¸ï¼Œæœ€æ–¹ä¾¿çš„è½¬æ¢ç±»å‹æ˜¯ Rowã€‚ä¸‹é¢çš„åˆ—è¡¨ç»™å‡ºäº†ä¸åŒé€‰é¡¹çš„åŠŸèƒ½æ¦‚è¿°ã€‚\n Rowï¼šå­—æ®µæŒ‰ä½ç½®æ˜ å°„ï¼Œå­—æ®µæ•°é‡ä»»æ„ï¼Œæ”¯æŒ null å€¼ï¼Œæ— ç±»å‹å®‰å…¨è®¿é—®ã€‚ POJOï¼šå­—æ®µæŒ‰åç§°æ˜ å°„ï¼ˆPOJO å­—æ®µå¿…é¡»ä¸è¡¨å­—æ®µä¸€æ ·å‘½åï¼‰ï¼Œä»»æ„æ•°é‡çš„å­—æ®µï¼Œæ”¯æŒ null å€¼ï¼Œç±»å‹å®‰å…¨è®¿é—®ã€‚ Case Classï¼šå­—æ®µæŒ‰ä½ç½®æ˜ å°„ï¼Œä¸æ”¯æŒ null å€¼ï¼Œç±»å‹å®‰å…¨è®¿é—®ã€‚ Tupleï¼šå­—æ®µæŒ‰ä½ç½®æ˜ å°„ï¼Œé™åˆ¶ä¸º 22 ä¸ªï¼ˆScalaï¼‰æˆ– 25 ä¸ªï¼ˆJavaï¼‰å­—æ®µï¼Œä¸æ”¯æŒ null å€¼ï¼Œç±»å‹å®‰å…¨è®¿é—®ã€‚ åŸå­ç±»å‹ï¼šè¡¨å¿…é¡»æœ‰ä¸€ä¸ªå­—æ®µï¼Œä¸æ”¯æŒç©ºå€¼ï¼Œç±»å‹å®‰å…¨è®¿é—®ã€‚è¡¨å¿…é¡»æœ‰ä¸€ä¸ªå­—æ®µï¼Œä¸æ”¯æŒ null å€¼ï¼Œç±»å‹å®‰å…¨è®¿é—®ã€‚  å°† Table è½¬æ¢ä¸º DataStream ä½œä¸ºæµå¼æŸ¥è¯¢ç»“æœçš„è¡¨å°†è¢«åŠ¨æ€æ›´æ–°ï¼Œå³éšç€æŸ¥è¯¢è¾“å…¥æµä¸­æ–°è®°å½•çš„åˆ°è¾¾è€Œå˜åŒ–ã€‚å› æ­¤ï¼Œå°†è¿™ç§åŠ¨æ€æŸ¥è¯¢è½¬æ¢æˆçš„ DataStream éœ€è¦å¯¹è¡¨çš„æ›´æ–°è¿›è¡Œç¼–ç ã€‚\næœ‰ä¸¤ç§æ¨¡å¼å¯ä»¥å°†è¡¨è½¬æ¢ä¸º DataStreamã€‚\n Append æ¨¡å¼ã€‚åªæœ‰å½“åŠ¨æ€ Table åªè¢« INSERT ä¿®æ”¹æ—¶ï¼Œæ‰å¯ä»¥ä½¿ç”¨è¿™ç§æ¨¡å¼ï¼Œå³åªè¿›è¡Œè¿½åŠ ï¼Œä¹‹å‰å‘å‡ºçš„ç»“æœæ°¸è¿œä¸ä¼šæ›´æ–°ã€‚ æ”¶å›æ¨¡å¼ã€‚è¿™ç§æ¨¡å¼å¯ä»¥ä¸€ç›´ä½¿ç”¨ã€‚å®ƒå°† INSERT å’Œ DELETE æ›´æ”¹ç”¨å¸ƒå°”æ ‡å¿—ç¼–ç ã€‚  // get TableEnvironment. // registration of a DataSet is equivalent val tableEnv: StreamTableEnvironment = ... // see \u0026#34;Create a TableEnvironment\u0026#34; section  // Table with two fields (String name, Integer age) val table: Table = ... // convert the Table into an append DataStream of Row val dsRow: DataStream[Row] = tableEnv.toAppendStream[Row](table) // convert the Table into an append DataStream of Tuple2[String, Int] val dsTuple: DataStream[(String, Int)] dsTuple = tableEnv.toAppendStream[(String, Int)](table) // convert the Table into a retract DataStream of Row. // A retract stream of type X is a DataStream[(Boolean, X)]. // The boolean field indicates the type of the change. // True is INSERT, false is DELETE. val retractStream: DataStream[(Boolean, Row)] = tableEnv.toRetractStream[Row](table) æ³¨æ„ï¼šå…³äºåŠ¨æ€è¡¨åŠå…¶å±æ€§çš„è¯¦ç»†è®¨è®ºåœ¨åŠ¨æ€è¡¨æ–‡æ¡£ä¸­ç»™å‡ºã€‚\næ³¨æ„: ä¸€æ—¦è¡¨è½¬æ¢ä¸º DataStreamï¼Œè¯·ä½¿ç”¨ StreamExecutionEnvironment.execute() æ–¹æ³•æ¥æ‰§è¡Œ DataStream ç¨‹åºã€‚\nå°† Table è½¬æ¢ä¸º DataSet Table è½¬æ¢ä¸º DataStream çš„è¿‡ç¨‹å¦‚ä¸‹:\n// get TableEnvironment // registration of a DataSet is equivalent val tableEnv = BatchTableEnvironment.create(env) // Table with two fields (String name, Integer age) val table: Table = ... // convert the Table into a DataSet of Row val dsRow: DataSet[Row] = tableEnv.toDataSet[Row](table) // convert the Table into a DataSet of Tuple2[String, Int] val dsTuple: DataSet[(String, Int)] = tableEnv.toDataSet[(String, Int)](table) æ³¨æ„: ä¸€æ—¦ Table è½¬æ¢ä¸º DataSetï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨ ExecutionEnvironment.execute æ–¹æ³•æ¥æ‰§è¡Œ DataSet ç¨‹åºã€‚\næ•°æ®ç±»å‹åˆ° Table Schema çš„æ˜ å°„ Flink çš„ DataStream å’Œ DataSet API æ”¯æŒéå¸¸å¤šæ ·åŒ–çš„ç±»å‹ã€‚å¤åˆç±»å‹ï¼Œå¦‚ Tuplesï¼ˆå†…ç½®çš„ Scala å’Œ Flink Java tuplesï¼‰ã€POJOsã€Scala case ç±»å’Œ Flink çš„ Row ç±»å‹ï¼Œå…è®¸åµŒå¥—å…·æœ‰å¤šä¸ªå­—æ®µçš„æ•°æ®ç»“æ„ï¼Œè¿™äº›å­—æ®µå¯ä»¥åœ¨ Table è¡¨è¾¾å¼ä¸­è®¿é—®ã€‚å…¶ä»–ç±»å‹è¢«è§†ä¸ºåŸå­ç±»å‹ã€‚åœ¨ä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æè¿° Table API å¦‚ä½•å°†è¿™äº›ç±»å‹è½¬æ¢ä¸ºå†…éƒ¨è¡Œè¡¨ç¤ºï¼Œå¹¶å±•ç¤ºå°† DataStream è½¬æ¢ä¸º Table çš„ä¾‹å­ã€‚\næ•°æ®ç±»å‹åˆ° Table Schema çš„æ˜ å°„å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼è¿›è¡Œï¼šåŸºäºå­—æ®µä½ç½®æˆ–åŸºäºå­—æ®µåã€‚\n åŸºäºä½ç½®çš„æ˜ å°„  åŸºäºä½ç½®çš„æ˜ å°„å¯ä»¥ç”¨æ¥ç»™å­—æ®µä¸€ä¸ªæ›´æœ‰æ„ä¹‰çš„åå­—ï¼ŒåŒæ—¶ä¿æŒå­—æ®µé¡ºåºã€‚è¿™ç§æ˜ å°„å¯ç”¨äºå…·æœ‰å®šä¹‰å­—æ®µé¡ºåºçš„å¤åˆæ•°æ®ç±»å‹ä»¥åŠåŸå­ç±»å‹ã€‚å¤åˆæ•°æ®ç±»å‹å¦‚å…ƒç»„ã€è¡Œå’Œ case ç±»éƒ½æœ‰è¿™æ ·çš„å­—æ®µé¡ºåºã€‚ç„¶è€Œï¼ŒPOJO çš„å­—æ®µå¿…é¡»æ ¹æ®å­—æ®µåè¿›è¡Œæ˜ å°„ï¼ˆè§ä¸‹ä¸€èŠ‚ï¼‰ã€‚å­—æ®µå¯ä»¥è¢«æŠ•å½±å‡ºæ¥ï¼Œä½†ä¸èƒ½ä½¿ç”¨åˆ«åä½œä¸ºé‡å‘½åã€‚\nå½“å®šä¹‰åŸºäºä½ç½®çš„æ˜ å°„æ—¶ï¼ŒæŒ‡å®šçš„åç§°å¿…é¡»ä¸å­˜åœ¨äºè¾“å…¥æ•°æ®ç±»å‹ä¸­ï¼Œå¦åˆ™ API å°†å‡è®¾æ˜ å°„åº”è¯¥åŸºäºå­—æ®µåå‘ç”Ÿã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šå­—æ®µåï¼Œåˆ™ä½¿ç”¨å¤åˆç±»å‹çš„é»˜è®¤å­—æ®µåå’Œå­—æ®µé¡ºåºï¼Œå¯¹äºåŸå­ç±»å‹åˆ™ä½¿ç”¨ f0ã€‚\n// get a TableEnvironment val tableEnv: StreamTableEnvironment = ... // see \u0026#34;Create a TableEnvironment\u0026#34; section  val stream: DataStream[(Long, Int)] = ... // convert DataStream into Table with default field names \u0026#34;_1\u0026#34; and \u0026#34;_2\u0026#34; val table: Table = tableEnv.fromDataStream(stream) // convert DataStream into Table with field \u0026#34;myLong\u0026#34; only val table: Table = tableEnv.fromDataStream(stream, $\u0026#34;myLong\u0026#34;) // convert DataStream into Table with field names \u0026#34;myLong\u0026#34; and \u0026#34;myInt\u0026#34; val table: Table = tableEnv.fromDataStream(stream, $\u0026#34;myLong\u0026#34;, $\u0026#34;myInt\u0026#34;)  åŸºäºåç§°çš„æ˜ å°„  åŸºäºåç§°çš„æ˜ å°„å¯ä»¥ç”¨äºä»»ä½•æ•°æ®ç±»å‹ï¼ŒåŒ…æ‹¬ POJOã€‚å®ƒæ˜¯å®šä¹‰è¡¨æ¨¡å¼æ˜ å°„çš„æœ€çµæ´»çš„æ–¹å¼ã€‚æ˜ å°„ä¸­çš„æ‰€æœ‰å­—æ®µéƒ½æ˜¯é€šè¿‡åç§°å¼•ç”¨çš„ï¼Œå¹¶å¯èƒ½ä½¿ç”¨åˆ«åé‡å‘½åä¸ºã€‚å­—æ®µå¯ä»¥é‡æ–°æ’åºå’ŒæŠ•å½±å‡ºæ¥ã€‚\nå¦‚æœæ²¡æœ‰æŒ‡å®šå­—æ®µåï¼Œåˆ™ä½¿ç”¨å¤åˆç±»å‹çš„é»˜è®¤å­—æ®µåå’Œå­—æ®µé¡ºåºï¼Œå¯¹äºåŸå­ç±»å‹åˆ™ä½¿ç”¨ f0ã€‚\n// get a TableEnvironment val tableEnv: StreamTableEnvironment = ... // see \u0026#34;Create a TableEnvironment\u0026#34; section  val stream: DataStream[(Long, Int)] = ... // convert DataStream into Table with default field names \u0026#34;_1\u0026#34; and \u0026#34;_2\u0026#34; val table: Table = tableEnv.fromDataStream(stream) // convert DataStream into Table with field \u0026#34;_2\u0026#34; only val table: Table = tableEnv.fromDataStream(stream, $\u0026#34;_2\u0026#34;) // convert DataStream into Table with swapped fields val table: Table = tableEnv.fromDataStream(stream, $\u0026#34;_2\u0026#34;, $\u0026#34;_1\u0026#34;) // convert DataStream into Table with swapped fields and field names \u0026#34;myInt\u0026#34; and \u0026#34;myLong\u0026#34; val table: Table = tableEnv.fromDataStream(stream, $\u0026#34;_2\u0026#34; as \u0026#34;myInt\u0026#34;, $\u0026#34;_1\u0026#34; as \u0026#34;myLong\u0026#34;) åŸå­ç±»å‹ Flink å°†åŸè¯­ï¼ˆIntegerã€Doubleã€Stringï¼‰æˆ–é€šç”¨ç±»å‹ï¼ˆä¸èƒ½åˆ†æå’Œåˆ†è§£çš„ç±»å‹ï¼‰è§†ä¸ºåŸå­ç±»å‹ã€‚åŸå­ç±»å‹çš„ DataStream æˆ– DataSet ä¼šè¢«è½¬æ¢ä¸ºå…·æœ‰å•ä¸€å±æ€§çš„ Tableã€‚å±æ€§çš„ç±»å‹æ˜¯ä»åŸå­ç±»å‹æ¨æ–­å‡ºæ¥çš„ï¼Œå¯ä»¥æŒ‡å®šå±æ€§çš„åç§°ã€‚\n// get a TableEnvironment val tableEnv: StreamTableEnvironment = ... // see \u0026#34;Create a TableEnvironment\u0026#34; section  val stream: DataStream[Long] = ... // convert DataStream into Table with default field name \u0026#34;f0\u0026#34; val table: Table = tableEnv.fromDataStream(stream) // convert DataStream into Table with field name \u0026#34;myLong\u0026#34; val table: Table = tableEnv.fromDataStream(stream, $\u0026#34;myLong\u0026#34;) Tuplesï¼ˆScala å’Œ Javaï¼‰å’Œ Case ç±»ï¼ˆä»… Scalaï¼‰ã€‚ Flink æ”¯æŒ Scala çš„å†…ç½®å…ƒç»„ï¼Œå¹¶ä¸º Java æä¾›äº†è‡ªå·±çš„å…ƒç»„ç±»ã€‚DataStreams å’Œ DataSets è¿™ä¸¤ç§å…ƒç»„éƒ½å¯ä»¥è½¬æ¢ä¸ºè¡¨ã€‚é€šè¿‡ä¸ºæ‰€æœ‰å­—æ®µæä¾›åç§°ï¼ˆåŸºäºä½ç½®çš„æ˜ å°„ï¼‰ï¼Œå¯ä»¥é‡å‘½åå­—æ®µã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šå­—æ®µåï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„å­—æ®µåã€‚å¦‚æœå¼•ç”¨äº†åŸå§‹çš„å­—æ®µåï¼ˆå¯¹äº Flink Tuples æ¥è¯´æ˜¯ f0, f1, \u0026hellip;ï¼Œå¯¹äº Scala Tuples æ¥è¯´æ˜¯ _1, _2, \u0026hellip;ï¼‰ï¼ŒAPI ä¼šå‡å®šæ˜ å°„æ˜¯åŸºäºåç§°è€Œä¸æ˜¯åŸºäºä½ç½®çš„ã€‚åŸºäºåç§°çš„æ˜ å°„å…è®¸é‡æ–°æ’åºå­—æ®µå’Œç”¨åˆ«åï¼ˆasï¼‰è¿›è¡ŒæŠ•å½±ã€‚\n// get a TableEnvironment val tableEnv: StreamTableEnvironment = ... // see \u0026#34;Create a TableEnvironment\u0026#34; section  val stream: DataStream[(Long, String)] = ... // convert DataStream into Table with renamed default field names \u0026#39;_1, \u0026#39;_2 val table: Table = tableEnv.fromDataStream(stream) // convert DataStream into Table with field names \u0026#34;myLong\u0026#34;, \u0026#34;myString\u0026#34; (position-based) val table: Table = tableEnv.fromDataStream(stream, $\u0026#34;myLong\u0026#34;, $\u0026#34;myString\u0026#34;) // convert DataStream into Table with reordered fields \u0026#34;_2\u0026#34;, \u0026#34;_1\u0026#34; (name-based) val table: Table = tableEnv.fromDataStream(stream, $\u0026#34;_2\u0026#34;, $\u0026#34;_1\u0026#34;) // convert DataStream into Table with projected field \u0026#34;_2\u0026#34; (name-based) val table: Table = tableEnv.fromDataStream(stream, $\u0026#34;_2\u0026#34;) // convert DataStream into Table with reordered and aliased fields \u0026#34;myString\u0026#34;, \u0026#34;myLong\u0026#34; (name-based) val table: Table = tableEnv.fromDataStream(stream, $\u0026#34;_2\u0026#34; as \u0026#34;myString\u0026#34;, $\u0026#34;_1\u0026#34; as \u0026#34;myLong\u0026#34;) // define case class case class Person(name: String, age: Int) val streamCC: DataStream[Person] = ... // convert DataStream into Table with default field names \u0026#39;name, \u0026#39;age val table = tableEnv.fromDataStream(streamCC) // convert DataStream into Table with field names \u0026#39;myName, \u0026#39;myAge (position-based) val table = tableEnv.fromDataStream(streamCC, $\u0026#34;myName\u0026#34;, $\u0026#34;myAge\u0026#34;) // convert DataStream into Table with reordered and aliased fields \u0026#34;myAge\u0026#34;, \u0026#34;myName\u0026#34; (name-based) val table: Table = tableEnv.fromDataStream(stream, $\u0026#34;age\u0026#34; as \u0026#34;myAge\u0026#34;, $\u0026#34;name\u0026#34; as \u0026#34;myName\u0026#34;) POJOï¼ˆJava å’Œ Scalaï¼‰ Flink æ”¯æŒ POJO ä½œä¸ºå¤åˆç±»å‹ã€‚è¿™é‡Œè®°å½•äº†ç¡®å®š POJO çš„è§„åˆ™ã€‚\nå½“å°† POJO DataStream æˆ– DataSet è½¬æ¢ä¸º Table è€Œä¸æŒ‡å®šå­—æ®µåæ—¶ï¼Œä¼šä½¿ç”¨åŸå§‹ POJO å­—æ®µçš„åç§°ã€‚åç§°æ˜ å°„éœ€è¦åŸå§‹åç§°ï¼Œä¸èƒ½é€šè¿‡ä½ç½®æ¥å®Œæˆã€‚å­—æ®µå¯ä»¥ä½¿ç”¨åˆ«åï¼ˆä½¿ç”¨ as å…³é”®å­—ï¼‰é‡å‘½åï¼Œé‡æ–°æ’åºï¼Œå¹¶è¿›è¡ŒæŠ•å½±ã€‚\n// get a TableEnvironment val tableEnv: StreamTableEnvironment = ... // see \u0026#34;Create a TableEnvironment\u0026#34; section  // Person is a POJO with field names \u0026#34;name\u0026#34; and \u0026#34;age\u0026#34; val stream: DataStream[Person] = ... // convert DataStream into Table with default field names \u0026#34;age\u0026#34;, \u0026#34;name\u0026#34; (fields are ordered by name!) val table: Table = tableEnv.fromDataStream(stream) // convert DataStream into Table with renamed fields \u0026#34;myAge\u0026#34;, \u0026#34;myName\u0026#34; (name-based) val table: Table = tableEnv.fromDataStream(stream, $\u0026#34;age\u0026#34; as \u0026#34;myAge\u0026#34;, $\u0026#34;name\u0026#34; as \u0026#34;myName\u0026#34;) // convert DataStream into Table with projected field \u0026#34;name\u0026#34; (name-based) val table: Table = tableEnv.fromDataStream(stream, $\u0026#34;name\u0026#34;) // convert DataStream into Table with projected and renamed field \u0026#34;myName\u0026#34; (name-based) val table: Table = tableEnv.fromDataStream(stream, $\u0026#34;name\u0026#34; as \u0026#34;myName\u0026#34;) Row Row æ•°æ®ç±»å‹æ”¯æŒä»»æ„æ•°é‡çš„å­—æ®µå’Œå…·æœ‰ null å€¼çš„å­—æ®µã€‚å­—æ®µåå¯ä»¥é€šè¿‡ RowTypeInfo æ¥æŒ‡å®šï¼Œä¹Ÿå¯ä»¥åœ¨å°† Row DataStream æˆ– DataSet è½¬æ¢ä¸º Table æ—¶æŒ‡å®šã€‚Row ç±»å‹æ”¯æŒé€šè¿‡ä½ç½®å’Œåç§°å¯¹å­—æ®µè¿›è¡Œæ˜ å°„ã€‚å¯ä»¥é€šè¿‡ä¸ºæ‰€æœ‰å­—æ®µæä¾›åç§°ï¼ˆåŸºäºä½ç½®çš„æ˜ å°„ï¼‰æˆ–å•ç‹¬é€‰æ‹©å­—æ®µè¿›è¡ŒæŠ•å½±/æ’åº/é‡å‘½åï¼ˆåŸºäºåç§°çš„æ˜ å°„ï¼‰æ¥é‡å‘½åå­—æ®µã€‚\n// get a TableEnvironment val tableEnv: StreamTableEnvironment = ... // see \u0026#34;Create a TableEnvironment\u0026#34; section  // DataStream of Row with two fields \u0026#34;name\u0026#34; and \u0026#34;age\u0026#34; specified in `RowTypeInfo` val stream: DataStream[Row] = ... // convert DataStream into Table with default field names \u0026#34;name\u0026#34;, \u0026#34;age\u0026#34; val table: Table = tableEnv.fromDataStream(stream) // convert DataStream into Table with renamed field names \u0026#34;myName\u0026#34;, \u0026#34;myAge\u0026#34; (position-based) val table: Table = tableEnv.fromDataStream(stream, $\u0026#34;myName\u0026#34;, $\u0026#34;myAge\u0026#34;) // convert DataStream into Table with renamed fields \u0026#34;myName\u0026#34;, \u0026#34;myAge\u0026#34; (name-based) val table: Table = tableEnv.fromDataStream(stream, $\u0026#34;name\u0026#34; as \u0026#34;myName\u0026#34;, $\u0026#34;age\u0026#34; as \u0026#34;myAge\u0026#34;) // convert DataStream into Table with projected field \u0026#34;name\u0026#34; (name-based) val table: Table = tableEnv.fromDataStream(stream, $\u0026#34;name\u0026#34;) // convert DataStream into Table with projected and renamed field \u0026#34;myName\u0026#34; (name-based) val table: Table = tableEnv.fromDataStream(stream, $\u0026#34;name\u0026#34; as \u0026#34;myName\u0026#34;) æŸ¥è¯¢ä¼˜åŒ–  Blink è®¡åˆ’å™¨  Apache Flink åˆ©ç”¨å¹¶æ‰©å±•äº† Apache Calcite æ¥æ‰§è¡Œå¤æ‚çš„æŸ¥è¯¢ä¼˜åŒ–ã€‚è¿™åŒ…æ‹¬ä¸€ç³»åˆ—åŸºäºè§„åˆ™å’Œæˆæœ¬çš„ä¼˜åŒ–ï¼Œå¦‚ï¼š\n åŸºäº Apache Calcite çš„å­æŸ¥è¯¢è£…é¥°ç›¸å…³ã€‚ æŠ•å½±ä¿®å‰ª åˆ†åŒºä¿®å‰ª è¿‡æ»¤å™¨ä¸‹æ¨ å­è®¡åˆ’é‡å¤å¤åˆ¶ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚ ç‰¹æ®Šå­æŸ¥è¯¢é‡å†™ï¼ŒåŒ…æ‹¬ä¸¤éƒ¨åˆ†ã€‚  å°† IN å’Œ EXISTS è½¬æ¢ä¸ºå·¦åŠè¿æ¥ã€‚ å°† NOT IN å’Œ NOT EXISTS è½¬æ¢ä¸ºå·¦åè¿æ¥ã€‚   å¯é€‰çš„ join é‡æ–°æ’åº  é€šè¿‡ table.optimizer.join-reorder-enabled å¯ç”¨ã€‚    æ³¨ï¼šIN/EXISTS/NOT IN/NOT EXISTS ç›®å‰åªæ”¯æŒå­æŸ¥è¯¢é‡å†™ä¸­çš„è¿è¯æ¡ä»¶ã€‚\nä¼˜åŒ–å™¨åšå‡ºæ™ºèƒ½å†³ç­–ï¼Œä¸ä»…åŸºäºè®¡åˆ’ï¼Œè¿˜åŸºäºæ•°æ®æºæä¾›çš„ä¸°å¯Œç»Ÿè®¡æ•°æ®ï¼Œä»¥åŠæ¯ä¸ªæ“ä½œç¬¦ï¼ˆå¦‚ ioã€cpuã€ç½‘ç»œå’Œå†…å­˜ï¼‰çš„ç»†ç²’åº¦æˆæœ¬ã€‚\né«˜çº§ç”¨æˆ·å¯ä»¥é€šè¿‡ CalciteConfig å¯¹è±¡æä¾›è‡ªå®šä¹‰ä¼˜åŒ–ï¼Œè¯¥å¯¹è±¡å¯ä»¥é€šè¿‡è°ƒç”¨ TableEnvironment#getConfig#setPlannerConfig æä¾›ç»™ table ç¯å¢ƒã€‚\nè§£é‡Šè¡¨ Table API æä¾›äº†ä¸€ç§æœºåˆ¶æ¥è§£é‡Šè®¡ç®— Table çš„é€»è¾‘å’Œä¼˜åŒ–æŸ¥è¯¢è®¡åˆ’ã€‚è¿™æ˜¯é€šè¿‡ Table.explain() æ–¹æ³•æˆ– StatementSet.explain() æ–¹æ³•å®Œæˆçš„ã€‚Table.explain() è¿”å›ä¸€ä¸ª Table çš„è®¡åˆ’ã€‚StatementSet.explain() è¿”å›å¤šä¸ªæ¥æ”¶å™¨çš„è®¡åˆ’ã€‚å®ƒè¿”å›ä¸€ä¸ªæè¿°ä¸‰ä¸ªè®¡åˆ’çš„å­—ç¬¦ä¸²ã€‚\n å…³ç³»æŸ¥è¯¢çš„æŠ½è±¡è¯­æ³•æ ‘ï¼Œå³æœªä¼˜åŒ–çš„é€»è¾‘æŸ¥è¯¢è®¡åˆ’ã€‚ ä¼˜åŒ–çš„é€»è¾‘æŸ¥è¯¢è®¡åˆ’ï¼Œä»¥åŠ ç‰©ç†æ‰§è¡Œè®¡åˆ’ã€‚  TableEnvironment.explainSql() å’Œ TableEnvironment.executeSql() æ”¯æŒæ‰§è¡Œ EXPLAIN è¯­å¥æ¥è·å–è®¡åˆ’ï¼Œè¯·å‚è€ƒ EXPLAIN é¡µé¢ã€‚\nä¸‹é¢çš„ä»£ç æ˜¾ç¤ºäº†ä¸€ä¸ªä½¿ç”¨ Table.explain() æ–¹æ³•ç»™å®š Table çš„ä¾‹å­å’Œç›¸åº”çš„è¾“å‡ºã€‚\nval env = StreamExecutionEnvironment.getExecutionEnvironment val tEnv = StreamTableEnvironment.create(env) val table1 = env.fromElements((1, \u0026#34;hello\u0026#34;)).toTable(tEnv, $\u0026#34;count\u0026#34;, $\u0026#34;word\u0026#34;) val table2 = env.fromElements((1, \u0026#34;hello\u0026#34;)).toTable(tEnv, $\u0026#34;count\u0026#34;, $\u0026#34;word\u0026#34;) val table = table1 .where($\u0026#34;word\u0026#34;.like(\u0026#34;F%\u0026#34;)) .unionAll(table2) println(table.explain()) ä¸Šè¿°ä¾‹å­çš„ç»“æœæ˜¯:\n== Abstract Syntax Tree == LogicalUnion(all=[true]) LogicalFilter(condition=[LIKE($1, _UTF-16LE'F%')]) FlinkLogicalDataStreamScan(id=[1], fields=[count, word]) FlinkLogicalDataStreamScan(id=[2], fields=[count, word]) == Optimized Logical Plan == DataStreamUnion(all=[true], union all=[count, word]) DataStreamCalc(select=[count, word], where=[LIKE(word, _UTF-16LE'F%')]) DataStreamScan(id=[1], fields=[count, word]) DataStreamScan(id=[2], fields=[count, word]) == Physical Execution Plan == Stage 1 : Data Source content : collect elements with CollectionInputFormat Stage 2 : Data Source content : collect elements with CollectionInputFormat Stage 3 : Operator content : from: (count, word) ship_strategy : REBALANCE Stage 4 : Operator content : where: (LIKE(word, _UTF-16LE'F%')), select: (count, word) ship_strategy : FORWARD Stage 5 : Operator content : from: (count, word) ship_strategy : REBALANCE ä¸‹é¢çš„ä»£ç æ˜¾ç¤ºäº†ä½¿ç”¨ StatementSet.explain() æ–¹æ³•è¿›è¡Œå¤šé‡æ¥æ”¶å™¨è®¡åˆ’çš„ä¸€ä¸ªä¾‹å­å’Œç›¸åº”çš„è¾“å‡ºã€‚\nval settings = EnvironmentSettings.newInstance.useBlinkPlanner.inStreamingMode.build val tEnv = TableEnvironment.create(settings) val schema = new Schema() .field(\u0026#34;count\u0026#34;, DataTypes.INT()) .field(\u0026#34;word\u0026#34;, DataTypes.STRING()) tEnv.connect(new FileSystem(\u0026#34;/source/path1\u0026#34;)) .withFormat(new Csv().deriveSchema()) .withSchema(schema) .createTemporaryTable(\u0026#34;MySource1\u0026#34;) tEnv.connect(new FileSystem(\u0026#34;/source/path2\u0026#34;)) .withFormat(new Csv().deriveSchema()) .withSchema(schema) .createTemporaryTable(\u0026#34;MySource2\u0026#34;) tEnv.connect(new FileSystem(\u0026#34;/sink/path1\u0026#34;)) .withFormat(new Csv().deriveSchema()) .withSchema(schema) .createTemporaryTable(\u0026#34;MySink1\u0026#34;) tEnv.connect(new FileSystem(\u0026#34;/sink/path2\u0026#34;)) .withFormat(new Csv().deriveSchema()) .withSchema(schema) .createTemporaryTable(\u0026#34;MySink2\u0026#34;) val stmtSet = tEnv.createStatementSet() val table1 = tEnv.from(\u0026#34;MySource1\u0026#34;).where($\u0026#34;word\u0026#34;.like(\u0026#34;F%\u0026#34;)) stmtSet.addInsert(\u0026#34;MySink1\u0026#34;, table1) val table2 = table1.unionAll(tEnv.from(\u0026#34;MySource2\u0026#34;)) stmtSet.addInsert(\u0026#34;MySink2\u0026#34;, table2) val explanation = stmtSet.explain() println(explanation) å¤šé‡æ¥æ”¶å™¨è®¡åˆ’çš„ç»“æœæ˜¯:\n== Abstract Syntax Tree == LogicalLegacySink(name=[MySink1], fields=[count, word]) +- LogicalFilter(condition=[LIKE($1, _UTF-16LE'F%')]) +- LogicalTableScan(table=[[default_catalog, default_database, MySource1, source: [CsvTableSource(read fields: count, word)]]]) LogicalLegacySink(name=[MySink2], fields=[count, word]) +- LogicalUnion(all=[true]) :- LogicalFilter(condition=[LIKE($1, _UTF-16LE'F%')]) : +- LogicalTableScan(table=[[default_catalog, default_database, MySource1, source: [CsvTableSource(read fields: count, word)]]]) +- LogicalTableScan(table=[[default_catalog, default_database, MySource2, source: [CsvTableSource(read fields: count, word)]]]) == Optimized Logical Plan == Calc(select=[count, word], where=[LIKE(word, _UTF-16LE'F%')], reuse_id=[1]) +- TableSourceScan(table=[[default_catalog, default_database, MySource1, source: [CsvTableSource(read fields: count, word)]]], fields=[count, word]) LegacySink(name=[MySink1], fields=[count, word]) +- Reused(reference_id=[1]) LegacySink(name=[MySink2], fields=[count, word]) +- Union(all=[true], union=[count, word]) :- Reused(reference_id=[1]) +- TableSourceScan(table=[[default_catalog, default_database, MySource2, source: [CsvTableSource(read fields: count, word)]]], fields=[count, word]) == Physical Execution Plan == Stage 1 : Data Source content : collect elements with CollectionInputFormat Stage 2 : Operator content : CsvTableSource(read fields: count, word) ship_strategy : REBALANCE Stage 3 : Operator content : SourceConversion(table:Buffer(default_catalog, default_database, MySource1, source: [CsvTableSource(read fields: count, word)]), fields:(count, word)) ship_strategy : FORWARD Stage 4 : Operator content : Calc(where: (word LIKE _UTF-16LE'F%'), select: (count, word)) ship_strategy : FORWARD Stage 5 : Operator content : SinkConversionToRow ship_strategy : FORWARD Stage 6 : Operator content : Map ship_strategy : FORWARD Stage 8 : Data Source content : collect elements with CollectionInputFormat Stage 9 : Operator content : CsvTableSource(read fields: count, word) ship_strategy : REBALANCE Stage 10 : Operator content : SourceConversion(table:Buffer(default_catalog, default_database, MySource2, source: [CsvTableSource(read fields: count, word)]), fields:(count, word)) ship_strategy : FORWARD Stage 12 : Operator content : SinkConversionToRow ship_strategy : FORWARD Stage 13 : Operator content : Map ship_strategy : FORWARD Stage 7 : Data Sink content : Sink: CsvTableSink(count, word) ship_strategy : FORWARD Stage 14 : Data Sink content : Sink: CsvTableSink(count, word) ship_strategy : FORWARD åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/common.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-concepts-and-common-api/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL"],"title":"æ¦‚å¿µå’Œé€šç”¨ API"},{"categories":["Flink"],"contents":"æ¨¡å—æµ‹è¯•ç‰ˆ æ¨¡å—å…è®¸ç”¨æˆ·æ‰©å±• Flink çš„å†…ç½®å¯¹è±¡ï¼Œæ¯”å¦‚å®šä¹‰ä¸€äº›è¡Œä¸ºç±»ä¼¼ Flink å†…ç½®å‡½æ•°çš„åŠŸèƒ½ã€‚å®ƒä»¬æ˜¯å¯æ’æ‹”çš„ï¼Œè™½ç„¶ Flink æä¾›äº†ä¸€äº›é¢„å»ºæ¨¡å—ï¼Œä½†ç”¨æˆ·å¯ä»¥ç¼–å†™è‡ªå·±çš„æ¨¡å—ã€‚\nä¾‹å¦‚ï¼Œç”¨æˆ·å¯ä»¥å®šä¹‰è‡ªå·±çš„åœ°ç†å‡½æ•°ï¼Œå¹¶å°†å…¶ä½œä¸ºå†…ç½®å‡½æ•°æ’å…¥ Flinkï¼Œä»¥ä¾¿åœ¨ Flink SQL å’Œ Table API ä¸­ä½¿ç”¨ã€‚åˆæ¯”å¦‚ï¼Œç”¨æˆ·å¯ä»¥åŠ è½½ä¸€ä¸ªç°æˆçš„ Hive æ¨¡å—ï¼Œå°† Hive å†…ç½®å‡½æ•°ä½œä¸º Flink å†…ç½®å‡½æ•°ä½¿ç”¨ã€‚\næ¨¡å—ç±»å‹ CoreModule CoreModule åŒ…å«äº† Flink çš„æ‰€æœ‰ç³»ç»Ÿï¼ˆå†…ç½®ï¼‰åŠŸèƒ½ï¼Œå¹¶ä¸”é»˜è®¤è¢«åŠ è½½ã€‚\nHiveModule HiveModule ä½œä¸º Flink çš„ç³»ç»Ÿå‡½æ•°ï¼Œå‘ SQL å’Œ Table API ç”¨æˆ·æä¾› Hive å†…ç½®å‡½æ•°ã€‚Flink çš„ Hive æ–‡æ¡£æä¾›äº†è®¾ç½®è¯¥æ¨¡å—çš„å…¨éƒ¨ç»†èŠ‚ã€‚\nç”¨æˆ·å®šä¹‰æ¨¡å— ç”¨æˆ·å¯ä»¥é€šè¿‡å®ç° Module æ¥å£æ¥å¼€å‘è‡ªå®šä¹‰æ¨¡å—ã€‚ä¸ºäº†åœ¨ SQL CLI ä¸­ä½¿ç”¨è‡ªå®šä¹‰æ¨¡å—ï¼Œç”¨æˆ·åº”è¯¥é€šè¿‡å®ç° ModuleFactory æ¥å£åŒæ—¶å¼€å‘ä¸€ä¸ªæ¨¡å—å’Œå®ƒå¯¹åº”çš„æ¨¡å—å·¥å‚ã€‚\næ¨¡å—å·¥å‚å®šä¹‰äº†ä¸€ç»„å±æ€§ï¼Œç”¨äºåœ¨ SQL CLI å¼•å¯¼æ—¶é…ç½®æ¨¡å—ã€‚å±æ€§è¢«ä¼ é€’ç»™å‘ç°æœåŠ¡ï¼ŒæœåŠ¡ä¼šå°è¯•å°†å±æ€§ä¸æ¨¡å—å·¥å‚è¿›è¡ŒåŒ¹é…ï¼Œå¹¶å®ä¾‹åŒ–ä¸€ä¸ªç›¸åº”çš„æ¨¡å—å®ä¾‹ã€‚\nå‘½åç©ºé—´å’Œè§£æé¡ºåº æ¨¡å—æä¾›çš„å¯¹è±¡è¢«è®¤ä¸ºæ˜¯ Flink ç³»ç»Ÿï¼ˆå†…ç½®ï¼‰å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼›å› æ­¤ï¼Œå®ƒä»¬æ²¡æœ‰ä»»ä½•å‘½åç©ºé—´ã€‚\nå½“æœ‰ä¸¤ä¸ªåŒåçš„å¯¹è±¡å­˜åœ¨äºä¸¤ä¸ªæ¨¡å—ä¸­æ—¶ï¼ŒFlink æ€»æ˜¯å°†å¯¹è±¡å¼•ç”¨è§£æä¸ºç¬¬ä¸€ä¸ªåŠ è½½æ¨¡å—ä¸­çš„å¯¹è±¡ã€‚\næ¨¡å— API è£…è½½å’Œå¸è½½æ¨¡å— ç”¨æˆ·å¯ä»¥åœ¨ç°æœ‰çš„ Flink ä¼šè¯ä¸­åŠ è½½å’Œå¸è½½æ¨¡å—ã€‚\n Scala  tableEnv.loadModule(\u0026#34;myModule\u0026#34;, new CustomModule()); tableEnv.unloadModule(\u0026#34;myModule\u0026#34;);  YAML  æ‰€æœ‰ä½¿ç”¨ YAML å®šä¹‰çš„æ¨¡å—éƒ½å¿…é¡»æä¾›ä¸€ä¸ª type å±æ€§æ¥æŒ‡å®šç±»å‹ã€‚ä»¥ä¸‹ç±»å‹æ˜¯å¼€ç®±å³ç”¨çš„ã€‚\n   Catalog Type Value     CoreModule core   HiveModule hive    modules:- name:coretype:core- name:myhivetype:hiveåˆ—å‡ºå¯ç”¨çš„æ¨¡å—  Scala  tableEnv.listModules();  SQL  Flink SQL\u0026gt; SHOW MODULES; åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/modules.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-modules/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL","Module"],"title":"æ¨¡å—"},{"categories":["Flink"],"contents":"æµçš„æ¦‚å¿µ Flink çš„ Table APIå’Œ SQL æ”¯æŒæ˜¯æ‰¹å¤„ç†å’Œæµå¤„ç†çš„ç»Ÿä¸€ APIã€‚è¿™æ„å‘³ç€Table API å’Œ SQL æŸ¥è¯¢å…·æœ‰ç›¸åŒçš„è¯­ä¹‰ï¼Œæ— è®ºå…¶è¾“å…¥æ˜¯æœ‰ç•Œæ‰¹å¤„ç†è¾“å…¥è¿˜æ˜¯æ— ç•Œæµè¾“å…¥ã€‚ç”±äºå…³ç³»ä»£æ•°å’Œ SQL æœ€åˆæ˜¯ä¸ºæ‰¹å¤„ç†è®¾è®¡çš„ï¼Œæ‰€ä»¥å¯¹æ— ç•Œæµè¾“å…¥çš„å…³ç³»æŸ¥è¯¢ä¸å¦‚å¯¹æœ‰ç•Œæ‰¹è¾“å…¥çš„å…³ç³»æŸ¥è¯¢å¥½ç†è§£ã€‚\nä¸‹é¢å‡ é¡µè§£é‡Šäº† Flink çš„å…³ç³» API åœ¨æµæ•°æ®ä¸Šçš„æ¦‚å¿µã€å®é™…é™åˆ¶å’Œç‰¹å®šæµçš„é…ç½®å‚æ•°ã€‚\nä¸‹ä¸€æ­¥è¯¥å¾€å“ªé‡Œèµ°ï¼Ÿ  åŠ¨æ€è¡¨ã€‚æè¿°åŠ¨æ€è¡¨çš„æ¦‚å¿µã€‚ æ—¶é—´å±æ€§ã€‚è§£é‡Šæ—¶é—´å±æ€§ï¼Œä»¥åŠåœ¨è¡¨APIå’ŒSQLä¸­å¦‚ä½•å¤„ç†æ—¶é—´å±æ€§ã€‚ è¿ç»­æŸ¥è¯¢ä¸­çš„è¿æ¥ã€‚è¿ç»­æŸ¥è¯¢ä¸­æ”¯æŒçš„ä¸åŒç±»å‹çš„è¿æ¥ã€‚ ä¸´æ—¶è¡¨ã€‚æè¿°ä¸´æ—¶è¡¨çš„æ¦‚å¿µã€‚ æŸ¥è¯¢é…ç½®ã€‚åˆ—å‡º Table API å’Œ SQL ç‰¹å®šé…ç½®é€‰é¡¹ã€‚  åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/streaming/\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-streaming-concepts/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL"],"title":"æµçš„æ¦‚å¿µ"},{"categories":["Flink"],"contents":"æµ‹è¯• æµ‹è¯•æ˜¯æ¯ä¸ªè½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­ä¸å¯ç¼ºå°‘çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤ Apache Flink æä¾›çš„å·¥å…·å¯ä»¥åœ¨æµ‹è¯•é‡‘å­—å¡”çš„å¤šä¸ªå±‚æ¬¡ä¸Šæµ‹è¯•ä½ çš„åº”ç”¨ç¨‹åºä»£ç ã€‚\næµ‹è¯•ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•° é€šå¸¸ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾ Flink åœ¨ç”¨æˆ·å®šä¹‰çš„å‡½æ•°ä¹‹å¤–äº§ç”Ÿæ­£ç¡®çš„ç»“æœã€‚å› æ­¤ï¼Œå»ºè®®å°½å¯èƒ½ç”¨å•å…ƒæµ‹è¯•æ¥æµ‹è¯•é‚£äº›åŒ…å«ä¸»è¦ä¸šåŠ¡é€»è¾‘çš„ç±»ã€‚\nå•å…ƒæµ‹è¯•æ— çŠ¶æ€ã€Timeless UDFsã€‚ ä¾‹å¦‚ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ä¸‹é¢çš„æ— çŠ¶æ€ MapFunctionã€‚\nclass IncrementMapFunction extends MapFunction[Long, Long] { override def map(record: Long): Long = { record + 1 } } é€šè¿‡ä¼ é€’åˆé€‚çš„å‚æ•°å’ŒéªŒè¯è¾“å‡ºï¼Œç”¨ä½ æœ€å–œæ¬¢çš„æµ‹è¯•æ¡†æ¶å¯¹è¿™æ ·çš„å‡½æ•°è¿›è¡Œå•å…ƒæµ‹è¯•æ˜¯éå¸¸å®¹æ˜“çš„ã€‚\nclass IncrementMapFunctionTest extends FlatSpec with Matchers { \u0026#34;IncrementMapFunction\u0026#34; should \u0026#34;increment values\u0026#34; in { // instantiate your function  val incrementer: IncrementMapFunction = new IncrementMapFunction() // call the methods that you have implemented  incremeter.map(2) should be (3) } } åŒæ ·ï¼Œä½¿ç”¨ org.apache.flink.util.Collector çš„ç”¨æˆ·å®šä¹‰å‡½æ•°ï¼ˆä¾‹å¦‚ FlatMapFunction æˆ– ProcessFunctionï¼‰å¯ä»¥é€šè¿‡æä¾›ä¸€ä¸ªæ¨¡æ‹Ÿå¯¹è±¡è€Œä¸æ˜¯çœŸå®çš„ Collector æ¥è½»æ¾æµ‹è¯•ã€‚ä¸€ä¸ªä¸ IncrementMapFunction åŠŸèƒ½ç›¸åŒçš„ FlatMapFunction å¯ä»¥è¿›è¡Œå¦‚ä¸‹å•å…ƒæµ‹è¯•ã€‚\nclass IncrementFlatMapFunctionTest extends FlatSpec with MockFactory { \u0026#34;IncrementFlatMapFunction\u0026#34; should \u0026#34;increment values\u0026#34; in { // instantiate your function  val incrementer : IncrementFlatMapFunction = new IncrementFlatMapFunction() val collector = mock[Collector[Integer]] //verify collector was called with the right output  (collector.collect _).expects(3) // call the methods that you have implemented  flattenFunction.flatMap(2, collector) } } å•å…ƒæµ‹è¯• æœ‰çŠ¶æ€æˆ–åŠæ—¶çš„ UDF å’Œè‡ªå®šä¹‰æ“ä½œç¬¦ æµ‹è¯•ä¸€ä¸ªç”¨æˆ·å®šä¹‰å‡½æ•°çš„åŠŸèƒ½æ˜¯æ¯”è¾ƒå›°éš¾çš„ï¼Œå› ä¸ºå®ƒæ¶‰åŠåˆ°æµ‹è¯•ç”¨æˆ·ä»£ç å’Œ Flink è¿è¡Œæ—¶ä¹‹é—´çš„äº¤äº’ã€‚ä¸ºæ­¤ï¼ŒFlink æä¾›äº†ä¸€ä¸ªæ‰€è°“çš„æµ‹è¯•çº¿æŸçš„é›†åˆï¼Œå®ƒå¯ä»¥ç”¨æ¥æµ‹è¯•è¿™æ ·çš„ç”¨æˆ·å®šä¹‰å‡½æ•°ä»¥åŠè‡ªå®šä¹‰æ“ä½œç¬¦ã€‚\n OneInputStreamOperatorTestHarness(ç”¨äº DataStreams ä¸Šçš„æ“ä½œç¬¦) KeyedOneInputStreamOperatorTestHarness(ç”¨äº KeyedStreams ä¸Šçš„æ“ä½œè€…) TwoInputStreamOperatorTestHarness (é€‚ç”¨äºä¸¤ä¸ª DataStreams çš„ ConnectedStreams æ“ä½œè€…) KeyedTwoInputStreamOperatorTestHarness (ç”¨äºä¸¤ä¸ª KeyedStream çš„ ConnectedStreams ä¸Šçš„æ“ä½œå‘˜)  ä¸ºäº†ä½¿ç”¨æµ‹è¯•å¥—ä»¶ï¼Œéœ€è¦ä¸€ç»„é¢å¤–çš„ä¾èµ–å…³ç³»ï¼ˆæµ‹è¯•èŒƒå›´ï¼‰ã€‚\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.flink\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flink-test-utils_2.11\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.11.0\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.flink\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flink-runtime_2.11\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.11.0\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;classifier\u0026gt;tests\u0026lt;/classifier\u0026gt; \u0026lt;/dependency\u0026gt; \u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.flink\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flink-streaming-java_2.11\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.11.0\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;test\u0026lt;/scope\u0026gt; \u0026lt;classifier\u0026gt;tests\u0026lt;/classifier\u0026gt; \u0026lt;/dependency\u0026gt; ç°åœ¨ï¼Œæµ‹è¯•çº¿æŸå¯ä»¥ç”¨æ¥å°†è®°å½•å’Œæ°´å°æ¨é€åˆ°ä½ çš„ç”¨æˆ·å®šä¹‰å‡½æ•°æˆ–è‡ªå®šä¹‰è¿ç®—ç¬¦ä¸­ï¼Œæ§åˆ¶å¤„ç†æ—¶é—´ï¼Œæœ€åå¯¹è¿ç®—ç¬¦çš„è¾“å‡ºè¿›è¡Œæ–­è¨€ï¼ˆåŒ…æ‹¬ä¾§è¾“å‡ºï¼‰ã€‚\nclass StatefulFlatMapFunctionTest extends FlatSpec with Matchers with BeforeAndAfter { private var testHarness: OneInputStreamOperatorTestHarness[Long, Long] = null private var statefulFlatMap: StatefulFlatMapFunction = null before { //instantiate user-defined function  statefulFlatMap = new StatefulFlatMap // wrap user defined function into a the corresponding operator  testHarness = new OneInputStreamOperatorTestHarness[Long, Long](new StreamFlatMap(statefulFlatMap)) // optionally configured the execution environment  testHarness.getExecutionConfig().setAutoWatermarkInterval(50); // open the test harness (will also call open() on RichFunctions)  testHarness.open(); } \u0026#34;StatefulFlatMap\u0026#34; should \u0026#34;do some fancy stuff with timers and state\u0026#34; in { //push (timestamped) elements into the operator (and hence user defined function)  testHarness.processElement(2, 100); //trigger event time timers by advancing the event time of the operator with a watermark  testHarness.processWatermark(100); //trigger proccesign time timers by advancing the processing time of the operator directly  testHarness.setProcessingTime(100); //retrieve list of emitted records for assertions  testHarness.getOutput should contain (3) //retrieve list of records emitted to a specific side output for assertions (ProcessFunction only)  //testHarness.getSideOutput(new OutputTag[Int](\u0026#34;invalidRecords\u0026#34;)) should have size 0  } } KeyedOneInputStreamOperatorTestHarness å’Œ KeyedTwoInputStreamOperatorTestHarness æ˜¯é€šè¿‡é¢å¤–æä¾›ä¸€ä¸ªåŒ…æ‹¬é”®ç±»çš„ TypeInformation çš„ KeySelector æ¥å®ä¾‹åŒ–çš„ã€‚\nclass StatefulFlatMapTest extends FlatSpec with Matchers with BeforeAndAfter { private var testHarness: OneInputStreamOperatorTestHarness[String, Long, Long] = null private var statefulFlatMapFunction: FlattenFunction = null before { //instantiate user-defined function  statefulFlatMapFunction = new StateFulFlatMap // wrap user defined function into a the corresponding operator  testHarness = new KeyedOneInputStreamOperatorTestHarness(new StreamFlatMap(statefulFlatMapFunction),new MyStringKeySelector(), Types.STRING()) // open the test harness (will also call open() on RichFunctions)  testHarness.open(); } //tests  } åœ¨ Flink ä»£ç åº“ä¸­è¿˜å¯ä»¥æ‰¾åˆ°æ›´å¤šä½¿ç”¨è¿™äº›æµ‹è¯•çº¿æŸçš„ä¾‹å­ï¼Œä¾‹å¦‚ã€‚\n org.apache.flink.streaming.runtime.operators.windowing.WindowOperatorTest æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œç”¨äºæµ‹è¯•ä¾èµ–äºå¤„ç†æˆ–äº‹ä»¶æ—¶é—´çš„æ“ä½œå‘˜å’Œç”¨æˆ·å®šä¹‰çš„å‡½æ•°ã€‚ org.apache.flink.streaming.api.function.sink.filesystem.LocalStreamingFileSinkTest å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ AbstractStreamOperatorTestHarness æµ‹è¯•è‡ªå®šä¹‰çš„ sinkã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒä½¿ç”¨ AbstractStreamOperatorTestHarness.snapshot å’Œ AbstractStreamOperatorTestHarness.initializeState æ¥æµ‹è¯•å®ƒä¸ Flink çš„æ£€æŸ¥ç‚¹æœºåˆ¶çš„äº¤äº’ã€‚  æ³¨æ„: AbstractStreamOperatorTestHarness å’Œå®ƒçš„æ´¾ç”Ÿç±»ç›®å‰ä¸æ˜¯å…¬å…± API çš„ä¸€éƒ¨åˆ†ï¼Œå¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚\nå•å…ƒæµ‹è¯• ProcessFunction é‰´äºå…¶é‡è¦æ€§ï¼Œé™¤äº†ä¹‹å‰çš„æµ‹è¯•çº¿æŸå¯ä»¥ç›´æ¥ç”¨äºæµ‹è¯• ProcessFunction å¤–ï¼ŒFlink è¿˜æä¾›äº†ä¸€ä¸ªåä¸º ProcessFunctionTestHarnesses çš„æµ‹è¯•çº¿æŸå·¥å‚ï¼Œå¯ä»¥æ›´æ–¹ä¾¿åœ°è¿›è¡Œæµ‹è¯•çº¿æŸå®ä¾‹åŒ–ã€‚è€ƒè™‘åˆ°è¿™ä¸ªä¾‹å­ã€‚\næ³¨æ„: è¦ä½¿ç”¨è¿™ä¸ªæµ‹è¯•çº¿æŸï¼Œä½ è¿˜éœ€è¦å¼•å…¥ä¸Šä¸€èŠ‚ä¸­æåˆ°çš„ä¾èµ–å…³ç³»ã€‚\nclass PassThroughProcessFunction extends ProcessFunction[Integer, Integer] { @throws[Exception] override def processElement(value: Integer, ctx: ProcessFunction[Integer, Integer]#Context, out: Collector[Integer]): Unit = { out.collect(value) } } ä½¿ç”¨ ProcessFunctionTestHarnesses å¯¹è¿™æ ·çš„å‡½æ•°è¿›è¡Œå•å…ƒæµ‹è¯•æ˜¯éå¸¸å®¹æ˜“çš„ï¼Œé€šè¿‡ä¼ é€’åˆé€‚çš„å‚æ•°å¹¶éªŒè¯è¾“å‡ºã€‚\nclass PassThroughProcessFunctionTest extends FlatSpec with Matchers { \u0026#34;PassThroughProcessFunction\u0026#34; should \u0026#34;forward values\u0026#34; in { //instantiate user-defined function  val processFunction = new PassThroughProcessFunction // wrap user defined function into a the corresponding operator  val harness = ProcessFunctionTestHarnesses.forProcessFunction(processFunction) //push (timestamped) elements into the operator (and hence user defined function)  harness.processElement(1, 10) //retrieve list of emitted records for assertions  harness.extractOutputValues() should contain (1) } } å…³äºå¦‚ä½•ä½¿ç”¨ ProcessFunctionTestHarnesses æ¥æµ‹è¯• ProcessFunction çš„ä¸åŒé£å‘³ï¼Œå¦‚ KeyedProcessFunctionã€KeyedCoProcessFunctionã€BroadcastProcessFunction ç­‰çš„æ›´å¤šä¾‹å­ï¼Œé¼“åŠ±ç”¨æˆ·æŸ¥çœ‹ ProcessFunctionTestHarnessesTestã€‚\næµ‹è¯• Flink ä½œä¸š JUnit è§„åˆ™ MiniClusterWithClientResource Apache Flink æä¾›äº†ä¸€ä¸ªåä¸º MiniClusterWithClientResource çš„ JUnit è§„åˆ™ï¼Œç”¨äºé’ˆå¯¹æœ¬åœ°çš„ã€åµŒå…¥å¼çš„è¿·ä½ é›†ç¾¤æµ‹è¯•å®Œæ•´çš„ä½œä¸šï¼Œåä¸º MiniClusterWithClientResourceã€‚\nè¦ä½¿ç”¨ MiniClusterWithClientResourceï¼Œéœ€è¦ä¸€ä¸ªé¢å¤–çš„ä¾èµ–ï¼ˆæµ‹è¯•èŒƒå›´ï¼‰ã€‚\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.flink\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flink-test-utils_2.11\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.11.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; è®©æˆ‘ä»¬ä»¥å‰é¢å‡ èŠ‚ä¸­åŒæ ·ç®€å•çš„ MapFunction ä¸ºä¾‹ã€‚\nclass IncrementMapFunction extends MapFunction[Long, Long] { override def map(record: Long): Long = { record + 1 } } ç°åœ¨å¯ä»¥åœ¨æœ¬åœ° Flink é›†ç¾¤ä¸­æµ‹è¯•ä½¿ç”¨è¯¥ MapFunction çš„ç®€å•ç®¡é“ï¼Œå…·ä½“å¦‚ä¸‹ã€‚\nclass StreamingJobIntegrationTest extends FlatSpec with Matchers with BeforeAndAfter { val flinkCluster = new MiniClusterWithClientResource(new MiniClusterResourceConfiguration.Builder() .setNumberSlotsPerTaskManager(1) .setNumberTaskManagers(1) .build) before { flinkCluster.before() } after { flinkCluster.after() } \u0026#34;IncrementFlatMapFunction pipeline\u0026#34; should \u0026#34;incrementValues\u0026#34; in { val env = StreamExecutionEnvironment.getExecutionEnvironment // configure your test environment  env.setParallelism(2) // values are collected in a static variable  CollectSink.values.clear() // create a stream of custom elements and apply transformations  env.fromElements(1, 21, 22) .map(new IncrementMapFunction()) .addSink(new CollectSink()) // execute  env.execute() // verify your results  CollectSink.values should contain allOf (2, 22, 23) } } // create a testing sink class CollectSink extends SinkFunction[Long] { override def invoke(value: Long): Unit = { synchronized { CollectSink.values.add(value) } } } object CollectSink { // must be static  val values: util.List[Long] = new util.ArrayList() } å…³äº MiniClusterWithClientResource çš„é›†æˆæµ‹è¯•çš„å‡ ç‚¹è¯´æ˜ã€‚\n  ä¸ºäº†ä¸æŠŠä½ çš„æ•´ä¸ªæµæ°´çº¿ä»£ç ä»ç”Ÿäº§ä¸­å¤åˆ¶åˆ°æµ‹è¯•ä¸­ï¼Œè¯·åœ¨ä½ çš„ç”Ÿäº§ä»£ç ä¸­ä½¿æºå’Œæ±‡å¯æ’æ‹”ï¼Œå¹¶åœ¨ä½ çš„æµ‹è¯•ä¸­æ³¨å…¥ç‰¹æ®Šçš„æµ‹è¯•æºå’Œæµ‹è¯•æ±‡ã€‚\n  è¿™é‡Œä½¿ç”¨äº† CollectSink ä¸­çš„é™æ€å˜é‡ï¼Œå› ä¸º Flink åœ¨å°†æ‰€æœ‰æ“ä½œç¬¦åˆ†å¸ƒåœ¨é›†ç¾¤ä¸­ä¹‹å‰ï¼Œä¼šå°†å®ƒä»¬åºåˆ—åŒ–ã€‚é€šè¿‡é™æ€å˜é‡ä¸æœ¬åœ° Flink è¿·ä½ é›†ç¾¤å®ä¾‹åŒ–çš„è¿ç®—ç¬¦è¿›è¡Œé€šä¿¡æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„ä¸€ç§æ–¹æ³•ã€‚å¦å¤–ï¼Œä½ å¯ä»¥å°†æ•°æ®å†™åˆ°ä¸ä½ çš„æµ‹è¯•æ±‡çš„ä¸´æ—¶ç›®å½•ä¸­çš„æ–‡ä»¶ä¸­ã€‚\n  å¦‚æœä½ çš„ä½œä¸šä½¿ç”¨äº‹ä»¶æ—¶é—´è®¡æ—¶å™¨ï¼Œä½ å¯ä»¥å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„å¹¶è¡Œæºå‡½æ•°æ¥å‘å°„æ°´å°ã€‚\n  å»ºè®®å§‹ç»ˆä»¥å¹¶è¡Œåº¦ \u0026gt;1 çš„æ–¹å¼åœ¨æœ¬åœ°æµ‹è¯•ä½ çš„æµæ°´çº¿ï¼Œä»¥è¯†åˆ«åªæœ‰å¹¶è¡Œæ‰§è¡Œçš„æµæ°´çº¿æ‰ä¼šå‡ºç°çš„é”™è¯¯ã€‚\n  ä¼˜å…ˆé€‰æ‹© @ClassRule è€Œä¸æ˜¯ @Ruleï¼Œè¿™æ ·å¤šä¸ªæµ‹è¯•å¯ä»¥å…±äº«åŒä¸€ä¸ª Flink é›†ç¾¤ã€‚è¿™æ ·åšå¯ä»¥èŠ‚çœå¤§é‡çš„æ—¶é—´ï¼Œå› ä¸º Flink é›†ç¾¤çš„å¯åŠ¨å’Œå…³é—­é€šå¸¸ä¼šæ”¯é…å®é™…æµ‹è¯•çš„æ‰§è¡Œæ—¶é—´ã€‚\n  å¦‚æœä½ çš„ç®¡é“åŒ…å«è‡ªå®šä¹‰çŠ¶æ€å¤„ç†ï¼Œä½ å¯ä»¥é€šè¿‡å¯ç”¨æ£€æŸ¥ç‚¹å¹¶åœ¨è¿·ä½ é›†ç¾¤å†…é‡æ–°å¯åŠ¨ä½œä¸šæ¥æµ‹è¯•å…¶æ­£ç¡®æ€§ã€‚ä¸ºæ­¤ï¼Œä½ éœ€è¦é€šè¿‡ä»ä½ çš„ç®¡é“ä¸­çš„ï¼ˆä»…æµ‹è¯•çš„ï¼‰ç”¨æˆ·å®šä¹‰å‡½æ•°ä¸­æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸æ¥è§¦å‘å¤±è´¥ã€‚\n  åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/stream/testing.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-testing/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataStream API","testing"],"title":"æµ‹è¯•"},{"categories":["Flink"],"contents":"çŠ¶æ€åç«¯ Flink æä¾›äº†ä¸åŒçš„çŠ¶æ€åç«¯ï¼ŒæŒ‡å®šçŠ¶æ€çš„å­˜å‚¨æ–¹å¼å’Œä½ç½®ã€‚\nçŠ¶æ€å¯ä»¥ä½äº Java çš„å †ä¸Šæˆ–ç¦»å †(off-heap)ã€‚æ ¹æ®ä½ çš„çŠ¶æ€åç«¯ï¼ŒFlink è¿˜å¯ä»¥ä¸ºåº”ç”¨ç¨‹åºç®¡ç†çŠ¶æ€ï¼Œè¿™æ„å‘³ç€ Flink å¤„ç†å†…å­˜ç®¡ç†ï¼ˆå¿…è¦æ—¶å¯èƒ½ä¼šæº¢å‡ºåˆ°ç£ç›˜ï¼‰ï¼Œä»¥å…è®¸åº”ç”¨ç¨‹åºæŒæœ‰éå¸¸å¤§çš„çŠ¶æ€ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œé…ç½®æ–‡ä»¶ flink-conf.yaml å†³å®šäº†æ‰€æœ‰ Flink ä½œä¸š(job)çš„çŠ¶æ€åç«¯ã€‚\nç„¶è€Œï¼Œé»˜è®¤çš„çŠ¶æ€åç«¯å¯ä»¥åœ¨æ¯ä¸ªä½œä¸š(per-job)çš„åŸºç¡€ä¸Šè¢«é‡å†™ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚\næœ‰å…³å¯ç”¨çš„çŠ¶æ€åç«¯ã€å…¶ä¼˜åŠ¿ã€é™åˆ¶å’Œé…ç½®å‚æ•°çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§éƒ¨ç½²ä¸æ“ä½œä¸­çš„ç›¸åº”ç« èŠ‚ã€‚\nval env = StreamExecutionEnvironment.getExecutionEnvironment() env.setStateBackend(...) çŠ¶æ€åç«¯: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/stream/state/state_backends.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-21-state-backends/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataStream API"],"title":"çŠ¶æ€åç«¯"},{"categories":["Flink"],"contents":"Apache Flink æµåª’ä½“åº”ç”¨é€šå¸¸è¢«è®¾è®¡ä¸ºæ— é™æœŸæˆ–é•¿æ—¶é—´è¿è¡Œã€‚ä¸æ‰€æœ‰é•¿æœŸè¿è¡Œçš„æœåŠ¡ä¸€æ ·ï¼Œåº”ç”¨ç¨‹åºéœ€è¦æ›´æ–°ä»¥é€‚åº”ä¸æ–­å˜åŒ–çš„éœ€æ±‚ã€‚è¿™å¯¹äºåº”ç”¨ç¨‹åºæ‰€é’ˆå¯¹çš„æ•°æ®æ¨¡å¼(data schema)ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œå®ƒä»¬ä¼šéšç€åº”ç”¨ç¨‹åºçš„å‘å±•è€Œå‘å±•ã€‚\næœ¬é¡µæä¾›äº†å…³äºå¦‚ä½•æ¼”è¿›çŠ¶æ€ç±»å‹çš„æ•°æ®æ¨¡å¼(data schema)çš„æ¦‚è¿°ã€‚å½“å‰çš„é™åˆ¶åœ¨ä¸åŒçš„ç±»å‹å’ŒçŠ¶æ€ç»“æ„ï¼ˆValueStateã€ListState ç­‰ï¼‰ä¸­æœ‰æ‰€ä¸åŒã€‚\nè¯·æ³¨æ„ï¼Œæœ¬é¡µé¢ä¸Šçš„ä¿¡æ¯ä»…åœ¨æ‚¨ä½¿ç”¨ç”± Flink è‡ªå·±çš„ç±»å‹åºåˆ—åŒ–æ¡†æ¶ç”Ÿæˆçš„çŠ¶æ€åºåˆ—åŒ–å™¨æ—¶ç›¸å…³ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å£°æ˜ä½ çš„çŠ¶æ€æ—¶ï¼Œæ‰€æä¾›çš„çŠ¶æ€æè¿°ç¬¦å¹¶æ²¡æœ‰è¢«é…ç½®ä¸ºä½¿ç”¨ç‰¹å®šçš„ TypeSerializer æˆ– TypeInformationï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒFlink ä¼šæ¨å¯¼å‡ºçŠ¶æ€ç±»å‹çš„ä¿¡æ¯ã€‚\nListStateDescriptor\u0026lt;MyPojoType\u0026gt; descriptor = new ListStateDescriptor\u0026lt;\u0026gt;( \u0026#34;state-name\u0026#34;, MyPojoType.class); checkpointedState = getRuntimeContext().getListState(descriptor); åœ¨åº•å±‚ï¼ŒçŠ¶æ€çš„æ¨¡å¼(schema)æ˜¯å¦å¯ä»¥è¢«æ¼”åŒ–å–å†³äºç”¨äºè¯»å–/å†™å…¥æŒä¹…åŒ–çŠ¶æ€å­—èŠ‚çš„åºåˆ—åŒ–å™¨ã€‚ç®€å•åœ°è¯´ï¼Œåªæœ‰å½“å®ƒçš„åºåˆ—åŒ–å™¨æ­£ç¡®åœ°æ”¯æŒæ—¶ï¼Œä¸€ä¸ªæ³¨å†ŒçŠ¶æ€çš„æ¨¡å¼æ‰èƒ½è¢«æ¼”åŒ–ã€‚è¿™æ˜¯ç”± Flink çš„ç±»å‹åºåˆ—åŒ–æ¡†æ¶ç”Ÿæˆçš„åºåˆ—åŒ–å™¨é€æ˜åœ°å¤„ç†çš„ï¼ˆå½“å‰çš„æ”¯æŒèŒƒå›´åˆ—åœ¨ä¸‹é¢ï¼‰ã€‚\nå¦‚æœä½ æ‰“ç®—ä¸ºä½ çš„çŠ¶æ€ç±»å‹å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„ TypeSerializerï¼Œå¹¶æƒ³äº†è§£å¦‚ä½•å®ç°åºåˆ—åŒ–å™¨ä»¥æ”¯æŒçŠ¶æ€æ¨¡å¼æ¼”åŒ–ï¼Œè¯·å‚è€ƒè‡ªå®šä¹‰çŠ¶æ€åºåˆ—åŒ–ã€‚é‚£é‡Œçš„æ–‡æ¡£è¿˜æ¶µç›–äº†å…³äºçŠ¶æ€åºåˆ—åŒ–å™¨å’Œ Flink çš„çŠ¶æ€åç«¯ä¹‹é—´çš„ç›¸äº’ä½œç”¨çš„å¿…è¦å†…éƒ¨ç»†èŠ‚ï¼Œä»¥æ”¯æŒçŠ¶æ€æ¨¡å¼(state schema)æ¼”åŒ–ã€‚\nçŠ¶æ€æ¨¡å¼çš„æ¼”åŒ– è¦æ¼”åŒ–ç»™å®šçŠ¶æ€ç±»å‹çš„æ¨¡å¼ï¼Œæ‚¨éœ€è¦é‡‡å–ä»¥ä¸‹æ­¥éª¤ã€‚\n ä¿å­˜ä½ çš„ Flink æµä½œä¸š(job)çš„ä¿å­˜ç‚¹ã€‚ æ›´æ–°æ‚¨çš„åº”ç”¨ç¨‹åºä¸­çš„çŠ¶æ€ç±»å‹ï¼ˆä¾‹å¦‚ï¼Œä¿®æ”¹æ‚¨çš„ Avro ç±»å‹æ¨¡å¼ï¼‰ã€‚ ä»ä¿å­˜ç‚¹æ¢å¤ä½œä¸š(job)ã€‚å½“ç¬¬ä¸€æ¬¡è®¿é—®çŠ¶æ€æ—¶ï¼ŒFlink å°†è¯„ä¼°æ˜¯å¦å·²ç»æ”¹å˜äº†çŠ¶æ€çš„æ¨¡å¼(schema)ï¼Œå¹¶åœ¨å¿…è¦æ—¶è¿ç§»çŠ¶æ€æ¨¡å¼ã€‚  è¿ç§»çŠ¶æ€ä»¥é€‚åº”å·²æ›´æ”¹çš„æ¨¡å¼çš„è¿‡ç¨‹æ˜¯è‡ªåŠ¨å‘ç”Ÿçš„ï¼Œå¹¶ä¸”å¯¹æ¯ä¸ªçŠ¶æ€éƒ½æ˜¯ç‹¬ç«‹çš„ã€‚è¿™ä¸ªè¿‡ç¨‹ç”± Flink å†…éƒ¨æ‰§è¡Œï¼Œé¦–å…ˆæ£€æŸ¥çŠ¶æ€çš„æ–°åºåˆ—å™¨æ˜¯å¦ä¸ä¹‹å‰çš„åºåˆ—å™¨æœ‰ä¸åŒçš„åºåˆ—åŒ–æ¨¡å¼ï¼Œå¦‚æœæœ‰ï¼Œåˆ™ç”¨ä¹‹å‰çš„åºåˆ—å™¨å°†çŠ¶æ€è¯»åˆ°å¯¹è±¡ï¼Œå†ç”¨æ–°çš„åºåˆ—å™¨å†™å›å­—èŠ‚ã€‚\nå…³äºè¿ç§»è¿‡ç¨‹çš„è¿›ä¸€æ­¥ç»†èŠ‚ä¸åœ¨æœ¬æ–‡æ¡£çš„èŒƒå›´å†…ï¼Œè¯·å‚è€ƒè¿™é‡Œã€‚\næ”¯æŒçš„æ¨¡å¼æ¼”åŒ–æ•°æ®ç±»å‹ ç›®å‰ï¼Œæ¨¡å¼æ¼”åŒ–åªæ”¯æŒ POJO å’Œ Avro ç±»å‹ã€‚å› æ­¤ï¼Œå¦‚æœä½ å…³å¿ƒçŠ¶æ€çš„æ¨¡å¼æ¼”åŒ–ï¼Œç›®å‰å»ºè®®å§‹ç»ˆä½¿ç”¨ POJO æˆ– Avro ä½œä¸ºçŠ¶æ€æ•°æ®ç±»å‹ã€‚\næœ‰è®¡åˆ’æ‰©å±•å¯¹æ›´å¤šå¤åˆç±»å‹çš„æ”¯æŒï¼›æ›´å¤šç»†èŠ‚è¯·å‚è€ƒ FLINK-10896ã€‚\nPOJO ç±»å‹ Flink æ”¯æŒ POJO ç±»å‹çš„æ¼”åŒ–æ¨¡å¼ï¼ŒåŸºäºä»¥ä¸‹ä¸€ç»„è§„åˆ™ã€‚\n å­—æ®µå¯ä»¥è¢«åˆ é™¤ã€‚ä¸€æ—¦è¢«åˆ é™¤ï¼Œåœ¨æœªæ¥çš„æ£€æŸ¥ç‚¹å’Œä¿å­˜ç‚¹ä¸­ï¼Œè¢«åˆ é™¤å­—æ®µçš„ä¹‹å‰å€¼å°†è¢«ä¸¢å¼ƒã€‚ å¯ä»¥æ·»åŠ æ–°å­—æ®µã€‚æ–°å­—æ®µå°†è¢«åˆå§‹åŒ–ä¸ºå…¶ç±»å‹çš„é»˜è®¤å€¼ï¼Œæ­£å¦‚ Java æ‰€å®šä¹‰çš„é‚£æ ·ã€‚ å·²å£°æ˜çš„å­—æ®µç±»å‹ä¸èƒ½æ”¹å˜ã€‚ POJO ç±»å‹çš„ç±»åä¸èƒ½æ”¹å˜ï¼ŒåŒ…æ‹¬ç±»çš„å‘½åç©ºé—´ã€‚  è¯·æ³¨æ„ï¼ŒPOJO ç±»å‹çŠ¶æ€çš„æ¨¡å¼åªèƒ½åœ¨ Flink ç‰ˆæœ¬å¤§äº 1.8.0 çš„æƒ…å†µä¸‹ï¼Œä»ä»¥å‰çš„ä¿å­˜ç‚¹æ¢å¤æ—¶æ‰èƒ½è¿›åŒ–ã€‚å½“ä½¿ç”¨æ¯” 1.8.0 æ›´è€çš„ Flink ç‰ˆæœ¬è¿›è¡Œè¿˜åŸæ—¶ï¼Œæ¨¡å¼ä¸èƒ½è¢«æ”¹å˜ã€‚\nAvro ç±»å‹ Flink å®Œå…¨æ”¯æŒ Avro ç±»å‹çŠ¶æ€çš„æ¼”å˜æ¨¡å¼ï¼Œåªè¦æ¨¡å¼å˜åŒ–è¢« Avro çš„æ¨¡å¼è§£æè§„åˆ™è®¤ä¸ºæ˜¯å…¼å®¹çš„ã€‚\nä¸€ä¸ªé™åˆ¶æ˜¯ä½œä¸ºçŠ¶æ€ç±»å‹ä½¿ç”¨çš„ Avro ç”Ÿæˆçš„ç±»åœ¨æ¢å¤ä½œä¸šæ—¶ä¸èƒ½è¢«é‡æ–°å®šä½æˆ–å…·æœ‰ä¸åŒçš„å‘½åç©ºé—´ã€‚\næ³¨æ„: ä¸æ”¯æŒé”®çš„æ¨¡å¼æ¼”å˜ã€‚\nä¸¾ä¸ªä¾‹å­ã€‚RocksDB çŠ¶æ€åç«¯ä¾èµ–äºäºŒè¿›åˆ¶å¯¹è±¡çš„æ ‡è¯†ï¼Œè€Œä¸æ˜¯ hashCode æ–¹æ³•å®ç°ã€‚å¯¹ keys å¯¹è±¡ç»“æ„çš„ä»»ä½•æ”¹å˜éƒ½å¯èƒ½å¯¼è‡´éç¡®å®šæ€§è¡Œä¸ºã€‚\næ³¨æ„: Kryo ä¸èƒ½ç”¨äºæ¨¡å¼æ¼”åŒ–ã€‚\nå½“ä½¿ç”¨ Kryo æ—¶ï¼Œæ¡†æ¶æ²¡æœ‰å¯èƒ½éªŒè¯æ˜¯å¦æœ‰ä»»ä½•ä¸å…¼å®¹çš„å˜åŒ–ã€‚\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/stream/state/schema_evolution.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-state-schema-evolution/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataStream API"],"title":"çŠ¶æ€æ¨¡å¼çš„æ¼”å˜"},{"categories":["Flink"],"contents":"æœ¬é¡µè§£é‡Šäº†å¦‚ä½•ä½¿ç”¨ Flink çš„ API ä¸å¤–éƒ¨æ•°æ®å­˜å‚¨è¿›è¡Œå¼‚æ­¥ I/Oã€‚å¯¹äºä¸ç†Ÿæ‚‰å¼‚æ­¥æˆ–äº‹ä»¶é©±åŠ¨ç¼–ç¨‹çš„ç”¨æˆ·æ¥è¯´ï¼Œä¸€ç¯‡å…³äº Futures å’Œäº‹ä»¶é©±åŠ¨ç¼–ç¨‹çš„æ–‡ç« å¯èƒ½æ˜¯æœ‰ç”¨çš„å‡†å¤‡ã€‚\næ³¨ï¼šå…³äºå¼‚æ­¥ I/O å®ç”¨ç¨‹åºçš„è®¾è®¡å’Œå®ç°çš„ç»†èŠ‚å¯ä»¥åœ¨ææ¡ˆå’Œè®¾è®¡æ–‡ä»¶ FLIP-12ï¼šå¼‚æ­¥I/Oè®¾è®¡å’Œå®ç°ä¸­æ‰¾åˆ°ã€‚\nå¼‚æ­¥I/Oæ“ä½œçš„å¿…è¦æ€§ åœ¨ä¸å¤–éƒ¨ç³»ç»Ÿäº¤äº’æ—¶ï¼ˆä¾‹å¦‚ç”¨å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æ•°æ®æ¥ä¸°å¯Œæµäº‹ä»¶æ—¶ï¼‰ï¼Œéœ€è¦æ³¨æ„ä¸å¤–éƒ¨ç³»ç»Ÿçš„é€šä¿¡å»¶è¿Ÿä¸ä¼šä¸»å¯¼æµåº”ç”¨çš„æ€»å·¥ä½œã€‚\nå¥ˆä½•è®¿é—®å¤–éƒ¨æ•°æ®åº“ä¸­çš„æ•°æ®ï¼Œä¾‹å¦‚åœ¨ MapFunction ä¸­ï¼Œé€šå¸¸æ„å‘³ç€åŒæ­¥äº¤äº’ã€‚ä¸€ä¸ªè¯·æ±‚è¢«å‘é€åˆ°æ•°æ®åº“ï¼ŒMapFunction ç­‰å¾…ç›´åˆ°æ”¶åˆ°å“åº”ã€‚åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œè¿™ç§ç­‰å¾…å æ®äº†å‡½æ•°çš„ç»å¤§éƒ¨åˆ†æ—¶é—´ã€‚\nä¸æ•°æ®åº“çš„å¼‚æ­¥äº¤äº’æ„å‘³ç€ä¸€ä¸ªå¹¶è¡Œå‡½æ•°å®ä¾‹å¯ä»¥åŒæ—¶å¤„ç†è®¸å¤šè¯·æ±‚ï¼Œå¹¶åŒæ—¶æ¥æ”¶å“åº”ã€‚è¿™æ ·ä¸€æ¥ï¼Œç­‰å¾…æ—¶é—´å°±å¯ä»¥ä¸å‘é€å…¶ä»–è¯·æ±‚å’Œæ¥æ”¶å“åº”å åŠ èµ·æ¥ã€‚æœ€èµ·ç ï¼Œç­‰å¾…æ—¶é—´å¯ä»¥æ‘Šåœ¨å¤šä¸ªè¯·æ±‚ä¸Šã€‚è¿™åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ä¼šå¯¼è‡´æ›´é«˜çš„æµååé‡ã€‚\næ³¨æ„ï¼šé€šè¿‡ä»…ä»…å°† MapFunction æ‰©å±•åˆ°å¾ˆé«˜çš„å¹¶è¡Œåº¦æ¥æé«˜ååé‡ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œä½†é€šå¸¸è¦ä»˜å‡ºå¾ˆé«˜çš„èµ„æºä»£ä»·ï¼šæ‹¥æœ‰æ›´å¤šçš„å¹¶è¡Œ MapFunction å®ä¾‹æ„å‘³ç€æ›´å¤šçš„ä»»åŠ¡ã€çº¿ç¨‹ã€Flink å†…éƒ¨ç½‘ç»œè¿æ¥ã€ä¸æ•°æ®åº“çš„ç½‘ç»œè¿æ¥ã€ç¼“å†²åŒºä»¥åŠä¸€èˆ¬çš„å†…éƒ¨è®°è´¦å¼€é”€ã€‚\nå‰ææ¡ä»¶ å¦‚ä¸ŠèŠ‚æ‰€è¿°ï¼Œè¦å®ç°å¯¹æ•°æ®åº“ï¼ˆæˆ–é”®/å€¼å­˜å‚¨ï¼‰çš„é€‚å½“å¼‚æ­¥ I/Oï¼Œéœ€è¦å‘è¯¥æ•°æ®åº“æä¾›ä¸€ä¸ªæ”¯æŒå¼‚æ­¥è¯·æ±‚çš„å®¢æˆ·ç«¯ã€‚è®¸å¤šæµè¡Œçš„æ•°æ®åº“éƒ½æä¾›äº†è¿™æ ·çš„å®¢æˆ·ç«¯ã€‚\nåœ¨æ²¡æœ‰è¿™æ ·çš„å®¢æˆ·ç«¯çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å°è¯•é€šè¿‡åˆ›å»ºå¤šä¸ªå®¢æˆ·ç«¯ï¼Œå¹¶ç”¨çº¿ç¨‹æ± å¤„ç†åŒæ­¥è°ƒç”¨ï¼Œå°†åŒæ­¥å®¢æˆ·ç«¯å˜æˆæœ‰é™çš„å¹¶å‘å®¢æˆ·ç«¯ã€‚ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•é€šå¸¸æ¯”ä¸€ä¸ªåˆé€‚çš„å¼‚æ­¥å®¢æˆ·ç«¯æ•ˆç‡ä½ã€‚\nå¼‚æ­¥ I/O API Flink çš„ Async I/O API å…è®¸ç”¨æˆ·ä½¿ç”¨å¼‚æ­¥è¯·æ±‚å®¢æˆ·ç«¯ä¸æ•°æ®æµã€‚è¯¥ API å¤„ç†ä¸æ•°æ®æµçš„é›†æˆï¼Œä»¥åŠå¤„ç†é¡ºåºã€äº‹ä»¶æ—¶é—´ã€å®¹é”™ç­‰ã€‚\nå‡è®¾è‡ªå·±æœ‰ä¸€ä¸ªç›®æ ‡æ•°æ®åº“çš„å¼‚æ­¥å®¢æˆ·ç«¯ï¼Œéœ€è¦ä¸‰ä¸ªéƒ¨åˆ†æ¥å®ç°å¯¹æ•°æ®åº“çš„å¼‚æ­¥ I/O çš„æµè½¬æ¢ã€‚\n ä¸€ä¸ª AsyncFunction çš„å®ç°ï¼Œç”¨æ¥è°ƒåº¦è¯·æ±‚ã€‚ ä¸€ä¸ªå›è°ƒï¼Œè·å–æ“ä½œç»“æœå¹¶å°†å…¶äº¤ç»™ ResultFutureã€‚ åœ¨ DataStream ä¸Šåº”ç”¨å¼‚æ­¥ I/O æ“ä½œä½œä¸ºè½¬æ¢ã€‚  ä¸‹é¢çš„ä»£ç ç¤ºä¾‹è¯´æ˜äº†åŸºæœ¬æ¨¡å¼ã€‚\n/** * An implementation of the \u0026#39;AsyncFunction\u0026#39; that sends requests and sets the callback. */ class AsyncDatabaseRequest extends AsyncFunction[String, (String, String)] { /** The database specific client that can issue concurrent requests with callbacks */ lazy val client: DatabaseClient = new DatabaseClient(host, post, credentials) /** The context used for the future callbacks */ implicit lazy val executor: ExecutionContext = ExecutionContext.fromExecutor(Executors.directExecutor()) override def asyncInvoke(str: String, resultFuture: ResultFuture[(String, String)]): Unit = { // issue the asynchronous request, receive a future for the result  val resultFutureRequested: Future[String] = client.query(str) // set the callback to be executed once the request by the client is complete  // the callback simply forwards the result to the result future  resultFutureRequested.onSuccess { case result: String =\u0026gt; resultFuture.complete(Iterable((str, result))) } } } // create the original stream val stream: DataStream[String] = ... // apply the async I/O transformation val resultStream: DataStream[(String, String)] = AsyncDataStream.unorderedWait(stream, new AsyncDatabaseRequest(), 1000, TimeUnit.MILLISECONDS, 100) é‡è¦æç¤ºï¼šResultFuture.complete çš„ç¬¬ä¸€æ¬¡è°ƒç”¨å°±å®Œæˆäº†ã€‚æ‰€æœ‰åç»­çš„å®Œæˆè°ƒç”¨å°†è¢«å¿½ç•¥ã€‚\nä»¥ä¸‹ä¸¤ä¸ªå‚æ•°æ§åˆ¶å¼‚æ­¥æ“ä½œã€‚\n  è¶…æ—¶: è¶…æ—¶å®šä¹‰äº†å¼‚æ­¥è¯·æ±‚åœ¨è¢«è®¤ä¸ºå¤±è´¥ä¹‹å‰å¯èƒ½éœ€è¦çš„æ—¶é—´ã€‚è¿™ä¸ªå‚æ•°å¯ä»¥é˜²èŒƒæ­»æœº/å¤±è´¥çš„è¯·æ±‚ã€‚\n  Capacityï¼ˆå®¹é‡ï¼‰ï¼šè¯¥å‚æ•°å®šä¹‰äº†å¼‚æ­¥è¯·æ±‚åœ¨è¢«è®¤ä¸ºå¤±è´¥ä¹‹å‰å¯èƒ½éœ€è¦çš„æ—¶é—´ã€‚è¿™ä¸ªå‚æ•°å®šä¹‰äº†å¤šå°‘ä¸ªå¼‚æ­¥è¯·æ±‚å¯ä»¥åŒæ—¶è¿›è¡Œã€‚å°½ç®¡å¼‚æ­¥I/Oæ–¹æ³•é€šå¸¸ä¼šå¸¦æ¥æ›´å¥½çš„ååé‡ï¼Œä½†æ“ä½œè€…ä»ç„¶å¯ä»¥æˆä¸ºæµåº”ç”¨çš„ç“¶é¢ˆã€‚é™åˆ¶å¹¶å‘è¯·æ±‚çš„æ•°é‡å¯ä»¥ç¡®ä¿æ“ä½œè€…ä¸ä¼šç§¯ç´¯è¶Šæ¥è¶Šå¤šçš„å¾…å¤„ç†è¯·æ±‚çš„ç§¯å‹ï¼Œä½†ä¸€æ—¦å®¹é‡è€—å°½ï¼Œå°±ä¼šè§¦å‘èƒŒå‹ã€‚\n  è¶…æ—¶å¤„ç† å½“ä¸€ä¸ªå¼‚æ­¥ I/O è¯·æ±‚è¶…æ—¶æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸å¹¶é‡æ–°å¯åŠ¨ä½œä¸šã€‚å¦‚æœä½ æƒ³å¤„ç†è¶…æ—¶ï¼Œä½ å¯ä»¥é‡å†™ AsyncFunction#timeout æ–¹æ³•ã€‚\nç»“æœçš„é¡ºåº AsyncFunction å‘å‡ºçš„å¹¶å‘è¯·æ±‚ç»å¸¸ä»¥æŸç§æœªå®šä¹‰çš„é¡ºåºå®Œæˆï¼ŒåŸºäºå“ªä¸ªè¯·æ±‚å…ˆå®Œæˆã€‚ä¸ºäº†æ§åˆ¶ç»“æœè®°å½•ä»¥ä½•ç§é¡ºåºå‘å‡ºï¼ŒFlink æä¾›äº†ä¸¤ç§æ¨¡å¼ã€‚\n  Unordered: å¼‚æ­¥è¯·æ±‚ä¸€ç»“æŸï¼Œç»“æœè®°å½•å°±ä¼šè¢«å‘å‡ºã€‚åœ¨å¼‚æ­¥ I/O æ“ä½œç¬¦ä¹‹åï¼Œæµä¸­è®°å½•çš„é¡ºåºä¸ä¹‹å‰ä¸åŒã€‚è¿™ç§æ¨¡å¼ä»¥å¤„ç†æ—¶é—´ä¸ºåŸºæœ¬æ—¶é—´ç‰¹æ€§æ—¶ï¼Œå»¶è¿Ÿæœ€ä½ï¼Œå¼€é”€æœ€å°ã€‚ä½¿ç”¨ AsyncDataStream.unorderedWait(...) æ¥å®ç°è¿™ç§æ¨¡å¼ã€‚\n  Ordered: åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæµçš„é¡ºåºè¢«ä¿ç•™ä¸‹æ¥ã€‚ç»“æœè®°å½•çš„å‘å‡ºé¡ºåºä¸å¼‚æ­¥è¯·æ±‚è¢«è§¦å‘çš„é¡ºåºç›¸åŒï¼ˆè¿ç®—ç¬¦è¾“å…¥è®°å½•çš„é¡ºåºï¼‰ã€‚ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œæ“ä½œç¬¦ä¼šç¼“å†²ä¸€ä¸ªç»“æœè®°å½•ï¼Œç›´åˆ°å®ƒå‰é¢çš„æ‰€æœ‰è®°å½•éƒ½è¢«å‘å‡ºæ¥ï¼ˆæˆ–å®šæ—¶å‘å‡ºæ¥ï¼‰ã€‚è¿™é€šå¸¸ä¼šåœ¨æ£€æŸ¥ç‚¹ä¸­å¼•å…¥ä¸€äº›é¢å¤–çš„å»¶è¿Ÿå’Œä¸€äº›å¼€é”€ï¼Œå› ä¸ºä¸æ— åºæ¨¡å¼ç›¸æ¯”ï¼Œè®°å½•æˆ–ç»“æœåœ¨æ£€æŸ¥ç‚¹çŠ¶æ€ä¸‹ç»´æŒçš„æ—¶é—´æ›´é•¿ã€‚ä½¿ç”¨ AsyncDataStream.orderedWait(...) æ¥å¤„ç†è¿™ç§æ¨¡å¼ã€‚\n  äº‹ä»¶æ—¶é—´ å½“æµåª’ä½“åº”ç”¨ç¨‹åºä½¿ç”¨äº‹ä»¶æ—¶é—´å·¥ä½œæ—¶ï¼Œæ°´å°å°†ç”±å¼‚æ­¥ I/O æ“ä½œç¬¦æ­£ç¡®å¤„ç†ã€‚å…·ä½“æ¥è¯´ï¼Œè¿™æ„å‘³ç€ä¸¤ç§é¡ºåºæ¨¡å¼çš„ä»¥ä¸‹å†…å®¹ã€‚\n æ— åºçš„ï¼šæ°´å°ä¸ä¼šè¶…è¶Šè®°å½•ï¼Œåä¹‹äº¦ç„¶ï¼Œè¿™æ„å‘³ç€æ°´å°ä¼šå»ºç«‹ä¸€ä¸ªé¡ºåºè¾¹ç•Œã€‚åªæœ‰åœ¨æ°´å°ä¹‹é—´æ‰ä¼šå‘å‡ºæ— åºçš„è®°å½•ã€‚å‘ç”Ÿåœ¨æŸä¸€æ°´å°ä¹‹åçš„è®°å½•ï¼Œåªæœ‰åœ¨è¯¥æ°´å°è¢«å‘å°„ä¹‹åæ‰ä¼šè¢«å‘å°„ã€‚è€Œæ°´å°åˆ™åªæœ‰åœ¨è¯¥æ°´å°ä¹‹å‰çš„æ‰€æœ‰è¾“å…¥çš„ç»“æœè®°å½•è¢«å‘å‡ºä¹‹åæ‰ä¼šè¢«å‘å‡ºã€‚  è¿™æ„å‘³ç€åœ¨æœ‰æ°´å°çš„æƒ…å†µä¸‹ï¼Œæ— åºæ¨¡å¼ä¼šå¼•å…¥ä¸€äº›ä¸æœ‰åºæ¨¡å¼ç›¸åŒçš„å»¶è¿Ÿå’Œç®¡ç†å¼€é”€ã€‚è¯¥å¼€é”€çš„æ•°é‡å–å†³äºæ°´å°çš„é¢‘ç‡ã€‚\n æœ‰åºçš„: æ°´å°å’Œè®°å½•çš„é¡ºåºè¢«ä¿ç•™ä¸‹æ¥ å°±åƒè®°å½•ä¹‹é—´çš„é¡ºåºè¢«ä¿ç•™ä¸€æ · ä¸å¤„ç†æ—¶é—´ç›¸æ¯”ï¼Œå¼€é”€æ²¡æœ‰æ˜æ˜¾å˜åŒ–ã€‚  è¯·è®°ä½ï¼Œæ‘„å–æ—¶é—´æ˜¯äº‹ä»¶æ—¶é—´çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå…¶è‡ªåŠ¨ç”Ÿæˆçš„æ°´å°æ˜¯åŸºäºæºå¤„ç†æ—¶é—´çš„ã€‚\nå®¹é”™ä¿è¯ å¼‚æ­¥ I/O æ“ä½œç¬¦æä¾›äº†å®Œå…¨ç²¾ç¡®çš„ä¸€æ¬¡å®¹é”™ä¿è¯ï¼Œå®ƒå°†é£è¡Œä¸­çš„å¼‚æ­¥è¯·æ±‚è®°å½•å­˜å‚¨åœ¨æ£€æŸ¥ç‚¹ä¸­ï¼Œå¹¶åœ¨æ•…éšœæ¢å¤æ—¶æ¢å¤/é‡æ–°è§¦å‘è¯·æ±‚ã€‚å®ƒå°†é£è¡Œä¸­çš„å¼‚æ­¥è¯·æ±‚è®°å½•å­˜å‚¨åœ¨æ£€æŸ¥ç‚¹ä¸­ï¼Œå¹¶åœ¨ä»æ•…éšœä¸­æ¢å¤æ—¶æ¢å¤/é‡æ–°è§¦å‘è¯·æ±‚ã€‚\nå®ç°æŠ€å·§ å¯¹äºæœ‰ Executorï¼ˆæˆ– Scala ä¸­çš„ ExecutionContextï¼‰ç”¨äºå›è°ƒçš„ Futures å®ç°ï¼Œæˆ‘ä»¬å»ºè®®ä½¿ç”¨ DirectExecutorï¼Œå› ä¸ºå›è°ƒé€šå¸¸åªåšæœ€å°‘çš„å·¥ä½œï¼Œè€Œä¸”DirectExecutor é¿å…äº†é¢å¤–çš„çº¿ç¨‹é—´äº¤æ¥å¼€é”€ã€‚å›è°ƒé€šå¸¸åªå°†ç»“æœäº¤ç»™ ResultFutureï¼Œåè€…å°†å…¶æ·»åŠ åˆ°è¾“å‡ºç¼“å†²åŒºã€‚ä»é‚£é‡Œå¼€å§‹ï¼ŒåŒ…æ‹¬è®°å½•æ’æ”¾å’Œä¸æ£€æŸ¥ç‚¹è®°è´¦çš„äº¤äº’åœ¨å†…çš„ç¹é‡é€»è¾‘æ— è®ºå¦‚ä½•éƒ½å‘ç”Ÿåœ¨ä¸€ä¸ªä¸“ç”¨çº¿ç¨‹æ± ä¸­ã€‚\nå¯ä»¥é€šè¿‡ org.apache.flink.runtime.concurrent.Executors.directExecutor() æˆ– com.google.common.util.concurrent.MoreExecutors.directExecutor() è·å¾— DirectExecutorã€‚\næ³¨æ„äº‹é¡¹ AsyncFunction ä¸å«å¤šçº¿ç¨‹ã€‚\næˆ‘ä»¬åœ¨è¿™é‡Œè¦æ˜ç¡®æŒ‡å‡ºçš„ä¸€ä¸ªå¸¸è§çš„å›°æƒ‘æ˜¯ï¼ŒAsyncFunction ä¸æ˜¯ä»¥å¤šçº¿ç¨‹çš„æ–¹å¼è°ƒç”¨çš„ã€‚AsyncFunction åªå­˜åœ¨ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶ä¸”å¯¹äºæµçš„å„ä¸ªåˆ†åŒºä¸­çš„æ¯ä¸€æ¡è®°å½•ï¼Œå®ƒéƒ½ä¼šè¢«ä¾æ¬¡è°ƒç”¨ã€‚é™¤é asyncInvoke(...) æ–¹æ³•å¿«é€Ÿè¿”å›å¹¶ä¾èµ–äºå›è°ƒï¼ˆç”±å®¢æˆ·ç«¯ï¼‰ï¼Œå¦åˆ™ä¸ä¼šå¯¼è‡´æ­£ç¡®çš„å¼‚æ­¥ I/Oã€‚\nä¾‹å¦‚ï¼Œä»¥ä¸‹æ¨¡å¼ä¼šå¯¼è‡´é˜»å¡ asyncInvoke(...) å‡½æ•°ï¼Œä»è€Œä½¿å¼‚æ­¥è¡Œä¸ºæ— æ•ˆã€‚\n  ä½¿ç”¨ä¸€ä¸ªæ•°æ®åº“å®¢æˆ·ç«¯ï¼Œå…¶æŸ¥æ‰¾/æŸ¥è¯¢æ–¹æ³•çš„è°ƒç”¨ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°ç»“æœè¢«æ¥æ”¶å›æ¥ä¸ºæ­¢\n  åœ¨ asyncInvoke(...) æ–¹æ³•ä¸­é˜»æ­¢/ç­‰å¾…å¼‚æ­¥å®¢æˆ·ç«¯è¿”å›çš„æœªæ¥å‹å¯¹è±¡ã€‚\n  å‡ºäºä¸€è‡´æ€§çš„è€ƒè™‘ï¼ŒAsyncFunction çš„æ“ä½œç¬¦ï¼ˆAsyncWaitOperatorï¼‰ç›®å‰å¿…é¡»ä½äºæ“ä½œç¬¦é“¾çš„å¤´éƒ¨ã€‚\nç”±äºåœ¨ FLINK-13063 é—®é¢˜ä¸­ç»™å‡ºçš„åŸå› ï¼Œæˆ‘ä»¬ç›®å‰å¿…é¡»æ‰“ç ´ AsyncWaitOperator çš„æ“ä½œç¬¦é“¾ï¼Œä»¥é˜²æ­¢æ½œåœ¨çš„ä¸€è‡´æ€§é—®é¢˜ã€‚è¿™æ˜¯å¯¹ä»¥å‰æ”¯æŒé“¾çš„è¡Œä¸ºçš„æ”¹å˜ã€‚éœ€è¦æ—§è¡Œä¸ºå¹¶æ¥å—æ½œåœ¨çš„è¿åä¸€è‡´æ€§ä¿è¯çš„ç”¨æˆ·å¯ä»¥æ‰‹åŠ¨å®ä¾‹åŒ–å¹¶å°† AsyncWaitOperator æ·»åŠ åˆ°ä½œä¸šå›¾ä¸­ï¼Œå¹¶é€šè¿‡ AsyncWaitOperator#setChainingStrategy(ChainingStrategy.ALWAYS) å°†é“¾å¼ç­–ç•¥è®¾ç½®å›é“¾å¼ã€‚\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/stream/operators/asyncio.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-asynchronous-io-for-external-data-access/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataStream API","Operators","IO"],"title":"ç”¨äºå¤–éƒ¨æ•°æ®è®¿é—®çš„å¼‚æ­¥ I/O"},{"categories":["Flink"],"contents":"ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•° ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°(UDFs)æ˜¯æ‰©å±•ç‚¹ï¼Œç”¨äºè°ƒç”¨å¸¸ç”¨çš„é€»è¾‘æˆ–è‡ªå®šä¹‰é€»è¾‘ï¼Œè¿™äº›é€»è¾‘æ— æ³•åœ¨æŸ¥è¯¢ä¸­ä»¥å…¶ä»–æ–¹å¼è¡¨è¾¾ã€‚\nç”¨æˆ·å®šä¹‰å‡½æ•°å¯ä»¥ç”¨ JVM è¯­è¨€ï¼ˆå¦‚ Java æˆ– Scalaï¼‰æˆ– Python å®ç°ã€‚å®ç°è€…å¯ä»¥åœ¨ UDF ä¸­ä½¿ç”¨ä»»æ„çš„ç¬¬ä¸‰æ–¹åº“ã€‚æœ¬é¡µå°†é‡ç‚¹ä»‹ç»åŸºäº JVM çš„è¯­è¨€ã€‚\næ¦‚è¿° ç›®å‰ï¼ŒFlink åŒºåˆ†äº†ä»¥ä¸‹å‡ ç§å‡½æ•°ã€‚\n æ ‡é‡å‡½æ•°å°†æ ‡é‡å€¼æ˜ å°„åˆ°ä¸€ä¸ªæ–°çš„æ ‡é‡å€¼ã€‚ è¡¨å‡½æ•°å°†æ ‡é‡å€¼æ˜ å°„åˆ°æ–°çš„è¡Œ(row)ã€‚ èšåˆå‡½æ•°å°†å¤šè¡Œçš„æ ‡é‡å€¼æ˜ å°„åˆ°æ–°çš„æ ‡é‡å€¼ã€‚ è¡¨èšåˆå‡½æ•°å°†å¤šè¡Œçš„æ ‡é‡å€¼æ˜ å°„åˆ°æ–°çš„è¡Œä¸Šã€‚ å¼‚æ­¥è¡¨å‡½æ•°æ˜¯é’ˆå¯¹ table source æ‰§è¡ŒæŸ¥æ‰¾çš„ç‰¹æ®Šå‡½æ•°ã€‚  æ³¨æ„: æ ‡é‡å‡½æ•°å’Œè¡¨å‡½æ•°å·²ç»æ›´æ–°ä¸ºåŸºäºæ•°æ®ç±»å‹çš„æ–°ç±»å‹ç³»ç»Ÿã€‚èšåˆå‡½æ•°ä»ç„¶ä½¿ç”¨åŸºäº TypeInformation çš„æ—§ç±»å‹ç³»ç»Ÿã€‚\nä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªç®€å•çš„æ ‡é‡å‡½æ•°ï¼Œä»¥åŠå¦‚ä½•åœ¨è¡¨ API å’Œ SQL ä¸­è°ƒç”¨è¯¥å‡½æ•°ã€‚\nå¯¹äº SQL æŸ¥è¯¢ï¼Œä¸€ä¸ªå‡½æ•°å¿…é¡»å§‹ç»ˆä»¥ä¸€ä¸ªåå­—æ³¨å†Œã€‚å¯¹äº Table APIï¼Œå‡½æ•°å¯ä»¥è¢«æ³¨å†Œï¼Œä¹Ÿå¯ä»¥ç›´æ¥å†…è”ä½¿ç”¨ã€‚\nimport org.apache.flink.table.api._ import org.apache.flink.table.functions.ScalarFunction // define function logic class SubstringFunction extends ScalarFunction { def eval(s: String, begin: Integer, end: Integer): String = { s.substring(begin, end) } } val env = TableEnvironment.create(...) // call function \u0026#34;inline\u0026#34; without registration in Table API env.from(\u0026#34;MyTable\u0026#34;).select(call(classOf[SubstringFunction], $\u0026#34;myField\u0026#34;, 5, 12)) // register function env.createTemporarySystemFunction(\u0026#34;SubstringFunction\u0026#34;, classOf[SubstringFunction]) // call registered function in Table API env.from(\u0026#34;MyTable\u0026#34;).select(call(\u0026#34;SubstringFunction\u0026#34;, $\u0026#34;myField\u0026#34;, 5, 12)) // call registered function in SQL env.sqlQuery(\u0026#34;SELECT SubstringFunction(myField, 5, 12) FROM MyTable\u0026#34;) å¯¹äºäº¤äº’å¼ä¼šè¯ï¼Œä¹Ÿå¯ä»¥åœ¨ä½¿ç”¨æˆ–æ³¨å†Œå‡½æ•°ä¹‹å‰å¯¹å…¶è¿›è¡Œå‚æ•°åŒ–ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨å‡½æ•°å®ä¾‹ä»£æ›¿å‡½æ•°ç±»ä½œä¸ºä¸´æ—¶å‡½æ•°ã€‚\nå®ƒè¦æ±‚å‚æ•°æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œä»¥ä¾¿å°†å‡½æ•°å®ä¾‹è¿é€åˆ°é›†ç¾¤ã€‚\nimport org.apache.flink.table.api._ import org.apache.flink.table.functions.ScalarFunction // define parameterizable function logic class SubstringFunction(val endInclusive) extends ScalarFunction { def eval(s: String, begin: Integer, end: Integer): String = { s.substring(endInclusive ? end + 1 : end) } } val env = TableEnvironment.create(...) // call function \u0026#34;inline\u0026#34; without registration in Table API env.from(\u0026#34;MyTable\u0026#34;).select(call(new SubstringFunction(true), $\u0026#34;myField\u0026#34;, 5, 12)) // register function env.createTemporarySystemFunction(\u0026#34;SubstringFunction\u0026#34;, new SubstringFunction(true)) å®ç°æŒ‡å— æ³¨æ„ï¼šæœ¬èŠ‚ç›®å‰åªé€‚ç”¨äºæ ‡é‡å‡½æ•°å’Œè¡¨å‡½æ•°ï¼›åœ¨é›†åˆå‡½æ•°æ›´æ–°åˆ°æ–°çš„ç±»å‹ç³»ç»Ÿä¹‹å‰ï¼Œæœ¬èŠ‚åªé€‚ç”¨äºæ ‡é‡å‡½æ•°ã€‚\næ— è®ºå‡½æ•°çš„ç§ç±»å¦‚ä½•ï¼Œæ‰€æœ‰ç”¨æˆ·å®šä¹‰çš„å‡½æ•°éƒ½éµå¾ªä¸€äº›åŸºæœ¬çš„å®ç°åŸåˆ™ã€‚\nå‡½æ•°ç±» ä¸€ä¸ªå®ç°ç±»å¿…é¡»ä»ä¸€ä¸ªå¯ç”¨çš„åŸºç±»(ä¾‹å¦‚ org.apache.flink.table.function.ScalarFunction)ä¸­æ‰©å±•å‡ºæ¥ã€‚\nè¿™ä¸ªç±»å¿…é¡»è¢«å£°æ˜ä¸º publicï¼Œè€Œä¸æ˜¯ abstractï¼Œå¹¶ä¸”åº”è¯¥æ˜¯å…¨å±€è®¿é—®çš„ã€‚å› æ­¤ï¼Œä¸å…è®¸ä½¿ç”¨éé™æ€çš„å†…éƒ¨ç±»æˆ–åŒ¿åç±»ã€‚\nå¯¹äºåœ¨æŒä¹…åŒ–ç›®å½•ä¸­å­˜å‚¨ç”¨æˆ·å®šä¹‰çš„å‡½æ•°ï¼Œè¯¥ç±»å¿…é¡»æœ‰ä¸€ä¸ªé»˜è®¤çš„æ„é€ å‡½æ•°ï¼Œå¹¶ä¸”åœ¨è¿è¡Œæ—¶å¿…é¡»æ˜¯å¯å®ä¾‹åŒ–çš„ã€‚\nè¯„ä¼°æ–¹æ³• åŸºç±»æä¾›äº†ä¸€ç»„å¯ä»¥é‡å†™çš„æ–¹æ³•ï¼Œå¦‚ open()ã€close() æˆ– isDeterministic()ã€‚\nç„¶è€Œï¼Œé™¤äº†è¿™äº›å£°æ˜çš„æ–¹æ³•å¤–ï¼Œåº”ç”¨äºæ¯ä¸ªä¼ å…¥è®°å½•çš„ä¸»è¦è¿è¡Œæ—¶é€»è¾‘å¿…é¡»é€šè¿‡ä¸“é—¨çš„è¯„ä¼°æ–¹æ³•æ¥å®ç°ã€‚\næ ¹æ®å‡½æ•°ç§ç±»çš„ä¸åŒï¼Œè¯„ä»·æ–¹æ³•å¦‚ eval()ã€accumulate() æˆ– retract() ä¼šåœ¨è¿è¡Œæ—¶è¢«ä»£ç ç”Ÿæˆçš„æ“ä½œç¬¦è°ƒç”¨ã€‚\nè¿™äº›æ–¹æ³•å¿…é¡»å£°æ˜ä¸º publicï¼Œå¹¶æ¥å—ä¸€ç»„å®šä¹‰æ˜ç¡®çš„å‚æ•°ã€‚\nå¸¸è§„çš„ JVM æ–¹æ³•è°ƒç”¨è¯­ä¹‰é€‚ç”¨ã€‚å› æ­¤ï¼Œå¯ä»¥\n å®ç°é‡è½½æ–¹æ³•ï¼Œå¦‚ eval(Integer) å’Œ eval(LocalDateTime)ã€‚ ä½¿ç”¨ var-argsï¼Œå¦‚ eval(Integer...)ã€‚ ä½¿ç”¨å¯¹è±¡ç»§æ‰¿ï¼Œå¦‚ eval(Object)ï¼Œå®ƒåŒæ—¶æ¥å— LocalDateTime å’Œ Integerã€‚ ä»¥åŠä¸Šè¿°å‡½æ•°çš„ç»„åˆï¼Œå¦‚ eval(Object...)ï¼Œå®ƒå¯ä»¥æ¥å—æ‰€æœ‰ç±»å‹çš„å‚æ•°ã€‚  å¦‚æœä½ æ‰“ç®—åœ¨ Scala ä¸­å®ç°å‡½æ•°ï¼Œè¯·åœ¨ä½¿ç”¨å˜é‡å‚æ•°æ—¶æ·»åŠ  scala.annotation.varargs æ³¨è§£ã€‚æ­¤å¤–ï¼Œå»ºè®®ä½¿ç”¨ç›’çŠ¶åŸºå…ƒï¼ˆå¦‚ç”¨ java.lang.Integer ä»£æ›¿ Intï¼‰æ¥æ”¯æŒ NULLã€‚\nä¸‹é¢çš„ä»£ç æ®µæ˜¾ç¤ºäº†ä¸€ä¸ªé‡è½½å‡½æ•°çš„ç¤ºä¾‹ã€‚\nimport org.apache.flink.table.functions.ScalarFunction import java.lang.Integer import java.lang.Double import scala.annotation.varargs // function with overloaded evaluation methods class SumFunction extends ScalarFunction { def eval(a: Integer, b: Integer): Integer = { a + b } def eval(a: String, b: String): Integer = { Integer.valueOf(a) + Integer.valueOf(b) } @varargs // generate var-args like Java  def eval(d: Double*): Integer = { d.sum.toInt } } ç±»å‹æ¨æ–­ è¡¨ç”Ÿæ€ç³»ç»Ÿï¼ˆç±»ä¼¼äº SQL æ ‡å‡†ï¼‰æ˜¯ä¸€ä¸ªå¼ºç±»å‹çš„ APIã€‚å› æ­¤ï¼Œå‡½æ•°å‚æ•°å’Œè¿”å›ç±»å‹éƒ½å¿…é¡»æ˜ å°„åˆ°æ•°æ®ç±»å‹ã€‚\nä»é€»è¾‘çš„è§’åº¦æ¥çœ‹ï¼Œè§„åˆ’å¸ˆéœ€è¦å…³äºé¢„æœŸç±»å‹ã€ç²¾åº¦å’Œè§„æ¨¡çš„ä¿¡æ¯ã€‚ä» JVM çš„è§’åº¦æ¥çœ‹ï¼Œè§„åˆ’å¸ˆéœ€è¦äº†è§£å½“è°ƒç”¨ç”¨æˆ·å®šä¹‰çš„å‡½æ•°æ—¶ï¼Œå†…éƒ¨æ•°æ®ç»“æ„å¦‚ä½•è¢«è¡¨ç¤ºä¸º JVM å¯¹è±¡ã€‚\néªŒè¯è¾“å…¥å‚æ•°å’Œæ¨å¯¼å‡ºå‡½æ•°çš„å‚æ•°å’Œç»“æœçš„æ•°æ®ç±»å‹çš„é€»è¾‘è¢«æ€»ç»“åœ¨ç±»å‹æ¨ç†è¿™ä¸ªæœ¯è¯­ä¸‹ã€‚\nFlink çš„ç”¨æˆ·å®šä¹‰å‡½æ•°å®ç°äº†è‡ªåŠ¨ç±»å‹æ¨ç†æå–ï¼Œé€šè¿‡åå°„ä»å‡½æ•°çš„ç±»å’Œå®ƒçš„è¯„ä¼°æ–¹æ³•ä¸­å¯¼å‡ºæ•°æ®ç±»å‹ã€‚å¦‚æœè¿™ç§éšå¼åå°„æå–æ–¹æ³•ä¸æˆåŠŸï¼Œå¯ä»¥é€šè¿‡ç”¨ @DataTypeHint å’Œ @FunctionHint æ³¨é‡Šå—å½±å“çš„å‚æ•°ã€ç±»æˆ–æ–¹æ³•æ¥æ”¯æŒæå–è¿‡ç¨‹ã€‚æ›´å¤šå…³äºå¦‚ä½•æ³¨é‡Šå‡½æ•°çš„ä¾‹å­å¦‚ä¸‹æ‰€ç¤ºã€‚\nå¦‚æœéœ€è¦æ›´é«˜çº§çš„ç±»å‹æ¨ç†é€»è¾‘ï¼Œå®ç°è€…å¯ä»¥åœ¨æ¯ä¸ªç”¨æˆ·å®šä¹‰çš„å‡½æ•°ä¸­æ˜¾å¼è¦†ç›– getTypeInference() æ–¹æ³•ã€‚ç„¶è€Œï¼Œæ¨èä½¿ç”¨æ³¨é‡Šæ–¹æ³•ï¼Œå› ä¸ºå®ƒå°†è‡ªå®šä¹‰ç±»å‹æ¨ç†é€»è¾‘ä¿æŒåœ¨å—å½±å“çš„ä½ç½®é™„è¿‘ï¼Œå¹¶å›è½åˆ°å…¶ä½™å®ç°çš„é»˜è®¤è¡Œä¸ºã€‚\nè‡ªåŠ¨ç±»å‹æ¨æ–­ è‡ªåŠ¨ç±»å‹æ¨ç†æ£€æŸ¥å‡½æ•°çš„ç±»å’Œè¯„ä¼°æ–¹æ³•ï¼Œä»è€Œå¾—å‡ºå‡½æ•°çš„å‚æ•°å’Œç»“æœçš„æ•°æ®ç±»å‹ã€‚@DataTypeHint å’Œ @FunctionHint æ³¨è§£æ”¯æŒè‡ªåŠ¨æå–ã€‚\nå…³äºå¯ä»¥éšå¼æ˜ å°„åˆ°æ•°æ®ç±»å‹çš„ç±»çš„å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚é˜…æ•°æ®ç±»å‹æå–éƒ¨åˆ†ã€‚\n@DataTypeHint åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œéœ€è¦æ”¯æŒå¯¹å‡½æ•°çš„å‚æ•°å’Œè¿”å›ç±»å‹è¿›è¡Œåœ¨çº¿è‡ªåŠ¨æå–ã€‚\nä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ•°æ®ç±»å‹æç¤ºã€‚æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨æ³¨è§£ç±»çš„æ–‡æ¡£ä¸­æ‰¾åˆ°ã€‚\nimport org.apache.flink.table.annotation.DataTypeHint import org.apache.flink.table.annotation.InputGroup import org.apache.flink.table.functions.ScalarFunction import org.apache.flink.types.Row import scala.annotation.varargs // function with overloaded evaluation methods class OverloadedFunction extends ScalarFunction { // no hint required  def eval(a: Long, b: Long): Long = { a + b } // define the precision and scale of a decimal  @DataTypeHint(\u0026#34;DECIMAL(12, 3)\u0026#34;) def eval(double a, double b): BigDecimal = { java.lang.BigDecimal.valueOf(a + b) } // define a nested data type  @DataTypeHint(\u0026#34;ROW\u0026lt;s STRING, t TIMESTAMP(3) WITH LOCAL TIME ZONE\u0026gt;\u0026#34;) def eval(Int i): Row = { Row.of(java.lang.String.valueOf(i), java.time.Instant.ofEpochSecond(i)) } // allow wildcard input and customly serialized output  @DataTypeHint(value = \u0026#34;RAW\u0026#34;, bridgedTo = classOf[java.nio.ByteBuffer]) def eval(@DataTypeHint(inputGroup = InputGroup.ANY) Object o): java.nio.ByteBuffer = { MyUtils.serializeToByteBuffer(o) } } @FunctionHint åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œä¸€ä¸ªè¯„ä¼°æ–¹æ³•åŒæ—¶å¤„ç†å¤šç§ä¸åŒçš„æ•°æ®ç±»å‹æ˜¯å¯å–çš„ã€‚æ­¤å¤–ï¼Œåœ¨æŸäº›åœºæ™¯ä¸­ï¼Œé‡è½½çš„è¯„ä¼°æ–¹æ³•æœ‰ä¸€ä¸ªå…±åŒçš„ç»“æœç±»å‹ï¼Œåº”è¯¥åªå£°æ˜ä¸€æ¬¡ã€‚\n@FunctionHint æ³¨è§£å¯ä»¥æä¾›ä»å‚æ•°æ•°æ®ç±»å‹åˆ°ç»“æœæ•°æ®ç±»å‹çš„æ˜ å°„ã€‚å®ƒå¯ä»¥ä¸ºè¾“å…¥ã€ç´¯åŠ å™¨å’Œç»“æœæ•°æ®ç±»å‹æ³¨é‡Šæ•´ä¸ªå‡½æ•°ç±»æˆ–è¯„ä¼°æ–¹æ³•ã€‚ä¸€ä¸ªæˆ–å¤šä¸ªæ³¨è§£å¯ä»¥åœ¨ä¸€ä¸ªç±»çš„é¡¶éƒ¨å£°æ˜ï¼Œä¹Ÿå¯ä»¥ä¸ºæ¯ä¸ªè¯„ä¼°æ–¹æ³•å•ç‹¬å£°æ˜ï¼Œä»¥ä¾¿é‡è½½å‡½æ•°ç­¾åã€‚æ‰€æœ‰çš„æç¤ºå‚æ•°éƒ½æ˜¯å¯é€‰çš„ã€‚å¦‚æœæ²¡æœ‰å®šä¹‰å‚æ•°ï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„åŸºäºåå°„çš„æå–æ–¹å¼ã€‚åœ¨å‡½æ•°ç±»ä¹‹ä¸Šå®šä¹‰çš„æç¤ºå‚æ•°ä¼šè¢«æ‰€æœ‰çš„è¯„ä¼°æ–¹æ³•ç»§æ‰¿ã€‚\nä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨å‡½æ•°æç¤ºã€‚æ›´å¤šä¿¡æ¯å¯ä»¥åœ¨æ³¨è§£ç±»çš„æ–‡æ¡£ä¸­æ‰¾åˆ°ã€‚\nimport org.apache.flink.table.annotation.DataTypeHint import org.apache.flink.table.annotation.FunctionHint import org.apache.flink.table.functions.TableFunction import org.apache.flink.types.Row // function with overloaded evaluation methods // but globally defined output type @FunctionHint(output = new DataTypeHint(\u0026#34;ROW\u0026lt;s STRING, i INT\u0026gt;\u0026#34;)) class OverloadedFunction extends TableFunction[Row] { def eval(a: Int, b: Int): Unit = { collect(Row.of(\u0026#34;Sum\u0026#34;, Int.box(a + b))) } // overloading of arguments is still possible  def eval(): Unit = { collect(Row.of(\u0026#34;Empty args\u0026#34;, Int.box(-1))) } } // decouples the type inference from evaluation methods, // the type inference is entirely determined by the function hints @FunctionHint( input = Array(new DataTypeHint(\u0026#34;INT\u0026#34;), new DataTypeHint(\u0026#34;INT\u0026#34;)), output = new DataTypeHint(\u0026#34;INT\u0026#34;) ) @FunctionHint( input = Array(new DataTypeHint(\u0026#34;BIGINT\u0026#34;), new DataTypeHint(\u0026#34;BIGINT\u0026#34;)), output = new DataTypeHint(\u0026#34;BIGINT\u0026#34;) ) @FunctionHint( input = Array(), output = new DataTypeHint(\u0026#34;BOOLEAN\u0026#34;) ) class OverloadedFunction extends TableFunction[AnyRef] { // an implementer just needs to make sure that a method exists  // that can be called by the JVM  @varargs def eval(o: AnyRef*) = { if (o.length == 0) { collect(Boolean.box(false)) } collect(o(0)) } } è‡ªå®šä¹‰ç±»å‹æ¨æ–­ å¯¹äºå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œ@DataTypeHint å’Œ @FunctionHint åº”è¯¥è¶³ä»¥ä¸ºç”¨æˆ·å®šä¹‰çš„å‡½æ•°å»ºæ¨¡ã€‚ç„¶è€Œï¼Œé€šè¿‡è¦†ç›– getTypeInference() ä¸­å®šä¹‰çš„è‡ªåŠ¨ç±»å‹æ¨ç†ï¼Œå®ç°è€…å¯ä»¥åˆ›å»ºä»»æ„çš„å‡½æ•°ï¼Œè¿™äº›å‡½æ•°çš„è¡Œä¸ºå°±åƒå†…ç½®çš„ç³»ç»Ÿå‡½æ•°ä¸€æ ·ã€‚\nä¸‹é¢è¿™ä¸ªç”¨ Java å®ç°çš„ä¾‹å­è¯´æ˜äº†è‡ªå®šä¹‰ç±»å‹æ¨ç†é€»è¾‘çš„æ½œåŠ›ã€‚å®ƒä½¿ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²æ–‡å­—å‚æ•°æ¥ç¡®å®šä¸€ä¸ªå‡½æ•°çš„ç»“æœç±»å‹ã€‚è¯¥å‡½æ•°éœ€è¦ä¸¤ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°ä»£è¡¨è¦è§£æçš„å­—ç¬¦ä¸²ï¼Œç¬¬äºŒä¸ªå‚æ•°ä»£è¡¨ç›®æ ‡ç±»å‹ã€‚\nimport org.apache.flink.table.api.DataTypes; import org.apache.flink.table.catalog.DataTypeFactory; import org.apache.flink.table.functions.ScalarFunction; import org.apache.flink.table.types.inference.TypeInference; import org.apache.flink.types.Row; public static class LiteralFunction extends ScalarFunction { public Object eval(String s, String type) { switch (type) { case \u0026#34;INT\u0026#34;: return Integer.valueOf(s); case \u0026#34;DOUBLE\u0026#34;: return Double.valueOf(s); case \u0026#34;STRING\u0026#34;: default: return s; } } // the automatic, reflection-based type inference is disabled and  // replaced by the following logic  @Override public TypeInference getTypeInference(DataTypeFactory typeFactory) { return TypeInference.newBuilder() // specify typed arguments  // parameters will be casted implicitly to those types if necessary  .typedArguments(DataTypes.STRING(), DataTypes.STRING()) // specify a strategy for the result data type of the function  .outputTypeStrategy(callContext -\u0026gt; { if (!callContext.isArgumentLiteral(1) || callContext.isArgumentNull(1)) { throw callContext.newValidationError(\u0026#34;Literal expected for second argument.\u0026#34;); } // return a data type based on a literal  final String literal = callContext.getArgumentValue(1, String.class).orElse(\u0026#34;STRING\u0026#34;); switch (literal) { case \u0026#34;INT\u0026#34;: return Optional.of(DataTypes.INT().notNull()); case \u0026#34;DOUBLE\u0026#34;: return Optional.of(DataTypes.DOUBLE().notNull()); case \u0026#34;STRING\u0026#34;: default: return Optional.of(DataTypes.STRING()); } }) .build(); } } è¿è¡Œæ—¶é›†æˆ æœ‰æ—¶å¯èƒ½éœ€è¦ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°åœ¨å®é™…å·¥ä½œå‰è·å–å…¨å±€è¿è¡Œæ—¶ä¿¡æ¯æˆ–åšä¸€äº›è®¾ç½®/æ¸…ç†å·¥ä½œã€‚ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°æä¾›äº† open() å’Œ close() æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å¯ä»¥è¢«é‡å†™ï¼Œå¹¶æä¾›ä¸ DataStream API çš„ RichFunction ä¸­çš„æ–¹æ³•ç±»ä¼¼çš„åŠŸèƒ½ã€‚\nopen() æ–¹æ³•åœ¨è¯„ä¼°æ–¹æ³•ä¹‹å‰è¢«è°ƒç”¨ä¸€æ¬¡ã€‚close() æ–¹æ³•åœ¨æœ€åä¸€æ¬¡è°ƒç”¨è¯„ä¼°æ–¹æ³•åè°ƒç”¨ã€‚\nopen() æ–¹æ³•æä¾›äº†ä¸€ä¸ª FunctionContextï¼Œè¯¥ FunctionContext åŒ…å«äº†ç”¨æˆ·å®šä¹‰å‡½æ•°æ‰§è¡Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå¦‚åº¦é‡ç»„ã€åˆ†å¸ƒå¼ç¼“å­˜æ–‡ä»¶æˆ–å…¨å±€ä½œä¸šå‚æ•°ã€‚\né€šè¿‡è°ƒç”¨ FunctionContext çš„ç›¸åº”æ–¹æ³•ï¼Œå¯ä»¥è·å¾—ä»¥ä¸‹ä¿¡æ¯ã€‚\n   æ–¹æ³• æè¿°     getMetricGroup() è¯¥å¹¶è¡Œå­ä»»åŠ¡çš„åº¦é‡ç»„ã€‚   getCachedFile(name) åˆ†å¸ƒå¼ç¼“å­˜æ–‡ä»¶çš„æœ¬åœ°ä¸´æ—¶æ–‡ä»¶å‰¯æœ¬ã€‚   getJobParameter(name, defaultValue) ä¸ç»™å®šé”®ç›¸å…³è”çš„å…¨å±€ä½œä¸šå‚æ•°å€¼ã€‚    ä¸‹é¢çš„ç¤ºä¾‹ç‰‡æ®µå±•ç¤ºäº†å¦‚ä½•åœ¨æ ‡é‡å‡½æ•°ä¸­ä½¿ç”¨ FunctionContext æ¥è®¿é—®å…¨å±€å·¥ä½œå‚æ•°ã€‚\nimport org.apache.flink.table.api._ import org.apache.flink.table.functions.FunctionContext import org.apache.flink.table.functions.ScalarFunction class HashCodeFunction extends ScalarFunction { private var factor: Int = 0 override def open(context: FunctionContext): Unit = { // access the global \u0026#34;hashcode_factor\u0026#34; parameter  // \u0026#34;12\u0026#34; would be the default value if the parameter does not exist  factor = context.getJobParameter(\u0026#34;hashcode_factor\u0026#34;, \u0026#34;12\u0026#34;).toInt } def eval(s: String): Int = { s.hashCode * factor } } val env = TableEnvironment.create(...) // add job parameter env.getConfig.addJobParameter(\u0026#34;hashcode_factor\u0026#34;, \u0026#34;31\u0026#34;) // register the function env.createTemporarySystemFunction(\u0026#34;hashCode\u0026#34;, classOf[HashCodeFunction]) // use the function env.sqlQuery(\u0026#34;SELECT myField, hashCode(myField) FROM MyTable\u0026#34;) æ ‡é‡å‡½æ•° ç”¨æˆ·å®šä¹‰çš„æ ‡é‡å‡½æ•°å¯ä»¥å°†é›¶ã€ä¸€æˆ–å¤šä¸ªæ ‡é‡å€¼æ˜ å°„åˆ°ä¸€ä¸ªæ–°çš„æ ‡é‡å€¼ã€‚æ•°æ®ç±»å‹ä¸€èŠ‚ä¸­åˆ—å‡ºçš„ä»»ä½•æ•°æ®ç±»å‹éƒ½å¯ä»¥ä½œä¸ºä¸€ä¸ªè¯„ä¼°æ–¹æ³•çš„å‚æ•°æˆ–è¿”å›ç±»å‹ã€‚\nä¸ºäº†å®šä¹‰ä¸€ä¸ªæ ‡é‡å‡½æ•°ï¼Œå¿…é¡»æ‰©å±• org.apache.flink.table.function ä¸­çš„åŸºç±» ScalarFunctionï¼Œå¹¶å®ç°ä¸€ä¸ªæˆ–å¤šä¸ªåä¸º eval(...) çš„è¯„ä¼°æ–¹æ³•ã€‚\nä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•å®šä¹‰è‡ªå·±çš„å“ˆå¸Œç å‡½æ•°å¹¶åœ¨æŸ¥è¯¢ä¸­è°ƒç”¨å®ƒã€‚æ›´å¤šç»†èŠ‚è¯·å‚è§å®æ–½æŒ‡å—ã€‚\nimport org.apache.flink.table.annotation.InputGroup import org.apache.flink.table.api._ import org.apache.flink.table.functions.ScalarFunction class HashFunction extends ScalarFunction { // take any data type and return INT  def eval(@DataTypeHint(inputGroup = InputGroup.ANY) o: AnyRef): Int { return o.hashCode(); } } val env = TableEnvironment.create(...) // call function \u0026#34;inline\u0026#34; without registration in Table API env.from(\u0026#34;MyTable\u0026#34;).select(call(classOf[HashFunction], $\u0026#34;myField\u0026#34;)) // register function env.createTemporarySystemFunction(\u0026#34;HashFunction\u0026#34;, classOf[HashFunction]) // call registered function in Table API env.from(\u0026#34;MyTable\u0026#34;).select(call(\u0026#34;HashFunction\u0026#34;, $\u0026#34;myField\u0026#34;)) // call registered function in SQL env.sqlQuery(\u0026#34;SELECT HashFunction(myField) FROM MyTable\u0026#34;) å¦‚æœä½ æ‰“ç®—ç”¨ Python å®ç°æˆ–è°ƒç”¨å‡½æ•°ï¼Œè¯·å‚è€ƒ Python Scalar Functions æ–‡æ¡£äº†è§£æ›´å¤šç»†èŠ‚ã€‚\nè¡¨å‡½æ•° ä¸ç”¨æˆ·å®šä¹‰çš„æ ‡é‡å‡½æ•°ç±»ä¼¼ï¼Œç”¨æˆ·å®šä¹‰çš„è¡¨å‡½æ•°å°†é›¶ã€ä¸€ä¸ªæˆ–å¤šä¸ªæ ‡é‡å€¼ä½œä¸ºè¾“å…¥å‚æ•°ã€‚ç„¶è€Œï¼Œä¸æ ‡é‡å‡½æ•°ä¸åŒçš„æ˜¯ï¼Œå®ƒå¯ä»¥è¿”å›ä»»æ„æ•°é‡çš„è¡Œï¼ˆæˆ–ç»“æ„åŒ–ç±»å‹ï¼‰ä½œä¸ºè¾“å‡ºï¼Œè€Œä¸æ˜¯å•ä¸ªå€¼ã€‚è¿”å›çš„è®°å½•å¯èƒ½ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µç»„æˆã€‚å¦‚æœä¸€æ¡è¾“å‡ºè®°å½•åªç”±ä¸€ä¸ªå­—æ®µç»„æˆï¼Œåˆ™å¯ä»¥çœç•¥ç»“æ„åŒ–è®°å½•ï¼Œå¹¶å‘å‡ºä¸€ä¸ªæ ‡é‡å€¼ã€‚å®ƒå°†è¢«è¿è¡Œæ—¶åŒ…è£…æˆä¸€ä¸ªéšå¼è¡Œã€‚\nä¸ºäº†å®šä¹‰ä¸€ä¸ªè¡¨å‡½æ•°ï¼Œå¿…é¡»æ‰©å±• org.apache.flink.table.function ä¸­çš„åŸºç±» TableFunctionï¼Œå¹¶å®ç°ä¸€ä¸ªæˆ–å¤šä¸ªåä¸º eval(...) çš„è¯„ä¼°æ–¹æ³•ã€‚ä¸å…¶ä»–å‡½æ•°ç±»ä¼¼ï¼Œè¾“å…¥å’Œè¾“å‡ºæ•°æ®ç±»å‹ä¹Ÿæ˜¯ä½¿ç”¨åå°„è‡ªåŠ¨æå–çš„ã€‚è¿™åŒ…æ‹¬ç±»çš„é€šç”¨å‚æ•° Tï¼Œç”¨äºç¡®å®šè¾“å‡ºæ•°æ®ç±»å‹ã€‚ä¸æ ‡é‡å‡½æ•°ä¸åŒçš„æ˜¯ï¼Œè¯„ä»·æ–¹æ³•æœ¬èº«ä¸èƒ½æœ‰è¿”å›ç±»å‹ï¼Œç›¸åï¼Œè¡¨å‡½æ•°æä¾›äº†ä¸€ä¸ª collect(T) æ–¹æ³•ï¼Œå¯ä»¥åœ¨æ¯ä¸ªè¯„ä»·æ–¹æ³•å†…è°ƒç”¨ï¼Œç”¨äºå‘å‡ºé›¶ã€ä¸€æ¡æˆ–å¤šæ¡è®°å½•ã€‚\nåœ¨è¡¨ API ä¸­ï¼Œè¡¨å‡½æ•°çš„ä½¿ç”¨æ–¹æ³•æ˜¯ .joinLateral(...) æˆ– .leftOuterJoinLateral(...)ã€‚joinLateral è¿ç®—ç¬¦ï¼ˆcrossï¼‰å°†å¤–è¡¨ï¼ˆè¿ç®—ç¬¦å·¦è¾¹çš„è¡¨ï¼‰çš„æ¯æ¡è®°å½•ä¸è¡¨å€¼å‡½æ•°äº§ç”Ÿçš„æ‰€æœ‰è®°å½•ï¼ˆè¡¨å€¼å‡½æ•°åœ¨è¿ç®—ç¬¦çš„å³è¾¹ï¼‰è¿æ¥èµ·æ¥ã€‚leftOuterJoinLateral æ“ä½œç¬¦å°†å¤–è¡¨ï¼ˆæ“ä½œç¬¦å·¦è¾¹çš„è¡¨ï¼‰çš„æ¯ä¸€æ¡è®°å½•ä¸è¡¨å€¼å‡½æ•°äº§ç”Ÿçš„æ‰€æœ‰è®°å½•ï¼ˆå®ƒåœ¨æ“ä½œç¬¦çš„å³è¾¹ï¼‰è¿æ¥èµ·æ¥ï¼Œå¹¶ä¸”ä¿ç•™é‚£äº›è¡¨å‡½æ•°è¿”å›ç©ºè¡¨çš„å¤–è¡¨ã€‚\nåœ¨ SQL ä¸­ï¼Œä½¿ç”¨ LATERAL TABLE(\u0026lt;TableFunction\u0026gt;) ä¸ JOIN æˆ– LEFT JOIN ä¸ ON TRUE è¿æ¥æ¡ä»¶ã€‚\nä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•å®šä¹‰è‡ªå·±çš„æ‹†åˆ†å‡½æ•°å¹¶åœ¨æŸ¥è¯¢ä¸­è°ƒç”¨å®ƒã€‚æ›´å¤šç»†èŠ‚è¯·å‚è§ã€Šå®ç°æŒ‡å—ã€‹ã€‚\nimport org.apache.flink.table.annotation.DataTypeHint import org.apache.flink.table.annotation.FunctionHint import org.apache.flink.table.api._ import org.apache.flink.table.functions.TableFunction import org.apache.flink.types.Row @FunctionHint(output = new DataTypeHint(\u0026#34;ROW\u0026lt;word STRING, length INT\u0026gt;\u0026#34;)) class SplitFunction extends TableFunction[Row] { def eval(str: String): Unit = { // use collect(...) to emit a row  str.split(\u0026#34; \u0026#34;).foreach(s =\u0026gt; collect(Row.of(s, Int.box(s.length)))) } } val env = TableEnvironment.create(...) // call function \u0026#34;inline\u0026#34; without registration in Table API env .from(\u0026#34;MyTable\u0026#34;) .joinLateral(call(classOf[SplitFunction], $\u0026#34;myField\u0026#34;) .select($\u0026#34;myField\u0026#34;, $\u0026#34;word\u0026#34;, $\u0026#34;length\u0026#34;) env .from(\u0026#34;MyTable\u0026#34;) .leftOuterJoinLateral(call(classOf[SplitFunction], $\u0026#34;myField\u0026#34;)) .select($\u0026#34;myField\u0026#34;, $\u0026#34;word\u0026#34;, $\u0026#34;length\u0026#34;) // rename fields of the function in Table API env .from(\u0026#34;MyTable\u0026#34;) .leftOuterJoinLateral(call(classOf[SplitFunction], $\u0026#34;myField\u0026#34;).as(\u0026#34;newWord\u0026#34;, \u0026#34;newLength\u0026#34;)) .select($\u0026#34;myField\u0026#34;, $\u0026#34;newWord\u0026#34;, $\u0026#34;newLength\u0026#34;) // register function env.createTemporarySystemFunction(\u0026#34;SplitFunction\u0026#34;, classOf[SplitFunction]) // call registered function in Table API env .from(\u0026#34;MyTable\u0026#34;) .joinLateral(call(\u0026#34;SplitFunction\u0026#34;, $\u0026#34;myField\u0026#34;)) .select($\u0026#34;myField\u0026#34;, $\u0026#34;word\u0026#34;, $\u0026#34;length\u0026#34;) env .from(\u0026#34;MyTable\u0026#34;) .leftOuterJoinLateral(call(\u0026#34;SplitFunction\u0026#34;, $\u0026#34;myField\u0026#34;)) .select($\u0026#34;myField\u0026#34;, $\u0026#34;word\u0026#34;, $\u0026#34;length\u0026#34;) // call registered function in SQL env.sqlQuery( \u0026#34;SELECT myField, word, length \u0026#34; + \u0026#34;FROM MyTable, LATERAL TABLE(SplitFunction(myField))\u0026#34;); env.sqlQuery( \u0026#34;SELECT myField, word, length \u0026#34; + \u0026#34;FROM MyTable \u0026#34; + \u0026#34;LEFT JOIN LATERAL TABLE(SplitFunction(myField)) ON TRUE\u0026#34;) // rename fields of the function in SQL env.sqlQuery( \u0026#34;SELECT myField, newWord, newLength \u0026#34; + \u0026#34;FROM MyTable \u0026#34; + \u0026#34;LEFT JOIN LATERAL TABLE(SplitFunction(myField)) AS T(newWord, newLength) ON TRUE\u0026#34;) å¦‚æœä½ æ‰“ç®—åœ¨ Scala ä¸­å®ç°å‡½æ•°ï¼Œä¸è¦å°†è¡¨å‡½æ•°å®ç°ä¸º Scala å¯¹è±¡ã€‚Scala å¯¹è±¡æ˜¯å•å­ï¼Œä¼šå¯¼è‡´å¹¶å‘é—®é¢˜ã€‚\nå¦‚æœä½ æ‰“ç®—ç”¨ Python å®ç°æˆ–è°ƒç”¨å‡½æ•°ï¼Œè¯·å‚è€ƒ Python è¡¨å‡½æ•°æ–‡æ¡£äº†è§£æ›´å¤šç»†èŠ‚ã€‚\nèšåˆå‡½æ•° ç”¨æˆ·è‡ªå®šä¹‰èšåˆå‡½æ•°ï¼ˆUDAGGï¼‰å°†ä¸€ä¸ªè¡¨ï¼ˆä¸€ä¸ªæˆ–å¤šä¸ªå…·æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§çš„è¡Œï¼‰èšåˆæˆä¸€ä¸ªæ ‡é‡å€¼ã€‚\nä¸Šå›¾æ˜¾ç¤ºäº†ä¸€ä¸ªèšåˆçš„ä¾‹å­ã€‚å‡è®¾ä½ æœ‰ä¸€ä¸ªåŒ…å«é¥®æ–™æ•°æ®çš„è¡¨ã€‚è¯¥è¡¨ç”± idã€åç§°å’Œä»·æ ¼ä¸‰åˆ—å’Œ 5 è¡Œç»„æˆã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä½ éœ€è¦æ‰¾åˆ°è¡¨ä¸­æ‰€æœ‰é¥®æ–™çš„æœ€é«˜ä»·æ ¼ï¼Œå³æ‰§è¡Œ max() èšåˆã€‚ä½ éœ€è¦å¯¹ 5 è¡Œä¸­çš„æ¯ä¸€è¡Œè¿›è¡Œæ£€æŸ¥ï¼Œç»“æœå°†æ˜¯ä¸€ä¸ªå•ä¸€çš„æ•°å€¼ã€‚\nç”¨æˆ·å®šä¹‰çš„èšåˆå‡½æ•°æ˜¯é€šè¿‡æ‰©å±• AggregateFunction ç±»æ¥å®ç°çš„ã€‚AggregateFunction çš„å·¥ä½œåŸç†å¦‚ä¸‹ã€‚é¦–å…ˆï¼Œå®ƒéœ€è¦ä¸€ä¸ªç´¯åŠ å™¨ï¼Œå®ƒæ˜¯å­˜æ”¾èšåˆä¸­é—´ç»“æœçš„æ•°æ®ç»“æ„ã€‚é€šè¿‡è°ƒç”¨ AggregateFunction çš„ createAccumulator() æ–¹æ³•åˆ›å»ºä¸€ä¸ªç©ºçš„ç´¯åŠ å™¨ã€‚éšåï¼Œå‡½æ•°çš„ accumulate() æ–¹æ³•å¯¹æ¯ä¸€æ¡è¾“å…¥è¡Œè¿›è¡Œè°ƒç”¨ï¼Œä»¥æ›´æ–°ç´¯åŠ å™¨ã€‚ä¸€æ—¦æ‰€æœ‰çš„è¡Œéƒ½è¢«å¤„ç†å®Œæ¯•ï¼Œå‡½æ•°çš„ getValue() æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨æ¥è®¡ç®—å¹¶è¿”å›æœ€ç»ˆç»“æœã€‚\nä»¥ä¸‹æ–¹æ³•æ˜¯æ¯ä¸ª AggregateFunction å¿…é¡»ä½¿ç”¨çš„ã€‚\n createAccumulator() accumulate() getValue()  Flink çš„ç±»å‹æå–è®¾æ–½å¯èƒ½æ— æ³•è¯†åˆ«å¤æ‚çš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚ï¼Œå¦‚æœå®ƒä»¬ä¸æ˜¯åŸºæœ¬ç±»å‹æˆ–ç®€å•çš„ POJOsã€‚æ‰€ä»¥ä¸ ScalarFunction å’Œ TableFunction ç±»ä¼¼ï¼ŒAggregateFunction æä¾›äº†æŒ‡å®šç»“æœç±»å‹ï¼ˆé€šè¿‡ AggregateFunction#getResultType()ï¼‰å’Œç´¯åŠ å™¨ç±»å‹ï¼ˆé€šè¿‡ AggregateFunction#getAccumulatorType()ï¼‰çš„æ–¹æ³•ã€‚\né™¤äº†ä¸Šè¿°æ–¹æ³•å¤–ï¼Œè¿˜æœ‰ä¸€äº›ç­¾çº¦æ–¹æ³•å¯ä»¥é€‰æ‹©å®ç°ã€‚è¿™äº›æ–¹æ³•ä¸­çš„ä¸€äº›æ–¹æ³•å¯ä»¥è®©ç³»ç»Ÿæ›´é«˜æ•ˆåœ°æ‰§è¡ŒæŸ¥è¯¢ï¼Œè€Œå¦ä¸€äº›æ–¹æ³•åˆ™æ˜¯æŸäº›ç”¨ä¾‹æ‰€å¿…é¡»çš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœèšåˆå‡½æ•°åº”è¯¥åœ¨ä¼šè¯ç»„çª—å£çš„ä¸Šä¸‹æ–‡ä¸­åº”ç”¨ï¼Œé‚£ä¹ˆ merge() æ–¹æ³•æ˜¯å¼ºåˆ¶æ€§çš„ï¼ˆå½“è§‚å¯Ÿåˆ°æœ‰ä¸€è¡Œ \u0026ldquo;è¿æ¥ \u0026ldquo;å®ƒä»¬æ—¶ï¼Œéœ€è¦å°†ä¸¤ä¸ªä¼šè¯çª—å£çš„ç´¯åŠ å™¨è¿æ¥èµ·æ¥ï¼‰ã€‚\nAggregateFunction çš„ä»¥ä¸‹æ–¹æ³•æ˜¯æ ¹æ®ç”¨ä¾‹éœ€è¦çš„ã€‚\n retract() å¯¹äºæœ‰ç•Œ OVER çª—å£ä¸Šçš„èšåˆæ˜¯éœ€è¦çš„ã€‚ merge() æ˜¯è®¸å¤šæ‰¹æ¬¡èšåˆå’Œä¼šè¯çª—å£èšåˆæ‰€éœ€è¦çš„ã€‚ resetAccumulator() æ˜¯è®¸å¤šæ‰¹å¤„ç†èšåˆæ‰€éœ€è¦çš„ã€‚  AggregateFunction çš„æ‰€æœ‰æ–¹æ³•éƒ½å¿…é¡»å£°æ˜ä¸º publicï¼Œè€Œä¸æ˜¯ staticï¼Œå¹¶ä¸”å‘½åä¸ä¸Šè¿°åç§°å®Œå…¨ä¸€è‡´ã€‚æ–¹æ³• createAccumulatorã€getValueã€getResultType å’Œ getAccumulatorType æ˜¯åœ¨ AggregateFunction æŠ½è±¡ç±»ä¸­å®šä¹‰çš„ï¼Œè€Œå…¶ä»–æ–¹æ³•åˆ™æ˜¯åˆåŒæ–¹æ³•ã€‚ä¸ºäº†å®šä¹‰ä¸€ä¸ªèšåˆå‡½æ•°ï¼Œå¿…é¡»æ‰©å±•åŸºç±» org.apache.flink.table.function.AggregateFunctionï¼Œå¹¶å®ç°ä¸€ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰accumulate æ–¹æ³•ã€‚æ–¹æ³• accumulate å¯ä»¥ç”¨ä¸åŒçš„å‚æ•°ç±»å‹é‡è½½ï¼Œå¹¶æ”¯æŒå˜é‡å‚æ•°ã€‚\nä¸‹é¢ç»™å‡ºäº† AggregateFunction æ‰€æœ‰æ–¹æ³•çš„è¯¦ç»†æ–‡æ¡£ã€‚\n/** * Base class for user-defined aggregates and table aggregates. * * @tparam T the type of the aggregation result. * @tparam ACC the type of the aggregation accumulator. The accumulator is used to keep the * aggregated values which are needed to compute an aggregation result. */ abstract class UserDefinedAggregateFunction[T, ACC] extends UserDefinedFunction { /** * Creates and init the Accumulator for this (table)aggregate function. * * @return the accumulator with the initial value */ def createAccumulator(): ACC // MANDATORY  /** * Returns the TypeInformation of the (table)aggregate function\u0026#39;s result. * * @return The TypeInformation of the (table)aggregate function\u0026#39;s result or null if the result * type should be automatically inferred. */ def getResultType: TypeInformation[T] = null // PRE-DEFINED  /** * Returns the TypeInformation of the (table)aggregate function\u0026#39;s accumulator. * * @return The TypeInformation of the (table)aggregate function\u0026#39;s accumulator or null if the * accumulator type should be automatically inferred. */ def getAccumulatorType: TypeInformation[ACC] = null // PRE-DEFINED } /** * Base class for aggregation functions. * * @tparam T the type of the aggregation result * @tparam ACC the type of the aggregation accumulator. The accumulator is used to keep the * aggregated values which are needed to compute an aggregation result. * AggregateFunction represents its state using accumulator, thereby the state of the * AggregateFunction must be put into the accumulator. */ abstract class AggregateFunction[T, ACC] extends UserDefinedAggregateFunction[T, ACC] { /** * Processes the input values and update the provided accumulator instance. The method * accumulate can be overloaded with different custom types and arguments. An AggregateFunction * requires at least one accumulate() method. * * @param accumulator the accumulator which contains the current aggregated results * @param [user defined inputs] the input value (usually obtained from a new arrived data). */ def accumulate(accumulator: ACC, [user defined inputs]): Unit // MANDATORY  /** * Retracts the input values from the accumulator instance. The current design assumes the * inputs are the values that have been previously accumulated. The method retract can be * overloaded with different custom types and arguments. This function must be implemented for * datastream bounded over aggregate. * * @param accumulator the accumulator which contains the current aggregated results * @param [user defined inputs] the input value (usually obtained from a new arrived data). */ def retract(accumulator: ACC, [user defined inputs]): Unit // OPTIONAL  /** * Merges a group of accumulator instances into one accumulator instance. This function must be * implemented for datastream session window grouping aggregate and dataset grouping aggregate. * * @param accumulator the accumulator which will keep the merged aggregate results. It should * be noted that the accumulator may contain the previous aggregated * results. Therefore user should not replace or clean this instance in the * custom merge method. * @param its an [[java.lang.Iterable]] pointed to a group of accumulators that will be * merged. */ def merge(accumulator: ACC, its: java.lang.Iterable[ACC]): Unit // OPTIONAL  /** * Called every time when an aggregation result should be materialized. * The returned value could be either an early and incomplete result * (periodically emitted as data arrive) or the final result of the * aggregation. * * @param accumulator the accumulator which contains the current * aggregated results * @return the aggregation result */ def getValue(accumulator: ACC): T // MANDATORY  /** * Resets the accumulator for this [[AggregateFunction]]. This function must be implemented for * dataset grouping aggregate. * * @param accumulator the accumulator which needs to be reset */ def resetAccumulator(accumulator: ACC): Unit // OPTIONAL  /** * Returns true if this AggregateFunction can only be applied in an OVER window. * * @return true if the AggregateFunction requires an OVER window, false otherwise. */ def requiresOver: Boolean = false // PRE-DEFINED } ä¸‹é¢çš„ä¾‹å­è¯´æ˜äº†å¦‚ä½•è¿›è¡Œ\n å®šä¹‰ä¸€ä¸ª AggregateFunctionï¼Œç”¨äºè®¡ç®—ç»™å®šåˆ—çš„åŠ æƒå¹³å‡å€¼ã€‚ åœ¨ TableEnvironment ä¸­æ³¨å†Œè¯¥å‡½æ•°ï¼Œå¹¶ä¸” åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨è¯¥å‡½æ•°ã€‚  ä¸ºäº†è®¡ç®—åŠ æƒå¹³å‡å€¼ï¼Œç´¯åŠ å™¨éœ€è¦å­˜å‚¨æ‰€æœ‰å·²ç§¯ç´¯çš„æ•°æ®çš„åŠ æƒå’Œå’Œè®¡æ•°ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç±» WeightedAvgAccum ä½œä¸ºç´¯åŠ å™¨ã€‚ç´¯ç§¯å™¨ç”± Flink çš„æ£€æŸ¥ç‚¹æœºåˆ¶è‡ªåŠ¨å¤‡ä»½ï¼Œå¹¶åœ¨æ•…éšœæ—¶æ¢å¤ï¼Œä»¥ä¿è¯ç²¾ç¡®çš„å”¯ä¸€æ€§è¯­ä¹‰ã€‚\næˆ‘ä»¬ WeightedAvg AggregateFunction çš„ accumulate() æ–¹æ³•æœ‰ä¸‰ä¸ªè¾“å…¥ã€‚ç¬¬ä¸€ä¸ªæ˜¯ WeightedAvgAccum ç´¯åŠ å™¨ï¼Œå¦å¤–ä¸¤ä¸ªæ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„è¾“å…¥ï¼šè¾“å…¥å€¼ ivalue å’Œè¾“å…¥çš„æƒé‡ iweightã€‚è™½ç„¶ retract()ã€merge() å’Œ resetAccumulator() æ–¹æ³•å¯¹äºå¤§å¤šæ•°èšåˆç±»å‹æ¥è¯´å¹¶ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œä½†æˆ‘ä»¬åœ¨ä¸‹é¢æä¾›å®ƒä»¬ä½œä¸ºä¾‹å­ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨ Scala ç¤ºä¾‹ä¸­ä½¿ç”¨äº† Java åŸºå…ƒç±»å‹ï¼Œå¹¶å®šä¹‰äº† getResultType() å’Œ getAccumulatorType() æ–¹æ³•ï¼Œå› ä¸º Flink ç±»å‹æå–å¯¹äº Scala ç±»å‹å¹¶ä¸ååˆ†æœ‰æ•ˆã€‚\nimport java.lang.{Long =\u0026gt; JLong, Integer =\u0026gt; JInteger} import org.apache.flink.api.java.tuple.{Tuple1 =\u0026gt; JTuple1} import org.apache.flink.api.java.typeutils.TupleTypeInfo import org.apache.flink.table.api.Types import org.apache.flink.table.functions.AggregateFunction /** * Accumulator for WeightedAvg. */ class WeightedAvgAccum extends JTuple1[JLong, JInteger] { sum = 0L count = 0 } /** * Weighted Average user-defined aggregate function. */ class WeightedAvg extends AggregateFunction[JLong, CountAccumulator] { override def createAccumulator(): WeightedAvgAccum = { new WeightedAvgAccum } override def getValue(acc: WeightedAvgAccum): JLong = { if (acc.count == 0) { null } else { acc.sum / acc.count } } def accumulate(acc: WeightedAvgAccum, iValue: JLong, iWeight: JInteger): Unit = { acc.sum += iValue * iWeight acc.count += iWeight } def retract(acc: WeightedAvgAccum, iValue: JLong, iWeight: JInteger): Unit = { acc.sum -= iValue * iWeight acc.count -= iWeight } def merge(acc: WeightedAvgAccum, it: java.lang.Iterable[WeightedAvgAccum]): Unit = { val iter = it.iterator() while (iter.hasNext) { val a = iter.next() acc.count += a.count acc.sum += a.sum } } def resetAccumulator(acc: WeightedAvgAccum): Unit = { acc.count = 0 acc.sum = 0L } override def getAccumulatorType: TypeInformation[WeightedAvgAccum] = { new TupleTypeInfo(classOf[WeightedAvgAccum], Types.LONG, Types.INT) } override def getResultType: TypeInformation[JLong] = Types.LONG } // register function val tEnv: StreamTableEnvironment = ??? tEnv.registerFunction(\u0026#34;wAvg\u0026#34;, new WeightedAvg()) // use function tEnv.sqlQuery(\u0026#34;SELECT user, wAvg(points, level) AS avgPoints FROM userScores GROUP BY user\u0026#34;) è¡¨èšåˆå‡½æ•° ç”¨æˆ·å®šä¹‰è¡¨èšåˆå‡½æ•°(UDTAGGs)å°†ä¸€ä¸ªè¡¨(å…·æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå±æ€§çš„ä¸€è¡Œæˆ–å¤šè¡Œ)èšåˆåˆ°ä¸€ä¸ªå…·æœ‰å¤šè¡Œå’Œå¤šåˆ—çš„ç»“æœè¡¨ã€‚\nä¸Šå›¾æ˜¾ç¤ºäº†ä¸€ä¸ªè¡¨èšåˆçš„ä¾‹å­ã€‚å‡è®¾ä½ æœ‰ä¸€ä¸ªåŒ…å«é¥®æ–™æ•°æ®çš„è¡¨ã€‚è¯¥è¡¨ç”± idã€åç§°å’Œä»·æ ¼ä¸‰åˆ—å’Œ 5 è¡Œç»„æˆã€‚è®¾æƒ³ä½ éœ€è¦æ‰¾åˆ°è¡¨ä¸­æ‰€æœ‰é¥®æ–™ä¸­ä»·æ ¼æœ€é«˜çš„å‰ 2 åï¼Œå³æ‰§è¡Œ top2() è¡¨èšåˆã€‚ä½ éœ€è¦å¯¹ 5 è¡Œä¸­çš„æ¯ä¸€è¡Œè¿›è¡Œæ£€æŸ¥ï¼Œç»“æœå°†æ˜¯ä¸€ä¸ªå…·æœ‰å‰ 2 ä¸ªå€¼çš„è¡¨ã€‚\nç”¨æˆ·å®šä¹‰çš„è¡¨èšåˆå‡½æ•°æ˜¯é€šè¿‡æ‰©å±• TableAggregateFunction ç±»æ¥å®ç°çš„ã€‚TableAggregateFunction çš„å·¥ä½œåŸç†å¦‚ä¸‹ã€‚é¦–å…ˆï¼Œå®ƒéœ€è¦ä¸€ä¸ªç´¯åŠ å™¨ï¼Œå®ƒæ˜¯å­˜æ”¾èšåˆä¸­é—´ç»“æœçš„æ•°æ®ç»“æ„ã€‚é€šè¿‡è°ƒç”¨ TableAggregateFunction çš„ createAccumulator() æ–¹æ³•åˆ›å»ºä¸€ä¸ªç©ºçš„ç´¯åŠ å™¨ã€‚éšåï¼Œå¯¹æ¯ä¸€æ¡è¾“å…¥è¡Œè°ƒç”¨å‡½æ•°çš„ accumulate() æ–¹æ³•æ¥æ›´æ–°ç´¯åŠ å™¨ã€‚ä¸€æ—¦æ‰€æœ‰çš„è¡Œéƒ½è¢«å¤„ç†å®Œæ¯•ï¼Œå‡½æ•°çš„ emitValue() æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨æ¥è®¡ç®—å¹¶è¿”å›æœ€ç»ˆç»“æœã€‚\nä»¥ä¸‹æ–¹æ³•æ˜¯æ¯ä¸ª TableAggregateFunction å¿…é¡»ä½¿ç”¨çš„ã€‚\n createAccumulator() accumulate()  Flink çš„ç±»å‹æå–è®¾æ–½å¯èƒ½æ— æ³•è¯†åˆ«å¤æ‚çš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚ï¼Œå¦‚æœå®ƒä»¬ä¸æ˜¯åŸºæœ¬ç±»å‹æˆ–ç®€å•çš„ POJOsã€‚å› æ­¤ï¼Œä¸ ScalarFunction å’Œ TableFunction ç±»ä¼¼ï¼ŒTableAggregateFunction æä¾›äº†æŒ‡å®šç»“æœç±»å‹ï¼ˆé€šè¿‡ TableAggregateFunction#getResultType()ï¼‰å’Œç´¯ç§¯å™¨ç±»å‹ï¼ˆé€šè¿‡ TableAggregateFunction#getAccumulatorType()ï¼‰çš„æ–¹æ³•ã€‚\né™¤äº†ä¸Šè¿°æ–¹æ³•å¤–ï¼Œè¿˜æœ‰ä¸€äº›ç­¾çº¦æ–¹æ³•å¯ä»¥é€‰æ‹©å®ç°ã€‚è¿™äº›æ–¹æ³•ä¸­çš„ä¸€äº›æ–¹æ³•å¯ä»¥è®©ç³»ç»Ÿæ›´é«˜æ•ˆåœ°æ‰§è¡ŒæŸ¥è¯¢ï¼Œè€Œå¦ä¸€äº›æ–¹æ³•åˆ™æ˜¯æŸäº›ç”¨ä¾‹æ‰€å¿…é¡»çš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœèšåˆå‡½æ•°åº”è¯¥åœ¨ä¼šè¯ç»„çª—å£çš„ä¸Šä¸‹æ–‡ä¸­åº”ç”¨ï¼Œé‚£ä¹ˆ merge() æ–¹æ³•æ˜¯å¼ºåˆ¶æ€§çš„ï¼ˆå½“è§‚å¯Ÿåˆ°æœ‰ä¸€æ¡è®°å½•\u0026quot;è¿æ¥\u0026quot;å®ƒä»¬æ—¶ï¼Œéœ€è¦å°†ä¸¤ä¸ªä¼šè¯çª—å£çš„ç´¯åŠ å™¨è¿æ¥èµ·æ¥ï¼‰ã€‚\nTableAggregateFunction çš„ä»¥ä¸‹æ–¹æ³•æ˜¯éœ€è¦çš„ï¼Œè¿™å–å†³äºç”¨ä¾‹ã€‚\n retract() å¯¹äºæœ‰ç•Œ OVER çª—å£ä¸Šçš„èšåˆæ˜¯éœ€è¦çš„ã€‚ merge() æ˜¯è®¸å¤šæ‰¹æ¬¡èšåˆå’Œä¼šè¯çª—å£èšåˆæ‰€éœ€è¦çš„ã€‚ resetAccumulator() æ˜¯è®¸å¤šæ‰¹å¤„ç†èšåˆæ‰€éœ€è¦çš„ã€‚ emitValue() æ˜¯æ‰¹å¤„ç†å’Œçª—å£èšåˆæ‰€éœ€è¦çš„ã€‚  TableAggregateFunction çš„ä»¥ä¸‹æ–¹æ³•ç”¨äºæé«˜æµä½œä¸šçš„æ€§èƒ½ã€‚\n emitUpdateWithRetract() ç”¨äºå‘å°„åœ¨ä¼¸ç¼©æ¨¡å¼ä¸‹æ›´æ–°çš„å€¼ã€‚  å¯¹äº emitValue æ–¹æ³•ï¼Œåˆ™æ˜¯æ ¹æ®ç´¯åŠ å™¨æ¥å‘å°„å®Œæ•´çš„æ•°æ®ã€‚ä»¥ TopN ä¸ºä¾‹ï¼ŒemitValue æ¯æ¬¡éƒ½ä¼šå‘å°„æ‰€æœ‰å‰ n ä¸ªå€¼ã€‚è¿™å¯èƒ½ä¼šç»™æµå¼ä½œä¸šå¸¦æ¥æ€§èƒ½é—®é¢˜ã€‚ä¸ºäº†æé«˜æ€§èƒ½ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥å®ç° emitUpdateWithRetract æ–¹æ³•æ¥æé«˜æ€§èƒ½ã€‚è¯¥æ–¹æ³•ä»¥å›ç¼©æ¨¡å¼å¢é‡è¾“å‡ºæ•°æ®ï¼Œå³ä¸€æ—¦æœ‰æ›´æ–°ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨å‘é€æ–°çš„æ›´æ–°è®°å½•ä¹‹å‰å›ç¼©æ—§è®°å½•ã€‚å¦‚æœåœ¨è¡¨èšåˆå‡½æ•°ä¸­éƒ½å®šä¹‰äº†è¯¥æ–¹æ³•ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•å°†ä¼˜å…ˆäº emitValue æ–¹æ³•ä½¿ç”¨ï¼Œå› ä¸º emitUpdateWithRetract è¢«è®¤ä¸ºæ¯” emitValue æ›´æœ‰æ•ˆç‡ï¼Œå› ä¸ºå®ƒå¯ä»¥å¢é‡è¾“å‡ºå€¼ã€‚\nTableAggregateFunction çš„æ‰€æœ‰æ–¹æ³•éƒ½å¿…é¡»å£°æ˜ä¸º publicï¼Œè€Œä¸æ˜¯ staticï¼Œå¹¶å®Œå…¨æŒ‰ç…§ä¸Šé¢æåˆ°çš„åå­—å‘½åã€‚æ–¹æ³• createAccumulatorã€getResultType å’Œ getAccumulatorType æ˜¯åœ¨ TableAggregateFunction çš„çˆ¶æŠ½è±¡ç±»ä¸­å®šä¹‰çš„ï¼Œè€Œå…¶ä»–æ–¹æ³•åˆ™æ˜¯æ”¶ç¼©çš„æ–¹æ³•ã€‚ä¸ºäº†å®šä¹‰ä¸€ä¸ªè¡¨èšåˆå‡½æ•°ï¼Œå¿…é¡»æ‰©å±•åŸºç±» org.apache.flink.table.function.TableAggregateFunctionï¼Œå¹¶å®ç°ä¸€ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰accumulate æ–¹æ³•ã€‚ç§¯ç´¯æ–¹æ³•å¯ä»¥ç”¨ä¸åŒçš„å‚æ•°ç±»å‹é‡è½½ï¼Œå¹¶æ”¯æŒå˜é‡å‚æ•°ã€‚\nä¸‹é¢ç»™å‡ºäº† TableAggregateFunction æ‰€æœ‰æ–¹æ³•çš„è¯¦ç»†æ–‡æ¡£ã€‚\n/** * Base class for user-defined aggregates and table aggregates. * * @tparam T the type of the aggregation result. * @tparam ACC the type of the aggregation accumulator. The accumulator is used to keep the * aggregated values which are needed to compute an aggregation result. */ abstract class UserDefinedAggregateFunction[T, ACC] extends UserDefinedFunction { /** * Creates and init the Accumulator for this (table)aggregate function. * * @return the accumulator with the initial value */ def createAccumulator(): ACC // MANDATORY  /** * Returns the TypeInformation of the (table)aggregate function\u0026#39;s result. * * @return The TypeInformation of the (table)aggregate function\u0026#39;s result or null if the result * type should be automatically inferred. */ def getResultType: TypeInformation[T] = null // PRE-DEFINED  /** * Returns the TypeInformation of the (table)aggregate function\u0026#39;s accumulator. * * @return The TypeInformation of the (table)aggregate function\u0026#39;s accumulator or null if the * accumulator type should be automatically inferred. */ def getAccumulatorType: TypeInformation[ACC] = null // PRE-DEFINED } /** * Base class for table aggregation functions. * * @tparam T the type of the aggregation result * @tparam ACC the type of the aggregation accumulator. The accumulator is used to keep the * aggregated values which are needed to compute an aggregation result. * TableAggregateFunction represents its state using accumulator, thereby the state of * the TableAggregateFunction must be put into the accumulator. */ abstract class TableAggregateFunction[T, ACC] extends UserDefinedAggregateFunction[T, ACC] { /** * Processes the input values and update the provided accumulator instance. The method * accumulate can be overloaded with different custom types and arguments. A TableAggregateFunction * requires at least one accumulate() method. * * @param accumulator the accumulator which contains the current aggregated results * @param [user defined inputs] the input value (usually obtained from a new arrived data). */ def accumulate(accumulator: ACC, [user defined inputs]): Unit // MANDATORY  /** * Retracts the input values from the accumulator instance. The current design assumes the * inputs are the values that have been previously accumulated. The method retract can be * overloaded with different custom types and arguments. This function must be implemented for * datastream bounded over aggregate. * * @param accumulator the accumulator which contains the current aggregated results * @param [user defined inputs] the input value (usually obtained from a new arrived data). */ def retract(accumulator: ACC, [user defined inputs]): Unit // OPTIONAL  /** * Merges a group of accumulator instances into one accumulator instance. This function must be * implemented for datastream session window grouping aggregate and dataset grouping aggregate. * * @param accumulator the accumulator which will keep the merged aggregate results. It should * be noted that the accumulator may contain the previous aggregated * results. Therefore user should not replace or clean this instance in the * custom merge method. * @param its an [[java.lang.Iterable]] pointed to a group of accumulators that will be * merged. */ def merge(accumulator: ACC, its: java.lang.Iterable[ACC]): Unit // OPTIONAL  /** * Called every time when an aggregation result should be materialized. The returned value * could be either an early and incomplete result (periodically emitted as data arrive) or * the final result of the aggregation. * * @param accumulator the accumulator which contains the current * aggregated results * @param out the collector used to output data */ def emitValue(accumulator: ACC, out: Collector[T]): Unit // OPTIONAL  /** * Called every time when an aggregation result should be materialized. The returned value * could be either an early and incomplete result (periodically emitted as data arrive) or * the final result of the aggregation. * * Different from emitValue, emitUpdateWithRetract is used to emit values that have been updated. * This method outputs data incrementally in retract mode, i.e., once there is an update, we * have to retract old records before sending new updated ones. The emitUpdateWithRetract * method will be used in preference to the emitValue method if both methods are defined in the * table aggregate function, because the method is treated to be more efficient than emitValue * as it can outputvalues incrementally. * * @param accumulator the accumulator which contains the current * aggregated results * @param out the retractable collector used to output data. Use collect method * to output(add) records and use retract method to retract(delete) * records. */ def emitUpdateWithRetract(accumulator: ACC, out: RetractableCollector[T]): Unit // OPTIONAL  /** * Collects a record and forwards it. The collector can output retract messages with the retract * method. Note: only use it in `emitRetractValueIncrementally`. */ trait RetractableCollector[T] extends Collector[T] { /** * Retract a record. * * @param record The record to retract. */ def retract(record: T): Unit } } ä¸‹é¢çš„ä¾‹å­è¯´æ˜äº†å¦‚ä½•è¿›è¡Œ\n å®šä¹‰ä¸€ä¸ª TableAggregateFunctionï¼Œç”¨äºè®¡ç®—ç»™å®šåˆ—ä¸Šçš„å‰ 2 ä¸ªå€¼ã€‚ åœ¨ TableEnvironment ä¸­æ³¨å†Œè¯¥å‡½æ•°ï¼Œå¹¶ä¸” åœ¨ Table API æŸ¥è¯¢ä¸­ä½¿ç”¨è¯¥å‡½æ•°(TableAggregateFunction ä»…ç”± Table API æ”¯æŒ)ã€‚  ä¸ºäº†è®¡ç®—å‰ 2 åçš„å€¼ï¼Œç´¯åŠ å™¨éœ€è¦å­˜å‚¨æ‰€æœ‰å·²ç§¯ç´¯çš„æ•°æ®ä¸­æœ€å¤§çš„ 2 ä¸ªå€¼ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç±» Top2Accum ä½œä¸ºç´¯åŠ å™¨ã€‚ç´¯ç§¯å™¨ä¼šè¢« Flink çš„æ£€æŸ¥ç‚¹æœºåˆ¶è‡ªåŠ¨å¤‡ä»½ï¼Œå¹¶åœ¨æ•…éšœæ—¶æ¢å¤ï¼Œä»¥ä¿è¯ç²¾ç¡®çš„ once è¯­ä¹‰ã€‚\næˆ‘ä»¬ Top2 TableAggregateFunction çš„ accumulate() æ–¹æ³•æœ‰ä¸¤ä¸ªè¾“å…¥ã€‚ç¬¬ä¸€ä¸ªæ˜¯ Top2Accum ç´¯åŠ å™¨ï¼Œå¦ä¸€ä¸ªæ˜¯ç”¨æˆ·å®šä¹‰çš„è¾“å…¥ï¼šè¾“å…¥å€¼ vï¼Œè™½ç„¶ merge() æ–¹æ³•å¯¹äºå¤§å¤šæ•°è¡¨èšåˆç±»å‹æ¥è¯´ä¸æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œä½†æˆ‘ä»¬åœ¨ä¸‹é¢æä¾›å®ƒä½œä¸ºä¾‹å­ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨ Scala ç¤ºä¾‹ä¸­ä½¿ç”¨äº† Java åŸºå…ƒç±»å‹ï¼Œå¹¶å®šä¹‰äº† getResultType() å’Œ getAccumulatorType() æ–¹æ³•ï¼Œå› ä¸º Flink ç±»å‹æå–å¯¹ Scala ç±»å‹çš„æ•ˆæœå¹¶ä¸å¥½ã€‚\nimport java.lang.{Integer =\u0026gt; JInteger} import org.apache.flink.table.api.Types import org.apache.flink.table.functions.TableAggregateFunction /** * Accumulator for top2. */ class Top2Accum { var first: JInteger = _ var second: JInteger = _ } /** * The top2 user-defined table aggregate function. */ class Top2 extends TableAggregateFunction[JTuple2[JInteger, JInteger], Top2Accum] { override def createAccumulator(): Top2Accum = { val acc = new Top2Accum acc.first = Int.MinValue acc.second = Int.MinValue acc } def accumulate(acc: Top2Accum, v: Int) { if (v \u0026gt; acc.first) { acc.second = acc.first acc.first = v } else if (v \u0026gt; acc.second) { acc.second = v } } def merge(acc: Top2Accum, its: JIterable[Top2Accum]): Unit = { val iter = its.iterator() while (iter.hasNext) { val top2 = iter.next() accumulate(acc, top2.first) accumulate(acc, top2.second) } } def emitValue(acc: Top2Accum, out: Collector[JTuple2[JInteger, JInteger]]): Unit = { // emit the value and rank  if (acc.first != Int.MinValue) { out.collect(JTuple2.of(acc.first, 1)) } if (acc.second != Int.MinValue) { out.collect(JTuple2.of(acc.second, 2)) } } } // init table val tab = ... // use function tab .groupBy(\u0026#39;key) .flatAggregate(top2(\u0026#39;a) as (\u0026#39;v, \u0026#39;rank)) .select(\u0026#39;key, \u0026#39;v, \u0026#39;rank) ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ emitUpdateWithRetract æ–¹æ³•æ¥åªå‘é€æ›´æ–°ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œä¸ºäº†åªå‘å‡ºæ›´æ–°ï¼Œç´¯åŠ å™¨åŒæ—¶ä¿ç•™æ–°æ—§ top2 çš„å€¼ã€‚æ³¨æ„ï¼šå¦‚æœ topN çš„ N å¾ˆå¤§ï¼Œé‚£ä¹ˆåŒæ—¶ä¿ç•™æ–°æ—§å€¼çš„æ•ˆç‡å¯èƒ½å¾ˆä½ã€‚è§£å†³è¿™ç§æƒ…å†µçš„æ–¹æ³•ä¹‹ä¸€æ˜¯åœ¨ç´¯åŠ æ–¹æ³•ä¸­æŠŠè¾“å…¥çš„è®°å½•å­˜å‚¨åˆ°ç´¯åŠ å™¨ä¸­ï¼Œç„¶ååœ¨ emitUpdateWithRetract ä¸­è¿›è¡Œè®¡ç®—ã€‚\nimport java.lang.{Integer =\u0026gt; JInteger} import org.apache.flink.table.api.Types import org.apache.flink.table.functions.TableAggregateFunction /** * Accumulator for top2. */ class Top2Accum { var first: JInteger = _ var second: JInteger = _ var oldFirst: JInteger = _ var oldSecond: JInteger = _ } /** * The top2 user-defined table aggregate function. */ class Top2 extends TableAggregateFunction[JTuple2[JInteger, JInteger], Top2Accum] { override def createAccumulator(): Top2Accum = { val acc = new Top2Accum acc.first = Int.MinValue acc.second = Int.MinValue acc.oldFirst = Int.MinValue acc.oldSecond = Int.MinValue acc } def accumulate(acc: Top2Accum, v: Int) { if (v \u0026gt; acc.first) { acc.second = acc.first acc.first = v } else if (v \u0026gt; acc.second) { acc.second = v } } def emitUpdateWithRetract( acc: Top2Accum, out: RetractableCollector[JTuple2[JInteger, JInteger]]) : Unit = { if (acc.first != acc.oldFirst) { // if there is an update, retract old value then emit new value.  if (acc.oldFirst != Int.MinValue) { out.retract(JTuple2.of(acc.oldFirst, 1)) } out.collect(JTuple2.of(acc.first, 1)) acc.oldFirst = acc.first } if (acc.second != acc.oldSecond) { // if there is an update, retract old value then emit new value.  if (acc.oldSecond != Int.MinValue) { out.retract(JTuple2.of(acc.oldSecond, 2)) } out.collect(JTuple2.of(acc.second, 2)) acc.oldSecond = acc.second } } } // init table val tab = ... // use function tab .groupBy(\u0026#39;key) .flatAggregate(top2(\u0026#39;a) as (\u0026#39;v, \u0026#39;rank)) .select(\u0026#39;key, \u0026#39;v, \u0026#39;rank) åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/functions/udfs.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-table-api-user-defined-functions/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL","Function"],"title":"ç”¨æˆ·å®šä¹‰å‡½æ•°"},{"categories":["Flink"],"contents":"ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•° å¤§å¤šæ•°æ“ä½œç¬¦éƒ½éœ€è¦ç”¨æˆ·å®šä¹‰çš„å‡½æ•°ã€‚æœ¬èŠ‚åˆ—å‡ºäº†å¦‚ä½•æŒ‡å®šè¿™äº›å‡½æ•°çš„ä¸åŒæ–¹æ³•ã€‚æˆ‘ä»¬è¿˜æ¶µç›–äº†ç´¯åŠ å™¨ï¼Œå®ƒå¯ä»¥ç”¨æ¥æ·±å…¥äº†è§£æ‚¨çš„ Flink åº”ç”¨ç¨‹åºã€‚\nLambda å‡½æ•° åœ¨å‰é¢çš„ä¾‹å­ä¸­å·²ç»çœ‹åˆ°ï¼Œæ‰€æœ‰çš„æ“ä½œç¬¦éƒ½æ¥å— lambda å‡½æ•°æ¥æè¿°æ“ä½œã€‚\nval data: DataSet[String] = // [...] data.filter { _.startsWith(\u0026#34;http://\u0026#34;) } val data: DataSet[Int] = // [...] data.reduce { (i1,i2) =\u0026gt; i1 + i2 } // æˆ– data.reduce { _ + _ } å¯Œå‡½æ•°(Rich functions) æ‰€æœ‰ä»¥ lambda å‡½æ•°ä½œä¸ºå‚æ•°çš„å˜æ¢éƒ½å¯ä»¥ä»¥å¯Œå‡½æ•°ä½œä¸ºå‚æ•°ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ä½¿ç”¨:\ndata.map { x =\u0026gt; x.toInt } ä½ å¯ä»¥ç¼–å†™:\nclass MyMapFunction extends RichMapFunction[String, Int] { def map(in: String):Int = { in.toInt } }; å¹¶å°†è¯¥å‡½æ•°ä¼ é€’ç»™ map è½¬æ¢:\ndata.map(new MyMapFunction()) ä¸°å¯Œçš„å‡½æ•°ä¹Ÿå¯ä»¥å®šä¹‰ä¸ºåŒ¿åç±»:\ndata.map (new RichMapFunction[String, Int] { def map(in: String):Int = { in.toInt } }) ä¸°å¯Œçš„å‡½æ•°é™¤äº†æä¾›ç”¨æˆ·å®šä¹‰çš„å‡½æ•°ï¼ˆmapã€reduceç­‰ï¼‰å¤–ï¼Œè¿˜æä¾›äº†å››ä¸ªæ–¹æ³•ï¼šopenã€closeã€getRuntimeContext å’Œ setRuntimeContextã€‚è¿™äº›æ–¹æ³•å¯ä»¥ç”¨äºä¸ºå‡½æ•°è®¾ç½®å‚æ•°ï¼ˆå‚è§ Passing Parameters to Functionsï¼‰ã€åˆ›å»ºå’Œæœ€ç»ˆç¡®å®šå±€éƒ¨çŠ¶æ€ã€è®¿é—®å¹¿æ’­å˜é‡ï¼ˆå‚è§ Broadcast Variablesï¼‰ã€è®¿é—®è¿è¡Œæ—¶ä¿¡æ¯ï¼Œå¦‚ç´¯åŠ å™¨å’Œè®¡æ•°å™¨ï¼ˆå‚è§ Accumulators and Countersï¼‰ä»¥åŠè¿­ä»£ä¿¡æ¯ï¼ˆå‚è§ Iterationsï¼‰ã€‚\nç´¯ç§¯å™¨å’Œè®¡æ•°å™¨ ç´¯ç§¯å™¨æ˜¯ä¸€ä¸ªç®€å•çš„æ„é€ ï¼Œæœ‰ä¸€ä¸ªåŠ æ³•è¿ç®—å’Œä¸€ä¸ªæœ€ç»ˆçš„ç´¯ç§¯ç»“æœï¼Œåœ¨ä½œä¸šç»“æŸåå°±å¯ä»¥ä½¿ç”¨ã€‚\næœ€ç›´æ¥çš„ç´¯åŠ å™¨æ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œä½ å¯ä»¥ä½¿ç”¨ Accumulator.add(V value) æ–¹æ³•å¯¹å®ƒè¿›è¡Œå¢é‡ã€‚åœ¨ä½œä¸šç»“æŸæ—¶ï¼ŒFlink å°†å¯¹æ‰€æœ‰éƒ¨åˆ†ç»“æœè¿›è¡ŒåŠ æ€»ï¼ˆåˆå¹¶ï¼‰å¹¶å°†ç»“æœå‘é€ç»™å®¢æˆ·ç«¯ã€‚ç´¯ç§¯å™¨åœ¨è°ƒè¯•æœŸé—´æˆ–å¦‚æœä½ å¿«é€Ÿæƒ³äº†è§£æ›´å¤šçš„æ•°æ®æ—¶æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚\nFlink ç›®å‰æœ‰ä»¥ä¸‹å†…ç½®çš„ç´¯åŠ å™¨ã€‚å®ƒä»¬æ¯ä¸ªéƒ½å®ç°äº† Accumulator æ¥å£ã€‚\n IntCounterã€LongCounter å’Œ DoubleCounterã€‚è¯·çœ‹ä¸‹é¢ä¸€ä¸ªä½¿ç”¨è®¡æ•°å™¨çš„ä¾‹å­ã€‚ ç›´æ–¹å›¾ã€‚ä¸€ä¸ªç¦»æ•£æ•°é‡çš„ç›´æ–¹å—çš„ç›´æ–¹å›¾å®ç°ã€‚åœ¨å†…éƒ¨ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªä» Integer åˆ° Integer çš„æ˜ å°„ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®¡ç®—å€¼çš„åˆ†å¸ƒï¼Œä¾‹å¦‚å­—æ•°ç¨‹åºçš„æ¯è¡Œå­—æ•°åˆ†å¸ƒã€‚  å¦‚ä½•ä½¿ç”¨ç´¯åŠ å™¨:\né¦–å…ˆä½ å¿…é¡»åœ¨ç”¨æˆ·å®šä¹‰çš„è½¬æ¢å‡½æ•°ä¸­åˆ›å»ºä¸€ä¸ªç´¯åŠ å™¨å¯¹è±¡(è¿™é‡Œæ˜¯ä¸€ä¸ªè®¡æ•°å™¨)ï¼Œåœ¨ä½ æƒ³ä½¿ç”¨å®ƒçš„åœ°æ–¹ã€‚\nprivate IntCounter numLines = new IntCounter(); å…¶æ¬¡ï¼Œä½ å¿…é¡»æ³¨å†Œç´¯åŠ å™¨å¯¹è±¡ï¼Œé€šå¸¸æ˜¯åœ¨å¯Œå‡½æ•°çš„ open() æ–¹æ³•ä¸­ã€‚åœ¨è¿™é‡Œä½ è¿˜éœ€è¦å®šä¹‰åç§°ã€‚\ngetRuntimeContext().addAccumulator(\u0026#34;num-lines\u0026#34;, this.numLines); ç°åœ¨ä½ å¯ä»¥åœ¨è¿ç®—å‡½æ•°çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨ç´¯åŠ å™¨ï¼ŒåŒ…æ‹¬åœ¨ open() å’Œ close() æ–¹æ³•ä¸­ã€‚\nthis.numLines.add(1); æ•´ä½“ç»“æœå°†å­˜å‚¨åœ¨ JobExecutionResult å¯¹è±¡ä¸­ï¼Œè¯¥å¯¹è±¡ç”±æ‰§è¡Œç¯å¢ƒçš„ execute() æ–¹æ³•è¿”å›ï¼ˆç›®å‰åªæœ‰åœ¨æ‰§è¡Œç­‰å¾…ä½œä¸šå®Œæˆçš„æƒ…å†µä¸‹æ‰æœ‰æ•ˆï¼‰ã€‚\nmyJobExecutionResult.getAccumulatorResult(\u0026#34;num-lines\u0026#34;) æ‰€æœ‰çš„ç´¯åŠ å™¨åœ¨æ¯ä¸ªä½œä¸šä¸­å…±äº«ä¸€ä¸ªå‘½åç©ºé—´ã€‚å› æ­¤ä½ å¯ä»¥åœ¨ä½ çš„å·¥ä½œçš„ä¸åŒæ“ä½œå‡½æ•°ä¸­ä½¿ç”¨åŒä¸€ä¸ªç´¯åŠ å™¨ã€‚Flink ä¼šåœ¨å†…éƒ¨åˆå¹¶æ‰€æœ‰åŒåçš„ç´¯åŠ å™¨ã€‚\nå…³äºç´¯åŠ å™¨å’Œè¿­ä»£çš„è¯´æ˜ã€‚ç›®å‰ï¼Œç´¯åŠ å™¨çš„ç»“æœåªæœ‰åœ¨æ•´ä¸ªä½œä¸šç»“æŸåæ‰ä¼šå‡ºç°ã€‚æˆ‘ä»¬è®¡åˆ’åœ¨ä¸‹ä¸€æ¬¡è¿­ä»£ä¸­ä¹Ÿèƒ½è·å¾—ä¸Šä¸€æ¬¡è¿­ä»£çš„ç»“æœã€‚ä½ å¯ä»¥ä½¿ç”¨ Aggregators æ¥è®¡ç®—æ¯æ¬¡è¿­ä»£çš„ç»Ÿè®¡æ•°æ®ï¼Œå¹¶æ ¹æ®è¿™äº›ç»Ÿè®¡æ•°æ®æ¥ç»ˆæ­¢è¿­ä»£ã€‚\nè‡ªå®šä¹‰ç´¯åŠ å™¨:\nè¦å®ç°ä½ è‡ªå·±çš„ç´¯åŠ å™¨ï¼Œä½ åªéœ€è¦ç¼–å†™ä½ çš„ Accumulator æ¥å£çš„å®ç°ã€‚å¦‚æœä½ è®¤ä¸ºä½ çš„è‡ªå®šä¹‰ç´¯åŠ å™¨åº”è¯¥å’ŒFlinkä¸€èµ·å‘å¸ƒï¼Œè¯·éšæ—¶åˆ›å»ºä¸€ä¸ªpull requestã€‚\nä½ å¯ä»¥é€‰æ‹©å®ç° Accumulator æˆ– SimpleAccumulatorã€‚\nAccumulator\u0026lt;V,R\u0026gt; æ˜¯æœ€çµæ´»çš„ã€‚å®ƒä¸ºè¦æ·»åŠ çš„å€¼å®šä¹‰äº†ä¸€ä¸ªç±»å‹ Vï¼Œä¸ºæœ€ç»ˆç»“æœå®šä¹‰äº†ä¸€ä¸ªç»“æœç±»å‹ Rã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ªç›´æ–¹å›¾ï¼ŒV æ˜¯ä¸€ä¸ªæ•°å­—ï¼ŒR æ˜¯ä¸€ä¸ªç›´æ–¹å›¾ã€‚ SimpleAccumulator é€‚ç”¨äºä¸¤ç§ç±»å‹éƒ½ç›¸åŒçš„æƒ…å†µï¼Œä¾‹å¦‚è®¡æ•°å™¨ã€‚\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/user_defined_functions.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-user-defined-functions/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataStream API"],"title":"ç”¨æˆ·å®šä¹‰å‡½æ•°"},{"categories":["Flink"],"contents":"çª—å£ çª—å£æ˜¯å¤„ç†æ— é™æµçš„æ ¸å¿ƒã€‚çª—å£å°†æµåˆ†å‰²æˆæœ‰é™å¤§å°çš„\u0026quot;æ¡¶\u0026quot;ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶åº”ç”¨è®¡ç®—ã€‚æœ¬æ–‡æ¡£ä¸»è¦ä»‹ç» Flink ä¸­å¦‚ä½•è¿›è¡Œçª—å£åŒ–ï¼Œä»¥åŠç¨‹åºå‘˜å¦‚ä½•ä»å…¶æä¾›çš„åŠŸèƒ½ä¸­æœ€å¤§é™åº¦åœ°å—ç›Šã€‚\nä¸‹é¢ä»‹ç»äº†ä¸€ä¸ªçª—å£åŒ– Flink ç¨‹åºçš„ä¸€èˆ¬ç»“æ„ã€‚ç¬¬ä¸€ä¸ªç‰‡æ®µæŒ‡çš„æ˜¯ keyed æµï¼Œè€Œç¬¬äºŒä¸ªç‰‡æ®µæŒ‡çš„æ˜¯ non-keyed æµã€‚æ­£å¦‚äººä»¬æ‰€çœ‹åˆ°çš„é‚£æ ·ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ keyed æµçš„ keyBy(...) è°ƒç”¨å’Œ non-keyed æµçš„ window(...) å˜æˆäº† windowAll(...)ã€‚è¿™ä¹Ÿå°†ä½œä¸ºæœ¬é¡µé¢å…¶ä»–å†…å®¹çš„è·¯çº¿å›¾ã€‚\nKeyed çª—å£\nstream .keyBy(...) \u0026lt;- keyed ä¸ non-keyed çª—å£çš„å¯¹æ¯” .window(...) \u0026lt;- å¿…é¡»çš„: \u0026quot;assigner\u0026quot; [.trigger(...)] \u0026lt;- å¯é€‰çš„: \u0026quot;trigger\u0026quot; (å¦åˆ™ä½¿ç”¨é»˜è®¤çš„ trigger) [.evictor(...)] \u0026lt;- å¯é€‰çš„: \u0026quot;evictor\u0026quot; (å¦åˆ™æ²¡æœ‰ evictor) [.allowedLateness(...)] \u0026lt;- å¯é€‰çš„: \u0026quot;lateness\u0026quot; (å¦åˆ™ä¸ºé›¶) [.sideOutputLateData(...)] \u0026lt;- å¯é€‰çš„: \u0026quot;output tag\u0026quot; (å¦åˆ™è¿Ÿåˆ°æ•°æ®æ— ä¾§è¾“å‡º) .reduce/aggregate/fold/apply() \u0026lt;- å¿…é¡»çš„: \u0026quot;function\u0026quot; [.getSideOutput(...)] \u0026lt;- å¯é€‰çš„: \u0026quot;output tag\u0026quot; Non-Keyed çª—å£\nstream .windowAll(...) \u0026lt;- å¿…é¡»çš„: \u0026quot;assigner\u0026quot; [.trigger(...)] \u0026lt;- å¯é€‰çš„: \u0026quot;trigger\u0026quot; (å¦åˆ™ä½¿ç”¨é»˜è®¤çš„ trigger) [.evictor(...)] \u0026lt;- å¯é€‰çš„: \u0026quot;evictor\u0026quot; (å¦åˆ™æ²¡æœ‰ evictor) [.allowedLateness(...)] \u0026lt;- å¯é€‰çš„: \u0026quot;lateness\u0026quot; (å¦åˆ™ä¸ºé›¶) [.sideOutputLateData(...)] \u0026lt;- å¯é€‰çš„: \u0026quot;output tag\u0026quot; (å¦åˆ™è¿Ÿåˆ°æ•°æ®æ— ä¾§è¾“å‡º) .reduce/aggregate/fold/apply() \u0026lt;- å¿…é¡»çš„: \u0026quot;function\u0026quot; [.getSideOutput(...)] \u0026lt;- å¯é€‰çš„: \u0026quot;output tag\u0026quot; åœ¨ä¸Šé¢ï¼Œæ–¹æ‹¬å·ä¸­çš„å‘½ä»¤([...])æ˜¯å¯é€‰çš„ã€‚è¿™è¡¨æ˜ Flink å…è®¸ä½ ä»¥å¤šç§ä¸åŒçš„æ–¹å¼å®šåˆ¶ä½ çš„çª—å£é€»è¾‘ï¼Œä»¥ä¾¿å®ƒæœ€é€‚åˆä½ çš„éœ€æ±‚ã€‚\nçª—å£ç”Ÿå‘½å‘¨æœŸ ç®€è€Œè¨€ä¹‹ï¼Œå½“ç¬¬ä¸€ä¸ªåº”è¯¥å±äºè¿™ä¸ªçª—å£çš„å…ƒç´ åˆ°è¾¾æ—¶ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªçª—å£ï¼Œå½“æ—¶é—´ï¼ˆäº‹ä»¶æ—¶é—´æˆ–å¤„ç†æ—¶é—´ï¼‰ç»è¿‡(passes)å®ƒçš„ç»“æŸæ—¶é—´æˆ³åŠ ä¸Šç”¨æˆ·æŒ‡å®šçš„å…è®¸å»¶è¿Ÿæ—¶ï¼Œè¿™ä¸ªçª—å£å°±ä¼šè¢«å®Œå…¨ç§»é™¤ï¼ˆè§å…è®¸å»¶è¿Ÿï¼‰ã€‚Flink åªä¿è¯å¯¹åŸºäºæ—¶é—´çš„çª—å£è¿›è¡Œç§»é™¤ï¼Œè€Œä¸ä¿è¯å¯¹å…¶ä»–ç±»å‹çš„çª—å£ï¼Œå¦‚å…¨å±€çª—å£è¿›è¡Œç§»é™¤ï¼ˆè§çª—å£åˆ†é…å™¨ï¼‰ã€‚ä¾‹å¦‚ï¼ŒåŸºäºäº‹ä»¶-æ—¶é—´çš„çª—å£ç­–ç•¥æ¯5åˆ†é’Ÿåˆ›å»ºä¸€ä¸ªéé‡å ï¼ˆæˆ–ç¿»æ»šï¼‰çš„çª—å£ï¼Œå¹¶ä¸”å…è®¸çš„å»¶è¿Ÿä¸º1åˆ†é’Ÿï¼Œå½“ç¬¬ä¸€ä¸ªå…·æœ‰æ—¶é—´æˆ³çš„å…ƒç´ è½å…¥è¿™ä¸ªåŒºé—´æ—¶ï¼ŒFlink å°†ä¸º 12:00 å’Œ 12:05 ä¹‹é—´çš„åŒºé—´åˆ›å»ºä¸€ä¸ªæ–°çš„çª—å£ï¼Œå½“æ°´å°é€šè¿‡ 12:06 çš„æ—¶é—´æˆ³æ—¶ï¼Œå®ƒå°†åˆ é™¤å®ƒã€‚\næ­¤å¤–ï¼Œæ¯ä¸ªçª—å£å°†æœ‰ä¸€ä¸ªè§¦å‘å™¨(è§è§¦å‘å™¨)å’Œä¸€ä¸ªå‡½æ•°(ProcessWindowFunctionã€ReduceFunctionã€AggregateFunctionæˆ–FoldFunction)(è§çª—å£å‡½æ•°)ã€‚å‡½æ•°å°†åŒ…å«è¦åº”ç”¨äºçª—å£å†…å®¹çš„è®¡ç®—ï¼Œè€Œè§¦å‘å™¨åˆ™æŒ‡å®šäº†çª—å£è¢«è®¤ä¸ºå¯ä»¥åº”ç”¨å‡½æ•°çš„æ¡ä»¶ã€‚è§¦å‘ç­–ç•¥å¯èƒ½æ˜¯\u0026quot;å½“çª—å£ä¸­çš„å…ƒç´ æ•°é‡è¶…è¿‡4æ—¶\u0026quot;ï¼Œæˆ–è€…\u0026quot;å½“æ°´å°ç»è¿‡çª—å£çš„æœ«ç«¯æ—¶\u0026quot;ã€‚è§¦å‘å™¨è¿˜å¯ä»¥å†³å®šåœ¨åˆ›å»ºå’Œåˆ é™¤çª—å£ä¹‹é—´çš„ä»»ä½•æ—¶é—´(any time between its creation and removal)æ¸…é™¤çª—å£çš„å†…å®¹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¸…é™¤åªæŒ‡çª—å£ä¸­çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯çª—å£å…ƒæ•°æ®ã€‚è¿™æ„å‘³ç€æ–°çš„æ•°æ®ä»ç„¶å¯ä»¥è¢«æ·»åŠ åˆ°è¯¥çª—å£ä¸­ã€‚\né™¤ä¸Šè¿°ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥æŒ‡å®šä¸€ä¸ª Evictor(è§ Evictors)ï¼Œå®ƒå°†èƒ½å¤Ÿåœ¨è§¦å‘å™¨è§¦å‘åä»¥åŠåœ¨å‡½æ•°åº”ç”¨ä¹‹å‰å’Œ/æˆ–ä¹‹åä»çª—å£ä¸­åˆ é™¤å…ƒç´ ã€‚\nåœ¨ä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å¯¹ä¸Šè¿°æ¯ä¸ªç»„ä»¶è¿›è¡Œæ›´è¯¦ç»†çš„ä»‹ç»ã€‚æˆ‘ä»¬å…ˆä»ä¸Šè¿°ä»£ç æ®µä¸­å¿…é¡»çš„éƒ¨åˆ†å¼€å§‹(å‚è§ Keyed vs Non-Keyed çª—å£ã€çª—å£åˆ†é…å™¨å’Œçª—å£å‡½æ•°)ï¼Œç„¶åå†è½¬å‘å¯é€‰éƒ¨åˆ†ã€‚\nKeyed ä¸ Non-Keyed çª—å£çš„å¯¹æ¯” é¦–å…ˆè¦æŒ‡å®šçš„æ˜¯æ‚¨çš„æµæ˜¯å¦åº”è¯¥æ˜¯ keyed çš„ã€‚è¿™å¿…é¡»åœ¨å®šä¹‰çª—å£ä¹‹å‰å®Œæˆã€‚ä½¿ç”¨ keyBy(...) å°†æŠŠæ‚¨çš„æ— é™æµåˆ†å‰²æˆé€»è¾‘ keyed æµã€‚å¦‚æœæ²¡æœ‰è°ƒç”¨ keyBy(...)ï¼Œé‚£ä¹ˆæ‚¨çš„æµå°±ä¸æ˜¯ keyed æµã€‚\nåœ¨ keyed æµçš„æƒ…å†µä¸‹ï¼Œä¼ å…¥äº‹ä»¶çš„ä»»ä½•å±æ€§éƒ½å¯ä»¥è¢«ç”¨ä½œé”®ï¼ˆæ›´å¤šç»†èŠ‚åœ¨è¿™é‡Œï¼‰ã€‚æ‹¥æœ‰ä¸€ä¸ª keyed æµå°†å…è®¸ä½ çš„çª—å£è®¡ç®—ç”±å¤šä¸ªä»»åŠ¡å¹¶è¡Œæ‰§è¡Œï¼Œå› ä¸ºæ¯ä¸ªé€»è¾‘ keyed æµå¯ä»¥ç‹¬ç«‹äºå…¶ä»–æµè¿›è¡Œå¤„ç†ã€‚æ‰€æœ‰æŒ‡å‘åŒä¸€é”®çš„å…ƒç´ å°†è¢«å‘é€åˆ°åŒä¸€ä¸ªå¹¶è¡Œä»»åŠ¡(task)ã€‚\nåœ¨ non-keyed æµçš„æƒ…å†µä¸‹ï¼Œæ‚¨çš„åŸå§‹æµä¸ä¼šè¢«åˆ†å‰²æˆå¤šä¸ªé€»è¾‘æµï¼Œæ‰€æœ‰çš„çª—å£åŒ–é€»è¾‘å°†ç”±ä¸€ä¸ªä»»åŠ¡(task)æ¥æ‰§è¡Œï¼Œå³å¹¶è¡Œåº¦ä¸º1ã€‚\nçª—å£åˆ†é…å™¨ åœ¨æŒ‡å®šæµæ˜¯å¦æ˜¯ keyed æµä¹‹åï¼Œä¸‹ä¸€æ­¥æ˜¯å®šä¹‰çª—å£åˆ†é…å™¨ã€‚çª—å£åˆ†é…å™¨å®šä¹‰äº†å¦‚ä½•å°†å…ƒç´ åˆ†é…ç»™çª—å£ã€‚è¿™æ˜¯é€šè¿‡åœ¨ window(...)ï¼ˆå¯¹äº keyed æµï¼‰æˆ– windowAll()ï¼ˆå¯¹äº non-keyed æµï¼‰è°ƒç”¨ä¸­æŒ‡å®šæ‚¨æ‰€é€‰æ‹©çš„ WindowAssigner æ¥å®ç°çš„ã€‚\nWindowAssigner è´Ÿè´£å°†æ¯ä¸ªä¼ å…¥çš„å…ƒç´ åˆ†é…ç»™ä¸€ä¸ªæˆ–å¤šä¸ªçª—å£ã€‚Flink ä¸ºæœ€å¸¸è§çš„ç”¨ä¾‹æä¾›äº†é¢„å®šä¹‰çš„çª—å£åˆ†é…å™¨ï¼Œå³æ»šåŠ¨çª—å£ã€æ»‘åŠ¨çª—å£ã€ä¼šè¯çª—å£å’Œå…¨å±€çª—å£ã€‚æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡æ‰©å±• WindowAssigner ç±»æ¥å®ç°è‡ªå®šä¹‰çª—å£åˆ†é…å™¨ã€‚æ‰€æœ‰å†…ç½®çš„çª—å£åˆ†é…å™¨ï¼ˆé™¤äº†å…¨å±€çª—å£ï¼‰éƒ½æ˜¯åŸºäºæ—¶é—´å°†å…ƒç´ åˆ†é…ç»™çª—å£ï¼Œæ—¶é—´å¯ä»¥æ˜¯å¤„ç†æ—¶é—´ï¼Œä¹Ÿå¯ä»¥æ˜¯äº‹ä»¶æ—¶é—´ã€‚è¯·æŸ¥çœ‹æˆ‘ä»¬å…³äºäº‹ä»¶æ—¶é—´çš„éƒ¨åˆ†ï¼Œäº†è§£å¤„ç†æ—¶é—´å’Œäº‹ä»¶æ—¶é—´ä¹‹é—´çš„åŒºåˆ«ï¼Œä»¥åŠæ—¶é—´æˆ³å’Œæ°´å°æ˜¯å¦‚ä½•ç”Ÿæˆçš„ã€‚\nåŸºäºæ—¶é—´çš„çª—å£æœ‰ä¸€ä¸ªå¼€å§‹æ—¶é—´æˆ³ï¼ˆåŒ…æ‹¬ï¼‰å’Œç»“æŸæ—¶é—´æˆ³ï¼ˆä¸åŒ…æ‹¬ï¼‰ï¼Œå…±åŒæè¿°çª—å£çš„å¤§å°ã€‚åœ¨ä»£ç ä¸­ï¼ŒFlink åœ¨å¤„ç†åŸºäºæ—¶é—´çš„çª—å£æ—¶ä½¿ç”¨äº† TimeWindowï¼Œå®ƒæœ‰æŸ¥è¯¢å¼€å§‹å’Œç»“æŸæ—¶é—´æˆ³çš„æ–¹æ³•ï¼Œè¿˜æœ‰ä¸€ä¸ªé¢å¤–çš„æ–¹æ³• maxTimestamp()ï¼Œå¯ä»¥è¿”å›ç»™å®šçª—å£çš„æœ€å¤§å…è®¸æ—¶é—´æˆ³ã€‚\nåœ¨ä¸‹æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†å±•ç¤º Flink çš„é¢„å®šä¹‰çª—å£åˆ†é…å™¨æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä»¥åŠå¦‚ä½•åœ¨ DataStream ç¨‹åºä¸­ä½¿ç”¨å®ƒä»¬ã€‚ä¸‹å›¾ç›´è§‚åœ°å±•ç¤ºäº†æ¯ä¸ªåˆ†é…å™¨çš„å·¥ä½œæƒ…å†µã€‚ç´«è‰²çš„åœ†åœˆä»£è¡¨æµçš„å…ƒç´ ï¼Œè¿™äº›å…ƒç´ è¢«æŸä¸ªé”®ï¼ˆåœ¨æœ¬ä¾‹ä¸­æ˜¯ç”¨æˆ·1ã€ç”¨æˆ·2å’Œç”¨æˆ·3ï¼‰åˆ†å‰²ã€‚xè½´æ˜¾ç¤ºçš„æ˜¯æ—¶é—´çš„è¿›åº¦ã€‚\næ»šåŠ¨çª—å£ æ»šåŠ¨çª—å£åˆ†é…å™¨å°†æ¯ä¸ªå…ƒç´ åˆ†é…åˆ°ä¸€ä¸ªæŒ‡å®šçª—å£å¤§å°çš„çª—å£ã€‚æ»šåŠ¨çª—å£æœ‰ä¸€ä¸ªå›ºå®šçš„å¤§å°ï¼Œå¹¶ä¸”ä¸é‡å ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æŒ‡å®šäº†ä¸€ä¸ªå¤§å°ä¸º5åˆ†é’Ÿçš„æ»šåŠ¨çª—å£ï¼Œé‚£ä¹ˆå½“å‰çš„çª—å£å°†è¢«è¯„ä¼°ï¼Œå¹¶ä¸”æ¯éš”5åˆ†é’Ÿå°±ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„çª—å£ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\nä»¥ä¸‹ä»£ç ç‰‡æ®µå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ»šåŠ¨çª—å£ã€‚\nval input: DataStream[T] = ... // tumbling event-time windows input .keyBy(\u0026lt;key selector\u0026gt;) .window(TumblingEventTimeWindows.of(Time.seconds(5))) .\u0026lt;windowed transformation\u0026gt;(\u0026lt;window function\u0026gt;) // tumbling processing-time windows input .keyBy(\u0026lt;key selector\u0026gt;) .window(TumblingProcessingTimeWindows.of(Time.seconds(5))) .\u0026lt;windowed transformation\u0026gt;(\u0026lt;window function\u0026gt;) // daily tumbling event-time windows offset by -8 hours. input .keyBy(\u0026lt;key selector\u0026gt;) .window(TumblingEventTimeWindows.of(Time.days(1), Time.hours(-8))) .\u0026lt;windowed transformation\u0026gt;(\u0026lt;window function\u0026gt;) æ—¶é—´é—´éš”å¯ä»¥ä½¿ç”¨ Time.milliseconds(x), Time.seconds(x), Time.minutes(x) ç­‰ä¸­çš„ä¸€ç§æ¥æŒ‡å®šã€‚\nå¦‚æœ€åä¸€ä¸ªä¾‹å­æ‰€ç¤ºï¼Œæ»šåŠ¨çª—å£åˆ†é…å™¨è¿˜å¯ä»¥é‡‡ç”¨ä¸€ä¸ªå¯é€‰çš„åç§»é‡(offset)å‚æ•°ï¼Œç”¨äºæ”¹å˜çª—å£çš„å¯¹é½æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œåœ¨æ²¡æœ‰åç§»é‡çš„æƒ…å†µä¸‹ï¼Œæ¯å°æ—¶çš„æ»šåŠ¨çª—å£ä¸çºªå…ƒå¯¹é½ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ ä¼šå¾—åˆ°è¯¸å¦‚ 1:00:00.000 - 1:59:59.999ï¼Œ2:00:00.000 - 2:59:59.999 ç­‰çª—å£ã€‚å¦‚æœä½ æƒ³æ”¹å˜è¿™ä¸€ç‚¹ï¼Œä½ å¯ä»¥ç»™å‡ºä¸€ä¸ªåç§»é‡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåç§»é‡ä¸º15åˆ†é’Ÿï¼Œæ‚¨å°†å¾—åˆ° 1:15:00.000 - 2:14:59.999ï¼Œ2:15:00.000 - 3:14:59.999 ç­‰ã€‚åç§»é‡çš„ä¸€ä¸ªé‡è¦ç”¨é€”æ˜¯è°ƒæ•´çª—å£åˆ° UTC-0 ä»¥å¤–çš„æ—¶åŒºã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸­å›½ï¼Œä½ å¿…é¡»æŒ‡å®šä¸€ä¸ª Time.hours(-8) çš„åç§»é‡ã€‚\næ»‘åŠ¨çª—å£ æ»‘åŠ¨çª—å£åˆ†é…å™¨å°†å…ƒç´ åˆ†é…ç»™å›ºå®šé•¿åº¦çš„çª—å£ã€‚ä¸æ»šåŠ¨çª—å£åˆ†é…å™¨ç±»ä¼¼ï¼Œçª—å£çš„å¤§å°ç”±çª—å£å¤§å°(window size)å‚æ•°é…ç½®ã€‚ä¸€ä¸ªé¢å¤–çš„çª—å£æ»‘åŠ¨(window slide)å‚æ•°æ§åˆ¶æ»‘åŠ¨çª—å£çš„å¯åŠ¨é¢‘ç‡ã€‚å› æ­¤ï¼Œå¦‚æœæ»‘åŠ¨çª—å£çš„æ»‘å—å°äºçª—å£å¤§å°ï¼Œæ»‘åŠ¨çª—å£å¯ä»¥é‡å ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå…ƒç´ è¢«åˆ†é…åˆ°å¤šä¸ªçª—å£ã€‚\nä¾‹å¦‚ï¼Œä½ å¯ä»¥æœ‰10åˆ†é’Ÿå¤§å°çš„çª—å£ï¼Œæ»‘åŠ¨5åˆ†é’Ÿã€‚è¿™æ ·ï¼Œæ¯éš”5åˆ†é’Ÿå°±ä¼šæœ‰ä¸€ä¸ªçª—å£ï¼ŒåŒ…å«è¿‡å»10åˆ†é’Ÿå†…åˆ°è¾¾çš„äº‹ä»¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\nä»¥ä¸‹ä»£ç ç‰‡æ®µå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ»‘åŠ¨çª—å£ã€‚\nval input: DataStream[T] = ... // sliding event-time windows input .keyBy(\u0026lt;key selector\u0026gt;) .window(SlidingEventTimeWindows.of(Time.seconds(10), Time.seconds(5))) .\u0026lt;windowed transformation\u0026gt;(\u0026lt;window function\u0026gt;) // sliding processing-time windows input .keyBy(\u0026lt;key selector\u0026gt;) .window(SlidingProcessingTimeWindows.of(Time.seconds(10), Time.seconds(5))) .\u0026lt;windowed transformation\u0026gt;(\u0026lt;window function\u0026gt;) // sliding processing-time windows offset by -8 hours input .keyBy(\u0026lt;key selector\u0026gt;) .window(SlidingProcessingTimeWindows.of(Time.hours(12), Time.hours(1), Time.hours(-8))) .\u0026lt;windowed transformation\u0026gt;(\u0026lt;window function\u0026gt;) æ—¶é—´é—´éš”å¯ä»¥é€šè¿‡ä½¿ç”¨ Time.milliseconds(x), Time.seconds(x), Time.minutes(x) ç­‰ä¸­çš„ä¸€ä¸ªæ¥æŒ‡å®šã€‚\nå¦‚ä¸Šä¸€ä¸ªä¾‹å­æ‰€ç¤ºï¼Œæ»‘åŠ¨çª—å£åˆ†é…å™¨è¿˜å¯ä»¥é‡‡å–ä¸€ä¸ªå¯é€‰çš„åç§»é‡(offset)å‚æ•°ï¼Œç”¨äºæ”¹å˜çª—å£çš„å¯¹é½æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œåœ¨æ²¡æœ‰åç§»é‡çš„æƒ…å†µä¸‹ï¼Œæ¯å°æ—¶æ»‘åŠ¨30åˆ†é’Ÿçš„çª—å£ä¸çºªå…ƒå¯¹é½ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ å°†å¾—åˆ° 1:00:00.000 - 1:59:59.999ï¼Œ1:30:00.000 - 2:29:59.999 ç­‰çª—å£ã€‚å¦‚æœä½ æƒ³æ”¹å˜è¿™ä¸€ç‚¹ï¼Œä½ å¯ä»¥ç»™å‡ºä¸€ä¸ªåç§»é‡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåç§»é‡ä¸º15åˆ†é’Ÿï¼Œæ‚¨å°†å¾—åˆ° 1:15:00.000 - 2:14:59.999ï¼Œ1:45:00.000 - 2:44:59.999 ç­‰ã€‚åç§»é‡çš„ä¸€ä¸ªé‡è¦ç”¨é€”æ˜¯è°ƒæ•´çª—å£åˆ° UTC-0 ä»¥å¤–çš„æ—¶åŒºã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸­å›½ï¼Œä½ å¿…é¡»æŒ‡å®šä¸€ä¸ª Time.hours(-8) çš„åç§»ã€‚\nä¼šè¯çª—å£ ä¼šè¯çª—å£åˆ†é…å™¨æŒ‰æ´»åŠ¨çš„ä¼šè¯å¯¹å…ƒç´ è¿›è¡Œåˆ†ç»„ã€‚ä¸æ»šåŠ¨çª—å£å’Œæ»‘åŠ¨çª—å£ä¸åŒï¼Œä¼šè¯çª—å£ä¸é‡å ï¼Œä¹Ÿæ²¡æœ‰å›ºå®šçš„å¼€å§‹å’Œç»“æŸæ—¶é—´ã€‚ç›¸åï¼Œå½“ä¼šè¯çª—å£åœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ¥æ”¶åˆ°å…ƒç´ æ—¶ï¼Œä¹Ÿå°±æ˜¯åœ¨ä¸æ´»åŠ¨çš„é—´éš™å‘ç”Ÿæ—¶ï¼Œä¼šè¯çª—å£å°±ä¼šå…³é—­ã€‚ä¼šè¯çª—å£åˆ†é…å™¨å¯ä»¥é…ç½®ä¸€ä¸ªé™æ€çš„ä¼šè¯é—´éš™(session gap)ï¼Œä¹Ÿå¯ä»¥é…ç½®ä¸€ä¸ªä¼šè¯é—´éš™æå–å‡½æ•°ï¼Œè¯¥å‡½æ•°å®šä¹‰äº†å¤šé•¿æ—¶é—´çš„ä¸æ´»åŠ¨æœŸã€‚å½“è¿™ä¸ªæ—¶é—´æ®µ(period)åˆ°æœŸ(expires)æ—¶ï¼Œå½“å‰ä¼šè¯å…³é—­ï¼Œåç»­å…ƒç´ è¢«åˆ†é…åˆ°ä¸€ä¸ªæ–°çš„ä¼šè¯çª—å£ã€‚\nä»¥ä¸‹ä»£ç ç‰‡æ®µå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ä¼šè¯çª—å£ã€‚\nval input: DataStream[T] = ... // event-time session windows with static gap input .keyBy(\u0026lt;key selector\u0026gt;) .window(EventTimeSessionWindows.withGap(Time.minutes(10))) .\u0026lt;windowed transformation\u0026gt;(\u0026lt;window function\u0026gt;) // event-time session windows with dynamic gap input .keyBy(\u0026lt;key selector\u0026gt;) .window(EventTimeSessionWindows.withDynamicGap(new SessionWindowTimeGapExtractor[String] { override def extract(element: String): Long = { // determine and return session gap  } })) .\u0026lt;windowed transformation\u0026gt;(\u0026lt;window function\u0026gt;) // processing-time session windows with static gap input .keyBy(\u0026lt;key selector\u0026gt;) .window(ProcessingTimeSessionWindows.withGap(Time.minutes(10))) .\u0026lt;windowed transformation\u0026gt;(\u0026lt;window function\u0026gt;) // processing-time session windows with dynamic gap input .keyBy(\u0026lt;key selector\u0026gt;) .window(DynamicProcessingTimeSessionWindows.withDynamicGap(new SessionWindowTimeGapExtractor[String] { override def extract(element: String): Long = { // determine and return session gap  } })) .\u0026lt;windowed transformation\u0026gt;(\u0026lt;window function\u0026gt;) é™æ€é—´éš™å¯ä»¥é€šè¿‡ä½¿ç”¨ Time.milliseconds(x), Time.seconds(x), Time.minutes(x) ç­‰ä¹‹ä¸€æ¥æŒ‡å®šã€‚\nåŠ¨æ€é—´éš™å¯ä»¥é€šè¿‡å®ç° SessionWindowTimeGapExtractor æ¥å£æ¥æŒ‡å®šã€‚\næ³¨æ„: ç”±äºä¼šè¯çª—å£æ²¡æœ‰å›ºå®šçš„å¼€å§‹å’Œç»“æŸï¼Œæ‰€ä»¥å®ƒä»¬çš„è¯„ä¼°æ–¹å¼ä¸æ»šåŠ¨å’Œæ»‘åŠ¨çª—å£ä¸åŒã€‚åœ¨å†…éƒ¨ï¼Œä¼šè¯çª—å£æ“ä½œç¬¦ä¸ºæ¯ä¸ªåˆ°è¾¾çš„è®°å½•åˆ›å»ºä¸€ä¸ªæ–°çš„çª—å£ï¼Œå¦‚æœå®ƒä»¬å½¼æ­¤ä¹‹é—´çš„è·ç¦»æ¯”å®šä¹‰çš„é—´éš™æ›´è¿‘ï¼Œå°±ä¼šå°†çª—å£åˆå¹¶åœ¨ä¸€èµ·ã€‚ä¸ºäº†èƒ½å¤Ÿåˆå¹¶ï¼Œä¼šè¯çª—å£æ“ä½œç¬¦éœ€è¦ä¸€ä¸ªåˆå¹¶è§¦å‘å™¨å’Œä¸€ä¸ªåˆå¹¶çª—å£å‡½æ•°ï¼Œå¦‚ ReduceFunctionã€AggregateFunction æˆ– ProcessWindowFunction(FoldFunction ä¸èƒ½åˆå¹¶)ã€‚\nå…¨å±€çª—å£ å…¨å±€çª—å£åˆ†é…å™¨å°†å…·æœ‰ç›¸åŒé”®çš„æ‰€æœ‰å…ƒç´ åˆ†é…åˆ°åŒä¸€ä¸ªå…¨å±€çª—å£ã€‚åªæœ‰å½“ä½ è¿˜æŒ‡å®šäº†ä¸€ä¸ªè‡ªå®šä¹‰è§¦å‘å™¨æ—¶ï¼Œè¿™ç§çª—å£æ–¹æ¡ˆæ‰æœ‰ç”¨ã€‚å¦åˆ™ï¼Œä»»ä½•è®¡ç®—éƒ½ä¸ä¼šè¢«æ‰§è¡Œï¼Œå› ä¸ºå…¨å±€çª—å£æ²¡æœ‰ä¸€ä¸ªè‡ªç„¶çš„ç»ˆç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é‚£é‡Œå¤„ç†èšé›†çš„å…ƒç´ ã€‚\nä¸‹é¢çš„ä»£ç ç‰‡æ®µå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨å…¨å±€çª—å£ã€‚\nval input: DataStream[T] = ... input .keyBy(\u0026lt;key selector\u0026gt;) .window(GlobalWindows.create()) .\u0026lt;windowed transformation\u0026gt;(\u0026lt;window function\u0026gt;) çª—å£å‡½æ•° åœ¨å®šä¹‰äº†çª—å£åˆ†é…å™¨ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šæˆ‘ä»¬è¦å¯¹è¿™äº›çª—å£ä¸­çš„æ¯ä¸€ä¸ªçª—å£è¿›è¡Œçš„è®¡ç®—ã€‚è¿™æ˜¯çª—å£å‡½æ•°çš„è´£ä»»ï¼Œä¸€æ—¦ç³»ç»Ÿç¡®å®šä¸€ä¸ªçª—å£å‡†å¤‡å¥½è¿›è¡Œå¤„ç†ï¼Œå®ƒå°±ä¼šç”¨æ¥å¤„ç†æ¯ä¸ªï¼ˆå¯èƒ½æ˜¯ keyed çš„ï¼‰çª—å£çš„å…ƒç´ ï¼ˆå…³äº Flink å¦‚ä½•ç¡®å®šçª—å£å‡†å¤‡å¥½ï¼Œè¯·å‚è§è§¦å‘å™¨ï¼‰ã€‚\nçª—å£å‡½æ•°å¯ä»¥æ˜¯ ReduceFunctionã€AggregateFunctionã€FoldFunction æˆ– ProcessWindowFunction ä¸­çš„ä¸€ç§ã€‚å‰ä¸¤ä¸ªå¯ä»¥æ›´æœ‰æ•ˆåœ°æ‰§è¡Œï¼ˆè§çŠ¶æ€å¤§å°éƒ¨åˆ†ï¼‰ï¼Œå› ä¸º Flink å¯ä»¥åœ¨æ¯ä¸ªçª—å£åˆ°è¾¾æ—¶å¢é‡åœ°èšåˆå…ƒç´ ã€‚ProcessWindowFunction å¯ä»¥ä¸ºä¸€ä¸ªçª—å£ä¸­åŒ…å«çš„æ‰€æœ‰å…ƒç´ è·å–ä¸€ä¸ª Iterableï¼Œä»¥åŠå…³äºå…ƒç´ æ‰€å±çª—å£çš„é™„åŠ å…ƒä¿¡æ¯ã€‚\nå¸¦æœ‰ ProcessWindowFunction çš„çª—å£åŒ–è½¬æ¢ä¸èƒ½åƒå…¶ä»–æƒ…å†µä¸€æ ·é«˜æ•ˆæ‰§è¡Œï¼Œå› ä¸º Flink åœ¨è°ƒç”¨å‡½æ•°ä¹‹å‰å¿…é¡»åœ¨å†…éƒ¨ç¼“å†²ä¸€ä¸ªçª—å£çš„æ‰€æœ‰å…ƒç´ ã€‚é€šè¿‡å°† ProcessWindowFunction ä¸ ReduceFunctionã€AggregateFunction æˆ– FoldFunction ç»“åˆèµ·æ¥ï¼Œæ—¢å¯ä»¥å¾—åˆ°çª—å£å…ƒç´ çš„å¢é‡èšåˆï¼Œä¹Ÿå¯ä»¥å¾—åˆ° ProcessWindowFunction æ¥æ”¶åˆ°çš„é¢å¤–çš„çª—å£å…ƒæ•°æ®ï¼Œä»è€Œç¼“è§£è¿™ç§æƒ…å†µã€‚æˆ‘ä»¬å°†æŸ¥çœ‹è¿™äº›å˜ä½“çš„æ¯ä¸ªä¾‹å­ã€‚\nReduceFunction ReduceFunction æŒ‡å®šäº†å¦‚ä½•å°†è¾“å…¥çš„ä¸¤ä¸ªå…ƒç´ ç»„åˆèµ·æ¥ä»¥äº§ç”Ÿç›¸åŒç±»å‹çš„è¾“å‡ºå…ƒç´ ã€‚Flink ä½¿ç”¨ ReduceFunction æ¥å¢é‡èšåˆä¸€ä¸ªçª—å£çš„å…ƒç´ ã€‚\nReduceFunction å¯ä»¥è¿™æ ·å®šä¹‰å’Œä½¿ç”¨ã€‚\nval input: DataStream[(String, Long)] = ... input .keyBy(\u0026lt;key selector\u0026gt;) .window(\u0026lt;window assigner\u0026gt;) .reduce { (v1, v2) =\u0026gt; (v1._1, v1._2 + v2._2) } ä¸Šé¢çš„ä¾‹å­æŠŠä¸€ä¸ªçª—å£ä¸­æ‰€æœ‰å…ƒç´ çš„å…ƒç»„çš„ç¬¬äºŒä¸ªå­—æ®µç›¸åŠ èµ·æ¥ã€‚\nAggregateFunction AggregateFunction æ˜¯ ReduceFunction çš„é€šç”¨ç‰ˆæœ¬ï¼Œå®ƒæœ‰ä¸‰ç§ç±»å‹ï¼šè¾“å…¥ç±»å‹ï¼ˆINï¼‰ã€ç´¯åŠ å™¨ç±»å‹ï¼ˆACCï¼‰å’Œè¾“å‡ºç±»å‹ï¼ˆOUTï¼‰ã€‚è¾“å…¥ç±»å‹æ˜¯è¾“å…¥æµä¸­å…ƒç´ çš„ç±»å‹ï¼ŒAggregateFunction æœ‰ä¸€ä¸ªæ–¹æ³•ç”¨äºå°†ä¸€ä¸ªè¾“å…¥å…ƒç´ æ·»åŠ åˆ°ç´¯åŠ å™¨ä¸­ã€‚è¯¥æ¥å£è¿˜æœ‰åˆ›å»ºä¸€ä¸ªåˆå§‹ç´¯åŠ å™¨ã€å°†ä¸¤ä¸ªç´¯åŠ å™¨åˆå¹¶æˆä¸€ä¸ªç´¯åŠ å™¨ä»¥åŠä»ä¸€ä¸ªç´¯åŠ å™¨ä¸­æå–ä¸€ä¸ªè¾“å‡ºï¼ˆç±»å‹ä¸º OUTï¼‰çš„æ–¹æ³•ã€‚æˆ‘ä»¬å°†åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­çœ‹åˆ°è¿™äº›æ–¹æ³•æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚\nå’Œ ReduceFunction ä¸€æ ·ï¼ŒFlink ä¼šåœ¨çª—å£çš„è¾“å…¥å…ƒç´ åˆ°è¾¾æ—¶ï¼Œå¯¹å®ƒä»¬è¿›è¡Œå¢é‡èšåˆã€‚\nAggregateFunction å¯ä»¥è¿™æ ·å®šä¹‰å’Œä½¿ç”¨ã€‚\n/** * The accumulator is used to keep a running sum and a count. The [getResult] method * computes the average. */ class AverageAggregate extends AggregateFunction[(String, Long), (Long, Long), Double] { override def createAccumulator() = (0L, 0L) override def add(value: (String, Long), accumulator: (Long, Long)) = (accumulator._1 + value._2, accumulator._2 + 1L) override def getResult(accumulator: (Long, Long)) = accumulator._1 / accumulator._2 override def merge(a: (Long, Long), b: (Long, Long)) = (a._1 + b._1, a._2 + b._2) } val input: DataStream[(String, Long)] = ... input .keyBy(\u0026lt;key selector\u0026gt;) .window(\u0026lt;window assigner\u0026gt;) .aggregate(new AverageAggregate) ä¸Šé¢çš„ä¾‹å­æ˜¯è®¡ç®—çª—å£ä¸­å…ƒç´ çš„ç¬¬äºŒä¸ªå­—æ®µçš„å¹³å‡å€¼ã€‚\nFoldFunction FoldFunction æŒ‡å®šäº†çª—å£çš„è¾“å…¥å…ƒç´ å¦‚ä½•ä¸è¾“å‡ºç±»å‹çš„å…ƒç´ ç›¸ç»“åˆã€‚å¯¹äºæ·»åŠ åˆ°çª—å£çš„æ¯ä¸ªå…ƒç´ å’Œå½“å‰çš„è¾“å‡ºå€¼ï¼Œéƒ½ä¼šé€’å¢åœ°è°ƒç”¨ FoldFunctionã€‚ç¬¬ä¸€ä¸ªå…ƒç´ ä¸è¾“å‡ºç±»å‹çš„é¢„å®šä¹‰åˆå§‹å€¼ç›¸ç»“åˆã€‚\nå¯ä»¥è¿™æ ·å®šä¹‰å’Œä½¿ç”¨ FoldFunctionã€‚\nval input: DataStream[(String, Long)] = ... input .keyBy(\u0026lt;key selector\u0026gt;) .window(\u0026lt;window assigner\u0026gt;) .fold(\u0026#34;\u0026#34;) { (acc, v) =\u0026gt; acc + v._2 } ä¸Šé¢çš„ä¾‹å­å°†æ‰€æœ‰è¾“å…¥çš„ Long å€¼è¿½åŠ åˆ°ä¸€ä¸ªåˆå§‹çš„ç©ºå­—ç¬¦ä¸²ä¸­ã€‚\næ³¨æ„ fold() ä¸èƒ½ç”¨äºä¼šè¯çª—å£æˆ–å…¶ä»–å¯åˆå¹¶çª—å£ã€‚\nProcessWindowFunction ProcessWindowFunction å¾—åˆ°ä¸€ä¸ªåŒ…å«çª—å£æ‰€æœ‰å…ƒç´ çš„ Iterableï¼Œä»¥åŠä¸€ä¸ªå¯ä»¥è®¿é—®æ—¶é—´å’ŒçŠ¶æ€ä¿¡æ¯çš„ Context å¯¹è±¡ï¼Œè¿™ä½¿å¾—å®ƒèƒ½å¤Ÿæä¾›æ¯”å…¶ä»–çª—å£å‡½æ•°æ›´å¤šçš„çµæ´»æ€§ã€‚è¿™æ˜¯ä»¥æ€§èƒ½å’Œèµ„æºæ¶ˆè€—ä¸ºä»£ä»·çš„ï¼Œå› ä¸ºå…ƒç´ ä¸èƒ½å¢é‡èšåˆï¼Œè€Œæ˜¯éœ€è¦åœ¨å†…éƒ¨ç¼“å†²ï¼Œç›´åˆ°çª—å£è¢«è®¤ä¸ºå¯ä»¥å¤„ç†ä¸ºæ­¢ã€‚\nProcessWindowFunction çš„ç­¾åå¦‚ä¸‹ã€‚\nabstract class ProcessWindowFunction[IN, OUT, KEY, W \u0026lt;: Window] extends Function { /** * Evaluates the window and outputs none or several elements. * * @param key The key for which this window is evaluated. * @param context The context in which the window is being evaluated. * @param elements The elements in the window being evaluated. * @param out A collector for emitting elements. * @throws Exception The function may throw exceptions to fail the program and trigger recovery. */ def process( key: KEY, context: Context, elements: Iterable[IN], out: Collector[OUT]) /** * The context holding window metadata */ abstract class Context { /** * Returns the window that is being evaluated. */ def window: W /** * Returns the current processing time. */ def currentProcessingTime: Long /** * Returns the current event-time watermark. */ def currentWatermark: Long /** * State accessor for per-key and per-window state. */ def windowState: KeyedStateStore /** * State accessor for per-key global state. */ def globalState: KeyedStateStore } } æ³¨æ„ key å‚æ•°æ˜¯é€šè¿‡ä¸º keyBy() è°ƒç”¨æŒ‡å®šçš„ KeySelector æå–çš„é”®ã€‚å¦‚æœæ˜¯å…ƒç»„ç´¢å¼•é”®æˆ–å­—ç¬¦ä¸²å­—æ®µå¼•ç”¨ï¼Œè¿™ä¸ªé”®çš„ç±»å‹æ€»æ˜¯ Tupleï¼Œä½ å¿…é¡»æ‰‹åŠ¨å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªæ­£ç¡®å¤§å°çš„å…ƒç»„æ¥æå–é”®å­—æ®µã€‚\nProcessWindowFunction å¯ä»¥è¿™æ ·å®šä¹‰å’Œä½¿ç”¨ã€‚\nval input: DataStream[(String, Long)] = ... input .keyBy(_._1) .timeWindow(Time.minutes(5)) .process(new MyProcessWindowFunction()) /* ... */ class MyProcessWindowFunction extends ProcessWindowFunction[(String, Long), String, String, TimeWindow] { def process(key: String, context: Context, input: Iterable[(String, Long)], out: Collector[String]) = { var count = 0L for (in \u0026lt;- input) { count = count + 1 } out.collect(s\u0026#34;Window ${context.window}count: $count\u0026#34;) } } è¿™ä¸ªä¾‹å­æ˜¾ç¤ºäº†ä¸€ä¸ª ProcessWindowFunctionï¼Œå®ƒå¯ä»¥è®¡ç®—ä¸€ä¸ªçª—å£ä¸­çš„å…ƒç´ ã€‚æ­¤å¤–ï¼Œçª—å£å‡½æ•°è¿˜å°†çª—å£çš„ä¿¡æ¯æ·»åŠ åˆ°è¾“å‡ºä¸­ã€‚\næ³¨æ„ï¼Œä½¿ç”¨ ProcessWindowFunction è¿›è¡Œç®€å•çš„èšåˆï¼Œå¦‚ countï¼Œæ•ˆç‡ç›¸å½“ä½ã€‚ä¸‹ä¸€èŠ‚å°†å±•ç¤ºå¦‚ä½•å°† ReduceFunction æˆ– AggregateFunction ä¸ ProcessWindowFunction ç»“åˆèµ·æ¥ï¼Œä»¥è·å¾—å¢é‡èšåˆå’Œ ProcessWindowFunction çš„é™„åŠ ä¿¡æ¯ã€‚\nå…·æœ‰å¢é‡èšåˆåŠŸèƒ½çš„ ProcessWindowFunction ProcessWindowFunction å¯ä»¥ä¸ ReduceFunctionã€AggregateFunction æˆ– FoldFunction ç›¸ç»“åˆï¼Œä»¥åœ¨å…ƒç´ åˆ°è¾¾çª—å£æ—¶è¿›è¡Œå¢é‡èšåˆã€‚å½“çª—å£å…³é—­æ—¶ï¼ŒProcessWindowFunction å°†è¢«æä¾›èšåˆçš„ç»“æœã€‚è¿™ä½¿å¾—å®ƒå¯ä»¥å¢é‡è®¡ç®—çª—å£ï¼ŒåŒæ—¶å¯ä»¥è®¿é—® ProcessWindowFunction çš„é™„åŠ çª—å£å…ƒä¿¡æ¯ã€‚\næ³¨æ„ æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ legacy WindowFunction ä»£æ›¿ ProcessWindowFunction è¿›è¡Œå¢é‡çª—å£èšåˆã€‚\nä½¿ç”¨ ReduceFunction è¿›è¡Œå¢é‡çª—å£èšåˆ ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•å°†å¢é‡ ReduceFunction ä¸ ProcessWindowFunction ç›¸ç»“åˆï¼Œä»¥è¿”å›çª—å£ä¸­æœ€å°çš„äº‹ä»¶ä»¥åŠçª—å£çš„å¼€å§‹æ—¶é—´ã€‚\nval input: DataStream[SensorReading] = ... input .keyBy(\u0026lt;key selector\u0026gt;) .timeWindow(\u0026lt;duration\u0026gt;) .reduce( (r1: SensorReading, r2: SensorReading) =\u0026gt; { if (r1.value \u0026gt; r2.value) r2 else r1 }, ( key: String, context: ProcessWindowFunction[_, _, _, TimeWindow]#Context, minReadings: Iterable[SensorReading], out: Collector[(Long, SensorReading)] ) =\u0026gt; { val min = minReadings.iterator.next() out.collect((context.window.getStart, min)) } ) ç”¨ AggregateFunction è¿›è¡Œå¢é‡çª—å£èšåˆ ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•å°†å¢é‡çš„ AggregateFunction ä¸ ProcessWindowFunction ç»“åˆèµ·æ¥ï¼Œè®¡ç®—å¹³å‡å€¼ï¼ŒåŒæ—¶å°†é”®å’Œçª—å£ä¸å¹³å‡å€¼ä¸€èµ·å‘å‡ºã€‚\nval input: DataStream[(String, Long)] = ... input .keyBy(\u0026lt;key selector\u0026gt;) .timeWindow(\u0026lt;duration\u0026gt;) .aggregate(new AverageAggregate(), new MyProcessWindowFunction()) // Function definitions  /** * The accumulator is used to keep a running sum and a count. The [getResult] method * computes the average. */ class AverageAggregate extends AggregateFunction[(String, Long), (Long, Long), Double] { override def createAccumulator() = (0L, 0L) override def add(value: (String, Long), accumulator: (Long, Long)) = (accumulator._1 + value._2, accumulator._2 + 1L) override def getResult(accumulator: (Long, Long)) = accumulator._1 / accumulator._2 override def merge(a: (Long, Long), b: (Long, Long)) = (a._1 + b._1, a._2 + b._2) } class MyProcessWindowFunction extends ProcessWindowFunction[Double, (String, Double), String, TimeWindow] { def process(key: String, context: Context, averages: Iterable[Double], out: Collector[(String, Double)]) = { val average = averages.iterator.next() out.collect((key, average)) } } ç”¨ FoldFunction è¿›è¡Œå¢é‡çª—å£èšåˆ ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•å°†å¢é‡å¼ FoldFunction ä¸ ProcessWindowFunction ç›¸ç»“åˆï¼Œä»¥æå–çª—å£ä¸­çš„äº‹ä»¶æ•°é‡ï¼Œå¹¶è¿”å›çª—å£çš„é”®å’Œç»“æŸæ—¶é—´ã€‚\nval input: DataStream[SensorReading] = ... input .keyBy(\u0026lt;key selector\u0026gt;) .timeWindow(\u0026lt;duration\u0026gt;) .fold ( (\u0026#34;\u0026#34;, 0L, 0), (acc: (String, Long, Int), r: SensorReading) =\u0026gt; { (\u0026#34;\u0026#34;, 0L, acc._3 + 1) }, ( key: String, window: TimeWindow, counts: Iterable[(String, Long, Int)], out: Collector[(String, Long, Int)] ) =\u0026gt; { val count = counts.iterator.next() out.collect((key, window.getEnd, count._3)) } ) åœ¨ ProcessWindowFunction ä¸­ä½¿ç”¨ per-çª—å£çŠ¶æ€ é™¤äº†è®¿é—® keyed çŠ¶æ€ï¼ˆä»»ä½•å¯Œå‡½æ•°éƒ½å¯ä»¥ï¼‰ï¼ŒProcessWindowFunction è¿˜å¯ä»¥ä½¿ç”¨ keyed çŠ¶æ€ï¼Œè¯¥çŠ¶æ€çš„ä½œç”¨åŸŸæ˜¯å‡½æ•°å½“å‰æ­£åœ¨å¤„ç†çš„çª—å£ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç†è§£æ¯ä¸ªçª—å£çŠ¶æ€æ‰€æŒ‡çš„çª—å£æ˜¯ä»€ä¹ˆå¾ˆé‡è¦ã€‚è¿™é‡Œæ¶‰åŠåˆ°ä¸åŒçš„\u0026quot;çª—å£\u0026quot;ã€‚\n çª—å£æ˜¯åœ¨æŒ‡å®šçª—å£æ“ä½œæ—¶å®šä¹‰çš„ã€‚è¿™å¯èƒ½æ˜¯1å°æ—¶çš„æ»šåŠ¨çª—å£æˆ–è€…2å°æ—¶çš„æ»‘åŠ¨çª—å£ï¼Œæ»‘åŠ¨1å°æ—¶ã€‚ ä¸€ä¸ªç»™å®šçš„é”®çš„å®šä¹‰çª—å£çš„å®é™…å®ä¾‹ã€‚è¿™å¯èƒ½æ˜¯ 12: 00 åˆ° 13: 00 çš„æ—¶é—´çª—å£ï¼Œç”¨æˆ· ID xyz. è¿™æ˜¯åŸºäºçª—å£å®šä¹‰çš„ï¼Œä¼šæœ‰å¾ˆå¤šçª—å£ï¼ŒåŸºäºä½œä¸šå½“å‰æ­£åœ¨å¤„ç†çš„é”®çš„æ•°é‡ï¼ŒåŸºäºäº‹ä»¶å±äºä»€ä¹ˆæ—¶é—´æ®µã€‚  æ¯ä¸ªçª—å£çš„çŠ¶æ€ä¸è¿™ä¸¤è€…ä¸­çš„åä¸€ç§æŒ‚é’©ã€‚æ„æ€æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬å¤„ç†äº†1000ä¸ªä¸åŒé”®çš„äº‹ä»¶ï¼Œå¹¶ä¸”æ‰€æœ‰é”®çš„äº‹ä»¶å½“å‰éƒ½å±äº [12:00ï¼Œ13:00) æ—¶é—´çª—å£ï¼Œé‚£ä¹ˆå°†æœ‰1000ä¸ªçª—å£å®ä¾‹ï¼Œæ¯ä¸ªçª—å£éƒ½æœ‰è‡ªå·±çš„é”®çš„per-çª—å£çŠ¶æ€ã€‚\nprocess() è°ƒç”¨æ¥æ”¶åˆ°çš„ Context å¯¹è±¡ä¸Šæœ‰ä¸¤ä¸ªæ–¹æ³•å…è®¸è®¿é—®è¿™ä¸¤ç§ç±»å‹çš„çŠ¶æ€ã€‚\n globalState()ï¼Œå…è®¸è®¿é—®ä¸åœ¨çª—å£èŒƒå›´å†…çš„ keyed çŠ¶æ€ã€‚ windowState()ï¼Œå®ƒå…è®¸è®¿é—®åŒæ ·ä½œç”¨äºçª—å£çš„ keyed çŠ¶æ€ã€‚  å¦‚æœä½ é¢„è®¡åŒä¸€çª—å£ä¼šæœ‰å¤šæ¬¡å‘å°„ï¼Œé‚£ä¹ˆè¿™ä¸ªåŠŸèƒ½æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ï¼Œå› ä¸ºå½“ä½ å¯¹æ™šåˆ°çš„æ•°æ®æœ‰æ™šå‘å°„çš„æƒ…å†µï¼Œæˆ–è€…å½“ä½ æœ‰ä¸€ä¸ªè‡ªå®šä¹‰çš„è§¦å‘å™¨ï¼ŒåšæŠ•æœºæ€§çš„æ—©æœŸå‘å°„æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ ä¼šåœ¨æ¯ä¸ªçª—å£çŠ¶æ€ä¸‹å­˜å‚¨ä¹‹å‰çš„å‘å°„ä¿¡æ¯æˆ–å‘å°„æ¬¡æ•°ã€‚\nå½“ä½¿ç”¨çª—å£çŠ¶æ€æ—¶ï¼Œé‡è¦çš„æ˜¯å½“çª—å£è¢«æ¸…é™¤æ—¶ä¹Ÿè¦æ¸…ç†è¯¥çŠ¶æ€ã€‚è¿™åº”è¯¥å‘ç”Ÿåœ¨ clear() æ–¹æ³•ä¸­ã€‚\nWindowFunction(Legacy) åœ¨ä¸€äº›å¯ä»¥ä½¿ç”¨ ProcessWindowFunction çš„åœ°æ–¹ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ WindowFunctionã€‚è¿™æ˜¯ ProcessWindowFunction çš„æ—§ç‰ˆæœ¬ï¼Œå®ƒæä¾›çš„ä¸Šä¸‹æ–‡ä¿¡æ¯è¾ƒå°‘ï¼Œè€Œä¸”æ²¡æœ‰ä¸€äº›å…ˆè¿›çš„åŠŸèƒ½ï¼Œæ¯”å¦‚æ¯ä¸ªçª—å£çš„ keyed çŠ¶æ€ã€‚è¿™ä¸ªæ¥å£åœ¨æŸäº›æ—¶å€™ä¼šè¢«åºŸå¼ƒã€‚\nWindowFunction çš„ç­¾åå¦‚ä¸‹ã€‚\ntrait WindowFunction[IN, OUT, KEY, W \u0026lt;: Window] extends Function with Serializable { /** * Evaluates the window and outputs none or several elements. * * @param key The key for which this window is evaluated. * @param window The window that is being evaluated. * @param input The elements in the window being evaluated. * @param out A collector for emitting elements. * @throws Exception The function may throw exceptions to fail the program and trigger recovery. */ def apply(key: KEY, window: W, input: Iterable[IN], out: Collector[OUT]) } å¯ä»¥è¿™æ ·ä½¿ç”¨ã€‚\nval input: DataStream[(String, Long)] = ... input .keyBy(\u0026lt;key selector\u0026gt;) .window(\u0026lt;window assigner\u0026gt;) .apply(new MyWindowFunction()) è§¦å‘å™¨ è§¦å‘å™¨å†³å®šä¸€ä¸ªçª—å£ï¼ˆç”±çª—å£åˆ†é…å™¨å½¢æˆï¼‰ä½•æ—¶å¯ä»¥è¢«çª—å£å‡½æ•°å¤„ç†ã€‚æ¯ä¸ª WindowAssigner éƒ½æœ‰ä¸€ä¸ªé»˜è®¤çš„è§¦å‘å™¨ã€‚å¦‚æœé»˜è®¤çš„è§¦å‘å™¨ä¸ç¬¦åˆä½ çš„éœ€æ±‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ trigger(...) æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„è§¦å‘å™¨ã€‚\nè§¦å‘å™¨æ¥å£æœ‰äº”ä¸ªæ–¹æ³•ï¼Œå…è®¸ Trigger å¯¹ä¸åŒçš„äº‹ä»¶åšå‡ºååº”ã€‚\n onElement() æ–¹æ³•å¯¹æ¯ä¸ªæ·»åŠ åˆ°çª—å£çš„å…ƒç´ éƒ½ä¼šè¢«è°ƒç”¨ã€‚ onEventTime() æ–¹æ³•åœ¨æ³¨å†Œçš„äº‹ä»¶æ—¶é—´å®šæ—¶å™¨å¯åŠ¨æ—¶è¢«è°ƒç”¨ã€‚ onProcessingTime() æ–¹æ³•åœ¨æ³¨å†Œçš„å¤„ç†æ—¶é—´è®¡æ—¶å™¨å¯åŠ¨æ—¶è¢«è°ƒç”¨ã€‚ onMerge() æ–¹æ³•ä¸æœ‰çŠ¶æ€çš„è§¦å‘å™¨ç›¸å…³ï¼Œå½“ä¸¤ä¸ªè§¦å‘å™¨çš„å¯¹åº”çª—å£åˆå¹¶æ—¶ï¼Œä¾‹å¦‚ä½¿ç”¨ä¼šè¯çª—å£æ—¶ï¼Œå°±ä¼šåˆå¹¶ä¸¤ä¸ªè§¦å‘å™¨çš„çŠ¶æ€ã€‚ æœ€å clear() æ–¹æ³•åœ¨åˆ é™¤ç›¸åº”çª—å£æ—¶æ‰§è¡Œä»»ä½•éœ€è¦çš„æ“ä½œã€‚  å…³äºä»¥ä¸Šæ–¹æ³•æœ‰ä¸¤ç‚¹éœ€è¦æ³¨æ„ã€‚\n1ï¼‰å‰ä¸‰ä¸ªæ–¹æ³•é€šè¿‡è¿”å›ä¸€ä¸ª TriggerResult æ¥å†³å®šå¦‚ä½•å¯¹å…¶è°ƒç”¨äº‹ä»¶é‡‡å–è¡ŒåŠ¨ã€‚åŠ¨ä½œå¯ä»¥æ˜¯ä»¥ä¸‹ä¹‹ä¸€ã€‚\n CONTINUEï¼šä»€ä¹ˆä¹Ÿä¸åšã€‚ FIREï¼šè§¦å‘è®¡ç®—ã€‚ PURGEï¼šæ¸…é™¤çª—å£ä¸­çš„å…ƒç´ ï¼Œä»¥åŠ FIRE_AND_PURGEï¼šè§¦å‘è®¡ç®—ï¼Œä¹‹åæ¸…é™¤çª—å£ä¸­çš„å…ƒç´ ã€‚  è¿™äº›æ–¹æ³•ä¸­çš„ä»»ä½•ä¸€ç§éƒ½å¯ä»¥ç”¨æ¥æ³¨å†Œå¤„ç†æ—¶é—´æˆ–äº‹ä»¶æ—¶é—´çš„å®šæ—¶å™¨ï¼Œä»¥å¤‡å°†æ¥çš„æ“ä½œã€‚  Fire å’Œ Purge ä¸€æ—¦è§¦å‘å™¨ç¡®å®šä¸€ä¸ªçª—å£å¯ä»¥å¤„ç†ï¼Œå®ƒå°±ä¼šå‘å°„ï¼Œå³è¿”å› FIRE æˆ– FIRE_AND_PURGEã€‚è¿™æ˜¯çª—å£æ“ä½œè€…å‘å‡ºå½“å‰çª—å£ç»“æœçš„ä¿¡å·ã€‚ç»™å®šä¸€ä¸ªå¸¦æœ‰ ProcessWindowFunction çš„çª—å£ï¼Œæ‰€æœ‰çš„å…ƒç´ éƒ½ä¼šè¢«ä¼ é€’ç»™ ProcessWindowFunctionï¼ˆå¯èƒ½æ˜¯åœ¨å°†å®ƒä»¬ä¼ é€’ç»™ evictor ä¹‹åï¼‰ã€‚å¸¦æœ‰ ReduceFunctionã€AggregateFunction æˆ– FoldFunction çš„çª—å£åªæ˜¯ç®€å•åœ°å‘å‡ºå®ƒä»¬æ€¥åˆ‡çš„èšåˆç»“æœã€‚\nå½“ä¸€ä¸ªè§¦å‘å™¨å‘å°„æ—¶ï¼Œå®ƒå¯ä»¥æ˜¯ FIRE æˆ– FIRE_AND_PURGEã€‚FIRE ä¿ç•™çª—å£çš„å†…å®¹ï¼Œè€Œ FIRE_AND_PURGE åˆ™åˆ é™¤å…¶å†…å®¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œé¢„å…ˆå®ç°çš„è§¦å‘å™¨åªæ˜¯ FIRE è€Œä¸æ¸…é™¤çª—å£çŠ¶æ€ã€‚\næ³¨æ„ Purging å°†ç®€å•åœ°åˆ é™¤çª—å£çš„å†…å®¹ï¼Œå¹¶å°†å®Œæ•´åœ°ä¿ç•™ä»»ä½•å…³äºçª—å£å’Œä»»ä½•è§¦å‘çŠ¶æ€çš„æ½œåœ¨å…ƒä¿¡æ¯ã€‚\nçª—å£åˆ†é…å™¨çš„é»˜è®¤è§¦å‘å™¨ WindowAssigner çš„é»˜è®¤è§¦å‘å™¨é€‚åˆäºè®¸å¤šç”¨ä¾‹ã€‚ä¾‹å¦‚ï¼Œæ‰€æœ‰çš„äº‹ä»¶æ—¶é—´çª—å£åˆ†é…å™¨éƒ½æœ‰ä¸€ä¸ª EventTimeTrigger ä½œä¸ºé»˜è®¤è§¦å‘å™¨ã€‚è¿™ä¸ªè§¦å‘å™¨ä»…ä»…æ˜¯åœ¨æ°´å°é€šè¿‡çª—å£ç»“æŸåå°±ä¼šè§¦å‘ã€‚\næ³¨æ„ï¼šGlobalWindow çš„é»˜è®¤è§¦å‘å™¨æ˜¯ NeverTriggerï¼Œå®ƒæ°¸è¿œä¸ä¼šè§¦å‘ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨ GlobalWindow æ—¶ï¼Œæ‚¨å¿…é¡»å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰çš„è§¦å‘å™¨ã€‚\næ³¨æ„ï¼šé€šè¿‡ä½¿ç”¨ trigger() æŒ‡å®šä¸€ä¸ªè§¦å‘å™¨ï¼Œæ‚¨å°†è¦†ç›–ä¸€ä¸ª WindowAssigner çš„é»˜è®¤è§¦å‘å™¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ ä¸º TumblingEventTimeWindows æŒ‡å®šäº†ä¸€ä¸ª CountTriggerï¼Œä½ å°†ä¸å†è·å¾—åŸºäºæ—¶é—´è¿›åº¦çš„çª—å£å¯åŠ¨ï¼Œè€Œåªèƒ½é€šè¿‡è®¡æ•°æ¥è·å¾—ã€‚ç°åœ¨ï¼Œå¦‚æœä½ æƒ³åŒæ—¶åŸºäºæ—¶é—´å’Œè®¡æ•°åšå‡ºååº”ï¼Œä½ å¿…é¡»ç¼–å†™è‡ªå·±çš„è‡ªå®šä¹‰è§¦å‘å™¨ã€‚\nå†…ç½®å’Œè‡ªå®šä¹‰è§¦å‘å™¨ Flink å†…ç½®äº†ä¸€äº›è§¦å‘å™¨ã€‚\n å‰é¢å·²ç»æåˆ°è¿‡çš„, EventTimeTrigger ä¼šæ ¹æ®æ°´å°æµ‹é‡çš„äº‹ä»¶æ—¶é—´çš„è¿›å±•è€Œè§¦å‘ã€‚ å¤„ç†æ—¶é—´è§¦å‘å™¨ï¼ˆProcessingTimeTriggerï¼‰åŸºäºå¤„ç†æ—¶é—´è€Œè§¦å‘ã€‚ CountTrigger åœ¨ä¸€ä¸ªçª—å£ä¸­çš„å…ƒç´ æ•°é‡è¶…è¿‡ç»™å®šçš„é™åˆ¶æ—¶è§¦å‘ã€‚ PurgingTrigger å°†å¦ä¸€ä¸ªè§¦å‘å™¨ä½œä¸ºå‚æ•°ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªæ¸…æ´—è§¦å‘å™¨ã€‚  å¦‚æœä½ éœ€è¦å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„è§¦å‘å™¨ï¼Œä½ åº”è¯¥æŸ¥çœ‹æŠ½è±¡çš„ Trigger ç±»ã€‚è¯·æ³¨æ„ï¼ŒAPI ä»åœ¨ä¸æ–­å‘å±•ï¼Œå¯èƒ½ä¼šåœ¨ Flink çš„æœªæ¥ç‰ˆæœ¬ä¸­æ”¹å˜ã€‚\nEvictors Flink çš„çª—å£æ¨¡å‹å…è®¸åœ¨ WindowAssigner å’Œ Trigger ä¹‹å¤–æŒ‡å®šä¸€ä¸ªå¯é€‰çš„ Evictorã€‚è¿™å¯ä»¥é€šè¿‡ evictor(...) æ–¹æ³•æ¥å®Œæˆï¼ˆå¦‚æœ¬æ–‡å¼€å¤´æ‰€ç¤ºï¼‰ã€‚Evictor èƒ½å¤Ÿåœ¨è§¦å‘å™¨è§¦å‘åå’Œåº”ç”¨çª—å£å‡½æ•°ä¹‹å‰å’Œ/æˆ–ä¹‹åä»çª—å£ä¸­ç§»é™¤å…ƒç´ ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼ŒEvictor æ¥å£æœ‰ä¸¤ä¸ªæ–¹æ³•ã€‚\n/** * Optionally evicts elements. Called before windowing function. * * @param elements The elements currently in the pane. * @param size The current number of elements in the pane. * @param window The {@link Window} * @param evictorContext The context for the Evictor */ void evictBefore(Iterable\u0026lt;TimestampedValue\u0026lt;T\u0026gt;\u0026gt; elements, int size, W window, EvictorContext evictorContext); /** * Optionally evicts elements. Called after windowing function. * * @param elements The elements currently in the pane. * @param size The current number of elements in the pane. * @param window The {@link Window} * @param evictorContext The context for the Evictor */ void evictAfter(Iterable\u0026lt;TimestampedValue\u0026lt;T\u0026gt;\u0026gt; elements, int size, W window, EvictorContext evictorContext); evictBefore() åŒ…å«åœ¨çª—å£å‡½æ•°ä¹‹å‰åº”ç”¨çš„é©±é€é€»è¾‘ï¼Œè€Œ evictAfter() åŒ…å«åœ¨çª—å£å‡½æ•°ä¹‹ååº”ç”¨çš„é€»è¾‘ã€‚åœ¨åº”ç”¨çª—å£å‡½æ•°ä¹‹å‰è¢«é©±é€çš„å…ƒç´ å°†ä¸ä¼šè¢«å®ƒå¤„ç†ã€‚\nFlink è‡ªå¸¦äº†ä¸‰ä¸ªé¢„å…ˆå®ç°çš„é©±é€å™¨ã€‚è¿™ä¸‰ä¸ªæ˜¯:\n CountEvictorï¼šä»çª—å£ä¸­ä¿ç•™æœ€å¤šç”¨æˆ·æŒ‡å®šæ•°é‡çš„å…ƒç´ ï¼Œå¹¶ä»çª—å£ç¼“å†²åŒºå¼€å§‹ä¸¢å¼ƒå‰©ä½™çš„å…ƒç´ ã€‚ DeltaEvictorï¼šå– DeltaFunction å’Œé˜ˆå€¼ï¼Œè®¡ç®—çª—å£ç¼“å†²åŒºä¸­æœ€åä¸€ä¸ªå…ƒç´ å’Œå‰©ä½™å…ƒç´ ä¹‹é—´çš„ deltaï¼Œå¹¶åˆ é™¤ delta å¤§äºæˆ–ç­‰äºé˜ˆå€¼çš„å…ƒç´ ã€‚ TimeEvictorï¼šä»¥æ¯«ç§’ä¸ºå•ä½çš„æ—¶é—´é—´éš”ä½œä¸ºå‚æ•°ï¼Œå¯¹äºä¸€ä¸ªç»™å®šçš„çª—å£ï¼Œå®ƒåœ¨å…¶å…ƒç´ ä¸­æ‰¾åˆ°æœ€å¤§çš„æ—¶é—´æˆ³ max_tsï¼Œå¹¶åˆ é™¤æ‰€æœ‰æ—¶é—´æˆ³å°äº max_ts - interval çš„å…ƒç´ ã€‚  é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰é¢„å…ˆå®ç°çš„ evictor éƒ½ä¼šåœ¨ window å‡½æ•°ä¹‹å‰åº”ç”¨å…¶é€»è¾‘ã€‚\næ³¨æ„: æŒ‡å®šä¸€ä¸ª evictor å¯ä»¥é˜²æ­¢ä»»ä½•é¢„èšé›†ï¼Œå› ä¸ºä¸€ä¸ªçª—å£çš„æ‰€æœ‰å…ƒç´ éƒ½å¿…é¡»åœ¨åº”ç”¨è®¡ç®—ä¹‹å‰ä¼ é€’ç»™ evictorã€‚\næ³¨æ„ Flink ä¸ä¿è¯çª—å£å†…å…ƒç´ çš„é¡ºåºã€‚è¿™æ„å‘³ç€ï¼Œè™½ç„¶ evictor å¯ä»¥ä»çª—å£çš„å¼€å¤´ç§»é™¤å…ƒç´ ï¼Œä½†è¿™äº›å…ƒç´ ä¸ä¸€å®šæ˜¯æœ€å…ˆæˆ–æœ€ååˆ°è¾¾çš„ã€‚\nå…è®¸çš„å»¶è¿Ÿ å½“ä½¿ç”¨äº‹ä»¶æ—¶é—´çª—å£æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿå…ƒç´ è¿Ÿåˆ°çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒFlink ç”¨æ¥è·Ÿè¸ªäº‹ä»¶æ—¶é—´è¿›åº¦çš„æ°´å°å·²ç»è¶…è¿‡äº†å…ƒç´ æ‰€å±çª—å£çš„ç»“æŸæ—¶é—´æˆ³ã€‚å…³äº Flink å¦‚ä½•å¤„ç†äº‹ä»¶æ—¶é—´ï¼Œè¯·å‚è§äº‹ä»¶æ—¶é—´ï¼Œå°¤å…¶æ˜¯è¿Ÿåˆ°å…ƒç´ ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æ°´å°è¶…è¿‡çª—å£çš„ç»“æŸæ—¶é—´æ—¶ï¼Œæ™šæœŸå…ƒç´ å°±ä¼šè¢«åˆ é™¤ã€‚ç„¶è€Œï¼ŒFlink å…è®¸ä¸ºçª—å£æ“ä½œè€…æŒ‡å®šä¸€ä¸ªæœ€å¤§å…è®¸å»¶è¿Ÿã€‚å…è®¸å»¶è¿ŸæŒ‡å®šäº†å…ƒç´ åœ¨è¢«ä¸¢å¼ƒä¹‹å‰å¯ä»¥è¿Ÿåˆ°å¤šå°‘æ—¶é—´ï¼Œå…¶é»˜è®¤å€¼ä¸º0ã€‚ åœ¨æ°´å°é€šè¿‡çª—å£ç»“æŸåä½†åœ¨å…¶é€šè¿‡çª—å£ç»“æŸå‰åŠ ä¸Šå…è®¸å»¶è¿Ÿä¹‹å‰åˆ°è¾¾çš„å…ƒç´ ï¼Œä»ç„¶ä¼šè¢«æ·»åŠ åˆ°çª—å£ä¸­ã€‚æ ¹æ®æ‰€ä½¿ç”¨çš„è§¦å‘å™¨ï¼Œä¸€ä¸ªè¿Ÿåˆ°ä½†æœªè¢«ä¸¢å¼ƒçš„å…ƒç´ å¯èƒ½ä¼šå¯¼è‡´çª—å£å†æ¬¡å¯åŠ¨ã€‚EventTimeTrigger å°±å±äºè¿™ç§æƒ…å†µã€‚\nä¸ºäº†ä½¿è¿™ä¸ªå·¥ä½œï¼ŒFlink ä¼šä¿æŒçª—å£çš„çŠ¶æ€ï¼Œç›´åˆ°å®ƒä»¬çš„å…è®¸å»¶è¿Ÿè¿‡æœŸã€‚ä¸€æ—¦å‘ç”Ÿè¿™ç§æƒ…å†µï¼ŒFlink å°±ä¼šåˆ é™¤çª—å£å¹¶åˆ é™¤å…¶çŠ¶æ€ï¼Œè¿™ä¸€ç‚¹åœ¨çª—å£ç”Ÿå‘½å‘¨æœŸéƒ¨åˆ†ä¹Ÿæœ‰æè¿°ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œå…è®¸çš„å»¶è¿Ÿè¢«è®¾ç½®ä¸º0ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåˆ°è¾¾æ°´å°åé¢çš„å…ƒç´ å°†è¢«ä¸¢å¼ƒã€‚\næ‚¨å¯ä»¥åƒè¿™æ ·æŒ‡å®šå…è®¸çš„å»¶è¿Ÿã€‚\nval input: DataStream[T] = ... input .keyBy(\u0026lt;key selector\u0026gt;) .window(\u0026lt;window assigner\u0026gt;) .allowedLateness(\u0026lt;time\u0026gt;) .\u0026lt;windowed transformation\u0026gt;(\u0026lt;window function\u0026gt;) æ³¨æ„ å½“ä½¿ç”¨ GlobalWindows çª—å£åˆ†é…å™¨æ—¶ï¼Œç”±äºå…¨å±€çª—å£çš„ç»“æŸæ—¶é—´æˆ³æ˜¯ Long.MAX_VALUEï¼Œå› æ­¤æ²¡æœ‰æ•°æ®è¢«è®¤ä¸ºæ˜¯è¿Ÿåˆ°æ•°æ®ã€‚\nä½œä¸ºä¾§è¾“å‡ºè·å–è¿Ÿåˆ°æ•°æ® ä½¿ç”¨ Flink çš„ä¾§è¾“å‡ºåŠŸèƒ½ï¼Œä½ å¯ä»¥å¾—åˆ°ä¸€ä¸ªè¢«ä¸¢å¼ƒçš„è¿Ÿåˆ°æ•°æ®æµã€‚\né¦–å…ˆï¼Œä½ éœ€è¦åœ¨çª—å£åŒ–çš„æ•°æ®æµä¸Šä½¿ç”¨ sideOutputLateData(OutputTag) æ¥æŒ‡å®šä½ è¦è·å–è¿Ÿåˆ°çš„æ•°æ®ã€‚ç„¶åï¼Œä½ å°±å¯ä»¥åœ¨çª—å£åŒ–æ“ä½œçš„ç»“æœä¸Šå¾—åˆ°ä¾§è¾“å‡ºæµã€‚\nval lateOutputTag = OutputTag[T](\u0026#34;late-data\u0026#34;) val input: DataStream[T] = ... val result = input .keyBy(\u0026lt;key selector\u0026gt;) .window(\u0026lt;window assigner\u0026gt;) .allowedLateness(\u0026lt;time\u0026gt;) .sideOutputLateData(lateOutputTag) .\u0026lt;windowed transformation\u0026gt;(\u0026lt;window function\u0026gt;) val lateStream = result.getSideOutput(lateOutputTag) è¿Ÿåˆ°å…ƒç´ çš„è€ƒè™‘ å½“æŒ‡å®šå…è®¸çš„å»¶è¿Ÿå¤§äº0æ—¶ï¼Œåœ¨æ°´å°é€šè¿‡çª—å£ç»“æŸåï¼Œçª—å£åŠå…¶å†…å®¹å°†è¢«ä¿ç•™ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œå½“ä¸€ä¸ªè¿Ÿåˆ°ä½†æœªè¢«ä¸¢å¼ƒçš„å…ƒç´ åˆ°è¾¾æ—¶ï¼Œå®ƒå¯èƒ½ä¼šè§¦å‘çª—å£çš„å¦ä¸€æ¬¡å‘å°„ã€‚è¿™äº›å‘å°„è¢«ç§°ä¸ºæ™šæœŸå‘å°„ï¼Œå› ä¸ºå®ƒä»¬æ˜¯ç”±æ™šæœŸäº‹ä»¶è§¦å‘çš„ï¼Œä¸ä¸»å‘å°„ç›¸åï¼Œä¸»å‘å°„æ˜¯çª—å£çš„ç¬¬ä¸€æ¬¡å‘å°„ã€‚åœ¨ä¼šè¯çª—å£çš„æƒ…å†µä¸‹ï¼Œè¿Ÿå‘å¯èƒ½ä¼šè¿›ä¸€æ­¥å¯¼è‡´çª—å£çš„åˆå¹¶ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¼š\u0026quot;å¼¥åˆ\u0026quot;ä¸¤ä¸ªå·²ç»å­˜åœ¨çš„ã€æœªåˆå¹¶çš„çª—å£ä¹‹é—´çš„å·®è·ã€‚\næ³¨æ„ï¼šä½ åº”è¯¥æ„è¯†åˆ°ï¼Œæ™šç‚¹å‘å°„çš„å…ƒç´ åº”è¯¥è¢«è§†ä¸ºä¹‹å‰è®¡ç®—çš„æ›´æ–°ç»“æœï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä½ çš„æ•°æ®æµå°†åŒ…å«åŒä¸€è®¡ç®—çš„å¤šä¸ªç»“æœã€‚æ ¹æ®ä½ çš„åº”ç”¨ï¼Œä½ éœ€è¦è€ƒè™‘åˆ°è¿™äº›é‡å¤çš„ç»“æœï¼Œæˆ–è€…å¯¹å®ƒä»¬è¿›è¡Œé‡å¤å¤åˆ¶ã€‚\nå¤„ç†çª—å£ç»“æœ çª—å£åŒ–æ“ä½œçš„ç»“æœåˆæ˜¯ä¸€ä¸ª DataStreamï¼Œåœ¨ç»“æœå…ƒç´ ä¸­æ²¡æœ‰ä¿ç•™ä»»ä½•å…³äºçª—å£åŒ–æ“ä½œçš„ä¿¡æ¯ï¼Œæ‰€ä»¥å¦‚æœä½ æƒ³ä¿ç•™çª—å£çš„å…ƒä¿¡æ¯ï¼Œä½ å¿…é¡»åœ¨ä½ çš„ ProcessWindowFunction çš„ç»“æœå…ƒç´ ä¸­æ‰‹åŠ¨ç¼–ç è¿™äº›ä¿¡æ¯ã€‚åœ¨ç»“æœå…ƒç´ ä¸Šè®¾ç½®çš„å”¯ä¸€ç›¸å…³ä¿¡æ¯æ˜¯å…ƒç´ çš„æ—¶é—´æˆ³ã€‚è¿™è¢«è®¾ç½®ä¸ºå¤„ç†è¿‡çš„çª—å£çš„æœ€å¤§å…è®¸æ—¶é—´æˆ³ï¼Œä¹Ÿå°±æ˜¯ç»“æŸæ—¶é—´æˆ³-1ï¼Œå› ä¸ºçª—å£ç»“æŸæ—¶é—´æˆ³æ˜¯ç‹¬å çš„ã€‚æ³¨æ„ï¼Œè¿™å¯¹äº‹ä»¶æ—¶é—´çª—å£å’Œå¤„ç†æ—¶é—´çª—å£éƒ½æ˜¯å¦‚æ­¤ï¼Œå³åœ¨çª—å£åŒ–æ“ä½œåå…ƒç´ æ€»æ˜¯æœ‰ä¸€ä¸ªæ—¶é—´æˆ³ï¼Œä½†è¿™ä¸ªæ—¶é—´æˆ³å¯ä»¥æ˜¯äº‹ä»¶æ—¶é—´æ—¶é—´æˆ³ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤„ç†æ—¶é—´æ—¶é—´æˆ³ã€‚å¯¹äºå¤„ç†æ—¶é—´çª—å£æ¥è¯´ï¼Œè¿™æ²¡æœ‰ç‰¹åˆ«çš„å½±å“ï¼Œä½†æ˜¯å¯¹äºäº‹ä»¶æ—¶é—´çª—å£æ¥è¯´ï¼ŒåŠ ä¸Šæ°´å°ä¸çª—å£çš„äº¤äº’æ–¹å¼ï¼Œä½¿å¾—è¿ç»­çš„çª—å£åŒ–æ“ä½œå…·æœ‰ç›¸åŒçš„çª—å£å¤§å°ã€‚æˆ‘ä»¬å°†åœ¨çœ‹å®Œæ°´å°å¦‚ä½•ä¸çª—å£äº¤äº’åå†è°ˆè¿™ä¸ªé—®é¢˜ã€‚\næ°´å°å’Œçª—å£çš„äº¤äº’ åœ¨ç»§ç»­æœ¬èŠ‚ä¹‹å‰ï¼Œä½ å¯èƒ½æƒ³çœ‹çœ‹æˆ‘ä»¬å…³äºäº‹ä»¶æ—¶é—´å’Œæ°´å°çš„ç« èŠ‚ã€‚\nå½“æ°´å°åˆ°è¾¾çª—å£æ“ä½œç¬¦æ—¶ï¼Œä¼šè§¦å‘ä¸¤ä»¶äº‹ã€‚\n æ°´å°ä¼šè§¦å‘è®¡ç®—æ‰€æœ‰çª—å£çš„æœ€å¤§æ—¶é—´æˆ³ï¼ˆå°±æ˜¯ç»“æŸæ—¶é—´æˆ³-1ï¼‰å°äºæ–°æ°´å°çš„çª—å£ã€‚ æ°´å°è¢«è½¬å‘åˆ°ä¸‹æ¸¸çš„æ“ä½œä¸­  ç›´è§‚åœ°è¯´ï¼Œæ°´å°ä¼š\u0026quot;å†²æ‰\u0026quot;ä»»ä½•åœ¨ä¸‹æ¸¸æ“ä½œä¸­è¢«è®¤ä¸ºæ˜¯æ™šæœŸçš„çª—å£ï¼Œä¸€æ—¦å®ƒä»¬æ”¶åˆ°è¯¥æ°´å°ã€‚\nè¿ç»­çš„çª—å£æ“ä½œ å¦‚å‰æ‰€è¿°ï¼Œè®¡ç®—çª—å£åŒ–ç»“æœçš„æ—¶é—´æˆ³çš„æ–¹å¼ä»¥åŠæ°´å°ä¸çª—å£çš„äº¤äº’æ–¹å¼å…è®¸å°†è¿ç»­çš„çª—å£åŒ–æ“ä½œä¸²åœ¨ä¸€èµ·ã€‚å½“ä½ æƒ³è¿›è¡Œä¸¤ä¸ªè¿ç»­çš„çª—å£åŒ–æ“ä½œæ—¶ï¼Œå¦‚æœä½ æƒ³ä½¿ç”¨ä¸åŒçš„é”®ï¼Œä½†ä»ç„¶å¸Œæœ›æ¥è‡ªåŒä¸€ä¸ªä¸Šæ¸¸çª—å£çš„å…ƒç´ æœ€ç»ˆå‡ºç°åœ¨åŒä¸€ä¸ªä¸‹æ¸¸çª—å£ä¸­ï¼Œè¿™å°±å¾ˆæœ‰ç”¨ã€‚è€ƒè™‘è¿™ä¸ªä¾‹å­ã€‚\nval input: DataStream[Int] = ... val resultsPerKey = input .keyBy(\u0026lt;key selector\u0026gt;) .window(TumblingEventTimeWindows.of(Time.seconds(5))) .reduce(new Summer()) val globalResults = resultsPerKey .windowAll(TumblingEventTimeWindows.of(Time.seconds(5))) .process(new TopKWindowFunction()) åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç¬¬ä¸€æ¬¡æ“ä½œçš„æ—¶é—´çª—å£ [0ï¼Œ5) çš„ç»“æœä¹Ÿä¼šåœ¨éšåçš„çª—å£æ“ä½œä¸­æœ€ç»ˆå‡ºç°åœ¨æ—¶é—´çª—å£ [0ï¼Œ5)ã€‚è¿™æ ·å°±å¯ä»¥è®¡ç®—æ¯ä¸ªé”®çš„å’Œï¼Œç„¶ååœ¨ç¬¬äºŒä¸ªæ“ä½œä¸­è®¡ç®—åŒä¸€çª—å£å†…çš„ top-k å…ƒç´ ã€‚\næœ‰ç”¨çš„çŠ¶æ€å¤§å°è€ƒè™‘ çª—å£å¯ä»¥åœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´å†…ï¼ˆå¦‚å‡ å¤©ã€å‡ å‘¨æˆ–å‡ ä¸ªæœˆï¼‰è¢«å®šä¹‰ï¼Œå› æ­¤ä¼šç§¯ç´¯éå¸¸å¤§çš„çŠ¶æ€ã€‚åœ¨ä¼°ç®—çª—å£è®¡ç®—çš„å­˜å‚¨éœ€æ±‚æ—¶ï¼Œæœ‰å‡ ä¸ªè§„åˆ™éœ€è¦ç‰¢è®°ã€‚\n  Flink ä¸ºæ¯ä¸ªå…ƒç´ æ‰€å±çš„çª—å£åˆ›å»ºä¸€ä¸ªå‰¯æœ¬ã€‚é‰´äºæ­¤ï¼Œç¿»æ»šçª—å£ä¸ºæ¯ä¸ªå…ƒç´ ä¿ç•™ä¸€ä¸ªå‰¯æœ¬ï¼ˆä¸€ä¸ªå…ƒç´ æ­£å¥½å±äºä¸€ä¸ªçª—å£ï¼Œé™¤éå®ƒè¢«åæœŸä¸¢å¼ƒï¼‰ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œæ»‘åŠ¨çª—å£ä¼šç»™æ¯ä¸ªå…ƒç´ åˆ›å»ºè‹¥å¹²ä¸ªï¼Œè¿™ä¸€ç‚¹åœ¨çª—å£åˆ†é…å™¨éƒ¨åˆ†æœ‰è§£é‡Šã€‚å› æ­¤ï¼Œå¤§å°ä¸º1å¤©ï¼Œæ»‘åŠ¨1ç§’çš„æ»‘åŠ¨çª—å£å¯èƒ½ä¸æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚\n  ReduceFunctionã€AggregateFunction å’Œ FoldFunction å¯ä»¥æ˜¾è‘—é™ä½å­˜å‚¨è¦æ±‚ï¼Œå› ä¸ºå®ƒä»¬çƒ­è¡·äºèšåˆå…ƒç´ ï¼Œæ¯ä¸ªçª—å£åªå­˜å‚¨ä¸€ä¸ªå€¼ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œä»…ä»…ä½¿ç”¨ ProcessWindowFunction å°±éœ€è¦ç´¯ç§¯æ‰€æœ‰å…ƒç´ ã€‚\n  ä½¿ç”¨ Evictor å¯ä»¥é˜²æ­¢ä»»ä½•é¢„èšé›†ï¼Œå› ä¸ºä¸€ä¸ªçª—å£çš„æ‰€æœ‰å…ƒç´ éƒ½å¿…é¡»åœ¨åº”ç”¨è®¡ç®—ä¹‹å‰é€šè¿‡ evictorï¼ˆè§ Evictorï¼‰ã€‚\n  åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/stream/operators/windows.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-windows/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataStream API","Operators","Windows"],"title":"çª—å£"},{"categories":["Flink"],"contents":"æœ¬é¡µé¢çš„ç›®æ ‡æ˜¯ä¸ºéœ€è¦ä½¿ç”¨è‡ªå®šä¹‰çŠ¶æ€åºåˆ—åŒ–çš„ç”¨æˆ·æä¾›æŒ‡å¯¼ï¼Œæ¶µç›–äº†å¦‚ä½•æä¾›è‡ªå®šä¹‰çŠ¶æ€åºåˆ—åŒ–å™¨ï¼Œä»¥åŠå®ç°å…è®¸çŠ¶æ€æ¨¡å¼æ¼”åŒ–çš„åºåˆ—åŒ–å™¨çš„æŒ‡å—å’Œæœ€ä½³å®è·µã€‚\nå¦‚æœä½ åªæ˜¯ç®€å•åœ°ä½¿ç”¨ Flink è‡ªå¸¦çš„åºåˆ—åŒ–å™¨ï¼Œè¿™ä¸ªé¡µé¢æ˜¯ä¸ç›¸å…³çš„ï¼Œå¯ä»¥å¿½ç•¥ã€‚\nä½¿ç”¨è‡ªå®šä¹‰çŠ¶æ€åºåˆ—åŒ–å™¨ å½“æ³¨å†Œä¸€ä¸ª managed operator æˆ– keyed stateæ—¶ï¼Œéœ€è¦ä¸€ä¸ª StateDescriptor æ¥æŒ‡å®šçŠ¶æ€çš„åç§°ï¼Œä»¥åŠçŠ¶æ€çš„ç±»å‹ä¿¡æ¯ã€‚ç±»å‹ä¿¡æ¯è¢« Flink çš„ç±»å‹åºåˆ—åŒ–æ¡†æ¶ç”¨æ¥ä¸ºçŠ¶æ€åˆ›å»ºåˆé€‚çš„åºåˆ—åŒ–å™¨ã€‚\nä¹Ÿå¯ä»¥å®Œå…¨ç»•è¿‡è¿™ä¸€ç‚¹ï¼Œè®© Flink ä½¿ç”¨è‡ªå·±çš„è‡ªå®šä¹‰åºåˆ—åŒ–å™¨æ¥åºåˆ—åŒ–è¢«ç®¡ç†çš„çŠ¶æ€ï¼Œåªéœ€ç”¨è‡ªå·±çš„ TypeSerializer å®ç°ç›´æ¥å®ä¾‹åŒ– StateDescriptor å³å¯ã€‚\nclass CustomTypeSerializer extends TypeSerializer[(String, Integer)] {...} val descriptor = new ListStateDescriptor[(String, Integer)]( \u0026#34;state-name\u0026#34;, new CustomTypeSerializer) ) checkpointedState = getRuntimeContext.getListState(descriptor) çŠ¶æ€åºåˆ—åŒ–å™¨å’Œæ¨¡å¼æ¼”è¿› æœ¬èŠ‚è§£é‡Šäº†ä¸çŠ¶æ€åºåˆ—åŒ–å’Œæ¨¡å¼æ¼”è¿›ç›¸å…³çš„é¢å‘ç”¨æˆ·çš„æŠ½è±¡ï¼Œä»¥åŠå…³äº Flink å¦‚ä½•ä¸è¿™äº›æŠ½è±¡äº¤äº’çš„å¿…è¦å†…éƒ¨ç»†èŠ‚ã€‚\nå½“ä»ä¿å­˜ç‚¹æ¢å¤æ—¶ï¼ŒFlink å…è®¸æ”¹å˜ç”¨äºè¯»å–å’Œå†™å…¥å…ˆå‰æ³¨å†ŒçŠ¶æ€çš„åºåˆ—åŒ–å™¨ï¼Œå› æ­¤ç”¨æˆ·ä¸ä¼šè¢«é”å®šåœ¨ä»»ä½•ç‰¹å®šçš„åºåˆ—åŒ–æ¨¡å¼ä¸Šã€‚å½“çŠ¶æ€è¢«è¿˜åŸæ—¶ï¼Œå°†ä¸ºè¯¥çŠ¶æ€æ³¨å†Œä¸€ä¸ªæ–°çš„åºåˆ—åŒ–å™¨ï¼ˆå³åœ¨è¿˜åŸä½œä¸šä¸­ç”¨äºè®¿é—®çŠ¶æ€çš„ StateDescriptor æ‰€é™„å¸¦çš„åºåˆ—åŒ–å™¨ï¼‰ã€‚è¿™ä¸ªæ–°çš„åºåˆ—åŒ–å™¨å¯èƒ½ä¸ä¹‹å‰çš„åºåˆ—åŒ–å™¨çš„æ¨¡å¼ä¸åŒã€‚å› æ­¤ï¼Œåœ¨å®ç°çŠ¶æ€åºåˆ—åŒ–å™¨æ—¶ï¼Œé™¤äº†è¯»å–/å†™å…¥æ•°æ®çš„åŸºæœ¬é€»è¾‘å¤–ï¼Œå¦ä¸€ä¸ªéœ€è¦æ³¨æ„çš„é‡è¦é—®é¢˜æ˜¯æœªæ¥å¦‚ä½•æ”¹å˜åºåˆ—åŒ–æ¨¡å¼ã€‚\nè¯´åˆ° schemaï¼Œåœ¨è¿™é‡Œï¼Œè¿™ä¸ªæœ¯è¯­å¯ä»¥äº’æ¢ï¼ŒæŒ‡çš„æ˜¯çŠ¶æ€ç±»å‹çš„æ•°æ®æ¨¡å‹å’ŒçŠ¶æ€ç±»å‹çš„åºåˆ—åŒ–äºŒè¿›åˆ¶æ ¼å¼ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ¨¡å¼ï¼Œå¯ä»¥ä¸ºå°‘æ•°æƒ…å†µè€Œæ”¹å˜ã€‚\n çŠ¶æ€ç±»å‹çš„æ•°æ®æ¨¡å¼å‘ç”Ÿäº†å˜åŒ–ï¼Œå³ä» POJO ä¸­å¢åŠ æˆ–åˆ é™¤ä¸€ä¸ªä½œä¸ºçŠ¶æ€çš„å­—æ®µã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œæ•°æ®æ¨¡å¼å‘ç”Ÿå˜åŒ–åï¼Œéœ€è¦å‡çº§åºåˆ—å™¨çš„åºåˆ—åŒ–æ ¼å¼ã€‚ åºåˆ—å™¨çš„é…ç½®å‘ç”Ÿäº†å˜åŒ–ã€‚  ä¸ºäº†è®©æ–°çš„æ‰§è¡Œæœ‰çŠ¶æ€çš„å†™å…¥æ¨¡å¼çš„ä¿¡æ¯ï¼Œå¹¶æ£€æµ‹æ¨¡å¼æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ï¼Œåœ¨å¯¹æ“ä½œç¬¦çš„çŠ¶æ€è¿›è¡Œä¿å­˜ç‚¹æ—¶ï¼Œéœ€è¦å°†çŠ¶æ€åºåˆ—å™¨çš„å¿«ç…§å’ŒçŠ¶æ€å­—èŠ‚ä¸€èµ·å†™å…¥ã€‚è¿™å°±æ˜¯æŠ½è±¡å‡ºæ¥çš„ä¸€ä¸ª TypeSerializerSnapshotï¼Œåœ¨ä¸‹ä¸€å°èŠ‚è§£é‡Šã€‚\nTypeSerializerSnapshot æŠ½è±¡ public interface TypeSerializerSnapshot\u0026lt;T\u0026gt; { int getCurrentVersion(); void writeSnapshot(DataOuputView out) throws IOException; void readSnapshot(int readVersion, DataInputView in, ClassLoader userCodeClassLoader) throws IOException; TypeSerializerSchemaCompatibility\u0026lt;T\u0026gt; resolveSchemaCompatibility(TypeSerializer\u0026lt;T\u0026gt; newSerializer); TypeSerializer\u0026lt;T\u0026gt; restoreSerializer(); } public abstract class TypeSerializer\u0026lt;T\u0026gt; { // ...  public abstract TypeSerializerSnapshot\u0026lt;T\u0026gt; snapshotConfiguration(); } åºåˆ—å™¨çš„ TypeSerializerSnapshot æ˜¯ä¸€ä¸ªæ—¶é—´ç‚¹ä¿¡æ¯ï¼Œå®ƒä½œä¸ºçŠ¶æ€åºåˆ—å™¨çš„å†™æ¨¡å¼çš„å”¯ä¸€çœŸç†æ¥æºï¼Œä»¥åŠè¿˜åŸä¸€ä¸ªåºåˆ—å™¨æ‰€å¿…é¡»çš„ä»»ä½•é¢å¤–ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å°†ä¸ç»™å®šçš„æ—¶é—´ç‚¹ç›¸åŒã€‚å…³äºåœ¨è¿˜åŸæ—¶åº”è¯¥å†™å…¥å’Œè¯»å–ä»€ä¹ˆä½œä¸ºåºåˆ—å™¨å¿«ç…§çš„é€»è¾‘æ˜¯åœ¨ writeSnapshotå’ŒreadSnapshot æ–¹æ³•ä¸­å®šä¹‰çš„ã€‚\nè¯·æ³¨æ„ï¼Œå¿«ç…§æœ¬èº«çš„å†™æ¨¡å¼ä¹Ÿå¯èƒ½éœ€è¦éšç€æ—¶é—´çš„æ¨ç§»è€Œæ”¹å˜ï¼ˆä¾‹å¦‚ï¼Œå½“ä½ å¸Œæœ›åœ¨å¿«ç…§ä¸­æ·»åŠ æ›´å¤šå…³äºåºåˆ—å™¨çš„ä¿¡æ¯æ—¶ï¼‰ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œå¿«ç…§æ˜¯æœ‰ç‰ˆæœ¬çš„ï¼Œåœ¨ getCurrentVersion æ–¹æ³•ä¸­å®šä¹‰äº†å½“å‰çš„ç‰ˆæœ¬å·ã€‚åœ¨è¿˜åŸæ—¶ï¼Œå½“ä»ä¿å­˜ç‚¹è¯»å–åºåˆ—å™¨å¿«ç…§æ—¶ï¼Œå°†å‘ readSnapshot æ–¹æ³•æä¾›å†™å…¥å¿«ç…§çš„æ¨¡å¼çš„ç‰ˆæœ¬ï¼Œä»¥ä¾¿è¯»å–å®ç°å¯ä»¥å¤„ç†ä¸åŒçš„ç‰ˆæœ¬ã€‚\nåœ¨è¿˜åŸæ—¶ï¼Œæ£€æµ‹æ–°çš„åºåˆ—å™¨çš„æ¨¡å¼æ˜¯å¦æ”¹å˜çš„é€»è¾‘åº”è¯¥åœ¨ resolveSchemaCompatibility æ–¹æ³•ä¸­å®ç°ã€‚å½“ä¹‹å‰çš„æ³¨å†ŒçŠ¶æ€åœ¨è¿˜åŸæ‰§è¡Œçš„æ“ä½œç¬¦ä¸­å†æ¬¡æ³¨å†Œæ–°çš„åºåˆ—åŒ–å™¨æ—¶ï¼Œæ–°çš„åºåˆ—åŒ–å™¨ä¼šé€šè¿‡è¿™ä¸ªæ–¹æ³•æä¾›ç»™ä¹‹å‰åºåˆ—åŒ–å™¨çš„å¿«ç…§ã€‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªä»£è¡¨å…¼å®¹æ€§è§£å†³ç»“æœçš„ TypeSerializerSchemaCompatibilityï¼Œå®ƒå¯ä»¥æ˜¯ä»¥ä¸‹ä¹‹ä¸€ã€‚\n TypeSerializerSchemaCompatibility.compatibleAsIs()ï¼šè¿™ä¸ªç»“æœæ ‡å¿—ç€æ–°çš„åºåˆ—åŒ–å™¨æ˜¯å…¼å®¹çš„ï¼Œè¿™æ„å‘³ç€æ–°çš„åºåˆ—åŒ–å™¨ä¸ä¹‹å‰çš„åºåˆ—åŒ–å™¨å…·æœ‰ç›¸åŒçš„æ¨¡å¼ã€‚æœ‰å¯èƒ½åœ¨resolveSchemaCompatibilityæ–¹æ³•ä¸­é‡æ–°é…ç½®äº†æ–°çš„åºåˆ—åŒ–å™¨ï¼Œä½¿å…¶å…¼å®¹ã€‚ TypeSerializerSchemaCompatibility.compatibleAfterMigration()ï¼šè¿™ä¸ªç»“æœæ ‡å¿—ç€æ–°çš„åºåˆ—åŒ–å™¨å…·æœ‰ä¸åŒçš„åºåˆ—åŒ–æ¨¡å¼ï¼Œå¯ä»¥ä»æ—§çš„æ¨¡å¼è¿ç§»ï¼Œä½¿ç”¨ä¹‹å‰çš„åºåˆ—åŒ–å™¨ï¼ˆè¯†åˆ«æ—§çš„æ¨¡å¼ï¼‰å°†å­—èŠ‚è¯»å…¥çŠ¶æ€å¯¹è±¡ï¼Œç„¶åç”¨æ–°çš„åºåˆ—åŒ–å™¨ï¼ˆè¯†åˆ«æ–°çš„æ¨¡å¼ï¼‰å°†å¯¹è±¡é‡æ–°å†™å›å­—èŠ‚ã€‚ TypeSerializerSchemaCompatibility.incompatible()ï¼šè¿™ä¸ªç»“æœæ ‡å¿—ç€æ–°çš„åºåˆ—åŒ–å™¨æœ‰ä¸åŒçš„åºåˆ—åŒ–æ¨¡å¼ï¼Œä½†ä¸å¯èƒ½ä»æ—§æ¨¡å¼è¿ç§»ã€‚  æœ€åä¸€ç‚¹ç»†èŠ‚æ˜¯åœ¨éœ€è¦è¿ç§»çš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•è·å¾—ä¹‹å‰çš„åºåˆ—åŒ–å™¨ã€‚åºåˆ—åŒ–å™¨çš„ TypeSerializerSnapshot çš„å¦ä¸€ä¸ªé‡è¦ä½œç”¨æ˜¯ï¼Œå®ƒå¯ä»¥ä½œä¸ºä¸€ä¸ªå·¥å‚æ¥æ¢å¤ä»¥å‰çš„åºåˆ—åŒ–å™¨ã€‚æ›´å…·ä½“åœ°è¯´ï¼ŒTypeSerializerSnapshot åº”è¯¥å®ç° restoreSerializer æ–¹æ³•æ¥å®ä¾‹åŒ–ä¸€ä¸ªåºåˆ—åŒ–å™¨å®ä¾‹ï¼Œè¯¥å®ä¾‹èƒ½å¤Ÿè¯†åˆ«ä¹‹å‰åºåˆ—åŒ–å™¨çš„æ¨¡å¼å’Œé…ç½®ï¼Œå› æ­¤å¯ä»¥å®‰å…¨åœ°è¯»å–ä¹‹å‰åºåˆ—åŒ–å™¨å†™å…¥çš„æ•°æ®ã€‚\nFlink å¦‚ä½•ä¸ TypeSerializer å’Œ TypeSerializerSnapshot æŠ½è±¡è¿›è¡Œäº¤äº’ æ€»ç»“ä¸€ä¸‹ï¼Œæœ¬èŠ‚æ€»ç»“äº† Flinkï¼Œæˆ–è€…æ›´å…·ä½“åœ°è¯´ï¼ŒçŠ¶æ€åç«¯å¦‚ä½•ä¸æŠ½è±¡è¿›è¡Œäº¤äº’ã€‚æ ¹æ®çŠ¶æ€åç«¯çš„ä¸åŒï¼Œäº¤äº’ç•¥æœ‰ä¸åŒï¼Œä½†è¿™ä¸çŠ¶æ€åºåˆ—åŒ–å™¨åŠå…¶åºåˆ—åŒ–å™¨å¿«ç…§çš„å®ç°æ˜¯æ­£äº¤çš„ã€‚\nç¦»å †çŠ¶æ€åç«¯(å¦‚ RocksDBStateBackend)\n ç”¨å…·æœ‰æ¨¡å¼Açš„çŠ¶æ€åºåˆ—å™¨æ³¨å†Œæ–°çš„çŠ¶æ€ã€‚   æ³¨å†Œçš„ TypeSerializer ç”¨äºåœ¨æ¯æ¬¡çŠ¶æ€è®¿é—®æ—¶è¯»å–/å†™å…¥çŠ¶æ€ã€‚ çŠ¶æ€è¢«å†™å…¥æ¨¡å¼Aä¸­ã€‚  æ‹æ‘„ä¸€ä¸ªä¿å­˜ç‚¹   åºåˆ—å™¨å¿«ç…§æ˜¯é€šè¿‡ TypeSerializer#snapshotConfiguration æ–¹æ³•æå–çš„ã€‚ åºåˆ—å™¨å¿«ç…§è¢«å†™å…¥ä¿å­˜ç‚¹ï¼Œä»¥åŠå·²ç»åºåˆ—åŒ–çš„çŠ¶æ€å­—èŠ‚ï¼ˆæ¨¡å¼Aï¼‰ã€‚  æ¢å¤çš„æ‰§è¡Œç”¨æ–°çš„çŠ¶æ€åºåˆ—åŒ–å™¨é‡æ–°è®¿é—®æ¢å¤çš„çŠ¶æ€å­—èŠ‚ï¼Œæ–°çš„çŠ¶æ€åºåˆ—åŒ–å™¨å…·æœ‰æ¨¡å¼Bã€‚   å‰ä¸€ä¸ªçŠ¶æ€åºåˆ—å™¨çš„å¿«ç…§è¢«è¿˜åŸã€‚ çŠ¶æ€å­—èŠ‚åœ¨è¿˜åŸæ—¶ä¸è¢«ååºåˆ—åŒ–ï¼Œåªè¢«åŠ è½½å›çŠ¶æ€åç«¯ï¼ˆå› æ­¤ï¼Œä»åœ¨æ¨¡å¼Aä¸­ï¼‰ã€‚ æ¥æ”¶åˆ°æ–°çš„åºåˆ—åŒ–å™¨åï¼Œé€šè¿‡ TypeSerializer#resolveSchemaCompatibility æä¾›ç»™è¢«è¿˜åŸçš„å‰ä¸€ä¸ªåºåˆ—åŒ–å™¨çš„å¿«ç…§ï¼Œæ£€æŸ¥æ¨¡å¼æ˜¯å¦å…¼å®¹ã€‚  å°†åç«¯ä¸­çš„çŠ¶æ€å­—èŠ‚ä»æ¨¡å¼Aè¿ç§»åˆ°æ¨¡å¼Bã€‚   å¦‚æœå…¼å®¹æ€§å†³è®®åæ˜ æ¨¡å¼å·²ç»æ”¹å˜ï¼Œå¹¶ä¸”å¯ä»¥è¿›è¡Œè¿ç§»ï¼Œåˆ™è¿›è¡Œæ¨¡å¼è¿ç§»ã€‚é€šè¿‡ TypeSerializerSnapshot#restoreSerializer()ï¼Œå°†ä»åºåˆ—åŒ–å™¨å¿«ç…§ä¸­è·å–ä¹‹å‰è¯†åˆ«æ¨¡å¼Açš„çŠ¶æ€åºåˆ—åŒ–å™¨ï¼Œå¹¶ç”¨äºååºåˆ—åŒ–çŠ¶æ€å­—èŠ‚åˆ°å¯¹è±¡ï¼Œè¿›è€Œç”¨æ–°çš„åºåˆ—åŒ–å™¨å†æ¬¡é‡å†™ï¼Œè¯†åˆ«æ¨¡å¼Bï¼Œå®Œæˆè¿ç§»ã€‚åœ¨ç»§ç»­å¤„ç†ä¹‹å‰ï¼Œæ‰€æœ‰è®¿é—®çŠ¶æ€çš„æ¡ç›®å…¨éƒ¨è¿ç§»å®Œæ¯•ã€‚ å¦‚æœè§£æä¿¡å·ä¸ºä¸å…¼å®¹ï¼Œåˆ™çŠ¶æ€è®¿é—®å¤±è´¥ï¼Œå‡ºç°å¼‚å¸¸ã€‚  å †çŠ¶æ€åç«¯ï¼ˆå¦‚ MemoryStateBackendã€FsStateBackendï¼‰:\n ç”¨å…·æœ‰æ¨¡å¼Açš„çŠ¶æ€åºåˆ—å™¨æ³¨å†Œæ–°çš„çŠ¶æ€ã€‚   æ³¨å†Œçš„ TypeSerializer ç”±çŠ¶æ€åç«¯ç»´æŠ¤ã€‚  æ‹æ‘„ä¸€ä¸ªä¿å­˜ç‚¹ï¼Œå°†æ‰€æœ‰çŠ¶æ€ç”¨æ¨¡å¼Aåºåˆ—åŒ–ã€‚   åºåˆ—å™¨å¿«ç…§æ˜¯é€šè¿‡ TypeSerializer#snapshotConfiguration æ–¹æ³•æå–çš„ã€‚ åºåˆ—åŒ–å™¨å¿«ç…§è¢«å†™å…¥ä¿å­˜ç‚¹ã€‚ ç°åœ¨çŠ¶æ€å¯¹è±¡è¢«åºåˆ—åŒ–åˆ°ä¿å­˜ç‚¹ï¼Œå†™å…¥æ¨¡å¼Aä¸­ã€‚  åœ¨è¿˜åŸæ—¶ï¼Œå°†çŠ¶æ€ååºåˆ—åŒ–ä¸ºå †ä¸­çš„å¯¹è±¡ã€‚   å‰ä¸€ä¸ªçŠ¶æ€åºåˆ—å™¨çš„å¿«ç…§è¢«æ¢å¤ã€‚ é€šè¿‡ TypeSerializerSnapshot#restoreSerializer() ä»åºåˆ—åŒ–å™¨å¿«ç…§ä¸­è·å–ä¹‹å‰çš„åºåˆ—åŒ–å™¨ï¼Œè¯¥åºåˆ—åŒ–å™¨è¯†åˆ«æ¨¡å¼Aï¼Œç”¨äºå°†çŠ¶æ€å­—èŠ‚ååºåˆ—åŒ–ä¸ºå¯¹è±¡ã€‚ ä»ç°åœ¨å¼€å§‹ï¼Œæ‰€æœ‰çš„çŠ¶æ€éƒ½å·²ç»è¢«ååºåˆ—åŒ–äº†ã€‚  æ¢å¤åçš„æ‰§è¡Œç”¨æ–°çš„çŠ¶æ€åºåˆ—åŒ–å™¨é‡æ–°è®¿é—®ä»¥å‰çš„çŠ¶æ€ï¼Œæ–°çš„çŠ¶æ€åºåˆ—åŒ–å™¨å…·æœ‰æ¨¡å¼Bã€‚   åœ¨æ¥æ”¶åˆ°æ–°çš„åºåˆ—åŒ–å™¨åï¼Œé€šè¿‡ TypeSerializer#resolveSchemaCompatibility æä¾›ç»™æ¢å¤ä¹‹å‰åºåˆ—åŒ–å™¨çš„å¿«ç…§ï¼Œä»¥æ£€æŸ¥æ¨¡å¼çš„å…¼å®¹æ€§ã€‚ å¦‚æœå…¼å®¹æ€§æ£€æŸ¥å‘å‡ºéœ€è¦è¿ç§»çš„ä¿¡å·ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä»€ä¹ˆéƒ½ä¸ä¼šå‘ç”Ÿï¼Œå› ä¸ºå¯¹äºå †åç«¯æ¥è¯´ï¼Œæ‰€æœ‰çš„çŠ¶æ€å·²ç»è¢«ååºåˆ—åŒ–ä¸ºå¯¹è±¡ã€‚ å¦‚æœè§£æä¿¡å·ä¸ºä¸å…¼å®¹ï¼Œåˆ™çŠ¶æ€è®¿é—®å¤±è´¥ï¼Œå‡ºç°å¼‚å¸¸ã€‚  å†æ‹æ‘„ä¸€ä¸ªä¿å­˜ç‚¹ï¼Œå°†æ‰€æœ‰çŠ¶æ€ç”¨æ¨¡å¼Båºåˆ—åŒ–ã€‚   ä¸æ­¥éª¤2.ç›¸åŒï¼Œä½†ç°åœ¨çŠ¶æ€å­—èŠ‚éƒ½åœ¨æ¨¡å¼Bä¸­ã€‚  é¢„å…ˆå®šä¹‰æ–¹ä¾¿çš„ TypeSerializerSnapshot ç±» Flink æä¾›äº†ä¸¤ä¸ªæŠ½è±¡çš„åŸºç¡€ TypeSerializerSnapshot ç±»ï¼Œå¯ä»¥ç”¨äºå…¸å‹åœºæ™¯ã€‚SimpleTypeSerializerSnapshot å’Œ CompositeTypeSerializerSnapshotã€‚\næä¾›è¿™äº›é¢„å®šä¹‰å¿«ç…§ä½œä¸ºå…¶åºåˆ—åŒ–å™¨å¿«ç…§çš„åºåˆ—åŒ–å™¨å¿…é¡»å§‹ç»ˆæœ‰è‡ªå·±ç‹¬ç«‹çš„å­ç±»å®ç°ã€‚è¿™ä¸ä¸åœ¨ä¸åŒçš„åºåˆ—åŒ–å™¨ä¹‹é—´å…±äº«å¿«ç…§ç±»çš„æœ€ä½³å®è·µç›¸å¯¹åº”ï¼Œè¿™å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­å¾—åˆ°æ›´è¯¦å°½çš„è§£é‡Šã€‚\nå®ç° SimpleTypeSerializerSnapshot SimpleTypeSerializerSnapshot æ˜¯ä¸ºæ²¡æœ‰ä»»ä½•çŠ¶æ€æˆ–é…ç½®çš„åºåˆ—åŒ–å™¨å‡†å¤‡çš„ï¼Œæœ¬è´¨ä¸Šæ„å‘³ç€åºåˆ—åŒ–å™¨çš„åºåˆ—åŒ–æ¨¡å¼å®Œå…¨ç”±åºåˆ—åŒ–å™¨çš„ç±»æ¥å®šä¹‰ã€‚\nå½“ä½¿ç”¨ SimpleTypeSerializerSnapshot ä½œä¸ºä½ çš„åºåˆ—åŒ–å™¨çš„å¿«ç…§ç±»æ—¶ï¼Œå…¼å®¹æ€§è§£å†³åªæœ‰2ç§å¯èƒ½çš„ç»“æœã€‚\n TypeSerializerSchemaCompatibility.compatibleAsIs()ï¼Œå¦‚æœæ–°çš„åºåˆ—åŒ–å™¨ç±»ä¿æŒç›¸åŒï¼Œæˆ– TypeSerializerSchemaCompatibility.incompatible()ï¼Œå¦‚æœæ–°çš„åºåˆ—åŒ–å™¨ç±»ä¸ä¹‹å‰çš„åºåˆ—åŒ–å™¨ç±»ä¸åŒã€‚  ä¸‹é¢ä»¥ Flink çš„ IntSerializer ä¸ºä¾‹ï¼Œä»‹ç» SimpleTypeSerializerSnapshot çš„ä½¿ç”¨æ–¹æ³•ã€‚\npublic class IntSerializerSnapshot extends SimpleTypeSerializerSnapshot\u0026lt;Integer\u0026gt; { public IntSerializerSnapshot() { super(() -\u0026gt; IntSerializer.INSTANCE); } } IntSerializer æ²¡æœ‰çŠ¶æ€æˆ–é…ç½®ã€‚åºåˆ—åŒ–æ ¼å¼å®Œå…¨ç”±åºåˆ—åŒ–å™¨ç±»è‡ªå·±å®šä¹‰ï¼Œåªèƒ½ç”±å¦ä¸€ä¸ª IntSerializer è¯»å–ã€‚å› æ­¤ï¼Œå®ƒé€‚åˆ SimpleTypeSerializerSnapshot çš„ä½¿ç”¨æƒ…å†µã€‚\nSimpleTypeSerializerSnapshot çš„åŸºç¡€è¶…çº§æ„é€ å‡½æ•°æœŸæœ›å¾—åˆ°ä¸€ä¸ªç›¸åº”åºåˆ—å™¨å®ä¾‹çš„ Supplierï¼Œä¸ç®¡å¿«ç…§å½“å‰æ˜¯åœ¨è¿˜åŸè¿˜æ˜¯åœ¨å¿«ç…§æœŸé—´å†™å…¥ã€‚è¯¥ Supplier ç”¨äºåˆ›å»ºè¿˜åŸåºåˆ—åŒ–å™¨ï¼Œä»¥åŠç±»å‹æ£€æŸ¥ï¼Œä»¥éªŒè¯æ–°åºåˆ—åŒ–å™¨æ˜¯å¦å±äºç›¸åŒçš„é¢„æœŸåºåˆ—åŒ–å™¨ç±»ã€‚\nå®ç° CompositeTypeSerializerSnapshot CompositeTypeSerializerSnapshot æ˜¯ä¸ºé‚£äº›ä¾èµ–äºå¤šä¸ªåµŒå¥—åºåˆ—åŒ–å™¨çš„åºåˆ—åŒ–å™¨è€Œè®¾è®¡çš„ã€‚\nåœ¨è¿›ä¸€æ­¥è§£é‡Šä¹‹å‰ï¼Œæˆ‘ä»¬å°†ä¾èµ–äºå¤šä¸ªåµŒå¥—åºåˆ—åŒ–å™¨çš„åºåˆ—åŒ–å™¨ç§°ä¸ºæ­¤ä¸Šä¸‹æ–‡ä¸­çš„\u0026quot;å¤–éƒ¨\u0026quot;åºåˆ—åŒ–å™¨ã€‚è¿™æ–¹é¢çš„ä¾‹å­å¯ä»¥æ˜¯ MapSerializerã€ListSerializerã€GenericArraySerializer ç­‰ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ MapSerializer \u0026ndash;é”®å’Œå€¼åºåˆ—åŒ–å™¨å°†æ˜¯åµŒå¥—åºåˆ—åŒ–å™¨ï¼Œè€ŒMapSerializeræœ¬èº«æ˜¯ \u0026ldquo;å¤–éƒ¨ \u0026ldquo;åºåˆ—åŒ–å™¨ã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¤–å±‚åºåˆ—åŒ–å™¨çš„å¿«ç…§ä¹Ÿåº”è¯¥åŒ…å«åµŒå¥—åºåˆ—åŒ–å™¨çš„å¿«ç…§ï¼Œè¿™æ ·å°±å¯ä»¥ç‹¬ç«‹æ£€æŸ¥åµŒå¥—åºåˆ—åŒ–å™¨çš„å…¼å®¹æ€§ã€‚åœ¨è§£å†³å¤–å±‚åºåˆ—åŒ–å™¨çš„å…¼å®¹æ€§æ—¶ï¼Œéœ€è¦è€ƒè™‘æ¯ä¸ªåµŒå¥—åºåˆ—åŒ–å™¨çš„å…¼å®¹æ€§ã€‚\næä¾› CompositeTypeSerializerSnapshot æ˜¯ä¸ºäº†ååŠ©å®ç°è¿™ç±»å¤åˆåºåˆ—å™¨çš„å¿«ç…§ã€‚å®ƒå¤„ç†åµŒå¥—åºåˆ—åŒ–å™¨å¿«ç…§çš„è¯»å†™ï¼Œä»¥åŠè€ƒè™‘åˆ°æ‰€æœ‰åµŒå¥—åºåˆ—åŒ–å™¨çš„å…¼å®¹æ€§ï¼Œè§£ææœ€ç»ˆçš„å…¼å®¹æ€§ç»“æœã€‚\nä¸‹é¢ä»¥ Flink çš„ MapSerializer ä¸ºä¾‹ï¼Œä»‹ç»å¦‚ä½•ä½¿ç”¨ CompositeTypeSerializerSnapshotã€‚\npublic class MapSerializerSnapshot\u0026lt;K, V\u0026gt; extends CompositeTypeSerializerSnapshot\u0026lt;Map\u0026lt;K, V\u0026gt;, MapSerializer\u0026gt; { private static final int CURRENT_VERSION = 1; public MapSerializerSnapshot() { super(MapSerializer.class); } public MapSerializerSnapshot(MapSerializer\u0026lt;K, V\u0026gt; mapSerializer) { super(mapSerializer); } @Override public int getCurrentOuterSnapshotVersion() { return CURRENT_VERSION; } @Override protected MapSerializer createOuterSerializerWithNestedSerializers(TypeSerializer\u0026lt;?\u0026gt;[] nestedSerializers) { TypeSerializer\u0026lt;K\u0026gt; keySerializer = (TypeSerializer\u0026lt;K\u0026gt;) nestedSerializers[0]; TypeSerializer\u0026lt;V\u0026gt; valueSerializer = (TypeSerializer\u0026lt;V\u0026gt;) nestedSerializers[1]; return new MapSerializer\u0026lt;\u0026gt;(keySerializer, valueSerializer); } @Override protected TypeSerializer\u0026lt;?\u0026gt;[] getNestedSerializers(MapSerializer outerSerializer) { return new TypeSerializer\u0026lt;?\u0026gt;[] { outerSerializer.getKeySerializer(), outerSerializer.getValueSerializer() }; } } å½“å®ç°ä¸€ä¸ªæ–°çš„åºåˆ—å™¨å¿«ç…§ä½œä¸º CompositeTypeSerializerSnapshot çš„å­ç±»æ—¶ï¼Œå¿…é¡»å®ç°ä»¥ä¸‹ä¸‰ä¸ªæ–¹æ³•ã€‚\n #getCurrentOuterSnapshotVersion()ã€‚è¯¥æ–¹æ³•å®šä¹‰äº†å½“å‰å¤–éƒ¨åºåˆ—åŒ–å™¨å¿«ç…§çš„åºåˆ—åŒ–äºŒè¿›åˆ¶æ ¼å¼çš„ç‰ˆæœ¬ã€‚ #getNestedSerializers(TypeSerializer)ã€‚ç»™å®šå¤–éƒ¨åºåˆ—åŒ–å™¨ï¼Œè¿”å›å…¶åµŒå¥—çš„åºåˆ—åŒ–å™¨ã€‚ #createOuterSerializerWithNestedSerializers(TypeSerializer[])ã€‚ç»™å®šåµŒå¥—çš„åºåˆ—åŒ–å™¨ï¼Œåˆ›å»ºä¸€ä¸ªå¤–éƒ¨åºåˆ—åŒ–å™¨çš„å®ä¾‹ã€‚  ä¸Šé¢çš„ä¾‹å­æ˜¯ä¸€ä¸ª CompositeTypeSerializerSnapshotï¼Œé™¤äº†åµŒå¥—çš„åºåˆ—åŒ–å™¨çš„å¿«ç…§å¤–ï¼Œæ²¡æœ‰é¢å¤–çš„ä¿¡æ¯éœ€è¦å¿«ç…§ã€‚å› æ­¤ï¼Œå¯ä»¥é¢„æœŸå…¶å¤–éƒ¨å¿«ç…§ç‰ˆæœ¬æ°¸è¿œä¸éœ€è¦ä¸ŠæŠ¥ã€‚ç„¶è€Œï¼Œå…¶ä»–ä¸€äº›åºåˆ—åŒ–å™¨ï¼ŒåŒ…å«ä¸€äº›é¢å¤–çš„é™æ€é…ç½®ï¼Œéœ€è¦å’ŒåµŒå¥—çš„ç»„ä»¶åºåˆ—åŒ–å™¨ä¸€èµ·æŒä¹…åŒ–ã€‚ä¸€ä¸ªä¾‹å­æ˜¯ Flink çš„ GenericArraySerializerï¼Œé™¤äº†åµŒå¥—çš„å…ƒç´ åºåˆ—åŒ–å™¨ä¹‹å¤–ï¼Œå®ƒè¿˜åŒ…å«äº†æ•°ç»„å…ƒç´ ç±»å‹çš„ç±»ä½œä¸ºé…ç½®ã€‚\nåœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œéœ€è¦åœ¨ CompositeTypeSerializerSnapshot ä¸Šå®ç°å¦å¤–ä¸‰ä¸ªæ–¹æ³•ã€‚\n #writeOuterSnapshot(DataOutputView)ï¼šå®šä¹‰å¦‚ä½•å†™å…¥å¤–éƒ¨å¿«ç…§ä¿¡æ¯ã€‚ #readOuterSnapshot(int, DataInputView, ClassLoader)ï¼šå®šä¹‰å¦‚ä½•è¯»å–å¤–éƒ¨å¿«ç…§ä¿¡æ¯ã€‚ #resolveOuterSchemaCompatibility(TypeSerializer)ï¼šæ ¹æ®å¤–éƒ¨å¿«ç…§ä¿¡æ¯æ£€æŸ¥å…¼å®¹æ€§ã€‚  é»˜è®¤æƒ…å†µä¸‹ï¼ŒCompositeTypeSerializerSnapshot å‡è®¾æ²¡æœ‰ä»»ä½•å¤–éƒ¨å¿«ç…§ä¿¡æ¯å¯è¯»/å¯å†™ï¼Œå› æ­¤ä¸Šè¿°æ–¹æ³•çš„é»˜è®¤å®ç°ä¸ºç©ºã€‚å¦‚æœå­ç±»æœ‰å¤–éƒ¨å¿«ç…§ä¿¡æ¯ï¼Œé‚£ä¹ˆè¿™ä¸‰ä¸ªæ–¹æ³•å¿…é¡»å…¨éƒ¨å®ç°ã€‚\nä¸‹é¢ä»¥ Flink çš„ GenericArraySerializer ä¸ºä¾‹ï¼Œè¯´æ˜ CompositeTypeSerializerSnapshot å¦‚ä½•ç”¨äºç¡®å®æœ‰å¤–éƒ¨å¿«ç…§ä¿¡æ¯çš„å¤åˆåºåˆ—å™¨å¿«ç…§ã€‚\npublic final class GenericArraySerializerSnapshot\u0026lt;C\u0026gt; extends CompositeTypeSerializerSnapshot\u0026lt;C[], GenericArraySerializer\u0026gt; { private static final int CURRENT_VERSION = 1; private Class\u0026lt;C\u0026gt; componentClass; public GenericArraySerializerSnapshot() { super(GenericArraySerializer.class); } public GenericArraySerializerSnapshot(GenericArraySerializer\u0026lt;C\u0026gt; genericArraySerializer) { super(genericArraySerializer); this.componentClass = genericArraySerializer.getComponentClass(); } @Override protected int getCurrentOuterSnapshotVersion() { return CURRENT_VERSION; } @Override protected void writeOuterSnapshot(DataOutputView out) throws IOException { out.writeUTF(componentClass.getName()); } @Override protected void readOuterSnapshot(int readOuterSnapshotVersion, DataInputView in, ClassLoader userCodeClassLoader) throws IOException { this.componentClass = InstantiationUtil.resolveClassByName(in, userCodeClassLoader); } @Override protected boolean resolveOuterSchemaCompatibility(GenericArraySerializer newSerializer) { return (this.componentClass == newSerializer.getComponentClass()) ? OuterSchemaCompatibility.COMPATIBLE_AS_IS : OuterSchemaCompatibility.INCOMPATIBLE; } @Override protected GenericArraySerializer createOuterSerializerWithNestedSerializers(TypeSerializer\u0026lt;?\u0026gt;[] nestedSerializers) { TypeSerializer\u0026lt;C\u0026gt; componentSerializer = (TypeSerializer\u0026lt;C\u0026gt;) nestedSerializers[0]; return new GenericArraySerializer\u0026lt;\u0026gt;(componentClass, componentSerializer); } @Override protected TypeSerializer\u0026lt;?\u0026gt;[] getNestedSerializers(GenericArraySerializer outerSerializer) { return new TypeSerializer\u0026lt;?\u0026gt;[] { outerSerializer.getComponentSerializer() }; } } åœ¨ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæœ‰ä¸¤ä¸ªé‡è¦çš„äº‹æƒ…éœ€è¦æ³¨æ„ã€‚é¦–å…ˆï¼Œç”±äºè¿™ä¸ª CompositeTypeSerializerSnapshot å®ç°çš„å¤–å¿«ç…§ä¿¡æ¯æ˜¯ä½œä¸ºå¿«ç…§çš„ä¸€éƒ¨åˆ†å†™å…¥çš„ï¼Œæ‰€ä»¥æ¯å½“å¤–å¿«ç…§ä¿¡æ¯çš„åºåˆ—åŒ–æ ¼å¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œç”± getCurrentOuterSnapshotVersion() å®šä¹‰çš„å¤–å¿«ç…§ç‰ˆæœ¬å¿…é¡»è¢«ä¸Šè°ƒã€‚\nå…¶æ¬¡ï¼Œè¯·æ³¨æ„æˆ‘ä»¬åœ¨å†™ç»„ä»¶ç±»æ—¶é¿å…ä½¿ç”¨ Java åºåˆ—åŒ–ï¼Œåªå†™ç±»åï¼Œåœ¨è¯»å›å¿«ç…§æ—¶åŠ¨æ€åŠ è½½ã€‚é¿å…ä½¿ç”¨ Java åºåˆ—åŒ–æ¥ç¼–å†™åºåˆ—åŒ–å™¨å¿«ç…§çš„å†…å®¹ï¼Œæ€»çš„æ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åšæ³•ã€‚å…³äºè¿™æ–¹é¢çš„æ›´å¤šç»†èŠ‚å°†åœ¨ä¸‹ä¸€èŠ‚ä»‹ç»ã€‚\nå®æ–½è¯´æ˜å’Œæœ€ä½³å®è·µ  Flink é€šè¿‡å°†åºåˆ—å™¨å¿«ç…§å®ä¾‹åŒ–ï¼Œæ¢å¤åºåˆ—å™¨å¿«ç…§ï¼Œå…¶ç±»åä¸º  åºåˆ—å™¨çš„å¿«ç…§ï¼Œæ˜¯æ³¨å†ŒçŠ¶æ€å¦‚ä½•è¢«åºåˆ—åŒ–çš„å”¯ä¸€çœŸå®æ¥æºï¼Œæ˜¯è¯»å–ä¿å­˜ç‚¹ä¸­çŠ¶æ€çš„å…¥å£ã€‚ä¸ºäº†èƒ½å¤Ÿæ¢å¤å’Œè®¿é—®ä»¥å‰çš„çŠ¶æ€ï¼Œå¿…é¡»èƒ½å¤Ÿæ¢å¤ä»¥å‰çŠ¶æ€åºåˆ—åŒ–å™¨çš„å¿«ç…§ã€‚\nFlink é€šè¿‡é¦–å…ˆå®ä¾‹åŒ– TypeSerializerSnapshot ä¸å…¶ç±»åï¼ˆä¸å¿«ç…§å­—èŠ‚ä¸€èµ·å†™å…¥ï¼‰æ¥æ¢å¤åºåˆ—å™¨å¿«ç…§ã€‚å› æ­¤ï¼Œä¸ºäº†é¿å…å—åˆ°æ„å¤–çš„ç±»åæ›´æ”¹æˆ–å®ä¾‹åŒ–å¤±è´¥ï¼Œ TypeSerializerSnapshot ç±»åº”è¯¥ã€‚\n é¿å…è¢«å®ç°ä¸ºåŒ¿åç±»æˆ–åµŒå¥—ç±»ã€‚ æœ‰ä¸€ä¸ªå…¬å…±çš„ç©ºå€¼æ„é€ å‡½æ•°ç”¨äºå®ä¾‹åŒ–ã€‚  é¿å…åœ¨ä¸åŒçš„åºåˆ—åŒ–å™¨ä¹‹é—´å…±äº«åŒä¸€ä¸ª TypeSerializerSnapshot ç±»ã€‚  ç”±äºæ¨¡å¼å…¼å®¹æ€§æ£€æŸ¥è¦é€šè¿‡åºåˆ—åŒ–å™¨å¿«ç…§ï¼Œè®©å¤šä¸ªåºåˆ—åŒ–å™¨è¿”å›åŒä¸€ä¸ª TypeSerializerSnapshot ç±»ä½œä¸ºå®ƒä»¬çš„å¿«ç…§ï¼Œä¼šä½¿ TypeSerializerSnapshot#resolveSchemaCompatibility å’Œ TypeSerializerSnapshot#restoreSerializer() æ–¹æ³•çš„å®ç°å˜å¾—å¤æ‚ã€‚\nè¿™ä¹Ÿå°†æ˜¯ä¸€ä¸ªä¸å¥½çš„åˆ†ç¦»å…³æ³¨ç‚¹ï¼Œä¸€ä¸ªå•ä¸€åºåˆ—åŒ–å™¨çš„åºåˆ—åŒ–æ¨¡å¼ã€é…ç½®ä»¥åŠå¦‚ä½•æ¢å¤å®ƒï¼Œåº”è¯¥åˆå¹¶åœ¨è‡ªå·±ä¸“é—¨çš„TypeSerializerSnapshotç±»ä¸­ã€‚\né¿å…ä½¿ç”¨ Java åºåˆ—åŒ–æ¥åˆ¶ä½œåºåˆ—åŒ–å™¨å¿«ç…§å†…å®¹  åœ¨ç¼–å†™æŒä¹…åŒ–çš„åºåˆ—åŒ–å™¨å¿«ç…§çš„å†…å®¹æ—¶ï¼Œå®Œå…¨ä¸åº”è¯¥ä½¿ç”¨ Java åºåˆ—åŒ–ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªåºåˆ—åŒ–å™¨éœ€è¦æŒä¹…åŒ–ä¸€ä¸ªç›®æ ‡ç±»å‹çš„ç±»ä½œä¸ºå…¶å¿«ç…§çš„ä¸€éƒ¨åˆ†ã€‚å…³äºç±»çš„ä¿¡æ¯åº”è¯¥é€šè¿‡å†™å…¥ç±»åæ¥æŒä¹…åŒ–ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ Java å°†ç±»åºåˆ—åŒ–ã€‚åœ¨è¯»å–å¿«ç…§æ—¶ï¼Œä¼šè¯»å–ç±»åï¼Œå¹¶é€šè¿‡åç§°æ¥åŠ¨æ€åŠ è½½ç±»ã€‚\nè¿™ç§åšæ³•ä¿è¯äº†åºåˆ—åŒ–å™¨å¿«ç…§æ€»æ˜¯å¯ä»¥å®‰å…¨è¯»å–ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœç±»å‹ç±»æ˜¯ä½¿ç”¨ Java åºåˆ—åŒ–æ¥æŒä¹…åŒ–çš„ï¼Œä¸€æ—¦ç±»çš„å®ç°å‘ç”Ÿäº†å˜åŒ–ï¼Œæ ¹æ® Java åºåˆ—åŒ–çš„å…·ä½“è§„å®šï¼Œå¿«ç…§å¯èƒ½ä¸å†å¯è¯»ï¼Œä¸å†äºŒè¿›åˆ¶å…¼å®¹ã€‚\nä» Flink 1.7 ä¹‹å‰çš„åºŸå¼ƒåºåˆ—åŒ–å¿«ç…§ API è¿ç§» æœ¬èŠ‚æ˜¯ä¸€ä¸ªä» Flink 1.7 ä¹‹å‰å­˜åœ¨çš„åºåˆ—åŒ–å™¨å’Œåºåˆ—åŒ–å™¨å¿«ç…§çš„ API è¿ç§»æŒ‡å—ã€‚\nåœ¨ Flink 1.7 ä¹‹å‰ï¼Œåºåˆ—åŒ–å™¨å¿«ç…§æ˜¯ä»¥ TypeSerializerConfigSnapshot çš„å½¢å¼å®ç°çš„ï¼ˆç°åœ¨å·²ç»è¢«åºŸå¼ƒäº†ï¼Œå°†æ¥æœ€ç»ˆä¼šè¢«ç§»é™¤ï¼Œå®Œå…¨è¢«æ–°çš„ TypeSerializerSnapshot æ¥å£å–ä»£ï¼‰ã€‚æ­¤å¤–ï¼Œåºåˆ—åŒ–å™¨æ¨¡å¼å…¼å®¹æ€§æ£€æŸ¥çš„è´£ä»»ä½åœ¨ TypeSerializer å†…éƒ¨ï¼Œåœ¨ TypeSerializer#ensureCompatibility(TypeSerializerConfigSnapshot) æ–¹æ³•ä¸­å®ç°ã€‚\næ–°æ—§æŠ½è±¡ä¹‹é—´çš„å¦ä¸€ä¸ªä¸»è¦åŒºåˆ«æ˜¯ï¼Œè¢«åºŸå¼ƒçš„ TypeSerializerConfigSnapshot ä¸å…·å¤‡å®ä¾‹åŒ–ä¹‹å‰çš„åºåˆ—åŒ–å™¨çš„èƒ½åŠ›ã€‚å› æ­¤ï¼Œåœ¨ä½ çš„åºåˆ—åŒ–å™¨ä»ç„¶è¿”å› TypeSerializerConfigSnapshot çš„å­ç±»ä½œä¸ºå®ƒçš„å¿«ç…§çš„æƒ…å†µä¸‹ï¼Œåºåˆ—åŒ–å™¨å®ä¾‹æœ¬èº«å°†æ€»æ˜¯ä½¿ç”¨ Java åºåˆ—åŒ–å†™å…¥ savepointsï¼Œä»¥ä¾¿åœ¨è¿˜åŸæ—¶å¯ä»¥ä½¿ç”¨ä»¥å‰çš„åºåˆ—åŒ–å™¨ã€‚è¿™æ˜¯å¾ˆä¸å¯å–çš„ï¼Œå› ä¸ºè¿˜åŸä½œä¸šæ˜¯å¦æˆåŠŸï¼Œå¾ˆå®¹æ˜“å—åˆ°å‰ä¸€ä¸ªåºåˆ—åŒ–å™¨ç±»çš„å¯ç”¨æ€§çš„å½±å“ï¼Œæˆ–è€…è¯´ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œåºåˆ—åŒ–å™¨å®ä¾‹æ˜¯å¦å¯ä»¥åœ¨è¿˜åŸæ—¶ä½¿ç”¨ Java åºåˆ—åŒ–è¯»å›ã€‚è¿™æ„å‘³ç€ä½ çš„çŠ¶æ€åªèƒ½ä½¿ç”¨åŒä¸€ä¸ªåºåˆ—åŒ–å™¨ï¼Œä¸€æ—¦ä½ æƒ³å‡çº§åºåˆ—åŒ–å™¨ç±»æˆ–è¿›è¡Œæ¨¡å¼è¿ç§»ï¼Œå¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚\nä¸ºäº†é¢å‘æœªæ¥ï¼Œå¹¶èƒ½çµæ´»åœ°è¿ç§»ä½ çš„çŠ¶æ€åºåˆ—å™¨å’Œæ¨¡å¼ï¼Œå¼ºçƒˆå»ºè®®ä»æ—§çš„æŠ½è±¡ä¸­è¿ç§»ã€‚åšåˆ°è¿™ä¸€ç‚¹çš„æ­¥éª¤å¦‚ä¸‹ã€‚\n å®ç° TypeSerializerSnapshot çš„æ–°å­ç±»ã€‚è¿™å°†æ˜¯ä½ çš„åºåˆ—åŒ–å™¨çš„æ–°å¿«ç…§ã€‚ åœ¨ TypeSerializer#snapshotConfiguration() æ–¹æ³•ä¸­è¿”å›æ–°çš„ TypeSerializerSnapshot ä½œä¸ºä½ çš„ serializer å¿«ç…§ã€‚ ä» Flink 1.7 ä¹‹å‰å­˜åœ¨çš„ä¿å­˜ç‚¹æ¢å¤ä½œä¸šï¼Œç„¶åå†å–ä¸€ä¸ªä¿å­˜ç‚¹ã€‚æ³¨æ„ï¼Œåœ¨è¿™ä¸€æ­¥ï¼Œæ—§çš„åºåˆ—åŒ–å™¨çš„ TypeSerializerConfigSnapshot å¿…é¡»ä»ç„¶å­˜åœ¨äº classpath ä¸­ï¼Œå¹¶ä¸”ä¸èƒ½åˆ é™¤ TypeSerializer#ensureCompatibility(TypeSerializerConfigSnapshot) æ–¹æ³•çš„å®ç°ã€‚è¿™ä¸ªè¿‡ç¨‹çš„ç›®çš„æ˜¯å°†æ—§ä¿å­˜ç‚¹ä¸­å†™çš„ TypeSerializerConfigSnapshot æ›¿æ¢ä¸ºåºåˆ—åŒ–å™¨æ–°å®ç°çš„ TypeSerializerSnapshotã€‚ ä¸€æ—¦ä½ æœ‰ä¸€ä¸ªç”¨ Flink 1.7 æ‹æ‘„çš„ä¿å­˜ç‚¹ï¼Œä¿å­˜ç‚¹å°†åŒ…å« TypeSerializerSnapshot ä½œä¸ºçŠ¶æ€åºåˆ—åŒ–å™¨å¿«ç…§ï¼Œåºåˆ—åŒ–å™¨å®ä¾‹å°†ä¸å†å†™å…¥ä¿å­˜ç‚¹ä¸­ã€‚åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œç°åœ¨å¯ä»¥å®‰å…¨åœ°åˆ é™¤æ—§æŠ½è±¡çš„æ‰€æœ‰å®ç°ï¼ˆä»åºåˆ—åŒ–å™¨ä¸­åˆ é™¤æ—§çš„ TypeSerializerConfigSnapshot å®ç°ï¼Œå› ä¸ºå°†ä½œä¸º TypeSerializer#ensureCompatibility(TypeSerializerConfigSnapshot)ï¼‰ã€‚  åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/stream/state/custom_serialization.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-custom-serialization-for-managed-state/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataStream API"],"title":"è‡ªå®šä¹‰åºåˆ—åŒ–ç®¡ç†çŠ¶æ€"},{"categories":["Flink"],"contents":"DESCRIBE è¯­å¥ DESCRIBE è¯­å¥ç”¨äºæè¿°è¡¨æˆ–è§†å›¾çš„æ¨¡å¼ã€‚\nè¿è¡Œä¸€ä¸ªDESCRIBEè¯­å¥ DESCRIBEè¯­å¥å¯ä»¥ç”¨TableEnvironmentçš„executeSql()æ–¹æ³•æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨SQL CLIä¸­æ‰§è¡Œã€‚executeSql()æ–¹æ³•å¯¹äºä¸€ä¸ªæˆåŠŸçš„DESCRIBEæ“ä½œä¼šè¿”å›ç»™å®šè¡¨çš„æ¨¡å¼ï¼Œå¦åˆ™ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚\nä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨TableEnvironmentå’ŒSQL CLIä¸­è¿è¡ŒDESCRIBEè¯­å¥ã€‚\nval settings = EnvironmentSettings.newInstance()... val tableEnv = TableEnvironment.create(settings) // register a table named \u0026#34;Orders\u0026#34;  tableEnv.executeSql( \u0026#34;CREATE TABLE Orders (\u0026#34; + \u0026#34; `user` BIGINT NOT NULl,\u0026#34; + \u0026#34; product VARCHAR(32),\u0026#34; + \u0026#34; amount INT,\u0026#34; + \u0026#34; ts TIMESTAMP(3),\u0026#34; + \u0026#34; ptime AS PROCTIME(),\u0026#34; + \u0026#34; PRIMARY KEY(`user`) NOT ENFORCED,\u0026#34; + \u0026#34; WATERMARK FOR ts AS ts - INTERVAL \u0026#39;1\u0026#39; SECONDS\u0026#34; + \u0026#34;) with (...)\u0026#34;) // print the schema tableEnv.executeSql(\u0026#34;DESCRIBE Orders\u0026#34;).print() Flink SQL\u0026gt; CREATE TABLE Orders ( \u0026gt; `user` BIGINT NOT NULl, \u0026gt; product VARCHAR(32), \u0026gt; amount INT, \u0026gt; ts TIMESTAMP(3), \u0026gt; ptime AS PROCTIME(), \u0026gt; PRIMARY KEY(`user`) NOT ENFORCED, \u0026gt; WATERMARK FOR ts AS ts - INTERVAL '1' SECONDS \u0026gt; ) with ( \u0026gt; ... \u0026gt; ); [INFO] Table has been created. Flink SQL\u0026gt; DESCRIBE Orders; root |-- user: BIGINT NOT NULL |-- product: VARCHAR(32) |-- amount: INT |-- ts: TIMESTAMP(3) *ROWTIME* |-- ptime: TIMESTAMP(3) NOT NULL *PROCTIME* AS PROCTIME() |-- WATERMARK FOR ts AS `ts` - INTERVAL '1' SECOND |-- CONSTRAINT PK_3599338 PRIMARY KEY (user) ä¸Šè¿°ä¾‹å­çš„ç»“æœæ˜¯ï¼š\n+---------+----------------------------------+-------+-----------+-----------------+----------------------------+ | name | type | null | key | computed column | watermark | +---------+----------------------------------+-------+-----------+-----------------+----------------------------+ | user | BIGINT | false | PRI(user) | | | | product | VARCHAR(32) | true | | | | | amount | INT | true | | | | | ts | TIMESTAMP(3) *ROWTIME* | true | | | `ts` - INTERVAL '1' SECOND | | ptime | TIMESTAMP(3) NOT NULL *PROCTIME* | false | | PROCTIME() | | +---------+----------------------------------+-------+-----------+-----------------+----------------------------+ 5 rows in set è¯­æ³• DESCRIBE[catalog_name.][db_name.]table_nameåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/sql/describe.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-run-a-describe-statement/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL","SQL"],"title":"è¿è¡Œ Describe è¯­å¥"},{"categories":["Flink"],"contents":"è¿ç»­æŸ¥è¯¢ä¸­çš„ Join åœ¨æ‰¹å¤„ç†æ•°æ®æ—¶ï¼Œè¿æ¥æ˜¯ä¸€ç§å¸¸è§çš„ã€å¥½ç†è§£çš„æ“ä½œï¼Œç”¨æ¥è¿æ¥ä¸¤ä¸ªå…³ç³»çš„è¡Œã€‚ç„¶è€Œï¼Œåœ¨åŠ¨æ€è¡¨ä¸Šçš„è¿æ¥çš„è¯­ä¹‰å°±ä¸é‚£ä¹ˆæ˜æ˜¾äº†ï¼Œç”šè‡³æ˜¯æ··ä¹±çš„ã€‚\næ­£å› ä¸ºå¦‚æ­¤ï¼Œæœ‰å‡ ç§æ–¹æ³•å¯ä»¥ä½¿ç”¨ Table API æˆ– SQL å®é™…æ‰§è¡Œè¿æ¥ã€‚\nå…³äºè¯­æ³•çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ Table API å’Œ SQL ä¸­çš„è¿æ¥éƒ¨åˆ†ã€‚\nå¸¸è§„è¿æ¥ å¸¸è§„è”æ¥æ˜¯æœ€é€šç”¨çš„è”æ¥ç±»å‹ï¼Œè”æ¥è¾“å…¥çš„ä»»ä½•ä¸€æ¡æ–°è®°å½•æˆ–å˜åŒ–éƒ½æ˜¯å¯è§çš„ï¼Œå¹¶å½±å“æ•´ä¸ªè”æ¥ç»“æœã€‚ä¾‹å¦‚ï¼Œå¦‚æœå·¦è¾¹æœ‰ä¸€æ¡æ–°è®°å½•ï¼Œå®ƒå°†ä¸å³è¾¹æ‰€æœ‰ä»¥å‰å’Œå°†æ¥çš„è®°å½•ä¸€èµ·è¿æ¥ã€‚\nSELECT*FROMOrdersINNERJOINProductONOrders.productId=Product.idè¿™äº›è¯­ä¹‰å…è®¸ä»»ä½•å½¢å¼çš„æ›´æ–°ï¼ˆæ’å…¥ã€æ›´æ–°ã€åˆ é™¤ï¼‰è¾“å…¥è¡¨ã€‚\nç„¶è€Œï¼Œè¿™ç§æ“ä½œæœ‰ä¸€ä¸ªé‡è¦çš„å«ä¹‰ï¼šå®ƒéœ€è¦å°† join è¾“å…¥çš„åŒæ–¹æ°¸è¿œä¿æŒåœ¨ Flink çš„çŠ¶æ€ä¸­ã€‚å› æ­¤ï¼Œå¦‚æœä¸€ä¸ªæˆ–ä¸¤ä¸ªè¾“å…¥è¡¨æŒç»­å¢é•¿ï¼Œèµ„æºä½¿ç”¨é‡ä¹Ÿä¼šæ— é™å¢é•¿ã€‚\nåŒºé—´è¿æ¥ åŒºé—´è”æ¥æ˜¯ç”±è”æ¥è°“è¯å®šä¹‰çš„ï¼Œå®ƒæ£€æŸ¥è¾“å…¥è®°å½•çš„æ—¶é—´å±æ€§æ˜¯å¦åœ¨ä¸€å®šçš„æ—¶é—´é™åˆ¶å†…ï¼Œå³æ—¶é—´çª—å£ã€‚\nSELECT*FROMOrderso,ShipmentssWHEREo.id=s.orderIdANDo.ordertimeBETWEENs.shiptime-INTERVAL\u0026#39;4\u0026#39;HOURANDs.shiptimeä¸æ™®é€šçš„ join æ“ä½œç›¸æ¯”ï¼Œè¿™ç§ join åªæ”¯æŒå¸¦æœ‰æ—¶é—´å±æ€§çš„ append-only è¡¨ã€‚ç”±äºæ—¶é—´å±æ€§æ˜¯å‡†å•è°ƒé€’å¢çš„ï¼Œæ‰€ä»¥ Flink å¯ä»¥åœ¨ä¸å½±å“ç»“æœæ­£ç¡®æ€§çš„æƒ…å†µä¸‹ï¼Œä»å…¶çŠ¶æ€ä¸­åˆ é™¤æ—§å€¼ã€‚\nç”¨ä¸´æ—¶è¡¨å‡½æ•°è¿›è¡Œè”æ¥ ä½¿ç”¨æ—¶æ€è¡¨å‡½æ•°çš„è¿æ¥ï¼Œå°†ä¸€ä¸ªåªé™„åŠ è¡¨ï¼ˆå·¦è¾“å…¥/æ¢é’ˆä¾§ï¼‰ä¸ä¸€ä¸ªæ—¶æ€è¡¨ï¼ˆå³è¾“å…¥/å»ºç«‹ä¾§ï¼‰è¿æ¥èµ·æ¥ï¼Œå³ä¸€ä¸ªéšæ—¶é—´å˜åŒ–çš„è¡¨ï¼Œå¹¶è·Ÿè¸ªå…¶å˜åŒ–ã€‚å…³äºä¸´æ—¶è¡¨çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ç›¸åº”é¡µé¢ã€‚\nä¸‹é¢çš„ä¾‹å­æ˜¾ç¤ºäº†ä¸€ä¸ªåªé™„åŠ è¡¨ Ordersï¼Œå®ƒåº”è¯¥ä¸ä¸æ–­å˜åŒ–çš„è´§å¸æ±‡ç‡è¡¨ RatesHistory è¿æ¥ã€‚\nOrders æ˜¯ä¸€ä¸ªåªé™„åŠ è¡¨ï¼Œè¡¨ç¤ºç»™å®šé‡‘é¢å’Œç»™å®šè´§å¸çš„ä»˜æ¬¾ã€‚ä¾‹å¦‚åœ¨ 10:15 æœ‰ä¸€ä¸ªé‡‘é¢ä¸º 2 æ¬§å…ƒçš„è®¢å•ã€‚\nSELECT*FROMOrders;rowtimeamountcurrency======================10:152Euro10:301USDollar10:3250Yen10:523Euro11:045USDollarRatesHistory ä»£è¡¨äº†ä¸€ä¸ªä¸æ–­å˜åŒ–çš„å¯¹æ—¥å…ƒï¼ˆæ±‡ç‡ä¸º 1ï¼‰çš„è´§å¸æ±‡ç‡é™„åŠ è¡¨ã€‚ä¾‹å¦‚ï¼Œä» 09:00 åˆ° 10:45ï¼Œæ¬§å…ƒå¯¹æ—¥å…ƒçš„æ±‡ç‡æ˜¯ 114ï¼Œä» 10:45 åˆ° 11:15 æ˜¯ 116ã€‚ä» 10:45 åˆ° 11:15 æ˜¯ 116ã€‚\nSELECT*FROMRatesHistory;rowtimecurrencyrate=====================09:00USDollar10209:00Euro11409:00Yen110:45Euro11611:15Euro11911:49Pounds108æˆ‘ä»¬æƒ³è®¡ç®—æ‰€æœ‰è®¢å•çš„é‡‘é¢ï¼Œå¹¶å°†å…¶æ¢ç®—æˆä¸€ç§é€šç”¨è´§å¸ï¼ˆæ—¥å…ƒï¼‰ã€‚\nä¾‹å¦‚ï¼Œæˆ‘ä»¬æƒ³ä½¿ç”¨ç»™å®šè¡Œæ—¶é—´(114)çš„é€‚å½“æ¢ç®—ç‡æ¢ç®—ä»¥ä¸‹è®¢å•ã€‚\nrowtime amount currency ======= ====== ========= 10:15 2 Euro å¦‚æœä¸ä½¿ç”¨ä¸´æ—¶è¡¨çš„æ¦‚å¿µï¼Œå°±éœ€è¦å†™ä¸€ä¸ªç±»ä¼¼çš„æŸ¥è¯¢ã€‚\nSELECTSUM(o.amount*r.rate)ASamountFROMOrdersASo,RatesHistoryASrWHEREr.currency=o.currencyANDr.rowtime=(SELECTMAX(rowtime)FROMRatesHistoryASr2WHEREr2.currency=o.currencyANDr2.rowtime\u0026lt;=o.rowtime);åœ¨ä¸´æ—¶è¡¨å‡½æ•° Rates over RatesHistory çš„å¸®åŠ©ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™æ ·çš„æŸ¥è¯¢ç”¨ SQL è¡¨è¾¾ä¸º:\nSELECTo.amount*r.rateASamountFROMOrdersASo,LATERALTABLE(Rates(o.rowtime))ASrWHEREr.currency=o.currencyæ¥è‡ªæ¢é’ˆä¾§çš„æ¯æ¡è®°å½•å°†ä¸æ„å»ºä¾§è¡¨åœ¨æ¢é’ˆä¾§è®°å½•çš„ç›¸å…³æ—¶é—´å±æ€§æ—¶çš„ç‰ˆæœ¬è¿æ¥ã€‚ä¸ºäº†æ”¯æŒæ›´æ–°ï¼ˆè¦†ç›–ï¼‰æ„å»ºä¾§è¡¨çš„å…ˆå‰å€¼ï¼Œè¡¨å¿…é¡»å®šä¹‰ä¸€ä¸ªä¸»é”®ã€‚\nåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæ¥è‡ª Orders çš„æ¯æ¡è®°å½•å°†ä¸ Rates çš„ç‰ˆæœ¬åœ¨æ—¶é—´ o.rowtime è¿æ¥ã€‚è´§å¸å­—æ®µä¹‹å‰å·²ç»è¢«å®šä¹‰ä¸º Rates çš„ä¸»é”®ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ç”¨æ¥è¿æ¥ä¸¤ä¸ªè¡¨ã€‚å¦‚æœæŸ¥è¯¢ä½¿ç”¨çš„æ˜¯å¤„ç†æ—¶é—´çš„æ¦‚å¿µï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œæ“ä½œæ—¶ï¼Œæ–°æ·»åŠ çš„è®¢å•å°†å§‹ç»ˆä¸ Rates çš„æœ€æ–°ç‰ˆæœ¬è¿æ¥ã€‚\nä¸å¸¸è§„çš„è¿æ¥ä¸åŒï¼Œè¿™æ„å‘³ç€å¦‚æœåœ¨æ„å»ºç«¯æœ‰æ–°çš„è®°å½•ï¼Œä¸ä¼šå½±å“ä¹‹å‰çš„è¿æ¥ç»“æœã€‚è¿™åˆä½¿å¾— Flink å¯ä»¥é™åˆ¶å¿…é¡»ä¿ç•™åœ¨çŠ¶æ€ä¸­çš„å…ƒç´ æ•°é‡ã€‚\nä¸åŒºé—´è”æ¥ç›¸æ¯”ï¼Œæ—¶é—´è¡¨è”æ¥å¹¶æ²¡æœ‰å®šä¹‰ä¸€ä¸ªæ—¶é—´çª—å£ï¼Œåœ¨è¿™ä¸ªæ—¶é—´çª—å£çš„èŒƒå›´å†…ï¼Œè®°å½•å°†è¢«åŠ å…¥ã€‚æ¥è‡ªæ¢é’ˆä¾§çš„è®°å½•æ€»æ˜¯åœ¨æ—¶é—´å±æ€§æŒ‡å®šçš„æ—¶é—´ä¸æ„å»ºä¾§çš„ç‰ˆæœ¬è¿›è¡Œè¿æ¥ã€‚å› æ­¤ï¼Œæ„å»ºä¾§çš„è®°å½•å¯èƒ½æ˜¯ä»»æ„çš„æ—§è®°å½•ã€‚éšç€æ—¶é—´çš„æµé€ï¼Œè®°å½•ï¼ˆå¯¹äºç»™å®šçš„ä¸»é”®ï¼‰ä»¥å‰çš„å’Œä¸å†éœ€è¦çš„ç‰ˆæœ¬å°†ä»çŠ¶æ€ä¸­åˆ é™¤ã€‚\nè¿™æ ·çš„è¡Œä¸ºä½¿å¾—æ—¶é—´è¡¨è¿æ¥æˆä¸ºç”¨å…³ç³»æœ¯è¯­æ¥è¡¨è¾¾æµä¸°å¯Œçš„ä¸€ä¸ªå¾ˆå¥½çš„å€™é€‰ã€‚\nä½¿ç”¨æ–¹æ³• å®šä¹‰äº†ä¸´æ—¶è¡¨å‡½æ•°ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ä½¿ç”¨å®ƒäº†ã€‚æ—¶é—´è¡¨å‡½æ•°çš„ä½¿ç”¨æ–¹æ³•å¯ä»¥å’Œæ™®é€šè¡¨å‡½æ•°çš„ä½¿ç”¨æ–¹æ³•ä¸€æ ·ã€‚\nä¸‹é¢çš„ä»£ç ç‰‡æ®µè§£å†³äº†æˆ‘ä»¬çš„åŠ¨æœºé—®é¢˜ï¼Œå³ä»è®¢å•è¡¨ä¸­è½¬æ¢è´§å¸ã€‚\nSELECTSUM(o_amount*r_rate)ASamountFROMOrders,LATERALTABLE(Rates(o_proctime))WHEREr_currency=o_currency// scala val result = orders .joinLateral(rates(\u0026#39;o_proctime), \u0026#39;r_currency === \u0026#39;o_currency) .select((\u0026#39;o_amount * \u0026#39;r_rate).sum as \u0026#39;amount) æ³¨æ„ï¼šåœ¨æŸ¥è¯¢é…ç½®ä¸­å®šä¹‰çš„çŠ¶æ€ä¿ç•™è¿˜æ²¡æœ‰å®ç°æ—¶åºè¿æ¥ã€‚è¿™æ„å‘³ç€è®¡ç®—æŸ¥è¯¢ç»“æœæ‰€éœ€çš„çŠ¶æ€å¯èƒ½ä¼šæ ¹æ®å†å²è¡¨çš„ä¸åŒä¸»é”®çš„æ•°é‡è€Œæ— é™å¢é•¿ã€‚\nå¤„ç†æ—¶é—´çš„ Temporal è¿æ¥ æœ‰äº†å¤„ç†æ—¶é—´æ—¶é—´å±æ€§ï¼Œå°±ä¸å¯èƒ½å°†è¿‡å»çš„æ—¶é—´å±æ€§ä½œä¸ºå‚æ•°ä¼ é€’ç»™æ—¶åºè¡¨å‡½æ•°ã€‚æ ¹æ®å®šä¹‰ï¼Œå®ƒæ€»æ˜¯å½“å‰çš„æ—¶é—´æˆ³ã€‚å› æ­¤ï¼Œå¯¹å¤„ç†æ—¶é—´æ—¶é—´è¡¨å‡½æ•°çš„è°ƒç”¨å°†å§‹ç»ˆè¿”å›åº•å±‚è¡¨çš„æœ€æ–°å·²çŸ¥ç‰ˆæœ¬ï¼Œåº•å±‚å†å²è¡¨çš„ä»»ä½•æ›´æ–°ä¹Ÿå°†ç«‹å³è¦†ç›–å½“å‰å€¼ã€‚\nåªæœ‰æ„å»ºä¾§è®°å½•çš„æœ€æ–°ç‰ˆæœ¬ï¼ˆç›¸å¯¹äºå®šä¹‰çš„ä¸»é”®ï¼‰æ‰ä¼šä¿å­˜åœ¨çŠ¶æ€ä¸­ã€‚æ„å»ºä¾§çš„æ›´æ–°ä¸ä¼šå¯¹ä¹‹å‰å‘å‡ºçš„è¿æ¥ç»“æœäº§ç”Ÿå½±å“ã€‚\næˆ‘ä»¬å¯ä»¥æŠŠå¤„ç†æ—¶çš„æ—¶ç©ºè”æ¥çœ‹æˆä¸€ä¸ªç®€å•çš„ HashMap\u0026lt;Kï¼ŒV\u0026gt;ï¼Œå®ƒå­˜å‚¨äº†æ¥è‡ªæ„å»ºä¾§çš„æ‰€æœ‰è®°å½•ã€‚å½“æ¥è‡ªæ„å»ºä¾§çš„æ–°è®°å½•ä¸ä¹‹å‰çš„æŸä¸ªè®°å½•å…·æœ‰ç›¸åŒçš„é”®æ—¶ï¼Œæ—§çš„å€¼åªæ˜¯ç®€å•åœ°è¢«è¦†ç›–ã€‚æ¥è‡ªæ¢é’ˆä¾§çš„æ¯æ¡è®°å½•æ€»æ˜¯æ ¹æ® HashMap çš„æœ€è¿‘/å½“å‰çŠ¶æ€è¿›è¡Œè¯„ä¼°ã€‚\näº‹ä»¶æ—¶é—´çš„ Temporal è¿æ¥ æœ‰äº†äº‹ä»¶æ—¶é—´å±æ€§ï¼ˆå³è¡Œæ—¶é—´å±æ€§ï¼‰ï¼Œå°±å¯ä»¥å°†è¿‡å»çš„æ—¶é—´å±æ€§ä¼ é€’ç»™æ—¶é—´è¡¨å‡½æ•°ã€‚è¿™æ ·å°±å¯ä»¥åœ¨ä¸€ä¸ªå…±åŒçš„æ—¶é—´ç‚¹ä¸Šè¿æ¥ä¸¤ä¸ªè¡¨ã€‚\nä¸å¤„ç†æ—¶é—´çš„æ—¶ç©ºè¿æ¥ç›¸æ¯”ï¼Œæ—¶ç©ºè¡¨ä¸ä»…ä¿ç•™äº†çŠ¶æ€ä¸‹æ„å»ºæ–¹è®°å½•çš„æœ€æ–°ç‰ˆæœ¬ï¼ˆç›¸å¯¹äºå®šä¹‰çš„ä¸»é”®ï¼‰ï¼Œè€Œä¸”è¿˜å­˜å‚¨äº†è‡ªä¸Šæ¬¡æ°´å°ä»¥æ¥çš„æ‰€æœ‰ç‰ˆæœ¬ï¼ˆé€šè¿‡æ—¶é—´æ¥è¯†åˆ«ï¼‰ã€‚\nä¾‹å¦‚ï¼Œä¸€ä¸ªäº‹ä»¶æ—¶é—´æ—¶é—´æˆ³ä¸º 12:30:00 çš„ä¼ å…¥è¡Œè¢«è¿½åŠ åˆ°æ¢é’ˆä¾§è¡¨ä¸­ï¼Œæ ¹æ®ä¸´æ—¶è¡¨çš„æ¦‚å¿µï¼Œå®ƒä¸æ„å»ºä¾§è¡¨ä¸­æ—¶é—´ä¸º 12:30:00 çš„ç‰ˆæœ¬è¿æ¥ã€‚å› æ­¤ï¼Œä¼ å…¥çš„è¡Œåªä¸æ—¶é—´æˆ³å°äºæˆ–ç­‰äº 12:30:00 çš„è¡Œè¿æ¥ï¼Œå¹¶æ ¹æ®ä¸»é”®åº”ç”¨æ›´æ–°ï¼Œç›´åˆ°è¿™ä¸ªæ—¶é—´ç‚¹ã€‚\næ ¹æ®äº‹ä»¶æ—¶é—´çš„å®šä¹‰ï¼Œæ°´å°å…è®¸è”æ¥æ“ä½œåœ¨æ—¶é—´ä¸Šå‘å‰ç§»åŠ¨ï¼Œå¹¶ä¸¢å¼ƒä¸å†éœ€è¦çš„æ„å»ºè¡¨çš„ç‰ˆæœ¬ï¼Œå› ä¸ºé¢„è®¡ä¸ä¼šæœ‰æ—¶é—´æˆ³è¾ƒä½æˆ–ç›¸ç­‰çš„ä¼ å…¥è¡Œã€‚\nç”¨æ—¶é—´è¡¨è¿›è¡Œè”æ¥ å¸¦æ—¶æ€è¡¨çš„è¿æ¥å°†ä¸€ä¸ªä»»æ„è¡¨ï¼ˆå·¦è¾“å…¥/æ¢é’ˆä¾§ï¼‰ä¸ä¸€ä¸ªæ—¶æ€è¡¨ï¼ˆå³è¾“å…¥/å»ºç«‹ä¾§ï¼‰è¿æ¥èµ·æ¥ï¼Œå³ä¸€ä¸ªéšæ—¶é—´å˜åŒ–çš„å¤–éƒ¨ç»´åº¦è¡¨ã€‚å…³äºæ—¶é—´è¡¨çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ç›¸åº”é¡µé¢ã€‚\næ³¨æ„: ç”¨æˆ·ä¸èƒ½ä½¿ç”¨ä»»æ„è¡¨ä½œä¸ºæ—¶é—´è¡¨ï¼Œè€Œæ˜¯éœ€è¦ä½¿ç”¨ä¸€ä¸ªç”± LookupableTableSource æ”¯æŒçš„è¡¨ã€‚ä¸€ä¸ª LookupableTableSource åªèƒ½ä½œä¸ºä¸€ä¸ªæ—¶æ€è¡¨ç”¨äºæ—¶æ€è¿æ¥ã€‚æœ‰å…³å¦‚ä½•å®šä¹‰ LookupableTableSource çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§é¡µé¢ã€‚\nä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºäº†ä¸€ä¸ª Orders æµï¼Œå®ƒåº”è¯¥ä¸ä¸æ–­å˜åŒ–çš„è´§å¸æ±‡ç‡è¡¨ LatestRates è¿›è¡Œè¿æ¥ã€‚\nLatestRates æ˜¯ä¸€ä¸ªç»´åº¦è¡¨ï¼Œå®ƒæ˜¯ä»¥æœ€æ–°çš„æ±‡ç‡æ¥å®ç°çš„ã€‚åœ¨æ—¶é—´ 10:15ã€10:30ã€10:52ï¼ŒLatestRates çš„å†…å®¹å¦‚ä¸‹ã€‚\n10:15\u0026gt;SELECT*FROMLatestRates;currencyrate==============USDollar102Euro114Yen110:30\u0026gt;SELECT*FROMLatestRates;currencyrate==============USDollar102Euro114Yen110:52\u0026gt;SELECT*FROMLatestRates;currencyrate==============USDollar102Euro116\u0026lt;====changedfrom114to116Yen1æ—¶é—´ 10:15 å’Œ 10:30 çš„ LastestRates å†…å®¹ç›¸ç­‰ã€‚æ¬§å…ƒæ±‡ç‡åœ¨ 10:52 ä» 114 å˜ä¸º 116ã€‚\nè®¢å•æ˜¯ä¸€ä¸ªåªé™„åŠ çš„è¡¨ï¼Œè¡¨ç¤ºç»™å®šé‡‘é¢å’Œç»™å®šè´§å¸çš„æ”¯ä»˜ã€‚ä¾‹å¦‚åœ¨ 10:15 æœ‰ä¸€ä¸ªé‡‘é¢ä¸º 2 æ¬§å…ƒçš„è®¢å•ã€‚\nSELECT*FROMOrders;amountcurrency===============2Euro\u0026lt;==arrivedattime10:151USDollar\u0026lt;==arrivedattime10:302Euro\u0026lt;==arrivedattime10:52æˆ‘ä»¬æƒ³è®¡ç®—æ‰€æœ‰è®¢å•çš„é‡‘é¢ï¼Œå¹¶å°†å…¶å…‘æ¢æˆä¸€ç§é€šç”¨è´§å¸ï¼ˆæ—¥å…ƒï¼‰ã€‚\nä¾‹å¦‚ï¼Œæˆ‘ä»¬æƒ³ä½¿ç”¨ LatestRates ä¸­çš„æœ€æ–°æ±‡ç‡æ¥è½¬æ¢ä»¥ä¸‹è®¢å•ã€‚ç»“æœå°†æ˜¯ï¼š\namount currency rate amout*rate ====== ========= ======= ============ 2 Euro 114 228 \u0026lt;== arrived at time 10:15 1 US Dollar 102 102 \u0026lt;== arrived at time 10:30 2 Euro 116 232 \u0026lt;== arrived at time 10:52 åœ¨æ—¶é—´è¡¨è¿æ¥çš„å¸®åŠ©ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™æ ·çš„æŸ¥è¯¢ç”¨ SQL è¡¨è¾¾ä¸ºã€‚\nSELECTo.amout,o.currency,r.rate,o.amount*r.rateFROMOrdersASoJOINLatestRatesFORSYSTEM_TIMEASOFo.proctimeASrONr.currency=o.currencyæ¥è‡ªæ¢é’ˆä¾§çš„æ¯ä¸€æ¡è®°å½•éƒ½å°†ä¸æ„å»ºä¾§è¡¨çš„å½“å‰ç‰ˆæœ¬ç›¸è¿æ¥ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼ŒæŸ¥è¯¢ä½¿ç”¨çš„æ˜¯å¤„ç†æ—¶é—´çš„æ¦‚å¿µï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œæ“ä½œæ—¶ï¼Œæ–°è¿½åŠ çš„è®¢å•å°†å§‹ç»ˆä¸æœ€æ–°ç‰ˆæœ¬çš„ LatestRates è¿æ¥ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç»“æœå¹¶ä¸æ˜¯å¤„ç†æ—¶é—´çš„ç¡®å®šæ€§ã€‚\nä¸å¸¸è§„è”æ¥ç›¸æ¯”ï¼Œå°½ç®¡æ„å»ºç«¯å‘ç”Ÿäº†å˜åŒ–ï¼Œä½†æ—¶æ€è¡¨è”æ¥ä¹‹å‰çš„ç»“æœä¸ä¼šå—åˆ°å½±å“ã€‚å¦å¤–ï¼Œæ—¶æ€è¡¨è¿æ¥æ“ä½œç¬¦éå¸¸è½»é‡çº§ï¼Œä¸ä¿ç•™ä»»ä½•çŠ¶æ€ã€‚\nä¸åŒºé—´è”æ¥ç›¸æ¯”ï¼Œæ—¶æ€è¡¨è”æ¥ä¸å®šä¹‰è®°å½•è”æ¥çš„æ—¶é—´çª—å£ã€‚åœ¨å¤„ç†æ—¶ï¼Œæ¥è‡ªæ¢é’ˆä¾§çš„è®°å½•æ€»æ˜¯ä¸æ„å»ºä¾§çš„æœ€æ–°ç‰ˆæœ¬è¿æ¥ã€‚å› æ­¤ï¼Œæ„å»ºä¾§çš„è®°å½•å¯èƒ½æ˜¯ä»»æ„æ—§çš„ã€‚\næ—¶æ€è¡¨å‡½æ•°è¿æ¥å’Œæ—¶æ€è¡¨è¿æ¥çš„åŠ¨æœºéƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†åœ¨ SQL è¯­æ³•å’Œè¿è¡Œæ—¶çš„å®ç°ä¸Šå´æœ‰æ‰€ä¸åŒã€‚\n æ—¶é—´è¡¨å‡½æ•° join çš„ SQL è¯­æ³•æ˜¯ join UDTFï¼Œè€Œæ—¶é—´è¡¨ join ä½¿ç”¨ SQL:2011 ä¸­å¼•å…¥çš„æ ‡å‡†æ—¶é—´è¡¨è¯­æ³•ã€‚ æ—¶æ€è¡¨å‡½æ•° join çš„å®ç°å®é™…ä¸Šæ˜¯å°†ä¸¤ä¸ªæµè¿æ¥èµ·æ¥å¹¶ä¿æŒçŠ¶æ€ï¼Œè€Œæ—¶æ€è¡¨ join åªæ˜¯æ¥æ”¶å”¯ä¸€çš„è¾“å…¥æµï¼Œå¹¶æ ¹æ®è®°å½•ä¸­çš„é”®æŸ¥æ‰¾å¤–éƒ¨æ•°æ®åº“ã€‚ æ—¶æ€è¡¨å‡½æ•°è”æ¥é€šå¸¸ç”¨äºè”æ¥å˜æ›´æ—¥å¿—æµï¼Œè€Œæ—¶æ€è¡¨è”æ¥é€šå¸¸ç”¨äºè”æ¥å¤–éƒ¨è¡¨ï¼ˆå³ç»´è¡¨ï¼‰ã€‚  è¿™æ ·çš„è¡Œä¸ºä½¿å¾—æ—¶æ€è¡¨è¿æ¥æˆä¸ºç”¨å…³ç³»æœ¯è¯­æ¥è¡¨è¾¾æµä¸°å¯Œçš„ä¸€ä¸ªå¾ˆå¥½çš„å€™é€‰ã€‚\nåœ¨æœªæ¥ï¼Œæ—¶æ€è¡¨è¿æ¥å°†æ”¯æŒæ—¶æ€è¡¨å‡½æ•°è¿æ¥çš„ç‰¹æ€§ï¼Œå³æ”¯æŒæ—¶æ€è¿æ¥ changelog æµã€‚\nä½¿ç”¨æ–¹æ³• æ—¶é—´è¡¨è¿æ¥çš„è¯­æ³•å¦‚ä¸‹ã€‚\nSELECT[column_list]FROMtable1[AS\u0026lt;alias1\u0026gt;][LEFT]JOINtable2FORSYSTEM_TIMEASOFtable1.proctime[AS\u0026lt;alias2\u0026gt;]ONtable1.column-name1=table2.column-name1ç›®å‰åªæ”¯æŒ INNER JOIN å’Œ LEFT JOINã€‚åœ¨ temporal è¡¨ååº”è·Ÿä¸Š FOR SYSTEM_TIME AS OF table1.proctimeã€‚proctime æ˜¯ table1 çš„å¤„ç†æ—¶é—´å±æ€§ã€‚è¿™æ„å‘³ç€å®ƒåœ¨å¤„ç†æ—¶é—´å¯¹æ—¶é—´è¡¨è¿›è¡Œå¿«ç…§ï¼Œå½“ä»å·¦è¡¨è¿æ¥æ¯ä¸€æ¡è®°å½•æ—¶ï¼Œå®ƒå°±ä¼šå¯¹æ—¶é—´è¡¨è¿›è¡Œå¿«ç…§ã€‚\nä¾‹å¦‚ï¼Œåœ¨å®šä¹‰äº† temporal è¡¨ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ä»¥ä¸‹æ–¹å¼ä½¿ç”¨ã€‚\nSELECTSUM(o_amount*r_rate)ASamountFROMOrdersJOINLatestRatesFORSYSTEM_TIMEASOFo_proctimeONr_currency=o_currencyæ³¨æ„: è¿™åªåœ¨ Blink è®¡åˆ’å™¨ä¸­æ”¯æŒã€‚\næ³¨æ„: ç›®å‰åªåœ¨ SQL ä¸­æ”¯æŒï¼Œåœ¨ Table API ä¸­è¿˜ä¸æ”¯æŒã€‚\næ³¨æ„: Flink ç›®å‰ä¸æ”¯æŒäº‹ä»¶æ—¶é—´çš„è¡¨è¿æ¥ã€‚\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/table/streaming/joins.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-join-in-continuous-queries/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Table API \u0026 SQL"],"title":"è¿ç»­æŸ¥è¯¢ä¸­çš„ Join"},{"categories":["Flink"],"contents":"è¿­ä»£ è¿­ä»£ç®—æ³•å‡ºç°åœ¨æ•°æ®åˆ†æçš„è®¸å¤šé¢†åŸŸï¼Œå¦‚æœºå™¨å­¦ä¹ æˆ–å›¾å½¢åˆ†æã€‚ä¸ºäº†å®ç°å¤§æ•°æ®çš„æ‰¿è¯ºï¼Œä»æ•°æ®ä¸­æå–æœ‰æ„ä¹‰çš„ä¿¡æ¯ï¼Œæ­¤ç±»ç®—æ³•è‡³å…³é‡è¦ã€‚éšç€äººä»¬å¯¹åœ¨éå¸¸å¤§çš„æ•°æ®é›†ä¸Šè¿è¡Œè¿™ç±»ç®—æ³•çš„å…´è¶£è¶Šæ¥è¶Šå¤§ï¼Œå°±éœ€è¦ä»¥å¤§è§„æ¨¡å¹¶è¡Œçš„æ–¹å¼æ‰§è¡Œè¿­ä»£ã€‚\nFlink ç¨‹åºé€šè¿‡å®šä¹‰ä¸€ä¸ªæ­¥éª¤å‡½æ•°å¹¶å°†å…¶åµŒå…¥åˆ°ä¸€ä¸ªç‰¹æ®Šçš„è¿­ä»£è¿ç®—ç¬¦ä¸­æ¥å®ç°è¿­ä»£ç®—æ³•ã€‚è¿™ä¸ªè¿ç®—ç¬¦æœ‰ä¸¤ä¸ªå˜ä½“ã€‚Iterate å’Œ Delta Iterateã€‚è¿™ä¸¤ä¸ªè¿ç®—ç¬¦éƒ½æ˜¯åœ¨å½“å‰çš„è¿­ä»£çŠ¶æ€ä¸Šåå¤è°ƒç”¨æ­¥éª¤å‡½æ•°ï¼Œç›´åˆ°è¾¾åˆ°æŸä¸ªç»ˆæ­¢æ¡ä»¶ã€‚\nåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æä¾›äº†è¿™ä¸¤ä¸ªæ“ä½œç¬¦å˜ä½“çš„èƒŒæ™¯ï¼Œå¹¶æ¦‚è¿°äº†å®ƒä»¬çš„ç”¨æ³•ã€‚ç¼–ç¨‹æŒ‡å—è§£é‡Šäº†å¦‚ä½•åœ¨ Scala å’Œ Java ä¸­å®ç°è¿™äº›æ“ä½œç¬¦ã€‚æˆ‘ä»¬è¿˜é€šè¿‡ Flink çš„å›¾å¤„ç† API Gelly æ”¯æŒä»¥é¡¶ç‚¹ä¸ºä¸­å¿ƒçš„è¿­ä»£å’Œé›†å’Œåº”ç”¨è¿­ä»£ã€‚\nä¸‹è¡¨æä¾›äº†è¿™ä¸¤ç§è¿ç®—ç¬¦çš„æ¦‚è¿°:\n    Iterate Delta Iterate     Iteration è¾“å…¥ Partial Solution Workset and Solution Set   Step å‡½æ•° Arbitrary Data Flows Arbitrary Data Flows   State Update Next partial solution Next workset,Changes to solution set   Iteration Result Last partial solution Solution set state after last iteration   Termination Maximum number of iterations (default),Custom aggregator convergence Maximum number of iterations or empty workset (default),Custom aggregator convergence    Iterate Operator è¿­ä»£è¿ç®—ç¬¦æ¶µç›–äº†ç®€å•çš„è¿­ä»£å½¢å¼ï¼šåœ¨æ¯ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œstep å‡½æ•°éƒ½ä¼šæ¶ˆè€—æ•´ä¸ªè¾“å…¥ï¼ˆä¸Šä¸€æ¬¡è¿­ä»£çš„ç»“æœï¼Œæˆ–åˆå§‹æ•°æ®é›†ï¼‰ï¼Œå¹¶è®¡ç®—å‡ºä¸‹ä¸€ä¸ªç‰ˆæœ¬çš„éƒ¨åˆ†è§£ï¼ˆå¦‚ map, reduce, join ç­‰ï¼‰ã€‚\n è¿­ä»£è¾“å…¥ã€‚ç¬¬ä¸€æ¬¡è¿­ä»£çš„åˆå§‹è¾“å…¥ï¼Œæ¥è‡ªæ•°æ®æºæˆ–ä¹‹å‰çš„è¿ç®—ç¬¦ã€‚ step å‡½æ•°ã€‚æ­¥éª¤å‡½æ•°å°†åœ¨æ¯æ¬¡è¿­ä»£ä¸­æ‰§è¡Œã€‚å®ƒæ˜¯ä¸€ä¸ªä»»æ„çš„æ•°æ®æµï¼Œç”± mapã€reduceã€join ç­‰è¿ç®—ç¬¦ç»„æˆï¼Œå–å†³äºä½ æ‰‹å¤´çš„å…·ä½“ä»»åŠ¡ã€‚ ä¸‹ä¸€ä¸ªéƒ¨åˆ†è§£å†³æ–¹æ¡ˆã€‚åœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œæ­¥éª¤å‡½æ•°çš„è¾“å‡ºå°†è¢«åé¦ˆåˆ°ä¸‹ä¸€æ¬¡è¿­ä»£ä¸­ã€‚ è¿­ä»£ç»“æœã€‚ä¸Šä¸€æ¬¡è¿­ä»£çš„è¾“å‡ºä¼šè¢«å†™å…¥æ•°æ®æ¥æ”¶å™¨ï¼Œæˆ–è€…ä½œä¸ºåç»­è¿ç®—ç¬¦çš„è¾“å…¥ã€‚  æœ‰å¤šä¸ªé€‰é¡¹å¯ä»¥æŒ‡å®šè¿­ä»£çš„ç»ˆæ­¢æ¡ä»¶ã€‚\n æœ€å¤§è¿­ä»£æ¬¡æ•°ã€‚æ²¡æœ‰ä»»ä½•è¿›ä¸€æ­¥çš„æ¡ä»¶ï¼Œè¿­ä»£å°†è¢«æ‰§è¡Œè¿™ä¹ˆå¤šæ¬¡ã€‚ è‡ªå®šä¹‰èšåˆå™¨æ”¶æ•›ã€‚è¿­ä»£å…è®¸æŒ‡å®šè‡ªå®šä¹‰èšåˆå™¨å’Œæ”¶æ•›æ ‡å‡†ï¼Œæ¯”å¦‚å¯¹å‘å‡ºçš„è®°å½•æ•°é‡è¿›è¡ŒåŠ æ€»ï¼ˆèšåˆå™¨ï¼‰ï¼Œå¦‚æœè¿™ä¸ªæ•°å­—ä¸ºé›¶å°±ç»ˆæ­¢ï¼ˆæ”¶æ•›æ ‡å‡†ï¼‰ã€‚  ä½ ä¹Ÿå¯ä»¥ç”¨ä¼ªä»£ç æ¥æ€è€ƒè¿­ä»£æ“ä½œç¬¦ã€‚\nIterationState state = getInitialState(); while (!terminationCriterion()) { state = step(state); } setFinalState(state); è¯¦æƒ…å’Œä»£ç ç¤ºä¾‹è¯·å‚è§ç¼–ç¨‹æŒ‡å—ã€‚\nä¾‹å­: æ•°å­—é€’å¢ åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯¹ä¸€ç»„æ•°å­—è¿›è¡Œè¿­ä»£é€’å¢ã€‚\n è¿­ä»£è¾“å…¥ã€‚åˆå§‹è¾“å…¥æ˜¯ä»æ•°æ®æºè¯»å–çš„ï¼Œç”±5ä¸ªå•å­—æ®µè®°å½•ç»„æˆï¼ˆæ•´æ•°1è‡³5ï¼‰ã€‚ step å‡½æ•°ã€‚æ­¥è¿›å‡½æ•°æ˜¯ä¸€ä¸ªå•ä¸€çš„ map è¿ç®—ç¬¦ï¼Œå®ƒå°†æ•´æ•°å­—æ®µä»ié€’å¢åˆ°i+1ã€‚å®ƒå°†è¢«åº”ç”¨äºè¾“å…¥çš„æ¯ä¸€æ¡è®°å½•ã€‚ ä¸‹ä¸€ä¸ªéƒ¨åˆ†è§£ã€‚step å‡½æ•°çš„è¾“å‡ºå°†æ˜¯ map è¿ç®—ç¬¦çš„è¾“å‡ºï¼Œä¹Ÿå°±æ˜¯æ•´æ•°é€’å¢çš„è®°å½•ã€‚ è¿­ä»£ç»“æœã€‚ç»è¿‡åæ¬¡è¿­ä»£ï¼Œåˆå§‹æ•°å­—å°†è¢«é€’å¢åå€ï¼Œç»“æœæ˜¯æ•´æ•°11åˆ°15ã€‚  // 1st 2nd 10th map(1) -\u0026gt; 2 map(2) -\u0026gt; 3 ... map(10) -\u0026gt; 11 map(2) -\u0026gt; 3 map(3) -\u0026gt; 4 ... map(11) -\u0026gt; 12 map(3) -\u0026gt; 4 map(4) -\u0026gt; 5 ... map(12) -\u0026gt; 13 map(4) -\u0026gt; 5 map(5) -\u0026gt; 6 ... map(13) -\u0026gt; 14 map(5) -\u0026gt; 6 map(6) -\u0026gt; 7 ... map(14) -\u0026gt; 15 è¯·æ³¨æ„ï¼Œ1ã€2å’Œ4å¯ä»¥æ˜¯ä»»æ„çš„æ•°æ®æµã€‚\nå¢é‡è¿­ä»£è¿ç®—ç¬¦ delta è¿­ä»£ç®—å­æ¶µç›–äº†å¢é‡è¿­ä»£çš„æƒ…å†µã€‚å¢é‡è¿­ä»£æœ‰é€‰æ‹©åœ°ä¿®æ”¹å…¶è§£çš„å…ƒç´ ï¼Œå¹¶å¯¹è§£è¿›è¡Œæ¼”åŒ–ï¼Œè€Œä¸æ˜¯å®Œå…¨é‡æ–°è®¡ç®—ã€‚\nåœ¨é€‚ç”¨çš„æƒ…å†µä¸‹ï¼Œè¿™å°†å¯¼è‡´æ›´é«˜æ•ˆçš„ç®—æ³•ï¼Œå› ä¸ºåœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œå¹¶ä¸æ˜¯è§£é›†ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½ä¼šæ”¹å˜ã€‚è¿™æ ·å°±å¯ä»¥æŠŠæ³¨æ„åŠ›é›†ä¸­åœ¨è§£çš„çƒ­ç‚¹éƒ¨åˆ†ï¼Œè€Œå¯¹å†·ç‚¹éƒ¨åˆ†ä¸åŠ å¤„ç†ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¤§éƒ¨åˆ†è§£çš„å†·å´é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œåé¢çš„è¿­ä»£åªå¯¹ä¸€å°éƒ¨åˆ†æ•°æ®è¿›è¡Œæ“ä½œã€‚\n è¿­ä»£è¾“å…¥ã€‚ä»æ•°æ®æºæˆ–ä»¥å‰çš„è¿ç®—ç¬¦ä¸­è¯»å–åˆå§‹å·¥ä½œé›†å’Œè§£å†³æ–¹æ¡ˆé›†ï¼Œä½œä¸ºç¬¬ä¸€æ¬¡è¿­ä»£çš„è¾“å…¥ã€‚ step å‡½æ•°ã€‚åœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œæ­¥éª¤å‡½æ•°å°†è¢«æ‰§è¡Œã€‚å®ƒæ˜¯ä¸€ä¸ªä»»æ„çš„æ•°æ®æµï¼Œç”± mapã€reduceã€join ç­‰è¿ç®—ç¬¦ç»„æˆï¼Œå–å†³äºä½ æ‰‹å¤´çš„å…·ä½“ä»»åŠ¡ã€‚ ä¸‹ä¸€ä¸ªå·¥ä½œé›†/æ›´æ–°è§£å†³æ–¹æ¡ˆé›†ã€‚ä¸‹ä¸€ä¸ªå·¥ä½œé›†é©±åŠ¨è¿­ä»£è®¡ç®—ï¼Œå¹¶å°†åé¦ˆåˆ°ä¸‹ä¸€ä¸ªè¿­ä»£ä¸­ã€‚æ­¤å¤–ï¼Œè§£å†³æ–¹æ¡ˆé›†å°†è¢«æ›´æ–°å¹¶éšå¼è½¬å‘ï¼ˆå®ƒä¸éœ€è¦è¢«é‡å»ºï¼‰ã€‚è¿™ä¸¤ä¸ªæ•°æ®é›†éƒ½å¯ä»¥é€šè¿‡æ­¥é•¿å‡½æ•°çš„ä¸åŒè¿ç®—ç¬¦è¿›è¡Œæ›´æ–°ã€‚ è¿­ä»£ç»“æœã€‚æœ€åä¸€æ¬¡è¿­ä»£åï¼Œè§£é›†è¢«å†™å…¥æ•°æ®æ¥æ”¶å™¨ï¼Œæˆ–ä½œä¸ºä¸‹é¢è¿ç®—ç¬¦çš„è¾“å…¥ã€‚  delta è¿­ä»£çš„é»˜è®¤ç»ˆæ­¢æ¡ä»¶ç”±ç©ºå·¥ä½œé›†æ”¶æ•›å‡†åˆ™å’Œæœ€å¤§è¿­ä»£æ¬¡æ•°æŒ‡å®šã€‚å½“äº§ç”Ÿçš„ä¸‹ä¸€ä¸ªå·¥ä½œé›†ä¸ºç©ºæˆ–è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°æ—¶ï¼Œè¿­ä»£å°†ç»ˆæ­¢ã€‚ä¹Ÿå¯ä»¥æŒ‡å®šä¸€ä¸ªè‡ªå®šä¹‰çš„èšåˆå™¨å’Œæ”¶æ•›å‡†åˆ™ã€‚\nä½ ä¹Ÿå¯ä»¥ç”¨ä¼ªä»£ç æ¥æ€è€ƒè¿­ä»£æ“ä½œç¬¦ã€‚\nIterationState workset = getInitialState(); IterationState solution = getInitialSolution(); while (!terminationCriterion()) { (delta, workset) = step(workset, solution); solution.update(delta) } setFinalState(solution); è¯¦æƒ…å’Œä»£ç ç¤ºä¾‹è¯·å‚è§ç¼–ç¨‹æŒ‡å—ã€‚\nä¾‹å­: åœ¨å›¾ä¸­ä¼ æ’­æœ€å°å€¼ åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæ¯ä¸ªé¡¶ç‚¹éƒ½æœ‰ä¸€ä¸ªIDå’Œä¸€ä¸ªç€è‰²ã€‚æ¯ä¸ªé¡¶ç‚¹å°†æŠŠå®ƒçš„é¡¶ç‚¹IDä¼ æ’­ç»™é‚»è¿‘çš„é¡¶ç‚¹ã€‚ç›®æ ‡æ˜¯ç»™å­å›¾ä¸­çš„æ¯ä¸ªé¡¶ç‚¹åˆ†é…æœ€å°çš„IDã€‚å¦‚æœä¸€ä¸ªæ¥æ”¶åˆ°çš„IDæ¯”å½“å‰çš„IDå°ï¼Œå®ƒå°±ä¼šæ”¹å˜æˆæ¥æ”¶åˆ°IDçš„é¡¶ç‚¹çš„é¢œè‰²ã€‚è¿™åœ¨ç¤¾åŒºåˆ†ææˆ–è¿æ¥ç»„ä»¶è®¡ç®—ä¸­å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªåº”ç”¨ã€‚\nåˆå§‹è¾“å…¥è¢«è®¾å®šä¸ºå·¥ä½œé›†å’Œè§£å†³æ–¹æ¡ˆé›†ã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œé¢œè‰²ç›´è§‚åœ°æ˜¾ç¤ºäº†è§£å†³æ–¹æ¡ˆé›†çš„æ¼”å˜ã€‚éšç€æ¯æ¬¡è¿­ä»£ï¼Œæœ€å°IDçš„é¢œè‰²åœ¨å„è‡ªçš„å­å›¾ä¸­è”“å»¶ã€‚åŒæ—¶ï¼Œæ¯ä¸€æ¬¡è¿­ä»£ï¼Œå·¥ä½œé‡ï¼ˆäº¤æ¢å’Œæ¯”è¾ƒé¡¶ç‚¹IDï¼‰éƒ½åœ¨å‡å°‘ã€‚è¿™å¯¹åº”äºå·¥ä½œé›†çš„å¤§å°é€’å‡ï¼Œåœ¨ä¸‰æ¬¡è¿­ä»£åï¼Œå·¥ä½œé›†ä»æ‰€æœ‰ä¸ƒä¸ªé¡¶ç‚¹å˜ä¸ºé›¶ï¼Œæ­¤æ—¶è¿­ä»£ç»ˆæ­¢ã€‚é‡è¦çš„è§‚å¯Ÿæ˜¯ï¼Œä¸‹åŠå­å›¾åœ¨ä¸ŠåŠå­å›¾ä¹‹å‰æ”¶æ•›ï¼Œè€Œdeltaè¿­ä»£èƒ½å¤Ÿç”¨å·¥ä½œé›†æŠ½è±¡æ•æ‰åˆ°è¿™ä¸€ç‚¹ã€‚\nåœ¨ä¸Šå­å›¾ä¸­ï¼ŒID 1ï¼ˆæ©™è‰²ï¼‰æ˜¯æœ€å°IDã€‚åœ¨ç¬¬ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œå®ƒå°†è¢«ä¼ æ’­åˆ°é¡¶ç‚¹2ï¼Œéšåå®ƒçš„é¢œè‰²å°†å˜ä¸ºæ©™è‰²ã€‚é¡¶ç‚¹3å’Œ4å°†æ”¶åˆ°ID 2ï¼ˆé»„è‰²ï¼‰ä½œä¸ºå®ƒä»¬å½“å‰çš„æœ€å°IDï¼Œå¹¶æ”¹å˜ä¸ºé»„è‰²ã€‚å› ä¸ºé¡¶ç‚¹1çš„é¢œè‰²åœ¨ç¬¬ä¸€æ¬¡è¿­ä»£ä¸­æ²¡æœ‰æ”¹å˜ï¼Œæ‰€ä»¥åœ¨ä¸‹ä¸€ä¸ªå·¥ä½œé›†ä¸­å¯ä»¥è·³è¿‡å®ƒã€‚\nåœ¨ä¸‹å±‚å­å›¾ä¸­ï¼ŒID 5ï¼ˆé’è‰²ï¼‰æ˜¯æœ€å°IDã€‚ä¸‹å±‚å­å›¾çš„æ‰€æœ‰é¡¶ç‚¹éƒ½ä¼šåœ¨ç¬¬ä¸€æ¬¡è¿­ä»£ä¸­æ”¶åˆ°å®ƒã€‚åŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸‹ä¸€ä¸ªå·¥ä½œé›†ä¸­è·³è¿‡æ²¡æœ‰å˜åŒ–çš„é¡¶ç‚¹ï¼ˆé¡¶ç‚¹5ï¼‰ã€‚\nåœ¨ç¬¬2æ¬¡è¿­ä»£ä¸­ï¼Œå·¥ä½œé›†å¤§å°å·²ç»ä»7ä¸ªå…ƒç´ å‡å°‘åˆ°5ä¸ªå…ƒç´ ï¼ˆé¡¶ç‚¹2ã€3ã€4ã€6å’Œ7ï¼‰ã€‚è¿™äº›éƒ½æ˜¯è¿­ä»£çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶è¿›ä¸€æ­¥ä¼ æ’­å®ƒä»¬å½“å‰çš„æœ€å°IDã€‚åœ¨è¿™æ¬¡è¿­ä»£ä¹‹åï¼Œä¸‹åŠéƒ¨åˆ†å­å›¾å·²ç»æ”¶æ•›äº†ï¼ˆå›¾çš„å†·éƒ¨åˆ†ï¼‰ï¼Œå› ä¸ºå®ƒåœ¨å·¥ä½œé›†ä¸­æ²¡æœ‰å…ƒç´ ï¼Œè€Œä¸ŠåŠéƒ¨åˆ†åˆ™éœ€è¦å¯¹å‰©ä¸‹çš„ä¸¤ä¸ªå·¥ä½œé›†å…ƒç´ ï¼ˆé¡¶ç‚¹3å’Œ4ï¼‰è¿›è¡Œè¿›ä¸€æ­¥çš„è¿­ä»£ï¼ˆå›¾çš„çƒ­éƒ¨åˆ†ï¼‰ã€‚\nå½“ç¬¬3æ¬¡è¿­ä»£åå·¥ä½œé›†ä¸ºç©ºæ—¶ï¼Œè¿­ä»£ç»ˆæ­¢ã€‚\nSuperstep åŒæ­¥ æˆ‘ä»¬å°†è¿­ä»£æ“ä½œç¬¦çš„æ­¥éª¤å‡½æ•°çš„æ¯æ¬¡æ‰§è¡Œç§°ä¸ºå•æ¬¡è¿­ä»£ã€‚åœ¨å¹¶è¡Œè®¾ç½®ä¸­ï¼Œæ­¥éª¤å‡½æ•°çš„å¤šä¸ªå®ä¾‹åœ¨è¿­ä»£çŠ¶æ€çš„ä¸åŒåˆ†åŒºä¸Šå¹¶è¡Œè¯„ä¼°ã€‚åœ¨è®¸å¤šè®¾ç½®ä¸­ï¼Œåœ¨æ‰€æœ‰å¹¶è¡Œå®ä¾‹ä¸Šå¯¹æ­¥éª¤å‡½æ•°çš„ä¸€æ¬¡è¯„ä¼°å½¢æˆä¸€ä¸ªæ‰€è°“çš„è¶…çº§æ­¥éª¤ï¼Œè¿™ä¹Ÿæ˜¯åŒæ­¥çš„ç²’åº¦ã€‚å› æ­¤ï¼Œä¸€ä¸ªè¿­ä»£çš„æ‰€æœ‰å¹¶è¡Œä»»åŠ¡éƒ½éœ€è¦å®Œæˆ superstepï¼Œæ‰ä¼šåˆå§‹åŒ–ä¸‹ä¸€ä¸ª superstepã€‚ç»ˆæ­¢æ ‡å‡†ä¹Ÿå°†åœ¨ superstep éšœç¢å¤„è¿›è¡Œè¯„ä¼°ã€‚\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/batch/iterations.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-iterations/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataSet API"],"title":"è¿­ä»£"},{"categories":["Flink"],"contents":"Flink ç¨‹åºå¯ä»¥åœ¨è®¸å¤šæœºå™¨ç»„æˆçš„é›†ç¾¤ä¸Šåˆ†å¸ƒå¼è¿è¡Œã€‚æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥å°†ç¨‹åºå‘é€åˆ°é›†ç¾¤ä¸Šæ‰§è¡Œã€‚\nå‘½ä»¤è¡Œæ¥å£ å‘½ä»¤è¡Œç•Œé¢è®©æ‚¨å¯ä»¥å°†æ‰“åŒ…çš„ç¨‹åºï¼ˆJARï¼‰æäº¤åˆ°é›†ç¾¤ï¼ˆæˆ–å•æœºè®¾ç½®ï¼‰ã€‚\nè¯¦æƒ…è¯·å‚è€ƒå‘½ä»¤è¡Œæ¥å£æ–‡æ¡£ã€‚\nè¿œç¨‹ç¯å¢ƒ è¿œç¨‹ç¯å¢ƒå¯ä»¥è®©ä½ ç›´æ¥åœ¨é›†ç¾¤ä¸Šæ‰§è¡Œ Flink Java ç¨‹åºã€‚è¿œç¨‹ç¯å¢ƒæŒ‡å‘ä½ è¦æ‰§è¡Œç¨‹åºçš„é›†ç¾¤ã€‚\nMaven ä¾èµ– å¦‚æœä½ æ˜¯ä»¥ Maven é¡¹ç›®çš„å½¢å¼å¼€å‘ç¨‹åºï¼Œä½ å¿…é¡»ä½¿ç”¨è¿™ä¸ªä¾èµ–å…³ç³»æ·»åŠ  flink-clients æ¨¡å—ã€‚\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.flink\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flink-clients_2.11\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.11.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; ä¾‹å­ ä»¥ä¸‹è¯´æ˜äº† RemoteEnvironment çš„ä½¿ç”¨ã€‚\npublic static void main(String[] args) throws Exception { ExecutionEnvironment env = ExecutionEnvironment .createRemoteEnvironment(\u0026#34;flink-jobmanager\u0026#34;, 8081, \u0026#34;/home/user/udfs.jar\u0026#34;); DataSet\u0026lt;String\u0026gt; data = env.readTextFile(\u0026#34;hdfs://path/to/file\u0026#34;); data .filter(new FilterFunction\u0026lt;String\u0026gt;() { public boolean filter(String value) { return value.startsWith(\u0026#34;http://\u0026#34;); } }) .writeAsText(\u0026#34;hdfs://path/to/result\u0026#34;); env.execute(); } è¯·æ³¨æ„ï¼Œè¯¥ç¨‹åºåŒ…å«è‡ªå®šä¹‰ç”¨æˆ·ä»£ç ï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªåŒ…å«ä»£ç ç±»çš„ JAR æ–‡ä»¶ã€‚è¿œç¨‹ç¯å¢ƒçš„æ„é€ å‡½æ•°ä½¿ç”¨ JAR æ–‡ä»¶çš„è·¯å¾„ã€‚\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/cluster_execution.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-cluster-execution/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","Cluster Execution"],"title":"é›†ç¾¤ Execution"},{"categories":["Flink"],"contents":"é¡¹ç›®é…ç½® æ¯ä¸ª Flink åº”ç”¨éƒ½ä¾èµ–äºä¸€ç»„ Flink åº“ã€‚æœ€èµ·ç ï¼Œåº”ç”¨ç¨‹åºä¾èµ–äº Flink APIsã€‚è®¸å¤šåº”ç”¨è¿˜ä¾èµ–äºæŸäº›è¿æ¥å™¨åº“ï¼ˆå¦‚ Kafkaã€Cassandra ç­‰ï¼‰ã€‚å½“è¿è¡Œ Flink åº”ç”¨æ—¶ï¼ˆæ— è®ºæ˜¯åœ¨åˆ†å¸ƒå¼éƒ¨ç½²ä¸­ï¼Œè¿˜æ˜¯åœ¨ IDE ä¸­è¿›è¡Œæµ‹è¯•ï¼‰ï¼ŒFlink è¿è¡Œæ—¶åº“ä¹Ÿå¿…é¡»æ˜¯å¯ç”¨çš„ã€‚\nFlink æ ¸å¿ƒå’Œåº”ç”¨ä¾èµ–æ€§ ä¸å¤§å¤šæ•°è¿è¡Œç”¨æˆ·å®šä¹‰åº”ç”¨çš„ç³»ç»Ÿä¸€æ ·ï¼ŒFlink ä¸­çš„ä¾èµ–å’Œåº“æœ‰ä¸¤å¤§ç±»ã€‚\n Flink æ ¸å¿ƒä¾èµ–ã€‚Flink æœ¬èº«ç”±ä¸€ç»„è¿è¡Œç³»ç»Ÿæ‰€éœ€çš„ç±»å’Œä¾èµ–å…³ç³»ç»„æˆï¼Œä¾‹å¦‚åè°ƒã€ç½‘ç»œã€æ£€æŸ¥ç‚¹ã€æ•…éšœè½¬ç§»ã€APIã€æ“ä½œï¼ˆå¦‚çª—å£åŒ–ï¼‰ã€èµ„æºç®¡ç†ç­‰ã€‚æ‰€æœ‰è¿™äº›ç±»å’Œä¾èµ–é¡¹çš„é›†åˆæ„æˆäº† Flink è¿è¡Œæ—¶çš„æ ¸å¿ƒï¼Œåœ¨ Flink åº”ç”¨å¯åŠ¨æ—¶å¿…é¡»å­˜åœ¨ã€‚  è¿™äº›æ ¸å¿ƒç±»å’Œä¾èµ–é¡¹è¢«æ‰“åŒ…åœ¨ flink-dist jar ä¸­ã€‚å®ƒä»¬æ˜¯ Flink çš„ lib æ–‡ä»¶å¤¹çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯åŸºæœ¬çš„ Flink å®¹å™¨é•œåƒçš„ä¸€éƒ¨åˆ†ã€‚æŠŠè¿™äº›ä¾èµ–å…³ç³»æƒ³è±¡æˆç±»ä¼¼äº Java çš„æ ¸å¿ƒåº“ï¼ˆrt.jarï¼Œcharsets.jar ç­‰ï¼‰ï¼Œå…¶ä¸­åŒ…å«äº† String å’Œ List ç­‰ç±»ã€‚\nFlink Core Dependencies ä¸åŒ…å«ä»»ä½•è¿æ¥å™¨æˆ–åº“ï¼ˆCEPã€SQLã€ML ç­‰ï¼‰ï¼Œä»¥é¿å…é»˜è®¤æƒ…å†µä¸‹ classpath ä¸­çš„ä¾èµ–å…³ç³»å’Œç±»æ•°é‡è¿‡å¤šã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬å°½é‡è®©æ ¸å¿ƒä¾èµ–å…³ç³»ä¿æŒçº¤ç»†ï¼Œä»¥ä¿æŒé»˜è®¤ classpath å°ï¼Œé¿å…ä¾èµ–å†²çªã€‚\n ç”¨æˆ·åº”ç”¨ä¾èµ–æ˜¯æŒ‡ç‰¹å®šç”¨æˆ·åº”ç”¨æ‰€éœ€è¦çš„æ‰€æœ‰è¿æ¥å™¨ã€æ ¼å¼æˆ–åº“ã€‚  ç”¨æˆ·åº”ç”¨ç¨‹åºé€šå¸¸è¢«æ‰“åŒ…æˆä¸€ä¸ªåº”ç”¨ç¨‹åº jarï¼Œå…¶ä¸­åŒ…å«äº†åº”ç”¨ç¨‹åºä»£ç å’Œæ‰€éœ€çš„è¿æ¥å™¨å’Œåº“ä¾èµ–ã€‚\nç”¨æˆ·åº”ç”¨ä¾èµ–å…³ç³»æ˜ç¡®ä¸åŒ…æ‹¬ Flink DataStream API å’Œè¿è¡Œæ—¶ä¾èµ–å…³ç³»ï¼Œå› ä¸ºè¿™äº›å·²ç»æ˜¯ Flink æ ¸å¿ƒä¾èµ–å…³ç³»çš„ä¸€éƒ¨åˆ†ã€‚\nè®¾ç½®ä¸€ä¸ªé¡¹ç›®: åŸºæœ¬ä¾èµ–æ€§ æ¯ä¸€ä¸ª Flink åº”ç”¨éƒ½éœ€è¦æœ€ä½é™åº¦çš„ API ä¾èµ–å…³ç³»ï¼Œæ¥è¿›è¡Œå¼€å‘ã€‚\nå½“æ‰‹åŠ¨è®¾ç½®é¡¹ç›®æ—¶ï¼Œä½ éœ€è¦ä¸º Java/Scala API æ·»åŠ ä»¥ä¸‹ä¾èµ–å…³ç³»ï¼ˆè¿™é‡Œç”¨ Maven è¯­æ³•è¡¨ç¤ºï¼Œä½†åŒæ ·çš„ä¾èµ–å…³ç³»ä¹Ÿé€‚ç”¨äºå…¶ä»–æ„å»ºå·¥å…·ï¼ˆGradleã€SBT ç­‰ï¼‰ã€‚\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.flink\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flink-streaming-scala_2.11\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.11.0\u0026lt;/version\u0026gt; \u0026lt;scope\u0026gt;provided\u0026lt;/scope\u0026gt; \u0026lt;/dependency\u0026gt; é‡è¦ï¼šè¯·æ³¨æ„ï¼Œæ‰€æœ‰è¿™äº›ä¾èµ–å…³ç³»çš„èŒƒå›´éƒ½è¢«è®¾ç½®ä¸º providedã€‚è¿™æ„å‘³ç€å®ƒä»¬éœ€è¦è¢«ç¼–è¯‘ï¼Œä½†å®ƒä»¬ä¸åº”è¯¥è¢«æ‰“åŒ…åˆ°é¡¹ç›®çš„åº”ç”¨ç¨‹åº jar æ–‡ä»¶ä¸­\u0026ndash;è¿™äº›ä¾èµ–æ˜¯ Flink æ ¸å¿ƒä¾èµ–ï¼Œåœ¨ä»»ä½•è®¾ç½®ä¸­éƒ½æ˜¯å¯ç”¨çš„ã€‚\nå¼ºçƒˆå»ºè®®å°†è¿™äº›ä¾èµ–å…³ç³»ä¿æŒåœ¨ provid çš„ä½œç”¨åŸŸå†…ã€‚å¦‚æœå®ƒä»¬æ²¡æœ‰è¢«è®¾ç½®ä¸º providedï¼Œæœ€å¥½çš„æƒ…å†µæ˜¯ç”Ÿæˆçš„ JAR å˜å¾—è¿‡å¤§ï¼Œå› ä¸ºå®ƒä¹ŸåŒ…å«äº†æ‰€æœ‰ Flink æ ¸å¿ƒä¾èµ–ã€‚æœ€åçš„æƒ…å†µæ˜¯ï¼Œæ·»åŠ åˆ°åº”ç”¨ç¨‹åºçš„ jar æ–‡ä»¶ä¸­çš„ Flink æ ¸å¿ƒä¾èµ–ä¸ä½ è‡ªå·±çš„ä¸€äº›ä¾èµ–ç‰ˆæœ¬å‘ç”Ÿå†²çªï¼ˆé€šå¸¸é€šè¿‡å€’ç±»åŠ è½½æ¥é¿å…ï¼‰ã€‚\nå…³äº IntelliJ çš„è¯´æ˜ï¼šè¦ä½¿åº”ç”¨ç¨‹åºåœ¨ IntelliJ IDEA ä¸­è¿è¡Œï¼Œå°±å¿…é¡»åœ¨è¿è¡Œé…ç½®ä¸­å‹¾é€‰ Include dependencies with \u0026ldquo;Provided\u0026rdquo; scope boxã€‚å¦‚æœè¿™ä¸ªé€‰é¡¹ä¸å¯ç”¨ï¼ˆå¯èƒ½æ˜¯ç”±äºä½¿ç”¨äº†æ—§çš„ IntelliJ IDEA ç‰ˆæœ¬ï¼‰ï¼Œé‚£ä¹ˆä¸€ä¸ªç®€å•çš„å˜é€šæ–¹æ³•æ˜¯åˆ›å»ºä¸€ä¸ªè°ƒç”¨åº”ç”¨ç¨‹åº main() æ–¹æ³•çš„æµ‹è¯•ã€‚\næ·»åŠ è¿æ¥å™¨å’Œåº“ä¾èµ–æ€§ å¤§å¤šæ•°åº”ç”¨éƒ½éœ€è¦ç‰¹å®šçš„è¿æ¥å™¨æˆ–åº“æ¥è¿è¡Œï¼Œä¾‹å¦‚ä¸ Kafkaã€Cassandra ç­‰çš„è¿æ¥å™¨ã€‚è¿™äº›è¿æ¥å™¨ä¸æ˜¯ Flink æ ¸å¿ƒä¾èµ–çš„ä¸€éƒ¨åˆ†ï¼Œå¿…é¡»ä½œä¸ºä¾èµ–å…³ç³»æ·»åŠ åˆ°åº”ç”¨ç¨‹åºä¸­ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªå°† Kafka çš„è¿æ¥å™¨ä½œä¸ºä¾èµ–é¡¹æ·»åŠ çš„ä¾‹å­ï¼ˆMaven è¯­æ³•ï¼‰ã€‚\n\u0026lt;dependency\u0026gt; \u0026lt;groupId\u0026gt;org.apache.flink\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;flink-connector-kafka_2.11\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;1.11.0\u0026lt;/version\u0026gt; \u0026lt;/dependency\u0026gt; æˆ‘ä»¬å»ºè®®å°†åº”ç”¨ç¨‹åºä»£ç å’Œæ‰€æœ‰éœ€è¦çš„ä¾èµ–å…³ç³»æ‰“åŒ…æˆä¸€ä¸ªå¸¦æœ‰ä¾èµ–å…³ç³»çš„ jarï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºåº”ç”¨ jarã€‚åº”ç”¨ jar å¯ä»¥æäº¤ç»™ä¸€ä¸ªå·²ç»è¿è¡Œçš„ Flink é›†ç¾¤ï¼Œæˆ–è€…æ·»åŠ åˆ° Flink åº”ç”¨å®¹å™¨é•œåƒä¸­ã€‚\nä» Java é¡¹ç›®æ¨¡æ¿æˆ– Scala é¡¹ç›®æ¨¡æ¿åˆ›å»ºçš„é¡¹ç›®è¢«é…ç½®ä¸ºåœ¨è¿è¡Œ mvn clean package æ—¶è‡ªåŠ¨å°†åº”ç”¨ä¾èµ–å…³ç³»åŒ…å«åˆ°åº”ç”¨ jar ä¸­ã€‚å¯¹äºæ²¡æœ‰ä»è¿™äº›æ¨¡æ¿ä¸­è®¾ç½®çš„é¡¹ç›®ï¼Œæˆ‘ä»¬å»ºè®®æ·»åŠ  Maven Shade Pluginï¼ˆå¦‚ä¸‹æ–‡é™„å½•ä¸­æ‰€åˆ—ï¼‰æ¥æ„å»ºåŒ…å«æ‰€æœ‰æ‰€éœ€ä¾èµ–é¡¹çš„åº”ç”¨ jarã€‚\né‡è¦çš„æ˜¯ã€‚ä¸ºäº†è®© Mavenï¼ˆå’Œå…¶ä»–æ„å»ºå·¥å…·ï¼‰æ­£ç¡®åœ°å°†ä¾èµ–å…³ç³»æ‰“åŒ…åˆ°åº”ç”¨ jar ä¸­ï¼Œè¿™äº›åº”ç”¨ä¾èµ–å…³ç³»å¿…é¡»åœ¨ç¼–è¯‘èŒƒå›´ä¸­æŒ‡å®šï¼ˆä¸æ ¸å¿ƒä¾èµ–å…³ç³»ä¸åŒï¼Œåè€…å¿…é¡»åœ¨æä¾›çš„èŒƒå›´ä¸­æŒ‡å®šï¼‰ã€‚\nScala ç‰ˆæœ¬ Scala ç‰ˆæœ¬(2.11, 2.12 ç­‰)å½¼æ­¤ä¹‹é—´ä¸æ˜¯äºŒè¿›åˆ¶å…¼å®¹çš„ã€‚å› æ­¤ï¼ŒFlink for Scala 2.11 ä¸èƒ½ç”¨äºä½¿ç”¨ Scala 2.12 çš„åº”ç”¨ç¨‹åºã€‚\næ‰€æœ‰çš„ Flink ä¾èµ–æ€§éƒ½æ˜¯ä»¥ Scala ç‰ˆæœ¬ä¸ºåç¼€çš„ï¼Œä¾‹å¦‚ flink-streaming-scala_2.11ã€‚\nåªä½¿ç”¨ Java çš„å¼€å‘è€…å¯ä»¥é€‰æ‹©ä»»ä½• Scala ç‰ˆæœ¬ï¼ŒScala å¼€å‘è€…éœ€è¦é€‰æ‹©ä¸å…¶åº”ç”¨çš„ Scala ç‰ˆæœ¬ç›¸åŒ¹é…çš„ Scala ç‰ˆæœ¬ã€‚\nè¯·å‚è€ƒæ„å»ºæŒ‡å—ï¼Œäº†è§£å¦‚ä½•ä¸ºç‰¹å®šçš„ Scala ç‰ˆæœ¬æ„å»º Flinkã€‚\nHadoop ä¾èµ–æ€§ ä¸€èˆ¬è§„åˆ™ï¼šæ°¸è¿œä¸éœ€è¦ç›´æ¥å°† Hadoop ä¾èµ–å…³ç³»æ·»åŠ åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºä¸­ã€‚å”¯ä¸€çš„ä¾‹å¤–æ˜¯å½“ä½¿ç”¨ç°æœ‰çš„ Hadoop è¾“å…¥/è¾“å‡ºæ ¼å¼å’Œ Flink çš„ Hadoop å…¼å®¹æ€§åŒ…è£…æ—¶ã€‚\nå¦‚æœæ‚¨æƒ³å°† Flink ä¸ Hadoop ä¸€èµ·ä½¿ç”¨ï¼Œæ‚¨éœ€è¦æœ‰ä¸€ä¸ªåŒ…å« Hadoop ä¾èµ–çš„ Flink è®¾ç½®ï¼Œè€Œä¸æ˜¯å°† Hadoop æ·»åŠ ä¸ºåº”ç”¨ç¨‹åºä¾èµ–ã€‚è¯¦æƒ…è¯·å‚è€ƒ Hadoop è®¾ç½®æŒ‡å—ã€‚\nè¿™ç§è®¾è®¡ä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ã€‚\n  ä¸€äº› Hadoop äº¤äº’å‘ç”Ÿåœ¨ Flink çš„æ ¸å¿ƒä¸­ï¼Œå¯èƒ½æ˜¯åœ¨ç”¨æˆ·åº”ç”¨å¯åŠ¨ä¹‹å‰ï¼Œä¾‹å¦‚ä¸ºæ£€æŸ¥ç‚¹è®¾ç½® HDFSï¼Œé€šè¿‡ Hadoop çš„ Kerberos ä»¤ç‰Œè¿›è¡Œè®¤è¯ï¼Œæˆ–è€…åœ¨ YARN ä¸Šè¿›è¡Œéƒ¨ç½²ã€‚\n  Flink çš„å€’ç±»åŠ è½½æ–¹æ³•å°†è®¸å¤šè¿‡æ¸¡æ€§ä¾èµ–ä»æ ¸å¿ƒä¾èµ–ä¸­éšè—èµ·æ¥ã€‚è¿™ä¸ä»…é€‚ç”¨äº Flink è‡ªèº«çš„æ ¸å¿ƒä¾èµ–ï¼Œä¹Ÿé€‚ç”¨äº Hadoop åœ¨è®¾ç½®ä¸­å­˜åœ¨çš„ä¾èµ–ã€‚è¿™æ ·ä¸€æ¥ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨ç›¸åŒä¾èµ–çš„ä¸åŒç‰ˆæœ¬ï¼Œè€Œä¸ä¼šé‡åˆ°ä¾èµ–å†²çªï¼ˆç›¸ä¿¡æˆ‘ä»¬ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤§é—®é¢˜ï¼Œå› ä¸º Hadoop çš„ä¾èµ–æ ‘æ˜¯å·¨å¤§çš„ï¼‰ã€‚\n  å¦‚æœä½ åœ¨ IDE å†…éƒ¨çš„æµ‹è¯•æˆ–å¼€å‘è¿‡ç¨‹ä¸­éœ€è¦ Hadoop ä¾èµ–å…³ç³»ï¼ˆä¾‹å¦‚ç”¨äº HDFS è®¿é—®ï¼‰ï¼Œè¯·å°†è¿™äº›ä¾èµ–å…³ç³»é…ç½®æˆç±»ä¼¼äºè¦æµ‹è¯•æˆ–æä¾›çš„ä¾èµ–å…³ç³»çš„èŒƒå›´ã€‚\nMaven å¿«é€Ÿå…¥é—¨ æ‰€éœ€\nå”¯ä¸€çš„è¦æ±‚æ˜¯å·¥ä½œä¸­çš„ Maven 3.0.4ï¼ˆæˆ–æ›´é«˜ï¼‰å’Œ Java 8.x çš„å®‰è£…ã€‚\nåˆ›å»ºé¡¹ç›®\nä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¹‹ä¸€æ¥åˆ›å»ºé¡¹ç›®ã€‚\n ä½¿ç”¨ Maven åŸå‹  $ mvn archetype:generate \\  -DarchetypeGroupId=org.apache.flink \\  -DarchetypeArtifactId=flink-quickstart-java \\  -DarchetypeVersion=1.11.0 è¿™å¯ä»¥è®©ä½ ä¸ºæ–°åˆ›å»ºçš„é¡¹ç›®å‘½åï¼Œå®ƒå°†äº¤äº’å¼åœ°è¦æ±‚ä½ æä¾› groupIdã€artifactId å’ŒåŒ…åã€‚\n è¿è¡Œå¿«é€Ÿå¯åŠ¨è„šæœ¬  $ curl https://flink.apache.org/q/quickstart.sh | bash -s 1.11.0 æˆ‘ä»¬å»ºè®®æ‚¨å°†è¯¥é¡¹ç›®å¯¼å…¥åˆ°æ‚¨çš„ IDE ä¸­è¿›è¡Œå¼€å‘å’Œæµ‹è¯•ã€‚IntelliJ IDEA æ”¯æŒå¼€ç®±å³ç”¨çš„ Maven é¡¹ç›®ã€‚å¦‚æœæ‚¨ä½¿ç”¨ Eclipseï¼Œm2e æ’ä»¶å…è®¸å¯¼å…¥ Maven é¡¹ç›®ã€‚æœ‰äº› Eclipse æ†ç»‘åŒ…é»˜è®¤åŒ…å«è¯¥æ’ä»¶ï¼Œæœ‰äº›åˆ™éœ€è¦æ‚¨æ‰‹åŠ¨å®‰è£…ã€‚\nè¯·æ³¨æ„ï¼šJava é»˜è®¤çš„ JVM å †å¤§å°å¯¹ Flink æ¥è¯´å¯èƒ½å¤ªå°ã€‚ä½ å¿…é¡»æ‰‹åŠ¨å¢åŠ å®ƒã€‚åœ¨ Eclipse ä¸­ï¼Œé€‰æ‹© Run Configurations -\u0026gt; Argumentsï¼Œå¹¶åœ¨ VM Arguments æ¡†ä¸­å†™ä¸‹ -Xmx800mã€‚åœ¨ IntelliJ IDEA ä¸­æ¨èçš„æ”¹å˜ JVM é€‰é¡¹çš„æ–¹æ³•æ˜¯æ¥è‡ª Help | Edit Custom VM Options èœå•ã€‚è¯¦æƒ…è¯·çœ‹è¿™ç¯‡æ–‡ç« ã€‚\næ„å»ºé¡¹ç›® å¦‚æœä½ æƒ³æ„å»º/æ‰“åŒ…ä½ çš„é¡¹ç›®ï¼Œè¿›å…¥ä½ çš„é¡¹ç›®ç›®å½•å¹¶è¿è¡Œ \u0026ldquo;mvn clean package\u0026rdquo; å‘½ä»¤ã€‚ä½ ä¼šå‘ç°ä¸€ä¸ª JAR æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†ä½ çš„åº”ç”¨ç¨‹åºï¼ŒåŠ ä¸Šä½ å¯èƒ½å·²ç»æ·»åŠ çš„è¿æ¥å™¨å’Œåº“ä½œä¸ºåº”ç”¨ç¨‹åºçš„ä¾èµ–å…³ç³»ï¼štarget/\u0026lt;artifact-id\u0026gt;-\u0026lt;version\u0026gt;.jarã€‚\næ³¨æ„ï¼šå¦‚æœæ‚¨ä½¿ç”¨ä¸ StreamingJob ä¸åŒçš„ç±»ä½œä¸ºåº”ç”¨ç¨‹åºçš„ä¸»ç±»/å…¥å£ç‚¹ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨ç›¸åº”åœ°æ›´æ”¹ pom.xml æ–‡ä»¶ä¸­çš„ mainClass è®¾ç½®ã€‚è¿™æ ·ï¼ŒFlink å°±å¯ä»¥ä» JAR æ–‡ä»¶ä¸­è¿è¡Œåº”ç”¨ç¨‹åºï¼Œè€Œä¸éœ€è¦é¢å¤–æŒ‡å®šä¸»ç±»ã€‚\nGradle éœ€æ±‚\nå”¯ä¸€çš„è¦æ±‚æ˜¯å·¥ä½œçš„ Gradle 3.xï¼ˆæˆ–æ›´é«˜ï¼‰å’Œ Java 8.x å®‰è£…ã€‚\nåˆ›å»ºé¡¹ç›®\nä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¹‹ä¸€æ¥åˆ›å»ºä¸€ä¸ªé¡¹ç›®ã€‚\n Gradle ä¾‹å­  build.gradle\nbuildscript { repositories { jcenter() // this applies only to the Gradle \u0026#39;Shadow\u0026#39; plugin } dependencies { classpath \u0026#39;com.github.jengelman.gradle.plugins:shadow:2.0.4\u0026#39; } } plugins { id \u0026#39;java\u0026#39; id \u0026#39;application\u0026#39; // shadow plugin to produce fat JARs id \u0026#39;com.github.johnrengelman.shadow\u0026#39; version \u0026#39;2.0.4\u0026#39; } // artifact properties group = \u0026#39;org.myorg.quickstart\u0026#39; version = \u0026#39;0.1-SNAPSHOT\u0026#39; mainClassName = \u0026#39;org.myorg.quickstart.StreamingJob\u0026#39; description = \u0026#34;\u0026#34;\u0026#34;Flink Quickstart Job\u0026#34;\u0026#34;\u0026#34; ext { javaVersion = \u0026#39;1.8\u0026#39; flinkVersion = \u0026#39;1.11.0\u0026#39; scalaBinaryVersion = \u0026#39;2.11\u0026#39; slf4jVersion = \u0026#39;1.7.15\u0026#39; log4jVersion = \u0026#39;2.12.1\u0026#39; } sourceCompatibility = javaVersion targetCompatibility = javaVersion tasks.withType(JavaCompile) { options.encoding = \u0026#39;UTF-8\u0026#39; } applicationDefaultJvmArgs = [\u0026#34;-Dlog4j.configurationFile=log4j2.properties\u0026#34;] task wrapper(type: Wrapper) { gradleVersion = \u0026#39;3.1\u0026#39; } // declare where to find the dependencies of your project repositories { mavenCentral() maven { url \u0026#34;https://repository.apache.org/content/repositories/snapshots/\u0026#34; } } // NOTE: We cannot use \u0026#34;compileOnly\u0026#34; or \u0026#34;shadow\u0026#34; configurations since then we could not run code // in the IDE or with \u0026#34;gradle run\u0026#34;. We also cannot exclude transitive dependencies from the // shadowJar yet (see https://github.com/johnrengelman/shadow/issues/159). // -\u0026gt; Explicitly define the // libraries we want to be included in the \u0026#34;flinkShadowJar\u0026#34; configuration! configurations { flinkShadowJar // dependencies which go into the shadowJar // always exclude these (also from transitive dependencies) since they are provided by Flink flinkShadowJar.exclude group: \u0026#39;org.apache.flink\u0026#39;, module: \u0026#39;force-shading\u0026#39; flinkShadowJar.exclude group: \u0026#39;com.google.code.findbugs\u0026#39;, module: \u0026#39;jsr305\u0026#39; flinkShadowJar.exclude group: \u0026#39;org.slf4j\u0026#39; flinkShadowJar.exclude group: \u0026#39;org.apache.logging.log4j\u0026#39; } // declare the dependencies for your production and test code dependencies { // -------------------------------------------------------------- // Compile-time dependencies that should NOT be part of the // shadow jar and are provided in the lib folder of Flink // -------------------------------------------------------------- compile \u0026#34;org.apache.flink:flink-streaming-java_${scalaBinaryVersion}:${flinkVersion}\u0026#34; // -------------------------------------------------------------- // Dependencies that should be part of the shadow jar, e.g. // connectors. These must be in the flinkShadowJar configuration! // -------------------------------------------------------------- //flinkShadowJar \u0026#34;org.apache.flink:flink-connector-kafka-0.11_${scalaBinaryVersion}:${flinkVersion}\u0026#34; compile \u0026#34;org.apache.logging.log4j:log4j-api:${log4jVersion}\u0026#34; compile \u0026#34;org.apache.logging.log4j:log4j-core:${log4jVersion}\u0026#34; compile \u0026#34;org.apache.logging.log4j:log4j-slf4j-impl:${log4jVersion}\u0026#34; compile \u0026#34;org.slf4j:slf4j-log4j12:${slf4jVersion}\u0026#34; // Add test dependencies here. // testCompile \u0026#34;junit:junit:4.12\u0026#34; } // make compileOnly dependencies available for tests: sourceSets { main.compileClasspath += configurations.flinkShadowJar main.runtimeClasspath += configurations.flinkShadowJar test.compileClasspath += configurations.flinkShadowJar test.runtimeClasspath += configurations.flinkShadowJar javadoc.classpath += configurations.flinkShadowJar } run.classpath = sourceSets.main.runtimeClasspath jar { manifest { attributes \u0026#39;Built-By\u0026#39;: System.getProperty(\u0026#39;user.name\u0026#39;), \u0026#39;Build-Jdk\u0026#39;: System.getProperty(\u0026#39;java.version\u0026#39;) } } shadowJar { configurations = [project.configurations.flinkShadowJar] } setting.gradle\nrootProject.name = \u0026#39;quickstart\u0026#39; è¿™å…è®¸ä½ ä¸ºä½ æ–°åˆ›å»ºçš„é¡¹ç›®å‘½åï¼Œå®ƒå°†äº¤äº’å¼åœ°è¯¢é—®ä½ é¡¹ç›®çš„åç§°ã€ç»„ç»‡ï¼ˆä¹Ÿç”¨äºåŒ…åï¼‰ã€é¡¹ç›®ç‰ˆæœ¬ã€Scala å’Œ Flinkã€‚å®ƒå°†äº¤äº’å¼åœ°è¦æ±‚ä½ æä¾›é¡¹ç›®åç§°ã€ç»„ç»‡ï¼ˆä¹Ÿç”¨äºåŒ…åï¼‰ã€é¡¹ç›®ç‰ˆæœ¬ã€Scala å’Œ Flink ç‰ˆæœ¬ã€‚\n è¿è¡Œå¿«é€Ÿå¯åŠ¨è„šæœ¬  bash -c \u0026#34;$(curl https://flink.apache.org/q/gradle-quickstart.sh)\u0026#34; -- 1.11.0 2.11 æˆ‘ä»¬å»ºè®®ä½ å°†è¿™ä¸ªé¡¹ç›®å¯¼å…¥åˆ°ä½ çš„ IDE ä¸­è¿›è¡Œå¼€å‘å’Œæµ‹è¯•ã€‚IntelliJ IDEA åœ¨å®‰è£… Gradle æ’ä»¶åï¼Œæ”¯æŒ Gradle é¡¹ç›®ã€‚Eclipse é€šè¿‡ Eclipse Buildship æ’ä»¶æ¥å®ç°ï¼ˆç¡®ä¿åœ¨å¯¼å…¥å‘å¯¼çš„æœ€åä¸€æ­¥æŒ‡å®š Gradle ç‰ˆæœ¬\u0026gt;=3.0ï¼Œå½±å­æ’ä»¶éœ€è¦å®ƒï¼‰ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ Gradle çš„ IDE é›†æˆæ¥ä» Gradle åˆ›å»ºé¡¹ç›®æ–‡ä»¶ã€‚\nè¯·æ³¨æ„ï¼šJava é»˜è®¤çš„ JVM å †å¤§å°å¯¹ Flink æ¥è¯´å¯èƒ½å¤ªå°ã€‚ä½ å¿…é¡»æ‰‹åŠ¨å¢åŠ å®ƒã€‚åœ¨ Eclipse ä¸­ï¼Œé€‰æ‹© Run Configurations -\u0026gt; Argumentsï¼Œå¹¶åœ¨ VM Arguments æ¡†ä¸­å†™ä¸‹ -Xmx800mã€‚åœ¨ IntelliJ IDEA ä¸­æ¨èçš„æ”¹å˜ JVM é€‰é¡¹çš„æ–¹æ³•æ˜¯æ¥è‡ª Help | Edit Custom VM Options èœå•ã€‚è¯¦æƒ…è¯·çœ‹è¿™ç¯‡æ–‡ç« ã€‚\næ„å»ºé¡¹ç›® å¦‚æœä½ æƒ³æ„å»º/æ‰“åŒ…ä½ çš„é¡¹ç›®ï¼Œå»ä½ çš„é¡¹ç›®ç›®å½•ä¸‹è¿è¡Œ \u0026ldquo;gradle clean shadowJar\u0026rdquo; å‘½ä»¤ï¼Œä½ ä¼šå‘ç°ä¸€ä¸ª JAR æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†ä½ çš„åº”ç”¨ç¨‹åºï¼Œä»¥åŠä½ å¯èƒ½å·²ç»æ·»åŠ åˆ°åº”ç”¨ç¨‹åºä¸­ä½œä¸ºä¾èµ–çš„è¿æ¥å™¨å’Œåº“ï¼šbuild/libs/\u0026lt;project-name\u0026gt;-\u0026lt;version\u0026gt;-all.jarã€‚\næ³¨æ„ï¼šå¦‚æœä½ ä½¿ç”¨ä¸ StreamingJob ä¸åŒçš„ç±»ä½œä¸ºåº”ç”¨ç¨‹åºçš„ä¸»ç±»/å…¥å£ç‚¹ï¼Œæˆ‘ä»¬å»ºè®®ä½ ç›¸åº”åœ°æ›´æ”¹ build.gradle æ–‡ä»¶ä¸­çš„ mainClassName è®¾ç½®ã€‚è¿™æ ·ï¼ŒFlink å°±å¯ä»¥ä» JAR æ–‡ä»¶ä¸­è¿è¡Œåº”ç”¨ç¨‹åºï¼Œè€Œæ— éœ€é¢å¤–æŒ‡å®šä¸»ç±»ã€‚\nSBT åˆ›å»ºé¡¹ç›® æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ä¸­çš„ä»»ä½•ä¸€ç§æ¥æ„å»ºä¸€ä¸ªæ–°é¡¹ç›®ã€‚\n ä½¿ç”¨ sbt æ¨¡æ¿  $ sbt new tillrohrmann/flink-project.g8  è¿è¡Œå¿«é€Ÿå¯åŠ¨è„šæœ¬  $ bash \u0026lt;(curl https://flink.apache.org/q/sbt-quickstart.sh) è¿™å°†åœ¨æŒ‡å®šçš„é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª Flink é¡¹ç›®ã€‚\næ„å»ºé¡¹ç›® ä¸ºäº†å»ºç«‹ä½ çš„é¡¹ç›®ï¼Œä½ åªéœ€è¦å‘å‡º sbt clean assembly å‘½ä»¤ã€‚è¿™å°†åœ¨ target/scala_your-major-scala-version/ ç›®å½•ä¸‹åˆ›å»º fat-jar your-project-name-assembly-0.1-SNAPSHOT.jarã€‚\nè¿è¡Œé¡¹ç›®\nä¸ºäº†è¿è¡Œä½ çš„é¡¹ç›®ï¼Œä½ å¿…é¡»å‘å‡º sbt è¿è¡Œå‘½ä»¤ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™å°†åœ¨ sbt è¿è¡Œçš„åŒä¸€ä¸ª JVM ä¸­è¿è¡Œä½ çš„å·¥ä½œã€‚ä¸ºäº†åœ¨ä¸åŒçš„ JVM ä¸­è¿è¡Œä½ çš„å·¥ä½œï¼Œè¯·åœ¨ build.sbt ä¸­æ·»åŠ ä»¥ä¸‹è¡Œã€‚\nfork in run := true IntelliJ æˆ‘ä»¬æ¨èæ‚¨ä½¿ç”¨ IntelliJ è¿›è¡Œ Flink ä½œä¸šå¼€å‘ã€‚ä¸ºäº†å¼€å§‹ï¼Œæ‚¨å¿…é¡»å°†æ–°åˆ›å»ºçš„é¡¹ç›®å¯¼å…¥åˆ° IntelliJ ä¸­ã€‚æ‚¨å¯ä»¥é€šè¿‡ File -\u0026gt; New -\u0026gt; Project from Existing Sources\u0026hellip;ç„¶åé€‰æ‹©æ‚¨çš„é¡¹ç›®ç›®å½•ã€‚IntelliJ ä¼šè‡ªåŠ¨æ£€æµ‹ build.sbt æ–‡ä»¶ï¼Œå¹¶è®¾ç½®å¥½ä¸€åˆ‡ã€‚\nä¸ºäº†è¿è¡Œ Flink ä½œä¸šï¼Œå»ºè®®é€‰æ‹© mainRunner æ¨¡å—ä½œä¸ºè¿è¡Œ/è°ƒè¯•é…ç½®çš„ classpathã€‚è¿™å°†ç¡®ä¿æ‰€æœ‰è¢«è®¾ç½®ä¸ºæä¾›çš„ä¾èµ–å…³ç³»åœ¨æ‰§è¡Œæ—¶éƒ½æ˜¯å¯ç”¨çš„ã€‚æ‚¨å¯ä»¥é€šè¿‡ Run -\u0026gt; Edit Configurations\u0026hellip;é…ç½® Run/Debug é…ç½®ï¼Œç„¶åä» Use classpath of module dropbox ä¸­é€‰æ‹© mainRunnerã€‚\nEclipse ä¸ºäº†å°†æ–°åˆ›å»ºçš„é¡¹ç›®å¯¼å…¥åˆ° Eclipse ä¸­ï¼Œé¦–å…ˆå¿…é¡»ä¸ºå…¶åˆ›å»º Eclipse é¡¹ç›®æ–‡ä»¶ã€‚è¿™äº›é¡¹ç›®æ–‡ä»¶å¯ä»¥é€šè¿‡ sbteclipse æ’ä»¶æ¥åˆ›å»ºã€‚åœ¨ PROJECT_DIR/project/plugins.sbt æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä¸€è¡Œã€‚\naddSbtPlugin(\u0026quot;com.typeafe.sbteclipse\u0026quot; % \u0026quot;sbteclipse-plugin\u0026quot; % \u0026quot;4.0.0\u0026quot;) åœ¨ sbt ä¸­ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥åˆ›å»º Eclipse é¡¹ç›®æ–‡ä»¶\n\u0026gt; eclipse ç°åœ¨ä½ å¯ä»¥é€šè¿‡ File-\u0026gt;Import\u0026hellip;-\u0026gt;Existing Projects into Workspace å¯¼å…¥ Eclipseï¼Œç„¶åé€‰æ‹©é¡¹ç›®ç›®å½•ã€‚\né™„å½•: ç”¨ä¾èµ–å…³ç³»æ„å»º Jar çš„æ¨¡æ¿ è¦æ„å»ºä¸€ä¸ªåŒ…å«å£°æ˜çš„è¿æ¥å™¨å’Œåº“æ‰€éœ€çš„æ‰€æœ‰ä¾èµ–å…³ç³»çš„åº”ç”¨ç¨‹åº JARï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ shade æ’ä»¶å®šä¹‰ã€‚\n\u0026lt;build\u0026gt; \u0026lt;plugins\u0026gt; \u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.apache.maven.plugins\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;maven-shade-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.1.1\u0026lt;/version\u0026gt; \u0026lt;executions\u0026gt; \u0026lt;execution\u0026gt; \u0026lt;phase\u0026gt;package\u0026lt;/phase\u0026gt; \u0026lt;goals\u0026gt; \u0026lt;goal\u0026gt;shade\u0026lt;/goal\u0026gt; \u0026lt;/goals\u0026gt; \u0026lt;configuration\u0026gt; \u0026lt;artifactSet\u0026gt; \u0026lt;excludes\u0026gt; \u0026lt;exclude\u0026gt;com.google.code.findbugs:jsr305\u0026lt;/exclude\u0026gt; \u0026lt;exclude\u0026gt;org.slf4j:*\u0026lt;/exclude\u0026gt; \u0026lt;exclude\u0026gt;log4j:*\u0026lt;/exclude\u0026gt; \u0026lt;/excludes\u0026gt; \u0026lt;/artifactSet\u0026gt; \u0026lt;filters\u0026gt; \u0026lt;filter\u0026gt; \u0026lt;!-- Do not copy the signatures in the META-INF folder. Otherwise, this might cause SecurityExceptions when using the JAR. --\u0026gt; \u0026lt;artifact\u0026gt;*:*\u0026lt;/artifact\u0026gt; \u0026lt;excludes\u0026gt; \u0026lt;exclude\u0026gt;META-INF/*.SF\u0026lt;/exclude\u0026gt; \u0026lt;exclude\u0026gt;META-INF/*.DSA\u0026lt;/exclude\u0026gt; \u0026lt;exclude\u0026gt;META-INF/*.RSA\u0026lt;/exclude\u0026gt; \u0026lt;/excludes\u0026gt; \u0026lt;/filter\u0026gt; \u0026lt;/filters\u0026gt; \u0026lt;transformers\u0026gt; \u0026lt;transformer implementation=\u0026#34;org.apache.maven.plugins.shade.resource.ManifestResourceTransformer\u0026#34;\u0026gt; \u0026lt;mainClass\u0026gt;my.programs.main.clazz\u0026lt;/mainClass\u0026gt; \u0026lt;/transformer\u0026gt; \u0026lt;/transformers\u0026gt; \u0026lt;/configuration\u0026gt; \u0026lt;/execution\u0026gt; \u0026lt;/executions\u0026gt; \u0026lt;/plugin\u0026gt; \u0026lt;/plugins\u0026gt; \u0026lt;/build\u0026gt; åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/project-configuration.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-22-project-configuration/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataStream API"],"title":"é¡¹ç›®é…ç½®"},{"categories":["programming"],"contents":"Event Time åœ¨æœ¬èŠ‚ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ç¼–å†™æ—¶é—´æ„ŸçŸ¥(time-aware)çš„ Flink ç¨‹åºã€‚è¯·çœ‹ä¸€ä¸‹åŠæ—¶æµå¤„ç†ï¼Œäº†è§£åŠæ—¶æµå¤„ç†èƒŒåçš„æ¦‚å¿µã€‚\nå…³äºå¦‚ä½•åœ¨ Flink ç¨‹åºä¸­ä½¿ç”¨æ—¶é—´çš„ä¿¡æ¯è¯·å‚è€ƒ windowing å’Œ ProcessFunctionã€‚\nä½¿ç”¨äº‹ä»¶æ—¶é—´å¤„ç†çš„å…ˆå†³æ¡ä»¶æ˜¯è®¾ç½®æ­£ç¡®çš„æ—¶é—´ç‰¹æ€§(time characteristic)ã€‚è¯¥è®¾ç½®å®šä¹‰äº†æ•°æ®æµæºçš„è¡Œä¸ºï¼ˆä¾‹å¦‚ï¼Œå®ƒä»¬æ˜¯å¦ä¼šåˆ†é…æ—¶é—´æˆ³ï¼‰ï¼Œä»¥åŠåƒ KeyedStream.timeWindow(Time.seconds(30)) è¿™æ ·çš„çª—å£æ“ä½œåº”è¯¥ä½¿ç”¨ä»€ä¹ˆæ—¶é—´æ¦‚å¿µã€‚\nä½ å¯ä»¥ä½¿ç”¨ StreamExecutionEnvironment.setStreamTimeCharacteristic() è®¾ç½®æ—¶é—´ç‰¹æ€§:\nval env = StreamExecutionEnvironment.getExecutionEnvironment env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime) val stream: DataStream[MyEvent] = env.addSource(new FlinkKafkaConsumer[MyEvent](topic, schema, props)) stream .keyBy( _.getUser ) .timeWindow(Time.hours(1)) .reduce( (a, b) =\u0026gt; a.add(b) ) .addSink(...) éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ºäº†åœ¨äº‹ä»¶æ—¶é—´(event time)ä¸­è¿è¡Œè¿™ä¸ªä¾‹å­ï¼Œç¨‹åºéœ€è¦ä½¿ç”¨ç›´æ¥ä¸ºæ•°æ®å®šä¹‰äº‹ä»¶æ—¶é—´å¹¶è‡ªå·±å‘å°„æ°´å°çš„æºï¼Œæˆ–è€…ç¨‹åºå¿…é¡»åœ¨æºä¹‹åæ³¨å…¥ä¸€ä¸ªæ—¶é—´æˆ³åˆ†é…å™¨(Timestamp Assigner)ä¸æ°´å°ç”Ÿæˆå™¨(Watermark Generator)ã€‚è¿™äº›å‡½æ•°æè¿°äº†å¦‚ä½•è®¿é—®äº‹ä»¶æ—¶é—´æˆ³ï¼Œä»¥åŠäº‹ä»¶æµè¡¨ç°å‡ºä½•ç§ç¨‹åº¦çš„æ— åºæ€§ã€‚\nä¸‹ä¸€æ­¥è¯¥æ€ä¹ˆèµ°ï¼Ÿ  ç”Ÿæˆæ°´å°ã€‚å±•ç¤ºäº†å¦‚ä½•ç¼–å†™æ—¶é—´æˆ³åˆ†é…å™¨å’Œæ°´å°ç”Ÿæˆå™¨ï¼Œè¿™äº›éƒ½æ˜¯äº‹ä»¶æ—¶é—´(event-time)æ„ŸçŸ¥ Flink åº”ç”¨æ‰€éœ€è¦çš„ã€‚ å†…ç½®çš„æ°´å°ç”Ÿæˆå™¨ã€‚æ¦‚è¿°äº†å†…ç½®çš„æ°´å°ç”Ÿæˆå™¨ã€‚ è°ƒè¯•çª—å£å’Œäº‹ä»¶æ—¶é—´ï¼šå±•ç¤ºå¦‚ä½•è°ƒè¯•äº‹ä»¶æ—¶é—´ Flink åº”ç”¨ç¨‹åºä¸­å›´ç»•æ°´å°å’Œæ—¶é—´æˆ³çš„é—®é¢˜ã€‚  ","permalink":"https://ohmyweekly.github.io/notes/2020-08-21-event-time/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataStream API"],"title":"Event Time"},{"categories":["programming"],"contents":"Flink DataStream API ç¼–ç¨‹æŒ‡å— Flink ä¸­çš„ DataStream ç¨‹åºæ˜¯å¯¹æ•°æ®æµå®ç°è½¬æ¢çš„å¸¸è§„ç¨‹åºï¼ˆå¦‚è¿‡æ»¤ã€æ›´æ–°çŠ¶æ€ã€å®šä¹‰çª—å£ã€èšåˆï¼‰ã€‚æ•°æ®æµæœ€åˆæ˜¯ç”±å„ç§æºï¼ˆå¦‚æ¶ˆæ¯é˜Ÿåˆ—ã€å¥—æ¥å­—æµã€æ–‡ä»¶ï¼‰åˆ›å»ºçš„ã€‚ç»“æœé€šè¿‡æ¥æ”¶å™¨(sink)è¿”å›ï¼Œä¾‹å¦‚å¯ä»¥å°†æ•°æ®å†™å…¥æ–‡ä»¶ï¼Œæˆ–æ ‡å‡†è¾“å‡ºï¼ˆä¾‹å¦‚å‘½ä»¤è¡Œç»ˆç«¯ï¼‰ã€‚Flink ç¨‹åºå¯ä»¥åœ¨å„ç§ç¯å¢ƒä¸‹è¿è¡Œï¼Œç‹¬ç«‹è¿è¡Œï¼Œæˆ–è€…åµŒå…¥åˆ°å…¶ä»–ç¨‹åºä¸­ã€‚æ‰§è¡Œå¯ä»¥å‘ç”Ÿåœ¨æœ¬åœ° JVM ä¸­ï¼Œä¹Ÿå¯ä»¥å‘ç”Ÿåœ¨è®¸å¤šæœºå™¨çš„é›†ç¾¤ä¸­ã€‚\nä¸ºäº†åˆ›å»ºä½ è‡ªå·±çš„ Flink DataStream ç¨‹åºï¼Œæˆ‘ä»¬é¼“åŠ±ä½ ä»ä¸€ä¸ª Flink ç¨‹åºçš„éª¨æ¶å¼€å§‹ï¼Œå¹¶é€æ­¥æ·»åŠ ä½ è‡ªå·±çš„æµè½¬æ¢ã€‚å…¶ä½™éƒ¨åˆ†ä½œä¸ºé¢å¤–æ“ä½œå’Œé«˜çº§åŠŸèƒ½çš„å‚è€ƒã€‚\nä»€ä¹ˆæ˜¯ DataStreamï¼Ÿ DataStream API çš„åå­—æ¥è‡ªäºç‰¹æ®Šçš„ DataStream ç±»ï¼Œå®ƒç”¨äºè¡¨ç¤º Flink ç¨‹åºä¸­çš„æ•°æ®é›†åˆã€‚ä½ å¯ä»¥æŠŠå®ƒä»¬çœ‹ä½œæ˜¯ä¸å¯æ”¹å˜çš„æ•°æ®é›†åˆï¼Œå¯ä»¥åŒ…å«é‡å¤çš„æ•°æ®ã€‚è¿™äº›æ•°æ®æ—¢å¯ä»¥æ˜¯æœ‰é™çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯æ— è¾¹ç•Œçš„ï¼Œä½ ç”¨æ¥å¤„ç†å®ƒä»¬çš„ API æ˜¯ä¸€æ ·çš„ã€‚\nDataStream åœ¨ç”¨æ³•ä¸Šä¸æ™®é€šçš„ Java Collection ç±»ä¼¼ï¼Œä½†åœ¨ä¸€äº›å…³é”®æ–¹é¢å´æœ‰å¾ˆå¤§ä¸åŒã€‚å®ƒä»¬æ˜¯ä¸å¯æ”¹å˜çš„ï¼Œè¿™æ„å‘³ç€ä¸€æ—¦å®ƒä»¬è¢«åˆ›å»ºï¼Œä½ å°±ä¸èƒ½æ·»åŠ æˆ–åˆ é™¤å…ƒç´ ã€‚ä½ ä¹Ÿä¸èƒ½ç®€å•åœ°æ£€æŸ¥é‡Œé¢çš„å…ƒç´ ï¼Œè€Œåªèƒ½ä½¿ç”¨ DataStream API æ“ä½œå¯¹å®ƒä»¬è¿›è¡Œæ“ä½œï¼Œè¿™ä¹Ÿè¢«ç§°ä¸ºè½¬æ¢ã€‚\nä½ å¯ä»¥é€šè¿‡åœ¨ Flink ç¨‹åºä¸­æ·»åŠ ä¸€ä¸ªæºæ¥åˆ›å»ºä¸€ä¸ªåˆå§‹çš„ DataStreamã€‚ç„¶åä½ å¯ä»¥ä»ä¸­æ´¾ç”Ÿæ–°çš„æµï¼Œå¹¶é€šè¿‡ä½¿ç”¨ API æ–¹æ³•ï¼Œå¦‚ mapã€filter ç­‰æ¥ç»„åˆå®ƒä»¬ã€‚\nFlink ç¨‹åºçš„éª¨æ¶ Flink ç¨‹åºçœ‹èµ·æ¥å°±åƒè½¬æ¢ DataStream çš„æ™®é€šç¨‹åºã€‚æ¯ä¸ªç¨‹åºç”±ç›¸åŒçš„åŸºæœ¬éƒ¨åˆ†ç»„æˆã€‚\n è·å–ä¸€ä¸ªæ‰§è¡Œç¯å¢ƒ åŠ è½½/åˆ›å»ºåˆå§‹æ•°æ®ã€‚ æŒ‡å®šè¯¥æ•°æ®çš„è½¬æ¢ã€‚ æŒ‡å®šè®¡ç®—ç»“æœçš„ä½ç½®ã€‚ è§¦å‘ç¨‹åºæ‰§è¡Œ  ç°åœ¨æˆ‘ä»¬å°†å¯¹å…¶ä¸­çš„æ¯ä¸€ä¸ªæ­¥éª¤è¿›è¡Œæ¦‚è¿°ï¼Œæ›´å¤šç»†èŠ‚è¯·å‚è€ƒç›¸å…³ç« èŠ‚ã€‚æ³¨æ„ï¼ŒScala DataStream API çš„æ‰€æœ‰æ ¸å¿ƒç±»éƒ½å¯ä»¥åœ¨ org.apache.flink.stream.api.scala ä¸­æ‰¾åˆ°ã€‚\nStreamExecutionEnvironment æ˜¯æ‰€æœ‰ Flink ç¨‹åºçš„åŸºç¡€ã€‚ä½ å¯ä»¥ä½¿ç”¨ StreamExecutionEnvironment ä¸Šçš„è¿™äº›é™æ€æ–¹æ³•è·å¾—ä¸€ä¸ªã€‚\ngetExecutionEnvironment() createLocalEnvironment() createRemoteEnvironment(host: String, port: Int, jarFiles: String*) é€šå¸¸æƒ…å†µä¸‹ï¼Œä½ åªéœ€è¦ä½¿ç”¨ getExecutionEnvironment()ï¼Œå› ä¸ºè¿™å°†æ ¹æ®ä¸Šä¸‹æ–‡åšæ­£ç¡®çš„äº‹æƒ…ï¼šå¦‚æœä½ åœ¨ IDE é‡Œé¢æ‰§è¡Œä½ çš„ç¨‹åºï¼Œæˆ–è€…ä½œä¸ºä¸€ä¸ªæ™®é€šçš„ Java ç¨‹åºï¼Œå®ƒå°†åˆ›å»ºä¸€ä¸ªæœ¬åœ°ç¯å¢ƒï¼Œåœ¨ä½ çš„æœ¬åœ°æœºå™¨ä¸Šæ‰§è¡Œä½ çš„ç¨‹åºã€‚å¦‚æœä½ ä»ä½ çš„ç¨‹åºä¸­åˆ›å»ºäº†ä¸€ä¸ª JAR æ–‡ä»¶ï¼Œå¹¶é€šè¿‡å‘½ä»¤è¡Œè°ƒç”¨å®ƒï¼ŒFlink é›†ç¾¤ç®¡ç†å™¨å°†æ‰§è¡Œä½ çš„ä¸»æ–¹æ³•ï¼Œå¹¶ä¸” getExecutionEnvironment() å°†è¿”å›ä¸€ä¸ªåœ¨é›†ç¾¤ä¸Šæ‰§è¡Œä½ çš„ç¨‹åºçš„æ‰§è¡Œç¯å¢ƒã€‚\nå¯¹äºæŒ‡å®šæ•°æ®æºï¼Œæ‰§è¡Œç¯å¢ƒæœ‰å‡ ç§æ–¹æ³•å¯ä»¥ä½¿ç”¨ä¸åŒçš„æ–¹æ³•ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ï¼šä½ å¯ä»¥åªæ˜¯é€è¡Œè¯»å–ï¼Œä½œä¸º CSV æ–‡ä»¶ï¼Œæˆ–è€…ä½¿ç”¨ä»»ä½•å…¶ä»–æä¾›çš„æ•°æ®æºã€‚å¦‚æœåªæ˜¯å°†æ–‡æœ¬æ–‡ä»¶ä½œä¸ºä¸€ä¸ªè¡Œçš„åºåˆ—æ¥è¯»å–ï¼Œä½ å¯ä»¥ä½¿ç”¨ã€‚\nval env = StreamExecutionEnvironment.getExecutionEnvironment() val text: DataStream[String] = env.readTextFile(\u0026#34;file:///path/to/file\u0026#34;) è¿™å°†ä¸ºæ‚¨æä¾›ä¸€ä¸ª DataStreamï¼Œç„¶åæ‚¨å¯ä»¥åœ¨å…¶ä¸Šåº”ç”¨è½¬æ¢æ¥åˆ›å»ºæ–°çš„æ´¾ç”Ÿ DataStreamã€‚\nä½ å¯ä»¥é€šè¿‡è°ƒç”¨ DataStream ä¸Šçš„æ–¹æ³•å’Œè½¬æ¢å‡½æ•°æ¥åº”ç”¨è½¬æ¢ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª map è½¬æ¢çœ‹èµ·æ¥åƒè¿™æ ·ã€‚\nval input: DataSet[String] = ... val mapped = input.map { x =\u0026gt; x.toInt } è¿™å°†é€šè¿‡å°†åŸå§‹é›†åˆä¸­çš„æ¯ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ª Integer æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ DataStreamã€‚\nä¸€æ—¦ä½ æœ‰äº†ä¸€ä¸ªåŒ…å«æœ€ç»ˆç»“æœçš„ DataStreamï¼Œä½ å°±å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªæ¥æ”¶å™¨(sink)å°†å…¶å†™å…¥å¤–éƒ¨ç³»ç»Ÿã€‚è¿™äº›åªæ˜¯åˆ›å»ºæ¥æ”¶å™¨çš„ä¸€äº›ç¤ºä¾‹æ–¹æ³•ã€‚\nwriteAsText(path: String) print() ä¸€æ—¦ä½ æŒ‡å®šäº†å®Œæ•´çš„ç¨‹åºï¼Œä½ éœ€è¦é€šè¿‡è°ƒç”¨ StreamExecutionEnvironment ä¸Šçš„ execution() æ¥è§¦å‘ç¨‹åºçš„æ‰§è¡Œã€‚æ ¹æ® ExecutionEnvironment çš„ç±»å‹ï¼Œå°†åœ¨ä½ çš„æœ¬åœ°æœºå™¨ä¸Šè§¦å‘æ‰§è¡Œï¼Œæˆ–è€…å°†ä½ çš„ç¨‹åºæäº¤åˆ°é›†ç¾¤ä¸Šæ‰§è¡Œã€‚\nexecute() æ–¹æ³•å°†ç­‰å¾…ä½œä¸šå®Œæˆï¼Œç„¶åè¿”å›ä¸€ä¸ª JobExecutionResultï¼Œè¿™ä¸ªåŒ…å«æ‰§è¡Œæ—¶é—´å’Œç´¯åŠ å™¨ç»“æœã€‚\nå¦‚æœä½ ä¸æƒ³ç­‰å¾…ä½œä¸šå®Œæˆï¼Œä½ å¯ä»¥åœ¨ StreamExecutionEnvironment ä¸Šè°ƒç”¨ executeAysnc() æ¥è§¦å‘å¼‚æ­¥ä½œä¸šæ‰§è¡Œã€‚å®ƒå°†è¿”å›ä¸€ä¸ª JobClientï¼Œä½ å¯ä»¥ç”¨å®ƒä¸åˆšåˆšæäº¤çš„ä½œä¸šè¿›è¡Œé€šä¿¡ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯å¦‚ä½•é€šè¿‡ä½¿ç”¨ executeAsync() æ¥å®ç° execute() çš„è¯­ä¹‰ã€‚\nfinal JobClient jobClient = env.executeAsync(); final JobExecutionResult jobExecutionResult = jobClient.getJobExecutionResult(userClassloader).get(); æœ€åè¿™éƒ¨åˆ†å…³äºç¨‹åºæ‰§è¡Œçš„å†…å®¹å¯¹äºç†è§£ Flink æ“ä½œä½•æ—¶ä»¥åŠå¦‚ä½•æ‰§è¡Œè‡³å…³é‡è¦ã€‚æ‰€æœ‰çš„ Flink ç¨‹åºéƒ½æ˜¯æ‡’æƒ°åœ°æ‰§è¡Œçš„ã€‚å½“ç¨‹åºçš„ä¸»æ–¹æ³•è¢«æ‰§è¡Œæ—¶ï¼Œæ•°æ®åŠ è½½å’Œè½¬æ¢ä¸ä¼šç›´æ¥å‘ç”Ÿã€‚ç›¸åï¼Œæ¯ä¸ªæ“ä½œéƒ½è¢«åˆ›å»ºå¹¶æ·»åŠ åˆ°ä¸€ä¸ªæ•°æ®æµå›¾(dataflow graph)ä¸­ã€‚å½“æ‰§è¡Œç¯å¢ƒä¸Šçš„ execute() è°ƒç”¨æ˜ç¡®è§¦å‘æ‰§è¡Œæ—¶ï¼Œè¿™äº›æ“ä½œæ‰ä¼šè¢«å®é™…æ‰§è¡Œã€‚ç¨‹åºæ˜¯åœ¨æœ¬åœ°æ‰§è¡Œè¿˜æ˜¯åœ¨é›†ç¾¤ä¸Šæ‰§è¡Œï¼Œå–å†³äºæ‰§è¡Œç¯å¢ƒçš„ç±»å‹\næƒ°æ€§æ±‚å€¼å¯ä»¥è®©æ‚¨æ„å»ºå¤æ‚çš„ç¨‹åºï¼ŒFlink ä½œä¸ºä¸€ä¸ªæ•´ä½“è§„åˆ’çš„å•å…ƒæ¥æ‰§è¡Œã€‚\nç¤ºä¾‹ç¨‹åº ä¸‹é¢çš„ç¨‹åºæ˜¯ä¸€ä¸ªå®Œæ•´çš„ï¼Œå·¥ä½œçš„æµåª’ä½“çª—å£å•è¯è®¡æ•°åº”ç”¨ç¨‹åºçš„ä¾‹å­ï¼Œå®ƒå¯ä»¥åœ¨5ç§’çš„çª—å£ä¸­è®¡ç®—æ¥è‡ª Web Socket çš„å•è¯ã€‚ä½ å¯ä»¥å¤åˆ¶å’Œç²˜è´´ä»£ç åœ¨æœ¬åœ°è¿è¡Œå®ƒã€‚\nimport org.apache.flink.streaming.api.scala._ import org.apache.flink.streaming.api.windowing.time.Time object WindowWordCount { def main(args: Array[String]) { val env = StreamExecutionEnvironment.getExecutionEnvironment val text = env.socketTextStream(\u0026#34;localhost\u0026#34;, 9999) val counts = text.flatMap { _.toLowerCase.split(\u0026#34;\\\\W+\u0026#34;) filter { _.nonEmpty } } .map { (_, 1) } .keyBy(0) .timeWindow(Time.seconds(5)) .sum(1) counts.print() env.execute(\u0026#34;Window Stream WordCount\u0026#34;) } } To run the example program, start the input stream with netcat first from a terminal:\nnc -lk 9999 åªéœ€è¾“å…¥ä¸€äº›å•è¯ï¼ŒæŒ‰å›è½¦é”®è¾“å…¥ä¸€ä¸ªæ–°å•è¯ã€‚è¿™äº›è¯å°†è¢«è¾“å…¥åˆ°å•è¯è®¡æ•°ç¨‹åºä¸­ã€‚å¦‚æœä½ æƒ³çœ‹åˆ°å¤§äº1çš„è®¡æ•°ï¼Œè¯·åœ¨5ç§’å†…åå¤è¾“å…¥åŒä¸€ä¸ªå•è¯ï¼ˆå¦‚æœä½ æ‰“å­—æ²¡é‚£ä¹ˆå¿«ï¼Œè¯·ä»5ç§’å¼€å§‹å¢åŠ çª—å£å¤§å°â˜ºï¼‰ã€‚\næ•°æ®æº æºæ˜¯ä½ çš„ç¨‹åºè¯»å–å…¶è¾“å…¥çš„åœ°æ–¹ã€‚ä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ StreamExecutionEnvironment.addSource(sourceFunction) å°†ä¸€ä¸ªæºé™„åŠ åˆ°ä½ çš„ç¨‹åºä¸­ã€‚Flink æä¾›äº†è®¸å¤šé¢„å…ˆå®ç°çš„ SourceFunctionï¼Œä½†æ˜¯ä½ å¯ä»¥é€šè¿‡å®ç°éå¹¶è¡Œæºçš„ SourceFunctionï¼Œæˆ–è€…å®ç°å¹¶è¡Œæºçš„ ParallelSourceFunction æ¥å£æˆ–æ‰©å±• RichParallelSourceFunction æ¥ç¼–å†™è‡ªå·±çš„è‡ªå®šä¹‰æºã€‚\næœ‰å‡ ç§é¢„å®šä¹‰çš„æµæº(stream sources)å¯ä»¥ä» StreamExecutionEnvironment ä¸­è®¿é—®ã€‚\nåŸºäºæ–‡ä»¶çš„ã€‚\n  readTextFile(path) - é€è¡Œè¯»å–æ–‡æœ¬æ–‡ä»¶ï¼Œå³éµå¾ª TextInputFormat è§„èŒƒçš„æ–‡ä»¶ï¼Œå¹¶å°†å…¶ä½œä¸ºå­—ç¬¦ä¸²è¿”å›ã€‚\n  readFile(fileInputFormat, path) - æ ¹æ®æŒ‡å®šçš„æ–‡ä»¶è¾“å…¥æ ¼å¼è¯»å–ï¼ˆä¸€æ¬¡ï¼‰æ–‡ä»¶ã€‚\n  readFile(fileInputFormat, path, watchType, interval, pathFilter) - è¿™æ˜¯å‰é¢ä¸¤ä¸ªæ–¹æ³•å†…éƒ¨è°ƒç”¨çš„æ–¹æ³•ã€‚å®ƒæ ¹æ®ç»™å®šçš„ fileInputFormat è¯»å–è·¯å¾„ä¸­çš„æ–‡ä»¶ã€‚æ ¹æ®æ‰€æä¾›çš„ watchTypeï¼Œè¿™ä¸ªæºå¯èƒ½ä¼šå‘¨æœŸæ€§åœ°ç›‘è§†(æ¯éš” interval æ¯«ç§’)è·¯å¾„ä¸­çš„æ–°æ•°æ®(FileProcessingMode.PROCESS_CONTINUOUSLY)ï¼Œæˆ–è€…å¤„ç†ä¸€æ¬¡å½“å‰è·¯å¾„ä¸­çš„æ•°æ®å¹¶é€€å‡º(FileProcessingMode.PROCESS_ONCE)ã€‚ä½¿ç”¨ pathFilterï¼Œç”¨æˆ·å¯ä»¥è¿›ä¸€æ­¥æ’é™¤è¢«å¤„ç†çš„æ–‡ä»¶ã€‚\n  å®ç°:\nåœ¨åº•å±‚ä¸‹ï¼ŒFlink å°†æ–‡ä»¶è¯»å–è¿‡ç¨‹åˆ†æˆä¸¤ä¸ªå­ä»»åŠ¡(sub-tasks)ï¼Œå³ç›®å½•ç›‘æ§å’Œæ•°æ®è¯»å–ã€‚è¿™äº›å­ä»»åŠ¡ä¸­çš„æ¯ä¸€ä¸ªéƒ½æ˜¯ç”±ä¸€ä¸ªå•ç‹¬çš„å®ä½“å®ç°çš„ã€‚ç›‘æ§ç”±ä¸€ä¸ªå•ä¸€çš„ã€éå¹¶è¡Œï¼ˆå¹¶è¡Œåº¦=1ï¼‰çš„ä»»åŠ¡å®ç°ï¼Œè€Œè¯»å–åˆ™ç”±å¤šä¸ªä»»åŠ¡(task)å¹¶è¡Œè¿è¡Œã€‚åè€…çš„å¹¶è¡Œåº¦ç­‰äºä½œä¸šçš„å¹¶è¡Œåº¦(job parallelism)ã€‚å•ä¸ªç›‘æ§ä»»åŠ¡çš„ä½œç”¨æ˜¯æ‰«æç›®å½•ï¼ˆæ ¹æ® watchType çš„ä¸åŒï¼Œå®šæœŸæˆ–åªæ‰«æä¸€æ¬¡ï¼‰ï¼Œæ‰¾åˆ°è¦å¤„ç†çš„æ–‡ä»¶ï¼Œå°†å…¶åˆ†å‰²ï¼Œå¹¶å°†è¿™äº›åˆ†å‰²çš„æ–‡ä»¶åˆ†é…ç»™ä¸‹æ¸¸çš„è¯»å–å™¨ã€‚è¯»å–å™¨æ˜¯é‚£äº›å°†è¯»å–å®é™…æ•°æ®çš„ä¸œè¥¿ã€‚æ¯ä¸ªåˆ†ç‰‡åªèƒ½ç”±ä¸€ä¸ªè¯»å–å™¨è¯»å–ï¼Œè€Œä¸€ä¸ªè¯»å–å™¨å¯ä»¥è¯»å–å¤šä¸ªåˆ†ç‰‡ï¼Œä¸€ä¸ªæ¥ä¸€ä¸ªã€‚\né‡è¦æç¤º:\n  å¦‚æœ watchType è¢«è®¾ç½®ä¸º FileProcessingMode.PROCESS_CONTINUOUSLYï¼Œå½“ä¸€ä¸ªæ–‡ä»¶è¢«ä¿®æ”¹æ—¶ï¼Œå®ƒçš„å†…å®¹ä¼šè¢«å®Œå…¨é‡æ–°å¤„ç†ã€‚è¿™å¯èƒ½ä¼šæ‰“ç ´\u0026quot;ç²¾ç¡®åœ°ä¸€æ¬¡\u0026quot;(exactly-once)çš„è¯­ä¹‰ï¼Œå› ä¸ºåœ¨æ–‡ä»¶æœ«å°¾è¿½åŠ æ•°æ®ä¼šå¯¼è‡´å…¶æ‰€æœ‰å†…å®¹è¢«é‡æ–°å¤„ç†ã€‚\n  å¦‚æœ watchType è¢«è®¾ç½®ä¸º FileProcessingMode.PROCESS_ONCEï¼Œé‚£ä¹ˆæºå°±ä¼šå¯¹è·¯å¾„æ‰«æä¸€æ¬¡å¹¶é€€å‡ºï¼Œè€Œä¸ä¼šç­‰å¾…è¯»å–å™¨å®Œæˆå¯¹æ–‡ä»¶å†…å®¹çš„è¯»å–ã€‚å½“ç„¶ï¼Œè¯»å–å™¨ä¼šç»§ç»­è¯»å–ï¼Œç›´åˆ°è¯»å–å®Œæ‰€æœ‰æ–‡ä»¶å†…å®¹ã€‚å…³é—­æºä¼šå¯¼è‡´åœ¨è¿™ä¹‹åä¸å†æœ‰æ£€æŸ¥ç‚¹ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´èŠ‚ç‚¹æ•…éšœåçš„æ¢å¤é€Ÿåº¦å˜æ…¢ï¼Œå› ä¸ºä½œä¸š(job)å°†ä»æœ€åä¸€ä¸ªæ£€æŸ¥ç‚¹å¼€å§‹æ¢å¤è¯»å–ã€‚\n  åŸºäº Socket çš„:\n socketTextStream - ä»å¥—æ¥å­—è¯»å–ã€‚å…ƒç´ å¯ä»¥ç”¨å®šç•Œç¬¦åˆ†å¼€ã€‚  åŸºäºé›†åˆçš„:\n  fromCollection(Seq) - ä» Java Java.util.Collection ä¸­åˆ›å»ºæ•°æ®æµã€‚é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ å¿…é¡»æ˜¯ç›¸åŒçš„ç±»å‹ã€‚\n  fromCollection(Iterator) - ä»è¿­ä»£å™¨ä¸­åˆ›å»ºä¸€ä¸ªæ•°æ®æµã€‚è¯¥ç±»æŒ‡å®šè¿­ä»£å™¨è¿”å›çš„å…ƒç´ çš„æ•°æ®ç±»å‹ã€‚\n  fromElements(elements: _*) - ä»ç»™å®šçš„å¯¹è±¡åºåˆ—ä¸­åˆ›å»ºä¸€ä¸ªæ•°æ®æµã€‚æ‰€æœ‰å¯¹è±¡å¿…é¡»æ˜¯ç›¸åŒçš„ç±»å‹ã€‚\n  fromParallelCollection(SplittableIterator) - ä»è¿­ä»£å™¨ä¸­å¹¶è¡Œåˆ›å»ºæ•°æ®æµã€‚è¯¥ç±»æŒ‡å®šäº†è¿­ä»£å™¨è¿”å›çš„å…ƒç´ çš„æ•°æ®ç±»å‹ã€‚\n  generateSequence(from, to) - åœ¨ç»™å®šçš„åŒºé—´å†…å¹¶è¡Œç”Ÿæˆæ•°å­—åºåˆ—ã€‚\n  è‡ªå®šä¹‰çš„:\n addSource - é™„åŠ ä¸€ä¸ªæ–°çš„æºå‡½æ•°ã€‚ä¾‹å¦‚ï¼Œè¦ä» Apache Kafka è¯»å–æ•°æ®ï¼Œä½ å¯ä»¥ä½¿ç”¨ addSource(new FlinkKafkaConsumer010\u0026lt;\u0026gt;(...))ã€‚æ›´å¤šç»†èŠ‚è¯·å‚è§è¿æ¥å™¨ã€‚  æ•°æ®æµè½¬æ¢ è¯·å‚é˜… operators ä»¥äº†è§£å¯ç”¨çš„æµè½¬æ¢çš„æ¦‚è¿°ã€‚\næ•°æ®æ¥æ”¶å™¨ æ•°æ®æ¥æ”¶å™¨æ¶ˆè€— DataStreamï¼Œå¹¶å°†å…¶è½¬å‘åˆ°æ–‡ä»¶ã€å¥—æ¥å­—ã€å¤–éƒ¨ç³»ç»Ÿæˆ–æ‰“å°ã€‚Flink å¸¦æœ‰å„ç§å†…ç½®çš„è¾“å‡ºæ ¼å¼ï¼Œè¿™äº›æ ¼å¼è¢«å°è£…åœ¨ DataStream çš„æ“ä½œåé¢ã€‚\n  writeAsText() / TextOutputFormat - å°†å…ƒç´ é€è¡Œå†™å…¥å­—ç¬¦ä¸²ã€‚è¿™äº›å­—ç¬¦ä¸²æ˜¯é€šè¿‡è°ƒç”¨æ¯ä¸ªå…ƒç´ çš„ toString() æ–¹æ³•è·å¾—çš„ã€‚\n  writeAsCsv(...) / CsvOutputFormat - å°†å…ƒç»„å†™æˆé€—å·åˆ†éš”çš„å€¼æ–‡ä»¶ã€‚è¡Œå’Œå­—æ®µå®šç•Œç¬¦æ˜¯å¯é…ç½®çš„ã€‚æ¯ä¸ªå­—æ®µçš„å€¼æ¥è‡ªå¯¹è±¡çš„ toString() æ–¹æ³•ã€‚\n  print() / printToErr() - å°†æ¯ä¸ªå…ƒç´ çš„ toString() å€¼æ‰“å°åœ¨æ ‡å‡†è¾“å‡º/æ ‡å‡†é”™è¯¯æµä¸Šã€‚å¯ä»¥é€‰æ‹©æä¾›ä¸€ä¸ªå‰ç¼€(msg)ï¼Œè¿™ä¸ªå‰ç¼€è¢«æ·»åŠ åˆ°è¾“å‡ºä¸­ã€‚è¿™å¯ä»¥å¸®åŠ©åŒºåˆ†ä¸åŒçš„ print è°ƒç”¨ã€‚å¦‚æœå¹¶è¡Œåº¦å¤§äº1ï¼Œè¾“å‡ºä¹Ÿå°†è¢«é¢„ç½®ä¸ºäº§ç”Ÿè¾“å‡ºçš„ä»»åŠ¡(task)çš„æ ‡è¯†ç¬¦ã€‚\n  writeUsingOutputFormat() / FileOutputFormat - ç”¨äºè‡ªå®šä¹‰æ–‡ä»¶è¾“å‡ºçš„æ–¹æ³•å’ŒåŸºç±»ã€‚æ”¯æŒè‡ªå®šä¹‰å¯¹è±¡åˆ°å­—èŠ‚çš„è½¬æ¢ã€‚\n  writeToSocket - æ ¹æ® SerializationSchema å°†å…ƒç´ å†™å…¥ socketã€‚\n  addSink - è°ƒç”¨ä¸€ä¸ªè‡ªå®šä¹‰çš„ sink å‡½æ•°ã€‚Flink æ†ç»‘äº†è¿æ¥å…¶ä»–ç³»ç»Ÿï¼ˆå¦‚ Apache Kafkaï¼‰çš„è¿æ¥å™¨ï¼Œè¿™äº›è¿æ¥å™¨è¢«å®ç°ä¸º sink å‡½æ•°ã€‚\n  è¯·æ³¨æ„ï¼ŒDataStream ä¸Šçš„ write*() æ–¹æ³•ä¸»è¦æ˜¯ä¸ºäº†è°ƒè¯•çš„ç›®çš„ã€‚å®ƒä»¬ä¸å‚ä¸ Flink çš„æ£€æŸ¥ç‚¹ï¼Œè¿™æ„å‘³ç€è¿™äº›å‡½æ•°é€šå¸¸å…·æœ‰æœ€å¤šä¸€æ¬¡(at-least-once)çš„è¯­ä¹‰ã€‚æ•°æ®å†²æ´—åˆ°ç›®æ ‡ç³»ç»Ÿå–å†³äº OutputFormat çš„å®ç°ã€‚è¿™æ„å‘³ç€å¹¶éæ‰€æœ‰å‘é€åˆ° OutputFormat çš„å…ƒç´ éƒ½ä¼šç«‹å³åœ¨ç›®æ ‡ç³»ç»Ÿä¸­æ˜¾ç¤ºå‡ºæ¥ã€‚å¦å¤–ï¼Œåœ¨å¤±è´¥çš„æƒ…å†µä¸‹ï¼Œè¿™äº›è®°å½•å¯èƒ½ä¼šä¸¢å¤±ã€‚\nä¸ºäº†å¯é åœ°ã€ç²¾ç¡®åœ°ä¸€æ¬¡æ€§å°†æµä¼ é€åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œè¯·ä½¿ç”¨ flink-connector-filesystemã€‚æ­¤å¤–ï¼Œé€šè¿‡ .addSink(...) æ–¹æ³•çš„è‡ªå®šä¹‰å®ç°å¯ä»¥å‚ä¸ Flink çš„æ£€æŸ¥ç‚¹ï¼Œä»¥å®ç°ç²¾ç¡®çš„ä¸€æ¬¡è¯­ä¹‰ã€‚\nè¿­ä»£ è¿­ä»£æµç¨‹åºå®ç°äº†ä¸€ä¸ªæ­¥éª¤å‡½æ•°ï¼Œå¹¶å°†å…¶åµŒå…¥åˆ° IterativeStream ä¸­ã€‚ç”±äº DataStream ç¨‹åºå¯èƒ½æ°¸è¿œä¸ä¼šç»“æŸï¼Œæ‰€ä»¥æ²¡æœ‰æœ€å¤§çš„è¿­ä»£æ¬¡æ•°ã€‚ç›¸åï¼Œä½ éœ€è¦æŒ‡å®šæµçš„å“ªä¸€éƒ¨åˆ†è¢«é¦ˆå…¥åˆ°è¿­ä»£ä¸­ï¼Œå“ªä¸€éƒ¨åˆ†ä½¿ç”¨ split è½¬æ¢æˆ– filter è½¬å‘åˆ°ä¸‹æ¸¸ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å±•ç¤ºäº†ä¸€ä¸ªè¿­ä»£çš„ä¾‹å­ï¼Œå…¶ä¸­ä¸»ä½“ï¼ˆé‡å¤è®¡ç®—çš„éƒ¨åˆ†ï¼‰æ˜¯ä¸€ä¸ªç®€å•çš„ map è½¬æ¢ï¼Œè€Œåé¦ˆå›æ¥çš„å…ƒç´ æ˜¯é€šè¿‡ä½¿ç”¨ filter è½¬å‘åˆ°ä¸‹æ¸¸çš„å…ƒç´ æ¥åŒºåˆ†çš„ã€‚\nval iteratedStream = someDataStream.iterate( iteration =\u0026gt; { val iterationBody = iteration.map(/* this is executed many times */) (iterationBody.filter(/* one part of the stream */), iterationBody.filter(/* some other part of the stream */)) }) ä¾‹å¦‚ï¼Œè¿™é‡Œçš„ç¨‹åºæ˜¯ä»ä¸€ç³»åˆ—æ•´æ•°ä¸­è¿ç»­å‡å»1ï¼Œç›´åˆ°å®ƒä»¬è¾¾åˆ°é›¶ã€‚\nval someIntegers: DataStream[Long] = env.generateSequence(0, 1000) val iteratedStream = someIntegers.iterate( iteration =\u0026gt; { val minusOne = iteration.map( v =\u0026gt; v - 1) val stillGreaterThanZero = minusOne.filter (_ \u0026gt; 0) val lessThanZero = minusOne.filter(_ \u0026lt;= 0) (stillGreaterThanZero, lessThanZero) } ) æ‰§è¡Œå‚æ•° StreamExecutionEnvironment åŒ…å«äº† ExecutionConfigï¼Œå®ƒå…è®¸ä¸ºè¿è¡Œæ—¶è®¾ç½®ä½œä¸šç‰¹å®š(job specific)çš„é…ç½®å€¼ã€‚\nè¯·å‚è€ƒæ‰§è¡Œé…ç½®ï¼Œäº†è§£å¤§å¤šæ•°å‚æ•°çš„è§£é‡Šã€‚è¿™äº›å‚æ•°ä¸“é—¨ä¸ DataStream API æœ‰å…³ã€‚\n setAutoWatermarkInterval(long milliseconds): è®¾ç½®è‡ªåŠ¨å‘å°„æ°´å°çš„æ—¶é—´é—´éš”ã€‚ä½ å¯ä»¥é€šè¿‡ long getAutoWatermarkInterval() æ¥è·å–å½“å‰å€¼ã€‚  å®¹é”™ çŠ¶æ€å’Œæ£€æŸ¥ç‚¹ä»‹ç»äº†å¦‚ä½•å¯ç”¨å’Œé…ç½® Flink çš„æ£€æŸ¥ç‚¹æœºåˆ¶ã€‚\næ§åˆ¶å»¶è¿Ÿ é»˜è®¤æƒ…å†µä¸‹ï¼Œå…ƒç´ ä¸ä¼šåœ¨ç½‘ç»œä¸Šé€ä¸€ä¼ è¾“ï¼ˆä¼šé€ æˆä¸å¿…è¦çš„ç½‘ç»œæµé‡ï¼‰ï¼Œè€Œæ˜¯è¢«ç¼“å†²ã€‚ç¼“å†²åŒºï¼ˆå®é™…åœ¨æœºå™¨ä¹‹é—´ä¼ è¾“ï¼‰çš„å¤§å°å¯ä»¥åœ¨ Flink é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ã€‚è™½ç„¶è¿™ç§æ–¹æ³•æœ‰åˆ©äºä¼˜åŒ–ååé‡ï¼Œä½†å½“ä¼ å…¥çš„æ•°æ®æµé€Ÿåº¦ä¸å¤Ÿå¿«æ—¶ï¼Œä¼šé€ æˆå»¶è¿Ÿé—®é¢˜ã€‚ä¸ºäº†æ§åˆ¶ååé‡å’Œå»¶è¿Ÿï¼Œä½ å¯ä»¥åœ¨æ‰§è¡Œç¯å¢ƒä¸Šï¼ˆæˆ–è€…åœ¨å•ä¸ª operator ä¸Šï¼‰ä½¿ç”¨ env.setBufferTimeout(timeoutMillis) æ¥è®¾ç½®ç¼“å†²åŒºå¡«æ»¡çš„æœ€å¤§ç­‰å¾…æ—¶é—´ã€‚è¿‡äº†è¿™ä¸ªæ—¶é—´ï¼Œå³ä½¿ç¼“å†²åŒºæ²¡æœ‰æ»¡ï¼Œä¹Ÿä¼šè‡ªåŠ¨å‘é€ã€‚è¯¥è¶…æ—¶çš„é»˜è®¤å€¼ä¸º 100 msã€‚\nä½¿ç”¨æ–¹æ³•:\nval env: LocalStreamEnvironment = StreamExecutionEnvironment.createLocalEnvironment env.setBufferTimeout(timeoutMillis) env.generateSequence(1,10).map(myMap).setBufferTimeout(timeoutMillis) ä¸ºäº†æœ€å¤§é™åº¦åœ°æé«˜ååé‡ï¼Œè®¾ç½® setBufferTimeout(-1)ï¼Œè¿™å°†æ¶ˆé™¤è¶…æ—¶ï¼Œç¼“å†²åŒºåªæœ‰åœ¨æ»¡æ—¶æ‰ä¼šè¢«åˆ·æ–°ã€‚ä¸ºäº†æœ€å¤§é™åº¦åœ°å‡å°‘å»¶è¿Ÿï¼Œå°†è¶…æ—¶è®¾ç½®ä¸ºæ¥è¿‘0çš„å€¼ï¼ˆä¾‹å¦‚5æˆ–10æ¯«ç§’ï¼‰ã€‚åº”è¯¥é¿å…ç¼“å†²åŒºè¶…æ—¶ä¸º0ï¼Œå› ä¸ºå®ƒä¼šå¯¼è‡´ä¸¥é‡çš„æ€§èƒ½ä¸‹é™ã€‚\nè°ƒè¯• åœ¨åˆ†å¸ƒå¼é›†ç¾¤ä¸­è¿è¡Œä¸€ä¸ªæµç¨‹åºä¹‹å‰ï¼Œæœ€å¥½å…ˆç¡®ä¿å®ç°çš„ç®—æ³•èƒ½å¤ŸæŒ‰ç…§é¢„æœŸçš„æ–¹å¼è¿è¡Œã€‚å› æ­¤ï¼Œå®ç°æ•°æ®åˆ†æç¨‹åºé€šå¸¸æ˜¯ä¸€ä¸ªæ£€æŸ¥ç»“æœã€è°ƒè¯•å’Œæ”¹è¿›çš„æ¸è¿›è¿‡ç¨‹ã€‚\nFlink æä¾›äº†ä¸€äº›åŠŸèƒ½ï¼Œé€šè¿‡æ”¯æŒ IDE å†…çš„æœ¬åœ°è°ƒè¯•ã€æµ‹è¯•æ•°æ®çš„æ³¨å…¥å’Œç»“æœæ•°æ®çš„æ”¶é›†ï¼Œå¤§å¤§ç®€åŒ–äº†æ•°æ®åˆ†æç¨‹åºçš„å¼€å‘è¿‡ç¨‹ã€‚æœ¬èŠ‚ç»™å‡ºä¸€äº›æç¤ºï¼Œå¦‚ä½•ç®€åŒ– Flink ç¨‹åºçš„å¼€å‘ã€‚\næœ¬åœ°æ‰§è¡Œç¯å¢ƒ LocalStreamEnvironment åœ¨å®ƒåˆ›å»ºçš„åŒä¸€ä¸ª JVM è¿›ç¨‹ä¸­å¯åŠ¨ Flink ç³»ç»Ÿã€‚å¦‚æœä½ ä» IDE ä¸­å¯åŠ¨ LocalEnvironmentï¼Œä½ å¯ä»¥åœ¨ä»£ç ä¸­è®¾ç½®æ–­ç‚¹ï¼Œè½»æ¾è°ƒè¯•ä½ çš„ç¨‹åºã€‚\nLocalEnvironment çš„åˆ›å»ºå’Œä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ã€‚\nval env = StreamExecutionEnvironment.createLocalEnvironment() val lines = env.addSource(/* some source */) // build your program  env.execute() æ”¶é›†æ•°æ®æº Flink æä¾›äº†ç‰¹æ®Šçš„æ•°æ®æºï¼Œè¿™äº›æ•°æ®æºç”± Java é›†åˆæ”¯æŒï¼Œä»¥æ–¹ä¾¿æµ‹è¯•ã€‚ä¸€æ—¦ç¨‹åºè¢«æµ‹è¯•ï¼Œæºå’Œæ¥æ”¶å™¨å°±å¯ä»¥å¾ˆå®¹æ˜“åœ°è¢«ä»å¤–éƒ¨ç³»ç»Ÿè¯»å–/å†™å…¥çš„æºå’Œæ¥æ”¶å™¨æ‰€æ›¿ä»£ã€‚\né›†åˆæ•°æ®æºçš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ã€‚\nval env = StreamExecutionEnvironment.createLocalEnvironment() // ä»å…ƒç´ åˆ—è¡¨ä¸­åˆ›å»ºä¸€ä¸ª DataStream val myInts = env.fromElements(1, 2, 3, 4, 5) // ä»ä»»ä½•é›†åˆä¸­åˆ›å»ºä¸€ä¸ª DataStream val data: Seq[(String, Int)] = ... val myTuples = env.fromCollection(data) // ä»è¿­ä»£å™¨ä¸­åˆ›å»ºä¸€ä¸ª DataStream val longIt: Iterator[Long] = ... val myLongs = env.fromCollection(longIt) æ³¨ï¼šç›®å‰ï¼Œé›†åˆæ•°æ®æºè¦æ±‚æ•°æ®ç±»å‹å’Œè¿­ä»£å™¨å®ç° Serializableã€‚æ­¤å¤–ï¼Œé›†åˆæ•°æ®æºä¸èƒ½å¹¶è¡Œæ‰§è¡Œ( parallelism = 1)ã€‚\nè¿­ä»£å™¨æ•°æ®æ¥æ”¶å™¨ Flink è¿˜æä¾›äº†ä¸€ä¸ªæ”¶é›† DataStream ç»“æœçš„æ¥æ”¶å™¨(sink)ï¼Œç”¨äºæµ‹è¯•å’Œè°ƒè¯•ç›®çš„ã€‚å®ƒçš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ã€‚\nimport org.apache.flink.streaming.experimental.DataStreamUtils import scala.collection.JavaConverters.asScalaIteratorConverter val myResult: DataStream[(String, Int)] = ... val myOutput: Iterator[(String, Int)] = DataStreamUtils.collect(myResult.javaStream).asScala æ³¨æ„ï¼šflink-streaming-contrib æ¨¡å—ä» Flink 1.5.0 ä¸­ç§»é™¤ã€‚å®ƒçš„ç±»è¢«ç§»åˆ° flink-streaming-java å’Œ flink-streaming-scala ä¸­ã€‚\nä¸‹ä¸€æ­¥æ€ä¹ˆèµ°ï¼Ÿ  è¿ç®—ç¬¦: è§„èŒƒå¯ç”¨çš„æµå¼è¿ç®—ç¬¦ã€‚ äº‹ä»¶æ—¶é—´: ä»‹ç» Flink çš„æ—¶é—´æ¦‚å¿µã€‚ çŠ¶æ€å’Œå®¹é”™: è§£é‡Šå¦‚ä½•å¼€å‘æœ‰çŠ¶æ€çš„åº”ç”¨ã€‚ è¿æ¥å™¨: æè¿°å¯ç”¨çš„è¾“å…¥å’Œè¾“å‡ºè¿æ¥å™¨ã€‚  ","permalink":"https://ohmyweekly.github.io/notes/2020-08-21-flink-datastream-api-programming-guide/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataStream API"],"title":"Flink Datastream API ç¼–ç¨‹æŒ‡å—"},{"categories":["programming"],"contents":"ç”Ÿæˆæ°´å° åœ¨æœ¬èŠ‚ä¸­ï¼Œæ‚¨å°†äº†è§£ Flink æä¾›çš„ APIï¼Œç”¨äºå¤„ç†äº‹ä»¶æ—¶é—´æ—¶é—´æˆ³å’Œæ°´å°ã€‚å…³äºäº‹ä»¶æ—¶é—´ã€å¤„ç†æ—¶é—´å’Œæ‘„å–æ—¶é—´çš„ä»‹ç»ï¼Œè¯·å‚è€ƒäº‹ä»¶æ—¶é—´çš„ä»‹ç»ã€‚\næ°´å°ç­–ç•¥ä»‹ç» ä¸ºäº†ä½¿ç”¨äº‹ä»¶æ—¶é—´ï¼ŒFlink éœ€è¦çŸ¥é“äº‹ä»¶çš„æ—¶é—´æˆ³ï¼Œè¿™æ„å‘³ç€æµä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½éœ€è¦åˆ†é…å…¶äº‹ä»¶æ—¶é—´æˆ³(event timestamp)ã€‚è¿™é€šå¸¸æ˜¯é€šè¿‡ä½¿ç”¨ TimestampAssigner ä»å…ƒç´ ä¸­çš„æŸä¸ªå­—æ®µè®¿é—®/æå–æ—¶é—´æˆ³(timestamp)æ¥å®Œæˆçš„ã€‚\næ—¶é—´æˆ³åˆ†é…ä¸ç”Ÿæˆæ°´å°æ˜¯åŒæ­¥è¿›è¡Œçš„ï¼Œæ°´å°å‘Šè¯‰ç³»ç»Ÿäº‹ä»¶æ—¶é—´çš„è¿›å±•ã€‚ä½ å¯ä»¥é€šè¿‡æŒ‡å®šä¸€ä¸ª WatermarkGenerator æ¥é…ç½®ã€‚\nFlink API æœŸæœ›ä¸€ä¸ª WatermarkStrategyï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ª TimestampAssigner å’Œ WatermarkGeneratorã€‚ä¸€äº›å¸¸è§çš„ç­–ç•¥ä½œä¸º WatermarkStrategy ä¸Šçš„é™æ€æ–¹æ³•æ˜¯å¼€ç®±å³ç”¨çš„ï¼Œä½†ç”¨æˆ·ä¹Ÿå¯ä»¥åœ¨éœ€è¦æ—¶å»ºç«‹è‡ªå·±çš„ç­–ç•¥ã€‚\nä¸ºäº†å®Œæ•´èµ·è§ï¼Œè¿™é‡Œæ˜¯æ¥å£:\npublic interface WatermarkStrategy\u0026lt;T\u0026gt; extends TimestampAssignerSupplier\u0026lt;T\u0026gt;, WatermarkGeneratorSupplier\u0026lt;T\u0026gt;{ /** * Instantiates a {@link TimestampAssigner} for assigning timestamps according to this * strategy. */ @Override TimestampAssigner\u0026lt;T\u0026gt; createTimestampAssigner(TimestampAssignerSupplier.Context context); /** * Instantiates a WatermarkGenerator that generates watermarks according to this strategy. */ @Override WatermarkGenerator\u0026lt;T\u0026gt; createWatermarkGenerator(WatermarkGeneratorSupplier.Context context); } å¦‚å‰æ‰€è¿°ï¼Œä½ é€šå¸¸ä¸ä¼šè‡ªå·±å®ç°è¿™ä¸ªæ¥å£ï¼Œè€Œæ˜¯ä½¿ç”¨ WatermarkStrategy ä¸Šçš„é™æ€å¸®åŠ©æ–¹æ³•æ¥å®ç°å¸¸è§çš„æ°´å°ç­–ç•¥ï¼Œæˆ–è€…å°†è‡ªå®šä¹‰çš„ TimestampAssigner ä¸ WatermarkGenerator æ†ç»‘åœ¨ä¸€èµ·ã€‚ä¾‹å¦‚ï¼Œè¦ä½¿ç”¨æœ‰ç•Œæ— åºæ°´å°å’Œ lambda å‡½æ•°ä½œä¸ºæ—¶é—´æˆ³åˆ†é…å™¨ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚\nWatermarkStrategy .forBoundedOutOfOrderness[(Long, String)](Duration.ofSeconds(20)) .withTimestampAssigner(new SerializableTimestampAssigner[(Long, String)] { override def extractTimestamp(element: (Long, String), recordTimestamp: Long): Long = element._1 }) (åœ¨è¿™é‡Œä½¿ç”¨ Scala Lambdas ç›®å‰æ˜¯è¡Œä¸é€šçš„ï¼Œå› ä¸º Scala å¾ˆç¬¨ï¼Œå¾ˆéš¾æ”¯æŒè¿™ä¸ªã€‚#fus)\næŒ‡å®šä¸€ä¸ª TimestampAssigner æ˜¯å¯é€‰çš„ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½ å…¶å®å¹¶ä¸æƒ³æŒ‡å®šä¸€ä¸ªã€‚ä¾‹å¦‚ï¼Œå½“ä½¿ç”¨ Kafka æˆ– Kinesis æ—¶ï¼Œä½ ä¼šç›´æ¥ä» Kafka/Kinesis è®°å½•ä¸­è·å–æ—¶é—´æˆ³ã€‚\næˆ‘ä»¬å°†åœ¨åé¢çš„ Writing WatermarkGeneratorä¸­æŸ¥çœ‹ WatermarkGenerator æ¥å£ã€‚\næ³¨æ„ï¼šæ—¶é—´æˆ³å’Œæ°´å°éƒ½è¢«æŒ‡å®šä¸ºè‡ª 1970-01-01T00:00:00Z çš„ Java çºªå…ƒä»¥æ¥çš„æ¯«ç§’ã€‚\nä½¿ç”¨æ°´å°ç­–ç•¥ åœ¨ Flink åº”ç”¨ä¸­ï¼Œæœ‰ä¸¤ä¸ªåœ°æ–¹å¯ä»¥ä½¿ç”¨ WatermarkStrategyã€‚1ï¼‰ç›´æ¥åœ¨æºä¸Šä½¿ç”¨ï¼Œ2ï¼‰åœ¨éæºæ“ä½œåä½¿ç”¨ã€‚\nç¬¬ä¸€ä¸ªé€‰é¡¹æ˜¯æ¯”è¾ƒå¥½çš„ï¼Œå› ä¸ºå®ƒå…è®¸æºåœ¨æ°´å°é€»è¾‘ä¸­åˆ©ç”¨å…³äºç¢ç‰‡/åˆ†åŒº/åˆ†å‰²çš„çŸ¥è¯†ã€‚æºé€šå¸¸å¯ä»¥æ›´ç²¾ç»†åœ°è·Ÿè¸ªæ°´å°ï¼Œæºäº§ç”Ÿçš„æ•´ä½“æ°´å°ä¹Ÿä¼šæ›´å‡†ç¡®ã€‚ç›´æ¥åœ¨æºä¸ŠæŒ‡å®š WatermarkStrategy é€šå¸¸æ„å‘³ç€ä½ å¿…é¡»ä½¿ç”¨æºçš„ç‰¹å®šæ¥å£/è¯·å‚é˜… Watermark Strategies å’Œ Kafka Connectorï¼Œä»¥äº†è§£åœ¨ Kafka Connector ä¸Šå¦‚ä½•å·¥ä½œï¼Œä»¥åŠå…³äºæ¯ä¸ªåˆ†åŒºæ°´å°å¦‚ä½•å·¥ä½œçš„æ›´å¤šç»†èŠ‚ã€‚\nç¬¬äºŒä¸ªé€‰é¡¹ï¼ˆåœ¨ä»»æ„æ“ä½œåè®¾ç½® WatermarkStrategyï¼‰åªåº”åœ¨ä¸èƒ½ç›´æ¥åœ¨æºä¸Šè®¾ç½®ç­–ç•¥æ—¶ä½¿ç”¨ã€‚\nval env = StreamExecutionEnvironment.getExecutionEnvironment env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime) val stream: DataStream[MyEvent] = env.readFile( myFormat, myFilePath, FileProcessingMode.PROCESS_CONTINUOUSLY, 100, FilePathFilter.createDefaultFilter()) val withTimestampsAndWatermarks: DataStream[MyEvent] = stream .filter( _.severity == WARNING ) .assignTimestampsAndWatermarks(\u0026lt;watermark strategy\u0026gt;) withTimestampsAndWatermarks .keyBy( _.getGroup ) .timeWindow(Time.seconds(10)) .reduce( (a, b) =\u0026gt; a.add(b) ) .addSink(...) ä»¥è¿™ç§æ–¹å¼ä½¿ç”¨ WatermarkStrategyï¼Œå¯ä»¥è·å–ä¸€ä¸ªæµå¹¶ç”Ÿæˆä¸€ä¸ªå¸¦æœ‰æ—¶é—´æˆ³å…ƒç´ å’Œæ°´å°çš„æ–°æµã€‚å¦‚æœåŸå§‹æµå·²ç»æœ‰æ—¶é—´æˆ³å’Œ/æˆ–æ°´å°äº†ï¼Œæ—¶é—´æˆ³åˆ†é…å™¨å°±ä¼šè¦†ç›–å®ƒä»¬ã€‚\nå¤„ç†é—²ç½®æº å¦‚æœå…¶ä¸­ä¸€ä¸ªè¾“å…¥åˆ†å‰²/åˆ†åŒº/ç¢ç‰‡åœ¨ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰æºå¸¦äº‹ä»¶ï¼Œè¿™æ„å‘³ç€ WatermarkGenerator ä¹Ÿæ²¡æœ‰å¾—åˆ°ä»»ä½•æ–°çš„ä¿¡æ¯æ¥ä½œä¸ºæ°´å°çš„åŸºç¡€ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸ºç©ºé—²è¾“å…¥æˆ–ç©ºé—²æºã€‚è¿™æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºæœ‰å¯èƒ½å‘ç”Ÿä½ çš„ä¸€äº›åˆ†åŒºä»ç„¶æºå¸¦äº‹ä»¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ°´å°å°†è¢«ä¿ç•™ä¸‹æ¥ï¼Œå› ä¸ºå®ƒæ˜¯ä½œä¸ºæ‰€æœ‰ä¸åŒçš„å¹¶è¡Œæ°´å°çš„æœ€å°å€¼è®¡ç®—çš„ã€‚\nä¸ºäº†å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œä½ å¯ä»¥ä½¿ç”¨ WatermarkStrategy æ¥æ£€æµ‹ç©ºé—²ï¼Œå¹¶å°†ä¸€ä¸ªè¾“å…¥æ ‡è®°ä¸ºç©ºé—²ã€‚WatermarkStrategy ä¸ºæ­¤æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„åŠ©æ‰‹ã€‚\nWatermarkStrategy .forBoundedOutOfOrderness[(Long, String)](Duration.ofSeconds(20)) .withIdleness(Duration.ofMinutes(1)) ç¼–å†™æ°´å°ç”Ÿæˆå™¨ æ—¶é—´æˆ³åˆ†é…å™¨(TimestampAssigner)æ˜¯ä¸€ä¸ªä»äº‹ä»¶ä¸­æå–å­—æ®µçš„ç®€å•å‡½æ•°ï¼Œå› æ­¤æˆ‘ä»¬ä¸éœ€è¦è¯¦ç»†ç ”ç©¶å®ƒä»¬ã€‚è€Œ WatermarkGenerator çš„ç¼–å†™å°±æ¯”è¾ƒå¤æ‚äº†ï¼Œæˆ‘ä»¬å°†åœ¨æ¥ä¸‹æ¥çš„ä¸¤èŠ‚ä¸­çœ‹å¦‚ä½•åšã€‚è¿™å°±æ˜¯ WatermarkGenerator çš„æ¥å£ã€‚\n/** * The {@code WatermarkGenerator} generates watermarks either based on events or * periodically (in a fixed interval). * * \u0026lt;p\u0026gt;\u0026lt;b\u0026gt;Note:\u0026lt;/b\u0026gt; This WatermarkGenerator subsumes the previous distinction between the * {@code AssignerWithPunctuatedWatermarks} and the {@code AssignerWithPeriodicWatermarks}. */ @Public public interface WatermarkGenerator\u0026lt;T\u0026gt; { /** * Called for every event, allows the watermark generator to examine and remember the * event timestamps, or to emit a watermark based on the event itself. */ void onEvent(T event, long eventTimestamp, WatermarkOutput output); /** * Called periodically, and might emit a new watermark, or not. * * \u0026lt;p\u0026gt;The interval in which this method is called and Watermarks are generated * depends on {@link ExecutionConfig#getAutoWatermarkInterval()}. */ void onPeriodicEmit(WatermarkOutput output); } æœ‰ä¸¤ç§ä¸åŒé£æ ¼çš„æ°´å°ç”Ÿæˆå™¨ï¼šå‘¨æœŸæ€§å’Œæ‰“ç‚¹å¼ã€‚\nå‘¨æœŸæ€§ç”Ÿæˆå™¨é€šå¸¸é€šè¿‡ onEvent() è§‚å¯Ÿåˆ°ä¼ å…¥çš„äº‹ä»¶ï¼Œç„¶åå½“æ¡†æ¶è°ƒç”¨ onPeriodicEmit() æ—¶ï¼Œå‘å°„æ°´å°ã€‚\næ ‡ç‚¹å¼ç”Ÿæˆå™¨ä¼šè§‚å¯Ÿ onEvent() ä¸­çš„äº‹ä»¶ï¼Œå¹¶ç­‰å¾…æµä¸­æºå¸¦æ°´å°ä¿¡æ¯çš„ç‰¹æ®Šæ ‡è®°äº‹ä»¶æˆ–æ ‡ç‚¹ã€‚å½“å®ƒçœ‹åˆ°è¿™äº›äº‹ä»¶ä¹‹ä¸€æ—¶ï¼Œå°±ä¼šç«‹å³å‘å‡ºä¸€ä¸ªæ°´å°ã€‚é€šå¸¸ï¼Œæ ‡ç‚¹ç”Ÿæˆå™¨ä¸ä¼šä» onPeriodicEmit() å‘å‡ºæ°´å°ã€‚\næ¥ä¸‹æ¥æˆ‘ä»¬å°†çœ‹çœ‹å¦‚ä½•å®ç°æ¯ç§æ ·å¼çš„ç”Ÿæˆå™¨ã€‚\nç¼–å†™å‘¨æœŸæ€§æ°´å°ç”Ÿæˆå™¨ å‘¨æœŸæ€§ç”Ÿæˆå™¨è§‚å¯Ÿæµäº‹ä»¶å¹¶å‘¨æœŸæ€§åœ°ç”Ÿæˆæ°´å°ï¼ˆå¯èƒ½å–å†³äºæµå…ƒç´ ï¼Œæˆ–è€…çº¯ç²¹åŸºäºå¤„ç†æ—¶é—´ï¼‰ã€‚\nç”Ÿæˆæ°´å°çš„é—´éš”ï¼ˆæ¯næ¯«ç§’ï¼‰é€šè¿‡ ExecutionConfig.setAutoWatermarkInterval(...) æ¥å®šä¹‰ã€‚æ¯æ¬¡éƒ½ä¼šè°ƒç”¨ç”Ÿæˆå™¨çš„ onPeriodicEmit() æ–¹æ³•ï¼Œå¦‚æœè¿”å›çš„æ°´å°æ˜¯éç©ºçš„ï¼Œå¹¶ä¸”å¤§äºå‰ä¸€ä¸ªæ°´å°ï¼Œå°±ä¼šå‘å‡ºä¸€ä¸ªæ–°çš„æ°´å°ã€‚\nè¿™é‡Œæˆ‘ä»¬å±•ç¤ºäº†ä¸¤ä¸ªä½¿ç”¨å‘¨æœŸæ€§æ°´å°ç”Ÿæˆå™¨çš„ç®€å•ä¾‹å­ã€‚è¯·æ³¨æ„ï¼ŒFlink æä¾›äº† BoundedOutfOrdernessWatermarksï¼Œè¿™æ˜¯ä¸€ä¸ª WatermarkGeneratorï¼Œå®ƒçš„å·¥ä½œåŸç†ä¸ä¸‹é¢æ‰€ç¤ºçš„ BoundedOutfOrdernessGenerator ç±»ä¼¼ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»å…³äºå¦‚ä½•ä½¿ç”¨å®ƒã€‚\n/** * This generator generates watermarks assuming that elements arrive out of order, * but only to a certain degree. The latest elements for a certain timestamp t will arrive * at most n milliseconds after the earliest elements for timestamp t. */ class BoundedOutOfOrdernessGenerator extends AssignerWithPeriodicWatermarks[MyEvent] { val maxOutOfOrderness = 3500L // 3.5 seconds  var currentMaxTimestamp: Long = _ override def onEvent(element: MyEvent, eventTimestamp: Long): Unit = { currentMaxTimestamp = max(eventTimestamp, currentMaxTimestamp) } override def onPeriodicEmit(): Unit = { // emit the watermark as current highest timestamp minus the out-of-orderness bound  output.emitWatermark(new Watermark(currentMaxTimestamp - maxOutOfOrderness - 1)); } } /** * This generator generates watermarks that are lagging behind processing time by a fixed amount. * It assumes that elements arrive in Flink after a bounded delay. */ class TimeLagWatermarkGenerator extends AssignerWithPeriodicWatermarks[MyEvent] { val maxTimeLag = 5000L // 5 seconds  override def onEvent(element: MyEvent, eventTimestamp: Long): Unit = { // don\u0026#39;t need to do anything because we work on processing time  } override def onPeriodicEmit(): Unit = { output.emitWatermark(new Watermark(System.currentTimeMillis() - maxTimeLag)); } } ç¼–å†™ä¸€ä¸ªæ ‡ç‚¹æ°´å°ç”Ÿæˆå™¨ æ ‡ç‚¹æ°´å°ç”Ÿæˆå™¨å°†è§‚å¯Ÿäº‹ä»¶æµï¼Œæ¯å½“å®ƒçœ‹åˆ°ä¸€ä¸ªæºå¸¦æ°´å°ä¿¡æ¯çš„ç‰¹æ®Šå…ƒç´ æ—¶ï¼Œå°±ä¼šå‘å‡ºä¸€ä¸ªæ°´å°ã€‚\nè¿™å°±æ˜¯å¦‚ä½•å®ç°ä¸€ä¸ªæ ‡ç‚¹æ°´å°ç”Ÿæˆå™¨ï¼Œæ¯å½“ä¸€ä¸ªäº‹ä»¶è¡¨æ˜å®ƒæºå¸¦æŸä¸ªæ ‡è®°æ—¶ï¼Œå®ƒå°±ä¼šå‘å°„ä¸€ä¸ªæ°´å°ã€‚\nclass PunctuatedAssigner extends AssignerWithPunctuatedWatermarks[MyEvent] { override def onEvent(element: MyEvent, eventTimestamp: Long): Unit = { if (event.hasWatermarkMarker()) { output.emitWatermark(new Watermark(event.getWatermarkTimestamp())) } } override def onPeriodicEmit(): Unit = { // don\u0026#39;t need to do anything because we emit in reaction to events above  } } æ³¨ï¼šå¯ä»¥å¯¹æ¯ä¸ªäº‹ä»¶ç”Ÿæˆä¸€ä¸ªæ°´å°ã€‚ç„¶è€Œï¼Œç”±äºæ¯ä¸ªæ°´å°éƒ½ä¼šå¼•èµ·ä¸‹æ¸¸çš„ä¸€äº›è®¡ç®—ï¼Œå› æ­¤è¿‡å¤šçš„æ°´å°ä¼šé™ä½æ€§èƒ½ã€‚\næ°´å°ç­–ç•¥å’Œ Kafka è¿æ¥å™¨ å½“ä½¿ç”¨ Apache Kafka ä½œä¸ºæ•°æ®æºæ—¶ï¼Œæ¯ä¸ª Kafka åˆ†åŒºå¯èƒ½æœ‰ä¸€ä¸ªç®€å•çš„äº‹ä»¶æ—¶é—´æ¨¡å¼ï¼ˆå‡åºæ—¶é—´æˆ³æˆ–æœ‰ç•Œå¤±åºï¼‰ã€‚ç„¶è€Œï¼Œå½“æ¶ˆè€—æ¥è‡ª Kafka çš„æµæ—¶ï¼Œå¤šä¸ªåˆ†åŒºç»å¸¸ä¼šè¢«å¹¶è¡Œæ¶ˆè€—ï¼Œäº¤ç»‡æ¥è‡ªåˆ†åŒºçš„äº‹ä»¶ï¼Œå¹¶ç ´åæ¯ä¸ªåˆ†åŒºçš„æ¨¡å¼ï¼ˆè¿™æ˜¯ Kafka çš„æ¶ˆè´¹è€…å®¢æˆ·ç«¯çš„å›ºæœ‰å·¥ä½œæ–¹å¼ï¼‰ã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ Flink çš„ Kafka-partition-aware æ°´å°ç”ŸæˆåŠŸèƒ½ã€‚ä½¿ç”¨è¯¥åŠŸèƒ½ï¼Œåœ¨ Kafka æ¶ˆè´¹è€…å†…éƒ¨ï¼ŒæŒ‰ Kafka åˆ†åŒºç”Ÿæˆæ°´å°ï¼Œæ¯ä¸ªåˆ†åŒºæ°´å°çš„åˆå¹¶æ–¹å¼ä¸æµæ´—ç‰Œçš„æ°´å°åˆå¹¶æ–¹å¼ç›¸åŒã€‚\nä¾‹å¦‚ï¼Œå¦‚æœæ¯ä¸ª Kafka åˆ†åŒºçš„äº‹ä»¶æ—¶é—´æˆ³æ˜¯ä¸¥æ ¼çš„å‡åºï¼Œé‚£ä¹ˆç”¨å‡åºæ—¶é—´æˆ³æ°´å°ç”Ÿæˆå™¨ç”Ÿæˆæ¯ä¸ªåˆ†åŒºçš„æ°´å°ï¼Œä¼šå¾—åˆ°å®Œç¾çš„æ•´ä½“æ°´å°ã€‚è¯·æ³¨æ„ï¼Œæˆ‘ä»¬åœ¨ç¤ºä¾‹ä¸­å¹¶æ²¡æœ‰æä¾› TimestampAssignerï¼Œè€Œæ˜¯ä½¿ç”¨ Kafka è®°å½•æœ¬èº«çš„æ—¶é—´æˆ³ã€‚\nä¸‹é¢çš„æ’å›¾å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ per-Kafka-partition æ°´å°ç”Ÿæˆå™¨ï¼Œä»¥åŠåœ¨è¿™ç§æƒ…å†µä¸‹æ°´å°å¦‚ä½•é€šè¿‡æµå¼æ•°æ®æµä¼ æ’­ã€‚\nval kafkaSource = new FlinkKafkaConsumer[MyType](\u0026#34;myTopic\u0026#34;, schema, props) kafkaSource.assignTimestampsAndWatermarks( WatermarkStrategy .forBoundedOutOfOrderness(Duration.ofSeconds(20))) val stream: DataStream[MyType] = env.addSource(kafkaSource) è¿ç®—ç¬¦å¦‚ä½•å¤„ç†æ°´å° ä½œä¸ºä¸€èˆ¬è§„åˆ™ï¼Œè¿ç®—ç¬¦(operator)åœ¨å‘ä¸‹æ¸¸è½¬å‘ä¸€ä¸ªç»™å®šçš„æ°´å°ä¹‹å‰ï¼Œéœ€è¦å¯¹å…¶è¿›è¡Œå®Œå…¨å¤„ç†ã€‚ä¾‹å¦‚ï¼ŒWindowOperator å°†é¦–å…ˆè¯„ä¼°æ‰€æœ‰åº”è¯¥è¢«å‘å°„çš„çª—å£ï¼Œåªæœ‰åœ¨äº§ç”Ÿæ‰€æœ‰ç”±æ°´å°è§¦å‘çš„è¾“å‡ºä¹‹åï¼Œæ°´å°æœ¬èº«æ‰ä¼šè¢«å‘é€åˆ°ä¸‹æ¸¸ã€‚æ¢å¥è¯è¯´ï¼Œæ‰€æœ‰å› å‘ç”Ÿæ°´å°è€Œäº§ç”Ÿçš„å…ƒç´ å°†åœ¨æ°´å°ä¹‹å‰è¢«å‘å°„ã€‚\nåŒæ ·çš„è§„åˆ™ä¹Ÿé€‚ç”¨äº TwoInputStreamOperatorã€‚ç„¶è€Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿ç®—ç¬¦çš„å½“å‰æ°´å°è¢«å®šä¹‰ä¸ºå…¶ä¸¤ä¸ªè¾“å…¥çš„æœ€å°å€¼ã€‚\nè¿™ç§è¡Œä¸ºçš„ç»†èŠ‚ç”± OneInputStreamOperator#processWatermarkã€TwoInputStreamOperator#processWatermark1 å’Œ TwoInputStreamOperator#processWatermark2 æ–¹æ³•çš„å®ç°æ¥å®šä¹‰ã€‚\nåºŸå¼ƒçš„ AssignerWithPeriodicWatermarks å’Œ AssignerWithPunctuatedWatermarks æ–¹æ³• åœ¨å¼•å…¥å½“å‰çš„ WatermarkStrategyã€TimestampAssigner å’Œ WatermarkGenerator æŠ½è±¡ä¹‹å‰ï¼ŒFlink ä½¿ç”¨äº† AssignerWithPeriodicWatermarks å’Œ AssignerWithPeriodicWatermarksã€‚ä½ ä»ç„¶ä¼šåœ¨ API ä¸­çœ‹åˆ°å®ƒä»¬ï¼Œä½†å»ºè®®ä½¿ç”¨æ–°çš„æ¥å£ï¼Œå› ä¸ºå®ƒä»¬æä¾›äº†æ›´æ¸…æ™°çš„åˆ†ç¦»å…³æ³¨ç‚¹ï¼Œä¹Ÿç»Ÿä¸€äº†æ°´å°ç”Ÿæˆçš„å‘¨æœŸå’Œæ ‡ç‚¹æ ·å¼ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-21-generating-watermarks/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataStream API","Event Time"],"title":"Generating Watermarks"},{"categories":["Julia"],"contents":"Julia REPL Julia åœ¨ julia å¯æ‰§è¡Œæ–‡ä»¶ä¸­å†…ç½®äº†ä¸€ä¸ªåŠŸèƒ½é½å…¨çš„äº¤äº’å¼å‘½ä»¤è¡Œ REPLï¼ˆread-eval-print loopï¼‰ã€‚é™¤äº†å…è®¸å¿«é€Ÿã€ç®€å•åœ°è¯„ä¼° Julia è¯­å¥å¤–ï¼Œå®ƒè¿˜å…·æœ‰å¯æœç´¢çš„å†å²è®°å½•ã€tab-è¡¥å…¨ã€è®¸å¤šæœ‰ç”¨çš„é”®ç»‘å®šä»¥åŠä¸“é—¨çš„å¸®åŠ©å’Œ shell æ¨¡å¼ã€‚REPL å¯ä»¥é€šè¿‡ç®€å•åœ°è°ƒç”¨ julia è€Œä¸ä½¿ç”¨å‚æ•°æˆ–åŒå‡»å¯æ‰§è¡Œæ–‡ä»¶æ¥å¯åŠ¨ã€‚\n$ julia _ _ _ _(_)_ | Documentation: https://docs.julialang.org (_) | (_) (_) | _ _ _| |_ __ _ | Type \u0026#34;?\u0026#34; for help, \u0026#34;]?\u0026#34; for Pkg help. | | | | | | |/ _` | | | | |_| | | | (_| | | Version 1.5.0 (2020-08-01) _/ |\\__\u0026#39;_|_|_|\\__\u0026#39;_| | Official https://julialang.org/ release |__/ | julia\u0026gt; è¦é€€å‡ºäº¤äº’å¼ä¼šè¯ï¼Œè¯·é”®å…¥ ^D - æ§åˆ¶é”®ä¸ d é”®ä¸€èµ·åœ¨ç©ºè¡Œä¸Šé”®å…¥ï¼Œæˆ–é”®å…¥ exit() åè·Ÿå›è½¦æˆ–å›è½¦é”®ã€‚REPL ä¼šç”¨ä¸€ä¸ªæ¨ªå¹…å’Œ julia\u0026gt; æç¤ºæ¥æ¬¢è¿æ‚¨ã€‚\nä¸åŒçš„æç¤ºæ¨¡å¼ æœ±åˆ©å®‰æ¨¡å¼ REPL æœ‰å››ç§ä¸»è¦çš„æ“ä½œæ¨¡å¼ã€‚ç¬¬ä¸€ç§ä¹Ÿæ˜¯æœ€å¸¸è§çš„æ˜¯ Julian æç¤ºã€‚è¿™æ˜¯é»˜è®¤çš„æ“ä½œæ¨¡å¼ï¼›æ¯ä¸ªæ–°è¡Œéƒ½ä»¥ julia\u0026gt; å¼€å§‹ã€‚åœ¨è¿™é‡Œæ‚¨å¯ä»¥è¾“å…¥ Julia è¡¨è¾¾å¼ã€‚åœ¨è¾“å…¥å®Œæ•´çš„è¡¨è¾¾å¼åç‚¹å‡»å›è½¦æˆ–å›è½¦å°†è¯„ä¼°è¯¥æ¡ç›®å¹¶æ˜¾ç¤ºæœ€åä¸€ä¸ªè¡¨è¾¾å¼çš„ç»“æœã€‚\njulia\u0026gt; string(1 + 2) \u0026#34;3\u0026#34; åœ¨äº¤äº’å¼å·¥ä½œä¸­ï¼Œæœ‰è®¸å¤šç‹¬ç‰¹çš„æœ‰ç”¨åŠŸèƒ½ã€‚é™¤äº†æ˜¾ç¤ºç»“æœä¹‹å¤–ï¼ŒREPL è¿˜å°†ç»“æœç»‘å®šåˆ°å˜é‡ ans ä¸Šã€‚è¡Œä¸Šçš„åˆ†å·å¯ä»¥ä½œä¸ºä¸€ä¸ªæ ‡å¿—æ¥æŠ‘åˆ¶æ˜¾ç¤ºç»“æœã€‚\njulia\u0026gt; string(3 * 4); julia\u0026gt; ans \u0026#34;12\u0026#34; åœ¨ Julia æ¨¡å¼ä¸‹ï¼ŒREPL æ”¯æŒç§°ä¸ºæç¤ºç²˜è´´(prompt pasting)çš„ä¸œè¥¿ã€‚å½“æŠŠä»¥ julia\u0026gt; å¼€å¤´çš„æ–‡æœ¬ç²˜è´´åˆ° REPL ä¸­æ—¶ï¼Œè¿™ä¸ªåŠŸèƒ½ä¼šè¢«æ¿€æ´»ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåªæœ‰ä»¥ julia\u0026gt; å¼€å¤´çš„è¡¨è¾¾å¼ä¼šè¢«è§£æï¼Œå…¶ä»–è¡¨è¾¾å¼ä¼šè¢«åˆ é™¤ã€‚è¿™ä½¿å¾—æ‚¨å¯ä»¥ç²˜è´´ä» REPL ä¼šè¯ä¸­å¤åˆ¶çš„ä»£ç å—ï¼Œè€Œæ— éœ€æ¸…é™¤æç¤ºå’Œè¾“å‡ºã€‚è¿™ä¸ªåŠŸèƒ½é»˜è®¤æ˜¯å¯ç”¨çš„ï¼Œä½†å¯ä»¥é€šè¿‡ REPL.enable_promptpaste(::Bool) æ¥ç¦ç”¨æˆ–å¯ç”¨ã€‚å¦‚æœå¯ç”¨äº†ï¼Œæ‚¨å¯ä»¥ç›´æ¥å°†æœ¬æ®µä¸Šé¢çš„ä»£ç å—ç²˜è´´åˆ° REPL ä¸­è¯•è¯•ã€‚è¿™ä¸ªåŠŸèƒ½åœ¨æ ‡å‡†çš„ Windows å‘½ä»¤æç¤ºç¬¦ä¸Šä¸èµ·ä½œç”¨ï¼Œå› ä¸ºå®ƒåœ¨æ£€æµ‹ç²˜è´´å‘ç”Ÿæ—¶çš„å±€é™æ€§ã€‚\nusing REPL REPL.enable_promptpaste(false) # ç¦ç”¨ prompt pasting REPL.enable_promptpaste(true) # å¯ç”¨ prompt pasting å¯¹è±¡åœ¨ REPL ä¸­ä½¿ç”¨å¸¦æœ‰ç‰¹å®š IOContext çš„ show å‡½æ•°è¿›è¡Œæ‰“å°ã€‚ç‰¹åˆ«æ˜¯ï¼Œ:limit å±æ€§è¢«è®¾ç½®ä¸º trueã€‚å…¶ä»–å±æ€§å¯ä»¥åœ¨æŸäº› show æ–¹æ³•ä¸­æ¥æ”¶ä¸€ä¸ªé»˜è®¤å€¼ï¼Œå¦‚æœå®ƒè¿˜æ²¡æœ‰è¢«è®¾ç½®ï¼Œæ¯”å¦‚ :compactã€‚ä½œä¸ºå®éªŒæ€§åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡ Base.active_repl.options.iocontext å­—å…¸æ¥æŒ‡å®š REPL ä½¿ç”¨çš„å±æ€§ï¼ˆå°†å€¼å…³è”åˆ°å±æ€§ï¼‰ã€‚ä¾‹å¦‚:\njulia\u0026gt; rand(2, 2) 2Ã—2 Array{Float64,2}: 0.8833 0.329197 0.719708 0.59114 julia\u0026gt; show(IOContext(stdout, :compact =\u0026gt; false), \u0026#34;text/plain\u0026#34;, rand(2, 2)) 0.43540323669187075 0.15759787870609387 0.2540832269192739 0.4597637838786053 julia\u0026gt; Base.active_repl.options.iocontext[:compact] = false; julia\u0026gt; rand(2, 2) 2Ã—2 Array{Float64,2}: 0.2083967319174056 0.13330606013126012 0.6244375177790158 0.9777957560761545 ä¸ºäº†åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨å®šä¹‰è¿™ä¸ªå­—å…¸çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨ ~/.julia/config/startup.jl æ–‡ä»¶ä¸­çš„ atreplinit å‡½æ•°ï¼Œä¾‹å¦‚:\natreplinit() do repl repl.options.iocontext[:compact] = false end å¸®åŠ©æ¨¡å¼ å½“å…‰æ ‡åœ¨è¡Œé¦–æ—¶ï¼Œå¯ä»¥é€šè¿‡é”®å…¥ ? æ¥å°†æç¤ºå˜ä¸ºå¸®åŠ©æ¨¡å¼ã€‚Julia å°†å°è¯•æ‰“å°å¸®åŠ©æ¨¡å¼ä¸‹è¾“å…¥çš„ä»»ä½•å†…å®¹çš„å¸®åŠ©æˆ–æ–‡æ¡£ã€‚\njulia\u0026gt; ? # upon typing ?, the prompt changes (in place) to: help?\u0026gt; help?\u0026gt; string search: string String Cstring Cwstring RevString randstring bytestring SubString string(xs...) Create a string from any values using the print function. ä¹Ÿå¯ä»¥æŸ¥è¯¢å®ã€ç±»å‹å’Œå˜é‡:\nhelp?\u0026gt; @time @time A macro to execute an expression, printing the time it took to execute, the number of allocations, and the total number of bytes its execution caused to be allocated, before returning the value of the expression. See also @timev, @timed, @elapsed, and @allocated. help?\u0026gt; Int32 search: Int32 UInt32 Int32 \u0026lt;: Signed 32-bit signed integer type. æŒ‰è¡Œé¦–çš„é€€æ ¼é”®å¯ä»¥é€€å‡ºå¸®åŠ©æ¨¡å¼ã€‚\nShell æ¨¡å¼ å°±åƒå¸®åŠ©æ¨¡å¼å¯¹äºå¿«é€Ÿè®¿é—®æ–‡æ¡£å¾ˆæœ‰ç”¨ä¸€æ ·ï¼Œå¦ä¸€ä¸ªå¸¸è§çš„ä»»åŠ¡æ˜¯ä½¿ç”¨ç³»ç»Ÿ shell æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚å°±åƒ ? è¿›å…¥å¸®åŠ©æ¨¡å¼æ—¶ä¸€æ ·, åœ¨è¡Œé¦–æŒ‰ä¸‹åˆ†å·(;)ä¼šè¿›å…¥ shell æ¨¡å¼ã€‚è€Œä¸”å¯ä»¥åœ¨è¡Œé¦–æŒ‰é€€æ ¼é”®é€€å‡ºã€‚\njulia\u0026gt; ; # upon typing ;, the prompt changes (in place) to: shell\u0026gt; shell\u0026gt; echo hello hello æ³¨æ„:\nå¯¹äº Windows ç”¨æˆ·æ¥è¯´ï¼ŒJulia çš„ shell æ¨¡å¼ä¸æš´éœ² windows shell å‘½ä»¤ã€‚å› æ­¤ï¼Œè¿™å°†ä¼šå¤±è´¥:\njulia\u0026gt; ; # upon typing ;, the prompt changes (in place) to: shell\u0026gt; shell\u0026gt; dir ERROR: IOError: could not spawn `dir`: no such file or directory (ENOENT) Stacktrace! ....... ä¸è¿‡ï¼Œä½ å¯ä»¥åƒè¿™æ ·è®¿é—® PowerShell:\njulia\u0026gt; ; # upon typing ;, the prompt changes (in place) to: shell\u0026gt; shell\u0026gt; powershell Windows PowerShell Copyright (C) Microsoft Corporation. All rights reserved. PS C:\\Users\\elm\u0026gt; \u0026hellip;è€Œä¸”å¯¹ cmd.exe çš„è®¿é—®æ˜¯è¿™æ ·çš„ï¼ˆè§ dir å‘½ä»¤ï¼‰:\njulia\u0026gt; ; # upon typing ;, the prompt changes (in place) to: shell\u0026gt; shell\u0026gt; cmd Microsoft Windows [version 10.0.17763.973] (c) 2018 Microsoft Corporation. All rights reserved. C:\\Users\\elm\u0026gt;dir Volume in drive C has no label Volume Serial Number is 1643-0CD7 Directory of C:\\Users\\elm 29/01/2020 22:15 \u0026lt;DIR\u0026gt; . 29/01/2020 22:15 \u0026lt;DIR\u0026gt; .. 02/02/2020 08:06 \u0026lt;DIR\u0026gt; .atom æœç´¢æ¨¡å¼ åœ¨ä¸Šè¿°æ‰€æœ‰æ¨¡å¼ä¸­ï¼Œæ‰§è¡Œçš„è¡Œæ•°éƒ½ä¼šè¢«ä¿å­˜åˆ°å†å²æ–‡ä»¶ä¸­ï¼Œå¯ä»¥è¿›è¡Œæœç´¢ã€‚è¦åœ¨ä»¥å‰çš„å†å²è®°å½•ä¸­è¿›è¡Œå¢é‡æœç´¢ï¼Œè¾“å…¥ ^R\u0026ndash;æ§åˆ¶é”®å’Œ r é”®ã€‚æç¤ºç¬¦å°†å˜ä¸º(reverse-i-search):ï¼Œå½“ä½ è¾“å…¥æœç´¢æŸ¥è¯¢æ—¶ï¼Œæœç´¢æŸ¥è¯¢å°†å‡ºç°åœ¨å¼•å·ä¸­ã€‚å½“ä½ è¾“å…¥æ›´å¤šçš„å†…å®¹æ—¶ï¼Œä¸æŸ¥è¯¢ç›¸åŒ¹é…çš„æœ€æ–°ç»“æœä¼šåŠ¨æ€åœ°æ›´æ–°åˆ°å†’å·çš„å³è¾¹ã€‚å¦‚æœè¦ä½¿ç”¨ç›¸åŒçš„æŸ¥è¯¢æ‰¾åˆ°ä¸€ä¸ªè¾ƒæ—©çš„ç»“æœï¼Œåªéœ€å†æ¬¡è¾“å…¥ ^Rã€‚\nå°±åƒ ^R æ˜¯åå‘æœç´¢ä¸€æ ·ï¼Œ^S æ˜¯æ­£å‘æœç´¢ï¼Œå¹¶æç¤º(i-search):ã€‚ä¸¤è€…å¯ä»¥ç›¸äº’ç»“åˆä½¿ç”¨ï¼Œåˆ†åˆ«åœ¨ä¸Šä¸€ä¸ªæˆ–ä¸‹ä¸€ä¸ªåŒ¹é…ç»“æœä¸­ç§»åŠ¨ã€‚\né”®ç»‘å®š Julia REPL å¤§é‡ä½¿ç”¨äº†é”®ç»‘å®šã€‚ä¸Šé¢å·²ç»ä»‹ç»äº†å‡ ä¸ªæ§åˆ¶é”®ç»‘å®šï¼ˆ^D ç”¨äºé€€å‡ºï¼Œ^R å’Œ ^S ç”¨äºæœç´¢ï¼‰ï¼Œä½†è¿˜æœ‰æ›´å¤šã€‚é™¤äº†æ§åˆ¶é”®ï¼Œè¿˜æœ‰å…ƒé”®ç»‘å®šã€‚è¿™äº›å› å¹³å°ä¸åŒè€Œå˜åŒ–è¾ƒå¤§ï¼Œä½†å¤§å¤šæ•°ç»ˆç«¯é»˜è®¤ä½¿ç”¨ alt- æˆ– option- æŒ‰ä½é”®å‘é€å…ƒé”®ï¼ˆä¹Ÿå¯ä»¥é…ç½®æˆè¿™æ ·ï¼‰ï¼Œæˆ–è€…æŒ‰ Esc é”®ï¼Œç„¶åæŒ‰é”®ã€‚\n   Keybinding Description     Program control    ^D é€€å‡º(å½“ç¼“å­˜ä¸ºç©ºæ—¶)   ^C ä¸­æ–­æˆ–å–æ¶ˆ   ^L æ¸…ç†æ§åˆ¶å°å±å¹•   Return/Enter, ^J æ–°è¡Œï¼Œå¦‚æœå®Œæˆäº†å°±æ‰§è¡Œ   meta-Return/Enter æ’å…¥æ–°è¡Œè€Œä¸æ‰§è¡Œ   ? æˆ– ; è¿›å…¥å¸®åŠ©æˆ–shellæ¨¡å¼(å½“åœ¨è¡Œçš„å¼€å¤´æ—¶)   ^R, ^S é€’å¢å¼å†å²æ£€ç´¢ï¼Œå¦‚ä¸Šæ‰€è¿°    è‡ªå®šä¹‰é”®ç»‘å®š Julia çš„ REPL é”®ç»‘å®šå¯ä»¥é€šè¿‡å‘ REPL.setup_interface ä¼ é€’ä¸€ä¸ªå­—å…¸æ¥å®Œå…¨å®šåˆ¶ç”¨æˆ·çš„åå¥½ã€‚è¿™ä¸ªå­—å…¸çš„é”®å¯ä»¥æ˜¯å­—ç¬¦æˆ–å­—ç¬¦ä¸²ã€‚é”® \u0026lsquo;*\u0026rsquo; æŒ‡çš„æ˜¯é»˜è®¤æ“ä½œã€‚æ§åˆ¶åŠ å­—ç¬¦xçš„ç»‘å®šç”¨\u0026quot;^x\u0026quot;è¡¨ç¤ºã€‚Meta åŠ xå¯ä»¥å†™æˆ \u0026ldquo;\\M-x\u0026rdquo; æˆ– \u0026ldquo;\\ex\u0026rdquo;ï¼ŒControl åŠ  x å¯ä»¥å†™æˆ \u0026ldquo;\\C-x\u0026rdquo; æˆ– \u0026ldquo;^x\u0026rdquo;ã€‚è‡ªå®šä¹‰ keymap çš„å€¼å¿…é¡»æ˜¯ nothing(è¡¨ç¤ºè¾“å…¥åº”è¯¥è¢«å¿½ç•¥)æˆ–æ¥å—ç­¾åçš„å‡½æ•°(PromptState, AbstractREPL, Char)ã€‚REPL.setup_interface å‡½æ•°å¿…é¡»åœ¨ REPL åˆå§‹åŒ–ä¹‹å‰è¢«è°ƒç”¨ï¼Œé€šè¿‡åœ¨ atreplinit æ³¨å†Œæ“ä½œã€‚ä¾‹å¦‚ï¼Œè¦ç»‘å®šä¸Šä¸‹æ–¹å‘é”®æ¥ç§»åŠ¨å†å²è®°å½•è€Œä¸éœ€è¦å‰ç¼€æœç´¢ï¼Œå¯ä»¥åœ¨ ~/.julia/config/startup.jl ä¸­æ”¾å…¥ä»¥ä¸‹ä»£ç ã€‚\nimport REPL import REPL.LineEdit const mykeys = Dict{Any,Any}( # Up Arrow \u0026#34;\\e[A\u0026#34; =\u0026gt; (s,o...)-\u0026gt;(LineEdit.edit_move_up(s) || LineEdit.history_prev(s, LineEdit.mode(s).hist)), # Down Arrow \u0026#34;\\e[B\u0026#34; =\u0026gt; (s,o...)-\u0026gt;(LineEdit.edit_move_down(s) || LineEdit.history_next(s, LineEdit.mode(s).hist)) ) function customize_keys(repl) repl.interface = REPL.setup_interface(repl; extra_repl_keymap = mykeys) end atreplinit(customize_keys) ç”¨æˆ·åº”è¯¥å‚è€ƒ LineEdit.jl æ¥å‘ç°é”®è¾“å…¥çš„å¯ç”¨æ“ä½œã€‚\nTab è¡¥å…¨ åœ¨ REPL çš„ Julian å’Œå¸®åŠ©æ¨¡å¼ä¸‹ï¼Œå¯ä»¥è¾“å…¥å‡½æ•°æˆ–ç±»å‹çš„å‰å‡ ä¸ªå­—ç¬¦ï¼Œç„¶åæŒ‰tabé”®ï¼Œå¾—åˆ°ä¸€ä¸ªæ‰€æœ‰åŒ¹é…çš„åˆ—è¡¨:\njulia\u0026gt; stri[TAB] stride strides string strip julia\u0026gt; Stri[TAB] StridedArray StridedMatrix StridedVecOrMat StridedVector String tab é”®ä¹Ÿå¯ä»¥ç”¨æ¥ç”¨å®ƒä»¬çš„ Unicode ç­‰ä»·ç‰©æ›¿ä»£ LaTeX æ•°å­¦ç¬¦å·ï¼Œå¹¶è·å¾— LaTeX åŒ¹é…åˆ—è¡¨ã€‚\njulia\u0026gt; \\pi[TAB] julia\u0026gt; Ï€ Ï€ = 3.1415926535897... julia\u0026gt; e\\_1[TAB] = [1,0] julia\u0026gt; eâ‚ = [1,0] 2-element Array{Int64,1}: 1 0 julia\u0026gt; e\\^1[TAB] = [1 0] julia\u0026gt; eÂ¹ = [1 0] 1Ã—2 Array{Int64,2}: 1 0 julia\u0026gt; \\sqrt[TAB]2 # âˆš is equivalent to the sqrt function julia\u0026gt; âˆš2 1.4142135623730951 julia\u0026gt; \\hbar[TAB](h) = h / 2\\pi[TAB] julia\u0026gt; Ä§(h) = h / 2Ï€ Ä§ (generic function with 1 method) julia\u0026gt; \\h[TAB] \\hat \\hermitconjmatrix \\hkswarow \\hrectangle \\hatapprox \\hexagon \\hookleftarrow \\hrectangleblack \\hbar \\hexagonblack \\hookrightarrow \\hslash \\heartsuit \\hksearow \\house \\hspace julia\u0026gt; Î±=\u0026#34;\\alpha[TAB]\u0026#34; # LaTeX completion also works in strings julia\u0026gt; Î±=\u0026#34;Î±\u0026#34; å®Œæ•´çš„tab-è¡¥å…¨åˆ—è¡¨å¯ä»¥åœ¨æ‰‹å†Œçš„ Unicode è¾“å…¥éƒ¨åˆ†æ‰¾åˆ°ã€‚\nè·¯å¾„è¡¥å…¨é€‚ç”¨äºå­—ç¬¦ä¸²å’Œ julia çš„ shell æ¨¡å¼:\njulia\u0026gt; path=\u0026#34;/[TAB]\u0026#34; .dockerenv .juliabox/ boot/ etc/ lib/ media/ opt/ root/ sbin/ sys/ usr/ .dockerinit bin/ dev/ home/ lib64/ mnt/ proc/ run/ srv/ tmp/ var/ shell\u0026gt; /[TAB] .dockerenv .juliabox/ boot/ etc/ lib/ media/ opt/ root/ sbin/ sys/ usr/ .dockerinit bin/ dev/ home/ lib64/ mnt/ proc/ run/ srv/ tmp/ var/ Tab è¡¥å…¨å¯ä»¥å¸®åŠ©è°ƒæŸ¥åŒ¹é…è¾“å…¥å‚æ•°çš„å¯ç”¨æ–¹æ³•ã€‚\njulia\u0026gt; max([TAB] # All methods are displayed, not shown here due to size of the list julia\u0026gt; max([1, 2], [TAB] # All methods where `Vector{Int}` matches as first argument max(x, y) in Base at operators.jl:215 max(a, b, c, xs...) in Base at operators.jl:281 julia\u0026gt; max([1, 2], max(1, 2), [TAB] # All methods matching the arguments. max(x, y) in Base at operators.jl:215 max(a, b, c, xs...) in Base at operators.jl:281 å…³é”®è¯ä¹Ÿæ˜¾ç¤ºåœ¨ ; åé¢çš„å»ºè®®æ–¹æ³•ä¸­ï¼Œè§ä¸‹é¢ä¸€è¡Œï¼Œå…¶ä¸­ limit å’Œ keepempty æ˜¯å…³é”®è¯å‚æ•°:\njulia\u0026gt; split(\u0026#34;1 1 1\u0026#34;, [TAB] split(str::AbstractString; limit, keepempty) in Base at strings/util.jl:302 split(str::T, splitter; limit, keepempty) where T\u0026lt;:AbstractString in Base at strings/util.jl:277 æ–¹æ³•çš„è¡¥å…¨ä½¿ç”¨ç±»å‹æ¨æ–­ï¼Œå› æ­¤å³ä½¿å‚æ•°æ˜¯å‡½æ•°è¾“å‡ºçš„ï¼Œä¹Ÿèƒ½çœ‹åˆ°å‚æ•°æ˜¯å¦åŒ¹é…ã€‚å‡½æ•°éœ€è¦ç±»å‹ç¨³å®šï¼Œå®Œæˆæ‰èƒ½å¤Ÿåˆ é™¤ä¸åŒ¹é…çš„æ–¹æ³•ã€‚\nTab è¡¥å…¨ä¹Ÿå¯ä»¥å¸®åŠ©è¡¥å…¨å­—æ®µ:\njulia\u0026gt; import UUIDs julia\u0026gt; UUIDs.uuid[TAB] uuid1 uuid4 uuid_version ä¹Ÿå¯ä»¥è¡¥å…¨å‡½æ•°è¾“å‡ºçš„å­—æ®µ:\njulia\u0026gt; split(\u0026quot;\u0026quot;,\u0026quot;\u0026quot;)[1].[TAB] lastindex offset string å‡½æ•°è¾“å‡ºçš„å­—æ®µå®Œæˆé‡‡ç”¨ç±»å‹æ¨æ–­ï¼Œåªæœ‰åœ¨å‡½æ•°ç±»å‹ç¨³å®šçš„æƒ…å†µä¸‹ï¼Œå®ƒæ‰èƒ½å»ºè®®å­—æ®µã€‚\nå­—å…¸é”®ä¹Ÿå¯ä»¥ç”¨ tab è¡¥å…¨:\njulia\u0026gt; foo = Dict(\u0026#34;qwer1\u0026#34;=\u0026gt;1, \u0026#34;qwer2\u0026#34;=\u0026gt;2, \u0026#34;asdf\u0026#34;=\u0026gt;3) Dict{String,Int64} with 3 entries: \u0026#34;qwer2\u0026#34; =\u0026gt; 2 \u0026#34;asdf\u0026#34; =\u0026gt; 3 \u0026#34;qwer1\u0026#34; =\u0026gt; 1 julia\u0026gt; foo[\u0026#34;q[TAB] \u0026#34;qwer1\u0026#34; \u0026#34;qwer2\u0026#34; julia\u0026gt; foo[\u0026#34;qwer è‡ªå®šä¹‰é¢œè‰² Julia å’Œ REPL æ‰€ä½¿ç”¨çš„é¢œè‰²ä¹Ÿæ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ã€‚è¦æ”¹å˜ Julia æç¤ºç¬¦çš„é¢œè‰²ï¼Œæ‚¨å¯ä»¥åœ¨æ‚¨çš„ ~/.julia/config/startup.jl æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œè¯¥æ–‡ä»¶åº”æ”¾åœ¨æ‚¨çš„ä¸»ç›®å½•ä¸­ã€‚\nfunction customize_colors(repl) repl.prompt_color = Base.text_colors[:cyan] end atreplinit(customize_colors) å¯ç”¨çš„é¢œè‰²é”®å¯ä»¥é€šè¿‡åœ¨ REPL çš„å¸®åŠ©æ¨¡å¼ä¸‹è¾“å…¥ Base.text_colors æ¥æŸ¥çœ‹ã€‚æ­¤å¤–ï¼Œå¯¹äºæ”¯æŒ 256 è‰²çš„ç»ˆç«¯æ¥è¯´ï¼Œæ•´æ•° 0 åˆ° 255 å¯ä»¥ç”¨ä½œé¢œè‰²é”®ã€‚\nä¹Ÿå¯ä»¥é€šè¿‡åœ¨ä¸Šé¢çš„ customize_colors å‡½æ•°ä¸­è®¾ç½® repl çš„ç›¸åº”å­—æ®µï¼ˆåˆ†åˆ«ä¸º help_colorã€shell_colorã€input_color å’Œ answer_colorï¼‰æ¥æ”¹å˜å¸®åŠ©å’Œ shell æç¤ºç¬¦ä»¥åŠè¾“å…¥å’Œå›ç­”æ–‡å­—çš„é¢œè‰²ã€‚å¯¹äºåä¸¤è€…ï¼Œè¦ç¡®ä¿ envcolors å­—æ®µä¹Ÿè®¾ç½®ä¸º falseã€‚\nä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨ Base.text_colors[:bold] ä½œä¸ºé¢œè‰²æ¥åº”ç”¨ç²—ä½“æ ¼å¼ã€‚ä¾‹å¦‚ï¼Œè¦ç”¨ç²—ä½“å­—æ‰“å°ç­”æ¡ˆï¼Œå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„ ~/.julia/config/startup.jl:\nfunction customize_colors(repl) repl.envcolors = false repl.answer_color = Base.text_colors[:bold] end atreplinit(customize_colors) ä½ ä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½®é€‚å½“çš„ç¯å¢ƒå˜é‡æ¥å®šåˆ¶ç”¨äºæ¸²æŸ“è­¦å‘Šå’Œä¿¡æ¯æ¶ˆæ¯çš„é¢œè‰²ã€‚ä¾‹å¦‚ï¼Œè¦åˆ†åˆ«ç”¨æ´‹çº¢è‰²ã€é»„è‰²å’Œé’è‰²æ¥æ¸²æŸ“é”™è¯¯ã€è­¦å‘Šå’Œä¿¡æ¯æ¶ˆæ¯ï¼Œä½ å¯ä»¥åœ¨ ~/.julia/config/startup.jl æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹å†…å®¹:\nENV[\u0026#34;JULIA_ERROR_COLOR\u0026#34;] = :magenta ENV[\u0026#34;JULIA_WARN_COLOR\u0026#34;] = :yellow ENV[\u0026#34;JULIA_INFO_COLOR\u0026#34;] = :cyan TerminalMenus TerminalMenus æ˜¯ Julia REPL çš„ä¸€ä¸ªå­æ¨¡å—ï¼Œå¯ä»¥åœ¨ç»ˆç«¯ä¸­å®ç°å°å‹ã€ä½é…çš„äº¤äº’å¼èœå•ã€‚\nä¾‹å­ import REPL using REPL.TerminalMenus options = [\u0026#34;apple\u0026#34;, \u0026#34;orange\u0026#34;, \u0026#34;grape\u0026#34;, \u0026#34;strawberry\u0026#34;, \u0026#34;blueberry\u0026#34;, \u0026#34;peach\u0026#34;, \u0026#34;lemon\u0026#34;, \u0026#34;lime\u0026#34;] RadioMenu RadioMenu å…è®¸ç”¨æˆ·ä»åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªé€‰é¡¹ã€‚request å‡½æ•°æ˜¾ç¤ºäº¤äº’å¼èœå•å¹¶è¿”å›æ‰€é€‰é€‰é¡¹çš„ç´¢å¼•ã€‚å¦‚æœç”¨æˆ·æŒ‰ \u0026lsquo;q\u0026rsquo; æˆ– ctrl-cï¼Œrequest å°†è¿”å› -1ã€‚\n# `pagesize` is the number of items to be displayed at a time. # The UI will scroll if the number of options is greater # than the `pagesize` menu = RadioMenu(options, pagesize=4) # `request` displays the menu and returns the index after the # user has selected a choice choice = request(\u0026#34;Choose your favorite fruit:\u0026#34;, menu) if choice != -1 println(\u0026#34;Your favorite fruit is \u0026#34;, options[choice], \u0026#34;!\u0026#34;) else println(\u0026#34;Menu canceled.\u0026#34;) end è¾“å‡º:\nChoose your favorite fruit: ^ grape strawberry \u0026gt; blueberry v peach Your favorite fruit is blueberry! MultiSelectMenu å¤šé‡é€‰æ‹©èœå•ï¼ˆMultiSelectMenuï¼‰å…è®¸ç”¨æˆ·ä»ä¸€ä¸ªåˆ—è¡¨ä¸­é€‰æ‹©è®¸å¤šé€‰æ‹©ã€‚\n# here we use the default `pagesize` 10 menu = MultiSelectMenu(options) # `request` returns a `Set` of selected indices # if the menu us canceled (ctrl-c or q), return an empty set choices = request(\u0026#34;Select the fruits you like:\u0026#34;, menu) if length(choices) \u0026gt; 0 println(\u0026#34;You like the following fruits:\u0026#34;) for i in choices println(\u0026#34; - \u0026#34;, options[i]) end else println(\u0026#34;Menu canceled.\u0026#34;) end è¾“å‡º:\nSelect the fruits you like: [press: d=done, a=all, n=none] [ ] apple \u0026gt; [X] orange [X] grape [ ] strawberry [ ] blueberry [X] peach [ ] lemon [ ] lime You like the following fruits: - orange - grape - peach Customization / Configuration æ‰€æœ‰çš„ç•Œé¢å®šåˆ¶éƒ½æ˜¯é€šè¿‡å…³é”®å­— TerminalMenus.config() å‡½æ•°å®Œæˆçš„ã€‚\nå‚æ•°  charset::Symbol=:na: è¦ä½¿ç”¨çš„uiå­—ç¬¦(:ascii æˆ– :unicode); è¢«å…¶ä»–å‚æ•°è¦†ç›–ã€‚ cursor::Char='\u0026gt;'|'â†’': å…‰æ ‡ä½¿ç”¨çš„å­—ç¬¦ã€‚ up_arrow::Char='^'|'â†‘': ç”¨äºå‘ä¸Šç®­å¤´çš„å­—ç¬¦ã€‚ down_arrow::Char='v'|'â†“': ç”¨äºå‘ä¸‹ç®­å¤´çš„å­—ç¬¦ã€‚ checked::String=\u0026quot;[X]\u0026quot;|\u0026quot;âœ“\u0026quot;ï¼šç”¨äºæ£€æŸ¥çš„å­—ç¬¦ä¸²ã€‚ unchecked::String=\u0026quot;[]\u0026quot;|\u0026quot;â¬š\u0026quot;)ï¼šç”¨äºæœªé€‰ä¸­çš„å­—ç¬¦ä¸²ã€‚ scroll::Symbol=:na: å¦‚æœ :wrapï¼Œåˆ™å°†å…‰æ ‡ç¯ç»•åœ¨é¡¶éƒ¨å’Œåº•éƒ¨ï¼Œå¦‚æœ :nowrap åˆ™ä¸ç¯ç»•å…‰æ ‡ã€‚ supress_output::Bool=falseã€‚ç”¨äºæµ‹è¯•ã€‚å¦‚æœä¸ºçœŸï¼Œèœå•ä¸ä¼šè¢«æ‰“å°åˆ°æ§åˆ¶å°ã€‚ ctrl_c_interrupt::Bool=true: å¦‚æœä¸ºå‡ï¼Œåœ¨ ^C æ—¶è¿”å›ç©ºï¼Œå¦‚æœä¸ºçœŸï¼Œåœ¨ ^C æ—¶æŠ›å‡º InterruptException()ã€‚  ä¾‹å­ julia\u0026gt; menu = MultiSelectMenu(options, pagesize=5); julia\u0026gt; request(menu) # ASCII is used by default [press: d=done, a=all, n=none] [ ] apple [X] orange [ ] grape \u0026gt; [X] strawberry v [ ] blueberry Set([4, 2]) julia\u0026gt; TerminalMenus.config(charset=:unicode) julia\u0026gt; request(menu) [press: d=done, a=all, n=none] â¬š apple âœ“ orange â¬š grape â†’ âœ“ strawberry â†“ â¬š blueberry Set([4, 2]) julia\u0026gt; TerminalMenus.config(checked=\u0026#34;YEP!\u0026#34;, unchecked=\u0026#34;NOPE\u0026#34;, cursor=\u0026#39;â§\u0026#39;) julia\u0026gt; request(menu) [press: d=done, a=all, n=none] NOPE apple YEP! orange NOPE grape â§ YEP! strawberry â†“ NOPE blueberry Set([4, 2]) å‚è€ƒ Base.atreplinit\n atreplinit(f)\n æ³¨å†Œä¸€ä¸ªå•å‚æ•°å‡½æ•°ï¼Œåœ¨äº¤äº’å¼ä¼šè¯ä¸­ï¼Œåœ¨ REPL æ¥å£åˆå§‹åŒ–ä¹‹å‰è¢«è°ƒç”¨ï¼›è¿™å¯¹è‡ªå®šä¹‰æ¥å£å¾ˆæœ‰ç”¨ã€‚f çš„å‚æ•°æ˜¯ REPL å¯¹è±¡ã€‚è¿™ä¸ªå‡½æ•°åº”è¯¥åœ¨ ~/.julia/config/startup.jl åˆå§‹åŒ–æ–‡ä»¶ä¸­è°ƒç”¨ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-21-repl-in-julia/","tags":["Julia","Julia å®˜æ–¹æ–‡æ¡£"],"title":"Julia ä¸­çš„ REPL"},{"categories":["Flink"],"contents":"ä½¿ç”¨çŠ¶æ€ åœ¨æœ¬èŠ‚ä¸­ï¼Œæ‚¨å°†äº†è§£ Flink ä¸ºç¼–å†™æœ‰çŠ¶æ€ç¨‹åºæä¾›çš„ APIã€‚è¯·çœ‹ Stateful Stream Processing æ¥äº†è§£æœ‰çŠ¶æ€æµå¤„ç†èƒŒåçš„æ¦‚å¿µã€‚\nKeyed DataStream å¦‚æœè¦ä½¿ç”¨ keyed stateï¼Œé¦–å…ˆéœ€è¦åœ¨ DataStream ä¸ŠæŒ‡å®šä¸€ä¸ªé”®ï¼Œè¿™ä¸ªé”®åº”è¯¥ç”¨æ¥åˆ†éš”(partition)çŠ¶æ€ï¼ˆä¹ŸåŒ…æ‹¬æµä¸­çš„è®°å½•æœ¬èº«ï¼‰ã€‚ä½ å¯ä»¥åœ¨ DataStream ä¸Šä½¿ç”¨ keyBy(KeySelector) æŒ‡å®šä¸€ä¸ªé”®ã€‚è¿™å°†äº§ç”Ÿä¸€ä¸ª KeyedDataStreamï¼Œç„¶åå…è®¸ä½¿ç”¨ keyed state çš„æ“ä½œã€‚\né”®é€‰æ‹©å‡½æ•°å°†ä¸€æ¡è®°å½•ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¿”å›è¯¥è®°å½•çš„é”®ã€‚é”®å¯ä»¥æ˜¯ä»»ä½•ç±»å‹çš„ï¼Œå¹¶ä¸”å¿…é¡»ä»ç¡®å®šæ€§è®¡ç®—ä¸­å¯¼å‡ºã€‚\nFlink çš„æ•°æ®æ¨¡å‹ä¸æ˜¯åŸºäºé”®å€¼å¯¹çš„ã€‚å› æ­¤ï¼Œæ‚¨ä¸éœ€è¦å°†æ•°æ®é›†ç±»å‹ç‰©ç†åœ°æ‰“åŒ…æˆé”®å’Œå€¼ã€‚é”®æ˜¯\u0026quot;è™šæ‹Ÿ\u0026quot;çš„ï¼šå®ƒä»¬è¢«å®šä¹‰ä¸ºå®é™…æ•°æ®ä¸Šçš„å‡½æ•°ï¼Œä»¥æŒ‡å¯¼åˆ†ç»„æ“ä½œç¬¦ã€‚\nä¸‹é¢çš„ä¾‹å­æ˜¾ç¤ºäº†ä¸€ä¸ªé”®é€‰æ‹©å‡½æ•°ï¼Œå®ƒåªæ˜¯è¿”å›å¯¹è±¡çš„å­—æ®µã€‚\n// æ™®é€šçš„ case ç±» case class WC(word: String, count: Int) val words: DataStream[WC] = // [...] val keyed = words.keyBy( _.word ) å…ƒç»„é”®å’Œè¡¨è¾¾å¼é”® Flink è¿˜æœ‰ä¸¤ç§å®šä¹‰é”®çš„æ–¹æ³•ï¼šå…ƒç»„é”®å’Œè¡¨è¾¾å¼é”®ã€‚æœ‰äº†å®ƒï¼Œä½ å¯ä»¥ä½¿ç”¨å…ƒç»„å­—æ®µç´¢å¼•æˆ–è¡¨è¾¾å¼æ¥æŒ‡å®šé”®ï¼Œç”¨äºé€‰æ‹©å¯¹è±¡çš„å­—æ®µã€‚æˆ‘ä»¬ä»Šå¤©ä¸æ¨èä½¿ç”¨è¿™äº›ï¼Œä½†ä½ å¯ä»¥å‚è€ƒ DataStream çš„ Javadoc æ¥äº†è§£å®ƒä»¬ã€‚ä¸¥æ ¼æ¥è¯´ï¼Œä½¿ç”¨ KeySelector å‡½æ•°æ›´èƒœä¸€ç­¹ï¼šä½¿ç”¨ Java lambdasï¼Œå®ƒä»¬å¾ˆå®¹æ˜“ä½¿ç”¨ï¼Œè€Œä¸”å®ƒä»¬åœ¨è¿è¡Œæ—¶çš„å¼€é”€å¯èƒ½æ›´å°‘ã€‚\nä½¿ç”¨ Keyed State keyed State æ¥å£æä¾›äº†å¯¹ä¸åŒç±»å‹çš„çŠ¶æ€çš„è®¿é—®ï¼Œè¿™äº›çŠ¶æ€çš„ä½œç”¨åŸŸéƒ½æ˜¯å½“å‰è¾“å…¥å…ƒç´ çš„é”®ã€‚è¿™æ„å‘³ç€ï¼Œè¿™ç§ç±»å‹çš„çŠ¶æ€åªèƒ½åœ¨ KeyedStream ä¸Šä½¿ç”¨ï¼Œå®ƒå¯ä»¥é€šè¿‡ stream.keyBy(...) æ¥åˆ›å»ºã€‚\nç°åœ¨ï¼Œæˆ‘ä»¬å°†é¦–å…ˆçœ‹çœ‹ä¸åŒç±»å‹çš„çŠ¶æ€æœ‰å“ªäº›ï¼Œç„¶åæˆ‘ä»¬ä¼šçœ‹çœ‹å¦‚ä½•åœ¨ç¨‹åºä¸­ä½¿ç”¨å®ƒä»¬ã€‚å¯ç”¨çš„çŠ¶æ€åŸè¯­æœ‰:\n  ValueState\u0026lt;T\u0026gt;ï¼šå®ƒä¿ç•™äº†ä¸€ä¸ªå¯æ›´æ–°å’Œæ£€ç´¢çš„å€¼ï¼ˆå¦‚ä¸Šæ‰€è¿°ï¼Œä½œç”¨åŸŸä¸ºè¾“å…¥å…ƒç´ çš„é”®ï¼Œå› æ­¤æ“ä½œç¬¦æ‰€çœ‹åˆ°çš„æ¯ä¸ªé”®éƒ½å¯èƒ½æœ‰ä¸€ä¸ªå€¼ï¼‰ã€‚è¿™ä¸ªå€¼å¯ä»¥ä½¿ç”¨ update(T) æ¥è®¾ç½®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ T value() æ¥æ£€ç´¢ã€‚\n  ListState\u0026lt;T\u0026gt;ï¼šè¿™ä¿å­˜äº†ä¸€ä¸ªå…ƒç´ åˆ—è¡¨ã€‚ä½ å¯ä»¥åœ¨æ‰€æœ‰å½“å‰å­˜å‚¨çš„å…ƒç´ ä¸Šè¿½åŠ å…ƒç´ å’Œæ£€ç´¢ä¸€ä¸ª Iterableã€‚ä½¿ç”¨ add(T) æˆ– addAll(List\u0026lt;T\u0026gt;) æ·»åŠ å…ƒç´ ï¼Œå¯ä»¥ä½¿ç”¨ Iterable\u0026lt;T\u0026gt; get() æ£€ç´¢ Iterableã€‚ä½ ä¹Ÿå¯ä»¥ç”¨ update(List\u0026lt;T\u0026gt;) è¦†ç›–ç°æœ‰çš„åˆ—è¡¨ã€‚\n  ReducingState\u0026lt;T\u0026gt;: è¿™ä¿ç•™äº†ä¸€ä¸ªå•ä¸€çš„å€¼ï¼Œä»£è¡¨æ‰€æœ‰æ·»åŠ åˆ°çŠ¶æ€çš„å€¼çš„é›†åˆã€‚è¯¥æ¥å£ç±»ä¼¼äº ListStateï¼Œä½†ä½¿ç”¨ add(T) æ·»åŠ çš„å…ƒç´ ä¼šä½¿ç”¨æŒ‡å®šçš„ ReduceFunction è¢«åŒ–ç®€æˆä¸€ä¸ªæ€»è®¡ã€‚\n  AggregatingState\u0026lt;INï¼ŒOUT\u0026gt;ï¼šè¿™ä¿ç•™äº†ä¸€ä¸ªå•ä¸€çš„å€¼ï¼Œä»£è¡¨æ‰€æœ‰æ·»åŠ åˆ°çŠ¶æ€çš„å€¼çš„èšåˆã€‚ä¸ ReducingState ç›¸åï¼Œaggregate ç±»å‹å¯èƒ½ä¸æ·»åŠ åˆ°çŠ¶æ€ä¸­çš„å…ƒç´ ç±»å‹ä¸åŒã€‚æ¥å£ä¸ ListState ç›¸åŒï¼Œä½†ä½¿ç”¨ add(IN) æ·»åŠ çš„å…ƒç´ ä¼šä½¿ç”¨æŒ‡å®šçš„ AggregateFunction è¿›è¡Œèšåˆã€‚\n  MapState\u0026lt;UK, UV\u0026gt;: å®ƒä¿å­˜äº†ä¸€ä¸ªæ˜ å°„åˆ—è¡¨ã€‚ä½ å¯ä»¥å°†é”®å€¼å¯¹æ”¾å…¥çŠ¶æ€ä¸­ï¼Œå¹¶åœ¨æ‰€æœ‰å½“å‰å­˜å‚¨çš„æ˜ å°„ä¸Šæ£€ç´¢ä¸€ä¸ª Iterableã€‚ä½¿ç”¨ put(UK, UV) æˆ– putAll(Map\u0026lt;UK, UV\u0026gt;) å¯ä»¥æ·»åŠ æ˜ å°„ã€‚ä¸ç”¨æˆ·é”®ç›¸å…³è”çš„å€¼å¯ä»¥ä½¿ç”¨ get(UK) æ¥æ£€ç´¢ã€‚å¯ä»¥åˆ†åˆ«ä½¿ç”¨ entries()ã€keys() å’Œ values() æ£€ç´¢æ˜ å°„ã€é”®å’Œå€¼çš„å¯è¿­ä»£è§†å›¾ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ isEmpty() æ¥æ£€æŸ¥è¿™ä¸ªæ˜ å°„æ˜¯å¦åŒ…å«ä»»ä½•é”®å€¼æ˜ å°„ã€‚\n  æ‰€æœ‰ç±»å‹çš„çŠ¶æ€ä¹Ÿéƒ½æœ‰ä¸€ä¸ªæ–¹æ³• clear()ï¼Œå¯ä»¥æ¸…é™¤å½“å‰æ´»åŠ¨é”®çš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯è¾“å…¥å…ƒç´ çš„é”®ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›çŠ¶æ€å¯¹è±¡åªç”¨äºå¸¦çŠ¶æ€çš„æ¥å£ã€‚çŠ¶æ€ä¸ä¸€å®šå­˜å‚¨åœ¨é‡Œé¢ï¼Œè€Œå¯èƒ½é©»ç•™åœ¨ç£ç›˜æˆ–å…¶ä»–åœ°æ–¹ã€‚ç¬¬äºŒä»¶è¦è®°ä½çš„äº‹æƒ…æ˜¯ï¼Œä½ ä»çŠ¶æ€ä¸­å¾—åˆ°çš„å€¼å–å†³äºè¾“å…¥å…ƒç´ çš„é”®ã€‚å› æ­¤ï¼Œå¦‚æœæ‰€æ¶‰åŠçš„é”®ä¸åŒï¼Œä½ åœ¨ç”¨æˆ·å‡½æ•°çš„ä¸€æ¬¡è°ƒç”¨ä¸­å¾—åˆ°çš„å€¼å¯èƒ½ä¸å¦ä¸€æ¬¡è°ƒç”¨ä¸­çš„å€¼ä¸åŒã€‚\nä¸ºäº†å¾—åˆ°ä¸€ä¸ªçŠ¶æ€å¥æŸ„ï¼Œä½ å¿…é¡»åˆ›å»ºä¸€ä¸ª StateDescriptorã€‚è¿™é‡Œé¢åŒ…å«äº†çŠ¶æ€çš„åç§°(æˆ‘ä»¬ç¨åä¼šçœ‹åˆ°ï¼Œä½ å¯ä»¥åˆ›å»ºå¤šä¸ªçŠ¶æ€ï¼Œè€Œä¸”å®ƒä»¬å¿…é¡»æœ‰ç‹¬ç‰¹çš„åç§°ï¼Œè¿™æ ·ä½ æ‰èƒ½å¼•ç”¨å®ƒä»¬)ï¼ŒçŠ¶æ€æ‰€æ‹¥æœ‰çš„å€¼çš„ç±»å‹ï¼Œå¯èƒ½è¿˜æœ‰ä¸€ä¸ªç”¨æˆ·æŒ‡å®šçš„å‡½æ•°ï¼Œæ¯”å¦‚ ReduceFunctionã€‚æ ¹æ®ä½ è¦æ£€ç´¢çš„çŠ¶æ€ç±»å‹ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª ValueStateDescriptorã€ä¸€ä¸ª ListStateDescriptorã€ä¸€ä¸ª ReducingStateDescriptor æˆ–ä¸€ä¸ª MapStateDescriptorã€‚\nçŠ¶æ€æ˜¯ä½¿ç”¨ RuntimeContext è®¿é—®çš„ï¼Œæ‰€ä»¥åªæœ‰åœ¨å¯Œå‡½æ•°(rich functions)ä¸­æ‰æœ‰å¯èƒ½ã€‚è¯·çœ‹è¿™é‡Œäº†è§£ç›¸å…³ä¿¡æ¯ï¼Œä½†æˆ‘ä»¬ä¹Ÿä¼šå¾ˆå¿«çœ‹åˆ°ä¸€ä¸ªä¾‹å­ã€‚RichFunction ä¸­å¯ç”¨çš„ RuntimeContext æœ‰è¿™äº›æ–¹æ³•æ¥è®¿é—®çŠ¶æ€ã€‚\n ValueStategetState(ValueStateDescriptor) ReducingStategetReducingState(ReducingStateDescriptor) ListStategetListState(ListStateDescriptor) AggregatingState\u0026lt;IN, OUT\u0026gt; getAggregatingState(AggregatingStateDescriptor\u0026lt;IN, ACC, OUT\u0026gt;) MapState\u0026lt;UK, UV\u0026gt; getMapState(MapStateDescriptor\u0026lt;UK, UV\u0026gt;)  è¿™æ˜¯ä¸€ä¸ª FlatMapFunction çš„ä¾‹å­ï¼Œå®ƒå±•ç¤ºäº†æ‰€æœ‰çš„éƒ¨åˆ†æ˜¯å¦‚ä½•ç»“åˆåœ¨ä¸€èµ·çš„ã€‚\nclass CountWindowAverage extends RichFlatMapFunction[(Long, Long), (Long, Long)] { private var sum: ValueState[(Long, Long)] = _ override def flatMap(input: (Long, Long), out: Collector[(Long, Long)]): Unit = { // è®¿é—®çŠ¶æ€å€¼  val tmpCurrentSum = sum.value // å¦‚æœä¹‹å‰æ²¡æœ‰ä½¿ç”¨è¿‡ï¼Œåˆ™ä¸º nullã€‚  val currentSum = if (tmpCurrentSum != null) { tmpCurrentSum } else { (0L, 0L) } // æ›´æ–°æ¬¡æ•°  val newSum = (currentSum._1 + 1, currentSum._2 + input._2) // æ›´æ–°çŠ¶æ€  sum.update(newSum) // å¦‚æœè®¡æ•°è¾¾åˆ°2ï¼Œåˆ™å‘å‡ºå¹³å‡æ•°ï¼Œå¹¶æ¸…é™¤çŠ¶æ€ã€‚  if (newSum._1 \u0026gt;= 2) { out.collect((input._1, newSum._2 / newSum._1)) sum.clear() } } override def open(parameters: Configuration): Unit = { sum = getRuntimeContext.getState( new ValueStateDescriptor[(Long, Long)](\u0026#34;average\u0026#34;, createTypeInformation[(Long, Long)]) ) } } object ExampleCountWindowAverage extends App { val env = StreamExecutionEnvironment.getExecutionEnvironment env.fromCollection(List( (1L, 3L), (1L, 5L), (1L, 7L), (1L, 4L), (1L, 2L) )).keyBy(_._1) .flatMap(new CountWindowAverage()) .print() // the printed output will be (1,4) and (1,5)  env.execute(\u0026#34;ExampleKeyedState\u0026#34;) } è¿™ä¸ªä¾‹å­å®ç°äº†ä¸€ä¸ªç©·äººçš„è®¡æ•°çª—å£ã€‚æˆ‘ä»¬ç”¨ç¬¬ä¸€ä¸ªå­—æ®µå¯¹å…ƒç»„è¿›è¡Œ keyed æ“ä½œï¼ˆåœ¨æœ¬ä¾‹ä¸­ï¼Œæ‰€æœ‰å…ƒç»„éƒ½æœ‰ç›¸åŒçš„é”® 1ï¼‰ã€‚è¯¥å‡½æ•°å°†è®¡æ•°å’Œè¿è¡Œçš„æ€»å’Œå­˜å‚¨åœ¨ä¸€ä¸ª ValueState ä¸­ã€‚ä¸€æ—¦è®¡æ•°è¾¾åˆ° 2ï¼Œå®ƒå°±ä¼šå‘å‡ºå¹³å‡æ•°å¹¶æ¸…é™¤çŠ¶æ€ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä» 0 å¼€å§‹ã€‚æ³¨æ„ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ç¬¬ä¸€ä¸ªå­—æ®µä¸­çš„å…ƒç»„å…·æœ‰ä¸åŒçš„å€¼ï¼Œé‚£ä¹ˆè¿™å°†ä¸ºæ¯ä¸ªä¸åŒçš„è¾“å…¥é”®ä¿æŒä¸åŒçš„çŠ¶æ€å€¼ã€‚\nçŠ¶æ€å­˜æ´»æ—¶é—´(TTL) å¯ä»¥ä¸ºä»»ä½•ç±»å‹çš„ keyed state åˆ†é…ä¸€ä¸ªç”Ÿå­˜æ—¶é—´ï¼ˆTTLï¼‰ã€‚å¦‚æœé…ç½®äº† TTLï¼Œå¹¶ä¸”çŠ¶æ€å€¼å·²ç»è¿‡æœŸï¼Œå­˜å‚¨çš„å€¼å°†åœ¨å°½åŠ›çš„åŸºç¡€ä¸Šè¿›è¡Œæ¸…ç†ï¼Œè¿™å°†åœ¨ä¸‹é¢è¯¦ç»†è®¨è®ºã€‚\næ‰€æœ‰çŠ¶æ€é›†åˆç±»å‹éƒ½æ”¯æŒæ¯ä¸ªæ¡ç›®çš„ TTLã€‚è¿™æ„å‘³ç€åˆ—è¡¨å…ƒç´ å’Œæ˜ å°„æ¡ç›®ç‹¬ç«‹è¿‡æœŸã€‚\nä¸ºäº†ä½¿ç”¨çŠ¶æ€ TTLï¼Œå¿…é¡»é¦–å…ˆå»ºç«‹ä¸€ä¸ª StateTtlConfig é…ç½®å¯¹è±¡ã€‚ç„¶åå¯ä»¥é€šè¿‡ä¼ é€’é…ç½®åœ¨ä»»ä½•çŠ¶æ€æè¿°ç¬¦ä¸­å¯ç”¨ TTL åŠŸèƒ½ã€‚\nimport org.apache.flink.api.common.state.StateTtlConfig import org.apache.flink.api.common.state.ValueStateDescriptor import org.apache.flink.api.common.time.Time val ttlConfig = StateTtlConfig .newBuilder(Time.seconds(1)) .setUpdateType(StateTtlConfig.UpdateType.OnCreateAndWrite) .setStateVisibility(StateTtlConfig.StateVisibility.NeverReturnExpired) .build val stateDescriptor = new ValueStateDescriptor[String](\u0026#34;text state\u0026#34;, classOf[String]) stateDescriptor.enableTimeToLive(ttlConfig) é…ç½®æœ‰å‡ ä¸ªé€‰é¡¹éœ€è¦è€ƒè™‘ã€‚\nnewBuilder æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¼ºåˆ¶æ€§çš„ï¼Œå®ƒæ˜¯å­˜æ´»çš„æ—¶é—´å€¼ã€‚\næ›´æ–°ç±»å‹é…ç½®çŠ¶æ€ TTL ä½•æ—¶è¢«åˆ·æ–°ï¼ˆé»˜è®¤ä¸º OnCreateAndWriteï¼‰ã€‚\n StateTtlConfig.UpdateType.OnCreateAndWrite - ä»…åœ¨åˆ›å»ºå’Œå†™å…¥è®¿é—®æ—¶æ‰ä¼šå‡ºç° StateTtlConfig.UpdateType.OnReadAndWrite - ä¹Ÿæ˜¯åœ¨è¯»çš„æ—¶å€™ã€‚  çŠ¶æ€å¯è§æ€§é…ç½®å¦‚æœè¿‡æœŸå€¼å°šæœªæ¸…ç†ï¼Œæ˜¯å¦åœ¨è¯»å–è®¿é—®æ—¶è¿”å›ï¼ˆé»˜è®¤ä¸º NeverReturnExpiredï¼‰ã€‚\n StateTtlConfig.StateVisibility.NeverReturnExpired - è¿‡æœŸå€¼æ°¸ä¸è¿”å› StateTtlConfig.StateVisibility.ReturnExpiredIfNotCleanedUp - å¦‚æœä»ç„¶å¯ç”¨åˆ™è¿”å›ã€‚  åœ¨ NeverReturnExpired çš„æƒ…å†µä¸‹ï¼Œè¿‡æœŸçŠ¶æ€å°±åƒä¸å­˜åœ¨ä¸€æ ·ï¼Œå³ä½¿å®ƒä»ç„¶å¿…é¡»è¢«åˆ é™¤ã€‚è¿™ä¸ªé€‰é¡¹å¯¹äºæ•°æ®åœ¨ TTL ä¹‹åå¿…é¡»ä¸¥æ ¼åœ°æˆä¸ºä¸å¯è¯»çš„è®¿é—®çŠ¶æ€çš„ç”¨ä¾‹æ˜¯å¾ˆæœ‰ç”¨çš„ï¼Œä¾‹å¦‚å¤„ç†éšç§æ•æ„Ÿæ•°æ®çš„åº”ç”¨ç¨‹åºã€‚\nå¦ä¸€ä¸ªé€‰é¡¹ ReturnExpiredIfNotCleanedUp å…è®¸åœ¨æ¸…ç†ä¹‹å‰è¿”å›è¿‡æœŸçŠ¶æ€ã€‚\næ³¨æ„:\n  çŠ¶æ€åç«¯å­˜å‚¨æœ€åä¸€æ¬¡ä¿®æ”¹çš„æ—¶é—´æˆ³å’Œç”¨æˆ·å€¼ï¼Œè¿™æ„å‘³ç€å¯ç”¨è¯¥åŠŸèƒ½ä¼šå¢åŠ çŠ¶æ€å­˜å‚¨çš„æ¶ˆè€—ã€‚Heap çŠ¶æ€åç«¯åœ¨å†…å­˜ä¸­å­˜å‚¨äº†ä¸€ä¸ªé¢å¤–çš„ Java å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æœ‰ä¸€ä¸ªå¯¹ç”¨æˆ·çŠ¶æ€å¯¹è±¡çš„å¼•ç”¨å’Œä¸€ä¸ªåŸå§‹çš„é•¿å€¼ã€‚RocksDB çŠ¶æ€åç«¯æ¯å­˜å‚¨ä¸€ä¸ªå€¼ã€åˆ—è¡¨é¡¹æˆ–æ˜ å°„é¡¹å¢åŠ 8ä¸ªå­—èŠ‚ã€‚\n  ç›®å‰åªæ”¯æŒå‚è€ƒå¤„ç†æ—¶é—´çš„ TTLã€‚\n  è¯•å›¾ä½¿ç”¨å¯ç”¨ TTL çš„æè¿°ç¬¦æ¥æ¢å¤ä¹‹å‰æ²¡æœ‰é…ç½® TTL çš„çŠ¶æ€ï¼Œæˆ–è€…åä¹‹ï¼Œå°†å¯¼è‡´å…¼å®¹æ€§å¤±è´¥å’Œ StateMigrationExceptionã€‚\n  TTL é…ç½®ä¸æ˜¯æ£€æŸ¥ç‚¹æˆ–ä¿å­˜ç‚¹çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯ Flink åœ¨å½“å‰è¿è¡Œçš„ä½œä¸šä¸­å¦‚ä½•å¤„ç†çš„ä¸€ç§æ–¹å¼ã€‚\n  å¸¦ TTL çš„æ˜ å°„çŠ¶æ€ç›®å‰åªæœ‰åœ¨ç”¨æˆ·å€¼åºåˆ—åŒ–å™¨èƒ½å¤Ÿå¤„ç† null å€¼çš„æƒ…å†µä¸‹æ‰æ”¯æŒ null ç”¨æˆ·å€¼ã€‚å¦‚æœåºåˆ—åŒ–å™¨ä¸æ”¯æŒç©ºå€¼ï¼Œå¯ä»¥ç”¨ NullableSerializer åŒ…è£…ï¼Œä»£ä»·æ˜¯åœ¨åºåˆ—åŒ–å½¢å¼ä¸­å¤šå‡ºä¸€ä¸ªå­—èŠ‚ã€‚\n  è¿‡æœŸçŠ¶æ€çš„æ¸…ç† é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿‡æœŸçš„å€¼ä¼šåœ¨è¯»å–æ—¶æ˜¾å¼åˆ é™¤ï¼Œå¦‚ ValueState#valueï¼Œå¦‚æœé…ç½®çš„çŠ¶æ€åå°æ”¯æŒï¼Œåˆ™ä¼šå®šæœŸåœ¨åå°è¿›è¡Œåƒåœ¾å›æ”¶ã€‚åå°æ¸…ç†å¯ä»¥åœ¨ StateTtlConfig ä¸­ç¦ç”¨ã€‚\nimport org.apache.flink.api.common.state.StateTtlConfig val ttlConfig = StateTtlConfig .newBuilder(Time.seconds(1)) .disableCleanupInBackground .build å¦‚æœæƒ³å¯¹åå°çš„ä¸€äº›ç‰¹æ®Šæ¸…ç†è¿›è¡Œæ›´ç²¾ç»†çš„æ§åˆ¶ï¼Œå¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æè¿°å•ç‹¬é…ç½®ã€‚ç›®å‰ï¼Œå †çŠ¶æ€åå°ä¾é å¢é‡æ¸…ç†ï¼ŒRocksDB åå°ä½¿ç”¨å‹å®è¿‡æ»¤å™¨è¿›è¡Œåå°æ¸…ç†ã€‚\nå…¨å¿«ç…§ä¸­çš„æ¸…ç† æ­¤å¤–ï¼Œæ‚¨å¯ä»¥åœ¨æ‹æ‘„å®Œæ•´çŠ¶æ€å¿«ç…§çš„ç¬é—´æ¿€æ´»æ¸…ç†ï¼Œè¿™å°†å‡å°‘å…¶å¤§å°ã€‚åœ¨å½“å‰çš„å®ç°ä¸‹ï¼Œæœ¬åœ°çŠ¶æ€ä¸ä¼šè¢«æ¸…ç†ï¼Œä½†åœ¨ä»ä¸Šä¸€ä¸ªå¿«ç…§æ¢å¤çš„æƒ…å†µä¸‹ï¼Œå®ƒå°†ä¸åŒ…æ‹¬åˆ é™¤çš„è¿‡æœŸçŠ¶æ€ã€‚å¯ä»¥åœ¨ StateTtlConfig ä¸­è¿›è¡Œé…ç½®ã€‚\nimport org.apache.flink.api.common.state.StateTtlConfig import org.apache.flink.api.common.time.Time val ttlConfig = StateTtlConfig .newBuilder(Time.seconds(1)) .cleanupFullSnapshot .build æ­¤é€‰é¡¹ä¸é€‚ç”¨äº RocksDB çŠ¶æ€åç«¯çš„å¢é‡æ£€æŸ¥ç‚¹ã€‚\næ³¨æ„:\n å¯¹äºç°æœ‰çš„ä½œä¸šï¼Œè¿™ä¸ªæ¸…ç†ç­–ç•¥å¯ä»¥åœ¨ StateTtlConfig ä¸­éšæ—¶æ¿€æ´»æˆ–åœç”¨ï¼Œä¾‹å¦‚ä»ä¿å­˜ç‚¹é‡æ–°å¯åŠ¨åã€‚  å¢é‡æ¸…ç† å¦ä¸€ç§é€‰æ‹©æ˜¯é€æ­¥è§¦å‘ä¸€äº›çŠ¶æ€æ¡ç›®çš„æ¸…ç†ã€‚è§¦å‘å™¨å¯ä»¥æ˜¯æ¯æ¬¡çŠ¶æ€è®¿é—®æˆ–/å’Œæ¯æ¬¡è®°å½•å¤„ç†çš„å›è°ƒã€‚å¦‚æœè¿™ç§æ¸…ç†ç­–ç•¥å¯¹æŸäº›çŠ¶æ€æ˜¯æ¿€æ´»çš„ï¼Œå­˜å‚¨åç«¯å°±ä¼šä¸ºè¿™ä¸ªçŠ¶æ€çš„æ‰€æœ‰æ¡ç›®ä¿ç•™ä¸€ä¸ªæƒ°æ€§çš„å…¨å±€è¿­ä»£å™¨ã€‚æ¯æ¬¡è§¦å‘å¢é‡æ¸…ç†æ—¶ï¼Œè¿­ä»£å™¨éƒ½ä¼šè¢«æå‰ã€‚å¯¹éå†è¿‡çš„çŠ¶æ€æ¡ç›®è¿›è¡Œæ£€æŸ¥ï¼Œå¯¹è¿‡æœŸçš„æ¡ç›®è¿›è¡Œæ¸…ç†ã€‚\nè¿™ä¸ªåŠŸèƒ½å¯ä»¥åœ¨ StateTtlConfig ä¸­é…ç½®ã€‚\nimport org.apache.flink.api.common.state.StateTtlConfig val ttlConfig = StateTtlConfig .newBuilder(Time.seconds(1)) .cleanupIncrementally(10, true) .build è¿™ä¸ªç­–ç•¥æœ‰ä¸¤ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªæ˜¯æ¯æ¬¡æ¸…ç†è§¦å‘çš„æ£€æŸ¥çŠ¶æ€æ¡ç›®æ•°ã€‚å®ƒæ€»æ˜¯åœ¨æ¯æ¬¡çŠ¶æ€è®¿é—®æ—¶è§¦å‘ã€‚ç¬¬äºŒä¸ªå‚æ•°å®šä¹‰æ˜¯å¦åœ¨æ¯æ¬¡è®°å½•å¤„ç†ä¸­é¢å¤–è§¦å‘æ¸…ç†ã€‚å †åç«¯é»˜è®¤çš„åå°æ¸…ç†æ¯æ¬¡è®°å½•å¤„ç†æ£€æŸ¥5ä¸ªæ¡ç›®è€Œä¸è¿›è¡Œæ¸…ç†ã€‚\næ³¨æ„:\n å¦‚æœæ²¡æœ‰å‘ç”Ÿå¯¹çŠ¶æ€çš„è®¿é—®æˆ–è€…æ²¡æœ‰å¤„ç†è®°å½•ï¼Œè¿‡æœŸçŠ¶æ€å°†æŒç»­å­˜åœ¨ã€‚ å¢é‡æ¸…ç†æ‰€èŠ±è´¹çš„æ—¶é—´ä¼šå¢åŠ è®°å½•å¤„ç†çš„å»¶è¿Ÿã€‚ ç›®å‰ï¼Œå¢é‡æ¸…ç†åªåœ¨å †çŠ¶æ€åç«¯å®ç°ã€‚å¯¹ RocksDB çš„è®¾ç½®ä¸ä¼šæœ‰å½±å“ã€‚ å¦‚æœå †çŠ¶æ€åç«¯ä¸åŒæ­¥å¿«ç…§ä¸€èµ·ä½¿ç”¨ï¼Œå…¨å±€è¿­ä»£å™¨åœ¨è¿­ä»£çš„æ—¶å€™ä¼šä¿ç•™æ‰€æœ‰é”®çš„å‰¯æœ¬ï¼Œå› ä¸ºå®ƒçš„å…·ä½“å®ç°ä¸æ”¯æŒå¹¶å‘ä¿®æ”¹ã€‚é‚£ä¹ˆå¯ç”¨è¿™ä¸ªåŠŸèƒ½ä¼šå¢åŠ å†…å­˜æ¶ˆè€—ã€‚å¼‚æ­¥å¿«ç…§åˆ™ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚ å¯¹äºç°æœ‰çš„ä½œä¸šï¼Œè¿™ä¸ªæ¸…ç†ç­–ç•¥å¯ä»¥åœ¨ StateTtlConfig ä¸­éšæ—¶æ¿€æ´»æˆ–åœç”¨ï¼Œä¾‹å¦‚ä»ä¿å­˜ç‚¹é‡æ–°å¯åŠ¨åã€‚  RocksDB å‹ç¼©è¿‡ç¨‹ä¸­çš„æ¸…ç† å¦‚æœä½¿ç”¨ RocksDB çŠ¶æ€åç«¯ï¼Œå°†è°ƒç”¨ Flink ç‰¹å®šçš„å‹å®è¿‡æ»¤å™¨è¿›è¡Œåå°æ¸…ç†ã€‚RocksDB ä¼šå®šæœŸè¿è¡Œå¼‚æ­¥å‹å®æ¥åˆå¹¶çŠ¶æ€æ›´æ–°ï¼Œå‡å°‘å­˜å‚¨é‡ã€‚Flink å‹å®è¿‡æ»¤å™¨é€šè¿‡ TTL æ£€æŸ¥çŠ¶æ€æ¡ç›®çš„è¿‡æœŸæ—¶é—´æˆ³ï¼Œæ’é™¤è¿‡æœŸå€¼ã€‚\nè¿™ä¸ªåŠŸèƒ½å¯ä»¥åœ¨ StateTtlConfig ä¸­é…ç½®ã€‚\nimport org.apache.flink.api.common.state.StateTtlConfig val ttlConfig = StateTtlConfig .newBuilder(Time.seconds(1)) .cleanupInRocksdbCompactFilter(1000) .build RocksDB å‹å®è¿‡æ»¤å™¨åœ¨å¤„ç†ä¸€å®šæ•°é‡çš„çŠ¶æ€æ¡ç›®åï¼Œæ¯æ¬¡éƒ½ä¼šä» Flink ä¸­æŸ¥è¯¢å½“å‰çš„æ—¶é—´æˆ³ï¼Œç”¨äºæ£€æŸ¥è¿‡æœŸæƒ…å†µï¼Œä½ å¯ä»¥æ”¹å˜å®ƒï¼Œå¹¶ä¼ é€’è‡ªå®šä¹‰å€¼ç»™ StateTtlConfig.newBuilder(...).cleanupInRocksdbCompactFilter(long queryTimeAfterNumEntries) æ–¹æ³•ã€‚æ›´é¢‘ç¹åœ°æ›´æ–°æ—¶é—´æˆ³å¯ä»¥æé«˜æ¸…ç†é€Ÿåº¦ï¼Œä½†ç”±äºå®ƒä½¿ç”¨äº†æ¥è‡ªæœ¬åœ°ä»£ç çš„ JNI è°ƒç”¨ï¼Œå› æ­¤é™ä½äº†å‹ç¼©æ€§èƒ½ã€‚RocksDB åå°é»˜è®¤çš„æ¸…ç†æ–¹å¼æ˜¯æ¯æ¬¡å¤„ç†1000ä¸ªæ¡ç›®åæŸ¥è¯¢å½“å‰æ—¶é—´æˆ³ã€‚\nä½ å¯ä»¥é€šè¿‡æ¿€æ´» FlinkCompactionFilter çš„è°ƒè¯•çº§åˆ«æ¥æ¿€æ´» RocksDB è¿‡æ»¤å™¨åŸç”Ÿä»£ç çš„è°ƒè¯•æ—¥å¿—ã€‚\nlog4j.logger.org.rocksdb.FlinkCompactionFilter=DEBUG æ³¨æ„:\n åœ¨å‹å®è¿‡ç¨‹ä¸­è°ƒç”¨ TTL è¿‡æ»¤å™¨ä¼šä½¿å…¶é€Ÿåº¦å‡æ…¢ã€‚TTL è¿‡æ»¤å™¨å¿…é¡»è§£ææœ€åä¸€æ¬¡è®¿é—®çš„æ—¶é—´æˆ³ï¼Œå¹¶æ£€æŸ¥æ¯ä¸ªè¢«å‹ç¼©çš„é”®çš„å­˜å‚¨çŠ¶æ€æ¡ç›®çš„åˆ°æœŸæ—¶é—´ã€‚å¦‚æœæ˜¯é›†åˆçŠ¶æ€ç±»å‹(list æˆ– map)ï¼Œæ¯ä¸ªå­˜å‚¨å…ƒç´ çš„æ£€æŸ¥ä¹Ÿä¼šè¢«è°ƒç”¨ã€‚ å¦‚æœè¯¥åŠŸèƒ½ç”¨äºå…·æœ‰éå›ºå®šå­—èŠ‚é•¿åº¦å…ƒç´ çš„åˆ—è¡¨çŠ¶æ€ï¼Œåˆ™åŸç”Ÿ TTL è¿‡æ»¤å™¨å¿…é¡»é¢å¤–è°ƒç”¨æ¯ä¸ªè‡³å°‘ç¬¬ä¸€ä¸ªå…ƒç´ å·²è¿‡æœŸçš„çŠ¶æ€æ¡ç›®ä¸­å…ƒç´ åœ¨ JNI ä¸Šçš„ Flink java ç±»å‹åºåˆ—åŒ–å™¨ï¼Œä»¥ç¡®å®šä¸‹ä¸€ä¸ªæœªè¿‡æœŸå…ƒç´ çš„åç§»ã€‚ å¯¹äºç°æœ‰çš„ä½œä¸šï¼Œè¿™ç§æ¸…ç†ç­–ç•¥å¯ä»¥åœ¨ StateTtlConfig ä¸­éšæ—¶æ¿€æ´»æˆ–åœç”¨ï¼Œä¾‹å¦‚ä»ä¿å­˜ç‚¹é‡æ–°å¯åŠ¨åã€‚  Scala DataStream API ä¸­çš„çŠ¶æ€ é™¤äº†ä¸Šé¢æè¿°çš„æ¥å£å¤–ï¼ŒScala API è¿˜ä¸º KeyedStream ä¸Šå…·æœ‰å•ä¸ª ValueState çš„æœ‰çŠ¶æ€ map() æˆ– flatMap() å‡½æ•°æä¾›äº†å¿«æ·æ–¹å¼ã€‚ç”¨æˆ·å‡½æ•°åœ¨ Option ä¸­è·å– ValueState çš„å½“å‰å€¼ï¼Œå¹¶ä¸”å¿…é¡»è¿”å›ä¸€ä¸ªæ›´æ–°çš„å€¼ï¼Œè¯¥å€¼å°†ç”¨äºæ›´æ–°çŠ¶æ€ã€‚\nval stream: DataStream[(String, Int)] = ... val counts: DataStream[(String, Int)] = stream .keyBy(_._1) .mapWithState((in: (String, Int), count: Option[Int]) =\u0026gt; count match { case Some(c) =\u0026gt; ( (in._1, c), Some(c + in._2) ) case None =\u0026gt; ( (in._1, 0), Some(in._2) ) }) Operator State Operator Stateï¼ˆæˆ– non-keyed stateï¼‰æ˜¯æŒ‡ç»‘å®šåˆ°ä¸€ä¸ªå¹¶è¡Œæ“ä½œç¬¦å®ä¾‹çš„çŠ¶æ€ã€‚Kafka è¿æ¥å™¨æ˜¯ Flink ä¸­ä½¿ç”¨ Operator State çš„ä¸€ä¸ªå¾ˆå¥½çš„æ¿€åŠ±ä¾‹å­ã€‚Kafka æ¶ˆè´¹è€…çš„æ¯ä¸ªå¹¶è¡Œå®ä¾‹éƒ½ç»´æŠ¤ç€ä¸€ä¸ªä¸»é¢˜åˆ†åŒºå’Œåç§»çš„æ˜ å°„ä½œä¸ºå…¶ Operator Stateã€‚\nOperator State æ¥å£æ”¯æŒåœ¨å¹¶è¡Œæ“ä½œç¬¦å®ä¾‹ä¹‹é—´é‡æ–°åˆ†é…çŠ¶æ€ï¼Œå½“å¹¶è¡Œæ€§å‘ç”Ÿå˜åŒ–æ—¶ã€‚æœ‰ä¸åŒçš„æ–¹æ¡ˆæ¥è¿›è¡Œè¿™ç§é‡æ–°åˆ†é…ã€‚\nåœ¨å…¸å‹çš„æœ‰çŠ¶æ€çš„ Flink åº”ç”¨ä¸­ï¼Œä½ ä¸éœ€è¦æ“ä½œç¬¦çŠ¶æ€ã€‚å®ƒä¸»è¦æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„çŠ¶æ€ï¼Œç”¨äºæº/æ¥æ”¶å™¨å®ç°å’Œä½ æ²¡æœ‰é”®çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€šè¿‡å®ƒæ¥åˆ†éš”çŠ¶æ€ã€‚\nå¹¿æ’­çŠ¶æ€ Broadcast State æ˜¯ Operator State çš„ä¸€ç§ç‰¹æ®Šç±»å‹ã€‚å¼•å…¥å®ƒæ˜¯ä¸ºäº†æ”¯æŒè¿™æ ·çš„ç”¨ä¾‹ï¼šä¸€ä¸ªæµçš„è®°å½•(records)éœ€è¦è¢«å¹¿æ’­åˆ°æ‰€æœ‰ä¸‹æ¸¸ä»»åŠ¡ï¼Œå®ƒä»¬è¢«ç”¨æ¥åœ¨æ‰€æœ‰å­ä»»åŠ¡ä¸­ä¿æŒç›¸åŒçš„çŠ¶æ€ã€‚ç„¶ååœ¨å¤„ç†ç¬¬äºŒä¸ªæµçš„è®°å½•æ—¶å¯ä»¥è®¿é—®è¿™ä¸ªçŠ¶æ€ã€‚ä½œä¸ºä¸€ä¸ªå¹¿æ’­çŠ¶æ€å¯ä»¥è‡ªç„¶å‡ºç°çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³è±¡ä¸€ä¸ªä½ååé‡çš„æµï¼Œå…¶ä¸­åŒ…å«ä¸€ç»„è§„åˆ™ï¼Œæˆ‘ä»¬å¸Œæœ›å¯¹æ¥è‡ªå¦ä¸€ä¸ªæµçš„æ‰€æœ‰å…ƒç´ è¿›è¡Œè¯„ä¼°ã€‚è€ƒè™‘åˆ°ä¸Šè¿°ç±»å‹çš„ç”¨ä¾‹ï¼Œå¹¿æ’­çŠ¶æ€ä¸å…¶ä½™è¿ç®—ç¬¦çŠ¶æ€çš„ä¸åŒä¹‹å¤„åœ¨äºã€‚\n å®ƒæœ‰ä¸€ä¸ª map æ ¼å¼ã€‚ å®ƒåªé€‚ç”¨äºæœ‰å¹¿æ’­æµå’Œéå¹¿æ’­æµä½œä¸ºè¾“å…¥çš„ç‰¹å®šæ“ä½œç¬¦ï¼Œä»¥åŠ è¿™æ ·çš„æ“ä½œç¬¦å¯ä»¥æ‹¥æœ‰å¤šä¸ªä¸åŒåç§°çš„å¹¿æ’­çŠ¶æ€ã€‚  ä½¿ç”¨ Operator State è¦ä½¿ç”¨è¿ç®—ç¬¦çŠ¶æ€ï¼Œæœ‰çŠ¶æ€å‡½æ•°å¯ä»¥å®ç° CheckpointedFunction æ¥å£ã€‚\nCheckpointedFunction CheckpointedFunction æ¥å£æä¾›äº†å¯¹ä¸åŒé‡åˆ†é…æ–¹æ¡ˆçš„ non-keyed çš„è®¿é—®ã€‚å®ƒéœ€è¦å®ç°ä¸¤ä¸ªæ–¹æ³•ã€‚\nvoid snapshotState(FunctionSnapshotContext context) throws Exception; void initializeState(FunctionInitializationContext context) throws Exception; æ¯å½“éœ€è¦æ‰§è¡Œä¸€ä¸ªæ£€æŸ¥ç‚¹æ—¶ï¼Œå°±ä¼šè°ƒç”¨ snapshotState()ã€‚ä¸ä¹‹å¯¹åº”çš„ initializeState()ï¼Œåœ¨æ¯æ¬¡ç”¨æˆ·å®šä¹‰çš„å‡½æ•°è¢«åˆå§‹åŒ–æ—¶éƒ½ä¼šè¢«è°ƒç”¨ï¼Œä¸ç®¡æ˜¯åœ¨å‡½æ•°é¦–æ¬¡åˆå§‹åŒ–æ—¶ï¼Œè¿˜æ˜¯åœ¨å‡½æ•°å®é™…ä»æ—©æœŸçš„æ£€æŸ¥ç‚¹æ¢å¤æ—¶ã€‚é‰´äºæ­¤ï¼ŒinitializeState() ä¸ä»…æ˜¯åˆå§‹åŒ–ä¸åŒç±»å‹çŠ¶æ€çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯åŒ…å«çŠ¶æ€æ¢å¤é€»è¾‘çš„åœ°æ–¹ã€‚\nç›®å‰ï¼Œæ”¯æŒåˆ—è¡¨å¼æ“ä½œç¬¦çŠ¶æ€ã€‚çŠ¶æ€æœ‰æœ›æˆä¸ºä¸€ä¸ªå¯åºåˆ—åŒ–å¯¹è±¡çš„ Listï¼Œå½¼æ­¤ç‹¬ç«‹ï¼Œå› æ­¤åœ¨é‡æ–°ç¼©æ”¾æ—¶æœ‰èµ„æ ¼é‡æ–°åˆ†é…ã€‚æ¢å¥è¯è¯´ï¼Œè¿™äº›å¯¹è±¡æ˜¯ non-keyed state å¯ä»¥é‡æ–°åˆ†é…çš„æœ€ç»†ç²’åº¦ã€‚æ ¹æ®çŠ¶æ€è®¿é—®æ–¹æ³•çš„ä¸åŒï¼Œå®šä¹‰äº†ä»¥ä¸‹é‡åˆ†å¸ƒæ–¹æ¡ˆã€‚\n  å‡åˆ†é‡åˆ†é…: æ¯ä¸ªæ“ä½œç¬¦éƒ½ä¼šè¿”å›ä¸€ä¸ªçŠ¶æ€å…ƒç´ åˆ—è¡¨ã€‚æ•´ä¸ªçŠ¶æ€åœ¨é€»è¾‘ä¸Šæ˜¯æ‰€æœ‰åˆ—è¡¨çš„è¿æ¥(concatenation)ã€‚åœ¨è¿˜åŸ/å†åˆ†é…æ—¶ï¼Œåˆ—è¡¨è¢«å¹³å‡åˆ†æˆæœ‰å¤šå°‘ä¸ªå¹¶è¡Œæ“ä½œç¬¦å°±æœ‰å¤šå°‘ä¸ªå­åˆ—è¡¨ã€‚æ¯ä¸ªæ“ä½œç¬¦éƒ½ä¼šå¾—åˆ°ä¸€ä¸ªå­åˆ—è¡¨ï¼Œè¿™ä¸ªå­åˆ—è¡¨å¯ä»¥æ˜¯ç©ºçš„ï¼Œä¹Ÿå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœåœ¨å¹¶è¡Œåº¦ä¸º1çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæ“ä½œç¬¦çš„æ£€æŸ¥ç‚¹çŠ¶æ€åŒ…å«å…ƒç´ 1å’Œå…ƒç´ 2ï¼Œå½“æŠŠå¹¶è¡Œåº¦å¢åŠ åˆ°2æ—¶ï¼Œå…ƒç´ 1å¯èƒ½æœ€ç»ˆè¿›å…¥æ“ä½œç¬¦å®ä¾‹0ï¼Œè€Œå…ƒç´ 2å°†è¿›å…¥æ“ä½œç¬¦å®ä¾‹1ã€‚\n  è”ç›Ÿå†åˆ†é…ã€‚æ¯ä¸ªæ“ä½œç¬¦éƒ½ä¼šè¿”å›ä¸€ä¸ªçŠ¶æ€å…ƒç´ åˆ—è¡¨ã€‚æ•´ä¸ªçŠ¶æ€åœ¨é€»è¾‘ä¸Šæ˜¯æ‰€æœ‰ List çš„è¿æ¥(concatenation)ã€‚åœ¨è¿˜åŸ/å†åˆ†é…æ—¶ï¼Œæ¯ä¸ªæ“ä½œç¬¦éƒ½ä¼šå¾—åˆ°å®Œæ•´çš„çŠ¶æ€å…ƒç´ åˆ—è¡¨ã€‚å¦‚æœä½ çš„åˆ—è¡¨å¯èƒ½æœ‰å¾ˆé«˜çš„åŸºæ•°(cardinality)ï¼Œè¯·ä¸è¦ä½¿ç”¨è¿™ä¸ªåŠŸèƒ½ã€‚æ£€æŸ¥ç‚¹å…ƒæ•°æ®å°†ä¸ºæ¯ä¸ªåˆ—è¡¨æ¡ç›®å­˜å‚¨ä¸€ä¸ªåç§»ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ RPC å¸§å¤§å°æˆ–å†…å­˜å¤–é”™è¯¯ã€‚\n  ä¸‹é¢æ˜¯ä¸€ä¸ªæœ‰çŠ¶æ€çš„ SinkFunction çš„ä¾‹å­ï¼Œå®ƒä½¿ç”¨ CheckpointedFunction æ¥ç¼“å†²å…ƒç´ ï¼Œç„¶åå†å°†å®ƒä»¬å‘é€åˆ°å¤–ç•Œã€‚å®ƒæ¼”ç¤ºäº†åŸºæœ¬çš„å‡åˆ†é‡åˆ†é…åˆ—è¡¨çŠ¶æ€ã€‚\nclass BufferingSink(threshold: Int = 0) extends SinkFunction[(String, Int)] with CheckpointedFunction { @transient private var checkpointedState: ListState[(String, Int)] = _ private val bufferedElements = ListBuffer[(String, Int)]() override def invoke(value: (String, Int), context: Context): Unit = { bufferedElements += value if (bufferedElements.size == threshold) { for (element \u0026lt;- bufferedElements) { // send it to the sink  } bufferedElements.clear() } } override def snapshotState(context: FunctionSnapshotContext): Unit = { checkpointedState.clear() for (element \u0026lt;- bufferedElements) { checkpointedState.add(element) } } override def initializeState(context: FunctionInitializationContext): Unit = { val descriptor = new ListStateDescriptor[(String, Int)]( \u0026#34;buffered-elements\u0026#34;, TypeInformation.of(new TypeHint[(String, Int)]() {}) ) checkpointedState = context.getOperatorStateStore.getListState(descriptor) if(context.isRestored) { for(element \u0026lt;- checkpointedState.get()) { bufferedElements += element } } } } initializeState æ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ª FunctionInitializationContextã€‚å®ƒç”¨äºåˆå§‹åŒ– non-keyed \u0026ldquo;å®¹å™¨\u0026rdquo;ã€‚è¿™äº›å®¹å™¨æ˜¯ä¸€ä¸ª ListState ç±»å‹çš„å®¹å™¨ï¼Œåœ¨æ£€æŸ¥ç‚¹æ—¶ï¼Œnon-keyed å¯¹è±¡å°†è¢«å­˜å‚¨åœ¨é‚£é‡Œã€‚\nè¯·æ³¨æ„å¦‚ä½•åˆå§‹åŒ–çŠ¶æ€ï¼Œç±»ä¼¼äº keyed stateï¼Œç”¨ä¸€ä¸ª StateDescriptor æ¥åˆå§‹åŒ–ï¼Œè¿™ä¸ª StateDescriptor åŒ…å«äº†çŠ¶æ€åç§°å’ŒçŠ¶æ€æ‰€æŒæœ‰çš„å€¼çš„ç±»å‹ä¿¡æ¯ã€‚\nval descriptor = new ListStateDescriptor[(String, Long)]( \u0026#34;buffered-elements\u0026#34;, TypeInformation.of(new TypeHint[(String, Long)]() {}) ) checkpointedState = context.getOperatorStateStore.getListState(descriptor) çŠ¶æ€è®¿é—®æ–¹æ³•çš„å‘½åçº¦å®šåŒ…å«å…¶é‡åˆ†é…æ¨¡å¼ï¼Œç„¶åæ˜¯å…¶çŠ¶æ€ç»“æ„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¦åœ¨è¿˜åŸæ—¶ä½¿ç”¨ union é‡åˆ†é…æ–¹æ¡ˆçš„åˆ—è¡¨çŠ¶æ€ï¼Œåˆ™ä½¿ç”¨ getUnionListState(descriptor) è®¿é—®çŠ¶æ€ã€‚å¦‚æœæ–¹æ³•åä¸­ä¸åŒ…å«é‡åˆ†é…æ¨¡å¼ï¼Œä¾‹å¦‚ getListState(descriptor)ï¼Œåˆ™ä»…ä»…æ„å‘³ç€å°†ä½¿ç”¨åŸºæœ¬çš„å‡åˆ†é‡åˆ†é…æ–¹æ¡ˆã€‚\nåœ¨åˆå§‹åŒ–å®¹å™¨åï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸Šä¸‹æ–‡çš„ isRestored() æ–¹æ³•æ¥æ£€æŸ¥æ˜¯å¦åœ¨æ•…éšœåæ¢å¤ã€‚å¦‚æœä¸ºçœŸï¼Œå³æˆ‘ä»¬æ­£åœ¨æ¢å¤ï¼Œåˆ™åº”ç”¨è¿˜åŸé€»è¾‘ã€‚\nå¦‚ä¿®æ”¹åçš„ BufferingSink çš„ä»£ç æ‰€ç¤ºï¼Œåœ¨çŠ¶æ€åˆå§‹åŒ–è¿‡ç¨‹ä¸­æ¢å¤çš„è¿™ä¸ª ListState è¢«ä¿å­˜åœ¨ä¸€ä¸ªç±»å˜é‡ä¸­ï¼Œä»¥ä¾¿å°†æ¥åœ¨ snapshotState() ä¸­ä½¿ç”¨ã€‚åœ¨é‚£é‡Œï¼ŒListState ä¼šè¢«æ¸…é™¤æ‰ä¹‹å‰æ£€æŸ¥ç‚¹æ‰€åŒ…å«çš„æ‰€æœ‰å¯¹è±¡ï¼Œç„¶åç”¨æˆ‘ä»¬è¦æ£€æŸ¥ç‚¹çš„æ–°å¯¹è±¡æ¥å¡«å……ã€‚\né¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œ keyed state ä¹Ÿå¯ä»¥åœ¨ initializeState() æ–¹æ³•ä¸­åˆå§‹åŒ–ã€‚è¿™å¯ä»¥ä½¿ç”¨æä¾›çš„ FunctionInitializationContext æ¥å®Œæˆã€‚\næœ‰çŠ¶æ€çš„æºå‡½æ•° ä¸å…¶ä»–æ“ä½œç¬¦ç›¸æ¯”ï¼Œæœ‰çŠ¶æ€çš„æºéœ€è¦æ›´å¤šçš„å°å¿ƒã€‚ä¸ºäº†ä½¿çŠ¶æ€å’Œè¾“å‡ºé›†åˆçš„æ›´æ–°æ˜¯åŸå­æ€§çš„ï¼ˆå¯¹äºå¤±è´¥/æ¢å¤æ—¶çš„ç²¾ç¡®ä¸€æ¬¡æ€§è¯­ä¹‰æ¥è¯´æ˜¯å¿…éœ€çš„ï¼‰ï¼Œç”¨æˆ·éœ€è¦ä»æºçš„ä¸Šä¸‹æ–‡ä¸­è·å¾—ä¸€ä¸ªé”ã€‚\nclass CounterSource extends RichParallelSourceFunction[Long] with CheckpointedFunction { @volatile private var isRunning = true private var offset = 0L private var state: ListState[Long] = _ override def run(ctx: SourceFunction.SourceContext[Long]): Unit = { val lock = ctx.getCheckpointLock while (isRunning) { // output and state update are atomic  lock.synchronized({ ctx.collect(offset) offset += 1 }) } } override def cancel(): Unit = isRunning = false override def initializeState(context: FunctionInitializationContext): Unit = { state = context.getOperatorStateStore.getListState( new ListStateDescriptor[Long](\u0026#34;state\u0026#34;, classOf[Long])) for (l \u0026lt;- state.get().asScala) { offset = l } } override def snapshotState(context: FunctionSnapshotContext): Unit = { state.clear() state.add(offset) } } ä¸€äº›è¿ç®—ç¬¦å¯èƒ½éœ€è¦æ£€æŸ¥ç‚¹è¢« Flink å®Œå…¨æ‰¿è®¤æ—¶çš„ä¿¡æ¯æ¥ä¸å¤–ç•Œæ²Ÿé€šã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯·å‚è§ org.apache.flink.runtime.state.CheckpointListener æ¥å£ã€‚\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/dev/stream/state/state.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-21-working-with-state/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataStream API","State"],"title":"ä½¿ç”¨çŠ¶æ€"},{"categories":["programming"],"contents":"å†…ç½®æ°´å°ç”Ÿæˆå™¨ æ­£å¦‚åœ¨ Generating Watermarks ä¸€æ–‡ä¸­æ‰€æè¿°çš„ï¼ŒFlink æä¾›äº†æŠ½è±¡ï¼Œå…è®¸ç¨‹åºå‘˜åˆ†é…è‡ªå·±çš„æ—¶é—´æˆ³å’Œå‘å°„è‡ªå·±çš„æ°´å°ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œå¯ä»¥é€šè¿‡å®ç° WatermarkGenerator æ¥å£æ¥å®ç°ã€‚\nä¸ºäº†è¿›ä¸€æ­¥ç®€åŒ–æ­¤ç±»ä»»åŠ¡çš„ç¼–ç¨‹å·¥ä½œï¼ŒFlink è‡ªå¸¦äº†ä¸€äº›é¢„å…ˆå®ç°çš„æ—¶é—´æˆ³åˆ†é…å™¨ã€‚æœ¬èŠ‚æä¾›äº†å®ƒä»¬çš„åˆ—è¡¨ã€‚é™¤äº†å®ƒä»¬çš„å¼€ç®±å³ç”¨çš„åŠŸèƒ½å¤–ï¼Œå®ƒä»¬çš„å®ç°å¯ä»¥ä½œä¸ºè‡ªå®šä¹‰å®ç°çš„èŒƒä¾‹ã€‚\nå•è°ƒåœ°å¢åŠ æ—¶é—´æˆ³ å‘¨æœŸæ€§æ°´å°ç”Ÿæˆçš„æœ€ç®€å•çš„ç‰¹æ®Šæƒ…å†µæ˜¯å½“ç»™å®šæºä»»åŠ¡(task)çœ‹åˆ°çš„æ—¶é—´æˆ³ä»¥å‡åºå‡ºç°æ—¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“å‰çš„æ—¶é—´æˆ³æ€»æ˜¯å¯ä»¥ä½œä¸ºæ°´å°ï¼Œå› ä¸ºä¸ä¼šæœ‰æ›´æ—©çš„æ—¶é—´æˆ³åˆ°è¾¾ã€‚\nè¯·æ³¨æ„ï¼Œåªéœ€è¦æ¯ä¸ªå¹¶è¡Œæ•°æ®æºä»»åŠ¡çš„æ—¶é—´æˆ³æ˜¯å‡åºçš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåœ¨ä¸€ä¸ªç‰¹å®šçš„è®¾ç½®ä¸­ï¼Œä¸€ä¸ª Kafka åˆ†åŒºè¢«ä¸€ä¸ªå¹¶è¡Œæ•°æ®æºå®ä¾‹è¯»å–ï¼Œé‚£ä¹ˆåªéœ€è¦åœ¨æ¯ä¸ª Kafka åˆ†åŒºä¸­æ—¶é—´æˆ³æ˜¯å‡åºçš„ã€‚æ¯å½“å¹¶è¡Œæµè¢«æ´—ç‰Œã€è”åˆã€è¿æ¥(connected)æˆ–åˆå¹¶æ—¶ï¼ŒFlink çš„æ°´å°åˆå¹¶æœºåˆ¶éƒ½ä¼šç”Ÿæˆæ­£ç¡®çš„æ°´å°ã€‚\nWatermarkStrategy.forMonotonousTimestamps() å›ºå®šçš„å»¶è¿Ÿé‡ å‘¨æœŸæ€§æ°´å°ç”Ÿæˆçš„å¦ä¸€ä¸ªä¾‹å­æ˜¯ï¼Œå½“æ°´å°æ»åäºæµä¸­çœ‹åˆ°çš„æœ€å¤§ï¼ˆäº‹ä»¶æ—¶é—´ï¼‰æ—¶é—´æˆ³çš„å›ºå®šæ—¶é—´é‡æ—¶ã€‚è¿™ç§æƒ…å†µæ¶µç›–äº†é¢„å…ˆçŸ¥é“æµä¸­å¯èƒ½é‡åˆ°çš„æœ€å¤§å»¶è¿Ÿçš„åœºæ™¯ï¼Œä¾‹å¦‚ï¼Œå½“åˆ›å»ºä¸€ä¸ªåŒ…å«æ—¶é—´æˆ³åˆ†å¸ƒåœ¨å›ºå®šæ—¶é—´æ®µå†…çš„å…ƒç´ çš„è‡ªå®šä¹‰æºè¿›è¡Œæµ‹è¯•æ—¶ã€‚å¯¹äºè¿™äº›æƒ…å†µï¼ŒFlink æä¾›äº† BoundedOutOfOrdernessWatermarks ç”Ÿæˆå™¨ï¼Œå®ƒä»¥ maxOutOfOrderness ä½œä¸ºå‚æ•°ï¼Œå³åœ¨è®¡ç®—ç»™å®šçª—å£çš„æœ€ç»ˆç»“æœæ—¶ï¼Œä¸€ä¸ªå…ƒç´ åœ¨è¢«å¿½ç•¥ä¹‹å‰å…è®¸è¿Ÿåˆ°çš„æœ€å¤§æ—¶é—´ã€‚Lateness å¯¹åº”äº t - t_w çš„ç»“æœï¼Œå…¶ä¸­ t æ˜¯ä¸€ä¸ªå…ƒç´ çš„ï¼ˆäº‹ä»¶-æ—¶é—´ï¼‰æ—¶é—´æˆ³ï¼Œt_w æ˜¯ä¹‹å‰çš„æ°´å°ã€‚å¦‚æœ lateness \u0026gt; 0ï¼Œé‚£ä¹ˆè¯¥å…ƒç´ è¢«è®¤ä¸ºæ˜¯è¿Ÿåˆ°çš„ï¼Œå¹¶ä¸”é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨è®¡ç®—å…¶å¯¹åº”çª—å£çš„ä½œä¸šç»“æœæ—¶è¢«å¿½ç•¥ã€‚è¯·å‚é˜…å…³äºå…è®¸å»¶è¿Ÿçš„æ–‡æ¡£ï¼Œä»¥è·å¾—æ›´å¤šå…³äºå¤„ç†è¿Ÿåˆ°å…ƒç´ çš„ä¿¡æ¯ã€‚\nWatermarkStrategy .forBoundedOutOfOrderness(Duration.ofSeconds(10)) ","permalink":"https://ohmyweekly.github.io/notes/2020-08-21-built-in-watermark-generators/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataStream API"],"title":"å†…ç½®çš„æ°´å°ç”Ÿæˆå™¨"},{"categories":["Flink"],"contents":"çŠ¶æ€å’Œå®¹é”™æ€§ åœ¨æœ¬èŠ‚ä¸­ï¼Œæ‚¨å°†äº†è§£ Flink ä¸ºç¼–å†™æœ‰çŠ¶æ€ç¨‹åºæä¾›çš„ APIã€‚è¯·çœ‹ä¸€ä¸‹ Stateful Stream Processingï¼Œäº†è§£æœ‰çŠ¶æ€æµå¤„ç†èƒŒåçš„æ¦‚å¿µã€‚\nä¸‹ä¸€æ­¥æ€ä¹ˆèµ°ï¼Ÿ  ä½¿ç”¨çŠ¶æ€ã€‚å±•ç¤ºå¦‚ä½•åœ¨ Flink åº”ç”¨ä¸­ä½¿ç”¨çŠ¶æ€ï¼Œå¹¶è§£é‡Šä¸åŒç±»å‹çš„çŠ¶æ€ã€‚ å¹¿æ’­çŠ¶æ€æ¨¡å¼ã€‚è§£é‡Šå¦‚ä½•è¿æ¥ä¸€ä¸ªå¹¿æ’­æµå’Œä¸€ä¸ªéå¹¿æ’­æµï¼Œå¹¶ä½¿ç”¨çŠ¶æ€åœ¨å®ƒä»¬ä¹‹é—´äº¤æ¢ä¿¡æ¯ã€‚ æ£€æŸ¥ç‚¹ã€‚æè¿°äº†å¦‚ä½•å¯ç”¨å’Œé…ç½®æ£€æŸ¥ç‚¹ä»¥å®ç°å®¹é”™ã€‚ å¯æŸ¥è¯¢çŠ¶æ€ã€‚è¯´æ˜å¦‚ä½•åœ¨è¿è¡Œæ—¶ä» Flink å¤–éƒ¨è®¿é—®çŠ¶æ€ã€‚ çŠ¶æ€æ¨¡å¼æ¼”åŒ–ï¼šä»‹ç»å¦‚ä½•åœ¨è¿è¡Œæ—¶ä»å¤–éƒ¨è®¿é—®çŠ¶æ€ã€‚å±•ç¤ºäº†çŠ¶æ€ç±»å‹çš„æ¨¡å¼å¦‚ä½•æ¼”åŒ–ã€‚ ç®¡ç†çŠ¶æ€çš„è‡ªå®šä¹‰åºåˆ—åŒ–ã€‚è®¨è®ºå¦‚ä½•å®ç°è‡ªå®šä¹‰åºåˆ—åŒ–ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹æ¨¡å¼æ¼”åŒ–ã€‚  ","permalink":"https://ohmyweekly.github.io/notes/2020-08-21-state-and-fault-tolerance/","tags":["Flink","Flink å®˜æ–¹æ–‡æ¡£","DataStream API"],"title":"çŠ¶æ€å’Œå®¹é”™æ€§"},{"categories":["programming"],"contents":"Flink æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œä¸ºäº†æ‰§è¡Œæµå¼åº”ç”¨ï¼Œéœ€è¦å¯¹è®¡ç®—èµ„æºè¿›è¡Œæœ‰æ•ˆçš„åˆ†é…å’Œç®¡ç†ã€‚å®ƒé›†æˆäº†æ‰€æœ‰å¸¸è§çš„é›†ç¾¤èµ„æºç®¡ç†å™¨ï¼Œå¦‚ Hadoop YARNã€Apache Mesos å’Œ Kubernetesï¼Œä½†ä¹Ÿå¯ä»¥è®¾ç½®ä¸ºç‹¬ç«‹é›†ç¾¤ç”šè‡³ä½œä¸ºåº“è¿è¡Œã€‚\næœ¬èŠ‚åŒ…å« Flink æ¶æ„çš„æ¦‚è¿°ï¼Œå¹¶æè¿°äº†å…¶ä¸»è¦ç»„ä»¶å¦‚ä½•äº¤äº’æ‰§è¡Œåº”ç”¨ç¨‹åºå¹¶ä»æ•…éšœä¸­æ¢å¤ã€‚\nFlink é›†ç¾¤çš„è§£å‰– Flink è¿è¡Œæ—¶ç”±ä¸¤ç§ç±»å‹çš„è¿›ç¨‹ç»„æˆï¼šä¸€ä¸ª JobManager å’Œä¸€ä¸ªæˆ–å¤šä¸ª TaskManagersã€‚\nå®¢æˆ·ç«¯ä¸æ˜¯è¿è¡Œæ—¶å’Œç¨‹åºæ‰§è¡Œçš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯ç”¨æ¥å‡†å¤‡å¹¶å‘ JobManager å‘é€æ•°æ®æµã€‚ä¹‹åï¼Œå®¢æˆ·ç«¯å¯ä»¥æ–­å¼€è¿æ¥ï¼ˆåˆ†ç¦»æ¨¡å¼ï¼‰ï¼Œæˆ–è€…ä¿æŒè¿æ¥ä»¥æ¥æ”¶è¿›åº¦æŠ¥å‘Šï¼ˆé™„åŠ æ¨¡å¼ï¼‰ã€‚å®¢æˆ·ç«¯æ—¢å¯ä»¥ä½œä¸ºè§¦å‘æ‰§è¡Œçš„ Java/Scala ç¨‹åºçš„ä¸€éƒ¨åˆ†è¿è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨å‘½ä»¤è¡Œè¿›ç¨‹ ./bin/flink run \u0026hellip;ä¸­è¿è¡Œã€‚\nJobManager å’Œ TaskManagers å¯ä»¥ä»¥å„ç§æ–¹å¼å¯åŠ¨ï¼šç›´æ¥åœ¨æœºå™¨ä¸Šä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„é›†ç¾¤ï¼Œåœ¨å®¹å™¨ä¸­ï¼Œæˆ–ç”± YARN æˆ– Mesos ç­‰èµ„æºæ¡†æ¶ç®¡ç†ã€‚TaskManagers è¿æ¥åˆ° JobManagersï¼Œå®£å¸ƒè‡ªå·±å¯ç”¨ï¼Œå¹¶è¢«åˆ†é…å·¥ä½œã€‚\nJobManager JobManager æœ‰ä¸€äº›ä¸åè°ƒ Flink åº”ç”¨çš„åˆ†å¸ƒå¼æ‰§è¡Œæœ‰å…³çš„èŒè´£ï¼šå®ƒå†³å®šä½•æ—¶å®‰æ’ä¸‹ä¸€ä¸ªä»»åŠ¡ï¼ˆæˆ–ä¸€ç»„ä»»åŠ¡ï¼‰ï¼Œå¯¹å·²å®Œæˆçš„ä»»åŠ¡æˆ–æ‰§è¡Œå¤±è´¥ä½œå‡ºååº”ï¼Œåè°ƒæ£€æŸ¥ç‚¹ï¼Œå¹¶åè°ƒå¤±è´¥æ—¶çš„æ¢å¤ç­‰ã€‚è¿™ä¸ªè¿‡ç¨‹ç”±ä¸‰ä¸ªä¸åŒçš„ç»„ä»¶ç»„æˆã€‚\n èµ„æºç®¡ç†å™¨(ResourceManager)  ResourceManager è´Ÿè´£ Flink é›†ç¾¤ä¸­çš„èµ„æºå»/åˆ†é…å’Œä¾›åº”\u0026ndash;å®ƒç®¡ç†ä»»åŠ¡æ§½(task slots)ï¼Œä»»åŠ¡æ§½æ˜¯ Flink é›†ç¾¤ä¸­èµ„æºè°ƒåº¦çš„å•ä½ï¼ˆè§ TaskManagersï¼‰ã€‚Flink é’ˆå¯¹ä¸åŒçš„ç¯å¢ƒå’Œèµ„æºæä¾›è€…ï¼ˆå¦‚ YARNã€Mesosã€Kubernetes å’Œç‹¬ç«‹éƒ¨ç½²ï¼‰å®ç°äº†å¤šä¸ª ResourceManagersã€‚åœ¨ç‹¬ç«‹è®¾ç½®ä¸­ï¼ŒResourceManager åªèƒ½åˆ†é…å¯ç”¨çš„ TaskManagers çš„æ§½ä½ï¼Œä¸èƒ½è‡ªè¡Œå¯åŠ¨æ–°çš„ TaskManagersã€‚\n Dispatcher  Dispatcher æä¾›äº†ä¸€ä¸ª REST æ¥å£æ¥æäº¤ Flink åº”ç”¨æ‰§è¡Œï¼Œå¹¶ä¸ºæ¯ä¸ªæäº¤çš„ä½œä¸šå¯åŠ¨ä¸€ä¸ªæ–°çš„ JobMasterã€‚å®ƒè¿˜è¿è¡Œ Flink WebUI æ¥æä¾›ä½œä¸šæ‰§è¡Œçš„ä¿¡æ¯ã€‚\n JobMaster  ä¸€ä¸ª JobMaster è´Ÿè´£ç®¡ç†ä¸€ä¸ª JobGraph çš„æ‰§è¡Œã€‚åœ¨ä¸€ä¸ª Flink é›†ç¾¤ä¸­å¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªä½œä¸šï¼Œæ¯ä¸ªä½œä¸šéƒ½æœ‰è‡ªå·±çš„ JobMasterã€‚\næ€»æ˜¯è‡³å°‘æœ‰ä¸€ä¸ª JobManagerã€‚ä¸€ä¸ªé«˜å¯ç”¨æ€§è®¾ç½®å¯èƒ½æœ‰å¤šä¸ª JobManagersï¼Œå…¶ä¸­ä¸€ä¸ªæ€»æ˜¯é¢†å¯¼è€…ï¼Œå…¶ä»–çš„æ˜¯å¤‡ç”¨çš„ï¼ˆè§é«˜å¯ç”¨æ€§ï¼ˆHAï¼‰ï¼‰ã€‚\nTaskManagers ä»»åŠ¡ç®¡ç†å™¨ï¼ˆTaskManagersï¼‰ï¼ˆä¹Ÿå« workerï¼‰æ‰§è¡Œæ•°æ®æµçš„ä»»åŠ¡ï¼Œå¹¶ç¼“å†²å’Œäº¤æ¢æ•°æ®æµã€‚\nå¿…é¡»å§‹ç»ˆæœ‰è‡³å°‘ä¸€ä¸ªTaskManagerã€‚TaskManagerä¸­èµ„æºè°ƒåº¦çš„æœ€å°å•ä½æ˜¯ä¸€ä¸ªä»»åŠ¡æ§½ã€‚ä¸€ä¸ªä»»åŠ¡ç®¡ç†å™¨ä¸­ä»»åŠ¡æ§½çš„æ•°é‡è¡¨ç¤ºå¹¶å‘å¤„ç†ä»»åŠ¡çš„æ•°é‡ã€‚è¯·æ³¨æ„ï¼Œä¸€ä¸ªä»»åŠ¡æ§½ä¸­å¯ä»¥æ‰§è¡Œå¤šä¸ªæ“ä½œè€…ï¼ˆå‚è§Tasks å’Œ Operator é“¾ï¼‰ã€‚\nTasks å’Œ Operator Chains å¯¹äºåˆ†å¸ƒå¼æ‰§è¡Œï¼ŒFlink å°†æ“ä½œè€…çš„å­ä»»åŠ¡é“¾æˆä»»åŠ¡ã€‚æ¯ä¸ªä»»åŠ¡ç”±ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚å°†è¿ç®—ç¬¦ä¸€èµ·é“¾å…¥ä»»åŠ¡æ˜¯ä¸€ç§æœ‰ç”¨çš„ä¼˜åŒ–ï¼šå®ƒå‡å°‘äº†çº¿ç¨‹åˆ°çº¿ç¨‹çš„äº¤æ¥å’Œç¼“å†²çš„å¼€é”€ï¼Œå¢åŠ äº†æ•´ä½“çš„ååé‡ï¼ŒåŒæ—¶é™ä½äº†å»¶è¿Ÿã€‚é“¾é”è¡Œä¸ºå¯ä»¥é…ç½®ï¼Œè¯¦æƒ…è¯·çœ‹chaining æ–‡æ¡£ã€‚\nä¸‹å›¾ä¸­çš„ç¤ºä¾‹æ•°æ®æµæ˜¯ä»¥äº”ä¸ªå­ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯äº”ä¸ªå¹¶è¡Œçº¿ç¨‹æ¥æ‰§è¡Œçš„ã€‚\nä»»åŠ¡æ§½å’Œèµ„æº(Task Slots å’Œ Resources) æ¯ä¸ª workerï¼ˆTaskManagerï¼‰éƒ½æ˜¯ä¸€ä¸ª JVM è¿›ç¨‹ï¼Œå¯ä»¥åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸­æ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªå­ä»»åŠ¡ã€‚ä¸ºäº†æ§åˆ¶ä¸€ä¸ªä»»åŠ¡ç®¡ç†å™¨æ¥å—å¤šå°‘ä»»åŠ¡ï¼Œå®ƒæœ‰æ‰€è°“çš„ä»»åŠ¡æ§½ï¼ˆè‡³å°‘ä¸€ä¸ªï¼‰ã€‚\næ¯ä¸ªä»»åŠ¡æ§½ä»£è¡¨ä»»åŠ¡ç®¡ç†å™¨çš„ä¸€ä¸ªå›ºå®šçš„èµ„æºå­é›†ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªæœ‰ä¸‰ä¸ªæ§½çš„ä»»åŠ¡ç®¡ç†å™¨ï¼Œå°†æŠŠå…¶ç®¡ç†å†…å­˜çš„1/3å¥‰çŒ®ç»™æ¯ä¸ªæ§½ã€‚æ§½ä½èµ„æºæ„å‘³ç€ä¸€ä¸ªå­ä»»åŠ¡ä¸ä¼šä¸å…¶ä»–ä»»åŠ¡çš„å­ä»»åŠ¡äº‰å¤ºç®¡ç†å†…å­˜ï¼Œè€Œæ˜¯æ‹¥æœ‰ä¸€å®šé‡çš„é¢„ç•™ç®¡ç†å†…å­˜ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰å‘ç”Ÿ CPU éš”ç¦»ï¼Œç›®å‰æ’æ§½åªæ˜¯å°†ä»»åŠ¡çš„ç®¡ç†å†…å­˜åˆ†å¼€ã€‚\né€šè¿‡è°ƒæ•´ä»»åŠ¡æ§½çš„æ•°é‡ï¼Œç”¨æˆ·å¯ä»¥å®šä¹‰å­ä»»åŠ¡ä¹‹é—´çš„éš”ç¦»æ–¹å¼ã€‚æ¯ä¸ªä»»åŠ¡ç®¡ç†å™¨æœ‰ä¸€ä¸ªæ’æ§½æ„å‘³ç€æ¯ä¸ªä»»åŠ¡ç»„éƒ½åœ¨ä¸€ä¸ªå•ç‹¬çš„ JVM ä¸­è¿è¡Œï¼ˆä¾‹å¦‚å¯ä»¥åœ¨ä¸€ä¸ªå•ç‹¬çš„å®¹å™¨ä¸­å¯åŠ¨ï¼‰ã€‚æ‹¥æœ‰å¤šä¸ªæ’æ§½æ„å‘³ç€æ›´å¤šçš„å­ä»»åŠ¡å…±äº«åŒä¸€ä¸ª JVMã€‚åŒä¸€ JVM ä¸­çš„ä»»åŠ¡å…±äº« TCP è¿æ¥ï¼ˆé€šè¿‡å¤šè·¯å¤ç”¨ï¼‰å’Œå¿ƒè·³æ¶ˆæ¯ã€‚å®ƒä»¬è¿˜å¯ä»¥å…±äº«æ•°æ®é›†å’Œæ•°æ®ç»“æ„ï¼Œä»è€Œå‡å°‘æ¯ä¸ªä»»åŠ¡çš„å¼€é”€ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼ŒFlink å…è®¸å­ä»»åŠ¡å…±äº«æ§½ï¼Œå³ä½¿å®ƒä»¬æ˜¯ä¸åŒä»»åŠ¡çš„å­ä»»åŠ¡ï¼Œåªè¦å®ƒä»¬æ¥è‡ªåŒä¸€ä¸ªä½œä¸šã€‚å…¶ç»“æœæ˜¯ï¼Œä¸€ä¸ªæ§½å¯ä»¥å®¹çº³æ•´ä¸ªä½œä¸šçš„æµæ°´çº¿ã€‚å…è®¸è¿™ç§æ§½ä½å…±äº«æœ‰ä¸¤ä¸ªä¸»è¦å¥½å¤„ã€‚\n  ä¸€ä¸ª Flink é›†ç¾¤éœ€è¦çš„ä»»åŠ¡æ§½æ•°é‡æ­£å¥½ä¸ä½œä¸šä¸­ä½¿ç”¨çš„æœ€é«˜å¹¶è¡Œåº¦ç›¸åŒã€‚ä¸éœ€è¦è®¡ç®—ä¸€ä¸ªç¨‹åºæ€»å…±åŒ…å«å¤šå°‘ä¸ªä»»åŠ¡ï¼ˆå…·æœ‰ä¸åŒçš„å¹¶è¡Œåº¦ï¼‰ã€‚\n  æ›´å®¹æ˜“è·å¾—æ›´å¥½çš„èµ„æºåˆ©ç”¨ç‡ã€‚å¦‚æœæ²¡æœ‰æ§½ä½å…±äº«ï¼Œéå¯†é›†å‹çš„ source/map() å­ä»»åŠ¡å’Œèµ„æºå¯†é›†å‹çš„ window å­ä»»åŠ¡ä¸€æ ·ï¼Œä¼šé˜»å¡å¾ˆå¤šèµ„æºã€‚æœ‰äº†æ§½ä½å…±äº«ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå°†åŸºç¡€å¹¶è¡Œåº¦ä»2ä¸ªå¢åŠ åˆ°6ä¸ªï¼Œå°±ä¼šäº§ç”Ÿæ§½ä½èµ„æºçš„å……åˆ†åˆ©ç”¨ï¼ŒåŒæ—¶ç¡®ä¿é‡åº¦å­ä»»åŠ¡åœ¨ TaskManager ä¸­å…¬å¹³åˆ†é…ã€‚\n  Flink åº”ç”¨æ‰§è¡Œ Flink åº”ç”¨ç¨‹åºæ˜¯ä»»ä½•ä»å…¶ main() æ–¹æ³•ä¸­ç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ª Flink ä½œä¸šçš„ç”¨æˆ·ç¨‹åºã€‚è¿™äº›ä½œä¸šçš„æ‰§è¡Œå¯ä»¥å‘ç”Ÿåœ¨æœ¬åœ° JVMï¼ˆLocalEnvironmentï¼‰ä¸­ï¼Œä¹Ÿå¯ä»¥å‘ç”Ÿåœ¨å¤šå°æœºå™¨çš„è¿œç¨‹é›†ç¾¤è®¾ç½®ï¼ˆRemoteEnvironmentï¼‰ä¸­ã€‚å¯¹äºæ¯ä¸ªç¨‹åºï¼ŒExecutionEnvironment æä¾›äº†æ§åˆ¶ä½œä¸šæ‰§è¡Œçš„æ–¹æ³•ï¼ˆä¾‹å¦‚è®¾ç½®å¹¶è¡Œæ€§ï¼‰å’Œä¸å¤–ç•Œäº¤äº’çš„æ–¹æ³•ï¼ˆå‚è§ Anatomy of a Flink Programï¼‰ã€‚\nFlink åº”ç”¨çš„ä½œä¸šå¯ä»¥æäº¤åˆ°ä¸€ä¸ªé•¿æœŸè¿è¡Œçš„ Flink ä¼šè¯é›†ç¾¤ã€ä¸€ä¸ªä¸“é—¨çš„ Flink ä½œä¸šé›†ç¾¤æˆ–ä¸€ä¸ª Flink åº”ç”¨é›†ç¾¤ã€‚è¿™äº›é€‰é¡¹ä¹‹é—´çš„åŒºåˆ«ä¸»è¦ä¸é›†ç¾¤çš„ç”Ÿå‘½å‘¨æœŸå’Œèµ„æºéš”ç¦»ä¿è¯æœ‰å…³ã€‚\nFlink ä¼šè¯é›†ç¾¤   é›†ç¾¤ç”Ÿå‘½å‘¨æœŸï¼šåœ¨ Flink ä¼šè¯é›†ç¾¤ä¸­ï¼Œå®¢æˆ·ç«¯è¿æ¥åˆ°ä¸€ä¸ªé¢„å…ˆå­˜åœ¨çš„ã€é•¿æœŸè¿è¡Œçš„é›†ç¾¤ï¼Œå¯ä»¥æ¥å—å¤šä¸ªä½œä¸šæäº¤ã€‚å³ä½¿åœ¨æ‰€æœ‰ä½œä¸šå®Œæˆåï¼Œé›†ç¾¤ï¼ˆå’Œ JobManagerï¼‰å°†ç»§ç»­è¿è¡Œï¼Œç›´åˆ°ä¼šè¯è¢«æ‰‹åŠ¨åœæ­¢ã€‚å› æ­¤ï¼Œä¸€ä¸ª Flink ä¼šè¯é›†ç¾¤çš„å¯¿å‘½ä¸å—ä»»ä½• Flink ä½œä¸šå¯¿å‘½çš„çº¦æŸã€‚\n  èµ„æºéš”ç¦»ã€‚TaskManager æ’æ§½ç”± ResourceManager åœ¨ä½œä¸šæäº¤æ—¶åˆ†é…ï¼Œä½œä¸šå®Œæˆåé‡Šæ”¾ã€‚å› ä¸ºæ‰€æœ‰ä½œä¸šéƒ½å…±äº«åŒä¸€ä¸ªé›†ç¾¤ï¼Œæ‰€ä»¥å¯¹é›†ç¾¤èµ„æºæœ‰ä¸€å®šçš„ç«äº‰\u0026ndash;æ¯”å¦‚æäº¤ä½œä¸šé˜¶æ®µçš„ç½‘ç»œå¸¦å®½ã€‚è¿™ç§å…±äº«è®¾ç½®çš„ä¸€ä¸ªé™åˆ¶æ˜¯ï¼Œå¦‚æœä¸€ä¸ªä»»åŠ¡ç®¡ç†å™¨å´©æºƒï¼Œé‚£ä¹ˆæ‰€æœ‰åœ¨è¿™ä¸ªä»»åŠ¡ç®¡ç†å™¨ä¸Šæœ‰ä»»åŠ¡è¿è¡Œçš„ä½œä¸šéƒ½ä¼šå¤±è´¥ï¼›åŒæ ·ï¼Œå¦‚æœåœ¨ä½œä¸šç®¡ç†å™¨ä¸Šå‘ç”Ÿä¸€äº›è‡´å‘½çš„é”™è¯¯ï¼Œä¹Ÿä¼šå½±å“é›†ç¾¤ä¸­è¿è¡Œçš„æ‰€æœ‰ä½œä¸šã€‚\n  å…¶ä»–è€ƒè™‘å› ç´ ï¼šæ‹¥æœ‰ä¸€ä¸ªé¢„å…ˆå­˜åœ¨çš„é›†ç¾¤ï¼Œå¯ä»¥èŠ‚çœå¤§é‡ç”³è¯·èµ„æºå’Œå¯åŠ¨ TaskManagers çš„æ—¶é—´ã€‚è¿™åœ¨ä½œä¸šçš„æ‰§è¡Œæ—¶é—´éå¸¸çŸ­ï¼Œé«˜å¯åŠ¨æ—¶é—´ä¼šå¯¹ç«¯åˆ°ç«¯çš„ç”¨æˆ·ä½“éªŒäº§ç”Ÿè´Ÿé¢å½±å“çš„åœºæ™¯ä¸­éå¸¸é‡è¦\u0026ndash;å°±åƒå¯¹çŸ­æŸ¥è¯¢çš„äº¤äº’å¼åˆ†æä¸€æ ·ï¼Œå¸Œæœ›ä½œä¸šèƒ½å¤Ÿåˆ©ç”¨ç°æœ‰èµ„æºå¿«é€Ÿæ‰§è¡Œè®¡ç®—ã€‚\n  æ³¨ï¼šä»¥å‰ï¼ŒFlink ä¼šè¯é›†ç¾¤ä¹Ÿè¢«ç§°ä¸ºä¼šè¯æ¨¡å¼ä¸‹çš„ Flink é›†ç¾¤ã€‚\nFlink ä½œä¸šé›†ç¾¤   é›†ç¾¤ç”Ÿå‘½å‘¨æœŸï¼šåœ¨ Flink Job Cluster ä¸­ï¼Œå¯ç”¨çš„é›†ç¾¤ç®¡ç†å™¨ï¼ˆå¦‚ YARN æˆ– Kubernetesï¼‰ä¸ºæ¯ä¸ªæäº¤çš„ä½œä¸šæ—‹è½¬ä¸€ä¸ªé›†ç¾¤ï¼Œè¿™ä¸ªé›†ç¾¤åªå¯¹è¯¥ä½œä¸šå¯ç”¨ã€‚åœ¨è¿™é‡Œï¼Œå®¢æˆ·ç«¯é¦–å…ˆå‘é›†ç¾¤ç®¡ç†å™¨è¯·æ±‚èµ„æºæ¥å¯åŠ¨ JobManagerï¼Œå¹¶å°†ä½œä¸šæäº¤ç»™è¿è¡Œåœ¨è¿™ä¸ªè¿›ç¨‹å†…éƒ¨çš„ Dispatcherã€‚ç„¶åæ ¹æ®ä½œä¸šçš„èµ„æºéœ€æ±‚ï¼Œæ‡’æƒ°åœ°åˆ†é… TaskManagerã€‚ä½œä¸šå®Œæˆåï¼ŒFlink Job Cluster å°±ä¼šè¢«æ‹†æ‰ã€‚\n  èµ„æºéš”ç¦»ï¼šJobManager çš„è‡´å‘½é”™è¯¯åªå½±å“è¯¥ Flink Job Cluster ä¸­è¿è¡Œçš„ä¸€ä¸ªä½œä¸šã€‚\n  å…¶ä»–è€ƒè™‘å› ç´ ï¼šç”±äº ResourceManager éœ€è¦ç”³è¯·å¹¶ç­‰å¾…å¤–éƒ¨èµ„æºç®¡ç†ç»„ä»¶æ¥å¯åŠ¨ TaskManager è¿›ç¨‹å¹¶åˆ†é…èµ„æºï¼Œå› æ­¤ Flink Job Cluster æ›´é€‚åˆè¿è¡Œæ—¶é—´é•¿ã€ç¨³å®šæ€§è¦æ±‚é«˜ã€å¯¹å¯åŠ¨æ—¶é—´è¾ƒé•¿ä¸æ•æ„Ÿçš„å¤§å‹ä½œä¸šã€‚\næ³¨ï¼šä»¥å‰ï¼ŒFlink Job Cluster ä¹Ÿè¢«ç§°ä¸ºä½œä¸šï¼ˆæˆ–æ¯ä½œä¸šï¼‰æ¨¡å¼ä¸‹çš„ Flink Clusterã€‚\nFlink åº”ç”¨é›†ç¾¤(Flink Application Cluster)   é›†ç¾¤ç”Ÿå‘½å‘¨æœŸï¼šFlink åº”ç”¨é›†ç¾¤æ˜¯ä¸€ä¸ªä¸“ç”¨çš„ Flink é›†ç¾¤ï¼Œå®ƒåªæ‰§è¡Œæ¥è‡ªä¸€ä¸ª Flink åº”ç”¨çš„ä½œä¸šï¼Œå¹¶ä¸” main() æ–¹æ³•è¿è¡Œåœ¨é›†ç¾¤ä¸Šè€Œä¸æ˜¯å®¢æˆ·ç«¯ä¸Šã€‚ä½œä¸šæäº¤æ˜¯ä¸€ä¸ªä¸€æ­¥åˆ°ä½çš„è¿‡ç¨‹ï¼šä½ ä¸éœ€è¦å…ˆå¯åŠ¨ä¸€ä¸ª Flink é›†ç¾¤ï¼Œç„¶åå‘ç°æœ‰çš„é›†ç¾¤ä¼šè¯æäº¤ä½œä¸šï¼Œè€Œæ˜¯å°†ä½ çš„åº”ç”¨é€»è¾‘å’Œä¾èµ–å…³ç³»æ‰“åŒ…æˆä¸€ä¸ªå¯æ‰§è¡Œçš„ä½œä¸š JARï¼Œé›†ç¾¤å…¥å£ç‚¹(ApplicationClusterEntryPoint)è´Ÿè´£è°ƒç”¨ main() æ–¹æ³•æ¥æå–ä½œä¸šå›¾ã€‚è¿™æ ·ä½ å°±å¯ä»¥åƒåœ¨ Kubernetes ä¸Šéƒ¨ç½²å…¶ä»–åº”ç”¨ä¸€æ ·éƒ¨ç½² Flink åº”ç”¨ï¼Œä¾‹å¦‚ã€‚å› æ­¤ï¼ŒFlink Application Cluster çš„å¯¿å‘½ä¸ Flink Application çš„å¯¿å‘½æ˜¯ç»‘å®šçš„ã€‚\n  èµ„æºéš”ç¦»ï¼šåœ¨ Flink Application Cluster ä¸­ï¼ŒResourceManager å’Œ Dispatcher çš„èŒƒå›´æ˜¯å•ä¸€çš„ Flink Applicationï¼Œè¿™æ¯” Flink Session Cluster æä¾›äº†æ›´å¥½çš„åˆ†ç¦»å…³æ³¨ç‚¹ã€‚\n  æ³¨ï¼šFlink Job Cluster å¯ä»¥çœ‹ä½œæ˜¯ Flink Application Cluster çš„ \u0026ldquo;run-on-client\u0026rdquo; æ›¿ä»£å“ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-20-flink-architecture/","tags":["Flink","architecture"],"title":"Flink çš„æ¶æ„"},{"categories":["programming"],"contents":"ä»‹ç» åŠæ—¶æµå¤„ç†æ˜¯æœ‰çŠ¶æ€æµå¤„ç†çš„ä¸€ç§æ‰©å±•ï¼Œå…¶ä¸­æ—¶é—´åœ¨è®¡ç®—ä¸­èµ·ç€ä¸€å®šçš„ä½œç”¨ã€‚å…¶ä¸­ï¼Œå½“ä½ åšæ—¶é—´åºåˆ—åˆ†ææ—¶ï¼Œå½“åšåŸºäºç‰¹å®šæ—¶é—´æ®µï¼ˆé€šå¸¸ç§°ä¸ºçª—å£ï¼‰çš„èšåˆæ—¶ï¼Œæˆ–è€…å½“ä½ åšäº‹ä»¶å¤„ç†æ—¶ï¼Œäº‹ä»¶å‘ç”Ÿçš„æ—¶é—´å¾ˆé‡è¦æ—¶ï¼Œéƒ½æ˜¯è¿™ç§æƒ…å†µã€‚\nåœ¨ä¸‹é¢çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ç€é‡ä»‹ç»ä¸€äº›æ‚¨åœ¨ä½¿ç”¨åŠæ—¶ Flink åº”ç”¨æ—¶åº”è¯¥è€ƒè™‘çš„ä¸»é¢˜ã€‚\næ—¶é—´çš„æ¦‚å¿µï¼šäº‹ä»¶æ—¶é—´å’Œå¤„ç†æ—¶é—´ å½“åœ¨æµç¨‹åºä¸­æåˆ°æ—¶é—´æ—¶ï¼ˆä¾‹å¦‚å®šä¹‰çª—å£ï¼‰ï¼Œå¯ä»¥æåˆ°ä¸åŒçš„æ—¶é—´æ¦‚å¿µã€‚\n å¤„ç†æ—¶é—´ã€‚å¤„ç†æ—¶é—´æŒ‡çš„æ˜¯æ­£åœ¨æ‰§è¡Œç›¸åº”æ“ä½œçš„æœºå™¨çš„ç³»ç»Ÿæ—¶é—´ã€‚  å½“æµç¨‹åºåœ¨å¤„ç†æ—¶é—´ä¸Šè¿è¡Œæ—¶ï¼Œæ‰€æœ‰åŸºäºæ—¶é—´çš„æ“ä½œ(å¦‚æ—¶é—´çª—å£)å°†ä½¿ç”¨è¿è¡Œå„æ“ä½œçš„æœºå™¨çš„ç³»ç»Ÿæ—¶é’Ÿã€‚ä¸€ä¸ªå°æ—¶çš„å¤„ç†æ—¶é—´çª—å£å°†åŒ…æ‹¬åœ¨ç³»ç»Ÿæ—¶é’ŸæŒ‡ç¤ºæ•´å°æ—¶çš„æ—¶é—´ä¹‹é—´åˆ°è¾¾ç‰¹å®šæ“ä½œè€…çš„æ‰€æœ‰è®°å½•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªåº”ç”¨ç¨‹åºåœ¨ä¸Šåˆ9:15å¼€å§‹è¿è¡Œï¼Œåˆ™ç¬¬ä¸€ä¸ªå°æ—¶å¤„ç†æ—¶é—´çª—å£å°†åŒ…æ‹¬ä¸Šåˆ9:15åˆ°10:00ä¹‹é—´å¤„ç†çš„äº‹ä»¶ï¼Œä¸‹ä¸€ä¸ªçª—å£å°†åŒ…æ‹¬ä¸Šåˆ10:00åˆ°11:00ä¹‹é—´å¤„ç†çš„äº‹ä»¶ï¼Œä»¥æ­¤ç±»æ¨ã€‚\nå¤„ç†æ—¶é—´æ˜¯æœ€ç®€å•çš„æ—¶é—´æ¦‚å¿µï¼Œä¸éœ€è¦æµå’Œæœºå™¨ä¹‹é—´çš„åè°ƒã€‚å®ƒæä¾›äº†æœ€å¥½çš„æ€§èƒ½å’Œæœ€ä½çš„å»¶è¿Ÿã€‚ç„¶è€Œï¼Œåœ¨åˆ†å¸ƒå¼å’Œå¼‚æ­¥ç¯å¢ƒä¸­ï¼Œå¤„ç†æ—¶é—´å¹¶ä¸èƒ½æä¾›ç¡®å®šæ€§ï¼Œå› ä¸ºå®ƒå¾ˆå®¹æ˜“å—åˆ°è®°å½•åˆ°è¾¾ç³»ç»Ÿçš„é€Ÿåº¦ï¼ˆä¾‹å¦‚ä»æ¶ˆæ¯é˜Ÿåˆ—ï¼‰ã€è®°å½•åœ¨ç³»ç»Ÿå†…éƒ¨çš„æ“ä½œå‘˜ä¹‹é—´æµåŠ¨çš„é€Ÿåº¦ä»¥åŠä¸­æ–­ï¼ˆè®¡åˆ’æ€§çš„æˆ–å…¶ä»–ï¼‰çš„å½±å“ã€‚\n äº‹ä»¶æ—¶é—´ã€‚äº‹ä»¶æ—¶é—´æ˜¯æŒ‡æ¯ä¸ªäº‹ä»¶åœ¨å…¶ç”Ÿäº§è®¾å¤‡ä¸Šå‘ç”Ÿçš„æ—¶é—´ã€‚è¿™ä¸ªæ—¶é—´é€šå¸¸åœ¨è®°å½•è¿›å…¥ Flink ä¹‹å‰å°±è¢«åµŒå…¥åˆ°è®°å½•ä¸­ï¼Œè¯¥äº‹ä»¶æ—¶é—´æˆ³å¯ä»¥ä»æ¯ä¸ªè®°å½•ä¸­æå–å‡ºæ¥ã€‚åœ¨äº‹ä»¶æ—¶é—´ä¸­ï¼Œæ—¶é—´çš„è¿›å±•å–å†³äºæ•°æ®ï¼Œè€Œä¸æ˜¯ä»»ä½•æŒ‚é’Ÿã€‚äº‹ä»¶æ—¶é—´ç¨‹åºå¿…é¡»æŒ‡å®šå¦‚ä½•ç”Ÿæˆäº‹ä»¶æ—¶é—´æ°´å°ï¼Œè¿™æ˜¯äº‹ä»¶æ—¶é—´ä¸­ä¿¡å·è¿›åº¦çš„æœºåˆ¶ã€‚è¿™ä¸ªæ°´å°æœºåˆ¶å°†åœ¨åé¢çš„ç« èŠ‚ä¸­æè¿°ï¼Œä¸‹é¢ã€‚  åœ¨ä¸€ä¸ªå®Œç¾çš„ä¸–ç•Œé‡Œï¼Œäº‹ä»¶æ—¶é—´å¤„ç†å°†äº§ç”Ÿå®Œå…¨ä¸€è‡´å’Œç¡®å®šçš„ç»“æœï¼Œä¸ç®¡äº‹ä»¶ä½•æ—¶åˆ°è¾¾ï¼Œæˆ–å®ƒä»¬çš„é¡ºåºå¦‚ä½•ã€‚ç„¶è€Œï¼Œé™¤éå·²çŸ¥äº‹ä»¶æ˜¯æŒ‰é¡ºåºåˆ°è¾¾çš„ï¼ˆé€šè¿‡æ—¶é—´æˆ³ï¼‰ï¼Œå¦åˆ™äº‹ä»¶æ—¶é—´å¤„ç†åœ¨ç­‰å¾…å¤±åºäº‹ä»¶æ—¶å°±ä¼šäº§ç”Ÿä¸€äº›å»¶è¿Ÿã€‚ç”±äºåªèƒ½åœ¨æœ‰é™çš„æ—¶é—´å†…ç­‰å¾…ï¼Œè¿™å°±å¯¹äº‹ä»¶æ—¶é—´åº”ç”¨çš„ç¡®å®šæ€§æå‡ºäº†é™åˆ¶ã€‚\nå‡è®¾æ‰€æœ‰çš„æ•°æ®éƒ½å·²ç»åˆ°è¾¾ï¼Œäº‹ä»¶æ—¶é—´æ“ä½œå°†æŒ‰ç…§é¢„æœŸçš„æ–¹å¼è¿›è¡Œï¼Œå³ä½¿åœ¨å¤„ç†å¤±åºæˆ–è¿Ÿåˆ°çš„äº‹ä»¶æ—¶ï¼Œæˆ–è€…åœ¨é‡æ–°å¤„ç†å†å²æ•°æ®æ—¶ï¼Œä¹Ÿèƒ½äº§ç”Ÿæ­£ç¡®å’Œä¸€è‡´çš„ç»“æœã€‚ä¾‹å¦‚ï¼Œæ¯å°æ—¶äº‹ä»¶æ—¶é—´çª—å£å°†åŒ…å«æ‰€æœ‰æºå¸¦äº‹ä»¶æ—¶é—´æˆ³çš„è®°å½•ï¼Œè¿™äº›è®°å½•å±äºè¯¥å°æ—¶ï¼Œæ— è®ºå®ƒä»¬åˆ°è¾¾çš„é¡ºåºå¦‚ä½•ï¼Œä¹Ÿæ— è®ºå®ƒä»¬ä½•æ—¶è¢«å¤„ç†ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è§\u0026ldquo;è¿Ÿåˆ°äº‹ä»¶\u0026rdquo;ä¸€èŠ‚ï¼‰ã€‚\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ‰æ—¶äº‹ä»¶æ—¶é—´ç¨‹åºåœ¨å®æ—¶å¤„ç†å®æ—¶æ•°æ®æ—¶ï¼Œä¼šä½¿ç”¨ä¸€äº›å¤„ç†æ—¶é—´æ“ä½œæ¥ä¿è¯å…¶åŠæ—¶è¿›è¡Œã€‚\näº‹ä»¶æ—¶é—´å’Œæ°´å° æ³¨ï¼šFlink å®ç°äº† Dataflow æ¨¡å‹ä¸­çš„è®¸å¤šæŠ€æœ¯ã€‚å¯¹äºäº‹ä»¶æ—¶é—´å’Œæ°´å°çš„ä»‹ç»ï¼Œå¯ä»¥çœ‹çœ‹ä¸‹é¢çš„æ–‡ç« ã€‚\n Tyler Akidau çš„ Streaming 101ã€‚ æ•°æ®æµæ¨¡å‹è®ºæ–‡  ä¸€ä¸ªæ”¯æŒäº‹ä»¶æ—¶é—´çš„æµå¤„ç†å™¨éœ€è¦ä¸€ç§æ–¹æ³•æ¥æµ‹é‡äº‹ä»¶æ—¶é—´çš„è¿›åº¦ã€‚ä¾‹å¦‚ï¼Œå½“äº‹ä»¶æ—¶é—´å·²ç»è¶…è¿‡ä¸€å°æ—¶ç»“æŸæ—¶ï¼Œéœ€è¦é€šçŸ¥å»ºç«‹å°æ—¶çª—å£çš„çª—å£æ“ä½œå‘˜ï¼Œä»¥ä¾¿æ“ä½œå‘˜å¯ä»¥å…³é—­æ­£åœ¨è¿›è¡Œçš„çª—å£ã€‚\näº‹ä»¶æ—¶é—´çš„è¿›å±•å¯ä»¥ç‹¬ç«‹äºå¤„ç†æ—¶é—´(ç”±æŒ‚é’Ÿæµ‹é‡)ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªç¨‹åºä¸­ï¼Œæ“ä½œè€…çš„å½“å‰äº‹ä»¶æ—¶é—´å¯èƒ½ç•¥å¾®è½åäºå¤„ç†æ—¶é—´(è€ƒè™‘åˆ°æ¥æ”¶äº‹ä»¶çš„å»¶è¿Ÿ)ï¼Œè€Œä¸¤è€…ä»¥ç›¸åŒçš„é€Ÿåº¦è¿›è¡Œã€‚å¦ä¸€æ–¹é¢ï¼Œå¦ä¸€ä¸ªæµç¨‹åºå¯èƒ½é€šè¿‡å¿«è¿›ä¸€äº›å·²ç»ç¼“å†²åœ¨ Kafka ä¸»é¢˜ï¼ˆæˆ–å¦ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ä¸­çš„å†å²æ•°æ®ï¼Œåªç”¨å‡ ç§’é’Ÿçš„å¤„ç†æ—¶é—´å°±å¯ä»¥å®Œæˆå‡ å‘¨çš„äº‹ä»¶æ—¶é—´çš„è¿›å±•ã€‚\nFlink ä¸­è¡¡é‡äº‹ä»¶æ—¶é—´è¿›åº¦çš„æœºåˆ¶æ˜¯æ°´å°ã€‚æ°´å°ä½œä¸ºæ•°æ®æµçš„ä¸€éƒ¨åˆ†æµåŠ¨ï¼Œå¹¶æºå¸¦ä¸€ä¸ªæ—¶é—´æˆ³ tï¼Œä¸€ä¸ª Watermark(t) å£°æ˜è¯¥æ•°æ®æµä¸­çš„äº‹ä»¶æ—¶é—´å·²ç»è¾¾åˆ°äº†æ—¶é—´ tï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥æ•°æ®æµä¸­ä¸åº”è¯¥å†æœ‰æ—¶é—´æˆ³ t'\u0026lt;=t çš„å…ƒç´ ï¼ˆå³äº‹ä»¶çš„æ—¶é—´æˆ³å¤§äºæˆ–ç­‰äºæ°´å°ï¼‰ã€‚\nä¸‹å›¾æ˜¾ç¤ºäº†ä¸€ä¸ªå¸¦æœ‰ï¼ˆé€»è¾‘ï¼‰æ—¶é—´æˆ³çš„äº‹ä»¶æµï¼Œä»¥åŠæ°´å°çš„å†…è”æµã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œäº‹ä»¶æ˜¯æŒ‰é¡ºåºæ’åˆ—çš„ï¼ˆç›¸å¯¹äºå®ƒä»¬çš„æ—¶é—´æˆ³ï¼‰ï¼Œè¿™æ„å‘³ç€æ°´å°åªæ˜¯æµä¸­çš„å‘¨æœŸæ€§æ ‡è®°ã€‚\næ°´å°å¯¹äºæ— åºæµæ¥è¯´æ˜¯è‡³å…³é‡è¦çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œäº‹ä»¶ä¸æ˜¯æŒ‰ç…§æ—¶é—´æˆ³æ¥æ’åºçš„ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæ°´å°æ˜¯ä¸€ç§å£°æ˜ï¼Œå³åœ¨æµä¸­çš„é‚£ä¸€ç‚¹ä¸Šï¼Œæ‰€æœ‰äº‹ä»¶åœ¨æŸä¸ªæ—¶é—´æˆ³ä¹‹å‰éƒ½åº”è¯¥å·²ç»åˆ°è¾¾ã€‚ä¸€æ—¦æ°´å°åˆ°è¾¾æ“ä½œè€…ï¼Œæ“ä½œè€…å¯ä»¥å°†å…¶å†…éƒ¨äº‹ä»¶æ—¶é—´æ—¶é’Ÿæå‰åˆ°æ°´å°çš„å€¼ã€‚\nè¯·æ³¨æ„ï¼Œäº‹ä»¶æ—¶é—´æ˜¯ç”±æ–°åˆ›å»ºçš„æµå…ƒç´ ï¼ˆæˆ–å…ƒç´ ï¼‰ä»äº§ç”Ÿå®ƒä»¬çš„äº‹ä»¶æˆ–è§¦å‘åˆ›å»ºè¿™äº›å…ƒç´ çš„æ°´å°ä¸­ç»§æ‰¿çš„ã€‚\nå¹¶è¡Œæµä¸­çš„æ°´å° æ°´å°æ˜¯åœ¨æºå‡½æ•°å¤„æˆ–ç›´æ¥åœ¨æºå‡½æ•°åç”Ÿæˆçš„ã€‚æºå‡½æ•°çš„æ¯ä¸ªå¹¶è¡Œå­ä»»åŠ¡é€šå¸¸éƒ½ä¼šç‹¬ç«‹åœ°ç”Ÿæˆå…¶æ°´å°ã€‚è¿™äº›æ°´å°å®šä¹‰äº†è¯¥ç‰¹å®šå¹¶è¡Œæºçš„äº‹ä»¶æ—¶é—´ã€‚\nå½“æ°´å°æµç»æµç¨‹åºæ—¶ï¼Œå®ƒä»¬ä¼šåœ¨å®ƒä»¬åˆ°è¾¾çš„æ“ä½œç¬¦å¤„æå‰äº‹ä»¶æ—¶é—´ã€‚æ¯å½“ä¸€ä¸ªæ“ä½œè€…æå‰å…¶äº‹ä»¶æ—¶é—´æ—¶ï¼Œå®ƒå°±ä¼šåœ¨ä¸‹æ¸¸ä¸ºå…¶åç»­æ“ä½œè€…ç”Ÿæˆä¸€ä¸ªæ–°çš„æ°´å°ã€‚\næœ‰äº›è¿ç®—ç¬¦ä¼šæ¶ˆè€—å¤šä¸ªè¾“å…¥æµï¼›ä¾‹å¦‚ï¼Œä¸€ä¸ªè”åˆï¼Œæˆ–è€…åœ¨ keyBy(...) æˆ– partition(...) å‡½æ•°ä¹‹åçš„è¿ç®—ç¬¦ã€‚è¿™ç§è¿ç®—ç¬¦çš„å½“å‰äº‹ä»¶æ—¶é—´æ˜¯å…¶è¾“å…¥æµäº‹ä»¶æ—¶é—´çš„æœ€å°å€¼ã€‚å½“å®ƒçš„è¾“å…¥æµæ›´æ–°å®ƒä»¬çš„äº‹ä»¶æ—¶é—´æ—¶ï¼Œè¯¥è¿ç®—ç¬¦ä¹Ÿä¼šæ›´æ–°ã€‚\nä¸‹å›¾æ˜¾ç¤ºäº†äº‹ä»¶å’Œæ°´å°åœ¨å¹¶è¡Œæµä¸­æµåŠ¨çš„ä¾‹å­ï¼Œä»¥åŠè¿ç®—ç¬¦è·Ÿè¸ªäº‹ä»¶æ—¶é—´çš„ä¾‹å­ã€‚\nå»¶æ—¶ æŸäº›å…ƒç´ æœ‰å¯èƒ½ä¼šè¿åæ°´å°æ¡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿åœ¨æ°´å°(t)å‘ç”Ÿåï¼Œä¹Ÿä¼šæœ‰æ›´å¤šæ—¶é—´æˆ³ t'\u0026lt;=t çš„å…ƒç´ å‘ç”Ÿã€‚äº‹å®ä¸Šï¼Œåœ¨è®¸å¤šç°å®ä¸–ç•Œçš„è®¾ç½®ä¸­ï¼ŒæŸäº›å…ƒç´ å¯ä»¥ä»»æ„å»¶è¿Ÿï¼Œè¿™ä½¿å¾—æ— æ³•æŒ‡å®šæŸä¸ªäº‹ä»¶æ—¶é—´æˆ³çš„æ‰€æœ‰å…ƒç´ åœ¨ä»€ä¹ˆæ—¶å€™å‘ç”Ÿã€‚æ­¤å¤–ï¼Œå³ä½¿å»¶è¿Ÿæ—¶é—´å¯ä»¥è¢«é™å®šï¼Œä½†å»¶è¿Ÿæ°´å°çš„æ—¶é—´è¿‡é•¿å¾€å¾€æ˜¯ä¸å¯å–çš„ï¼Œå› ä¸ºå®ƒå¯¹äº‹ä»¶æ—¶é—´çª—å£çš„è¯„ä¼°é€ æˆè¿‡å¤šçš„å»¶è¿Ÿã€‚\nå‡ºäºè¿™ä¸ªåŸå› ï¼Œæµåª’ä½“ç¨‹åºå¯èƒ½ä¼šæ˜¾å¼åœ°æœŸæœ›ä¸€äº›è¿Ÿåˆ°çš„å…ƒç´ ã€‚æ™šæœŸå…ƒç´ æ˜¯æŒ‡åœ¨ç³»ç»Ÿçš„äº‹ä»¶æ—¶é—´æ—¶é’Ÿï¼ˆç”±æ°´å°å‘å‡ºçš„ä¿¡å·ï¼‰å·²ç»è¿‡äº†æ™šæœŸå…ƒç´ çš„æ—¶é—´æˆ³ä¹‹ååˆ°è¾¾çš„å…ƒç´ ã€‚æœ‰å…³å¦‚ä½•åœ¨äº‹ä»¶æ—¶é—´çª—å£ä¸­å¤„ç†è¿Ÿåˆ°å…ƒç´ çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§å…è®¸çš„å»¶æ—¶ã€‚\nçª—å£ èšåˆäº‹ä»¶ï¼ˆå¦‚è®¡æ•°ã€æ±‚å’Œï¼‰åœ¨æµä¸Šçš„å·¥ä½œæ–¹å¼ä¸æ‰¹å¤„ç†ä¸­çš„å·¥ä½œæ–¹å¼ä¸åŒã€‚ä¾‹å¦‚ï¼Œä¸å¯èƒ½å¯¹ä¸€ä¸ªæµä¸­çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œè®¡æ•°ï¼Œå› ä¸ºæµä¸€èˆ¬æ˜¯æ— é™çš„ï¼ˆæ— è¾¹ç•Œçš„ï¼‰ã€‚ç›¸åï¼Œæµä¸Šçš„èšåˆï¼ˆè®¡æ•°ã€æ±‚å’Œç­‰ï¼‰æ˜¯ç”±çª—å£æ¥é™å®šèŒƒå›´çš„ï¼Œæ¯”å¦‚ \u0026ldquo;è¿‡å»5åˆ†é’Ÿçš„è®¡æ•°\u0026rdquo;ï¼Œæˆ–è€…\u0026quot;è¿‡å»100ä¸ªå…ƒç´ çš„æ€»å’Œ\u0026quot;ã€‚\nçª—å£å¯ä»¥æ˜¯æ—¶é—´é©±åŠ¨çš„ï¼ˆä¾‹å¦‚ï¼šæ¯30ç§’ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯æ•°æ®é©±åŠ¨çš„ï¼ˆä¾‹å¦‚ï¼šæ¯100ä¸ªå…ƒç´ ï¼‰ã€‚äººä»¬é€šå¸¸ä¼šåŒºåˆ†ä¸åŒç±»å‹çš„çª—å£ï¼Œå¦‚ç¿»æ»šçª—å£ï¼ˆæ— é‡å ï¼‰ã€æ»‘åŠ¨çª—å£ï¼ˆæœ‰é‡å ï¼‰å’Œä¼šè¯çª—å£ï¼ˆä»¥ä¸æ´»åŠ¨çš„é—´éš™ä¸ºç‚¹ï¼‰ã€‚\nè¯·æŸ¥çœ‹è¿™ç¯‡åšå®¢æ–‡ç« ï¼Œäº†è§£æ›´å¤šçš„çª—å£ç¤ºä¾‹ï¼Œæˆ–æŸ¥çœ‹ DataStream API çš„çª—å£æ–‡æ¡£ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-20-timely-stream-processing/","tags":["Flink","stream"],"title":"åŠæ—¶çš„æµå¤„ç†"},{"categories":["programming"],"contents":"ä»€ä¹ˆæ˜¯çŠ¶æ€ï¼Ÿ è™½ç„¶æ•°æ®æµä¸­çš„è®¸å¤šæ“ä½œä¸€æ¬¡åªçœ‹ä¸€ä¸ªå•ç‹¬çš„äº‹ä»¶ï¼ˆä¾‹å¦‚äº‹ä»¶åˆ†æå™¨ï¼‰ï¼Œä½†æœ‰äº›æ“ä½œä¼šè®°ä½å¤šä¸ªäº‹ä»¶çš„ä¿¡æ¯ï¼ˆä¾‹å¦‚çª—å£ operator ï¼‰ã€‚è¿™äº›æ“ä½œè¢«ç§°ä¸ºæœ‰çŠ¶æ€æ“ä½œã€‚\nä¸€äº›æœ‰çŠ¶æ€æ“ä½œçš„ä¾‹å­:\n å½“ä¸€ä¸ªåº”ç”¨ç¨‹åºæœç´¢æŸäº›äº‹ä»¶æ¨¡å¼æ—¶ï¼ŒçŠ¶æ€å°†å­˜å‚¨åˆ°ç›®å‰ä¸ºæ­¢é‡åˆ°çš„äº‹ä»¶åºåˆ—ã€‚ å½“æŒ‰åˆ†é’Ÿ/å°æ—¶/å¤©èšåˆäº‹ä»¶æ—¶ï¼ŒçŠ¶æ€ä¼šä¿å­˜å¾…èšåˆçš„äº‹ä»¶ã€‚ å½“åœ¨æ•°æ®ç‚¹æµä¸Šè®­ç»ƒæœºå™¨å­¦ä¹ æ¨¡å‹æ—¶ï¼ŒçŠ¶æ€ä¼šä¿å­˜æ¨¡å‹å‚æ•°çš„å½“å‰ç‰ˆæœ¬ã€‚ å½“éœ€è¦ç®¡ç†å†å²æ•°æ®æ—¶ï¼ŒçŠ¶æ€å¯ä»¥æœ‰æ•ˆè®¿é—®è¿‡å»å‘ç”Ÿçš„äº‹ä»¶ã€‚  Flink éœ€è¦äº†è§£çŠ¶æ€ï¼Œä»¥ä¾¿ä½¿ç”¨æ£€æŸ¥ç‚¹å’Œä¿å­˜ç‚¹ä½¿å…¶å…·æœ‰å®¹é”™æ€§ã€‚\nå…³äºçŠ¶æ€çš„çŸ¥è¯†è¿˜å…è®¸é‡æ–°ç¼©æ”¾ Flink åº”ç”¨ï¼Œè¿™æ„å‘³ç€ Flink è´Ÿè´£åœ¨å¹¶è¡Œå®ä¾‹ä¹‹é—´é‡æ–°åˆ†é…çŠ¶æ€ã€‚\nå¯æŸ¥è¯¢çŠ¶æ€å…è®¸ä½ åœ¨è¿è¡Œæ—¶ä» Flink å¤–éƒ¨è®¿é—®çŠ¶æ€ã€‚\nåœ¨å¤„ç†çŠ¶æ€æ—¶ï¼Œé˜…è¯»ä¸€ä¸‹ Flink çš„çŠ¶æ€åç«¯å¯èƒ½ä¹Ÿå¾ˆæœ‰ç”¨ã€‚Flink æä¾›äº†ä¸åŒçš„çŠ¶æ€åç«¯ï¼ŒæŒ‡å®šäº†çŠ¶æ€çš„å­˜å‚¨æ–¹å¼å’Œä½ç½®ã€‚\nKeyed State Keyed state è¢«ç»´æŠ¤åœ¨å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªåµŒå…¥å¼é”®/å€¼å­˜å‚¨ä¸­ã€‚è¯¥çŠ¶æ€ä¸¥æ ¼åœ°ä¸æœ‰çŠ¶æ€ operator è¯»å–çš„æµä¸€èµ·è¢«åˆ†å‰²å’Œåˆ†é…ã€‚å› æ­¤ï¼Œå¯¹é”®/å€¼çŠ¶æ€çš„è®¿é—®åªæœ‰åœ¨ keyed streams ä¸Šï¼Œå³åœ¨ keyed/åˆ†åŒºæ•°æ®äº¤æ¢ä¹‹åæ‰æœ‰å¯èƒ½ï¼Œå¹¶ä¸”ä»…é™äºä¸å½“å‰äº‹ä»¶çš„é”®ç›¸å…³è”çš„å€¼ã€‚å°†æµå’ŒçŠ¶æ€çš„é”®å¯¹é½ï¼Œå¯ä»¥ç¡®ä¿æ‰€æœ‰çš„çŠ¶æ€æ›´æ–°éƒ½æ˜¯æœ¬åœ°æ“ä½œï¼Œä¿è¯äº†ä¸€è‡´æ€§ï¼Œè€Œæ²¡æœ‰äº‹åŠ¡å¼€é”€ã€‚è¿™ç§å¯¹é½æ–¹å¼è¿˜å…è®¸ Flink é€æ˜åœ°é‡æ–°åˆ†é…çŠ¶æ€å’Œè°ƒæ•´æµåˆ†åŒºã€‚\nKeyed State è¢«è¿›ä¸€æ­¥ç»„ç»‡æˆæ‰€è°“çš„ Key Groupsã€‚Key Groups æ˜¯ Flink å¯ä»¥é‡æ–°åˆ†é… Keyed State çš„åŸå­å•ä½ï¼›Key Groups çš„æ•°é‡æ­£å¥½ä¸å®šä¹‰çš„æœ€å¤§å¹¶è¡Œåº¦ç›¸åŒã€‚åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œkeyed operator çš„æ¯ä¸ªå¹¶è¡Œå®ä¾‹éƒ½ä¸ä¸€ä¸ªæˆ–å¤šä¸ª Key Groups çš„é”®ä¸€èµ·å·¥ä½œã€‚\nçŠ¶æ€æŒä¹…åŒ– Flink ä½¿ç”¨æµé‡æ”¾(stream replay)å’Œæ£€æŸ¥ç‚¹(checkpointing)çš„ç»„åˆæ¥å®ç°å®¹é”™ã€‚ä¸€ä¸ªæ£€æŸ¥ç‚¹æ ‡è®°äº†æ¯ä¸ªè¾“å…¥æµä¸­çš„ä¸€ä¸ªç‰¹å®šç‚¹ä»¥åŠæ¯ä¸ª operator çš„ç›¸åº”çŠ¶æ€ã€‚é€šè¿‡æ¢å¤è¿ç®—ç¬¦çš„çŠ¶æ€ï¼Œä»æ£€æŸ¥ç‚¹å¼€å§‹é‡æ”¾è®°å½•ï¼Œå¯ä»¥ä»æ£€æŸ¥ç‚¹æ¢å¤æµæ•°æ®æµï¼ŒåŒæ—¶ä¿æŒä¸€è‡´æ€§ï¼ˆç²¾ç¡®çš„ä¸€æ¬¡å¤„ç†è¯­ä¹‰ï¼‰ã€‚\næ£€æŸ¥ç‚¹é—´éš”æ˜¯ç”¨æ¢å¤æ—¶é—´ï¼ˆéœ€è¦é‡æ”¾çš„è®°å½•æ•°é‡ï¼‰æ¥äº¤æ¢æ‰§è¡Œè¿‡ç¨‹ä¸­å®¹é”™çš„å¼€é”€çš„ä¸€ç§æ‰‹æ®µã€‚\nå®¹é”™æœºåˆ¶ä¸æ–­åœ°ç»˜åˆ¶åˆ†å¸ƒå¼æµæ•°æ®æµçš„å¿«ç…§ã€‚å¯¹äºçŠ¶æ€è¾ƒå°çš„æµåª’ä½“åº”ç”¨ï¼Œè¿™äº›å¿«ç…§éå¸¸è½»é‡çº§ï¼Œå¯ä»¥é¢‘ç¹åœ°ç»˜åˆ¶ï¼Œè€Œä¸ä¼šå¯¹æ€§èƒ½äº§ç”Ÿå¤ªå¤§çš„å½±å“ã€‚æµåº”ç”¨çš„çŠ¶æ€å­˜å‚¨åœ¨ä¸€ä¸ªå¯é…ç½®çš„åœ°æ–¹ï¼Œé€šå¸¸æ˜¯åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚\nåœ¨ç¨‹åºå¤±è´¥çš„æƒ…å†µä¸‹ï¼ˆç”±äºæœºå™¨ã€ç½‘ç»œæˆ–è½¯ä»¶æ•…éšœï¼‰ï¼ŒFlinkä¼šåœæ­¢åˆ†å¸ƒå¼æµæ•°æ®æµã€‚ç„¶åç³»ç»Ÿä¼šé‡æ–°å¯åŠ¨ operator ï¼Œå¹¶å°†å…¶é‡ç½®åˆ°æœ€æ–°çš„æˆåŠŸæ£€æŸ¥ç‚¹ã€‚è¾“å…¥æµè¢«é‡ç½®åˆ°çŠ¶æ€å¿«ç…§çš„ç‚¹ã€‚ä½œä¸ºé‡æ–°å¯åŠ¨çš„å¹¶è¡Œæ•°æ®æµçš„ä¸€éƒ¨åˆ†å¤„ç†çš„ä»»ä½•è®°å½•éƒ½ä¿è¯ä¸å½±å“ä¹‹å‰çš„æ£€æŸ¥ç‚¹çŠ¶æ€ã€‚\næ³¨: é»˜è®¤æƒ…å†µä¸‹ï¼Œæ£€æŸ¥ç‚¹è¢«ç¦ç”¨ã€‚æœ‰å…³å¦‚ä½•å¯ç”¨å’Œé…ç½®æ£€æŸ¥ç‚¹çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§æ£€æŸ¥ç‚¹ã€‚\næ³¨: ä¸ºäº†å®ç°è¿™ç§æœºåˆ¶çš„å®Œå…¨ä¿è¯ï¼Œæ•°æ®æµæºï¼ˆå¦‚æ¶ˆæ¯é˜Ÿåˆ—æˆ– brokerï¼‰éœ€è¦èƒ½å¤Ÿå°†æ•°æ®æµå€’é€€åˆ°ä¸€ä¸ªå®šä¹‰çš„æœ€è¿‘ç‚¹ã€‚Apache Kafka å…·æœ‰è¿™ç§èƒ½åŠ›ï¼ŒFlink çš„ Kafka è¿æ¥å™¨åˆ©ç”¨äº†è¿™ä¸€ç‚¹ã€‚å‚è§æ•°æ®æºå’Œæ¥æ”¶å™¨çš„å®¹é”™ä¿è¯ï¼Œäº†è§£æ›´å¤šå…³äº Flink è¿æ¥å™¨æä¾›çš„ä¿è¯çš„ä¿¡æ¯ã€‚\næ³¨: å› ä¸º Flink çš„æ£€æŸ¥ç‚¹æ˜¯é€šè¿‡åˆ†å¸ƒå¼å¿«ç…§å®ç°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬äº’æ¢ä½¿ç”¨å¿«ç…§å’Œæ£€æŸ¥ç‚¹è¿™ä¸¤ä¸ªè¯ã€‚é€šå¸¸æˆ‘ä»¬ä¹Ÿä½¿ç”¨æœ¯è¯­å¿«ç…§æ¥è¡¨ç¤ºæ£€æŸ¥ç‚¹æˆ–ä¿å­˜ç‚¹ã€‚\næ£€æŸ¥ç‚¹ Flink å®¹é”™æœºåˆ¶çš„æ ¸å¿ƒéƒ¨åˆ†æ˜¯ç»˜åˆ¶åˆ†å¸ƒå¼æ•°æ®æµå’Œ operator çŠ¶æ€çš„ä¸€è‡´å¿«ç…§ã€‚è¿™äº›å¿«ç…§ä½œä¸ºä¸€è‡´çš„æ£€æŸ¥ç‚¹ï¼Œç³»ç»Ÿåœ¨å‘ç”Ÿæ•…éšœæ—¶å¯ä»¥å›é€€ã€‚Flink ç»˜åˆ¶è¿™äº›å¿«ç…§çš„æœºåˆ¶åœ¨ \u0026ldquo;Lightweight Asynchronous Snapshots for Distributed Dataflows\u0026rdquo; ä¸­æè¿°ã€‚å®ƒçš„çµæ„Ÿæ¥è‡ªäºåˆ†å¸ƒå¼å¿«ç…§çš„æ ‡å‡† Chandy-Lamport ç®—æ³•ï¼Œå¹¶ä¸“é—¨ä¸º Flink çš„æ‰§è¡Œæ¨¡å‹é‡èº«å®šåšã€‚\nè¯·è®°ä½ï¼Œæ‰€æœ‰ä¸æ£€æŸ¥ç‚¹æœ‰å…³çš„äº‹æƒ…éƒ½å¯ä»¥å¼‚æ­¥å®Œæˆã€‚æ£€æŸ¥ç‚¹å±éšœä¸æŒ‰é”æ­¥èµ°ï¼Œæ“ä½œå¯ä»¥å¼‚æ­¥å¿«ç…§å…¶çŠ¶æ€ã€‚\nè‡ª Flink 1.11 ä»¥æ¥ï¼Œæ£€æŸ¥ç‚¹å¯ä»¥åœ¨æœ‰æˆ–æ²¡æœ‰å¯¹é½çš„æƒ…å†µä¸‹è¿›è¡Œã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬å…ˆä»‹ç»å¯¹é½çš„æ£€æŸ¥ç‚¹ã€‚\nå±éšœ Flink çš„åˆ†å¸ƒå¼å¿«ç…§ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒå…ƒç´ æ˜¯æµå±éšœã€‚è¿™äº›å±éšœè¢«æ³¨å…¥åˆ°æ•°æ®æµä¸­ï¼Œå¹¶ä½œä¸ºæ•°æ®æµçš„ä¸€éƒ¨åˆ†ä¸è®°å½•ä¸€èµ·æµåŠ¨ã€‚å±éšœæ°¸è¿œä¸ä¼šè¶…è¶Šè®°å½•ï¼Œå®ƒä»¬ä¸¥æ ¼æŒ‰ç…§çº¿è·¯æµåŠ¨ã€‚å±éšœå°†æ•°æ®æµä¸­çš„è®°å½•åˆ†ä¸ºè¿›å…¥å½“å‰å¿«ç…§çš„è®°å½•é›†å’Œè¿›å…¥ä¸‹ä¸€ä¸ªå¿«ç…§çš„è®°å½•ã€‚æ¯ä¸ªå±éšœéƒ½å¸¦æœ‰å…¶è®°å½•è¢«æ¨åˆ°å‰é¢çš„å¿«ç…§çš„IDã€‚å±éšœä¸ä¼šä¸­æ–­æ•°æ®æµçš„æµåŠ¨ï¼Œå› æ­¤éå¸¸è½»é‡çº§ã€‚ä¸åŒå¿«ç…§çš„å¤šä¸ªå±éšœå¯ä»¥åŒæ—¶å‡ºç°åœ¨æµä¸­ï¼Œè¿™æ„å‘³ç€ä¸åŒçš„å¿«ç…§å¯ä»¥åŒæ—¶å‘ç”Ÿã€‚\næµå±éšœæ˜¯åœ¨æµæºå¤„æ³¨å…¥å¹¶è¡Œæ•°æ®æµã€‚å¿«ç…§nçš„å±éšœè¢«æ³¨å…¥çš„ç‚¹ï¼ˆæˆ‘ä»¬ç§°å®ƒä¸º Sâ‚™ï¼‰æ˜¯æºæµä¸­å¿«ç…§è¦†ç›–æ•°æ®çš„ä½ç½®ã€‚ä¾‹å¦‚ï¼Œåœ¨ Apache Kafka ä¸­ï¼Œè¿™ä¸ªä½ç½®å°†æ˜¯åˆ†åŒºä¸­æœ€åä¸€æ¡è®°å½•çš„åç§»ã€‚è¿™ä¸ªä½ç½® Sâ‚™ è¢«æŠ¥å‘Šç»™æ£€æŸ¥ç‚¹åè°ƒå™¨ï¼ˆFlink çš„ JobManagerï¼‰ã€‚\nç„¶åï¼Œå±éšœå°±ä¼šæµå‘ä¸‹æ¸¸ã€‚å½“ä¸€ä¸ªä¸­é—´ operator ä»å®ƒçš„æ‰€æœ‰è¾“å…¥æµä¸­æ¥æ”¶åˆ°ä¸€ä¸ªå¿«ç…§nçš„å±éšœæ—¶ï¼Œå®ƒå°±ä¼šå‘å®ƒçš„æ‰€æœ‰è¾“å‡ºæµä¸­å‘å‡ºä¸€ä¸ªå¿«ç…§nçš„å±éšœã€‚ä¸€æ—¦ä¸€ä¸ªæ±‡ operator ï¼ˆæµ DAG çš„æœ«ç«¯ï¼‰ä»å®ƒçš„æ‰€æœ‰è¾“å…¥æµä¸­æ¥æ”¶åˆ°å±éšœnï¼Œå®ƒå°±ä¼šå‘æ£€æŸ¥ç‚¹åè°ƒå™¨ç¡®è®¤è¯¥å¿«ç…§nã€‚åœ¨æ‰€æœ‰çš„æ¥æ”¶å™¨(sink)ç¡®è®¤äº†ä¸€ä¸ªå¿«ç…§ä¹‹åï¼Œå®ƒå°±è¢«è®¤ä¸ºå®Œæˆäº†ã€‚\nä¸€æ—¦å¿«ç…§nå®Œæˆåï¼Œä½œä¸šå†ä¹Ÿä¸ä¼šå‘æºå¤´è¯¢é—® Sâ‚™ ä¹‹å‰çš„è®°å½•ï¼Œå› ä¸ºæ­¤æ—¶è¿™äº›è®°å½•ï¼ˆä»¥åŠå®ƒä»¬çš„å­å­™è®°å½•ï¼‰å°†é€šè¿‡æ•´ä¸ªæ•°æ®æµæ‹“æ‰‘ã€‚\næ¥æ”¶å¤šä¸ªè¾“å…¥æµçš„ operator éœ€è¦å°†è¾“å…¥æµå¯¹å‡†å¿«ç…§å±éšœã€‚ä¸Šå›¾å°±è¯´æ˜äº†è¿™ä¸€ç‚¹ã€‚\n ä¸€æ—¦ operator ä»ä¸€ä¸ªè¾“å…¥æµä¸­æ¥æ”¶åˆ°å¿«ç…§å±éšœnï¼Œå®ƒå°±ä¸èƒ½å†å¤„ç†è¯¥æµçš„ä»»ä½•è®°å½•ï¼Œç›´åˆ°å®ƒä¹Ÿä»å…¶ä»–è¾“å…¥ä¸­æ¥æ”¶åˆ°å±éšœnã€‚å¦åˆ™ï¼Œå®ƒå°±ä¼šæŠŠå±äºå¿«ç…§nçš„è®°å½•å’Œå±äºå¿«ç…§n+1çš„è®°å½•æ··åœ¨ä¸€èµ·ã€‚ ä¸€æ—¦æœ€åä¸€ä¸ªæµæ”¶åˆ°äº†å±éšœnï¼Œ operator å°±ä¼šå‘å‡ºæ‰€æœ‰çš„å¾…å‘è®°å½•ï¼Œç„¶åè‡ªå·±å‘å‡ºå¿«ç…§nçš„å±éšœã€‚ å®ƒå¿«ç…§çŠ¶æ€å¹¶æ¢å¤å¤„ç†æ‰€æœ‰è¾“å…¥æµçš„è®°å½•ï¼Œåœ¨å¤„ç†æµçš„è®°å½•ä¹‹å‰ï¼Œå…ˆå¤„ç†è¾“å…¥ç¼“å†²åŒºçš„è®°å½•ã€‚ æœ€åï¼Œ operator å°†çŠ¶æ€å¼‚æ­¥å†™å…¥çŠ¶æ€åç«¯ã€‚  éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰€æœ‰å…·æœ‰å¤šä¸ªè¾“å…¥çš„ operator å’Œæ´—ç‰Œåçš„ operator åœ¨æ¶ˆè€—å¤šä¸ªä¸Šæ¸¸å­ä»»åŠ¡çš„è¾“å‡ºæµæ—¶ï¼Œéƒ½éœ€è¦è¿›è¡Œå¯¹é½ã€‚\nå¿«ç…§ Operator State å½“ operator åŒ…å«ä»»ä½•å½¢å¼çš„çŠ¶æ€æ—¶ï¼Œè¿™ä¸ªçŠ¶æ€ä¹Ÿå¿…é¡»æ˜¯å¿«ç…§çš„ä¸€éƒ¨åˆ†ã€‚\nOperator åœ¨ä»è¾“å…¥æµæ¥æ”¶åˆ°æ‰€æœ‰å¿«ç…§å±éšœåï¼Œåœ¨å‘è¾“å‡ºæµå‘å‡ºå±éšœä¹‹å‰ï¼Œåœ¨è¿™ä¸ªæ—¶é—´ç‚¹å¿«ç…§å…¶çŠ¶æ€ã€‚è¿™æ—¶ï¼Œæ‰€æœ‰æ¥è‡ªå±éšœä¹‹å‰çš„è®°å½•å¯¹çŠ¶æ€çš„æ›´æ–°éƒ½å·²ç»è¿›è¡Œäº†ï¼Œè€Œæ²¡æœ‰ä¾èµ–äºå±éšœä¹‹åçš„è®°å½•çš„æ›´æ–°ã€‚ç”±äºå¿«ç…§çš„çŠ¶æ€å¯èƒ½å¾ˆå¤§ï¼Œæ‰€ä»¥å®ƒè¢«å­˜å‚¨åœ¨ä¸€ä¸ªå¯é…ç½®çš„çŠ¶æ€åç«¯ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™æ˜¯ JobManager çš„å†…å­˜ï¼Œä½†å¯¹äºç”Ÿäº§ä½¿ç”¨ï¼Œåº”è¯¥é…ç½®ä¸€ä¸ªåˆ†å¸ƒå¼çš„å¯é å­˜å‚¨ï¼ˆå¦‚ HDFSï¼‰ã€‚çŠ¶æ€å­˜å‚¨å®Œæ¯•åï¼Œ operator ç¡®è®¤æ£€æŸ¥ç‚¹ï¼Œå‘è¾“å‡ºæµå‘å‡ºå¿«ç…§å±éšœï¼Œç„¶åç»§ç»­è¿›è¡Œã€‚\nç°åœ¨äº§ç”Ÿçš„å¿«ç…§åŒ…å«ã€‚\n å¯¹äºæ¯ä¸ªå¹¶è¡Œæµæ•°æ®æºï¼Œå½“å¿«ç…§å¼€å§‹æ—¶ï¼Œæµä¸­çš„åç§»é‡/ä½ç½®ã€‚ å¯¹äºæ¯ä¸ª operatorï¼Œä¸€ä¸ªæŒ‡å‘ä½œä¸ºå¿«ç…§çš„ä¸€éƒ¨åˆ†å­˜å‚¨çš„çŠ¶æ€çš„æŒ‡é’ˆã€‚  æ¢å¤ è¿™ç§æœºåˆ¶ä¸‹çš„æ¢å¤æ˜¯ç›´æ¥çš„ã€‚ç³»ç»Ÿä¼šé‡æ–°éƒ¨ç½²æ•´ä¸ªåˆ†å¸ƒå¼æ•°æ®æµï¼Œå¹¶ç»™æ¯ä¸ª operator æä¾›å¿«ç…§çš„çŠ¶æ€ï¼Œä½œä¸ºæ£€æŸ¥ç‚¹ k çš„ä¸€éƒ¨åˆ†ã€‚ æ¥æºè¢«è®¾ç½®ä¸ºä»ä½ç½® Sâ‚– å¼€å§‹è¯»å–æ•°æ®æµã€‚ä¾‹å¦‚åœ¨ Apache Kafka ä¸­ï¼Œè¿™æ„å‘³ç€å‘Šè¯‰æ¶ˆè´¹è€…ä»åç§»é‡ Sâ‚– å¼€å§‹è·å–ã€‚\nå¦‚æœçŠ¶æ€æ˜¯å¢é‡å¿«ç…§çš„ï¼Œåˆ™è¿ç®—ç¬¦ä»æœ€æ–°çš„å®Œæ•´å¿«ç…§çš„çŠ¶æ€å¼€å§‹ï¼Œç„¶åå¯¹è¯¥çŠ¶æ€åº”ç”¨ä¸€ç³»åˆ—å¢é‡å¿«ç…§æ›´æ–°ã€‚\næ›´å¤šä¿¡æ¯è¯·å‚è§é‡å¯ç­–ç•¥ã€‚\nä¸å¯¹é½æ£€æŸ¥ç‚¹ ä» Flink 1.11 å¼€å§‹ï¼Œæ£€æŸ¥ç‚¹ä¹Ÿå¯ä»¥åœ¨ä¸å¯¹é½çš„æƒ…å†µä¸‹è¿›è¡Œã€‚åŸºæœ¬æ€è·¯æ˜¯ï¼Œåªè¦é£è¡Œä¸­çš„æ•°æ®æˆä¸º operator çŠ¶æ€çš„ä¸€éƒ¨åˆ†ï¼Œæ£€æŸ¥ç‚¹å°±å¯ä»¥è¦†ç›–æ‰€æœ‰é£è¡Œä¸­çš„æ•°æ®ã€‚\nè¯·æ³¨æ„ï¼Œè¿™ç§æ–¹æ³•å®é™…ä¸Šæ›´æ¥è¿‘ Chandy-Lamport ç®—æ³• ï¼Œä½† Flink ä»ç„¶åœ¨æºä¸­æ’å…¥å±éšœï¼Œä»¥é¿å…è¶…è½½æ£€æŸ¥ç‚¹åè°ƒå™¨ã€‚\nè¯¥å›¾æè¿°äº†ä¸€ä¸ª operator å¦‚ä½•å¤„ç†ä¸å¯¹é½çš„æ£€æŸ¥ç‚¹å±éšœã€‚\n operator å¯¹è¾“å…¥ç¼“å†²åŒºä¸­å­˜å‚¨çš„ç¬¬ä¸€ä¸ªå±éšœä½œå‡ºååº”ã€‚ å®ƒç«‹å³å°†å±éšœè½¬å‘ç»™ä¸‹æ¸¸ operator ï¼Œå°†å…¶æ·»åŠ åˆ°è¾“å‡ºç¼“å†²åŒºçš„æœ«å°¾ã€‚ operator å°†æ‰€æœ‰è¢«è¶…è¶Šçš„è®°å½•æ ‡è®°ä¸ºå¼‚æ­¥å­˜å‚¨ï¼Œå¹¶åˆ›å»ºè‡ªå·±çŠ¶æ€çš„å¿«ç…§ã€‚  å› æ­¤ï¼Œ operator åªçŸ­æš‚åœ°åœæ­¢å¯¹è¾“å…¥çš„å¤„ç†ä»¥æ ‡è®°ç¼“å†²åŒºï¼Œè½¬å‘å±éšœï¼Œå¹¶åˆ›å»ºå…¶ä»–çŠ¶æ€çš„å¿«ç…§ã€‚\nä¸å¯¹é½çš„æ£€æŸ¥ç‚¹ç¡®ä¿å±éšœä»¥æœ€å¿«çš„é€Ÿåº¦åˆ°è¾¾æ±‡æµæ’ã€‚å®ƒç‰¹åˆ«é€‚åˆäºè‡³å°‘æœ‰ä¸€æ¡ç¼“æ…¢ç§»åŠ¨çš„æ•°æ®è·¯å¾„çš„åº”ç”¨ï¼Œåœ¨è¿™ç§åº”ç”¨ä¸­ï¼Œå¯¹é½æ—¶é—´å¯èƒ½è¾¾åˆ°æ•°å°æ—¶ã€‚ç„¶è€Œï¼Œç”±äºå®ƒå¢åŠ äº†é¢å¤–çš„I/Oå‹åŠ›ï¼Œæ‰€ä»¥å½“çŠ¶æ€åç«¯çš„I/Oæ˜¯ç“¶é¢ˆæ—¶ï¼Œå®ƒå¹¶æ²¡æœ‰å¸®åŠ©ã€‚å…³äºå…¶ä»–çš„å±€é™æ€§ï¼Œè¯·å‚è§è¿ç»´ä¸­æ›´æ·±å…¥çš„è®¨è®ºã€‚\nè¯·æ³¨æ„ï¼Œä¿å­˜ç‚¹å°†å§‹ç»ˆæ˜¯å¯¹é½çš„ã€‚\næœªå¯¹é½çš„æ¢å¤ operator é¦–å…ˆæ¢å¤é£è¡Œä¸­çš„æ•°æ®ï¼Œç„¶åæ‰å¼€å§‹å¤„ç†æ¥è‡ªä¸Šæ¸¸ operator åœ¨ä¸ç»“ç›Ÿæ£€æŸ¥ç‚¹çš„ä»»ä½•æ•°æ®ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒæ‰§è¡Œçš„æ­¥éª¤ä¸æ¢å¤å¯¹é½æ£€æŸ¥ç‚¹æ—¶ç›¸åŒã€‚\nçŠ¶æ€åç«¯ é”®/å€¼ç´¢å¼•çš„å…·ä½“æ•°æ®ç»“æ„å–å†³äºæ‰€é€‰æ‹©çš„çŠ¶æ€åç«¯ã€‚ä¸€ç§çŠ¶æ€åç«¯å°†æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­çš„å“ˆå¸Œå›¾ä¸­ï¼Œå¦ä¸€ç§çŠ¶æ€åç«¯ä½¿ç”¨ RocksDB ä½œä¸ºé”®/å€¼å­˜å‚¨ã€‚é™¤äº†å®šä¹‰æŒæœ‰çŠ¶æ€çš„æ•°æ®ç»“æ„å¤–ï¼ŒçŠ¶æ€åç«¯è¿˜å®ç°äº†å¯¹é”®/å€¼çŠ¶æ€è¿›è¡Œæ—¶é—´ç‚¹å¿«ç…§çš„é€»è¾‘ï¼Œå¹¶å°†è¯¥å¿«ç…§ä½œä¸ºæ£€æŸ¥ç‚¹çš„ä¸€éƒ¨åˆ†è¿›è¡Œå­˜å‚¨ã€‚çŠ¶æ€åç«¯å¯ä»¥åœ¨ä¸æ”¹å˜åº”ç”¨é€»è¾‘çš„æƒ…å†µä¸‹è¿›è¡Œé…ç½®ã€‚\nä¿å­˜ç‚¹ æ‰€æœ‰ä½¿ç”¨æ£€æŸ¥ç‚¹çš„ç¨‹åºéƒ½å¯ä»¥ä»ä¿å­˜ç‚¹(savepoint)æ¢å¤æ‰§è¡Œã€‚ä¿å­˜ç‚¹å…è®¸åœ¨ä¸ä¸¢å¤±ä»»ä½•çŠ¶æ€çš„æƒ…å†µä¸‹åŒæ—¶æ›´æ–°ä½ çš„ç¨‹åºå’Œ Flink é›†ç¾¤ã€‚\nä¿å­˜ç‚¹æ˜¯æ‰‹åŠ¨è§¦å‘çš„æ£€æŸ¥ç‚¹ï¼Œå®ƒé‡‡å–ç¨‹åºçš„å¿«ç…§å¹¶å°†å…¶å†™å…¥çŠ¶æ€åç«¯ã€‚å®ƒä»¬ä¾é å¸¸è§„çš„æ£€æŸ¥ç‚¹æœºåˆ¶æ¥å®ç°ã€‚\nä¿å­˜ç‚¹ä¸æ£€æŸ¥ç‚¹ç±»ä¼¼ï¼Œåªæ˜¯å®ƒä»¬æ˜¯ç”±ç”¨æˆ·è§¦å‘çš„ï¼Œå½“æ–°çš„æ£€æŸ¥ç‚¹å®Œæˆåï¼Œå®ƒä»¬ä¸ä¼šè‡ªåŠ¨å¤±æ•ˆã€‚\nå®Œå…¨ä¸€æ¬¡ä¸è‡³å°‘ä¸€æ¬¡ å¯¹é½æ­¥éª¤å¯èƒ½ä¼šç»™æµåª’ä½“ç¨‹åºå¢åŠ å»¶è¿Ÿã€‚é€šå¸¸ï¼Œè¿™ç§é¢å¤–çš„å»¶è¿Ÿæ˜¯åœ¨å‡ æ¯«ç§’çš„æ•°é‡çº§ï¼Œä½†æˆ‘ä»¬å·²ç»çœ‹åˆ°ä¸€äº›å¼‚å¸¸å€¼çš„å»¶è¿Ÿæ˜æ˜¾å¢åŠ çš„æƒ…å†µã€‚å¯¹äºè¦æ±‚æ‰€æœ‰è®°å½•æŒç»­è¶…ä½å»¶è¿Ÿï¼ˆå‡ æ¯«ç§’ï¼‰çš„åº”ç”¨ï¼ŒFlink æœ‰ä¸€ä¸ªå¼€å…³ï¼Œå¯ä»¥åœ¨æ£€æŸ¥ç‚¹æœŸé—´è·³è¿‡æµå¯¹é½ã€‚åªè¦ operator ä»æ¯ä¸ªè¾“å…¥ä¸­çœ‹åˆ°æ£€æŸ¥ç‚¹å±éšœï¼Œæ£€æŸ¥ç‚¹å¿«ç…§ä»ç„¶ä¼šè¢«ç»˜åˆ¶ã€‚\nå½“è·³è¿‡å¯¹é½æ—¶ï¼Œ operator ä¼šç»§ç»­å¤„ç†æ‰€æœ‰çš„è¾“å…¥ï¼Œç”šè‡³åœ¨ä¸€äº›æ£€æŸ¥ç‚¹ n çš„æ£€æŸ¥ç‚¹å±éšœåˆ°è¾¾åï¼Œ operator ä¹Ÿä¼šç»§ç»­å¤„ç†ã€‚è¿™æ ·ä¸€æ¥ï¼Œ operator ä¹Ÿä¼šåœ¨æ£€æŸ¥ç‚¹ n çš„çŠ¶æ€å¿«ç…§è¢«é‡‡é›†ä¹‹å‰å¤„ç†å±äºæ£€æŸ¥ç‚¹ n+1 çš„å…ƒç´ ã€‚åœ¨è¿˜åŸæ—¶ï¼Œè¿™äº›è®°å½•å°†ä½œä¸ºé‡å¤å‘ç”Ÿï¼Œå› ä¸ºå®ƒä»¬éƒ½åŒ…å«åœ¨æ£€æŸ¥ç‚¹ n çš„çŠ¶æ€å¿«ç…§ä¸­ï¼Œå¹¶å°†åœ¨æ£€æŸ¥ç‚¹ n ä¹‹åä½œä¸ºæ•°æ®çš„ä¸€éƒ¨åˆ†é‡æ”¾ã€‚\næ³¨æ„å¯¹é½åªå‘ç”Ÿåœ¨æœ‰å¤šä¸ªå‰è¾ˆçš„ operator ï¼ˆè¿æ¥ï¼‰ä»¥åŠæœ‰å¤šä¸ªå‘é€è€…çš„ operator ï¼ˆæµé‡æ–°åˆ†åŒº/æ´—ç‰Œåï¼‰ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œå³ä½¿åœ¨è‡³å°‘ä¸€æ¬¡çš„æ¨¡å¼ä¸‹ï¼Œåªæœ‰ä»¤äººå°´å°¬çš„å¹¶è¡Œæµæ“ä½œ(map(), flatMap(), filter(), \u0026hellip;)çš„æ•°æ®æµå®é™…ä¸Šä¹Ÿä¼šç»™å‡ºç²¾ç¡®çš„ä¸€æ¬¡ä¿è¯ã€‚\næ‰¹é‡ç¨‹åºä¸­çš„çŠ¶æ€å’Œå®¹é”™èƒ½åŠ› Flink æ‰§è¡Œæ‰¹å¤„ç†ç¨‹åºæ˜¯æµç¨‹åºçš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå…¶ä¸­æµæ˜¯æœ‰ç•Œçš„ï¼ˆå…ƒç´ æ•°é‡æœ‰é™ï¼‰ã€‚ä¸€ä¸ª DataSet åœ¨å†…éƒ¨è¢«å½“ä½œä¸€ä¸ªæ•°æ®æµã€‚å› æ­¤ï¼Œä¸Šè¿°æ¦‚å¿µé€‚ç”¨äºæ‰¹å¤„ç†ç¨‹åºçš„æ–¹å¼ä¸é€‚ç”¨äºæµç¨‹åºçš„æ–¹å¼ç›¸åŒï¼Œä½†æœ‰ä¸€äº›å°çš„ä¾‹å¤–ã€‚\n  æ‰¹å¤„ç†ç¨‹åºçš„å®¹é”™ä¸ä½¿ç”¨æ£€æŸ¥ç‚¹ã€‚æ¢å¤æ˜¯é€šè¿‡å®Œå…¨é‡æ”¾æµå‘ç”Ÿçš„ã€‚è¿™æ˜¯å¯èƒ½çš„ï¼Œå› ä¸ºè¾“å…¥æ˜¯æœ‰ç•Œçš„ã€‚è¿™å°†æˆæœ¬æ›´å¤šåœ°æ¨å‘æ¢å¤ï¼Œä½†ä½¿å¸¸è§„å¤„ç†æ›´ä¾¿å®œï¼Œå› ä¸ºå®ƒé¿å…äº†æ£€æŸ¥ç‚¹ã€‚\n  DataSet API ä¸­çš„æœ‰çŠ¶æ€æ“ä½œä½¿ç”¨ç®€åŒ–çš„å†…å­˜å†…/æ ¸å¿ƒå¤–æ•°æ®ç»“æ„ï¼Œè€Œä¸æ˜¯é”®/å€¼ç´¢å¼•ã€‚\n  DataSet API å¼•å…¥äº†ç‰¹æ®Šçš„åŒæ­¥ï¼ˆåŸºäºsuperstepçš„ï¼‰è¿­ä»£ï¼Œåªæœ‰åœ¨æœ‰ç•Œæµä¸Šæ‰èƒ½å®ç°ã€‚è¯¦æƒ…è¯·æŸ¥çœ‹è¿­ä»£æ–‡æ¡£ã€‚\n  ","permalink":"https://ohmyweekly.github.io/notes/2020-08-20-stateful-stream-processing/","tags":["Flink","stateful"],"title":"æœ‰çŠ¶æ€çš„æµå¤„ç†"},{"categories":["programming"],"contents":"Flink Application Cluster\nFlink åº”ç”¨é›†ç¾¤æ˜¯ä¸€ä¸ªä¸“ç”¨çš„ Flink é›†ç¾¤ï¼Œå®ƒåªæ‰§è¡Œä¸€ä¸ª Flink åº”ç”¨çš„ Flink ä½œä¸šã€‚Flink é›†ç¾¤çš„å¯¿å‘½ä¸ Flink åº”ç”¨çš„å¯¿å‘½ç»‘å®šã€‚\nFlink Job Cluster\nFlink Job Cluster æ˜¯ä¸€ä¸ªä¸“ç”¨çš„ Flink Clusterï¼Œå®ƒåªæ‰§è¡Œä¸€ä¸ª Flink Jobã€‚Flink Cluster çš„å¯¿å‘½ä¸ Flink Job çš„å¯¿å‘½ç»‘å®šã€‚\nFlink Cluster\nä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿç”±ï¼ˆé€šå¸¸ï¼‰ä¸€ä¸ª JobManager å’Œä¸€ä¸ªæˆ–å¤šä¸ª Flink TaskManager è¿›ç¨‹ç»„æˆã€‚\nEvent\näº‹ä»¶æ˜¯å…³äºåº”ç”¨ç¨‹åºæ‰€æ¨¡æ‹Ÿçš„åŸŸçš„çŠ¶æ€å˜åŒ–çš„å£°æ˜ã€‚äº‹ä»¶å¯ä»¥æ˜¯æµæˆ–æ‰¹å¤„ç†åº”ç”¨ç¨‹åºçš„è¾“å…¥å’Œ/æˆ–è¾“å‡ºã€‚äº‹ä»¶æ˜¯ç‰¹æ®Šç±»å‹çš„è®°å½•ã€‚\nExecutionGraph\nå‚è§ç‰©ç†å›¾(Physical Graph)\nFunction\nå‡½æ•°ç”±ç”¨æˆ·å®ç°ï¼Œå°è£…äº† Flink ç¨‹åºçš„åº”ç”¨é€»è¾‘ã€‚å¤§å¤šæ•° Functions éƒ½ç”±ç›¸åº”çš„ Operator å°è£…ã€‚\nInstance\næœ¯è¯­ instance ç”¨äºæè¿°è¿è¡Œæ—¶ç‰¹å®šç±»å‹ï¼ˆé€šå¸¸æ˜¯ Operator æˆ– Functionï¼‰çš„å…·ä½“å®ä¾‹ã€‚ç”±äº Apache Flink å¤§éƒ¨åˆ†æ˜¯ç”¨ Java ç¼–å†™çš„ï¼Œæ‰€ä»¥å¯¹åº”äº Java ä¸­çš„ Instance æˆ– Object çš„å®šä¹‰ã€‚åœ¨ Apache Flink çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå¹¶è¡Œå®ä¾‹è¿™ä¸ªæœ¯è¯­ä¹Ÿç»å¸¸è¢«ç”¨æ¥å¼ºè°ƒåŒä¸€ä¸ª Operator æˆ– Function ç±»å‹çš„å¤šä¸ªå®ä¾‹åœ¨å¹¶è¡Œè¿è¡Œã€‚\nFlink Application\nFlink åº”ç”¨ç¨‹åºæ˜¯ä¸€ä¸ª Java åº”ç”¨ç¨‹åºï¼Œå®ƒä» main() æ–¹æ³•(æˆ–é€šè¿‡å…¶ä»–æ–¹å¼)æäº¤ä¸€ä¸ªæˆ–å¤šä¸ª Flink ä½œä¸šã€‚æäº¤ä½œä¸šé€šå¸¸æ˜¯é€šè¿‡è°ƒç”¨æ‰§è¡Œç¯å¢ƒä¸Šçš„ execute() æ¥å®Œæˆçš„ã€‚\nåº”ç”¨ç¨‹åºçš„ä½œä¸šå¯ä»¥æäº¤åˆ°ä¸€ä¸ªé•¿æœŸè¿è¡Œçš„ Flink ä¼šè¯é›†ç¾¤ï¼Œä¹Ÿå¯ä»¥æäº¤åˆ°ä¸€ä¸ªä¸“é—¨çš„ Flink åº”ç”¨é›†ç¾¤ï¼Œæˆ–è€…æäº¤åˆ°ä¸€ä¸ª Flink ä½œä¸šé›†ç¾¤ã€‚\nFlink Job\nFlink Job æ˜¯æŒ‡åœ¨ Flink åº”ç”¨ä¸­é€šè¿‡è°ƒç”¨ execute() æ¥åˆ›å»ºå’Œæäº¤çš„é€»è¾‘å›¾ï¼ˆä¹Ÿå¸¸ç§°ä¸ºæ•°æ®æµå›¾ï¼‰çš„è¿è¡Œæ—¶è¡¨ç¤ºã€‚\nJobGraph\nå‚è§é€»è¾‘å›¾(Logical Graph)\nFlink JobManager\nJobManager æ˜¯ Flink é›†ç¾¤çš„åè°ƒå™¨ã€‚å®ƒåŒ…å«äº†ä¸‰ä¸ªä¸åŒçš„ç»„ä»¶ï¼šFlink èµ„æºç®¡ç†å™¨ã€Flink è°ƒåº¦å™¨å’Œæ¯ä¸ªè¿è¡Œçš„ Flink ä½œä¸š ä¸€ä¸ª Flink JobMasterã€‚\nFlink JobMaster\nJobMasters æ˜¯è¿è¡Œåœ¨ JobManager ä¸­çš„ç»„ä»¶ä¹‹ä¸€ã€‚ä¸€ä¸ª JobMaster è´Ÿè´£ç›‘ç£å•ä¸ªä½œä¸šçš„ Tasks çš„æ‰§è¡Œæƒ…å†µã€‚\nLogical Graph\né€»è¾‘å›¾æ˜¯ä¸€ä¸ªæœ‰å‘å›¾ï¼Œå…¶ä¸­èŠ‚ç‚¹æ˜¯ Operatorsï¼Œè¾¹ç¼˜å®šä¹‰äº† operator çš„è¾“å…¥/è¾“å‡ºå…³ç³»ï¼Œå¹¶å¯¹åº”æ•°æ®æµæˆ–æ•°æ®é›†ã€‚é€»è¾‘å›¾æ˜¯é€šè¿‡ä» Flink åº”ç”¨ç¨‹åºæäº¤ä½œä¸šæ¥åˆ›å»ºçš„ã€‚\né€»è¾‘å›¾ä¹Ÿå¸¸è¢«ç§°ä¸ºæ•°æ®æµå›¾ã€‚\nManaged State\nManaged State æè¿°çš„æ˜¯å·²ç»åœ¨æ¡†æ¶ä¸­æ³¨å†Œçš„åº”ç”¨çŠ¶æ€ã€‚å¯¹äºæ‰˜ç®¡çŠ¶æ€ï¼ŒApache Flink å°†è´Ÿè´£å¤„ç†æŒä¹…æ€§å’Œé‡æ–°ç¼©æ”¾ç­‰é—®é¢˜ã€‚\nOperator\né€»è¾‘å›¾çš„èŠ‚ç‚¹ã€‚Operator æ‰§è¡ŒæŸç§æ“ä½œï¼Œé€šå¸¸ç”± Function æ‰§è¡Œã€‚æºå’Œæ¥æ”¶å™¨æ˜¯æ•°æ®æ‘„å…¥å’Œæ•°æ®è¾“å‡ºçš„ç‰¹æ®Š Operatorã€‚\nOperator Chain\nä¸€ä¸ª Operator é“¾ç”±ä¸¤ä¸ªæˆ–å¤šä¸ªè¿ç»­çš„ Operator ç»„æˆï¼Œä¸­é—´æ²¡æœ‰ä»»ä½•é‡æ–°åˆ†åŒºã€‚åŒä¸€ Operator é“¾å†…çš„ operattor ç›´æ¥ç›¸äº’è½¬å‘è®°å½•ï¼Œè€Œä¸éœ€è¦ç»è¿‡åºåˆ—åŒ–æˆ– Flink çš„ç½‘ç»œæ ˆã€‚\nPartition\nåˆ†åŒºæ˜¯æ•´ä¸ªæ•°æ®æµæˆ–æ•°æ®é›†çš„ä¸€ä¸ªç‹¬ç«‹å­é›†ã€‚é€šè¿‡å°†æ¯æ¡è®°å½•åˆ†é…åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªåˆ†åŒºï¼Œå°†æ•°æ®æµæˆ–æ•°æ®é›†åˆ’åˆ†ä¸ºå¤šä¸ªåˆ†åŒºã€‚æ•°æ®æµæˆ–æ•°æ®é›†çš„åˆ†åŒºåœ¨è¿è¡Œæ—¶ç”±Tasksæ¶ˆè€—ã€‚æ”¹å˜æ•°æ®æµæˆ–æ•°æ®é›†åˆ†åŒºæ–¹å¼çš„è½¬æ¢é€šå¸¸ç§°ä¸ºé‡æ–°åˆ†åŒºã€‚\nPhysical Graph\nç‰©ç†å›¾æ˜¯ç¿»è¯‘é€»è¾‘å›¾çš„ç»“æœï¼Œä»¥ä¾¿åœ¨åˆ†å¸ƒå¼è¿è¡Œæ—¶æ‰§è¡Œã€‚èŠ‚ç‚¹æ˜¯Tasksï¼Œè¾¹ç¼˜è¡¨ç¤ºè¾“å…¥/è¾“å‡ºå…³ç³»æˆ–æ•°æ®æµæˆ–æ•°æ®é›†çš„åˆ†åŒºã€‚\nRecord\nè®°å½•æ˜¯æ•°æ®é›†æˆ–æ•°æ®æµçš„ç»„æˆå…ƒç´ ã€‚Operator å’Œ Functions æ¥æ”¶è®°å½•ä½œä¸ºè¾“å…¥ï¼Œå¹¶å‘å‡ºè®°å½•ä½œä¸ºè¾“å‡ºã€‚\nFlink Session Cluster\nä¸€ä¸ªé•¿æœŸè¿è¡Œçš„ Flink Clusterï¼Œå®ƒæ¥å—å¤šä¸ª Flink Job çš„æ‰§è¡Œã€‚è¯¥ Flink Cluster çš„å¯¿å‘½ä¸å—ä»»ä½• Flink Job å¯¿å‘½çš„çº¦æŸã€‚ä»¥å‰ï¼ŒFlink Session Cluster ä¹Ÿè¢«ç§°ä¸ºä¼šè¯æ¨¡å¼ä¸‹çš„ Flink Clusterã€‚ä¸ Flink Application Cluster æ¯”è¾ƒã€‚\nState Backend\nå¯¹äºæµå¤„ç†ç¨‹åºæ¥è¯´ï¼ŒFlink Job çš„çŠ¶æ€åç«¯å†³å®šäº†å®ƒçš„çŠ¶æ€å¦‚ä½•å­˜å‚¨åœ¨æ¯ä¸ª TaskManager ä¸Šï¼ˆTaskManager çš„ Java å †æˆ–ï¼ˆåµŒå…¥å¼ï¼‰RocksDBï¼‰ï¼Œä»¥åŠå®ƒåœ¨æ£€æŸ¥ç‚¹æ—¶çš„å†™å…¥ä½ç½®ï¼ˆJobManager çš„ Java å †æˆ– Filesystemï¼‰ã€‚\nSub-Task\nå­ä»»åŠ¡( Sub-Task)æ˜¯æŒ‡è´Ÿè´£å¤„ç†æ•°æ®æµçš„ä¸€ä¸ªåˆ†åŒºçš„ä»»åŠ¡(Task)ã€‚æœ¯è¯­\u0026quot;å­ä»»åŠ¡\u0026quot;å¼ºè°ƒåŒä¸€ Operator æˆ– Operator é“¾æœ‰å¤šä¸ªå¹¶è¡Œçš„ Taskã€‚\nTask\nç‰©ç†å›¾çš„èŠ‚ç‚¹ã€‚Task æ˜¯å·¥ä½œçš„åŸºæœ¬å•ä½ï¼Œç”± Flink çš„è¿è¡Œæ—¶æ‰§è¡Œã€‚ä»»åŠ¡æ­£å¥½å°è£…äº†ä¸€ä¸ª Operator æˆ– Operator é“¾ çš„ä¸€ä¸ªå¹¶è¡Œå®ä¾‹ã€‚\nFlink TaskManager\nTaskManager æ˜¯ Flink Cluster çš„å·¥ä½œè¿›ç¨‹ã€‚Tasks è¢«å®‰æ’ç»™ TaskManagers æ‰§è¡Œã€‚å®ƒä»¬ç›¸äº’é€šä¿¡ï¼Œåœ¨åç»­çš„ Task ä¹‹é—´äº¤æ¢æ•°æ®ã€‚\nTransformation\nå˜æ¢åº”ç”¨äºä¸€ä¸ªæˆ–å¤šä¸ªæ•°æ®æµæˆ–æ•°æ®é›†ï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªæˆ–å¤šä¸ªè¾“å‡ºæ•°æ®æµæˆ–æ•°æ®é›†ã€‚å˜æ¢å¯èƒ½ä¼šåœ¨æ¯æ¡è®°å½•çš„åŸºç¡€ä¸Šæ”¹å˜æ•°æ®æµæˆ–æ•°æ®é›†ï¼Œä½†ä¹Ÿå¯èƒ½åªæ”¹å˜å…¶åˆ†åŒºæˆ–æ‰§è¡Œèšåˆã€‚Operator æˆ– Functionsæ˜¯ Flink çš„ API çš„ \u0026ldquo;ç‰©ç†\u0026quot;éƒ¨åˆ†ï¼Œè€Œå˜æ¢åªæ˜¯ä¸€ä¸ª API æ¦‚å¿µã€‚å…·ä½“æ¥è¯´ï¼Œå¤§å¤šæ•°å˜æ¢æ˜¯ç”±æŸäº› Operator å®ç°çš„ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-20-glossary/","tags":["Flink","architecture"],"title":"æœ¯è¯­è¡¨"},{"categories":["programming"],"contents":"æ¦‚å¿µ å®è·µåŸ¹è®­è§£é‡Šäº†ä½œä¸º Flink çš„ API åŸºç¡€çš„æœ‰çŠ¶æ€å’ŒåŠæ—¶æµå¤„ç†çš„åŸºæœ¬æ¦‚å¿µï¼Œå¹¶æä¾›äº†è¿™äº›æœºåˆ¶å¦‚ä½•åœ¨åº”ç”¨ä¸­ä½¿ç”¨çš„ä¾‹å­ã€‚æœ‰çŠ¶æ€çš„æµå¤„ç†æ˜¯åœ¨æ•°æ®ç®¡é“å’ŒETLçš„èƒŒæ™¯ä¸‹ä»‹ç»çš„ï¼Œå¹¶åœ¨å®¹é”™éƒ¨åˆ†è¿›ä¸€æ­¥å‘å±•ã€‚åœ¨\u0026ldquo;æµåˆ†æ\u0026rdquo;ä¸€èŠ‚ä¸­ä»‹ç»äº†åŠæ—¶çš„æµå¤„ç†ã€‚\næœ¬æ¦‚å¿µæ·±åº¦éƒ¨åˆ†æä¾›äº†å¯¹ Flink çš„æ¶æ„å’Œè¿è¡Œæ—¶å¦‚ä½•å®ç°è¿™äº›æ¦‚å¿µçš„æ›´æ·±å…¥çš„ç†è§£ã€‚\nFlink çš„ API Flink ä¸ºå¼€å‘æµå¼/æ‰¹é‡åº”ç”¨æä¾›äº†ä¸åŒå±‚æ¬¡çš„æŠ½è±¡ã€‚\n  æœ€åº•å±‚çš„æŠ½è±¡åªæ˜¯æä¾›æœ‰çŠ¶æ€å’ŒåŠæ—¶çš„æµå¤„ç†ã€‚å®ƒé€šè¿‡ Process Function åµŒå…¥åˆ° DataStream API ä¸­ã€‚å®ƒå…è®¸ç”¨æˆ·è‡ªç”±å¤„ç†æ¥è‡ªä¸€ä¸ªæˆ–å¤šä¸ªæµçš„äº‹ä»¶ï¼Œå¹¶æä¾›ä¸€è‡´çš„ã€å®¹é”™çš„çŠ¶æ€ã€‚æ­¤å¤–ï¼Œç”¨æˆ·è¿˜å¯ä»¥æ³¨å†Œäº‹ä»¶æ—¶é—´å’Œå¤„ç†æ—¶é—´çš„å›è°ƒï¼Œä½¿ç¨‹åºå¯ä»¥å®ç°å¤æ‚çš„è®¡ç®—ã€‚\n  åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¾ˆå¤šåº”ç”¨ç¨‹åºå¹¶ä¸éœ€è¦ä¸Šè¿°çš„ä½çº§æŠ½è±¡ï¼Œè€Œæ˜¯å¯ä»¥é’ˆå¯¹ Core APIs è¿›è¡Œç¼–ç¨‹ï¼šDataStream APIï¼ˆæœ‰ç•Œ/æ— ç•Œæµï¼‰å’Œ DataSet APIï¼ˆæœ‰ç•Œæ•°æ®é›†ï¼‰ã€‚è¿™äº›æµç•…çš„ API ä¸ºæ•°æ®å¤„ç†æä¾›äº†å¸¸è§çš„æ„ä»¶ï¼Œæ¯”å¦‚å„ç§å½¢å¼çš„ç”¨æˆ·æŒ‡å®šçš„è½¬æ¢ã€è¿æ¥ã€èšåˆã€çª—å£ã€çŠ¶æ€ç­‰ã€‚åœ¨è¿™äº› API ä¸­å¤„ç†çš„æ•°æ®ç±»å‹åœ¨å„è‡ªçš„ç¼–ç¨‹è¯­è¨€ä¸­è¢«è¡¨ç¤ºä¸ºç±»ã€‚\n  ä½çº§ Process Function ä¸ DataStream API ç›¸é›†æˆï¼Œå› æ­¤å¯ä»¥æ ¹æ®éœ€è¦ä½¿ç”¨ä½çº§æŠ½è±¡ã€‚DataSet API æä¾›äº†å…³äºæœ‰ç•Œæ•°æ®é›†çš„é™„åŠ åŸè¯­ï¼Œå¦‚å¾ªç¯/è¿­ä»£ã€‚\n Table API æ˜¯ä»¥è¡¨ä¸ºä¸­å¿ƒçš„å£°æ˜å¼ DSLï¼Œå®ƒå¯èƒ½æ˜¯åŠ¨æ€å˜åŒ–çš„è¡¨ï¼ˆå½“è¡¨ç¤ºæµæ—¶ï¼‰ã€‚Table API éµå¾ªï¼ˆæ‰©å±•çš„ï¼‰å…³ç³»æ¨¡å‹ã€‚è¡¨æœ‰ä¸€ä¸ªé™„åŠ çš„æ¨¡å¼ï¼ˆç±»ä¼¼äºå…³ç³»æ•°æ®åº“ä¸­çš„è¡¨ï¼‰ï¼ŒAPI æä¾›äº†å¯æ¯”è¾ƒçš„æ“ä½œï¼Œå¦‚selectã€projectã€joinã€group-byã€aggregation ç­‰ã€‚Table API ç¨‹åºå£°æ˜å¼åœ°å®šä¹‰äº†åº”è¯¥åšä»€ä¹ˆé€»è¾‘æ“ä½œï¼Œè€Œä¸æ˜¯å…·ä½“è§„å®šæ“ä½œçš„ä»£ç æ˜¯æ€æ ·çš„ã€‚è™½ç„¶ Table API å¯ä»¥é€šè¿‡å„ç§ç±»å‹çš„ç”¨æˆ·å®šä¹‰å‡½æ•°è¿›è¡Œæ‰©å±•ï¼Œä½†å®ƒçš„è¡¨ç°åŠ›ä¸å¦‚ Core APIï¼Œä½¿ç”¨èµ·æ¥æ›´ç®€æ´ï¼ˆå†™çš„ä»£ç æ›´å°‘ï¼‰ã€‚æ­¤å¤–ï¼ŒTable API ç¨‹åºåœ¨æ‰§è¡Œå‰è¿˜è¦ç»è¿‡ä¸€ä¸ªä¼˜åŒ–å™¨ï¼Œåº”ç”¨ä¼˜åŒ–è§„åˆ™ã€‚  äººä»¬å¯ä»¥åœ¨è¡¨å’Œ DataStream/DataSet ä¹‹é—´æ— ç¼è½¬æ¢ï¼Œå…è®¸ç¨‹åºå°† Table API ä¸ DataStream å’Œ DataSet API æ··åˆä½¿ç”¨ã€‚\n Flink æä¾›çš„æœ€é«˜çº§æŠ½è±¡æ˜¯ SQLã€‚è¿™ä¸ªæŠ½è±¡åœ¨è¯­ä¹‰å’Œè¡¨ç°å½¢å¼ä¸Šéƒ½ä¸ Table API ç›¸ä¼¼ï¼Œä½†å°†ç¨‹åºè¡¨ç¤ºä¸º SQL æŸ¥è¯¢è¡¨è¾¾å¼ã€‚SQL æŠ½è±¡ä¸ Table API ç´§å¯†äº¤äº’ï¼ŒSQL æŸ¥è¯¢å¯ä»¥åœ¨ Table API ä¸­å®šä¹‰çš„è¡¨ä¸Šæ‰§è¡Œã€‚  ","permalink":"https://ohmyweekly.github.io/notes/2020-08-20-concepts-overview/","tags":["Flink","æ¦‚å¿µ"],"title":"æ¦‚å¿µ"},{"categories":["programming"],"contents":"æœ¬æ¬¡åŸ¹è®­çš„é‡ç‚¹æ˜¯å¹¿æ³›åœ°ä»‹ç» DataStream APIï¼Œä½¿ä½ èƒ½å¤Ÿå¼€å§‹ç¼–å†™æµå¼åº”ç”¨ç¨‹åºã€‚\nä»€ä¹ˆå¯ä»¥è¢«æµå¼åŒ–ï¼Ÿ Flink çš„ DataStream API(Java å’Œ Scala)å¯ä»¥è®©ä½ æµåŒ–ä»»ä½•å¯ä»¥åºåˆ—åŒ–çš„ä¸œè¥¿ã€‚Flink è‡ªå·±çš„åºåˆ—åŒ–å™¨ç”¨äº:\n åŸºæœ¬ç±»å‹ï¼Œå³ String, Long, Integer, Boolean, Array å¤åˆç±»å‹ã€‚Tuples, POJOs å’Œ Scala case classes  è€Œ Flink åˆå›åˆ°äº† Kryo çš„å…¶ä»–ç±»å‹ã€‚ä¹Ÿå¯ä»¥åœ¨ Flink ä¸­ä½¿ç”¨å…¶ä»–åºåˆ—åŒ–å™¨ã€‚ç‰¹åˆ«æ˜¯ Avroï¼Œå¾—åˆ°äº†å¾ˆå¥½çš„æ”¯æŒã€‚\nJava å…ƒç»„ å’Œ POJO Flink çš„æœ¬åœ°åºåˆ—åŒ–å™¨å¯ä»¥æœ‰æ•ˆåœ°æ“ä½œå…ƒç»„å’Œ POJOã€‚\nå…ƒç»„\nå¯¹äº Javaï¼ŒFlink å®šä¹‰äº†è‡ªå·±çš„ Tuple0 åˆ° Tuple25 ç±»å‹ã€‚\nTuple2\u0026lt;String, Integer\u0026gt; person = Tuple2.of(\u0026#34;Fred\u0026#34;, 35); // zero based index! String name = person.f0; Integer age = person.f1; POJO\nå¦‚æœæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼ŒFlink å°†æ•°æ®ç±»å‹è¯†åˆ«ä¸º POJO ç±»å‹ï¼ˆå¹¶å…è®¸\u0026quot;æŒ‰åç§°\u0026quot;å­—æ®µå¼•ç”¨ï¼‰ã€‚\n ç±»æ˜¯å…¬å…±çš„å’Œç‹¬ç«‹çš„ï¼ˆæ²¡æœ‰éé™æ€çš„å†…éƒ¨ç±»ï¼‰ã€‚ è¯¥ç±»æœ‰ä¸€ä¸ªå…¬å…±çš„æ— å‚æ•°æ„é€ å‡½æ•°ã€‚ ç±»ï¼ˆä»¥åŠæ‰€æœ‰è¶…çº§ç±»ï¼‰ä¸­çš„æ‰€æœ‰éé™æ€ã€éç¬æ€å­—æ®µè¦ä¹ˆæ˜¯å…¬å…±çš„ï¼ˆè€Œä¸”æ˜¯éæœ€ç»ˆçš„ï¼‰ï¼Œè¦ä¹ˆæœ‰å…¬å…±çš„ getter- å’Œ setter- æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•éµå¾ª Java beans ä¸­ getter å’Œ setter çš„å‘½åçº¦å®šã€‚  ä¾‹å¦‚:\npublic class Person { public String name; public Integer age; public Person() {}; public Person(String name, Integer age) { . . . }; } Person person = new Person(\u0026#34;Fred Flintstone\u0026#34;, 35); Flink çš„åºåˆ—åŒ–å™¨æ”¯æŒ POJO ç±»å‹çš„æ¨¡å¼è¿›åŒ–ã€‚\nScala å…ƒç»„å’Œ case class è¿™äº›å·¥ä½œå°±åƒä½ æœŸæœ›çš„é‚£æ ·ã€‚\nä¸€ä¸ªå®Œæ•´çš„ä¾‹å­ è¿™ä¸ªä¾‹å­å°†ä¸€ä¸ªå…³äºäººçš„è®°å½•æµä½œä¸ºè¾“å…¥ï¼Œå¹¶å°†å…¶è¿‡æ»¤ä¸ºåªåŒ…æ‹¬æˆå¹´äººã€‚\nimport org.apache.flink.streaming.api.environment.StreamExecutionEnvironment; import org.apache.flink.streaming.api.datastream.DataStream; import org.apache.flink.api.common.functions.FilterFunction; public class Example { public static void main(String[] args) throws Exception { final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); DataStream\u0026lt;Person\u0026gt; flintstones = env.fromElements( new Person(\u0026#34;Fred\u0026#34;, 35), new Person(\u0026#34;Wilma\u0026#34;, 35), new Person(\u0026#34;Pebbles\u0026#34;, 2)); DataStream\u0026lt;Person\u0026gt; adults = flintstones.filter(new FilterFunction\u0026lt;Person\u0026gt;() { @Override public boolean filter(Person person) throws Exception { return person.age \u0026gt;= 18; } }); adults.print(); env.execute(); } public static class Person { public String name; public Integer age; public Person() {}; public Person(String name, Integer age) { this.name = name; this.age = age; }; public String toString() { return this.name.toString() + \u0026#34;: age \u0026#34; + this.age.toString(); }; } } æµæ‰§è¡Œç¯å¢ƒ æ¯ä¸ª Flink åº”ç”¨éƒ½éœ€è¦ä¸€ä¸ªæ‰§è¡Œç¯å¢ƒï¼Œæœ¬ä¾‹ä¸­çš„ envã€‚æµå¼åº”ç”¨éœ€è¦ä½¿ç”¨ä¸€ä¸ª StreamExecutionEnvironmentã€‚\nåœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­è¿›è¡Œçš„ DataStream API è°ƒç”¨å»ºç«‹äº†ä¸€ä¸ªä½œä¸šå›¾(job graph)ï¼Œè¿™ä¸ªä½œä¸šå›¾è¢«é™„åŠ åˆ° StreamExecutionEnvironment ä¸Šã€‚å½“è°ƒç”¨ env.execute() æ—¶ï¼Œè¿™ä¸ªå›¾ä¼šè¢«æ‰“åŒ…å¹¶å‘é€ç»™ JobManagerï¼ŒJobManager å°†ä½œä¸šå¹¶è¡ŒåŒ–ï¼Œå¹¶å°†å®ƒçš„ç‰‡æ–­åˆ†é…ç»™ Task Manager æ‰§è¡Œã€‚ä½ çš„ä½œä¸šçš„æ¯ä¸ªå¹¶è¡Œç‰‡æ–­å°†åœ¨ä¸€ä¸ªä»»åŠ¡æ§½(task slot)ä¸­æ‰§è¡Œã€‚\næ³¨æ„ï¼Œå¦‚æœä½ ä¸è°ƒç”¨ execute()ï¼Œä½ çš„åº”ç”¨ç¨‹åºå°†ä¸ä¼šè¢«è¿è¡Œã€‚\nè¿™ç§åˆ†å¸ƒå¼è¿è¡Œæ—¶å–å†³äºä½ çš„åº”ç”¨ç¨‹åºæ˜¯å¯åºåˆ—åŒ–çš„ã€‚å®ƒè¿˜è¦æ±‚æ‰€æœ‰çš„ä¾èµ–å…³ç³»éƒ½èƒ½åœ¨é›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šä½¿ç”¨ã€‚\nåŸºæœ¬çš„æµæº ä¸Šé¢çš„ä¾‹å­ä½¿ç”¨ env.fromElements(...) æ„é€ äº†ä¸€ä¸ª DataStream[Person]ã€‚è¿™æ˜¯ä¸€ç§æ–¹ä¾¿çš„æ–¹æ³•ï¼Œå¯ä»¥å°†ä¸€ä¸ªç®€å•çš„æµç»„åˆèµ·æ¥ï¼Œç”¨äºåŸå‹æˆ–æµ‹è¯•ã€‚StreamExecutionEnvironment ä¸Šè¿˜æœ‰ä¸€ä¸ª fromCollection(Collection) æ–¹æ³•ã€‚æ‰€ä»¥ï¼Œä½ å¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•æ¥ä»£æ›¿ã€‚\nval people: List[Person] = new ArrayList\u0026lt;Person\u0026gt;(); people.add(new Person(\u0026#34;Fred\u0026#34;, 35)); people.add(new Person(\u0026#34;Wilma\u0026#34;, 35)); people.add(new Person(\u0026#34;Pebbles\u0026#34;, 2)); val flintstones: DataStream[Person] = env.fromCollection(people); å¦ä¸€ç§æ–¹ä¾¿çš„æ–¹æ³•æ˜¯åœ¨åŸå‹å¼€å‘æ—¶å°†ä¸€äº›æ•°æ®å¯¼å…¥æµä¸­ï¼Œä½¿ç”¨ socket:\nval lines: DataStream[String] = env.socketTextStream(\u0026#34;localhost\u0026#34;, 9999) æˆ–ä»æ–‡ä»¶ä¸­è¯»å–:\nval lines: DataStream[String] = env.readTextFile(\u0026#34;file:///path\u0026#34;); åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæœ€å¸¸ç”¨çš„æ•°æ®æºæ˜¯é‚£äº›æ”¯æŒä½å»¶è¿Ÿã€é«˜ååé‡å¹¶è¡Œè¯»å–å¹¶ç»“åˆå€’å¸¦å’Œé‡æ”¾çš„æ•°æ®æº\u0026ndash;è¿™æ˜¯é«˜æ€§èƒ½å’Œå®¹é”™çš„å…ˆå†³æ¡ä»¶\u0026ndash;å¦‚ Apache Kafkaã€Kinesis å’Œå„ç§æ–‡ä»¶ç³»ç»Ÿã€‚REST API å’Œæ•°æ®åº“ä¹Ÿç»å¸¸è¢«ç”¨äºæµçš„ä¸°å¯Œã€‚\nåŸºæœ¬çš„æµå¼æ¥æ”¶å™¨ ä¸Šé¢çš„ä¾‹å­ä½¿ç”¨ adults.print() å°†å…¶ç»“æœæ‰“å°åˆ° task manager çš„æ—¥å¿—ä¸­ï¼ˆå½“åœ¨ IDE ä¸­è¿è¡Œæ—¶ï¼Œå®ƒå°†å‡ºç°åœ¨ä½ çš„ IDE çš„æ§åˆ¶å°ä¸­ï¼‰ã€‚è¿™å°†åœ¨æµçš„æ¯ä¸ªå…ƒç´ ä¸Šè°ƒç”¨ toString()ã€‚\nè¾“å‡ºç»“æœçœ‹èµ·æ¥åƒè¿™æ ·ï¼š\n1\u0026gt; Fred: age 35 2\u0026gt; Wilma: age 35 å…¶ä¸­ 1\u0026gt; å’Œ 2\u0026gt; è¡¨ç¤ºå“ªä¸ªå­ä»»åŠ¡ï¼ˆå³çº¿ç¨‹ï¼‰äº§ç”Ÿçš„è¾“å‡ºã€‚\nåœ¨ç”Ÿäº§ä¸­ï¼Œå¸¸ç”¨çš„æ¥æ”¶å™¨æ‹¬ StreamingFileSinkã€å„ç§æ•°æ®åº“å’Œä¸€äº› pub-sub ç³»ç»Ÿã€‚\nè°ƒè¯• åœ¨ç”Ÿäº§ä¸­ï¼Œä½ çš„åº”ç”¨ç¨‹åºå°†åœ¨è¿œç¨‹é›†ç¾¤æˆ–ä¸€ç»„å®¹å™¨ä¸­è¿è¡Œã€‚è€Œå¦‚æœå®ƒå¤±è´¥äº†ï¼Œå®ƒå°†ä¼šè¿œç¨‹å¤±è´¥ã€‚JobManager å’Œ TaskManager æ—¥å¿—å¯¹è°ƒè¯•æ­¤ç±»æ•…éšœéå¸¸æœ‰å¸®åŠ©ï¼Œä½†åœ¨ IDE å†…éƒ¨è¿›è¡Œæœ¬åœ°è°ƒè¯•è¦å®¹æ˜“å¾—å¤šï¼ŒFlink æ”¯æŒè¿™ä¸€ç‚¹ã€‚ä½ å¯ä»¥è®¾ç½®æ–­ç‚¹ï¼Œæ£€æŸ¥æœ¬åœ°å˜é‡ï¼Œå¹¶é€æ­¥æ£€æŸ¥ä½ çš„ä»£ç ã€‚ä½ ä¹Ÿå¯ä»¥æ­¥å…¥ Flink çš„ä»£ç ï¼Œå¦‚æœä½ å¥½å¥‡ Flink æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè¿™å¯ä»¥æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ–¹å¼æ¥äº†è§£å®ƒçš„å†…éƒ¨ç»“æ„ã€‚\nå®è·µ åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œä½ çŸ¥é“äº†è¶³å¤Ÿçš„çŸ¥è¯†ï¼Œå¯ä»¥å¼€å§‹ç¼–ç å’Œè¿è¡Œä¸€ä¸ªç®€å•çš„ DataStream åº”ç”¨ç¨‹åºã€‚å…‹éš† flink-training repoï¼ŒæŒ‰ç…§ README ä¸­çš„è¯´æ˜æ“ä½œåï¼Œè¿›è¡Œç¬¬ä¸€ä¸ªç»ƒä¹ ã€‚è¿‡æ»¤ä¸€ä¸ªæµï¼ˆRide Cleansingï¼‰ã€‚\nè¿›ä¸€æ­¥é˜…è¯»  Flinkåºåˆ—åŒ–è°ƒä¼˜ç¬¬ä¸€å·ï¼šé€‰æ‹©ä½ çš„åºåˆ—åŒ–å™¨\u0026ndash;å¦‚æœä½ å¯ä»¥çš„è¯ Flink ç¨‹åºçš„è§£å‰– æ•°æ®æº æ•°æ®æ¥æ”¶å™¨ DataStream è¿æ¥å™¨  ","permalink":"https://ohmyweekly.github.io/notes/2020-08-19-intro-to-the-datastream-api/","tags":["Flink","Training"],"title":"DataStream API ä»‹ç»"},{"categories":["programming"],"contents":"Process Functions ä»‹ç» ProcessFunction å°†äº‹ä»¶å¤„ç†ä¸å®šæ—¶å™¨å’ŒçŠ¶æ€ç»“åˆèµ·æ¥ï¼Œä½¿å…¶æˆä¸ºæµå¤„ç†åº”ç”¨çš„å¼ºå¤§æ„ä»¶ã€‚è¿™æ˜¯ç”¨ Flink åˆ›å»ºäº‹ä»¶é©±åŠ¨åº”ç”¨çš„åŸºç¡€ã€‚å®ƒä¸ RichFlatMapFunction éå¸¸ç›¸ä¼¼ï¼Œä½†å¢åŠ äº†å®šæ—¶å™¨ã€‚\nå®ä¾‹ å¦‚æœä½ åšè¿‡æµåˆ†æåŸ¹è®­ä¸­çš„å®æˆ˜ç»ƒä¹ ï¼Œä½ ä¼šè®°å¾—å®ƒä½¿ç”¨ TumblingEventTimeWindow æ¥è®¡ç®—æ¯ä¸ªå¸æœºåœ¨æ¯ä¸ªå°æ—¶å†…çš„å°è´¹ä¹‹å’Œï¼Œå°±åƒè¿™æ ·:\n// compute the sum of the tips per hour for each driver DataStream\u0026lt;Tuple3\u0026lt;Long, Long, Float\u0026gt;\u0026gt; hourlyTips = fares .keyBy((TaxiFare fare) -\u0026gt; fare.driverId) .window(TumblingEventTimeWindows.of(Time.hours(1))) .process(new AddTips()); ç”¨ KeyedProcessFunction åšåŒæ ·çš„äº‹æƒ…æ˜¯ç›¸å½“ç›´æ¥çš„ï¼Œä¹Ÿæ˜¯å¾ˆæœ‰æ•™è‚²æ„ä¹‰çš„ã€‚è®©æˆ‘ä»¬å…ˆæŠŠä¸Šé¢çš„ä»£ç æ›¿æ¢æˆè¿™æ ·:\n// compute the sum of the tips per hour for each driver DataStream\u0026lt;Tuple3\u0026lt;Long, Long, Float\u0026gt;\u0026gt; hourlyTips = fares .keyBy((TaxiFare fare) -\u0026gt; fare.driverId) .process(new PseudoWindow(Time.hours(1))); åœ¨è¿™æ®µä»£ç ä¸­ï¼Œä¸€ä¸ªåä¸º PseudoWindow çš„ KeyedProcessFunction è¢«åº”ç”¨äºä¸€ä¸ª keyed æµï¼Œå…¶ç»“æœæ˜¯ä¸€ä¸ª DataStream\u0026lt;Tuple3\u0026lt;Longï¼ŒLongï¼ŒFloat\u0026gt;\u0026gt;ï¼ˆå°±æ˜¯ä½¿ç”¨ Flink å†…ç½®æ—¶é—´çª—å£çš„å®ç°æ‰€äº§ç”Ÿçš„é‚£ç§æµï¼‰ã€‚\nPseudoWindow çš„æ•´ä½“è½®å»“æ˜¯è¿™æ ·çš„å½¢çŠ¶:\n// Compute the sum of the tips for each driver in hour-long windows. // The keys are driverIds. public static class PseudoWindow extends KeyedProcessFunction\u0026lt;Long, TaxiFare, Tuple3\u0026lt;Long, Long, Float\u0026gt;\u0026gt; { private final long durationMsec; public PseudoWindow(Time duration) { this.durationMsec = duration.toMilliseconds(); } @Override // Called once during initialization.  public void open(Configuration conf) { . . . } @Override // Called as each fare arrives to be processed.  public void processElement( TaxiFare fare, Context ctx, Collector\u0026lt;Tuple3\u0026lt;Long, Long, Float\u0026gt;\u0026gt; out) throws Exception { . . . } @Override // Called when the current watermark indicates that a window is now complete.  public void onTimer(long timestamp, OnTimerContext context, Collector\u0026lt;Tuple3\u0026lt;Long, Long, Float\u0026gt;\u0026gt; out) throws Exception { . . . } } éœ€è¦æ³¨æ„çš„äº‹æƒ…ã€‚\n  ProcessFunctions æœ‰å¥½å‡ ç§ç±»å‹\u0026ndash;è¿™æ˜¯ä¸€ä¸ª KeyedProcessFunctionsï¼Œä½†è¿˜æœ‰ CoProcessFunctionsã€BroadcastProcessFunctions ç­‰ã€‚\n  KeyedProcessFunction æ˜¯ RichFunctionçš„ä¸€ç§ã€‚ä½œä¸ºä¸€ä¸ª RichFunctionï¼Œå®ƒå¯ä»¥è®¿é—®åœ¨ç®¡ç† keyed state ä¸‹å·¥ä½œæ‰€éœ€çš„ open å’Œ getRuntimeContext æ–¹æ³•ã€‚\n  æœ‰ä¸¤ä¸ªå›è°ƒè¦å®ç°ï¼šprocessElement å’Œ onTimerã€‚processElement åœ¨æ¯æ¬¡ä¼ å…¥äº‹ä»¶æ—¶è¢«è°ƒç”¨ï¼›onTimer åœ¨å®šæ—¶å™¨å‘å°„æ—¶è¢«è°ƒç”¨ã€‚è¿™äº›å®šæ—¶å™¨å¯ä»¥æ˜¯äº‹ä»¶æ—¶é—´ï¼Œä¹Ÿå¯ä»¥æ˜¯å¤„ç†æ—¶é—´å®šæ—¶å™¨ã€‚processElement å’Œ onTimer éƒ½æä¾›äº†ä¸€ä¸ªä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯ä»¥ç”¨æ¥ä¸ TimerService äº¤äº’ï¼ˆé™¤å…¶ä»–å¤–ï¼‰ã€‚ä¸¤ä¸ªå›è°ƒéƒ½è¿˜ä¼ é€’äº†ä¸€ä¸ªå¯ä»¥ç”¨æ¥å‘å‡ºç»“æœçš„ Collectorã€‚\n  open() æ–¹æ³• // Keyed, managed state, with an entry for each window, keyed by the window\u0026#39;s end time. // There is a separate MapState object for each driver. private transient MapState\u0026lt;Long, Float\u0026gt; sumOfTips; @Override public void open(Configuration conf) { MapStateDescriptor\u0026lt;Long, Float\u0026gt; sumDesc = new MapStateDescriptor\u0026lt;\u0026gt;(\u0026#34;sumOfTips\u0026#34;, Long.class, Float.class); sumOfTips = getRuntimeContext().getMapState(sumDesc); } ç”±äºç¥¨ä»·äº‹ä»¶å¯èƒ½ä¼šä¸æŒ‰é¡ºåºåˆ°è¾¾ï¼Œæ‰€ä»¥æœ‰æ—¶éœ€è¦å¤„ç†ä¸€ä¸ªå°æ—¶çš„äº‹ä»¶ï¼Œç„¶åå†å®Œæˆå‰ä¸€ä¸ªå°æ—¶çš„ç»“æœè®¡ç®—ã€‚äº‹å®ä¸Šï¼Œå¦‚æœæ°´å°å»¶è¿Ÿæ¯”çª—å£é•¿åº¦é•¿å¾—å¤šï¼Œé‚£ä¹ˆå¯èƒ½ä¼šåŒæ—¶æ‰“å¼€è®¸å¤šçª—å£ï¼Œè€Œä¸æ˜¯åªæœ‰ä¸¤ä¸ªã€‚æœ¬å®ç°é€šè¿‡ä½¿ç”¨ MapState æ¥æ”¯æŒè¿™ä¸€ç‚¹ï¼ŒMapState å°†æ¯ä¸ªçª—å£ç»“æŸçš„æ—¶é—´æˆ³æ˜ å°„åˆ°è¯¥çª—å£çš„æç¤ºä¹‹å’Œã€‚\nprocessElement() æ–¹æ³• public void processElement( TaxiFare fare, Context ctx, Collector\u0026lt;Tuple3\u0026lt;Long, Long, Float\u0026gt;\u0026gt; out) throws Exception { long eventTime = fare.getEventTime(); TimerService timerService = ctx.timerService(); if (eventTime \u0026lt;= timerService.currentWatermark()) { // This event is late; its window has already been triggered.  } else { // Round up eventTime to the end of the window containing this event.  long endOfWindow = (eventTime - (eventTime % durationMsec) + durationMsec - 1); // Schedule a callback for when the window has been completed.  timerService.registerEventTimeTimer(endOfWindow); // Add this fare\u0026#39;s tip to the running total for that window.  Float sum = sumOfTips.get(endOfWindow); if (sum == null) { sum = 0.0F; } sum += fare.tip; sumOfTips.put(endOfWindow, sum); } } è¦è€ƒè™‘çš„äº‹æƒ…:\n  è¿Ÿåˆ°çš„äº‹ä»¶ä¼šæ€æ ·ï¼Ÿåœ¨æ°´å°åé¢çš„äº‹ä»¶ï¼ˆå³è¿Ÿåˆ°ï¼‰ä¼šè¢«ä¸¢å¼ƒã€‚å¦‚æœä½ æƒ³åšä¸€äº›æ¯”è¿™æ›´å¥½çš„äº‹æƒ…ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ä¾§è¾“å‡ºï¼Œè¿™å°†åœ¨ä¸‹ä¸€èŠ‚è§£é‡Šã€‚\n  è¿™ä¸ªä¾‹å­ä½¿ç”¨äº†ä¸€ä¸ª MapStateï¼Œå…¶ä¸­é”®æ˜¯æ—¶é—´æˆ³ï¼Œå¹¶ä¸ºåŒä¸€ä¸ªæ—¶é—´æˆ³è®¾ç½®ä¸€ä¸ª Timerã€‚è¿™æ˜¯ä¸€ç§å¸¸è§çš„æ¨¡å¼ï¼›å®ƒä½¿å¾—åœ¨å®šæ—¶å™¨å‘å°„æ—¶æŸ¥æ‰¾ç›¸å…³ä¿¡æ¯å˜å¾—ç®€å•è€Œé«˜æ•ˆã€‚\n  onTimer() æ–¹æ³• public void onTimer( long timestamp, OnTimerContext context, Collector\u0026lt;Tuple3\u0026lt;Long, Long, Float\u0026gt;\u0026gt; out) throws Exception { long driverId = context.getCurrentKey(); // Look up the result for the hour that just ended.  Float sumOfTips = this.sumOfTips.get(timestamp); Tuple3\u0026lt;Long, Long, Float\u0026gt; result = Tuple3.of(driverId, timestamp, sumOfTips); out.collect(result); this.sumOfTips.remove(timestamp); } è§‚å¯Ÿ:\n  ä¼ é€’ç»™ onTimer çš„ OnTimerContext ä¸Šä¸‹æ–‡å¯ä»¥ç”¨æ¥ç¡®å®šå½“å‰çš„é”®ã€‚\n  æˆ‘ä»¬çš„ä¼ªçª—å£æ˜¯åœ¨å½“å‰æ°´å°åˆ°è¾¾æ¯ä¸ªå°æ—¶ç»“æŸæ—¶è¢«è§¦å‘çš„ï¼Œæ­¤æ—¶è°ƒç”¨ onTimerã€‚è¿™ä¸ª onTimer æ–¹æ³•ä» sumOfTips ä¸­åˆ é™¤äº†ç›¸å…³çš„æ¡ç›®ï¼Œè¿™æ ·åšçš„æ•ˆæœæ˜¯æ— æ³•å®¹çº³è¿Ÿåˆ°çš„äº‹ä»¶ã€‚è¿™ç›¸å½“äºåœ¨ä½¿ç”¨ Flink çš„æ—¶é—´çª—å£æ—¶ï¼Œå°† allowLateness è®¾ç½®ä¸ºé›¶ã€‚\n  æ€§èƒ½æ–¹é¢çš„è€ƒè™‘ Flink æä¾›äº†é’ˆå¯¹ RocksDB ä¼˜åŒ–çš„ MapState å’Œ ListState ç±»å‹ã€‚åœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥ä½¿ç”¨è¿™äº›ç±»å‹æ¥ä»£æ›¿æŒæœ‰æŸç§é›†åˆçš„ ValueState å¯¹è±¡ã€‚RocksDB çŠ¶æ€åç«¯å¯ä»¥è¿½åŠ åˆ° ListStateï¼Œè€Œä¸éœ€è¦ç»è¿‡(å»)åºåˆ—åŒ–ï¼Œå¯¹äº MapStateï¼Œæ¯ä¸ªé”®/å€¼å¯¹éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„ RocksDB å¯¹è±¡ï¼Œå› æ­¤ MapState å¯ä»¥æœ‰æ•ˆåœ°è¢«è®¿é—®å’Œæ›´æ–°ã€‚\nä¾§è¾“å‡º ä»‹ç» æœ‰å‡ ä¸ªå¾ˆå¥½çš„ç†ç”±å¯ä»¥è®© Flink operator æœ‰ä¸€ä¸ªä»¥ä¸Šçš„è¾“å‡ºæµï¼Œæ¯”å¦‚æŠ¥å‘Š:\n å¼‚å¸¸ ç•¸å½¢äº‹ä»¶ è¿Ÿåˆ°äº‹ä»¶ æ“ä½œè­¦æŠ¥ï¼Œå¦‚ä¸å¤–éƒ¨æœåŠ¡çš„è¿æ¥è¶…æ—¶ã€‚  ä¾§è¾“å‡ºæ˜¯ä¸€ç§æ–¹ä¾¿çš„æ–¹å¼ã€‚é™¤äº†é”™è¯¯æŠ¥å‘Šï¼Œä¾§è¾“å‡ºä¹Ÿæ˜¯å®ç°æµçš„å¤šè·¯åˆ†å‰²çš„å¥½æ–¹æ³•ã€‚\nä¾‹å­ ç°åœ¨ï¼Œæ‚¨å¯ä»¥å¯¹ä¸Šä¸€èŠ‚ä¸­è¢«å¿½ç•¥çš„è¿Ÿåˆ°äº‹ä»¶åšäº›ä»€ä¹ˆäº†ã€‚\nä¸€ä¸ªä¾§è¾“å‡ºé€šé“ä¸ä¸€ä¸ª OutputTag\u0026lt;T\u0026gt; ç›¸å…³è”ã€‚è¿™äº›æ ‡ç­¾å…·æœ‰ä¸ä¾§è¾“å‡ºçš„ DataStream çš„ç±»å‹ç›¸å¯¹åº”çš„é€šç”¨ç±»å‹ï¼Œå®ƒä»¬æœ‰åç§°ã€‚\nprivate static final OutputTag\u0026lt;TaxiFare\u0026gt; lateFares = new OutputTag\u0026lt;TaxiFare\u0026gt;(\u0026#34;lateFares\u0026#34;) {}; ä¸Šé¢å±•ç¤ºçš„æ˜¯ä¸€ä¸ªé™æ€çš„ OutputTag\u0026lt;TaxiFare\u0026gt;ï¼Œå®ƒæ—¢å¯ä»¥åœ¨ PseudoWindow çš„ processElement æ–¹æ³•ä¸­å‘å‡ºè¿Ÿåˆ°äº‹ä»¶æ—¶è¢«å¼•ç”¨ã€‚\nif (eventTime \u0026lt;= timerService.currentWatermark()) { // This event is late; its window has already been triggered.  ctx.output(lateFares, fare); } else { . . . } å¹¶åœ¨è®¿é—®è¿™ä¸€ä¾§è¾“å‡ºçš„æµæ—¶ï¼Œåœ¨ä½œä¸šçš„ main æ–¹æ³•ä¸­è¾“å‡º:\n// compute the sum of the tips per hour for each driver SingleOutputStreamOperator hourlyTips = fares .keyBy((TaxiFare fare) -\u0026gt; fare.driverId) .process(new PseudoWindow(Time.hours(1))); hourlyTips.getSideOutput(lateFares).print(); æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªå…·æœ‰ç›¸åŒåç§°çš„ OutputTags æ¥å¼•ç”¨åŒä¸€ä¾§é¢è¾“å‡ºï¼Œä½†å¦‚æœæ‚¨è¿™æ ·åšï¼Œå®ƒä»¬å¿…é¡»å…·æœ‰ç›¸åŒçš„ç±»å‹ã€‚\nç»“æŸè¯­ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ å·²ç»çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨ ProcessFunction æ¥é‡æ–°å®ç°ä¸€ä¸ªç›´æ¥çš„æ—¶é—´çª—å£ã€‚å½“ç„¶ï¼Œå¦‚æœ Flink å†…ç½®çš„çª—å£ API æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œæ— è®ºå¦‚ä½•ï¼Œè¯·ç»§ç»­ä½¿ç”¨å®ƒã€‚ä½†å¦‚æœä½ å‘ç°è‡ªå·±åœ¨è€ƒè™‘ç”¨ Flink çš„çª—å£åšä¸€äº›å˜å½¢ï¼Œä¸è¦å®³æ€•æ¨å‡ºè‡ªå·±çš„çª—å£ã€‚\næ­¤å¤–ï¼ŒProcessFunction å¯¹äºè®¡ç®—åˆ†æä¹‹å¤–çš„è®¸å¤šå…¶ä»–ç”¨ä¾‹ä¹Ÿå¾ˆæœ‰ç”¨ã€‚ä¸‹é¢çš„å®è·µç»ƒä¹ æä¾›äº†ä¸€ä¸ªå®Œå…¨ä¸åŒçš„ä¾‹å­ã€‚\nProcessFunction çš„å¦ä¸€ä¸ªå¸¸è§ç”¨ä¾‹æ˜¯ç”¨äºè¿‡æœŸçš„é™ˆæ—§çŠ¶æ€ã€‚å¦‚æœä½ å›æƒ³ä¸€ä¸‹ Rides å’Œ Fares ç»ƒä¹ ï¼Œå…¶ä¸­ä½¿ç”¨ RichCoFlatMapFunction æ¥è®¡ç®—ä¸€ä¸ªç®€å•çš„è¿æ¥ï¼Œç¤ºä¾‹è§£å†³æ–¹æ¡ˆå‡è®¾ TaxiRides å’Œ TaxiFares æ˜¯å®Œç¾åŒ¹é…çš„ï¼Œæ¯ä¸ª rideId æ˜¯ä¸€å¯¹ä¸€çš„ã€‚å¦‚æœä¸€ä¸ªäº‹ä»¶ä¸¢å¤±äº†ï¼ŒåŒä¸€ä¹˜è½¦ ID çš„å…¶ä»–äº‹ä»¶å°†æ°¸è¿œä¿æŒåœ¨çŠ¶æ€ã€‚è¿™å¯ä»¥æ›¿æ¢ä¸ºä¸€ä¸ª KeyedCoProcessFunction æ¥å®ç°ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå®šæ—¶å™¨æ¥æ£€æµ‹å’Œæ¸…é™¤ä»»ä½•é™ˆæ—§çš„çŠ¶æ€ã€‚\nå®è·µ ä¸æœ¬èŠ‚é…å¥—çš„å®æˆ˜ç»ƒä¹ æ˜¯ Long Ride Alerts ç»ƒä¹ ã€‚\nè¿›ä¸€æ­¥é˜…è¯»  ProcessFunction ä¾§è¾“å‡º  ","permalink":"https://ohmyweekly.github.io/notes/2020-08-19-event-driven-applications/","tags":["Flink","Training"],"title":"äº‹ä»¶é©±åŠ¨å‹åº”ç”¨ç¨‹åº"},{"categories":["programming"],"contents":"æœ¬æ¬¡åŸ¹è®­çš„ç›®æ ‡å’ŒèŒƒå›´ æœ¬åŸ¹è®­ä»‹ç»äº† Apache Flinkï¼ŒåŒ…æ‹¬è¶³å¤Ÿçš„å†…å®¹è®©ä½ å¼€å§‹ç¼–å†™å¯æ‰©å±•çš„æµå¼ ETLï¼Œåˆ†æå’Œäº‹ä»¶é©±åŠ¨çš„åº”ç”¨ç¨‹åºï¼ŒåŒæ—¶çœç•¥äº†å¾ˆå¤šï¼ˆæœ€ç»ˆé‡è¦çš„ï¼‰ç»†èŠ‚ã€‚æœ¬ä¹¦çš„é‡ç‚¹æ˜¯ä¸º Flink ç®¡ç†çŠ¶æ€å’Œæ—¶é—´çš„ API æä¾›ç›´æ¥çš„ä»‹ç»ï¼Œå¸Œæœ›åœ¨æŒæ¡äº†è¿™äº›åŸºç¡€çŸ¥è¯†åï¼Œä½ èƒ½æ›´å¥½åœ°ä»æ›´è¯¦ç»†çš„å‚è€ƒæ–‡æ¡£ä¸­è·å–å…¶ä½™éœ€è¦äº†è§£çš„å†…å®¹ã€‚æ¯ä¸€èŠ‚æœ«å°¾çš„é“¾æ¥å°†å¼•å¯¼ä½ åˆ°å¯ä»¥å­¦ä¹ æ›´å¤šçŸ¥è¯†çš„åœ°æ–¹ã€‚\nå…·ä½“æ¥è¯´ï¼Œæ‚¨å°†å­¦ä¹ :\n å¦‚ä½•å®ç°æµæ•°æ®å¤„ç†ç®¡é“ Flink å¦‚ä½•ä»¥åŠä¸ºä½•ç®¡ç†çŠ¶æ€ å¦‚ä½•ä½¿ç”¨äº‹ä»¶æ—¶é—´æ¥æŒç»­è®¡ç®—å‡†ç¡®çš„åˆ†æç»“æœï¼Ÿ å¦‚ä½•åœ¨è¿ç»­æµä¸Šæ„å»ºäº‹ä»¶é©±åŠ¨çš„åº”ç”¨ç¨‹åºï¼Ÿ Flink æ˜¯å¦‚ä½•æä¾›å…·æœ‰ç²¾ç¡®åªè¯»è¯­ä¹‰çš„å®¹é”™ã€æœ‰çŠ¶æ€çš„æµå¤„ç†çš„ï¼Ÿ  æœ¬åŸ¹è®­ä¸»è¦ä»‹ç»å››ä¸ªå…³é”®æ¦‚å¿µï¼šæµæ•°æ®çš„è¿ç»­å¤„ç†ã€äº‹ä»¶æ—¶é—´ã€æœ‰çŠ¶æ€çš„æµå¤„ç†å’ŒçŠ¶æ€å¿«ç…§ã€‚æœ¬é¡µä»‹ç»äº†è¿™äº›æ¦‚å¿µã€‚\næ³¨: ä¼´éšæœ¬åŸ¹è®­çš„æ˜¯ä¸€å¥—å®è·µç»ƒä¹ ï¼Œå®ƒå°†æŒ‡å¯¼æ‚¨å­¦ä¹ å¦‚ä½•ä½¿ç”¨æ‰€ä»‹ç»çš„æ¦‚å¿µã€‚æ¯ä¸€èŠ‚çš„æœ€åéƒ½æä¾›äº†ç›¸å…³ç»ƒä¹ çš„é“¾æ¥ã€‚\næµå¤„ç† æµæ˜¯æ•°æ®çš„å¤©ç„¶æ –æ¯åœ°ã€‚æ— è®ºæ˜¯æ¥è‡ªç½‘ç»œæœåŠ¡å™¨çš„äº‹ä»¶ï¼Œè¿˜æ˜¯æ¥è‡ªè‚¡ç¥¨äº¤æ˜“æ‰€çš„äº¤æ˜“ï¼Œæˆ–è€…æ˜¯æ¥è‡ªå·¥å‚è½¦é—´æœºå™¨çš„ä¼ æ„Ÿå™¨è¯»æ•°ï¼Œæ•°æ®éƒ½æ˜¯ä½œä¸ºæµçš„ä¸€éƒ¨åˆ†è¢«åˆ›å»ºçš„ã€‚ä½†å½“ä½ åˆ†ææ•°æ®æ—¶ï¼Œä½ å¯ä»¥å›´ç»•æœ‰ç•Œæµæˆ–æ— ç•Œæµç»„ç»‡å¤„ç†ï¼Œè€Œä½ é€‰æ‹©å“ªç§èŒƒå¼ä¼šäº§ç”Ÿæ·±è¿œçš„å½±å“ã€‚\nå½“ä½ å¤„ç†ä¸€ä¸ªæœ‰è¾¹ç•Œçš„æ•°æ®æµæ—¶ï¼Œæ‰¹å¤„ç†æ˜¯å·¥ä½œçš„èŒƒå¼ã€‚åœ¨è¿™ç§æ“ä½œæ¨¡å¼ä¸‹ï¼Œä½ å¯ä»¥é€‰æ‹©åœ¨äº§ç”Ÿä»»ä½•ç»“æœä¹‹å‰æ‘„å–æ•´ä¸ªæ•°æ®é›†ï¼Œè¿™æ„å‘³ç€ï¼Œä¾‹å¦‚ï¼Œå¯ä»¥å¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œè®¡ç®—å…¨å±€ç»Ÿè®¡ï¼Œæˆ–äº§ç”Ÿä¸€ä¸ªæ±‡æ€»æ‰€æœ‰è¾“å…¥çš„æœ€ç»ˆæŠ¥å‘Šã€‚\nå¦ä¸€æ–¹é¢ï¼Œæµå¤„ç†æ¶‰åŠæ— è¾¹ç•Œçš„æ•°æ®æµã€‚è‡³å°‘åœ¨æ¦‚å¿µä¸Šï¼Œè¾“å…¥å¯èƒ½æ°¸è¿œä¸ä¼šç»“æŸï¼Œå› æ­¤ä½ ä¸å¾—ä¸åœ¨æ•°æ®åˆ°è¾¾æ—¶æŒç»­å¤„ç†æ•°æ®ã€‚\nåœ¨ Flink ä¸­ï¼Œåº”ç”¨ç¨‹åºç”±æµå¼æ•°æ®æµç»„æˆï¼Œè¿™äº›æ•°æ®æµå¯ä»¥é€šè¿‡ç”¨æˆ·å®šä¹‰çš„è¿ç®—ç¬¦è¿›è¡Œè½¬æ¢ã€‚è¿™äº›æ•°æ®æµå½¢æˆæœ‰å‘å›¾ï¼Œä»ä¸€ä¸ªæˆ–å¤šä¸ªæºå¼€å§‹ï¼Œåˆ°ä¸€ä¸ªæˆ–å¤šä¸ª sink ç»“æŸã€‚\né€šå¸¸ï¼Œç¨‹åºä¸­çš„å˜æ¢(transformation)å’Œæ•°æ®æµ(dataflow)ä¸­çš„è¿ç®—ç¬¦(operator)ä¹‹é—´å­˜åœ¨ä¸€å¯¹ä¸€çš„å¯¹åº”å…³ç³»ã€‚ä½†æœ‰æ—¶ï¼Œä¸€ä¸ªå˜æ¢å¯èƒ½ç”±å¤šä¸ªè¿ç®—ç¬¦(operator)ç»„æˆã€‚\nä¸€ä¸ªåº”ç”¨ç¨‹åºå¯èƒ½ä¼šæ¶ˆè€—æ¥è‡ªæµå¼æºçš„å®æ—¶æ•°æ®ï¼Œå¦‚æ¶ˆæ¯é˜Ÿåˆ—æˆ–åˆ†å¸ƒå¼æ—¥å¿—ï¼Œå¦‚ Apache Kafka æˆ– Kinesisã€‚ä½† Flink ä¹Ÿå¯ä»¥æ¶ˆè€—æ¥è‡ªå„ç§æ•°æ®æºçš„æœ‰ç•Œå†å²æ•°æ®ã€‚åŒæ ·ï¼ŒFlink åº”ç”¨æ­£åœ¨äº§ç”Ÿçš„ç»“æœæµä¹Ÿå¯ä»¥è¢«å‘é€åˆ°å„ç§å„æ ·çš„ç³»ç»Ÿï¼Œè¿™äº›ç³»ç»Ÿå¯ä»¥ä½œä¸º sink è¿æ¥ã€‚\nå¹¶è¡Œæ•°æ®æµ Flink ä¸­çš„ç¨‹åºæœ¬è´¨ä¸Šæ˜¯å¹¶è¡Œå’Œåˆ†å¸ƒå¼çš„ã€‚åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªæµæœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæµåˆ†åŒº(stream partitions)ï¼Œæ¯ä¸ªè¿ç®—ç¬¦(operator)æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªè¿ç®—ç¬¦å­ä»»åŠ¡(operator subtasks)ã€‚è¿ç®—ç¬¦å­ä»»åŠ¡(operator subtasks)ç›¸äº’ç‹¬ç«‹ï¼Œåœ¨ä¸åŒçš„çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œä¹Ÿå¯èƒ½åœ¨ä¸åŒçš„æœºå™¨æˆ–å®¹å™¨ä¸Šæ‰§è¡Œã€‚\nè¿ç®—ç¬¦ç¬¦å­ä»»åŠ¡(operator subtasks)çš„æ•°é‡å°±æ˜¯è¯¥ç‰¹å®šè¿ç®—ç¬¦(operator)çš„å¹¶è¡Œåº¦(parallelism)ã€‚åŒä¸€ç¨‹åºçš„ä¸åŒè¿ç®—ç¬¦å¯èƒ½å…·æœ‰ä¸åŒçš„å¹¶è¡Œåº¦æ°´å¹³ã€‚\næµå¯ä»¥åœ¨ä¸¤ä¸ªè¿ç®—ç¬¦ä¹‹é—´ä»¥ä¸€å¯¹ä¸€ï¼ˆæˆ–è½¬å‘ï¼‰çš„æ¨¡å¼æˆ–ä»¥é‡åˆ†å‘çš„æ¨¡å¼ä¼ è¾“æ•°æ®ã€‚\n  ä¸€å¯¹ä¸€çš„æµï¼ˆä¾‹å¦‚ä¸Šå›¾ä¸­ Source å’Œ map() è¿ç®—ç¬¦ä¹‹é—´ï¼‰ä¿ç•™äº†å…ƒç´ çš„åˆ†åŒºå’Œæ’åºã€‚è¿™æ„å‘³ç€ map() è¿ç®—ç¬¦çš„ subtask[1] å°†çœ‹åˆ°ä¸ Source è¿ç®—ç¬¦çš„ subtask[1] æ‰€äº§ç”Ÿçš„å…ƒç´ é¡ºåºç›¸åŒçš„å…ƒç´ ã€‚\n  é‡æ–°åˆ†å‘æµï¼ˆå¦‚ä¸Šé¢ map() å’Œ keyBy/window ä¹‹é—´ï¼Œä»¥åŠ keyBy/window å’Œ Sink ä¹‹é—´ï¼‰ä¼šæ”¹å˜æµçš„åˆ†åŒºã€‚æ¯ä¸ªè¿ç®—ç¬¦å­ä»»åŠ¡(operator subtask)éƒ½ä¼šæ ¹æ®æ‰€é€‰çš„è½¬æ¢å°†æ•°æ®å‘é€åˆ°ä¸åŒçš„ç›®æ ‡å­ä»»åŠ¡ã€‚ä¾‹å¦‚ keyBy()ï¼ˆé€šè¿‡æ•£åˆ—é”®æ¥é‡æ–°åˆ†åŒºï¼‰ã€broadcast() æˆ– rebalance()ï¼ˆéšæœºé‡æ–°åˆ†åŒºï¼‰ã€‚åœ¨é‡åˆ†å‘äº¤æ¢ä¸­ï¼Œå…ƒç´ ä¹‹é—´çš„æ’åºåªåœ¨æ¯ä¸€å¯¹å‘é€å’Œæ¥æ”¶å­ä»»åŠ¡ä¸­è¢«ä¿ç•™ï¼ˆä¾‹å¦‚ï¼Œmap() çš„ subtask[1] å’Œ keyBy/window çš„ subtask[2]ï¼‰ã€‚å› æ­¤ï¼Œä¾‹å¦‚ï¼Œä¸Šé¢æ˜¾ç¤ºçš„ keyBy/window å’Œ Sink è¿ç®—ç¬¦ä¹‹é—´çš„é‡æ–°åˆ†å‘ï¼Œå¼•å…¥äº†å…³äºä¸åŒé”®çš„èšåˆç»“æœåˆ°è¾¾ Sink çš„é¡ºåºçš„éç¡®å®šæ€§ã€‚\n  åŠæ—¶çš„æµå¤„ç† å¯¹äºå¤§å¤šæ•°æµå¼åº”ç”¨æ¥è¯´ï¼Œèƒ½å¤Ÿç”¨å¤„ç†å®æ—¶æ•°æ®çš„ç›¸åŒä»£ç é‡æ–°å¤„ç†å†å²æ•°æ®æ˜¯éå¸¸æœ‰ä»·å€¼çš„\u0026ndash;æ— è®ºå¦‚ä½•ï¼Œéƒ½èƒ½äº§ç”Ÿç¡®å®šæ€§çš„ã€ä¸€è‡´çš„ç»“æœã€‚\næ­¤å¤–ï¼Œå…³æ³¨äº‹ä»¶å‘ç”Ÿçš„é¡ºåºï¼Œè€Œä¸æ˜¯äº‹ä»¶äº¤ä»˜å¤„ç†çš„é¡ºåºï¼Œå¹¶ä¸”èƒ½å¤Ÿæ¨ç†å‡ºä¸€ç»„äº‹ä»¶ä½•æ—¶ï¼ˆæˆ–åº”è¯¥ï¼‰å®Œæˆä¹Ÿæ˜¯è‡³å…³é‡è¦çš„ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ç”µå­å•†åŠ¡äº¤æ˜“ï¼Œæˆ–é‡‘èè´¸æ˜“ä¸­æ¶‰åŠçš„ä¸€ç³»åˆ—äº‹ä»¶ã€‚\né€šè¿‡ä½¿ç”¨è®°å½•åœ¨æ•°æ®æµä¸­çš„äº‹ä»¶æ—¶é—´æˆ³ï¼Œè€Œä¸æ˜¯ä½¿ç”¨å¤„ç†æ•°æ®çš„æœºå™¨çš„æ—¶é’Ÿï¼Œå¯ä»¥æ»¡è¶³è¿™äº›åŠæ—¶æµå¤„ç†çš„è¦æ±‚ã€‚\næœ‰çŠ¶æ€çš„æµå¤„ç† Flink çš„æ“ä½œå¯ä»¥æ˜¯æœ‰çŠ¶æ€çš„ã€‚è¿™æ„å‘³ç€ä¸€ä¸ªäº‹ä»¶çš„å¤„ç†æ–¹å¼å¯ä»¥å–å†³äºä¹‹å‰æ‰€æœ‰äº‹ä»¶çš„ç´¯ç§¯æ•ˆæœã€‚çŠ¶æ€å¯ä»¥ç”¨äºä¸€äº›ç®€å•çš„äº‹æƒ…ï¼Œä¾‹å¦‚è®¡ç®—æ¯åˆ†é’Ÿçš„äº‹ä»¶ä»¥æ˜¾ç¤ºåœ¨ä»ªè¡¨æ¿ä¸Šï¼Œæˆ–è€…ç”¨äºä¸€äº›æ›´å¤æ‚çš„äº‹æƒ…ï¼Œä¾‹å¦‚è®¡ç®—æ¬ºè¯ˆæ£€æµ‹æ¨¡å‹çš„åŠŸèƒ½ã€‚\nä¸€ä¸ª Flink åº”ç”¨æ˜¯åœ¨åˆ†å¸ƒå¼é›†ç¾¤ä¸Šå¹¶è¡Œè¿è¡Œçš„ã€‚ä¸€ä¸ªç»™å®šçš„è¿ç®—ç¬¦çš„å„ç§å¹¶è¡Œå®ä¾‹å°†ä»¥ä¸åŒçš„çº¿ç¨‹ç‹¬ç«‹æ‰§è¡Œï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå®ƒä»¬å°†åœ¨ä¸åŒçš„æœºå™¨ä¸Šè¿è¡Œã€‚\nä¸€ä¸ªæœ‰çŠ¶æ€è¿ç®—ç¬¦çš„å¹¶è¡Œå®ä¾‹é›†å®é™…ä¸Šæ˜¯ä¸€ä¸ªåˆ†ç‰‡çš„é”®å€¼å­˜å‚¨ã€‚æ¯ä¸€ä¸ªå¹¶è¡Œå®ä¾‹è´Ÿè´£å¤„ç†ä¸€ç»„ç‰¹å®šé”®çš„äº‹ä»¶ï¼Œè¿™äº›é”®çš„çŠ¶æ€è¢«ä¿å­˜åœ¨æœ¬åœ°ã€‚\nä¸‹å›¾æ˜¾ç¤ºäº†ä¸€ä¸ªä½œä¸š(Job)ï¼Œåœ¨ä½œä¸šå›¾(job graph)ä¸­çš„å‰ä¸‰ä¸ªè¿ç®—ç¬¦ä¸Šè¿è¡Œçš„å¹¶è¡Œåº¦ä¸º2ï¼Œç»ˆæ­¢äºä¸€ä¸ªå¹¶è¡Œåº¦ä¸º 1 çš„ sinkã€‚ç¬¬ä¸‰ä¸ªè¿ç®—ç¬¦æ˜¯æœ‰çŠ¶æ€çš„ï¼Œä½ å¯ä»¥çœ‹åˆ°åœ¨ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªè¿ç®—ç¬¦ä¹‹é—´å‘ç”Ÿäº†ä¸€ä¸ªå®Œå…¨è¿æ¥çš„ç½‘ç»œæ´—ç‰Œã€‚è¿™æ˜¯åœ¨é€šè¿‡ä¸€äº›é”®æ¥å¯¹æµè¿›è¡Œåˆ†åŒºï¼Œè¿™æ ·æ‰€æœ‰éœ€è¦ä¸€èµ·å¤„ç†çš„äº‹ä»¶ï¼Œéƒ½ä¼šè¢«ä¸€èµ·å¤„ç†ã€‚\nçŠ¶æ€æ€»æ˜¯åœ¨æœ¬åœ°è®¿é—®ï¼Œè¿™æœ‰åŠ©äº Flink åº”ç”¨å®ç°é«˜ååé‡å’Œä½å»¶è¿Ÿã€‚ä½ å¯ä»¥é€‰æ‹©å°†çŠ¶æ€ä¿å­˜åœ¨ JVM å †ä¸Šï¼Œå¦‚æœçŠ¶æ€å¤ªå¤§ï¼Œä¹Ÿå¯ä»¥å°†å…¶ä¿å­˜åœ¨æœ‰æ•ˆç»„ç»‡çš„ç£ç›˜æ•°æ®ç»“æ„ä¸­ã€‚\né€šè¿‡çŠ¶æ€å¿«ç…§è¿›è¡Œå®¹é”™ Flink èƒ½å¤Ÿé€šè¿‡çŠ¶æ€å¿«ç…§å’Œæµé‡æ”¾çš„ç»„åˆï¼Œæä¾›å®¹é”™ã€ç²¾ç¡®çš„ä¸€æ¬¡æ€§è¯­ä¹‰ã€‚è¿™äº›å¿«ç…§æ•è·äº†åˆ†å¸ƒå¼ç®¡é“çš„æ•´ä¸ªçŠ¶æ€ï¼Œè®°å½•äº†è¿›å…¥è¾“å…¥é˜Ÿåˆ—çš„åç§»ä»¥åŠæ•´ä¸ªä½œä¸šå›¾(job graph)ä¸­å› æ‘„å–äº†è¯¥ç‚¹æ•°æ®è€Œäº§ç”Ÿçš„çŠ¶æ€ã€‚å½“å‘ç”Ÿæ•…éšœæ—¶ï¼Œæºä¼šè¢«é‡æ”¾ï¼ŒçŠ¶æ€è¢«æ¢å¤ï¼Œå¹¶æ¢å¤å¤„ç†ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œè¿™äº›çŠ¶æ€å¿«ç…§æ˜¯å¼‚æ­¥æ•è·çš„ï¼Œä¸ä¼šå¦¨ç¢æ­£åœ¨è¿›è¡Œçš„å¤„ç†ã€‚\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/learn-flink/\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-19-learn-flink-hands-on-training/","tags":["Flink","Training"],"title":"å­¦ä¹  Flink: å®è·µåŸ¹è®­"},{"categories":["programming"],"contents":"å¯¹äº Apache Flink æ¥è¯´ï¼Œä¸€ä¸ªéå¸¸å¸¸è§çš„ç”¨ä¾‹æ˜¯å®ç° ETLï¼ˆæå–ã€è½¬æ¢ã€åŠ è½½ï¼‰ç®¡é“ï¼Œä»ä¸€ä¸ªæˆ–å¤šä¸ªæºä¸­è·å–æ•°æ®ï¼Œè¿›è¡Œä¸€äº›è½¬æ¢å’Œ/æˆ–ä¸°å¯Œï¼Œç„¶åå°†ç»“æœå­˜å‚¨åœ¨æŸä¸ªåœ°æ–¹ã€‚åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ Flink çš„ DataStream API æ¥å®ç°è¿™ç§åº”ç”¨ã€‚\nè¯·æ³¨æ„ï¼ŒFlinkçš„ Table å’Œ SQL APIå¾ˆé€‚åˆè®¸å¤š ETL ç”¨ä¾‹ã€‚ä½†æ— è®ºä½ æœ€ç»ˆæ˜¯å¦ç›´æ¥ä½¿ç”¨ DataStream APIï¼Œå¯¹è¿™é‡Œä»‹ç»çš„åŸºç¡€çŸ¥è¯†æœ‰ä¸€ä¸ªæ‰å®çš„ç†è§£éƒ½æ˜¯æœ‰ä»·å€¼çš„ã€‚\næ— çŠ¶æ€è½¬æ¢ æœ¬èŠ‚ä»‹ç»äº† map() å’Œ flatmap()ï¼Œå®ƒä»¬æ˜¯ç”¨æ¥å®ç°æ— çŠ¶æ€è½¬æ¢çš„åŸºæœ¬æ“ä½œã€‚æœ¬èŠ‚ä¸­çš„ä¾‹å­å‡è®¾ä½ ç†Ÿæ‚‰ flink-training ä»“åº“ä¸­çš„å®æˆ˜ç»ƒä¹ ä¸­ä½¿ç”¨çš„å‡ºç§Ÿè½¦ä¹˜è½¦æ•°æ®ã€‚\nmap() åœ¨ç¬¬ä¸€ä¸ªç»ƒä¹ ä¸­ï¼Œä½ è¿‡æ»¤äº†ä¸€ä¸ªæ‰“è½¦äº‹ä»¶çš„æµï¼Œåœ¨åŒä¸€ä¸ªä»£ç åº“ä¸­ï¼Œæœ‰ä¸€ä¸ª GeoUtils ç±»ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªé™æ€æ–¹æ³• GeoUtils.mapToGridCell(float lon, float lat)ï¼Œè¯¥æ–¹æ³•å°†ä¸€ä¸ª location (longitude, latitude) æ˜ å°„åˆ°ä¸€ä¸ªç½‘æ ¼å•å…ƒï¼Œè¯¥å•å…ƒæŒ‡çš„æ˜¯ä¸€ä¸ªå¤§çº¦100x100ç±³å¤§å°çš„åŒºåŸŸã€‚\nç°åœ¨è®©æˆ‘ä»¬é€šè¿‡ä¸ºæ¯ä¸ªäº‹ä»¶æ·»åŠ  startCell å’Œ endCell å­—æ®µæ¥ä¸°å¯Œæˆ‘ä»¬çš„æ‰“è½¦å¯¹è±¡æµã€‚ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª EnrichedRide å¯¹è±¡ï¼Œæ‰©å±• TaxiRideï¼Œæ·»åŠ è¿™äº›å­—æ®µã€‚\npublic static class EnrichedRide extends TaxiRide { public int startCell; public int endCell; public EnrichedRide() {} public EnrichedRide(TaxiRide ride) { this.rideId = ride.rideId; this.isStart = ride.isStart; ... this.startCell = GeoUtils.mapToGridCell(ride.startLon, ride.startLat); this.endCell = GeoUtils.mapToGridCell(ride.endLon, ride.endLat); } public String toString() { return super.toString() + \u0026#34;,\u0026#34; + Integer.toString(this.startCell) + \u0026#34;,\u0026#34; + Integer.toString(this.endCell); } } ç„¶åï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå°†æµè½¬åŒ–ä¸º:\nval rides: DataStream[TaxiRide] = env.addSource(new TaxiRideSource(...)); val enrichedNYCRides: DataStream[EnrichedRide] = rides .filter(new RideCleansingSolution.NYCFilter()) .map(new Enrichment()); enrichedNYCRides.print(); ä½¿ç”¨è¿™ä¸ª MapFunction:\nclass Enrichment extends MapFunction[TaxiRide, EnrichedRide] { override def map(taxiRide: TaxiRide) { return new EnrichedRide(taxiRide); } } flatmap() MapFunction åªé€‚ç”¨äºæ‰§è¡Œä¸€å¯¹ä¸€çš„è½¬æ¢ï¼šå¯¹äºæ¯ä¸€ä¸ªè¿›å…¥çš„æµå…ƒç´ ï¼Œmap() å°†å‘å‡ºä¸€ä¸ªè½¬æ¢åçš„å…ƒç´ ã€‚å¦åˆ™ï¼Œä½ å°†éœ€è¦ä½¿ç”¨ flatmap():\nval rides: DataStream[TaxiRide] = env.addSource(new TaxiRideSource(...)); val enrichedNYCRides: DataStream[EnrichedRide] = rides .flatMap(new NYCEnrichment()); enrichedNYCRides.print(); åŠ ä¸Šä¸€ä¸ª FlatMapFunction:\nclass NYCEnrichment extends FlatMapFunction[TaxiRide, EnrichedRide] { override def flatMap(taxiRide: TaxiRide, out: Collector[EnrichedRide]) { val valid: FilterFunction[TaxiRide] = new RideCleansing.NYCFilter(); if (valid.filter(taxiRide)) { out.collect(new EnrichedRide(taxiRide)); } } } é€šè¿‡è¿™ä¸ªæ¥å£æä¾›çš„ Collectorï¼Œflatmap() æ–¹æ³•å¯ä»¥éšå¿ƒæ‰€æ¬²åœ°å‘å°„è®¸å¤šæµå…ƒç´ ï¼ŒåŒ…æ‹¬å®Œå…¨ä¸å‘å°„å…ƒç´ ã€‚\nKeyed Streams keyBy() é€šå¸¸ï¼Œèƒ½å¤Ÿå›´ç»•ä¸€ä¸ªå±æ€§å¯¹ä¸€ä¸ªæµè¿›è¡Œåˆ†åŒºæ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œè¿™æ ·æ‰€æœ‰å…·æœ‰ç›¸åŒå±æ€§å€¼çš„äº‹ä»¶å°±ä¼šè¢«å½’ä¸ºä¸€ç»„ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ æƒ³æ‰¾åˆ°ä»æ¯ä¸ªç½‘æ ¼å•å…ƒå¼€å§‹çš„æœ€é•¿çš„å‡ºç§Ÿè½¦ä¹˜è½¦æ—¶é—´ã€‚ä» SQL æŸ¥è¯¢çš„è§’åº¦è€ƒè™‘ï¼Œè¿™æ„å‘³ç€è¦å¯¹ startCell è¿›è¡ŒæŸç§ GROUP BYï¼Œè€Œåœ¨ Flink ä¸­ï¼Œè¿™æ˜¯ç”¨ keyBy(KeySelector) æ¥å®Œæˆçš„ã€‚\nrides .flatMap(new NYCEnrichment()) .keyBy(\u0026#34;startCell\u0026#34;) æ¯ä¸€ä¸ª keyBy éƒ½ä¼šå¼•èµ·ä¸€æ¬¡ç½‘ç»œæ´—ç‰Œï¼Œå¯¹æµè¿›è¡Œé‡æ–°åˆ†åŒºã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™æ˜¯å¾ˆæ˜‚è´µçš„ï¼Œå› ä¸ºå®ƒæ¶‰åŠåˆ°ç½‘ç»œé€šä¿¡ä»¥åŠåºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚\nåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œé”®æ˜¯ç”±ä¸€ä¸ªå­—æ®µå \u0026ldquo;startCell\u0026rdquo; æŒ‡å®šçš„ã€‚è¿™ç§é”®é€‰æ‹©çš„é£æ ¼æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œé‚£å°±æ˜¯ç¼–è¯‘å™¨æ— æ³•æ¨æ–­ç”¨äºé”®é€‰æ‹©çš„å­—æ®µçš„ç±»å‹ï¼Œå› æ­¤ Flink ä¼šå°†é”®å€¼ä½œä¸ºå…ƒç»„ä¼ é€’ï¼Œè¿™å¯èƒ½ä¼šå¾ˆç¬¨æ‹™ã€‚æœ€å¥½æ˜¯ä½¿ç”¨ä¸€ä¸ªæ­£ç¡®ç±»å‹çš„ KeySelectorï¼Œä¾‹å¦‚:\nrides .flatMap(new NYCEnrichment()) .keyBy( new KeySelector\u0026lt;EnrichedRide, int\u0026gt;() { @Override public int getKey(EnrichedRide enrichedRide) throws Exception { return enrichedRide.startCell; } }) å¯ä»¥ç”¨ lambda æ›´ç®€æ´åœ°è¡¨è¾¾å‡ºæ¥ã€‚\nrides .flatMap(new NYCEnrichment()) .keyBy(enrichedRide -\u0026gt; enrichedRide.startCell) Keys are computed KeySelectors å¹¶ä¸å±€é™äºä»ä½ çš„äº‹ä»¶ä¸­æå–ä¸€ä¸ªé”®ï¼Œç›¸åï¼Œå®ƒä»¬å¯ä»¥ç”¨ä»»ä½•ä½ æƒ³è¦çš„æ–¹å¼æ¥è®¡ç®—é”®ï¼Œåªè¦äº§ç”Ÿçš„é”®æ˜¯ç¡®å®šæ€§çš„ï¼Œå¹¶ä¸”æœ‰æœ‰æ•ˆçš„ hashCode() å’Œ equals() çš„å®ç°ã€‚è¿™ä¸ªé™åˆ¶æ’é™¤äº†ç”Ÿæˆéšæœºæ•°ï¼Œæˆ–è€…è¿”å›æ•°ç»„æˆ–æšä¸¾çš„ KeySelectorsï¼Œä½†æ˜¯ä½ å¯ä»¥ä½¿ç”¨å…ƒç»„æˆ– POJOs æ¥ç”Ÿæˆå¤åˆé”®ï¼Œä¾‹å¦‚ï¼Œåªè¦å®ƒä»¬çš„å…ƒç´ éµå¾ªè¿™äº›ç›¸åŒçš„è§„åˆ™ã€‚\né”®å¿…é¡»ä»¥ç¡®å®šæ€§çš„æ–¹å¼äº§ç”Ÿï¼Œå› ä¸ºæ¯å½“éœ€è¦å®ƒä»¬æ—¶ï¼Œå®ƒä»¬å°±ä¼šè¢«é‡æ–°è®¡ç®—ï¼Œè€Œä¸æ˜¯é™„åŠ åˆ°æµè®°å½•ä¸Šã€‚\nä¾‹å¦‚ï¼Œæˆ‘ä»¬ä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ EnrichedRide ç±»ï¼Œè¯¥ç±»æœ‰ä¸€ä¸ª startCell å­—æ®µï¼Œç„¶åæˆ‘ä»¬å°†å…¶ç”¨ä½œé”®:\nkeyBy(enrichedRide -\u0026gt; enrichedRide.startCell) ç›¸å, æˆ‘ä»¬å¯ä»¥è¿™æ ·åš:\nkeyBy(ride -\u0026gt; GeoUtils.mapToGridCell(ride.startLon, ride.startLat)) Keyed æµçš„èšåˆ è¿™æ®µä»£ç ä¸ºæ¯ä¸ª end-of-ride äº‹ä»¶åˆ›å»ºä¸€ä¸ªæ–°çš„å…ƒç»„æµï¼Œå…¶ä¸­åŒ…å« startCell å’ŒæŒç»­æ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰ã€‚\nimport org.joda.time.Interval; DataStream\u0026lt;Tuple2\u0026lt;Integer, Minutes\u0026gt;\u0026gt; minutesByStartCell = enrichedNYCRides .flatMap(new FlatMapFunction\u0026lt;EnrichedRide, Tuple2\u0026lt;Integer, Minutes\u0026gt;\u0026gt;() { @Override public void flatMap(EnrichedRide ride, Collector\u0026lt;Tuple2\u0026lt;Integer, Minutes\u0026gt;\u0026gt; out) throws Exception { if (!ride.isStart) { Interval rideInterval = new Interval(ride.startTime, ride.endTime); Minutes duration = rideInterval.toDuration().toStandardMinutes(); out.collect(new Tuple2\u0026lt;\u0026gt;(ride.startCell, duration)); } } }); ç°åœ¨å¯ä»¥äº§ç”Ÿä¸€ä¸ªæµï¼Œå…¶ä¸­åªåŒ…å«é‚£äº›å¯¹æ¯ä¸ª startCell æ¥è¯´æ˜¯æœ‰å²ä»¥æ¥ï¼ˆè‡³æ­¤ï¼‰æœ€é•¿çš„ä¹˜è½¦è®°å½•ã€‚\næœ‰å¤šç§æ–¹å¼å¯ä»¥è¡¨è¾¾ä½œä¸ºé”®çš„å­—æ®µã€‚ä¹‹å‰ä½ çœ‹åˆ°äº†ä¸€ä¸ª EnrichedRide POJO çš„ä¾‹å­ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¦ç”¨ä½œé”®çš„å­—æ®µæ˜¯ç”¨å®ƒçš„åå­—æŒ‡å®šçš„ã€‚è¿™ä¸ªä¾‹å­æ¶‰åŠåˆ° Tuple2 å¯¹è±¡ï¼Œå…ƒç»„ä¸­çš„ç´¢å¼•ï¼ˆä»0å¼€å§‹ï¼‰è¢«ç”¨æ¥æŒ‡å®šé”®ã€‚\nminutesByStartCell .keyBy(0) // startCell  .maxBy(1) // duration  .print(); ç°åœ¨ï¼Œæ¯å½“æŒç»­æ—¶é—´è¾¾åˆ°ä¸€ä¸ªæ–°çš„æœ€å¤§å€¼æ—¶ï¼Œè¾“å‡ºæµå°±ä¼šåŒ…å«ä¸€ä¸ªé’ˆå¯¹æ¯ä¸ªé”®çš„è®°å½•\u0026ndash;å¦‚è¿™é‡Œçš„50797å•å…ƒæ ¼æ‰€ç¤ºã€‚\n... 4\u0026gt; (64549,5M) 4\u0026gt; (46298,18M) 1\u0026gt; (51549,14M) 1\u0026gt; (53043,13M) 1\u0026gt; (56031,22M) 1\u0026gt; (50797,6M) ... 1\u0026gt; (50797,8M) ... 1\u0026gt; (50797,11M) ... 1\u0026gt; (50797,12M) (Implicit) State è¿™æ˜¯æœ¬æ¬¡è®­ç»ƒä¸­ç¬¬ä¸€ä¸ªæ¶‰åŠæœ‰çŠ¶æ€æµçš„ä¾‹å­ã€‚è™½ç„¶çŠ¶æ€è¢«é€æ˜åœ°å¤„ç†ï¼Œä½† Flink å¿…é¡»è·Ÿè¸ªæ¯ä¸ªä¸åŒé”®çš„æœ€å¤§æŒç»­æ—¶é—´ã€‚\næ¯å½“çŠ¶æ€æ¶‰åŠåˆ°ä½ çš„åº”ç”¨æ—¶ï¼Œä½ åº”è¯¥è€ƒè™‘çŠ¶æ€å¯èƒ½ä¼šå˜å¾—å¤šå¤§ã€‚æ¯å½“é”®ç©ºé—´æ˜¯æ— é™åˆ¶çš„ï¼Œé‚£ä¹ˆ Flink éœ€è¦çš„çŠ¶æ€é‡ä¹Ÿæ˜¯æ— é™åˆ¶çš„ã€‚\nå½“å¤„ç†æµæ—¶ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œåœ¨æœ‰é™çš„çª—å£ä¸Šè€ƒè™‘èšåˆæ¯”åœ¨æ•´ä¸ªæµä¸Šè€ƒè™‘æ›´æœ‰æ„ä¹‰ã€‚\nreduce() å’Œå…¶ä»–èšåˆå™¨ ä¸Šæ–‡ä¸­ä½¿ç”¨çš„ maxBy() åªæ˜¯ Flink çš„ KeyedStreams ä¸Šä¼—å¤šèšåˆå‡½æ•°ä¸­çš„ä¸€ä¸ªä¾‹å­ã€‚è¿˜æœ‰ä¸€ä¸ªæ›´é€šç”¨çš„ reduce() å‡½æ•°ï¼Œä½ å¯ä»¥ç”¨å®ƒæ¥å®ç°è‡ªå·±çš„è‡ªå®šä¹‰èšåˆã€‚\nçŠ¶æ€è½¬æ¢ ä¸ºä»€ä¹ˆ Flink è¦å‚ä¸ç®¡ç†çŠ¶æ€ï¼Ÿ ä½ çš„åº”ç”¨ç¨‹åºå½“ç„¶èƒ½å¤Ÿåœ¨æ²¡æœ‰è®© Flink å‚ä¸ç®¡ç†çŠ¶æ€çš„æƒ…å†µä¸‹ä½¿ç”¨çŠ¶æ€\u0026ndash;ä½† Flink ä¸ºå®ƒæ‰€ç®¡ç†çš„çŠ¶æ€æä¾›äº†ä¸€äº›å¼•äººæ³¨ç›®çš„åŠŸèƒ½ã€‚\n æœ¬åœ°åŒ–ã€‚Flink çŠ¶æ€è¢«ä¿å­˜åœ¨å¤„ç†å®ƒçš„æœºå™¨çš„æœ¬åœ°ï¼Œå¹¶ä¸”å¯ä»¥ä»¥å†…å­˜é€Ÿåº¦è¢«è®¿é—®ã€‚ è€ç”¨ã€‚Flink çŠ¶æ€æ˜¯å®¹é”™çš„ï¼Œå³æ¯éš”ä¸€æ®µæ—¶é—´å°±ä¼šè‡ªåŠ¨æ£€æŸ¥ä¸€æ¬¡ï¼Œä¸€æ—¦å¤±è´¥å°±ä¼šæ¢å¤ã€‚ çºµå‘å¯æ‰©å±•ã€‚Flink çŠ¶æ€å¯ä»¥ä¿å­˜åœ¨åµŒå…¥å¼ RocksDB å®ä¾‹ä¸­ï¼Œé€šè¿‡å¢åŠ æ›´å¤šçš„æœ¬åœ°ç£ç›˜æ¥æ‰©å±•ã€‚ æ¨ªå‘å¯æ‰©å±•ã€‚éšç€é›†ç¾¤çš„å¢é•¿å’Œæ”¶ç¼©ï¼ŒFlink çŠ¶æ€ä¼šè¢«é‡æ–°åˆ†é…ã€‚ å¯æŸ¥è¯¢ã€‚Flink çŠ¶æ€å¯ä»¥é€šè¿‡å¯æŸ¥è¯¢çŠ¶æ€ API è¿›è¡Œå¤–éƒ¨æŸ¥è¯¢ã€‚  åœ¨æœ¬èŠ‚ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ Flink çš„ API ç®¡ç† keyed çŠ¶æ€ã€‚\nRich å‡½æ•° æ­¤æ—¶ä½ å·²ç»çœ‹åˆ°äº† Flink çš„å‡ ä¸ªå‡½æ•°æ¥å£ï¼ŒåŒ…æ‹¬ FilterFunctionã€MapFunction å’Œ FlatMapFunctionã€‚è¿™äº›éƒ½æ˜¯å•ä¸€æŠ½è±¡æ–¹æ³•æ¨¡å¼çš„ä¾‹å­ã€‚\nå¯¹äºæ¯ä¸€ä¸ªæ¥å£ï¼ŒFlink è¿˜æä¾›äº†ä¸€ä¸ªæ‰€è°“çš„\u0026quot;å¯Œ\u0026quot;å˜ä½“ï¼Œä¾‹å¦‚ï¼ŒRichFlatMapFunctionï¼Œå®ƒæœ‰ä¸€äº›é¢å¤–çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬:\n open(Configuration c) close() getRuntimeContext()  open() åœ¨æ“ä½œç¬¦åˆå§‹åŒ–æœŸé—´è¢«è°ƒç”¨ä¸€æ¬¡ã€‚è¿™æ˜¯ä¸€ä¸ªåŠ è½½ä¸€äº›é™æ€æ•°æ®çš„æœºä¼šï¼Œæˆ–è€…, ä¾‹å¦‚æ‰“å¼€ä¸€ä¸ªå¤–éƒ¨æœåŠ¡çš„è¿æ¥ã€‚\ngetRuntimeContext() æä¾›äº†å¯¹ä¸€æ•´å¥—æ½œåœ¨çš„æœ‰è¶£çš„ä¸œè¥¿çš„è®¿é—®ï¼Œä½†æœ€å€¼å¾—æ³¨æ„çš„æ˜¯å®ƒæ˜¯å¦‚ä½•åˆ›å»ºå’Œè®¿é—®ç”± Flink ç®¡ç†çš„çŠ¶æ€ã€‚\nä¸€ä¸ªå¸¦æœ‰ Keyed State çš„ä¾‹å­ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€ä¸ªäº‹ä»¶æµï¼Œä½ æƒ³å»æ‰é‡å¤ï¼Œæ‰€ä»¥ä½ åªä¿ç•™æ¯ä¸ªé”®çš„ç¬¬ä¸€ä¸ªäº‹ä»¶ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºå¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½¿ç”¨ä¸€ä¸ªåä¸º Deduplicator çš„ RichFlatMapFunction:\nprivate static class Event { public final String key; public final long timestamp; ... } public static void main(String[] args) throws Exception { StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); env.addSource(new EventSource()) .keyBy(e -\u0026gt; e.key) .flatMap(new Deduplicator()) .print(); env.execute(); } ä¸ºäº†è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼ŒDeduplicator å°†éœ€è¦ä»¥æŸç§æ–¹å¼è®°ä½ï¼Œå¯¹äºæ¯ä¸ªé”®æ¥è¯´ï¼Œæ˜¯å¦å·²ç»æœ‰äº†è¯¥é”®çš„äº‹ä»¶ã€‚å®ƒå°†ä½¿ç”¨ Flink çš„ keyed state æ¥å£æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚\nå½“ä½ åœ¨ä½¿ç”¨åƒè¿™æ ·çš„ keyed æµæ—¶ï¼ŒFlink å°†ä¸ºæ¯ä¸ªè¢«ç®¡ç†çš„çŠ¶æ€é¡¹ç›®ç»´æŠ¤ä¸€ä¸ªé”®/å€¼å­˜å‚¨ã€‚\nFlink æ”¯æŒå‡ ç§ä¸åŒç±»å‹çš„ keyed stateï¼Œæœ¬ä¾‹ä½¿ç”¨çš„æ˜¯æœ€ç®€å•çš„ä¸€ç§ï¼Œå³ ValueStateã€‚è¿™æ„å‘³ç€å¯¹äºæ¯ä¸ªé”®ï¼ŒFlink å°†å­˜å‚¨ä¸€ä¸ªå•ä¸€çš„å¯¹è±¡\u0026ndash;åœ¨æœ¬ä¾‹ä¸­ï¼Œä¸€ä¸ªç±»å‹ä¸º Boolean çš„å¯¹è±¡ã€‚\næˆ‘ä»¬çš„ Deduplicator ç±»æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼šopen() å’Œ flatMap()ã€‚open æ–¹æ³•é€šè¿‡å®šä¹‰ä¸€ä¸ª ValueStateDescriptor` æ¥å»ºç«‹å¯¹æ‰˜ç®¡çŠ¶æ€çš„ä½¿ç”¨ã€‚æ„é€ å‡½æ•°çš„å‚æ•°ä¸ºè¿™ä¸ª keyed state é¡¹æŒ‡å®šäº†ä¸€ä¸ªåç§°ï¼ˆ\u0026ldquo;keyHasBeenSeen\u0026rdquo;ï¼‰ï¼Œå¹¶æä¾›äº†å¯ç”¨äºåºåˆ—åŒ–è¿™äº›å¯¹è±¡çš„ä¿¡æ¯ï¼ˆåœ¨æœ¬ä¾‹ä¸­ï¼ŒTypes.BOOLEANï¼‰ã€‚\npublic static class Deduplicator extends RichFlatMapFunction\u0026lt;Event, Event\u0026gt; { ValueState\u0026lt;Boolean\u0026gt; keyHasBeenSeen; @Override public void open(Configuration conf) { ValueStateDescriptor\u0026lt;Boolean\u0026gt; desc = new ValueStateDescriptor\u0026lt;\u0026gt;(\u0026#34;keyHasBeenSeen\u0026#34;, Types.BOOLEAN); keyHasBeenSeen = getRuntimeContext().getState(desc); } @Override public void flatMap(Event event, Collector\u0026lt;Event\u0026gt; out) throws Exception { if (keyHasBeenSeen.value() == null) { out.collect(event); keyHasBeenSeen.update(true); } } } å½“ flatMap æ–¹æ³•è°ƒç”¨ keyHasBeenSeen.value() æ—¶ï¼ŒFlink çš„è¿è¡Œæ—¶ä¼šåœ¨ä¸Šä¸‹æ–‡ä¸­æŸ¥æ‰¾ key çš„è¿™å—çŠ¶æ€å€¼ï¼Œåªæœ‰å½“å®ƒä¸º null æ—¶ï¼Œå®ƒæ‰ä¼šå»æ”¶é›†äº‹ä»¶åˆ°è¾“å‡ºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒè¿˜ä¼šå°† keyHasBeenSeen æ›´æ–°ä¸º trueã€‚\nè¿™ç§è®¿é—®å’Œæ›´æ–° key-partitioned çŠ¶æ€çš„æœºåˆ¶å¯èƒ½çœ‹èµ·æ¥ç›¸å½“ç¥å¥‡ï¼Œå› ä¸ºåœ¨æˆ‘ä»¬çš„ Deduplicator çš„å®ç°ä¸­ï¼Œkey å¹¶ä¸æ˜¯æ˜¾å¼å¯è§çš„ã€‚å½“ Flink çš„è¿è¡Œæ—¶è°ƒç”¨æˆ‘ä»¬çš„ RichFlatMapFunction çš„ open æ–¹æ³•æ—¶ï¼Œæ²¡æœ‰ä»»ä½•äº‹ä»¶ï¼Œå› æ­¤é‚£ä¸€åˆ»ä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰ keyã€‚ä½†æ˜¯å½“å®ƒè°ƒç”¨ flatMap æ–¹æ³•æ—¶ï¼Œè¢«å¤„ç†çš„äº‹ä»¶çš„ key å¯¹è¿è¡Œæ—¶æ¥è¯´æ˜¯å¯ç”¨çš„ï¼Œå¹¶åœ¨å¹•åç”¨äºç¡®å®š Flink çš„çŠ¶æ€åç«¯ä¸­çš„å“ªä¸ªæ¡ç›®è¢«æ“ä½œã€‚\nå½“éƒ¨ç½²åˆ°åˆ†å¸ƒå¼é›†ç¾¤æ—¶ï¼Œä¼šæœ‰å¾ˆå¤šè¿™ä¸ª Deduplicator çš„å®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹å°†è´Ÿè´£æ•´ä¸ªé”®ç©ºé—´çš„ä¸€ä¸ªä¸ç›¸å¹²å­é›†ã€‚å› æ­¤ï¼Œå½“ä½ çœ‹åˆ°ä¸€ä¸ª ValueState çš„å•é¡¹ï¼Œå¦‚:\nValueState\u0026lt;Boolean\u0026gt; keyHasBeenSeen; ç†è§£è¿™ä¸ä»…ä»…æ˜¯ä¸€ä¸ªå•ä¸€çš„å¸ƒå°”å€¼ï¼Œè€Œæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼çš„ã€åˆ†ç‰‡å¼çš„ã€é”®/å€¼å­˜å‚¨ã€‚\næ¸…é™¤çŠ¶æ€ ä¸Šé¢çš„ä¾‹å­æœ‰ä¸€ä¸ªæ½œåœ¨çš„é—®é¢˜ã€‚å¦‚æœé”®çš„ç©ºé—´æ˜¯æ— é™åˆ¶çš„ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼ŸFlink æ˜¯åœ¨æŸä¸ªåœ°æ–¹ä¸ºæ¯ä¸€ä¸ªè¢«ä½¿ç”¨çš„ä¸åŒé”®å­˜å‚¨ä¸€ä¸ªå¸ƒå°”çš„å®ä¾‹ã€‚å¦‚æœæœ‰ä¸€ä¸ªæœ‰ç•Œçš„é”®é›†ï¼Œé‚£ä¹ˆè¿™å°†æ˜¯å¾ˆå¥½çš„ï¼Œä½†æ˜¯åœ¨é”®é›†ä»¥æ— ç•Œçš„æ–¹å¼å¢é•¿çš„åº”ç”¨ä¸­ï¼Œæœ‰å¿…è¦ä¸ºä¸å†éœ€è¦çš„é”®æ¸…é™¤çŠ¶æ€ã€‚è¿™æ˜¯é€šè¿‡è°ƒç”¨çŠ¶æ€å¯¹è±¡ä¸Šçš„ clear() æ¥å®ç°çš„ï¼Œå¦‚:\nkeyHasBeenSeen.clear() ä¾‹å¦‚ï¼Œä½ å¯èƒ½æƒ³åœ¨ç»™å®šé”®çš„ä¸€æ®µæ—¶é—´ä¸æ´»åŠ¨åè¿™æ ·åšã€‚å½“ä½ åœ¨äº‹ä»¶é©±åŠ¨çš„åº”ç”¨ç¨‹åºä¸€èŠ‚ä¸­å­¦ä¹  ProcessFunction æ—¶ï¼Œä½ å°†çœ‹åˆ°å¦‚ä½•ä½¿ç”¨ Timer æ¥å®ç°è¿™ä¸€ç‚¹ã€‚\næ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªçŠ¶æ€å­˜æ´»æ—¶é—´(TTL)é€‰é¡¹ï¼Œä½ å¯ä»¥ç”¨çŠ¶æ€æè¿°ç¬¦æ¥é…ç½®ï¼ŒæŒ‡å®šä»€ä¹ˆæ—¶å€™è‡ªåŠ¨æ¸…é™¤é™ˆæ—§é”®çš„çŠ¶æ€ã€‚\nNon-keyed State ä¹Ÿå¯ä»¥åœ¨ non-keyed çš„ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨æ‰˜ç®¡çŠ¶æ€ã€‚è¿™æœ‰æ—¶è¢«ç§°ä¸º operator stateã€‚æ‰€æ¶‰åŠçš„æ¥å£æœ‰äº›ä¸åŒï¼Œç”±äºç”¨æˆ·å®šä¹‰çš„å‡½æ•°éœ€è¦ non-keyed state æ˜¯ä¸å¸¸è§çš„ï¼Œæ‰€ä»¥è¿™é‡Œä¸åšä»‹ç»ã€‚è¿™ä¸ªåŠŸèƒ½æœ€å¸¸ç”¨äºæºå’Œæ¥æ”¶å™¨(sink)çš„å®ç°ã€‚\nConnected Streams æœ‰æ—¶ä¸æ˜¯åº”ç”¨è¿™æ ·çš„é¢„å®šä¹‰å˜æ¢:\nä½ å¸Œæœ›èƒ½å¤ŸåŠ¨æ€åœ°æ”¹å˜å˜æ¢çš„æŸäº›æ–¹é¢\u0026ndash;é€šè¿‡æµçš„é˜ˆå€¼ï¼Œæˆ–è§„åˆ™ï¼Œæˆ–å…¶ä»–å‚æ•°ã€‚Flink ä¸­æ”¯æŒè¿™ç§æ¨¡å¼çš„æ˜¯ä¸€ç§å«åšè¿æ¥æµ(connected streams)çš„ä¸œè¥¿ï¼Œå…¶ä¸­ä¸€ä¸ª operator æœ‰ä¸¤ä¸ªè¾“å…¥æµï¼Œå°±åƒè¿™æ ·:\nè¿æ¥æµä¹Ÿå¯ä»¥ç”¨æ¥å®ç°æµå¼è¿æ¥(streaming joins.)ã€‚\nä¾‹å­ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ§åˆ¶æµè¢«ç”¨æ¥æŒ‡å®šå¿…é¡»ä» streamOfWords ä¸­è¿‡æ»¤æ‰çš„å•è¯ã€‚ä¸€ä¸ªåä¸º ControlFunction çš„ RichCoFlatMapFunction è¢«åº”ç”¨åˆ°è¿æ¥çš„æµä¸­æ¥å®Œæˆè¿™ä¸ªä»»åŠ¡ã€‚\npublic static void main(String[] args) throws Exception { StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); DataStream\u0026lt;String\u0026gt; control = env.fromElements(\u0026#34;DROP\u0026#34;, \u0026#34;IGNORE\u0026#34;).keyBy(x -\u0026gt; x); DataStream\u0026lt;String\u0026gt; streamOfWords = env.fromElements(\u0026#34;Apache\u0026#34;, \u0026#34;DROP\u0026#34;, \u0026#34;Flink\u0026#34;, \u0026#34;IGNORE\u0026#34;).keyBy(x -\u0026gt; x); control .connect(datastreamOfWords) .flatMap(new ControlFunction()) .print(); env.execute(); } æ³¨æ„ï¼Œè¢«è¿æ¥çš„ä¸¤ä¸ªæµå¿…é¡»ä»¥å…¼å®¹çš„æ–¹å¼è¿›è¡Œ keyedã€‚keyBy çš„ä½œç”¨æ˜¯å¯¹æµçš„æ•°æ®è¿›è¡Œåˆ†åŒºï¼Œå½“ keyed æµè¿æ¥æ—¶ï¼Œå¿…é¡»ä»¥åŒæ ·çš„æ–¹å¼è¿›è¡Œåˆ†åŒºã€‚è¿™æ ·å°±å¯ä»¥ä¿è¯ä¸¤ä¸ªæµä¸­å…·æœ‰ç›¸åŒ key çš„äº‹ä»¶éƒ½ä¼šè¢«å‘é€åˆ°åŒä¸€ä¸ªå®ä¾‹ä¸­ã€‚é‚£ä¹ˆï¼Œè¿™å°±ä½¿å¾—å°†è¯¥é”®ä¸Šçš„ä¸¤ä¸ªæµè¿æ¥èµ·æ¥æˆä¸ºå¯èƒ½ï¼Œä¾‹å¦‚ã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸¤ä¸ªæµçš„ç±»å‹éƒ½æ˜¯ DataStream[String]ï¼Œå¹¶ä¸”ä¸¤ä¸ªæµéƒ½ä»¥å­—ç¬¦ä¸²ä¸ºé”®ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œè¿™ä¸ª RichCoFlatMapFunction åœ¨ keyed state ä¸‹å­˜å‚¨äº†ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè€Œè¿™ä¸ªå¸ƒå°”å€¼æ˜¯ç”±ä¸¤ä¸ªæµå…±äº«çš„ã€‚\npublic static class ControlFunction extends RichCoFlatMapFunction\u0026lt;String, String, String\u0026gt; { private ValueState\u0026lt;Boolean\u0026gt; blocked; @Override public void open(Configuration config) { blocked = getRuntimeContext().getState(new ValueStateDescriptor\u0026lt;\u0026gt;(\u0026#34;blocked\u0026#34;, Boolean.class)); } @Override public void flatMap1(String control_value, Collector\u0026lt;String\u0026gt; out) throws Exception { blocked.update(Boolean.TRUE); } @Override public void flatMap2(String data_value, Collector\u0026lt;String\u0026gt; out) throws Exception { if (blocked.value() == null) { out.collect(data_value); } } } RichCoFlatMapFunction æ˜¯ FlatMapFunction çš„ä¸€ç§ï¼Œå®ƒå¯ä»¥åº”ç”¨äºä¸€å¯¹è¿æ¥çš„æµï¼Œå¹¶ä¸”å®ƒå¯ä»¥è®¿é—®å¯Œå‡½æ•°æ¥å£ã€‚è¿™æ„å‘³ç€å®ƒå¯ä»¥è¢«åšæˆæœ‰çŠ¶æ€çš„ã€‚\nå±è”½çš„(blocked)å¸ƒå°”æ­£åœ¨è¢«ç”¨æ¥è®°ä½æ§åˆ¶æµä¸Šæåˆ°çš„é”®ï¼ˆåœ¨è¿™é‡Œæ˜¯å•è¯ï¼‰ï¼Œè¿™äº›è¯è¢«è¿‡æ»¤å‡º streamOfWords æµã€‚è¿™å°±æ˜¯ keyed stateï¼Œå®ƒåœ¨ä¸¤ä¸ªæµä¹‹é—´æ˜¯å…±äº«çš„ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¸¤ä¸ªæµè¦å…±äº«åŒä¸€ä¸ªé”®ç©ºé—´ã€‚\nflatMap1 å’Œ flatMap2 è¢« Flink è¿è¡Œæ—¶è°ƒç”¨ï¼Œåˆ†åˆ«æ¥è‡ªä¸¤ä¸ªè¿æ¥æµçš„å…ƒç´ \u0026ndash;åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæ¥è‡ªæ§åˆ¶æµçš„å…ƒç´ è¢«ä¼ å…¥ flatMap1ï¼Œæ¥è‡ª streamOfWords çš„å…ƒç´ è¢«ä¼ å…¥ flatMap2ã€‚è¿™æ˜¯ç”±ä½¿ç”¨ control.connect(datastreamOfWords) è¿æ¥ä¸¤ä¸ªæµçš„é¡ºåºå†³å®šçš„ã€‚\né‡è¦çš„æ˜¯è¦è®¤è¯†åˆ°ï¼Œä½ æ— æ³•æ§åˆ¶è°ƒç”¨ flatMap1 å’Œ flatMap2 å›è°ƒçš„é¡ºåºã€‚è¿™ä¸¤ä¸ªè¾“å…¥æµåœ¨ç›¸äº’ç«äº‰ï¼ŒFlink è¿è¡Œæ—¶å°†å¯¹æ¥è‡ªä¸€ä¸ªæµæˆ–å¦ä¸€ä¸ªæµçš„äº‹ä»¶çš„æ¶ˆè€—åšå®ƒæƒ³åšçš„äº‹ã€‚åœ¨æ—¶é—´å’Œ/æˆ–é¡ºåºå¾ˆé‡è¦çš„æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½ä¼šå‘ç°æœ‰å¿…è¦åœ¨æ‰˜ç®¡çš„ Flink çŠ¶æ€ä¸‹ç¼“å†²äº‹ä»¶ï¼Œç›´åˆ°ä½ çš„åº”ç”¨ç¨‹åºå‡†å¤‡å¥½å¤„ç†å®ƒä»¬ã€‚(æ³¨æ„ï¼šå¦‚æœä½ çœŸçš„å¾ˆç»æœ›ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨å®ç° InputSelectable æ¥å£çš„è‡ªå®šä¹‰ Operator æ¥å¯¹åŒè¾“å…¥ operator æ¶ˆè€—è¾“å…¥çš„é¡ºåºè¿›è¡Œä¸€äº›æœ‰é™çš„æ§åˆ¶ã€‚)\nå®è·µ ä¸æœ¬èŠ‚é…å¥—çš„å®è·µç»ƒä¹ æ˜¯\u0026ldquo;ä¹˜è½¦ä¸ç¥¨ä»·ç»ƒä¹ \u0026rdquo;ã€‚\nè¿›ä¸€æ­¥é˜…è¯»  æ•°æ®æµè½¬æ¢ æœ‰çŠ¶æ€çš„æµå¤„ç†  ","permalink":"https://ohmyweekly.github.io/notes/2020-08-19-data-pipelines-and-etl/","tags":["Flink","Training"],"title":"æ•°æ®ç®¡é“å’Œ ETL"},{"categories":["programming"],"contents":"Event Time å’Œ Watermarks ä»‹ç» Flink æ˜ç¡®æ”¯æŒä¸‰ç§ä¸åŒçš„æ—¶é—´æ¦‚å¿µã€‚\näº‹ä»¶æ—¶é—´ï¼šäº‹ä»¶å‘ç”Ÿçš„æ—¶é—´ï¼Œç”±äº§ç”Ÿï¼ˆæˆ–å­˜å‚¨ï¼‰è¯¥äº‹ä»¶çš„è®¾å¤‡è®°å½•çš„æ—¶é—´\næ‘„å–æ—¶é—´ï¼šFlink åœ¨æ‘„å–äº‹ä»¶æ—¶è®°å½•çš„æ—¶é—´æˆ³ã€‚\nå¤„ç†æ—¶é—´ï¼šæ‚¨çš„ç®¡é“ä¸­çš„ç‰¹å®š operator å¤„ç†äº‹ä»¶çš„æ—¶é—´ã€‚\nä¸ºäº†è·å¾—å¯é‡å¤çš„ç»“æœï¼Œä¾‹å¦‚ï¼Œåœ¨è®¡ç®—æŸä¸€å¤©è‚¡ç¥¨åœ¨äº¤æ˜“çš„ç¬¬ä¸€ä¸ªå°æ—¶å†…è¾¾åˆ°çš„æœ€é«˜ä»·æ ¼æ—¶ï¼Œæ‚¨åº”è¯¥ä½¿ç”¨äº‹ä»¶æ—¶é—´(event time)ã€‚è¿™æ ·ä¸€æ¥ï¼Œç»“æœå°±ä¸ä¼šä¾èµ–äºè®¡ç®—çš„æ—¶é—´ã€‚è¿™ç§å®æ—¶åº”ç”¨æœ‰æ—¶ä¼šä½¿ç”¨å¤„ç†æ—¶é—´(processing time)ï¼Œä½†è¿™æ ·ä¸€æ¥ï¼Œç»“æœå°±ä¼šç”±è¯¥å°æ—¶å†…æ°å¥½å¤„ç†çš„äº‹ä»¶å†³å®šï¼Œè€Œä¸æ˜¯ç”±å½“æ—¶å‘ç”Ÿçš„äº‹ä»¶å†³å®šã€‚åŸºäºå¤„ç†æ—¶é—´çš„è®¡ç®—åˆ†æä¼šå¯¼è‡´ä¸ä¸€è‡´ï¼Œå¹¶ä½¿é‡æ–°åˆ†æå†å²æ•°æ®æˆ–æµ‹è¯•æ–°çš„å®ç°å˜å¾—å›°éš¾ã€‚\nä½¿ç”¨äº‹ä»¶æ—¶é—´ é»˜è®¤æƒ…å†µä¸‹ï¼ŒFlink å°†ä½¿ç”¨å¤„ç†æ—¶é—´(processing time)ã€‚è¦æ”¹å˜è¿™ä¸€ç‚¹ï¼Œæ‚¨å¯ä»¥è®¾ç½®æ—¶é—´ç‰¹æ€§(Time Characteristic)ã€‚\nfinal StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment(); env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime); å¦‚æœä½ æƒ³ä½¿ç”¨äº‹ä»¶æ—¶é—´ï¼Œä½ è¿˜éœ€è¦æä¾›ä¸€ä¸ªæ—¶é—´æˆ³æå–å™¨å’Œæ°´å°ç”Ÿæˆå™¨ï¼ŒFlink å°†ä½¿ç”¨å®ƒä»¬æ¥è·Ÿè¸ªäº‹ä»¶æ—¶é—´çš„è¿›å±•ã€‚è¿™å°†åœ¨ä¸‹é¢çš„\u0026ldquo;ä½¿ç”¨æ°´å°\u0026rdquo;ä¸€èŠ‚ä¸­ä»‹ç»ï¼Œä½†é¦–å…ˆæˆ‘ä»¬åº”è¯¥è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯æ°´å°ã€‚\næ°´å° è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥è¯´æ˜ä¸ºä»€ä¹ˆéœ€è¦æ°´å°ï¼Œä»¥åŠå®ƒä»¬æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ æœ‰ä¸€ä¸ªå¸¦æ—¶é—´æˆ³çš„äº‹ä»¶æµï¼Œè¿™äº›äº‹ä»¶çš„åˆ°è¾¾é¡ºåºæœ‰äº›æ··ä¹±ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚æ˜¾ç¤ºçš„æ•°å­—æ˜¯æ—¶é—´æˆ³ï¼Œè¡¨ç¤ºè¿™äº›äº‹ä»¶å®é™…å‘ç”Ÿçš„æ—¶é—´ã€‚ç¬¬ä¸€ä¸ªåˆ°è¾¾çš„äº‹ä»¶å‘ç”Ÿåœ¨æ—¶é—´ 4ï¼Œéšåæ˜¯æ›´æ—©å‘ç”Ÿçš„äº‹ä»¶ï¼Œåœ¨æ—¶é—´ 2ï¼Œä»¥æ­¤ç±»æ¨ã€‚\nÂ·Â·Â· 23 19 22 24 21 14 17 13 12 15 9 11 7 2 4 â†’ ç°åœ¨æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨å°è¯•åˆ›å»ºä¸€ä¸ªæµæ’åºå™¨(stream sorter)ã€‚è¿™ä¸ªåº”ç”¨ç¨‹åºçš„ç›®çš„æ˜¯å¤„ç†æµä¸­çš„æ¯ä¸ªäº‹ä»¶ï¼Œå¹¶å‘å‡ºä¸€ä¸ªæ–°çš„æµï¼Œå…¶ä¸­åŒ…å«ç›¸åŒçš„äº‹ä»¶ï¼Œä½†æŒ‰æ—¶é—´æˆ³æ’åºã€‚\nä¸€äº›è§‚å¯Ÿ:\n(1)ä½ çš„æµæ’åºå™¨çœ‹åˆ°çš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯ 4ï¼Œ ä½†ä½ ä¸èƒ½é©¬ä¸ŠæŠŠå®ƒä½œä¸ºæ’åºæµçš„ç¬¬ä¸€ä¸ªå…ƒç´ é‡Šæ”¾å‡ºæ¥ã€‚å®ƒå¯èƒ½å·²ç»ä¸æŒ‰é¡ºåºåˆ°è¾¾ï¼Œè€Œæ›´æ—©çš„äº‹ä»¶å¯èƒ½è¿˜æ²¡æœ‰åˆ°è¾¾ã€‚äº‹å®ä¸Šï¼Œä½ å¯¹è¿™ä¸ªæµçš„æœªæ¥æœ‰ä¸€äº›ç¥ä¸€æ ·çš„çŸ¥è¯†ï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼Œä½ çš„æµæ’åºå™¨è‡³å°‘åº”è¯¥ç­‰åˆ° 2 åˆ°è¾¾åå†äº§ç”Ÿä»»ä½•ç»“æœã€‚\nä¸€äº›ç¼“å†²ï¼Œå’Œä¸€äº›å»¶è¿Ÿï¼Œæ˜¯å¿…è¦çš„ã€‚\n(2)å¦‚æœä½ åšé”™äº†ï¼Œä½ å¯èƒ½æœ€ç»ˆä¼šæ°¸è¿œç­‰å¾…ã€‚é¦–å…ˆï¼Œæ’åºå™¨çœ‹åˆ°äº†ä¸€ä¸ªæ¥è‡ªæ—¶é—´ 4 çš„äº‹ä»¶ï¼Œç„¶åæ˜¯ä¸€ä¸ªæ¥è‡ªæ—¶é—´ 2 çš„äº‹ä»¶ã€‚ä¸€ä¸ªæ—¶é—´æˆ³å°äº 2 çš„äº‹ä»¶ä¼šä¸ä¼šæ°¸è¿œåˆ°è¾¾ï¼Ÿä¹Ÿè®¸ä¼šï¼Œä¹Ÿè®¸ä¸ä¼šã€‚ä¹Ÿè®¸ä¸ä¼šã€‚ä½ å¯ä»¥æ°¸è¿œç­‰å¾…ï¼Œæ°¸è¿œçœ‹ä¸åˆ° 1ã€‚\næœ€ç»ˆä½ å¿…é¡»é¼“èµ·å‹‡æ°”ï¼Œå‘å‡º 2 ä½œä¸ºæ’åºæµçš„å¼€å§‹ã€‚\n(3)é‚£ä¹ˆä½ éœ€è¦çš„æ˜¯æŸç§ç­–ç•¥ï¼Œå®ƒå®šä¹‰äº†å¯¹äºä»»ä½•ç»™å®šçš„æ—¶é—´æˆ³äº‹ä»¶ï¼Œä½•æ—¶åœæ­¢ç­‰å¾…æ—©æœŸäº‹ä»¶çš„åˆ°æ¥ã€‚\nè¿™æ­£æ˜¯æ°´å°çš„ä½œç”¨\u0026ndash;å®ƒä»¬å®šä¹‰äº†ä½•æ—¶åœæ­¢ç­‰å¾…æ—©æœŸ(earlier)äº‹ä»¶ã€‚\nFlink ä¸­çš„äº‹ä»¶æ—¶é—´å¤„ç†ä¾èµ–äºæ°´å°ç”Ÿæˆå™¨ï¼Œè¿™äº›æ°´å°ç”Ÿæˆå™¨å°†ç‰¹æ®Šçš„æ—¶é—´æˆ³å…ƒç´ æ’å…¥åˆ°æµä¸­ï¼Œç§°ä¸ºæ°´å°ã€‚æ—¶é—´ t çš„æ°´å°æ˜¯ä¸€ç§æ–­è¨€ï¼Œå³åˆ°æ—¶é—´ t ä¸ºæ­¢ï¼Œæµç°åœ¨ï¼ˆå¯èƒ½ï¼‰æ˜¯å®Œæ•´çš„ã€‚\nè¿™ä¸ªæµæ’åºå™¨åº”è¯¥åœ¨ä»€ä¹ˆæ—¶å€™åœæ­¢ç­‰å¾…ï¼Œå¹¶æ¨å‡º2å¼€å§‹æ’åºæµï¼Ÿå½“ä¸€ä¸ªæ—¶é—´æˆ³ä¸º 2ï¼Œæˆ–æ›´å¤§çš„æ°´å°åˆ°è¾¾æ—¶ã€‚\n(4)ä½ å¯ä»¥æƒ³è±¡ä¸åŒçš„ç­–ç•¥æ¥å†³å®šå¦‚ä½•ç”Ÿæˆæ°´å°ã€‚\næ¯ä¸€ä¸ªäº‹ä»¶éƒ½æ˜¯åœ¨ä¸€äº›å»¶è¿Ÿä¹‹ååˆ°è¾¾çš„ï¼Œè€Œè¿™äº›å»¶è¿Ÿæ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥ä¸€äº›äº‹ä»¶çš„å»¶è¿Ÿæ¯”å…¶ä»–äº‹ä»¶æ›´å¤šã€‚ä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯å‡è®¾è¿™äº›å»¶è¿Ÿè¢«æŸä¸ªæœ€å¤§å»¶è¿Ÿæ‰€çº¦æŸã€‚Flink å°†è¿™ç§ç­–ç•¥ç§°ä¸ºæœ‰ç•Œæ— åºæ°´å°ã€‚å¾ˆå®¹æ˜“æƒ³è±¡æ›´å¤æ‚çš„æ°´å°æ–¹æ³•ï¼Œä½†å¯¹äºå¤§å¤šæ•°åº”ç”¨æ¥è¯´ï¼Œå›ºå®šçš„å»¶è¿Ÿå·²ç»è¶³å¤Ÿå¥½äº†ã€‚\nå»¶è¿Ÿä¸å®Œæ•´æ€§ å…³äºæ°´å°çš„å¦ä¸€ç§æ€è€ƒæ–¹å¼æ˜¯ï¼Œæ°´å°è®©ä½ è¿™ä¸ªæµå¼åº”ç”¨çš„å¼€å‘è€…èƒ½å¤Ÿæ§åˆ¶å»¶è¿Ÿå’Œå®Œæ•´æ€§ä¹‹é—´çš„æƒè¡¡ã€‚ä¸æ‰¹å¤„ç†ä¸åŒçš„æ˜¯ï¼Œåœ¨æ‰¹å¤„ç†ä¸­ï¼Œäººä»¬å¯ä»¥åœ¨äº§ç”Ÿä»»ä½•ç»“æœä¹‹å‰å®Œå…¨äº†è§£è¾“å…¥ï¼Œè€Œåœ¨æµå¼å¤„ç†ä¸­ï¼Œä½ æœ€ç»ˆå¿…é¡»åœæ­¢ç­‰å¾…çœ‹åˆ°æ›´å¤šçš„è¾“å…¥ï¼Œå¹¶äº§ç”ŸæŸç§ç»“æœã€‚\nä½ å¯ä»¥ç§¯æåœ°é…ç½®ä½ çš„æ°´å°ï¼Œç”¨ä¸€ä¸ªå¾ˆçŸ­çš„å»¶è¿Ÿï¼Œä»è€Œæ‰¿æ‹…åœ¨å¯¹è¾“å…¥ä¸å®Œå…¨äº†è§£çš„æƒ…å†µä¸‹äº§ç”Ÿç»“æœçš„é£é™©\u0026ndash;ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªå¯èƒ½æ˜¯é”™è¯¯çš„ç»“æœï¼Œå¾ˆå¿«å°±äº§ç”Ÿäº†ã€‚æˆ–è€…ä½ å¯ä»¥ç­‰å¾…æ›´é•¿æ—¶é—´ï¼Œå¹¶åˆ©ç”¨å¯¹è¾“å…¥æµæ›´å®Œæ•´çš„çŸ¥è¯†äº§ç”Ÿç»“æœã€‚\nä¹Ÿå¯ä»¥å®ç°æ··åˆè§£å†³æ–¹æ¡ˆï¼Œå¿«é€Ÿç”Ÿæˆåˆå§‹ç»“æœï¼Œç„¶ååœ¨å¤„ç†é¢å¤–ï¼ˆåæœŸï¼‰æ•°æ®æ—¶å¯¹è¿™äº›ç»“æœè¿›è¡Œæ›´æ–°ã€‚å¯¹äºæŸäº›åº”ç”¨æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ç§å¾ˆå¥½çš„æ–¹æ³•ã€‚\nå»¶è¿Ÿ è¿Ÿåˆ°çš„å®šä¹‰æ˜¯ç›¸å¯¹äºæ°´å°è€Œè¨€çš„ã€‚æ°´å°(t)å£°æ˜æµåœ¨æ—¶é—´tä¹‹å‰æ˜¯å®Œæ•´çš„ï¼›åœ¨è¿™ä¸ªæ°´å°ä¹‹åçš„ä»»ä½•äº‹ä»¶ï¼Œå¦‚æœæ—¶é—´æˆ³ â‰¤tï¼Œåˆ™ä¸ºå»¶è¿Ÿã€‚\nä½¿ç”¨æ°´å° ä¸ºäº†æ‰§è¡ŒåŸºäºäº‹ä»¶æ—¶é—´çš„äº‹ä»¶å¤„ç†ï¼ŒFlink éœ€è¦çŸ¥é“ä¸æ¯ä¸ªäº‹ä»¶ç›¸å…³è”çš„æ—¶é—´ï¼Œè¿˜éœ€è¦æµåŒ…å«æ°´å°ã€‚\nå®è·µç»ƒä¹ ä¸­ä½¿ç”¨çš„ Taxi æ•°æ®æºä¸ºä½ å¤„ç†äº†è¿™äº›ç»†èŠ‚ã€‚ä½†åœ¨ä½ è‡ªå·±çš„åº”ç”¨ç¨‹åºä¸­ï¼Œä½ å¿…é¡»è‡ªå·±å¤„ç†è¿™äº›äº‹æƒ…ï¼Œé€šå¸¸æ˜¯é€šè¿‡å®ç°ä¸€ä¸ªç±»æ¥å®ç°ï¼Œè¯¥ç±»ä»äº‹ä»¶ä¸­æå–æ—¶é—´æˆ³ï¼Œå¹¶æŒ‰éœ€ç”Ÿæˆæ°´å°ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨ WatermarkStrategy:\nDataStream\u0026lt;Event\u0026gt; stream = ... WatermarkStrategy\u0026lt;Event\u0026gt; strategy = WatermarkStrategy .\u0026lt;Event\u0026gt;forBoundedOutOfOrderness(Duration.ofSeconds(20)) .withTimestampAssigner((event, timestamp) -\u0026gt; event.timestamp); DataStream\u0026lt;Event\u0026gt; withTimestampsAndWatermarks = stream.assignTimestampsAndWatermarks(strategy); çª—å£ Flink å…·æœ‰éå¸¸æœ‰è¡¨ç°åŠ›çš„çª—å£è¯­ä¹‰ã€‚\nåœ¨æœ¬èŠ‚ä¸­ï¼Œä½ å°†å­¦ä¹ \n å¦‚ä½•ä½¿ç”¨çª—å£æ¥è®¡ç®—æ— è¾¹ç•Œæµçš„èšåˆã€‚ Flink æ”¯æŒå“ªäº›ç±»å‹çš„çª—å£ï¼Œä»¥åŠ å¦‚ä½•å®ç°ä¸€ä¸ªçª—å£åŒ–èšåˆçš„ DataStream ç¨‹åºï¼Ÿ  ä»‹ç» åœ¨åšæµå¤„ç†çš„æ—¶å€™ï¼Œè‡ªç„¶è€Œç„¶åœ°æƒ³è¦è®¡ç®—æµçš„æœ‰ç•Œå­é›†çš„èšåˆåˆ†æï¼Œä»¥å›ç­”è¿™æ ·çš„é—®é¢˜ã€‚\n æ¯åˆ†é’Ÿçš„é¡µé¢æµè§ˆé‡ æ¯ä¸ªç”¨æˆ·æ¯å‘¨ä¼šè¯æ•° æ¯ä¸ªä¼ æ„Ÿå™¨æ¯åˆ†é’Ÿçš„æœ€é«˜æ¸©åº¦  ç”¨ Flink è®¡ç®—çª—å£åŒ–åˆ†æä¾èµ–äºä¸¤ä¸ªä¸»è¦çš„æŠ½è±¡ã€‚çª—å£åˆ†é…å™¨ï¼ˆWindow Assignersï¼‰å°†äº‹ä»¶åˆ†é…ç»™çª—å£ï¼ˆå¿…è¦æ—¶åˆ›å»ºæ–°çš„çª—å£å¯¹è±¡ï¼‰ï¼Œçª—å£å‡½æ•°ï¼ˆWindow Functionsï¼‰åº”ç”¨äºåˆ†é…ç»™çª—å£çš„äº‹ä»¶ã€‚\nFlink çš„çª—å£ API è¿˜æœ‰ Triggers çš„æ¦‚å¿µï¼Œå®ƒå†³å®šä»€ä¹ˆæ—¶å€™è°ƒç”¨çª—å£å‡½æ•°ï¼Œè¿˜æœ‰ Evictorsï¼Œå®ƒå¯ä»¥åˆ é™¤çª—å£ä¸­æ”¶é›†çš„å…ƒç´ ã€‚\nåœ¨å®ƒçš„åŸºæœ¬å½¢å¼ä¸­ï¼Œä½ å°†çª—å£åŒ–åº”ç”¨åˆ°åƒè¿™æ ·çš„ keyed stream ä¸­ã€‚\nstream. .keyBy(\u0026lt;key selector\u0026gt;) .window(\u0026lt;window assigner\u0026gt;) .reduce|aggregate|process(\u0026lt;window function\u0026gt;) æ‚¨ä¹Ÿå¯ä»¥å¯¹ non-keyed stream ä½¿ç”¨çª—å£åŒ–ï¼Œä½†è¯·è®°ä½ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¤„ç†å°†ä¸ä¼šå¹¶è¡Œè¿›è¡Œã€‚\nstream. .windowAll(\u0026lt;window assigner\u0026gt;) .reduce|aggregate|process(\u0026lt;window function\u0026gt;) çª—å£åˆ†é…å™¨ Flink æœ‰å‡ ç§å†…ç½®çš„çª—å£åˆ†é…å™¨ç±»å‹ï¼Œä¸‹é¢è¿›è¡Œè¯´æ˜ã€‚\nä¸€äº›ä¾‹å­è¯´æ˜è¿™äº›çª—å£åˆ†é…å™¨çš„ç”¨é€”ï¼Œä»¥åŠå¦‚ä½•æŒ‡å®šå®ƒä»¬:\n  æ»šåŠ¨æ—¶é—´çª—å£\n  æ¯åˆ†é’Ÿæµè§ˆé‡\n  TumblingEventTimeWindows.of(Time.minutes(1))\n  æ»‘åŠ¨æ—¶é—´çª—å£\n  æ¯10ç§’è®¡ç®—çš„æ¯åˆ†é’Ÿé¡µé¢æµè§ˆé‡\n  SlidingEventTimeWindows.of(Time.min(1), Time.seconds(10))\n  ä¼šè¯çª—å£\n  æ¯èŠ‚è¯¾çš„é¡µé¢æµè§ˆé‡ï¼Œå…¶ä¸­æ¯èŠ‚è¯¾ä¹‹é—´è‡³å°‘æœ‰30åˆ†é’Ÿçš„é—´éš”ã€‚\n  EventTimeSessionWindows.withGap(Time.minutes(30))\n  å¯ä»¥ä½¿ç”¨ Time.milliseconds(n), Time.seconds(n), Time.minutes(n), Time.hours(n), å’Œ Time.days(n) ä¸­çš„ä¸€ç§æŒ‡å®šæŒç»­æ—¶é—´ã€‚\nåŸºäºæ—¶é—´çš„çª—å£åˆ†é…å™¨ï¼ˆåŒ…æ‹¬ä¼šè¯çª—å£ï¼‰æœ‰äº‹ä»¶æ—¶é—´(event time)å’Œå¤„ç†æ—¶é—´(processing time)ä¸¤ç§é£å‘³ã€‚è¿™ä¸¤ç§ç±»å‹çš„æ—¶é—´çª—å£ä¹‹é—´æœ‰æ˜¾è‘—çš„æƒè¡¡ã€‚å¯¹äºå¤„ç†æ—¶é—´çª—å£ï¼Œä½ å¿…é¡»æ¥å—è¿™äº›é™åˆ¶:\n ä¸èƒ½æ­£ç¡®å¤„ç†å†å²æ•°æ®ã€‚ ä¸èƒ½æ­£ç¡®å¤„ç†å¤±åºæ•°æ®ã€‚ ç»“æœå°†æ˜¯éç¡®å®šæ€§çš„ã€‚  ä½†å…·æœ‰è¾ƒä½å»¶è¿Ÿçš„ä¼˜åŠ¿ã€‚\nå½“ä½¿ç”¨åŸºäºè®¡æ•°çš„çª—å£æ—¶ï¼Œè¯·è®°ä½ï¼Œè¿™äº›çª—å£å°†ä¸ä¼šå¯åŠ¨ï¼Œç›´åˆ°ä¸€ä¸ªæ‰¹æ¬¡å®Œæˆã€‚æ²¡æœ‰è¶…æ—¶å’Œå¤„ç†éƒ¨åˆ†çª—å£çš„é€‰é¡¹ï¼Œå°½ç®¡ä½ å¯ä»¥ç”¨è‡ªå®šä¹‰çš„è§¦å‘å™¨è‡ªå·±å®ç°è¿™ç§è¡Œä¸ºã€‚\nå…¨å±€çª—å£åˆ†é…å™¨å°†æ¯ä¸ªäº‹ä»¶ï¼ˆç”¨ç›¸åŒçš„é”®ï¼‰åˆ†é…åˆ°åŒä¸€ä¸ªå…¨å±€çª—å£ã€‚åªæœ‰å½“ä½ æ‰“ç®—ä½¿ç”¨è‡ªå®šä¹‰è§¦å‘å™¨æ¥åšä½ è‡ªå·±çš„è‡ªå®šä¹‰çª—å£æ—¶ï¼Œè¿™æ‰æ˜¯æœ‰ç”¨çš„ã€‚åœ¨è®¸å¤šçœ‹ä¼¼æœ‰ç”¨çš„æƒ…å†µä¸‹ï¼Œæ‚¨æœ€å¥½ä½¿ç”¨å¦ä¸€èŠ‚ä¸­æè¿°çš„ ProcessFunctionã€‚\nçª—å£å‡½æ•° å¯¹äºå¦‚ä½•å¤„ç†çª—å£çš„å†…å®¹ï¼Œæ‚¨æœ‰ä¸‰ä¸ªåŸºæœ¬é€‰é¡¹ã€‚\n ä½œä¸ºä¸€ä¸ªæ‰¹æ¬¡ï¼Œä½¿ç”¨ä¸€ä¸ª ProcessWindowFunctionï¼Œå®ƒå°†è¢«ä¼ é€’ä¸€ä¸ªåŒ…å«çª—å£å†…å®¹çš„ Iterableã€‚ ä»¥å¢é‡æ–¹å¼ï¼Œä½¿ç”¨ ReduceFunction æˆ– AggregateFunctionï¼Œå½“æ¯ä¸ªäº‹ä»¶è¢«åˆ†é…åˆ°çª—å£æ—¶è¢«è°ƒç”¨ã€‚ æˆ–ä¸¤è€…ç»“åˆï¼Œå½“çª—å£è¢«è§¦å‘æ—¶ï¼ŒReduceFunction æˆ– AggregateFunction çš„é¢„èšé›†ç»“æœè¢«æä¾›ç»™ ProcessWindowFunctionã€‚  è¿™é‡Œæ˜¯æ–¹æ³•1å’Œ3çš„ä¾‹å­ã€‚æ¯ä¸ªå®ç°éƒ½åœ¨1åˆ†é’Ÿçš„äº‹ä»¶æ—¶é—´çª—å£ä¸­ä»æ¯ä¸ªä¼ æ„Ÿå™¨ä¸­æ‰¾åˆ°å³°å€¼å€¼ï¼Œå¹¶äº§ç”Ÿä¸€ä¸ªåŒ…å«(key, end-of-window-timestamp, max_value) çš„ Tuples æµã€‚\nProcessWindowFunction ç¤ºä¾‹ DataStream\u0026lt;SensorReading\u0026gt; input = ... input .keyBy(x -\u0026gt; x.key) .window(TumblingEventTimeWindows.of(Time.minutes(1))) .process(new MyWastefulMax()); public static class MyWastefulMax extends ProcessWindowFunction\u0026lt; SensorReading, // input type  Tuple3\u0026lt;String, Long, Integer\u0026gt;, // output type  String, // key type  TimeWindow\u0026gt; { // window type  @Override public void process( String key, Context context, Iterable\u0026lt;SensorReading\u0026gt; events, Collector\u0026lt;Tuple3\u0026lt;String, Long, Integer\u0026gt;\u0026gt; out) { int max = 0; for (SensorReading event : events) { max = Math.max(event.value, max); } out.collect(Tuple3.of(key, context.window().getEnd(), max)); } } åœ¨è¿™ä¸ªå®ç°ä¸­ï¼Œæœ‰å‡ ä»¶äº‹éœ€è¦æ³¨æ„ã€‚\n æ‰€æœ‰åˆ†é…ç»™çª—å£çš„äº‹ä»¶éƒ½å¿…é¡»åœ¨ keyed Flink state ä¸‹è¢«ç¼“å†²ï¼Œç›´åˆ°çª—å£è¢«è§¦å‘ã€‚è¿™å¯èƒ½æ˜¯ç›¸å½“æ˜‚è´µçš„ã€‚ æˆ‘ä»¬çš„ ProcessWindowFunction è¢«ä¼ é€’äº†ä¸€ä¸ª Context å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«äº†çª—å£çš„ä¿¡æ¯ã€‚å®ƒçš„æ¥å£æ˜¯è¿™æ ·çš„:  public abstract class Context implements java.io.Serializable { public abstract W window(); public abstract long currentProcessingTime(); public abstract long currentWatermark(); public abstract KeyedStateStore windowState(); public abstract KeyedStateStore globalState(); } windowState å’Œ globalState æ˜¯æ‚¨å¯ä»¥å­˜å‚¨è¯¥é”®çš„æ‰€æœ‰çª—å£çš„ per-key, per-window, æˆ–å…¨å±€ per-key ä¿¡æ¯çš„åœ°æ–¹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³è®°å½•ä¸€äº›å…³äºå½“å‰çª—å£çš„ä¿¡æ¯ï¼Œå¹¶åœ¨å¤„ç†åç»­çª—å£æ—¶ä½¿ç”¨è¿™äº›ä¿¡æ¯ï¼Œè¿™å¯èƒ½ä¼šå¾ˆæœ‰ç”¨ã€‚\né€’å¢èšåˆç¤ºä¾‹ DataStream\u0026lt;SensorReading\u0026gt; input = ... input .keyBy(x -\u0026gt; x.key) .window(TumblingEventTimeWindows.of(Time.minutes(1))) .reduce(new MyReducingMax(), new MyWindowFunction()); private static class MyReducingMax implements ReduceFunction\u0026lt;SensorReading\u0026gt; { public SensorReading reduce(SensorReading r1, SensorReading r2) { return r1.value() \u0026gt; r2.value() ? r1 : r2; } } private static class MyWindowFunction extends ProcessWindowFunction\u0026lt; SensorReading, Tuple3\u0026lt;String, Long, SensorReading\u0026gt;, String, TimeWindow\u0026gt; { @Override public void process( String key, Context context, Iterable\u0026lt;SensorReading\u0026gt; maxReading, Collector\u0026lt;Tuple3\u0026lt;String, Long, SensorReading\u0026gt;\u0026gt; out) { SensorReading max = maxReading.iterator().next(); out.collect(Tuple3.of(key, context.window().getEnd(), max)); } } è¯·æ³¨æ„ï¼ŒIterable\u0026lt;SensorReading\u0026gt; å°†åªåŒ…å«ä¸€ä¸ªè¯»æ•°\u0026ndash;ç”± MyReducingMax è®¡ç®—çš„ pre-aggregated æœ€å¤§å€¼ã€‚\nè¿Ÿæ¥çš„äº‹ä»¶ é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ä½¿ç”¨äº‹ä»¶æ—¶é—´çª—å£æ—¶ï¼Œè¿Ÿåˆ°çš„äº‹ä»¶ä¼šè¢«ä¸¢å¼ƒã€‚çª—å£ API æœ‰ä¸¤ä¸ªå¯é€‰éƒ¨åˆ†å¯ä»¥è®©æ‚¨å¯¹æ­¤æœ‰æ›´å¤šçš„æ§åˆ¶ã€‚\næ‚¨å¯ä»¥ä½¿ç”¨åä¸º\u0026ldquo;ä¾§è¾“å‡º\u0026rdquo;çš„æœºåˆ¶ï¼Œå®‰æ’å°†è¢«ä¸¢å¼ƒçš„äº‹ä»¶æ”¶é›†åˆ°ä¸€ä¸ªå¤‡ç”¨çš„è¾“å‡ºæµä¸­ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œè¯´æ˜è¿™å¯èƒ½æ˜¯ä»€ä¹ˆæ ·å­çš„:\nOutputTag\u0026lt;Event\u0026gt; lateTag = new OutputTag\u0026lt;Event\u0026gt;(\u0026#34;late\u0026#34;){}; SingleOutputStreamOperator\u0026lt;Event\u0026gt; result = stream. .keyBy(...) .window(...) .sideOutputLateData(lateTag) .process(...); DataStream\u0026lt;Event\u0026gt; lateStream = result.getSideOutput(lateTag); æ‚¨è¿˜å¯ä»¥æŒ‡å®šå…è®¸çš„å»¶è¿Ÿæ—¶é—´é—´éš”ï¼Œåœ¨æ­¤æœŸé—´ï¼Œå»¶è¿Ÿäº‹ä»¶å°†ç»§ç»­åˆ†é…ç»™ç›¸åº”çš„çª—å£ï¼ˆå…¶çŠ¶æ€å°†è¢«ä¿ç•™ï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå»¶è¿Ÿäº‹ä»¶éƒ½ä¼šå¯¼è‡´çª—å£å‡½æ•°å†æ¬¡è¢«è°ƒç”¨ï¼ˆæœ‰æ—¶ç§°ä¸ºå»¶è¿Ÿå‘å°„ï¼‰ã€‚\næ¢å¥è¯è¯´ï¼Œæ°´å°åé¢çš„å…ƒç´ ä¼šè¢«ä¸¢å¼ƒï¼ˆæˆ–å‘é€åˆ°ä¾§è¾“å‡ºï¼‰ã€‚\næ¯”å¦‚è¯´:\nstream. .keyBy(...) .window(...) .allowedLateness(Time.seconds(10)) .process(...); å½“å…è®¸çš„å»¶è¿Ÿå¤§äºé›¶æ—¶ï¼Œåªæœ‰é‚£äº›æ™šåˆ°ä¼šè¢«ä¸¢å¼ƒçš„äº‹ä»¶æ‰ä¼šè¢«å‘é€åˆ°ä¾§è¾“å‡ºï¼ˆå¦‚æœå·²ç»é…ç½®äº†ï¼‰ã€‚\næƒŠå–œ Flink çš„ windowing API çš„æŸäº›æ–¹é¢å¯èƒ½å¹¶ä¸åƒä½ æ‰€æœŸæœ›çš„é‚£æ ·ã€‚åŸºäº flink ç”¨æˆ·é‚®ä»¶åˆ—è¡¨å’Œå…¶ä»–åœ°æ–¹çš„å¸¸è§é—®é¢˜ï¼Œè¿™é‡Œæœ‰ä¸€äº›å…³äºçª—å£çš„äº‹å®å¯èƒ½ä¼šè®©ä½ æ„Ÿåˆ°æƒŠè®¶ã€‚\næ»‘åŠ¨çª—å£ä¼šè¿›è¡Œå¤åˆ¶ æ»‘åŠ¨çª—å£åˆ†é…å™¨å¯ä»¥åˆ›å»ºå¾ˆå¤šçª—å£å¯¹è±¡ï¼Œå¹¶ä¼šå°†æ¯ä¸ªäº‹ä»¶å¤åˆ¶åˆ°æ¯ä¸ªç›¸å…³çª—å£ä¸­ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æ¯15åˆ†é’Ÿæœ‰ä¸€ä¸ªé•¿åº¦ä¸º24å°æ—¶çš„æ»‘åŠ¨çª—å£ï¼Œæ¯ä¸ªäº‹ä»¶å°†è¢«å¤åˆ¶åˆ° 4*24=96 ä¸ªçª—å£ä¸­ã€‚\næ—¶é—´çª—å£ä¸çºªå…ƒå¯¹é½ ä»…ä»…å› ä¸ºä½ ä½¿ç”¨äº†ä¸€ä¸ªå°æ—¶çš„å¤„ç†æ—¶é—´çª—å£ï¼Œå¹¶ä¸”åœ¨ 12:05 å¼€å§‹è¿è¡Œä½ çš„åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸æ„å‘³ç€ç¬¬ä¸€ä¸ªçª—å£ä¼šåœ¨ 1:05 å…³é—­ã€‚ç¬¬ä¸€ä¸ªçª—å£å°†é•¿è¾¾ 55 åˆ†é’Ÿï¼Œå¹¶åœ¨ 1:00 å…³é—­ã€‚\nä½†æ˜¯è¯·æ³¨æ„ï¼Œæ»šåŠ¨çª—å£å’Œæ»‘åŠ¨çª—å£åˆ†é…å™¨é‡‡ç”¨ä¸€ä¸ªå¯é€‰çš„åç§»å‚æ•°ï¼Œå¯ä»¥ç”¨æ¥æ”¹å˜çª—å£çš„å¯¹é½æ–¹å¼ã€‚è¯¦æƒ…è¯·å‚è§æ»šåŠ¨çª—å£å’Œæ»‘åŠ¨çª—å£ã€‚\nçª—å£å¯ä»¥è·Ÿéšçª—å£ ä¾‹å¦‚ï¼Œè¿™æ ·åšæ˜¯å¯è¡Œçš„:\nstream .keyBy(t -\u0026gt; t.key) .timeWindow(\u0026lt;time specification\u0026gt;) .reduce(\u0026lt;reduce function\u0026gt;) .timeWindowAll(\u0026lt;same time specification\u0026gt;) .reduce(\u0026lt;same reduce function\u0026gt;) ä½ å¯èƒ½ä¼šæœŸæœ› Flink çš„è¿è¡Œæ—¶è¶³å¤Ÿèªæ˜ï¼Œèƒ½å¤Ÿä¸ºä½ åšè¿™ç§å¹¶è¡Œçš„é¢„èšåˆï¼ˆå‰ææ˜¯ä½ ä½¿ç”¨çš„æ˜¯ ReduceFunction æˆ– AggregateFunctionï¼‰ï¼Œä½†äº‹å®å¹¶éå¦‚æ­¤ã€‚\nä¹‹æ‰€ä»¥è¿™æ ·åšçš„åŸå› æ˜¯ï¼Œä¸€ä¸ªæ—¶é—´çª—å£äº§ç”Ÿçš„äº‹ä»¶ä¼šæ ¹æ®çª—å£ç»“æŸçš„æ—¶é—´åˆ†é…æ—¶é—´æˆ³ã€‚æ‰€ä»¥ï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªå°æ—¶é•¿çš„çª—å£äº§ç”Ÿçš„æ‰€æœ‰äº‹ä»¶éƒ½ä¼šæœ‰æ ‡è®°ä¸€ä¸ªå°æ—¶ç»“æŸçš„æ—¶é—´æˆ³ã€‚ä»»ä½•æ¶ˆè€—è¿™äº›äº‹ä»¶çš„åç»­çª—å£çš„æŒç»­æ—¶é—´åº”è¯¥ä¸å‰ä¸€ä¸ªçª—å£çš„æŒç»­æ—¶é—´ç›¸åŒï¼Œæˆ–è€…æ˜¯å…¶å€æ•°ã€‚\nç©ºçš„æ—¶é—´çª—å£æ²¡æœ‰ç»“æœ åªæœ‰å½“äº‹ä»¶è¢«åˆ†é…åˆ°çª—å£æ—¶ï¼Œæ‰ä¼šåˆ›å»ºçª—å£ã€‚å› æ­¤ï¼Œå¦‚æœåœ¨ç»™å®šçš„æ—¶é—´å¸§å†…æ²¡æœ‰äº‹ä»¶ï¼Œå°±ä¸ä¼šæŠ¥å‘Šç»“æœã€‚\nè¿Ÿæ¥çš„äº‹ä»¶ä¼šå¯¼è‡´è¿Ÿæ¥çš„åˆå¹¶ ä¼šè¯çª—å£æ˜¯åŸºäºå¯ä»¥åˆå¹¶çš„çª—å£çš„æŠ½è±¡ã€‚æ¯ä¸ªå…ƒç´ æœ€åˆéƒ½è¢«åˆ†é…åˆ°ä¸€ä¸ªæ–°çš„çª—å£ï¼Œä¹‹ååªè¦çª—å£ä¹‹é—´çš„é—´éš™è¶³å¤Ÿå°ï¼Œå°±ä¼šåˆå¹¶ã€‚è¿™æ ·ä¸€æ¥ï¼Œä¸€ä¸ªè¿Ÿåˆ°çš„äº‹ä»¶å¯ä»¥å¼¥åˆåˆ†å¼€ä¸¤ä¸ªä¹‹å‰ç‹¬ç«‹çš„ä¼šè¯çš„å·®è·ï¼Œäº§ç”Ÿè¿Ÿåˆ°çš„åˆå¹¶ã€‚\nå®è·µ ä¸æœ¬èŠ‚é…å¥—çš„å®æˆ˜ç»ƒä¹ æ˜¯ Hourly Tips Exerciseã€‚\nè¿›ä¸€æ­¥é˜…è¯»  åŠæ—¶çš„æµå¤„ç† çª—å£  åŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/learn-flink/streaming_analytics.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-19-streaming-analytics/","tags":["Flink","Training"],"title":"æµåˆ†æ"},{"categories":["programming"],"contents":"çŠ¶æ€åç«¯ Flink ç®¡ç†çš„ keyed state æ˜¯ä¸€ç§ç¢ç‰‡åŒ–çš„ã€é”®/å€¼å­˜å‚¨ï¼Œæ¯é¡¹ keyed state çš„å·¥ä½œå‰¯æœ¬éƒ½è¢«ä¿å­˜åœ¨è´Ÿè´£è¯¥é”®çš„ taskmanager çš„æœ¬åœ°æŸå¤„ã€‚Operator çš„çŠ¶æ€ä¹Ÿè¢«ä¿å­˜åœ¨éœ€è¦å®ƒçš„æœºå™¨çš„æœ¬åœ°ã€‚Flink ä¼šå®šæœŸå¯¹æ‰€æœ‰çŠ¶æ€è¿›è¡ŒæŒä¹…åŒ–å¿«ç…§ï¼Œå¹¶å°†è¿™äº›å¿«ç…§å¤åˆ¶åˆ°æŸä¸ªæ›´æŒä¹…çš„åœ°æ–¹ï¼Œæ¯”å¦‚åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€‚\nåœ¨å‘ç”Ÿæ•…éšœçš„æƒ…å†µä¸‹ï¼ŒFlink å¯ä»¥æ¢å¤ä½ çš„åº”ç”¨ç¨‹åºçš„å®Œæ•´çŠ¶æ€ï¼Œå¹¶æ¢å¤å¤„ç†ï¼Œå°±åƒä»€ä¹ˆéƒ½æ²¡æœ‰å‘ç”Ÿè¿‡ä¸€æ ·ã€‚\nFlink ç®¡ç†çš„è¿™ç§çŠ¶æ€è¢«å­˜å‚¨åœ¨çŠ¶æ€åç«¯ä¸­ã€‚çŠ¶æ€åç«¯æœ‰ä¸¤ç§å®ç°\u0026ndash;ä¸€ç§æ˜¯åŸºäº RocksDB çš„ï¼Œå®ƒæ˜¯ä¸€ä¸ªåµŒå…¥å¼çš„é”®/å€¼å­˜å‚¨ï¼Œå°†å…¶å·¥ä½œçŠ¶æ€ä¿å­˜åœ¨ç£ç›˜ä¸Šï¼›å¦ä¸€ç§æ˜¯åŸºäºå †çš„çŠ¶æ€åç«¯ï¼Œå°†å…¶å·¥ä½œçŠ¶æ€ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œåœ¨ Java å †ä¸Šã€‚è¿™ç§åŸºäºå †çš„çŠ¶æ€åç«¯æœ‰ä¸¤ç§é£å‘³ï¼šå°†å…¶çŠ¶æ€å¿«ç…§æŒä¹…åŒ–åˆ°åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿçš„ FsStateBackend å’Œä½¿ç”¨ JobManager çš„å †çš„ MemoryStateBackendã€‚\n   åç§° å·¥ä½œçŠ¶æ€ çŠ¶æ€å¤‡ä»½ å¿«ç…§     RocksDBStateBackend æœ¬åœ°ç£ç›˜(tmp dir) åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ å®Œå…¨/å¢é‡   æ”¯æŒå¤§äºå¯ç”¨å†…å­˜çš„çŠ¶æ€; ç»éªŒæ³•åˆ™ï¼šæ¯”åŸºäºå †çš„åç«¯æ…¢10å€ã€‚      FsStateBackend JVM Heap åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿ Full   é€Ÿåº¦å¿«ï¼Œéœ€è¦å¤§é‡å †ç§¯; å—åˆ¶äº GC      MemoryStateBackend JVM Heap JobManager JVM Heap Full   æœ‰åˆ©äºå°çŠ¶æ€ï¼ˆåœ°æ–¹ï¼‰çš„æµ‹è¯•å’Œå®éªŒã€‚       å½“å¤„ç†ä¿å­˜åœ¨åŸºäºå †çš„çŠ¶æ€åç«¯çš„çŠ¶æ€æ—¶ï¼Œè®¿é—®å’Œæ›´æ–°æ¶‰åŠåˆ°åœ¨å †ä¸Šè¯»å†™å¯¹è±¡ã€‚ä½†æ˜¯å¯¹äºä¿å­˜åœ¨ RocksDBStateBackend ä¸­çš„å¯¹è±¡ï¼Œè®¿é—®å’Œæ›´æ–°æ¶‰åŠåˆ°åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œå› æ­¤æˆæœ¬æ›´é«˜ã€‚ä½†æ˜¯ä½¿ç”¨ RocksDB å¯ä»¥æ‹¥æœ‰çš„çŠ¶æ€æ•°é‡åªå—é™äºæœ¬åœ°ç£ç›˜çš„å¤§å°ã€‚è¿˜è¦æ³¨æ„çš„æ˜¯ï¼Œåªæœ‰ RocksDBStateBackend èƒ½å¤Ÿè¿›è¡Œå¢é‡å¿«ç…§ï¼Œè¿™å¯¹äºæœ‰å¤§é‡ç¼“æ…¢å˜åŒ–çš„çŠ¶æ€çš„åº”ç”¨æ¥è¯´æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„å¥½å¤„ã€‚\næ‰€æœ‰è¿™äº›çŠ¶æ€åç«¯éƒ½èƒ½å¤Ÿè¿›è¡Œå¼‚æ­¥å¿«ç…§ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å¯ä»¥åœ¨ä¸å¦¨ç¢æ­£åœ¨è¿›è¡Œçš„æµå¤„ç†çš„æƒ…å†µä¸‹è¿›è¡Œå¿«ç…§ã€‚\nçŠ¶æ€å¿«ç…§ å®šä¹‰  å¿«ç…§\u0026ndash;ä¸€ä¸ªé€šç”¨æœ¯è¯­ï¼ŒæŒ‡çš„æ˜¯ä¸€ä¸ª Flink ä½œä¸šçŠ¶æ€çš„å…¨å±€ã€ä¸€è‡´çš„å›¾åƒã€‚å¿«ç…§åŒ…æ‹¬è¿›å…¥æ¯ä¸ªæ•°æ®æºçš„æŒ‡é’ˆï¼ˆä¾‹å¦‚ï¼Œè¿›å…¥æ–‡ä»¶æˆ– Kafka åˆ†åŒºçš„åç§»ï¼‰ï¼Œä»¥åŠæ¥è‡ªæ¯ä¸ªä½œä¸šçš„æœ‰çŠ¶æ€æ“ä½œç¬¦çš„çŠ¶æ€å‰¯æœ¬ï¼Œè¿™äº›æ“ä½œç¬¦æ˜¯åœ¨å¤„ç†äº†æ‰€æœ‰äº‹ä»¶åäº§ç”Ÿçš„ï¼Œç›´åˆ°æºä¸­çš„è¿™äº›ä½ç½®ã€‚ æ£€æŸ¥ç‚¹\u0026ndash;Flink ä¸ºäº†èƒ½å¤Ÿä»æ•…éšœä¸­æ¢å¤è€Œè‡ªåŠ¨æ‹æ‘„çš„å¿«ç…§ã€‚æ£€æŸ¥ç‚¹å¯ä»¥æ˜¯å¢é‡çš„ï¼Œå¹¶ä¸ºå¿«é€Ÿæ¢å¤è¿›è¡Œäº†ä¼˜åŒ–ã€‚ å¤–éƒ¨åŒ–æ£€æŸ¥ç‚¹\u0026ndash;é€šå¸¸æ£€æŸ¥ç‚¹ä¸æ‰“ç®—è¢«ç”¨æˆ·æ“çºµã€‚Flink åªåœ¨ä½œä¸šè¿è¡Œæ—¶ä¿ç•™nä¸ªæœ€è¿‘çš„æ£€æŸ¥ç‚¹ï¼ˆnæ˜¯å¯é…ç½®çš„ï¼‰ï¼Œå¹¶åœ¨ä½œä¸šå–æ¶ˆæ—¶åˆ é™¤å®ƒä»¬ã€‚ä½†ä½ ä¹Ÿå¯ä»¥é…ç½®å®ƒä»¬è¢«ä¿ç•™ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥æ‰‹åŠ¨ä»å®ƒä»¬æ¢å¤ã€‚ ä¿å­˜ç‚¹\u0026ndash;ç”±ç”¨æˆ·ï¼ˆæˆ–APIè°ƒç”¨ï¼‰æ‰‹åŠ¨è§¦å‘çš„å¿«ç…§ï¼Œç”¨äºæŸäº›æ“ä½œç›®çš„ï¼Œä¾‹å¦‚æœ‰çŠ¶æ€çš„é‡æ–°éƒ¨ç½²/å‡çº§/é‡æ–°ç¼©æ”¾æ“ä½œã€‚ä¿å­˜ç‚¹å§‹ç»ˆæ˜¯å®Œæ•´çš„ï¼Œå¹¶ä¸ºæ“ä½œçš„çµæ´»æ€§è¿›è¡Œäº†ä¼˜åŒ–ã€‚  çŠ¶æ€å¿«ç…§æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ Flink ä½¿ç”¨ Chandy-Lamport ç®—æ³•çš„ä¸€ä¸ªå˜ä½“ï¼Œç§°ä¸ºå¼‚æ­¥å±éšœå¿«ç…§ã€‚\nå½“ä»»åŠ¡ç®¡ç†å™¨è¢«æ£€æŸ¥ç‚¹åè°ƒå™¨ï¼ˆä½œä¸šç®¡ç†å™¨çš„ä¸€éƒ¨åˆ†ï¼‰æŒ‡ç¤ºå¼€å§‹æ£€æŸ¥ç‚¹æ—¶ï¼Œå®ƒè®©æ‰€æœ‰çš„æºè®°å½•å®ƒä»¬çš„åç§»é‡ï¼Œå¹¶åœ¨å®ƒä»¬çš„æµä¸­æ’å…¥ç¼–å·çš„æ£€æŸ¥ç‚¹éšœç¢ã€‚è¿™äº›å±éšœåœ¨ä½œä¸šå›¾(job graph)ä¸­æµåŠ¨ï¼ŒæŒ‡ç¤ºæ¯ä¸ªæ£€æŸ¥ç‚¹å‰åçš„æµçš„éƒ¨åˆ†ã€‚\næ£€æŸ¥ç‚¹nå°†åŒ…å«æ¯ä¸ª operator çš„çŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€æ˜¯ç”±äºæ¶ˆè€—äº†æ£€æŸ¥ç‚¹éšœç¢nä¹‹å‰çš„æ¯ä¸ªäº‹ä»¶ï¼Œè€Œæ²¡æœ‰æ¶ˆè€—å®ƒä¹‹åçš„ä»»ä½•äº‹ä»¶ã€‚\nå½“ä½œä¸šå›¾ä¸­çš„æ¯ä¸ª operator æ¥æ”¶åˆ°è¿™äº›éšœç¢ä¹‹ä¸€æ—¶ï¼Œå®ƒå°±ä¼šè®°å½•å…¶çŠ¶æ€ã€‚å…·æœ‰ä¸¤ä¸ªè¾“å…¥æµï¼ˆå¦‚ CoProcessFunctionï¼‰çš„ operator æ‰§è¡Œå±éšœå¯¹é½ï¼Œè¿™æ ·å¿«ç…§å°†åæ˜ æ¶ˆè€—ä¸¤ä¸ªè¾“å…¥æµçš„äº‹ä»¶æ‰€äº§ç”Ÿçš„çŠ¶æ€ï¼Œç›´åˆ°ï¼ˆä½†ä¸è¶…è¿‡ï¼‰ä¸¤ä¸ªå±éšœã€‚\nFlink çš„çŠ¶æ€åç«¯ä½¿ç”¨å¤åˆ¶-å†™æœºåˆ¶ï¼Œå…è®¸åœ¨å¼‚æ­¥å¿«ç…§çŠ¶æ€çš„æ—§ç‰ˆæœ¬æ—¶ï¼Œæµå¤„ç†ä¸å—é˜»ç¢åœ°ç»§ç»­ã€‚åªæœ‰å½“å¿«ç…§è¢«æŒä¹…åŒ–åï¼Œè¿™äº›æ—§ç‰ˆæœ¬çš„çŠ¶æ€æ‰ä¼šè¢«åƒåœ¾å›æ”¶ã€‚\nä¸€æ¬¡æ€§ä¿è¯ å½“æµå¤„ç†åº”ç”¨ä¸­å‡ºç°é—®é¢˜æ—¶ï¼Œæœ‰å¯èƒ½å‡ºç°ä¸¢å¤±ï¼Œæˆ–è€…é‡å¤çš„ç»“æœã€‚åœ¨ Flink ä¸­ï¼Œæ ¹æ®ä½ å¯¹åº”ç”¨çš„é€‰æ‹©å’Œä½ è¿è¡Œå®ƒçš„é›†ç¾¤ï¼Œè¿™äº›ç»“æœä¸­çš„ä»»ä½•ä¸€ç§éƒ½æ˜¯å¯èƒ½çš„ã€‚\n Flink ä¸åŠªåŠ›ä»æ•…éšœä¸­æ¢å¤ï¼ˆæœ€å¤šä¸€æ¬¡ï¼‰ã€‚ æ²¡æœ‰ä»»ä½•æŸå¤±ï¼Œä½†æ‚¨å¯èƒ½ä¼šé‡åˆ°é‡å¤çš„ç»“æœï¼ˆè‡³å°‘ä¸€æ¬¡ï¼‰ã€‚ æ²¡æœ‰ä»»ä½•ä¸œè¥¿ä¸¢å¤±æˆ–é‡å¤ï¼ˆç²¾ç¡®åœ°ä¸€æ¬¡ï¼‰ã€‚  é‰´äº Flink é€šè¿‡å€’å¸¦å’Œé‡æ”¾æºæ•°æ®æµä»æ•…éšœä¸­æ¢å¤ï¼Œå½“ç†æƒ³æƒ…å†µè¢«æè¿°ä¸ºç²¾ç¡®ä¸€æ¬¡æ—¶ï¼Œè¿™å¹¶ä¸æ„å‘³ç€æ¯ä¸ªäº‹ä»¶éƒ½å°†è¢«ç²¾ç¡®å¤„ç†ä¸€æ¬¡ã€‚ç›¸åï¼Œå®ƒæ„å‘³ç€æ¯ä¸€ä¸ªäº‹ä»¶éƒ½ä¼šå¯¹ Flink æ‰€ç®¡ç†çš„çŠ¶æ€äº§ç”Ÿä¸€æ¬¡ç¡®åˆ‡çš„å½±å“ã€‚\nBarrier å¯¹é½åªéœ€è¦ç”¨äºæä¾›ç²¾ç¡®çš„ä¸€æ¬¡ä¿è¯ã€‚å¦‚æœä½ ä¸éœ€è¦è¿™ä¸ªï¼Œä½ å¯ä»¥é€šè¿‡é…ç½® Flink ä½¿ç”¨ CheckpointingMode.AT_LEAST_ONCE æ¥è·å¾—ä¸€äº›æ€§èƒ½ï¼Œå®ƒçš„æ•ˆæœæ˜¯ç¦ç”¨å±éšœå¯¹é½ã€‚\nç²¾ç¡®ä¸€æ¬¡, ç«¯åˆ°ç«¯ ä¸ºäº†å®ç°ç«¯åˆ°ç«¯ç²¾ç¡®çš„ä¸€æ¬¡ï¼Œè®©æºçš„æ¯ä¸ªäº‹ä»¶ç²¾ç¡®åœ°å½±å“æ±‡ï¼Œä»¥ä¸‹å‡ ç‚¹å¿…é¡»æ˜¯çœŸçš„ã€‚\n ä½ çš„æºå¿…é¡»æ˜¯å¯é‡æ’­çš„ï¼Œå¹¶ä¸” ä½ çš„æ¥æ”¶å™¨å¿…é¡»æ˜¯äº‹åŠ¡æ€§çš„(æˆ–å¹‚ç­‰çš„)  å®è·µ Flink Operations Playground åŒ…æ‹¬è§‚å¯Ÿæ•…éšœå’Œæ¢å¤çš„éƒ¨åˆ†ã€‚\nè¿›ä¸€æ­¥é˜…è¯»  æœ‰çŠ¶æ€çš„æµå¤„ç† çŠ¶æ€åç«¯ æ•°æ®æºå’Œæ¥æ”¶å™¨çš„å®¹é”™ä¿è¯ å¯ç”¨å’Œé…ç½®æ£€æŸ¥ç‚¹ æ£€æŸ¥ç‚¹ ä¿å­˜ç‚¹ è°ƒæ•´æ£€æŸ¥ç‚¹å’Œå¤§çŠ¶æ€ ç›‘æµ‹æ£€æŸ¥ç‚¹ ä»»åŠ¡æ•…éšœæ¢å¤  ","permalink":"https://ohmyweekly.github.io/notes/2020-08-19-fault-tolerance/","tags":["Flink","Training"],"title":"é€šè¿‡çŠ¶æ€å¿«ç…§è¿›è¡Œå®¹é”™"},{"categories":["programming"],"contents":"Flink æ“ä½œæ¸¸ä¹åœº åœ¨å„ç§ç¯å¢ƒä¸­éƒ¨ç½²å’Œæ“ä½œ Apache Flink çš„æ–¹æ³•æœ‰å¾ˆå¤šã€‚æ— è®ºè¿™ç§å¤šæ ·æ€§å¦‚ä½•ï¼ŒFlink é›†ç¾¤çš„åŸºæœ¬æ„ä»¶ä¿æŒä¸å˜ï¼Œç±»ä¼¼çš„æ“ä½œåŸåˆ™ä¹Ÿé€‚ç”¨ã€‚\nåœ¨è¿™ä¸ªæ¸¸ä¹åœºä¸Šï¼Œä½ å°†å­¦ä¹ å¦‚ä½•ç®¡ç†å’Œè¿è¡Œ Flink Jobsã€‚ä½ å°†çœ‹åˆ°å¦‚ä½•éƒ¨ç½²å’Œç›‘æ§åº”ç”¨ç¨‹åºï¼Œä½“éªŒ Flink å¦‚ä½•ä» Job æ•…éšœä¸­æ¢å¤ï¼Œå¹¶æ‰§è¡Œæ—¥å¸¸æ“ä½œä»»åŠ¡ï¼Œå¦‚å‡çº§å’Œé‡æ–°ç¼©æ”¾ã€‚\nè¿™ä¸ªæ¸¸ä¹åœºçš„è§£å‰– è¿™ä¸ªæ¸¸ä¹åœºç”±ä¸€ä¸ªæŒä¹…çš„ Flink Session Cluster å’Œä¸€ä¸ª Kafka Cluster ç»„æˆã€‚\nä¸€ä¸ª Flink Cluster æ€»æ˜¯ç”±ä¸€ä¸ª JobManager å’Œä¸€ä¸ªæˆ–å¤šä¸ª Flink TaskManager ç»„æˆã€‚JobManager è´Ÿè´£å¤„ç† Job æäº¤ï¼Œç›‘ç£ Job ä»¥åŠèµ„æºç®¡ç†ã€‚Flink TaskManager æ˜¯ worker è¿›ç¨‹ï¼Œè´Ÿè´£æ‰§è¡Œæ„æˆ Flink Job çš„å®é™…ä»»åŠ¡ã€‚åœ¨è¿™ä¸ªæ¸¸æˆåœºä¸­ï¼Œä½ å°†ä»å•ä¸ª TaskManager å¼€å§‹ï¼Œä½†ä»¥åä¼šæ‰©å±•åˆ°æ›´å¤šçš„ TaskManagerã€‚æ­¤å¤–ï¼Œè¿™ä¸ªæ¸¸ä¹åœºè¿˜å¸¦æœ‰ä¸€ä¸ªä¸“é—¨çš„å®¢æˆ·ç«¯å®¹å™¨ï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒæ¥æäº¤ Flink Jobï¼Œå¹¶åœ¨ä»¥åæ‰§è¡Œå„ç§æ“ä½œä»»åŠ¡ã€‚å®¢æˆ·ç«¯å®¹å™¨ä¸æ˜¯ Flink Cluster æœ¬èº«éœ€è¦çš„ï¼Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨æ‰åŒ…å«åœ¨é‡Œé¢ã€‚\nKafka é›†ç¾¤ç”±ä¸€ä¸ª Zookeeper æœåŠ¡å™¨å’Œä¸€ä¸ª Kafka Broker ç»„æˆã€‚\nå½“æ¸¸ä¹åœºå¯åŠ¨æ—¶ï¼Œä¸€ä¸ªåä¸º Flink Event Count çš„ Flink Job å°†è¢«æäº¤ç»™ JobManagerã€‚æ­¤å¤–ï¼Œè¿˜ä¼šåˆ›å»ºä¸¤ä¸ª Kafka ä¸»é¢˜ input å’Œ outputã€‚\nè¯¥ä½œä¸šä» input ä¸»é¢˜ä¸­æ¶ˆè€—ç‚¹å‡»äº‹ä»¶(ClickEvent)ï¼Œæ¯ä¸ªç‚¹å‡»äº‹ä»¶(ClickEvent)éƒ½æœ‰ä¸€ä¸ªæ—¶é—´æˆ³(timestamp)å’Œä¸€ä¸ªé¡µé¢(page)ã€‚ç„¶åæŒ‰é¡µé¢å¯¹äº‹ä»¶è¿›è¡Œåˆ†ç»„(keyed by)ï¼Œå¹¶åœ¨ 15 ç§’çš„çª—å£ä¸­è¿›è¡Œè®¡æ•°ã€‚ç»“æœè¢«å†™å…¥ output ä¸»é¢˜ã€‚\næœ‰6ä¸ªä¸åŒçš„é¡µé¢ï¼Œæˆ‘ä»¬åœ¨æ¯ä¸ªé¡µé¢å’Œ15ç§’å†…äº§ç”Ÿ1000ä¸ªç‚¹å‡»äº‹ä»¶ã€‚å› æ­¤ï¼ŒFlink ä½œä¸šçš„è¾“å‡ºåº”è¯¥æ˜¾ç¤ºæ¯ä¸ªé¡µé¢å’Œçª—å£æœ‰1000ä¸ªæµè§ˆé‡ã€‚\nå¯åŠ¨æ¸¸ä¹åœº æ¸¸æˆåœºç¯å¢ƒçš„è®¾ç½®åªéœ€å‡ æ­¥ã€‚æˆ‘ä»¬å°†å¼•å¯¼ä½ å®Œæˆå¿…è¦çš„å‘½ä»¤ï¼Œå¹¶å±•ç¤ºå¦‚ä½•éªŒè¯ä¸€åˆ‡éƒ½åœ¨æ­£ç¡®è¿è¡Œã€‚\næˆ‘ä»¬å‡è®¾ä½ çš„æœºå™¨ä¸Šå®‰è£…äº† Dockerï¼ˆ1.12+ï¼‰å’Œ docker-composeï¼ˆ2.1+ï¼‰ã€‚\næ‰€éœ€çš„é…ç½®æ–‡ä»¶å¯ä»¥åœ¨ flink-playgrounds ä»“åº“ä¸­æ‰¾åˆ°ã€‚æ£€æŸ¥ä¸€ä¸‹ï¼Œç„¶åå¯¹é½ç¯å¢ƒã€‚\ngit clone --branch release-1.11 https://github.com/apache/flink-playgrounds.git cd flink-playgrounds/operations-playground docker-compose build docker-compose up -d ä¹‹åï¼Œä½ å¯ä»¥ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥æ­£åœ¨è¿è¡Œçš„ Docker å®¹å™¨ã€‚\ndocker-compose ps Name Command State Ports ----------------------------------------------------------------------------------------------------------------------------- operations-playground_clickevent-generator_1 /docker-entrypoint.sh java ... Up 6123/tcp, 8081/tcp operations-playground_client_1 /docker-entrypoint.sh flin ... Exit 0 operations-playground_jobmanager_1 /docker-entrypoint.sh jobm ... Up 6123/tcp, 0.0.0.0:8081-\u0026gt;8081/tcp operations-playground_kafka_1 start-kafka.sh Up 0.0.0.0:9094-\u0026gt;9094/tcp operations-playground_taskmanager_1 /docker-entrypoint.sh task ... Up 6123/tcp, 8081/tcp operations-playground_zookeeper_1 /bin/sh -c /usr/sbin/sshd ... Up 2181/tcp, 22/tcp, 2888/tcp, 3888/tcp è¿™è¡¨æ˜å®¢æˆ·ç«¯å®¹å™¨å·²ç»æˆåŠŸæäº¤äº† Flink Jobï¼ˆExit 0ï¼‰ï¼Œæ‰€æœ‰é›†ç¾¤ç»„ä»¶ä»¥åŠæ•°æ®ç”Ÿæˆå™¨éƒ½åœ¨è¿è¡Œï¼ˆUpï¼‰ã€‚\nä½ å¯ä»¥é€šè¿‡è°ƒç”¨æ¥åœæ­¢æ¸¸ä¹åœºç¯å¢ƒã€‚\ndocker-compose down -v è¿›å…¥æ¸¸ä¹åœº åœ¨è¿™ä¸ªæ¸¸ä¹åœºä¸­ï¼Œæœ‰å¾ˆå¤šä¸œè¥¿ä½ å¯ä»¥å°è¯•å’Œæ£€æŸ¥ã€‚åœ¨ä¸‹é¢çš„ä¸¤èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å‘ä½ å±•ç¤ºå¦‚ä½•ä¸ Flink é›†ç¾¤è¿›è¡Œäº¤äº’ï¼Œå¹¶å±•ç¤º Flink çš„ä¸€äº›å…³é”®åŠŸèƒ½ã€‚\nFlink WebUI è§‚å¯Ÿä½ çš„ Flink é›†ç¾¤æœ€è‡ªç„¶çš„å‡ºå‘ç‚¹æ˜¯åœ¨ http://localhost:8081 ä¸‹æš´éœ²çš„ WebUIã€‚å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œä½ ä¼šçœ‹åˆ°é›†ç¾¤æœ€åˆç”±ä¸€ä¸ª TaskManager ç»„æˆï¼Œå¹¶æ‰§è¡Œä¸€ä¸ªåä¸º Click Event Count çš„ Jobã€‚\nFlink WebUI åŒ…å«äº†å¾ˆå¤šå…³äº Flink é›†ç¾¤å’Œå®ƒçš„å·¥ä½œçš„æœ‰ç”¨å’Œæœ‰è¶£çš„ä¿¡æ¯ï¼ˆJobGraph, Metrics, Checkpointing Statistics, TaskManager Status, \u0026hellip;ï¼‰ã€‚\næ—¥å¿— JobManager å¯ä»¥é€šè¿‡ docker-compose å¯¹ JobManager æ—¥å¿—è¿›è¡Œè·Ÿè¸ªã€‚\ndocker-compose logs -f jobmanager åœ¨åˆå§‹å¯åŠ¨åï¼Œä½ åº”è¯¥ä¸»è¦çœ‹åˆ°æ¯ä¸€ä¸ªæ£€æŸ¥ç‚¹å®Œæˆçš„æ—¥å¿—ä¿¡æ¯ã€‚\nTaskManager TaskManager çš„æ—¥å¿—ä¹Ÿå¯ä»¥ç”¨åŒæ ·çš„æ–¹å¼è¿›è¡Œ tailã€‚\ndocker-compose logs -f taskmanager åœ¨åˆå§‹å¯åŠ¨åï¼Œä½ åº”è¯¥ä¸»è¦çœ‹åˆ°æ¯ä¸ªæ£€æŸ¥ç‚¹å®Œæˆçš„æ—¥å¿—ä¿¡æ¯ã€‚\nFlink CLI Flink CLI å¯ä»¥åœ¨å®¢æˆ·ç«¯å®¹å™¨ä¸­ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œè¦æ‰“å° Flink CLI çš„å¸®åŠ©ä¿¡æ¯ï¼Œä½ å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤\ndocker-compose run --no-deps client flink --help Flink REST API Flink REST API é€šè¿‡ä¸»æœºä¸Šçš„ localhost:8081 æˆ–å®¢æˆ·ç«¯å®¹å™¨ä¸­çš„ jobmanager:8081 æš´éœ²å‡ºæ¥ï¼Œä¾‹å¦‚ï¼Œè¦åˆ—å‡ºæ‰€æœ‰å½“å‰æ­£åœ¨è¿è¡Œçš„ä½œä¸šï¼Œä½ å¯ä»¥è¿è¡Œ:\ncurl localhost:8081/jobs Kafka Topics ä½ å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹å†™å…¥ Kafka ä¸»é¢˜çš„è®°å½•\n//input topic (1000 records/s) docker-compose exec kafka kafka-console-consumer.sh \\  --bootstrap-server localhost:9092 --topic input //output topic (24 records/min) docker-compose exec kafka kafka-console-consumer.sh \\  --bootstrap-server localhost:9092 --topic output Time to Play! ç°åœ¨ä½ å·²ç»å­¦ä¼šäº†å¦‚ä½•ä¸ Flink å’Œ Docker å®¹å™¨è¿›è¡Œäº¤äº’ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€äº›å¸¸è§çš„æ“ä½œä»»åŠ¡ï¼Œä½ å¯ä»¥åœ¨æˆ‘ä»¬çš„æ¸¸ä¹åœºä¸Šå°è¯•ä¸€ä¸‹ã€‚æ‰€æœ‰è¿™äº›ä»»åŠ¡éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå³ä½ å¯ä»¥ä»¥ä»»ä½•é¡ºåºæ‰§è¡Œå®ƒä»¬ã€‚å¤§å¤šæ•°ä»»åŠ¡å¯ä»¥é€šè¿‡ CLI å’Œ REST API æ¥æ‰§è¡Œã€‚\nåˆ—å‡ºæ­£åœ¨è¿è¡Œçš„ Job  CLI  å‘½ä»¤\ndocker-compose run --no-deps client flink list æœŸæœ›çš„è¾“å‡º\nWaiting for response... ------------------ Running/Restarting Jobs ------------------- 16.07.2019 16:37:55 : \u0026lt;job-id\u0026gt; : Click Event Count (RUNNING) -------------------------------------------------------------- No scheduled jobs.  REST API  è¯·æ±‚\ncurl localhost:8081/jobs æœŸå¾…çš„å“åº”(ç¾åŒ–äº†æ‰“å°)\n{ \u0026#34;jobs\u0026#34;: [ { \u0026#34;id\u0026#34;: \u0026#34;\u0026lt;job-id\u0026gt;\u0026#34;, \u0026#34;status\u0026#34;: \u0026#34;RUNNING\u0026#34; } ] } JobID åœ¨æäº¤æ—¶è¢«åˆ†é…ç»™ä½œä¸š(Job)ï¼Œå¹¶ä¸”éœ€è¦é€šè¿‡ CLI æˆ– REST API å¯¹ä½œä¸š(Job)æ‰§è¡Œæ“ä½œã€‚\nè§‚å¯Ÿæ•…éšœå’Œæ¢å¤ Flink åœ¨(éƒ¨åˆ†)å¤±è´¥ä¸‹æä¾›äº†ç²¾ç¡®çš„ä¸€æ¬¡å¤„ç†ä¿è¯ã€‚åœ¨è¿™ä¸ªæ¸¸ä¹åœºä¸­ï¼Œä½ å¯ä»¥è§‚å¯Ÿå¹¶åœ¨ä¸€å®šç¨‹åº¦ä¸ŠéªŒè¯è¿™ç§è¡Œä¸ºã€‚\næ­¥éª¤1ï¼šè§‚å¯Ÿè¾“å‡º\nå¦‚ä¸Šæ‰€è¿°ï¼Œåœ¨è¿™ä¸ªæ¸¸ä¹åœºä¸­çš„äº‹ä»¶æ˜¯è¿™æ ·ç”Ÿæˆçš„ï¼Œæ¯ä¸ªçª—å£æ­£å¥½åŒ…å«ä¸€åƒæ¡è®°å½•ã€‚å› æ­¤ï¼Œä¸ºäº†éªŒè¯ Flink æ˜¯å¦æˆåŠŸåœ°ä» TaskManager æ•…éšœä¸­æ¢å¤ï¼Œè€Œæ²¡æœ‰æ•°æ®ä¸¢å¤±æˆ–é‡å¤ï¼Œä½ å¯ä»¥è·Ÿè¸ª output ä¸»é¢˜ï¼Œå¹¶æ£€æŸ¥æ¢å¤åæ‰€æœ‰çš„çª—å£éƒ½å­˜åœ¨ï¼Œè€Œä¸”è®¡æ•°æ˜¯æ­£ç¡®çš„ã€‚\nä¸ºæ­¤ï¼Œä» output ä¸»é¢˜å¼€å§‹è¯»å–ï¼Œå¹¶è®©è¿™ä¸ªå‘½ä»¤è¿è¡Œåˆ°æ¢å¤åï¼ˆæ­¥éª¤3ï¼‰ã€‚\ndocker-compose exec kafka kafka-console-consumer.sh \\  --bootstrap-server localhost:9092 --topic output ç¬¬äºŒæ­¥ï¼šå¼•å…¥æ•…éšœ\nä¸ºäº†æ¨¡æ‹Ÿéƒ¨åˆ†æ•…éšœï¼Œä½ å¯ä»¥æ€æ­»ä¸€ä¸ª TaskManagerï¼Œåœ¨ç”Ÿäº§è®¾ç½®ä¸­ï¼Œè¿™å¯èƒ½å¯¹åº”äº TaskManager è¿›ç¨‹ã€TaskManager æœºå™¨çš„ä¸¢å¤±ï¼Œæˆ–è€…ä»…ä»…æ˜¯æ¡†æ¶æˆ–ç”¨æˆ·ä»£ç æŠ›å‡ºçš„ç¬æ—¶å¼‚å¸¸ï¼ˆä¾‹å¦‚ç”±äºæš‚æ—¶ä¸å¯ç”¨ï¼‰ã€‚\ndocker-compose kill taskmanager å‡ ç§’é’Ÿåï¼ŒJobManager ä¼šæ³¨æ„åˆ° TaskManager çš„ä¸¢å¤±ï¼Œå–æ¶ˆå—å½±å“çš„ Jobï¼Œå¹¶ç«‹å³é‡æ–°æäº¤å®ƒè¿›è¡Œæ¢å¤ã€‚å½“ Job è¢«é‡æ–°å¯åŠ¨åï¼Œå…¶ä»»åŠ¡ä»å¤„äº SCHEDULED çŠ¶æ€ï¼Œç”±ç´«è‰²çš„æ–¹å—è¡¨ç¤ºï¼ˆè§ä¸‹é¢çš„æˆªå›¾ï¼‰ã€‚\næ³¨æ„ï¼šå³ä½¿ä½œä¸š(Job)çš„ä»»åŠ¡(Task)å¤„äº SCHEDULED çŠ¶æ€è€Œä¸æ˜¯ RUNNING çŠ¶æ€ï¼Œä½œä¸š(Job)çš„æ•´ä½“çŠ¶æ€ä¹Ÿä¼šæ˜¾ç¤ºä¸º RUNNINGã€‚\næ­¤æ—¶ï¼ŒJob çš„ä»»åŠ¡(Task)ä¸èƒ½ä» SCHEDULED çŠ¶æ€è½¬ä¸º RUNNING çŠ¶æ€ï¼Œå› ä¸ºæ²¡æœ‰èµ„æº(TaskManager æä¾›çš„ TaskSlotsï¼‰æ¥è¿è¡Œè¿™äº›ä»»åŠ¡ã€‚åœ¨æ–°çš„ TaskManager å¯ç”¨ä¹‹å‰ï¼ŒJob å°†ç»å†ä¸€ä¸ªå–æ¶ˆå’Œé‡æ–°æäº¤çš„å¾ªç¯ã€‚\nåŒæ—¶ï¼Œæ•°æ®ç”Ÿæˆå™¨ä¼šä¸æ–­åœ°å°† ClickEvents æ¨é€åˆ° input ä¸»é¢˜ä¸­ã€‚è¿™ç±»ä¼¼äºçœŸæ­£çš„ç”Ÿäº§è®¾ç½®ï¼Œåœ¨ç”Ÿäº§æ•°æ®çš„åŒæ—¶ï¼Œè¦å¤„ç†æ•°æ®çš„ Job å´å®•æœºäº†ã€‚\næ­¥éª¤3ï¼šæ¢å¤\nä¸€æ—¦ä½ é‡æ–°å¯åŠ¨ TaskManagerï¼Œå®ƒå°±ä¼šé‡æ–°è¿æ¥åˆ° JobManagerã€‚\ndocker-compose up -d taskmanager å½“ JobManager è¢«é€šçŸ¥åˆ°æ–°çš„ TaskManager æ—¶ï¼Œå®ƒå°†æ¢å¤ä¸­çš„ Job çš„ä»»åŠ¡(tasks)è°ƒåº¦åˆ°æ–°çš„å¯ç”¨ TaskSlotsã€‚é‡æ–°å¯åŠ¨åï¼Œä»»åŠ¡ä¼šä»æ•…éšœå‰æœ€åä¸€æ¬¡æˆåŠŸçš„æ£€æŸ¥ç‚¹æ¢å¤å…¶çŠ¶æ€ï¼Œå¹¶åˆ‡æ¢åˆ° RUNNING çŠ¶æ€ã€‚\nJob å°†å¿«é€Ÿå¤„ç†æ¥è‡ª Kafka çš„å…¨éƒ¨ç§¯å‹è¾“å…¥äº‹ä»¶(åœ¨æ•…éšœæœŸé—´ç§¯ç´¯çš„)ï¼Œå¹¶ä»¥æ›´é«˜çš„é€Ÿåº¦(\u0026gt;24æ¡è®°å½•/åˆ†é’Ÿ)äº§ç”Ÿè¾“å‡ºï¼Œç›´åˆ°åˆ°è¾¾æµçš„å¤´éƒ¨ã€‚åœ¨è¾“å‡ºä¸­ï¼Œä½ ä¼šçœ‹åˆ°æ‰€æœ‰çš„é”®(é¡µé¢)éƒ½å­˜åœ¨äºæ‰€æœ‰çš„æ—¶é—´çª—å£ä¸­ï¼Œè€Œä¸”æ¯ä¸ªè®¡æ•°éƒ½æ˜¯ç²¾ç¡®çš„ 1000ã€‚ç”±äºæˆ‘ä»¬æ˜¯åœ¨\u0026quot;è‡³å°‘ä¸€æ¬¡\u0026quot;æ¨¡å¼ä¸‹ä½¿ç”¨ FlinkKafkaProducerï¼Œæ‰€ä»¥ä½ æœ‰å¯èƒ½ä¼šçœ‹åˆ°ä¸€äº›é‡å¤çš„è¾“å‡ºè®°å½•ã€‚\næ³¨æ„ï¼šå¤§å¤šæ•°ç”Ÿäº§è®¾ç½®ä¾èµ–äºèµ„æºç®¡ç†å™¨(Kubernetesã€Yarnã€Mesos)æ¥è‡ªåŠ¨é‡å¯å¤±è´¥çš„è¿›ç¨‹ã€‚\nå‡çº§å’Œé‡æ–°ç¼©æ”¾ä½œä¸š å‡çº§ Flink ä½œä¸šæ€»æ˜¯æ¶‰åŠä¸¤ä¸ªæ­¥éª¤ã€‚é¦–å…ˆï¼Œç”¨ä¸€ä¸ªä¿å­˜ç‚¹ä¼˜é›…åœ°åœæ­¢ Flink Jobã€‚ä¿å­˜ç‚¹æ˜¯åœ¨ä¸€ä¸ªæ˜ç¡®å®šä¹‰çš„ã€å…¨å±€ä¸€è‡´çš„æ—¶é—´ç‚¹(ç±»ä¼¼äºæ£€æŸ¥ç‚¹)ä¸Šçš„å®Œæ•´åº”ç”¨çŠ¶æ€çš„ä¸€è‡´å¿«ç…§ã€‚å…¶æ¬¡ï¼Œå‡çº§åçš„ Flink Job ä» Savepoint å¼€å§‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ\u0026ldquo;å‡çº§\u0026quot;å¯ä»¥æ„å‘³ç€ä¸åŒçš„äº‹æƒ…ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å†…å®¹:\n é…ç½®çš„å‡çº§ï¼ˆåŒ…æ‹¬ä½œä¸šçš„å¹¶è¡Œæ€§ï¼‰ã€‚ å¯¹ Job çš„æ‹“æ‰‘ç»“æ„è¿›è¡Œå‡çº§ï¼ˆå¢åŠ /åˆ é™¤ Operatorï¼‰ã€‚ å¯¹ Job çš„ç”¨æˆ·å®šä¹‰çš„å‡½æ•°è¿›è¡Œå‡çº§ã€‚  åœ¨å¼€å§‹å‡çº§ä¹‹å‰ï¼Œä½ å¯èƒ½è¦å¼€å§‹ tailing output ä¸»é¢˜ï¼Œä»¥è§‚å¯Ÿåœ¨å‡çº§è¿‡ç¨‹ä¸­æ²¡æœ‰æ•°æ®ä¸¢å¤±æˆ–æŸåã€‚\ndocker-compose exec kafka kafka-console-consumer.sh \\  --bootstrap-server localhost:9092 --topic output ç¬¬ä¸€æ­¥ï¼šåœæ­¢å·¥ä½œ\nè¦ä¼˜é›…åœ°åœæ­¢ä½œä¸šï¼Œä½ éœ€è¦ä½¿ç”¨ CLI æˆ– REST API çš„ \u0026ldquo;stop\u0026rdquo; å‘½ä»¤ã€‚ä¸ºæ­¤ï¼Œä½ éœ€è¦è¯¥ä½œä¸šçš„ JobIDï¼Œä½ å¯ä»¥é€šè¿‡åˆ—å‡ºæ‰€æœ‰æ­£åœ¨è¿è¡Œçš„ Job æˆ–ä» WebUI ä¸­è·å¾—ã€‚æœ‰äº† JobIDï¼Œä½ å°±å¯ä»¥ç»§ç»­åœæ­¢è¯¥ä½œä¸š:\n CLI  å‘½ä»¤\ndocker-compose run --no-deps client flink stop \u0026lt;job-id\u0026gt; é¢„æœŸçš„è¾“å‡º\nSuspending job \u0026quot;\u0026lt;job-id\u0026gt;\u0026quot; with a savepoint. Suspended job \u0026quot;\u0026lt;job-id\u0026gt;\u0026quot; with a savepoint. Savepoint å·²ç»è¢«å­˜å‚¨åˆ° flink-conf.yaml ä¸­é…ç½®çš„ state.savepoint.dir ä¸­ï¼Œå®ƒè¢«å®‰è£…åœ¨æœ¬åœ°æœºå™¨çš„ /tmp/flink-savepoints-directory/ ä¸‹ã€‚åœ¨ä¸‹ä¸€æ­¥ä¸­ï¼Œä½ å°†éœ€è¦è¿™ä¸ª Savepoint çš„è·¯å¾„ã€‚åœ¨ REST API çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªè·¯å¾„å·²ç»æ˜¯å“åº”çš„ä¸€éƒ¨åˆ†ï¼Œä½ å°†éœ€è¦ç›´æ¥æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿã€‚\nå‘½ä»¤\nls -lia /tmp/flink-savepoints-directory é¢„æœŸçš„è¾“å‡º\ntotal 0 17 drwxr-xr-x 3 root root 60 17 jul 17:05 . 2 drwxrwxrwt 135 root root 3420 17 jul 17:09 .. 1002 drwxr-xr-x 2 root root 140 17 jul 17:05 savepoint-\u0026lt;short-job-id\u0026gt;-\u0026lt;uuid\u0026gt;  REST API  è¯·æ±‚\n# triggering stop curl -X POST localhost:8081/jobs/\u0026lt;job-id\u0026gt;/stop -d \u0026#39;{\u0026#34;drain\u0026#34;: false}\u0026#39; é¢„æœŸçš„å“åº”(ç¾åŒ–äº†æ‰“å°)\n{ \u0026#34;request-id\u0026#34;: \u0026#34;\u0026lt;trigger-id\u0026gt;\u0026#34; } è¯·æ±‚\n# check status of stop action and retrieve savepoint path curl localhost:8081/jobs/\u0026lt;job-id\u0026gt;/savepoints/\u0026lt;trigger-id\u0026gt; é¢„æœŸçš„å“åº”(ç¾åŒ–äº†æ‰“å°)\n{ \u0026#34;status\u0026#34;: { \u0026#34;id\u0026#34;: \u0026#34;COMPLETED\u0026#34; }, \u0026#34;operation\u0026#34;: { \u0026#34;location\u0026#34;: \u0026#34;\u0026lt;savepoint-path\u0026gt;\u0026#34; } } æ­¥éª¤2a: é‡å¯ Jobï¼Œä¸åšä»»ä½•æ”¹å˜\nç°åœ¨ä½ å¯ä»¥ä»è¯¥ä¿å­˜ç‚¹é‡æ–°å¯åŠ¨å‡çº§åçš„ä½œä¸š(Job)ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œä½ å¯ä»¥åœ¨ä¸åšä»»ä½•æ›´æ”¹çš„æƒ…å†µä¸‹é‡æ–°å¯åŠ¨å®ƒã€‚\n CLI  å‘½ä»¤\ndocker-compose run --no-deps client flink run -s \u0026lt;savepoint-path\u0026gt; \\  -d /opt/ClickCountJob.jar \\  --bootstrap.servers kafka:9092 --checkpointing --event-time é¢„æœŸçš„è¾“å‡º\nStarting execution of program Job has been submitted with JobID \u0026lt;job-id\u0026gt;  REST API  è¯·æ±‚\n# Uploading the JAR from the Client container docker-compose run --no-deps client curl -X POST -H \u0026#34;Expect:\u0026#34; \\  -F \u0026#34;jarfile=@/opt/ClickCountJob.jar\u0026#34; http://jobmanager:8081/jars/upload é¢„æœŸçš„å“åº”(ç¾åŒ–äº†æ‰“å°)\n{ \u0026#34;filename\u0026#34;: \u0026#34;/tmp/flink-web-\u0026lt;uuid\u0026gt;/flink-web-upload/\u0026lt;jar-id\u0026gt;\u0026#34;, \u0026#34;status\u0026#34;: \u0026#34;success\u0026#34; } è¯·æ±‚\n# Submitting the Job curl -X POST http://localhost:8081/jars/\u0026lt;jar-id\u0026gt;/run \\  -d \u0026#39;{\u0026#34;programArgs\u0026#34;: \u0026#34;--bootstrap.servers kafka:9092 --checkpointing --event-time\u0026#34;, \u0026#34;savepointPath\u0026#34;: \u0026#34;\u0026lt;savepoint-path\u0026gt;\u0026#34;}\u0026#39; é¢„æœŸçš„è¾“å‡º\n{ \u0026#34;jobid\u0026#34;: \u0026#34;\u0026lt;job-id\u0026gt;\u0026#34; } ä¸€æ—¦ Job å†æ¬¡ RUNNINGï¼Œä½ ä¼šåœ¨ output ä¸»é¢˜ä¸­çœ‹åˆ°ï¼Œå½“ Job åœ¨å¤„ç†ä¸­æ–­æœŸé—´ç§¯ç´¯çš„ç§¯å‹æ—¶ï¼Œè®°å½•ä»¥è¾ƒé«˜çš„é€Ÿåº¦äº§ç”Ÿã€‚æ­¤å¤–ï¼Œä½ ä¼šçœ‹åˆ°åœ¨å‡çº§è¿‡ç¨‹ä¸­æ²¡æœ‰ä¸¢å¤±ä»»ä½•æ•°æ®ï¼šæ‰€æœ‰çª—å£éƒ½å­˜åœ¨ï¼Œæ•°é‡æ­£å¥½æ˜¯ 1000ã€‚\næ­¥éª¤2b: ç”¨ä¸åŒçš„å¹¶è¡Œåº¦é‡æ–°å¯åŠ¨ä½œä¸šï¼ˆé‡æ–°ç¼©æ”¾ï¼‰\nå¦å¤–ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨é‡æ–°æäº¤æ—¶é€šè¿‡ä¼ é€’ä¸åŒçš„å¹¶è¡Œæ€§ï¼Œä»è¿™ä¸ªä¿å­˜ç‚¹é‡æ–°ç¼©æ”¾ä½œä¸šã€‚\n CLI  docker-compose run --no-deps client flink run -p 3 -s \u0026lt;savepoint-path\u0026gt; \\  -d /opt/ClickCountJob.jar \\  --bootstrap.servers kafka:9092 --checkpointing --event-time é¢„æœŸçš„è¾“å‡º\nStarting execution of program Job has been submitted with JobID \u0026lt;job-id\u0026gt;  REST API  è¯·æ±‚\n# Uploading the JAR from the Client container docker-compose run --no-deps client curl -X POST -H \u0026#34;Expect:\u0026#34; \\  -F \u0026#34;jarfile=@/opt/ClickCountJob.jar\u0026#34; http://jobmanager:8081/jars/upload é¢„æœŸçš„å“åº”(ç¾åŒ–äº†æ‰“å°)\n{ \u0026#34;filename\u0026#34;: \u0026#34;/tmp/flink-web-\u0026lt;uuid\u0026gt;/flink-web-upload/\u0026lt;jar-id\u0026gt;\u0026#34;, \u0026#34;status\u0026#34;: \u0026#34;success\u0026#34; } è¯·æ±‚\n# Submitting the Job curl -X POST http://localhost:8081/jars/\u0026lt;jar-id\u0026gt;/run \\  -d \u0026#39;{\u0026#34;parallelism\u0026#34;: 3, \u0026#34;programArgs\u0026#34;: \u0026#34;--bootstrap.servers kafka:9092 --checkpointing --event-time\u0026#34;, \u0026#34;savepointPath\u0026#34;: \u0026#34;\u0026lt;savepoint-path\u0026gt;\u0026#34;}\u0026#39; é¢„æœŸçš„å“åº”(ç¾åŒ–äº†æ‰“å°)\n{ \u0026#34;jobid\u0026#34;: \u0026#34;\u0026lt;job-id\u0026gt;\u0026#34; } ç°åœ¨ï¼Œä½œä¸š(Job)å·²ç»è¢«é‡æ–°æäº¤ï¼Œä½†å®ƒä¸ä¼šå¯åŠ¨ï¼Œå› ä¸ºæ²¡æœ‰è¶³å¤Ÿçš„ TaskSlots åœ¨å¢åŠ çš„å¹¶è¡Œåº¦ä¸‹æ‰§è¡Œå®ƒï¼ˆ2ä¸ªå¯ç”¨ï¼Œéœ€è¦3ä¸ªï¼‰ã€‚ä½¿ç”¨:\ndocker-compose scale taskmanager=2 ä½ å¯ä»¥åœ¨ Flink é›†ç¾¤ä¸­æ·»åŠ ä¸€ä¸ªå¸¦æœ‰ä¸¤ä¸ª TaskSlots çš„ç¬¬äºŒä¸ª TaskManagerï¼Œå®ƒå°†è‡ªåŠ¨æ³¨å†Œåˆ° JobManager ä¸­ã€‚æ·»åŠ  TaskManager åä¸ä¹…ï¼Œè¯¥ä»»åŠ¡(Job)åº”è¯¥å†æ¬¡å¼€å§‹è¿è¡Œã€‚\nä¸€æ—¦ Job å†æ¬¡ \u0026ldquo;RUNNING\u0026rdquo;ï¼Œä½ ä¼šåœ¨ output Topic ä¸­çœ‹åˆ°åœ¨é‡æ–°ç¼©æ”¾è¿‡ç¨‹ä¸­æ²¡æœ‰ä¸¢å¤±æ•°æ®ï¼šæ‰€æœ‰çš„çª—å£éƒ½å­˜åœ¨ï¼Œè®¡æ•°æ­£å¥½æ˜¯ 1000ã€‚\næŸ¥è¯¢ä½œä¸š(Job)çš„æŒ‡æ ‡ JobManager é€šè¿‡å…¶ REST API å…¬å¼€ç³»ç»Ÿå’Œç”¨æˆ·æŒ‡æ ‡ã€‚\nç«¯ç‚¹å–å†³äºè¿™äº›æŒ‡æ ‡çš„èŒƒå›´ã€‚å¯ä»¥é€šè¿‡ jobs/\u0026lt;job-id\u0026gt;/metrics æ¥åˆ—å‡ºä¸€ä¸ªä½œä¸šçš„èŒƒå›´å†…çš„åº¦é‡ã€‚æŒ‡æ ‡çš„å®é™…å€¼å¯ä»¥é€šè¿‡ get query å‚æ•°è¿›è¡ŒæŸ¥è¯¢ã€‚\nè¯·æ±‚\ncurl \u0026quot;localhost:8081/jobs/\u0026lt;jod-id\u0026gt;/metrics?get=lastCheckpointSize\u0026quot; é¢„æœŸçš„å“åº”(ç¾åŒ–äº†æ‰“å°; æ²¡æœ‰å ä½ç¬¦)\n[ { \u0026#34;id\u0026#34;: \u0026#34;lastCheckpointSize\u0026#34;, \u0026#34;value\u0026#34;: \u0026#34;9378\u0026#34; } ] REST API ä¸ä»…å¯ä»¥ç”¨æ¥æŸ¥è¯¢æŒ‡æ ‡ï¼Œè¿˜å¯ä»¥æ£€ç´¢è¿è¡Œä¸­çš„ä½œä¸šçŠ¶æ€çš„è¯¦ç»†ä¿¡æ¯ã€‚\nè¯·æ±‚\n# find the vertex-id of the vertex of interest curl localhost:8081/jobs/\u0026lt;jod-id\u0026gt; é¢„æœŸçš„å“åº”(ç¾åŒ–äº†æ‰“å°)\n{ \u0026#34;jid\u0026#34;: \u0026#34;\u0026lt;job-id\u0026gt;\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;Click Event Count\u0026#34;, \u0026#34;isStoppable\u0026#34;: false, \u0026#34;state\u0026#34;: \u0026#34;RUNNING\u0026#34;, \u0026#34;start-time\u0026#34;: 1564467066026, \u0026#34;end-time\u0026#34;: -1, \u0026#34;duration\u0026#34;: 374793, \u0026#34;now\u0026#34;: 1564467440819, \u0026#34;timestamps\u0026#34;: { \u0026#34;CREATED\u0026#34;: 1564467066026, \u0026#34;FINISHED\u0026#34;: 0, \u0026#34;SUSPENDED\u0026#34;: 0, \u0026#34;FAILING\u0026#34;: 0, \u0026#34;CANCELLING\u0026#34;: 0, \u0026#34;CANCELED\u0026#34;: 0, \u0026#34;RECONCILING\u0026#34;: 0, \u0026#34;RUNNING\u0026#34;: 1564467066126, \u0026#34;FAILED\u0026#34;: 0, \u0026#34;RESTARTING\u0026#34;: 0 }, \u0026#34;vertices\u0026#34;: [ { \u0026#34;id\u0026#34;: \u0026#34;\u0026lt;vertex-id\u0026gt;\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;ClickEvent Source\u0026#34;, \u0026#34;parallelism\u0026#34;: 2, \u0026#34;status\u0026#34;: \u0026#34;RUNNING\u0026#34;, \u0026#34;start-time\u0026#34;: 1564467066423, \u0026#34;end-time\u0026#34;: -1, \u0026#34;duration\u0026#34;: 374396, \u0026#34;tasks\u0026#34;: { \u0026#34;CREATED\u0026#34;: 0, \u0026#34;FINISHED\u0026#34;: 0, \u0026#34;DEPLOYING\u0026#34;: 0, \u0026#34;RUNNING\u0026#34;: 2, \u0026#34;CANCELING\u0026#34;: 0, \u0026#34;FAILED\u0026#34;: 0, \u0026#34;CANCELED\u0026#34;: 0, \u0026#34;RECONCILING\u0026#34;: 0, \u0026#34;SCHEDULED\u0026#34;: 0 }, \u0026#34;metrics\u0026#34;: { \u0026#34;read-bytes\u0026#34;: 0, \u0026#34;read-bytes-complete\u0026#34;: true, \u0026#34;write-bytes\u0026#34;: 5033461, \u0026#34;write-bytes-complete\u0026#34;: true, \u0026#34;read-records\u0026#34;: 0, \u0026#34;read-records-complete\u0026#34;: true, \u0026#34;write-records\u0026#34;: 166351, \u0026#34;write-records-complete\u0026#34;: true } }, { \u0026#34;id\u0026#34;: \u0026#34;\u0026lt;vertex-id\u0026gt;\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;Timestamps/Watermarks\u0026#34;, \u0026#34;parallelism\u0026#34;: 2, \u0026#34;status\u0026#34;: \u0026#34;RUNNING\u0026#34;, \u0026#34;start-time\u0026#34;: 1564467066441, \u0026#34;end-time\u0026#34;: -1, \u0026#34;duration\u0026#34;: 374378, \u0026#34;tasks\u0026#34;: { \u0026#34;CREATED\u0026#34;: 0, \u0026#34;FINISHED\u0026#34;: 0, \u0026#34;DEPLOYING\u0026#34;: 0, \u0026#34;RUNNING\u0026#34;: 2, \u0026#34;CANCELING\u0026#34;: 0, \u0026#34;FAILED\u0026#34;: 0, \u0026#34;CANCELED\u0026#34;: 0, \u0026#34;RECONCILING\u0026#34;: 0, \u0026#34;SCHEDULED\u0026#34;: 0 }, \u0026#34;metrics\u0026#34;: { \u0026#34;read-bytes\u0026#34;: 5066280, \u0026#34;read-bytes-complete\u0026#34;: true, \u0026#34;write-bytes\u0026#34;: 5033496, \u0026#34;write-bytes-complete\u0026#34;: true, \u0026#34;read-records\u0026#34;: 166349, \u0026#34;read-records-complete\u0026#34;: true, \u0026#34;write-records\u0026#34;: 166349, \u0026#34;write-records-complete\u0026#34;: true } }, { \u0026#34;id\u0026#34;: \u0026#34;\u0026lt;vertex-id\u0026gt;\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;ClickEvent Counter\u0026#34;, \u0026#34;parallelism\u0026#34;: 2, \u0026#34;status\u0026#34;: \u0026#34;RUNNING\u0026#34;, \u0026#34;start-time\u0026#34;: 1564467066469, \u0026#34;end-time\u0026#34;: -1, \u0026#34;duration\u0026#34;: 374350, \u0026#34;tasks\u0026#34;: { \u0026#34;CREATED\u0026#34;: 0, \u0026#34;FINISHED\u0026#34;: 0, \u0026#34;DEPLOYING\u0026#34;: 0, \u0026#34;RUNNING\u0026#34;: 2, \u0026#34;CANCELING\u0026#34;: 0, \u0026#34;FAILED\u0026#34;: 0, \u0026#34;CANCELED\u0026#34;: 0, \u0026#34;RECONCILING\u0026#34;: 0, \u0026#34;SCHEDULED\u0026#34;: 0 }, \u0026#34;metrics\u0026#34;: { \u0026#34;read-bytes\u0026#34;: 5085332, \u0026#34;read-bytes-complete\u0026#34;: true, \u0026#34;write-bytes\u0026#34;: 316, \u0026#34;write-bytes-complete\u0026#34;: true, \u0026#34;read-records\u0026#34;: 166305, \u0026#34;read-records-complete\u0026#34;: true, \u0026#34;write-records\u0026#34;: 6, \u0026#34;write-records-complete\u0026#34;: true } }, { \u0026#34;id\u0026#34;: \u0026#34;\u0026lt;vertex-id\u0026gt;\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;ClickEventStatistics Sink\u0026#34;, \u0026#34;parallelism\u0026#34;: 2, \u0026#34;status\u0026#34;: \u0026#34;RUNNING\u0026#34;, \u0026#34;start-time\u0026#34;: 1564467066476, \u0026#34;end-time\u0026#34;: -1, \u0026#34;duration\u0026#34;: 374343, \u0026#34;tasks\u0026#34;: { \u0026#34;CREATED\u0026#34;: 0, \u0026#34;FINISHED\u0026#34;: 0, \u0026#34;DEPLOYING\u0026#34;: 0, \u0026#34;RUNNING\u0026#34;: 2, \u0026#34;CANCELING\u0026#34;: 0, \u0026#34;FAILED\u0026#34;: 0, \u0026#34;CANCELED\u0026#34;: 0, \u0026#34;RECONCILING\u0026#34;: 0, \u0026#34;SCHEDULED\u0026#34;: 0 }, \u0026#34;metrics\u0026#34;: { \u0026#34;read-bytes\u0026#34;: 20668, \u0026#34;read-bytes-complete\u0026#34;: true, \u0026#34;write-bytes\u0026#34;: 0, \u0026#34;write-bytes-complete\u0026#34;: true, \u0026#34;read-records\u0026#34;: 6, \u0026#34;read-records-complete\u0026#34;: true, \u0026#34;write-records\u0026#34;: 0, \u0026#34;write-records-complete\u0026#34;: true } } ], \u0026#34;status-counts\u0026#34;: { \u0026#34;CREATED\u0026#34;: 0, \u0026#34;FINISHED\u0026#34;: 0, \u0026#34;DEPLOYING\u0026#34;: 0, \u0026#34;RUNNING\u0026#34;: 4, \u0026#34;CANCELING\u0026#34;: 0, \u0026#34;FAILED\u0026#34;: 0, \u0026#34;CANCELED\u0026#34;: 0, \u0026#34;RECONCILING\u0026#34;: 0, \u0026#34;SCHEDULED\u0026#34;: 0 }, \u0026#34;plan\u0026#34;: { \u0026#34;jid\u0026#34;: \u0026#34;\u0026lt;job-id\u0026gt;\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;Click Event Count\u0026#34;, \u0026#34;nodes\u0026#34;: [ { \u0026#34;id\u0026#34;: \u0026#34;\u0026lt;vertex-id\u0026gt;\u0026#34;, \u0026#34;parallelism\u0026#34;: 2, \u0026#34;operator\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;operator_strategy\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;ClickEventStatistics Sink\u0026#34;, \u0026#34;inputs\u0026#34;: [ { \u0026#34;num\u0026#34;: 0, \u0026#34;id\u0026#34;: \u0026#34;\u0026lt;vertex-id\u0026gt;\u0026#34;, \u0026#34;ship_strategy\u0026#34;: \u0026#34;FORWARD\u0026#34;, \u0026#34;exchange\u0026#34;: \u0026#34;pipelined_bounded\u0026#34; } ], \u0026#34;optimizer_properties\u0026#34;: {} }, { \u0026#34;id\u0026#34;: \u0026#34;\u0026lt;vertex-id\u0026gt;\u0026#34;, \u0026#34;parallelism\u0026#34;: 2, \u0026#34;operator\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;operator_strategy\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;ClickEvent Counter\u0026#34;, \u0026#34;inputs\u0026#34;: [ { \u0026#34;num\u0026#34;: 0, \u0026#34;id\u0026#34;: \u0026#34;\u0026lt;vertex-id\u0026gt;\u0026#34;, \u0026#34;ship_strategy\u0026#34;: \u0026#34;HASH\u0026#34;, \u0026#34;exchange\u0026#34;: \u0026#34;pipelined_bounded\u0026#34; } ], \u0026#34;optimizer_properties\u0026#34;: {} }, { \u0026#34;id\u0026#34;: \u0026#34;\u0026lt;vertex-id\u0026gt;\u0026#34;, \u0026#34;parallelism\u0026#34;: 2, \u0026#34;operator\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;operator_strategy\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;Timestamps/Watermarks\u0026#34;, \u0026#34;inputs\u0026#34;: [ { \u0026#34;num\u0026#34;: 0, \u0026#34;id\u0026#34;: \u0026#34;\u0026lt;vertex-id\u0026gt;\u0026#34;, \u0026#34;ship_strategy\u0026#34;: \u0026#34;FORWARD\u0026#34;, \u0026#34;exchange\u0026#34;: \u0026#34;pipelined_bounded\u0026#34; } ], \u0026#34;optimizer_properties\u0026#34;: {} }, { \u0026#34;id\u0026#34;: \u0026#34;\u0026lt;vertex-id\u0026gt;\u0026#34;, \u0026#34;parallelism\u0026#34;: 2, \u0026#34;operator\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;operator_strategy\u0026#34;: \u0026#34;\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;ClickEvent Source\u0026#34;, \u0026#34;optimizer_properties\u0026#34;: {} } ] } } è¯·æŸ¥é˜… REST API å‚è€ƒèµ„æ–™ï¼Œäº†è§£å¯èƒ½æŸ¥è¯¢çš„å®Œæ•´åˆ—è¡¨ï¼ŒåŒ…æ‹¬å¦‚ä½•æŸ¥è¯¢ä¸åŒä½œç”¨åŸŸçš„æŒ‡æ ‡ï¼ˆå¦‚ TaskManager æŒ‡æ ‡ï¼‰ã€‚\nå˜ä½“ ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼ŒClick Event Count åº”ç”¨ç¨‹åºæ€»æ˜¯ä»¥ --checkpointing å’Œ --event-time ç¨‹åºå‚æ•°å¯åŠ¨ã€‚é€šè¿‡åœ¨ docker-compose.yaml çš„å®¢æˆ·ç«¯å®¹å™¨çš„å‘½ä»¤ä¸­çœç•¥è¿™äº›ï¼Œä½ å¯ä»¥æ”¹å˜ Job çš„è¡Œä¸ºã€‚\n  --checkpointing å¯ç”¨äº† checkpointï¼Œè¿™æ˜¯ Flink çš„å®¹é”™æœºåˆ¶ã€‚å¦‚æœä½ åœ¨æ²¡æœ‰å®ƒçš„æƒ…å†µä¸‹è¿è¡Œï¼Œå¹¶é€šè¿‡æ•…éšœå’Œæ¢å¤ï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°æ•°æ®å®é™…ä¸Šå·²ç»ä¸¢å¤±äº†ã€‚\n  --event-time å¯ç”¨äº†ä½ çš„ Job çš„äº‹ä»¶æ—¶é—´è¯­ä¹‰ã€‚å½“ç¦ç”¨æ—¶ï¼Œä½œä¸šå°†æ ¹æ®æŒ‚é’Ÿæ—¶é—´è€Œä¸æ˜¯ ClickEvent çš„æ—¶é—´æˆ³å°†äº‹ä»¶åˆ†é…ç»™çª—å£ã€‚å› æ­¤ï¼Œæ¯ä¸ªçª—å£çš„äº‹ä»¶æ•°é‡å°†ä¸å†æ˜¯ç²¾ç¡®çš„ 1000ã€‚\n  Click Event Count åº”ç”¨ç¨‹åºè¿˜æœ‰å¦ä¸€ä¸ªé€‰é¡¹ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯å…³é—­çš„ï¼Œä½ å¯ä»¥å¯ç”¨è¿™ä¸ªé€‰é¡¹æ¥æ¢ç´¢è¿™ä¸ªä½œä¸šåœ¨èƒŒå‹ä¸‹çš„è¡Œä¸ºã€‚ä½ å¯ä»¥åœ¨ docker-compose.yaml çš„å®¢æˆ·ç«¯å®¹å™¨çš„å‘½ä»¤ä¸­æ·»åŠ è¿™ä¸ªé€‰é¡¹ã€‚\n --backpressure åœ¨ä½œä¸šä¸­é—´å¢åŠ äº†ä¸€ä¸ªé¢å¤–çš„ operatorï¼Œåœ¨å¶æ•°åˆ†é’Ÿå†…ä¼šé€ æˆä¸¥é‡çš„èƒŒå‹ï¼ˆä¾‹å¦‚ï¼Œåœ¨10:12æœŸé—´ï¼Œä½†åœ¨10:13æœŸé—´ä¸ä¼šï¼‰ã€‚è¿™å¯ä»¥é€šè¿‡æ£€æŸ¥å„ç§ç½‘ç»œæŒ‡æ ‡ï¼ˆå¦‚ outputQueueLength å’Œ outPoolUsageï¼‰å’Œ/æˆ–ä½¿ç”¨ WebUI ä¸­çš„èƒŒå‹ç›‘æ§æ¥è§‚å¯Ÿã€‚  ","permalink":"https://ohmyweekly.github.io/notes/2020-08-17-flink-operations-playground/","tags":["Flink","Playground"],"title":"Flink æ“ä½œæ¸¸ä¹åœº"},{"categories":["programming"],"contents":"Python API æŒ‡å— æœ¬æ¼”ç»ƒå°†å¿«é€Ÿè®©ä½ å¼€å§‹æ„å»ºä¸€ä¸ªçº¯ Python Flink é¡¹ç›®ã€‚\nå…³äºå¦‚ä½•è®¾ç½® Python æ‰§è¡Œç¯å¢ƒï¼Œè¯·å‚è€ƒ Python Table API å®‰è£…æŒ‡å—ã€‚\nè®¾ç½®ä¸€ä¸ª Python é¡¹ç›® æ‚¨å¯ä»¥å…ˆåˆ›å»ºä¸€ä¸ª Python é¡¹ç›®ï¼Œç„¶åæŒ‰ç…§å®‰è£…æŒ‡å—å®‰è£… PyFlink åŒ…ã€‚\nç¼–å†™ä¸€ä¸ª Flink Python Table API ç¨‹åº Table API åº”ç”¨ç¨‹åºé€šè¿‡å£°æ˜ä¸€ä¸ªè¡¨ç¯å¢ƒå¼€å§‹ï¼›å¯¹äºæ‰¹å¤„ç†åº”ç”¨ç¨‹åºï¼Œå¯ä»¥æ˜¯ BatchTableEvironmentï¼Œå¯¹äºæµå¼åº”ç”¨ç¨‹åºï¼Œå¯ä»¥æ˜¯ StreamTableEnvironmentã€‚è¿™ä½œä¸ºä¸ Flink è¿è¡Œæ—¶äº¤äº’çš„ä¸»è¦å…¥å£ç‚¹ã€‚å®ƒå¯ä»¥ç”¨æ¥è®¾ç½®æ‰§è¡Œå‚æ•°ï¼Œå¦‚é‡å¯ç­–ç•¥ã€é»˜è®¤å¹¶è¡Œåº¦ç­‰ã€‚è¡¨é…ç½®å…è®¸è®¾ç½® Table API çš„å…·ä½“é…ç½®ã€‚\nexec_env = ExecutionEnvironment.get_execution_environment() exec_env.set_parallelism(1) t_config = TableConfig() t_env = BatchTableEnvironment.create(exec_env, t_config) åœ¨åˆ›å»ºçš„è¡¨ç¯å¢ƒä¸­ï¼Œå¯ä»¥å£°æ˜ source/sink è¡¨ã€‚\nt_env.connect(FileSystem().path(\u0026#39;/tmp/input\u0026#39;)) \\ .with_format(OldCsv() .field(\u0026#39;word\u0026#39;, DataTypes.STRING())) \\ .with_schema(Schema() .field(\u0026#39;word\u0026#39;, DataTypes.STRING())) \\ .create_temporary_table(\u0026#39;mySource\u0026#39;) t_env.connect(FileSystem().path(\u0026#39;/tmp/output\u0026#39;)) \\ .with_format(OldCsv() .field_delimiter(\u0026#39;\\t\u0026#39;) .field(\u0026#39;word\u0026#39;, DataTypes.STRING()) .field(\u0026#39;count\u0026#39;, DataTypes.BIGINT())) \\ .with_schema(Schema() .field(\u0026#39;word\u0026#39;, DataTypes.STRING()) .field(\u0026#39;count\u0026#39;, DataTypes.BIGINT())) \\ .create_temporary_table(\u0026#39;mySink\u0026#39;) ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ TableEnvironment.sql_update() æ–¹æ³•æ¥æ³¨å†Œ DDL ä¸­å®šä¹‰çš„ source/sink è¡¨ã€‚\nmy_source_ddl = \u0026#34;\u0026#34;\u0026#34; create table mySource ( word VARCHAR ) with ( \u0026#39;connector.type\u0026#39; = \u0026#39;filesystem\u0026#39;, \u0026#39;format.type\u0026#39; = \u0026#39;csv\u0026#39;, \u0026#39;connector.path\u0026#39; = \u0026#39;/tmp/input\u0026#39; ) \u0026#34;\u0026#34;\u0026#34; my_sink_ddl = \u0026#34;\u0026#34;\u0026#34; create table mySink ( word VARCHAR, `count` BIGINT ) with ( \u0026#39;connector.type\u0026#39; = \u0026#39;filesystem\u0026#39;, \u0026#39;format.type\u0026#39; = \u0026#39;csv\u0026#39;, \u0026#39;connector.path\u0026#39; = \u0026#39;/tmp/output\u0026#39; ) \u0026#34;\u0026#34;\u0026#34; t_env.sql_update(my_source_ddl) t_env.sql_update(my_sink_ddl) è¿™å°†åœ¨æ‰§è¡Œç¯å¢ƒä¸­æ³¨å†Œä¸€ä¸ªåä¸º mySource çš„è¡¨å’Œä¸€ä¸ªåä¸º mySink çš„è¡¨ã€‚è¡¨ mySource åªæœ‰ä¸€åˆ—ï¼Œå³ wordï¼Œå®ƒæ¶ˆè€—ä»æ–‡ä»¶ /tmp/input ä¸­è¯»å–çš„å­—ç¬¦ä¸²ã€‚è¡¨ mySink æœ‰ä¸¤åˆ—ï¼Œåˆ†åˆ«æ˜¯ word å’Œ countï¼Œå°†æ•°æ®å†™å…¥æ–‡ä»¶ /tmp/outputï¼Œç”¨ /t ä½œä¸ºå­—æ®µåˆ†éš”ç¬¦ã€‚\nç°åœ¨ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªä½œä¸š(job)ï¼Œå®ƒä»è¡¨ mySource ä¸­è¯»å–è¾“å…¥ï¼Œé¢„å…ˆæ‰§è¡Œä¸€äº›è½¬æ¢ï¼Œå¹¶å°†ç»“æœå†™å…¥è¡¨ mySinkã€‚\nt_env.from_path(\u0026#39;mySource\u0026#39;) \\ .group_by(\u0026#39;word\u0026#39;) \\ .select(\u0026#39;word, count(1)\u0026#39;) \\ .insert_into(\u0026#39;mySink\u0026#39;) æœ€åä½ å¿…é¡»æ‰§è¡Œå®é™…çš„ Flink Python Table API ä½œä¸šã€‚æ‰€æœ‰çš„æ“ä½œï¼Œå¦‚åˆ›å»ºæºã€è½¬æ¢å’Œ sink éƒ½æ˜¯æ‡’æƒ°çš„ã€‚åªæœ‰å½“ t_env.execute(job_name) è¢«è°ƒç”¨æ—¶ï¼Œä½œä¸šæ‰ä¼šè¢«è¿è¡Œã€‚\nt_env.execute(\u0026#34;tutorial_job\u0026#34;) åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå®Œæ•´çš„ä»£ç å¦‚ä¸‹:\nfrom pyflink.dataset import ExecutionEnvironment from pyflink.table import TableConfig, DataTypes, BatchTableEnvironment from pyflink.table.descriptors import Schema, OldCsv, FileSystem exec_env = ExecutionEnvironment.get_execution_environment() exec_env.set_parallelism(1) t_config = TableConfig() t_env = BatchTableEnvironment.create(exec_env, t_config) t_env.connect(FileSystem().path(\u0026#39;/tmp/input\u0026#39;)) \\ .with_format(OldCsv() .field(\u0026#39;word\u0026#39;, DataTypes.STRING())) \\ .with_schema(Schema() .field(\u0026#39;word\u0026#39;, DataTypes.STRING())) \\ .create_temporary_table(\u0026#39;mySource\u0026#39;) t_env.connect(FileSystem().path(\u0026#39;/tmp/output\u0026#39;)) \\ .with_format(OldCsv() .field_delimiter(\u0026#39;\\t\u0026#39;) .field(\u0026#39;word\u0026#39;, DataTypes.STRING()) .field(\u0026#39;count\u0026#39;, DataTypes.BIGINT())) \\ .with_schema(Schema() .field(\u0026#39;word\u0026#39;, DataTypes.STRING()) .field(\u0026#39;count\u0026#39;, DataTypes.BIGINT())) \\ .create_temporary_table(\u0026#39;mySink\u0026#39;) t_env.from_path(\u0026#39;mySource\u0026#39;) \\ .group_by(\u0026#39;word\u0026#39;) \\ .select(\u0026#39;word, count(1)\u0026#39;) \\ .insert_into(\u0026#39;mySink\u0026#39;) t_env.execute(\u0026#34;tutorial_job\u0026#34;) æ‰§è¡Œ Flink Python Table API ç¨‹åº é¦–å…ˆï¼Œä½ éœ€è¦åœ¨ \u0026ldquo;/tmp/input\u0026rdquo; æ–‡ä»¶ä¸­å‡†å¤‡è¾“å…¥æ•°æ®ã€‚ä½ å¯ä»¥é€‰æ‹©ä»¥ä¸‹å‘½ä»¤è¡Œæ¥å‡†å¤‡è¾“å…¥æ•°æ®ã€‚\n$ echo -e \u0026#34;flink\\npyflink\\nflink\u0026#34; \u0026gt; /tmp/input æ¥ä¸‹æ¥ï¼Œä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸Šè¿è¡Œè¿™ä¸ªä¾‹å­ï¼ˆæ³¨æ„ï¼šå¦‚æœç»“æœæ–‡ä»¶ \u0026ldquo;/tmp/output\u0026rdquo; å·²ç»å­˜åœ¨ï¼Œä½ éœ€è¦åœ¨è¿è¡Œè¿™ä¸ªä¾‹å­ä¹‹å‰åˆ é™¤è¯¥æ–‡ä»¶ï¼‰ã€‚\n$ python WordCount.py è¯¥å‘½ä»¤åœ¨æœ¬åœ°å°å‹é›†ç¾¤ä¸­æ„å»ºå¹¶è¿è¡Œ Python Table API ç¨‹åºã€‚ä½ ä¹Ÿå¯ä»¥å°† Python Table API ç¨‹åºæäº¤åˆ°è¿œç¨‹é›†ç¾¤ï¼Œè¯¦æƒ…å¯ä»¥å‚è€ƒ Job Submission Examplesã€‚\næœ€åï¼Œæ‚¨å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­çœ‹åˆ°æ‰§è¡Œç»“æœã€‚\n$ cat /tmp/output flink\t2 pyflink\t1 è¿™åº”è¯¥å¯ä»¥è®©ä½ å¼€å§‹ç¼–å†™è‡ªå·±çš„ Flink Python Table API ç¨‹åºã€‚è¦äº†è§£æ›´å¤šå…³äº Python Table API çš„ä¿¡æ¯ï¼Œä½ å¯ä»¥å‚è€ƒ Flink Python Table API Docs äº†è§£æ›´å¤šç»†èŠ‚ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-17-python-api-tutorial/","tags":["Flink","Python"],"title":"Python API æŒ‡å—"},{"categories":["programming"],"contents":"Apache Kafka Connector Kafka Consumer val properties = new Properties() properties.setProperty(\u0026#34;bootstrap.servers\u0026#34;, \u0026#34;localhost:9092\u0026#34;) properties.setProperty(\u0026#34;group.id\u0026#34;, \u0026#34;test\u0026#34;) stream = env .addSource(new FlinkKafkaConsumer[String](\u0026#34;topic\u0026#34;, new SimpleStringSchema(), properties)) ","permalink":"https://ohmyweekly.github.io/notes/2020-08-05-connectors-in-flink/","tags":["Flink","Connector"],"title":"Flink ä¸­çš„ Connectors"},{"categories":["programming"],"contents":"æ¨¡å— Julia ä¸­çš„æ¨¡å—æ˜¯ç‹¬ç«‹çš„å˜é‡å·¥ä½œç©ºé—´ï¼Œå³å®ƒä»¬å¼•å…¥äº†ä¸€ä¸ªæ–°çš„å…¨å±€ä½œç”¨åŸŸã€‚å®ƒä»¬åœ¨è¯­æ³•ä¸Šæ˜¯æœ‰åˆ†ç•Œçš„ï¼Œåœ¨ module Name ... end é‡Œé¢ã€‚æ¨¡å—å…è®¸æ‚¨åˆ›å»ºé¡¶å±‚å®šä¹‰ï¼ˆä¹Ÿå°±æ˜¯å…¨å±€å˜é‡ï¼‰ï¼Œè€Œä¸ç”¨æ‹…å¿ƒæ‚¨çš„ä»£ç ä¸åˆ«äººçš„ä»£ç ä¸€èµ·ä½¿ç”¨æ—¶çš„åç§°å†²çªã€‚åœ¨ä¸€ä¸ªæ¨¡å—ä¸­ï¼Œä½ å¯ä»¥æ§åˆ¶å“ªäº›æ¥è‡ªå…¶ä»–æ¨¡å—çš„åå­—æ˜¯å¯è§çš„ï¼ˆé€šè¿‡å¯¼å…¥ï¼‰ï¼Œå¹¶æŒ‡å®šå“ªäº›åå­—æ˜¯è¦å…¬å¼€çš„ï¼ˆé€šè¿‡å¯¼å‡ºï¼‰ã€‚\nä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†æ¨¡å—çš„ä¸»è¦åŠŸèƒ½ã€‚è¿™ä¸ªä¾‹å­å¹¶ä¸æ˜¯ä¸ºäº†è¿è¡Œï¼Œè€Œæ˜¯ä¸ºäº†è¯´æ˜é—®é¢˜ã€‚\nmodule MyModule using Lib using BigLib: thing1, thing2 import Base.show export MyType, foo struct MyType x end bar(x) = 2x foo(a::MyType) = bar(a.x) + 1 show(io::IO, a::MyType) = print(io, \u0026#34;MyType $(a.x)\u0026#34;) end éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªæ ·å¼å¹¶ä¸æ˜¯è¦åœ¨æ¨¡å—çš„æ­£æ–‡ä¸­ç¼©è¿›ï¼Œå› ä¸ºè¿™é€šå¸¸ä¼šå¯¼è‡´æ•´ä¸ªæ–‡ä»¶è¢«ç¼©è¿›ã€‚\nè¿™ä¸ªæ¨¡å—å®šä¹‰äº†ä¸€ä¸ª MyType ç±»å‹å’Œä¸¤ä¸ªå‡½æ•°ã€‚å‡½æ•° foo å’Œ MyType ç±»å‹æ˜¯å¯¼å‡ºçš„ï¼Œå› æ­¤å¯ä»¥å¯¼å…¥åˆ°å…¶ä»–æ¨¡å—ä¸­ã€‚å‡½æ•° bar æ˜¯ MyModule çš„ç§æœ‰å‡½æ•°ã€‚\nusing Lib è¯­å¥æ„å‘³ç€å°†æœ‰ä¸€ä¸ªåä¸º Lib çš„æ¨¡å—å¯ä»¥æ ¹æ®éœ€è¦è§£æåç§°ã€‚å½“é‡åˆ°ä¸€ä¸ªå…¨å±€å˜é‡åœ¨å½“å‰æ¨¡å—ä¸­æ²¡æœ‰å®šä¹‰æ—¶ï¼Œç³»ç»Ÿä¼šåœ¨ Lib å¯¼å‡ºçš„å˜é‡ä¸­æœç´¢å®ƒï¼Œå¦‚æœåœ¨é‚£é‡Œæ‰¾åˆ°äº†ï¼Œå°±ä¼šå¯¼å…¥å®ƒã€‚è¿™æ„å‘³ç€åœ¨å½“å‰æ¨¡å—å†…å¯¹è¯¥å…¨å±€çš„æ‰€æœ‰ä½¿ç”¨éƒ½å°†è§£æä¸ºè¯¥å˜é‡åœ¨ Lib ä¸­çš„å®šä¹‰ã€‚\nusing BigLib: thing1, thing2 è¯­å¥ï¼Œåªå°†æ ‡è¯†ç¬¦ thing1 å’Œ thing2 ä»æ¨¡å— BigLib ä¸­å¸¦å…¥ä½œç”¨åŸŸã€‚å¦‚æœè¿™äº›åç§°æŒ‡çš„æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆå°†ä¸å…è®¸å‘å®ƒä»¬æ·»åŠ æ–¹æ³•ï¼ˆä½ åªèƒ½ \u0026ldquo;ä½¿ç”¨ \u0026ldquo;å®ƒä»¬ï¼Œè€Œä¸æ˜¯æ‰©å±•å®ƒä»¬ï¼‰ã€‚\nimport å…³é”®å­—æ”¯æŒä¸ using ç›¸åŒçš„è¯­æ³•ã€‚import ä¸ using çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œä½¿ç”¨ import å¯¼å…¥çš„å‡½æ•°å¯ä»¥ç”¨æ–°çš„æ–¹æ³•è¿›è¡Œæ‰©å±•ã€‚\nåœ¨ä¸Šé¢çš„ MyModule ä¸­ï¼Œæˆ‘ä»¬æƒ³ç»™æ ‡å‡†çš„ show å‡½æ•°æ·»åŠ ä¸€ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»å†™ import Base.showã€‚åªæœ‰é€šè¿‡ using æ‰èƒ½çœ‹åˆ°åå­—çš„å‡½æ•°ä¸èƒ½è¢«æ‰©å±•ã€‚\nä¸€æ—¦ä¸€ä¸ªå˜é‡é€šè¿‡ using æˆ– import å˜å¾—å¯è§ï¼Œä¸€ä¸ªæ¨¡å—å°±ä¸èƒ½åˆ›å»ºè‡ªå·±çš„åŒåå˜é‡ã€‚å¯¼å…¥çš„å˜é‡æ˜¯åªè¯»çš„ï¼Œåˆ†é…ç»™å…¨å±€å˜é‡æ€»æ˜¯ä¼šå½±å“åˆ°å½“å‰æ¨¡å—æ‰€æ‹¥æœ‰çš„å˜é‡ï¼Œå¦åˆ™ä¼šå¼•å‘é”™è¯¯ã€‚\næ¨¡å—ä½¿ç”¨æƒ…å†µæ¦‚è¿° è¦åŠ è½½ä¸€ä¸ªæ¨¡å—ï¼Œå¯ä»¥ä½¿ç”¨ä¸¤ä¸ªä¸»è¦çš„å…³é”®è¯ï¼šusing å’Œ importã€‚è¦äº†è§£å®ƒä»¬çš„åŒºåˆ«ï¼Œè¯·çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚\nmodule MyModule export x, y x() = \u0026#34;x\u0026#34; y() = \u0026#34;y\u0026#34; p() = \u0026#34;p\u0026#34; end åœ¨è¿™ä¸ªæ¨¡å—ä¸­ï¼Œæˆ‘ä»¬å¯¼å‡ºäº† x å’Œ y å‡½æ•°(ç”¨å…³é”®å­— export)ï¼Œä¹Ÿæœ‰éå¯¼å‡ºçš„å‡½æ•° pï¼Œæœ‰å‡ ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥å°† Module åŠå…¶å†…éƒ¨å‡½æ•°åŠ è½½åˆ°å½“å‰çš„å·¥ä½œç©ºé—´ä¸­ã€‚\n   å¯¼å…¥å‘½ä»¤ å¸¦å…¥å¸¦ä½œç”¨åŸŸä¸­çš„ä¸œè¥¿ å¯ç”¨äºæ–¹æ³•æ‰©å±•     using MyModule æ‰€æœ‰å¯¼å‡ºçš„åå­—(x å’Œ y), MyModule.x, MyModule.y å’Œ MyModule.p MyModule.x, MyModule.y å’Œ MyModule.p   using MyModule: x, p x å’Œ p    import MyModule MyModule.x, MyModule.y å’Œ MyModule.p MyModule.x, MyModule.y å’Œ MyModule.p   import MyModule.x, MyModule.p x å’Œ p x å’Œ p   import MyModule: x, p x å’Œ p x å’Œ p    æ¨¡å—å’Œæ–‡ä»¶ æ–‡ä»¶å’Œæ–‡ä»¶åå¤§å¤šä¸æ¨¡å—æ— å…³ï¼Œæ¨¡å—åªä¸æ¨¡å—è¡¨è¾¾å¼æœ‰å…³ã€‚ä¸€ä¸ªæ¨¡å—å¯ä»¥æœ‰å¤šä¸ªæ–‡ä»¶ï¼Œä¸€ä¸ªæ–‡ä»¶å¯ä»¥æœ‰å¤šä¸ªæ¨¡å—ã€‚\nmodule Foo include(\u0026#34;file1.jl\u0026#34;) include(\u0026#34;file2.jl\u0026#34;) end åœ¨ä¸åŒçš„æ¨¡å—ä¸­åŒ…å«ç›¸åŒçš„ä»£ç ï¼Œæä¾›äº†ç±»ä¼¼ mixin çš„è¡Œä¸ºã€‚äººä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸€ç‚¹æ¥ç”¨ä¸åŒçš„åŸºç¡€å®šä¹‰æ¥è¿è¡Œç›¸åŒçš„ä»£ç ï¼Œä¾‹å¦‚ï¼Œé€šè¿‡ä½¿ç”¨æŸäº›æ“ä½œç¬¦çš„\u0026quot;å®‰å…¨\u0026quot;ç‰ˆæœ¬æ¥æµ‹è¯•ä»£ç ã€‚\nmodule Normal include(\u0026#34;mycode.jl\u0026#34;) end module Testing include(\u0026#34;safe_operators.jl\u0026#34;) include(\u0026#34;mycode.jl\u0026#34;) end æ ‡å‡†æ¨¡å— There are three important standard modules:\nCore åŒ…å«\u0026quot;å†…ç½®äº\u0026quot;è¯­è¨€ä¸­çš„æ‰€æœ‰åŠŸèƒ½ã€‚ Base åŒ…å«å‡ ä¹åœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½æœ‰ç”¨çš„åŸºæœ¬åŠŸèƒ½ã€‚ Main æ˜¯å½“ Julia è¢«å¯åŠ¨æ—¶çš„é¡¶çº§æ¨¡å—å’Œå½“å‰æ¨¡å—ã€‚\né»˜è®¤çš„é¡¶å±‚å®šä¹‰å’Œè£¸æ¨¡å— é™¤äº† using Base ä¹‹å¤–ï¼Œæ¨¡å—è¿˜è‡ªåŠ¨åŒ…å« evalå’Œ include å‡½æ•°çš„å®šä¹‰ï¼Œè¿™äº›å‡½æ•°åœ¨è¯¥æ¨¡å—çš„å…¨å±€ä½œç”¨åŸŸå†…è¯„ä¼°è¡¨è¾¾å¼/æ–‡ä»¶ã€‚\nå¦‚æœä¸æƒ³è¦è¿™äº›é»˜è®¤çš„å®šä¹‰ï¼Œå¯ä»¥ä½¿ç”¨å…³é”®å­— baremodule æ¥ä»£æ›¿å®šä¹‰æ¨¡å—ï¼ˆæ³¨æ„ï¼š Core ä»ç„¶æ˜¯å¯¼å…¥çš„ï¼Œå¦‚ä¸Šæ‰€è¿°ï¼‰ã€‚ä»¥ baremodule æ¥è¯´ï¼Œä¸€ä¸ªæ ‡å‡†çš„æ¨¡å—æ˜¯è¿™æ ·çš„ã€‚\nbaremodule Mod using Base eval(x) = Core.eval(Mod, x) include(p) = Base.include(Mod, p) ... end ç›¸å¯¹å’Œç»å¯¹æ¨¡å—è·¯å¾„ ç»™å®š using Foo è¯­å¥ï¼Œç³»ç»Ÿä¼šæŸ¥è¯¢å†…éƒ¨çš„é¡¶å±‚æ¨¡å—è¡¨ï¼Œå¯»æ‰¾ä¸€ä¸ªåä¸º Foo çš„æ¨¡å—ã€‚å¦‚æœè¯¥æ¨¡å—ä¸å­˜åœ¨ï¼Œç³»ç»Ÿä¼šå°è¯• require(:Foo)ï¼Œè¿™é€šå¸¸ä¼šå¯¼è‡´ä»å®‰è£…çš„åŒ…ä¸­åŠ è½½ä»£ç ã€‚\nç„¶è€Œï¼Œæœ‰äº›æ¨¡å—åŒ…å«å­æ¨¡å—ï¼Œè¿™æ„å‘³ç€ä½ æœ‰æ—¶éœ€è¦è®¿é—®ä¸€ä¸ªéé¡¶å±‚æ¨¡å—ã€‚æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚ç¬¬ä¸€ç§æ˜¯ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œä¾‹å¦‚ using Base.Sortã€‚ç¬¬äºŒç§æ˜¯ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œè¿™æ ·å¯ä»¥æ›´å®¹æ˜“åœ°å¯¼å…¥å½“å‰æ¨¡å—çš„å­æ¨¡å—æˆ–å…¶ä»»ä½•ä¸€ä¸ªå¤–å±‚æ¨¡å—ã€‚\nmodule Parent module Utils ... end using .Utils ... end è¿™é‡Œæ¨¡å— Parent åŒ…å«ä¸€ä¸ªå­æ¨¡å— Utilsï¼ŒParent ä¸­çš„ä»£ç å¸Œæœ› Utils çš„å†…å®¹å¯è§ã€‚è¿™å¯ä»¥é€šè¿‡åœ¨ using è·¯å¾„ä¸­ä½¿ç”¨ç‚¹å·æ¥å®ç°ã€‚æ·»åŠ æ›´å¤šçš„å‰å¯¼ç‚¹å·ä¼šä½¿æ¨¡å—çš„å±‚æ¬¡ç»“æ„ä¸Šå‡ã€‚ä¾‹å¦‚ï¼Œusing ..Utils ä¼šåœ¨ Parent çš„å¤–å±‚æ¨¡å—ä¸­æŸ¥æ‰¾Utilsï¼Œè€Œä¸æ˜¯åœ¨ Parent æœ¬èº«ä¸­æŸ¥æ‰¾ã€‚\næ³¨æ„ç›¸å¯¹å¯¼å…¥é™å®šç¬¦åªåœ¨ä½¿ç”¨å’Œå¯¼å…¥è¯­å¥ä¸­æœ‰æ•ˆã€‚\nå‘½åç©ºé—´æ‚é¡¹ å¦‚æœä¸€ä¸ªåå­—æ˜¯é™å®šçš„(ä¾‹å¦‚ Base.sin)ï¼Œé‚£ä¹ˆå³ä½¿å®ƒæ²¡æœ‰è¢«å¯¼å‡ºï¼Œä¹Ÿå¯ä»¥è¢«è®¿é—®ã€‚è¿™åœ¨è°ƒè¯•æ—¶å¾€å¾€å¾ˆæœ‰ç”¨ã€‚å®ƒä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨é™å®šåä½œä¸ºå‡½æ•°åæ¥æ·»åŠ æ–¹æ³•ã€‚ä½†æ˜¯ï¼Œç”±äºä¼šäº§ç”Ÿè¯­æ³•ä¸Šçš„æ­§ä¹‰ï¼Œå¦‚æœä½ æƒ³ç»™ä¸åŒæ¨¡å—ä¸­çš„ä¸€ä¸ªå‡½æ•°æ·»åŠ æ–¹æ³•ï¼Œè€Œè¿™ä¸ªå‡½æ•°çš„åç§°åªåŒ…å«ç¬¦å·ï¼Œä¾‹å¦‚ä¸€ä¸ªè¿ç®—ç¬¦ï¼ŒBase.+ï¼Œä½ å¿…é¡»ä½¿ç”¨ Base.:+ æ¥å¼•ç”¨å®ƒã€‚å¦‚æœè¿ç®—ç¬¦çš„é•¿åº¦è¶…è¿‡ä¸€ä¸ªå­—ç¬¦ï¼Œä½ å¿…é¡»ç”¨æ‹¬å·æŠŠå®ƒæ‹¬èµ·æ¥ï¼Œæ¯”å¦‚ Base.:(==)ã€‚\nåœ¨å¯¼å…¥å’Œå¯¼å‡ºè¯­å¥ä¸­ï¼Œå®çš„åç§°ç”¨ @ ä¹¦å†™ï¼Œä¾‹å¦‚ import Mod.@macã€‚å…¶ä»–æ¨¡å—ä¸­çš„å®å¯ä»¥ç”¨ Mod.@mac æˆ– @Mod.mac æ¥è°ƒç”¨ã€‚\nè¯­æ³• M.x = y ä¸èƒ½ç”¨äºåˆ†é…å…¶ä»–æ¨¡å—ä¸­çš„å…¨å±€ï¼Œå…¨å±€åˆ†é…æ€»æ˜¯æ¨¡å—-å±€éƒ¨çš„ã€‚\nå˜é‡åå¯ä»¥é€šè¿‡å£°æ˜ä¸º global x æ¥ \u0026ldquo;ä¿ç•™\u0026quot;è€Œä¸åˆ†é…ç»™å®ƒï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢åŠ è½½ååˆå§‹åŒ–çš„ globals çš„åç§°å†²çªã€‚\næ¨¡å—åˆå§‹åŒ–å’Œé¢„ç¼–è¯‘ å¤§å‹æ¨¡å—å¯èƒ½éœ€è¦å‡ ç§’é’Ÿçš„æ—¶é—´æ¥åŠ è½½ï¼Œå› ä¸ºæ‰§è¡Œä¸€ä¸ªæ¨¡å—ä¸­çš„æ‰€æœ‰è¯­å¥å¾€å¾€éœ€è¦ç¼–è¯‘å¤§é‡çš„ä»£ç ã€‚Julia åˆ›å»ºäº†æ¨¡å—çš„é¢„ç¼–è¯‘ç¼“å­˜æ¥å‡å°‘è¿™ä¸ªæ—¶é—´ã€‚\nå½“ä½¿ç”¨ import æˆ– using åŠ è½½æ¨¡å—æ—¶ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºå¹¶ä½¿ç”¨å¢é‡çš„é¢„ç¼–è¯‘æ¨¡å—æ–‡ä»¶ã€‚è¿™å°†å¯¼è‡´å®ƒåœ¨ç¬¬ä¸€æ¬¡å¯¼å…¥æ—¶è‡ªåŠ¨ç¼–è¯‘ã€‚å¦å¤–ï¼Œæ‚¨ä¹Ÿå¯ä»¥æ‰‹åŠ¨è°ƒç”¨ Base.compilecache(modulename)ã€‚ç”±æ­¤äº§ç”Ÿçš„ç¼“å­˜æ–‡ä»¶å°†å­˜å‚¨åœ¨ DEPOT_PATH[1]/compiled/ ä¸­ã€‚éšåï¼Œåªè¦æ¨¡å—çš„ä»»ä½•ä¾èµ–å…³ç³»å‘ç”Ÿå˜åŒ–ï¼Œæ¨¡å—å°±ä¼šåœ¨ using æˆ– import æ—¶è‡ªåŠ¨é‡æ–°ç¼–è¯‘ï¼›ä¾èµ–å…³ç³»æ˜¯æŒ‡å¯¼å…¥çš„æ¨¡å—ã€Julia æ„å»ºçš„æ¨¡å—ã€åŒ…å«çš„æ–‡ä»¶ï¼Œæˆ–è€…æ¨¡å—æ–‡ä»¶ä¸­ include_dependency(path) å£°æ˜çš„æ˜¾å¼ä¾èµ–å…³ç³»ã€‚\nå¯¹äºæ–‡ä»¶ä¾èµ–ï¼Œé€šè¿‡æ£€æŸ¥ç”± include åŠ è½½çš„æ–‡ä»¶æˆ–ç”± include_dependency æ˜¾å¼æ·»åŠ çš„æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´(mtime)æ˜¯å¦ä¿æŒä¸å˜ï¼Œæˆ–è€…æ˜¯å¦ç­‰äºè¢«æˆªæ–­åˆ°æœ€æ¥è¿‘ç§’çš„ä¿®æ”¹æ—¶é—´(ä»¥é€‚åº”æ— æ³•ä»¥äºšç§’çº§ç²¾åº¦å¤åˆ¶ mtime çš„ç³»ç»Ÿ)æ¥ç¡®å®šå˜åŒ–ã€‚å®ƒè¿˜è€ƒè™‘åˆ°åœ¨ require ä¸­æœç´¢é€»è¾‘é€‰æ‹©çš„æ–‡ä»¶è·¯å¾„æ˜¯å¦ä¸åˆ›å»ºé¢„ç¼–è¯‘æ–‡ä»¶çš„è·¯å¾„åŒ¹é…ã€‚å®ƒè¿˜ä¼šè€ƒè™‘åˆ°å·²ç»åŠ è½½åˆ°å½“å‰è¿›ç¨‹ä¸­çš„ä¸€ç»„ä¾èµ–å…³ç³»ï¼Œå³ä½¿è¿™äº›æ¨¡å—çš„æ–‡ä»¶å‘ç”Ÿå˜åŒ–æˆ–æ¶ˆå¤±ï¼Œä¹Ÿä¸ä¼šé‡æ–°ç¼–è¯‘è¿™äº›æ¨¡å—ï¼Œä»¥é¿å…åœ¨è¿è¡Œç³»ç»Ÿå’Œé¢„ç¼–è¯‘ç¼“å­˜ä¹‹é—´äº§ç”Ÿä¸å…¼å®¹çš„æƒ…å†µã€‚\nå¦‚æœä½ çŸ¥é“æŸä¸ªæ¨¡å—é¢„ç¼–è¯‘ä½ çš„æ¨¡å—æ˜¯ä¸å®‰å…¨çš„ï¼ˆä¾‹å¦‚ï¼Œå‡ºäºä¸‹é¢æè¿°çš„åŸå› ä¹‹ä¸€ï¼‰ï¼Œä½ åº”è¯¥åœ¨æ¨¡å—æ–‡ä»¶ä¸­åŠ ä¸Š __precompile__(false)ï¼ˆé€šå¸¸æ”¾åœ¨é¡¶éƒ¨ï¼‰ã€‚è¿™å°†å¯¼è‡´ Base.compilecache æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œå¹¶å°†å¯¼è‡´ using / import ç›´æ¥å°†å…¶åŠ è½½åˆ°å½“å‰è¿›ç¨‹ä¸­è€Œè·³è¿‡é¢„ç¼–è¯‘å’Œç¼“å­˜ã€‚è¿™ä¹Ÿå› æ­¤é˜»æ­¢äº†è¯¥æ¨¡å—è¢«ä»»ä½•å…¶ä»–é¢„ç¼–è¯‘æ¨¡å—å¯¼å…¥ã€‚\næ‚¨å¯èƒ½éœ€è¦æ³¨æ„åˆ›å»ºå¢é‡å…±äº«åº“æ—¶å›ºæœ‰çš„æŸäº›è¡Œä¸ºï¼Œåœ¨ç¼–å†™æ¨¡å—æ—¶å¯èƒ½éœ€è¦æ³¨æ„ã€‚ä¾‹å¦‚ï¼Œå¤–éƒ¨çŠ¶æ€ä¸ä¼šè¢«ä¿å­˜ã€‚ä¸ºäº†é€‚åº”è¿™ä¸€ç‚¹ï¼Œæ˜ç¡®åœ°å°†ä»»ä½•å¿…é¡»åœ¨è¿è¡Œæ—¶å‘ç”Ÿçš„åˆå§‹åŒ–æ­¥éª¤ä¸å¯ä»¥åœ¨ç¼–è¯‘æ—¶å‘ç”Ÿçš„æ­¥éª¤åˆ†å¼€ã€‚ä¸ºæ­¤ï¼ŒJulia å…è®¸æ‚¨åœ¨æ‚¨çš„æ¨¡å—ä¸­å®šä¹‰ä¸€ä¸ª __init__() å‡½æ•°æ¥æ‰§è¡Œä»»ä½•å¿…é¡»åœ¨è¿è¡Œæ—¶å‘ç”Ÿçš„åˆå§‹åŒ–æ­¥éª¤ã€‚è¿™ä¸ªå‡½æ•°åœ¨ç¼–è¯‘æ—¶ä¸ä¼šè¢«è°ƒç”¨ï¼ˆ--output-*ï¼‰ã€‚å®é™…ä¸Šï¼Œä½ å¯ä»¥å‡è®¾å®ƒåœ¨ä»£ç çš„ç”Ÿå‘½å‘¨æœŸä¸­åªè¿è¡Œä¸€æ¬¡ã€‚å½“ç„¶ï¼Œå¦‚æœæœ‰å¿…è¦çš„è¯ï¼Œä½ å¯ä»¥æ‰‹åŠ¨è°ƒç”¨å®ƒï¼Œä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥å‡è®¾è¿™ä¸ªå‡½æ•°å¤„ç†çš„æ˜¯æœ¬åœ°æœºå™¨çš„è®¡ç®—çŠ¶æ€ï¼Œå®ƒä¸éœ€è¦\u0026ndash;ç”šè‡³ä¸åº”è¯¥\u0026ndash;åœ¨ç¼–è¯‘åçš„é•œåƒä¸­æ•è·ã€‚å®ƒå°†åœ¨æ¨¡å—è¢«åŠ è½½åˆ°ä¸€ä¸ªè¿›ç¨‹åè¢«è°ƒç”¨ï¼ŒåŒ…æ‹¬å¦‚æœå®ƒè¢«åŠ è½½åˆ°å¢é‡ç¼–è¯‘ä¸­(--output-incremental=yes)ï¼Œä½†å¦‚æœå®ƒè¢«åŠ è½½åˆ°ä¸€ä¸ªå®Œæ•´çš„ç¼–è¯‘è¿›ç¨‹ä¸­ï¼Œåˆ™ä¸ä¼šè¢«è°ƒç”¨ã€‚\nç‰¹åˆ«æ˜¯ï¼Œå¦‚æœä½ åœ¨ä¸€ä¸ªæ¨¡å—ä¸­å®šä¹‰äº†ä¸€ä¸ª function __init__()ï¼Œé‚£ä¹ˆ Julia å°†åœ¨æ¨¡å—è¢«åŠ è½½åï¼ˆä¾‹å¦‚é€šè¿‡ importã€using æˆ– requireï¼‰åœ¨è¿è¡Œæ—¶ç¬¬ä¸€æ¬¡ç«‹å³è°ƒç”¨ __init__()ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œ__init__ åªè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œè€Œä¸”æ˜¯åœ¨æ¨¡å—ä¸­çš„æ‰€æœ‰è¯­å¥è¢«æ‰§è¡Œåæ‰è¢«è°ƒç”¨ï¼‰ã€‚å› ä¸ºå®ƒæ˜¯åœ¨æ¨¡å—å®Œå…¨å¯¼å…¥ä¹‹åè¢«è°ƒç”¨çš„ï¼Œæ‰€ä»¥ä»»ä½•å­æ¨¡å—æˆ–å…¶å®ƒå¯¼å…¥çš„æ¨¡å—éƒ½ä¼šåœ¨å¤–å±‚æ¨¡å—çš„ __init__ ä¹‹å‰è°ƒç”¨å®ƒä»¬çš„ __init__ å‡½æ•°ã€‚\n__init__ çš„ä¸¤ä¸ªå…¸å‹ç”¨é€”æ˜¯è°ƒç”¨å¤–éƒ¨ C åº“çš„è¿è¡Œæ—¶åˆå§‹åŒ–å‡½æ•°å’Œåˆå§‹åŒ–æ¶‰åŠå¤–éƒ¨åº“è¿”å›æŒ‡é’ˆçš„å…¨å±€å¸¸é‡ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æ­£åœ¨è°ƒç”¨ä¸€ä¸ª C åº“ libfooï¼Œå®ƒè¦æ±‚æˆ‘ä»¬åœ¨è¿è¡Œæ—¶è°ƒç”¨ foo_init() åˆå§‹åŒ–å‡½æ•°ã€‚å‡è®¾æˆ‘ä»¬è¿˜æƒ³å®šä¹‰ä¸€ä¸ªå…¨å±€å¸¸é‡ foo_data_ptrï¼Œç”¨æ¥å­˜æ”¾ libfoo å®šä¹‰çš„ void *foo_data() å‡½æ•°çš„è¿”å›å€¼\u0026ndash;è¿™ä¸ªå¸¸é‡å¿…é¡»åœ¨è¿è¡Œæ—¶ï¼ˆè€Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶ï¼‰åˆå§‹åŒ–ï¼Œå› ä¸ºæŒ‡é’ˆåœ°å€ä¼šéšç€è¿è¡Œè€Œæ”¹å˜ã€‚ä½ å¯ä»¥é€šè¿‡åœ¨ä½ çš„æ¨¡å—ä¸­å®šä¹‰ä¸‹é¢çš„ __init__ å‡½æ•°æ¥å®ç°ã€‚\nconst foo_data_ptr = Ref{Ptr{Cvoid}}(0) function __init__() ccall((:foo_init, :libfoo), Cvoid, ()) foo_data_ptr[] = ccall((:foo_data, :libfoo), Ptr{Cvoid}, ()) nothing end è¯·æ³¨æ„ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥åœ¨å‡½æ•°å†…éƒ¨å®šä¹‰ä¸€ä¸ªå…¨å±€ï¼Œæ¯”å¦‚ __init__ï¼›è¿™æ˜¯ä½¿ç”¨åŠ¨æ€è¯­è¨€çš„ä¼˜åŠ¿ä¹‹ä¸€ã€‚ä½†æ˜¯é€šè¿‡åœ¨å…¨å±€ä½œç”¨åŸŸå†…å®šä¹‰ä¸€ä¸ªå¸¸é‡ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®ä¿ç¼–è¯‘å™¨çŸ¥é“è¿™ä¸ªç±»å‹ï¼Œå¹¶å…è®¸å®ƒç”Ÿæˆæ›´å¥½çš„ä¼˜åŒ–ä»£ç ã€‚æ˜¾ç„¶ï¼Œä½ çš„æ¨¡å—ä¸­ä»»ä½•å…¶ä»–ä¾èµ–äº foo_data_ptr çš„ globals ä¹Ÿå¿…é¡»åœ¨ __init__ ä¸­åˆå§‹åŒ–ã€‚\næ¶‰åŠå¤§å¤šæ•°ä¸æ˜¯ç”± ccall äº§ç”Ÿçš„ Julia å¯¹è±¡çš„å¸¸é‡ä¸éœ€è¦æ”¾åœ¨ __init__ ä¸­ï¼šå®ƒä»¬çš„å®šä¹‰å¯ä»¥è¢«é¢„ç¼–è¯‘å¹¶ä»ç¼“å­˜çš„æ¨¡å—æ˜ åƒä¸­åŠ è½½ã€‚è¿™åŒ…æ‹¬åƒæ•°ç»„è¿™æ ·å¤æ‚çš„å †åˆ†é…å¯¹è±¡ã€‚ç„¶è€Œï¼Œä»»ä½•è¿”å›åŸå§‹æŒ‡é’ˆå€¼çš„ä¾‹ç¨‹éƒ½å¿…é¡»åœ¨è¿è¡Œæ—¶è°ƒç”¨ï¼Œä»¥ä¾¿é¢„ç¼–è¯‘å·¥ä½œï¼ˆPtr å¯¹è±¡å°†å˜æˆç©ºæŒ‡é’ˆï¼Œé™¤éå®ƒä»¬è¢«éšè—åœ¨ isbits å¯¹è±¡ä¸­ï¼‰ã€‚è¿™åŒ…æ‹¬ Julia å‡½æ•° cfunction å’Œ pointer çš„è¿”å›å€¼ã€‚\nå­—å…¸å’Œé›†åˆç±»å‹ï¼Œæˆ–è€…ä¸€èˆ¬æ¥è¯´ä»»ä½•ä¾èµ–äº hash(key) æ–¹æ³•è¾“å‡ºçš„ä¸œè¥¿ï¼Œéƒ½æ˜¯æ¯”è¾ƒæ£˜æ‰‹çš„æƒ…å†µã€‚åœ¨å¸¸è§çš„æƒ…å†µä¸‹ï¼Œé”®æ˜¯æ•°å­—ã€å­—ç¬¦ä¸²ã€ç¬¦å·ã€èŒƒå›´ã€Expr æˆ–è¿™äº›ç±»å‹çš„ç»„åˆï¼ˆé€šè¿‡æ•°ç»„ã€å…ƒç»„ã€é›†åˆã€å¯¹ç­‰ï¼‰ï¼Œå®ƒä»¬å¯ä»¥å®‰å…¨åœ°è¿›è¡Œé¢„ç¼–è¯‘ã€‚ç„¶è€Œï¼Œå¯¹äºå…¶ä»–ä¸€äº›å…³é”®ç±»å‹ï¼Œå¦‚ Function æˆ– DataType å’Œé€šç”¨çš„ç”¨æˆ·å®šä¹‰ç±»å‹ï¼Œåœ¨è¿™äº›ç±»å‹ä¸­ï¼Œä½ æ²¡æœ‰å®šä¹‰ hash æ–¹æ³•ï¼Œå›é€€ hash æ–¹æ³•å–å†³äºå¯¹è±¡çš„å†…å­˜åœ°å€ï¼ˆé€šè¿‡å®ƒçš„ objectidï¼‰ï¼Œå› æ­¤å¯èƒ½ä¼šåœ¨è¿è¡Œæ—¶æ”¹å˜ã€‚å¦‚æœä½ æœ‰è¿™äº›é”®ç±»å‹ä¹‹ä¸€ï¼Œæˆ–è€…å¦‚æœä½ ä¸ç¡®å®šï¼Œä¸ºäº†å®‰å…¨èµ·è§ï¼Œä½ å¯ä»¥åœ¨ä½ çš„ __init__ å‡½æ•°ä¸­åˆå§‹åŒ–è¿™ä¸ªå­—å…¸ã€‚æˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ IdDict å­—å…¸ç±»å‹ï¼Œå®ƒç”±é¢„ç¼–è¯‘ç‰¹åˆ«å¤„ç†ï¼Œæ‰€ä»¥åœ¨ç¼–è¯‘æ—¶åˆå§‹åŒ–æ˜¯å®‰å…¨çš„ã€‚\nåœ¨ä½¿ç”¨é¢„ç¼–è¯‘æ—¶ï¼Œä¿æŒå¯¹ç¼–è¯‘é˜¶æ®µå’Œæ‰§è¡Œé˜¶æ®µçš„æ¸…æ™°è®¤è¯†å¾ˆé‡è¦ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå¾€å¾€ä¼šæ›´æ¸…æ¥šåœ°è®¤è¯†åˆ° Julia æ˜¯ä¸€ä¸ªå…è®¸æ‰§è¡Œä»»æ„ Julia ä»£ç çš„ç¼–è¯‘å™¨ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªåŒæ—¶ç”Ÿæˆç¼–è¯‘ä»£ç çš„ç‹¬ç«‹è§£é‡Šå™¨ã€‚\nå…¶ä»–å·²çŸ¥çš„æ½œåœ¨æ•…éšœæƒ…å†µåŒ…æ‹¬ã€‚\n å…¨å±€è®¡æ•°å™¨ï¼ˆä¾‹å¦‚ï¼Œç”¨äºè¯•å›¾å”¯ä¸€è¯†åˆ«å¯¹è±¡ï¼‰ã€‚è€ƒè™‘ä»¥ä¸‹ä»£ç ç‰‡æ®µã€‚  mutable struct UniquedById myid::Int let counter = 0 UniquedById() = new(counter += 1) end end è™½ç„¶è¿™æ®µä»£ç çš„ç›®çš„æ˜¯ç»™æ¯ä¸ªå®ä¾‹ä¸€ä¸ªå”¯ä¸€çš„ idï¼Œä½†è®¡æ•°å™¨çš„å€¼æ˜¯åœ¨ç¼–è¯‘ç»“æŸæ—¶è®°å½•çš„ã€‚è¿™ä¸ªå¢é‡ç¼–è¯‘æ¨¡å—çš„æ‰€æœ‰åç»­ä½¿ç”¨å°†ä»åŒä¸€ä¸ªè®¡æ•°å™¨å€¼å¼€å§‹ã€‚\nè¯·æ³¨æ„ï¼Œobjectidï¼ˆé€šè¿‡å“ˆå¸Œå†…å­˜æŒ‡é’ˆå·¥ä½œï¼‰ä¹Ÿæœ‰ç±»ä¼¼çš„é—®é¢˜ï¼ˆå‚è§ä¸‹é¢å…³äº Dict ç”¨æ³•çš„è¯´æ˜ï¼‰ã€‚\nä¸€ç§æ›¿ä»£æ–¹æ³•æ˜¯ä½¿ç”¨å®æ¥æ•è· @MODULEï¼Œå¹¶å°†å…¶ä¸å½“å‰çš„è®¡æ•°å™¨å€¼ä¸€èµ·å•ç‹¬å­˜å‚¨ï¼Œç„¶è€Œï¼Œé‡æ–°è®¾è®¡ä»£ç ä½¿å…¶ä¸ä¾èµ–äºè¿™ä¸ªå…¨å±€çŠ¶æ€å¯èƒ½ä¼šæ›´å¥½ã€‚\n å…³è”é›†åˆ(æ¯”å¦‚ Dict å’Œ Set)éœ€è¦åœ¨ __init__ ä¸­é‡æ–°æ´—ç‰Œ(å°†æ¥å¯èƒ½ä¼šæä¾›ä¸€ä¸ªæœºåˆ¶æ¥æ³¨å†Œä¸€ä¸ªåˆå§‹åŒ–å‡½æ•°)ã€‚\n  æ ¹æ®ç¼–è¯‘æ—¶çš„å‰¯ä½œç”¨åœ¨åŠ è½½æ—¶æŒç»­å­˜åœ¨ã€‚ä¾‹å¦‚ï¼šä¿®æ”¹å…¶ä»– Julia æ¨¡å—ä¸­çš„æ•°ç»„æˆ–å…¶ä»–å˜é‡ï¼›ç»´æŠ¤æ‰“å¼€çš„æ–‡ä»¶æˆ–è®¾å¤‡çš„å¥æŸ„ï¼›å­˜å‚¨å…¶ä»–ç³»ç»Ÿèµ„æºï¼ˆåŒ…æ‹¬å†…å­˜ï¼‰çš„æŒ‡é’ˆã€‚\n  é€šè¿‡ç›´æ¥å¼•ç”¨è€Œä¸æ˜¯é€šè¿‡å®ƒçš„æŸ¥æ‰¾è·¯å¾„ï¼Œä»å¦ä¸€ä¸ªæ¨¡å—åˆ›å»ºæ„å¤–çš„å…¨å±€çŠ¶æ€\u0026quot;å‰¯æœ¬\u0026rdquo;ã€‚ä¾‹å¦‚ï¼Œï¼ˆåœ¨å…¨å±€ä½œç”¨åŸŸå†…ï¼‰ã€‚\n  #mystdout = Base.stdout #= will not work correctly, since this will copy Base.stdout into this module =# # instead use accessor functions: getstdout() = Base.stdout #= best option =# # or move the assignment into the runtime: __init__() = global mystdout = Base.stdout #= also works =# å¯¹é¢„ç¼–è¯‘ä»£ç æ—¶å¯ä»¥è¿›è¡Œçš„æ“ä½œè¿›è¡Œäº†ä¸€äº›é¢å¤–çš„é™åˆ¶ï¼Œä»¥å¸®åŠ©ç”¨æˆ·é¿å…å…¶ä»–é”™è¯¯è¡Œä¸ºçš„æƒ…å†µã€‚\n  è°ƒç”¨ eval å¼•èµ·å¦ä¸€ä¸ªæ¨¡å—çš„å‰¯ä½œç”¨ã€‚å½“å¢é‡é¢„ç¼–è¯‘æ ‡å¿—è¢«è®¾ç½®æ—¶ï¼Œè¿™ä¹Ÿä¼šå¯¼è‡´å‘å‡ºè­¦å‘Šã€‚\n  åœ¨ __init__() è¢«å¯åŠ¨åï¼Œä»æœ¬åœ°ä½œç”¨åŸŸè°ƒç”¨ global const è¯­å¥(å‚è§é—®é¢˜ #12010ï¼Œè®¡åˆ’ä¸ºæ­¤å¢åŠ ä¸€ä¸ªé”™è¯¯)\n  åœ¨è¿›è¡Œå¢é‡é¢„ç¼–è¯‘æ—¶ï¼Œæ›¿æ¢ä¸€ä¸ªæ¨¡å—æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶é”™è¯¯ã€‚\n  è¿˜æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ã€‚\n  åœ¨å¯¹æºæ–‡ä»¶æœ¬èº«è¿›è¡Œä¿®æ”¹ä¹‹åï¼Œä¸ä¼šè¿›è¡Œä»£ç é‡è½½/ç¼“å­˜æ— æ•ˆåŒ–ï¼ˆåŒ…æ‹¬é€šè¿‡ Pkg.updateï¼‰ï¼Œè€Œä¸”åœ¨ Pkg.rm ä¹‹åä¹Ÿä¸ä¼šè¿›è¡Œæ¸…ç†ã€‚\n  é¢„ç¼–è¯‘ä¸è€ƒè™‘é‡å¡‘æ•°ç»„çš„å†…å­˜å…±äº«è¡Œä¸º (æ¯ä¸ªè§†å›¾éƒ½æœ‰è‡ªå·±çš„å‰¯æœ¬)\n  æœŸå¾…æ–‡ä»¶ç³»ç»Ÿåœ¨ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶ä¹‹é—´ä¿æŒä¸å˜ï¼Œä¾‹å¦‚ @FILE/source_path() åœ¨è¿è¡Œæ—¶æŸ¥æ‰¾èµ„æºï¼Œæˆ–è€… BinDeps çš„ @checked_lib å®ã€‚æœ‰æ—¶è¿™æ˜¯ä¸å¯é¿å…çš„ã€‚ç„¶è€Œï¼Œåœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œåœ¨ç¼–è¯‘æ—¶å°†èµ„æºå¤åˆ¶åˆ°æ¨¡å—ä¸­æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åšæ³•ï¼Œè¿™æ ·å®ƒä»¬å°±ä¸éœ€è¦åœ¨è¿è¡Œæ—¶è¢«æ‰¾åˆ°ã€‚\n  WeakRef å¯¹è±¡å’Œ finalizers ç›®å‰è¿˜æ²¡æœ‰è¢«åºåˆ—åŒ–å™¨æ­£ç¡®å¤„ç†ï¼ˆè¿™å°†åœ¨å³å°†å‘å¸ƒçš„ç‰ˆæœ¬ä¸­å¾—åˆ°ä¿®æ­£ï¼‰ã€‚\n  é€šå¸¸æœ€å¥½é¿å…æ•è·å¯¹å†…éƒ¨å…ƒæ•°æ®å¯¹è±¡å®ä¾‹çš„å¼•ç”¨ï¼Œå¦‚ Methodã€MethodInstanceã€MethodTableã€TypeMapLevelã€TypeMapEntry ä»¥åŠè¿™äº›å¯¹è±¡çš„å­—æ®µï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šæ··æ·†åºåˆ—åŒ–å™¨ï¼Œå¯èƒ½ä¸ä¼šå¯¼è‡´ä½ æƒ³è¦çš„ç»“æœã€‚è¿™æ ·åšä¸ä¸€å®šä¼šå‡ºé”™ï¼Œä½†ä½ åªéœ€è¦åšå¥½å‡†å¤‡ï¼Œç³»ç»Ÿä¼šå°è¯•å¤åˆ¶å…¶ä¸­çš„ä¸€äº›å¯¹è±¡ï¼Œå¹¶ä¸ºå…¶ä»–å¯¹è±¡åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„å®ä¾‹ã€‚\n  åœ¨æ¨¡å—å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæœ‰æ—¶å…³é—­å¢é‡é¢„ç¼–è¯‘æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚å‘½ä»¤è¡Œæ ‡å¿— --compiled-modules={yes|no} å¯ä»¥è®©ä½ å¼€å¯æˆ–å…³é—­æ¨¡å—é¢„ç¼–è¯‘ã€‚å½“ Julia ä»¥ --compiled-modules=no å¯åŠ¨æ—¶ï¼Œå½“åŠ è½½æ¨¡å—å’Œæ¨¡å—ä¾èµ–æ—¶ï¼Œç¼–è¯‘ç¼“å­˜ä¸­çš„åºåˆ—åŒ–æ¨¡å—ä¼šè¢«å¿½ç•¥ã€‚Base.compilecache ä»ç„¶å¯ä»¥è¢«æ‰‹åŠ¨è°ƒç”¨ã€‚è¿™ä¸ªå‘½ä»¤è¡Œæ ‡å¿—çš„çŠ¶æ€è¢«ä¼ é€’ç»™ Pkg.buildï¼Œä»¥ä¾¿åœ¨å®‰è£…ã€æ›´æ–°å’Œæ˜¾å¼æ„å»ºåŒ…æ—¶ç¦ç”¨è‡ªåŠ¨é¢„ç¼–è¯‘è§¦å‘ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-05-modules-in-julia/","tags":["julia","module"],"title":"Julia ä¸­çš„ æ¨¡å—"},{"categories":["programming"],"contents":"è¿›å…¥ Pkg æ¨¡å¼ Pkg æ˜¯ Julia ä¸­åŒ…ç®¡ç†å·¥å…·ã€‚Pkg æ¥è‡ªäº REPL, åœ¨ Julia çš„ REPL ä¸­æŒ‰ä¸‹ ] å°±è¿›å…¥ Pkg REPL äº†ã€‚è¦å›åˆ° Julia REPL, æŒ‰é€€æ ¼é”®æˆ– ^Cã€‚\nä½¿ç”¨ Pkg add JSON # æ·»åŠ ä¸€ä¸ª package add JSON StaticArrays # æ·»åŠ å¤šä¸ª package rm JSON # ç§»é™¤ä¸€ä¸ª package rm JSON StaticArrays # ç§»é™¤å¤šä¸ª package add https://github.com/JuliaLang/Example.jl # æ·»åŠ ä¸€ä¸ªæœªæ³¨å†Œçš„ package rm Example # æŒ‰åå­—ç§»é™¤ package update Example # å‡çº§ä¸€ä¸ªå·²å®‰è£…çš„ package update # å‡çº§æ‰€æœ‰å·²å®‰è£…çš„ package environments ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ° Pkg REPL æç¤ºç¬¦å‰é¢çš„ (@v1.5) å­—ç¬¦ä¸²äº†ã€‚è¿™é‡Œçš„ (@v1.5) å°±æ˜¯æ¿€æ´»ç¯å¢ƒ(active environment)ã€‚æ¿€æ´»ç¯å¢ƒæ˜¯èƒ½è¢«è¯¸å¦‚ addã€rm å’Œ update ç­‰ Pkg å‘½ä»¤ä¿®æ”¹çš„ç¯å¢ƒã€‚\næˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªæ–°çš„æ¿€æ´»ç¯å¢ƒç”¨äºå®éªŒã€‚è¦è®¾ç½®æ¿€æ´»ç¯å¢ƒ, ä½¿ç”¨ activate:\n(@v1.5) pkg\u0026gt; activate tutorial Activating new environment at `~/tutorial/Project.toml` ~/tutorial/Project.toml æ˜¯æ¿€æ´»ç¯å¢ƒçš„é¡¹ç›®æ–‡ä»¶ã€‚é¡¹ç›®æ–‡ä»¶æ˜¯ Pkg å­˜å‚¨ç¯å¢ƒçš„å…ƒæ•°æ®çš„åœ°æ–¹ã€‚\n(tutorial) pkg\u0026gt; status Status `~/tutorial/Project.toml` (empty project) ç°åœ¨è¿™ä¸ªæ–°çš„ç¯å¢ƒæ˜¯ç©ºçš„, æˆ‘ä»¬æ·»åŠ ä¸€ä¸ª package è§‚å¯Ÿä¸‹:\n(tutorial) pkg\u0026gt; add Example Updating registry at `~/.julia/registries/General` Updating git-repo `https://github.com/JuliaRegistries/General.git` Resolving package versions... Cloning [7876af07-990d-54b4-ab0e-23690620f79a] Example from https://github.com/JuliaLang/Example.jl.git Installed Example â”€ v0.5.3 Updating `~/tutorial/Project.toml` [7876af07] + Example v0.5.3 Updating `~/tutorial/Manifest.toml` [7876af07] + Example v0.5.3 ç”¨ status å‘½ä»¤æŸ¥çœ‹æ¿€æ´»ç¯å¢ƒçš„ä¿¡æ¯:\n(tutorial) pkg\u0026gt; status Status `~/tutorial/Project.toml` [7876af07] Example v0.5.3 ä½¿ç”¨ develop å‘½ä»¤è®¾ç½® Example package çš„ ä¸€ä¸ª git clone, ä»¥ä¾›æˆ‘ä»¬ä¿®æ”¹è¿™ä¸ªæœ¬åœ°ä»“åº“:\n(tutorial) pkg\u0026gt; develop --local Example Cloning git-repo `https://github.com/JuliaLang/Example.jl.git` Resolving package versions... Updating `~/tutorial/Project.toml` [7876af07] ~ Example v0.5.3 â‡’ v0.5.4 `dev/Example` Updating `~/tutorial/Manifest.toml` [7876af07] ~ Example v0.5.3 â‡’ v0.5.4 `dev/Example` ç”¨ ; åˆ‡æ¢åˆ° shell æ¨¡å¼, ç”¨ vi ä¿®æ”¹ ~/tutorial/dev/Example/src/Example.jl æ–‡ä»¶, å¢åŠ ä¸€ä¸ª plusone å‡½æ•°, ä¿å­˜ã€‚\nåœ¨ Julia çš„ REPL ä¸­, å¯¼å…¥ä¿®æ”¹åçš„ Example package:\njulia\u0026gt; import Example [ Info: Precompiling Example [7876af07-990d-54b4-ab0e-23690620f79a] julia\u0026gt; Example.plusone(1) 2 julia\u0026gt; Example.plusone(4) 5 å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ·»åŠ çš„å‡½æ•°ç”Ÿæ•ˆäº†, è¿™æ ·å°±å¾ˆæ–¹ä¾¿æˆ‘ä»¬æ·»åŠ æµ‹è¯•æ–°åŠŸèƒ½ã€‚å¦‚æœæˆ‘ä»¬å·²ç»ä¸å†éœ€è¦æœ¬åœ°çš„ Example äº†, éœ€è¦ä½¿ç”¨ free å‘½ä»¤ä»¥åœæ­¢ä½¿ç”¨æœ¬åœ°å…‹éš†çš„ package, è½¬è€Œä½¿ç”¨å·²æ³¨å†Œç‰ˆæœ¬ä»£æ›¿:\n(tutorial) pkg\u0026gt; free Example Resolving package versions... Updating `~/tutorial/Project.toml` [7876af07] ~ Example v0.5.4 `dev/Example` â‡’ v0.5.3 Updating `~/tutorial/Manifest.toml` [7876af07] ~ Example v0.5.4 `dev/Example` â‡’ v0.5.3 å¦‚æœå·²ç»ç”¨ tutorial åšå®Œå®éªŒäº†, å¯ä»¥ä½¿ç”¨ä¸å¸¦å‚æ•°çš„ activate å›åˆ°é»˜è®¤ç¯å¢ƒ:\n(tutorial) pkg\u0026gt; activate Activating environment at `~/.julia/environments/v1.5/Project.toml` (@v1.5) pkg\u0026gt; ","permalink":"https://ohmyweekly.github.io/notes/2020-08-04-pkg-in-julia/","tags":["julia","pkg"],"title":"Julia ä¸­çš„ Pkg"},{"categories":["programming"],"contents":"Dates æ¨¡å—çš„åŠ è½½å’Œä½¿ç”¨ åœ¨ Julia çš„ Pkg REPL ä¸­, è¾“å…¥ add Dates æ·»åŠ  Dates æ¨¡å—ã€‚å›åˆ° Julia çš„ REPL ä¸­, è¾“å…¥:\njulia\u0026gt; using Dates julia\u0026gt; DateTime(2020) 2020-01-01T00:00:00 julia\u0026gt; typeof(DateTime(2020)) DateTime julia\u0026gt; DateTime(2020,8,1) 2020-08-01T00:00:00 julia\u0026gt; DateTime(2020,8,1,12) 2020-08-01T12:00:00 julia\u0026gt; DateTime(2020,8,1,12,30) 2020-08-01T12:30:00 julia\u0026gt; DateTime(2020,8,1,12,30,59) 2020-08-01T12:30:59 julia\u0026gt; DateTime(2020,8,1,12,30,59, 999) 2020-08-01T12:30:59.999 julia\u0026gt; Date(2020, 8) 2020-08-01 julia\u0026gt; Date(2020, 8, 1) 2020-08-01 julia\u0026gt; Date(Dates.Year(2020),Dates.Month(8),Dates.Day(1)) 2020-08-01 julia\u0026gt; Date(Dates.Month(8),Dates.Year(2020)) 2020-08-01 Date å’Œ DateTime çš„ç®—æœ¯æ“ä½œ julia\u0026gt; dt = Date(2012,2,29) 2012-02-29 julia\u0026gt; dt2 = Date(2000,2,1) 2000-02-01 julia\u0026gt; dump(dt) Date instant: Dates.UTInstant{Day} periods: Day value: Int64 734562 julia\u0026gt; dump(dt2) Date instant: Dates.UTInstant{Day} periods: Day value: Int64 730151 julia\u0026gt; dt \u0026gt; dt2 true julia\u0026gt; dt != dt2 true julia\u0026gt; dt + dt2 ERROR: MethodError: no method matching +(::Date, ::Date) [...] julia\u0026gt; dt * dt2 ERROR: MethodError: no method matching *(::Date, ::Date) [...] julia\u0026gt; dt / dt2 ERROR: MethodError: no method matching /(::Date, ::Date) julia\u0026gt; dt - dt2 4411 days julia\u0026gt; typeof(dt - dt2) Day julia\u0026gt; dt2 - dt -4411 days julia\u0026gt; dt = DateTime(2012,2,29) 2012-02-29T00:00:00 julia\u0026gt; dt2 = DateTime(2000,2,1) 2000-02-01T00:00:00 julia\u0026gt; dt - dt2 381110400000 milliseconds julia\u0026gt; typeof(dt - dt2) Millisecond è®¿é—®å™¨å‡½æ•° å› ä¸º Date å’Œ DateTime ç±»å‹è¢«å­˜å‚¨ä¸ºå•ä¸ª Int64 å€¼ï¼Œæ‰€ä»¥æ—¥æœŸéƒ¨åˆ†æˆ–å­—æ®µå¯ä»¥é€šè¿‡è®¿é—®å™¨å‡½æ•°è¿›è¡Œæ£€ç´¢ã€‚å°å†™è®¿é—®å™¨å‡½æ•°ä»¥æ•´æ•°å½¢å¼è¿”å›å­—æ®µã€‚\njulia\u0026gt; t = Date(2014, 1, 31) 2014-01-31 julia\u0026gt; Dates.year(t) 2014 julia\u0026gt; Dates.month(t) 1 julia\u0026gt; Dates.week(t) 5 julia\u0026gt; Dates.day(t) 31 è€Œä¸“æœ‰å½¢å¼è¿”å›ç›¸åº” Period ç±»å‹ä¸­çš„ç›¸åŒå€¼ã€‚\njulia\u0026gt; Dates.Year(t) 2014 years julia\u0026gt; Dates.Day(t) 31 days Julia è¿˜æä¾›äº†å¤åˆæ–¹æ³•ï¼Œå› ä¸ºåœ¨åŒæ—¶éœ€è¦å¤šä¸ªå­—æ®µçš„æƒ…å†µä¸‹ï¼Œè¿™äº›æ–¹æ³•æä¾›äº†ä¸€ç§æ•ˆç‡è¡¡é‡æ ‡å‡†ã€‚\njulia\u0026gt; Dates.yearmonth(t) (2014, 1) julia\u0026gt; Dates.monthday(t) (1, 31) julia\u0026gt; Dates.yearmonthday(t) (2014, 1, 31) ä¹Ÿå¯ä»¥è®¿é—®åº•å±‚ UTInstant æˆ–æ•´æ•°å€¼ã€‚\njulia\u0026gt; dump(t) Date instant: Dates.UTInstant{Day} periods: Day value: Int64 735264 julia\u0026gt; t.instant Dates.UTInstant{Day}(Day(735264)) julia\u0026gt; Dates.value(t) 735264 æŸ¥è¯¢å‡½æ•° æŸ¥è¯¢å‡½æ•°æä¾›å…³äº TimeType çš„å†æ³•ä¿¡æ¯ã€‚å®ƒä»¬åŒ…æ‹¬å…³äºä¸€å‘¨ä¸­çš„æŸä¸€å¤©çš„ä¿¡æ¯ã€‚\njulia\u0026gt; t = Date(2014, 1, 31) 2014-01-31 julia\u0026gt; Dates.dayofweek(t) 5 julia\u0026gt; Dates.dayname(t) \u0026#34;Friday\u0026#34; julia\u0026gt; Dates.dayofweekofmonth(t) # 5th Friday of January 5 julia\u0026gt; Dates.monthname(t) \u0026#34;January\u0026#34; julia\u0026gt; Dates.daysinmonth(t) 31 ä»¥åŠ TimeType çš„å¹´ä»½å’Œå­£åº¦ä¿¡æ¯ã€‚\njulia\u0026gt; Dates.isleapyear(t) false julia\u0026gt; Dates.dayofyear(t) 31 julia\u0026gt; Dates.quarterofyear(t) 1 julia\u0026gt; Dates.dayofquarter(t) 31 dayname å’Œ monthname æ–¹æ³•ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå¯é€‰çš„ locale å…³é”®å­—ï¼Œå®ƒå¯ä»¥ç”¨æ¥è¿”å›å…¶ä»–è¯­è¨€/åœ°åŒºçš„å¹´ä»½æˆ–æœˆä»½çš„åç§°ã€‚è¿™äº›å‡½æ•°ä¹Ÿæœ‰è¿”å›ç¼©å†™åç§°çš„ç‰ˆæœ¬ï¼Œå³ dayabbr å’Œ monthabbrã€‚é¦–å…ˆå°†æ˜ å°„åŠ è½½åˆ° LOCALES å˜é‡ä¸­ã€‚\njulia\u0026gt; french_months = [\u0026#34;janvier\u0026#34;, \u0026#34;fÃ©vrier\u0026#34;, \u0026#34;mars\u0026#34;, \u0026#34;avril\u0026#34;, \u0026#34;mai\u0026#34;, \u0026#34;juin\u0026#34;, \u0026#34;juillet\u0026#34;, \u0026#34;aoÃ»t\u0026#34;, \u0026#34;septembre\u0026#34;, \u0026#34;octobre\u0026#34;, \u0026#34;novembre\u0026#34;, \u0026#34;dÃ©cembre\u0026#34;]; julia\u0026gt; french_monts_abbrev = [\u0026#34;janv\u0026#34;,\u0026#34;fÃ©vr\u0026#34;,\u0026#34;mars\u0026#34;,\u0026#34;avril\u0026#34;,\u0026#34;mai\u0026#34;,\u0026#34;juin\u0026#34;, \u0026#34;juil\u0026#34;,\u0026#34;aoÃ»t\u0026#34;,\u0026#34;sept\u0026#34;,\u0026#34;oct\u0026#34;,\u0026#34;nov\u0026#34;,\u0026#34;dÃ©c\u0026#34;]; julia\u0026gt; french_days = [\u0026#34;lundi\u0026#34;,\u0026#34;mardi\u0026#34;,\u0026#34;mercredi\u0026#34;,\u0026#34;jeudi\u0026#34;,\u0026#34;vendredi\u0026#34;,\u0026#34;samedi\u0026#34;,\u0026#34;dimanche\u0026#34;]; julia\u0026gt; Dates.LOCALES[\u0026#34;french\u0026#34;] = Dates.DateLocale(french_months, french_monts_abbrev, french_days, [\u0026#34;\u0026#34;]); ç„¶åå¯ä»¥åˆ©ç”¨ä¸Šè¿°å‡½æ•°è¿›è¡ŒæŸ¥è¯¢ã€‚\njulia\u0026gt; Dates.dayname(t;locale=\u0026#34;french\u0026#34;) \u0026#34;vendredi\u0026#34; julia\u0026gt; Dates.monthname(t;locale=\u0026#34;french\u0026#34;) \u0026#34;janvier\u0026#34; julia\u0026gt; Dates.monthabbr(t;locale=\u0026#34;french\u0026#34;) \u0026#34;janv\u0026#34; ç”±äºæ²¡æœ‰åŠ è½½æ—¥æœŸçš„ç¼©å†™ç‰ˆæœ¬ï¼Œè¯•å›¾ä½¿ç”¨å‡½æ•° dayabbr ä¼šå‡ºé”™ã€‚\njulia\u0026gt; Dates.dayabbr(t;locale=\u0026#34;french\u0026#34;) ERROR: BoundsError: attempt to access 1-element Array{String,1} at index [5] Stacktrace: [...] æ—¶é—´ç±»å‹-å‘¨æœŸç®—æœ¯ åœ¨ä½¿ç”¨ä»»ä½•è¯­è¨€/æ—¥æœŸæ¡†æ¶æ—¶ï¼Œç†Ÿæ‚‰å¦‚ä½•å¤„ç†æ—¥æœŸ-å‘¨æœŸç®—æœ¯æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„åšæ³•ï¼Œå› ä¸ºæœ‰ä¸€äº›æ£˜æ‰‹çš„é—®é¢˜éœ€è¦å¤„ç†ï¼ˆå°½ç®¡å¯¹äºæ—¥-ç²¾åº¦ç±»å‹æ¥è¯´è¦å°‘å¾—å¤šï¼‰ã€‚\nDates æ¨¡å—çš„æ–¹æ³•è¯•å›¾éµå¾ªç®€å•çš„åŸåˆ™ï¼Œå³åœ¨åš Period ç®—æœ¯æ—¶å°½é‡å°‘æ”¹ã€‚è¿™ç§æ–¹æ³•ä¹Ÿå¸¸è¢«ç§°ä¸ºå†æ³•ç®—æœ¯ï¼Œæˆ–è€…è¯´å¦‚æœæœ‰äººåœ¨å¯¹è¯ä¸­é—®ä½ åŒæ ·çš„è®¡ç®—æ–¹æ³•ï¼Œä½ å¯èƒ½ä¼šçŒœåˆ°ã€‚ä¸ºä»€ä¹ˆè¦å¤§æƒŠå°æ€ªå‘¢ï¼Ÿæˆ‘ä»¬ä¸¾ä¸ªç»å…¸çš„ä¾‹å­ï¼šæŠŠ2014å¹´1æœˆ31æ—¥åŠ 1ä¸ªæœˆã€‚ç­”æ¡ˆæ˜¯ä»€ä¹ˆï¼ŸJavascript ä¼šè¯´3æœˆ3æ—¥ï¼ˆå‡è®¾31å¤©ï¼‰ã€‚PHP ä¼šè¯´3æœˆ2æ—¥ï¼ˆå‡è®¾30å¤©ï¼‰ã€‚äº‹å®ä¸Šï¼Œæ²¡æœ‰æ­£ç¡®çš„ç­”æ¡ˆã€‚åœ¨ Dates æ¨¡å—ä¸­ï¼Œå®ƒç»™å‡ºçš„ç»“æœæ˜¯2æœˆ28æ—¥ã€‚å®ƒæ˜¯å¦‚ä½•è®¡ç®—å‡ºæ¥çš„å‘¢ï¼Ÿæˆ‘å–œæ¬¢æƒ³åˆ°èµŒåœºé‡Œç»å…¸çš„ 7-7-7 èµŒåšæ¸¸æˆã€‚\nç°åœ¨åªè¦æƒ³è±¡ä¸€ä¸‹ï¼Œè€è™æœºä¸æ˜¯ 7-7-7ï¼Œè€Œæ˜¯å¹´-æœˆ-æ—¥ï¼Œæˆ–è€…åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œ2014-01-31ã€‚å½“ä½ è¦æ±‚åœ¨è¿™ä¸ªæ—¥æœŸçš„åŸºç¡€ä¸Šå¢åŠ 1ä¸ªæœˆçš„æ—¶å€™ï¼Œæœˆä»½æ§½å°±ä¼šé€’å¢ï¼Œæ‰€ä»¥ç°åœ¨æˆ‘ä»¬æœ‰ 2014-02-31ã€‚ç„¶åæ£€æŸ¥æ—¥å·æ˜¯å¦å¤§äºæ–°æœˆä»½çš„æœ€åæœ‰æ•ˆæ—¥ï¼Œå¦‚æœå¤§äºï¼ˆå¦‚ä¸Šä¾‹ï¼‰ï¼Œåˆ™æ—¥å·å‘ä¸‹è°ƒæ•´åˆ°æœ€åæœ‰æ•ˆæ—¥ï¼ˆ28ï¼‰ã€‚è¿™ç§æ–¹æ³•çš„åæœæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿç»§ç»­åœ¨æˆ‘ä»¬çš„æ—¥æœŸä¸Šå†åŠ ä¸€ä¸ªæœˆï¼Œ2014-02-28 + Month(1) == 2014-03-28ã€‚ä»€ä¹ˆï¼Ÿä½ æ˜¯åœ¨æœŸå¾…3æœˆçš„æœ€åä¸€å¤©å—ï¼Ÿä¸å¯¹ï¼Œå¯¹ä¸èµ·ï¼Œè®°å¾— 7-7-7 çš„æ¡£æœŸã€‚å°½å¯èƒ½å°‘çš„æ§½ä½è¦æ”¹å˜ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæŠŠæœˆä»½æ§½ä½é€’å¢1ï¼Œ2014-03-28ï¼Œè½°ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ—¥æœŸã€‚å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæˆ‘ä»¬è¦åœ¨åŸæ¥çš„æ—¥æœŸ 2014-01-31 çš„åŸºç¡€ä¸Šå¢åŠ 2ä¸ªæœˆï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ€ç»ˆçš„ç»“æœæ˜¯ 2014-03-31ï¼Œæ­£å¦‚é¢„æœŸçš„é‚£æ ·ã€‚è¿™ç§æ–¹æ³•çš„å¦ä¸€ä¸ªåæœæ˜¯ï¼Œå½“å¼ºè¡Œè¿›è¡Œç‰¹å®šçš„æ’åºæ—¶ï¼Œå…³è”æ€§ä¼šæœ‰æ‰€æŸå¤±ï¼ˆå³ä»¥ä¸åŒçš„é¡ºåºæ·»åŠ ä¸œè¥¿ä¼šå¯¼è‡´ä¸åŒçš„ç»“æœï¼‰ã€‚æ¯”å¦‚è¯´ï¼š\njulia\u0026gt; (Date(2014,1,29)+Dates.Day(1)) + Dates.Month(1) 2014-02-28 julia\u0026gt; (Date(2014,1,29)+Dates.Month(1)) + Dates.Day(1) 2014-03-01 é‚£æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿåœ¨ç¬¬ä¸€è¡Œä¸­ï¼Œæˆ‘ä»¬åœ¨1æœˆ29æ—¥çš„åŸºç¡€ä¸ŠåŠ 1å¤©ï¼Œç»“æœæ˜¯ 2014-01-30ï¼›ç„¶åå†åŠ 1ä¸ªæœˆï¼Œäºæ˜¯å¾—åˆ° 2014-02-30ï¼Œå†å¾€ä¸‹è°ƒæ•´ä¸º 2014-02-28ã€‚åœ¨ç¬¬äºŒä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å…ˆåŠ 1ä¸ªæœˆï¼Œæˆ‘ä»¬å¾—åˆ° 2014-02-29ï¼Œå†å¾€ä¸‹è°ƒæ•´ä¸º 2014-02-28ï¼Œç„¶åå†åŠ 1å¤©ï¼Œç»“æœæ˜¯ 2014-03-01ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰ä¸€ä¸ªè®¾è®¡åŸåˆ™æ˜¯æœ‰å¸®åŠ©çš„ï¼Œé‚£å°±æ˜¯åœ¨å­˜åœ¨å¤šä¸ª Periods çš„æƒ…å†µä¸‹ï¼Œæ“ä½œå°†æŒ‰ç…§ Periods çš„ç±»å‹æ¥æ’åºï¼Œè€Œä¸æ˜¯æŒ‰ç…§å®ƒä»¬çš„å€¼æˆ–ä½ç½®é¡ºåºæ¥æ’åºï¼›è¿™æ„å‘³ç€æ€»æ˜¯å…ˆåŠ  Yearï¼Œç„¶ååŠ  Monthï¼Œå†åŠ  Week ç­‰ã€‚å› æ­¤ï¼Œä»¥ä¸‹ç¡®å®ä¼šå¯¼è‡´å…³è”æ€§å¹¶æ­£å¥½æœ‰ç”¨:\njulia\u0026gt; Date(2014,1,29) + Dates.Day(1) + Dates.Month(1) 2014-03-01 julia\u0026gt; Date(2014,1,29) + Dates.Month(1) + Dates.Day(1) 2014-03-01 æ£˜æ‰‹å—ï¼Ÿä¹Ÿè®¸å§ã€‚ä¸€ä¸ªæ— è¾œçš„ Dates ç”¨æˆ·è¯¥æ€ä¹ˆåšï¼Ÿæœ€é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œå½“å¤„ç†æœˆä»½æ—¶ï¼Œæ˜ç¡®åœ°å¼ºåˆ¶æ‰§è¡ŒæŸç§å…³è”æ€§ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›æ„æƒ³ä¸åˆ°çš„ç»“æœï¼Œä½†é™¤æ­¤ä¹‹å¤–ï¼Œä¸€åˆ‡éƒ½åº”è¯¥æŒ‰ç…§é¢„æœŸå·¥ä½œã€‚å€¼å¾—åº†å¹¸çš„æ˜¯ï¼Œåœ¨ UT ä¸­å¤„ç†æ—¶é—´æ—¶ï¼Œæ—¥æœŸ-å‘¨æœŸç®—æœ¯ä¸­çš„å¥‡ç‰¹æƒ…å†µå‡ ä¹å°±æ˜¯è¿™æ ·äº†ï¼ˆé¿å…äº†å¤„ç†å¤ä»¤æ—¶ã€é—°ç§’ç­‰çš„ \u0026ldquo;ä¹è¶£\u0026rdquo;ï¼‰ã€‚\nä½œä¸ºå¥–åŠ±ï¼Œæ‰€æœ‰çš„å‘¨æœŸç®—æœ¯å¯¹è±¡éƒ½å¯ä»¥ç›´æ¥ä¸èŒƒå›´ä¸€èµ·å·¥ä½œã€‚\njulia\u0026gt; dr = Date(2014,1,29):Day(1):Date(2014,2,3) Date(\u0026#34;2014-01-29\u0026#34;):Day(1):Date(\u0026#34;2014-02-03\u0026#34;) julia\u0026gt; collect(dr) 6-element Array{Date,1}: 2014-01-29 2014-01-30 2014-01-31 2014-02-01 2014-02-02 2014-02-03 julia\u0026gt; dr = Date(2014,1,29):Dates.Month(1):Date(2014,07,29) Date(\u0026#34;2014-01-29\u0026#34;):Month(1):Date(\u0026#34;2014-07-29\u0026#34;) julia\u0026gt; collect(dr) 7-element Array{Date,1}: 2014-01-29 2014-02-28 2014-03-29 2014-04-29 2014-05-29 2014-06-29 2014-07-29 for i in Date(\u0026quot;2020-08-01\u0026quot;):Day(1):Date(\u0026quot;2020-08-09\u0026quot;) println(i) end 2020-08-01 2020-08-02 2020-08-03 2020-08-04 2020-08-05 2020-08-06 2020-08-07 2020-08-08 2020-08-09 è°ƒæ•´å™¨å‡½æ•° å°½ç®¡æ—¥æœŸ-å‘¨æœŸç®—æœ¯å¾ˆæ–¹ä¾¿ï¼Œä½†ç»å¸¸éœ€è¦åœ¨æ—¥æœŸä¸Šè¿›è¡Œçš„è®¡ç®—å…·æœ‰æ—¥å†æˆ–æ—¶é—´çš„æ€§è´¨ï¼Œè€Œä¸æ˜¯å›ºå®šçš„å‘¨æœŸæ•°ã€‚èŠ‚æ—¥å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œå¤§å¤šæ•°éƒ½éµå¾ªè¿™æ ·çš„è§„åˆ™ï¼š\u0026ldquo;çºªå¿µæ—¥ = äº”æœˆçš„æœ€åä¸€ä¸ªæ˜ŸæœŸä¸€\u0026rdquo;ï¼Œæˆ–è€… \u0026ldquo;æ„Ÿæ©èŠ‚ = åä¸€æœˆçš„ç¬¬å››ä¸ªæ˜ŸæœŸå››\u0026rdquo;ã€‚è¿™ç±»æ—¶é—´è¡¨è¾¾å¼å¤„ç†çš„æ˜¯ç›¸å¯¹äºæ—¥å†çš„è§„åˆ™ï¼Œæ¯”å¦‚æœ¬æœˆçš„ç¬¬ä¸€å¤©æˆ–æœ€åä¸€å¤©ï¼Œä¸‹å‘¨äºŒï¼Œæˆ–ç¬¬ä¸€ä¸ªå’Œç¬¬ä¸‰ä¸ªæ˜ŸæœŸä¸‰ç­‰ã€‚\nDates æ¨¡å—é€šè¿‡å‡ ä¸ªæ–¹ä¾¿çš„æ–¹æ³•æä¾›äº†è°ƒæ•´å™¨ APIï¼Œè¿™äº›æ–¹æ³•æœ‰åŠ©äºç®€å•ã€ç®€æ´åœ°è¡¨è¾¾æ—¶é—´è§„åˆ™ã€‚ç¬¬ä¸€ç»„è°ƒæ•´å™¨æ–¹æ³•å¤„ç†å‘¨ã€æœˆã€å­£åº¦å’Œå¹´çš„é¦–å°¾ã€‚å®ƒä»¬æ¯ä¸ªæ–¹æ³•éƒ½æ¥æ”¶ä¸€ä¸ªå•ä¸€çš„ TimeType ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¿”å›æˆ–è°ƒæ•´åˆ°ç›¸å¯¹äºè¾“å…¥çš„æ‰€éœ€æ—¶æœŸçš„ç¬¬ä¸€ä¸ªæˆ–æœ€åä¸€ä¸ªã€‚\njulia\u0026gt; Dates.firstdayofweek(Date(2014,7,16)) # Adjusts the input to the Monday of the input\u0026#39;s week 2014-07-14 julia\u0026gt; Dates.lastdayofmonth(Date(2014,7,16)) # Adjusts to the last day of the input\u0026#39;s month 2014-07-31 julia\u0026gt; Dates.lastdayofquarter(Date(2014,7,16)) # Adjusts to the last day of the input\u0026#39;s quarter 2014-09-30 æ¥ä¸‹æ¥çš„ä¸¤ä¸ªé«˜é˜¶æ–¹æ³• tonext å’Œ toprevï¼Œé€šè¿‡å°†ä¸€ä¸ª DateFunction å’Œä¸€ä¸ªèµ·å§‹ TimeType ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°æ¥æ¦‚æ‹¬å¤„ç†æ—¶é—´è¡¨è¾¾å¼ã€‚DateFunction åªæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé€šå¸¸æ˜¯åŒ¿åçš„ï¼Œå®ƒæ¥å—ä¸€ä¸ªå•ä¸€çš„ TimeType ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¿”å›ä¸€ä¸ª Boolï¼Œtrue è¡¨ç¤ºæ»¡è¶³è°ƒæ•´æ ‡å‡†ã€‚ä¾‹å¦‚:\njulia\u0026gt; istuesday = x-\u0026gt;Dates.dayofweek(x) == Dates.Tuesday; # Returns true if the day of the week of x is Tuesday julia\u0026gt; Dates.tonext(istuesday, Date(2014,7,13)) # 2014-07-13 is a Sunday 2014-07-15 julia\u0026gt; Dates.tonext(Date(2014,7,13), Dates.Tuesday) # Convenience method provided for day of the week adjustments 2014-07-15 è¿™å¯¹äºæ›´å¤æ‚çš„æ—¶é—´è¡¨è¾¾å¼çš„ do-block è¯­æ³•æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚\njulia\u0026gt; Dates.tonext(Date(2014,7,13)) do x # Return true on the 4th Thursday of November (Thanksgiving) Dates.dayofweek(x) == Dates.Thursday \u0026amp;\u0026amp; Dates.dayofweekofmonth(x) == 4 \u0026amp;\u0026amp; Dates.month(x) == Dates.November end 2014-11-27 Base.filter æ–¹æ³•å¯ä»¥ç”¨æ¥è·å–æŒ‡å®šèŒƒå›´å†…çš„æ‰€æœ‰æœ‰æ•ˆæ—¥æœŸ/æ—¶åˆ»ã€‚\n# åŒ¹å…¹å ¡è¡—é“æ¸…æ´; ä» 4æœˆåˆ°11æœˆçš„æ¯ç¬¬äºŒä¸ªå‘¨äºŒ # æ—¥æœŸèŒƒå›´ä» 2014-01-01 åˆ° 2015-01-01 julia\u0026gt; dr = Dates.Date(2014):Day(1):Dates.Date(2015); julia\u0026gt; filter(dr) do x Dates.dayofweek(x) == Dates.Tue \u0026amp;\u0026amp; Dates.April \u0026lt;= Dates.month(x) \u0026lt;= Dates.Nov \u0026amp;\u0026amp; Dates.dayofweekofmonth(x) == 2 end 8-element Array{Date,1}: 2014-04-08 2014-05-13 2014-06-10 2014-07-08 2014-08-12 2014-09-09 2014-10-14 2014-11-11 åœ¨ Raku ä¸­ä¸Šé¢çš„ä»£ç å¯ä»¥å†™æˆ:\nlazy my @dates = Date.new(\u0026#39;2014-01-01\u0026#39;) ... Date.new(\u0026#39;2015-01-01\u0026#39;); .say for @dates.grep: -\u0026gt; $d { $d.day-of-week == 2 \u0026amp;\u0026amp; 4 \u0026lt;= $d.month \u0026lt;= 11 \u0026amp;\u0026amp; $d.weekday-of-month == 2 } å…¶ä»–çš„ä¾‹å­å’Œæµ‹è¯•å¯ä»¥åœ¨ stdlib/Dates/test/adjusters.jl ä¸­æ‰¾åˆ°ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/2020-08-04-dates-in-julia/","tags":["julia","dates"],"title":"Julia ä¸­çš„æ—¥æœŸå’Œæ—¶é—´"},{"categories":["programming"],"contents":"Apache Flink æä¾›çš„ Table API æ˜¯ä¸€ä¸ªç»Ÿä¸€çš„ã€å…³ç³»å‹çš„ APIï¼Œç”¨äºæ‰¹å¤„ç†å’Œæµå¤„ç†ï¼Œå³åœ¨æ— è¾¹ç•Œçš„ã€å®æ—¶çš„æµæˆ–æœ‰è¾¹ç•Œçš„ã€æ‰¹å¤„ç†çš„æ•°æ®é›†ä¸Šä»¥ç›¸åŒçš„è¯­ä¹‰æ‰§è¡ŒæŸ¥è¯¢ï¼Œå¹¶äº§ç”Ÿç›¸åŒçš„ç»“æœã€‚Flink ä¸­çš„ Table API é€šå¸¸ç”¨äºç®€åŒ–æ•°æ®åˆ†æã€æ•°æ®ç®¡é“åŒ–å’Œ ETL åº”ç”¨çš„å®šä¹‰ã€‚\nä½ è¦æ„å»ºä»€ä¹ˆ? åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œä½ å°†å­¦ä¹ å¦‚ä½•æ„å»ºä¸€ä¸ªå®æ—¶çš„ä»ªè¡¨ç›˜ï¼Œä»¥æŒ‰è´¦æˆ·è·Ÿè¸ªé‡‘èäº¤æ˜“ã€‚è¯¥ç®¡é“å°†ä» Kafka è¯»å–æ•°æ®ï¼Œå¹¶å°†ç»“æœå†™å…¥ MySQLï¼Œé€šè¿‡ Grafana å¯è§†åŒ–ã€‚\nå…ˆå†³æ¡ä»¶ æœ¬æ¼”ç»ƒå‡è®¾ä½ å¯¹ Java æˆ– Scala æœ‰ä¸€å®šçš„ç†Ÿæ‚‰ï¼Œä½†å³ä½¿ä½ æ¥è‡ªä¸åŒçš„ç¼–ç¨‹è¯­è¨€ï¼Œä½ ä¹Ÿåº”è¯¥èƒ½å¤Ÿè·Ÿä¸Šã€‚å®ƒè¿˜å‡è®¾ä½ ç†Ÿæ‚‰åŸºæœ¬çš„å…³ç³»æ¦‚å¿µï¼Œå¦‚ SELECT å’Œ GROUP BY å­å¥ã€‚\næ•‘å‘½, æˆ‘è¢«å¡ä½äº†! å¦‚æœä½ é‡åˆ°å›°éš¾ï¼Œè¯·æŸ¥çœ‹ç¤¾åŒºæ”¯æŒèµ„æºã€‚ç‰¹åˆ«æ˜¯ Apache Flink çš„ç”¨æˆ·é‚®ä»¶åˆ—è¡¨ï¼Œå®ƒä¸€ç›´æ˜¯ Apache é¡¹ç›®ä¸­æœ€æ´»è·ƒçš„ä¸€ä¸ªï¼Œä¹Ÿæ˜¯å¿«é€Ÿè·å¾—å¸®åŠ©çš„å¥½æ–¹æ³•ã€‚\nå¦‚ä½•è·Ÿè¿› å¦‚æœä½ æƒ³è·Ÿç€èµ°ï¼Œä½ éœ€è¦ä¸€å°ç”µè„‘ä¸:\n Java 8 æˆ– 11 Maven Docker  æ‰€éœ€çš„é…ç½®æ–‡ä»¶å¯åœ¨ flink-playgrounds èµ„æºåº“ä¸­è·å¾—ã€‚ä¸‹è½½åï¼Œåœ¨ IDE ä¸­æ‰“å¼€é¡¹ç›® flink-playground/table-walkthroughï¼Œå¹¶å¯¼èˆªåˆ°æ–‡ä»¶ SpendReportã€‚\nEnvironmentSettings settings = EnvironmentSettings.newInstance().build(); TableEnvironment tEnv = TableEnvironment.create(settings); tEnv.executeSql(\u0026#34;CREATE TABLE transactions (\\n\u0026#34; + \u0026#34; account_id BIGINT,\\n\u0026#34; + \u0026#34; amount BIGINT,\\n\u0026#34; + \u0026#34; transaction_time TIMESTAMP(3),\\n\u0026#34; + \u0026#34; WATERMARK FOR transaction_time AS transaction_time - INTERVAL \u0026#39;5\u0026#39; SECOND\\n\u0026#34; + \u0026#34;) WITH (\\n\u0026#34; + \u0026#34; \u0026#39;connector\u0026#39; = \u0026#39;kafka\u0026#39;,\\n\u0026#34; + \u0026#34; \u0026#39;topic\u0026#39; = \u0026#39;transactions\u0026#39;,\\n\u0026#34; + \u0026#34; \u0026#39;properties.bootstrap.servers\u0026#39; = \u0026#39;kafka:9092\u0026#39;,\\n\u0026#34; + \u0026#34; \u0026#39;format\u0026#39; = \u0026#39;csv\u0026#39;\\n\u0026#34; + \u0026#34;)\u0026#34;); tEnv.executeSql(\u0026#34;CREATE TABLE spend_report (\\n\u0026#34; + \u0026#34; account_id BIGINT,\\n\u0026#34; + \u0026#34; log_ts TIMESTAMP(3),\\n\u0026#34; + \u0026#34; amount BIGINT\\n,\u0026#34; + \u0026#34; PRIMARY KEY (account_id, log_ts) NOT ENFORCED\u0026#34; + \u0026#34;) WITH (\\n\u0026#34; + \u0026#34; \u0026#39;connector\u0026#39; = \u0026#39;jdbc\u0026#39;,\\n\u0026#34; + \u0026#34; \u0026#39;url\u0026#39; = \u0026#39;jdbc:mysql://mysql:3306/sql-demo\u0026#39;,\\n\u0026#34; + \u0026#34; \u0026#39;table-name\u0026#39; = \u0026#39;spend_report\u0026#39;,\\n\u0026#34; + \u0026#34; \u0026#39;driver\u0026#39; = \u0026#39;com.mysql.jdbc.Driver\u0026#39;,\\n\u0026#34; + \u0026#34; \u0026#39;username\u0026#39; = \u0026#39;sql-demo\u0026#39;,\\n\u0026#34; + \u0026#34; \u0026#39;password\u0026#39; = \u0026#39;demo-sql\u0026#39;\\n\u0026#34; + \u0026#34;)\u0026#34;); Table transactions = tEnv.from(\u0026#34;transactions\u0026#34;); report(transactions).executeInsert(\u0026#34;spend_report\u0026#34;); æ‹†è§£ä»£ç  The Execution Environment å‰ä¸¤è¡Œè®¾ç½®äº†ä½ çš„ TableEnvironmentã€‚è¡¨ç¯å¢ƒæ˜¯ä½ å¦‚ä½•ä¸ºä½ çš„ Job è®¾ç½®å±æ€§ï¼ŒæŒ‡å®šä½ æ˜¯åœ¨å†™æ‰¹å¤„ç†è¿˜æ˜¯æµå¼åº”ç”¨ï¼Œä»¥åŠåˆ›å»ºä½ çš„æºã€‚æœ¬æ¼”ç»ƒåˆ›å»ºäº†ä¸€ä¸ªä½¿ç”¨æµå¼æ‰§è¡Œçš„æ ‡å‡†è¡¨ç¯å¢ƒã€‚\nEnvironmentSettings settings = EnvironmentSettings.newInstance().build(); TableEnvironment tEnv = TableEnvironment.create(settings); æ³¨å†Œè¡¨ æ¥ä¸‹æ¥ï¼Œåœ¨å½“å‰ç›®å½•ä¸­æ³¨å†Œäº†è¡¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¿™äº›è¡¨è¿æ¥åˆ°å¤–éƒ¨ç³»ç»Ÿï¼Œä»¥ä¾¿è¯»å†™æ‰¹å¤„ç†å’Œæµæ•°æ®ã€‚è¡¨æºæä¾›å¯¹å­˜å‚¨åœ¨å¤–éƒ¨ç³»ç»Ÿä¸­çš„æ•°æ®çš„è®¿é—®ï¼Œå¦‚æ•°æ®åº“ã€é”®å€¼å­˜å‚¨ã€æ¶ˆæ¯é˜Ÿåˆ—æˆ–æ–‡ä»¶ç³»ç»Ÿã€‚table sink å‘å¤–éƒ¨å­˜å‚¨ç³»ç»Ÿå‘å‡ºä¸€ä¸ªè¡¨ã€‚æ ¹æ®æºå’Œ sink çš„ç±»å‹ï¼Œå®ƒä»¬æ”¯æŒä¸åŒçš„æ ¼å¼ï¼Œå¦‚ CSVã€JSONã€Avro æˆ– Parquetã€‚\ntEnv.executeSql(\u0026#34;CREATE TABLE transactions (\\n\u0026#34; + \u0026#34; account_id BIGINT,\\n\u0026#34; + \u0026#34; amount BIGINT,\\n\u0026#34; + \u0026#34; transaction_time TIMESTAMP(3),\\n\u0026#34; + \u0026#34; WATERMARK FOR transaction_time AS transaction_time - INTERVAL \u0026#39;5\u0026#39; SECOND\\n\u0026#34; + \u0026#34;) WITH (\\n\u0026#34; + \u0026#34; \u0026#39;connector\u0026#39; = \u0026#39;kafka\u0026#39;,\\n\u0026#34; + \u0026#34; \u0026#39;topic\u0026#39; = \u0026#39;transactions\u0026#39;,\\n\u0026#34; + \u0026#34; \u0026#39;properties.bootstrap.servers\u0026#39; = \u0026#39;kafka:9092\u0026#39;,\\n\u0026#34; + \u0026#34; \u0026#39;format\u0026#39; = \u0026#39;csv\u0026#39;\\n\u0026#34; + \u0026#34;)\u0026#34;); æ³¨å†Œäº†ä¸¤ä¸ªè¡¨ï¼šä¸€ä¸ªæ˜¯äº¤æ˜“è¾“å…¥è¡¨ï¼Œä¸€ä¸ªæ˜¯æ¶ˆè´¹æŠ¥å‘Šè¾“å‡ºè¡¨ã€‚äº¤æ˜“(transaction)è¡¨è®©æˆ‘ä»¬å¯ä»¥è¯»å–ä¿¡ç”¨å¡äº¤æ˜“ï¼Œå…¶ä¸­åŒ…å«è´¦æˆ·ID(account_id)ã€æ—¶é—´æˆ³(transaction_time)å’Œç¾å…ƒé‡‘é¢(amount)ã€‚è¯¥è¡¨æ˜¯åœ¨ä¸€ä¸ªåä¸º transactions çš„ Kafka ä¸»é¢˜ä¸Šçš„é€»è¾‘è§†å›¾ï¼ŒåŒ…å« CSV æ•°æ®ã€‚\ntEnv.executeSql(\u0026#34;CREATE TABLE spend_report (\\n\u0026#34; + \u0026#34; account_id BIGINT,\\n\u0026#34; + \u0026#34; log_ts TIMESTAMP(3),\\n\u0026#34; + \u0026#34; amount BIGINT\\n,\u0026#34; + \u0026#34; PRIMARY KEY (account_id, log_ts) NOT ENFORCED\u0026#34; + \u0026#34;) WITH (\\n\u0026#34; + \u0026#34; \u0026#39;connector\u0026#39; = \u0026#39;jdbc\u0026#39;,\\n\u0026#34; + \u0026#34; \u0026#39;url\u0026#39; = \u0026#39;jdbc:mysql://mysql:3306/sql-demo\u0026#39;,\\n\u0026#34; + \u0026#34; \u0026#39;table-name\u0026#39; = \u0026#39;spend_report\u0026#39;,\\n\u0026#34; + \u0026#34; \u0026#39;driver\u0026#39; = \u0026#39;com.mysql.jdbc.Driver\u0026#39;,\\n\u0026#34; + \u0026#34; \u0026#39;username\u0026#39; = \u0026#39;sql-demo\u0026#39;,\\n\u0026#34; + \u0026#34; \u0026#39;password\u0026#39; = \u0026#39;demo-sql\u0026#39;\\n\u0026#34; + \u0026#34;)\u0026#34;); ç¬¬äºŒå¼ è¡¨ spend_reportï¼Œå­˜å‚¨äº†æœ€ç»ˆçš„æ±‡æ€»ç»“æœã€‚å…¶åº•å±‚å­˜å‚¨æ˜¯ MySql æ•°æ®åº“ä¸­çš„ä¸€å¼ è¡¨ã€‚\næŸ¥è¯¢ é…ç½®å¥½ç¯å¢ƒå’Œæ³¨å†Œå¥½è¡¨ä¹‹åï¼Œä½ å°±å¯ä»¥æ„å»ºä½ çš„ç¬¬ä¸€ä¸ªåº”ç”¨ç¨‹åºäº†ã€‚ä» TableEnvironment ä¸­ï¼Œä½ å¯ä»¥ä»ä¸€ä¸ªè¾“å…¥è¡¨ä¸­è¯»å–å®ƒçš„è¡Œï¼Œç„¶åä½¿ç”¨ executeInsert å°†è¿™äº›ç»“æœå†™å…¥åˆ°ä¸€ä¸ªè¾“å‡ºè¡¨ä¸­ã€‚report å‡½æ•°æ˜¯ä½ å®ç°ä¸šåŠ¡é€»è¾‘çš„åœ°æ–¹ã€‚å®ƒç›®å‰è¿˜æ²¡æœ‰è¢«å®ç°ã€‚\nTable transactions = tEnv.from(\u0026#34;transactions\u0026#34;); report(transactions).executeInsert(\u0026#34;spend_report\u0026#34;); æµ‹è¯• è¯¥é¡¹ç›®åŒ…å«ä¸€ä¸ªäºŒæ¬¡æµ‹è¯•ç±» SpendReportTestï¼Œç”¨äºéªŒè¯æŠ¥è¡¨çš„é€»è¾‘ã€‚å®ƒä»¥æ‰¹å¤„ç†æ¨¡å¼åˆ›å»ºäº†ä¸€ä¸ªè¡¨ç¯å¢ƒã€‚\nEnvironmentSettings settings = EnvironmentSettings.newInstance().inBatchMode().build(); TableEnvironment tEnv = TableEnvironment.create(settings); Flink çš„ç‹¬ç‰¹å±æ€§ä¹‹ä¸€æ˜¯å®ƒåœ¨æ‰¹å¤„ç†å’Œæµå¼å¤„ç†ä¹‹é—´æä¾›ä¸€è‡´çš„è¯­ä¹‰ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨é™æ€æ•°æ®é›†ä¸Šä»¥æ‰¹å¤„ç†æ¨¡å¼å¼€å‘å’Œæµ‹è¯•åº”ç”¨ç¨‹åºï¼Œå¹¶ä»¥æµå¼åº”ç”¨ç¨‹åºçš„å½¢å¼éƒ¨ç½²åˆ°ç”Ÿäº§ä¸­ã€‚\nå°è¯•ä¸€ä¸‹ ç°åœ¨æœ‰äº† Job è®¾ç½®çš„éª¨æ¶ï¼Œä½ å°±å¯ä»¥æ·»åŠ ä¸€äº›ä¸šåŠ¡é€»è¾‘äº†ã€‚ç›®æ ‡æ˜¯å»ºç«‹ä¸€ä¸ªæŠ¥å‘Šï¼Œæ˜¾ç¤ºæ¯ä¸ªè´¦æˆ·åœ¨ä¸€å¤©ä¸­æ¯ä¸ªå°æ—¶çš„æ€»æ”¯å‡ºã€‚è¿™æ„å‘³ç€æ—¶é—´æˆ³åˆ—éœ€è¦ä»æ¯«ç§’åˆ°å°æ—¶çš„é¢—ç²’åº¦è¿›è¡Œèˆå…¥ã€‚\nFlink æ”¯æŒç”¨çº¯ SQL æˆ–ä½¿ç”¨ Table API å¼€å‘å…³ç³»å‹åº”ç”¨ã€‚Table API æ˜¯ä¸€ä¸ªå— SQL å¯å‘çš„æµç•… DSLï¼Œå¯ä»¥ç”¨ Pythonã€Java æˆ– Scala ç¼–å†™ï¼Œå¹¶æ”¯æŒå¼ºå¤§çš„ IDE é›†æˆã€‚å°±åƒ SQL æŸ¥è¯¢ä¸€æ ·ï¼ŒTable ç¨‹åºå¯ä»¥é€‰æ‹©æ‰€éœ€çš„å­—æ®µï¼Œå¹¶é€šè¿‡ä½ çš„é”®è¿›è¡Œåˆ†ç»„ã€‚è¿™äº›åŠŸèƒ½ï¼ŒåŠ ä¸Šå†…ç½®çš„å‡½æ•°ï¼Œå¦‚ floor å’Œ sumï¼Œå†™è¿™ä¸ªæŠ¥å‘Šé—®é¢˜ä¸å¤§ã€‚\npublic static Table report(Table transactions) { return transactions.select( $(\u0026#34;account_id\u0026#34;), $(\u0026#34;transaction_time\u0026#34;).floor(TimeIntervalUnit.HOUR).as(\u0026#34;log_ts\u0026#34;), $(\u0026#34;amount\u0026#34;)) .groupBy($(\u0026#34;account_id\u0026#34;), $(\u0026#34;log_ts\u0026#34;)) .select( $(\u0026#34;account_id\u0026#34;), $(\u0026#34;log_ts\u0026#34;), $(\u0026#34;amount\u0026#34;).sum().as(\u0026#34;amount\u0026#34;)); } ç”¨æˆ·å®šä¹‰çš„å‡½æ•° Flink åŒ…å«æœ‰é™çš„å†…ç½®å‡½æ•°ï¼Œæœ‰æ—¶ä½ éœ€è¦ç”¨ç”¨æˆ·å®šä¹‰çš„å‡½æ•°æ¥æ‰©å±•å®ƒã€‚å¦‚æœ floor ä¸æ˜¯é¢„å®šä¹‰çš„ï¼Œä½ å¯ä»¥è‡ªå·±å®ç°å®ƒã€‚\nimport java.time.LocalDateTime; import java.time.temporal.ChronoUnit; import org.apache.flink.table.annotation.DataTypeHint; import org.apache.flink.table.functions.ScalarFunction; public class MyFloor extends ScalarFunction { public @DataTypeHint(\u0026#34;TIMESTAMP(3)\u0026#34;) LocalDateTime eval( @DataTypeHint(\u0026#34;TIMESTAMP(3)\u0026#34;) LocalDateTime timestamp) { return timestamp.truncatedTo(ChronoUnit.HOURS); } } ç„¶åè¿…é€Ÿå°†å…¶é›†æˆåˆ°ä½ çš„åº”ç”¨ç¨‹åºä¸­ã€‚\npublic static Table report(Table transactions) { return transactions.select( $(\u0026#34;account_id\u0026#34;), call(MyFloor.class, $(\u0026#34;transaction_time\u0026#34;)).as(\u0026#34;log_ts\u0026#34;), $(\u0026#34;amount\u0026#34;)) .groupBy($(\u0026#34;account_id\u0026#34;), $(\u0026#34;log_ts\u0026#34;)) .select( $(\u0026#34;account_id\u0026#34;), $(\u0026#34;log_ts\u0026#34;), $(\u0026#34;amount\u0026#34;).sum().as(\u0026#34;amount\u0026#34;)); } è¿™ä¸ªæŸ¥è¯¢ä¼šæ¶ˆè€— transactions è¡¨çš„æ‰€æœ‰è®°å½•ï¼Œè®¡ç®—æŠ¥è¡¨ï¼Œå¹¶ä»¥é«˜æ•ˆã€å¯æ‰©å±•çš„æ–¹å¼è¾“å‡ºç»“æœã€‚ä½¿ç”¨è¯¥å®ç°è¿è¡Œæµ‹è¯•å°†é€šè¿‡ã€‚\næ·»åŠ çª—å£ åŸºäºæ—¶é—´çš„æ•°æ®åˆ†ç»„æ˜¯æ•°æ®å¤„ç†ä¸­çš„å…¸å‹æ“ä½œï¼Œå°¤å…¶æ˜¯åœ¨å¤„ç†æ— é™æµæ—¶ã€‚åŸºäºæ—¶é—´çš„åˆ†ç»„è¢«ç§°ä¸ºçª—å£ï¼ŒFlink æä¾›äº†çµæ´»çš„çª—å£è¯­ä¹‰ã€‚æœ€åŸºæœ¬çš„çª—å£ç±»å‹ç§°ä¸º Tumble çª—å£ï¼Œå®ƒæœ‰ä¸€ä¸ªå›ºå®šçš„å¤§å°ï¼Œå…¶æ¡¶ä¸é‡å ã€‚\npublic static Table report(Table transactions) { return transactions .window(Tumble.over(lit(1).hour()).on($(\u0026#34;transaction_time\u0026#34;)).as(\u0026#34;log_ts\u0026#34;)) .groupBy($(\u0026#34;account_id\u0026#34;), $(\u0026#34;log_ts\u0026#34;)) .select( $(\u0026#34;account_id\u0026#34;), $(\u0026#34;log_ts\u0026#34;).start().as(\u0026#34;log_ts\u0026#34;), $(\u0026#34;amount\u0026#34;).sum().as(\u0026#34;amount\u0026#34;)); } è¿™å°±å®šä¹‰äº†ä½ çš„åº”ç”¨ç¨‹åºä½¿ç”¨åŸºäºæ—¶é—´æˆ³åˆ—çš„ä¸€å°æ—¶æ»šåŠ¨çª—å£ã€‚å› æ­¤ï¼Œæ—¶é—´æˆ³ä¸º 2019-06-01 01:23:47 çš„è¡Œè¢«æ”¾åœ¨ 2019-06-01 01:00:00 çª—å£ä¸­ã€‚\nåŸºäºæ—¶é—´çš„èšåˆæ˜¯ç‹¬ä¸€æ— äºŒçš„ï¼Œå› ä¸ºåœ¨è¿ç»­æµåº”ç”¨ä¸­ï¼Œæ—¶é—´ä¸å…¶ä»–å±æ€§ä¸åŒï¼Œä¸€èˆ¬æ˜¯å‘å‰ç§»åŠ¨çš„ã€‚ä¸ floor å’Œä½ çš„ UDF ä¸åŒï¼Œçª—å£å‡½æ•°æ˜¯å†…åœ¨çš„ï¼Œå®ƒå…è®¸è¿è¡Œæ—¶åº”ç”¨é¢å¤–çš„ä¼˜åŒ–ã€‚åœ¨æ‰¹å¤„ç†ä¸Šä¸‹æ–‡ä¸­ï¼Œçª—å£æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„ APIï¼Œç”¨äºé€šè¿‡æ—¶é—´æˆ³å±æ€§å¯¹è®°å½•è¿›è¡Œåˆ†ç»„ã€‚\nç”¨è¿™ä¸ªå®ç°è¿è¡Œæµ‹è¯•ä¹Ÿä¼šé€šè¿‡ã€‚\nå†æ¥ä¸€æ¬¡ï¼Œç”¨æµ! å°±è¿™æ ·ï¼Œä¸€ä¸ªåŠŸèƒ½é½å…¨çš„ã€æœ‰çŠ¶æ€çš„ã€åˆ†å¸ƒå¼çš„æµå¼åº”ç”¨! æŸ¥è¯¢ä¸æ–­åœ°æ¶ˆè€— Kafka çš„äº‹åŠ¡æµï¼Œè®¡ç®—æ¯å°æ—¶çš„èŠ±è´¹ï¼Œå¹¶åœ¨ç»“æœå‡†å¤‡å¥½åç«‹å³å‘å‡ºã€‚ç”±äºè¾“å…¥æ˜¯æœ‰ç•Œçš„ï¼Œæ‰€ä»¥æŸ¥è¯¢ä¸€ç›´åœ¨è¿è¡Œï¼Œç›´åˆ°æ‰‹åŠ¨åœæ­¢ã€‚è€Œä¸”ç”±äº Job ä½¿ç”¨äº†åŸºäºæ—¶é—´çª—å£çš„èšåˆï¼Œæ‰€ä»¥å½“æ¡†æ¶çŸ¥é“æŸä¸ªçª—å£ä¸ä¼šå†æœ‰è®°å½•åˆ°è¾¾æ—¶ï¼ŒFlink å¯ä»¥è¿›è¡Œç‰¹å®šçš„ä¼˜åŒ–ï¼Œæ¯”å¦‚çŠ¶æ€æ¸…ç†ã€‚\nè¡¨æ¸¸ä¹åœºæ˜¯å®Œå…¨ docker åŒ–çš„ï¼Œå¯ä»¥ä½œä¸ºæµå¼åº”ç”¨åœ¨æœ¬åœ°è¿è¡Œã€‚è¯¥ç¯å¢ƒåŒ…å«ä¸€ä¸ª Kafka ä¸»é¢˜ã€ä¸€ä¸ªè¿ç»­æ•°æ®ç”Ÿæˆå™¨ã€MySql å’Œ Grafanaã€‚\nä» table-walkthrough æ–‡ä»¶å¤¹å†…å¯åŠ¨ docker-compose è„šæœ¬ã€‚\n$ docker-compose build $ docker-compose up -d ä½ å¯ä»¥é€šè¿‡ Flink æ§åˆ¶å°æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„ä½œä¸šä¿¡æ¯ã€‚\nä» MySQL é‡Œé¢æ¢ç´¢ç»“æœã€‚\n$ docker-compose exec mysql mysql -Dsql-demo -usql-demo -pdemo-sql mysql\u0026gt; use sql-demo; Database changed mysql\u0026gt; select count(*) from spend_report; +----------+ | count(*) | +----------+ | 110 | +----------+ æœ€åï¼Œå» Grafana çœ‹çœ‹å®Œå…¨å¯è§†åŒ–çš„ç»“æœå§!\nåŸæ–‡é“¾æ¥: https://ci.apache.org/projects/flink/flink-docs-release-1.11/try-flink/table_api.html\n","permalink":"https://ohmyweekly.github.io/notes/2020-07-30-table-api-in-flink/","tags":["flink","table","api"],"title":"Flink ä¸­çš„ Table API"},{"categories":["programming"],"contents":"è¯­æ³• æ•°å€¼å­—é¢é‡ç³»æ•° åœ¨æ ‡è¯†ç¬¦æˆ–åœ†æ‹¬å·å‰é¢ç›´æ¥æ”¾ä¸€ä¸ªæ•°å­—, ä¾‹å¦‚ 2x æˆ– 2(x+y), ä¼šè¢«è®¤ä¸ºæ˜¯æŠŠæ ‡è¯†ç¬¦å’Œå®ƒå‰é¢çš„æ•°å­—ç›¸ä¹˜ã€‚è¿™æ ·å†™å¤šé¡¹å¼å°±å¾ˆæ–¹ä¾¿äº†ã€‚\nå‘é‡åŒ–çš„ç‚¹å·è¿ç®—ç¬¦ [1,2,3] .+ 3 3-element Array{Int64,1}: 4 5 6 .+ ç±»ä¼¼äº Raku ä¸­çš„ Â»+Â» è¶…è¿ç®—ç¬¦:\n[1,2,3] Â»+Â» 3 [4 5 6] ä½†æ˜¯ Julia çš„ Vectorized \u0026quot;dot\u0026quot; è¯­æ³•æ²¡æœ‰ Raku çš„è¶…è¿ç®—ç¬¦è¯­æ³•æ¸…æ™°ã€‚\nç±»ä¼¼çš„ä¾‹å­è¿˜æœ‰:\nsin(0.5) # 0.479425538604203 A = [0.5, 1.0, 1.5] sin.(A) 3-element Array{Float64,1}: 0.479425538604203 0.8414709848078965 0.9974949866040544 f(x,y) = 3x + 4y; A = [1.0, 2.0, 3.0]; B = [4.0, 5.0, 6.0]; f.(pi, A) 3-element Array{Float64,1}: 13.42477796076938 17.42477796076938 21.42477796076938 f.(A, pi) 3-element Array{Float64,1}: 15.566370614359172 18.566370614359172 21.566370614359172 f.(A,B) 3-element Array{Float64,1}: 19.0 26.0 33.0 ç­‰ä»·çš„ Raku å†™æ³•ä¸º:\nsub f(\\x, \\y) { 3*x + 4*y}; my \\A = [1.0, 2.0, 3.0]; my \\B = [4.0, 5.0, 6.0]; AÂ».\u0026amp;f(pi) [15.566370614359172 18.566370614359172 21.566370614359172] é“¾å¼æ¯”è¾ƒ 1 \u0026lt; 2 \u0026lt;= 2 \u0026lt; 3 == 3 \u0026gt; 2 \u0026gt;= 1 == 1 \u0026lt; 3 != 5 true Raku åŒæ ·æ”¯æŒè¿™ç§é“¾å¼æ¯”è¾ƒã€‚\nè™šæ•° real(1 + 2im) # 1 imag(1 + 2im) # 2 (1 + 2im) * (1 - 2im) # 5 + 0im (1 + 2i).re # 1 (1 + 2i).im # 2 (1 + 2i) * (1 - 2i) # 5+0i å‘½åå‚æ•° function plot(x, y; style=\u0026#34;solid\u0026#34;, width=1, color=\u0026#34;black\u0026#34;) ### end plot(x, y, width=2) plot(x, y, :width =\u0026gt; 2) å‡½æ•°ç»„åˆ (sqrt âˆ˜ +)(3,6) # 3.0 map(first âˆ˜ reverse âˆ˜ uppercase, split(\u0026#34;you can compose functions like this\u0026#34;)) 6-element Array{Char,1}: \u0026#39;U\u0026#39; \u0026#39;N\u0026#39; \u0026#39;E\u0026#39; \u0026#39;S\u0026#39; \u0026#39;E\u0026#39; \u0026#39;S\u0026#39; Piping 1:10 |\u0026gt; sum |\u0026gt; sqrt # 7.416198487095663 # ç­‰ä»·äº (sqrt âˆ˜ sum)(1:10) # 7.416198487095663 å¹¿æ’­å’Œç®¡é“ä¸€èµ·ä½¿ç”¨ [\u0026#34;a\u0026#34;, \u0026#34;list\u0026#34;, \u0026#34;of\u0026#34;, \u0026#34;strings\u0026#34;] .|\u0026gt; [uppercase, reverse, titlecase, length] 4-element Array{Any,1}: \u0026#34;A\u0026#34; \u0026#34;tsil\u0026#34; \u0026#34;Of\u0026#34; 7 ç»„åˆç±»å‹  ä¸å¯å˜ç»„åˆç±»å‹  struct Foo bar baz::Int qux::Float64 end foo = Foo(\u0026#34;rakulang\u0026#34;, 6, 1.5) typeof(foo) # Foo typeof(Foo) # DataType foo.bar # rakulang foo.qux # 1.5 foo.qux = 1 # ERROR: setfield! immutable struct of type Foo cannot be changed  å¯å˜ç»„åˆç±»å‹  mutable struct Bar baz qux::Float64 end bar = Bar(\u0026#34;rakudo\u0026#34;, 6.0) bar.baz = 1//2 bar.qux = 2.0 è”åˆç±»å‹ IntOrString = Union{Int,AbstractString} 1 :: IntOrString # 1 \u0026#34;rakulang\u0026#34; :: IntOrString # rakulang å‚æ•°åŒ–ç±»å‹  å‚æ•°åŒ–ç»„åˆç±»å‹  struct Point{T} x::T y::T end point=Point{Float64}(1.0, 2.0) point.x # 1.0 point.y # 2.0 struct Circle{T,U} x::T y::U end c = Circle{Float64,AbstractString}(6.0, \u0026#34;rakulang\u0026#34;) c.x # 6.0 c.y # rakulang å¤šé‡åˆ†æ´¾ f(x::Float64, y::Float64) = 2x + y f(x::Number, y::Number) = 2x - y methods(f) # 2 methods for generic function \u0026#34;f\u0026#34;: [1] f(x::Float64, y::Float64) in Main at REPL[33]:1 [2] f(x::Number, y::Number) in Main at REPL[34]:1 f(2.0, 3.0) # 7 f(2, 3.0) # 1 ","permalink":"https://ohmyweekly.github.io/notes/2020-07-27-learning-julialang/","tags":["julialang","julia"],"title":"Julia è¯­è¨€å­¦ä¹ ç¬”è®°"},{"categories":["programming"],"contents":"å‡½æ•°å¼ç¼–ç¨‹æ˜¯ä¸€ç§ç¼–ç¨‹é£æ ¼ï¼Œç°ä»£è¯­è¨€æˆ–å¤šæˆ–å°‘éƒ½æ”¯æŒè¿™ç§é£æ ¼ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘æƒ³è§£é‡Šä¸€ä¸‹å‡½æ•°å¼ç¼–ç¨‹å¦‚ä½•ä¸ºä½ æä¾›å¼ºå¤§çš„æŠ½è±¡ï¼Œä½¿ä½ çš„ä»£ç æ›´åŠ ç®€æ´ã€‚æˆ‘å°†ç”¨ Raku å’Œ Python ä¸­çš„ä¾‹å­æ¥è¯´æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°è¿™ä¸¤ç§è¯­è¨€éƒ½æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„ä¼˜ç§€è¯­è¨€ã€‚\nRaku: ç®€ä»‹ æœ¬æ–‡çš„ä»£ç ç¤ºä¾‹æ˜¯ç”¨ Python å’Œ Raku ç¼–å†™çš„ã€‚æˆ‘æƒ³å¤§å¤šæ•°äººéƒ½ç†Ÿæ‚‰ Pythonï¼Œä½† Raku ä¸å¤ªä¸ºäººæ‰€çŸ¥ï¼Œæ‰€ä»¥æˆ‘å…ˆè§£é‡Šä¸€ä¸‹åŸºç¡€çŸ¥è¯†ã€‚æœ¬æ–‡ä¸­çš„ä»£ç ä¸æ˜¯å¾ˆä¹ æƒ¯ï¼Œæ‰€ä»¥å¦‚æœä½ æ‡‚å¾—å…¶ä»–ç¼–ç¨‹è¯­è¨€ï¼Œåº”è¯¥å¾ˆå®¹æ˜“ç†è§£ã€‚\nRaku ä¸ Perl æœ€ä¸ºç›¸ä¼¼ã€‚ä¸¤ç§è¯­è¨€åœ¨è¯­æ³•ä¸Šéƒ½ä¸ C/C++ã€Java å’Œ JavaScript ç›¸ä¼¼ï¼šåŸºäºå—ï¼Œè¯­å¥ç”¨åˆ†å·éš”å¼€ï¼Œå—ç”¨å¤§æ‹¬å·åˆ†ç•Œï¼Œå‚æ•°åˆ—è¡¨æ”¾åœ¨æ‹¬å·ä¸­ï¼Œç”¨é€—å·éš”å¼€ã€‚å°† Perl å’Œ Raku ä¸å…¶ä»–è¯­è¨€åŒºåˆ†å¼€æ¥çš„ä¸»è¦ç‰¹å¾æ˜¯ä½¿ç”¨é­”ç¬¦ï¼ˆ\u0026ldquo;æœ‰è¶£çš„å­—ç¬¦\u0026rdquo;ï¼‰æ¥è¯†åˆ«å˜é‡çš„ç±»å‹ï¼š$ ä»£è¡¨æ ‡é‡ï¼Œ@ ä»£è¡¨æ•°ç»„ï¼Œ% ä»£è¡¨å“ˆå¸Œï¼ˆæ˜ å°„ï¼‰ï¼Œ\u0026amp; ä»£è¡¨å­ç¨‹åºã€‚å˜é‡ä¹Ÿæœ‰å…³é”®å­—æ¥æ ‡è¯†å®ƒä»¬çš„ä½œç”¨åŸŸï¼Œæˆ‘åªç”¨ my æ¥æ ‡è¯†å˜é‡çš„è¯æ³•ä½œç”¨åŸŸã€‚å­ç¨‹åºæ˜¯ç”¨ sub å…³é”®å­—æ¥å£°æ˜çš„ï¼Œå­ç¨‹åºå¯ä»¥æ˜¯å‘½åçš„ï¼Œä¹Ÿå¯ä»¥æ˜¯åŒ¿åçš„ã€‚\nsub square ($x) { $x*$x; } # anonymous subroutine  my $anon_square = sub ($x) { $x*$x; } åœ¨ Python ä¸­ï¼Œè¿™å°†æ˜¯ï¼š\ndef square(x): return x*x # anonymous subroutine  anon_square = lambda x: x*x Raku æ”¯æŒæ— ç¬¦å·å˜é‡ï¼Œå¹¶ä½¿ç”¨ \\ è¯­æ³•æ¥å£°æ˜å®ƒä»¬ã€‚æ›´å¤šå…³äºæ™®é€šå˜é‡å’Œæ— ç¬¦å·å˜é‡ä¹‹é—´çš„åŒºåˆ«ï¼Œè¯·å‚è§ Raku æ–‡æ¡£ã€‚ä¾‹å¦‚(say æ‰“å°å®ƒçš„å‚æ•°ï¼Œåé¢åŠ ä¸€ä¸ªæ¢è¡Œ)ã€‚\nmy \\x = 42; # sigilless my $y = 43; say x + $y; åœ¨æœ¬æ–‡çš„ä»£ç ä¸­ï¼Œæˆ‘å°†å°½å¯èƒ½åœ°ä½¿ç”¨æ— ç¬¦å·å˜é‡ã€‚\nRaku æœ‰å‡ ç§ç±»å‹çš„åºåˆ—æ•°æ®ç»“æ„ã€‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘å°†ä½¿ç”¨åˆ—è¡¨å’Œæ•°ç»„ä»¥åŠèŒƒå›´ã€‚åœ¨ Raku ä¸­ï¼Œåˆ—è¡¨å’Œæ•°ç»„çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œåˆ—è¡¨æ˜¯ä¸å¯å˜çš„ï¼Œè¿™æ„å‘³ç€ä¸€æ—¦åˆ›å»ºï¼Œå°±ä¸èƒ½ä¿®æ”¹ã€‚æ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªåªè¯»çš„æ•°æ®ç»“æ„ã€‚è¦\u0026quot;æ›´æ–°\u0026quot;ä¸€ä¸ªä¸å¯å˜çš„æ•°æ®ç»“æ„ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªæ›´æ–°çš„å‰¯æœ¬ã€‚å¦ä¸€æ–¹é¢ï¼Œæ•°ç»„æ˜¯å¯å˜çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ›´æ–°å®ƒä»¬çš„å…ƒç´ ï¼Œæ‰©å±•å®ƒä»¬ï¼Œç¼©å°å®ƒä»¬ç­‰ç­‰ã€‚æ‰€æœ‰çš„æ›´æ–°éƒ½å‘ç”Ÿåœ¨åŸå§‹æ•°æ®çš„ä½ç½®ä¸Šã€‚\nRaku çš„æ•°ç»„ç±»ä¼¼äº Python çš„ listï¼ŒRaku çš„ list ç±»ä¼¼äº Python çš„ tupleï¼Œä¹Ÿæ˜¯ä¸å¯å˜çš„ã€‚é™¤äº†è¯­æ³•ä¹‹å¤–ï¼ŒRaku ä¸­çš„èŒƒå›´ä¸ Python ä¸­çš„èŒƒå›´ç›¸ä¼¼ï¼Œéƒ½æ˜¯ä¸å¯å˜çš„ã€‚\nmy @array1 = 1,2,3; #=\u0026gt;an array because of the \u0026#39;@\u0026#39; sigil my \\array2 = [1,2,3]; #= an array, because of the \u0026#39;[...]\u0026#39; my \\range1 = 1 .. 10; #=\u0026gt;a range 1 .. 10 my @array3 = 1 .. 10; #= an array from a range, because of the \u0026#39;@\u0026#39; sigil my \\list1 = 1,2,3; #=\u0026gt;a list my $list2 = (1,2,3); #= also a list my \\list3 = |(1 .. 10); #=\u0026gt;an array from a range because of the \u0026#39;|\u0026#39; flattening operation ç›¸åº”çš„ Python ä»£ç ä¸º:\nlist1 = list((1,2,3)) #=\u0026gt; a list from a tuple list2 = [1,2,3]; #=\u0026gt; a list, because of the \u0026#39;[...]\u0026#39; range1 = range(1,11) #=\u0026gt; a range 1 .. 10 list3 = list(range(1,11)); #=\u0026gt; a list from a range tuple1 = 1,2,3; #=\u0026gt; a tuple tuple2 = tuple([1,2,3]) #=\u0026gt; a tuple from a list tuple3 = tuple(range(1,11)) #=\u0026gt; creates a tuple from a range å…¶ä»–å…·ä½“çš„è¯­æ³•æˆ–åŠŸèƒ½å°†é’ˆå¯¹å…·ä½“çš„ä¾‹å­è¿›è¡Œè§£é‡Šã€‚\nå…¶ä»–ä»»ä½•åç§°çš„å‡½æ•° - ä½œä¸ºå€¼çš„å‡½æ•° å‡½æ•°æ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„ç²¾é«“ã€‚æ­£å¦‚æˆ‘åœ¨\u0026ldquo;ä¸‡ç‰©çš†å‡½æ•°\u0026rdquo;ä¸€æ–‡ä¸­æ‰€è§£é‡Šçš„é‚£æ ·ï¼Œåœ¨é€‚å½“çš„å‡½æ•°å¼è¯­è¨€ä¸­ï¼Œæ‰€æœ‰çš„ç»“æ„éƒ½æ˜¯ç”±å‡½æ•°æ„å»ºçš„ã€‚\næ‰€æœ‰ç°ä»£ç¼–ç¨‹è¯­è¨€éƒ½æœ‰å‡½æ•°ã€ç¨‹åºã€å­ç¨‹åºæˆ–æ–¹æ³•çš„æ¦‚å¿µã€‚å®ƒä»¬æ˜¯ä»£ç é‡ç”¨çš„é‡è¦æœºåˆ¶ã€‚é€šå¸¸ï¼Œæˆ‘ä»¬è®¤ä¸ºå‡½æ•°æ˜¯å¯¹ä¸€äº›è¾“å…¥å€¼è¿›è¡Œæ“ä½œä»¥äº§ç”Ÿä¸€ä¸ªæˆ–å¤šä¸ªè¾“å‡ºå€¼çš„ä¸œè¥¿ã€‚è¾“å…¥å€¼å¯ä»¥æ˜¯å…¨å±€å£°æ˜çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç±»çš„å±æ€§ï¼Œæˆ–è€…ä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°ã€‚åŒæ ·ï¼Œè¾“å‡ºå€¼å¯ä»¥ç›´æ¥è¿”å›ï¼Œåˆ°å…¨å±€å˜é‡ï¼Œä½œä¸ºç±»çš„å±æ€§æˆ–é€šè¿‡ä¿®æ”¹è¾“å…¥å€¼ã€‚\nè¦æƒ³ä»å‡½æ•°å¼ç¼–ç¨‹ä¸­è·ç›Šæœ€å¤šï¼Œæœ€å¥½æ˜¯å‡½æ•°æ˜¯çº¯ç²¹çš„ï¼Œè¿™æ„å‘³ç€å¯¹å‡½æ•°çš„è°ƒç”¨æ€»æ˜¯å¯¹ç›¸åŒçš„è¾“å…¥äº§ç”Ÿç›¸åŒçš„è¾“å‡ºã€‚åœ¨å®è·µä¸­ï¼Œå¦‚æœå‡½æ•°åªæ¥å—è¾“å…¥ä½œä¸ºå‚æ•°ï¼Œå¹¶ç›´æ¥è¿”å›è¾“å‡ºï¼Œè¿™ä¸€ç‚¹æ¯”è¾ƒå®¹æ˜“å®ç°ï¼Œä½†è¿™å¹¶ä¸æ˜¯å¿…ä¸å¯å°‘çš„ã€‚\nå‡½æ•°å¼ç¼–ç¨‹çš„å…³é”®ç‰¹å¾æ˜¯ï¼Œå‡½æ•°çš„è¾“å…¥å€¼å’Œè¾“å‡ºå€¼æœ¬èº«å¯ä»¥æ˜¯å‡½æ•°ã€‚æ‰€ä»¥å‡½æ•°å¿…é¡»æ˜¯ä½ è¯­è¨€ä¸­çš„å€¼ã€‚æœ‰æ—¶è¿™è¢«ç§°ä¸º \u0026ldquo;å‡½æ•°å¿…é¡»æ˜¯ä¸€ç­‰å…¬æ°‘\u0026rdquo;ï¼Œä¸€ä¸ªæ¥æ”¶å’Œ/æˆ–è¿”å›å‡½æ•°çš„å‡½æ•°æœ‰æ—¶è¢«ç§°ä¸º\u0026quot;é«˜é˜¶å‡½æ•°\u0026quot;ã€‚\nå¦‚æœå‡½æ•°æ˜¯å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°†å®ƒä»¬èµ‹å€¼ç»™å˜é‡ã€‚ç‰¹åˆ«æ˜¯æˆ‘ä»¬ä¼šå°†å®ƒä»¬èµ‹å€¼ç»™å…¶ä»–å‡½æ•°çš„å‚æ•°ã€‚ä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å®ƒä»¬èµ‹å€¼ç»™æ™®é€šçš„å˜é‡ã€‚\nè®©æˆ‘ä»¬è€ƒè™‘ä»¥ä¸‹å‡½æ•°ï¼Œchooseï¼Œå®ƒéœ€è¦ä¸‰ä¸ªå‚æ•° tï¼Œf å’Œ cã€‚\n# Raku sub choose (\\t, \\f, \\d) { if (d) {t} else {f} } # Python def choose (t, f, d): if d: return t else: return f é¦–å…ˆè®©æˆ‘ä»¬ç”¨å­—ç¬¦ä¸²ä½œä¸ºå‰ä¸¤ä¸ªå‚æ•°çš„å€¼æ¥è°ƒç”¨ chooseã€‚\n# Raku my \\tstr = \u0026#34;True!\u0026#34;; my \\fstr = \u0026#34;False!\u0026#34;; my \\res_str = choose(tstr, fstr, True); say res_str; #=\u0026gt;says \u0026#34;True!\u0026#34; # Python tstr = \u0026#34;True!\u0026#34; fstr = \u0026#34;False!\u0026#34; res_str = choose(tstr,fstr,True) print(res_str) #= says \u0026#34;True!\u0026#34; ç°åœ¨è®©æˆ‘ä»¬å°è¯•ç”¨å‡½æ•°ä½œä¸ºå‚æ•°:\n# Raku sub tt (\\s){ say \u0026#34;True {s}!\u0026#34;} sub ff (\\s) { say \u0026#34;False {s}!\u0026#34;} my \u0026amp;res_f = choose(\u0026amp;tt, \u0026amp;ff, False); say \u0026amp;res_f; #=\u0026gt;says \u0026amp;ff res_f(\u0026#34;rumour\u0026#34;); #= says \u0026#34;False rumour!\u0026#34; # Python def tt(s):print(\u0026#34;True \u0026#34;+s+\u0026#34;!\u0026#34;)def ff(s):print(\u0026#34;False\u0026#34;+s+\u0026#34;!\u0026#34;)res_f =choose(tt,ff,True)print(res_f)#=\u0026gt; says \u0026lt;function tt at 0x7f829c3aa310\u0026gt; res_f(\u0026#34;rumour\u0026#34;)#=\u0026gt; says \u0026#34;False rumour!\u0026#34; å› æ­¤ï¼Œæˆ‘ä»¬çš„å‡½æ•° choose æ¥æ”¶ä¸¤ä¸ªå‡½æ•°ä½œä¸ºå®ƒçš„å‰ä¸¤ä¸ªå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªå‡½æ•°ã€‚åœ¨ Raku ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å‡½æ•°åä¸ŠåŠ ä¸Š \u0026amp; ç¬¦å·ï¼Œå› ä¸ºå¦åˆ™å®ƒä»¬ä¼šè¢«æ±‚å€¼ï¼šåƒ tt è¿™æ ·çš„è£¸å‡½æ•°åå°±ç­‰äºè°ƒç”¨æ²¡æœ‰å‚æ•°çš„å‡½æ•° tt()ã€‚é€šè¿‡å°†è¿™ä¸ªå‡½æ•°èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡(res_f)ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å°† res_f ä½œä¸ºä¸€ä¸ªå‡½æ•°æ¥è°ƒç”¨ï¼Œå®ƒæœ€ç»ˆä¼šæ ¹æ®é€‰æ‹©æ¥è°ƒç”¨ tt æˆ– ffã€‚\nå‡½æ•°ä¸éœ€è¦åå­— ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥å°†å‡½æ•°èµ‹å€¼ç»™å˜é‡ï¼Œå®ƒä»¬æœ¬èº«å…¶å®å¹¶ä¸éœ€è¦ä¸€ä¸ªåå­—ã€‚æ‰€ä»¥æˆ‘ä»¬çš„å‡½æ•°å¯ä»¥æ˜¯åŒ¿åçš„ã€‚å¤§å¤šæ•°è¯­è¨€éƒ½æ”¯æŒåŒ¿åå‡½æ•°ï¼Œåœ¨å‡½æ•°å¼è¯­è¨€ä¸­ï¼Œå®ƒä»¬é€šå¸¸è¢«ç§°ä¸º \u0026ldquo;lambda å‡½æ•°\u0026rdquo;ã€‚åœ¨ Raku ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•æ¥åˆ›å»ºåŒ¿åå‡½æ•°ã€‚\nä½¿ç”¨ sub (...) è¯­æ³•:\nmy \\tt = sub (\\s){ say \u0026#34;True {s}!\u0026#34;}; æˆ–è€…ä½¿ç”¨\u0026lsquo;å°–å·å—\u0026rsquo;è¯­æ³•ï¼Œè¿™æ ·æ›´ç´§å‡‘ä¸€äº›:\nmy \\ff = -\u0026gt; \\s {say \u0026#34;False {s}!\u0026#34;}; Python ä½¿ç”¨ lambda å…³é”®å­—:\ntt = lambda s : print( \u0026#34;True \u0026#34;+s+\u0026#34;!\u0026#34; ) ff = lambda s : print( \u0026#34;False \u0026#34;+s+\u0026#34;!\u0026#34; ) æ‰€ä»¥ç°åœ¨æˆ‘ä»¬å¯ä»¥è¯´:\nmy \u0026amp;res_f = choose(tt, ff, True); say \u0026amp;res_f; #=\u0026gt;says sub { } res_f(\u0026#34;story\u0026#34;); #= says \u0026#34;True story!\u0026#34; å½“æˆ‘ä»¬æ‰“å°å‡ºå‡½æ•°æ‰€ç»‘å®šçš„å˜é‡æ—¶ï¼ŒRaku è¿”å› sub { } æ¥è¡¨ç¤ºè¯¥å˜é‡åŒ…å«ä¸€ä¸ªå‡½æ•°ã€‚\nåœ¨ Python ä¸­:\nres_f = choose(tt, ff, True); print( res_f) #=\u0026gt; says \u0026lt;function \u0026lt;lambda\u0026gt; at 0x7f829b298b80\u0026gt; res_f(\u0026#34;story\u0026#34;) #=\u0026gt; says \u0026#34;True story!\u0026#34; ä¾‹å­: mapã€ grep å’Œ reduce å‡½æ•°çš„åŠŸèƒ½æœ‰å¾ˆå¤šç”¨é€”ï¼Œæˆ‘åªæƒ³é‡ç‚¹ä»‹ç»ä¸‰ä¸ªåœ¨ Raku ä¸­ç°æˆçš„ä¾‹å­ï¼šmapã€reduce å’Œ grepã€‚Python æœ‰ map å’Œ filterï¼Œå¹¶é€šè¿‡ functools æ¨¡å—æä¾› reduceã€‚è¿™äº›å‡½æ•°çš„å…±åŒç‚¹æ˜¯ï¼Œå®ƒä»¬æä¾›äº†ä¸€ç§å¯¹åˆ—è¡¨è¿›è¡Œ for å¾ªç¯çš„æ›¿ä»£æ–¹æ³•ã€‚\nmap : å¯¹åˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œå‡½æ•°åº”ç”¨ map æœ‰ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªå‡½æ•°å’Œä¸€ä¸ªåˆ—è¡¨ã€‚å®ƒå°†å‡½æ•°æŒ‰é¡ºåºåº”ç”¨äºåˆ—è¡¨ä¸­çš„æ‰€æœ‰å€¼ï¼Œå¹¶è¿”å›ç»“æœï¼Œä¾‹å¦‚å°†åˆ—è¡¨ä¸­çš„æ‰€æœ‰å€¼å¹³æ–¹ã€‚\nmy \\res = map -\u0026gt; \\x {x*x} , 1 .. 10; åœ¨ Python ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ˜¾å¼åœ°åˆ›å»ºå…ƒç»„ï¼Œä½†é™¤äº†è¯­æ³•ä¸Šçš„å·®å¼‚ï¼Œç»“æ„æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚\nres = tuple( map( lambda x : x*x , range(1,11))) è¿™æ˜¯å¯¹ä¼ ç»Ÿ for å¾ªç¯çš„åŠŸèƒ½æ›¿ä»£ã€‚\n# Raku my \\res = []; for 1 .. 10 -\u0026gt; \\x { res.push(x*x); } # Python res = [] for x in range(1,11): res.append(x*x) è¯·æ³¨æ„ï¼Œåœ¨ Raku å’Œ Python ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¸º for å¾ªç¯ç‰ˆæœ¬ä½¿ç”¨ä¸€ä¸ªå¯å˜çš„æ•°æ®ç»“æ„ï¼Œè€Œ map ç‰ˆæœ¬åˆ™ä½¿ç”¨ä¸å¯å˜çš„æ•°æ®ç»“æ„ã€‚\ngrep : è¿‡æ»¤åˆ—è¡¨ grep (åœ¨ Python ä¸­ç§°ä¸º filter)ä¹Ÿæ¥å—å‚æ•°ï¼Œä¸€ä¸ªå‡½æ•°å’Œä¸€ä¸ªåˆ—è¡¨ï¼Œä½†å®ƒåªè¿”å›å‡½æ•°è¿”å›çœŸçš„åˆ—è¡¨ä¸­çš„å€¼ã€‚\n# Raku my \\res = grep -\u0026gt; \\x { x % 5 == 0 }, 1 .. 30; # Python res = tuple(filter( lambda x : x % 5 == 0 ,range(1,31))) å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ for å¾ªç¯å’Œ if è¯­å¥æ¥å†™ï¼Œä½†è¿™åˆéœ€è¦ä¸€ä¸ªå¯å˜çš„æ•°æ®ç»“æ„ã€‚\n# Raku my \\res = []; for 1 .. 30 -\u0026gt; \\x { if (x % 5 == 0) { res.push(x); } } # Python res = [] for x in range(1,31): if (x % 5 == 0): res.append(x) map å’Œ grep çš„å¥½å¤„æ˜¯ï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°æŠŠå®ƒä»¬é“¾åœ¨ä¸€èµ·ã€‚\n# Raku grep -\u0026gt; \\x { x % 5 == 0 }, map -\u0026gt; \\x {x*x}, 1..30 # Python res = tuple(filter( lambda x : x % 5 == 0 ,map( lambda x : x*x ,range(1,31)))) è¿™æ˜¯å› ä¸º map å’Œ grep æ¥å—ä¸€ä¸ªåˆ—è¡¨å¹¶è¿”å›ä¸€ä¸ªåˆ—è¡¨ï¼Œæ‰€ä»¥åªè¦ä½ éœ€è¦å¯¹ä¸€ä¸ªåˆ—è¡¨è¿›è¡Œæ“ä½œï¼Œå°±å¯ä»¥é€šè¿‡é“¾å¼è°ƒç”¨æ¥å®ç°ã€‚\nreduce : åŒ–æ•´ä¸ºé›¶ reduce ä¹Ÿæ¥å—ä¸€ä¸ªå‡½æ•°å’Œä¸€ä¸ª listï¼Œä½†å®ƒä½¿ç”¨å‡½æ•°å°† list çš„æ‰€æœ‰å…ƒç´ åˆå¹¶æˆä¸€ä¸ªç»“æœã€‚æ‰€ä»¥å‡½æ•°å¿…é¡»æ¥å—ä¸¤ä¸ªå‚æ•°ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä»åˆ—è¡¨ä¸­å–å‡ºçš„å…ƒç´ ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºçŠ¶æ€å˜é‡æ¥ç»„åˆæ‰€æœ‰å…ƒç´ ã€‚ä¾‹å¦‚ï¼Œè®¡ç®—ä¸€ä¸ªæ•°å­—åˆ—è¡¨çš„å’Œ:\n# Raku my \\sum = reduce sub (\\acc,\\elt) {acc+elt}, 1 .. 10; say sum; #=\u0026gt;says 55 # Python from functools import reduce sum = reduce(lambda acc,elt: acc+elt, range(1,11)) print( sum); #= says 55 è¿™é‡Œå‘ç”Ÿçš„æƒ…å†µæ˜¯ï¼Œé¦–å…ˆå°† acc è®¾ç½®ä¸ºåˆ—è¡¨ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ (1)ï¼Œç„¶ååŠ ä¸Šç¬¬äºŒä¸ªå…ƒç´ ï¼Œæ‰€ä»¥ acc å˜æˆ 1+2=3ï¼›ç„¶ååŠ ä¸Šç¬¬ä¸‰ä¸ªå…ƒç´ (3)ï¼Œä»¥æ­¤ç±»æ¨ã€‚å…¶æ•ˆæœæ˜¯å°†åˆ—è¡¨ä¸­çš„æ‰€æœ‰æ•°å­—è¿ç»­ç›¸åŠ ã€‚\nä¸ºäº†æ›´æ¸…æ¥šåœ°è¯´æ˜è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬æ¥å†™ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±çš„ reduce ç‰ˆæœ¬ã€‚\nç¼–å†™ä½ è‡ªå·±çš„ åœ¨è®¸å¤šå‡½æ•°å¼è¯­è¨€ä¸­ï¼Œä»å·¦åˆ°å³ï¼ˆä»æœ€ä½ç´¢å¼•å¼€å§‹ï¼‰å’Œä»å³åˆ°å·¦ï¼ˆä»æœ€é«˜ç´¢å¼•å¼€å§‹ï¼‰çš„è¿˜åŸæ˜¯æœ‰åŒºåˆ«çš„ã€‚è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå› ä¸ºæ ¹æ®åšè¿˜åŸçš„å‡½æ•°ï¼Œå¦‚æœä»å·¦è¾¹æˆ–å³è¾¹æ¶ˆè€—åˆ—è¡¨ï¼Œç»“æœå¯èƒ½ä¼šä¸åŒã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬çš„åŒ–ç®€å‡½æ•°æ˜¯\n# Raku -\u0026gt; \\x,\\y {x+y} # Python lambda x,y: x+y é‚£ä¹ˆæˆ‘ä»¬ä»å“ªä¸ªæ–¹å‘éå†åˆ—è¡¨å¹¶ä¸é‡è¦ã€‚ä½†è€ƒè™‘ä»¥ä¸‹å‡½æ•°:\n# Raku -\u0026gt; \\x,\\y { x \u0026lt; y ?? x+y !! x } # Python lambda x,y: x+y if x\u0026lt;y else x ( ... ?? ... !! ... æ˜¯æ¡ä»¶æ“ä½œç¬¦çš„ Raku å¥æ³•ï¼Œåœ¨å¤§å¤šæ•°å…¶ä»–è¯­è¨€ä¸­æ˜¯ ... ? ... : ... åœ¨ Python ä¸­æ˜¯ ... if ... else ...)ã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœåˆ—è¡¨ä»å·¦æˆ–ä»å³è¿˜åŸï¼Œç»“æœä¼šæœ‰æ‰€ä¸åŒã€‚åœ¨ Raku å’Œ Python ä¸­ï¼Œreduce æ˜¯ä¸€ç§ä»å·¦åˆ°å³çš„è¿˜åŸã€‚\nå¦å¤–ï¼Œreduce å‡½æ•°å¯ä»¥ä¸ä½¿ç”¨åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè€Œæ˜¯å–ä¸€ä¸ªé¢å¤–çš„å‚æ•°ï¼Œé€šå¸¸ç§°ä¸ºç´¯åŠ å™¨ã€‚åœ¨å‡½æ•°å¼è¯­è¨€ä¸­ï¼Œreduce é€šå¸¸è¢«ç§°ä¸º foldï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æœ‰ä¸€ä¸ªå·¦æŠ˜å’Œä¸€ä¸ªå³æŠ˜ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•å®ç°è¿™äº›ã€‚\nLeft fold å®ç°å·¦æŠ˜çš„ç›´æ¥æ–¹æ³•ï¼ˆæ‰€ä»¥å’Œ reduce ä¸€æ ·ï¼‰æ˜¯åœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨ for å¾ªç¯ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»åœ¨å¾ªç¯çš„æ¯æ¬¡è¿­ä»£ä¸Šæ›´æ–°ç´¯åŠ å™¨çš„å€¼ã€‚åœ¨ Raku ä¸­ï¼Œæ— ç¬¦å·å˜é‡æ˜¯ä¸å¯å˜çš„ï¼ˆæˆ‘åœ¨è¿™é‡Œç®€åŒ–äº†ï¼Œå®Œæ•´çš„æ•…äº‹è¯·çœ‹ Raku æ–‡æ¡£ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ä¸ªæœ‰ç¬¦å·çš„å˜é‡ï¼Œ$accã€‚\n# Raku sub foldll (\u0026amp;f, \\iacc, \\lst) { my $acc = iacc; for lst -\u0026gt; \\elt { $acc = f($acc,elt); } $acc; } # Python def foldll (f, iacc, lst): acc = iacc for elt in lst: acc = f(acc,elt) return acc å¦‚æœæˆ‘ä»¬åªæƒ³ä½¿ç”¨ä¸å¯å˜çš„å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é€’å½’ã€‚Raku ä½¿è¿™ä¸€ç‚¹å˜å¾—ç®€å•ï¼Œå› ä¸ºå®ƒå…è®¸ä¸€ä¸ªå­ç¨‹åºæœ‰å¤šä¸ªç­¾å(multi sub)ï¼Œå¹¶ä¸”å®ƒä¼šè°ƒç”¨ä¸ç­¾åç›¸åŒ¹é…çš„å˜é‡ã€‚\næˆ‘ä»¬çš„ foldl å°†æ¶ˆè€—è¾“å…¥åˆ—è¡¨ lstï¼Œå¹¶ä½¿ç”¨ f å°†å…¶å…ƒç´ ç»„åˆåˆ°ç´¯åŠ å™¨ acc ä¸­ï¼Œå½“åˆ—è¡¨è¢«æ¶ˆè€—åï¼Œè®¡ç®—ç»“æŸï¼Œæˆ‘ä»¬å¯ä»¥è¿”å› acc ä½œä¸ºç»“æœã€‚æ‰€ä»¥æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªå˜ä½“è¯´ï¼Œå¦‚æœè¾“å…¥åˆ—è¡¨æ˜¯ç©ºçš„ï¼Œæˆ‘ä»¬åº”è¯¥è¿”å› accã€‚ ç¬¬äºŒä¸ªå˜ä½“ä»åˆ—è¡¨ä¸­å–å‡ºä¸€ä¸ªå…ƒç´  elt (å…³äº * çš„ç»†èŠ‚è¯·å‚è§ Raku æ–‡æ¡£)ï¼Œå¹¶å°†å…¶ä¸ acc ç»“åˆåˆ° f(acc,elt) ä¸­ã€‚ç„¶åç”¨è¿™ä¸ªæ–°çš„ç´¯åŠ å™¨å’Œ list çš„å‰©ä½™éƒ¨åˆ† rest å†æ¬¡è°ƒç”¨ foldlã€‚\n# When the list is empty, return the accumulator multi sub foldl (\u0026amp;f, \\acc, ()) { acc } multi sub foldl (\u0026amp;f, \\acc, \\lst) { # Raku\u0026#39;s way of splitting a list in the first elt and the rest # The \u0026#39;*\u0026#39; is a shorthand for the end of the list my (\\elt,\\rest) = lst[0, 1 .. * ]; # The actual recursion foldl( \u0026amp;f, f(acc, elt), rest); } Python ä¸å…è®¸è¿™ç§æ¨¡å¼åŒ¹é…ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨æ¡ä»¶æ¥ç¼–å†™é€’å½’ã€‚\ndef foldl (f, acc, lst): if lst == (): return acc else: # Python\u0026#39;s way of splitting a tuple in the first elt and the rest # rest will be a list, not a tuple, but we\u0026#39;ll let that pass (elt,*rest) = lst # The actual recursion return foldl( f, f(acc, elt), rest) åœ¨è¿™ä¸ªå®ç°ä¸­ï¼Œæ‰€æœ‰çš„å˜é‡éƒ½ä¸ä¼šè¢«æ›´æ–°ã€‚æ‰€ä»¥æ‰€æœ‰çš„å˜é‡éƒ½å¯ä»¥æ˜¯ä¸å¯å˜çš„ã€‚\nRight fold å³æŠ˜ä¸å·¦æŠ˜é¢‡ä¸ºç›¸ä¼¼ã€‚å¯¹äºåŸºäºå¾ªç¯çš„ç‰ˆæœ¬ï¼Œæˆ‘ä»¬æ‰€åšçš„åªæ˜¯å°†åˆ—è¡¨åè½¬(reverse)ã€‚\n# Raku sub foldrl (\u0026amp;f, \\acc, \\lst) { my $res = acc; for lst.reverse -\u0026gt; \\elt { $res = f($res,elt); } $res; } # Python def foldlr (f, iacc, lst): acc = iacc for elt in lst.reverse(): acc = f(acc,elt) return acc åœ¨é€’å½’ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬ä»åˆ—è¡¨ä¸­å–æœ€åä¸€ä¸ªå…ƒç´ è€Œä¸æ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚å…³äº ..^ * - 1 è¯­æ³•çš„ç»†èŠ‚ï¼Œè¯·å‚è§ Raku æ–‡æ¡£ã€‚\n# Raku multi sub foldr ( \u0026amp;f, \\acc, ()) { acc } multi sub foldr (\u0026amp;f, \\acc, \\lst) { my (\\rest,\\elt) = lst[0..^*-1, * ]; foldr( \u0026amp;f, f(acc, elt), rest); } # Python def foldr (f, acc, lst): if lst == (): return acc else: (*rest,elt) = lst return foldr( f, f(acc, elt), rest) map and grep are folds ç°åœ¨ï¼Œmap å’Œ grep å‘¢ï¼Ÿæˆ‘ä»¬å½“ç„¶å¯ä»¥ç”¨ for å¾ªç¯æ¥å®ç°ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨æˆ‘ä»¬çš„ foldl æ¥å®ç°å®ƒä»¬ã€‚\n# Raku sub map (\u0026amp;f,\\lst) { foldl( sub (\\acc,\\elt) { (|acc,f(elt)) }, (), lst); } # Python def map (f,lst): return foldl( lambda acc,elt:(*acc, f(elt)) ,() ,lst ) å› ä¸ºå‡½æ•° f æ˜¯å¯æ˜ å°„çš„ï¼Œæ‰€ä»¥å®ƒåªæœ‰ä¸€ä¸ªå‚æ•°ã€‚ä½†æ˜¯ foldl éœ€è¦ä¸€ä¸ªæœ‰ä¸¤ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç´¯åŠ å™¨ã€‚æ‰€ä»¥æˆ‘ä»¬ç”¨ä¸¤ä¸ªå‚æ•°çš„åŒ¿åå‡½æ•°è°ƒç”¨ foldlã€‚ç´¯ç§¯å™¨æœ¬èº«æ˜¯ä¸€ä¸ªç©ºåˆ—è¡¨ã€‚è™½ç„¶æˆ‘ä»¬å‰é¢è¯´è¿‡ï¼Œè¿˜åŸå°†åŸæ¥åˆ—è¡¨çš„æ‰€æœ‰å…ƒç´ åˆå¹¶æˆä¸€ä¸ªè¿”å›å€¼ï¼Œå½“ç„¶è¿™ä¸ªè¿”å›å€¼å¯ä»¥æ˜¯ä»»ä½•æ•°æ®ç±»å‹ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚æ‰€ä»¥æˆ‘ä»¬å¯¹åŸå§‹åˆ—è¡¨ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½è°ƒç”¨ fï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°ç´¯åŠ å™¨åˆ—è¡¨çš„æœ«å°¾ã€‚(| å°†åˆ—è¡¨æ‰å¹³åŒ–ï¼Œæ‰€ä»¥ (|acc,f(elt)) æ˜¯ä¸€ä¸ªç”± acc çš„å…ƒç´ å’Œ f(elt) çš„ç»“æœå»ºç«‹çš„æ–°åˆ—è¡¨ã€‚)\nç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å®šä¹‰ grep:\n# Raku sub grep (\u0026amp;f,\\lst) { foldl( sub (\\acc,\\elt) { if (f(elt)) { (|acc,elt) } else { acc } }, (), lst); } # Python def filter (f,lst): return foldl( lambda acc,elt: (*acc,elt) if f(elt) else acc , (), lst) å°±åƒåœ¨ map å®ç°ä¸­ä¸€æ ·ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªåŒ¿åå‡½æ•°è°ƒç”¨ foldlã€‚åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬æµ‹è¯• lst ä¸­çš„æ¯ä¸ª elt æ˜¯å¦ä¸º f(elt) ä¸ºçœŸã€‚å¦‚æœæ˜¯çœŸï¼Œæˆ‘ä»¬å°±ä» acc å’Œ elt åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ—è¡¨ï¼Œå¦åˆ™æˆ‘ä»¬å°±åªè¿”å› accã€‚ å› ä¸º map å’Œ grep åˆ†åˆ«å¯¹åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ è¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å³æŠ˜æ¥å®ç°å®ƒä»¬ã€‚\né€šè¿‡è¿™äº›ä¾‹å­ï¼Œæˆ‘å¸Œæœ›æ— è®ºæ˜¯å¯¹å‡½æ•°å·¥ä½œçš„æ¦‚å¿µï¼Œè¿˜æ˜¯å¯¹å‡½æ•°å¯èƒ½çš„å®ç°æ–¹å¼ï¼Œéƒ½å˜å¾—æ›´åŠ æ¸…æ™°ã€‚é€’å½’å®ç°çš„ä¼˜ç‚¹æ˜¯å®ƒå…è®¸æˆ‘ä»¬ä½¿ç”¨ä¸å¯å˜çš„æ•°æ®ç»“æ„ã€‚\nä¸ºä»€ä¹ˆæ˜¯ä¸å¯å˜çš„æ•°æ®ç»“æ„ï¼Ÿ ä½ å¯èƒ½ä¼šå¥½å¥‡ä¸ºä»€ä¹ˆæˆ‘å…³æ³¨è¿™äº›ä¸å¯å˜çš„æ•°æ®ç»“æ„ã€‚æ­£å¦‚æˆ‘ä»¬å°†çœ‹åˆ°çš„é‚£æ ·ï¼Œå‡½æ•°å¼ç¼–ç¨‹ä¸ä¸å¯æ”¹å˜çš„æ•°æ®ç»“æ„é…åˆå¾—éå¸¸å¥½ã€‚è€Œä¸”å®ƒä»¬æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ä¼˜åŠ¿ï¼šä½ æ°¸è¿œä¸ç”¨æ‹…å¿ƒæ˜¯å¦ä¸å°å¿ƒä¿®æ”¹äº†ä½ çš„æ•°æ®ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒæ˜¯å¦åº”è¯¥åšä¸€ä¸ªå‰¯æœ¬æ¥ç¡®å®šã€‚æ‰€ä»¥ä½¿ç”¨ä¸å¯å˜æ•°æ®ç»“æ„å¯ä»¥ä½¿ä»£ç ä¸æ˜“å‡ºé”™ï¼Œæ›´å®¹æ˜“è°ƒè¯•ã€‚å®ƒä»¬è¿˜å…·æœ‰æ½œåœ¨çš„æ€§èƒ½ä¼˜åŠ¿ã€‚è€Œæˆ‘ä»¬æ¥ä¸‹æ¥ä¼šçœ‹åˆ°ï¼Œåœ¨ Raku ä¸­è¿˜æœ‰å¦ä¸€ä¸ªä¼˜åŠ¿ã€‚\nè¿”å›å‡½æ•°çš„å‡½æ•° å‡½æ•°ä¹Ÿå¯ä»¥è¿”å›å‡½æ•°ã€‚å¦‚æœæˆ‘ä»¬æƒ³æ‹¥æœ‰ä¸€ä¸ªå¯å‚æ•°åŒ–çš„å‡½æ•°ï¼Œè¿™ä¸€ç‚¹å°¤å…¶æœ‰ç”¨ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬æƒ³è¦ä¸€ç³»åˆ—ä»¥å›ºå®šå€¼é€’å¢ä¸€ä¸ªæ•°å­—çš„å‡½æ•°ï¼šadd1ã€add2 ç­‰ã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†åˆ«å†™å‡ºæ¯ä¸€ä¸ªå‡½æ•°ã€‚\n# Raku sub add_1 (\\x) {x+1} sub add_2 (\\x) {x+2} sub add_3 (\\x) {x+3} sub add_4 (\\x) {x+4} sub add_5 (\\x) {x+5} say add_1(4); #=\u0026gt;says 5 # Python def add_1 (x) : return x+1 def add_2 (x) : return x+2 def add_3 (x) : return x+3 def add_4 (x) : return x+4 def add_5 (x) : return x+5 print( add_1(4)) #= says 5 æˆ–è€…æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå……æ»¡åŒ¿åå‡½æ•°çš„åˆ—è¡¨ã€‚\n# Raku my \\add = sub (\\x) {x}, sub (\\x) {x+1}, sub (\\x) {x+2}, sub (\\x) {x+3}, sub (\\x) {x+4}, sub (\\x) {x+5}; say add[0].(4); #=\u0026gt;says 5 # Python add = ( lambda x : x+1, lambda x : x+2, lambda x : x+3, lambda x : x+4, lambda x : x+5 ) print( add[0](4)) #= says 5 æˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½ï¼Œç”¨ä¸€ä¸ªå¾ªç¯æ¥å¡«å……ä¸€ä¸ªåŒ¿åå‡½æ•°çš„æ•°ç»„ã€‚\n# Raku my \\add = []; for 0 .. 5 -\u0026gt; \\n { add.push(sub (\\x) {x+n}); } say add[1].(4); #=\u0026gt;says 5 # Python add = [] for n in range(0,6): add.append(lambda x: x+n) æˆ‘ä»¬æ¯æ¬¡å¾ªç¯è¿­ä»£éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„åŒ¿åå‡½æ•°ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°æ•°ç»„ä¸­ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå‡½æ•°æ¥åˆ›å»ºè¿™äº›åŒ¿åå‡½æ•°ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ map æ¥ä»£æ›¿å¾ªç¯ï¼Œå¹¶ä½¿ç”¨ä¸€ä¸ªä¸å¯æ”¹å˜çš„æ•°æ®ç»“æ„ã€‚\n# Raku sub gen_add(\\n) { sub (\\x) {x+n} } my \\add = map \u0026amp;gen_add, 0..5; say add[1].(4); #=\u0026gt;says 5 # Python def gen_add(n): return lambda x : x+n add = tuple(map( gen_add, range(0,6))) print( add[1](4)) #= says 5 Laziness åœ¨ Raku ä¸­ï¼Œä½¿ç”¨(ä¸å¯æ”¹å˜çš„)èŒƒå›´æœ‰ä¸€ä¸ªé¢å¤–çš„å¥½å¤„ï¼šæˆ‘ä»¬å¯ä»¥å°†èŒƒå›´çš„æœ«ç«¯è®¾ç½®ä¸ºæ— ç©·å¤§ï¼Œåœ¨ Raku ä¸­å¯ä»¥å†™æˆ âˆ(unicode 221E)ã€* æˆ– Infã€‚\n# Raku my \\add = map \u0026amp;gen_add, 0 .. âˆ; say add[244].(7124); #=\u0026gt;says 7368 è¿™æ˜¯ä¸€ä¸ªæ‰€è°“çš„\u0026quot;æ‡’æƒ°æ±‚å€¼\u0026quot;çš„ä¾‹å­ï¼Œç®€ç§° lazinessï¼šRaku ä¸ä¼šå°è¯•ï¼ˆå’Œå¤±è´¥ï¼‰å¤„ç†è¿™ä¸ªæ— é™çš„åˆ—è¡¨ã€‚ç›¸åï¼Œå®ƒå°†åœ¨æˆ‘ä»¬å®é™…ä½¿ç”¨è¯¥åˆ—è¡¨ä¸­çš„ä¸€ä¸ªå…ƒç´ æ—¶è¿›è¡Œå¤„ç†ã€‚è¡¨è¾¾å¼çš„è¯„ä¼°ä¼šå»¶è¿Ÿåˆ°éœ€è¦ç»“æœçš„æ—¶å€™ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è°ƒç”¨ add[244] æ—¶ï¼Œå‘ç”Ÿçš„æƒ…å†µæ˜¯ gen_add(244) è¢«è°ƒç”¨æ¥ç”Ÿæˆè¯¥å‡½æ•°ã€‚è¯·æ³¨æ„ï¼Œè¿™åœ¨ for å¾ªç¯ä¸­æ˜¯è¡Œä¸é€šçš„ï¼Œå› ä¸ºè¦ä½¿ç”¨ for å¾ªç¯ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¯å˜çš„æ•°æ®ç»“æ„ï¼Œè€Œæƒ°æ€§åˆ—è¡¨å¿…é¡»æ˜¯ä¸å¯å˜çš„ã€‚æ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œè¯´æ˜å‡½æ•°å¼ç¼–ç¨‹é£æ ¼å¦‚ä½•è®©ä½ ä»æ‡’æƒ°ä¸­è·ç›Šã€‚\nè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬é€’å½’åœ°å®ç°äº† foldlï¼Œç„¶åç”¨å®ƒæ¥å®ç°æˆ‘ä»¬è‡ªå·±çš„ map å’Œ grepï¼šåŸºäºé€’å½’çš„ç‰ˆæœ¬ä¸éœ€è¦æ›´æ–°ä»»ä½•å˜é‡ï¼Œæ‰€ä»¥å®ƒä»¬å¯ä»¥ä¸ä¸å¯å˜çš„æƒ°æ€§æ•°æ®ç»“æ„ä¸€èµ·å·¥ä½œã€‚\nå‡½æ•°ç»„åˆ æˆ‘ä»¬åœ¨ä¸Šé¢çœ‹åˆ°ï¼Œä½ å¯ä»¥æŠŠ map å’Œ grep çš„è°ƒç”¨é“¾åœ¨ä¸€èµ·ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä½ åªéœ€è¦å°† map è°ƒç”¨é“¾åœ¨ä¸€èµ·ï¼Œä¾‹å¦‚\n# Raku map -\u0026gt; \\x { x + 5 }, map -\u0026gt; \\x {x*x}, 1..30; # Python map( lambda x : x + 5, map( lambda x : x*x, range(1,31))) åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åšå¾—æ›´æœ‰æ•ˆç‡ä¸€äº›ï¼šæ¯”èµ·åˆ›å»ºä¸€ä¸ªåˆ—è¡¨ï¼Œç„¶ååœ¨è¿™ä¸ªåˆ—è¡¨ä¸Šè°ƒç”¨ mapï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç»„åˆå‡½æ•°ä¸€æ¬¡å®Œæˆä¸¤ä¸ªè®¡ç®—ã€‚Raku ä¸ºæ­¤æä¾›äº†ä¸€ä¸ªç‰¹æ®Šçš„æ“ä½œç¬¦ã€‚\nmap -\u0026gt; \\x { x + 5 } âˆ˜ -\u0026gt; \\x { x * x }, 1..30; æ“ä½œç¬¦ âˆ˜ï¼ˆ\u0026ldquo;ç¯å½¢æ“ä½œç¬¦\u0026rdquo;ï¼Œunicode 2218ï¼Œä½†ä½ ä¹Ÿå¯ä»¥ç”¨æ™®é€šçš„ oï¼‰æ˜¯å‡½æ•°ç»„æˆæ“ä½œç¬¦ï¼Œå®ƒçš„å‘éŸ³æ˜¯ \u0026ldquo;after\u0026rdquo;ï¼Œæ‰€ä»¥ f âˆ˜ g æ˜¯ \u0026ldquo;f after g\u0026rdquo;ã€‚å®ƒçš„ä½œç”¨æ˜¯å°†ä¸¤ä¸ªç°æœ‰çš„å‡½æ•°ç»„åˆèµ·æ¥ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ã€‚\nmy \u0026amp;h = \u0026amp;f âˆ˜ \u0026amp;g; æ˜¯ä¸‹é¢çš„ä»£ç æ˜¯ä¸€æ ·çš„:\nsub h (\\x) { f(g(x)) } ç»„æˆè¿ç®—ç¬¦çš„ä¼˜ç‚¹æ˜¯ï¼Œå®ƒå¯ä»¥é€‚ç”¨äºä»»ä½•å‡½æ•°ï¼ŒåŒ…æ‹¬åŒ¿åå‡½æ•°ã€‚ä½†å®é™…ä¸Šï¼Œå®ƒåªæ˜¯å¦ä¸€ä¸ªé«˜é˜¶å‡½æ•°ã€‚å®ƒåªæ˜¯ä¸‹é¢å‡½æ•°çš„è¿ç®—ç¬¦å½¢å¼ã€‚\n# Raku sub compose(\u0026amp;f,\u0026amp;g) { sub (\\x) { f(g(x)) } } Python æ²¡æœ‰å‡½æ•°ç»„æˆæ“ä½œç¬¦ï¼Œä½†ä½ ä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨ Python ä¸­æ‹¥æœ‰ composeã€‚\n# Python def compose(f,g): return lambda x: f(g(x)) ç»“è®º åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ç”¨ Raku å’Œ Python çš„ä¾‹å­ä»‹ç»äº†ä¸‰ç§å…³é”®çš„å‡½æ•°å¼ç¼–ç¨‹æŠ€æœ¯ï¼šå¯¹å‡½æ•°è¿›è¡Œæ“ä½œçš„å‡½æ•°ã€è¿”å›å‡½æ•°çš„å‡½æ•°å’Œå‡½æ•°ç»„æˆã€‚æˆ‘å·²ç»å±•ç¤ºäº†ä½ å¦‚ä½•ä½¿ç”¨å‡½æ•° mapã€reduce(æŠ˜å )å’Œ grep(è¿‡æ»¤)æ¥æ“ä½œä¸å¯å˜çš„åˆ—è¡¨ã€‚æˆ‘å·²ç»è§£é‡Šäº†å“Ÿ(å¦‚ä½•ç”¨é€’å½’å’Œä¸é€’å½’å®ç°è¿™æ ·çš„å‡½æ•°ï¼Œä»¥åŠé€’å½’å®ç°çš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆã€‚ä¸‹é¢æ˜¯ã€Š Raku ä¸ Pythonã€‹ä¸€æ–‡ä¸­çš„ä»£ç ã€‚\nå½“ç„¶ï¼Œå‡½æ•°å¼ç¼–ç¨‹çš„å†…å®¹è¿˜æœ‰å¾ˆå¤šï¼Œæˆ‘ä¹Ÿå†™äº†å‡ ç¯‡æ›´é«˜çº§çš„æ–‡ç« ã€‚æœ¬æ–‡ä»‹ç»çš„æ¦‚å¿µåº”è¯¥ä¸ºç†è§£é‚£äº›æ›´é«˜çº§çš„ä¸»é¢˜æ‰“ä¸‹è‰¯å¥½çš„åŸºç¡€ã€‚å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äºå‡½æ•°å¼ç¼–ç¨‹çš„çŸ¥è¯†ï¼Œä½ å¯ä»¥è€ƒè™‘æˆ‘çš„å…è´¹åœ¨çº¿è¯¾ç¨‹ã€‚\nåŸæ–‡: https://wimvanderbauwhede.github.io/articles/decluttering-with-functional-programming/\n","permalink":"https://ohmyweekly.github.io/notes/2020-07-26-cleaner-code-with-functional-programming/","tags":["raku","functional programming"],"title":"é€šè¿‡å‡½æ•°å¼ç¼–ç¨‹å®ç°æ›´ç®€æ´çš„ä»£ç "},{"categories":["programming"],"contents":"é—®é¢˜ åœ¨ 6.d ç‰ˆæœ¬ä¸­, å¾ˆå¤šä¸œè¥¿éƒ½å‘ç”Ÿäº†å˜åŒ–, æˆ‘ä»¬è‡³å°‘éœ€è¦å‘å¸ƒä¸€ä¸ªç‰ˆæœ¬ã€‚è¿™é‡Œæœ‰ä¸ªåˆ—è¡¨ã€‚ç„¶è€Œ, è¦†ç›–é¢æ˜¯ä¸å®Œæ•´çš„ã€‚å¼ƒç”¨é€šçŸ¥é‡‡å–äº†ä¸åŒçš„å½¢å¼, ä¸€äº›æ–°çš„ç±»å‹å’Œæ–¹æ³•åœ¨é‚£é‡Œ, ä¸€äº›åˆ™æ²¡æœ‰\u0026hellip;\u0026hellip;\nç”¨ #2632 å¼•ç”¨è¿™ä¸ªé—®é¢˜, å¹¶æ£€æŸ¥é¡¹ç›®, å½“ä½ çš„å·¥ä½œ, æ— è®ºæ˜¯é€šè¿‡æ”¹å˜åçš„æ–‡æ¡£, çœ‹åˆ°æ²¡æœ‰å˜åŒ–, éœ€è¦åšå®ƒã€‚åœ¨è¿™ç§æƒ…å†µä¸‹, è¯·é€šè¿‡è¯„è®ºæˆ–å¦‚ä½•è§£é‡Šä¸ºä»€ä¹ˆæ˜¯è¿™ç§æƒ…å†µã€‚\nç‰ˆæœ¬æ§åˆ¶çš„å˜æ›´  [6.d] \u0026amp;await åœ¨ç­‰å¾…çš„æ—¶å€™ä¸å†é˜»å¡çº¿ç¨‹ [6.d] whenever ä¸åœ¨ react æŠ›å‡ºçš„è¯æ³•ä½œç”¨åŸŸå†… [6.d] åœ¨ sub MAIN é‡Œé¢çš„ $*ARGFILES æ€»æ˜¯ç”± $*IN é¦ˆå…¥ [6.d] ç»“æ„(å­—é¢ä¸Šçš„) $()ã€@() å’Œ %() ä¸å¤å­˜åœ¨ [6.d] å¸¦æœ‰ :D/:U ç±»å‹çº¦æŸçš„å˜é‡é»˜è®¤ä¸ºçº¦æŸç±»å‹çš„ç±»å‹å¯¹è±¡(ä¾‹å¦‚, ä½ å¯ä»¥åœ¨å®ƒä»¬èº«ä¸Šä½¿ç”¨ .new) [6.d] start å—åœ¨ sink ä¸Šä¸‹æ–‡ä¸­é™„åŠ å¼‚å¸¸å¤„ç†ç¨‹åº [6.d] ä¾‹ç¨‹å¿…é¡»ä½¿ç”¨ return-rw æ¥è¿”å›ä¸€ä¸ª Proxy, å³ä½¿ä¾‹ç¨‹è¢«æ ‡è®°ä¸º is raw æˆ– is rw [6.d] åŸç”Ÿçš„ num ç±»å‹é»˜è®¤ä¸º 0e0 è€Œä¸æ˜¯ NaN [6.d] åœ¨å­ç¨‹åºåä¸­, ä¿ç•™äº†é”®åä¸º sym çš„å†’å·å¯¹ï¼ˆå¦‚:sym\u0026lt;foo\u0026gt;ï¼‰, ä»¥å¤‡å°†æ¥ä½¿ç”¨  åºŸå¼ƒ è¿™äº›æ–¹æ³•åœ¨ 6.d è¯­è¨€ä¸­å·²è¢«åºŸå¼ƒ, å¹¶å°†åœ¨ 6.e ä¸­è¢«åˆ é™¤ã€‚å®ç°è€…å¯ä»¥é€‰æ‹©å‘å‡ºå¼ƒç”¨è­¦å‘Š, æˆ–è€…åœ¨ 6.e ç‰ˆæœ¬å‘å¸ƒåæ›´é•¿çš„æ—¶é—´å†…æä¾›è¿™äº›æ–¹æ³•ã€‚\n ä½¿ç”¨ '-' (å•è¿å­—ç¬¦)ä½œä¸º \u0026amp;open çš„ç‰¹æ®Šè·¯å¾„, è¡¨ç¤ºç‰¹æ®Šçš„å¥æŸ„(ä½¿ç”¨ IO::Special å¯¹è±¡ä»£æ›¿) IO::Handle.slurp-rest (ä½¿ç”¨ .slurp ä»£æ›¿) Any.flatmap (ä½¿ç”¨.flat å’Œ .map æ–¹æ³•çš„ç»„åˆæ¥ä»£æ›¿) Cool.path (ä½¿ç”¨ .IO ä»£æ›¿) Pair.freeze (ä½¿ç”¨å»å®¹å™¨åŒ–çš„å‚æ•°çš„ Pair.new æ¥ä»£æ›¿) Str.subst-mutate (ä½¿ç”¨å¸¦æœ‰ .= æ–¹æ³•è°ƒç”¨èµ‹å€¼å…ƒè¿ç®—ç¬¦çš„ Str.subst ä»£æ›¿) Rational.norm (ç°åœ¨ Rational ç±»å‹å¿…é¡»åœ¨åˆ›å»ºæ—¶æ ‡å‡†åŒ–) IO::Path.child (ä½¿ç”¨ .add ä»£æ›¿) \u0026amp;undefine (ç›´æ¥åˆ†é… Empty/Nil ä»£æ›¿) :count \u0026amp;lines/Str.lines ä¾‹ç¨‹ä¸Šçš„å‚æ•°(ä½¿ç”¨æ‰€è¿”å›çš„ Seq ä¸Šçš„ .elems ä»£æ›¿) \u0026amp;is_approx in Test.pm6 (ä½¿ç”¨ä¸ \u0026amp;is-approx éå¸¸ç›¸ä¼¼çš„è¡Œä¸ºæ¥ä»£æ›¿)  æ–°çš„è¡Œä¸º  é€šè¿‡æ–°çš„å¯å®šä¹‰çš„ \u0026amp;RUN-MAINã€\u0026amp;ARGS-TO-CAPTURE å’Œ \u0026amp;GENERATE-USAGE å­ä¾‹ç¨‹æ”¹å–„ sub MAIN çš„è‡ªå®šä¹‰å¤„ç† % å˜é‡ä¸­çš„ QuantHash/Map å’Œ @ å˜é‡ä¸­çš„ List å¯ä»¥ç”¨ is ç‰¹æ€§æ¥å£°æ˜ï¼ˆä¾‹å¦‚ï¼Œmy %h is Setï¼‰ æ–°çš„ \u0026lt;ww\u0026gt; regex è§„åˆ™: åªåœ¨å•è¯å†…åŒ¹é… å¾ªç¯å¯ä»¥ä»ä¸Šä¸€æ¡è¯­å¥çš„å€¼ä¸­äº§ç”Ÿä¸€ä¸ªå€¼çš„åˆ—è¡¨ å¾ªç¯ä¸­çš„ next/last æ”¶é›†å…¶æœ€åçš„è¯­å¥å€¼, å¯¹å®ƒä»¬è¿è¡Œçš„è¿­ä»£è¿”å› Empty .perl å¯ä»¥åœ¨æ¶ˆè€—è¿‡çš„ Seqã€å¤šç»´æ•°ç»„ã€Date å’Œ CallFrame ä¸Šè°ƒç”¨ .gist å¯ä»¥åœ¨ Attribute ä¸Šè°ƒç”¨ å¯¹è‡ªåŠ¨ç”Ÿæˆçš„ USAGE ä¿¡æ¯è¿›è¡Œäº†å¤§é‡æ”¹è¿› is hidden-from-USAGE ç‰¹æ€§ï¼Œä»è‡ªåŠ¨ç”Ÿæˆçš„ USAGE æ¶ˆæ¯ä¸­éšè— sub MAIN å€™é€‰è€… Parameter.perl åŒ…æ‹¬å¯å†…çœçš„é»˜è®¤å€¼ %*ENV å€¼æ˜¯åŒç´ å¼‚å½¢çš„ å°è¯•ä½¿ç”¨å˜é‡ $;ã€$,ã€$.ã€$\\ã€$(ã€$)ã€$\u0026lt;ã€$\u0026gt;ã€$/ã€$\\ã€$[ã€$-ã€$+ å’Œ $@ ä¼šæŠ›å‡º X::Syntax::Perl5Var é»˜è®¤çš„ Hash.keyof è¿”å›ä¸€ä¸ª Str(Any) å¼ºè½¬ç±»å‹å¯¹è±¡ é ASCII æ•°å­—å¯ä»¥åœ¨ :42foo å†’å·å¯¹å¿«æ·æ–¹å¼ä¸­ä½¿ç”¨ StrDistance å­—ç¬¦ä¸²åŒ–ä¸º .after å­—ç¬¦ä¸² æ›´æ˜ç¡®çš„ Pod è¡¨æ ¼æ ¼å¼ Enumeration.enums è¿”å›ä¸€ä¸ª Map å„ç§æ•´æ•°ç±»å‹çš„ .Range è¿”å›å®ƒä»¬æ”¯æŒçš„å€¼çš„èŒƒå›´ min/max ä¾‹ç¨‹ä¹Ÿé€‚ç”¨äº Hash Signature å­—é¢å€¼å¯ä»¥åŒ…å«å­—ç¬¦ä¸²/æ•°å­—å­—é¢å€¼ä»¥åŠè°ƒç”¨è€…æ ‡è®° List.invert é€šè¿‡æ‰€éœ€çš„ Pair ç»‘å®šæ˜ å°„, å¯¼è‡´æ½œåœ¨çš„ç±»å‹æ£€æŸ¥å¤±è´¥ :exists å¯ä»¥ä¸å¤šç»´å…³è”ä¸‹æ ‡ä¸€èµ·ä½¿ç”¨ åŠ¨æ€åˆ›å»ºçš„åˆ—è¡¨å¯ä»¥ç”¨æ¥å®šä¹‰ä¸€ä¸ªæšä¸¾ åœ¨ .first ä¸­, Junction å¯ä»¥ä½œä¸ºåŒ¹é…å™¨ä½¿ç”¨ åŸç”Ÿå±æ€§å¯ä»¥ä½œä¸ºå‚æ•°ä¸­çš„ç»‘å®šç›®æ ‡ Proc å¯ä»¥ä¸å…¶ä»– Proc ä¸­çš„ IO::Pipe ä¸€èµ·å·¥ä½œ ç±»å‹æ•°ç»„å¯ä»¥ç”¨ my SomeType @array å’Œ my @array of SomeType åˆ›å»º å½“æŠŠ Mixy å¼ºè½¬ä¸º Setty/Baggy  æ—¶, è´Ÿæ•°æƒé‡çš„é¡¹å°†è¢«åˆ é™¤ :nth å‰¯è¯åœ¨ m// ä¸Šæ¥å—ä¸€ä¸ª Junction ä½œä¸ºå‚æ•° CX::Warn' å’Œ CX::Doneå¯ä»¥åœ¨CONTROL` phaser ä¸­æ•è· next å¯ç”¨äº whenever ä¸­ require ç¬¦å·ä¸å†è¿‡å¢ƒæ€§åœ°æš´éœ²å‡ºæ¥ é€šè¿‡ {...} è¿›è¡Œå¤šç»´è®¿é—®, ç±»ä¼¼äº [...] çš„å·¥ä½œæ–¹å¼ åœ¨ END æ—¶é—´æ‰“å¼€çš„ä»»ä½•æ‰‹æŸ„éƒ½ä¼šè‡ªåŠ¨å…³é—­ åœ¨ç¼“å­˜çš„ Seq ä¸Š, å½“ \u0026amp;infix:\u0026lt;eqv\u0026gt;ã€.Slipã€.joinã€.Listã€.listã€.eagerã€.Array å’Œ .is-lazy è¢«è°ƒç”¨æ—¶, å°±ä¼šä½¿ç”¨ç¼“å­˜åˆ—è¡¨ IO::Handle.encoding ä»¥ Nil è¡¨ç¤ºåˆ‡æ¢åˆ°äºŒè¿›åˆ¶æ¨¡å¼ is default ç‰¹è´¨ä¸å±æ€§ä¸€èµ·å·¥ä½œ åœ¨å¤šé‡åˆ†æ´¾ä¸­, å¸¦æœ‰ is rw ç‰¹æ€§çš„å‚æ•°è¢«è®¤ä¸ºæ¯”æ²¡æœ‰ç‰¹æ€§çš„å‚æ•°çª„ Arrayã€Blob å’Œ Map çš„ .gist è¢«è£å‰ªæˆ100ä¸ªå…ƒç´  æ–°çš„ for è¯­å¥ä¿®é¥°ç¬¦ hyper forã€race for å’Œ lazy for for å¾ªç¯è‡ªåŠ¨åºåˆ—åŒ– RaceSeq/HyperSeqï¼›ä½¿ç”¨æ–°çš„ for è¯­å¥ä¿®é¥°ç¬¦hyper for/race foré¿å… \u0026amp;infix:\u0026lt;does\u0026gt; å¯ç”¨äº RHS ä¸Šçš„éç»„åˆå®ä¾‹ æ•°å€¼æ¯”è¾ƒå™¨å¯ä»¥ä¸ DateTime  å¯¹è±¡ä¸€èµ·ä½¿ç”¨ Pod ä¿ç•™ç©ºç™½ç±»å‹ å®šä¹‰äº†å¸¦ @ã€% å’Œ \u0026amp; é­”ç¬¦å¸¸æ•°çš„è¯­ä¹‰  Math  Rational æ€»æ˜¯åœ¨åˆ›å»ºæ—¶è¢«åŒ–ç®€, å¹¶åœ¨å…¶ä¸€ç”Ÿä¸­ä¿æŒä¸å˜ Infã€Inf å’Œ NaN å¯ä»¥åˆ†åˆ«ç”¨ \u0026lt;-1/0\u0026gt;ã€\u0026lt;1/0\u0026gt; å’Œ \u0026lt;0/0\u0026gt; è¡¨ç¤º, é€šè¿‡Rational ç±»å‹è¿›è¡Œèˆå»ã€‚é›¶åˆ†æ¯ Rational è¢«æ ‡å‡†åŒ–ä¸ºè¿™ä¸‰ä¸ªå€¼ä¹‹ä¸€ åœ¨ Â±Inf å’Œ NaN ä¸Šè°ƒç”¨ .Int, ä¼šæŠ›å‡ºå¼‚å¸¸ æ”¹è¿›äº† Num è¿ç®—ç¬¦å’Œæ•°å­¦å‡½æ•°çš„ IEEE 754-2008 åˆè§„æ€§ è´Ÿé›¶ Num(-0e0)è¢«æ‰€æœ‰ä¾‹ç¨‹å’Œè¯­æ³•ç»“æ„æ­£ç¡®å¤„ç† Num ç±»å‹çš„å­—ç¬¦ä¸²åŒ–å¿…é¡»æ˜¯å¯èˆå¼ƒåˆ°åŸå§‹ Num çš„ å®šä¹‰äº†æ¶‰åŠé›¶çš„ Complex  æŒ‡æ•° .expmod ä¸­çš„è´Ÿæ•°å¹‚æœ‰æ•ˆ  Setsã€Bagsã€Mixes(aka QuantHashes)å’Œé›†åˆè¿ç®—ç¬¦  Set è¿ç®—ç¬¦å¯ä»¥ç”¨åœ¨ä»»ä½•å¯¹è±¡ä¸Š, åœ¨éœ€è¦çš„æ—¶å€™ä¼šè¢«å¼ºè½¬  æ‰€ä»¥, ä¸éœ€è¦ä¹Ÿä¸å¸Œæœ›æœ‰ä»»ä½•é¢„å…ˆçš„å¼ºè½¬ å¦‚æœæ²¡æœ‰ QuantHash å°±èƒ½å®ç°æ‰€éœ€çš„åŠŸèƒ½, é‚£ä¹ˆ Set è¿ç®—ç¬¦å¯ä»¥è‡ªç”±åœ°ä¸åˆ›å»ºä»»ä½• QuantHash   å¯¹ä¸åŒç±»å‹çš„ QuantHashes çš„ Set æ“ä½œå°†å¼ºè½¬åˆ°æœ€è‡ªç”±çš„å½¢å¼ï¼ˆSet -\u0026gt; Bag -\u0026gt; Mixï¼‰ é›†åˆè¿ç®—ç¬¦çš„ set_precedes å®¶æ—( (\u0026lt;+)ã€â‰¼ã€(\u0026gt;+)ã€â‰½) å·²è¢«ç§»é™¤  æ›¾ç»æ˜¯å­é›†è¿ç®—ç¬¦çš„ Baggy å½¢å¼ QuantHash å‡çº§ä¸ºæœ€è‡ªç”±çš„å½¢å¼, æ‰€ä»¥ (\u0026lt;=)ã€âŠ†ã€(\u0026gt;=)ã€âŠ‡ åšæ­£ç¡®çš„äº‹æƒ…   .classify-list æ–¹æ³•å¯ç”¨äº Baggy ç±»å‹ .categorize-list æ–¹æ³•å¯ç”¨äº Baggy ç±»å‹ .invert æ–¹æ³•å¯ç”¨äºæ ¸å¿ƒ QuantHash ç±»å‹ .antipairs æ–¹æ³•å¯ç”¨äº QuantHash ç±»å‹ QuantHash ç±»å‹æœ‰ .new-from-pairs å’Œå°†ä¸€ä¸ª QuantHash ç±»å‹è½¬æ¢ä¸ºå¦ä¸€ä¸ª QuantHash ç±»å‹çš„æ–¹æ³•(ä¾‹å¦‚ Set ç±»å‹çš„ .Bag æ–¹æ³•) QuantHash ç±»å‹ä¸Šçš„ .hash å¯¹é”®å€¼è¿›è¡Œäº†å­—ç¬¦ä¸²åŒ–  æ–°çš„å½¢å‚å’Œå®å‚  Date.new æ¥å—ä¸€ä¸ª :\u0026amp;formatter .first å¯ä»¥æ¥å— :kv unique å’Œ .repeated å¯ä»¥æ¥å— :\u0026amp;as å’Œ :\u0026amp;with Test.pm6 ä¸­çš„ \u0026amp;plan å¯ä»¥æ¥å— :skip-all \u0026amp;run/\u0026amp;shell å¯ä»¥æ¥å— :merge \u0026amp;note å¯ä»¥åœ¨æ²¡æœ‰å‚æ•°çš„æƒ…å†µä¸‹è°ƒç”¨ open æ¥å— :$out-buffer IO::Path.resolve å¯ä»¥æ¥å— :completely IO::Path.parent å¯ä»¥æ¥å—ä¸€ä¸ª Int è¡¨ç¤ºçˆ¶çº§ Proc::Async.new åå™¬ä½ç½®å‚æ•° Signature.ACCEPTS æ¥å—é Signature/Capture å‚æ•° \u0026amp;EVAL å¯ä»¥æ¥å—ä¸€ä¸ª Blob Promise.keep/.break å¯ä»¥åœ¨æ²¡æœ‰å‚æ•°çš„æƒ…å†µä¸‹è°ƒç”¨ åŸç”Ÿæ•°ç»„ä¸Šçš„ .sum å¯ä»¥æ¥å— :wrap is required ç°åœ¨å¯ä»¥æ¥å—ä¸€ä¸ªè¡¨ç¤ºç†ç”±çš„å‚æ•° IO::Socket::Async.listen å¯ä»¥ç»‘å®šåˆ°ç«¯å£ 0 ä»¥å‘æ“ä½œç³»ç»Ÿç”³è¯·å…è´¹ç«¯å£ .encode å¯ä»¥æ¥å— :translate-nl  æ–°çš„ä¾‹ç¨‹å’Œè¿ç®—ç¬¦  æ–°çš„ atomicint Unicode è¿ç®—ç¬¦å’Œ ASCII ç­‰ä»·ç‰©, ä¿è¯çº¿ç¨‹å®‰å…¨, åŸå­æ“ä½œ: \u0026amp;infix:\u0026lt;âš›=\u0026gt;/\u0026amp;atomic-assignã€\u0026amp;prefix:\u0026lt;âš›\u0026gt;/\u0026amp;atomic-fetchã€ \u0026amp;prefix:\u0026lt;++âš›\u0026gt;/\u0026amp;atomic-inc-fetchã€\u0026amp;postfix:\u0026lt;âš›++\u0026gt;/\u0026amp;atomic-fetch-incã€ \u0026amp;prefix:\u0026lt;--âš›\u0026gt;/\u0026amp;atomic-dec-fetchã€\u0026amp;postfix:\u0026lt;âš›--\u0026gt;/\u0026amp;atomic-fetch-decã€ \u0026amp;infix:\u0026lt;âš›-=\u0026gt;/\u0026amp;infix:\u0026lt;âš›âˆ’=\u0026gt;/\u0026amp;atomic-fetch-sub å’Œ \u0026amp;infix:\u0026lt;âš›+=\u0026gt;/\u0026amp;atomic-fetch-add \u0026amp;cas: åŸå­æ¯”è¾ƒä¸äº¤æ¢ â‰¤ã€â‰¥ å’Œ â‰  è¿ç®—ç¬¦æ˜¯ Unicode è¿ç®—ç¬¦, åˆ†åˆ«ç­‰ä»·äº \u0026lt;=ã€\u0026gt;= å’Œ != \u0026amp;infix:\u0026lt;unicmp\u0026gt;/\u0026amp;infix:\u0026lt;coll\u0026gt;: \u0026amp;infix:\u0026lt;cmp\u0026gt; çš„æ›¿ä»£è¡Œä¸º TR///: tr/// çš„éå˜å¼‚ç‰ˆæœ¬ submethod TWEAK: ä¸ BUILD ç±»ä¼¼, é™¤äº†å®ƒä¸å±æ€§é»˜è®¤å€¼å…¼å®¹ä¹‹å¤– \u0026amp;duckmap: åº”ç”¨ \u0026amp;callable åˆ°æ¯ä¸ªå…ƒç´ ä¸Š \u0026amp;deepmap: åº”ç”¨ \u0026amp;callable åˆ°æ¯ä¸ªå…ƒç´ ä¸Š, ä¸‹é™åˆ° Iterable ä¸­ \u0026amp;take-rw: åƒ \u0026amp;take ä¸€æ ·, ä½†æœ‰ä¸€ä¸ªå¯å†™çš„å®¹å™¨ \u0026amp;indir: åœ¨ç»™å®šçš„ $*CWD ä¸­æ‰§è¡Œä»£ç  \u0026amp;spurt: å‚è§ IO::Path.spurt \u0026amp;prompt: æç¤ºç”¨æˆ·è¾“å…¥ uniprops: uniprop çš„å¤šå­—ç¬¦ç‰ˆæœ¬ symlink: å»ºç«‹æ–‡ä»¶ç¬¦å·é“¾æ¥ link: åˆ›å»ºæ–‡ä»¶ç¡¬è¿æ¥ .hyper/.race: å¹¶è¡Œå¤„ç†å€¼çš„åˆ—è¡¨ Seq.from-loop: ä» Callable ç”Ÿäº§ä¸€ä¸ª Seq Str.uniparse: å°†ä¸€ä¸ªæˆ–å¤šä¸ª Unicode å­—ç¬¦åè§£æä¸ºå®é™…å­—ç¬¦ Str.parse-base: Int.base æ“ä½œçš„åè½¬ IO::Path æä¾›äº† .ACCEPTSã€.SPECã€.CWDã€.Numericã€.addã€.extensionã€.mode å’Œå„ç§æ–‡ä»¶æµ‹è¯•ã€.partsã€.sibling å’Œ .spurt IO::Handle æä¾›äº† .READã€.WRITEã€.EOFã€.DESTROY, .readcharsã€.flushã€.lockã€.unlockã€.out-bufferã€.tell, .sayã€.slurpã€.seekã€.printfã€.print-nl å’Œ .watch IO::Pipe æä¾›äº† .proc Iterator æä¾›äº† .skip-oneã€.skip-at-least å’Œ .skip-at-least-pull-one Mu.emit: \u0026amp;emit çš„æ–¹æ³•å½¢å¼ Test.pm6 æ¨¡å—ä¸­çš„ \u0026amp;fails-like: å…è®¸æµ‹è¯•å¤±è´¥ Test.pm6 æ¨¡å—ä¸­çš„ \u0026amp;bail-out: é€€å‡ºå¤±è´¥çš„æµ‹è¯•å¥—ä»¶ Test.pm6 æ¨¡å—ä¸­çš„ \u0026amp;is-approx: æµ‹è¯•ä¸€ä¸ªæ•°å­—è¿‘ä¼¼äºå¦ä¸€ä¸ª Buf æ‹¥æœ‰ .allocateã€.reallocateã€.appendã€.pushã€.popã€.spliceã€.subbuf-rwã€.prepend å’Œ .unshift æ–¹æ³• Range æ”¯æŒäº† .rand Backtrace æ‹¥æœ‰æ–¹æ³• .mapã€.flatã€.concise å’Œ .summary .classify-list æ–¹æ³•å¯ç”¨äº Hash ç±»å‹ .categorize-list æ–¹æ³•å¯ç”¨äº Hash ç±»å‹ Code.of: è¿”å›è¿”å›ç±»å‹çº¦æŸ Code.line/.file: è¿”å›å®šä¹‰çš„è¡Œ/æ–‡ä»¶ Proc::Async æä¾›äº† .Supplyã€.readyã€.pidã€.bind-stdinã€.bind-stdout å’Œ .bind-stderr Proc.command/Proc::Async.command: æˆ‘ä»¬è¦æ‰§è¡Œçš„å‘½ä»¤ Proc æä¾›äº† .signalã€.pid å’Œ .encoding Complex æä¾›äº† .cisã€.realsã€.ceilingã€.floorã€.roundã€.truncate å’Œ .abs æ–¹æ³•, å¹¶å¯ä»¥ä½¿ç”¨ \u0026lt;=\u0026gt; è¿›è¡Œæ¯”è¾ƒ(åªè¦è™šéƒ¨å¯ä»¥å¿½ç•¥ä¸è®¡) DateTime æä¾›äº† .offset-in-hoursã€.hh-mm-ss å’Œ .Date DateTime å¯ä»¥ä½¿ç”¨ \u0026lt;=\u0026gt; è¿ç®—ç¬¦å’Œå…¶å®ƒ DateTime å¯¹è±¡è¿›è¡Œæ¯”è¾ƒ Date æä¾›äº† .DateTime æ–¹æ³• \u0026amp;infix:\u0026lt;+\u0026gt;/\u0026amp;infix:\u0026lt;-\u0026gt; å¯ä»¥è¢« Durationã€DateTime å’Œ Real ç±»å‹è°ƒç”¨ Enumeration æä¾›äº† .Intã€.predã€.succã€.kv å’Œ .pair .Date å¯ä»¥åœ¨ Instant ä¸Šè°ƒç”¨ Junction èƒ½ä½¿ç”¨ Junction.new è°ƒç”¨æ¥åˆ›å»º List ç±»å‹æ‹¥æœ‰ .to å’Œ .from æ–¹æ³• Map type æä¾›äº† Int æ–¹æ³•, è¿”å› pair çš„æ•°é‡ Any.skip: è·³è¿‡åˆ—è¡¨ä¸­çš„å€¼ Any.batch: .rotor çš„æ›´åŸºæœ¬çš„è¡¨å…„å¼Ÿ Mu.iterator: ä¸ºä¸€ä¸ªåˆ—è¡¨ä¸­çš„å€¼ç”Ÿæˆä¸€ä¸ª Iterator IO::Spec::* ç±»å‹æä¾›äº† .tmpdirã€.extension å’Œ .path Pair æä¾›äº† .ACCEPTSã€.Pair å’Œ .invert .Capture æ–¹æ³•å¯¹æ‰€æœ‰æ ¸å¿ƒç±»å‹éƒ½æœ‰æ˜ç¡®å®šä¹‰ å®šä¹‰äº† .ACCEPTS åœ¨åŒç´ å¼‚å½¢ä½“ä¸Šçš„è¯­ä¹‰ Failure.self ä½¿æœªå¤„ç†çš„ Failure çˆ†å‘ Thread.is-initial-thread: æˆ‘ä»¬æ˜¯åœ¨åˆå§‹çº¿ç¨‹ä¸­è¿è¡Œå— Match æä¾›äº† .Int å’Œ .actions IO::Socket::Async æä¾›äº† .socket-port å’Œ .peer-port Promise æä¾›äº†å¦ä¸€ç§æ„é€ å‡½å™¨ .kept å’Œ .broken WhateverCode æä¾›äº† .assuming WhateverCode å’Œ Block æä¾›äº† .cando .:\u0026lt;â€¦\u0026gt; è¯­æ³•ç”¨äºè°ƒç”¨å‰ç¼€è¿ç®—ç¬¦ä½œä¸ºåç¼€ $*KERNEL æä¾›äº† .hostname Nil æ‹¥æœ‰å®šä¹‰çš„ .FALLBACK ç‰¹æ®Šæ–¹æ³•æ¥è¿”å› Nil  æ–°ç±»å‹  atomicint: åŸç”Ÿçš„ int, å¤§å°å¯ç”¨äºæ–°çš„åŸå­è¿ç®—ç¬¦ Lock::Async: äº’æ–¥çš„éé˜»å¡æœºåˆ¶ Encoding::Registry: ç®¡ç†å¯ç”¨çš„ç¼–ç  Encoding::Encoder: ç¼–ç å™¨, ç”¨äºç‰¹å®šçš„ç¼–ç  Encoding::Decoder: è§£ç å™¨, ç”¨äºç‰¹å®šçš„ç¼–ç  IO::CatHandle: å°†å¤šä¸ªåªè¯»çš„ IO::Handle è§†åŒä¸€ä¸ª åŸç”Ÿçš„ str æ•°ç»„ Supplier::Preserving: ç¼“å­˜çš„å®æ—¶ Supply å·¥å‚ Semaphore: æ§åˆ¶å¤šçº¿ç¨‹å¯¹å…±äº«èµ„æºçš„è®¿é—® IO::Special: ç‰¹æ®ŠI/Oè®¾å¤‡çš„è·¯å¾„ (ä¾‹å¦‚ STDOUT) Exceptions::JSON è‡ªå®šä¹‰å¼‚å¸¸å¤„ç†ç¨‹åºçš„å®ç°(å¯ä¸PERL6_EXCEPTIONS_HANDLER ç¯å¢ƒå˜é‡ä¸€èµ·ä½¿ç”¨) SeekType æšä¸¾: IO::Handle.seek ä¸­ä½¿ç”¨çš„å€¼  æ–°çš„å˜é‡   $*USAGE: å¯åœ¨ MAIN å­ä¾‹ç¨‹ä¸­ä½¿ç”¨, åŒ…å«è‡ªåŠ¨ç”Ÿæˆçš„ USAGE ä¿¡æ¯\n  %*SUB-MAIN-OPTS: è®¾ç½® sub MAIN çš„è¡Œä¸º\n %*SUB-MAIN-OPTS\u0026lt;named-anywhere\u0026gt; å…è®¸å°†å‘½åå‚æ•°æ”¾åœ¨å‘½ä»¤è¡Œçš„ä»»ä½•ä½ç½®    $*COLLATION: é…ç½®å››ä¸ª Unicode æ ¡å¯¹çº§åˆ«\n  $*INIT-INSTANT: ä»£è¡¨ç¨‹åºå¯åŠ¨æ—¶é—´çš„ Instant\n  $*HOME: ç”¨æˆ·çš„ä¸»ç›®å½•, å¦‚æœå­˜åœ¨çš„è¯\n  \u0026amp;*chdir: Callable åŒ…å« IO::Path.chdir çš„å˜ä½“, ä¹Ÿè®¾ç½®è¿›ç¨‹çš„å½“å‰ç›®å½•\n  PERL6_TEST_DIE_ON_FAIL ç¯å¢ƒå˜é‡: åœ¨ç¬¬ä¸€æ¬¡å¤±è´¥æ—¶åœæ­¢æµ‹è¯•å¥—ä»¶\n  PERL6_EXCEPTIONS_HANDLER ç¯å¢ƒå˜é‡: æŒ‡å®šè‡ªå®šä¹‰å¼‚å¸¸å¤„ç†ç±»\n  å¯¹è¾¹ç¼˜æƒ…å†µ/å¼ºè½¬è¡Œä¸ºçš„æ¾„æ¸…  UInt ä¸ Int ç±»å‹å¯¹è±¡æ™ºèƒ½åŒ¹é…ä¸º True sink è¯­å¥å‰ç¼€çˆ†ç‚¸ Failure å®šä¹‰äº†1é¡¹å’Œ0é¡¹åˆ—è¡¨ä»¥åŠè´Ÿå‚æ•°å’Œéæ•´æ•°å‚æ•°çš„ permutations/combinations çš„è¡Œä¸º \u0026amp;valã€Str.Numeric å’Œå…¶ä»– Str æ•°å­—è½¬æ¢æ–¹æ³•åœ¨è¯•å›¾è½¬æ¢ Unicode No å­—ç¬¦ç»„æˆ–åˆæˆæ•°å­—æ—¶ä¼š fail :42foo å†’å·å¯¹å¿«æ·æ–¹å¼ä¸­ä¸èƒ½ä½¿ç”¨åˆæˆæ•°å­— ç°åœ¨ã€Enumeration å¯ä»¥ä½œä¸ºä¸€ä¸ªæ•°ç»„å½¢çŠ¶æŒ‡å®šå™¨ä½¿ç”¨ å«æœ‰ç©ºæ ¼çš„ Str çš„æ•°å€¼è½¬æ¢ç°åœ¨è¿”å› 0 å¸¦ç©ºçš„æ¨¡å¼å‚æ•°çš„ samark, ç®€å•åœ°è¿”å›è°ƒç”¨è€… .polymod å¯ç”¨äº lazy ä½†æœ‰é™çš„é™¤æ•°åˆ—è¡¨ å®šä¹‰äº† .[*-0] ç´¢å¼• .rotor ä¸­å¤§äºå­åˆ—è¡¨çš„è´Ÿæ•°ç©ºéš™æŠ›å‡ºå¼‚å¸¸ .rotor çš„é Int å‚æ•°è¢«å¼ºè½¬ä¸º Int å‚æ•° è¯»å– /proc æ–‡ä»¶æ—¶å®šä¹‰äº† .lines å®šä¹‰äº†å­—ç¬¦ä¸²ä¸Šåç¼€/å‰ç¼€ ++/-- ä¸­æ³°è¯­æ•°å­—çš„è¡Œä¸º sunk for é‡Œé¢çš„ map è¢«è§†ä¸º sunk Sunk for å¾ªç¯å°†ä¸Šä¸€æ¡è¯­å¥çš„æ–¹æ³•è°ƒç”¨å€¼ä¸‹æ²‰ Bool å¯¹è±¡ä¸Šçš„ .Int è¿”å›ä¸€ä¸ª Int å¯¹è±¡ splice å¯ç”¨äºæ‰©å±•æ•°ç»„ classify å¯ä»¥ä¸ Junction é…åˆä½¿ç”¨ .pairup on a type object returns an empty Seq .pairup æ€»æ˜¯è¿”å›ä¸€ä¸ª Seq æ‹’ç»æ¥å— Date/DateTime æ„é€ å‡½æ•°ä¸­çš„åˆæˆä»£ç ç‚¹ â¸¨/â¸© å¯¹å„¿ç°åœ¨å¯ä»¥ä½œä¸ºå¼•å·ç»“æ„ä¸­çš„åŒ¹é…å­—ç¬¦ä½¿ç”¨ Array ç±»å‹å¯¹è±¡ä¸Šçš„ .flat ç®€å•åœ°è¿”å›è¯¥ç±»å‹å¯¹è±¡ æ··åˆçº§ classify åœ¨ Hash ä¸ŠæŠ›å‡ºå¼‚å¸¸ Junction å¯ä»¥ç”¨äºç»™ Hash æŒ‡å®šå¤šä¸ªé”® ç»™ .classify-list çš„ Callable ç°åœ¨ä¿è¯æ¯é¡¹åªæ‰§è¡Œä¸€æ¬¡ :delete å¯¹ Hash ç±»å‹å¯¹è±¡è¿›è¡Œå…³è”æŸ¥æ‰¾æ—¶è¿”å› Nil Test.pm6 ä¸­çš„ \u0026amp;is-deeply ä¼šè‡ªåŠ¨ .cache ä½œä¸ºå‚æ•°çš„ Seq, å¹¶ä½¿ç”¨è¿”å›çš„ List è¿›è¡Œæµ‹è¯• Complex.new() ç»™å‡º \u0026lt;0+0i\u0026gt; Int.new ç°åœ¨å¯ä»¥ä¿è¯æ„å»ºä¸€ä¸ªæ–°çš„ Int (è€Œä¸æ˜¯, æ¯”å¦‚è¯´, ä»å¸¸é‡ç¼“å­˜ä¸­é‡ç”¨ä¸€ä¸ª) å®šä¹‰äº†ä¸€ä¸ªå‚æ•°(1-arg)ç‰ˆæœ¬çš„ \u0026amp;infix:\u0026lt;=:=\u0026gt; å’Œ \u0026amp;infix:\u0026lt;eqv\u0026gt; å¦‚æœç›´æ¥æˆ–é—´æ¥åœ°è°ƒç”¨ .BIND-POSã€.BIND-KEYã€.ASSIGN-POSã€.ASSIGN-KEYã€.STOREã€.pushã€.appendã€.unshiftã€.prependã€Nil ç±»å‹ç°åœ¨æŠ›å‡ºå¼‚å¸¸ Nil.ord è¿”å›ä¸€ä¸ªç©ºçš„ Seq Nil.chrs è¿”å›ä¸€ä¸ª \u0026quot;\\0\u0026quot; Num.new å¼ºè½¬å‚æ•°ä¸º Num infix:\u0026lt;Z\u0026gt;() è¿”å›ä¸€ä¸ªç©ºçš„ Seq .comb æ€»æ˜¯è¿”å›ä¸€ä¸ª Seq ç”¨ \u0026amp;infix:\u0026lt;+\u0026gt; åŒ–ç®€ä¸€ä¸ªé¡¹, ç®€å•åœ°è¿”å›è¯¥é¡¹ ()[0] è¿”å› Nil å…è®¸åœ¨(å¯èƒ½æ˜¯æ— é™çš„) Seq ä¸Šä½¿ç”¨ Regex æ™ºèƒ½åŒ¹é… å®šä¹‰äº† Range å¯¹è±¡çš„æ™ºèƒ½åŒ¹é… Set è½¬æ¢ä¸ºMix/Bag ä¸å†æœ‰ Bool æƒé‡ å½“ä¸€ä¸ªæˆ–å¤šä¸ªæ“ä½œæ•°ä¸º 0 æ—¶ã€gcd æ˜¯æœ‰å®šä¹‰çš„ defined ä¾‹ç¨‹ä¸­çš„ Junction è‡ªåŠ¨çº¿ç¨‹åŒ– sum å¯ä»¥å¤„ç†å«æœ‰ Junction çš„åˆ—è¡¨ Grammar.parse è®©é¡¶çº§ regex å›æº¯ U+2212 MINUS SIGN [Sm] (-) ç°åœ¨å¾—åˆ°æ›´å¤šç»“æ„çš„æ”¯æŒ, å¦‚ Str.Numeric å’Œ \u0026amp;val Arity-1 \u0026amp;infix:\u0026lt;~\u0026gt; ä¸ Blob å¯ä»¥ä¸€èµ·å·¥ä½œ åœ¨ç­¾åä¸­, æ‰€æœ‰çš„ Numeric å­—é¢å€¼éƒ½æ”¯æŒä½œä¸ºå€¼å­—é¢å€¼ æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ \\b å’Œ \\B æŠ›å‡º X::Obsolete True å’Œ False ä½œä¸ºç­¾åä¸­çš„å€¼å­—é¢é‡å‘å‡ºè­¦å‘Š .sort å’Œ IO::Spec::Unix.path çš„è¿”å›å€¼æ€»æ˜¯ Seq Range å¯¹è±¡ä¸Šçš„ Out-of-range .AT-POS è¿”å› Nil å¯¹äºä¸å­˜åœ¨çš„é”®ã€Pair.AT-KEY è¿”å› Nil æ‰€æœ‰çš„ Cool ç±»å‹éƒ½æä¾›äº† .Rat/.FatRat å¼ºè½¬å™¨ IO::Path æ–‡ä»¶æµ‹è¯•ä¸ç¼“å­˜å…ˆå‰æµ‹è¯•æ‰§è¡Œçš„ç»“æœ Seq eqv List ä»…æ ¹æ®ç±»å‹ä¸åŒ¹é…å°±å®šä¸º False åœ¨ Hash ã€Hash  å’Œ QuantHash ä¸Š, æ¥è‡ª .kvã€.values å’Œ .pair åºåˆ—çš„å€¼æ˜¯å¯å†™çš„ å‚è§ Raku/roast#614 å’Œ #3519 \u0026amp;infix:\u0026lt;âˆ˜\u0026gt;/\u0026amp;infix:\u0026lt;o\u0026gt; ä¿ç•™ LHF çš„ .of å’Œ RHS çš„ .arity å’Œ .count å®Œå–„äº† regex è¿ç®—ç¬¦å‰¯è¯ä¸­çš„å¯æ¥å—å‚æ•°(ä¾‹å¦‚::in(â€¦)) å®Œå–„äº† IO::Handle.open ä¸­å¯æ¥å—çš„å‚æ•°ç»„åˆ IO::Path.Str ä¸åŒ…å« .CWD å±æ€§çš„å€¼ IO::Path ç±»å‹æ‹’ç»å¸¦æœ‰ nul å­—èŠ‚ (\u0026quot;\\0\u0026quot;) çš„è·¯å¾„ IO::Pipe çš„ .path/.IO è¿”å›ä¸€ä¸ª IO::Path ç±»å‹å¯¹è±¡ å¦‚æœç›®çš„è·¯å¾„å’Œæºè·¯å¾„æ˜¯ä¸€æ ·çš„ IO::Path çš„ .copy/.move ä¼š fail dir åˆ›å»ºçš„ IO::Path ç»å¯¹æ€§ç”±è°ƒç”¨è€…æ§åˆ¶ æ›´å¤šå®šä¹‰çš„è¾¹ç¼˜è¡Œä¸ºã€Callable  å¤„ç†ã€. defined è°ƒç”¨, ä»¥åŠ \u0026amp;infix:\u0026lt;andthen\u0026gt;ã€\u0026amp;infix:\u0026lt;orelse\u0026gt; å’Œ \u0026amp;infix:\u0026lt;notandthen\u0026gt; æ“ä½œç¬¦çš„é“¾æ¥ Seq çš„ç¦…åˆ‡ä¸ç¼“å­˜å®ƒä»¬ List.Capture å°†ä»»ä½•åŒ…å«çš„ Pair å¯¹è±¡çš„é”®å­—ç¬¦ä¸²åŒ– å¸¦å¤„ç†çš„ Failure å‚æ•°çš„ \u0026amp;fail æŠŠå®ƒæ ‡è®°ä¸ºæ˜¯æœªå¤„ç†çš„ use lib æ¥å— IO::Path å¯¹è±¡ é”šç‚¹ ^ã€^^ã€$ å’Œ $$ åœ¨ç¯è§†ä¸­æœ‰æ•ˆ Grammar.made æ”¯æŒç±»å‹å¯¹è±¡ .isa æ”¯æŒ subset  ç±»å‹å¯¹è±¡ :delete å¯ç”¨äºæƒ°æ€§æ•°ç»„ \u0026amp;infix:\u0026lt;eqv\u0026gt; å¯ä»¥åœ¨æŸäº›æƒ…å†µä¸‹å¯¹æƒ°æ€§å‚æ•°èµ·ä½œç”¨ åŠ¨æ€æŸ¥è¯¢(::(...)) æ˜¯é™åˆ¶æ€§çš„ regex è¯­æ³•, å¹¶ä¸”éœ€è¦ use MONKEY-SEE-NO-EVAL çš„è®¸å¯ å®šä¹‰äº†å¸¦å­”æ•°ç»„çš„ .Slip å’Œ .List Promise.in/.at å’Œ Supply.interval å¯ä»¥ç”¨é›¶å€¼å’Œè´Ÿå€¼å·¥ä½œ Supply.interval æœ€å°å€¼ä¸º 0.001ï¼›è¾ƒä½å€¼è¢«å¤„ç†ä¸º 0.001, å¹¶å‘å‡ºè­¦å‘Š#, å‚è§ https://docs.perl6.org/type/Supply#method_interval PR [#2649] Supply æä¾›äº† .Seqã€.list å’Œ .zip å¯ä»¥åœ¨æ„å»ºæ–¹æ³•ä¸­ç»‘å®šåˆ°åŸç”Ÿç±»å‹å±æ€§ WhateverCode ä¼ æ’­ use fatal sayã€noteã€putã€print å’Œ printf ä¾‹ç¨‹è‡ªåŠ¨çº¿ç¨‹åŒ– Junction IO::Handle.eof å€¼åœ¨ .seek è¿‡ç»ˆç‚¹åå†è¿”å›æ—¶ä¹Ÿä¼šç›¸åº”æ”¹å˜ å®šä¹‰äº† .succ'ã€.predå’Œ.Bool` çš„åŒè´¨å¼‚å½¢ä½“ åœ¨æ ¸å¿ƒ Numeric ä¸Šå®šä¹‰äº† .Bridge åœ¨æ ¸å¿ƒ Numeric çš„ç±»å‹å¯¹è±¡ä¸Šå®šä¹‰äº† .Numeric/.Real å®šä¹‰äº†å…³äºé›¶åˆ†æ¯æœ‰ç†æ•°çš„ Rational.Bool say/note ä¿è¯åœ¨ Str çš„å­ç±»ä¸Šè°ƒç”¨ .gist å®šä¹‰äº† Junction.Str è¿”å› Junction å®šä¹‰äº† Junction.gist/.perl è¿”å›ä¸€ä¸ª Str Map/Hash çš„ .list/.cache è¿”å›ä¸€ä¸ª List å®šä¹‰äº† .round çš„è¿”å›ç±»å‹ å®šä¹‰äº† Enumeration:D ä¸ .ACCEPT ä¸€ä¸ª Enumeration:U , å‚è§ rakudo/rakudo#2073  æ‚é¡¹  IO::ArgFiles ç±»å‹åªæ˜¯ IO::CatHandle çš„ä¸€ä¸ªç©ºçš„å­ç±» å¯¹å¸¸é‡çš„çº¦æŸ  çº¦æŸæ˜¯å®Œå…¨å¼ºåˆ¶çš„ è¯•å›¾åœ¨å¸¸é‡ä¸Šä½¿ç”¨å‚æ•°åŒ–ç±»å‹çº¦æŸ(ä¾‹å¦‚ä½¿ç”¨ my Foo constant @int) ä¼šå¼•å‘ X::ParametricConstant å¼‚å¸¸   Pod =defn(å®šä¹‰åˆ—è¡¨)æŒ‡ä»¤å¯ç”¨ Pod æä¾›äº† :numbered é…ç½®é”® .^verã€.^auth å’Œ .^name å…ƒæ–¹æ³•åœ¨ module ä¸­å¯ç”¨, è€Œåœ¨ package ä¸­åˆ™æ²¡æœ‰, è¿™æ˜¯è®¾è®¡ä¸Šçš„åŸå›  qww\u0026lt;â€¦\u0026gt; ä¸­æ”¯æŒèŠ±å“¨çš„å¼•å·(â€™â€¦â€™ã€â€œâ€¦â€ã€ï½¢â€¦ï½£ å’Œå˜ä½“) \u0026amp;infix:\u0026lt; \u0026gt; æ”¯æŒæŸ¥æ‰¾è‡ªåŠ¨ç”Ÿæˆçš„ Callables (ä¾‹å¦‚: \u0026amp;infix:\u0026lt;XX\u0026gt;) ä½¿ç”¨å‘½åçš„ anon å­ä¾‹ç¨‹ä¸å†äº§ç”Ÿé‡å£°æ˜è­¦å‘Š ::?MODULE/$?MODULE å˜é‡çš„æ‰©å±•è§„èŒƒ sub MAIN å¯ä»¥æ¥å—ä¸€ä¸ªå‚æ•°ä¸Šçš„ Enumeration ç±»å‹çº¦æŸå’Œ where å­å¥ ç¬‘è„¸å‹çº¦æŸå¯ä»¥ç”¨åœ¨å­é›†ä¸Š start å—å’Œ thunks å¾—åˆ°æ–°çš„ $/ å’Œ $! å®šä¹‰äº†ä¸åˆ—è¡¨å…³è”è¿ç®—ç¬¦ä¸€èµ·ä½¿ç”¨çš„ R å…ƒè¿ç®—ç¬¦ ç±»å‹å¼ºè½¬å¯ä»¥ç”¨åœ¨ç­¾åè¿”å›ç±»å‹çº¦æŸä¸­ \u0026amp;infix:\u0026lt;x\u0026gt;/\u0026amp;infix:\u0026lt;x\u0026gt; æŠ›å‡ºäº† -Inf/NaN é‡å¤å‚æ•° å­—é¢ç»“æ„ put å’Œ put for æŠ›å‡º, éœ€è¦ä½¿ç”¨æ‹¬å· æ‰©å¤§äº† Unicode ä¾‹ç¨‹å’ŒåŠŸèƒ½çš„è§„èŒƒè¦†ç›–é¢-å°†è¦†ç›–é¢å‡çº§åˆ° Unicode ç¬¬11ç‰ˆ $. æ–¹æ³•è°ƒç”¨è¯­æ³•èƒ½ç”¨åœ¨å…ƒæ–¹æ³•ä¸­äº†  ","permalink":"https://ohmyweekly.github.io/notes/2020-07-21-checklist-for-6-dot-d/","tags":["raku","6.d"],"title":"Checklist for Raku 6.d"},{"categories":["programming"],"contents":"https://imagemagick.org/Usage/draw/\nåœ¨ IM ä¸­ç»˜å›¾æ˜¯åœ¨ç°æœ‰å›¾åƒä¸­æ·»åŠ æ–°å…ƒç´ çš„æ–¹æ³•ã€‚è™½ç„¶åœ¨å¤åˆå­—ä½“æ•ˆæœçš„ç¤ºä¾‹é¡µå’Œå›¾åƒæ³¨é‡Šä¸­æ¶µç›–äº†å¾ˆå¤šæ–‡æœ¬ç»˜åˆ¶çš„å†…å®¹ï¼Œä½†æœ¬é¡µæ¶‰åŠ \u0026ldquo;-draw\u0026rdquo; æ“ä½œç¬¦çš„å…¶ä»–æ›´æ™®éçš„æ–¹é¢ã€‚\nç»˜åˆ¶å‘½ä»¤æœ€åˆæ˜¯ä½œä¸ºä¸€ç§åˆ›å»ºç®€å•å›¾åƒçš„æ‰‹æ®µã€‚ä½†éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå®ƒå·²ç»æ‰©å±•æˆä¸ºçŸ¢é‡å›¾å½¢åˆ°å…‰æ …å›¾åƒè½¬æ¢çš„ç•Œé¢ã€‚\nImageMagick ç»˜åˆ¶å‘½ä»¤ è®¡ç®—æœºä¸­çš„å›¾åƒé€šå¸¸ä»¥ä¸¤ç§ä¸åŒçš„æ–¹å¼ä¿å­˜ã€‚ç¬¬ä¸€ç§ä¹Ÿæ˜¯ä½ åœ¨è¿™äº›ç¤ºä¾‹é¡µé¢ä¸­çœ‹åˆ°çš„æœ€å¸¸è§çš„æ–¹å¼è¢«ç§°ä¸ºå…‰æ …å›¾å½¢ã€‚åœ¨è¿™ç§æ–¹å¼ä¸­ï¼Œå›¾åƒæ˜¯ä»¥åƒç´ çš„çŸ©å½¢é˜µåˆ—æ¥å­˜å‚¨çš„ã€‚\nå¦ä¸€ç§æ–¹å¼ä¸å¤ªå¸¸è§ï¼Œä¹Ÿä¸å¤ªå®¹æ˜“ä¿®æ”¹ï¼Œä½†ä»å¦ä¸€ä¸ªæ„ä¹‰ä¸Šè®²ï¼Œå®ƒçš„é€šç”¨æ€§æ›´å¼ºï¼Œå³å¯¹è±¡çŸ¢é‡å›¾å½¢ã€‚åœ¨è¿™ç§å½¢å¼ä¸‹ï¼Œå›¾åƒæ˜¯ç”¨çº¿æ¡ã€å¼§çº¿ã€é¢œè‰²å¡«å……ï¼Œæœ‰æ—¶è¿˜æœ‰æ·±åº¦æ¥æè¿°çš„ã€‚è¿™æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå› ä¸ºä½ å¯ä»¥å°†è¿™äº›å›¾åƒæ”¾å¤§åˆ°ä½ æƒ³è¦çš„ä»»ä½•å°ºå¯¸ï¼Œè€Œä¸”å®ƒä»¬ä»ç„¶å¯ä»¥å®Œç¾åœ°æ˜¾ç¤ºã€‚ä¸å…‰æ …æ ¼å¼çš„å›¾åƒç›¸æ¯”ï¼Œæ‚¨è¿˜å¯ä»¥åœ¨å¾ˆå°çš„ç©ºé—´å†…æè¿°éå¸¸å¤§å’Œå¤æ‚çš„å›¾åƒã€‚\nçŸ¢é‡å›¾å½¢å›¾åƒçš„ä¾‹å­åŒ…æ‹¬ postscript å’Œæ–°çš„ SVG-å¯ç¼©æ”¾çŸ¢é‡å›¾å½¢ã€‚\nTrue-Type å­—ä½“ä¹Ÿæ˜¯çŸ¢é‡å›¾å½¢çš„ä¾‹å­ï¼Œå› ä¸ºå®ƒå…è®¸åœ¨ä»»ä½•æ¯”ä¾‹ä¸‹ä½¿ç”¨å•ä¸ªå­—ç¬¦æè¿°ã€‚\n\u0026ldquo;-draw\u0026rdquo; å›¾åƒæ“ä½œç¬¦ï¼Œæ˜¯è¿›å…¥ ImageMagick çŸ¢é‡ç»˜å›¾åŠŸèƒ½çš„ä¸€ä¸ªçª—å£ï¼Œå¹¶å½¢æˆäº†ä¸€å¥—ä¸ IM çš„æ™®é€šå‘½ä»¤è¡Œå›¾åƒæ“ä½œç¬¦ç›¸å½“ç‹¬ç«‹çš„å‘½ä»¤ã€‚\n ä¸€èˆ¬ä½¿ç”¨çš„çŸ¢é‡å›¾å½¢æ–‡ä»¶æ ¼å¼åªæœ‰å‡ ç§ï¼Œå› ä¸ºæ¯ä¸€ç§è¿™æ ·çš„æ ¼å¼é€šå¸¸ä¸å…¶ä»–è¿™æ ·çš„æ ¼å¼æœ‰å¾ˆå¤§çš„ä¸åŒã€‚å…¶ç»“æœæ˜¯ï¼Œå¾ˆå°‘æœ‰ä»£ç å…±äº«çš„å¯èƒ½ã€‚ åŸºäºè¿™ä¸ªåŸå› ï¼ŒImageMagick æ›´å…³æ³¨ä½¿ç”¨çŸ¢é‡å›¾å½¢æ¥ç»˜åˆ¶ SVG æ ¼å¼çš„å›¾åƒã€‚Postscript å’Œ true-type å­—ä½“å›¾å½¢è¢«ä¼ é€’ç»™å…¶ä»–å¤–éƒ¨çš„\u0026quot;ä»£ç†\u0026ldquo;åº“å’Œåº”ç”¨ç¨‹åºï¼Œå®ƒä»¬æ›´é€‚åˆç»˜åˆ¶è¿™äº›ç±»å‹çš„çŸ¢é‡å›¾å½¢æ ¼å¼ã€‚ è¿™å¹¶ä¸æ˜¯è¯´ SVG æ²¡æœ‰ä»£ç†åº“ã€‚ä¸€ä¸ªä¾‹å­æ˜¯ RSVG åº“æˆ– GTK SVG åº“ï¼Œè¿™äº›åº“åœ¨ç¼–è¯‘æ—¶æ˜¯å¯ç”¨çš„ã€‚IM ä¼šé“¾æ¥åˆ°è¿™äº›åº“æ¥è½¬æ¢ SVGï¼Œè€Œä¸æ˜¯è‡ªå·±å°è¯•å»åšã€‚\n åŸå§‹ç»˜å›¾å‘½ä»¤ è®©æˆ‘ä»¬ä» MVG å‘½ä»¤çš„ \u0026ldquo;-draw\u0026rdquo; å›¾åƒæ“ä½œç¬¦ä¸­æœ€å¤è€ã€æœ€ç®€å•ã€æœ€å¸¸è§çš„ç»˜å›¾åŸè¯­å¼€å§‹ã€‚\nè¯·æ³¨æ„ï¼Œæ‰€æœ‰çš„å‚æ•°éƒ½è¢«è§†ä¸ºæµ®ç‚¹æ•°ï¼Œä¸ä¸€å®šæ˜¯æ•´æ•°ï¼Œæ¯”å¦‚æˆ‘åœ¨è¿™äº›ä¾‹å­ä¸­é€šå¸¸ä½¿ç”¨çš„ã€‚\n# Single Pixel Draw (ä¸¤ç§æ–¹å¼ -- è¿™äº›åƒç´ ç‚¹éƒ½è¢«æ”¾å¤§äº†) # Point \u0026#39;paints\u0026#39; the color pixel convert -size 10x6 xc:skyblue -fill black \\  -draw \u0026#39;point 3,2\u0026#39; -scale 100x60 draw_point.gif # Color Point \u0026#39;replaces\u0026#39; the color pixel convert -size 10x6 xc:skyblue -fill black \\  -draw \u0026#39;color 6,3 point\u0026#39; -scale 100x60 draw_color_point.gif æ ¹æ®ç»™å‡ºçš„æ³¨é‡Šï¼Œå½“æ¶‰åŠåŠé€æ˜é¢œè‰²æ—¶ï¼Œè¿™ä¸¤ç§ç‚¹æ–¹æ³•ä¼šäº§ç”Ÿä¸åŒçš„ç»“æœã€‚è¯¦æƒ…è¯·å‚è§ä¸‹é¢çš„é¢œè‰²å¡«å……åŸè¯­ã€‚\n# çŸ©å½¢ / åœ†è§’çŸ©å½¢ / çŸ©å½¢åœ†å¼§ convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;rectangle 20,10 80,50\u0026#34; draw_rect.gif convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;roundrectangle 20,10 80,50 20,15\u0026#34; draw_rrect.gif convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;arc 20,10 80,50 0,360\u0026#34; draw_arc.gif convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;arc 20,10 80,50 45,270\u0026#34; draw_arc_partial.gif arc ç»˜åˆ¶åŸè¯­ä¸çŸ©å½¢ä¸€èµ·åˆ—å‡ºï¼Œå› ä¸ºå®ƒå®é™…ä¸Šåªæ˜¯ä¸€ä¸ª\u0026quot;æ¤­åœ†\u0026rdquo;ï¼Œè£…åœ¨ä¸¤ä¸ªåæ ‡å®šä¹‰çš„\u0026quot;çŸ©å½¢\u0026quot;(rectangle)å†…ã€‚éƒ¨åˆ†å¼§çº¿å¾ˆå°‘ä½¿ç”¨ï¼Œå› ä¸ºå¾ˆéš¾ç¡®å®šç«¯ç‚¹ï¼Œé™¤éè§’åº¦é™åˆ¶åœ¨ä¹ååº¦çš„å€æ•°ã€‚\ncircle å’Œ ellipse åŸè¯­æ¶‰åŠ\u0026quot;ä¸­å¿ƒ\u0026quot;åæ ‡ä¸\u0026quot;è¾¹ç¼˜\u0026quot;åæ ‡ï¼Œæˆ–\u0026quot;å¤§å°\u0026quot;å’Œ\u0026quot;è§’åº¦\u0026quot;å€¼ã€‚\n# åœ† / æ¤­åœ† (ä»¥æŸä¸€ç‚¹ä¸ºä¸­å¿ƒ) convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;circle 50,30 40,10\u0026#34; draw_circle.gif convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;ellipse 50,30 40,20 0,360\u0026#34; draw_ellipse.gif convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;ellipse 50,30 40,20 45,270\u0026#34; draw_ellipse_partial.gif ä½ ä¹Ÿå¯ä»¥çœ‹çœ‹ Push/Pop ä¸Šä¸‹æ–‡ï¼Œäº†è§£å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ—‹è½¬çš„æ¤­åœ†çš„ä¾‹å­ã€‚\n# ç›´çº¿ / æŠ˜çº¿ / å¤šè¾¹å½¢ / è´å¡å°”æ›²çº¿ convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;line 20,50 90,10\u0026#34; draw_line.gif convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;polyline 40,10 20,50 90,10 70,40\u0026#34; draw_polyline.gif convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;polygon 40,10 20,50 90,10 70,40\u0026#34; draw_polygon.gif convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;bezier 40,10 20,50 90,10 70,40\u0026#34; draw_bezier.gif æ¯”è¾ƒå¥½çš„ç”»ç›´çº¿å’Œæ›²çº¿çš„æ–¹æ³•æ˜¯ä½¿ç”¨ SVG è·¯å¾„ç”»æ³•ï¼Œå®ƒçš„ç”¨é€”æ›´å¹¿ï¼Œç”šè‡³å¯ä»¥å®ç°\u0026quot;æ¯”ä¾‹ç”»çº¿\u0026quot;ã€‚\n# text drawing / image convert -size 100x60 xc:skyblue -fill white -stroke black \\  -font Candice -pointsize 40 -gravity center \\  -draw \u0026#34;text 0,0 \u0026#39;Hello\u0026#39;\u0026#34; draw_text.gif convert -size 100x60 xc:skyblue -gravity center \\  -draw \u0026#34;image over 0,0 0,0 \u0026#39;terminal.gif\u0026#39;\u0026#34; draw_image.gif æœ€åè¿™ä¸¤ä¸ªå¡«å……ç±»å‹çš„æ“ä½œæ˜¯ç›®å‰å”¯ä¸€å— \u0026ldquo;-gravity\u0026rdquo; å½±å“çš„ç»˜åˆ¶æ“ä½œã€‚è¿™äº›æ“ä½œçš„å…¶ä»–ä¿®é¥°ç¬¦ï¼ŒåŒ…æ‹¬ \u0026ldquo;-fill\u0026quot;ã€\u0026quot;-tile\u0026quot;ã€\u0026quot;-origin\u0026quot;ã€\u0026quot;-stroke\u0026quot;ã€\u0026quot;-strokeidth\u0026quot;ã€\u0026quot;-font\u0026quot;ã€\u0026quot;-pointsize\u0026quot;ã€\u0026quot;-box\u0026quot;ã€‚ä»–ä»¬è¿˜æœ‰å…¶ä»–çš„ä¿®é¥°ç¬¦ï¼Œä½†è¿™äº›ä¿®é¥°ç¬¦ä¸æ›´é«˜çº§çš„ Magick Vector Graphics è¯­è¨€æœ‰å…³ã€‚\nè´èµ›å°”åŸè¯­ \u0026ldquo;bezier\u0026rdquo; åŸè¯­ç”¨äºç»˜åˆ¶æ›²çº¿ã€‚æ¯æ¡å‘½ä»¤åªç”»ä¸€æ¡æ›²çº¿æ®µã€‚é€šå¸¸ä¼šç»™å‡º 4 ä¸ªç‚¹ï¼ˆ8 ä¸ªæ•°å­—ï¼‰ï¼šä¸€ä¸ªèµ·ç‚¹\u0026rsquo;ç»“'ã€ä¸¤ä¸ªæ§åˆ¶ç‚¹å’Œä¸€ä¸ªç»ˆç‚¹\u0026rsquo;ç»“'ã€‚ä¸¤ä¸ªæ§åˆ¶ç‚¹å®šä¹‰äº†æ›²çº¿çš„æ–¹å‘ä»¥åŠæ›²çº¿åç¦»é™„åŠ çš„ç»ˆç‚¹\u0026rsquo;ç»“\u0026rsquo;ç‚¹çš„é€Ÿåº¦ã€‚\nä¸ºäº†é¡ºåˆ©åœ°å°†ä¸¤æ¡æ›²çº¿è¿æ¥èµ·æ¥ï¼Œåº”è¯¥å°†ç«¯ç‚¹çš„æ§åˆ¶ç‚¹é€šè¿‡\u0026rsquo;ç»“\u0026rsquo;é•œåƒï¼Œå½¢æˆä¸‹ä¸€æ¡è´å¡å°”æ›²çº¿çš„æ§åˆ¶ç‚¹ã€‚ä¾‹å¦‚è¿™é‡Œæˆ‘ç”»äº†ä¸¤æ¡å¹³ç¨³è¿æ¥åœ¨ä¸€èµ·çš„è´èµ›å°”æ›²çº¿ã€‚è¯·æ³¨æ„æ§åˆ¶çº¿å’Œç‚¹ï¼ˆä¹Ÿæ˜¯ç”»å‡ºæ¥çš„ï¼‰æ˜¯å¦‚ä½•é€šè¿‡è¿æ¥åæ ‡ç›´çº¿é•œåƒçš„ï¼Œæ— è®ºæ˜¯è§’åº¦è¿˜æ˜¯é•¿åº¦ã€‚è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå¦åˆ™æ›²çº¿å°†ä¸å¹³æ»‘ã€‚\npoints=\u0026#34;10,10 30,90 25,10 50,50 50,50 75,90 70,10 90,40\u0026#34; clines=`echo \u0026#34;$points\u0026#34; | sed \u0026#39;s/ /\\n/g\u0026#39; |\\  while read line; do echo \u0026#34;line $line\u0026#34;; done` symbols=`echo path \u0026#34;\u0026#39;\u0026#34;; for point in $points; do echo \u0026#34;M $pointl -2,-2 +4,+4 -2,-2 l -2,+2 +4,-4 -2,+2\u0026#34; done; echo \u0026#34;\u0026#39;\u0026#34;` convert -size 100x100 xc:skyblue -fill none \\  -draw \u0026#34;stroke gray $clinesstroke blue $symbols\u0026#34; \\  -draw \u0026#34;stroke red bezier 10,10 30,90 25,10 50,50 \u0026#34; \\  -draw \u0026#34;stroke red bezier 50,50 75,90 70,10 90,40 \u0026#34; \\  draw_bezier_joined.gif å¦‚æœæˆ‘ç§»åŠ¨å…¶ä¸­ä¸€ä¸ªæ§åˆ¶ç‚¹ï¼Œä½¿å®ƒä¸ä»åŒä¸€\u0026quot;ç»“\u0026quot;çš„å¦ä¸€ä¸ªæ§åˆ¶ç‚¹é€šè¿‡é™„åŠ çš„\u0026quot;ç»“\u0026quot;è¿›è¡Œ\u0026quot;åå°„\u0026rdquo;ï¼Œé‚£ä¹ˆæ›²çº¿å°†ä¸è¿ç»­ã€‚\npoints=\u0026#34;10,10 30,90 25,10 50,50 50,50 80,50 70,10 90,40\u0026#34; clines=`echo \u0026#34;$points\u0026#34; | sed \u0026#39;s/ /\\n/g\u0026#39; |\\  while read line; do echo \u0026#34;line $line\u0026#34;; done` symbols=`echo path \u0026#34;\u0026#39;\u0026#34;; for point in $points; do echo \u0026#34;M $pointl -2,-2 +4,+4 -2,-2 l -2,+2 +4,-4 -2,+2\u0026#34; done; echo \u0026#34;\u0026#39;\u0026#34;` convert -size 100x100 xc:skyblue -fill none \\  -draw \u0026#34;stroke gray $clinesstroke blue $symbols\u0026#34; \\  -draw \u0026#34;stroke red bezier 10,10 30,90 25,10 50,50 \u0026#34; \\  -draw \u0026#34;stroke red bezier 50,50 80,50 70,10 90,40 \u0026#34; \\  draw_bezier_disjoint.gif å¦‚æœå†æ¬¡ç§»åŠ¨æ§åˆ¶ç‚¹ï¼Œä½¿å…¶ä¸ç›¸å…³çš„\u0026quot;ç»“\u0026quot;ç‚¹ç›¸åŒ¹é…ï¼Œçº¿æ¡å°†ç›´æ¥ä»è¯¥ç‚¹å‡ºå‘ï¼Œå®Œå…¨æ²¡æœ‰ä»»ä½•\u0026quot;æ›²çº¿\u0026quot;ã€‚\npoints=\u0026#34;10,10 30,90 25,10 50,50 50,50 50,50 70,10 90,40\u0026#34; clines=`echo \u0026#34;$points\u0026#34; | sed \u0026#39;s/ /\\n/g\u0026#39; |\\  while read line; do echo \u0026#34;line $line\u0026#34;; done` symbols=`echo path \u0026#34;\u0026#39;\u0026#34;; for point in $points; do echo \u0026#34;M $pointl -2,-2 +4,+4 -2,-2 l -2,+2 +4,-4 -2,+2\u0026#34; done; echo \u0026#34;\u0026#39;\u0026#34;` convert -size 100x100 xc:skyblue -fill none \\  -draw \u0026#34;stroke gray $clinesstroke blue $symbols\u0026#34; \\  -draw \u0026#34;stroke red bezier 10,10 30,90 25,10 50,50 \u0026#34; \\  -draw \u0026#34;stroke red bezier 50,50 50,50 70,10 90,40 \u0026#34; \\  draw_bezier_no_curve.gif å¦‚æœä¸¤ä¸ªæ§åˆ¶ç‚¹éƒ½è®¾ç½®ä¸ºå„è‡ªçš„\u0026quot;ç»“ç‚¹\u0026quot;ï¼Œé‚£ä¹ˆå°±ä¼šç”Ÿæˆä¸€æ¡ç›´çº¿ã€‚\npoints=\u0026#34;10,10 10,10 50,50 50,50 50,50 50,50 90,40 90,40\u0026#34; clines=`echo \u0026#34;$points\u0026#34; | sed \u0026#39;s/ /\\n/g\u0026#39; |\\  while read line; do echo \u0026#34;line $line\u0026#34;; done` symbols=`echo path \u0026#34;\u0026#39;\u0026#34;; for point in $points; do echo \u0026#34;M $pointl -2,-2 +4,+4 -2,-2 l -2,+2 +4,-4 -2,+2\u0026#34; done; echo \u0026#34;\u0026#39;\u0026#34;` convert -size 100x100 xc:skyblue -fill none \\  -draw \u0026#34;stroke gray $clinesstroke blue $symbols\u0026#34; \\  -draw \u0026#34;stroke red bezier 10,10 10,10 50,50 50,50 \u0026#34; \\  -draw \u0026#34;stroke red bezier 50,50 50,50 90,40 90,40 \u0026#34; \\  draw_bezier_lines.gif å¦‚æœä¸æŒ‡å®šæ‰€æœ‰ 4 ä¸ªç‚¹ï¼Œ\u0026lsquo;bezier\u0026rsquo; åŸè¯­å¹¶ä¸çœŸæ­£æœ‰ç”¨ã€‚åªæœ‰ç¬¬ä¸€ä¸ªç‚¹å’Œæœ€åä¸€ä¸ªç‚¹è¢«å½’ç±»ä¸º\u0026rsquo;ç»“'ï¼Œæ›²çº¿å°†é€šè¿‡ï¼ˆæˆ–ç»“æŸï¼‰è¿™ä¸¤ä¸ªç‚¹ã€‚æ‰€æœ‰å…¶ä»–çš„ç‚¹çº¯ç²¹è¢«è§†ä¸ºæ§åˆ¶ç‚¹ï¼ŒæŒ‰ç…§ç»™å®šçš„é¡ºåºå¯¹æ›²çº¿äº§ç”Ÿå½±å“ï¼Œæ§åˆ¶ç‚¹è¶Šè¿œï¼Œå¯¹è¯¥æ®µæ›²çº¿çš„å½±å“è¶Šå¤§ã€‚\npoints=\u0026#34;10,10 30,90 25,10 75,90 70,10 90,40\u0026#34; symbols=`for point in $points; do echo \u0026#34;M $pointl -2,-2 +4,+4 -2,-2 l -2,+2 +4,-4 -2,+2\u0026#34; done` convert -size 100x100 xc:skyblue -fill none \\  -draw \u0026#34;stroke gray polyline $points\u0026#34; \\  -draw \u0026#34;stroke red bezier $points\u0026#34; \\  -draw \u0026#34;stroke blue path \u0026#39;$symbols\u0026#39; \u0026#34; \\  draw_bezier_multi.gif ä¸ºäº†ä¿æŒç®€å•ï¼Œä¸å»ºè®®ä½ æ¯æ¡ \u0026lsquo;bezier\u0026rsquo; æ›²çº¿æ®µä½¿ç”¨è¶…è¿‡æˆ–å°‘äº4ä¸ªç‚¹ã€‚\nå…¶å®æˆ‘å»ºè®®ä½ å®Œå…¨ä¸è¦ä½¿ç”¨ \u0026lsquo;bezier\u0026rsquo; åŸè¯­ï¼Œè€Œæ˜¯ä½¿ç”¨ SVG Path Cubic Bezier æ¥ç”Ÿæˆæ›²çº¿ã€‚å®ƒæœ‰ä¸€ä¸ªç‰¹æ®Šçš„ \u0026ldquo;s\u0026rdquo; æ›²çº¿å»¶ç»­åŠŸèƒ½ï¼Œå¯ä»¥è‡ªåŠ¨åšç›¸åº”çš„æ§åˆ¶ç‚¹\u0026quot;åå°„\u0026quot;ï¼Œç”Ÿæˆå¹³æ»‘è¿æ¥çš„æ›²çº¿æ®µï¼Œå‡å°‘ä½ éœ€è¦ä½¿ç”¨çš„æ§åˆ¶ç‚¹æ•°é‡ã€‚æ‚¨è¿˜å¯ä»¥å®šä¹‰ç›¸å¯¹äºè·¯å¾„ä¸­æœ€åä¸€ä¸ªç«¯ç‚¹çš„ç‚¹ã€‚\né¢œè‰²å¡«å……åŸè¯­ é™¤äº†ä¸Šè¿° \u0026ldquo;ç®€å•\u0026quot;åŸè¯­ä¹‹å¤–ï¼Œ\u0026quot;-draw\u0026ldquo;è¿˜æä¾›äº†ä¸€ç»„é¢œè‰²å¡«å……æˆ–ä¿®æ”¹åŸè¯­ã€‚è¿™äº›åŸè¯­æ ¹æ®æ‰€é€‰æ–¹æ³•ï¼Œä»æŒ‡å®šçš„ç‚¹å¼€å§‹ä¿®æ”¹å›¾åƒä¸­çš„é¢œè‰²ã€‚\nè¿™äº›å¡«å……æ–¹æ³•å®é™…ä¸Šä¸æ˜¯çœŸæ­£çš„ \u0026lsquo;draw\u0026rsquo; å‘½ä»¤ï¼Œè€Œæ˜¯é¢œè‰²æ›¿æ¢å‡½æ•°ã€‚å®ƒä»¬è¢«æ·»åŠ åˆ°ç»˜å›¾ä¸­ï¼Œå› ä¸ºåœ¨ç¨‹åºçš„æ—©æœŸç‰ˆæœ¬ä¸­ï¼Œå°†å®ƒä»¬çš„æ“ä½œæ’å…¥åˆ° ImageMagick ä¸­æ˜¯æœ€ç®€å•çš„ã€‚\nå°±åƒä¸Šé¢ä¸€æ ·ï¼Œä½¿ç”¨çš„é¢œè‰²æ˜¯ç”¨ \u0026ldquo;-fill\u0026ldquo;é¢œè‰²è®¾ç½®çš„ï¼Œä½†å¦‚æœè®¾ç½®äº†ï¼Œå°±ä¼šä½¿ç”¨ \u0026ldquo;-tile\u0026rdquo; å›¾åƒæ¥ä»£æ›¿ã€‚\nä¸Šé¢çš„å…¶ä»–è®¾ç½®é€‰é¡¹æ²¡æœ‰ä½¿ç”¨ï¼Œå¯¹è¿™äº›æ“ä½œæ²¡æœ‰å½±å“ã€‚\nä¸¤ä¸ªé¢å¤–çš„è®¾ç½®ä¹Ÿå°†åº”ç”¨äºè¿™äº›åŸè¯­ï¼Œå³ \u0026ldquo;-bordercolor\u0026rdquo; å’Œ \u0026ldquo;-fuzz\u0026ldquo;ç³»æ•°è®¾ç½®ã€‚ä½†æ˜¯ï¼Œè¿™äº›è®¾ç½®ä¸èƒ½åœ¨ \u0026ldquo;MVG\u0026rdquo; è¯­è¨€ä¸­å®šä¹‰ï¼Œå› æ­¤åªèƒ½åœ¨ä½¿ç”¨ \u0026ldquo;-draw\u0026rdquo; æ“ä½œç¬¦ä¹‹å‰è¿›è¡Œè®¾ç½®ã€‚\nç¬¬ä¸€ä¸ª \u0026lsquo;color point\u0026rsquo; ä½ å·²ç»çœ‹åˆ°äº†ï¼Œå®ƒæ˜¯ä¸Šè¿°ä¾‹å­ä¸­ \u0026lsquo;point\u0026rsquo; ç»˜åˆ¶åŸè¯­çš„æ›¿ä»£ã€‚å¦‚æœä½ ä»”ç»†è§‚å¯Ÿï¼Œä½ ä¼šçœ‹åˆ°æˆ‘ä»¬åœ¨æµ‹è¯•å›¾åƒä¸­è®¾ç½®çš„å•ä¸ªç™½è‰²åƒç´ ã€‚\nconvert color_test.png -fill white \\  -draw \u0026#39;color 30,20 point\u0026#39; color_point.png ç„¶è€Œåœ¨ç»˜åˆ¶é€æ˜è‰²å’ŒåŠé€æ˜è‰²æ—¶ï¼Œè¿™äº›åŠŸèƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚\nè¿™é‡Œæˆ‘ä»¬æœ‰ä¸€ä¸ªä¸‰ä¸ªåƒç´ çš„çº¢è‰²å›¾åƒï¼ˆæ”¾å¤§äº†ï¼‰ï¼Œç¬¬äºŒä¸ªæˆ–ä¸­é—´çš„åƒç´ æˆ‘ä»¬ç”¨ point å‡½æ•°åœ¨çº¢è‰²åƒç´ ä¸Šç”»ä¸ŠåŠé€æ˜çš„è“è‰²ï¼Œå¾—åˆ°ç´«è‰²çš„ç»“æœã€‚ç„¶è€Œå¦‚æœä½¿ç”¨ color point å‡½æ•°ï¼ˆæœ€åä¸€ä¸ªæˆ–å³è¾¹çš„åƒç´ ï¼‰ï¼Œçº¢è‰²å®Œå…¨è¢«åŠé€æ˜çš„è“è‰²åƒç´ æ‰€å–ä»£ã€‚å®ƒä¸ä¼šè¢«å åŠ ã€‚\nconvert -size 3x1 xc:red -matte -fill \u0026#39;#00F8\u0026#39; \\  -draw \u0026#39;point 1,0\u0026#39; \\  -draw \u0026#39;color 2,0 point\u0026#39; -scale 33x33 draw_points.png æ‰€æœ‰çš„ color å‡½æ•°éƒ½ä¼šè¿›è¡Œå…¨è‰²æ›¿æ¢ï¼Œè€Œå…¶ä»–æ‰€æœ‰çš„é¢œè‰²åŸè¯­éƒ½ä¼šåœ¨å›¾åƒä¸Šé¢\u0026rsquo;ç”»\u0026rsquo;å‡ºé¢œè‰²ã€‚å› æ­¤ï¼Œä½ å¯ä»¥ä½¿ç”¨ color æ¥ç»˜åˆ¶é€æ˜è‰²ã€‚\ncolor replace ç»˜åˆ¶å‡½æ•°å°†åœ¨æŒ‡å®šçš„ä½ç½®æ›¿æ¢æ‰€æœ‰ç²¾ç¡®ç»™å®šé¢œè‰²çš„å®ä¾‹ã€‚è€Œä¸”æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œè¿™äº›åŒºåŸŸä¸ä¸€å®šè¦è¿æ¥åœ¨ä¸€èµ·ã€‚\nconvert color_test.png -fill white \\  -draw \u0026#39;color 30,20 replace\u0026#39; color_replace.png convert color_test.png -fill white -fuzz 13%\\  -draw \u0026#39;color 30,20 replace\u0026#39; color_replace_fuzz.png ç„¶è€Œï¼Œæ­£å¦‚ä½ åœ¨ç¬¬ä¸€ä¸ªç»“æœä¸­æ‰€çœ‹åˆ°çš„ï¼Œä¸€äº›æ²¿è¾¹ç¼˜çš„åƒç´ æ²¡æœ‰è¢«æ›¿æ¢ã€‚è¿™äº›åƒç´ ä¸æ‰€é€‰åƒç´ çš„é¢œè‰²ä¸å®Œå…¨ç›¸åŒï¼Œæ‰€ä»¥å®ƒä»¬è¢«å¿½ç•¥äº†ã€‚æ·»åŠ ä¸€ä¸ªå°çš„æ¨¡ç³Šå› å­ä¹Ÿä¼šåŒ…å«ä¸åŸè‰²ç›¸ä¼¼çš„é¢œè‰²ã€‚å¦‚ä¸Šé¢ç¬¬äºŒä¸ªä¾‹å­æ‰€ç¤ºã€‚\nå½“ç„¶ï¼Œfuzz factor å¹¶ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œå› ä¸ºå®ƒä¸ä¼šæ•æ‰æ‰€æœ‰è¿™æ ·çš„è¾¹ç¼˜åƒç´ ã€‚è¿™æ˜¯æ‰€æœ‰è¿™äº› color fill æ–¹æ³•ç»å¸¸å‡ºç°çš„é—®é¢˜ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ²¡æœ‰é€šç”¨è§£å†³æ–¹æ¡ˆçš„é—®é¢˜ã€‚\nå¦‚æœä½ æƒ³æ›¿æ¢ä¸€ä¸ªç‰¹å®šçš„å·²çŸ¥é¢œè‰²ï¼Œè€Œä¸æ˜¯ä»å›¾åƒæœ¬èº«é€‰æ‹©ä¸€ç§é¢œè‰²ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ \u0026ldquo;-opaque\u0026rdquo; å›¾åƒæ“ä½œç¬¦æ¥ä»£æ›¿ã€‚è¯¥å‡½æ•°è¿˜ä½¿ç”¨ \u0026ldquo;-fuzz\u0026rdquo; å› å­è®¾ç½®æ¥å¢åŠ ä¸ç»™å®šé¢œè‰²ç›¸åŒ¹é…çš„é¢œè‰²èŒƒå›´ã€‚\nfloodfill çš„æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œå› ä¸ºå®ƒåªä¼šå¡«å……æ‰€é€‰ç‚¹å‘¨å›´çš„æ•´ä¸ªåŒºåŸŸï¼Œè€Œä¸ä¼šé€‰æ‹©ä»»ä½•å…¶ä»–æ²¡æœ‰ä»¥æŸç§æ–¹å¼è¿æ¥çš„ç±»ä¼¼é¢œè‰²çš„åŒºåŸŸã€‚\nä½ ä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨ \u0026ldquo;-fuzz\u0026rdquo; æ¥æ‰©å¤§è¢«å¡«å……çš„åŒºåŸŸï¼Œä»¥åŒ…æ‹¬ç›¸ä¼¼çš„é¢œè‰²ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬é€‰æ‹©äº†ä¸€ä¸ªè¶³å¤Ÿé«˜çš„å€¼ï¼Œä¹ŸåŒ…æ‹¬äº†äº¤å‰è¾¹ç•Œï¼Œå…è®¸æ´ªæ°´å¡«å……\u0026quot;æ³„æ¼\u0026quot;åˆ°å›¾åƒçš„å¦ä¸€ä¾§ã€‚\nconvert color_test.png -fill white \\  -draw \u0026#39;color 30,20 floodfill\u0026#39; color_floodfill.png convert color_test.png -fill white -fuzz 15% \\  -draw \u0026#39;color 30,20 floodfill\u0026#39; color_floodfill_fuzz.png ç”¨é¢œè‰²å¡«å……åŒºåŸŸå¹¶éæ²¡æœ‰é—®é¢˜ã€‚é¢œè‰²å¯èƒ½ä¼šè¶Šè¿‡è–„è–„çš„è¾¹ç•Œï¼Œæ¸—å…¥åˆ°ä¸æƒ³è¦çš„åŒºåŸŸï¼Œ(è¯·çœ‹èƒŒæ™¯å›¾æ¡ˆä¸Šçš„ GIFï¼Œä»¥è¯æ˜è¿™ä¸€ç‚¹)ã€‚æˆ–è€…ï¼Œå®ƒå¯èƒ½æ— æ³•å¡«æ»¡æ‰€é€‰åŒºåŸŸçš„è¾¹ç¼˜ï¼Œï¼ˆè§åé”¯é½¿å’Œæ³›æ»¥å¡«å……é—®é¢˜ï¼‰ã€‚ä½†å®ƒç¡®å®æœ‰æ•ˆã€‚\nfilltoborder å°±åƒ floodfill ä¸€æ ·ï¼Œåªæ˜¯ä½ æŒ‡å®šäº†ä¸€ä¸ªé¢œè‰²ï¼Œè¿™ä¸ªé¢œè‰²çš„è¾¹ç•Œæ˜¯è¦å¡«å……çš„åŒºåŸŸï¼Œè€Œä¸æ˜¯å¡«å……è¿‡ç¨‹ä¸­è¦æ›¿æ¢çš„é¢œè‰²ã€‚\nå½“ç„¶ä¹Ÿå»ºè®®åœ¨è¯¥è¾¹æ¡†é¢œè‰²é€‰æ‹©ä¸­åŠ å…¥ similar colors çš„æ¨¡ç³Šå› å­ï¼Œä»¥è¿›ä¸€æ­¥é™åˆ¶æ´ªæ°´å¡«å……ã€‚\nconvert color_test.png -fill white -bordercolor royalblue \\  -draw \u0026#39;color 30,20 filltoborder\u0026#39; color_filltoborder.png convert color_test.png -fill white -bordercolor blue \\  -draw \u0026#39;color 30,20 filltoborder\u0026#39; color_filltoborder2.png convert color_test.png -fill white -bordercolor blue -fuzz 30% \\  -draw \u0026#39;color 30,20 filltoborder\u0026#39; color_filltoborder_fuzz.png æœ€åçš„ç»˜åˆ¶é¢œè‰²æ–¹æ³•æ˜¯ resetï¼Œå®ƒåªæ˜¯å°†æ•´ä¸ªå›¾åƒæ›¿æ¢æˆ–é‡ç½®ä¸ºå¡«å……é¢œè‰²ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®é™…é€‰æ‹©çš„åƒç´ å¯¹ç»“æœæ²¡æœ‰ä»»ä½•å½±å“ã€‚\nconvert color_test.png -fill white \\  -draw \u0026#39;color 30,20 reset\u0026#39; color_reset.png è¿™å®é™…ä¸Šæ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå› ä¸ºå®ƒæä¾›äº†ä¸€ç§ç®€å•çš„æ–¹æ³•ä»ç°æœ‰å›¾åƒç”Ÿæˆçº¯è‰²ï¼ˆæˆ–å¹³é“ºå›¾åƒï¼‰ç”»å¸ƒã€‚(è¯·å‚è§ Canvases Sized to an Existing Image)ä»¥äº†è§£æ­¤æ–¹æ³•å’Œå…¶ä»–åšåŒæ ·äº‹æƒ…çš„æ–¹æ³•ã€‚\næœªæ¥ï¼šä½¿ç”¨ \u0026ldquo;-tile\u0026rdquo; å›¾æ¡ˆæ¥å¡«å……è¯¥åŒºåŸŸã€‚\nMatt å¡«å……åŸè¯­ matte ç»˜åˆ¶åŸè¯­çš„å·¥ä½œæ–¹å¼ä¸ä¸Šè¿° color åŸè¯­å®Œå…¨ç›¸åŒï¼Œåªæ˜¯å®ƒä¸ä¼šæ›¿æ¢æ‰€é€‰åŒºåŸŸçš„é¢œè‰²ï¼Œåªä¼šæ›¿æ¢æ‰€é€‰åŒºåŸŸçš„ matte é€šé“ã€‚ï¼ˆä¹Ÿå°±æ˜¯åªæœ‰ alpha æˆ– matte é€šé“è¢«è¿™äº›å¡«å……å‡½æ•°è°ƒæ•´ï¼‰ã€‚\nå°±åƒ color å¡«å……å‡½æ•°ä¸€æ ·ï¼Œmatte å€¼ä½¿ç”¨çš„æ˜¯å¡«å……è‰²ï¼ˆé™¤éç”¨ \u0026ldquo;-tile\u0026rdquo; ä½œä¸º alpha value çš„æ¥æºï¼‰ã€‚\nè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ä¸Šé¢åŒæ ·çš„ color floodfill ä¾‹å­ï¼Œä½†è¿™é‡Œåªè°ƒæ•´ matte é€šé“ï¼Œä½¿å¡«å……éƒ¨åˆ†å®Œå…¨é€æ˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŸæ¥çš„é¢œè‰²ä»ç„¶å­˜åœ¨ï¼Œåªæ˜¯é€æ˜è€Œå·²!\nconvert color_test.png -fill none \\  -draw \u0026#39;matte 30,20 floodfill\u0026#39; matte_floodfill.png convert color_test.png -fill none -fuzz 15% \\  -draw \u0026#39;matte 30,20 floodfill\u0026#39; matte_floodfill_fuzz.png ä¹Ÿå¯ä»¥ä½¿ç”¨ matte reset å‡½æ•°ä½¿æ•´ä¸ªå›¾åƒå˜æˆåŠé€æ˜çš„ã€‚å½“ç„¶åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¿…é¡»è¾“å‡ºåˆ° PNGï¼Œå®ƒå¯ä»¥æ¥å—åŠé€æ˜é¢œè‰²çš„å›¾åƒã€‚\nconvert color_test.png -fill \u0026#39;#00000080\u0026#39; \\  -draw \u0026#39;matte 30,20 reset\u0026#39; matte_reset.png æ³¨æ„ï¼Œåœ¨æ“ä½œä¸­æ²¡æœ‰ä½¿ç”¨ black é¢œè‰²åˆ†é‡ï¼Œåªä½¿ç”¨äº†é¢œè‰²çš„ matte åˆ†é‡ã€‚å›¾åƒçš„åŸè‰²ä¿æŒåŸæ ·ã€‚\næœªæ¥ï¼šä½¿ç”¨ \u0026ldquo;-tile\u0026rdquo; æ¨¡å¼æ¥åˆ¶ä½œæœ‰è¶£çš„å“‘å…‰æ•ˆæœã€‚\ncolor å’Œ matte éƒ½æ˜¯å®Œå…¨æ›¿æ¢é¢œè‰²çš„å‡½æ•°ï¼Œå®ƒæ€»æ˜¯ä¼šäº§ç”Ÿä¸€ä¸ªå¸ƒå°”ï¼ˆall or nothingï¼‰ç±»å‹çš„é¢œè‰²æ›¿æ¢ã€‚å› æ­¤ï¼Œè¿™äº›åŒºåŸŸçš„è¾¹ç¼˜æ€»æ˜¯ä¼šæ˜¾ç¤ºå‡º Aliasing æ•ˆæœã€‚\næ­£å› ä¸ºå¦‚æ­¤ï¼Œé™¤äº†è®¾ç½® GIF å›¾åƒçš„é€æ˜åŒºåŸŸï¼ˆä¹Ÿæ˜¯å¸ƒå°”å‹ï¼‰å¤–ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿™äº›éƒ½ä¸æ˜¯ä¸€èˆ¬å›¾åƒæ˜¾å½±çš„å¥½å›¾åƒè¿ç®—ç¬¦ã€‚ä¸è¿‡ä¹Ÿä¸æ˜¯å…¨æ— ç”¨å¤„ï¼Œä»èƒŒæ™¯å»é™¤çš„ä¾‹å­ä¸­å¯ä»¥çœ‹å‡ºã€‚\nå…³äºç»˜å›¾å‘½ä»¤çš„å…·ä½“å†…å®¹ åƒç´ åæ ‡ [-draw](https://imagemagick.org/Usage/option_link.cgi?draw) å‘½ä»¤ï¼ˆä»¥åŠIMä¸­çš„è®¸å¤šå…¶ä»–å‘½ä»¤ï¼‰ä½¿ç”¨çš„æ˜¯æ‰€è°“çš„\u0026quot;åƒç´ åæ ‡\u0026rdquo;ã€‚ä¹Ÿå°±æ˜¯ \u0026ldquo;10,10\u0026rdquo; çš„åæ ‡æ˜¯å·¦ä¸Šè§’å¾€ä¸‹10ä¸ªåƒç´ çš„ä¸­å¿ƒã€‚\nåœ¨è¿™ä¸ªåæ ‡ç³»ä¸­ï¼Œ0,0 æ˜¯å·¦ä¸Šè§’åƒç´ çš„ä¸­å¿ƒï¼Œw-1,h-1 æ˜¯å³ä¸‹è§’çš„ä¸­å¿ƒã€‚å®é™…çš„è¾¹ç¼˜ä½äº -0.5,-0.5 å’Œ w-0.5,h-0.5ï¼Œä¸­å¿ƒåƒç´ ï¼ˆå¦‚æœå›¾åƒæ˜¯å¥‡æ•°å¤§å°ï¼‰ä½äº \u0026lsquo;(w-1)/2,(h-1)/2\u0026rsquo;ã€‚\nç„¶è€Œï¼Œå½“æ‚¨å¯¹å›¾åƒè¿›è¡Œæ•°å­¦å¤„ç†æ—¶ï¼ˆå¦‚ä½¿ç”¨æ‰­æ›²æ—¶ï¼‰ï¼Œå®é™…çš„åƒç´ æ²¡æœ‰å®é™…æ„ä¹‰ï¼Œå› æ­¤å®ƒä½¿ç”¨\u0026quot;å›¾åƒåæ ‡\u0026rdquo;ã€‚åœ¨è¿™ä¸ªç³»ç»Ÿä¸­ï¼Œå›¾åƒçš„å®é™…è¾¹ç¼˜åœ¨ \u0026lsquo;0,0\u0026rsquo; å’Œ \u0026lsquo;w,h\u0026rsquo; å¤„ã€‚è€Œå›¾åƒçš„ä¸­å¿ƒï¼ˆå¯èƒ½æ˜¯ï¼Œä¹Ÿå¯èƒ½ä¸æ˜¯åƒç´ çš„ä¸­å¿ƒï¼‰åœ¨ \u0026lsquo;w/2,h/2\u0026rsquo;ã€‚\nè¦å°† \u0026lsquo;åƒç´ åæ ‡\u0026rsquo; è½¬æ¢ä¸ºå›¾åƒåæ ‡ï¼Œè¯·åŠ ä¸Š Â½ å¦‚å·¦ä¸Šè§’åƒç´ çš„ä¸­å¿ƒæ˜¯ \u0026lsquo;0.5,0.5\u0026rsquo;ï¼Œå³ä¸‹è§’åƒç´ çš„ä¸­å¿ƒæ˜¯ \u0026lsquo;w-0.5,h-0.5\u0026rsquo;ã€‚ ä¾‹å¦‚ï¼šå°å›¾åƒä¸­çš„åœ†å¿ƒ\nç»˜åˆ¶ä¼½é©¬å’Œè‰²åŸŸæ ¡æ­£ å’Œå‡ ä¹æ‰€æœ‰çš„ ImageMagick æ“ä½œä¸€æ ·ï¼Œ [-draw](https://imagemagick.org/Usage/option_link.cgi?draw) æ˜¯ä¸€ä¸ªçº¿æ€§è¿ç®—ç¬¦ï¼Œå› æ­¤åœ¨çº¿æ€§ RGB è‰²å½©ç©ºé—´ä¸­å·¥ä½œã€‚è¿™æ„å‘³ç€ï¼Œä¸ºäº†å¾—åˆ°å¹³æ»‘çš„è¾¹ç¼˜ï¼Œä½ å¯èƒ½éœ€è¦å¯¹å›¾åƒè¿›è¡Œä¸€äº›ä¼½ç›æ ¡æ­£ï¼Œç„¶åå†ä¿å­˜ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨éçº¿æ€§ï¼ˆä¼½ç›æ ¡æ­£ï¼‰çš„sRGBè‰²å½©ç©ºé—´æ¥å­˜å‚¨ã€‚\nä¾‹å¦‚ï¼Œå¦‚æœä½ ç”»äº†ä¸€ä¸ªå¤§åœ†ï¼Œç„¶åä¿å­˜å®ƒ\u0026hellip;\nconvert -size 81x81 xc:black -fill white -draw \u0026#39;circle 40,40 40,3\u0026#39; \\  circle_raw.png çœ‹çœ‹åœ†åœˆçš„è¾¹ç¼˜ï¼Œå…¶å®çœ‹èµ·æ¥å¹¶ä¸æ˜¯çœŸçš„å¾ˆå…‰æ»‘ã€‚ä½ å¯ä»¥çœ‹åˆ°æ˜æ˜¾çš„é˜¶æ¢¯æ•ˆæœã€‚\né‚£æ˜¯å› ä¸ºä½ æ˜¯åœ¨çº¿æ€§ RGB è‰²å½©ç©ºé—´ä¸­ç”»çš„åœ†ã€‚ä½†æ˜¯ä½ å´æŠŠå›¾åƒä¿å­˜æˆäº†çœŸæ­£çš„ sRGB è‰²åŸŸï¼è¿™å°±å¯¼è‡´äº†ä½ çš„å›¾åƒåœ¨ä¿å­˜çš„è¿‡ç¨‹ä¸­å‡ºç°äº†æ˜æ˜¾çš„é˜¶æ¢¯æ•ˆæœã€‚\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ä¿å­˜å›¾åƒä¹‹å‰ç»™å›¾åƒæ·»åŠ ä¸€ä¸ªä¼½ç›æ ¡æ­£ã€‚\nconvert -size 81x81 xc:black -fill white -draw \u0026#39;circle 40,40 40,3\u0026#39; \\  -gamma 2.2 circle_gamma.png ç°åœ¨ï¼Œåœ†åœˆè¾¹ç¼˜å®é™…ä¸Šçœ‹èµ·æ¥å…‰æ»‘åœ†æ¶¦ï¼Œå°±åƒå®ƒä»¬åº”è¯¥çš„é‚£æ ·ã€‚\nå¦‚æœä½ æƒ³æ­£ç¡®åœ°åšè¿™ä»¶äº‹ï¼Œæˆ‘ä»¬çœŸçš„åº”è¯¥ä½¿ç”¨è‰²å½©ç©ºé—´è¿›è¡Œä¿®æ­£ã€‚ç„¶è€Œï¼Œç”±äºIMå‡è®¾RGBæ˜¯ä¿å­˜çš„é»˜è®¤è‰²å½©ç©ºé—´ï¼Œä½ éœ€è¦åšä¸€äº›æ£˜æ‰‹çš„å¤„ç†æ¥è®©å®ƒæ­£ç¡®åœ°åšäº‹æƒ…ã€‚\nconvert -size 81x81 xc:black -set colorspace RGB \\  -fill white -draw \u0026#39;circle 40,40 40,3\u0026#39; \\  -colorspace sRGB circle_sRGB.png  è¯·æ³¨æ„ï¼ŒsRGBè‰²å½©ç©ºé—´ï¼ˆè¿™æ˜¯ä¿å­˜å›¾åƒçš„æ­£ç¡®æ–¹æ³•ï¼‰ä¸ç®€å•åœ°åº”ç”¨2.2ä¼½ç›æ ¡æ­£å¹¶ä¸å®Œå…¨ç›¸åŒã€‚ç„¶è€Œï¼Œä¸¤è€…ä¹‹é—´çš„ç»“æœå·®å¼‚å¾ˆå°ï¼Œåªæœ‰åœ¨éå¸¸éå¸¸ç²—ç³™çš„å›¾åƒä¸­æ‰èƒ½çœ‹åˆ°ã€‚ åœ¨IM v6.7.5-1ä¹‹å‰ï¼Œè‰²å½©ç©ºé—´åç§° \u0026ldquo;sRGB\u0026rdquo; å’Œ \u0026ldquo;RGB\u0026rdquo;ï¼ˆçº¿æ€§-RGBï¼‰å®é™…ä¸Šæ˜¯é¢ å€’çš„ã€‚å› æ­¤ï¼Œåœ¨æ—§ç‰ˆæœ¬çš„IMä¸­ï¼Œä¸Šé¢çš„ä¸¤ä¸ªæ ‡ç­¾åº”è¯¥è¢«è°ƒæ¢ã€‚\n è¦ä½¿ç”¨çœŸå®çš„å›¾åƒï¼ˆåœ¨IMv6ä¸­ï¼‰æ­£ç¡®åœ°ç»˜åˆ¶ï¼ˆæˆ–è¿›è¡Œä»»ä½•\u0026quot;çº¿æ€§\u0026quot;å›¾åƒå¤„ç†ï¼‰ï¼Œä½ éœ€è¦é¦–å…ˆåˆ é™¤ä»»ä½•ç°æœ‰çš„ä¼½ç›ï¼Œå¤„ç†å›¾åƒï¼Œç„¶åæ¢å¤è¯¥ä¼½ç›æ ¡æ­£ã€‚æ›´å¤šç»†èŠ‚è¯·å‚è§ä½¿ç”¨è‰²åŸŸæ ¡æ­£è°ƒæ•´å¤§å°ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªåœ¨çœŸå®å›¾åƒä¸Šç»˜å›¾çš„ä¾‹å­\u0026hellip;ã€‚é¦–å…ˆæ˜¯æ²¡æœ‰ä»»ä½•é¢œè‰²æ ¡æ­£ï¼ˆåŸå§‹ï¼‰ï¼Œç„¶åæ˜¯ä¼½ç›å’Œè‰²åŸŸæ ¡æ­£ã€‚\nconvert rose: -fill none -stroke white -draw \u0026#39;line 5,40 65,5\u0026#39; rose_raw.png convert rose: -gamma .454545 \\  -fill none -stroke white -draw \u0026#39;line 5,40 65,5\u0026#39; \\  -gamma 2.2 rose_gamma.png convert rose: -colorspace RGB \\  -fill none -stroke white -draw \u0026#39;line 5,40 65,5\u0026#39; \\  -colorspace sRGB rose_sRGB.png æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œé€šè¿‡ä½¿ç”¨ä¼½ç›æˆ–è‰²å½©ç©ºé—´æ ¡æ­£ï¼Œçº¿æ¡å˜å¾—éå¸¸å¹³æ»‘ï¼Œæ²¡æœ‰é”¯é½¿çŠ¶çš„\u0026quot;æ¥¼æ¢¯\u0026quot;åˆ«ç¦»æ•ˆæœï¼Œæ¯”ç›´æ¥ç»˜åˆ¶æ—¶å¯ä»¥çœ‹åˆ°ã€‚(ä½ éœ€è¦ä¸€ä¸ªå¾ˆå¥½çš„æ˜¾ç¤ºå™¨æ‰èƒ½çœ‹åˆ°å®ƒ)\n ä¸Šé¢çš„çº¿æ¡æ˜¯ç”¨ [-stroke](https://imagemagick.org/Usage/option_link.cgi?stroke) é¢œè‰²ç»˜åˆ¶çš„ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ [-fill](https://imagemagick.org/Usage/option_link.cgi?fill) æ¥ç»˜åˆ¶çº¿æ¡ï¼Œå¹¶å¾—åˆ°åŒæ ·çš„ç»“æœï¼Œä½†è¿™æ ·æ‚¨å°±ä¸èƒ½ä½¿ç”¨ [-strokewidth](https://imagemagick.org/Usage/option_link.cgi?strokewidth) æ¥æ§åˆ¶çº¿æ¡ç²—ç»†ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è§ä¸‹é¢çš„\u0026rdquo;æè¾¹é¢œè‰²è®¾ç½®\u0026quot;ã€‚ è‰²åŸŸåç§°å®é™…ä¸Šæ˜¯ä½¿ç”¨\u0026rsquo;sRGB\u0026rsquo;è‰²å½©ç©ºé—´çš„å€¼æ¥å®šä¹‰çš„ï¼Œä½†é€šè¿‡ç»˜åˆ¶åº”ç”¨ï¼Œå°±å¥½åƒå›¾åƒæ˜¯åœ¨çº¿æ€§RGBè‰²å½©ç©ºé—´ä¸­ä¸€æ ·ã€‚å› æ­¤ï¼Œå¯¹å‘½åçš„é¢œè‰²ï¼ˆä¸æ˜¯\u0026quot;ç™½\u0026quot;æˆ–\u0026quot;é»‘\u0026rdquo;ï¼‰ä½¿ç”¨ä¸Šè¿°ä¼½ç›æ ¡æ­£å°†å¯¼è‡´è¿™äº›é¢œè‰²å˜å¾—å¤±çœŸã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€å¥½ä¸è¦ä½¿ç”¨ä¼½ç›æˆ–è‰²åŸŸæ ¡æ­£ï¼Œè¿™æ ·å‘½åçš„é¢œè‰²å°±ä¼šæ­£ç¡®æ˜ å°„ã€‚ å‘½åçš„\u0026rsquo;sRGB\u0026rsquo;é¢œè‰²ä¸å›¾åƒçš„è‰²å½©ç©ºé—´çš„æ­£ç¡®æ˜ å°„ï¼Œå°†ä½œä¸ºIMv7å¼€å‘çš„ä¸€éƒ¨åˆ†è¢«ä¿®æ­£ã€‚\n æè¾¹ã€æè¾¹å®½åº¦å’Œå¡«å……çš„ç›¸äº’ä½œç”¨ [-stroke](https://imagemagick.org/Usage/option_link.cgi?stroke) å’Œ [-strokewidth](https://imagemagick.org/Usage/option_link.cgi?strokewidth) é€‰é¡¹ç”¨äºåœ¨å­—ä½“è¾¹ç¼˜ç»˜åˆ¶è½®å»“ã€‚\nè¿™äº›é€‰é¡¹é€šå¸¸ä¸ [-fill](https://imagemagick.org/Usage/option_link.cgi?fill) ä¸€èµ·ä½¿ç”¨ï¼Œä»¥ä½¿æ–‡å­—æ›´æœ‰è¶£ï¼Œè€Œä¸è´¹åŠ›ã€‚\nconvert -size 380x70 xc:lightblue -pointsize 50 -font Chisel \\  -fill green -stroke black -draw \u0026#39;text 10,55 \u0026#34;Black Border\u0026#34;\u0026#39; \\  stroke_font.jpg é»˜è®¤è®¾ç½®æ˜¯ -strokewidth 1 å’Œ -stroke Noneã€‚\nä½†è¿™æ ·åšä¼šä½¿è½®å»“ç¬”ç”»ä¸å¯è§ï¼Œåªç•™ä¸‹ [-fill](https://imagemagick.org/Usage/option_link.cgi?fill) çš„é¢œè‰²ï¼Œä½ ä¸ä¼šçœ‹åˆ°å®ƒã€‚\nå½“ -strokewidth ä¸º \u0026ldquo;ä¸å¯è§ \u0026ldquo;æ—¶ï¼Œ -strokewidth å”¯ä¸€çš„æ•ˆæœæ˜¯å¯¹å­—ä½“å¤§å°å±æ€§çš„å½±å“ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»ç„¶å¯ä»¥å½±å“å­—ä½“å®šä½å’Œ Label å’Œ Caption å›¾ç‰‡ç”Ÿæˆçš„å¤§å°ã€‚å¦åˆ™ï¼Œå®½åº¦åœ¨ä½ ä½¿ç¬”ç”»å¯è§ä¹‹å‰æ˜¯æ²¡æœ‰å¯è§æ•ˆæœçš„ã€‚\nä¸ºäº†äº†è§£ [-strokewidth](https://imagemagick.org/Usage/option_link.cgi?strokewidth) å¯¹å­—ä½“å¤–è§‚çš„å®é™…å½±å“ï¼ˆå½“ä½¿å…¶å¯è§æ—¶ï¼‰ï¼Œæˆ‘åœ¨è¿™é‡Œç»˜åˆ¶äº†ä¸€äº›ä¸åŒå®½åº¦çš„æ–‡å­—ï¼Œä» \u0026ldquo;turned off\u0026rdquo; åˆ°è¶Šæ¥è¶Šå¤§ã€‚\nconvert -size 320x420 xc:lightblue -pointsize 70 -font Vademecum \\  -fill red -stroke none -draw \u0026#39;text 30,80 \u0026#34;Stroke -\u0026#34;\u0026#39; \\  -fill red -stroke black -strokewidth 0 -draw \u0026#39;text 30,160 \u0026#34;Stroke 0\u0026#34;\u0026#39; \\  -fill red -stroke black -strokewidth 1 -draw \u0026#39;text 30,240 \u0026#34;Stroke 1\u0026#34;\u0026#39; \\  -fill red -stroke black -strokewidth 2 -draw \u0026#39;text 30,320 \u0026#34;Stroke 2\u0026#34;\u0026#39; \\  -fill red -stroke black -strokewidth 3 -draw \u0026#39;text 30,400 \u0026#34;Stroke 3\u0026#34;\u0026#39; \\  stroke_table.jpg è¯·æ³¨æ„ï¼Œä»ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œè®¾ç½® -strokewidth ä¸º \u0026ldquo;0\u0026rdquo; ä¸è®¾ç½® -stroke é¢œè‰²ä¸º \u0026ldquo;none\u0026rdquo;ï¼ˆé»˜è®¤å€¼ï¼‰æ˜¯ä¸åŒçš„ã€‚å‰è€…ä¼šç”»å‡ºä¸€ä¸ªéå¸¸éå¸¸ç»†çš„ç¬”è§¦è½®å»“ï¼Œè€Œåè€…åˆ™ä¼šæœ‰æ•ˆåœ°å…³é—­å®ƒã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œç¬”è§¦ä»ç„¶ä¼šè¢«ç»˜åˆ¶ã€‚\nç„¶è€Œä½ ä¹Ÿåº”è¯¥æ³¨æ„åˆ°ï¼Œå³ä½¿ -strokewidth ä¸º \u0026ldquo;0\u0026rdquo;ï¼Œå›¾åƒçš„è½®å»“ä¹Ÿä¼šæ¯”æ™®é€šçš„ filled å›¾åƒï¼ˆä½¿ç”¨ -stroke é¢œè‰²ä¸º \u0026ldquo;none\u0026rdquo;ï¼‰æ‰©å¤§éå¸¸å°ã€‚\næœ€åï¼Œä½¿ç”¨ä»»ä½•å°äº \u0026ldquo;1.0\u0026rdquo; çš„å®½åº¦éƒ½ä¸èƒ½æ­£å¸¸å·¥ä½œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ åº”è¯¥è°¨æ…è¡Œäº‹ã€‚\nä½†æ˜¯è¯·è®°ä½ï¼Œ -strokewidth ä¹Ÿæ˜¯ä¸€ä¸ªæµ®ç‚¹è®¾ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ\u0026ldquo;0.5\u0026rdquo; çš„ç¬”ç”»å®½åº¦ä¹Ÿæ˜¯æœ‰æ•ˆçš„ã€‚ç„¶è€Œï¼Œé€šå¸¸åªæœ‰å½“æ‚¨è¯•å›¾åœ¨å…³é—­é˜²é”åŒ–åŠŸèƒ½çš„æƒ…å†µä¸‹ç»˜åˆ¶è–„çš„ä½å›¾åœ†æ—¶ï¼Œè¿™æ‰æ˜¯é‡è¦çš„ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨è¶…å¤§ç¬”è§¦å®½åº¦çš„ä¾‹å­ã€‚\nconvert -size 320x100 xc:lightblue -font Candice -pointsize 72 -fill white \\  -stroke black -strokewidth 15 -draw \u0026#34;text 25,65 \u0026#39;Anthony\u0026#39;\u0026#34; \\  stroke_thick.jpg è¯·æ³¨æ„ï¼Œ -strokewidth å¯ä»¥å‘å†…å’Œå‘å¤–æ‰©å±•çº¿æ¡ã€‚ä¸‹é¢æ˜¯åŒæ ·çš„ä¾‹å­ï¼Œä½†æ˜¯é‡æ–°ç»˜åˆ¶äº†å­—ä½“ï¼Œæ²¡æœ‰ç¬”ç”»è½®å»“ï¼Œå»æ‰äº†å¾ˆç²—çš„ç¬”ç”»çš„å†…ä¾§éƒ¨åˆ†ã€‚\nconvert -size 320x100 xc:lightblue -font Candice -pointsize 72 -fill white \\  -stroke black -strokewidth 15 -draw \u0026#34;text 25,65 \u0026#39;Anthony\u0026#39;\u0026#34; \\  -stroke none -draw \u0026#34;text 25,65 \u0026#39;Anthony\u0026#39;\u0026#34; \\  stroke_outline.jpg æ›´å¤šä½¿ç”¨æè¾¹çš„ä¾‹å­è¯·çœ‹å¤åˆå­—ä½“æ•ˆæœã€‚è¯·ç‰¹åˆ«çœ‹ä¸€ä¸‹\u0026rdquo;æ°”çƒæ•ˆæœ\u0026quot;ã€‚\nç»˜åˆ¶ï¼ˆæè¾¹ï¼‰çº¿æ¡ IMä¸­çš„é»˜è®¤ç”»çº¿æœ‰ä¸€äº›å¥‡æ€ªçš„è¡Œä¸ºï¼Œå€¼å¾—äº†è§£ã€‚ä¸‹é¢å°±ä¸ºå¤§å®¶ä»‹ç»ä¸€ä¸‹é»˜è®¤ç”»çº¿\u0026hellip;\nconvert -size 100x40 xc:lightblue \\  -draw \u0026#34;line 5,35 95,5\u0026#34; \\  line_default.jpg ä½ å¯ä»¥ç”¨ -fill é€‰é¡¹è®¾ç½®çº¿æ¡çš„é¢œè‰²ã€‚\nconvert -size 100x40 xc:lightblue \\  -fill white -draw \u0026#34;line 5,35 95,5\u0026#34; \\  line.jpg æ­¤å¤–ï¼Œä½ è¿˜å¯ä»¥é€šè¿‡è®¾ç½® [-stroke](https://imagemagick.org/Usage/option_link.cgi?stroke) é¢œè‰²ï¼Œä½¿çº¿æ¡ç¨å¾®ç²—ä¸€äº›ã€‚\nconvert -size 100x40 xc:lightblue \\  -fill white -stroke black -draw \u0026#34;line 5,35 95,5\u0026#34; \\  line_stroke.jpg ä½†æ˜¯æˆ‘ä»¬ç”¨ -fill é€‰é¡¹æŒ‡å®šçš„ç™½è‰²æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ\nè¿™å°±æ˜¯åœ¨ ImageMagick ä¸­ç»˜åˆ¶çº¿æ¡çš„æ£˜æ‰‹ä¹‹å¤„ã€‚è¯¥ç¨‹åºæ‰€åšçš„å®é™…ä¸Šæ˜¯å°†çº¿æ¡è§†ä¸ºä¸€ä¸ªçº¦1åƒç´ å®½çš„å¡«å……å¯¹è±¡ã€‚è¿™æ˜¯è‡ªç„¶çš„ï¼Œå› ä¸ºé€šå¸¸æƒ…å†µä¸‹ï¼Œå¤šæ¡çº¿é€šå¸¸ç”¨äºæ‰«å‡ºä¸€ä¸ªè¦å¡«å……çš„åŒºåŸŸã€‚\næ‰€ä»¥ï¼Œå°±åƒæˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚ä¸­ä½¿ç”¨å­—ä½“çš„æè¾¹ä¸€æ ·ï¼ŒIM ç”¨å¡«å……è‰²ç»˜åˆ¶çº¿æ¡ï¼ˆæˆ–å¯¹è±¡ï¼‰ï¼Œç„¶åç”¨æè¾¹è‰²åœ¨å…¶å‘¨å›´ç»˜åˆ¶ã€‚ç»“æœå°±æ˜¯ï¼Œç°åœ¨ä¸Šé¢çš„æè¾¹è‰²çº¿æ¡ç¨å¾®ç²—äº†ä¸€ç‚¹ï¼Œå¡«å……è‰²å®Œå…¨éšè—åœ¨ä¸‹é¢ã€‚å¦‚æœä½ æŠŠæè¾¹è‰²åšæˆåŠé€æ˜çš„ï¼Œå°±å¯ä»¥è®©è¿™ä¸ªå¡«å……è‰²å†æ¬¡æ˜¾ç°å‡ºæ¥ã€‚\nç»¼ä¸Šæ‰€è¿°ï¼Œçº¿æ¡ä¼šå‡ºç°åœ¨ -fill é¢œè‰²ä¸‹ç»˜åˆ¶ï¼Œä½†ä¸€æ—¦ -stroke é¢œè‰²è¢«å®šä¹‰ä¸ºé»˜è®¤çš„\u0026quot;æ— \u0026quot;æˆ–\u0026quot;é€æ˜\u0026quot;é¢œè‰²ä»¥å¤–çš„é¢œè‰²ï¼Œè¯¥é€‰é¡¹å°±æ²¡æœ‰ä»»ä½•æ„ä¹‰äº†ã€‚\n é€‰é¡¹ -linewidth å®é™…ä¸Šåªæ˜¯ -strokewidth çš„åˆ«åï¼Œä¸åº”è¯¥è¢«ä½¿ç”¨ã€‚\n ä¾‹å¦‚ï¼Œä½ å¯èƒ½ä¼šè®¤ä¸ºè¿™ä¸ªå‘½ä»¤ä¼šäº§ç”Ÿå¾ˆç²—çš„çº¿æ¡ã€‚ç¡®å®å¦‚æ­¤ï¼Œä½†ç”±äº -stroke çš„é¢œè‰²æ˜¯ä¸å¯è§çš„ï¼Œæ‰€ä»¥ä½ çœ‹ä¸åˆ°å®ƒã€‚ä½ åªèƒ½çœ‹åˆ°çº¿æ¡çš„ä¸€ä¸ªåƒç´ å®½çš„åŒºåŸŸçš„å†…éƒ¨\u0026quot;å¡«å……\u0026rdquo;ã€‚\nconvert -size 100x40 xc:lightblue \\  -fill white -strokewidth 3 -draw \u0026#34;line 5,35 95,5\u0026#34; \\  line_fill_3.jpg  ä»¥ä¸Šçš„ç»“æœå…¶å®æˆ‘è®¤ä¸ºæ˜¯ä¸€ä¸ª BUGï¼Œä»€ä¹ˆéƒ½æ²¡ç”»ï¼Œå› ä¸ºæ²¡æœ‰\u0026rsquo;åŒºåŸŸ\u0026rsquo;å¡«å……ï¼Œä¹Ÿæ²¡æœ‰è®¾ç½®çº¿çš„\u0026rsquo;æè¾¹é¢œè‰²'ã€‚ä»€ä¹ˆéƒ½æ²¡æœ‰ç”»ï¼Œå› ä¸ºæ²¡æœ‰\u0026quot;åŒºåŸŸ \u0026ldquo;éœ€è¦å¡«å……ï¼Œä¹Ÿæ²¡æœ‰è®¾ç½®çº¿çš„\u0026quot;ç¬”è§¦é¢œè‰²\u0026rdquo;ã€‚IM ç›®å‰è¿™æ ·åšçš„åŸå› æ˜¯ä¸ºäº†é¿å…æ–°ç”¨æˆ·çš„æ··æ·†ï¼Œä½†å®é™…ä¸Šè¿™åªä¼šç»™é«˜çº§ç”¨æˆ·å¸¦æ¥é—®é¢˜ã€‚è¯¦è§ã€Šç»˜åˆ¶å¡«å……è¾¹ç•Œã€‹ã€‚\n ä½†å¦‚æœåŒæ—¶å®šä¹‰äº†æè¾¹é¢œè‰²ï¼Œå°±ä¼šå¾—åˆ°è¦æ±‚çš„ç²—çº¿\u0026hellip;\nconvert -size 100x40 xc:lightblue \\  -stroke black -strokewidth 3 -draw \u0026#34;line 5,35 95,5\u0026#34; \\  line_stroke_3.jpg å¦‚æœå°† -strokewidth è®¾ç½®ä¸º1ï¼Œåˆ™ä¸Šé¢çš„ä¸€è¡Œå°†è¢«å®Œå…¨è¦†ç›–ã€‚\nconvert -size 100x40 xc:lightblue \\  -stroke black -strokewidth 1 -draw \u0026#34;line 5,35 95,5\u0026#34; \\  line_stroke_1.jpg å½“ç„¶å½“ä½ æŒæ¡äº†è¿™äº›çŸ¥è¯†åï¼Œä½ å°±å¯ä»¥åˆ©ç”¨è¿™äº›çŸ¥è¯†è¿›è¡Œåˆ›ä½œï¼Œå°±åƒç”»å­—ä½“ä¸€æ ·ã€‚\nconvert -size 100x40 xc:lightblue \\  -stroke black -strokewidth 5 -draw \u0026#34;line 5,35 95,5\u0026#34; \\  -stroke white -strokewidth 2 -draw \u0026#34;line 5,35 95,5\u0026#34; \\  line_multi.jpg åœ¨è¿™é‡Œï¼Œæˆ‘ä½¿ç”¨äº†æœ€è–„çš„ -strokewidth è®¾ç½®ä¸º \u0026ldquo;0\u0026rdquo;ï¼Œå°±åƒæˆ‘å¯¹ä¸Šè¿°å­—ä½“æ‰€åšçš„ä¸€æ ·ã€‚\nconvert -size 100x40 xc:lightblue \\  -fill white -stroke black -strokewidth 0 -draw \u0026#34;line 5,35 95,5\u0026#34; \\  line_stroke_0.jpg è¿™å°±äº§ç”Ÿäº†ä¸€ä¸ªéå¸¸å¥‡æ€ªçš„ç»“æœï¼Œå³ç”±é»‘ç‚¹å’Œç°æ®µç»„æˆçš„ç‚¹çº¿ã€‚è¿™æ˜¯ç¬”è§¦ã€å¡«å……å’ŒèƒŒæ™¯è‰²ä¹‹é—´å¥‡æ€ªçš„\u0026quot;è‰²æ‹é¢‘ç‡\u0026quot;çš„ç»“æœã€‚\nä¸‹é¢æ˜¯çº¿æ¡çš„æ”¾å¤§å›¾\u0026hellip;\nconvert -size 25x10 xc:lightblue \\  -fill white -stroke black -strokewidth 0 -draw \u0026#34;line 2,8 22,1\u0026#34; \\  -scale 400% line_stroke_0_white.jpg  é¢œè‰²èŠ‚æ‹é¢‘ç‡ \u0026ldquo;çš„æ•ˆæœä¸\u0026quot;å£°éŸ³èŠ‚æ‹\u0026quot;çš„æ•ˆæœå¹¶æ— äºŒè‡´ï¼Œå½“ä½ æœ‰ä¸¤æŠŠéå¸¸è½»å¾®çš„ä¸è°ƒçš„å‰ä»–æ—¶ï¼Œä½ ä¼šå¾—åˆ°è¿™æ ·çš„æ•ˆæœã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªé»‘ç‚¹ï¼Œå…¶ä¸­ç¬”è§¦é¢œè‰²å®Œå…¨è¦†ç›–äº†åŸºæœ¬çš„å¡«å……é¢œè‰²ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªç°è‰²çš„ç‚¹ï¼Œå…¶ä¸­ç¬”è§¦é¢œè‰²ä¸å¡«å……å’ŒèƒŒæ™¯é¢œè‰²æ··åˆã€‚ é¢œè‰²æ··åˆæ˜¯åé”¯é½¿è¿‡ç¨‹çš„è‡ªç„¶ç»“æœï¼ŒIMä½¿ç”¨åé”¯é½¿è¿‡ç¨‹æ¥å°è¯•æ”¹å–„çº¿æ¡å’Œå…¶ä»–ç»˜åˆ¶å¯¹è±¡çš„å¤–è§‚ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è§IM ä¸­çš„æŠ—é”¯é½¿è®¨è®ºå’Œç¤ºä¾‹é¡µé¢ã€‚\n éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§æ•ˆæœåªå‡ºç°åœ¨å€¾æ–œçš„çº¿æ¡ä¸Šï¼Œè€Œä¸æ˜¯çº¯æ°´å¹³æˆ–å‚ç›´çš„çº¿æ¡ï¼Œå› ä¸ºåœ¨è¿™äº›çº¿æ¡ä¸Šï¼Œåˆ«åæ²¡æœ‰å½±å“ï¼Œå› æ­¤ä¹Ÿå°±æ²¡æœ‰\u0026quot;è‰²æ‹é¢‘ç‡\u0026quot;çš„æ•ˆæœã€‚\nconvert -size 100x40 xc:lightblue \\  -fill white -stroke black -strokewidth 0 -draw \u0026#34;line 5,20 95,20\u0026#34; \\  line_stroke_horz.jpg åœ¨è¿™é‡Œï¼Œæˆ‘åœ¨æ”¾å¤§çš„è§†å›¾ä¸Šä½¿ç”¨äº†ä¸åŒçš„åº•å±‚å¡«å……é¢œè‰²ï¼Œæ‰€ä»¥ä½ å¯ä»¥çœ‹åˆ°é¢œè‰²å¦‚ä½•æ”¹å˜ç»“æœçš„èŠ‚æ‹ã€‚\nconvert -size 25x10 xc:lightblue \\  -fill none -stroke black -strokewidth 0 -draw \u0026#34;line 2,8 22,1\u0026#34; \\  -scale 400% line_stroke_0_none.jpg convert -size 25x10 xc:lightblue \\  -fill red -stroke black -strokewidth 0 -draw \u0026#34;line 2,8 22,1\u0026#34; \\  -scale 400% line_stroke_0_red.jpg convert -size 25x10 xc:lightblue \\  -fill black -stroke black -strokewidth 0 -draw \u0026#34;line 2,8 22,1\u0026#34; \\  -scale 400% line_stroke_0_black.jpg è®©æˆ‘ä»¬æŠŠå®ƒå’Œæ—  stroke ç›¸æ¯”\u0026hellip;\nconvert -size 25x10 xc:lightblue \\  -fill black -stroke none -draw \u0026#34;line 2,8 22,1\u0026#34; \\  -scale 400% line_stroke_-_black.jpg æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œå½“ç»˜åˆ¶éå¸¸ç»†çš„çº¿æ¡æ—¶ï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ç›¸åŒçš„å¡«å……å’Œæè¾¹é¢œè‰²ï¼Œæˆ–è€…å°†å…¶ä¸­ä¸€ç§é¢œè‰²è®¾ç½®ä¸ºæ— æ¥å‡å°‘\u0026quot;èŠ‚æ‹\u0026rdquo;ã€‚è™½ç„¶åè€…æ˜¯æœ€å¥½çš„ä¸»æ„ï¼Œä½†å‰è€…å¯èƒ½å¯¹ä½ çš„ç‰¹å®šç¼–ç¨‹éœ€æ±‚æ›´å®ç”¨ã€‚\næ³¨æ„ï¼Œå¡«å……çº¿çš„ç²—ç»†æ˜¯ \u0026ldquo;0\u0026rdquo;ã€‚ä½†æè¾¹çº¿å¯ä»¥æœ‰æ›´å¤§çš„åšåº¦ã€‚å®ƒä¹Ÿæ˜¯ä¸€ä¸ªæµ®ç‚¹å€¼! 2.5åƒç´ å®½çš„çº¿æ¡æ˜¯å®Œå…¨æœ‰æ•ˆçš„ã€‚\n è¿™äº›ç»“æœä¸ä»…æ˜¯ç”±äºç¬”ç”»å®½åº¦ä¸º0çš„bugï¼Œå¯¼è‡´é¢œè‰²è·³åŠ¨ï¼Œè€Œä¸”åœ¨æ²¡æœ‰å®é™…éœ€è¦å¡«å……çš„åŒºåŸŸæ—¶ï¼Œ\u0026ldquo;å¡«å……è‰²\u0026quot;è¢«ç”»å‡ºäº†é¢å¤–çš„1.0ç›´å¾„åšåº¦ã€‚è¿™æˆ‘ä¹Ÿè®¤ä¸ºæ˜¯ä¸€ä¸ªbugã€‚è¯·çœ‹ç»˜åˆ¶å¡«å……è¾¹ç•Œã€‚\n ç»˜åˆ¶å¡«å……è¾¹ç•Œ å…³äºå„ç§ç»˜åˆ¶åŸè¯­ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–è¦ç‚¹éœ€è¦æ‚¨æ³¨æ„ã€‚\nç¬”ç”»å®½åº¦å¯¹äºå¤§äº 1.0 çš„æµ®ç‚¹å€¼å·¥ä½œå¾—å¾ˆå¥½ï¼Œä½†å¯¹äºå°äº 1.0 çš„å€¼ä¼¼ä¹ä¼šå´©æºƒã€‚è¿™æ˜¯ç”±äºä½¿ç”¨çš„å®ç°ç®—æ³•é€ æˆçš„ï¼Œè€Œä¸ä»…ä»…æ˜¯å› ä¸ºå®ƒæ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºå®ƒåœ¨è¾ƒå¤§åšåº¦çš„çº¿æ¡ä¸Šå·¥ä½œå¾—å¾ˆå¥½ã€‚\nåŸºæœ¬ä¸Šï¼Œå¦‚æœä½ ä½¿ç”¨çš„ç¬”ç”»å®½åº¦ä¸ºé›¶ï¼Œä½ å¯ä»¥æœŸå¾…æ²¡æœ‰ç¬”ç”»é¢œè‰²ä¼šè¢«æ·»åŠ ã€‚ç›¸åï¼Œä½ ä¼šå¾—åˆ°ä¸€ç§èŠ‚æ‹æ¨¡å¼ï¼Œå½“çº¿æ¡ç©¿è¿‡åƒç´ çš„å®é™…\u0026quot;ä¸­å¿ƒ\u0026quot;æ—¶ï¼Œç¬”è§¦é¢œè‰²å°±ä¼šè¾¾åˆ°å…¨éƒ¨å¼ºåº¦ã€‚\nçœŸæ­£åº”è¯¥å‘ç”Ÿçš„æ˜¯ï¼Œæ·»åŠ åˆ°åƒç´ ä¸Šçš„é¢œè‰²æ•°é‡åº”è¯¥åæ˜ å‡ºè¢«ç»˜åˆ¶çš„çº¿æ¡çš„é¢ç§¯ï¼Œè€Œä¸æ˜¯åƒç´ ä¸è¯¥çº¿æ¡çš„è·ç¦»ã€‚å› æ­¤ï¼Œé›¶å®½åº¦çš„çº¿æ¡ä¸åº”è¯¥ç»™å›¾åƒæ·»åŠ ä»»ä½•é¢œè‰²ï¼Œè€Œåšåº¦å°äº1.0çš„çº¿æ¡åº”è¯¥åªæ·»åŠ è¾ƒå°‘çš„é¢œè‰²ã€‚\nè¯·çœ‹ä¸Šé¢çš„ä¾‹å­ Draw Lines, with StrokeWidth and Strokeã€‚\nå¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå¡«å……é¢œè‰²æ²¡æœ‰åº”ç”¨åˆ°æ­£åœ¨ç»˜åˆ¶çš„å½¢çŠ¶ï¼ˆå¤šè¾¹å½¢ï¼‰çš„è¾¹ç¼˜ï¼Œè€Œæ˜¯åº”ç”¨åˆ°æ›´è¿œçš„åŠåƒç´ å¤„ã€‚è¿™åŒ…æ‹¬æ²¡æœ‰åº”ç”¨\u0026quot;æè¾¹\u0026quot;çš„æƒ…å†µï¼Œè€Œè¾¹ç¼˜åº”è¯¥æ˜¯ç²¾ç¡®çš„ã€‚å®ƒä¹ŸåŒ…æ‹¬ç”»ä¸€æ¡\u0026quot;çº¿\u0026rdquo;ï¼Œå®ƒçš„å¡«å……åšåº¦å®é™…ä¸Šæ˜¯\u0026quot;é›¶\u0026rdquo;ã€‚\nåŸºæœ¬ä¸Šï¼Œå¦‚æœä½ ç”»äº†ä¸€æ¡çº¿ï¼Œæ²¡æœ‰å¯ç”¨æè¾¹ï¼Œä»æŠ€æœ¯ä¸Šè®²ï¼Œä½ åº”è¯¥çœ‹åˆ°ï¼Œæ²¡æœ‰çº¿ï¼Œå› ä¸ºå®ƒæ²¡æœ‰\u0026quot;å¡«å……\u0026quot;åšåº¦ã€‚ç›¸åï¼Œçº¿æ¡çš„ç»˜åˆ¶è‡³å°‘åŒ…æ‹¬1ä¸ªåƒç´ å®½çš„\u0026quot;å¡«å……\u0026quot;é¢œè‰²ã€‚è¿™æ˜¯å‡ºäºå†å²åŸå› ï¼Œä¸€èˆ¬æ¥è¯´å¯ä»¥é¿å…æ–°ç”¨æˆ·å¯¹IMçš„æ··æ·†ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™å¯¹é«˜çº§ç”¨æˆ·æ¥è¯´æ˜¯ä¸æ­£ç¡®çš„ã€‚\nè¿™æ„å‘³ç€ï¼Œå¦‚æœæ‚¨åªä½¿ç”¨å¡«å……è‰²ç»˜åˆ¶ä¸¤ä¸ªå¤šè¾¹å½¢ï¼Œå¹¶å…±äº«ä¸€ä¸ªè¾¹ç¼˜ï¼Œè¯¥è¾¹ç¼˜å°†é‡å 1ä¸ªåƒç´ ï¼Œå› ä¸ºæ¯ä¸ªå¤šè¾¹å½¢çš„æ‰€æœ‰è¾¹ç¼˜éƒ½æ¯”å®ƒå¤§åŠåƒç´ ã€‚æ¢å¥è¯è¯´ï¼Œå¤šè¾¹å½¢å’Œå…¶ä»–å½¢çŠ¶å¹¶ä¸é€‚åˆåœ¨ä¸€èµ·ï¼Œè€Œæ˜¯é‡å çš„ã€‚\nä¾‹å¦‚ï¼Œåœ¨è¿™é‡Œæˆ‘è¯•ç€ä½¿ç”¨ draw æŠŠä¸€å¼ å›¾ç‰‡åˆ†æˆä¸¤åŠï¼ˆåœ¨ç™½è‰²ä¸Šç»˜åˆ¶é»‘è‰²ï¼‰ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ç”»äº†ä¸¤ä¸ªå¤šè¾¹å½¢ï¼Œå…±äº«ä¸€ä¸ªè¾¹ç¼˜ï¼Œå®Œå…¨æ²¡æœ‰é‡å ã€‚ç”±æ­¤äº§ç”Ÿçš„\u0026quot;å¾®å°\u0026quot;å›¾åƒï¼Œå·²è¢«æ”¾å¤§æ˜¾ç¤ºã€‚\nconvert -size 10x10 xc: -draw \u0026#39;polygon 2,-1 7,10 10,10 10,-1\u0026#39; bound_left.gif convert -size 10x10 xc: -draw \u0026#39;polygon 2,-1 7,10 -1,10 -1,-1\u0026#39; bound_right.gif convert bound_left.gif bound_right.gif -compose Plus -composite bound_add.gif ä¸¤ä¸ªé»‘è‰²çš„éƒ¨åˆ†(è¿™æ˜¯å®é™…ç»˜åˆ¶çš„)å®é™…ä¸Šæ˜¯ç›¸äº’é‡å çš„! æ¢å¥è¯è¯´ï¼Œå°½ç®¡æˆ‘ä»¬è¯•å›¾ä½¿ç”¨ç»˜åˆ¶çš„å¤šè¾¹å½¢åˆ†åˆ«ç»˜åˆ¶è¿™ä¸¤ä¸ªåŒºåŸŸï¼Œä½†å¡«å……çš„åŒºåŸŸæ¯”è¦æ±‚çš„ç•¥å¤§ã€‚\næˆ‘è¿˜å°†ä¸¤å¼ å›¾ç‰‡åŠ ï¼ˆåŠ åˆæˆï¼‰åœ¨ä¸€èµ·ï¼Œè¿™æ ·ä½ å°±å¯ä»¥å®é™…çœ‹åˆ°ç»˜åˆ¶çš„é»‘è‰²åŒºåŸŸçš„é‡å ã€‚å¦‚æœä¸¤ä¸ªå¤šè¾¹å½¢æ˜¯å®Œç¾å¥‘åˆçš„ï¼Œé‚£ä¹ˆ \u0026ldquo;æ·»åŠ  \u0026ldquo;çš„å›¾ç”»å°†æ˜¯çº¯ç™½è‰²çš„ã€‚\nå®é™…çš„é‡å é‡ç›¸å½“äºé»˜è®¤çš„ -strokewidth 1.0 è®¾ç½®ã€‚å› æ­¤ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸ªé¢å¤–çš„åŒºåŸŸä¼šè¢«ä¸€ä¸ªæ­£å¸¸çš„ç¬”ç”»å®½åº¦æ‰€è¦†ç›–ã€‚ç„¶è€Œå®ƒå¯èƒ½ä¼šé€ æˆä¸€äº›å®é™…é—®é¢˜ã€‚\næ—ç™½: å¯¹äºä¸€ä¸ªå®Œæ•´çš„è¿æ¥æµ‹è¯•ï¼Œä½ ä¼šåœ¨é»‘è‰²èƒŒæ™¯ä¸Šç”Ÿæˆ50%çš„ç°è‰²åŒºåŸŸï¼Œç„¶åæŠŠå®ƒä»¬åŠ åœ¨ä¸€èµ·ã€‚è¿™æ ·ä½ å°±å¯ä»¥çœ‹åˆ°è¿™äº›åŒºåŸŸæ˜¯å¦ä¸ä»… \u0026ldquo;é‡å \u0026rdquo;ï¼ˆå¦‚ä¸Šå›¾æ‰€ç¤ºï¼‰ï¼Œè€Œä¸”è¿˜å¯ä»¥æµ‹è¯•å½“ä½ æŠŠè¿™äº›åŒºåŸŸåŠ åœ¨ä¸€èµ·æ—¶ï¼Œå®ƒä»¬æ˜¯å¦ \u0026ldquo;é‡å ä¸è¶³\u0026rdquo;ï¼ˆåœ¨å¡«å……çš„åŒºåŸŸä¹‹é—´ç•™ä¸‹ä¸€ä¸ªé—´éš™ï¼‰ã€‚æ‰€å¾—åˆ°çš„å›¾åƒåº”è¯¥æ˜¯ä¸€ä¸ªå®Œç¾å¹³æ»‘çš„50%ç°è‰²ï¼Œæ²¿è¿æ¥å¤„æ²¡æœ‰é¢œè‰²å˜åŒ–ã€‚é€æ˜åº¦æ£€æŸ¥ä¼šæ¶‰åŠåˆ°ï¼Œåœ¨ä¸€ä¸ªå®Œå…¨é€æ˜çš„èƒŒæ™¯ä¸Šåº”è¯¥ä½¿ç”¨50%é€æ˜ï¼Œ50%ç°è‰²çš„é¢œè‰²ã€‚\nè¦æŸ¥çœ‹ä¸€ä¸ªå®Œç¾çš„å‰ªåˆ‡å’Œé‡æ–°æ·»åŠ çš„ä¾‹å­ï¼ŒåŸºäºä¸€ä¸ªå•ä¸€çš„è’™ç‰ˆå›¾åƒï¼Œè¯·å‚é˜…ç»„æˆæ–¹æ³•çš„ä¾‹å­ï¼Œç»„æˆ DstOutã€‚\næœªæ¥BUGä¿®å¤ï¼šå¡«å……çš„åŒºåŸŸåº”è¯¥æ˜¯ç²¾ç¡®çš„ï¼Œä½†ä¸ºäº†åœ¨ç»˜åˆ¶å½¢çŠ¶æ—¶è¿›è¡Œè¡¥å¿ï¼Œé»˜è®¤çš„ \u0026ldquo;æè¾¹é¢œè‰² \u0026ldquo;åº”è¯¥è®¾ç½®ä¸ºå¡«å……é¢œè‰²ï¼ˆé™¤éå®ƒæœ¬èº«è¢«ç‰¹åˆ«è®¾ç½®ï¼‰ã€‚\nMVG - é­”æ³•çŸ¢é‡å›¾å½¢ ä¸Šé¢æ˜¾ç¤ºçš„åŸè¯­æ„æˆäº†æ‰€æœ‰ -draw æ“ä½œçš„åŸºç¡€ã€‚å®ƒä»¬å…±åŒæ„æˆäº† ImageMagick ä¸­ç‰¹æ®Šå†…éƒ¨è¯­è¨€çš„èµ·ç‚¹ï¼Œç§°ä¸º Magick Vector Graphics è¯­è¨€ã€‚å…³äºè¿™ç§è¯­è¨€çš„æ›´å¤šç»†èŠ‚ï¼Œè¯·å‚è§IMç½‘ç«™ä¸Šçš„ MVG åŸè¯­å’Œè¯­æ³•æ‘˜è¦ã€‚\nè¿™ç§ \u0026ldquo;MVG\u0026rdquo; è¯­è¨€çš„è®¾è®¡ç›®æ ‡æ˜¯è®© ImageMagick å¤„ç†æ›´å¤æ‚çš„ SVGï¼ˆå¯ç¼©æ”¾çŸ¢é‡å›¾å½¢ï¼‰è¯­è¨€ã€‚å®ƒé€šè¿‡å°è¯•å°†ç»™å®š SVG æ ¼å¼çš„å›¾åƒè½¬æ¢ä¸ºæ›´ç®€å•çš„å†…éƒ¨ MVG æ ¼å¼æ¥å®ç°ã€‚æ›´å¤šç»†èŠ‚è¯·çœ‹ä¸‹é¢çš„ SVG å¤„ç†ã€‚\nå› æ­¤ï¼Œä½ ä¸Šé¢çœ‹åˆ°çš„åªæ˜¯ -draw æ“ä½œç¬¦çš„ä¸€å°éƒ¨åˆ†åŠŸèƒ½ã€‚å¦‚æœä½ æƒ³ç»˜åˆ¶å¤æ‚çš„å¯¹è±¡ï¼Œæˆ‘å»ºè®®ä½ ä½¿ç”¨SVGç¼–è¾‘å™¨ï¼ˆå¦‚ \u0026ldquo;Sodipodi\u0026rdquo;ï¼‰ä¸ºå¯¹è±¡åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„SVGæ ¼å¼å›¾åƒã€‚å‚è§ä¸‹é¢çš„éIMçŸ¢é‡å›¾å½¢ç¨‹åºï¼‰ã€‚\nä¸ SVG ä¸åŒï¼ŒMVG æ²¡æœ‰ä»»ä½•å½¢å¼çš„\u0026quot;å®¹å™¨\u0026quot;æˆ–å›¾åƒå‘½ä»¤é›†ã€‚åœ¨è½¬æ¢è¿‡ç¨‹ä¸­ï¼Œè¿™äº›å‘½ä»¤éƒ½è¢«åˆ é™¤ï¼Œä»¥äº§ç”Ÿä¸€ä¸ªç®€åŒ–çš„ MVG ç»˜å›¾å‘½ä»¤åºåˆ—ã€‚ç›¸åï¼Œå®ƒä½¿ç”¨å›¾å½¢ä¸Šä¸‹æ–‡çš„æ¦‚å¿µæ¥ä¿å­˜å’Œæ¢å¤å„ç§ç»˜å›¾è®¾ç½®ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬ç°åœ¨è¦çœ‹çš„ã€‚\nå‘½ä»¤è¡Œè®¾ç½®ä¸ MVG è®¾ç½® é¦–å…ˆï¼Œæ‚¨é€šè¿‡å‘½ä»¤è¡Œé€‰é¡¹è®¾ç½®çš„å‡ ä¹æ‰€æœ‰è®¾ç½®ï¼Œç»˜åˆ¶åŸè¯­ä½¿ç”¨çš„è®¾ç½®åœ¨ MVG ç»˜åˆ¶å‘½ä»¤ä¸­éƒ½æœ‰ç›´æ¥å¯¹åº”çš„å†…å®¹ã€‚\né€šè¿‡å‘½ä»¤è¡Œé€‰é¡¹ï¼ˆå¦‚ -strokewidthï¼‰æˆ–ä½¿ç”¨ MVG ç»˜å›¾å­—ç¬¦ä¸²ï¼ˆå¦‚ strok-widthï¼‰ä¸­çš„è®¾ç½®ï¼Œä¸¤è€…ä¹‹é—´çš„ä¸»è¦åŒºåˆ«åœ¨äº MVG è®¾ç½®åªåœ¨ MVG å‘½ä»¤å­—ç¬¦ä¸²çš„æŒç»­æ—¶é—´å†…æœ‰æ•ˆã€‚\nä¸€èˆ¬ç»˜å›¾è®¾ç½®çš„æ€»ç»“:\n __cmd_option__ __draw_MVG__ __Argument__ -fill fill color/tile for inside shapes -tile fill image tile, replaces fill color -stroke stroke line color/tile around the shapes -strokewidth stroke-width pixel width +antialias stroke-antialias 0/1 aliasing line edges -font font font_name / font_file -family font-family ? -weight ? ? -stretch ? ? -pointsize font-size height in points -kerning - extra inter-character spacing +antialias text-antialias 0/1 aliasing drawing text -box text-undercolor fill color for font bounding box - decorate (None, Underline, LineThrough or Overline) -gravity gravity (None, North, South-East,...) -fuzz - color delta / percentage -bordercolor - color Notes:\n - no such option ? unknown è¿™äº›è®¾ç½®é€šå¸¸å¾ˆå¥½ç†è§£ï¼Œå› ä¸ºå®ƒä»¬ç»å¸¸ä½¿ç”¨ï¼Œä¸Šé¢ä¹Ÿæœ‰æ¼”ç¤ºã€‚\n å­—ä½“ã€æ‹‰ä¼¸ã€æ ·å¼å’Œé‡é‡ç”¨äºä» ImageMagick å­—ä½“åˆ—è¡¨ä¸­è¯†åˆ«å­—ä½“ã€‚ç„¶è€Œï¼Œå¤§å¤šæ•°äººåªæ˜¯é€‰æ‹©ä¸€ä¸ªç‰¹å®šçš„å­—ä½“å’Œå¤§å°ç‚¹æ¥ä»£æ›¿ä½¿ç”¨ã€‚å› æ­¤ï¼Œå®ƒä»¬åœ¨IMä¸­å¾ˆå°‘ä½¿ç”¨ã€‚ æ­£å¦‚æ‚¨æ‰€çœ‹åˆ°çš„ï¼Œ\u0026ldquo;color fill\u0026rdquo; åŸè¯­çš„ç‰¹æ®Šè®¾ç½®åœ¨ MVG ä¸­å¹¶æ²¡æœ‰ç›´æ¥å¯¹åº”çš„è®¾ç½®ã€‚è¿™å°±æ˜¯ -bordercolor å’Œ -fuzz å› å­è®¾ç½®ã€‚åœ¨ä½¿ç”¨ -draw æ“ä½œç¬¦ä¹‹å‰ï¼Œå¿…é¡»ä»å‘½ä»¤è¡ŒæŒ‡å®šè¿™äº›è®¾ç½®ã€‚\n æœ‰äº› MVG è®¾ç½®ä½œä¸ºå…¨å±€å‘½ä»¤è¡Œè®¾ç½®å¯èƒ½æ›´æœ‰ç”¨ï¼Œæ¯”å¦‚å­—ä½“ç»˜åˆ¶çš„ decorate è®¾ç½®ã€‚\nè­¦å‘Šï¼š [-gravity](https://imagemagick.org/Usage/option_link.cgi?gravity) ä¸æ˜¯ SVG è§„èŒƒçš„ä¸€éƒ¨åˆ†ã€‚åœ¨ MVG ä¸­ï¼Œå®ƒåªç”¨äºæ–‡æœ¬å’Œå›¾åƒçš„æ”¾ç½®ä»¥åŠå¯¹é½ã€‚ç›®å‰æ²¡æœ‰ä¸é»˜è®¤çš„\u0026quot;å¼•åŠ›\u0026quot;æ•ˆæœåˆ†å¼€çš„è°ƒæ•´è®¾ç½®ã€‚ç„¶è€Œï¼Œç”±äºè°ƒæ•´æ˜¯ SVG æ–‡æœ¬å¤„ç†çš„ä¸€éƒ¨åˆ†ï¼Œè¿™å¯èƒ½ä¼šåœ¨æœªæ¥çš„æŸä¸ªæ—¶å€™æ”¹å˜ã€‚\nç°åœ¨ï¼Œå…¨å±€å‘½ä»¤è¡Œè®¾ç½®ï¼ˆåœ¨ MVG ç»˜åˆ¶å­—ç¬¦ä¸²ä¹‹å¤–ï¼‰ç”¨äºåˆå§‹åŒ–ä½ æ‰€åº”ç”¨çš„æ¯ä¸ª -draw æ“ä½œçš„è®¾ç½®ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ å¯ä»¥è®¾ç½®ä¸€ä¸ª -fill é¢œè‰²ï¼Œç„¶åä½ å¯ä»¥ç”¨å®ƒæ¥ç»˜åˆ¶è¯¥é¢œè‰²çš„åœ†ã€‚\nconvert -size 100x60 xc:skyblue -fill red \\  -draw \u0026#34;circle 50,30 40,10\u0026#34; draw_circle_global.gif ä½ å¯ä»¥åœ¨ MVG å‚æ•° -draw ä¸­æœ¬åœ°è¦†ç›–å…¨å±€è®¾ç½®\u0026hellip;\nconvert -size 100x60 xc:skyblue -fill red \\  -draw \u0026#34;fill green circle 50,30 40,10\u0026#34; draw_circle_override.gif ç„¶è€Œï¼Œåœ¨å•ä¸ª -draw MVG å‚æ•°ä¸­è®¾ç½®çš„è®¾ç½®åªåœ¨ -draw æ“ä½œæœŸé—´å­˜åœ¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ -draw ä¸­çš„è®¾ç½®åªé™äºè¯¥æ¬¡ç»˜åˆ¶ï¼Œè€Œä¸ä¼šå¸¦å…¥ä»¥åå•ç‹¬çš„ -draw å‚æ•°ä¸­ã€‚\nconvert -size 100x60 xc:skyblue -fill red -draw \u0026#39;fill green\u0026#39; \\  -draw \u0026#34;circle 50,30 40,10\u0026#34; draw_circle_local.gif å¦‚æœä½ æ‰“ç®—è¿›è¡Œå¤§é‡çš„æ“ä½œï¼Œé‚£ä¹ˆåœ¨å•ä¸ª MVG å­—ç¬¦ä¸²ä¸­è¿›è¡Œè¿™äº›æ“ä½œå¯èƒ½ä¼šæ¯”å¤šä¸ª -draw æ“ä½œæ›´å¥½ã€‚\nconvert -size 100x60 xc:skyblue \\  -draw \u0026#34;fill green circle 41,39 44,57 fill blue circle 59,39 56,57 fill red circle 50,21 50,3 \u0026#34; draw_circle_multi.gif MVG ç‰¹å®šè®¾ç½® å…¶ä»–æ§åˆ¶çº¿æ¡å’Œå¯¹è±¡ç»˜åˆ¶æ–¹å¼çš„ MVG è®¾ç½®ï¼Œå³ä½¿åœ¨ä½¿ç”¨åŸè¯­æ“ä½œæ—¶ä¹Ÿéœ€è¦äº†è§£ã€‚è¿™äº›è®¾ç½®åŒ…æ‹¬\u0026hellip;\n __draw_MVG__ __Description/Argument__ fill-opacity fill transparency, from 0.0 to 1.0 clip-rule fill style for crossed lines (evenodd, nonzero) stroke-opacity line transparency, number from 0.0 to 1.0 stroke-dasharray list of 'on' and 'off' lengths for lines stroke-dash stroke-linecap End of line look: butt round square stroke-linejoin Lines joins: butt miter round square stroke-miterlimit Angle when 'miter' joins become 'bevel' (or 'butt') è®°ä½ï¼Œæ‰€æœ‰ MVG è®¾ç½®å’Œç»˜å›¾æ“ä½œç¬¦çš„å®Œæ•´åˆ—è¡¨å¯ä»¥åœ¨ IM ç½‘ç«™çš„ MVG åŸè¯­å’Œè¯­æ³•æ‘˜è¦ä¸­çœ‹åˆ°ã€‚\nè®©æˆ‘ä»¬çœ‹çœ‹ä¸€äº›ç®€å•è®¾ç½®çš„æ•ˆæœ\u0026hellip;\u0026hellip;\n# Stroke Opacity convert -size 100x60 xc:skyblue -fill none -stroke black \\  -draw \u0026#34; path \u0026#39;M 10,10 L 90,10\u0026#39;\u0026#34; \\  -draw \u0026#34;stroke-opacity 0.8 path \u0026#39;M 10,20 L 90,20\u0026#39;\u0026#34; \\  -draw \u0026#34;stroke-opacity 0.6 path \u0026#39;M 10,30 L 90,30\u0026#39;\u0026#34; \\  -draw \u0026#34;stroke-opacity 0.4 path \u0026#39;M 10,40 L 90,40\u0026#39;\u0026#34; \\  -draw \u0026#34;stroke-opacity 0.2 path \u0026#39;M 10,50 L 90,50\u0026#39;\u0026#34; \\  set_stroke_opacity.gif # Fill Opacity convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34; rectangle 5,10 15,50 \u0026#34; \\  -draw \u0026#34;fill-opacity 0.8 rectangle 20,10 30,50 \u0026#34; \\  -draw \u0026#34;fill-opacity 0.6 rectangle 35,10 45,50 \u0026#34; \\  -draw \u0026#34;fill-opacity 0.4 rectangle 50,10 60,50 \u0026#34; \\  -draw \u0026#34;fill-opacity 0.2 rectangle 65,10 75,50 \u0026#34; \\  -draw \u0026#34;fill-opacity 0 rectangle 80,10 90,50 \u0026#34; \\  set_fill_opacity.gif # Plain and Dashed Lines convert -size 100x60 xc:skyblue -fill none -stroke black \\  -draw \u0026#34; path \u0026#39;M 10,10 L 90,10\u0026#39;\u0026#34; \\  -draw \u0026#34;stroke-dasharray 5 3 path \u0026#39;M 10,20 L 90,20\u0026#39;\u0026#34; \\  -draw \u0026#34;stroke-dasharray 5 5 path \u0026#39;M 10,30 L 90,30\u0026#39;\u0026#34; \\  -draw \u0026#34;stroke-dasharray 10 3 3 3 path \u0026#39;M 10,40 L 90,40\u0026#39;\u0026#34; \\  -draw \u0026#34;stroke-dasharray 1 6 path \u0026#39;M 10,50 L 90,50\u0026#39;\u0026#34; \\  set_lines.gif convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34; path \u0026#39;M 10,10 L 90,10\u0026#39;\u0026#34; \\  -draw \u0026#34;stroke-dasharray 5 3 path \u0026#39;M 10,20 L 90,20\u0026#39;\u0026#34; \\  -draw \u0026#34;stroke-dasharray 5 5 path \u0026#39;M 10,30 L 90,30\u0026#39;\u0026#34; \\  -draw \u0026#34;stroke-dasharray 10 3 3 3 path \u0026#39;M 10,40 L 90,40\u0026#39;\u0026#34; \\  -draw \u0026#34;stroke-dasharray 1 6 path \u0026#39;M 10,50 L 90,50\u0026#39;\u0026#34; \\  set_lines_fill.gif # Note: Technically the second image should be the same as the first # as the \u0026#39;filled\u0026#39; lines contain no area. This I regard as a BUG. # Stroke Ends and Joins convert -size 100x60 xc:skyblue -fill white -stroke black -strokewidth 8 \\  -draw \u0026#34; path \u0026#39;M 20,20 L 20,70\u0026#39;\u0026#34; \\  -draw \u0026#34;stroke-linecap butt path \u0026#39;M 40,20 L 40,70\u0026#39;\u0026#34; \\  -draw \u0026#34;stroke-linecap round path \u0026#39;M 60,20 L 60,70\u0026#39;\u0026#34; \\  -draw \u0026#34;stroke-linecap square path \u0026#39;M 80,20 L 80,70\u0026#39;\u0026#34; \\  set_endcaps.gif convert -size 100x60 xc:skyblue -fill white -stroke black -strokewidth 5 \\  -draw \u0026#34; path \u0026#39;M 5,70 L 20,20 35,70\u0026#39;\u0026#34; \\  -draw \u0026#34;stroke-linejoin miter path \u0026#39;M 35,70 L 50,20 65,70\u0026#39;\u0026#34; \\  -draw \u0026#34;stroke-linejoin bevel path \u0026#39;M 55,70 L 70,20 85,70\u0026#39;\u0026#34; \\  -draw \u0026#34;stroke-linejoin round path \u0026#39;M 75,70 L 90,20 105,70\u0026#39;\u0026#34; \\  set_linejoin.gif convert -size 100x60 xc:skyblue -fill white -stroke black -strokewidth 5 \\  -draw \u0026#34; path \u0026#39;M 5,70 L 20,20 35,70\u0026#39;\u0026#34; \\  -draw \u0026#34;stroke-miterlimit 7 path \u0026#39;M 35,70 L 50,20 65,70\u0026#39;\u0026#34; \\  -draw \u0026#34;stroke-miterlimit 6 path \u0026#39;M 65,70 L 80,20 95,70\u0026#39;\u0026#34; \\  set_miterlimit.gif stroke-miterlimit çš„è®¾ç½®æ˜¯ç›¸å½“éš¾ä»¥æ¼”ç¤ºçš„ã€‚è¿™ä¸ªå±æ€§å®šä¹‰äº†å°† miter è¿æ¥å˜ä¸º bevel è¿æ¥çš„è§’åº¦ã€‚åŸºæœ¬ä¸Šå¯¹äºéå¸¸å°–é”çš„è§’åº¦ï¼Œä¸€ä¸ªæ–œé¢å¯ä»¥ä»ä¸¤æ¡çº¿çš„å®é™…æ¥åˆå¤„å»¶ä¼¸å¾ˆé•¿çš„è·ç¦»ã€‚è¿™å°±ä¸ºè¿™ä¸ªé”è§’è®¾ç½®äº†ä¸€ä¸ªæœ€å¤§é™åº¦ï¼Œå½“å®ƒå˜å¾—å¤ªé•¿æ—¶ï¼Œå°±ä¼šä½¿è§’ç‚¹å˜é’ã€‚ä½†è¯·æ³¨æ„ï¼Œå®ƒä»£è¡¨çš„æ˜¯æŸç§è§’åº¦çš„ä¸‰è§’å€¼ï¼Œè€Œä¸æ˜¯é•¿åº¦æˆ–è·ç¦»ã€‚è¯¥å€¼å¿…é¡»å¤§äº1.0ã€‚\nä¸Šé¢æ˜¾ç¤ºäº†å¯¹äºæˆ‘æ‰€æ˜¾ç¤ºçš„è¿æ¥è§’åº¦ï¼Œæ–œè§’ä¼šçªç„¶è½¬æ¢æˆä¸€ä¸ªä»‹äº6åˆ°7ä¹‹é—´çš„æ–œè§’ã€‚\nä¾‹å¦‚ï¼Œ1.414 çš„ troke-miterlimit ä¼šå°†å°äº90åº¦çš„ä»»ä½•è§’åº¦çš„ \u0026ldquo;miter\u0026rdquo; è½¬æ¢ä¸º bevel ã€‚4.0çš„ å€¼ï¼ˆé»˜è®¤å€¼ï¼‰å°†å°äºçº¦29åº¦çš„è§’åº¦è½¬æ¢ä¸ºè¿æ¥ã€‚è€Œ10.0çš„å€¼å¯ä»¥å°†å°äºçº¦11.5åº¦çš„è§’åº¦è½¬æ¢ä¸ºæ–œé¢ã€‚\nSVG sè·¯å¾„ç»˜åˆ¶ SVG è·¯å¾„æ˜¯ SVG çš„åŸºæœ¬ç»˜å›¾åŸè¯­ã€‚å®ƒç”¨äºç»˜åˆ¶çº¿å‹ã€åœ†ã€æ›²çº¿ã€å¼§çº¿ç­‰ã€‚SVG è·¯å¾„çš„å®Œæ•´è§„èŒƒå¯ä»¥åœ¨ SVG è·¯å¾„è§„èŒƒæ–‡æ¡£ä¸­æ‰¾åˆ°ã€‚\nç„¶è€Œè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå®¹æ˜“é˜…è¯»çš„æ–‡æ¡£ï¼Œå› ä¸ºå®ƒç¡®å®æ˜¯ä¸ºç¨‹åºå‘˜è€Œä¸æ˜¯ç”¨æˆ·å‡†å¤‡çš„ï¼Œæ‰€ä»¥æˆ‘å°†ç®€åŒ–å’Œæ€»ç»“è·¯å¾„è§„èŒƒ\u0026hellip;\n å­—æ¯æ˜¯å‘½ä»¤ï¼Œè€Œæ‰€æœ‰çš„æ•°å­—ï¼ˆæµ®ç‚¹ï¼‰éƒ½æ˜¯å‚æ•° é€—å·æˆ–ç©ºæ ¼å¯ä»¥ä½œä¸ºå‚æ•°åˆ†éš”ç¬¦ï¼Œå¦åˆ™å®Œå…¨å¿½ç•¥ æ¯ä¸ªè·¯å¾„ç»„ä»¶çš„æœ€åä¸¤ä¸ªå‚æ•° (x,y) å°†æˆä¸ºè¯¥è·¯å¾„ç»„ä»¶çš„ç»ˆç‚¹(æˆ–\u0026quot;ç»“\u0026rdquo;) å¤§å†™å­—æ¯æ˜¯æŒ‡æœ€ç»ˆç‚¹çš„ç»å¯¹åæ ‡ å°å†™å­—æ¯æ˜¯ç›¸å¯¹äºå‰ä¸€ä¸ªç»„ä»¶çš„ç»ˆç‚¹è€Œè¨€çš„ ä¾‹å¦‚ \u0026ldquo;M 1,2 L 3,4 L 2,4\u0026rdquo; å’Œ \u0026ldquo;M 1,2 L 4,6 L 6,2\u0026rdquo; æ˜¯ä¸€æ ·çš„ã€‚ å³åœ¨1,2ä¸ŠåŠ äº†3,4ï¼Œç”»çº¿åˆ°4,6ã€‚ ç„¶ååœ¨1,2ä¸ŠåŠ 2,4ï¼Œç”»å‡ºä¸€æ¡çº¿åˆ°æœ€åçš„åæ ‡6,2ã€‚ æ¯ä¸ªå…ƒç´ çš„å‚æ•°å¯ä»¥é‡å¤ï¼Œä¸éœ€è¦é‡æ–°å‘å¸ƒç›¸åŒçš„è·¯å¾„å­—æ¯ï¼Œå¯ä»¥å¤šåŠ æ•°å­—å‚æ•°ç»„ã€‚ä¸è¿‡å¯¹äºæ›²çº¿ï¼Œä¸ºäº†æ–¹ä¾¿é˜…è¯»ï¼Œæˆ‘å»ºè®®ä½ è¿˜æ˜¯åŠ ä¸Šå‡½æ•°å­—æ¯ã€‚ é‡å¤çš„å‚æ•° \u0026ldquo;M\u0026rdquo; æˆ– \u0026ldquo;m\u0026rdquo; åˆ†åˆ«ä½œä¸º \u0026ldquo;L\u0026rdquo; æˆ– \u0026ldquo;l\u0026rdquo; å¤„ç†ã€‚ ä¾‹å¦‚ï¼š\u0026rdquo; M 1,2 3,4 5,6 \u0026quot; å’Œ \u0026quot; M 1,2 L 3,4 L 5,6 \u0026quot; æ˜¯ä¸€æ ·çš„ã€‚ è€Œï¼š\u0026ldquo;m 1,2 3,4 2,4 \u0026quot; ä¸ \u0026quot; m 1,2 l 3,4 l 2,4 \u0026quot; ç›¸åŒã€‚ å¯¹äºç«‹æ–¹è´å¡å°”ï¼Œæ‰€æœ‰çš„ç‚¹ï¼ˆæ§åˆ¶ç‚¹å’Œç»“ç‚¹ï¼‰éƒ½æ˜¯ç›¸å¯¹äºå‰ä¸€ä¸ªè·¯å¾„ç»„ä»¶çš„ç«¯ç‚¹è€Œè¨€çš„ã€‚  è¯·æ³¨æ„ï¼Œæ‚¨å¯ä»¥ç”¨ç»å¯¹åæ ‡æˆ–ç›¸å¯¹åæ ‡æ¥æŒ‡å®šå¯¹è±¡ã€‚å› æ­¤ï¼Œä½ å¯ä»¥ç”¨ç›¸å¯¹åæ ‡æ¥å®šä¹‰ä¸€ä¸ªå¯¹è±¡ï¼Œåªéœ€æä¾›ä¸€ä¸ªåˆå§‹çš„ç»å¯¹\u0026quot;ç§»åŠ¨\u0026quot;åæ ‡æ¥å®šä½æ•´ä¸ªè·¯å¾„ã€‚\nå¦ä¸€æ–¹é¢ï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çš„\u0026quot;å›¾å½¢å†…å®¹\u0026quot;å‘½ä»¤æ¥ç§»åŠ¨æ•´ä¸ªå›¾å½¢åœ¨\u0026quot;è§†å›¾æ¡†\u0026quot;æˆ–\u0026quot;è½¬æ¢\u0026quot;ä¸­çš„ä½ç½®ï¼ˆè§ä¸‹æ–‡ï¼‰ã€‚å› æ­¤ï¼Œåœ¨ SVG è·¯å¾„ä¸­ä½¿ç”¨ç»å¯¹æˆ–ç›¸å¯¹åæ ‡å¹¶ä¸é‡è¦ã€‚ ç§»åŠ¨ã€çº¿æ¡å’Œè·¯å¾„é—­åˆæ˜¯å­¦ä¹  SVG å¯¹è±¡è·¯å¾„çš„æœ€åˆèµ·ç‚¹ã€‚\n# Open, Completed and Closed Paths (same points) convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;path \u0026#39;M 40,10 L 20,50 90,10 70,40\u0026#39;\u0026#34; path_open.gif convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;path \u0026#39;M 40,10 L 20,50 90,10 70,40 40,10\u0026#39;\u0026#34; path_complete.gif convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;path \u0026#39;M 40,10 20,50 90,10 70,40 Z\u0026#39;\u0026#34; path_closed.gif ä½†æ˜¯è¯·æ³¨æ„ï¼Œ\u0026lsquo;z\u0026rsquo; åªæ˜¯å…³é—­å¾ªç¯ã€‚å®ƒå¹¶æ²¡æœ‰åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„å¯¹è±¡ã€‚å› æ­¤ï¼Œä¸¤ä¸ª\u0026quot;å…³é—­\u0026quot;çš„è·¯å¾„ä»ç„¶è¢«å½’ç±»ä¸ºä¸€ä¸ªå•ä¸€çš„ç»˜åˆ¶å¯¹è±¡ï¼Œæ— è®ºå®ƒä»¬æ˜¯é‡å çš„è¿˜æ˜¯å®Œå…¨æ–­å¼€çš„ã€‚\nè¿™é‡Œæˆ‘ä»¬å±•ç¤ºäº†ä¸¤ä¸ªé—­åˆä½†é‡å çš„å¾ªç¯ï¼Œåœ¨åŒä¸€æ–¹å‘ä¸Šç»˜åˆ¶ã€‚ç”±äºåªä½¿ç”¨äº†ä¸€æ¡è·¯å¾„ï¼Œæ‰€ä»¥å¯¹è±¡æ˜¯ä¸€ä¸ªå•ä¸€çš„å¯¹è±¡ï¼Œfill-rule è®¾ç½®æ§åˆ¶äº†é‡å åŒºåŸŸçš„å¡«å……æ–¹å¼ã€‚\n# Overlapping Paths and Fill Rule convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;fill-rule evenodd \\ path \u0026#39;M 40,10 20,20 70,50 Z M 20,40 70,40 90,10 Z\u0026#39; \u0026#34; path_evenodd.gif convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;fill-rule nonzero \\ path \u0026#39;M 40,10 20,20 70,50 Z M 20,40 70,40 90,10 Z\u0026#39; \u0026#34; path_nonzero.gif ç”±äºå¯¹è±¡å›´ç»•ä¸­å¿ƒä»¥ç›¸åŒçš„è§’åº¦æ–¹å‘ç»˜åˆ¶ï¼Œä¸¤ä¸ªé—­åˆçš„å¾ªç¯å°†åŒ…å«ä¸€ä¸ªå‘¨æœŸå€¼ä¸º2çš„åŒºåŸŸï¼Œå› æ­¤ evenodd è§„åˆ™ä½¿å¾—è¯¥åŒºåŸŸæœªè¢«å¡«å……ï¼Œè€Œéé›¶çš„ nonzero è§„åˆ™åˆ™å°†å…¶å¡«å……ã€‚ä½†æ˜¯è¯·æ³¨æ„ï¼Œæ‰€æœ‰çš„è·¯å¾„éƒ½æ˜¯å¯è§çš„ï¼Œå› ä¸ºå®ƒä»¬å®é™…ä¸Šæ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚\nç»˜åˆ¶è·¯å¾„çš„æ–¹å‘æ˜¯éå¸¸é‡è¦çš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„è·¯å¾„ç›¸å¯¹äºå¯¹è±¡çš„\u0026rsquo;å†…éƒ¨\u0026rsquo;åº”è¯¥ç»˜åˆ¶åœ¨å®Œå…¨ç›¸åŒçš„æ–¹å‘ä¸Šã€‚\nä¾‹å¦‚è¿™é‡Œæˆ‘å°†ç¬¬äºŒä¸ªå¯¹è±¡ç”»æˆä¸ç¬¬ä¸€ä¸ªå¯¹è±¡ç›¸åçš„æ–¹å‘ã€‚å› æ­¤ï¼Œå½“ä¸¤ä¸ªå¯¹è±¡é‡å æ—¶ï¼Œè¯¥åŒºåŸŸè¢«åœˆå‡º \u0026lsquo;0\u0026rsquo; æ¬¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ— è®ºä½¿ç”¨ä»€ä¹ˆ fill-ruleï¼Œå®ƒéƒ½å°†æ˜¯æœªè¢«å¡«å……çš„ï¼Œå½¢æˆä¸€ä¸ª\u0026rsquo;æ´'ã€‚\n# Overlapping Closed Objects, Second object drawn in reverse convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;fill-rule evenodd \\ path \u0026#39;M 40,10 20,20 70,50 Z M 20,40 90,10 70,40 Z\u0026#39; \u0026#34; path_rvs_evenodd.gif convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;fill-rule nonzero \\ path \u0026#39;M 40,10 20,20 70,50 Z M 20,40 90,10 70,40 Z\u0026#39; \u0026#34; path_rvs_nonzero.gif è¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨ç‰©ä½“ä¸Šäº§ç”Ÿä¸€ä¸ª\u0026quot;æ´\u0026rdquo;ï¼Œé€šè¿‡åè½¬æ–¹å‘ï¼Œä½¿ç‰©ä½“çš„\u0026quot;å†…éƒ¨\u0026quot;ä¿æŒåœ¨è¡Œè¿›æ–¹å‘çš„åŒä¸€ä¾§ã€‚\n# An object with a reversed drawn hole! convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;path \u0026#39;M 30,10 20,55 70,50 80,5 Z M 50,20 60,40 40,30 Z\u0026#39; \u0026#34; path_with_hole.gif æ— è®º fill-rule çš„è®¾ç½®å¦‚ä½•ï¼Œç»“æœéƒ½æ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºè¿™ä¸ªæ´æ˜¯\u0026rsquo;å¶æ•°\u0026rsquo;å’Œ\u0026rsquo;é›¶'ï¼Œæ‰€ä»¥æ˜¯æœªå¡«å……çš„ã€‚\nå½“ç„¶ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„ path å…ƒç´ ï¼Œæ‚¨å°†ç”Ÿæˆä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„å¯¹è±¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œfill-rule ä¸é€‚ç”¨ï¼Œè€Œåªæ˜¯æŒ‰ç…§ç»™å®šçš„é¡ºåºï¼Œå°†å¯¹è±¡ç”»åœ¨å½¼æ­¤çš„ä¸Šæ–¹ã€‚\n# Separate paths are separate objects convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;path \u0026#39;M 40,10 20,20 70,50 Z\u0026#39; path \u0026#39;M 20,40 70,40 90,10 Z\u0026#39; \u0026#34; path_separate.gif æœªæ¥ï¼šåæ ‡å¯¹å‡†è·¯å¾„ \u0026ldquo;H\u0026rdquo; å’Œ \u0026ldquo;V\u0026rdquo;ã€‚\næ¤­åœ†å¼§æ˜¯ SVG è·¯å¾„çš„åœ†åœˆç»˜åˆ¶åŠŸèƒ½\u0026hellip;\nlarge å’Œ sweep å‚æ•°ç‰¹åˆ«é‡è¦ï¼Œå› ä¸ºå®ƒä»¬ç”¨äºå†³å®šä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„å››ç§å¼§çº¿ä¸­çš„å“ªä¸€ç§ã€‚\nlarge å’Œ sweep è¿™ä¸¤ä¸ªæ ‡å¿—å®šä¹‰äº†å››æ¡å¼§çº¿ä¸­å“ªä¸€æ¡å¼§çº¿å°†è¿æ¥è¿™ä¸¤ä¸ªç‚¹ã€‚\n# Elliptical Arcs : A radius_x,y angle large,sweep x,y convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;path \u0026#39;M 30,40 A 30,15 0 0,0 70,20\u0026#39;\u0026#34; path_arc.gif convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;path \u0026#39;M 30,40 A 30,15 0 0,1 70,20\u0026#39;\u0026#34; path_arc2.gif convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;path \u0026#39;M 30,40 A 30,15 0 1,0 70,20\u0026#39;\u0026#34; path_arc3.gif convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;path \u0026#39;M 30,40 A 30,15 0 1,1 70,20\u0026#39;\u0026#34; path_arc4.gif ç¬¬äºŒä¸ªæ ‡å¿— sweep ç®€å•åœ°å†³å®šäº†å¼§çº¿è·¯å¾„çš„æ–¹å‘çš„å“ªä¸€è¾¹åº”è¯¥è¢«ç»˜åˆ¶ã€‚\nlarge æ ‡å¿—æ˜¯ç”¨æ¥é€‰æ‹©è¾ƒé•¿çš„è·¯å¾„ï¼Œç»•ç€æ¤­åœ†çš„ä¸­å¿ƒèµ°ã€‚è¿™æ˜¯è®¾ç½®çš„è§’åº¦çš„å¼§çº¿å°†å¤§äº180åº¦ã€‚å¦‚æœå…³é—­ï¼Œä½ ä¼šå¾—åˆ°è¾ƒå°çš„\u0026rsquo;å¼§'ï¼Œä¸åŒ…å«æ¤­åœ†çš„ä¸­å¿ƒï¼Œå¹¶ä¸”å¼§çº¿çš„è§’åº¦å°äº180åº¦ã€‚\nç”¨ \u0026ldquo;Z\u0026rdquo; æ¥å…³é—­å¼§çº¿ï¼Œåªæ˜¯ç”»å‡ºæœ€åçš„ç›´çº¿æ®µã€‚\nè¦åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„æ¤­åœ†æˆ–åœ†ï¼Œä½ è‡³å°‘éœ€è¦ä¸¤ä¸ª\u0026rsquo;å¼§çº¿\u0026rsquo;æ®µï¼Œä»ç¬¬ä¸€ç‚¹åˆ°ç¬¬äºŒç‚¹ï¼Œç„¶åå›åˆ°ç¬¬ä¸€ç‚¹ã€‚ä¸¤æ¡å¼§çº¿éƒ½åº”è¯¥æœ‰ç›¸åŒçš„ sweep è®¾ç½®ï¼Œæ‰€ä»¥å¼§çº¿å°†åœ¨ä¸åŒçš„è¾¹ä¸Šï¼Œæœ‰ä¸åŒçš„ç§»åŠ¨æ–¹å‘ã€‚å…¶ä¸­ä¸€æ¡å¼§çº¿åº”è¯¥æœ‰ large çš„è®¾ç½®ã€‚\n# Closed and angled elliptical arcs (defined by two edge points) convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;path \u0026#39;M 30,40 A 30,20 20 0,0 70,20 Z \u0026#39;\u0026#34; path_arc5.gif convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;path \u0026#39;M 30,40 A 30,20 20 1,1 70,20 Z \u0026#39;\u0026#34; path_arc6.gif convert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;path \u0026#39;M 30,40 A 30,20 20 0,0 70,20 \\ A 30,20 20 1,0 30,40 Z \u0026#39;\u0026#34; path_arc7.gif è¯·æ³¨æ„ï¼Œå¦‚æœç›´çº¿å¤ªé•¿ï¼Œåœ¨ç»™å®šçš„è§’åº¦ä¸‹æ— æ³•é€‚åº”ç»™å®šçš„æ¤­åœ†å¤§å°ï¼Œæ¤­åœ†çš„å¤§å°å°†è¢«æ”¾å¤§ï¼Œä»¥é€‚åº”ä»¥æ¤­åœ†ä¸ºä¸­å¿ƒçš„ç›´çº¿ï¼Œè¿™æ„å‘³ç€é€šè¿‡ä½¿ç”¨å°æ•°å­—ä½œä¸ºè½´åŠå¾„ï¼Œä½ å¯ä»¥åªæŒ‡å®šè½´é•¿çš„æ¯”ä¾‹ï¼Œå¹¶ä¿è¯ç›´çº¿è·¯å¾„é€šè¿‡æ¤­åœ†çš„ä¸­å¿ƒç‚¹ã€‚\nè¿™æ„å‘³ç€ï¼Œé€šè¿‡ä½¿ç”¨å°æ•°å­—çš„è½´åŠå¾„ï¼Œä½ å¯ä»¥åªæŒ‡å®šä¸€ä¸ªè½´é•¿çš„æ¯”ä¾‹ï¼Œå¹¶ä¿è¯ç›´çº¿è·¯å¾„ç©¿è¿‡æ¤­åœ†çš„ä¸­å¿ƒç‚¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè·¯å¾„ä»æ¤­åœ†çš„ä¸€ä¾§åˆ°å¦ä¸€ä¾§å½¢æˆä¸€ä¸ªæ¤­åœ†ç›´å¾„ã€‚è¿™å¹¶ä¸æ˜¯æ¤­åœ†çš„ä¸»è½´æˆ–æ¬¡è½´ï¼Œåªæ˜¯ä¸€ä¸ªæ¤­åœ†çš„ç›´å¾„ã€‚\nconvert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;path \u0026#39;M 30,40 A 3,2 45 0,0 70,20\u0026#39;\u0026#34; path_arc_x.gif å½“ç„¶ï¼Œä½¿ç”¨é•¿åº¦ä¸º \u0026ldquo;1,1\u0026rdquo; çš„ç»“æœæ˜¯ä¸€ä¸ªå®Œç¾çš„åŠåœ†ï¼Œä»ä¸€ä¸ªç‚¹ï¼Œåˆ°ä¸‹ä¸€ä¸ªç‚¹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¤­åœ†è§’ä¸ä¼šæœ‰ä»»ä½•åŒºåˆ«ã€‚\nconvert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;path \u0026#39;M 30,40 A 1,1 0 0,0 70,20\u0026#39;\u0026#34; path_hcircle.gif å¯¹äºä»¥ä¸¤ç‚¹ä¸ºä¸­å¿ƒçš„å…¨åœ†ï¼Œç”¨\u0026hellip;\nconvert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;path \u0026#39;M 30,40 A 1,1 0 0,0 70,20 A 1,1 0 1,0 30,40 Z\u0026#39;\u0026#34; path_circle.gif SVG å¯¹ \u0026ldquo;å¼§çº¿\u0026quot;çš„å®šä¹‰ä¹Ÿå£°æ˜ï¼Œå¦‚æœä¸¤ä¸ªåŠå¾„ä¸­çš„ä»»ä½•ä¸€ä¸ªæ˜¯0ï¼Œé‚£ä¹ˆå°±åº”è¯¥ç”»ä¸€æ¡ç›´çº¿ã€‚å› æ­¤ï¼Œä»»ä½•åŠå¾„ä¸º \u0026ldquo;0,0\u0026rdquo; çš„åœ†å¼§ï¼Œéƒ½åªæ˜¯ä¸€æ¡ç®€å•çš„ç›´çº¿åœ†å¼§\u0026hellip;\nconvert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;path \u0026#39;M 30,40 A 0,0 0 0,0 70,20\u0026#39;\u0026#34; path_arc_line.gif å¦‚æœä½ ä¸ºå¼§çº¿æŒ‡å®šäº†ä¸€ä¸ªéå¸¸å¤§çš„åŠå¾„ï¼Œè€Œæ²¡æœ‰ä¸ºå›ç¨‹è·¯å¾„æŒ‡å®š large sweepï¼Œä½ å¯ä»¥åœ¨ä¸¤ç‚¹ä¹‹é—´åˆ›å»ºè¯¥åŠå¾„çš„é€é•œå½¢çŠ¶ã€‚\nconvert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;path \u0026#39;M 30,40 A 50,50 0 0,0 70,20 A 50,50 0 0,0 30,40 Z\u0026#39;\u0026#34; path_lens.gif è¿™ç§ç±»å‹çš„å¼§çº¿æ˜¯ä¸€ä¸ªå…³é”®ç‰¹å¾ã€‚å®ƒå¯ä»¥è®©ä½ å¾ˆå®¹æ˜“åœ°æŠŠåŸæœ¬æ˜¯ç›´çº¿çš„ä¸œè¥¿å˜æˆä¸€æ¡å°è€Œæ˜æ˜¾çš„æ›²çº¿ã€‚\nä¾‹å¦‚ï¼Œä¸å…¶è¯´æ˜¯ä¸€ä¸ªç®€å•çš„ä¸‰è§’å½¢ï¼Œä¸å¦‚è¯´æ˜¯ä¸€ä¸ª\u0026hellip;\nconvert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;path \u0026#39;M 20,55 L 25,10 L 70,5 L 20,55 Z\u0026#39; \u0026#34; triangle.gif ä½ å¯ä»¥ç”¨ä¸€ä¸ªå¤§åŠå¾„çš„å¼§çº¿ä»£æ›¿æ¯æ¡çº¿ï¼Œè®©å®ƒä»¬åªæ˜¯æœ‰è½»å¾®çš„æ›²çº¿ã€‚\nconvert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;path \u0026#39;M 20,55 A 100,100 0 0,0 25,10 A 100,100 0 0,0 70,5 A 100,100 0 0,0 20,55 Z\u0026#39; \u0026#34; triangle_curved.gif çº¿æ¡çš„ç«¯ç‚¹æ²¡æœ‰å˜åŒ–ï¼Œæ‰€å‘ç”Ÿçš„åªæ˜¯æ¯ä¸ª \u0026ldquo;L\u0026rdquo; è¢«ä¸€ä¸ªå¼§çº¿æ®µä»£æ›¿ã€‚ç„¶è€Œå¼§çº¿çš„å¤§å°åº”è¯¥ä¸çº¿çš„é•¿åº¦æˆæ­£æ¯”ã€‚ç”±äºæˆ‘æ²¡æœ‰è¿™æ ·åšï¼Œè¾ƒé•¿çš„å¯¹è§’çº¿æ¯”å…¶ä»–ä¸¤æ¡çº¿æœ‰æ›´æ·±çš„æ›²çº¿ã€‚\nè¯·è®°ä½ï¼Œå½“è°ƒæ•´å¯¹è±¡çš„å¤§å°æˆ–æ¯”ä¾‹æ—¶ï¼Œä½ ä¹Ÿåº”è¯¥å°†åŠå¾„çš„æ¯”ä¾‹ä¸çº¿çš„é•¿åº¦ç›¸åŒï¼Œè¿™æ ·æ›²çº¿çš„å¤§å°å°±ä¼šç›¸åº”åœ°è°ƒæ•´ï¼Œæ‰€ä»¥å¼§çº¿çš„æ¯”ä¾‹ä¹Ÿä¼šæ­£ç¡®ã€‚\nè¯·æ³¨æ„ï¼Œsweep æ ‡å¿—å¯ä»¥æ§åˆ¶æ›²çº¿æ˜¯å‘å¤–å‡¸èµ·è¿˜æ˜¯å‘å†…å‡¸èµ·ï¼Œè¿™å–å†³äºæ¯ä¸ªè·¯å¾„æ®µçš„ç»˜åˆ¶æ–¹å‘(è§ä¸Šæ–‡)ã€‚\nconvert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;path \u0026#39;M 20,55 A 100,100 0 0,0 25,10 A 100,100 0 0,1 70,5 A 100,100 0 0,1 20,55 Z\u0026#39; \u0026#34; triangle_bulge.gif çœ‹èµ·æ¥ \u0026ldquo;é™æ€\u0026quot;çš„ç›´è¾¹ä¸‰è§’å½¢ï¼Œç°åœ¨çœ‹èµ·æ¥æœ‰ç‚¹åƒå……æ»¡é£çš„å¸†ã€‚\nå¦‚æœä½ çœŸçš„æƒ³è®©çº¿æ¡å®Œç¾çš„ç›´ï¼Œè€Œä¸æŠŠå®ƒä»¬è½¬æ¢å›çœŸæ­£çš„çº¿æ®µï¼Œä½ å¯ä»¥é€šè¿‡ä½¿ç”¨å¼§çº¿åŠå¾„ä¸ºé›¶æ¥å…³é—­æ›²çº¿ã€‚\nå› æ­¤ï¼Œå¼§çº¿ä¸ä»…é€‚åˆç”Ÿæˆæ¤­åœ†å’Œåœ†ï¼Œè€Œä¸”å¯¹äºç»˜åˆ¶ç›´çº¿å’Œå¾®æ›²çº¿æ®µä¹Ÿå¾ˆæœ‰ç”¨ã€‚å®ƒæ˜¯ä¸€ç§éå¸¸é€šç”¨çš„é€šç”¨ç‚¹åˆ°ç‚¹çš„ç»˜åˆ¶è·¯å¾„ã€‚\nä½¿ç”¨æ¤­åœ†å¼§æ¥ç”Ÿæˆåˆ†ç¦»çš„æ›²çº¿æ®µçš„ä¸€ä¸ªç®€å•çš„æ›¿ä»£æ–¹æ³•æ˜¯ä½¿ç”¨å››å…ƒè´å¡å°”æ®µæ¥ä»£æ›¿ï¼Œä¸»è¦çš„åŒºåˆ«æ˜¯ä½¿ç”¨ä¸€ä¸ªå•ä¸€çš„æ§åˆ¶ç‚¹ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªåœ†å½¢åŠå¾„æ¥å®šä¹‰å¼§çº¿ã€‚è¿™ä¹Ÿå…è®¸æ‚¨å°†å¼§çº¿åå‘çº¿æ®µçš„ä¸€ç«¯ï¼Œä½†ä»£ä»·æ˜¯éš¾ä»¥ç”Ÿæˆå¯¹ç§°çš„å¼§çº¿ã€‚\nå½“ç„¶ï¼Œæ‚¨ä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨è¿™ä¸¤ç§æ–¹æ³•æ¥è¿›è¡Œ mix-n-matchã€‚\né¥¼å›¾ç¤ºä¾‹ ä¸ºäº†å®Œæˆå¯¹å¼§çº¿çš„ä½¿ç”¨ï¼Œè®©æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼Œä½¿ç”¨ä¸ºå®ƒä»¬ç”Ÿæˆåœ†æ¥”ã€‚å½“ç„¶ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨ä¸€äº›å¤–éƒ¨çš„ä¸‰è§’æ•°å­¦ï¼ˆä½ çš„é«˜ä¸­æ•°å­¦æœ‰å¤šå¥½ï¼Ÿï¼‰æ¥ç¡®å®šæ‰€éœ€çš„æœ€ç»ˆè·¯å¾„ç‚¹ã€‚\nconvert -size 140x130 xc:white -stroke black \\  -fill red -draw \u0026#34;path \u0026#39;M 60,70 L 60,20 A 50,50 0 0,1 68.7,20.8 Z\u0026#39;\u0026#34; \\  -fill green -draw \u0026#34;path \u0026#39;M 60,70 L 68.7,20.8 A 50,50 0 0,1 77.1,23.0 Z\u0026#39;\u0026#34; \\  -fill blue -draw \u0026#34;path \u0026#39;M 68,65 L 85.1,18.0 A 50,50 0 0,1 118,65 Z\u0026#39;\u0026#34; \\  -fill gold -draw \u0026#34;path \u0026#39;M 60,70 L 110,70 A 50,50 0 1,1 60,20 Z\u0026#39;\u0026#34; \\  -fill black -stroke none -pointsize 10 \\  -draw \u0026#34;text 57,19 \u0026#39;10\u0026#39; text 70,20 \u0026#39;10\u0026#39; text 90,19 \u0026#39;70\u0026#39; text 113,78 \u0026#39;270\u0026#39;\u0026#34; \\  piechart.jpg è¯·æ³¨æ„ï¼Œæ‰€æœ‰çš„å¼§çº¿éƒ½æ˜¯ç”»åœ¨ line path çš„å·¦è¾¹ï¼Œå¹¶æœ‰ç›¸åº”çš„æ ‡å¿—ï¼ˆä½¿ç”¨ sweep æ ‡å¿—ï¼‰ã€‚ä½†å¦‚æœå¼§çº¿è¦†ç›–çš„è§’åº¦å¤§äº180åº¦ï¼Œåˆ™éœ€è¦è®¾ç½® large æ ‡å¿—ã€‚è§ä¸Šé¢ä¾‹å­ä¸­æœ€åä¸€ä¸ª gold ç»„ä»¶ã€‚\nè¿˜è¦æ³¨æ„çš„æ˜¯ï¼Œä½ åº”è¯¥å®Œæ•´åœ°ç”»å‡ºæ¯ä¸ªéƒ¨åˆ†ï¼Œå°½ç®¡è¿™æ„å‘³ç€ä½ å¯èƒ½è¦ç”»ä¸¤æ¬¡è¾¹ç•Œçº¿ã€‚å¦‚æœä½ ä¸è¿™æ ·åšï¼Œä½ å¾ˆå¯èƒ½è¦ä¹ˆä¸ä¼šå®Œå…¨ç”¨é¢œè‰²å¡«å……è¯¥éƒ¨åˆ†ï¼Œè¦ä¹ˆå¡«å……é¢œè‰²ä¼šè¦†ç›–ä¹‹å‰ç»˜åˆ¶çš„éƒ¨åˆ†è½®å»“ã€‚\né¿å…é‡å¤ç»˜åˆ¶å¤šæ¡çº¿çš„å”¯ä¸€æ–¹æ³•æ˜¯ç»˜åˆ¶æ‰€æœ‰å¡«å……åŒºåŸŸï¼Œç„¶åé‡å¤è¿™æ ·ç»˜åˆ¶è½®å»“ã€‚å°±æ˜¯è¯´ä½ éœ€è¦æŠŠæ‰€æœ‰çš„ä¸œè¥¿éƒ½ç”»ä¸¤éï¼Œç¡®ä¿ä¸œè¥¿æ­£ç¡®åŒ¹é…ã€‚å› æ­¤ï¼Œå°†è½®å»“åŠ å€å¯èƒ½æ˜¯æœ€ç®€å•çš„è§£å†³æ–¹æ¡ˆã€‚\nç«‹æ–¹è´å¡å°”æ›²çº¿å¯ä»¥ä½¿ç”¨ c å‡½æ•°å®šä¹‰ä¸¤ä¸ªæ§åˆ¶ç‚¹ï¼Œä»¥åŠæœ€ç»ˆçš„ç»ˆç‚¹ã€‚å¯¹äºä½¿ç”¨æœ€åä¸€ä¸ªæ§åˆ¶ç‚¹çš„é•œåƒçš„æŒç»­ç«‹æ–¹è´å¡å°”æ›²çº¿ï¼ˆå¯¹äºè¿ç»­æ›²çº¿ï¼‰ï¼Œä½ å¯ä»¥ä½¿ç”¨ s å‡½æ•°ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ã€‚ç”±äºè¿™ä¸ªå‡½æ•°çš„å¤æ‚æ€§ï¼Œæˆ‘é¢„å…ˆå‡†å¤‡äº†ä¸€ä¸ªç”»å¸ƒï¼Œæ˜¾ç¤ºæ§åˆ¶ç‚¹çš„ä½ç½®ï¼Œä»¥åŠæœ€åä¸€ä¸ªæ§åˆ¶ç‚¹çš„ assumed mirrorã€‚\n# Cubic Bezier: C control_1_x,y control_2_x,y x,y # Smooth \u0026#34; : S control_2_x,y x,y convert path_cubic_canvas.gif -fill white -stroke black \\  -draw \u0026#34;path \u0026#39;M 10,30 C 10,4 50,4 50,30 S 90,55 90,30\u0026#39; \u0026#34; \\  path_cubic.gif è¿æ¥æ§åˆ¶ç‚¹å’Œè¯¥è·¯å¾„æ®µè·¯å¾„ä¸Šçš„æœ€ç»ˆç‚¹çš„çº¿ï¼ˆæ§åˆ¶çº¿ï¼‰åŸºæœ¬ä¸Šå®šä¹‰äº†é€šè¿‡è·¯å¾„ä¸Šè¯¥ç‚¹çš„æ›²çº¿æ–¹å‘ã€‚é•¿çš„æ§åˆ¶çº¿ä¼šåœ¨è¯¥ç‚¹äº§ç”Ÿä¸€æ¡æ›´å¹³æ»‘çš„æ›²çº¿ï¼Œè€ŒçŸ­çš„æ§åˆ¶çº¿åˆ™ä¼šåœ¨è¯¥ç‚¹äº§ç”Ÿä¸€æ¡æ›´æ¸…æ™°çš„æ›²çº¿ã€‚å¦‚æœæ§åˆ¶ç‚¹ä¸æ›²çº¿çš„ç‚¹ç›¸å»åˆï¼ˆæ§åˆ¶çº¿é•¿åº¦ä¸ºé›¶ï¼‰ï¼Œåˆ™æ›²çº¿åœ¨è¯¥ç‚¹æœ‰ä¸€ä¸ªå°–é”çš„ä¸è¿ç»­æ€§ï¼Œå°±åƒåªç”¨ç›´çº¿æ®µä¸€æ ·ã€‚\nä½œä¸ºä¸€ä¸ªæ›´å®é™…çš„ä¾‹å­ï¼Œä¸‹é¢çš„ä»£ç æ˜¯ä» IM å®ä¾‹ Logo ç”Ÿæˆå™¨è„šæœ¬ä¸­æå–å‡ºæ¥çš„ï¼Œè¯¥è„šæœ¬åˆ›å»ºäº† IM å®ä¾‹ Logo çš„æ›²çº¿æº…å°„åŒºåŸŸã€‚\nè¿™ä¸ªä¾‹å­çš„æ£˜æ‰‹ä¹‹å¤„åœ¨äºï¼Œæˆ‘å°†æˆ‘ä½¿ç”¨çš„ç«‹æ–¹è´å¡å°”è·¯å¾„å­—ç¬¦ä¸²ï¼Œè½¬æ¢ä¸ºå¦ä¸€ä¸ªè·¯å¾„ï¼Œæ˜¾ç¤ºç”¨äºç”Ÿæˆè´å¡å°”æ›²çº¿çš„æ§åˆ¶çº¿ã€‚è¿™è®©æˆ‘å¯ä»¥çœ‹åˆ°æ›²çº¿çš„æ§åˆ¶çº¿è§’åº¦å’Œé•¿åº¦ï¼Œä½¿å¾—è°ƒæ•´ç»“æœå˜å¾—æ›´åŠ å®¹æ˜“ã€‚åªéœ€è¦è°ƒæ•´ä¸€ç»„ç‚¹å°±å¯ä»¥åŒæ—¶æ˜¾ç¤ºæ›²çº¿å’Œæ§åˆ¶çº¿ï¼Œå°†é”™è¯¯æ§åˆ¶åœ¨æœ€å°èŒƒå›´å†…ã€‚\ncurve=\u0026#34;M 12,27 C 7,37 18,50 18,60 S 0,80 10,94 S 40,74 50,78 S 60,99 76,95 S 72,70 75,65 S 95,55 95,42 S 69,37 66,32 S 67,2 53,7 S 43,17 35,22 S 17,17 12,27 Z\u0026#34; c_ctrls=`echo $curve | \\  sed \u0026#39;1s/\\([0-9]\\) *\\([0-9]\\)/\\1 M \\2/; s/S/M/g; s/C/ /;\u0026#39; -` convert -size 100x100 xc:white \\  -draw \u0026#34;stroke None fill Green path \u0026#39;$curve\u0026#39;\u0026#34; \\  -draw \u0026#34;stroke Red fill None path \u0026#39;$c_ctrls\u0026#39;\u0026#34; \\  curvy_splash.gif å¦‚æœä½ ä»”ç»†è§‚å¯Ÿå›¾åƒï¼Œä½ ä¼šå‘ç°æ›²çº¿çš„èµ·ç‚¹å’Œç»ˆç‚¹æœ‰ä¸¤æ¡æ–¹å‘ç›¸åçš„æ§åˆ¶çº¿ã€‚å¯¹äºä¸€ä¸ªå°é—­çš„è¿ç»­è·¯å¾„æ¥è¯´ï¼Œå¼€å§‹å’Œç»“æŸçš„æ§åˆ¶çº¿åº”è¯¥åœ¨ç›¸åŒçš„è§’åº¦ï¼ˆåªæ˜¯åœ¨é•œé¢æ–¹å‘ï¼‰ï¼Œå½“ç„¶ä¹Ÿåº”è¯¥æ˜¯ç›¸åŒçš„é•¿åº¦ã€‚è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå› ä¸ºå¾ˆå®¹æ˜“å¼„é”™ã€‚\næ²¿ç€æ›²çº¿çš„æ‰€æœ‰å…¶ä»–ç‚¹åªæœ‰ä¸€ä¸ªæ§åˆ¶ç‚¹/çº¿ï¼Œå®ƒä¸æ›²çº¿çš„ç»˜åˆ¶æ–¹å‘ç›¸åã€‚è¯¥çº¿æ®µè¶Šé•¿ï¼Œæ›²çº¿åœ¨è¯¥æ§åˆ¶ç‚¹å¤„çš„ sharp è¶Šä½ï¼Œé•¿åº¦ä¸ºé›¶åˆ™äº§ç”Ÿä¸€ä¸ª pointã€‚\ns å‡½æ•°åœ¨å†…éƒ¨æ ¹æ®å‰ä¸€æ®µçš„æ•°æ®ç”Ÿæˆä¸‹ä¸€æ®µçš„é•œåƒæ§åˆ¶ç‚¹/çº¿ï¼Œä»è€Œäº§ç”Ÿæ›²çº¿çš„å¹³æ»‘å»¶ç»­ã€‚\nå…³äºè¿™ä¸ªè·¯å¾„å‡½æ•°çš„æ›´å¤šä¾‹å­ï¼Œè¯·çœ‹ã€ŠSVGï¼šç«‹æ–¹è´å¡å°”æ›²çº¿å‘½ä»¤ã€‹ã€‚\næ‰‹åŠ¨ç”Ÿæˆè´å¡å°”æ›²çº¿æ˜¯æ¯”è¾ƒç›´æ¥çš„ï¼Œä¸éœ€è¦ä»»ä½•èŠ±å“¨çš„ GUI å·¥å…·ã€‚\n é¦–å…ˆå®šä¹‰æ‰€æœ‰ä½ æƒ³è®©æ›²çº¿ç»è¿‡çš„åæ ‡ç‚¹ï¼Œåœ¨åˆ—è¡¨çš„æœ€åé‡å¤èµ·å§‹åæ ‡ã€‚ ç°åœ¨å°†è¿™ä¸ªåˆ—è¡¨æ‰©å¤§ï¼Œå°†æ‰€æœ‰çš„ x,y åæ ‡ç‚¹åŠ å€æˆå¯¹ï¼Œå¹¶åœ¨æ¯å¯¹åæ ‡ç‚¹å‰æ·»åŠ ä¸€ä¸ª sï¼ˆSmooth Cubicï¼‰å‡½æ•°ã€‚æ¯å¯¹ä¸­çš„ç¬¬ä¸€ä¸ªæ•°å­—æ˜¯æ§åˆ¶ç‚¹ï¼Œè¿æ¥åˆ°ç¬¬äºŒä¸ªæ•°å­—ä»£è¡¨æ›²çº¿ä¸Šçš„ç‚¹ã€‚ç„¶è€Œç¬¬ä¸€ä¸ªç‚¹å¯¹å´æŠŠè¿™ä¸€ç‚¹åè¿‡æ¥äº†ï¼Œç¬¬ä¸€ä¸ªç‚¹æ˜¯æ›²çº¿çš„èµ·ç‚¹ï¼Œç¬¬äºŒä¸ªç‚¹ä»£è¡¨ç¬¬ä¸€ä¸ªä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªåè½¬çš„æ§åˆ¶ç‚¹ã€‚ å°†ç¬¬ä¸€å¯¹åæ ‡çš„å‡½æ•°å­—æ¯ç”± \u0026lsquo;S\u0026rsquo; æ”¹ä¸º \u0026lsquo;M\u0026rsquo;ï¼Œç„¶ååœ¨è¿™å¯¹åæ ‡ä¹‹é—´åŠ ä¸€ä¸ª \u0026lsquo;C\u0026rsquo;ã€‚æœ€åå°†ç¬¬äºŒå¯¹åæ ‡çš„ \u0026lsquo;S\u0026rsquo; å»æ‰ï¼Œå®Œæˆåˆå§‹çš„ç«‹æ–¹ä½“ï¼ˆ\u0026lsquo;C\u0026rsquo;ï¼‰å‡½æ•°ã€‚ é€šè¿‡æ·»åŠ æœ€åçš„ \u0026lsquo;Z\u0026rsquo; æ¥å®Œæˆè·¯å¾„ï¼Œå…³é—­æ›²çº¿ã€‚ è¯·çœ‹ä¸Šé¢çš„ç¤ºä¾‹åºåˆ—ï¼Œå®ƒåº”è¯¥æ˜¯æ€æ ·çš„ã€‚ æ­¤æ—¶æ‚¨å¯ä»¥æµ‹è¯•ç»˜åˆ¶æ‚¨çš„è·¯å¾„ã€‚ç”±äºæ‰€æœ‰çš„æ§åˆ¶çº¿é•¿åº¦ä¸ºé›¶ï¼Œæ‰€ä»¥è·¯å¾„å°†åªç”±ç›´çº¿æ®µç»„æˆã€‚ ç°åœ¨æ‚¨éœ€è¦åšçš„å°±æ˜¯æ…¢æ…¢åœ°ã€å°å¿ƒåœ°è°ƒæ•´æ§åˆ¶çº¿æ®µçš„ä½ç½®ï¼ˆæ¯ä¸ª \u0026ldquo;S\u0026rdquo; å¯¹çš„ç¬¬ä¸€ä¸ªåæ ‡ï¼‰ï¼Œä»¥å¾—åˆ°æ‚¨æƒ³è¦çš„æœ€ç»ˆæ›²çº¿ã€‚ä¸è¦æŠŠæ§åˆ¶çº¿åšå¾—å¤ªé•¿ï¼Œæˆ–è€…æ–¹å‘ä¸å¯¹ï¼Œå¦åˆ™ä½ ä¼šå¾—åˆ°ä¸€æ¡çœ‹èµ·æ¥éå¸¸æ»‘ç¨½çš„æ›²çº¿ã€‚ ä¸ºäº†å¸®åŠ©æŸ¥çœ‹ä½ çš„å˜åŒ–å’Œå‘ç°é”™è¯¯ï¼Œè¯·ä½¿ç”¨ä¸Šé¢çš„è½¬æ¢ \u0026ldquo;sed\u0026rdquo; å‘½ä»¤æ¥ç»˜åˆ¶è·¯å¾„æ§åˆ¶ç‚¹å’Œæ›²çº¿æ§åˆ¶ç‚¹ä¹‹é—´çš„æ§åˆ¶çº¿ã€‚ä½†æ˜¯è¯·æ³¨æ„ï¼Œé›¶é•¿åº¦çš„æ§åˆ¶çº¿æ˜¯ä¸å¯è§çš„ï¼Œä½†æ˜¯ç”±äºlinä¼šäº§ç”Ÿä¸€ä¸ªå°–é”çš„ç‚¹ï¼Œæ‰€ä»¥ä½ç½®åº”è¯¥å¾ˆæ˜æ˜¾ã€‚ æœ€åï¼Œç¡®ä¿ \u0026ldquo;C\u0026rdquo; ä¹‹åçš„ç¬¬ä¸€æ¡æ§åˆ¶ç‚¹/çº¿ä¸ç»ˆç‚¹æ§åˆ¶ç‚¹/çº¿çš„ä½ç½®å®Œå…¨ç›¸åã€‚  äº¤äº’å¼æ›²çº¿çš„ç”Ÿæˆä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨ä¸€äº›çŸ¢é‡å›¾å½¢ç¼–è¾‘å™¨æ¥å®ç°ã€‚\nä¾‹å¦‚ Luis Guerra æŠ¥å‘Šè¯´ï¼Œ\u0026ldquo;Inkscape\u0026rdquo; ç”Ÿæˆçš„è´å¡å°”æ›²çº¿å¯ä»¥ä½¿ç”¨ \u0026ldquo;Edit -\u0026gt; XML Editor\u0026rdquo; åŠŸèƒ½ï¼Œç„¶åé€‰æ‹©ä½ æƒ³è¦æ§åˆ¶ç‚¹çš„è·¯å¾„æˆ–å½¢çŠ¶ã€‚\n ä½ çŸ¥é“æœ‰ä»€ä¹ˆå…¶ä»–çš„æ–¹æ³•å¯ä»¥ç”¨GUIå·¥å…·æ¥æå–è´å¡å°”æ›²çº¿ï¼ˆåœ¨æ›²çº¿ä¸Šæ¯ä¸ªç‚¹ç»™å‡ºä¸¤ä¸ªæˆ–ä¸€ä¸ªæ§åˆ¶ç‚¹ï¼‰ã€‚æˆ–è€…æ˜¯ä¸€äº›å…¶ä»–çš„æŠ€æœ¯æ¥ç”Ÿæˆè¿™æ ·çš„æ›²çº¿ï¼Ÿè¯·å‘é‚®ä»¶ç»™æˆ‘! æˆ‘å¾ˆä¹æ„å¬åˆ°å®ƒã€‚ä½ å°†ä¼šåƒå…¶ä»–äººä¸€æ ·ï¼Œè¢«è®°å…¥è¯¥æŠ€æœ¯çš„åä¸‹ã€‚\n äºŒæ¬¡æ–¹è´å¡å°”å‡½æ•°æ˜¯ç«‹æ–¹è´å¡å°”å‡½æ•°çš„ç®€åŒ–ï¼Œå½“ä¸¤ä¸ªæ§åˆ¶ç‚¹åˆå¹¶æˆä¸€ä¸ªæ§åˆ¶ç‚¹æ—¶ã€‚åŒæ ·ï¼Œä½ å¯ä»¥ç”¨ \u0026lsquo;Q\u0026rsquo; å‡½æ•°å¼€å§‹æ›²çº¿ï¼Œç„¶åç”¨ \u0026lsquo;T\u0026rsquo; å‡½æ•°ç»§ç»­æ›²çº¿ï¼Œé•œåƒæœ€åä¸€ä¸ªæ§åˆ¶ç‚¹ã€‚\n# Quadratic Bezier: Q control_x,y x,y # Smooth \u0026#34; : T x,y convert path_quad_canvas.gif -fill white -stroke black \\  -draw \u0026#34;path \u0026#39;M 10,30 Q 20,4 50,30 T 90,30\u0026#39; \u0026#34; \\  path_quad.gif ä½†æˆ‘è¦æé†’æ‚¨ï¼Œ\u0026ldquo;T\u0026rdquo; ç»§ç»­å‡½æ•°åªé€‚ç”¨äºè¿æ¥é—´è·ç›¸ç­‰çš„ç‚¹çš„è·¯å¾„ã€‚æˆ‘ä¸æ¨èä½¿ç”¨å®ƒã€‚\näºŒæ¬¡æ–¹æ›²çº¿çš„ä¼˜ç‚¹æ˜¯å¯ä»¥æ›¿ä»£æ¤­åœ†å¼§ï¼Œå› ä¸ºå®ƒä½¿ç”¨çš„æ˜¯å®é™…çš„ä½ç½®ï¼Œè€Œä¸æ˜¯å¼§çº¿çš„åŠå¾„ã€‚å®ƒä¹Ÿå¯ä»¥ä½¿å¼§çº¿åå‘äºä¸€ç«¯è€Œä¸æ˜¯å¦ä¸€ç«¯ï¼Œè¿™åœ¨ä½¿ç”¨æ¤­åœ†å¼§æ—¶å¹¶ä¸å®ç”¨ã€‚\nconvert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;path \u0026#39;M 20,55 Q 30,32 25,10 Q 50,1 70,5 Q 50,45 20,55 Z\u0026#39; \u0026#34; triangle_bulge_2.gif åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¼§çº¿ä¸æ˜¯é‚£ä¹ˆå‡åŒ€ï¼Œä½ å¾—åˆ°çš„ä¸œè¥¿å°±åƒä¸€ä¸ªå€’ç«‹çš„é²¨é±¼é³ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå¸†ã€‚\nè¯·è®°ä½å››è¾¹å½¢å¼§çº¿æ˜¯æŠ›ç‰©çº¿ï¼Œè€Œæ¤­åœ†å¼§çº¿åŸºæœ¬ä¸Šæ˜¯ç”Ÿæˆåœ†å¼§çº¿æ®µã€‚è¿™å¯èƒ½æ˜¯å†³å®šä½ åº”è¯¥ä½¿ç”¨å“ªç§ç±»å‹çš„å¼§çº¿æ®µçš„å…³é”®ã€‚\næœ‰å…³æ­¤è·¯å¾„åŠŸèƒ½çš„æ›´å¤šä¾‹å­ï¼Œè¯·å‚è§ï¼šSVG: Quadratic Bezier Curve Commandsã€‚\nç»˜å›¾è¡¨é¢çš„å˜å½¢ åœ¨è¿™äº›èƒ½åŠ›ä¹‹ä¸Šï¼Œç»˜åˆ¶å¯¹è±¡çš„ç»˜å›¾è¡¨é¢å¯ä»¥ä»¥å„ç§æ–¹å¼å˜å½¢ï¼Œè®©ä½ åšä¸€äº›ä»¤äººæƒŠå¥‡çš„äº‹æƒ…ã€‚\né¦–å…ˆï¼Œä½ å¯ä»¥åº”ç”¨ä¸€äº›é€šç”¨çš„ç»˜å›¾è¡¨é¢ä¿®æ”¹ï¼Œæ¯”å¦‚\u0026hellip; \u0026ldquo;translate\u0026rdquo;ã€\u0026ldquo;rotate\u0026rdquo;ã€\u0026ldquo;scale\u0026rdquo;ã€\u0026ldquo;skewX\u0026rdquo;ã€\u0026ldquo;skewY\u0026rdquo; å’Œ \u0026ldquo;affine\u0026rdquo;ã€‚\nä¾‹å¦‚ï¼Œç»™å®šä¸€ä¸ªçº¿æ¡çš„ pathï¼Œæˆ‘ä»¬å¯ä»¥ translate ç»˜å›¾è¡¨é¢çš„åŸç‚¹æˆ–0,0ç‚¹åˆ°å¦ä¸€ä¸ªä½ç½®ã€‚\nconvert -size 100x60 xc:skyblue \\  -draw \u0026#34;translate 50,30 image over 3,3 0,0 \u0026#39;terminal.gif\u0026#39; fill white stroke black path \u0026#39;M 0,20 -45,20 20,-25 -25,-25\u0026#39; fill none stroke red path \u0026#39;M 0,10 0,-10 M 10,0 -10,0\u0026#39; \u0026#34; transform_translate.gif è¯·æ³¨æ„ï¼Œ\u0026ldquo;0,0\u0026rdquo; æˆ–ç»˜å›¾åŒºåŸŸçš„åŸç‚¹ç°åœ¨ä»¥å›¾åƒä¸ºä¸­å¿ƒï¼Œå°½ç®¡Yè½´åœ¨å›¾åƒçš„é¡¶éƒ¨ä»ç„¶æ˜¯è´Ÿæ•°ï¼Œåœ¨åº•éƒ¨ä»ç„¶æ˜¯æ­£æ•°ã€‚\nrotate æ“ä½œå°†æ—‹è½¬ç»˜å›¾è¡¨é¢ï¼Œæ‰€ä»¥ä»¥ååœ¨è¯¥è¡¨é¢ä¸Šç»˜åˆ¶çš„ä»»ä½•ä¸œè¥¿éƒ½å°†è¢«æ—‹è½¬ç»˜åˆ¶ã€‚å½“ç„¶ï¼Œå®ƒä¼šå›´ç»•è½¬æ¢åçš„åŸç‚¹è¿›è¡Œæ—‹è½¬ï¼Œæ‰€ä»¥æœ€å¥½åŒæ—¶ä½¿ç”¨è¿™ä¸¤ä¸ªå˜æ¢è¿ç®—ç¬¦ã€‚\nconvert -size 100x60 xc:skyblue \\  -draw \u0026#34;translate 50,30 rotate -30 image over 4,4 0,0 \u0026#39;terminal.gif\u0026#39; fill white stroke black path \u0026#39;M 0,20 -45,20 20,-25 -25,-25\u0026#39; fill none stroke red path \u0026#39;M 0,10 0,-10 M 10,0 -10,0\u0026#39; \u0026#34; transform_rotate.gif scale å°†æ”¾å¤§å’Œç¼©å°åŸç‚¹å‘¨å›´çš„ç»˜å›¾é¢ã€‚\nconvert -size 100x60 xc:skyblue \\  -draw \u0026#34;translate 50,30 scale 1.5,1.5 image over 4,4 0,0 \u0026#39;terminal.gif\u0026#39; fill white stroke black path \u0026#39;M 0,20 -45,20 20,-25 -25,-25\u0026#39; fill none stroke red path \u0026#39;M 0,10 0,-10 M 10,0 -10,0\u0026#39; \u0026#34; transform_scale.gif ä¸€ä¸ªå¸¸è§çš„ scale ç”¨æ³•æ˜¯å°†Yè½´ç¿»è½¬ï¼Œä½¿Yçš„æ­£å€¼å‘ä¸Šã€‚å½“ç„¶åŸç‚¹ä¹Ÿåº”è¯¥ç§»åˆ°ä¸­å¿ƒï¼Œæˆ–è€…å·¦ä¸‹è§’ï¼Œä»¥ä¿æŒç§©åºã€‚\nconvert -size 100x60 xc:skyblue \\  -draw \u0026#34;translate 50,30 scale 1,-1 image over 4,4 0,0 \u0026#39;terminal.gif\u0026#39; fill white stroke black path \u0026#39;M 0,20 -45,20 20,-25 -25,-25\u0026#39; fill none stroke red path \u0026#39;M 0,10 0,-10 M 10,0 -10,0\u0026#39; \u0026#34; transform_flip.gif æœ€åï¼Œ\u0026ldquo;skewX\u0026rdquo; å’Œ \u0026ldquo;skewY\u0026rdquo; åœ¨Xå’ŒYæ–¹å‘ä¸Šå¯¹å›¾åƒè¿›è¡Œå‰ªåˆ‡ã€‚ä¾‹å¦‚ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ \u0026ldquo;skewX\u0026rdquo; ç»™å›¾åƒçš„å‚ç›´Yè½´ä¸€ä¸ªå€¾æ–œã€‚\nconvert -size 100x60 xc:skyblue \\  -draw \u0026#34;translate 50,30 skewX 20 image over 4,4 0,0 \u0026#39;terminal.gif\u0026#39; fill white stroke black path \u0026#39;M 0,20 -45,20 20,-25 -25,-25\u0026#39; fill none stroke red path \u0026#39;M 0,10 0,-10 M 10,0 -10,0\u0026#39; \u0026#34; transform_skewY.gif è¿™äº›æ“ä½œç¬¦åœ¨ MVG -draw å­—ç¬¦ä¸²ä¹‹å¤–æœ‰å¯¹åº”çš„æ“ä½œç¬¦ï¼Œä¾›ä¸€èˆ¬ä½¿ç”¨ã€‚ä½†æ˜¯è¿™äº›å‘½ä»¤è¡Œç‰ˆæœ¬æ˜¯è¿ç®—ç¬¦ï¼Œå¹¶ä¸”ç«‹å³åº”ç”¨äºå†…å­˜ä¸­å·²ç»å­˜åœ¨çš„å›¾åƒï¼Œè€Œä¸æ˜¯åº”ç”¨äºå°šæœªç»˜åˆ¶çš„çŸ¢é‡å¯¹è±¡çš„ç»˜åˆ¶è¡¨é¢ã€‚æ›´å¤šç»†èŠ‚è¯·çœ‹æ‰­æ›²å›¾åƒã€‚\nç»˜åˆ¶è¡¨é¢çš„å¹³ç§»å˜å½¢ ä¸Šè¿°æ‰€æœ‰äº”ç§ç”»å¸ƒå˜æ¢éƒ½å¯ä»¥ç»„åˆæˆä¸€ä¸ªé€šç”¨çš„ Affine Matrix Operatorï¼Œå¯ä»¥ä½¿ç”¨ MVG åŸè¯­ \u0026ldquo;affine\u0026rdquo;ï¼Œä¹Ÿå¯ä»¥åœ¨è°ƒç”¨ -draw ä¹‹å‰ä½¿ç”¨ -affine è®¾ç½® Affine å˜æ¢ã€‚\nAffine å˜æ¢ä½¿ç”¨ä¸€ç»„ \u0026ldquo;Matrix Coefficients\u0026rdquo;ï¼Œå®ƒå®šä¹‰äº†å¦‚ä½•å°†ä½ ç»™å‡ºçš„åæ ‡ä¿®æ”¹ä¸ºå®é™…çš„ç»˜å›¾åæ ‡ã€‚\nå…³äºè¿™äº› \u0026ldquo;coefficients\u0026rdquo; å¦‚ä½•å·¥ä½œçš„æ›´å¤šç»†èŠ‚ï¼Œè¯·å‚é˜… Affine Matrix Transformsã€‚\nä¾‹å¦‚\u0026hellip; è¦è®¾ç½®ä¸€ä¸ªç›¸å¯¹äºå¯¹è±¡ç»˜åˆ¶æ—¶çš„ä¸­å¿ƒåŸç‚¹\u0026hellip;\nconvert -size 100x60 xc:skyblue \\  -draw \u0026#34;affine 1,0,0,1,50,30 image over 4,4 0,0 \u0026#39;terminal.gif\u0026#39; fill white stroke black path \u0026#39;M 0,20 -45,20 20,-25 -25,-25\u0026#39; fill none stroke red path \u0026#39;M 0,10 0,-10 M 10,0 -10,0\u0026#39; \u0026#34; affine_null.gif ç¿»è½¬å›¾åƒ\u0026hellip;\nconvert -size 100x60 xc:skyblue \\  -draw \u0026#34;affine 1,0,0,-1,50,30 image over 4,4 0,0 \u0026#39;terminal.gif\u0026#39; fill white stroke black path \u0026#39;M 0,20 -45,20 20,-25 -25,-25\u0026#39; fill none stroke red path \u0026#39;M 0,10 0,-10 M 10,0 -10,0\u0026#39; \u0026#34; affine_flip.gif ç»•åŸç‚¹æ—‹è½¬30åº¦\u0026hellip;\nconvert -size 100x60 xc:skyblue \\  -draw \u0026#34;affine .866,-.5,.5,.866,50,30 image over 4,4 0,0 \u0026#39;terminal.gif\u0026#39; fill white stroke black path \u0026#39;M 0,20 -45,20 20,-25 -25,-25\u0026#39; fill none stroke red path \u0026#39;M 0,10 0,-10 M 10,0 -10,0\u0026#39; \u0026#34; affine_rot.gif å¯¹äºæ›´å¤æ‚çš„ä»¿å°„å˜æ¢ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä¸ºæ­¤ç›®çš„åˆ›å»ºçš„ä»¿å°„è¾…åŠ©è„šæœ¬ã€‚è¿™äº›è„šæœ¬å°†è¯¸å¦‚æ—‹è½¬è§’åº¦å’Œä¸­å¿ƒç‚¹ä¹‹ç±»çš„ä¸œè¥¿è½¬æ¢ä¸º Affine åæ ‡ï¼Œä½ å¯ä»¥ç›´æ¥åœ¨ -draw affine æˆ– -affine è®¾ç½®ä¸­ä½¿ç”¨ã€‚\næ¨/å¼¹ä¸Šä¸‹æ–‡ ä¸€äº› MVG åŸè¯­å®é™…ä¸Šä¾èµ–äºè¿™äº›å˜æ¢çš„ä½¿ç”¨æ‰èƒ½æ­£ç¡®ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œæ¤­åœ†åŸè¯­åªèƒ½ç”¨æ­£äº¤å¯¹é½çš„è½´ç›´æ¥æŒ‡å®šã€‚\nconvert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;ellipse 50,30 30,15 0,360\u0026#34; ellipse_orthogonal.gif ç„¶è€Œï¼Œé€šè¿‡ä½¿ç”¨ç»˜å›¾å˜æ¢ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°ç»™æ¤­åœ†æ·»åŠ ä¸€ä¸ª\u0026quot;æ—‹è½¬è§’\u0026rdquo;ã€‚\nconvert -size 100x60 xc:skyblue -fill white -stroke black \\  -draw \u0026#34;push graphic-context translate 50,30 rotate 30 fill white stroke black ellipse 0,0 30,15 0,360 pop graphic-context\u0026#34; ellipse_rotated.gif è¯·æ³¨æ„ï¼Œæ¤­åœ†çš„ center(æ—‹è½¬ç‚¹)åœ¨åº”ç”¨æ—‹è½¬ä¹‹å‰é¦–å…ˆè¢«è½¬æ¢ã€‚ç„¶åï¼Œellipse åœ¨ \u0026ldquo;0,0\u0026rdquo; å¤„çš„è½¬æ¢ä½ç½®è¢«ç»˜åˆ¶ã€‚\nä¸Šé¢è¿˜æ˜¾ç¤ºäº†ä¸¤ä¸ªæ–°çš„ MVG ç»˜å›¾åŸè¯­ã€‚\u0026lsquo;push graphic-context\u0026rsquo; å’Œ \u0026lsquo;pop graphic-context\u0026rsquo;ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¹¶ä¸æ˜¯ä¸¥æ ¼æ„ä¹‰ä¸Šçš„éœ€è¦ï¼Œä½†åœ¨è¿›è¡Œä¸»è¦çš„ç»˜å›¾è½¬æ¢æ—¶ï¼Œå»ºè®®ä½¿ç”¨è¿™ä¸¤ä¸ªåŸè¯­ã€‚\npush å’Œ pop åŸè¯­çš„ä½œç”¨æ˜¯ä¿å­˜å½“å‰çš„ç»˜å›¾çŠ¶æ€æˆ– \u0026ldquo;graphic-context\u0026rdquo;ï¼Œç„¶åå†æ¬¡æ¢å¤ã€‚åœ¨è¿™ä¸¤ä¸ªåŸè¯­ä¹‹é—´æ›´æ”¹çš„ä»»ä½•ç»˜å›¾è®¾ç½®éƒ½ä¼šè¢«é—å¿˜ã€‚è¿™åŒ…æ‹¬æ›²é¢å˜å½¢ï¼ˆå¦‚ \u0026ldquo;å¹³ç§» \u0026ldquo;å’Œ \u0026ldquo;æ—‹è½¬\u0026rdquo;ï¼‰ã€é¢œè‰²è®¾ç½® fill å’Œ stroke æˆ–ä»»ä½•å…¶ä»–ä¿®æ”¹äº†ç»˜å›¾ state çš„è®¾ç½®ã€‚\nè¿™äº›åŸè¯­ä½¿æ‚¨å¯ä»¥è½»æ¾åœ°ç»˜åˆ¶å…·æœ‰è®¸å¤šå˜æ¢çš„éå¸¸å¤æ‚çš„å¯¹è±¡ï¼Œç„¶åå°†äº‹ç‰©æ¢å¤åˆ°æ›´ \u0026ldquo;æ­£å¸¸\u0026quot;çš„çŠ¶æ€ï¼Œä»¥ä¾¿ä»¥åè¿›è¡Œç»˜åˆ¶æ“ä½œã€‚æ‚¨å¯ä»¥åœ¨ä¸‹é¢çš„ç»˜åˆ¶ç®­å¤´ä¸­çœ‹åˆ°æ›´å®ç”¨çš„æ¼”ç¤ºã€‚\næ¨/å¼¹ç‰¹æ®Šå¯¹è±¡ å»ºè®¾ä¸­ æ›´å¤šä¸“é—¨ç”¨äº MVG å¤„ç† SVG æ ¼å¼çš„è®¾ç½®ã€‚\n font-family font-stretch font-style font-weight encoding 'UTF-8' push defs push gradient 'def_name' linear X1,Y1 X2,Y2 stop-color 'color' where stop-color 'color' where # where is a point between the two pixels given (0 = X1,Y1 1= X2,Y2) gradient-units 'objectBoundingBox|userSpaceOnUse' affine .... pop gradient push gradient 'def_name' radial CX,CY FX,FY R # Here CX,CY is the center of the radial gradient of radius R # the FX,FY is the focal, and is usually the same a CX,CY # unless you are trying to warp the gradient in a specific direction stop-color 'color' where ... pop gradient pop defs push graphic-context fill 'url(#def_name)' ... draw things here ... pop graphic-context ä¾‹å­è§ Florent Monnier çš„å¼€å‘ç½‘ç«™\u0026hellip; http://www.linux-nantes.fr.eu.org/~fmonnier/OCaml/MVG/ã€‚\né˜…è¯» MVG æ–‡ä»¶ æ­£å¦‚ä½ åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­æ‰€çœ‹åˆ°çš„ï¼ŒMVG çš„ -draw å‚æ•°å¯ä»¥å˜å¾—å¾ˆé•¿ã€‚äº‹å®ä¸Šï¼ŒSVG åˆ° MVG çš„è½¬æ¢å¯ä»¥äº§ç”Ÿä¸€äº›éå¸¸é•¿çš„ MVG ç»˜å›¾å‚æ•°ï¼ˆè§ä¸‹æ–‡ï¼‰ã€‚\nç„¶è€Œï¼ŒIM çš„ä¸€èˆ¬å‘½ä»¤è¡Œç•Œé¢å…è®¸æ‚¨é€šè¿‡ä½¿ç”¨ \u0026quot;@filename\u0026quot; å‚æ•°ä»æ–‡ä»¶ä¸­è¯»å–ä»»ä½•å­—ç¬¦ä¸²å‚æ•°ã€‚è¿™å¾ˆæ–¹ä¾¿ï¼Œå› ä¸ºè¿™æ„å‘³ç€ä½ å¯ä»¥ä»ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸­è¯»å–éå¸¸é•¿å’Œå¤æ‚çš„MVGç»˜å›¾å‘½ä»¤ã€‚\nä¾‹å¦‚ï¼Œå¦‚æœæˆ‘å°† MVG æ“ä½œæ”¾å…¥ä¸€ä¸ªåä¸º \u0026ldquo;draw_circles.mvg\u0026rdquo; çš„æ–‡ä»¶ä¸­ï¼Œé‚£ä¹ˆæˆ‘å°±å¯ä»¥åƒè¿™æ ·ç»˜åˆ¶\u0026hellip;\nconvert -size 100x60 xc:skyblue -draw @mvg_circles.mvg mvg_draw.gif ä¸ä»…å¦‚æ­¤ï¼ŒImageMagick è¿˜æ‡‚å¾—ç›´æ¥è¯»å– \u0026ldquo;MVG:\u0026rdquo; å›¾åƒæ–‡ä»¶æ ¼å¼ï¼Œè®©ä½ å¯ä»¥æ›´ç›´æ¥åœ°ç»˜åˆ¶æ­¤ç±»å‘½ä»¤ã€‚ç„¶è€Œï¼Œé™¤é MVGæ–‡ ä»¶å®šä¹‰äº†ä¸€ä¸ªç”»å¸ƒï¼Œå¦åˆ™ä½ å¯èƒ½éœ€è¦æŒ‡å®šåˆå§‹ç”»å¸ƒï¼ˆ -size å’Œ\u0026rdquo;-background\u0026rdquo;ï¼‰æ¥ç»˜åˆ¶ã€‚\nconvert -size 100x60 -background limegreen mvg_circles.mvg mvg_file.gif ä½ å¯ä»¥é€šè¿‡åœ¨ MVG æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ª \u0026ldquo;viewbox\u0026rdquo;ï¼Œå¹¶æ·»åŠ é€‚å½“çš„èƒŒæ™¯è‰²å¡«å……ç»˜åˆ¶ï¼Œå°†åˆå§‹ç”»å¸ƒè®¾ç½®ç§»åŠ¨åˆ° MVG å›¾åƒä¸­ã€‚è¿™æ ·å°±å®Œæˆäº† MVG å›¾åƒæ–‡ä»¶ä½œä¸ºä¸€ä¸ªå®Œæ•´çš„å›¾åƒå®šä¹‰ã€‚\nconvert mvg_circles2.mvg mvg_image.gif  ç›®å‰åªæœ‰ä¸€ç§æ–¹æ³•å¯ä»¥ä» MVG å‚æ•°å­—ç¬¦ä¸²ä¸­è¯»å–å¤–éƒ¨ MVG æ–‡ä»¶ï¼Œé‚£å°±æ˜¯ä½¿ç”¨ \u0026ldquo;å›¾åƒ \u0026ldquo;ç»˜å›¾åŸè¯­ã€‚é—æ†¾çš„æ˜¯ï¼Œè¿™å°† MVG çš„ include è½¬æ¢ä¸ºå…‰æ …å›¾åƒï¼Œç„¶åå†å°†è¯¥å›¾åƒè¦†ç›–åˆ°ç»˜å›¾è¡¨é¢ã€‚ æ¢å¥è¯è¯´ï¼Œç›®å‰è¿˜æ²¡æœ‰MVGçš„ \u0026ldquo;include\u0026quot;åŠŸèƒ½ã€‚ :-(\n å»ºè®¾ä¸­ æ‚¨å¯ä»¥ç”ŸæˆIMçš„ä½çº§ç»˜åˆ¶æ“ä½œï¼Œä½¿ç”¨ `+render æ¥è®°å½•å®ƒä»¬ã€‚\nå½“ä½ å†ç»™ -render è®¾ç½®/æ“ä½œæ—¶ï¼ŒIMå°†ç«‹å³ç»˜åˆ¶è¿™äº›ä¿å­˜çš„æ“ä½œã€‚\nå¥‡æ€ªçš„æ˜¯ï¼Œä»…ä»…è¾“å‡ºåˆ° \u0026ldquo;MVG\u0026rdquo; æ–‡ä»¶ä¼¼ä¹ä¹Ÿèƒ½åšåˆ°è¿™ä¸€ç‚¹\u0026hellip;\u0026hellip;ã€‚\nconvert ... -draw \u0026#39;....\u0026#39; draw_commands.mvg æ³¨æ„ï¼šå¦‚æœä½ åœ¨è¾“å‡º MVG æ ¼å¼æ–‡ä»¶æ—¶ç”»äº†ä¸€æ¡æ›²çº¿ï¼Œæ–‡ä»¶ä¸­ä¼šåˆ—å‡ºä»¥ä¸‹å†…å®¹ã€‚æ›²çº¿æ˜¯ä¸€ç³»åˆ—çš„çŸ­çº¿æ®µï¼Œè€Œä¸æ˜¯åŸå§‹æ›²çº¿ã€‚\nå½“ç„¶æ‚¨ä¹Ÿå¯ä»¥å®Œå…¨ä½¿ç”¨æ›´é€šç”¨çš„ SVG æ ¼å¼ã€‚å‚è§ä¸‹é¢çš„ \u0026ldquo;SVG æ ¼å¼å¤„ç†\u0026quot;ã€‚\nMVG é˜¿å°”æ³•æ„æˆ å»ºè®¾ä¸­ æˆ‘æ²¡æœ‰çœ‹åˆ°ä»»ä½•ä½¿ç”¨ Alpha æ„å›¾çš„æƒ…å†µï¼ˆé™¤äº† painters çš„ç®—æ³•ä¹‹å¤–ï¼‰ã€‚åŸºæœ¬ä¸Šæ˜¯ä¸€ç§ \u0026ldquo;over\u0026rdquo; alpha åˆæˆï¼‰æ¥ç»˜åˆ¶å¯¹è±¡ã€‚\nç„¶è€Œï¼Œè¿™å¹¶ä¸æ˜¯è¯´ä¸èƒ½è¿™æ ·åšã€‚\nå¦‚æœä½ å–œæ¬¢å°†ä½ çš„çŸ©å½¢ã€æ¤­åœ†ã€åœ†å½¢æˆ–å…¶ä»–ç‰©ä½“ç”¨ä¸åŒçš„é˜¿å°”æ³•æˆåˆ†ï¼ˆå¦‚ \u0026ldquo;DstOver\u0026rdquo;ï¼Œè¿™æ˜¯ä¸€ä¸ªç±»ä¼¼äº Under çš„æˆåˆ†ï¼‰ï¼Œç„¶ååœ¨ç©ºç™½çš„é€æ˜ç”»å¸ƒä¸Šç”»å‡ºä½ çš„äººç‰©ï¼ŒåŒæ ·çš„æ„å›¾ï¼Œå¹¶å°†å…¶åˆæˆåˆ°æ‚¨çš„å›¾åƒä¸Šã€‚\nç„¶è€Œï¼Œç”±äº SVG å…è®¸æ‚¨ä½¿ç”¨ alpha åˆæˆæ¥ç»˜åˆ¶æ–‡æœ¬å’Œå…¶ä»–çš„å›¾åƒï¼Œå› æ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ SVG æ¥ç»˜åˆ¶å›¾åƒé¡¹ç›®åˆ°å›¾åƒä¸Šï¼Œæˆ‘æƒ³è¿™å°†æ˜¯ä¸€ä¸ªæœªæ¥çš„è¡¥å……ã€‚\næ•¬è¯·æœŸå¾…\nç»˜åˆ¶ç¬¦å· æœ‰æ—¶ä½ åœ¨å›¾åƒä¸Šæœ‰ä¸€ç»„ç‚¹ï¼Œä½ æƒ³åœ¨é‚£é‡Œç»˜åˆ¶å‚è€ƒç¬¦å·ï¼Œå¦‚åå­—ã€åœ†åœˆç­‰ã€‚é—æ†¾çš„æ˜¯ï¼Œç›®å‰IMè¿˜æ²¡æœ‰å¯ä»¥è½»æ¾ç»˜åˆ¶è¿™ç±»ç¬¦å·çš„å‘½ä»¤ï¼Œä½†åªè¦ç¨åŠ åŠªåŠ›ï¼Œä½ å°±å¯ä»¥ç»˜åˆ¶è¿™ç±»ç¬¦å·ã€‚\nç¬¦å·ç»˜åˆ¶æŠ€å·§ åœ¨ç»™å®šçš„ä½ç½®åˆ—è¡¨ä¸­ç»˜åˆ¶å¤šä¸ªç¬¦å·çš„è¯€çªæ˜¯ä½¿ç”¨ shell è„šæœ¬æˆ–ä»»ä½•ä½ æ­£åœ¨ä½¿ç”¨çš„ API ç”Ÿæˆ MVG ç»˜å›¾å‘½ä»¤ï¼Œä»¥ä¾¿å°†ç»™å®šçš„ç‚¹é›†è½¬åŒ–ä¸ºé€‚å½“çš„ç»˜å›¾å‘½ä»¤é›†ã€‚ ä¾‹å¦‚ï¼Œæˆ‘åœ¨è¿™é‡Œå°†ä¸€æ¡çº¿ä¸Šçš„ç‚¹è½¬æ¢ä¸ºæ¯ä¸€ä¸ªç‚¹çš„\u0026quot;åŠ å·\u0026rdquo;\u0026hellip;\n# Define a string of X and Y coordinates # comma between values, space between coordinates. points=\u0026#34;6.6,7.7 25.0,75.0 42.2,85.4 75.8,94.7 51.5,39.3 92.5,66.6\u0026#34; # convert each point into a draw command for a cross (using \u0026#39;awk\u0026#39;) # the \u0026#39;tr\u0026#39; converts spaces into \u0026#39;newlines\u0026#39; (one point per line). crosses=`echo $points | tr -s \u0026#39; \u0026#39; \u0026#39;\\012\u0026#39; |\\  awk -F, \u0026#39;{ print \u0026#34;line \u0026#34; $1-3 \u0026#34;,\u0026#34; $2 \u0026#34; \u0026#34; $1+3 \u0026#34;,\u0026#34; $2 ; print \u0026#34;line \u0026#34; $1 \u0026#34;,\u0026#34; $2-3 \u0026#34; \u0026#34; $1 \u0026#34;,\u0026#34; $2+3 ; }\u0026#39; -` # draw a red line between the points, and blue crosses on the points. convert -size 100x100 xc:white \\  -draw \u0026#34;fill none stroke red polyline $points\u0026#34; \\  -draw \u0026#34;fill none stroke blue $crosses\u0026#34; \\  points_plus.gif ä¸Šé¢ä½¿ç”¨ \u0026ldquo;tr\u0026rdquo; å°†æ¯ä¸ªç‚¹ï¼ˆä¸¤ä¸ªæ•°å­—ï¼‰åˆ†æˆæ¯æ¡çº¿ä¸Šçš„ä¸€ä¸ªç‚¹ï¼Œç„¶åä½¿ç”¨ \u0026ldquo;awk\u0026rdquo; è¿›è¡Œæ‰€æœ‰æ•°å­¦è®¡ç®—ï¼Œåœ¨ç»™å®šçš„ç‚¹ä¸Šç»˜åˆ¶\u0026quot;åŠ å·\u0026rdquo;ã€‚ä½ å¯ä»¥ä½¿ç”¨ä»»ä½•ä½ å–œæ¬¢çš„ä¸œè¥¿ï¼Œå› ä¸ºæˆ‘åªæ˜¯åœ¨è¾“å…¥ç‚¹åˆ—è¡¨ä¸Šåº”ç”¨äº†ä¸€ç§æ–‡æœ¬å®æ‰©å±•çš„å½¢å¼ã€‚å‡ ä¹æ‰€æœ‰çš„ç¼–ç¨‹è¯­è¨€éƒ½å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚å¯¹äºä¸Šé¢çš„shellè„šæœ¬æ¡ˆä¾‹ï¼Œæˆ‘åªæ˜¯å‘ç° \u0026ldquo;awk\u0026rdquo; æ˜¯æœ€ç®€å•ã€æœ€å¿«çš„æ‰‹æ®µã€‚\nå…¶å®ä½ ç”šè‡³å¯ä»¥ä½¿ç”¨ Imagemagick æœ¬èº«çš„ \u0026ldquo;convert\u0026rdquo; æ ¼å¼é€‰é¡¹æ¥è¿›è¡Œè¿™ç§ \u0026ldquo;macro\u0026rdquo; çš„æ‰©å±•\u0026hellip;æ¯”å¦‚è¿™é‡Œæˆ‘ç”¨å®ƒæ¥è®¡ç®—åœ†å‘¨ä¸Šçš„ä¸€ä¸ªç‚¹ï¼Œå¯¹äºè¿™ä¸ª\u0026quot;ç‚¹ç¬¦å·\u0026rdquo;ã€‚\n# Define a string of X and Y coordinates # comma between values, space between coordinates. points=\u0026#34;6.6,7.7 25.0,75.0 42.2,85.4 75.8,94.7 51.5,39.3 92.5,66.6\u0026#34; # circle radius (or symbol size) to draw around each point. radius=3.5 # convert each point into a draw command for a cross # In this case, points are space separated by the shell circles=$(for point in $points; do x=$(echo \u0026#34;$point\u0026#34; | cut -d, -f1) y=$(echo \u0026#34;$point\u0026#34; | cut -d, -f2) # use IM to do some floating point math, EG: y2=$y+$radius y2=$(convert xc: -format \u0026#39;%[fx:\u0026#39;\u0026#34;$y\u0026#34;\u0026#39;+\u0026#39;\u0026#34;$radius\u0026#34;\u0026#39;]\u0026#39; info:) echo \u0026#34;circle $x,$y$x,$y2\u0026#34; done) # Draw a red line between the points, and blue circles on the points. convert -size 100x100 xc:white \\  -draw \u0026#34;fill none stroke red polyline $points\u0026#34; \\  -draw \u0026#34;fill none stroke blue $circles\u0026#34; \\  points_circle.gif ç°åœ¨ï¼Œæ‚¨ç”Ÿæˆçš„ç»˜åˆ¶å­—ç¬¦ä¸²å¯èƒ½ä¼šå˜å¾—ç›¸å½“é•¿ï¼Œå¹¶ä¸”å¯èƒ½ä¼šå¼€å§‹å¯¼è‡´æ‚¨çš„æœ€ç»ˆå‘½ä»¤çš„é•¿åº¦é—®é¢˜ã€‚æ‰€ä»¥ï¼Œä¸å…¶å°†ç‚¹è½¬æ¢æˆé•¿å­—ç¬¦ä¸²ï¼Œç„¶åæˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä¸Šä¼ é€’ç»™ IMï¼Œä¸å¦‚å°†ç»˜åˆ¶å‘½ä»¤ä»¥æ–‡ä»¶çš„å½¢å¼ç®¡é“åŒ–ç»™ IMã€‚\næˆ‘è¿™æ¬¡ä¹Ÿä½¿ç”¨äº† SVG è·¯å¾„çš„ç»˜åˆ¶æ–¹æ³•æ¥ä»£æ›¿ Draw Primitive çš„ç»˜åˆ¶æ–¹æ³•ã€‚å¦å¤–æˆ‘ç”Ÿæˆçš„ç¬¦å·æ˜¯æ¯ä¸ªç‚¹å‘¨å›´çš„ä¸‰è§’å½¢ã€‚\n# Define a string of X and Y coordinates # comma between values, space between coordinates. points=\u0026#34;6.6,7.7 25.0,75.0 42.2,85.4 75.8,94.7 51.5,39.3 92.5,66.6\u0026#34; # convert each point into a draw commands to draw a triangle for point in $points; do echo \u0026#34;path \u0026#39;M $pointm 0,-5 -4,+8 +8,0 -4,-8\u0026#39;\u0026#34; done |\\  convert -size 100x100 xc:white \\  -fill none -stroke red -draw \u0026#34;path \u0026#39;M $points\u0026#39; \u0026#34; \\  -fill none -stroke blue -draw \u0026#39;@-\u0026#39; \\  points_tri.gif SVG è·¯å¾„å®é™…ä¸Šä½¿è¿™ä¸€ç‚¹å˜å¾—æ›´å®¹æ˜“ï¼Œé€šè¿‡å…è®¸ç›¸å¯¹åƒç´ ç§»åŠ¨ï¼Œå…è®¸ä½ è®¾è®¡ç¬¦å·ï¼Œæ‰€ä»¥å®ƒåªéœ€è¦ä¸€ä¸ªå•ä¸€çš„åˆå§‹ç»å¯¹ç§»åŠ¨\u0026rsquo;M'ï¼Œç„¶åå†ç»™å‡º\u0026rsquo;ç§»åŠ¨\u0026rsquo;å’Œ\u0026rsquo;çº¿\u0026rsquo;çš„åºåˆ—æ¥ç»˜åˆ¶ç¬¦å·ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œä½ å®é™…ä¸Šæ ¹æœ¬ä¸éœ€è¦ä»»ä½•æµ®ç‚¹è®¡ç®—ï¼Œå› ä¸ºIM drawä¼šå®Œæˆæ‰€éœ€çš„å®šä½æ•°å­¦ã€‚\n ç›¸å¯¹ç§»åŠ¨SVGè·¯å¾„é¡¹\u0026rsquo;m\u0026rsquo;åœ¨IM v6.4.3-5ä¹‹å‰è¢«ç ´åäº†ã€‚å¦‚æœä½ çš„IMæ¯”è¿™æ›´è€ï¼Œä¸Šé¢ï¼ˆå’Œä¸‹ä¸€ä¸ªï¼‰çš„ä¾‹å­å¯èƒ½ä»€ä¹ˆä¹Ÿç”»ä¸å‡ºæ¥ã€‚æ‚¨å¯ä»¥é€šè¿‡å°†ä¸Šé¢çš„ç›¸å¯¹ç§»åŠ¨\u0026rsquo;m\u0026rsquo;æ›¿æ¢ä¸ºé€‚å½“çš„ç›¸å¯¹çº¿åºåˆ—\u0026rsquo;l\u0026rsquo;æ¥è§£å†³æ—§ç‰ˆæœ¬çš„é—®é¢˜ã€‚\n ç°åœ¨ä½ å¯ä»¥æ›´è¿›ä¸€æ­¥ï¼Œå°†ä¸€ä¸ªå®Œæ•´çš„MVGæ–‡ä»¶ï¼ŒåŒ…æ‹¬ç”»å¸ƒè§„æ ¼ï¼Œç›´æ¥ä½œä¸ºä¸€ä¸ªç»˜ç”»å‘½ä»¤çš„æµæ°´çº¿è¾“å…¥åˆ°IMä¸­ã€‚è¿™æ¬¡è®©æˆ‘ä»¬åšä¸€ä¸ª\u0026rsquo;åå­—'ï¼Œè¿™å’Œä¸Šé¢ç¬¬ä¸€ä¸ª\u0026rsquo;åŠ \u0026rsquo;çš„ä¾‹å­ç±»ä¼¼ï¼Œéœ€è¦å¤§é‡çš„è®¡ç®—ã€‚\n# Define a string of X and Y coordinates # comma between values, space between coordinates. points=\u0026#34;6.6,7.7 25.0,75.0 42.2,85.4 75.8,94.7 51.5,39.3 92.5,66.6\u0026#34; # Generate a MVG file for IM to draw all components ( echo \u0026#34;viewbox 0 0 100 100 fill white rectangle 0,0 100 100\u0026#34; echo \u0026#34;fill none stroke red path \u0026#39;M $points\u0026#39;\u0026#34; echo \u0026#34;fill none stroke blue path \u0026#39;\u0026#34; for point in $points; do echo \u0026#34; M $pointm -2,-2 +4,+4 m -4,0 +4,-4\u0026#34; done echo \u0026#34;\u0026#39;\u0026#34; ) | convert mvg:- points_cross.gif è¿™ä½¿ç”¨äº†ç‰¹æ®Šçš„shellç¼–ç¨‹æŠ€æœ¯ï¼Œåœ¨shellæ‹¬å·ä¸­ \u0026ldquo;echo\u0026rdquo; çš„ä»»ä½•ä¸œè¥¿éƒ½å°†ä½œä¸ºMVGæ–‡ä»¶è¢«è¾“å…¥åˆ°æœ€ç»ˆçš„\u0026quot;è½¬æ¢\u0026quot;å‘½ä»¤ä¸­ã€‚ç¬¬ä¸€ä¸ª \u0026ldquo;echo\u0026rdquo; å®šä¹‰å¹¶å¡«å……å›¾åƒçš„ç»˜å›¾ç”»å¸ƒï¼Œè€Œ \u0026ldquo;while\u0026rdquo; å¾ªç¯åˆ™å°†æ¯ä¸ª \u0026ldquo;ç‚¹\u0026rdquo; è½¬æ¢ä¸ºä¸€ä¸ªç»™å®šåŠå¾„çš„åœ†ã€‚\nè¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯ï¼Œä½ ä¸ä¼šå—åˆ°ä»»ä½•å­—ç¬¦ä¸²çš„é™åˆ¶ï¼Œè€Œä½¿ç”¨å…¶ä»–ä¸¤ç§æ–¹æ³•å¯èƒ½ä¼šå—åˆ°é™åˆ¶ã€‚\nå…¶ä»–ä½ å¯ä»¥ç”Ÿæˆçš„ç¬¦å·åŒ…æ‹¬æ–¹æ¡†ã€é’»çŸ³ã€é”™è¯¯æ¡ç­‰ã€‚\nä¹Ÿè¯·å‚è§ä¸‹é¢çš„\u0026quot;ç»˜åˆ¶åœ†åœˆ\u0026rdquo;ï¼Œäº†è§£å…¶ä»–åœ†åœˆæ–¹æ³•ï¼ŒåŒ…æ‹¬ä¸è®¡ç®—ç›¸å¯¹ \u0026ldquo;è·¯å¾„\u0026quot;çš„åœ†åœˆç»˜åˆ¶ã€‚\nç»˜åˆ¶ç¬¦å·çš„æ›¿ä»£æ–¹æ³• é™¤äº†ç›´æ¥ç»˜åˆ¶ç¬¦å·å¤–ï¼Œè¿˜æœ‰å…¶ä»–çš„æ–¹æ³•å¯ä»¥å°†ç¬¦å·æ·»åŠ åˆ°å›¾åƒä¸­ã€‚\nç¬¦å·å­—ä½“ æ‚¨å¯ä»¥ä» Symbol Font ä¸­æå–ç¬¦å·ï¼Œå¹¶å°†å…¶ä¿å­˜ä¸ºä¸€ä¸ªå°ä½å›¾ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å°çš„é¢„å®šä¹‰ä½†è‰²å½©ä¸°å¯Œçš„å›¾åƒæ¥åšè¿™ä»¶äº‹ã€‚\nç„¶è€Œè¿™æ ·åšå¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œæ— æ³•å‡†ç¡®å®šä½å­—ä½“ç›¸å¯¹äºç‰¹å®šåƒç´ çš„ä½ç½®ã€‚ä¹Ÿå°±æ˜¯è¯´è¿™ä¸æ˜¯ä¸€ä¸ªéå¸¸ç²¾ç¡®çš„æŠ€æœ¯ã€‚ä½†æ˜¯ä½ å¯ä»¥åœ¨ä»»ä½•åƒç´ ä½ç½®ç»„æˆä»»ä½•å›¾åƒã€‚ä¾‹å¦‚è¿™äº›ç¬¦å·æ˜¯ä»ä¸€äº›å­—ä½“ä¸­æå–å‡ºæ¥çš„ï¼Œç”¨äºè¿™äº›ç¤ºä¾‹é¡µé¢çš„å…·ä½“ä½¿ç”¨ã€‚\n\u0026lt;= =\u0026gt; x + + + o o o o åœ¨åˆ†å±‚å›¾åƒä¸€èŠ‚ä¸­ç»™å‡ºäº†å°†å›¾åƒåˆæˆåˆ°å¤§èƒŒæ™¯ä¸Šçš„ä¾‹å­ã€‚ç„¶è€Œï¼Œå¾ªç¯çš„æ–¹æ³•å¯èƒ½æ›´æœ‰ç”¨ï¼Œä¾‹å¦‚åœ¨åˆ†å±‚å›¾åƒçš„ç¨‹åºåŒ–å®šä½ä¸­ç»™å‡ºäº†ã€‚\næœªæ¥ï¼šä½¿ç”¨åæ ‡å¯¹å›¾åƒè¿›è¡Œåˆ†å±‚çš„ä¾‹å­\nå½¢æ€å­¦ å¦ä¸€ç§é€‰æ‹©æ˜¯ä½¿ç”¨å½¢æ€å­¦ï¼Œä½¿ç”¨ç‰¹æ®Šçš„\u0026quot;å½¢çŠ¶\u0026quot;å†…æ ¸ï¼Œå¦‚ \u0026ldquo;ç£ç›˜\u0026rdquo;ã€\u0026ldquo;ç¯å½¢ \u0026ldquo;å’Œ \u0026ldquo;åŠ \u0026rdquo;ï¼Œç”šè‡³æ˜¯ä½ è‡ªå·±çš„ç”¨æˆ·å®šä¹‰å†…æ ¸ï¼Œæ¥ \u0026ldquo;ç¨€é‡Š\u0026quot;å•ä¸ªåƒç´ ã€‚\nä¾‹å¦‚\u0026hellip;\nconvert -size 80x80 xc:black -fill white \\  -draw \u0026#39;point 20,15 point 55,30 point 40,60\u0026#39; points_pixels.gif convert points_pixels.gif -morphology Dilate Ring points_rings.gif convert points_pixels.gif -morphology Dilate Plus:4 points_pluses.gif convert points_pixels.gif -morphology Dilate Cross:3 points_crosses.gif ç„¶åå¯ä»¥é€šè¿‡ä½¿ç”¨ Alpha Shape Operator å°†ç»“æœç›´æ¥è½¬æ¢ä¸ºå½©è‰²å åŠ ã€‚\nè¿™æ ·åšçš„æœ€å¤§å¥½å¤„æ˜¯ï¼Œä½ å…¶å®ä¸éœ€è¦çŸ¥é“æ¯ä¸ªç¬¦å·çš„å•ç‹¬ä½ç½®ã€‚æˆ–è€…æœ‰å¤šå°‘ä¸ªç¬¦å·ã€‚ä½†è¿™ä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªç¼ºç‚¹ã€‚ä¸€ä¸ªä¸»è¦çš„ç¼ºç‚¹æ˜¯ï¼Œä½ç½®åªåœ¨æ•´æ•°ä½ç½®ã€‚ä½ ä¸èƒ½ä½¿ç”¨æµ®ç‚¹ \u0026ldquo;å­åƒç´ \u0026quot;å®šä½æ¥\u0026quot;ç»˜åˆ¶\u0026rdquo;ã€‚\nå·ç§¯ ä¸€ä¸ªå‡ ä¹ç›¸åŒçš„æŠ€æœ¯æ˜¯ä½¿ç”¨ Convolveï¼Œä½¿ç”¨ä¸“é—¨è®¾è®¡çš„å†…æ ¸ï¼Œå®ƒå…è®¸ä½ è®¾ç½®ä¸åŒçš„ç°åº¦ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªç®€å•çš„å¼€/å…³ç»“æœï¼Œå¦‚ä¸Šæ‰€è¿°ã€‚\né€šè¿‡ä½¿ç”¨ä¸åŒçš„ç”¨æˆ·å®šä¹‰å†…æ ¸ï¼Œä¸ºå›¾åƒçš„æ¯ä¸€ä¸ªé€šé“ï¼ˆçº¢ã€ç»¿ã€è“å’Œé˜¿å°”æ³•ï¼‰ï¼Œç”šè‡³å¯ä»¥ä»æ¯ä¸ªåƒç´ åæ ‡åˆ›å»ºå¤šè‰²ç¬¦å·ã€‚\nä¸ºæ­¤ï¼Œæˆ‘ä½¿ç”¨äº†ä¸€ä¸ªæˆ‘å†™çš„ç‰¹æ®Šè„šæœ¬ image2kernel æ¥å°†å½©è‰²å›¾åƒï¼ˆè§å³å›¾ï¼‰è½¬æ¢ä¸ºæ¯ä¸ªé€šé“çš„ç‹¬ç«‹æµ®ç‚¹å·ç§¯æ ¸ã€‚\nimage2kernel -q marker.png marker.dat è¿™å°†ç”Ÿæˆå››ä¸ªæ–‡ä»¶ï¼Œæ¯”å¦‚ marker_R.datï¼Œæ¯ä¸ªé€šé“éƒ½æœ‰ä¸€ä¸ªéå¸¸å°çš„è¾“å…¥å›¾åƒï¼Œè¿™æ˜¯ç”¨æˆ·å®šä¹‰çš„å›¾åƒè¡¨ç¤ºï¼ˆåŸç‚¹åœ¨å›¾åƒä¸­å¿ƒï¼‰ã€‚\nç°åœ¨ä½¿ç”¨è¿™äº›å†…æ ¸æ•°æ®æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›å•ç‚¹åœ¨é€æ˜çš„èƒŒæ™¯ä¸Š Convolve æˆæˆ‘ä»¬å½©è‰²çš„æ ‡è®°å›¾åƒã€‚\nconvert points_pixels.gif -alpha off \\  \\( -clone 0 -morphology Convolve @marker_R.dat \\) \\  \\( -clone 0 -morphology Convolve @marker_G.dat \\) \\  \\( -clone 0 -morphology Convolve @marker_B.dat \\) \\  \\( -clone 0 -morphology Convolve @marker_A.dat \\) \\  -delete 0 -channel RGBA -combine point_markers.png  åœ¨IM v6.7.6-9ä¹‹å‰ï¼ŒCombine Operator è¦æ±‚å›¾åƒçš„é€æ˜åº¦é€šé“ä»¥ \u0026ldquo;å“‘å…‰\u0026quot;å€¼è€Œä¸æ˜¯alphaå€¼çš„å½¢å¼ç»™å‡ºï¼Œå› æ­¤ï¼Œç”±æ­¤äº§ç”Ÿçš„alphaé€šé“éœ€è¦è¢«å¦å®šã€‚EG:\n ... \u0026#34;`cat marker_A.dat`\u0026#34; -negate \\) \\ åªèƒ½ä½¿ç”¨å°å›¾åƒï¼Œåƒç´ ç‚¹è¦è¶³å¤Ÿåˆ†æ•£ï¼Œç¬¦å·ä¸è¦é‡å ã€‚è¿™æ˜¯å› ä¸º Convolve ä¼šå°†é‡å çš„åŒºåŸŸåŠ åœ¨ä¸€èµ·ï¼Œä½¿å…¶æ¯”é¢„æœŸçš„æ›´äº®ã€‚\nä»¥ä¸Šå†…å®¹å·²è¢«è½¬æ¢æˆUNIX shellè„šæœ¬ convolve_imageï¼Œä»¥æ–¹ä¾¿ä½¿ç”¨ã€‚\nconvolve_image points_pixels.gif marker.png point_markers.png è¿™ä¸ªæŠ€æœ¯æºäºIMè®ºå›ä¸Šçš„ä¸€ä¸ªè®¨è®º-IM çš„æœ‰è¶£ä½“éªŒã€‚ç”¨æˆ·å¸Œæœ›åœ¨è¶³çƒåœºçš„èƒŒæ™¯å›¾ä¸Šæ”¾ç½®å°äººï¼Œè®©ä»–ä»¬çš„ä½ç½®åœ¨å›¾ç‰‡ä¸­æ‹¼å‡ºä¸€ä¸ªäººçš„åå­—ã€‚\nåˆ†å±‚ ä¸€ç§ä¸åŒçš„æŠ€æœ¯ï¼Œå¦‚å›¾åƒå±‚ï¼Œä½¿ç”¨ä½ ä»æºå›¾åƒä¸­æå–çš„åƒç´ åˆ—è¡¨è¿›è¡Œå®šä½ï¼Œå¯èƒ½æ˜¯æ›´å¥½çš„æ–¹æ³•ã€‚ä½ å¯ä»¥å…ˆå åŠ æ›´è¿œçš„ç¬¦å·å›¾åƒï¼Œç„¶åå†å åŠ å‰æ™¯å›¾åƒï¼Œä½ å¯ä»¥é€šè¿‡ç¼–ç¨‹é€‰æ‹©æˆ–éšæœºé€‰æ‹©ä»€ä¹ˆç¬¦å·æ›¿æ¢ä»€ä¹ˆç‚¹ã€‚\nå…³äºè¿™ä¸ªä¾‹å­ï¼Œè¯·çœ‹åœ°å›¾ä¸­çš„å›¾é’‰ã€‚\nç»˜åˆ¶åœ†åœˆ ç»˜åˆ¶é€‰é¡¹ä¸ºæ‚¨æä¾›äº†è®¸å¤šæ–¹æ³•æ¥å®Œæˆä¸€äº›éå¸¸åŸºæœ¬çš„å·¥ä½œã€‚ç»˜åˆ¶åœ†ã€‚\nä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨åœ†å‘¨ä¸Šçš„ä»»ä½•ä¸€ç‚¹ä¸Šç”»ä¸€ä¸ªåœ†ï¼Œå› æ­¤æ‚¨éœ€è¦è®¡ç®—ä¸€ä¸ªä¸­å¿ƒç‚¹å’Œä¸€ä¸ªåŠå¾„ä¸º25åƒç´ çš„ç¬¬äºŒç‚¹ã€‚å› æ­¤ï¼Œæ‚¨éœ€è¦è®¡ç®—ä¸€ä¸ªä¸­å¿ƒç‚¹å’Œç¬¬äºŒä¸ªç‚¹ï¼Œè¿™ä¸ªç‚¹çš„åŠå¾„ï¼ˆä¾‹å¦‚25åƒç´ ï¼‰ç¦»ç¬¬ä¸€ä¸ªç‚¹çš„è·ç¦»ã€‚\nconvert -size 100x60 xc: -stroke Firebrick -fill tomato -strokewidth 2 \\  -draw \u0026#39;circle 50,30 50,55\u0026#39; circle_circle.gif Fred Weinhaus æŒ‡å‡ºï¼Œé€šè¿‡ä½¿ç”¨å¹³ç§»ï¼Œä½ å¯ä»¥æ¶ˆé™¤è®¡ç®—åœ†è¾¹åæ ‡çš„éœ€è¦ï¼Œè€Œç›´æ¥ç»™å‡ºåŠå¾„å³å¯ã€‚\nconvert -size 100x60 xc: -stroke SeaGreen -fill PaleGreen -strokewidth 2 \\  -draw \u0026#39;translate 50,30 circle 0,0 25,0\u0026#39; circle_circle_trans.gif ä½†æ˜¯å½“ç»˜åˆ¶å¤šä¸ªåœ†æ—¶ï¼Œä¸Šè¿°æ“ä½œéœ€è¦å¯¹æ¯ä¸ªåœ†è¿›è¡Œå•ç‹¬çš„ -draw æ“ä½œï¼Œæˆ–è€…ä½¿ç”¨ Context Pushingã€‚\nä½¿ç”¨æ¤­åœ†å¯ä»¥ç›´æ¥æŒ‡å®šåŠå¾„ä¸ºè½´é•¿\nconvert -size 100x60 xc: -stroke Sienna -fill Wheat -strokewidth 2 \\  -draw \u0026#39;ellipse 50,30 25,25 0,360\u0026#39; circle_ellipse.gif ä½ ä¹Ÿå¯ä»¥ç”¨ stroke-lineecap round ç”»ä¸€æ¡éå¸¸éå¸¸çŸ­çš„çº¿æ¥ç”Ÿæˆä¸€ä¸ªåœ†ã€‚æè¾¹çš„å®½åº¦å¯ä»¥è®¾ç½®åœ†çš„ç›´å¾„ã€‚æ³¨æ„çº¿æ¡å¿…é¡»æœ‰ä¸€å®šçš„é•¿åº¦ï¼ˆæ— è®ºå¤šå°ï¼‰ï¼Œå¦åˆ™ç”»ä¸å‡ºä»»ä½•ä¸œè¥¿ã€‚\nconvert -size 100x60 xc: -stroke Blue -strokewidth 50 \\  -draw \u0026#39;stroke-linecap round line 50,30 50,30.0001\u0026#39; \\  circle_line.gif è¿™ç§æŠ€æœ¯ï¼Œä¸å¹¸çš„æ˜¯ä¸èƒ½å‹¾å‹’å‡ºç”Ÿæˆçš„åœ†ï¼Œä½†å¯¹äºè¦†ç›–å¤§é¢ç§¯çš„åŒºåŸŸï¼Œå¤§ç¬”è§¦å®½åº¦æ˜¯æœ‰ç”¨çš„ã€‚è¯·çœ‹ä¸‹é¢ä¸€äº›ç®€å•çš„ä¾‹å­ã€‚\nè¿™ç§æ–¹æ³•åˆ©ç”¨äº† SVG è·¯å¾„çš„ç»˜åˆ¶æ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ä¸éœ€è¦è®¡ç®—ä»»ä½•é¢å¤–åæ ‡çš„æƒ…å†µä¸‹ç»˜åˆ¶åœ†å½¢ã€‚\nconvert -size 100x60 xc: -stroke Blue -fill DodgerBlue -strokewidth 2 \\  -draw \u0026#34;path \u0026#39;M 50,30 m 0,25 a 1,1 0 0,0 0,-50 a 1,1 0 1,0 0,50\u0026#39;\u0026#34; \\  circle_path.gif åªæœ‰æœ€åˆçš„ç»å¯¹ç§»åŠ¨ \u0026lsquo;M\u0026rsquo; æ˜¯ç”¨æ¥å®šä¹‰ä¸­å¿ƒçš„ï¼Œæ¥ä¸‹æ¥çš„è·¯å¾„ç»„ä»¶ä¸­çš„ \u0026lsquo;25\u0026rsquo; å’Œ \u0026lsquo;50\u0026rsquo; æ˜¯å®šä¹‰ç›¸å¯¹äºè¿™ä¸ªä¸­å¿ƒçš„åœ†çš„åŠå¾„å’Œç›´å¾„ã€‚\n åœ¨IM v6.4.3-5ä¹‹å‰ï¼Œç›¸å¯¹ç§»åŠ¨SVGè·¯å¾„é¡¹ \u0026rsquo;m' æ˜¯è¢«ç ´åçš„ã€‚ å¦‚æœæ‚¨çš„IMæ¯”è¿™æ›´æ—©ï¼Œåœ†å¯èƒ½åªæ˜¾ç¤ºä¸ºä¸€ä¸ªåƒç´ ã€‚æ‚¨å¯ä»¥é€šè¿‡å°†ä¸Šé¢çš„ \u0026rsquo;m' æ›¿æ¢ä¸º \u0026lsquo;l\u0026rsquo; æ¥ä¿®å¤æ—§ç‰ˆæœ¬çš„é—®é¢˜ã€‚\n Fred Weinhaus æ·»åŠ äº†ä»¥ä¸‹è´å¡å°”åœ†çš„æ–¹æ³•ã€‚å®ƒéå¸¸æ¥è¿‘çœŸå®çš„åœ†ï¼ˆè™½ç„¶ä¸ç²¾ç¡®ï¼‰ï¼Œå¹¶ä¸”éœ€è¦è¿›è¡Œæµ®ç‚¹è®¡ç®—ã€‚\nr=25; cx=50; cy=30; x1=25; x2=75; # = cx Â± radius y1=-3.25; y2=63.25; # = cy Â± radius*1.275 convert -size 100x60 xc: -stroke Purple -fill Violet -strokewidth 2 \\  -draw \u0026#34;bezier $x1,$cy$x1,$y1$x2,$y1$x2,$cy\u0026#34; \\  -draw \u0026#34;bezier $x1,$cy$x1,$y2$x2,$y2$x2,$cy\u0026#34; \\  circle_bezier.gif å¦‚æœç”»ä¸€ä¸ªç²¾ç¡®çš„åœ†å¹¶ä¸é‡è¦ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™ä¸ª4 Bezieræ®µ SVG è·¯å¾„ï¼Œå®ƒåªä½¿ç”¨åœ†çš„Xå’ŒYè¾¹ç•Œè¿›è¡Œè®¡ç®—ã€‚\nr=25; cx=50; cy=30; x1=25; x2=75; # X bounds = cx Â± radius y1=5; y2=55; # Y bounds = cy Â± radius convert -size 100x60 xc: -stroke Tomato -fill Gold -strokewidth 2 \\  -draw \u0026#34;path \u0026#39;M $cx,$y1Q $x1,$y1$x1,$cyT $cx,$y2$x2,$cy$cx,$y1z\u0026#39;\u0026#34; \\  circle_bezier_path.gif å¦‚æœä½ å–œæ¬¢ä¸€ä¸ªå®Œå…¨ç›¸å¯¹äºä¸­å¿ƒèµ·ç‚¹ç»˜åˆ¶çš„ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿™ç§æŠ€æœ¯ã€‚åªä½¿ç”¨åŠå¾„å€¼ï¼Œä½¿å…¶ç”Ÿæˆç®€å•ï¼Œåªä½¿ç”¨ API ä¸­çš„å­—ç¬¦ä¸²å‡½æ•°ã€‚\nconvert -size 100x60 xc: -stroke Orange -fill LemonChiffon -strokewidth 2 \\  -draw \u0026#34;path \u0026#39;M 50,30 m 0,25 q 25,0 25,-25 t -25,-25 -25,25 25,25 z\u0026#39;\u0026#34;\\  circle_bezier_path_rel.gif ä½ èƒ½æƒ³åˆ°å…¶ä»–ç”»åœ†çš„æ–¹æ³•å—ï¼Ÿ\nç»˜åˆ¶ç®­å¤´-å®šä½ã€æ—‹è½¬å’Œç¼©æ”¾ç¬¦å· ä½¿ç”¨ä¸Šè¿°æŠ€æœ¯ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„ç¬¦å·ï¼Œå¦‚ç®­å¤´ï¼Œä½ å¯ä»¥å®šä½ï¼Œä½¿å…¶ç‚¹åœ¨çº¿çš„æœ€æœ«ç«¯ï¼Œå¹¶ç”»åœ¨å®ƒä¸Šé¢ã€‚å¦‚æœä½ ç”»çš„ç®­å¤´åçš„çº¿ï¼ˆå…¸å‹çš„æƒ…å†µï¼‰ï¼Œé‚£ä¹ˆç®­å¤´å°†è¢«ç»˜åˆ¶åœ¨è¯¥è¡Œçš„é¡¶éƒ¨ã€‚\nç„¶è€Œï¼Œä»–ä»¬æœ‰ä¸‰ç§ç±»å‹çš„ç®­å¤´ï¼Œå¯ä»¥å®šä¹‰ï¼Œæ¯ä¸ªç±»å‹çš„å®šä¹‰åœ¨ä¸åŒçš„æ–¹å¼å–å†³äºå®ƒçš„ä½¿ç”¨ã€‚\n æµ‹é‡æ—¶ï¼Œä½ åªæ˜¯æƒ³ç”¨ç®­å¤´å¤´æ ‡è®°çº¿çš„ä¸¤ç«¯ï¼Œä»¥æŒ‡ç¤ºä¸€äº›å·¥ç¨‹å›¾ä¸­çš„æµ‹é‡æé™ã€‚éå¸¸ç®€å•ã€‚ çŸ¢é‡ï¼Œæ˜¾ç¤ºä¸€äº›æ•°å€¼çš„æ–¹å‘å’Œå¼ºåº¦ã€‚ä¾‹å¦‚åœ¨å¤©æ°”é£å›¾ä¸­ã€‚éœ€è¦ä¸€ä¸ªå°¾å·´ï¼Œ0,0ç‚¹å°±æ˜¯å°¾å·´çš„æœ«ç«¯ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿™æ ·çš„å‘é‡ä¼šå½¢æˆä¸€ä¸ªå¤§ç½‘æ ¼ã€‚ æŒ‡æ ‡ï¼ŒæŒ‡å‡ºä¸€äº›ç»†èŠ‚ã€‚å¯¹äºè¿™ä¸ª0,0ç‚¹å¯èƒ½åº”è¯¥æ˜¯ç®­å°–ï¼Œæˆ–è€…æ˜¯ç®­å¤´æœ¬èº«å‰é¢çš„ä¸€äº›è·ç¦»ã€‚  æµ‹é‡ç®­å¤´ ç®€å•åœ°åœ¨ä¸€æ¡çº¿çš„æœ«ç«¯æ·»åŠ ä¸€ä¸ªç®­å¤´æ˜¯æ¯”è¾ƒå®¹æ˜“åšåˆ°çš„ã€‚åŸºæœ¬ä¸Šï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ª \u0026lsquo;arrow head\u0026rsquo; ç¬¦å·ï¼Œå¹¶å°†å…¶ç”»åœ¨æ­£ç¡®çš„ä½ç½®ã€‚\nä¾‹å¦‚\u0026hellip;\narrow_head=\u0026#34;l -15,-5 +5,+5 -5,+5 +15,-5 z\u0026#34; convert -size 100x60 xc: -draw \u0026#39;line 10,30 80,30\u0026#39; \\  -draw \u0026#34;stroke blue fill skyblue path \u0026#39;M 80,30 $arrow_head\u0026#39; \u0026#34; \\  arrow_horizontal.gif è¯·æ³¨æ„ï¼Œæˆ‘ç”»çš„ç¬¦å·ï¼Œä½¿å…¶èµ·ç‚¹æ˜¯çº¿çš„æœ€æœ«ç«¯ã€‚è¿™æ ·ä¸€æ¥ï¼Œå®ƒå°±å¯ä»¥åœ¨ä¹‹å‰ç”»å¥½çš„çº¿ä¸Šé¢å‘åç”»ï¼Œå½¢æˆä¸€ä¸ªéå¸¸æ¼‚äº®çš„æ•´é½çš„ç¬¦å·ã€‚\nç®­å¤´å´æœ‰ä¸€ä¸ªç›¸å…³çš„æ–¹å‘ã€‚ä½ å¯ä»¥åœ¨è®¸å¤šä¸åŒçš„è§’åº¦åˆ›å»ºå¤§é‡çš„ç®­å¤´å®šä¹‰ï¼Œè®¸å¤šç¨‹åºéƒ½è¿™æ ·åšã€‚ä½†æ˜¯æ—¢ç„¶ç®­å¤´æ˜¯ä¸€ä¸ªçŸ¢é‡ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆä¸æŠŠç®­å¤´ä½œä¸ºä¸€ä¸ªçŸ¢é‡è¿›è¡Œæ—‹è½¬å‘¢ã€‚IMç»˜å›¾å‘½ä»¤å†…ç½®äº†ç»˜å›¾æ—‹è½¬ï¼ˆCanvas Warpingï¼‰ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ä½¿ç”¨å®ƒä»¬ã€‚\nè¿™æ ·åšè¿˜æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œå°±æ˜¯æŠŠä½ç½®ä»ç®­å¤´å¤´çš„ path å®šä¹‰ä¸­ç§»å‡ºæ¥ï¼Œè®©ä½ æŠŠæ•´ä¸ªè·¯å¾„æŒ‡å®šä¸º constant\u0026hellip;\narrow_head=\u0026#34;path \u0026#39;M 0,0 l -15,-5 +5,+5 -5,+5 +15,-5 z\u0026#39;\u0026#34; convert -size 100x60 xc: -draw \u0026#39;line 25,55 70,10\u0026#39; \\  -draw \u0026#34;stroke blue fill skyblue translate 70,10 rotate -45 $arrow_head\u0026#34; \\  arrow_rotate.gif å¦‚æœä½ å–œæ¬¢æ”¹å˜ç®­å¤´çš„å¤§å°ï¼Œå¯ä»¥åœ¨æ—‹è½¬åå¢åŠ ä¸€ä¸ª scale ç»˜åˆ¶é€‰é¡¹ã€‚\narrow_head=\u0026#34;path \u0026#39;M 0,0 l -15,-5 +5,+5 -5,+5 +15,-5 z\u0026#39;\u0026#34; convert -size 100x60 xc: -draw \u0026#39;line 25,55 70,10\u0026#39; \\  -draw \u0026#34;stroke blue fill skyblue translate 70,10 rotate -45 scale 2,2 $arrow_head\u0026#34; \\  arrow_scale.gif è¯·æ³¨æ„ï¼Œå®ƒæ˜¯å¦‚ä½•æ”¾å¤§ç¦»å¼€ç®­å¤´çš„\u0026quot;å°–ç«¯\u0026rdquo;ï¼Œä½ æŒ‡å®šçš„åœ°æ–¹ã€‚è¿™æ˜¯å¤„ç†ç®­å¤´çš„ä¸€ä¸ªéå¸¸é‡è¦çš„æ–¹é¢ï¼Œå› ä¸ºå®ƒæ˜¯å”¯ä¸€çš„ç»ˆç‚¹ï¼Œå’Œè§’åº¦çš„çº¿ï¼Œä½ æ­£åœ¨æ·»åŠ ç®­å¤´çš„äº‹é¡¹ã€‚\ntransforms çš„é¡ºåºæ˜¯å¾ˆé‡è¦çš„ï¼Œè€Œä¸”å®é™…ä¸Šä¸å®ƒä»¬å®é™…è¢«å¤„ç†çš„é¡ºåºæ˜¯ç›¸åçš„ã€‚ä¹Ÿå°±æ˜¯å…ˆå°†æ¯”ä¾‹å°ºåº”ç”¨äºåº§æ ‡ï¼Œç„¶åæ˜¯æ—‹è½¬ï¼Œå†æ˜¯å¹³ç§»ã€‚å¦‚æœåº§æ ‡å˜æ¢ä¸æ˜¯æŒ‰ç…§è¿™ä¸ªé¡ºåºè¿›è¡Œçš„ï¼Œæˆ‘ä»¬æœ€ç»ˆä¹Ÿä¼šå¯¹ç®­å¤´çš„æœ€ç»ˆä½ç½®è¿›è¡Œç¼©æ”¾ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„ä½ç½®ã€‚\nå¦å¤–ç”±äºæ¯”ä¾‹å°ºæœ‰ä¸¤ä¸ªæ•°å­—ï¼Œè€ŒåŸæ¥çš„ç®­å¤´å¤´ç¬¦å·æ˜¯æ°´å¹³è®¾è®¡çš„ï¼ˆè§’åº¦ä¸ºé›¶ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥åˆ†åˆ«å°†ç®­å¤´çš„å®½åº¦ä¸é«˜åº¦è¿›è¡Œæ¯”ä¾‹ã€‚åŒæ—¶æ³¨æ„ç¬”ç”»å®½åº¦ä¹Ÿéšç€ç®­å¤´çš„å¤§å°è€Œç¼©æ”¾ï¼Œä¿æŒä¸€è‡´ã€‚\narrow_head=\u0026#34;path \u0026#39;M 0,0 l -15,-5 +5,+5 -5,+5 +15,-5 z\u0026#39;\u0026#34; convert -size 100x60 xc: -draw \u0026#39;line 25,55 70,10\u0026#39; \\  -draw \u0026#34;stroke blue fill skyblue translate 70,10 rotate -45 scale 2,1 $arrow_head\u0026#34; \\  arrow_scale_aspect.gif ç°åœ¨ï¼Œå½“ä½ åœ¨ç”»å¸ƒä¸Šç¿˜èµ·ä¸€ä¸ªä¸ªç®­å¤´æ—¶ï¼Œä¹Ÿè®¸è¿˜æœ‰è®¸å¤šå…¶ä»–çš„ç»˜ç”»æ“ä½œï¼Œä½ å¯èƒ½å–œæ¬¢åœ¨ä¸€æ¬¡ [\u0026quot;-draw\u0026quot;](https://imagemagick.org/Usage/option_link.cgi?draw) æ“ä½œä¸­æŠŠå®ƒä»¬å…¨éƒ¨ç”»å®Œã€‚è¯´è¦ç”»çº¿ï¼Œç„¶ååœ¨ä¸¤ç«¯æ·»åŠ ç®­å¤´ï¼Œéœ€è¦ä¸åŒçš„é¢œè‰²ã€ä½ç½®ã€æ—‹è½¬ï¼Œç”šè‡³å¯èƒ½æ˜¯ä¸åŒçš„æ¯”ä¾‹ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦å°†ç”»å¸ƒç¿˜æ›²çš„èŒƒå›´é™åˆ¶åœ¨æ¯ä¸ªå•ç‹¬ç®­å¤´å¤´çš„ç»˜åˆ¶ä¸Šã€‚å¦‚æœä½ ä¸é™åˆ¶èŒƒå›´ï¼Œä½ å¯èƒ½ä¼šåœ¨ä»¥åå¼€å§‹å½±å“åˆ°å…¶ä»–åé¢çš„ç»˜åˆ¶æ“ä½œï¼Œæ°¸è¿œä¸èƒ½å¾ˆç¡®å®šä½ ç”Ÿæˆçš„æ˜¯ä»€ä¹ˆã€‚\nä¸ºäº†é™åˆ¶ç¿˜æ›²çš„èŒƒå›´ï¼ˆä»¥åŠæ‰€æœ‰å…¶ä»–çš„ç»˜å›¾å±æ€§ï¼‰ï¼Œæ‚¨å°†æ¶‰åŠåˆ°çš„éƒ¨åˆ†åŒ…è£¹åœ¨ä¸€ä¸ª graphic-context\u0026hellip;\narrow_head=\u0026#34;path \u0026#39;M 0,0 l -15,-5 +5,+5 -5,+5 +15,-5 z\u0026#39;\u0026#34; convert -size 100x60 xc: \\  -draw \u0026#34;stroke black fill none path \u0026#39;M 10,40 A 50,50 0 0,1 90,40\u0026#39; push graphic-context stroke blue fill skyblue translate 10,40 rotate 135 $arrow_headpop graphic-context push graphic-context stroke firebrick fill tomato translate 90,40 rotate 45 $arrow_headpop graphic-context \u0026#34; \\  arrow_context.gif push ä¸»è¦æ˜¯å°†å½“å‰æ‰€æœ‰çš„ç»˜å›¾å±æ€§ä¿å­˜èµ·æ¥ï¼Œä»¥å¤‡å°†æ¥ä½¿ç”¨ï¼Œè€Œ pop åˆ™æ¢å¤è¿™äº›å±æ€§ï¼Œç”¨ä¹‹å‰ä¿å­˜çš„è®¾ç½®æ›¿æ¢ä»»ä½•è®¾ç½®ï¼ˆé¢œè‰²ã€æ‰­æ›²ã€ä½ç½®ç­‰ï¼‰ã€‚è¿™æ„å‘³ç€åœ¨ \u0026lsquo;popping\u0026rsquo; ä¹‹åï¼Œ\u0026lsquo;canvas warp\u0026rsquo; ä¼šè¢«å–æ¶ˆï¼Œç”»å›¾ä¼šå›åˆ°ä¿®æ”¹ä¹‹å‰çš„çŠ¶æ€ã€‚\nä¸Šè¿°æŠ€æœ¯åªæ˜¯ç”Ÿæˆç®­å¤´çš„ä¸€ç§æ–¹æ³•ï¼Œåœ¨ç»˜åˆ¶ç®­å¤´ä½œä¸ºæµ‹é‡è·ç¦»çš„ä¸€éƒ¨åˆ†æ—¶ï¼Œå¦‚åœ¨æŠ€æœ¯å›¾çº¸ä¸­ï¼Œæ˜¯ä¸€ç§å¾ˆå¥½çš„æ–¹æ³•ã€‚\nçŸ¢é‡ç®­å¤´ å¦‚å‰æ‰€è¿°ï¼ŒçŸ¢é‡æ—¢æ˜¾ç¤ºæ–¹å‘ï¼Œåˆæ˜¾ç¤ºæŸä¸ªæ•°å€¼çš„å¼ºåº¦ã€‚è¿™æ„å‘³ç€ç®­å¤´çš„é•¿åº¦æ˜¯å¯å˜çš„ï¼Œç®­å¤´å¤´å¯ä»¥åœ¨ä»»ä½•ä½ç½®è¿œç¦»å‘é‡çš„èµ·ç‚¹ã€‚\nç°åœ¨ï¼Œä½ å¯ä»¥åšä¸€äº›æ²‰é‡çš„æ•°å­¦è®¡ç®—çš„ä½ç½®ï¼Œç®­å¤´å¤´åº”è¯¥æ˜¯åœ°æ–¹ç»™å®šçš„å‘é‡çš„é•¿åº¦å’Œè§’åº¦ï¼Œä½†ä»–ä»¬æ˜¯ä¸€ä¸ªæ›´å¥½çš„æ–¹æ³•ï¼Œè¿™è®© ImageMagick ä¸ºä½ åšè¿™äº›è®¡ç®—ã€‚\nè§£å†³çš„åŠæ³•æ˜¯åœ¨ Warped Canvas Space ä¸­ç”»ä¸€æ¡é•¿åº¦åˆé€‚çš„æ°´å¹³çº¿ä½œä¸ºå‘é‡é•¿åº¦ã€‚å½“è¿™æ¡çº¿ç”»å¥½åï¼Œåªéœ€å°†ç»˜å›¾ç©ºé—´å†æ¬¡è½¬æ¢åˆ°çº¿çš„æœ«ç«¯ï¼Œè€Œç”»å¸ƒä»ç„¶æ˜¯\u0026quot;æ‰­æ›²çš„\u0026rdquo;(warped)ã€‚ç°åœ¨ä½ çš„ä½ç½®å·²ç»æ­£ç¡®äº†ï¼Œåªè¦æ­£ç¡®çš„æ—‹è½¬å°±å¯ä»¥åƒæ­£å¸¸çš„é‚£æ ·ç”»å‡ºçŸ¢é‡çš„ 'arrow head'ã€‚\nä¾‹å¦‚ï¼Œè¿™é‡Œæˆ‘ä»¥-35åº¦è§’ç”Ÿæˆä¸€ä¸ª70åƒç´ é•¿çš„çŸ¢é‡ã€‚\nvector_head=\u0026#34;path \u0026#39;M 0,0 l -15,-5 +5,+5 -5,+5 +15,-5 z\u0026#39;\u0026#34; indicator=\u0026#34;path \u0026#39;M 10,0 l +15,+5 -5,-5 +5,-5 -15,+5 m +10,0 +20,0 \u0026#39;\u0026#34; convert -size 100x100 xc: \\  -draw \u0026#34;stroke black fill none circle 20,50 23,50 push graphic-context stroke blue fill skyblue translate 20,50 rotate -35 line 0,0 70,0 translate 70,0 $vector_headpop graphic-context push graphic-context stroke firebrick fill tomato translate 20,50 rotate 40 $indicatortranslate 40,0 rotate -40 stroke none fill firebrick text 3,6 \u0026#39;Center\u0026#39; pop graphic-context \u0026#34; \\  arrow_with_tails.gif æŒ‡ç¤ºç®­å¤´ åœ¨ä¸Šé¢æˆ‘è¿˜æ¼”ç¤ºäº†ä¸€ä¸ªæŒ‡ç¤ºç®­å¤´ï¼ŒæŒ‡å‘ä¹‹å‰çŸ¢é‡ç®­å¤´çš„èµ·ç‚¹ã€‚\nç„¶è€Œæˆ‘æ²¡æœ‰åƒä¹‹å‰é‚£æ ·ç”»ç®­å¤´ï¼Œè€Œæ˜¯å°†å®ƒåˆ›å»ºä¸ºä¸€ä¸ªåå‘çš„ç®­å¤´ç¬¦å·ï¼Œå®ƒçš„èµ·å§‹ç‚¹è·ç¦»åŸç‚¹ï¼ˆæˆ–èµ·å§‹ç‚¹ï¼‰10åƒç´ ã€‚è¿™æ˜¯ä¸€ä¸ªç¬¦å·ä½äºæˆ‘æƒ³è¦æŒ‡ç¤ºçš„ä½ç½®ï¼Œæ‰€ä»¥æˆ‘å®é™…ä¸Šå¹¶ä¸å¸Œæœ›ç®­å¤´ç›´æ¥åœ¨é‚£ä¸ªä½ç½®ä¸Šé¢ï¼Œè€Œæ˜¯ç¦»å®ƒç¨å¾®è¿œä¸€ç‚¹ã€‚\nç°åœ¨ï¼Œè™½ç„¶æŒ‡ç¤ºç¬¦æ¯”å‘é‡å¤„ç†èµ·æ¥æ›´ç®€å•ï¼Œé€šå¸¸ä¸éœ€è¦å¯å˜é•¿åº¦ï¼Œä½†ä½ é€šå¸¸è¦åœ¨æŒ‡ç¤ºç¬¦çš„è¿œç«¯æ·»åŠ æ–‡å­—æ¥æŒ‡å®šæŒ‡ç¤ºçš„å†…å®¹ã€‚å’Œä¹‹å‰ä¸€æ ·ï¼Œè®¡ç®—è¿™ä¸ªä½ç½®å¯èƒ½å¾ˆå›°éš¾ï¼Œä½•å¿…å‘¢ã€‚\næ–‡å­—å®šä½çš„è§£å†³æ–¹æ³•ä¹Ÿå’Œå‘é‡ä¸€æ ·ã€‚ä¿ç•™åŸæ¥ç”¨äºç»˜åˆ¶æŒ‡ç¤ºç®­å¤´çš„ç¿˜æ›²ç©ºé—´ï¼Œå¹¶å°†åŸç‚¹è½¬æ¢åˆ°è¯¥ç®­å¤´çš„å°¾ç«¯ï¼ˆåœ¨ç¿˜æ›²ç©ºé—´ä¸­æ°´å¹³40åƒç´ ï¼‰ã€‚ç°åœ¨æˆ‘ä»¬å·²ç»é‡æ–°å®šä½äº†ï¼Œæˆ‘ä»¬å¯ä»¥å›´ç»•è¿™ä¸ªæ–°çš„ä½ç½®è§£é™¤æ‰­æ›²ï¼Œè¿™æ ·ä½ å°±å¯ä»¥åƒæ­£å¸¸çš„é‚£æ ·ç»˜åˆ¶æ–‡æœ¬ï¼ˆæœ‰è½»å¾®çš„åç§»ï¼‰ã€‚\nä¸å¹¸çš„æ˜¯ï¼Œè™½ç„¶é»˜è®¤çš„æ–‡å­—å¯¹é½æ–¹å¼æ˜¯\u0026quot;å·¦\u0026rdquo;ï¼Œä½†ç›®å‰ä½ ä¸èƒ½åœ¨ MVG ä¸­æŒ‡å®šæ–‡å­—å¯¹é½æ–¹å¼ï¼Œä½œä¸ºé‡åŠ›çš„å•ç‹¬è®¾ç½®ã€‚å¦‚æœè¿™æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œè¯·åœ¨ IM bugs è®ºå›ä¸Šæå‡ºè¯·æ±‚ï¼Œå¸Œæœ›æ–‡æœ¬å¯¹é½ï¼ˆä½œä¸ºç‹¬ç«‹äºé‡åŠ›å®šä½ï¼‰èƒ½å¤Ÿæˆä¸ºç°å®ï¼Œå°¤å…¶æ˜¯å®ƒå®é™…ä¸Šæ˜¯ SVG è§„èŒƒçš„ä¸€éƒ¨åˆ†ã€‚\nç»˜åˆ¶å¯¹è±¡ å®½å¹¿çš„è‰²å½©ç¬”è§¦ ä½ ä¸éœ€è¦ç”¨è·¯å¾„æˆ–è½®å»“å®Œå…¨å°é—­å¡«å……åŒºåŸŸï¼Œå°±èƒ½åˆ›é€ å‡ºå„ç§å½¢çŠ¶ã€‚ä½¿ç”¨éå¸¸å¤§å’Œå®½çš„ç¬”è§¦ï¼Œä½ å¯ä»¥åœ¨ç”»å¸ƒä¸Šç”Ÿæˆå¤§é¢ç§¯çš„é¢œè‰²å’Œè‰²å—ã€‚\nä¾‹å¦‚ï¼Œä¸€ä¸ªå®½é˜”çš„ç¬”è§¦æ¤­åœ†å¼§å½¢å¯ä»¥ç”Ÿæˆä¸€ä¸ªæ¼‚äº®çš„é¢œè‰²åŒºåŸŸï¼Œæˆ‘å®é™…ä¸Šå·²ç»çœ‹åˆ°ç”¨äºåˆ›å»ºæµ·æŠ¥ã€‚\nconvert -size 100x100 xc: -fill none -stroke powderblue \\  -draw \u0026#39;stroke-width 70 ellipse -30,0 90,90 10,50\u0026#39; \\  -rotate 180 arc_background.gif æˆ–è€…ä½ å¯ä»¥ç”Ÿæˆä¸€ä¸ªå°ä¸‘ç›¸å½“å¤æ‚çš„ç¬‘å®¹ã€‚\nconvert -size 100x100 xc: \\  -draw \u0026#39;fill none stroke-linecap round stroke-width 40 stroke tomato ellipse 50,0 70,70 65,115 stroke-width 2 stroke black ellipse 50,0 70,70 60,120 stroke-width 40 stroke palegreen line 50,40 50,40.01\u0026#39; clown.gif ä½ èƒ½æƒ³å‡ºä»€ä¹ˆåŠæ³•ï¼Ÿè¯·å‘Šè¯‰æˆ‘ä»¬ã€‚\nåœ†æŸ±ä½“ åœ¨ IM è®ºå›çš„è®¨è®ºä¸­ï¼Œæœ‰ä¸€ä¸ªå…³äºä½¿ç”¨ ImageMagick ç»˜åˆ¶å‘½ä»¤ç»˜åˆ¶åœ†æŸ±ä½“ï¼ˆç‰¹åˆ«æ˜¯é˜´å½±åœ†æŸ±ä½“ï¼‰çš„é‡è¦è®¨è®ºã€‚\nç»˜åˆ¶åœ†æŸ±ä½“çš„è¯€çªæ˜¯ç»˜åˆ¶ roundrectangle åŸè¯­ï¼Œä½¿å…¶æœ«ç«¯å½¢æˆæ¤­åœ†å½¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåœ†æŸ±ä½“çš„å®½åº¦ä¸º 50 åƒç´ ï¼Œåˆ™å°†çŸ©å½¢çš„è§’åˆ†åˆ«èˆå» 25 å’Œ 12 åƒç´ ã€‚è¿™å°±æ˜¯çŸ©å½¢å®½åº¦çš„ä¸€åŠï¼Œç„¶åå†å‡åŠã€‚\nè¿™æ ·ï¼Œä¸€ä¸ªåœ†æŸ±ä½“å°±å˜æˆäº†ä¸¤ä¸ªç›¸äº’å åŠ çš„åœ†è§’çŸ©å½¢ã€‚ç¬¬äºŒä¸ªé¢œè‰²å¡«å……çš„ 'end oval' çš„å¤§å°æ­£å¥½æ˜¯ä¸¤ä¸ªè§’çš„ä¸¤å€ã€‚ä¾‹å¦‚\u0026hellip;\nconvert -size 60x100 xc:white -stroke snow4 \\  -fill chartreuse3 -draw \u0026#39;roundrectangle 5,5 55,95 25,12\u0026#39; \\  -fill chartreuse2 -draw \u0026#39;roundrectangle 5,5 55,29 25,12\u0026#39; \\  cylinder.gif é€šè¿‡å°†ç¬¬ä¸€ç§å¡«å……è‰²æ›¿æ¢ä¸ºæ¸å˜è‰²ï¼ˆä½¿ç”¨è®°å¿†ä¸­çš„å¹³é“ºæŠ€æœ¯ï¼‰ï¼Œä½ å¯ä»¥è®©åœ†æŸ±ä½“çœ‹èµ·æ¥æ›´åƒ3D\u0026hellip;\u0026hellip;ã€‚\nconvert -size 60x100 xc:white -stroke snow4 \\  \\( -size 1x60 gradient:chartreuse1-chartreuse4 -rotate -90 \\  -write mpr:shading +delete \\) \\  -tile mpr:shading -draw \u0026#39;roundrectangle 5,5 55,95 25,12\u0026#39; +tile \\  -fill chartreuse2 -draw \u0026#39;roundrectangle 5,5 55,29 25,12\u0026#39; \\  cylinder_shade.gif é€šè¿‡æ…¢æ…¢å®Œå–„åœ†æŸ±ä½“çš„ç»˜åˆ¶ï¼ˆå¦‚IMè®ºå›ä¸­è®¨è®ºçš„é‚£æ ·ï¼‰ï¼Œä½ å¯ä»¥èµ°å¾ˆé•¿çš„è·¯æ¥ç”Ÿæˆéå¸¸å¤æ‚å’Œå…·æœ‰è§†è§‰å¸å¼•åŠ›çš„åœ†æŸ±ä½“ã€‚è¿™åŒ…æ‹¬å¢åŠ å°é—­åŠé€æ˜ç»ç’ƒåœ†æŸ±ä½“ã€é˜´å½±æ•ˆæœå’Œæ ‡ç­¾ã€‚\nè¯¥è®¨è®ºçš„æœ€ç»ˆç»“æœæ˜¯ä¸€ä¸ªè„šæœ¬ \u0026ldquo;cylinder_bar\u0026quot;ï¼Œç”Ÿæˆä¸€ä¸ªåœ†æŸ±ä½“ç™¾åˆ†æ¯”æ¡\u0026hellip;\u0026hellip;\ncylinder_bar 95 cylinder_95.png è¯¥è„šæœ¬å¯ä»¥ç”Ÿæˆä»»ä½•å°ºå¯¸çš„å›¾åƒï¼Œæ ¹æ®è¯¥å°ºå¯¸å’Œè„šæœ¬é¡¶éƒ¨å®šä¹‰çš„å…¶ä»–è®¾ç½®é€‚å½“è°ƒæ•´æ‰€æœ‰å‚æ•°ã€‚è¿˜åŒ…æ‹¬ glass thickness çš„æ¦‚å¿µï¼Œåœ¨ä¸€ä¸ªå°é—­çš„åŠé€æ˜ç»ç’ƒåœ†æŸ±ä½“å’Œå†…éƒ¨çš„å½©è‰²åœ†æŸ±ä½“ä¹‹é—´åˆ›é€ ä¸€ä¸ªé—´éš™ã€‚\nè¯·æ³¨æ„åœ†æŸ±ä½“éå¸¸å¾®å¦™çš„é˜´å½±ï¼Œç‰¹åˆ«æ˜¯å½“ç»¿è‰²åœ†æŸ±ä½“çš„æœ«ç«¯ä¸ç»ç’ƒåœ†æŸ±ä½“çš„æœ«ç«¯é‡å æ—¶ã€‚åªè¦ç¨åŠ é¢„æƒ³ï¼Œå°±èƒ½åšå‡ºæƒŠäººçš„æ•ˆæœã€‚\nåœ¨æ–‡å­—ä¸²ä¸­ç»˜åˆ¶ç‰¹æ®Šå­—ç¬¦ å¼•å·è¿˜æ˜¯åæ–œæ ï¼Ÿ äººä»¬åœ¨ä½¿ç”¨ -draw æ—¶é‡åˆ°çš„æœ€å¤§çš„é—®é¢˜ä¹‹ä¸€æ˜¯ç»˜åˆ¶å­—ç¬¦ï¼Œè¿™äº›å­—ç¬¦å¯¹ UNIX shell å’Œ DOS å‘½ä»¤è¡Œç”šè‡³å…¶ä»–è¯­è¨€å¦‚ Cã€Perlã€PHPã€R æˆ– Visual Basic éƒ½æœ‰ç‰¹æ®Šæ„ä¹‰ã€‚\nåœ¨è¿™æ–¹é¢æœ€å¤§çš„ç½ªé­ç¥¸é¦–æ˜¯ä¸¤ç§ç±»å‹çš„å¼•å·å­—ç¬¦ï¼Œä»¥åŠå˜é‡æ›¿æ¢å­—ç¬¦ï¼Œå¦‚ç¾å…ƒ '$' å’Œ shell å’Œ ImageMagick çš„è½¬ä¹‰å­—ç¬¦ï¼Œåæ–œæ  '\\'ã€‚\nåŸºæœ¬ä¸Šä½œä¸º -draw çš„MVGå‚æ•°éœ€è¦åŠ å¼•å·ï¼Œè€Œé‡Œé¢çš„ 'text' å­—ç¬¦ä¸²å‚æ•°ä¹Ÿå¯èƒ½éœ€è¦ä¸€äº›é¢å¤–çš„å¼•å·ã€‚\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œç”¨æˆ·é€šå¸¸ä¼šä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„å¼•å·å­—ç¬¦ï¼Œä¸€ä¸ªç”¨äº shellï¼Œå¦ä¸€ä¸ªç”¨äº MVG æ–‡æœ¬å­—ç¬¦ä¸²ã€‚\n-draw \u0026#39;... text 0,0 \u0026#34;string\u0026#34; ...\u0026#39; éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äº windows ç”¨æˆ·æ¥è¯´ï¼Œè¿™æ˜¯å”¯ä¸€çœŸæ­£çš„é€‰æ‹©ï¼Œå®ƒæœ‰è‡ªå·±çš„å¼•å·é—®é¢˜å’Œæ–¹æ³•ã€‚æˆ–è€…ä»–ä»¬ä¼šäº¤æ¢å¼•å·ï¼Œç”¨\u0026hellip;\n-draw \u0026#34;... text 0,0 \u0026#39;string\u0026#39; ...\u0026#34; å®ƒå…è®¸ä½ åŒ…å« shell å˜é‡æ›¿æ¢(ä½¿ç”¨ '$' è€Œä¸è¿›è¡Œè½¬ä¹‰ã€‚)\né€‰æ‹©æ­£ç¡®çš„å½¢å¼å¯ä»¥è§£å†³å¤§å¤šæ•°é—®é¢˜ï¼Œä½†æœ‰äº›å­—ç¬¦ä»ç„¶å­˜åœ¨å›°éš¾ï¼Œæ¯ä¸ªè§£å†³æ–¹æ¡ˆéƒ½å–å†³äºä½ åˆ°åº•ä½¿ç”¨å“ªä¸€ç»„å¼•å·ï¼Œå› ä¸ºå®ƒä»¬ä¹Ÿå®šä¹‰äº†ç‰¹æ®Šå­—ç¬¦åº”è¯¥å¦‚ä½•è½¬ä¹‰ã€‚\nä»¥ä¸‹æ˜¯å››ç§æƒ…å†µä¸‹çš„å¼•å·ï¼Œä»¥åŠç‰¹æ®Šå­—ç¬¦çš„å¤„ç†\u0026hellip;\n å¯¹ shell å‚æ•°ä½¿ç”¨å•å¼•å·ï¼Œå¯¹ MVG æ–‡æœ¬å­—ç¬¦ä¸²å‘¨å›´ä½¿ç”¨åŒå¼•å·ã€‚  å¤„ç†ç»˜åˆ¶æ–‡æœ¬å­—ç¬¦ä¸²çš„æœ€ç®€å•çš„æŠ€æœ¯æ˜¯ä¸ºåŒ…è£… shell å‚æ•°ä½¿ç”¨å•å¼•å·ã€‚ç„¶è€Œï¼Œè¿™æ„å‘³ç€è¦åœ¨ç»˜åˆ¶çš„å­—ç¬¦ä¸²ä¸­åŒ…å«ä¸€ä¸ªæ’‡å·ï¼Œä½ éœ€è¦ç¦»å¼€ shell çš„\u0026quot;å•å¼•å·æ¨¡å¼\u0026rdquo;ï¼Œå¹¶åœ¨ shell çš„å•å¼•å·ä¹‹å¤–æä¾›æ’‡å·ã€‚\nä¾‹å¦‚ï¼Œè¿™é‡Œæ˜¯å¦‚ä½•å¤„ç†æˆ‘æåˆ°çš„å››ä¸ªç‰¹æ®Šå­—ç¬¦ã€‚\nconvert -size 250x50 xc:none -box white -pointsize 20 -gravity center \\  -draw \u0026#39;text 0,0 \u0026#34; \u0026#39;\\\u0026#39;\u0026#39; \\\u0026#34; $ \\\\ \u0026#34; \u0026#39; \\  -trim +repage text_special_sd.gif è¯·æ³¨æ„ï¼Œç”±äºç¾å…ƒç¬¦å·ä¸éœ€è¦è½¬ä¹‰ï¼Œä½ ä¹Ÿä¸èƒ½ç”¨å®ƒæ¥æ›¿ä»£ shell å˜é‡çš„å†…å®¹ã€‚\né‡è¦çš„æ˜¯è¦è®°ä½ï¼Œåæ–œæ æ˜¯IMç»˜å›¾å­—ç¬¦ä¸²å¤„ç†çš„å”¯ä¸€ç‰¹æ®Šå­—ç¬¦ã€‚åŒæ—¶ï¼Œå®ƒå­˜åœ¨çš„åŸå› ä¹Ÿçº¯ç²¹æ˜¯ä¸ºäº†è®©ä½ å¯ä»¥è½¬ä¹‰ä»»ä½•\u0026quot;IM ç»˜åˆ¶å­—ç¬¦ä¸²å¼•å·\u0026rdquo;ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨ä¸Šé¢ä½¿ç”¨çš„åŒå¼•å·ã€‚é™¤æ­¤ä»¥å¤–ï¼Œå…¶ä»–æ‰€æœ‰çš„æ€ªå¼‚éƒ½æ˜¯ç”± UNIX å‘½ä»¤è¡Œ shell å¼•èµ·çš„ï¼Œè€Œä¸æ˜¯ IMã€‚\nPC-DOS æœ‰å®ƒè‡ªå·±çš„æ€ªå¼‚ä¹‹å¤„ï¼Œæˆ‘å¸Œæœ›åœ¨ä½¿ç”¨ç¯å¢ƒä¸­çš„IMæ—¶ï¼Œèƒ½å¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ã€‚\n åœ¨ shell å‚æ•°ä¸­ä½¿ç”¨åŒå¼•å·ã€‚ åœ¨ MVG æ–‡æœ¬å­—ç¬¦ä¸²å‘¨å›´ä½¿ç”¨å•å¼•å·ã€‚  å¦‚æœä½ ç¡®å®æƒ³åœ¨ç»˜åˆ¶çš„å­—ç¬¦ä¸²ä¸­æ’å…¥ä¸€ä¸ª \u0026lsquo;shell variable\u0026rsquo;ï¼Œé‚£ä¹ˆä½ å°†ä¸å¾—ä¸åœ¨ shell å‚æ•°çš„å¤–é¢ä½¿ç”¨åŒå¼•å·ã€‚è¿™ä½¿å¾—æ•´ä¸ªäº‹æƒ…å˜å¾—æ›´åŠ å¤æ‚ï¼Œå› ä¸ºä½ å¤±å»äº† shell çš„ä¿æŠ¤ï¼Œä½ ç°åœ¨ä¸ä»…è¦è½¬ä¹‰ç¾å…ƒ '$' ç¬¦å·ï¼Œè€Œä¸”è¿˜è¦è½¬ä¹‰åæ–œæ  '\\'ã€‚\nå¦ä¸€æ–¹é¢ï¼Œshell å°†ä¸éœ€è¦ä½¿ç”¨å•å¼•å·å­—ç¬¦ä½œä¸ºå®ƒçš„å‚æ•°ç»“æŸé™åˆ¶å­—ç¬¦ï¼Œæ‰€ä»¥è¿™æ–¹é¢è¢«ç®€åŒ–äº†ã€‚è®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹æˆ‘ä»¬çš„ç‰¹æ®Šå­—ç¬¦çŸ­åå•çš„ç»“æœã€‚\nconvert -size 250x50 xc:none -box white -pointsize 20 -gravity center \\  -draw \u0026#34;text 0,0 \u0026#39; \\\\\u0026#39; \\\u0026#34; \\$ \\\\\\\\ \u0026#39; \u0026#34; \\  -trim +repage text_special_ds.gif è¯·æ³¨æ„ï¼Œå¦‚æœä½ æƒ³ç”»ä¸€ä¸ªåæ–œçº¿æœ¬èº«ï¼ŒMVG æ–‡æœ¬å­—ç¬¦ä¸²éœ€è¦å°†åæ–œçº¿åŠ å€ï¼ˆå¦‚å‰é¢çš„ä¾‹å­ï¼‰ï¼Œä½†æ˜¯ shell æœ¬èº«ä¹Ÿéœ€è¦å°†æ¯ä¸ªåæ–œçº¿åŠ å€ï¼Œæ€»å…±äº§ç”Ÿå››ä¸ªåæ–œçº¿æ‰èƒ½äº§ç”Ÿä¸€ä¸ªè¿™æ ·çš„å­—ç¬¦ã€‚\nè¿™ç§ç¿»å€å¾ˆå¿«å°±ä¼šè®©äººä¸çŸ¥æ‰€æªï¼Œéœ€è¦å¤§é‡çš„åæ–œæ æ‰èƒ½è¾¾åˆ°ä½ æƒ³è¦çš„æ•ˆæœã€‚åªè¦é‡‡å–çš„æ˜¯æ…¢æ…¢çš„ã€ç®€å•çš„æ–¹æ³•ï¼Œä½ å°±ä¼šé’ˆå¯¹è‡ªå·±çš„æƒ…å†µæƒ³å‡ºåŠæ³•ã€‚\n ä½¿ç”¨å•å¼•å·è¿›è¡Œ shell è®ºè¯ã€‚ ä¸ MVG æ–‡æœ¬å­—ç¬¦ä¸²å‘¨å›´çš„å•å¼•å·ã€‚  æœ€åï¼Œè®©æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹æœ€åä¸¤ç§å¼•å·ç»„åˆã€‚æˆ‘å°†è®©ä½ å»å¼„æ¸…æ¥šå®ƒä»¬æ˜¯å¦‚ä½•è¢« shell å’Œ MVG è§£ç çš„ã€‚\nconvert -size 250x50 xc:none -box white -pointsize 20 -gravity center \\  -draw \u0026#39;text 0,0 \u0026#39;\\\u0026#39;\u0026#39; \\\u0026#39;\\\u0026#39;\u0026#39; \u0026#34; $ \\\\ \u0026#39;\\\u0026#39;\u0026#39; \u0026#39; \\  -trim +repage text_special_ss.gif  åœ¨shellå‚æ•°ä¸­ä½¿ç”¨åŒå¼•å·ã€‚  åœ¨ MVG æ–‡æœ¬å­—ç¬¦ä¸²å‘¨å›´åŠ ä¸ŠåŒå¼•å·ã€‚\nconvert -size 250x50 xc:none -box white -pointsize 20 -gravity center \\  -draw \u0026#34;text 0,0 \\\u0026#34; \u0026#39; \\\\\\\u0026#34; \\$ \\\\\\\\ \\\u0026#34;\u0026#34; \\  -trim +repage text_special_dd.gif æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œæ¥è‡ªå‘½ä»¤è¡Œçš„ -draw å‚æ•°æ—¢è¦å¤„ç†å‘½ä»¤è¡Œ shellï¼Œä¹Ÿè¦å¤„ç† MVG æ–‡æœ¬å­—ç¬¦ä¸²ä¸­çš„åæ–œæ å’Œå¼•å·è½¬ä¹‰ã€‚å…¶ç»“æœå¯èƒ½ä¼šè®©äººæ„Ÿåˆ°å›°æƒ‘å’Œæ£˜æ‰‹ã€‚åªè¦è®°ä½ï¼Œshell å¯¹è¿™ä¸¤ç§å¼•å·çš„å¤„ç†æ–¹å¼ä¸åŒï¼Œè€Œ MVG æ–‡æœ¬å­—ç¬¦ä¸²åˆ™ä¸åŒã€‚\nå½“ç„¶ï¼Œåœ¨å¤æ‚çš„è„šæœ¬ä¸­ï¼Œæ›´å¥½çš„æ–¹æ³•å¯èƒ½æ˜¯å®Œå…¨é¿å… shell å’Œä»»ä½•è„šæœ¬é—®é¢˜ã€‚ä½ å¯ä»¥é€šè¿‡è¯»å– MVG ç»˜å›¾æ–‡ä»¶ä¸­çš„ -draw å‚æ•°æ¥å®ç°ã€‚\n-draw @drawfile.mvg å½“ç„¶ï¼Œä½ ä»ç„¶éœ€è¦å¯¹ä½ ä½¿ç”¨çš„ä»»ä½•å¼•å·å­—ç¬¦è¿›è¡Œåæ–œæ å¤„ç†ï¼Œä»¥åŠå¯¹æ–‡æœ¬ä¸­çš„ä»»ä½•åæ–œæ è¿›è¡Œå¤„ç†ã€‚ç„¶è€Œï¼Œè¿™æ¯”èµ·åŒæ—¶å¤„ç† shell è‡ªå·±çš„å¼•å·å’Œè½¬ä¹‰ç³»ç»Ÿè¦ç®€å•å¾—å¤šã€‚\nconvert -size 500x50 xc:lightblue -font Candice -pointsize 36 \\  -gravity center -draw @text_quotes.mvg text_quotes.gif ç¬¬ä¸€å¼ å›¾ç‰‡æ¥è‡ªæˆ‘ä½¿ç”¨çš„ä¸€ä¸ª \u0026ldquo;MVG\u0026rdquo; æ–‡æœ¬æ–‡ä»¶ã€‚å®ƒä¸åŒ…å«è½¬ä¹‰ç¬¦æˆ–å¼•å·ã€‚å› æ­¤ï¼Œåªæœ‰ MVG å¼•å·å’Œè½¬ä¹‰ç¬¦æ˜¯å­˜åœ¨çš„ã€‚\nè¯·æ³¨æ„ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœæˆ‘å¯¹ MVG æ–‡æœ¬å­—ç¬¦ä¸²ä½¿ç”¨äº†å•å¼•å·ï¼Œå”¯ä¸€çš„å˜åŒ–æ˜¯æˆ‘éœ€è¦å¯¹å­—ç¬¦ä¸²ä¸­çš„å•å¼•å·å­—ç¬¦è¿›è¡Œåæ–œæ å¤„ç†ï¼Œè€Œä¸æ˜¯åŒå¼•å·å­—ç¬¦ã€‚\nå…³äºç™¾åˆ†æ¯”å­—ç¬¦ æœ€åä¸€ç‚¹æ˜¯å…³äº \u0026quot;-draw text\u0026quot; æ“ä½œç¬¦ä¸­çš„ç‰¹æ®Š escape å­—ç¬¦ã€‚ç™¾åˆ†å·å­—ç¬¦ \u0026quot;%\u0026quot; åº”è¯¥\u0026quot;æŒ‰åŸæ ·\u0026quot;ç»˜åˆ¶ã€‚ä½ ä¸éœ€è¦åšä»»ä½•ç‰¹æ®Šçš„æ“ä½œæ¥ç»˜åˆ¶å®ƒä»¬ã€‚å¦‚æœå®ƒä»¬ä¸èƒ½\u0026quot;æŒ‰åŸæ ·\u0026quot;ç»˜åˆ¶ï¼Œé‚£ä¹ˆä½ çš„IMç‰ˆæœ¬è¾ƒæ—§ï¼Œåº”è¯¥å°½å¿«å‡çº§ã€‚\n ç›´åˆ°IM 6.2.4ç‰ˆæœ¬ï¼Œ\u0026quot;%\u0026quot; å­—ç¬¦è¢«ç”¨ä½œè½¬ä¹‰å­—ç¬¦ï¼Œåœ¨ç»˜åˆ¶çš„æ–‡æœ¬å­—ç¬¦ä¸²ä¸­åŒ…å«é¢å¤–çš„å›¾åƒä¿¡æ¯ã€‚ç°åœ¨ä¸å†æ˜¯è¿™æ ·äº†ï¼Œå› ä¸ºå½“SVGå›¾åƒä¹Ÿè¯•å›¾ç»˜åˆ¶ç™¾åˆ†æ•°å­—ç¬¦æ—¶ï¼Œè¿™ç§è½¬ä¹‰ç¬¦æ˜¯æ··ä¹±å’Œä¸æ­£ç¡®çš„ã€‚ ç™¾åˆ†å· \u0026ldquo;è½¬ä¹‰ç¬¦ \u0026ldquo;çš„ä½¿ç”¨ï¼ˆä»¥åŠ\u0026rdquo;/n \u0026ldquo;æ¢è¡Œç¬¦ï¼‰è¢«è®¤ä¸ºä¸ -draw æ“ä½œç¬¦å’ŒMVGæ ¼å¼å¤„ç†SVGå›¾åƒæ ¼å¼çš„é¢„æœŸç”¨é€”ä¸å…¼å®¹ã€‚å› æ­¤ï¼Œä» IM 6.2.4 ç‰ˆæœ¬å¼€å§‹ï¼Œ%è½¬ä¹‰å°±ä¸é€‚ç”¨äº†ï¼Œåæ–œæ åªèƒ½è½¬ä¹‰è‡ªå·±å’Œå‘¨å›´çš„å¼•å·ã€‚\n convert -size 250x50 xc:none -box white -pointsize 20 -gravity center \\  -draw \u0026#39;text 0,0 \u0026#34;%w\\n%h\u0026#34;\u0026#39; -trim +repage text_escapes.gif å…³äº\u0026quot;ç™¾åˆ†æ¯”é”™è¯¯\u0026quot;çš„æ›´å¤šç»†èŠ‚ï¼Œä»¥åŠåœ¨æ—§ç‰ˆ ImageMagick ä¸­ä½¿ç”¨ -draw æ—¶é¿å…è¯¥é”™è¯¯çš„æ–¹æ³•ï¼Œè¯·å‚è§ Drawing a Percent Bug é¡µé¢ã€‚\nç”¨æ³¨é‡Šä»£æ›¿ç»˜åˆ¶ é¿å…è¿™ç±»é—®é¢˜çš„è¾ƒå¥½æ–¹æ³•æ˜¯ä½¿ç”¨ [-annotate](https://imagemagick.org/Usage/option_link.cgi?annotate) è€Œä¸æ˜¯ draw æ¥ç»˜åˆ¶æ–‡æœ¬ã€‚è¿™ä¸ªæ“ä½œç¬¦æ˜¯ draw æ“ä½œç¬¦çš„ä¸€ä¸ªå°è£…å™¨ï¼Œå¯ä»¥ä½¿ç”¨ draw çš„æ‰€æœ‰åŠŸèƒ½ï¼Œä½†å½¢å¼æ›´ç®€å•ã€‚\nåŸºæœ¬ä¸Šè¿™ä¸ªæ“ä½œç¬¦åªéœ€è¦ä¸€ç»„å¼•å·ï¼ˆå¯¹äº shellï¼‰ã€‚è¿™ä½¿å¾—å¤„ç†ç‰¹æ®Šå­—ç¬¦å˜å¾—æ›´åŠ ç®€å•ã€‚\nä¸å¹¸çš„æ˜¯ï¼Œè™½ç„¶ä½ ä¸å†éœ€è¦ä¸º IM è½¬ä¹‰å¼•å·ï¼Œä½†ä½ ç°åœ¨æœ‰ç™¾åˆ†æ¯”è½¬ä¹‰ï¼Œå¦‚ '@' æ–‡ä»¶è¯»å–ï¼Œ'\\n' æ¢è¡Œï¼Œä»¥åŠå…¶ä»–ç™¾åˆ†å·è½¬ä¹‰æ‰©å±•ã€‚\nä¾‹å¦‚ï¼Œä½¿ç”¨å•å¼•å·\u0026hellip;\nconvert -size 200x50 xc:none -box white -pointsize 20 -gravity center \\  -annotate 0 \u0026#39;\\@ \u0026#39;\\\u0026#39;\u0026#39; \u0026#34; $ \\\\ %% \u0026#39; \\  -trim +repage annotate_s.gif è€Œå¯¹äºåŒå¼•å·\u0026hellip;\nconvert -size 200x50 xc:none -box white -pointsize 20 -gravity center \\  -annotate 0 \u0026#34;\\@ \u0026#39; \\\u0026#34; \\$ \\\\\\\\ %% \u0026#34; \\  -trim +repage annotate_d.gif ç„¶è€Œï¼Œå¦‚æœä½ ä½¿ç”¨ '@' è½¬ä¹‰ç¬¦ä»æ–‡ä»¶ä¸­è¯»å–å­—ç¬¦ä¸²ï¼Œæ‰€æœ‰çš„æ³¨é‡Šå¼•å·å’Œè½¬ä¹‰ç¬¦å°†è¢«å®Œå…¨å¿½ç•¥ã€‚\nä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨è¿™é‡ŒåŒ…å«äº†ä¸€ä¸ªå›¾åƒçš„å®½åº¦å’Œé«˜åº¦çš„ä¿¡æ¯!\nconvert -size 200x50 xc:none -box white -pointsize 20 -gravity center \\  -annotate 0 \u0026#39;%w\\n%h\u0026#39; -trim +repage annotate_percents.gif ç„¶è€Œï¼Œå½“ä»æ–‡ä»¶ä¸­è¯»å–æ³¨é‡Šå­—ç¬¦ä¸²æ—¶ï¼Œæ‰€æœ‰çš„è½¬ä¹‰éƒ½ä¼šè¢«å®Œå…¨å¿½ç•¥ã€‚\necho -n \u0026#39;@ %w\\n%h\u0026#39; |\\  convert -size 200x50 xc:none -box white -pointsize 20 -gravity center \\  -annotate 0 \u0026#39;@-\u0026#39; -trim +repage annotate_file.gif æ›´å¤šä¿¡æ¯è¯·å‚è§ Annotate Text Drawing Operatorï¼Œç‰¹åˆ«æ˜¯ Annotate Escape Charactersã€‚\nIM å’Œ SVG å¤„ç† SVG è¾“å…¥é©±åŠ¨ã€‚RSVG ä¸ MSVG å¤„ç†å®é™…çš„ SVG å›¾åƒæ ¼å¼æ˜¯ä¸€é¡¹éå¸¸å¤æ‚çš„å·¥ä½œã€‚å¼•æ“éœ€è¦å¤„ç† SVG\u0026ndash;å¯ç¼©æ”¾çŸ¢é‡å›¾å½¢æ–‡æ¡£æ‰€å®šä¹‰çš„æ‰€æœ‰æ–¹é¢ã€‚è¿™éœ€è¦å¤§é‡çš„ç¼–ç¨‹å·¥ä½œå’Œæ—¶é—´ã€‚\nå› æ­¤ï¼ŒImageMagick åœ¨ SVG æ ¼å¼å›¾åƒçš„å¤„ç†ä¸Šæä¾›äº†ä¸¤ç§æ–¹æ³•ã€‚ç¬¬ä¸€ç§æ˜¯ä½¿ç”¨ä¸€ä¸ªå¼€æºçš„ RSV Gåº“ï¼Œå°† SVG æ ¼å¼è½¬æ¢æˆ IM æ²¡æœ‰é—®é¢˜çš„å…‰æ …å›¾åƒã€‚è¿™ä¸ªå¼•æ“å‡ ä¹åœ¨ SVG å¤„ç†çš„æ‰€æœ‰æ–¹é¢éƒ½æ˜¯å®Œæ•´çš„ã€‚\nç¬¬äºŒç§æ–¹æ³•æ˜¯IMå°è¯•å°† SVG è½¬æ¢ä¸º MVGï¼Œä½¿ç”¨ä¸€ä¸ªåä¸º MSVG çš„å†…ç½®IMæ–¹æ³•ã€‚MSVG è¯•å›¾å°†SVGå›¾åƒè½¬æ¢æˆIMçš„ -draw è¿ç®—ç¬¦ \u0026ldquo;MVG\u0026quot;ç»˜å›¾è¯­è¨€ã€‚ç»˜åˆ¶ MVG çš„å¾ˆå¤šåŠŸèƒ½éƒ½æ˜¯ä¸“é—¨ä¸ºæ­¤è€Œåˆ›å»ºçš„ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè™½ç„¶åŸºæœ¬çš„çº¿æ¡ç»˜åˆ¶å’Œç€è‰²åŠŸèƒ½æ˜¯å­˜åœ¨çš„ï¼Œä½†å®ƒè¿œä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„ SVG è½¬æ¢å™¨ã€‚\nä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ç‰¹æ®Šçš„è¾“å…¥æ ¼å¼ \u0026ldquo;MSVG:\u0026quot;ï¼ˆIM v6.3.4æ–°å¢ï¼‰è¯»å– SVG å›¾åƒæ¥å¼ºåˆ¶ä½¿ç”¨å†…éƒ¨çš„ MSVG è½¬æ¢å™¨ã€‚ä½†å¦‚æœ RSVG åº“å­˜åœ¨ï¼Œå¤§å¤šæ•° ImageMagick å°†ä½¿ç”¨å®ƒæ¥æ¸²æŸ“ SVG å›¾åƒã€‚\nè¦æ‰¾å‡ºä½ çš„ IM ä¼šåšä»€ä¹ˆï¼Œè¯·ç”¨\u0026hellip;\nconvert -list format | grep SVG ä»æ‹¬å·ä¸­çš„ \u0026ldquo;RSVG\u0026rdquo; å¯ä»¥çœ‹å‡ºï¼Œæˆ‘è‡ªå·±çš„ IM å°†ä½¿ç”¨æˆ‘ç”µè„‘ä¸Šçš„ RSVG åº“ï¼Œå¹¶ç»™å‡ºäº†ç‰ˆæœ¬ã€‚\nåœ¨è¿™é‡Œï¼Œæˆ‘\u0026quot;ç»˜åˆ¶\u0026quot;äº†ä¸€ä¸ªå°çš„ã€æ‰‹å·¥åˆ¶ä½œçš„ SVG å›¾åƒ \u0026ldquo;diagonal.svg\u0026quot;ï¼ˆç”±è®ºå›ç”¨æˆ· penciledin è´¡çŒ®ï¼‰ï¼Œå®ƒåœ¨ç™½è‰²èƒŒæ™¯ä¸Šåˆ›å»ºäº†ä¸€ä¸ªç®€å•çš„å¯¹è§’çº¿æ¸å˜çš„çŸ©å½¢ã€‚\nconvert diagonal.svg diagonal_rsvg.gif å®Œç¾çš„ã€‚ä¸€ä¸ªæ­£ç¡®çš„å¯¹è§’çº¿æ¢¯åº¦è¢«ç”Ÿæˆã€‚\nç„¶è€Œï¼Œå¦‚æœä½ ä½¿ç”¨å†…éƒ¨çš„ MSVGï¼ˆå¦‚æœæ²¡æœ‰ RSVG åº“ï¼Œåˆ™ä¸ºé»˜è®¤å€¼ï¼‰æ¥æ¸²æŸ“\u0026hellip;\nconvert msvg:diagonal.svg diagonal_msvg.gif æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œå†…éƒ¨ MSVG è½¬æ¢å¤±è´¥ï¼Œè¿”å›çš„æ˜¯å‚ç›´æ¢¯åº¦è€Œä¸æ˜¯å¯¹è§’çº¿ã€‚\nconvert msvg:diagonal.svg diagonal.mvg ä½ å¤§æ¦‚å¯ä»¥çœ‹åˆ°MSVGè½¬æ¢å™¨æ˜¯å¦‚ä½•å°è¯•å°† SVG è½¬æ¢ä¸º MVG ç»˜å›¾å‘½ä»¤çš„ã€‚\nå½“å‰å†…éƒ¨ MSVG å·²çŸ¥å¤±è´¥çš„åœ°æ–¹åŒ…æ‹¬\u0026hellip;\n éå‚ç›´æ¢¯åº¦(æ²¡æœ‰è½¬æ¢åˆ°æ–°çš„MVGæ¢¯åº¦å¤„ç†) æ²¿ç€å¼¯æ›²è·¯å¾„çš„æ–‡å­— æ–‡æœ¬å¯¹é½ï¼ˆä¸é‡åŠ›åˆ†å¼€ï¼‰ã€‚  ç„¶è€Œå¤§å¤šæ•°åŸºæœ¬çš„ç»˜å›¾åŠ¨ä½œéƒ½è¢«å¤„ç†äº†ã€‚\nè¿˜è¯·è®°ä½ï¼ŒMVG è¯­è¨€å®é™…ä¸Šå¯ä»¥å¤„ç† SVG ä¸èƒ½å¤„ç†çš„äº‹æƒ…ï¼ŒåŒ…æ‹¬ä½¿ç”¨é‡åŠ›æ¥å®šä½å›¾åƒå’Œæ–‡æœ¬ã€‚é‡åŠ›ä¸æ˜¯ SVG è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œå°½ç®¡å®ƒæ˜¯ IM æ–‡æœ¬å’Œå­—ä½“å¤„ç†çš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ã€‚\nå¦å¤–è¯·è®°ä½ï¼ŒMVG æ²¡æœ‰ SVG æ‰€æ‹¥æœ‰çš„å®¹å™¨æœºåˆ¶ã€‚å†…éƒ¨çš„ MSVG è½¬æ¢å™¨ç”¨å›¾å½¢ä¸Šä¸‹æ–‡çš„æ¨é€å’Œå¼¹å‡ºä»£æ›¿äº† XML å®¹å™¨ï¼ˆè§ä¸Šé¢çš„ MVG è¾“å‡ºï¼‰ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚ SVG çš„è®¾ç½®\nSVG å›¾åƒæ ¼å¼æ˜¯ä¸€ç§çŸ¢é‡æ ¼å¼ï¼ˆè¯·å‚è§å…³äºçŸ¢é‡å›¾åƒæ ¼å¼çš„ä¸€å¥è¯ï¼‰ï¼Œå› æ­¤å›¾åƒé€šå¸¸æ²¡æœ‰ä¸€ä¸ªé»˜è®¤çš„\u0026quot;å¤§å°\u0026rdquo;ï¼Œè€Œæ˜¯ä»¥ç‰¹å®šçš„  \u0026quot;-density\u0026quot; æ¥ \u0026ldquo;ç»˜åˆ¶\u0026quot;æˆ–\u0026quot;æ¸²æŸ“\u0026rdquo;ï¼Œå°±åƒ postscript ä¸€æ ·ï¼ˆé»˜è®¤å¯†åº¦æ˜¯72dpiï¼‰ã€‚\nå¦å¤–ï¼Œå¦‚æœ SVG æ²¡æœ‰ \u0026ldquo;ç»˜åˆ¶\u0026quot;èƒŒæ™¯ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨ -background è®¾ç½®æŒ‡å®šè¦ä½¿ç”¨çš„èƒŒæ™¯é¢œè‰²ã€‚\nä¾‹å¦‚è¿™é‡Œæ˜¯å¦ä¸€ä¸ªå°çš„ SVG å›¾åƒ \u0026ldquo;home.svg\u0026rdquo;ï¼Œå®ƒå·²ç»ä½¿ç”¨3ç§ä¸åŒçš„å¯†åº¦ï¼Œ3ç§ä¸åŒçš„èƒŒæ™¯è¿›è¡Œ\u0026quot;æ¸²æŸ“\u0026rdquo;ï¼ŒåŒ…æ‹¬ä¸€ä¸ªé€æ˜çš„èƒŒæ™¯ã€‚\nconvert -density 36 home.svg home_1.gif convert -background skyblue home.svg home_2.gif convert -density 144 -background none home.svg home_3.png è¯·æ³¨æ„ï¼Œæˆ‘ä½¿ç”¨äº† PNG æ ¼å¼çš„å›¾ç‰‡æ¥åˆ¶ä½œä¸Šé¢ä¾‹å­ä¸­è¾ƒå¤§çš„é€æ˜èƒŒæ™¯ç‰ˆæœ¬ã€‚ç”±äºåŠé€æ˜çš„è¾¹ç¼˜åƒç´ ï¼Œè¿™äº§ç”Ÿçš„å›¾åƒæ¯” GIF å›¾åƒæ ¼å¼äº§ç”Ÿçš„å›¾åƒæ›´å¹²å‡€ã€‚å½“æœ€ç»ˆå›¾åƒä¸­æ¶‰åŠåˆ°é€æ˜åº¦æ—¶ï¼Œæ€»æ˜¯å»ºè®®ä½¿ç”¨ PNGã€‚\n æˆ‘å‘ç°æœ‰äº› SVG å›¾åƒä¸èƒ½ç¼©æ”¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬è¢«å®šä¹‰ä¸º\u0026quot;åƒç´ \u0026rdquo;ï¼Œè€Œä¸æ˜¯ç°å®ä¸–ç•Œä¸­çš„é•¿åº¦ï¼Œå¦‚\u0026quot;ç‚¹\u0026rdquo;ã€\u0026ldquo;è‹±å¯¸\u0026quot;æˆ–\u0026quot;æ¯«ç±³\u0026rdquo;ã€‚å› æ­¤ï¼Œè™½ç„¶ -density è®¾ç½®å¯èƒ½ä¼šæ”¹å˜å›¾åƒçš„æ•´ä½“å¤§å°ï¼ˆä»¥ç°å®ä¸–ç•Œä¸ºå•ä½ï¼‰ï¼Œä½† \u0026ldquo;åƒç´  \u0026ldquo;çš„å¤§å°ä¸ä¼šæ”¹å˜ï¼Œå› æ­¤å›¾åƒæœ¬èº«çš„å¤§å°ä¹Ÿä¸ä¼šæ”¹å˜ã€‚ç„¶è€Œè¿™æ ·çš„SVGå›¾åƒæ˜¯ç›¸å½“ç½•è§çš„ã€‚\n æ›´ç³Ÿç³•çš„æ˜¯ï¼Œä¸€äº› SVG å›¾åƒä½¿ç”¨äº†\u0026quot;åƒç´ \u0026quot;å’Œ \u0026ldquo;ç‚¹\u0026quot;çš„æ··åˆæµ‹é‡ï¼Œé™¤éä½œè€…æ•…æ„è¿™æ ·åšï¼Œå¦åˆ™ä½ å¯èƒ½ä¼šå¾—åˆ°ä¸€ä¸ªçœŸæ­£çš„æ··ä¹±ï¼Œä½ å¯ä»¥å°è¯•ä½¿ç”¨ä¸åŒçš„å¯†åº¦ï¼Œè€Œä¸æ˜¯ä½œè€…æƒ³è¦çš„ã€‚å¹¸è¿çš„æ˜¯ï¼Œè¿™ç§æƒ…å†µæ›´åŠ ç½•è§ã€‚\nä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ³•å°±æ˜¯å°† SVG ä¸­æ‰€æœ‰çš„ \u0026ldquo;åƒç´ \u0026quot;å•ä½æ”¹æˆ\u0026quot;ç‚¹\u0026rdquo;ï¼Œä½†ä¹Ÿä¸èƒ½ç›²ç›®çš„ä½¿ç”¨ï¼Œä»¥é˜²æ•…æ„ä½¿ç”¨\u0026quot;åƒç´ \u0026rdquo;ã€‚\nSVG è¾“å‡ºå¤„ç† ä» IM v6.4.2 å¼€å§‹ï¼ŒIM å¯ä»¥å°†ä»»ä½•ä½å›¾å›¾åƒè½¬æ¢ä¸º SVG çŸ¢é‡å›¾! è½¬æ¢å¹¶ä¸æ€»æ˜¯æˆåŠŸçš„ï¼Œä½†è¾ƒå¤§å’Œ/æˆ–è¾ƒç®€å•çš„å›¾åƒï¼ˆå¦‚ä½å›¾è’™ç‰ˆï¼‰ä¼šè½¬æ¢å¾—å¾ˆå¥½ã€‚\nä¾‹å¦‚ï¼Œæˆ‘åœ¨è¿™é‡Œå°†ä¸€ä¸ªå¯æ€•çš„ä½å›¾å½¢çŠ¶è½¬æ¢ä¸ºSVGå›¾åƒï¼Œç„¶åå†å°†å…¶è½¬æ¢å›æ¥ï¼Œä»¥ä¾¿å°†ä½å›¾å¹³æ»‘ä¸ºä¸€ä¸ªé€‚å½“çš„åé”¯é½¿å½¢çŠ¶ã€‚\nconvert -pointsize 72 -font Candice label:A -threshold 50% \\  -trim +repage -bordercolor white -border 5x5 A.gif convert A.gif A.svg convert A.svg A.png -\u0026gt; ç„¶è€Œï¼Œè¦ä½¿ä¹‹å·¥ä½œï¼Œå¿…é¡»å®‰è£…\u0026quot;å¼€å‘\u0026quot;çš„ AutoTrace åº“ï¼Œå¹¶åœ¨IMä¸­é…ç½® -with-autotrace å¼€å…³ã€‚\nå¦‚æœæ²¡æœ‰å®‰è£… AutoTrace åº“å¹¶å°†å…¶ç¼–è¯‘åˆ° IM ä¸­ï¼Œé‚£ä¹ˆç”Ÿæˆçš„ SVG è¾“å‡ºå°†æ˜¯å¤§é‡çš„å•åƒç´ åœ†åœˆï¼Œç”Ÿæˆä¸€ä¸ªäºŒè¿›åˆ¶ç»“æœï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå¹³æ»‘çš„ SVG è½®å»“å›¾åƒã€‚è¿™æ ·çš„å›¾åƒæ¯”è¾ƒå·¨å¤§ï¼Œé€šè¿‡ SVG æ¸²æŸ“å¾€å¾€éœ€è¦å¾ˆé•¿çš„æ—¶é—´æ¥æ¸²æŸ“ã€‚\nå…¶å®éœ€è¦ä¸€ç§æ›´å¥½çš„é»˜è®¤æ …æ ¼åˆ°çŸ¢é‡çš„æŠ€æœ¯ï¼Œå¯èƒ½ä¼šä½¿ç”¨ Morphology skeletion å’Œ MAT æŠ€æœ¯ã€‚\næœ‰ä¸€ä¸ª autotrace: è¾“å…¥ä»£ç†ï¼Œæ¥\u0026quot;å¹³æ»‘è¾“å…¥ä½å›¾å›¾åƒ\u0026rdquo;ï¼Œç›´æ¥ä½¿ç”¨ \u0026ldquo;autotrace\u0026rdquo; å‘½ä»¤ä¸€æ¬¡æ€§å®Œæˆä¸Šè¿°æ‰€æœ‰æ­¥éª¤ã€‚ç„¶è€Œæˆ‘æœ€åä¸€æ¬¡çœ‹åˆ°è¿™ä¸ªä»£ç†å·²ç»æ¶ˆå¤±äº†ã€‚\nä½ åº”è¯¥è¿™æ ·ä½¿ç”¨å®ƒ\u0026hellip;\nconvert autotrace:A.gif A_traced.png å½“ç„¶è¿™å¹¶ä¸èƒ½è®©ä½ ä» \u0026ldquo;autotrace\u0026rdquo; å‘½ä»¤ä¸­å¾—åˆ° SVG è¾“å‡ºï¼Œåªæ˜¯é€šè¿‡ SVG è¿‡æ»¤è¾“å…¥çš„å›¾åƒæ¥å¹³æ»‘å®ƒã€‚\nä½œä¸ºä¸€ç§æ›¿ä»£æ–¹æ³•ï¼Œä½ å¯ä»¥ç›´æ¥ä½¿ç”¨ \u0026ldquo;autotrace\u0026rdquo; å‘½ä»¤ï¼Œå¦‚ Raster to Vector Edging å’Œ Skeleton using Autotrace ç¤ºä¾‹æ‰€ç¤ºã€‚\nä½ ä¹Ÿå¯ä»¥çœ‹çœ‹ cancerberosgx çš„ç»“æœï¼Œåœ¨ç”Ÿæˆ SVG å›¾åƒï¼Œä»–ç ”ç©¶äº†è½¬æ¢ç…§ç‰‡çš„è§£å†³æ–¹æ¡ˆã€‚\néIMçŸ¢é‡å›¾å½¢ç¼–è¾‘å™¨ ImageMagick æ˜¯ä¸€ä¸ªåƒç´ æ•°ç»„å¤„ç†å™¨ï¼Œå®ƒä¸€èˆ¬ä¸ä¼šä¿å­˜çŸ¢é‡å›¾åƒï¼ˆ\u0026lsquo;MVG\u0026rsquo; æ˜¯å”¯ä¸€çš„ä¾‹å¤–ï¼‰ï¼Œåªä¼šè¯»å–å›¾åƒå¹¶å°†å…¶è½¬æ¢ä¸ºåƒç´ æ•°ç»„ã€‚\nå…¶ä»–åƒç´ å›¾åƒç¼–è¾‘å™¨ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå¦‚ Gimpã€Photoshop ç­‰ã€‚\nå¯¹äºç¼–è¾‘å’Œå¤„ç†åŸºäºçŸ¢é‡çš„å›¾åƒï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç¨‹åºï¼Œå¦‚\n Sodipodi åŸºäºSVGçš„çŸ¢é‡å›¾å½¢ç¼–è¾‘å™¨ã€‚ Xfig ç®€å•ä½†éå¸¸å¥½çš„çŸ¢é‡å¯¹è±¡ç¼–è¾‘å™¨ã€‚(é€‚ç”¨äºæ ‡å¿—ã€åœ°å›¾å’Œåœ¨é¡µé¢ä¸Šæ’åˆ—ç…§ç‰‡) Dia AutoTrace å°†ä½å›¾æ•°ç»„ä¸­çš„å½¢çŠ¶è½¬æ¢ä¸ºçŸ¢é‡è½®å»“ã€‚ Sketch åŸºäº Python çš„æ›²çº¿æ–‡å­—çŸ¢é‡ç¼–è¾‘å™¨ã€‚  å½“ç„¶ï¼Œè¿™ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„åˆ—è¡¨ã€‚å³ä½¿æ˜¯è®¸å¤šæ–‡å­—å¤„ç†ç¨‹åºï¼Œå¦‚ OpenOfficeã€Word å’Œ TeXï¼Œä¸€èˆ¬éƒ½æœ‰å„ç§ç®€å•çš„ï¼Œè™½ç„¶å¾€å¾€éš¾ä»¥ä½¿ç”¨çš„å¯¹è±¡ç¼–è¾‘å™¨ã€‚\nç„¶è€Œå¯¹äºä¸€èˆ¬å°†çŸ¢é‡å›¾å½¢æ ¼å¼è½¬æ¢ä¸ºä¸åŒçš„çŸ¢é‡æ ¼å¼ï¼Œä¸è¦ä½¿ç”¨ ImageMagickã€‚ImageMagick æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå…‰æ …å›¾åƒæˆ–ä½å›¾å›¾å½¢è½¬æ¢å™¨å’Œæ“ä½œå™¨ï¼Œè€Œä¸”æ°¸è¿œéƒ½æ˜¯è¿™æ ·ã€‚æ›´å¤šä¿¡æ¯è¯·å‚è§ A word about Vector Image formatsã€‚\n åˆ›å»ºäº: 24 March 2004 æ›´æ–°äº: 14 March 2011 ä½œè€…: Anthony Thyssen, Anthony.Thyssen@gmail.com Examples Generated with: [version image] URL: http://www.imagemagick.org/Usage/draw/  ","permalink":"https://ohmyweekly.github.io/notes/imagemagick-drawing/","tags":["imagemagick","image"],"title":"ImageMagick - Drawing"},{"categories":["programming"],"contents":"https://imagemagick.org/Usage/transform/index.html\n","permalink":"https://ohmyweekly.github.io/notes/imagemagick-transform/","tags":["imagemagick","transform"],"title":"ImageMagick - Transform"},{"categories":["programming"],"contents":"å‡ ä¸ªæœ‰æ„æ€çš„ ImageMagick è„šæœ¬ http://www.fmwconcepts.com/imagemagick/randomclipart/index.php http://www.fmwconcepts.com/imagemagick/sketching/index.php http://www.fmwconcepts.com/imagemagick/sphericalpano2cube/index.php http://www.fmwconcepts.com/imagemagick/surroundblur/index.php http://www.fmwconcepts.com/imagemagick/transfercolor/index.php http://www.fmwconcepts.com/imagemagick/colorcells/index.php\nç»™å›¾ç‰‡æ·»åŠ ç½‘æ ¼çº¿ ./glasseffects -e none -k simple -o \u0026#39;#FFDAB9\u0026#39; -t single -m overlay -c 200 -w 1 -s 20 -r 10 in.jpeg out.jpg ./grid -o 0.3 -s 200 -c white in.jpeg out.jpeg æŠ˜å å›¾ç‰‡ ./picturefold -o 80 -h 50 in.jpeg out.jpeg ç»™å›¾ç‰‡æ·»åŠ å¿ƒå½¢å›¾ç‰‡ ./randomclipart -d \u0026#34;64,16\u0026#34; -a \u0026#34;45,-45\u0026#34; -p 50 -c random in.jpeg heart.png out.jpeg ç»™å›¾ç‰‡åˆ†æˆå¸¦é¢œè‰²çš„æ–¹å— ./colorcells -n 8,8 -d 100,100 in.jpeg out.jpeg ","permalink":"https://ohmyweekly.github.io/notes/imagemagick-notes/","tags":["imagemagick","image"],"title":"ImageMagick ç¬”è®°"},{"categories":["ffmpeg"],"contents":"æ¦‚è¦ ffmpeg [global_options] {[input_file_options] -i input_url} ... {[output_file_options] output_url} ... æè¿° ffmpeg æ˜¯ä¸€æ¬¾éå¸¸å¿«é€Ÿçš„è§†é¢‘å’ŒéŸ³é¢‘è½¬æ¢å™¨ï¼Œå®ƒè¿˜å¯ä»¥ä»å®æ—¶éŸ³é¢‘/è§†é¢‘æºä¸­æŠ“å–ã€‚å®ƒè¿˜å¯ä»¥åœ¨ä»»æ„é‡‡æ ·ç‡ä¹‹é—´è¿›è¡Œè½¬æ¢ï¼Œå¹¶é€šè¿‡é«˜è´¨é‡çš„å¤šç›¸æ»¤æ³¢å™¨åœ¨é£è¡Œä¸­è°ƒæ•´è§†é¢‘å¤§å°ã€‚\nffmpeg ä»ä»»æ„æ•°é‡çš„è¾“å…¥\u0026quot;æ–‡ä»¶\u0026quot;ï¼ˆå¯ä»¥æ˜¯å¸¸è§„æ–‡ä»¶ã€ç®¡é“ã€ç½‘ç»œæµã€æŠ“å–è®¾å¤‡ç­‰ï¼‰ä¸­è¯»å–ï¼Œç”± -i é€‰é¡¹æŒ‡å®šï¼Œå¹¶å†™å…¥ä»»æ„æ•°é‡çš„è¾“å‡º\u0026quot;æ–‡ä»¶\u0026quot;ï¼Œç”±ä¸€ä¸ªæ™®é€šçš„è¾“å‡º url æŒ‡å®šã€‚åœ¨å‘½ä»¤è¡Œä¸­æ‰¾åˆ°çš„ä»»ä½•ä¸èƒ½è¢«è§£é‡Šä¸ºé€‰é¡¹çš„ä¸œè¥¿éƒ½è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªè¾“å‡º urlã€‚\nåŸåˆ™ä¸Šï¼Œæ¯ä¸ªè¾“å…¥æˆ–è¾“å‡º url å¯ä»¥åŒ…å«ä»»æ„æ•°é‡çš„ä¸åŒç±»å‹çš„æµï¼ˆè§†é¢‘/éŸ³é¢‘/å­—å¹•/é™„ä»¶/æ•°æ®ï¼‰ã€‚å…è®¸çš„æµçš„æ•°é‡å’Œ/æˆ–ç±»å‹å¯èƒ½å—åˆ°å®¹å™¨æ ¼å¼çš„é™åˆ¶ã€‚é€‰æ‹©å“ªäº›è¾“å…¥çš„æµå°†è¿›å…¥å“ªäº›è¾“å‡ºï¼Œå¯ä»¥è‡ªåŠ¨å®Œæˆï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ -map é€‰é¡¹å®Œæˆï¼ˆè¯·å‚è§æµé€‰æ‹©ç« èŠ‚ï¼‰ã€‚\nè¦åœ¨é€‰é¡¹ä¸­å¼•ç”¨è¾“å…¥æ–‡ä»¶ï¼Œæ‚¨å¿…é¡»ä½¿ç”¨å®ƒä»¬çš„ç´¢å¼•ï¼ˆåŸºäº 0ï¼‰ã€‚ä¾‹å¦‚ï¼Œç¬¬ä¸€ä¸ªè¾“å…¥æ–‡ä»¶æ˜¯ 0ï¼Œç¬¬äºŒä¸ªæ˜¯ 1ï¼Œç­‰ç­‰ã€‚åŒæ ·ï¼Œä¸€ä¸ªæ–‡ä»¶ä¸­çš„æµä¹Ÿç”¨å®ƒä»¬çš„ç´¢å¼•æ¥è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼Œ2:3 æŒ‡çš„æ˜¯ç¬¬ä¸‰ä¸ªè¾“å…¥æ–‡ä»¶ä¸­çš„ç¬¬å››ä¸ªæµã€‚ä¹Ÿè¯·å‚è§æµæŒ‡å®šç¬¦ä¸€ç« ã€‚\nä¸€èˆ¬æ¥è¯´ï¼Œé€‰é¡¹ä¼šåº”ç”¨åˆ°ä¸‹ä¸€ä¸ªæŒ‡å®šçš„æ–‡ä»¶ã€‚å› æ­¤ï¼Œé¡ºåºæ˜¯å¾ˆé‡è¦çš„ï¼Œæ‚¨å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­å¤šæ¬¡å‡ºç°åŒä¸€ä¸ªé€‰é¡¹ã€‚æ¯æ¬¡å‡ºç°éƒ½ä¼šè¢«åº”ç”¨åˆ°ä¸‹ä¸€ä¸ªè¾“å…¥æˆ–è¾“å‡ºæ–‡ä»¶ã€‚è¿™æ¡è§„åˆ™çš„ä¾‹å¤–æ˜¯å…¨å±€é€‰é¡¹ï¼ˆä¾‹å¦‚ verbosity levelï¼‰ï¼Œåº”è¯¥å…ˆæŒ‡å®šã€‚\nä¸è¦æ··åˆè¾“å…¥å’Œè¾“å‡ºæ–‡ä»¶-é¦–å…ˆæŒ‡å®šæ‰€æœ‰è¾“å…¥æ–‡ä»¶ï¼Œç„¶åå†æŒ‡å®šæ‰€æœ‰è¾“å‡ºæ–‡ä»¶ã€‚ä¹Ÿä¸è¦æ··åˆå±äºä¸åŒæ–‡ä»¶çš„é€‰é¡¹ã€‚æ‰€æœ‰é€‰é¡¹åªé€‚ç”¨äºä¸‹ä¸€ä¸ªè¾“å…¥æˆ–è¾“å‡ºæ–‡ä»¶ï¼Œå¹¶åœ¨æ–‡ä»¶ä¹‹é—´è¢«é‡ç½®ã€‚\n è¦å°†è¾“å‡ºæ–‡ä»¶çš„è§†é¢‘æ¯”ç‰¹ç‡è®¾ç½®ä¸º 64 kbit/s:  ffmpeg -i input.avi -b:v 64k -bufsize 64k output.avi  è¦å¼ºåˆ¶è¾“å‡ºæ–‡ä»¶çš„å¸§ç‡ä¸º24å¸§/ç§’:  ffmpeg -i input.avi -r 24 output.avi  å¼ºåˆ¶è¾“å…¥æ–‡ä»¶çš„å¸§ç‡ï¼ˆä»…å¯¹åŸå§‹æ ¼å¼æœ‰æ•ˆï¼‰ä¸º1å¸§/ç§’ï¼Œè¾“å‡ºæ–‡ä»¶çš„å¸§ç‡ä¸º24å¸§/ç§’:  ffmpeg -r 1 -i input.m2v -r 24 output.avi åŸå§‹è¾“å…¥æ–‡ä»¶å¯èƒ½éœ€è¦æ ¼å¼é€‰é¡¹ã€‚\nè¯¦æƒ…æè¿° ffmpeg ä¸­æ¯ä¸ªè¾“å‡ºçš„è½¬ç è¿‡ç¨‹å¯ä»¥ç”¨ä¸‹é¢çš„å›¾æ¥æè¿°:\n _______ ______________ | | | | | input | demuxer | encoded data | decoder | file | ---------\u0026gt; | packets | -----+ |_______| |______________| | v _________ | | | decoded | | frames | |_________| ________ ______________ | | | | | | | output | \u0026lt;-------- | encoded data | \u0026lt;----+ | file | muxer | packets | encoder |________| |______________| ffmpeg è°ƒç”¨ libavformat åº“ï¼ˆåŒ…å« demuxersï¼‰æ¥è¯»å–è¾“å…¥æ–‡ä»¶ï¼Œå¹¶ä»å…¶ä¸­è·å–åŒ…å«ç¼–ç æ•°æ®çš„æ•°æ®åŒ…ã€‚å½“æœ‰å¤šä¸ªè¾“å…¥æ–‡ä»¶æ—¶ï¼Œffmpeg è¯•å›¾é€šè¿‡è·Ÿè¸ªä»»ä½•æ´»åŠ¨è¾“å…¥æµä¸Šçš„æœ€ä½æ—¶é—´æˆ³æ¥ä¿æŒå®ƒä»¬çš„åŒæ­¥ã€‚\nç¼–ç åçš„æ•°æ®åŒ…ä¼šè¢«ä¼ é€’ç»™è§£ç å™¨ï¼ˆé™¤éä¸ºæµé€‰æ‹©äº† streamcopyï¼Œè¯¦è§ä¸‹æ–‡ï¼‰ã€‚è§£ç å™¨äº§ç”Ÿæœªå‹ç¼©çš„å¸§ï¼ˆåŸå§‹è§†é¢‘/PCMéŸ³é¢‘/\u0026hellip;ï¼‰ï¼Œè¿™äº›å¸§å¯ä»¥é€šè¿‡è¿‡æ»¤è¿›ä¸€æ­¥å¤„ç†ï¼ˆè§ä¸‹ä¸€èŠ‚ï¼‰ã€‚è¿‡æ»¤åï¼Œè¿™äº›å¸§è¢«ä¼ ç»™ç¼–ç å™¨ï¼Œç¼–ç å™¨å¯¹å®ƒä»¬è¿›è¡Œç¼–ç å¹¶è¾“å‡ºç¼–ç æ•°æ®åŒ…ã€‚æœ€åï¼Œè¿™äº›å¸§è¢«ä¼ ç»™ muxerï¼Œmuxer å°†ç¼–ç åçš„æ•°æ®åŒ…å†™å…¥è¾“å‡ºæ–‡ä»¶ã€‚\næ»¤æ³¢ åœ¨ç¼–ç ä¹‹å‰ï¼Œffmpeg å¯ä»¥ä½¿ç”¨ libavfilter åº“ä¸­çš„è¿‡æ»¤å™¨å¤„ç†åŸå§‹éŸ³é¢‘å’Œè§†é¢‘å¸§ã€‚ffmpeg åŒºåˆ†äº†ä¸¤ç§ç±»å‹çš„æ»¤æ³¢å›¾ï¼šç®€å•å’Œå¤æ‚ã€‚\nç®€å•çš„æ»¤æ³¢å›¾ ç®€å•çš„æ»¤æ³¢å›¾æ˜¯æŒ‡é‚£äº›åªæœ‰ä¸€ä¸ªè¾“å…¥å’Œè¾“å‡ºçš„æ»¤æ³¢å›¾ï¼Œä¸¤è€…ç±»å‹ç›¸åŒã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œå®ƒä»¬å¯ä»¥é€šè¿‡ç®€å•åœ°åœ¨è§£ç å’Œç¼–ç ä¹‹é—´æ’å…¥ä¸€ä¸ªé¢å¤–çš„æ­¥éª¤æ¥è¡¨ç¤º:\n _________ ______________ | | | | | decoded | | encoded data | | frames |\\ _ | packets | |_________| \\ /||______________| \\ __________ / simple _\\|| | / encoder filtergraph | filtered |/ | frames | |__________| ç®€å•çš„æ»¤æ³¢å›¾æ˜¯ç”¨ per-stream -filter é€‰é¡¹é…ç½®çš„ï¼ˆè§†é¢‘å’ŒéŸ³é¢‘åˆ†åˆ«ç”¨ -vf å’Œ -af åˆ«åï¼‰ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç®€å•çš„è§†é¢‘æ»¤æ³¢å›¾å¯ä»¥æ˜¯è¿™æ ·çš„:\n _______ _____________ _______ ________ | | | | | | | | | input | ---\u0026gt; | deinterlace | ---\u0026gt; | scale | ---\u0026gt; | output | |_______| |_____________| |_______| |________| è¯·æ³¨æ„ï¼Œæœ‰äº›æ»¤é•œä¼šæ”¹å˜å¸§çš„å±æ€§ï¼Œä½†ä¸ä¼šæ”¹å˜å¸§çš„å†…å®¹ã€‚ä¾‹å¦‚ï¼Œä¸Šé¢ä¾‹å­ä¸­çš„ fps è¿‡æ»¤å™¨æ”¹å˜äº†å¸§æ•°ï¼Œä½†æ²¡æœ‰è§¦åŠå¸§å†…å®¹ã€‚å¦ä¸€ä¸ªä¾‹å­æ˜¯ setpts è¿‡æ»¤å™¨ï¼Œå®ƒåªè®¾ç½®äº†æ—¶é—´æˆ³ï¼Œè€Œåœ¨å…¶ä»–æ–¹é¢æ²¡æœ‰æ”¹å˜å¸§çš„å†…å®¹ã€‚\nå¤æ‚çš„æ»¤æ³¢å›¾ å¤æ‚çš„æ»¤æ³¢å›¾æ˜¯é‚£äº›ä¸èƒ½ç®€å•åœ°æè¿°ä¸ºåº”ç”¨äºä¸€ä¸ªæµçš„çº¿æ€§å¤„ç†é“¾çš„å›¾ã€‚ä¾‹å¦‚ï¼Œå½“å›¾å½¢æœ‰ä¸€ä¸ªä»¥ä¸Šçš„è¾“å…¥å’Œ/æˆ–è¾“å‡ºæ—¶ï¼Œæˆ–è€…å½“è¾“å‡ºæµç±»å‹ä¸è¾“å…¥ä¸åŒæ—¶ï¼Œå°±ä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚å®ƒä»¬å¯ä»¥ç”¨ä¸‹å›¾æ¥è¡¨ç¤º:\n _________ | | | input 0 |\\ __________ |_________| \\ | | \\ _________ /| output 0 | \\ | | / |__________| _________ \\| complex | / | | | |/ | input 1 |----\u0026gt;| filter |\\ |_________| | | \\ __________ /| graph | \\ | | / | | \\| output 1 | _________ / |_________| |__________| | | / | input 2 |/ |_________| å¤æ‚çš„æ»¤æ³¢å›¾æ˜¯ç”¨ -filter_complex é€‰é¡¹é…ç½®çš„ã€‚æ³¨æ„è¿™ä¸ªé€‰é¡¹æ˜¯å…¨å±€æ€§çš„ï¼Œå› ä¸ºå¤æ‚çš„æ»¤æ³¢å›¾ï¼Œå°±å…¶æœ¬è´¨è€Œè¨€ï¼Œä¸èƒ½æ˜ç¡®åœ°ä¸ä¸€ä¸ªå•ä¸€çš„æµæˆ–æ–‡ä»¶ç›¸å…³è”ã€‚\n-lavfi é€‰é¡¹ç›¸å½“äº -filter_complexã€‚\nä¸€ä¸ªç®€å•çš„ä¾‹å­æ˜¯ overlay æ»¤æ³¢å™¨ï¼Œå®ƒæœ‰ä¸¤ä¸ªè§†é¢‘è¾“å…¥å’Œä¸€ä¸ªè§†é¢‘è¾“å‡ºï¼Œå…¶ä¸­ä¸€ä¸ªè§†é¢‘å åŠ åœ¨å¦ä¸€ä¸ªè§†é¢‘ä¸Šã€‚å®ƒçš„éŸ³é¢‘å¯¹åº”çš„æ˜¯ amix æ»¤æ³¢å™¨ã€‚\næµå¤åˆ¶ æµå¤åˆ¶æ˜¯é€šè¿‡å‘ -codec é€‰é¡¹æä¾› copy å‚æ•°æ¥é€‰æ‹©çš„æ¨¡å¼ï¼Œå®ƒä½¿ ffmpeg çœç•¥äº†å¯¹æŒ‡å®šæµçš„è§£ç å’Œç¼–ç æ­¥éª¤ï¼Œå› æ­¤å®ƒåªåšè§£å¤ç”¨(demuxing)å’Œæ··å (muxing)ã€‚å®ƒå¯¹äºæ”¹å˜å®¹å™¨æ ¼å¼æˆ–ä¿®æ”¹å®¹å™¨çº§å…ƒæ•°æ®éå¸¸æœ‰ç”¨ã€‚ä¸Šé¢çš„å›¾ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¼šç®€åŒ–æˆè¿™æ ·:\n _______ ______________ ________ | | | | | | | input | demuxer | encoded data | muxer | output | | file | ---------\u0026gt; | packets | -------\u0026gt; | file | |_______| |______________| |________| ç”±äºä¸éœ€è¦è§£ç æˆ–ç¼–ç ï¼Œæ‰€ä»¥é€Ÿåº¦éå¸¸å¿«ï¼Œè€Œä¸”æ²¡æœ‰è´¨é‡æŸå¤±ã€‚ä½†æ˜¯ï¼Œç”±äºå¾ˆå¤šå› ç´ çš„å½±å“ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½æ— æ³•å·¥ä½œã€‚åº”ç”¨è¿‡æ»¤å™¨æ˜¾ç„¶ä¹Ÿæ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºè¿‡æ»¤å™¨æ˜¯åœ¨æœªå‹ç¼©çš„æ•°æ®ä¸Šå·¥ä½œçš„ã€‚\næµé€‰æ‹© ffmpeg æä¾›äº† -map é€‰é¡¹æ¥æ‰‹åŠ¨æ§åˆ¶æ¯ä¸ªè¾“å‡ºæ–‡ä»¶çš„æµé€‰æ‹©ã€‚ç”¨æˆ·å¯ä»¥è·³è¿‡ -map é€‰é¡¹ï¼Œè®© ffmpeg æ‰§è¡Œè‡ªåŠ¨æµé€‰æ‹©ï¼Œå¦‚ä¸‹æ‰€è¿°ã€‚-vn / -an / -sn / -dn é€‰é¡¹å¯ä»¥åˆ†åˆ«ç”¨æ¥è·³è¿‡è§†é¢‘ã€éŸ³é¢‘ã€å­—å¹•å’Œæ•°æ®æµï¼Œæ— è®ºæ˜¯æ‰‹åŠ¨æ˜ å°„è¿˜æ˜¯è‡ªåŠ¨é€‰æ‹©ï¼Œä½†é‚£äº›å¤æ‚çš„æ»¤æ³¢å›¾è¾“å‡ºçš„æµé™¤å¤–ã€‚\næè¿°ï¼š ä¸‹é¢çš„å°èŠ‚æè¿°äº†æ¶‰åŠåˆ°æµé€‰æ‹©çš„å„ç§è§„åˆ™ã€‚æ¥ä¸‹æ¥çš„ä¾‹å­å°†å±•ç¤ºè¿™äº›è§„åˆ™æ˜¯å¦‚ä½•åœ¨å®è·µä¸­åº”ç”¨çš„ã€‚\nè™½ç„¶æˆ‘ä»¬å°½åŠ›å‡†ç¡®åœ°åæ˜ äº†ç¨‹åºçš„è¡Œä¸ºï¼Œä½† FFmpeg ä»åœ¨ä¸æ–­åœ°å¼€å‘ä¸­ï¼Œä»£ç å¯èƒ½ä¼šåœ¨å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™æœ‰æ‰€æ”¹å˜ã€‚\nè‡ªåŠ¨é€‰æ‹©æµ åœ¨æ²¡æœ‰ä»»ä½•ç‰¹å®šè¾“å‡ºæ–‡ä»¶çš„æ˜ å°„é€‰é¡¹çš„æƒ…å†µä¸‹ï¼Œffmpeg ä¼šæ£€æŸ¥è¾“å‡ºæ ¼å¼ï¼Œä»¥æ£€æŸ¥å“ªäº›ç±»å‹çš„æµå¯ä»¥è¢«åŒ…å«åœ¨å…¶ä¸­ï¼Œå³è§†é¢‘ã€éŸ³é¢‘å’Œ/æˆ–å­—å¹•ã€‚å¯¹äºæ¯ä¸€ç§å¯æ¥å—çš„æµç±»å‹ï¼Œffmpeg å°†ä»æ‰€æœ‰è¾“å…¥ä¸­é€‰æ‹©ä¸€ä¸ªå¯ç”¨çš„æµã€‚\nå®ƒå°†æ ¹æ®ä»¥ä¸‹æ ‡å‡†é€‰æ‹©è¯¥æµ:\n å¯¹äºè§†é¢‘ï¼Œå®ƒæ˜¯æœ€é«˜åˆ†è¾¨ç‡çš„æµ, å¯¹äºéŸ³é¢‘æ¥è¯´ï¼Œå®ƒæ˜¯æ‹¥æœ‰æœ€å¤šé€šé“çš„æµ, å¯¹äºå­—å¹•ï¼Œå®ƒæ˜¯ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„å­—å¹•æµï¼Œä½†æœ‰ä¸€ä¸ªæ³¨æ„äº‹é¡¹ã€‚è¾“å‡ºæ ¼å¼çš„é»˜è®¤å­—å¹•ç¼–ç å™¨å¯ä»¥æ˜¯åŸºäºæ–‡æœ¬çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯åŸºäºå›¾åƒçš„ï¼Œè€Œä¸”åªä¼šé€‰æ‹©ç›¸åŒç±»å‹çš„å­—å¹•æµã€‚  åœ¨å‡ ä¸ªç›¸åŒç±»å‹çš„æµé€Ÿç‡ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œä¼šé€‰æ‹©æŒ‡æ•°æœ€ä½çš„æµã€‚\næ•°æ®æµæˆ–é™„ä»¶æµä¸ä¼šè¢«è‡ªåŠ¨é€‰æ‹©ï¼Œåªèƒ½ä½¿ç”¨ -map æ¥åŒ…å«ã€‚\næ‰‹åŠ¨é€‰æ‹©æµ å½“ä½¿ç”¨ -map æ—¶ï¼Œåªæœ‰ç”¨æˆ·æ˜ å°„çš„æµæ‰ä¼šè¢«åŒ…å«åœ¨è¯¥è¾“å‡ºæ–‡ä»¶ä¸­ï¼Œä¸‹é¢æè¿°çš„æ»¤æ³¢å›¾è¾“å‡ºå¯èƒ½æ˜¯ä¸€ä¸ªä¾‹å¤–ã€‚\nå¤æ‚çš„æ»¤æ³¢å›¾ å¦‚æœæœ‰ä»»ä½•å¤æ‚çš„æ»¤æ³¢å›¾è¾“å‡ºæµå¸¦æœ‰æœªæ ‡è®°çš„å¡«è¡¥(pad)ï¼Œå®ƒä»¬å°†è¢«æ·»åŠ åˆ°ç¬¬ä¸€ä¸ªè¾“å‡ºæ–‡ä»¶ä¸­ã€‚å¦‚æœæµç±»å‹ä¸è¢«è¾“å‡ºæ ¼å¼æ”¯æŒï¼Œè¿™å°†å¯¼è‡´ä¸€ä¸ªè‡´å‘½çš„é”™è¯¯ã€‚åœ¨æ²¡æœ‰ map é€‰é¡¹çš„æƒ…å†µä¸‹ï¼ŒåŒ…å«è¿™äº›æµä¼šå¯¼è‡´è‡ªåŠ¨é€‰æ‹©æµçš„ç±»å‹è¢«è·³è¿‡ã€‚å¦‚æœå­˜åœ¨ map é€‰é¡¹ï¼Œè¿™äº›æ»¤æ³¢å›¾æµä¼šè¢«åŒ…å«åœ¨æ˜ å°„æµä¹‹å¤–ã€‚\nå¸¦æœ‰æ ‡ç­¾å¡«è¡¥çš„å¤æ‚æ»¤æ³¢å›¾è¾“å‡ºæµå¿…é¡»è¢«æ˜ å°„ä¸€æ¬¡ï¼Œè€Œä¸”æ˜¯ç²¾ç¡®åœ°æ˜ å°„ä¸€æ¬¡ã€‚\næµå¤„ç† æµå¤„ç†æ˜¯ç‹¬ç«‹äºæµé€‰æ‹©çš„ï¼Œä¸‹é¢æè¿°çš„å­—å¹•é™¤å¤–ã€‚æµå¤„ç†æ˜¯é€šè¿‡é’ˆå¯¹ç‰¹å®šè¾“å‡ºæ–‡ä»¶ä¸­çš„æµçš„ -codec é€‰é¡¹æ¥è®¾ç½®çš„ã€‚ç‰¹åˆ«æ˜¯ï¼Œç¼–è§£ç å™¨é€‰é¡¹æ˜¯åœ¨æµé€‰æ‹©è¿‡ç¨‹ä¹‹åç”± ffmpeg åº”ç”¨çš„ï¼Œå› æ­¤ä¸ä¼šå½±å“åè€…ã€‚å¦‚æœæ²¡æœ‰ä¸ºæŸä¸ªæµç±»å‹æŒ‡å®š -codec é€‰é¡¹ï¼Œffmpeg å°†é€‰æ‹©è¾“å‡ºæ–‡ä»¶ muxer æ³¨å†Œçš„é»˜è®¤ç¼–ç å™¨ã€‚\nå­—å¹•å­˜åœ¨ä¸€ä¸ªä¾‹å¤–ã€‚ffmpeg ä¸ä¼šéªŒè¯æŒ‡å®šçš„ç¼–ç å™¨æ˜¯å¦å¯ä»¥è½¬æ¢æ‰€é€‰çš„æµï¼Œä¹Ÿä¸ä¼šéªŒè¯è½¬æ¢åçš„æµæ˜¯å¦å¯ä»¥åœ¨è¾“å‡ºæ ¼å¼ä¸­æ¥å—ã€‚è¿™é€šå¸¸ä¹Ÿé€‚ç”¨äºï¼šå½“ç”¨æˆ·æ‰‹åŠ¨è®¾ç½®ç¼–ç å™¨æ—¶ï¼Œæµé€‰æ‹©è¿‡ç¨‹ä¸èƒ½æ£€æŸ¥ç¼–ç åçš„æµæ˜¯å¦èƒ½è¢«æ··å…¥è¾“å‡ºæ–‡ä»¶ä¸­ã€‚å¦‚æœä¸èƒ½ï¼Œffmpeg å°†ä¸­æ­¢ï¼Œæ‰€æœ‰çš„è¾“å‡ºæ–‡ä»¶å°†æ— æ³•è¢«å¤„ç†ã€‚\nç¤ºä¾‹ ä¸‹é¢çš„ä¾‹å­è¯´æ˜äº† ffmpeg æµé€‰æ‹©æ–¹æ³•çš„è¡Œä¸ºã€æ€ªç™–å’Œé™åˆ¶ã€‚\nå®ƒä»¬å‡è®¾ä»¥ä¸‹ä¸‰ä¸ªè¾“å…¥æ–‡ä»¶:\ninput file 'A.avi' stream 0: video 640x360 stream 1: audio 2 channels input file 'B.mp4' stream 0: video 1920x1080 stream 1: audio 2 channels stream 2: subtitles (text) stream 3: audio 5.1 channels stream 4: subtitles (text) input file 'C.mkv' stream 0: video 1280x720 stream 1: audio 2 channels stream 2: subtitles (image) ","permalink":"https://ohmyweekly.github.io/notes/ffmpeg/","tags":["ffmpeg","tiktok"],"title":"FFmpeg"},{"categories":["ffmpeg"],"contents":"æŠ–éŸ³çŸ­è§†é¢‘æœ‰å¾ˆå¤šå¥½å¬çš„æ­Œ, ç½‘æ˜“äº‘éŸ³ä¹ã€QQéŸ³ä¹å’Œè™¾ç±³éŸ³ä¹ä¸Šéƒ½æ²¡æœ‰, ä½†æ˜¯å¯ä»¥æŠŠè§†é¢‘è½¬æˆ mp3 æ ¼å¼ã€‚ ä½¿ç”¨ FFmpeg æ¥æå®šã€‚ç‚¹å‡»æŠ–éŸ³ä¸Šçš„è½¬å‘æŒ‰é’®, å¦‚æœã€Œä¿å­˜æœ¬åœ°ã€çš„æŒ‰é’®ä¸æ˜¯ç°è‰²çš„, è¡¨ç¤ºå¯ä»¥ä¸‹è½½åˆ°æ‰‹æœºä¸Šã€‚ä¸‹è½½å®Œå, å†è½¬å‘åˆ°ç”µè„‘ä¸Š, ä¸‹è½½å¥½ ffmpeg:\nbrew install ffmpeg ä»è§†é¢‘ä¸­é‡‡é›†éŸ³é¢‘ ffmpeg -i input.mp4 -f mp3 -vn output.mp3 æˆ–\nffmpeg -i input.mp4 -q:a 0 -map a output.mp3 æˆ–è€…åªæˆªå–å…¨éƒ¨éŸ³é¢‘ä¸­çš„ä¸€å°æ®µ:\nffmpeg -ss 00:00:03 -t 0:0:14 -i alcastar.mp4 -f mp3 -vn alcastar.mp3 å…¶ä¸­ -ss 00:00:03 ç”¨äºæŒ‡å®šè¦æˆªå–çš„éŸ³é¢‘çš„èµ·å§‹æ—¶é—´, å³ä»ç¬¬ä¸‰ç§’å¼€å§‹æˆªå–; -t 0:0:14 ç”¨äºæŒ‡å®šè¦æˆªå–çš„éŸ³é¢‘çš„æŒç»­æ—¶é•¿, å³æˆªå– 14 ç§’çš„éŸ³é¢‘ã€‚ -i alcastar.mp4 ç”¨äºæŒ‡å®šè¾“å…¥æ–‡ä»¶, å³ä¸‹è½½å¥½çš„è§†é¢‘æ–‡ä»¶; -f mp3 ç”¨äºæŒ‡å®šè¾“å‡ºæ ¼å¼ä¸º mp3; -vn å³ no vedio, å³ä¸ä¿ç•™è§†é¢‘; æœ€åçš„ alcastar.mp3 æ˜¯è¾“å‡ºæ–‡ä»¶åã€‚\nå»é™¤éŸ³é¢‘ä¸­çš„é™éŸ³ ffmpeg -i input.mp3 -af silenceremove=1:0:-50dB output.mp3 ç»™è§†é¢‘æ·»åŠ å­—å¹• ffmpeg -i input.mp4 -i SRTæ–‡ä»¶ -c copy -c:s mov_text -metadata:s:s:0 language=\u0026lt;language code\u0026gt; output.mp4 ç§»é™¤è¶…è¿‡1ç§’çš„é™æ­¢ç”»é¢ ffmpeg -i in.mp4 -vf \u0026#34;select=\u0026#39;if(gt(scene,0.01),st(1,t),lte(t-ld(1),1))\u0026#39;,setpts=N/FRAME_RATE/TB\u0026#34; trimmed.mp4 å°†å›¾ç‰‡å’ŒéŸ³é¢‘åˆæˆè§†é¢‘ ffmpeg -loop 1 -i $image -i $audio_file -q:v 1 -c:a copy -shortest $video_file å°†å¤šä¸ªè§†é¢‘åˆå¹¶æˆä¸€ä¸ª ffmpeg -safe 0 -f concat -i $list_file -c:v libx264 $final list file çš„æ ¼å¼æ˜¯ï¼š\nfile './data_1.ts' file './data_2.ts' file './data_3.ts' ","permalink":"https://ohmyweekly.github.io/notes/ffmpeg-notes/","tags":["ffmpeg","tiktok"],"title":"ä½¿ç”¨ FFmpeg æå–æŠ–éŸ³çŸ­è§†é¢‘ä¸­çš„éŸ³ä¹"},{"categories":["programming"],"contents":"Dart ç”Ÿæ€ç³»ç»Ÿä½¿ç”¨åŒ…æ¥å…±äº«è½¯ä»¶ï¼Œå¦‚åº“å’Œå·¥å…·ã€‚æœ¬é¡µå‘Šè¯‰ä½ å¦‚ä½•åˆ›å»ºä¸€ä¸ªåŒ…ï¼Œé‡ç‚¹æ˜¯æœ€å¸¸è§çš„ä¸€ç§åŒ…ï¼Œåº“åŒ…ã€‚\næ˜¯ä»€ä¹ˆé€ å°±äº†ä¸€ä¸ªåº“åŒ… ä¸‹å›¾æ˜¯æœ€ç®€å•çš„åº“åŒ…çš„å¸ƒå±€:\nä¸€ä¸ªåº“çš„æœ€ä½è¦æ±‚æ˜¯\npubspec æ–‡ä»¶\nåº“çš„ pubspec.yaml æ–‡ä»¶å’Œåº”ç”¨ç¨‹åºåŒ…çš„æ–‡ä»¶æ˜¯ä¸€æ ·çš„-æ²¡æœ‰ç‰¹åˆ«çš„åç§°æ¥è¡¨ç¤ºè¿™ä¸ªåŒ…æ˜¯ä¸€ä¸ªåº“ã€‚\nlib ç›®å½•\næ­£å¦‚ä½ æ‰€æœŸæœ›çš„é‚£æ ·ï¼Œåº“ä»£ç å­˜åœ¨äº lib ç›®å½•ä¸‹ï¼Œå¯¹å…¶ä»–åŒ…æ˜¯å…¬å¼€çš„ã€‚ä½ å¯ä»¥æ ¹æ®éœ€è¦åœ¨ lib ä¸‹åˆ›å»ºä»»ä½•å±‚æ¬¡ç»“æ„ã€‚æŒ‰ç…§æƒ¯ä¾‹ï¼Œå®ç°ä»£ç è¢«æ”¾åœ¨ lib/src ä¸‹ã€‚lib/src ä¸‹çš„ä»£ç è¢«è®¤ä¸ºæ˜¯ç§æœ‰çš„ï¼›å…¶ä»–åŒ…ä¸åº”è¯¥éœ€è¦å¯¼å…¥ src/...ã€‚è¦ä½¿ lib/src ä¸‹çš„ API å…¬å¼€ï¼Œæ‚¨å¯ä»¥ä»ç›´æ¥ä½äº lib ä¸‹çš„æ–‡ä»¶å¯¼å‡º lib/src æ–‡ä»¶ã€‚\næ³¨æ„ï¼šå½“æ²¡æœ‰æŒ‡å®š library æŒ‡ä»¤æ—¶ï¼Œä¼šæ ¹æ®æ¯ä¸ªåº“çš„è·¯å¾„å’Œæ–‡ä»¶åä¸ºå…¶ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„æ ‡ç­¾ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨ä»ä»£ç ä¸­çœç•¥ library æŒ‡ä»¤ï¼Œé™¤éæ‚¨è®¡åˆ’ç”Ÿæˆåº“çº§æ–‡æ¡£ã€‚\nç»„ç»‡ä¸€ä¸ªåº“åŒ… å½“ä½ åˆ›å»ºå°çš„ã€å•ç‹¬çš„åº“ï¼ˆç§°ä¸ºè¿·ä½ åº“ï¼‰æ—¶ï¼Œåº“åŒ…çš„ç»´æŠ¤ã€æ‰©å±•å’Œæµ‹è¯•æ˜¯æœ€å®¹æ˜“çš„ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ¯ä¸ªç±»éƒ½åº”è¯¥åœ¨è‡ªå·±çš„è¿·ä½ åº“ä¸­ï¼Œé™¤éä½ æœ‰ä¸¤ä¸ªç±»æ˜¯ç´§å¯†è€¦åˆçš„æƒ…å†µã€‚\næ³¨æ„ï¼šä½ å¯èƒ½å¬è¯´è¿‡ part æŒ‡ä»¤ï¼Œå®ƒå…è®¸ä½ å°†ä¸€ä¸ªåº“åˆ†å‰²æˆå¤šä¸ª Dart æ–‡ä»¶ã€‚æˆ‘ä»¬å»ºè®®ä½ é¿å…ä½¿ç”¨ part æŒ‡ä»¤ï¼Œè€Œæ˜¯åˆ›å»ºè¿·ä½ åº“ã€‚\nç›´æ¥åœ¨ lib ä¸‹åˆ›å»ºä¸€ä¸ª\u0026quot;ä¸»\u0026quot;åº“æ–‡ä»¶ï¼Œlib/\u0026lt;package-name\u0026gt;.dartï¼Œå¯¼å‡ºæ‰€æœ‰çš„å…¬å…± APIã€‚è¿™æ ·ç”¨æˆ·å°±å¯ä»¥é€šè¿‡å¯¼å…¥ä¸€ä¸ªæ–‡ä»¶æ¥è·å¾—ä¸€ä¸ªåº“çš„æ‰€æœ‰åŠŸèƒ½ã€‚\nlib ç›®å½•ä¹Ÿå¯èƒ½åŒ…å«å…¶ä»–å¯å¯¼å…¥çš„ã€ésrcçš„åº“ã€‚ä¾‹å¦‚ï¼Œä¹Ÿè®¸ä½ çš„ä¸»åº“å¯ä»¥è·¨å¹³å°ä½¿ç”¨ï¼Œä½†æ˜¯ä½ åˆ›å»ºäº†å•ç‹¬çš„åº“ï¼Œè¿™äº›åº“ä¾èµ–äº dart:io æˆ–è€… dart:htmlã€‚æœ‰äº›åŒ…æœ‰å•ç‹¬çš„åº“ï¼Œè¿™äº›åº“æ˜¯è¦ç”¨å‰ç¼€å¯¼å…¥çš„ï¼Œè€Œä¸»åº“ä¸æ˜¯ã€‚\nè®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€ä¸ªç°å®ä¸–ç•Œä¸­çš„åº“åŒ…çš„ç»„ç»‡ï¼š shelfã€‚shelf åŒ…æä¾›äº†ä¸€ç§ä½¿ç”¨ Dart åˆ›å»º web æœåŠ¡å™¨çš„ç®€å•æ–¹æ³•ï¼Œå®ƒçš„å¸ƒå±€ç»“æ„æ˜¯ Dart åº“åŒ…å¸¸ç”¨çš„:\nç›´æ¥åœ¨ lib ä¸‹ï¼Œä¸»åº“æ–‡ä»¶ shelf.dart ä» lib/src å¯¼å‡ºå‡ ä¸ªæ–‡ä»¶:\nexport \u0026#39;src/cascade.dart\u0026#39;; export \u0026#39;src/handler.dart\u0026#39;; export \u0026#39;src/handlers/logger.dart\u0026#39;; export \u0026#39;src/hijack_exception.dart\u0026#39;; export \u0026#39;src/middleware.dart\u0026#39;; export \u0026#39;src/pipeline.dart\u0026#39;; export \u0026#39;src/request.dart\u0026#39;; export \u0026#39;src/response.dart\u0026#39;; export \u0026#39;src/server.dart\u0026#39;; export \u0026#39;src/server_handler.dart\u0026#39;; shelf åŒ…è¿˜åŒ…å«ä¸€ä¸ªè¿·ä½ åº“ï¼š shelf_ioã€‚è¿™ä¸ªé€‚é…å™¨å¤„ç†æ¥è‡ª dart:io çš„ HttpRequest å¯¹è±¡ã€‚\nå¯¹ç½‘ç»œåº”ç”¨çš„æç¤º: ä¸ºäº†åœ¨ä½¿ç”¨ dartdevc å¼€å‘æ—¶è·å¾—æœ€ä½³æ€§èƒ½ï¼Œè¯·å°†å®ç°æ–‡ä»¶æ”¾åœ¨ /lib/src ä¸‹ï¼Œè€Œä¸æ˜¯æ”¾åœ¨ /lib ä¸‹çš„å…¶ä»–åœ°æ–¹ã€‚åŒæ—¶ï¼Œé¿å…å¯¼å…¥ package:package_name/src/... çš„æ–‡ä»¶ã€‚\nå¯¼å…¥åº“æ–‡ä»¶ å½“ä»å…¶ä»–åŒ…ä¸­å¯¼å…¥ä¸€ä¸ªåº“æ–‡ä»¶æ—¶ï¼Œä½¿ç”¨ package: æŒ‡ä»¤æ¥æŒ‡å®šè¯¥æ–‡ä»¶çš„ URIã€‚\nimport \u0026#39;package:utilities/utilities.dart\u0026#39;; å½“ä»è‡ªå·±çš„åŒ…ä¸­å¯¼å…¥ä¸€ä¸ªåº“æ–‡ä»¶æ—¶ï¼Œå½“ä¸¤ä¸ªæ–‡ä»¶éƒ½åœ¨ lib å†…ï¼Œæˆ–è€…ä¸¤ä¸ªæ–‡ä»¶éƒ½åœ¨ lib å¤–æ—¶ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„ã€‚ä½¿ç”¨ :package å½“å¯¼å…¥çš„æ–‡ä»¶åœ¨ lib å†…ï¼Œè€Œå¯¼å…¥è€…åœ¨ lib å¤–æ—¶ã€‚\nä¸‹å›¾æ˜¾ç¤ºäº†å¦‚ä½•ä» lib å’Œ web ä¸­å¯¼å…¥ lib/foo/a.dartã€‚\næœ‰æ¡ä»¶åœ°å¯¼å…¥å’Œå¯¼å‡ºåº“æ–‡ä»¶ å¦‚æœä½ çš„åº“æ”¯æŒå¤šä¸ªå¹³å°ï¼Œé‚£ä¹ˆä½ å¯èƒ½éœ€è¦æœ‰æ¡ä»¶åœ°å¯¼å…¥æˆ–å¯¼å‡ºåº“æ–‡ä»¶ã€‚ä¸€ä¸ªå¸¸è§çš„ç”¨ä¾‹æ˜¯ä¸€ä¸ªåŒæ—¶æ”¯æŒ web å’ŒåŸç”Ÿå¹³å°çš„åº“ã€‚\nè¦æœ‰æ¡ä»¶çš„å¯¼å…¥æˆ–å¯¼å‡ºï¼Œä½ éœ€è¦æ£€æŸ¥ dart:* åº“çš„å­˜åœ¨ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªæœ‰æ¡ä»¶å¯¼å‡ºä»£ç çš„ä¾‹å­ï¼Œå®ƒæ£€æŸ¥ dart:io å’Œ dart:html çš„å­˜åœ¨:\nexport \u0026#39;src/hw_none.dart\u0026#39; // Stub implementation if (dart.library.io) \u0026#39;src/hw_io.dart\u0026#39; // dart:io implementation if (dart.library.html) \u0026#39;src/hw_html.dart\u0026#39;; // dart:html implementation ä¸‹é¢æ˜¯è¿™æ®µä»£ç çš„ä½œç”¨ã€‚\n åœ¨ä¸€ä¸ªå¯ä»¥ä½¿ç”¨ dart:io çš„åº”ç”¨ç¨‹åºä¸­(ä¾‹å¦‚ï¼Œä¸€ä¸ªå‘½ä»¤è¡Œåº”ç”¨ç¨‹åº)ï¼Œå¯¼å‡º src/hw_io.dart åœ¨ä¸€ä¸ªå¯ä»¥ä½¿ç”¨ dart:html çš„åº”ç”¨ç¨‹åºä¸­(ä¸€ä¸ª web åº”ç”¨ç¨‹åº)ï¼Œå¯¼å‡º src/hw_html.dart å¦åˆ™ï¼Œå¯¼å‡º src/hw_none.dart  è¦æœ‰æ¡ä»¶åœ°å¯¼å…¥ä¸€ä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨ä¸ä¸Šé¢ç›¸åŒçš„ä»£ç ï¼Œä½†å°† exporrt æ”¹ä¸º importã€‚\næ³¨æ„ï¼šæœ‰æ¡ä»¶çš„å¯¼å…¥æˆ–å¯¼å‡ºåªæ£€æŸ¥åº“åœ¨å½“å‰å¹³å°ä¸Šæ˜¯å¦å¯ç”¨ï¼Œè€Œä¸æ˜¯æ£€æŸ¥æ˜¯å¦å®é™…å¯¼å…¥æˆ–ä½¿ç”¨ã€‚\næ‰€æœ‰æœ‰æ¡ä»¶å¯¼å‡ºçš„åº“éƒ½å¿…é¡»å®ç°ç›¸åŒçš„ APIã€‚ä¾‹å¦‚ï¼Œè¿™é‡Œæ˜¯ dart:io çš„å®ç°:\nimport \u0026#39;dart:io\u0026#39;; void alarm([String text]) { stderr.writeln(text ?? message); } String get message =\u0026gt; \u0026#39;Hello World from the VM!\u0026#39;; è¿™é‡Œæ˜¯é»˜è®¤çš„å®ç°ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŠ›å‡º UnsupportedErrors çš„ stubã€‚\nvoid alarm([String text]) =\u0026gt; throw UnsupportedError(\u0026#39;hw_none alarm\u0026#39;); String get message =\u0026gt; throw UnsupportedError(\u0026#39;hw_none message\u0026#39;); åœ¨ä»»ä½•å¹³å°ä¸Šï¼Œä½ éƒ½å¯ä»¥å¯¼å…¥æœ‰æ¡ä»¶å¯¼å‡ºä»£ç çš„åº“ã€‚\nimport \u0026#39;package:hw_mp/hw_mp.dart\u0026#39;; void main() { print(message); } æä¾›è¡¥å……æ–‡ä»¶ ä¸€ä¸ªè®¾è®¡è‰¯å¥½çš„åº“åŒ…æ˜¯å¾ˆå®¹æ˜“æµ‹è¯•çš„ã€‚æˆ‘ä»¬å»ºè®®ä½ ä½¿ç”¨ test åŒ…æ¥ç¼–å†™æµ‹è¯•ï¼Œå°†æµ‹è¯•ä»£ç æ”¾åœ¨æµ‹è¯•åŒ…é¡¶éƒ¨çš„ test ç›®å½•ä¸­ã€‚\nå¦‚æœä½ åˆ›å»ºäº†ä»»ä½•æ—¨åœ¨ä¾›å…¬ä¼—ä½¿ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œè¯·å°†è¿™äº›å·¥å…·æ”¾åœ¨ bin ç›®å½•ä¸‹ï¼Œè¿™æ˜¯å…¬å…±çš„ã€‚å¯ç”¨ä»å‘½ä»¤è¡Œè¿è¡Œå·¥å…·ï¼Œä½¿ç”¨ pub global activateã€‚å°†å·¥å…·åˆ—åœ¨ pubspec çš„å¯æ‰§è¡Œæ–‡ä»¶éƒ¨åˆ†ï¼Œå…è®¸ç”¨æˆ·ç›´æ¥è¿è¡Œå®ƒï¼Œè€Œæ— éœ€è°ƒç”¨ pub global runã€‚\nå¦‚æœä½ åŒ…å«äº†ä¸€ä¸ªå¦‚ä½•ä½¿ç”¨ä½ çš„åº“çš„ä¾‹å­ï¼Œè¿™å°†ä¼šå¾ˆæœ‰å¸®åŠ©ã€‚è¿™å°†è¢«æ”¾å…¥è½¯ä»¶åŒ…é¡¶éƒ¨çš„ example ç›®å½•ä¸­ã€‚\nä½ åœ¨å¼€å‘è¿‡ç¨‹ä¸­åˆ›å»ºçš„ä»»ä½•å·¥å…·æˆ–å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¦‚æœä¸æ˜¯å…¬å¼€ä½¿ç”¨çš„ï¼Œéƒ½ä¼šè¿›å…¥ tool ç›®å½•ã€‚\nå¦‚æœä½ æŠŠä½ çš„åº“å‘å¸ƒåˆ° pub.dev ç«™ç‚¹ï¼Œå…¶ä»–éœ€è¦çš„æ–‡ä»¶ï¼Œå¦‚ README.md å’Œ CHANGELOG.mdï¼Œå°†åœ¨å‘å¸ƒè½¯ä»¶åŒ…ä¸­æè¿°ã€‚æœ‰å…³å¦‚ä½•ç»„ç»‡åŒ…ç›®å½•çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ pub åŒ…å¸ƒå±€æƒ¯ä¾‹ã€‚\nç¼–å†™åº“æ–‡æ¡£ ä½ å¯ä»¥ä½¿ç”¨ dartdoc å·¥å…·ä¸ºä½ çš„åº“ç”Ÿæˆ API æ–‡æ¡£ã€‚Dartdoc è§£ææºç å¯»æ‰¾æ–‡æ¡£æ³¨é‡Šï¼Œå…¶ä¸­ä½¿ç”¨äº† /// è¯­æ³•:\n/// The event handler responsible for updating the badge in the UI. void updateBadge() { ... } å…³äºç”Ÿæˆæ–‡æ¡£çš„ä¾‹å­ï¼Œè¯·çœ‹ shelf æ–‡æ¡£ã€‚\næ³¨æ„ï¼šè¦åœ¨ç”Ÿæˆçš„æ–‡æ¡£ä¸­åŒ…å«ä»»ä½•åº“çº§æ–‡æ¡£ï¼Œä½ å¿…é¡»æŒ‡å®š library æŒ‡ä»¤ã€‚è¯·å‚é˜… é—®é¢˜ 1082ã€‚\nåˆ†å‘ä¸€ä¸ªå¼€æºåº“ å¦‚æœä½ çš„åº“æ˜¯å¼€æºçš„ï¼Œæˆ‘ä»¬å»ºè®®åœ¨ pub.dev ç«™ç‚¹ä¸Šåˆ†äº«å®ƒã€‚è¦å‘å¸ƒæˆ–æ›´æ–°åº“ï¼Œè¯·ä½¿ç”¨ pub publishï¼Œå®ƒå¯ä»¥ä¸Šä¼ æ‚¨çš„åŒ…å¹¶åˆ›å»ºæˆ–æ›´æ–°å…¶é¡µé¢ã€‚ä¾‹å¦‚ï¼Œè¯·çœ‹ shelf åŒ…çš„é¡µé¢ã€‚æœ‰å…³å¦‚ä½•å‡†å¤‡å‘å¸ƒè½¯ä»¶åŒ…çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§å‘å¸ƒåŒ…ã€‚\npub.dev ç«™ç‚¹ä¸ä»…æ‰˜ç®¡æ‚¨çš„è½¯ä»¶åŒ…ï¼Œè€Œä¸”è¿˜ç”Ÿæˆå’Œæ‰˜ç®¡æ‚¨è½¯ä»¶åŒ…çš„ API å‚è€ƒæ–‡æ¡£ã€‚æœ€æ–°ç”Ÿæˆçš„æ–‡æ¡£çš„é“¾æ¥åœ¨è½¯ä»¶åŒ…çš„ About æ¡†ä¸­ï¼›ä¾‹å¦‚ï¼Œè¯·çœ‹ shelf åŒ…çš„ API æ–‡æ¡£ã€‚åˆ°ä»¥å‰ç‰ˆæœ¬çš„æ–‡æ¡£çš„é“¾æ¥åœ¨è½¯ä»¶åŒ…é¡µé¢çš„ç‰ˆæœ¬é€‰é¡¹å¡ä¸­ã€‚\nè¦ç¡®ä¿ä½ çš„è½¯ä»¶åŒ…çš„ API æ–‡æ¡£åœ¨ pub.dev ç½‘ç«™ä¸Šçœ‹èµ·æ¥ä¸é”™ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œã€‚\n åœ¨å‘å¸ƒä½ çš„è½¯ä»¶åŒ…ä¹‹å‰ï¼Œè¿è¡Œ dartdoc å·¥å…·ï¼Œä»¥ç¡®ä¿ä½ çš„ docs æˆåŠŸç”Ÿæˆï¼Œå¹¶ä¸”çœ‹èµ·æ¥ç¬¦åˆé¢„æœŸã€‚ å‘å¸ƒè½¯ä»¶åŒ…åï¼Œæ£€æŸ¥ Versions é€‰é¡¹å¡ä»¥ç¡®ä¿æ–‡æ¡£æˆåŠŸç”Ÿæˆã€‚ å¦‚æœæ–‡æ¡£æ ¹æœ¬æ²¡æœ‰ç”Ÿæˆï¼Œç‚¹å‡» Verrsions é€‰é¡¹å¡ä¸­çš„ failedï¼ŒæŸ¥çœ‹ dartdoc çš„è¾“å‡ºã€‚  èµ„æº ä½¿ç”¨ä»¥ä¸‹èµ„æºäº†è§£æ›´å¤šå…³äºåº“åŒ…çš„ä¿¡æ¯ã€‚\n è¯­è¨€ä¹‹æ—…ä¸­çš„åº“å’Œå¯è§æ€§åŒ…æ‹¬ä½¿ç”¨åº“æ–‡ä»¶ã€‚ åŒ…æ–‡æ¡£å¾ˆæœ‰ç”¨ï¼Œç‰¹åˆ«æ˜¯åŒ…çš„å¸ƒå±€çº¦å®šã€‚ ä¸åº”æäº¤çš„å†…å®¹æ¶µç›–äº†å“ªäº›ä¸åº”è¯¥è¢«æ£€æŸ¥åˆ°æºä»£ç åº“ä¸­ã€‚ dart-lang ç»„ç»‡ä¸‹çš„è¾ƒæ–°çš„åº“åŒ…å€¾å‘äºå±•ç¤ºæœ€ä½³å®è·µã€‚å¯ä»¥è€ƒè™‘ç ”ç©¶è¿™äº›ä¾‹å­ï¼šdart_styleã€pathã€shelfã€source_gen å’Œ testã€‚  ","permalink":"https://ohmyweekly.github.io/notes/creating-packages/","tags":["flutter","packages"],"title":"åˆ›å»ºåŒ…"},{"categories":["programming"],"contents":"pub è½¯ä»¶åŒ…ç®¡ç†å™¨ä¸ä»…ä»…æ˜¯ç”¨æ¥ä½¿ç”¨åˆ«äººçš„è½¯ä»¶åŒ…ã€‚å®ƒè¿˜å…è®¸ä½ ä¸ä¸–ç•Œåˆ†äº«ä½ çš„è½¯ä»¶åŒ…ã€‚å¦‚æœæ‚¨æœ‰ä¸€ä¸ªæœ‰ç”¨çš„é¡¹ç›®ï¼Œå¹¶ä¸”æ‚¨å¸Œæœ›å…¶ä»–äººèƒ½å¤Ÿä½¿ç”¨å®ƒï¼Œè¯·ä½¿ç”¨ pub publish å‘½ä»¤ã€‚\næ³¨æ„: å¦‚æœè¦å‘å¸ƒåˆ° pub.dev ä»¥å¤–çš„å…¶ä»–ä½ç½®ï¼Œæˆ–è€…è¦é˜²æ­¢åœ¨ä»»ä½•åœ°æ–¹å‘å¸ƒï¼Œè¯·ä½¿ç”¨ pubspec ä¸­å®šä¹‰çš„ publish_to å­—æ®µã€‚\nå‘å¸ƒæ˜¯æ°¸è¿œçš„ è¯·è®°ä½ï¼Œå‘å¸ƒæ˜¯æ°¸è¿œçš„ã€‚åªè¦ä½ å‘å¸ƒä½ çš„åŒ…ï¼Œç”¨æˆ·å°±å¯ä»¥ä¾èµ–å®ƒã€‚ä¸€æ—¦ä»–ä»¬å¼€å§‹è¿™æ ·åšï¼Œåˆ é™¤åŒ…å°±ä¼šç ´åä»–ä»¬çš„åŒ…ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œpub.dev æ”¿ç­–ä¸å…è®¸å–æ¶ˆå‘å¸ƒè½¯ä»¶åŒ…ï¼Œé™¤éæ˜¯æå°‘æ•°æƒ…å†µã€‚\nä½ å¯ä»¥éšæ—¶ä¸Šä¼ ä½ çš„åŒ…çš„æ–°ç‰ˆæœ¬ï¼Œä½†æ—§çš„åŒ…å°†ç»§ç»­ä¸ºé‚£äº›è¿˜æ²¡æœ‰å‡†å¤‡å¥½å‡çº§çš„ç”¨æˆ·æä¾›æœåŠ¡ã€‚\nå¯¹äºå·²ç»å‘å¸ƒçš„åŒ…ï¼Œå¦‚æœä¸å†ç›¸å…³æˆ–æ­£åœ¨ç»´æŠ¤ï¼Œä½ å¯ä»¥å°†å…¶æ ‡è®°ä¸ºåœæ­¢å‘å¸ƒã€‚\nå‡†å¤‡å‘å¸ƒ å½“å‘å¸ƒä¸€ä¸ªè½¯ä»¶åŒ…æ—¶ï¼Œéµå¾ª pubspec æ ¼å¼å’ŒåŒ…å¸ƒå±€æƒ¯ä¾‹æ˜¯å¾ˆé‡è¦çš„ã€‚å…¶ä¸­æœ‰äº›æ˜¯å¿…é¡»çš„ï¼Œä»¥ä¾¿å…¶ä»–äººèƒ½å¤Ÿä½¿ç”¨ä½ çš„è½¯ä»¶åŒ…ã€‚å¦ä¸€äº›åˆ™æ˜¯ä¸ºäº†å¸®åŠ©ç”¨æˆ·æ›´å®¹æ˜“ç†è§£å’Œä½¿ç”¨æ‚¨çš„è½¯ä»¶åŒ…è€Œæå‡ºçš„å»ºè®®ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œpub éƒ½ä¼šå°è¯•å¸®åŠ©ä½ ï¼ŒæŒ‡å‡ºå“ªäº›æ”¹å˜ä¼šå¸®åŠ©ä½ çš„è½¯ä»¶åŒ…åœ¨ Dart ç”Ÿæ€ç³»ç»Ÿä¸­å‘æŒ¥å¾—æ›´å¥½ã€‚ä¸Šä¼ åŒ…æœ‰ä¸€äº›é¢å¤–çš„è¦æ±‚:\n  ä½ å¿…é¡»åŒ…å«ä¸€ä¸ªåŒ…å«å¼€æºè®¸å¯è¯çš„ LICENSE æ–‡ä»¶ã€‚æˆ‘ä»¬æ¨è BSD è®¸å¯è¯ï¼Œè¿™æ˜¯ Dart è‡ªå·±ä½¿ç”¨çš„ã€‚ä½ ä¹Ÿå¿…é¡»æœ‰åˆæ³•çš„æƒåˆ©æ¥é‡æ–°å‘å¸ƒä½ ä¸Šä¼ çš„ä»»ä½•ä¸œè¥¿ä½œä¸ºä½ çš„åŒ…çš„ä¸€éƒ¨åˆ†ã€‚\n  ä½ çš„è½¯ä»¶åŒ…åœ¨ç»è¿‡ gzip å‹ç¼©åå¿…é¡»å°äº 10 MBã€‚å¦‚æœå¤ªå¤§ï¼Œå¯ä»¥è€ƒè™‘å°†å…¶åˆ†å‰²æˆå¤šä¸ªåŒ…ï¼Œæˆ–è€…å‡å°‘åŒ…å«çš„èµ„æºæˆ–ä¾‹å­çš„æ•°é‡ã€‚\n  ä½ çš„åŒ…åº”è¯¥åªä¾èµ–æ‰˜ç®¡çš„ä¾èµ–é¡¹(æ¥è‡ªé»˜è®¤çš„ pub åŒ…æœåŠ¡å™¨)å’Œ SDK ä¾èµ–é¡¹(sdk: flutter)ã€‚è¿™äº›é™åˆ¶ç¡®ä¿äº†ä½ çš„åŒ…çš„ä¾èµ–æ€§ä¸ä¼šåœ¨æœªæ¥å˜å¾—ä¸å¯ç”¨ã€‚\n  æ‚¨å¿…é¡»æœ‰ä¸€ä¸ª Google å¸æˆ·ï¼Œpub ç”¨æ¥ç®¡ç†åŒ…çš„ä¸Šä¼ æƒé™ã€‚æ‚¨çš„ Google è´¦æˆ·å¯ä»¥ä¸ Gmail åœ°å€æˆ–ä»»ä½•å…¶ä»–ç”µå­é‚®ä»¶åœ°å€å…³è”ã€‚\n  æ³¨æ„ï¼šé™¤éæ‚¨ä½¿ç”¨å·²éªŒè¯çš„å‘å¸ƒè€…å‘å¸ƒï¼Œå¦åˆ™ pub.dev ä¼šæ˜¾ç¤ºä¸æ‚¨çš„ Google å¸æˆ·å…³è”çš„ç”µå­é‚®ä»¶åœ°å€ã€‚\né‡è¦æ–‡ä»¶ Pub ä½¿ç”¨ä¸€äº›æ–‡ä»¶çš„å†…å®¹ä¸ºä½ çš„åŒ…åˆ›å»ºä¸€ä¸ªé¡µé¢ï¼Œåœ°å€æ˜¯ pub.dev/packages/\u0026lt;your_package\u0026gt;ã€‚ä»¥ä¸‹æ˜¯å½±å“ä½ çš„åŒ…çš„é¡µé¢å¤–è§‚çš„æ–‡ä»¶ã€‚\n README.md: README.md æ–‡ä»¶æ˜¯ä½ çš„åŒ…é¡µé¢ä¸­çš„ä¸»è¦å†…å®¹ã€‚è¯¥æ–‡ä»¶çš„å†…å®¹ä»¥ Markdown çš„å½¢å¼å‘ˆç°ã€‚ CHANGELOG.mdï¼šCHANGELOG.md æ–‡ä»¶æ˜¯ä½ çš„åŒ…é¡µé¢ä¸­çš„ä¸»è¦å†…å®¹ã€‚ä½ çš„åŒ…çš„ CHANGELOG.md æ–‡ä»¶ï¼Œå¦‚æœæ‰¾åˆ°çš„è¯ï¼Œä¹Ÿä¼šåœ¨ä½ çš„åŒ…é¡µé¢çš„ä¸€ä¸ªæ ‡ç­¾ä¸­æ˜¾ç¤ºï¼Œè¿™æ ·å¼€å‘è€…å°±å¯ä»¥ç›´æ¥ä» pub.dev ä¸­è¯»å–å®ƒã€‚è¯¥æ–‡ä»¶çš„å†…å®¹ä¼šä»¥ Markdown çš„å½¢å¼å‘ˆç°ã€‚ pubspec: ä½ çš„åŒ…çš„ pubspec.yaml æ–‡ä»¶ç”¨æ¥åœ¨ä½ çš„åŒ…çš„é¡µé¢å³ä¾§å¡«å†™å…³äºä½ çš„åŒ…çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ¯”å¦‚å®ƒçš„æè¿°ã€ä¸»é¡µç­‰ã€‚  ä½¿ç”¨ç»è¿‡éªŒè¯çš„å‘å¸ƒè€…çš„ä¼˜åŠ¿ æ‚¨å¯ä»¥ä½¿ç”¨å·²éªŒè¯çš„å‘å¸ƒè€…ï¼ˆæ¨èï¼‰æˆ–ç‹¬ç«‹çš„è°·æ­Œè´¦æˆ·å‘å¸ƒè½¯ä»¶åŒ…ã€‚ä½¿ç”¨ç»è¿‡éªŒè¯çš„å‘å¸ƒè€…æœ‰ä»¥ä¸‹ä¼˜åŠ¿ã€‚\n æ‚¨çš„åŒ…çš„æ¶ˆè´¹è€…çŸ¥é“å‘å¸ƒè€…çš„åŸŸåå·²ç»è¢«éªŒè¯ã€‚ æ‚¨å¯ä»¥é¿å…è®© pub.dev æ˜¾ç¤ºæ‚¨çš„ä¸ªäººç”µå­é‚®ä»¶åœ°å€ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œpub.devä¼šæ˜¾ç¤ºå‘å¸ƒè€…çš„åŸŸåå’Œè”ç³»åœ°å€ã€‚ ç»éªŒè¯çš„å‘å¸ƒè€…å¾½ç«  pub.dev ç»éªŒè¯çš„å‘å¸ƒè€…æ ‡è¯†ä¼šåœ¨æœç´¢é¡µé¢å’Œå•ä¸ªè½¯ä»¶åŒ…é¡µé¢ä¸Šæ˜¾ç¤ºåœ¨æ‚¨çš„è½¯ä»¶åŒ…åç§°æ—è¾¹ã€‚  åˆ›å»ºä¸€ä¸ªéªŒè¯è¿‡çš„å‘å¸ƒè€… è¦åˆ›å»ºä¸€ä¸ªå·²éªŒè¯çš„å‘å¸ƒè€…ï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œã€‚\n è¿›å…¥ pub.devã€‚ ä½¿ç”¨ Google è´¦æˆ·ç™»å½• pub.devã€‚ åœ¨å³ä¸Šè§’çš„ç”¨æˆ·èœå•ä¸­ï¼Œé€‰æ‹©åˆ›å»ºå‘å¸ƒè€…ã€‚ è¾“å…¥æ‚¨è¦ä¸æ‚¨çš„å‘å¸ƒè€…ç›¸å…³è”çš„åŸŸå(ä¾‹å¦‚ï¼Œdart.dev)ï¼Œç„¶åå•å‡»\u0026quot;åˆ›å»ºå‘å¸ƒè€…\u0026quot;ã€‚ åœ¨ç¡®è®¤å¯¹è¯æ¡†ä¸­ï¼Œé€‰æ‹©\u0026quot;ç¡®å®š\u0026quot;ã€‚ å¦‚æœæç¤ºï¼Œå®ŒæˆéªŒè¯æµç¨‹ï¼Œè¿™å°†æ‰“å¼€ Google æœç´¢æ§åˆ¶å°ã€‚   åœ¨æ·»åŠ  DNS è®°å½•æ—¶ï¼Œå¯èƒ½éœ€è¦å‡ ä¸ªå°æ—¶åï¼Œæœç´¢æ§åˆ¶å°æ‰ä¼šåæ˜ å‡ºå˜åŒ–ã€‚ éªŒè¯æµç¨‹å®Œæˆåï¼Œè¿”å›æ­¥éª¤4ã€‚  å‘å¸ƒä½ çš„åŒ… ä½¿ç”¨ pub publish å‘½ä»¤æ¥é¦–æ¬¡å‘å¸ƒæ‚¨çš„è½¯ä»¶åŒ…ï¼Œæˆ–å°†å…¶æ›´æ–°åˆ°æ–°ç‰ˆæœ¬ã€‚\næ‰§è¡Œ dry run ä¸ºäº†æµ‹è¯• pub publish çš„å·¥ä½œæƒ…å†µï¼Œä½ å¯ä»¥è¿›è¡Œä¸€æ¬¡ dry run:\n$ pub publish --dry-run Pub ä¼šç¡®ä¿ä½ çš„è½¯ä»¶åŒ…éµå¾ª pubspec æ ¼å¼å’ŒåŒ…å¸ƒå±€çº¦å®šï¼Œç„¶åå°†ä½ çš„è½¯ä»¶åŒ…ä¸Šä¼ åˆ° pub.devã€‚Pub è¿˜ä¼šå‘ä½ å±•ç¤ºå®ƒæ‰“ç®—å‘å¸ƒçš„æ‰€æœ‰æ–‡ä»¶ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå‘å¸ƒåä¸º transmogrify çš„è½¯ä»¶åŒ…çš„ä¾‹å­:\nPublishing transmogrify 1.0.0.gitignoreCHANGELOG.mdREADME.mdlibtransmogrify.dartsrctransmogrifier.darttransmogrification.dartpubspec.yamltesttransmogrify_test.dartPackage has 0 warnings.å‘å¸ƒ å½“ä½ å‡†å¤‡å¥½å‘å¸ƒä½ çš„åŒ…æ—¶ï¼Œè¯·åˆ é™¤ --dry-run å‚æ•°:\n$ pub publish æ³¨æ„: pub å‘½ä»¤ç›®å‰ä¸æ”¯æŒç›´æ¥å°†æ–°è½¯ä»¶åŒ…å‘å¸ƒåˆ°å·²éªŒè¯çš„å‘å¸ƒè€…ã€‚ä½œä¸ºä¸€ä¸ªä¸´æ—¶çš„å˜é€šæ–¹æ³•ï¼Œå¯ä»¥å°†æ–°çš„è½¯ä»¶åŒ…å‘å¸ƒåˆ°Googleè´¦æˆ·ï¼Œç„¶åå°†åŒ…è½¬ç§»åˆ°å‘å¸ƒè€…ã€‚\nä¸€æ—¦è½¯ä»¶åŒ…è¢«è½¬ç§»åˆ°å‘å¸ƒè€…ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨ pub publish æ›´æ–°è½¯ä»¶åŒ…ã€‚\nå½“ä½ çš„åŒ…æˆåŠŸä¸Šä¼ åˆ° pub.dev åï¼Œä»»ä½• pub ç”¨æˆ·éƒ½å¯ä»¥ä¸‹è½½å®ƒæˆ–åœ¨ä»–ä»¬çš„é¡¹ç›®ä¸­ä¾èµ–å®ƒã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ åˆšåˆšå‘å¸ƒäº† 1.0.0 ç‰ˆæœ¬çš„ transmogrify åŒ…ï¼Œé‚£ä¹ˆå¦ä¸€ä¸ª Dart å¼€å‘è€…å¯ä»¥åœ¨ä»–ä»¬çš„ pubspec.yaml ä¸­æ·»åŠ å®ƒä½œä¸ºä¾èµ–:\ndependencies:transmogrify:^1.0.0å°†è½¯ä»¶åŒ…ä¼ è¾“ç»™å·²éªŒè¯çš„å‘å¸ƒè€… è¦å°†ä¸€ä¸ªè½¯ä»¶åŒ…è½¬ç§»åˆ°å·²éªŒè¯çš„å‘å¸ƒè€…ï¼Œæ‚¨å¿…é¡»æ˜¯è¯¥è½¯ä»¶åŒ…çš„ä¸Šä¼ è€…å’Œå·²éªŒè¯å‘å¸ƒè€…çš„ç®¡ç†å‘˜ã€‚\næ³¨æ„ï¼šè¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸å¯é€†çš„ã€‚ä¸€æ—¦ä½ å°†ä¸€ä¸ªè½¯ä»¶åŒ…è½¬ç§»åˆ°ä¸€ä¸ªå‘å¸ƒè€…ï¼Œä½ ä¸èƒ½å°†å®ƒè½¬ç§»å›ä¸ªäººè´¦æˆ·ã€‚\nä»¥ä¸‹æ˜¯å¦‚ä½•å°†è½¯ä»¶åŒ…è½¬ç§»åˆ°å·²éªŒè¯çš„å‘å¸ƒè€…:\n ç”¨ä¸€ä¸ªè¢«åˆ—ä¸ºè½¯ä»¶åŒ…ä¸Šä¼ è€…çš„ Google è´¦æˆ·ç™»å½•åˆ° pub.devã€‚ è¿›å…¥è½¯ä»¶åŒ…çš„è¯¦ç»†ä¿¡æ¯é¡µé¢(ä¾‹å¦‚ï¼Œhttps://pub.dev/packages/http)ã€‚ é€‰æ‹©\u0026quot;ç®¡ç†\u0026quot;é€‰é¡¹å¡ã€‚ è¾“å…¥å‘å¸ƒè€…çš„åç§°ï¼Œç„¶åå•å‡»\u0026quot;ä¼ è¾“åˆ°å‘å¸ƒè€…\u0026quot;ã€‚  å“ªäº›æ–‡ä»¶ä¼šè¢«å‘å¸ƒï¼Ÿ æ‚¨çš„è½¯ä»¶åŒ…ä¸­çš„æ‰€æœ‰æ–‡ä»¶éƒ½åŒ…å«åœ¨å·²å‘å¸ƒçš„è½¯ä»¶åŒ…ä¸­ï¼Œä½†æœ‰ä»¥ä¸‹ä¾‹å¤–:\n ä»»ä½•åŒ…çš„ç›®å½•ã€‚ æ‚¨çš„è½¯ä»¶åŒ…çš„ lockfile æ–‡ä»¶ã€‚ å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨ Gitï¼Œæ‰€æœ‰éšè—çš„æ–‡ä»¶ï¼ˆä¹Ÿå°±æ˜¯åå­—ä»¥ . å¼€å¤´çš„æ–‡ä»¶ï¼‰ã€‚ å¦‚æœä½¿ç”¨ Gitï¼Œåˆ™æ˜¯æ‰€æœ‰è¢« .gitignore æ–‡ä»¶å¿½ç•¥çš„æ–‡ä»¶ã€‚  è¯·ç¡®ä¿åˆ é™¤ä»»ä½•ä½ ä¸æƒ³åŒ…å«çš„æ–‡ä»¶(æˆ–å°†å®ƒä»¬æ·»åŠ åˆ° .gitignore ä¸­)ã€‚ pub publish åœ¨ä¸Šä¼ ä½ çš„åŒ…ä¹‹å‰åˆ—å‡ºäº†å®ƒè¦å‘å¸ƒçš„æ‰€æœ‰æ–‡ä»¶ï¼Œæ‰€ä»¥åœ¨å®Œæˆä¸Šä¼ ä¹‹å‰è¦ä»”ç»†æ£€æŸ¥åˆ—è¡¨ã€‚\nä¸Šä¼ è€… è°å‘å¸ƒäº†è½¯ä»¶åŒ…çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œè°å°±ä¼šè‡ªåŠ¨æˆä¸ºç¬¬ä¸€ä¸ªä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªè¢«æˆæƒä¸Šä¼ è¯¥è½¯ä»¶åŒ…å…¶ä»–ç‰ˆæœ¬çš„äººã€‚è¦å…è®¸æˆ–ä¸å…è®¸å…¶ä»–äººä¸Šä¼ ç‰ˆæœ¬ï¼Œè¯·ä½¿ç”¨ pub uploader å‘½ä»¤æˆ–å°†è½¯ä»¶åŒ…è½¬ç§»åˆ°å·²éªŒè¯çš„å‘å¸ƒè€…é‚£é‡Œã€‚\nå¦‚æœä¸€ä¸ªè½¯ä»¶åŒ…æœ‰ä¸€ä¸ªç»è¿‡éªŒè¯çš„å‘å¸ƒè€…ï¼Œé‚£ä¹ˆè¯¥è½¯ä»¶åŒ…çš„ pub.dev é¡µé¢ä¼šæ˜¾ç¤ºå‘å¸ƒè€…çš„åŸŸåã€‚å¦åˆ™ï¼Œè¯¥é¡µé¢å°†æ˜¾ç¤ºè¯¥è½¯ä»¶åŒ…çš„æˆæƒä¸Šä¼ è€…çš„ç”µå­é‚®ä»¶åœ°å€ã€‚\nå‘å¸ƒé¢„å‘åŒ… å½“ä½ åœ¨åšä¸€ä¸ªåŒ…çš„æ—¶å€™ï¼Œè€ƒè™‘æŠŠå®ƒä½œä¸ºä¸€ä¸ªé¢„å‘å¸ƒã€‚å½“ä»¥ä¸‹ä»»ä½•ä¸€ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼Œé¢„å‘å¸ƒéƒ½æ˜¯æœ‰ç”¨çš„ã€‚\n ä½ æ­£åœ¨ç§¯æå¼€å‘è½¯ä»¶åŒ…çš„ä¸‹ä¸€ä¸ªä¸»è¦ç‰ˆæœ¬ã€‚ ä½ æƒ³ä¸ºè½¯ä»¶åŒ…çš„ä¸‹ä¸€ä¸ªå‘è¡Œå€™é€‰ç‰ˆæœ¬æ‹›å‹Ÿæµ‹è¯•è€…ã€‚ è¯¥åŒ…ä¾èµ–äº Dart æˆ– Flutter SDK çš„ä¸ç¨³å®šç‰ˆæœ¬ã€‚  æ­£å¦‚åœ¨è¯­ä¹‰ç‰ˆæœ¬åŒ–ä¸­æ‰€æè¿°çš„é‚£æ ·ï¼Œä¸ºäº†ä½¿ä¸€ä¸ªç‰ˆæœ¬çš„é¢„å‘å¸ƒï¼Œä½ è¦ç»™ç‰ˆæœ¬é™„åŠ ä¸€ä¸ªåç¼€ã€‚ä¾‹å¦‚ï¼Œè¦å¯¹ 2.0.0 ç‰ˆæœ¬è¿›è¡Œé¢„å‘å¸ƒï¼Œä½ å¯ä»¥ä½¿ç”¨ 2.0.0-dev.1 ç‰ˆæœ¬ã€‚ä»¥åï¼Œå½“ä½ å‘å¸ƒ 2.0.0 ç‰ˆæœ¬æ—¶ï¼Œå®ƒå°†ä¼˜å…ˆäºæ‰€æœ‰ 2.0.0-XXX é¢„å‘å¸ƒç‰ˆæœ¬ã€‚\nå› ä¸º pub æ›´å€¾å‘äºåœ¨å¯ç”¨çš„æ—¶å€™å‘å¸ƒç¨³å®šç‰ˆï¼Œæ‰€ä»¥ä¸€ä¸ªé¢„å‘å¸ƒåŒ…çš„ç”¨æˆ·å¯èƒ½éœ€è¦æ”¹å˜ä»–ä»¬çš„ä¾èµ–çº¦æŸã€‚ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·æƒ³è¦æµ‹è¯• 2.1 ç‰ˆæœ¬çš„é¢„å‘å¸ƒåŒ…ï¼Œé‚£ä¹ˆä»–ä»¬å¯ä»¥æŒ‡å®š ^2.1.0-dev.1ï¼Œè€Œä¸æ˜¯ ^2.0.0 æˆ– ^2.1.0ã€‚\næ³¨æ„: å¦‚æœä¾èµ–å…³ç³»å›¾ä¸­çš„ç¨³å®šåŒ…ä¾èµ–äºä¸€ä¸ª prereleaseï¼Œé‚£ä¹ˆ pub ä¼šé€‰æ‹©é‚£ä¸ª prerelease è€Œä¸æ˜¯ç¨³å®šç‰ˆæœ¬ã€‚\nå½“ä¸€ä¸ª prerelease è¢«å‘å¸ƒåˆ° pub.dev æ—¶ï¼Œè½¯ä»¶åŒ…é¡µé¢ä¼šåŒæ—¶æ˜¾ç¤ºåˆ° prerelease å’Œç¨³å®šç‰ˆçš„é“¾æ¥ã€‚prerelease ä¸ä¼šå½±å“åˆ†æå¾—åˆ†ï¼Œä¸ä¼šå‡ºç°åœ¨æœç´¢ç»“æœä¸­ï¼Œä¹Ÿä¸ä¼šæ›¿æ¢åŒ…çš„ README.md å’Œæ–‡æ¡£ã€‚\nå°†è½¯ä»¶åŒ…æ ‡è®°ä¸ºå·²åœäº§çš„è½¯ä»¶åŒ… å°½ç®¡è½¯ä»¶åŒ…æ€»æ˜¯ä¿æŒå‘å¸ƒï¼Œä½†å‘å¼€å‘è€…å‘å‡ºä¿¡å·ï¼Œè¡¨æ˜ä¸€ä¸ªè½¯ä»¶åŒ…ä¸å†è¢«ç§¯æç»´æŠ¤ï¼Œæ˜¯å¾ˆæœ‰ç”¨çš„ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥å°†ä¸€ä¸ªè½¯ä»¶åŒ…æ ‡è®°ä¸º discontinuedã€‚ä¸€ä¸ªå·²åœç”¨çš„è½¯ä»¶åŒ…ä»ç„¶å¯ä»¥åœ¨ pub.dev ä¸Šå‘å¸ƒå’ŒæŸ¥çœ‹ï¼Œä½†å®ƒæœ‰ä¸€ä¸ªæ¸…æ™°çš„ DISCONTINUED å¾½ç« ï¼Œå¹¶ä¸”ä¸ä¼šå‡ºç°åœ¨ pub.dev çš„æœç´¢ç»“æœä¸­ã€‚\nè¦å°†è½¯ä»¶åŒ…æ ‡è®°ä¸ºå·²åœç”¨ï¼Œè¯·ä½¿ç”¨è¯¥è½¯ä»¶åŒ…çš„ä¸Šä¼ è€…æˆ–å·²éªŒè¯çš„å‘å¸ƒè€…ç®¡ç†å‘˜çš„ Google å¸æˆ·ç™»å½• pub.devã€‚ç„¶åä½¿ç”¨å•ä¸ªè½¯ä»¶åŒ…çš„ç®¡ç†é€‰é¡¹å¡å°†è¯¥è½¯ä»¶åŒ…æ ‡è®°ä¸ºå·²åœç”¨ã€‚\nèµ„æº æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ä»¥ä¸‹ pub å‘½ä»¤çš„å‚è€ƒé¡µé¢ã€‚\n pub publish pub uploader  ","permalink":"https://ohmyweekly.github.io/notes/publishing-packages/","tags":["flutter","packages"],"title":"å‘å¸ƒåŒ…"},{"categories":["programming"],"contents":"æœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿ\n HTTP åè®®å…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿›è¡Œé€šä¿¡ã€‚ dart:io åŒ…æœ‰ç¼–å†™ HTTP ç¨‹åºçš„ç±»ã€‚ æœåŠ¡å™¨ç›‘å¬ä¸»æœºå’Œç«¯å£ä¸Šçš„è¯·æ±‚ã€‚ å®¢æˆ·ç«¯ä½¿ç”¨ HTTP æ–¹æ³•è¯·æ±‚å‘é€è¯·æ±‚ã€‚ http_server åŒ…æä¾›äº†æ›´é«˜çº§åˆ«çš„æ„ä»¶ã€‚  å‰ææ¡ä»¶: HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¸¥é‡ä¾èµ– future å’Œæµï¼Œæœ¬æ•™ç¨‹ä¸­æ²¡æœ‰è§£é‡Šè¿™äº›å†…å®¹ã€‚ä½ å¯ä»¥ä»å¼‚æ­¥ç¼–ç¨‹ codelabå’Œæµæ•™ç¨‹ä¸­äº†è§£å®ƒä»¬ã€‚\nHTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰æ˜¯ä¸€ç§é€šä¿¡åè®®ï¼Œç”¨äºé€šè¿‡äº’è”ç½‘å°†æ•°æ®ä»ä¸€ä¸ªç¨‹åºå‘é€åˆ°å¦ä¸€ä¸ªç¨‹åºã€‚æ•°æ®ä¼ è¾“çš„ä¸€ç«¯æ˜¯æœåŠ¡å™¨ï¼Œå¦ä¸€ç«¯æ˜¯å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯é€šå¸¸æ˜¯åŸºäºæµè§ˆå™¨çš„ï¼ˆç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­è¾“å…¥æˆ–åœ¨æµè§ˆå™¨ä¸­è¿è¡Œçš„è„šæœ¬ï¼‰ï¼Œä½†ä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºã€‚\næœåŠ¡å™¨ä¸ä¸»æœºå’Œç«¯å£ç»‘å®šï¼ˆå®ƒä¸ä¸€ä¸ªIPåœ°å€å’Œä¸€ä¸ªç«¯å£å·å»ºç«‹ä¸“å±è¿æ¥ï¼‰ã€‚ç„¶åæœåŠ¡å™¨ç›‘å¬è¯·æ±‚ã€‚ç”±äº Dart çš„å¼‚æ­¥æ€§ï¼ŒæœåŠ¡å™¨å¯ä»¥åŒæ—¶å¤„ç†å¾ˆå¤šè¯·æ±‚ï¼Œå…·ä½“å¦‚ä¸‹ã€‚\n æœåŠ¡å™¨ç›‘å¬ å®¢æˆ·ç«¯è¿æ¥ æœåŠ¡å™¨æ¥å—å¹¶æ¥æ”¶è¯·æ±‚(å¹¶ç»§ç»­ç›‘å¬) æœåŠ¡å™¨å¯ä»¥ç»§ç»­æ¥å—å…¶ä»–è¯·æ±‚ æœåŠ¡å™¨å†™å…¥è¯·æ±‚çš„å“åº”æˆ–å‡ ä¸ªè¯·æ±‚ï¼Œå¯èƒ½æ˜¯äº¤é”™çš„è¯·æ±‚ æœåŠ¡å™¨æœ€ç»ˆç»“æŸ(å…³é—­)å“åº”  åœ¨ Dart ä¸­ï¼Œdart:io åº“åŒ…å«äº†ç¼–å†™ HTTP å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨æ‰€éœ€çš„ç±»å’Œå‡½æ•°ã€‚æ­¤å¤–ï¼Œhttp_server åŒ…åŒ…å«äº†ä¸€äº›æ›´é«˜å±‚æ¬¡çš„ç±»ï¼Œä½¿å…¶æ›´å®¹æ˜“ç¼–å†™å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ã€‚\né‡è¦ï¼šåŸºäºæµè§ˆå™¨çš„ç¨‹åºä¸èƒ½ä½¿ç”¨ dart:io åº“ã€‚\ndart:io åº“ä¸­çš„ API åªé€‚ç”¨äºç‹¬ç«‹çš„å‘½ä»¤è¡Œç¨‹åºã€‚å®ƒä»¬ä¸èƒ½åœ¨æµè§ˆå™¨ä¸­å·¥ä½œã€‚è¦ä»åŸºäºæµè§ˆå™¨çš„å®¢æˆ·ç«¯å‘å‡º HTTP è¯·æ±‚ï¼Œè¯·å‚è€ƒ dart:html HttpRequest ç±»ã€‚\næœ¬æ•™ç¨‹æä¾›äº†å‡ ä¸ªä¾‹å­ï¼Œè¯´æ˜ç¼–å†™ Dart HTTP æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ˜¯å¤šä¹ˆå®¹æ˜“ã€‚ä»æœåŠ¡å™¨çš„ hello world å¼€å§‹ï¼Œä½ å°†å­¦ä¹ å¦‚ä½•ç¼–å†™æœåŠ¡å™¨çš„ä»£ç ï¼Œä»ç»‘å®šå’Œç›‘å¬åˆ°å“åº”è¯·æ±‚ã€‚ä½ è¿˜å¯ä»¥å­¦ä¹ åˆ°å®¢æˆ·ç«¯ï¼šæå‡ºä¸åŒç±»å‹çš„è¯·æ±‚(GET å’Œ POST)ï¼Œç¼–å†™åŸºäºæµè§ˆå™¨å’Œå‘½ä»¤è¡Œçš„å®¢æˆ·ç«¯ã€‚\nè·å–æºç   è·å– Dart æ•™ç¨‹çš„ç¤ºä¾‹ä»£ç ã€‚ æŸ¥çœ‹ httpserver ç›®å½•ï¼Œå…¶ä¸­åŒ…å«æœ¬æ•™ç¨‹æ‰€éœ€çš„æºç ã€‚  è¿è¡Œ hello world æœåŠ¡å™¨ æœ¬èŠ‚çš„ç¤ºä¾‹æ–‡ä»¶ï¼šhello_world_server.dartã€‚\nè®©æˆ‘ä»¬ä»ä¸€ä¸ªå°å‹çš„æœåŠ¡å™¨å¼€å§‹ï¼Œç”¨å­—ç¬¦ä¸² Hello, world æ¥å“åº”æ‰€æœ‰çš„è¯·æ±‚ã€‚\nåœ¨å‘½ä»¤è¡Œä¸­ï¼Œè¿è¡Œ hello_world_server.dart è„šæœ¬:\n$ cd httpserver $ dart bin/hello_world_server.dart listening on localhost, port 4040 åœ¨ä»»ä½•æµè§ˆå™¨ä¸­ï¼Œè®¿é—® localhost:4040ã€‚æµè§ˆå™¨ä¼šæ˜¾ç¤º Hello, world!ã€‚\nåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨æ˜¯ä¸€ä¸ª Dart ç¨‹åºï¼Œå®¢æˆ·ç«¯æ˜¯ä½ ä½¿ç”¨çš„æµè§ˆå™¨ã€‚ç„¶è€Œï¼Œä½ å¯ä»¥ç”¨ Dart ç¼–å†™å®¢æˆ·ç«¯ç¨‹åº-æ— è®ºæ˜¯åŸºäºæµè§ˆå™¨çš„å®¢æˆ·ç«¯è„šæœ¬ï¼Œè¿˜æ˜¯ç‹¬ç«‹çš„ç¨‹åºã€‚\nå¿«é€Ÿæµè§ˆä¸€ä¸‹ä»£ç  åœ¨ hello world æœåŠ¡å™¨çš„ä»£ç ä¸­ï¼Œä¸€ä¸ª HTTP æœåŠ¡å™¨ä¸ä¸»æœºå’Œç«¯å£ç»‘å®šï¼Œç›‘å¬ HTTP è¯·æ±‚ï¼Œå¹¶å†™å…¥å“åº”ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¯¥ç¨‹åºå¯¼å…¥äº† dart:io åº“ï¼Œå…¶ä¸­åŒ…å«äº†æœåŠ¡å™¨ç«¯ç¨‹åºå’Œå®¢æˆ·ç«¯ç¨‹åºçš„ HTTP ç›¸å…³ç±»(ä½†ä¸åŒ…å« Web åº”ç”¨)ã€‚\nimport \u0026#39;dart:io\u0026#39;; Future main() async { var server = await HttpServer.bind( InternetAddress.loopbackIPv4, 4040, ); print(\u0026#39;Listening on localhost:${server.port}\u0026#39;); await for (HttpRequest request in server) { request.response.write(\u0026#39;Hello, world!\u0026#39;); await request.response.close(); } } æ¥ä¸‹æ¥çš„å‡ èŠ‚å†…å®¹åŒ…æ‹¬æœåŠ¡å™¨ç«¯ç»‘å®šã€å‘å‡ºå®¢æˆ·ç«¯ GET è¯·æ±‚ã€ç›‘å¬å’Œå“åº”ã€‚\nå°†æœåŠ¡å™¨ç»‘å®šåˆ°ä¸»æœºå’Œç«¯å£ æœ¬èŠ‚ç¤ºä¾‹ï¼šhello_world_server.dartã€‚\nmain() ä¸­çš„ç¬¬ä¸€æ¡è¯­å¥ä½¿ç”¨ HttpServer.bind() åˆ›å»ºä¸€ä¸ª HttpServer å¯¹è±¡ï¼Œå¹¶å°†å…¶ç»‘å®šåˆ°ä¸»æœºå’Œç«¯å£ã€‚\nvar server = await HttpServer.bind( InternetAddress.loopbackIPv4, 4040, ); è¯¥ä»£ç ä½¿ç”¨ await å¼‚æ­¥è°ƒç”¨ bind æ–¹æ³•ã€‚\nä¸»æœºå bind() çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æŒ‡å®šä¸»æœºåã€‚ä½ å¯ä»¥ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²æ¥æŒ‡å®šä¸€ä¸ªç‰¹å®šçš„ä¸»æœºåæˆ–IPåœ°å€ï¼Œä¹Ÿå¯ä»¥ç”¨ InternetAddress ç±»æä¾›çš„è¿™äº›é¢„å®šä¹‰çš„å€¼æ¥æŒ‡å®šä¸»æœºã€‚\n   å€¼ ç”¨ä¾‹     å›ç¯ IPv4 æˆ– loopbackIPv6 æœåŠ¡å™¨åœ¨ loopback åœ°å€ä¸Šç›‘å¬å®¢æˆ·ç«¯æ´»åŠ¨ï¼Œè¯¥åœ°å€å®é™…ä¸Šæ˜¯ localhostã€‚ä½¿ç”¨IPåè®®çš„4æˆ–6ç‰ˆæœ¬ã€‚è¿™äº›ä¸»è¦ç”¨äºæµ‹è¯•ã€‚æˆ‘ä»¬å»ºè®®æ‚¨ä½¿ç”¨è¿™äº›å€¼è€Œä¸æ˜¯ localhost æˆ– 127.0.0.1ã€‚   ä»»ä½• IPv4 æˆ– anyIPv6 æœåŠ¡å™¨ç›‘å¬ä»»ä½• IP åœ°å€ä¸ŠæŒ‡å®šç«¯å£ä¸Šçš„å®¢æˆ·ç«¯æ´»åŠ¨ã€‚ä½¿ç”¨IPåè®®çš„4æˆ–6ç‰ˆæœ¬ã€‚    é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ä½¿ç”¨V6äº’è”ç½‘åœ°å€æ—¶ï¼Œä¹Ÿä¼šä½¿ç”¨V4ç›‘å¬å™¨ã€‚\nç«¯å£ bind() çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯æŒ‡å®šç«¯å£çš„æ•´æ•°ã€‚ç«¯å£å”¯ä¸€åœ°æ ‡è¯†ä¸»æœºä¸Šçš„æœåŠ¡ã€‚1024 ä»¥ä¸‹çš„ç«¯å£å·ä¸ºæ ‡å‡†æœåŠ¡ä¿ç•™(0é™¤å¤–)ã€‚ä¾‹å¦‚ï¼ŒFTP æ•°æ®ä¼ è¾“é€šå¸¸åœ¨ç«¯å£20ä¸Šè¿è¡Œï¼Œæ¯æ—¥æŠ¥ä»·åœ¨ç«¯å£17ä¸Šè¿è¡Œï¼ŒHTTP åœ¨ç«¯å£80ä¸Šè¿è¡Œã€‚ä½ çš„ç¨‹åºåº”è¯¥ä½¿ç”¨1024ä»¥ä¸Šçš„ç«¯å£å·ã€‚å¦‚æœç«¯å£å·²ç»åœ¨ä½¿ç”¨ä¸­ï¼Œä½ çš„æœåŠ¡å™¨çš„è¿æ¥å°†è¢«æ‹’ç»ã€‚\nä¾¦å¬è¯·æ±‚ æœåŠ¡å™¨ä½¿ç”¨ await for å¼€å§‹ç›‘å¬ HTTP è¯·æ±‚ã€‚æ¯æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚ï¼Œä»£ç å°±ä¼šå‘é€ä¸€ä¸ª \u0026ldquo;Hello, world!\u0026rdquo; çš„å“åº”ã€‚\nawait for (HttpRequest request in server) { request.response.write(\u0026#39;Hello, world!\u0026#39;); await request.response.close(); } ä½ å°†åœ¨ç›‘å¬å’Œå¤„ç†è¯·æ±‚ä¸€èŠ‚ä¸­äº†è§£æ›´å¤šå…³äº HttpRequest å¯¹è±¡åŒ…å«çš„å†…å®¹ä»¥åŠå¦‚ä½•ç¼–å†™å“åº”ã€‚ä½†é¦–å…ˆï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å®¢æˆ·ç«¯äº§ç”Ÿè¯·æ±‚çš„ä¸€ç§æ–¹å¼ã€‚\nä½¿ç”¨ HTML è¡¨å•å‘å‡º GET è¯·æ±‚ æœ¬èŠ‚çš„ç¤ºä¾‹æ–‡ä»¶ï¼šnumber_thinker.dart å’Œ make_a_guess.htmlã€‚\næœ¬èŠ‚ä»‹ç»äº†ä¸€ä¸ªå‘½ä»¤è¡ŒæœåŠ¡å™¨ï¼Œå®ƒå¯ä»¥éšæœºé€‰æ‹©ä¸€ä¸ª0åˆ°9ä¹‹é—´çš„æ•°å­—ã€‚å®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªåŸºæœ¬çš„ HTML ç½‘é¡µï¼Œmake_a_guess.htmlï¼Œä½ å¯ä»¥ç”¨å®ƒæ¥çŒœæ•°å­—ã€‚\nè¯•è¯•å§\n è¿è¡Œæ•°å­—æ€è€ƒè€…æœåŠ¡å™¨  åœ¨å‘½ä»¤è¡Œï¼Œè¿è¡Œ number_thinker.dart serverã€‚ä½ åº”è¯¥çœ‹åˆ°ç±»ä¼¼ä¸‹é¢çš„ä¸œè¥¿:\n$ cd httpserver $ dart bin/number_thinker.dart I\u0026#39;m thinking of a number: 6 å¯åŠ¨ç½‘ç»œæœåŠ¡å™¨  ä»åº”ç”¨ç¨‹åºçš„é¡¶éƒ¨ç›®å½•è¿è¡Œ webdev serveã€‚\næ›´å¤šä¿¡æ¯ï¼šwebdev æ–‡æ¡£\næ‰“å¼€ HTML é¡µé¢  åœ¨æµè§ˆå™¨ä¸­ï¼Œè¿›å…¥ localhost:8080/make_a_guess.htmlã€‚\nåšä¸€ä¸ªçŒœæµ‹  é€‰æ‹©ä¸€ä¸ªæ•°å­—ï¼Œç„¶åæŒ‰çŒœæµ‹æŒ‰é’®ã€‚\nåœ¨å®¢æˆ·ç«¯ä¸­æ²¡æœ‰æ¶‰åŠåˆ° Dart ä»£ç ã€‚å®¢æˆ·ç«¯è¯·æ±‚æ˜¯é€šè¿‡æµè§ˆå™¨å‘ Dart æœåŠ¡å™¨å‘å‡ºçš„ï¼Œåœ¨ make_a_guess.html ä¸­çš„ HTML è¡¨å•ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªè‡ªåŠ¨åˆ¶å®šå’Œå‘é€å®¢æˆ·ç«¯ HTTP è¯·æ±‚çš„æ–¹æ³•ã€‚è¯¥è¡¨å•åŒ…å«ä¸‹æ‹‰åˆ—è¡¨å’ŒæŒ‰é’®ã€‚è¯¥è¡¨å•è¿˜æŒ‡å®šäº† URLï¼Œå…¶ä¸­åŒ…æ‹¬ç«¯å£å·ï¼Œä»¥åŠè¯·æ±‚çš„ç§ç±»ï¼ˆè¯·æ±‚æ–¹æ³•ï¼‰ã€‚å®ƒè¿˜å¯èƒ½åŒ…å«å»ºç«‹æŸ¥è¯¢å­—ç¬¦ä¸²çš„å…ƒç´ ã€‚\nä¸‹é¢æ˜¯ make_a_guess.html ä¸­çš„è¡¨å• HTMLã€‚\n\u0026lt;form action=\u0026#34;http://localhost:4041\u0026#34; method=\u0026#34;GET\u0026#34;\u0026gt; \u0026lt;select name=\u0026#34;q\u0026#34;\u0026gt; \u0026lt;option value=\u0026#34;0\u0026#34;\u0026gt;0\u0026lt;/option\u0026gt; \u0026lt;option value=\u0026#34;1\u0026#34;\u0026gt;1\u0026lt;/option\u0026gt; \u0026lt;option value=\u0026#34;2\u0026#34;\u0026gt;2\u0026lt;/option\u0026gt; \u0026lt;!-- Â·Â·Â· --\u0026gt; \u0026lt;option value=\u0026#34;9\u0026#34;\u0026gt;9\u0026lt;/option\u0026gt; \u0026lt;/select\u0026gt; \u0026lt;input type=\u0026#34;submit\u0026#34; value=\u0026#34;Guess\u0026#34;\u0026gt; \u0026lt;/form\u0026gt; ä¸‹é¢æ˜¯è¡¨å•çš„å·¥ä½œåŸç†:\n è¡¨å•çš„ action å±æ€§è¢«åˆ†é…ç»™å‘é€è¯·æ±‚çš„ URL è¡¨å•çš„ method å±æ€§å®šä¹‰äº†è¯·æ±‚çš„ç±»å‹ï¼Œè¿™é‡Œæ˜¯ GETã€‚å…¶ä»–å¸¸è§çš„è¯·æ±‚ç±»å‹åŒ…æ‹¬ POSTã€PUT å’Œ DELETEã€‚ è¡¨å•ä¸­ä»»ä½•æœ‰åç§°(name)çš„å…ƒç´ ï¼Œæ¯”å¦‚ \u0026lt;select\u0026gt; å…ƒç´ ï¼Œéƒ½ä¼šæˆä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²ä¸­çš„ä¸€ä¸ªå‚æ•°ã€‚ å½“æŒ‰ä¸‹æäº¤æŒ‰é’®(\u0026lt;input type=\u0026quot;submit\u0026quot;...\u0026gt;)æ—¶ï¼Œæäº¤æŒ‰é’®ä¼šæ ¹æ®è¡¨å•çš„å†…å®¹åˆ¶å®šè¯·æ±‚å¹¶å‘é€ã€‚  ä¸€ä¸ª RESTful GET è¯·æ±‚ REST(REpresentational State Transfer)æ˜¯ä¸€å¥—è®¾è®¡ Web æœåŠ¡çš„åŸåˆ™ã€‚ä¹–å·§çš„ HTTP å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éµå®ˆä¸º GET è¯·æ±‚å®šä¹‰çš„ REST åŸåˆ™ã€‚\nä¸€ä¸ª GET è¯·æ±‚:\n åªæ£€ç´¢æ•°æ® ä¸ä¼šæ”¹å˜æœåŠ¡å™¨çš„çŠ¶æ€ æœ‰é•¿åº¦é™åˆ¶ å¯ä»¥åœ¨è¯·æ±‚çš„ URL ä¸­å‘é€æŸ¥è¯¢å­—ç¬¦ä¸²  åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®¢æˆ·ç«¯å‘å‡ºäº†ä¸€ä¸ªç¬¦åˆ REST çš„ GET è¯·æ±‚ã€‚\nç›‘å¬å’Œå¤„ç†è¯·æ±‚ æœ¬èŠ‚çš„ç¤ºä¾‹æ–‡ä»¶: number_thinker.dart å’Œ make_a_guess.htmlã€‚\nç°åœ¨ä½ å·²ç»çœ‹åˆ°è¿™ä¸ªåŸºäºæµè§ˆå™¨çš„å®¢æˆ·ç«¯çš„ä¾‹å­ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æ•°å­—æ€ç»´æœåŠ¡å™¨çš„ Dart ä»£ç ï¼Œä» main() å¼€å§‹ã€‚\nå†ä¸€æ¬¡ï¼ŒæœåŠ¡å™¨ç»‘å®šäº†ä¸€ä¸ªä¸»æœºå’Œç«¯å£ã€‚åœ¨è¿™é‡Œï¼Œæ¯æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚éƒ½ä¼šè°ƒç”¨é¡¶å±‚çš„ handleRequest() æ–¹æ³•ã€‚å› ä¸º HttpServer å®ç°äº† Streamï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ await for æ¥å¤„ç†è¯·æ±‚ã€‚\nimport \u0026#39;dart:io\u0026#39;; import \u0026#39;dart:math\u0026#39; show Random; Random intGenerator = Random(); int myNumber = intGenerator.nextInt(10); Future main() async { print(\u0026#34;I\u0026#39;m thinking of a number: $myNumber\u0026#34;); HttpServer server = await HttpServer.bind( InternetAddress.loopbackIPv4, 4041, ); await for (var request in server) { handleRequest(request); } } å½“ä¸€ä¸ª GET è¯·æ±‚åˆ°è¾¾æ—¶ï¼ŒhandleRequest() æ–¹æ³•ä¼šè°ƒç”¨ handleGet() æ¥å¤„ç†è¯¥è¯·æ±‚ã€‚\nvoid handleRequest(HttpRequest request) { try { if (request.method == \u0026#39;GET\u0026#39;) { handleGet(request); } else { // Â·Â·Â·  } } catch (e) { print(\u0026#39;Exception in handleRequest: $e\u0026#39;); } print(\u0026#39;Request handled.\u0026#39;); } ä¸€ä¸ª HttpRequest å¯¹è±¡æœ‰å¾ˆå¤šå±æ€§ï¼Œæä¾›äº†å…³äºè¯·æ±‚çš„ä¿¡æ¯ã€‚ä¸‹è¡¨åˆ—å‡ºäº†ä¸€äº›æœ‰ç”¨çš„å±æ€§ã€‚\n   å±æ€§ ä¿¡æ¯     method \u0026lsquo;GET\u0026rsquo;, \u0026lsquo;POST\u0026rsquo;, \u0026lsquo;PUT\u0026rsquo; ç­‰æ–¹æ³•ä¸­çš„ä¸€ä¸ªã€‚   uri ä¸€ä¸ª Uri å¯¹è±¡ï¼šschemeã€hostã€portã€query string å’Œå…¶ä»–å…³äºè¯·æ±‚èµ„æºçš„ä¿¡æ¯ã€‚   response ä¸€ä¸ª HttpResponse å¯¹è±¡ï¼šæœåŠ¡å™¨å°†å…¶å“åº”å†™å…¥å…¶ä¸­ã€‚   headers ä¸€ä¸ª HttpHeaders å¯¹è±¡ï¼šè¯·æ±‚çš„å¤´ä¿¡æ¯ï¼ŒåŒ…æ‹¬ ContentTypeã€å†…å®¹é•¿åº¦ã€æ—¥æœŸç­‰ã€‚    ä½¿ç”¨æ–¹æ³•å±æ€§ ä¸‹é¢çš„æ•°æƒ³å™¨ä¾‹å­ä¸­çš„ä»£ç ä½¿ç”¨ HttpRequest çš„ method å±æ€§æ¥ç¡®å®šæ”¶åˆ°äº†ä»€ä¹ˆæ ·çš„è¯·æ±‚ã€‚è¿™ä¸ªæœåŠ¡å™¨åªå¤„ç† GET è¯·æ±‚ã€‚\nif (request.method == \u0026#39;GET\u0026#39;) { handleGet(request); } else { request.response ..statusCode = HttpStatus.methodNotAllowed ..write(\u0026#39;Unsupported request: ${request.method}.\u0026#39;) ..close(); } ä½¿ç”¨ uri å±æ€§ åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä¸€ä¸ª URL ä¼šäº§ç”Ÿä¸€ä¸ª GET è¯·æ±‚ï¼Œå®ƒåªæ˜¯ç®€å•åœ°ä»æŒ‡å®šçš„èµ„æºä¸­è¯·æ±‚æ•°æ®ã€‚å®ƒå¯ä»¥é€šè¿‡é™„åŠ åœ¨ URI ä¸Šçš„æŸ¥è¯¢å­—ç¬¦ä¸²éšè¯·æ±‚å‘é€å°‘é‡æ•°æ®ã€‚\nvoid handleGet(HttpRequest request) { final guess = request.uri.queryParameters[\u0026#39;q\u0026#39;]; // Â·Â·Â· } ä½¿ç”¨ HttpRequest å¯¹è±¡çš„ uri å±æ€§æ¥è·å–ä¸€ä¸ª Uri å¯¹è±¡ï¼Œè¿™ä¸ª Uri å¯¹è±¡åŒ…å«äº†ç”¨æˆ·è¾“å…¥çš„ URL çš„ä¿¡æ¯ã€‚Uri å¯¹è±¡çš„ queryParameters å±æ€§æ˜¯ä¸€ä¸ª Mapï¼ŒåŒ…å«æŸ¥è¯¢å­—ç¬¦ä¸²çš„ç»„ä»¶ã€‚é€šè¿‡åç§°æ¥å¼•ç”¨æ‰€éœ€çš„å‚æ•°ã€‚æœ¬ä¾‹ä½¿ç”¨ q æ¥æ ‡è¯†çŒœæµ‹çš„æ•°å­—ã€‚\nè®¾ç½®å“åº”çš„çŠ¶æ€ç  æœåŠ¡å™¨åº”è¯¥è®¾ç½®çŠ¶æ€ç æ¥è¡¨ç¤ºè¯·æ±‚çš„æˆåŠŸæˆ–å¤±è´¥ã€‚å‰é¢çœ‹åˆ°æ•°æƒ³å®¶å°†çŠ¶æ€ç è®¾ç½®ä¸º methodNotAllowed æ¥æ‹’ç»é GET è¯·æ±‚ã€‚åœ¨åé¢çš„ä»£ç ä¸­ï¼Œä¸ºäº†è¡¨ç¤ºè¯·æ±‚æˆåŠŸï¼Œå“åº”å®Œæˆï¼Œæ•°æƒ³å®¶æœåŠ¡å™¨å°† HttpResponse çŠ¶æ€ç è®¾ç½®ä¸º HttpStatus.okã€‚\nvoid handleGet(HttpRequest request) { final guess = request.uri.queryParameters[\u0026#39;q\u0026#39;]; final response = request.response; response.statusCode = HttpStatus.ok; // Â·Â·Â· } HttpStatus.ok å’Œ HttpStatus.methodNotAllowed æ˜¯ HttpStatus ç±»ä¸­è®¸å¤šé¢„å®šä¹‰çŠ¶æ€ç ä¸­çš„ä¸¤ä¸ªã€‚å¦ä¸€ä¸ªæœ‰ç”¨çš„é¢„å®šä¹‰çŠ¶æ€ç æ˜¯ HttpStatus.notFound(ç»å…¸çš„ 404ï¼‰ã€‚\né™¤äº†çŠ¶æ€ç (statusCode)ï¼ŒHttpResponse å¯¹è±¡è¿˜æœ‰å…¶ä»–æœ‰ç”¨çš„å±æ€§:\n   å±æ€§ ä¿¡æ¯     contentLength å“åº”çš„é•¿åº¦ï¼Œ-1 è¡¨ç¤ºäº‹å…ˆä¸çŸ¥é“é•¿åº¦ã€‚   cookies è¦åœ¨å®¢æˆ·ç«¯è®¾ç½®çš„ Cookies åˆ—è¡¨ã€‚   encoding ç¼–å†™å­—ç¬¦ä¸²æ—¶ä½¿ç”¨çš„ç¼–ç ï¼Œå¦‚ JSON å’Œ UTF-8ã€‚   headers å“åº”å¤´ï¼Œæ˜¯ä¸€ä¸ª HttpHeaders å¯¹è±¡ã€‚    å°†å“åº”å†™åˆ° HttpResponse å¯¹è±¡ æ¯ä¸ª HttpRequest å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ HttpResponse å¯¹è±¡ã€‚æœåŠ¡å™¨é€šè¿‡å“åº”å¯¹è±¡å°†æ•°æ®å‘å›ç»™å®¢æˆ·ç«¯ã€‚\nä½¿ç”¨ HttpResponse å†™æ–¹æ³•ä¹‹ä¸€(write()ã€writeln()ã€writeAll() æˆ– writeCharCodes())å°†å“åº”æ•°æ®å†™å…¥ HttpResponse å¯¹è±¡ã€‚æˆ–è€…é€šè¿‡ addStream å°† HttpResponse å¯¹è±¡è¿æ¥åˆ°ä¸€ä¸ªæµï¼Œå¹¶å†™å…¥æµã€‚å“åº”å®Œæˆåå…³é—­å¯¹è±¡ã€‚å…³é—­ HttpResponse å¯¹è±¡ä¼šå°†æ•°æ®å‘å›ç»™å®¢æˆ·ç«¯ã€‚\nvoid handleGet(HttpRequest request) { // Â·Â·Â·  if (guess == myNumber.toString()) { response ..writeln(\u0026#39;true\u0026#39;) ..writeln(\u0026#34;I\u0026#39;m thinking of another number.\u0026#34;) ..close(); // Â·Â·Â·  } } ä»ç‹¬ç«‹çš„å®¢æˆ·ç«¯è¿›è¡Œ POST è¯·æ±‚ æœ¬èŠ‚çš„ç¤ºä¾‹æ–‡ä»¶ï¼šbasic_writer_server.dart å’Œ basic_writer_client.dartã€‚\nåœ¨ hello world å’Œ number thinker çš„ä¾‹å­ä¸­ï¼Œæµè§ˆå™¨ç”Ÿæˆäº†ç®€å•çš„ GET è¯·æ±‚ï¼Œå¯¹äºæ›´å¤æ‚çš„ GET è¯·æ±‚å’Œå…¶ä»–ç±»å‹çš„è¯·æ±‚ï¼Œå¦‚ POSTã€PUT æˆ– DELETEï¼Œä½ éœ€è¦å†™ä¸€ä¸ªå®¢æˆ·ç«¯ç¨‹åºï¼Œå…¶ä¸­æœ‰ä¸¤ç§ã€‚\n ä¸€ä¸ªç‹¬ç«‹çš„å®¢æˆ·ç«¯ç¨‹åºï¼Œå®ƒä½¿ç”¨ dart:io çš„ HttpClient ç±»ã€‚ åŸºäºæµè§ˆå™¨çš„å®¢æˆ·ç«¯ï¼Œä½¿ç”¨ dart:html ä¸­çš„ APIã€‚æœ¬æ•™ç¨‹ä¸æ¶‰åŠåŸºäºæµè§ˆå™¨çš„å®¢æˆ·ç«¯ã€‚è¦æŸ¥çœ‹åŸºäºæµè§ˆå™¨çš„å®¢æˆ·ç«¯å’Œç›¸å…³æœåŠ¡å™¨çš„ä»£ç ï¼Œè¯·å‚è§ note_client.dartã€note_server.dart å’Œ note_taker.htmlã€‚  è®©æˆ‘ä»¬çœ‹çœ‹ä¸€ä¸ªç‹¬ç«‹çš„å®¢æˆ·ç«¯ï¼Œbasic_writer_client.dart å’Œå®ƒçš„æœåŠ¡å™¨ basic_writer_server.dartã€‚å®¢æˆ·ç«¯å‘å‡ºä¸€ä¸ª POST è¯·æ±‚ï¼Œå°† JSON æ•°æ®ä¿å­˜åˆ°æœåŠ¡å™¨ç«¯çš„æ–‡ä»¶ä¸­ã€‚æœåŠ¡å™¨æ¥å—è¯·æ±‚å¹¶ä¿å­˜æ–‡ä»¶ã€‚\nè¯•è¯•å§ åœ¨å‘½ä»¤è¡Œä¸Šè¿è¡ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚\n é¦–å…ˆï¼Œè¿è¡ŒæœåŠ¡å™¨:  cd httpserver $ dart bin/basic_writer_server.dart åœ¨ä¸€ä¸ªæ–°çš„ç»ˆç«¯ä¸­ï¼Œè¿è¡Œå®¢æˆ·ç«¯:  $ cd httpserver $ dart bin/basic_writer_client.dart Wrote data for Han Solo. çœ‹çœ‹æœåŠ¡å™¨å†™å…¥ file.txt çš„ JSON æ•°æ®:\n{\u0026#34;name\u0026#34;:\u0026#34;Han Solo\u0026#34;,\u0026#34;job\u0026#34;:\u0026#34;reluctant hero\u0026#34;,\u0026#34;BFF\u0026#34;:\u0026#34;Chewbacca\u0026#34;,\u0026#34;ship\u0026#34;:\u0026#34;Millennium Falcon\u0026#34;,\u0026#34;weakness\u0026#34;:\u0026#34;smuggling debts\u0026#34;} å®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ª HttpClient å¯¹è±¡ï¼Œå¹¶ä½¿ç”¨ post() æ–¹æ³•è¿›è¡Œè¯·æ±‚ã€‚å‘èµ·ä¸€ä¸ªè¯·æ±‚æ¶‰åŠä¸¤ä¸ª Futureã€‚\n post() æ–¹æ³•å»ºç«‹ä¸æœåŠ¡å™¨çš„ç½‘ç»œè¿æ¥å¹¶å®Œæˆç¬¬ä¸€ä¸ª Futureï¼Œè¿”å›ä¸€ä¸ª HttpClientRequest å¯¹è±¡ã€‚ å®¢æˆ·ç«¯ç»„æˆè¯·æ±‚å¯¹è±¡å¹¶å…³é—­å®ƒã€‚close() æ–¹æ³•å°†è¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨å¹¶è¿”å›ç¬¬äºŒä¸ª Futureï¼Œå®ƒä»¥ä¸€ä¸ª HttpClientResponse å¯¹è±¡å®Œæˆã€‚  import \u0026#39;dart:io\u0026#39;; import \u0026#39;dart:convert\u0026#39;; String _host = InternetAddress.loopbackIPv4.host; String path = \u0026#39;file.txt\u0026#39;; Map jsonData = { \u0026#39;name\u0026#39;: \u0026#39;Han Solo\u0026#39;, \u0026#39;job\u0026#39;: \u0026#39;reluctant hero\u0026#39;, \u0026#39;BFF\u0026#39;: \u0026#39;Chewbacca\u0026#39;, \u0026#39;ship\u0026#39;: \u0026#39;Millennium Falcon\u0026#39;, \u0026#39;weakness\u0026#39;: \u0026#39;smuggling debts\u0026#39; }; Future main() async { HttpClientRequest request = await HttpClient().post(_host, 4049, path) /*1*/ ..headers.contentType = ContentType.json /*2*/ ..write(jsonEncode(jsonData)); /*3*/ HttpClientResponse response = await request.close(); /*4*/ await utf8.decoder.bind(response /*5*/).forEach(print); } /1/ post() æ–¹æ³•éœ€è¦ä¸»æœºã€ç«¯å£å’Œè¯·æ±‚èµ„æºçš„è·¯å¾„ã€‚é™¤äº† post() ä¹‹å¤–ï¼ŒHttpClient ç±»è¿˜æä¾›äº†å…¶ä»–ç±»å‹çš„è¯·æ±‚å‡½æ•°ï¼ŒåŒ…æ‹¬ postUrl()ã€get() å’Œ open()ã€‚\n/2/ ä¸€ä¸ª HttpClientRequest å¯¹è±¡æœ‰ä¸€ä¸ª HttpHeaders å¯¹è±¡ï¼Œå®ƒåŒ…å«äº†è¯·æ±‚å¤´çš„ä¿¡æ¯ã€‚å¯¹äºä¸€äº›è¯·æ±‚å¤´ï¼Œæ¯”å¦‚ contentTypeï¼ŒHttpHeaders æœ‰ä¸€ä¸ªé’ˆå¯¹è¯¥è¯·æ±‚å¤´çš„å±æ€§ã€‚å¯¹äºå…¶ä»–çš„è¯·æ±‚å¤´ï¼Œä½¿ç”¨ set() æ–¹æ³•å°†è¯¥è¯·æ±‚å¤´æ”¾å…¥ HttpHeaders å¯¹è±¡ä¸­ã€‚\n/3/ å®¢æˆ·ç«¯ä½¿ç”¨ write() å‘è¯·æ±‚å¯¹è±¡å†™å…¥æ•°æ®ã€‚ç¼–ç ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ JSONï¼Œä¸ ContentType å¤´ä¸­æŒ‡å®šçš„ç±»å‹ç›¸åŒ¹é…ã€‚\n/4/ close() æ–¹æ³•å°†è¯·æ±‚å‘é€åˆ°æœåŠ¡å™¨ï¼Œå®Œæˆåè¿”å›ä¸€ä¸ª HttpClientResponse å¯¹è±¡ã€‚\n/5/ æ¥è‡ªæœåŠ¡å™¨çš„ UTF-8 å“åº”å°†è¢«è§£ç ã€‚ä½¿ç”¨åœ¨ dart:convert åº“ä¸­å®šä¹‰çš„è½¬æ¢å™¨å°†æ•°æ®è½¬æ¢ä¸ºå¸¸è§„çš„ Dart å­—ç¬¦ä¸²æ ¼å¼ã€‚\nä¸€ä¸ª RESTful POST è¯·æ±‚ ä¸ GET è¯·æ±‚ç±»ä¼¼ï¼ŒREST ä¸º POST è¯·æ±‚æä¾›äº†æŒ‡å¯¼æ–¹é’ˆã€‚\nä¸€ä¸ª POST è¯·æ±‚:\n åˆ›å»ºä¸€ä¸ªèµ„æº(åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä¸€ä¸ªæ–‡ä»¶) ä½¿ç”¨ä¸€ä¸ª URIï¼Œå…¶ç»“æ„ä¸æ–‡ä»¶å’Œç›®å½•è·¯å¾„åç›¸ä¼¼ï¼›ä¾‹å¦‚ï¼ŒURI æ²¡æœ‰æŸ¥è¯¢å­—ç¬¦ä¸²ã€‚ ä»¥ JSON æˆ– XML æ ¼å¼ä¼ è¾“æ•°æ® æ²¡æœ‰çŠ¶æ€ï¼Œä¹Ÿä¸ä¼šæ”¹å˜æœåŠ¡å™¨çš„çŠ¶æ€ã€‚ æ— é•¿åº¦é™åˆ¶  è¿™ä¸ªä¾‹å­ä¸­çš„å®¢æˆ·ç«¯å‘å‡º REST å…¼å®¹çš„ POST è¯·æ±‚ã€‚\nè¦æƒ³çœ‹åˆ°ä½¿ REST å…¼å®¹çš„ GET è¯·æ±‚çš„å®¢æˆ·ç«¯ä»£ç ï¼Œè¯·çœ‹ number_guesser.dartã€‚å®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å®¢æˆ·ç«¯ï¼Œç”¨äºæ•°å­—æ€è€ƒè€…æœåŠ¡å™¨ï¼Œå®šæœŸè¿›è¡ŒçŒœæµ‹ï¼Œç›´åˆ°çŒœå¯¹ä¸ºæ­¢ã€‚\nåœ¨æœåŠ¡å™¨ä¸­å¤„ç†ä¸€ä¸ª POST è¯·æ±‚ æœ¬èŠ‚çš„ç¤ºä¾‹æ–‡ä»¶ï¼šbasic_writer_server.dart å’Œ basic_writer_client.dartã€‚\nä¸€ä¸ª HttpRequest å¯¹è±¡æ˜¯ä¸€ä¸ªå­—èŠ‚åˆ—è¡¨æµ(Stream\u0026lt;List\u0026lt;int\u0026gt;)ã€‚è¦è·å¾—å®¢æˆ·ç«¯å‘é€çš„æ•°æ®ï¼Œå°±è¦ç›‘å¬ HttpRequest å¯¹è±¡ä¸Šçš„æ•°æ®ã€‚\nå¦‚æœæ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚åŒ…å«äº†å¤§é‡çš„æ•°æ®ï¼Œæ•°æ®å¯èƒ½ä¼šä»¥å¤šä¸ªåˆ†å—çš„å½¢å¼åˆ°è¾¾ã€‚ä½ å¯ä»¥ä½¿ç”¨ Stream ä¸­çš„ join() æ–¹æ³•æ¥è¿æ¥è¿™äº›åˆ†å—çš„å­—ç¬¦ä¸²å€¼ã€‚\nbasic_writer_server.dart æ–‡ä»¶å®ç°äº†ä¸€ä¸ªéµå¾ªè¿™ç§æ¨¡å¼çš„æœåŠ¡å™¨ã€‚\nimport \u0026#39;dart:io\u0026#39;; import \u0026#39;dart:convert\u0026#39;; String _host = InternetAddress.loopbackIPv4.host; Future main() async { var server = await HttpServer.bind(_host, 4049); await for (var req in server) { ContentType contentType = req.headers.contentType; HttpResponse response = req.response; if (req.method == \u0026#39;POST\u0026#39; \u0026amp;\u0026amp; contentType?.mimeType == \u0026#39;application/json\u0026#39; /*1*/) { try { String content = await utf8.decoder.bind(req).join(); /*2*/ var data = jsonDecode(content) as Map; /*3*/ var fileName = req.uri.pathSegments.last; /*4*/ await File(fileName) .writeAsString(content, mode: FileMode.write); req.response ..statusCode = HttpStatus.ok ..write(\u0026#39;Wrote data for ${data[\u0026#39;name\u0026#39;]}.\u0026#39;); } catch (e) { response ..statusCode = HttpStatus.internalServerError ..write(\u0026#39;Exception during file I/O: $e.\u0026#39;); } } else { response ..statusCode = HttpStatus.methodNotAllowed ..write(\u0026#39;Unsupported request: ${req.method}.\u0026#39;); } await response.close(); } } /1/ è¯¥è¯·æ±‚æœ‰ä¸€ä¸ª HttpHeaders å¯¹è±¡ã€‚è®°å¾—å®¢æˆ·ç«¯å°† contentType å¤´è®¾ç½®ä¸º JSON(application/json)ã€‚è¯¥æœåŠ¡å™¨æ‹’ç»ä¸æ˜¯ JSON ç¼–ç çš„è¯·æ±‚ã€‚\n/2/ ä¸€ä¸ª POST è¯·æ±‚å¯¹å®ƒå¯ä»¥å‘é€çš„æ•°æ®é‡æ²¡æœ‰é™åˆ¶ï¼Œæ•°æ®å¯èƒ½ä¼šä»¥å¤šå—å½¢å¼å‘é€ã€‚æ­¤å¤–ï¼ŒJSON æ˜¯ UTF-8ï¼Œè€Œ UTF-8 å­—ç¬¦å¯ä»¥åœ¨å¤šä¸ªå­—èŠ‚ä¸Šè¿›è¡Œç¼–ç ã€‚join() æ–¹æ³•å°†è¿™äº›åˆ†å—æ”¾åœ¨ä¸€èµ·ã€‚\n/3/ å®¢æˆ·ç«¯å‘é€çš„æ•°æ®æ˜¯ JSON æ ¼å¼çš„ã€‚æœåŠ¡å™¨ä½¿ç”¨ dart:convert åº“ä¸­çš„ JSON ç¼–è§£ç å™¨å¯¹å…¶è¿›è¡Œè§£ç ã€‚\n/4/ è¯·æ±‚çš„ URL æ˜¯ localhost:4049/file.txtã€‚ä»£ç  req.uri.pathSegments.last ä» URI ä¸­æå–æ–‡ä»¶å: file.txtã€‚\nå…³äº CORS å¤´çš„è¯´æ˜ å¦‚æœä½ æƒ³ä¸ºè¿è¡Œåœ¨ä¸åŒæºå¤´ï¼ˆä¸åŒä¸»æœºæˆ–ç«¯å£ï¼‰çš„å®¢æˆ·ç«¯æä¾›æœåŠ¡ï¼Œä½ éœ€è¦æ·»åŠ  CORS å¤´ã€‚ä¸‹é¢çš„ä»£ç ï¼Œå–è‡ª note_server.dartï¼Œå…è®¸ä»ä»»ä½•æ¥æºçš„ POST å’Œ OPTIONS è¯·æ±‚ã€‚è°¨æ…ä½¿ç”¨ CORS å¤´æ–‡ä»¶ï¼Œå› ä¸ºå®ƒä»¬ä¼šç»™ä½ çš„ç½‘ç»œå¸¦æ¥å®‰å…¨é£é™©ã€‚\nvoid addCorsHeaders(HttpResponse response) { response.headers.add(\u0026#39;Access-Control-Allow-Origin\u0026#39;, \u0026#39;*\u0026#39;); response.headers .add(\u0026#39;Access-Control-Allow-Methods\u0026#39;, \u0026#39;POST, OPTIONS\u0026#39;); response.headers.add(\u0026#39;Access-Control-Allow-Headers\u0026#39;, \u0026#39;Origin, X-Requested-With, Content-Type, Accept\u0026#39;); } æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒç»´åŸºç™¾ç§‘çš„è·¨æºèµ„æºå…±äº«ä¸€æ–‡ã€‚\nä½¿ç”¨ http_server åŒ… æœ¬èŠ‚çš„ç¤ºä¾‹æ–‡ä»¶ï¼šmini_file_server.dart å’Œ static_file_server.dartã€‚\nå¯¹äºä¸€äº›æ›´é«˜å±‚æ¬¡çš„æ„ä»¶ï¼Œæˆ‘ä»¬æ¨èä½ å°è¯• http_server pub åŒ…ï¼Œå®ƒåŒ…å«äº†ä¸€ç»„ç±»ï¼Œä¸ dart:io åº“ä¸­çš„ HttpServer ç±»ä¸€èµ·ï¼Œä½¿å¾—å®ç° HTTP åŠ¡å™¨æ›´åŠ å®¹æ˜“ã€‚\nåœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬æ¯”è¾ƒäº†ä¸€ä¸ªåªä½¿ç”¨ dart:io çš„ API ç¼–å†™çš„æœåŠ¡å™¨å’Œä¸€ä¸ªä½¿ç”¨ dart:io å’Œ http_server ä¸€èµ·ç¼–å†™çš„å…·æœ‰ç›¸åŒåŠŸèƒ½çš„æœåŠ¡å™¨ã€‚\nä½ å¯ä»¥åœ¨ mini_file_server.dart ä¸­æ‰¾åˆ°ç¬¬ä¸€ä¸ªæœåŠ¡å™¨ã€‚å®ƒé€šè¿‡ä» web ç›®å½•è¿”å› index.html æ–‡ä»¶çš„å†…å®¹æ¥å“åº”æ‰€æœ‰è¯·æ±‚ã€‚\nè¯•è¯•å§ åœ¨å‘½ä»¤è¡Œä¸­è¿è¡ŒæœåŠ¡å™¨:\n$ cd httpserver $ dart bin/mini_file_server.dart åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ localhost:4044ã€‚æœåŠ¡å™¨ä¼šæ˜¾ç¤ºä¸€ä¸ª HTML æ–‡ä»¶ã€‚\nè¿™æ˜¯è¿·ä½ æ–‡ä»¶æœåŠ¡å™¨çš„ä»£ç :\nimport \u0026#39;dart:io\u0026#39;; File targetFile = File(\u0026#39;web/index.html\u0026#39;); Future main() async { Stream\u0026lt;HttpRequest\u0026gt; server; try { server = await HttpServer.bind(InternetAddress.loopbackIPv4, 4044); } catch (e) { print(\u0026#34;Couldn\u0026#39;t bind to port 4044: $e\u0026#34;); exit(-1); } await for (HttpRequest req in server) { if (await targetFile.exists()) { print(\u0026#34;Serving ${targetFile.path}.\u0026#34;); req.response.headers.contentType = ContentType.html; try { await req.response.addStream(targetFile.openRead()); } catch (e) { print(\u0026#34;Couldn\u0026#39;t read file: $e\u0026#34;); exit(-1); } } else { print(\u0026#34;Can\u0026#39;t open ${targetFile.path}.\u0026#34;); req.response.statusCode = HttpStatus.notFound; } await req.response.close(); } } è¿™æ®µä»£ç ç¡®å®šæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶å°†æ–‡ä»¶å†…å®¹ç®¡é“åŒ–åˆ°HttpResponseå¯¹è±¡ã€‚\nç¬¬äºŒä¸ªæœåŠ¡å™¨ï¼Œä½ å¯ä»¥åœ¨ basic_file_server.dart ä¸­æ‰¾åˆ°å®ƒçš„ä»£ç ï¼Œä½¿ç”¨ http_server åŒ…ã€‚\nè¯•è¯•å§ åœ¨å‘½ä»¤è¡Œä¸­è¿è¡ŒæœåŠ¡å™¨:\n$ cd httpserver $ dart bin/basic_file_server.dart åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ localhost:4046ã€‚æœåŠ¡å™¨æ˜¾ç¤ºä¸ä¹‹å‰ç›¸åŒçš„ index.html æ–‡ä»¶ã€‚\nåœ¨è¿™ä¸ªæœåŠ¡å™¨ä¸­ï¼Œå¤„ç†è¯·æ±‚çš„ä»£ç è¦çŸ­å¾—å¤šï¼Œå› ä¸º VirtualDirectory ç±»å¤„ç†æœåŠ¡æ–‡ä»¶çš„ç»†èŠ‚ã€‚\nimport \u0026#39;dart:io\u0026#39;; import \u0026#39;package:http_server/http_server.dart\u0026#39;; File targetFile = File(\u0026#39;web/index.html\u0026#39;); Future main() async { VirtualDirectory staticFiles = VirtualDirectory(\u0026#39;.\u0026#39;); var serverRequests = await HttpServer.bind(InternetAddress.loopbackIPv4, 4046); await for (var request in serverRequests) { staticFiles.serveFile(targetFile, request); } } è¿™é‡Œï¼Œè¯·æ±‚çš„èµ„æº index.html æ˜¯ç”± VirtualDirectory ç±»ä¸­çš„ serviceFile() æ–¹æ³•æä¾›çš„ã€‚ä½ ä¸éœ€è¦å†™ä»£ç æ¥æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶å¹¶å°†å…¶å†…å®¹ç”¨ç®¡é“ä¼ é€åˆ°è¯·æ±‚ä¸­ã€‚\nå¦ä¸€ä¸ªæ–‡ä»¶æœåŠ¡å™¨ static_file_server.dart ä¹Ÿä½¿ç”¨ http_server åŒ…ã€‚è¿™ä¸ªæœåŠ¡å™¨å¯ä»¥æœåŠ¡äºæœåŠ¡å™¨ç›®å½•æˆ–å­ç›®å½•ä¸­çš„ä»»ä½•æ–‡ä»¶ã€‚\nè¿è¡Œ static_file_server.dartï¼Œç”¨ localhost:4048 è¿™ä¸ª URL è¿›è¡Œæµ‹è¯•ã€‚\nä¸‹é¢æ˜¯ static_file_server.dart çš„ä»£ç :\nimport \u0026#39;dart:io\u0026#39;; import \u0026#39;package:http_server/http_server.dart\u0026#39;; Future main() async { var staticFiles = VirtualDirectory(\u0026#39;web\u0026#39;); staticFiles.allowDirectoryListing = true; /*1*/ staticFiles.directoryHandler = (dir, request) /*2*/ { var indexUri = Uri.file(dir.path).resolve(\u0026#39;index.html\u0026#39;); staticFiles.serveFile(File(indexUri.toFilePath()), request); /*3*/ }; var server = await HttpServer.bind(InternetAddress.loopbackIPv4, 4048); print(\u0026#39;Listening on port 4048\u0026#39;); await server.forEach(staticFiles.serveRequest); /*4*/ } /1/ å…è®¸å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡å™¨ç›®å½•å†…çš„æ–‡ä»¶ã€‚\n/2/ ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œå¤„ç†å¯¹ç›®å½•æœ¬èº«çš„è¯·æ±‚ï¼Œå³ URL ä¸åŒ…å«æ–‡ä»¶åã€‚è¯¥å‡½æ•°å°†è¿™äº›è¯·æ±‚é‡å®šå‘åˆ° index.htmlã€‚\n/3/ serveFile æ–¹æ³•ä¸ºä¸€ä¸ªæ–‡ä»¶æä¾›æœåŠ¡ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒä¸ºç›®å½•è¯·æ±‚æœåŠ¡index.htmlã€‚\n/4/ VirtualDirectory ç±»æä¾›çš„ serviceRequest æ–¹æ³•å¤„ç†æŒ‡å®šæ–‡ä»¶çš„è¯·æ±‚ã€‚\nä½¿ç”¨ bindSecure() çš„ https æ–¹æ³• æœ¬èŠ‚çš„ç¤ºä¾‹ï¼šhello_world_server_secure.dartã€‚\nä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼ŒHttpServer ç±»å®šä¹‰äº†ä¸€ä¸ªå«åš bindSecure() çš„æ–¹æ³•ï¼Œå®ƒä½¿ç”¨ HTTPS(Hyper Text Transfer Protocol with Secure Sockets Layer)æä¾›å®‰å…¨è¿æ¥ã€‚è¦ä½¿ç”¨ bindSecure() æ–¹æ³•ï¼Œä½ éœ€è¦ä¸€ä¸ªè¯ä¹¦ï¼Œè¿™ä¸ªè¯ä¹¦ç”±è¯ä¹¦é¢å‘æœºæ„(CA)æä¾›ã€‚æœ‰å…³è¯ä¹¦çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒä»€ä¹ˆæ˜¯ SSL å’Œä»€ä¹ˆæ˜¯è¯ä¹¦ï¼Ÿ\nä¸ºäº†è¯´æ˜é—®é¢˜ï¼Œä¸‹é¢çš„æœåŠ¡å™¨ hello_world_server_secure.dart ä½¿ç”¨ Dart å›¢é˜Ÿåˆ›å»ºçš„è¯ä¹¦è°ƒç”¨ bindSecure() è¿›è¡Œæµ‹è¯•ã€‚ä½ å¿…é¡»ä¸ºä½ çš„æœåŠ¡å™¨æä¾›è‡ªå·±çš„è¯ä¹¦ã€‚\nimport \u0026#39;dart:io\u0026#39;; String certificateChain = \u0026#39;server_chain.pem\u0026#39;; String serverKey = \u0026#39;server_key.pem\u0026#39;; Future main() async { var serverContext = SecurityContext(); /*1*/ serverContext.useCertificateChain(certificateChain); /*2*/ serverContext.usePrivateKey(serverKey, password: \u0026#39;dartdart\u0026#39;); /*3*/ var server = await HttpServer.bindSecure( \u0026#39;localhost\u0026#39;, 4047, serverContext, /*4*/ ); print(\u0026#39;Listening on localhost:${server.port}\u0026#39;); await for (HttpRequest request in server) { request.response.write(\u0026#39;Hello, world!\u0026#39;); await request.response.close(); } } /1/ å®‰å…¨ç½‘ç»œè¿æ¥çš„å¯é€‰è®¾ç½®åœ¨ SecurityContext å¯¹è±¡ä¸­æŒ‡å®šï¼Œæœ‰ä¸€ä¸ªé»˜è®¤çš„å¯¹è±¡ SecurityContext.defaultContextï¼ŒåŒ…æ‹¬çŸ¥åè¯ä¹¦æœºæ„çš„å¯ä¿¡æ ¹è¯ä¹¦ã€‚\n/2/ ä¸€ä¸ªåŒ…å«ä»æœåŠ¡å™¨è¯ä¹¦åˆ°ç­¾åæœºå…³æ ¹è¯ä¹¦é“¾çš„æ–‡ä»¶ï¼Œæ ¼å¼ä¸º PEMã€‚\n/3/ ä¸€ä¸ªåŒ…å«ï¼ˆåŠ å¯†çš„ï¼‰æœåŠ¡å™¨è¯ä¹¦ç§é’¥çš„æ–‡ä»¶ï¼ŒPEM æ ¼å¼ã€‚\n/4/ åœ¨æœåŠ¡å™¨ä¸Šï¼Œä¸Šä¸‹æ–‡å‚æ•°æ˜¯å¿…éœ€çš„ï¼Œå¯¹å®¢æˆ·ç«¯æ¥è¯´æ˜¯å¯é€‰çš„ã€‚å¦‚æœçœç•¥å®ƒï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„å†…ç½®å¯ä¿¡æ ¹çš„ä¸Šä¸‹æ–‡ã€‚\nå…¶ä»–èµ„æº è¯·è®¿é—®è¿™äº› API æ–‡æ¡£ï¼Œäº†è§£æœ¬æ•™ç¨‹ä¸­è®¨è®ºçš„ç±»å’Œåº“çš„æ›´å¤šç»†èŠ‚ã€‚\n   Dart ç±» ç›®çš„     HttpServer ä¸€ä¸ª HTTP æœåŠ¡å™¨   HttpClient ä¸€ä¸ª HTTP å®¢æˆ·ç«¯   HttpRequest ä¸€ä¸ªæœåŠ¡å™¨ç«¯è¯·æ±‚å¯¹è±¡   HttpResponse ä¸€ä¸ªæœåŠ¡å™¨ç«¯å“åº”å¯¹è±¡   HttpClientRequest ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚å¯¹è±¡   HttpClientResponse ä¸€ä¸ªå®¢æˆ·ç«¯å“åº”å¯¹è±¡   HttpHeaders è¯·æ±‚å¤´   HttpStatus å“åº”çš„çŠ¶æ€   InternetAddress ä¸€ä¸ªäº’è”ç½‘åœ°å€   SecurityContext åŒ…å«å®‰å…¨è¿æ¥çš„è¯ä¹¦ã€å¯†é’¥å’Œä¿¡ä»»ä¿¡æ¯ã€‚   http_server åŒ… ä¸€ä¸ªå…·æœ‰è¾ƒé«˜çº§åˆ«çš„ HTTP ç±»çš„åŒ…    ä¸‹ä¸€æ­¥è¯¥æ€ä¹ˆåšï¼Ÿ  å¦‚æœä½ è¿˜æ²¡æœ‰å°è¯•è¿‡æœåŠ¡å™¨ç«¯çš„ codelabï¼Œå¯ä»¥å°è¯•ç¼–å†™ä¸€ä¸ªæœåŠ¡å™¨åº”ç”¨ç¨‹åºã€‚ Servers with Dart é“¾æ¥åˆ°ç¼–å†™ç‹¬ç«‹ Dart åº”ç”¨ç¨‹åºçš„èµ„æºï¼ŒåŒ…æ‹¬æœåŠ¡å™¨ã€‚  ","permalink":"https://ohmyweekly.github.io/notes/write-http-clients/","tags":["flutter","client"],"title":"ç¼–å†™HTTPå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨"},{"categories":["programming"],"contents":"Dart ç”Ÿæ€ç³»ç»Ÿä½¿ç”¨åŒ…æ¥ç®¡ç†å…±äº«è½¯ä»¶ï¼Œå¦‚åº“å’Œå·¥å…·ã€‚è¦è·å¾— Dart åŒ…ï¼Œä½ å¯ä»¥ä½¿ç”¨ pub åŒ…ç®¡ç†å™¨ã€‚ä½ å¯ä»¥åœ¨ pub.dev ç½‘ç«™ä¸Šæ‰¾åˆ°å…¬å¼€çš„åŒ…ï¼Œä¹Ÿå¯ä»¥ä»æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæˆ–å…¶ä»–åœ°æ–¹åŠ è½½åŒ…ï¼Œæ¯”å¦‚ Git ä»“åº“ã€‚æ— è®ºä½ çš„åŒ…æ¥è‡ªå“ªé‡Œï¼Œpub éƒ½ä¼šç®¡ç†ç‰ˆæœ¬ä¾èµ–å…³ç³»ï¼Œå¸®åŠ©ä½ è·å¾—ç›¸äº’ä¹‹é—´ä»¥åŠä¸ SDK ç‰ˆæœ¬å…¼å®¹çš„åŒ…ç‰ˆæœ¬ã€‚\nå¤§å¤šæ•°ç²¾é€š Dart çš„ IDE éƒ½æä¾›äº†å¯¹ pub çš„æ”¯æŒï¼ŒåŒ…æ‹¬åˆ›å»ºã€ä¸‹è½½ã€æ›´æ–°å’Œå‘å¸ƒåŒ…ã€‚æˆ–è€…ä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ pubã€‚\nè‡³å°‘ï¼Œä¸€ä¸ª Dart åŒ…æ˜¯ä¸€ä¸ªåŒ…å« pubspec æ–‡ä»¶çš„ç›®å½•ã€‚pubspec åŒ…å«ä¸€äº›å…³äºåŒ…çš„å…ƒæ•°æ®ã€‚æ­¤å¤–ï¼Œä¸€ä¸ªåŒ…å¯ä»¥åŒ…å«ä¾èµ–å…³ç³»(åœ¨ pubspec ä¸­åˆ—å‡º)ï¼ŒDart åº“ï¼Œåº”ç”¨ç¨‹åºï¼Œèµ„æºï¼Œæµ‹è¯•ï¼Œå›¾åƒå’Œä¾‹å­ã€‚\nè¦ä½¿ç”¨ä¸€ä¸ªåŒ…ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œ:\n åˆ›å»ºä¸€ä¸ª pubspec(ä¸€ä¸ªåä¸º pubspec.yaml çš„æ–‡ä»¶ï¼Œå®ƒåˆ—å‡ºäº†è½¯ä»¶åŒ…çš„ä¾èµ–å…³ç³»ï¼Œå¹¶åŒ…å«å…¶ä»–å…ƒæ•°æ®ï¼Œå¦‚ç‰ˆæœ¬å·)ã€‚ ä½¿ç”¨ pub æ¥è·å–ä½ çš„åŒ…çš„ä¾èµ–å…³ç³»ã€‚ å¦‚æœä½ çš„ Dart ä»£ç ä¾èµ–äºè½¯ä»¶åŒ…ä¸­çš„ä¸€ä¸ªåº“ï¼Œåˆ™å¯¼å…¥è¯¥åº“ã€‚  åˆ›å»ºä¸€ä¸ª pubspec pubspec æ˜¯ä¸€ä¸ªåä¸º pubspec.yaml çš„æ–‡ä»¶ï¼Œå®ƒä½äºä½ çš„åº”ç”¨ç¨‹åºçš„é¡¶çº§ç›®å½•ä¸­ã€‚æœ€ç®€å•çš„ pubspec åªåˆ—å‡ºäº†åŒ…å:\nname: my_app ä¸‹é¢æ˜¯ä¸€ä¸ª pubspec çš„ä¾‹å­ï¼Œå®ƒå£°æ˜äº†ä¸¤ä¸ªåŒ…(js å’Œ intl)çš„ä¾èµ–å…³ç³»ï¼Œè¿™ä¸¤ä¸ªåŒ…éƒ½æ‰˜ç®¡åœ¨ pub.dev ç«™ç‚¹ä¸Š:\nname: my_app dependencies: js: ^0.6.0 intl: ^0.15.8 å…³äºåˆ›å»º pubspec çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§ pubspec æ–‡æ¡£å’Œä½ è¦ä½¿ç”¨çš„åŒ…çš„æ–‡æ¡£ã€‚\nè·å–è½¯ä»¶åŒ… ä¸€æ—¦ä½ æœ‰äº† pubspecï¼Œä½ å°±å¯ä»¥ä»ä½ çš„åº”ç”¨ç¨‹åºçš„é¡¶çº§ç›®å½•ä¸­è¿è¡Œ pub get:\n$ cd \u0026lt;path-to-my_app\u0026gt; $ pub get è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºè·å–ä¾èµ–å…³ç³»ã€‚\npub get å‘½ä»¤å¯ä»¥ç¡®å®šæ‚¨çš„åº”ç”¨ç¨‹åºä¾èµ–äºå“ªäº›è½¯ä»¶åŒ…ï¼Œå¹¶å°†å®ƒä»¬æ”¾åœ¨ä¸­å¤®ç³»ç»Ÿç¼“å­˜ä¸­ã€‚å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºä¾èµ–äºå·²å‘å¸ƒçš„åŒ…ï¼Œpub ä¼šä» pub.dev ç«™ç‚¹ä¸‹è½½è¯¥åŒ…ã€‚å¯¹äº Git ä¾èµ–ï¼Œpub ä¼šå…‹éš† Git ä»“åº“ã€‚è¿˜åŒ…æ‹¬äº†è¿‡æ¸¡æ€§ä¾èµ–ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ js åŒ…ä¾èµ–äº test åŒ…ï¼Œpub ä¼šåŒæ—¶æŠ“å– js åŒ…å’Œ test åŒ…ã€‚\nPub ä¼šåˆ›å»ºä¸€ä¸ª .packages æ–‡ä»¶(åœ¨ä½ çš„åº”ç”¨ç¨‹åºçš„é¡¶å±‚ç›®å½•ä¸‹)ï¼Œå°†ä½ çš„åº”ç”¨ç¨‹åºæ‰€ä¾èµ–çš„æ¯ä¸ªåŒ…åæ˜ å°„åˆ°ç³»ç»Ÿç¼“å­˜ä¸­çš„å¯¹åº”åŒ…ã€‚\nä»åŒ…ä¸­å¯¼å…¥åº“ è¦å¯¼å…¥åœ¨åŒ…ä¸­æ‰¾åˆ°çš„åº“ï¼Œä½¿ç”¨ package: å‰ç¼€:\nimport \u0026#39;package:js/js.dart\u0026#39; as js; import \u0026#39;package:intl/intl.dart\u0026#39;; Dart è¿è¡Œæ—¶åœ¨ package: ä¹‹åçš„æ‰€æœ‰å†…å®¹éƒ½ä¼šåœ¨åº”ç”¨ç¨‹åºçš„ .package æ–‡ä»¶ä¸­è¿›è¡ŒæŸ¥æ‰¾ã€‚\nä½ ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ç§é£æ ¼ä»ä½ è‡ªå·±çš„åŒ…ä¸­å¯¼å…¥åº“ã€‚æ¯”æ–¹è¯´ï¼Œtransmogrify åŒ…çš„å¸ƒå±€å¦‚ä¸‹:\ntransmogrify/ lib/ transmogrify.dart parser.dart test/ parser/ parser_test.dart parser_test.dart æ–‡ä»¶å¯ä»¥è¿™æ ·å¯¼å…¥ parser.dart:\nimport \u0026#39;package:transmogrify/parser.dart\u0026#39;; å‡çº§ä¾èµ–å…³ç³» å½“ä½ ç¬¬ä¸€æ¬¡ä¸ºä½ çš„è½¯ä»¶åŒ…è·å–ä¸€ä¸ªæ–°çš„ä¾èµ–å…³ç³»æ—¶ï¼Œpub ä¼šä¸‹è½½ä¸ä½ çš„å…¶ä»–ä¾èµ–å…³ç³»å…¼å®¹çš„æœ€æ–°ç‰ˆæœ¬ã€‚ç„¶åï¼Œå®ƒé€šè¿‡åˆ›å»ºä¸€ä¸ª lockfile é”æ–‡ä»¶æ¥é”å®šæ‚¨çš„è½¯ä»¶åŒ…ï¼Œä½¿å…¶å§‹ç»ˆä½¿ç”¨è¯¥ç‰ˆæœ¬ã€‚è¿™æ˜¯ä¸€ä¸ªåä¸º pubspec.lock çš„æ–‡ä»¶ï¼Œç”± pub åˆ›å»ºå¹¶å­˜å‚¨åœ¨ pubspec çš„æ—è¾¹ã€‚å®ƒåˆ—å‡ºäº†æ‚¨çš„è½¯ä»¶åŒ…æ‰€ä½¿ç”¨çš„æ¯ä¸ªä¾èµ–å…³ç³»çš„ç‰¹å®šç‰ˆæœ¬ (å³æ—¶çš„å’Œè¿‡æ¸¡çš„)ã€‚\nå¦‚æœä½ çš„åŒ…æ˜¯ä¸€ä¸ªåº”ç”¨ç¨‹åºåŒ…ï¼Œä½ åº”è¯¥æŠŠè¿™ä¸ªæ–‡ä»¶æ£€æŸ¥åˆ°æºä»£ç æ§åˆ¶ä¸­ã€‚è¿™æ ·ï¼Œåœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸Šå·¥ä½œçš„æ¯ä¸ªäººéƒ½ä¼šä½¿ç”¨æ‰€æœ‰åŒ…çš„ç›¸åŒç‰ˆæœ¬ã€‚åœ¨ lockfile æ–‡ä»¶ä¸­æ£€æŸ¥ä¹Ÿå¯ä»¥ç¡®ä¿ä½ éƒ¨ç½²çš„åº”ç”¨ä½¿ç”¨ç›¸åŒç‰ˆæœ¬çš„ä»£ç ã€‚\nå½“ä½ å‡†å¤‡å¥½å°†ä½ çš„ä¾èµ–é¡¹å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬æ—¶ï¼Œä½¿ç”¨ pub upgrade å‘½ä»¤:\n$ pub upgrade pub upgrade å‘½ä»¤å‘Šè¯‰ pub ä½¿ç”¨ä½ çš„åŒ…çš„ä¾èµ–å…³ç³»çš„æœ€æ–°ç‰ˆæœ¬æ¥é‡æ–°ç”Ÿæˆ lockfile æ–‡ä»¶ã€‚å¦‚æœä½ åªæƒ³å‡çº§ä¸€ä¸ªä¾èµ–å…³ç³»ï¼Œä½ å¯ä»¥æŒ‡å®šè¦å‡çº§çš„è½¯ä»¶åŒ…:\n$ pub upgrade transmogrify è¯¥å‘½ä»¤å°† transmogrify å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œä½†å…¶ä»–ä¸€åˆ‡éƒ½ä¿æŒä¸å˜ã€‚\nç”±äº pubspec ä¸­æœ‰å†²çªçš„ç‰ˆæœ¬é™åˆ¶ï¼Œpub upgrade å‘½ä»¤å¹¶ä¸èƒ½æ€»æ˜¯å°†æ¯ä¸ªè½¯ä»¶åŒ…å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚è¦è¯†åˆ«éœ€è¦ç¼–è¾‘ pubspec çš„è¿‡æœŸè½¯ä»¶åŒ…ï¼Œè¯·ä½¿ç”¨ pub outdatedã€‚\næ›´å¤šä¿¡æ¯ ä¸‹é¢çš„é¡µé¢æœ‰æ›´å¤šå…³äºè½¯ä»¶åŒ…å’Œ pub åŒ…ç®¡ç†å™¨çš„ä¿¡æ¯ã€‚\nå¦‚ä½•ä½¿ç”¨\n åˆ›å»ºåŒ… å‘å¸ƒåŒ…  å‚è€ƒ\n Pub ä¾èµ– Pub ç¯å¢ƒå˜é‡ Pub è¯æ±‡è¡¨ Pub åŒ…å¸ƒå±€çº¦å®š Pub ç‰ˆæœ¬å“²å­¦ Pubspec æ ¼å¼åŒ–  Pub å‘½ä»¤\npub å·¥å…·æä¾›äº†ä»¥ä¸‹å‘½ä»¤:\n pub cache pub deps pub downgrade pub get pub global pub outdated pub publish pub run pub upgrade pub uploader  æœ‰å…³æ‰€æœ‰ pub å‘½ä»¤çš„æ¦‚è¿°ï¼Œè¯·å‚é˜… pub å·¥å…·æ–‡æ¡£ã€‚\nç–‘éš¾è§£ç­”\næ•…éšœæ’é™¤ pub æä¾›äº†ä½¿ç”¨ pub æ—¶å¯èƒ½é‡åˆ°çš„é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚\n","permalink":"https://ohmyweekly.github.io/notes/how-to-use-packages/","tags":["flutter","packages"],"title":"å¦‚ä½•ä½¿ç”¨åŒ…"},{"categories":["programming"],"contents":"æœ¬é¡µåˆ—å‡ºäº†ä¸€äº› Dart å¼€å‘è€…å‘å¸ƒçš„æœ€æµè¡Œå’Œæœ€æœ‰ç”¨çš„åŒ…ã€‚è¦æ‰¾åˆ°æ›´å¤šçš„è½¯ä»¶åŒ…\u0026ndash;ä¹Ÿå¯ä»¥æœç´¢æ ¸å¿ƒåº“\u0026ndash;è¯·ä½¿ç”¨ pub.dev ç½‘ç«™ã€‚\nå¸¸ç”¨çš„è½¯ä»¶åŒ…å¯åˆ†ä¸ºä¸‰ç±»:\n é€šç”¨åŒ… æ‰©å±• Dart æ ¸å¿ƒåº“çš„åŒ… ç‰¹å®šçš„åŒ…  é€šç”¨åŒ… ä»¥ä¸‹åŒ…å¯¹å„ç§é¡¹ç›®éƒ½å¾ˆæœ‰ç”¨:\n   åŒ… æè¿° å¸¸ç”¨çš„ API     archive å¯¹å„ç§æ¡£æ¡ˆå’Œå‹ç¼©æ ¼å¼è¿›è¡Œç¼–ç å’Œè§£ç ã€‚ Archive, ArchiveFile, TarEncoder, TarDecoder, ZipEncoder, ZipDecoder   characters å¯¹ç”¨æˆ·æ„ŸçŸ¥çš„å­—ç¬¦è¿›è¡Œå­—ç¬¦ä¸²æ“ä½œ(Unicode å­—ç¬¦ç°‡) String.characters, Characters, CharacterRange   http ä¸€ç»„é«˜çº§çš„å‡½æ•°å’Œç±»ï¼Œä½¿å…¶æ˜“äºæ¶ˆè´¹ HTTP èµ„æº delete(), get(), post(), read()   intl å›½é™…åŒ–å’Œæœ¬åœ°åŒ–è®¾æ–½ï¼Œæ”¯æŒå¤æ•°å’Œæ€§åˆ«ã€æ—¥æœŸå’Œæ•°å­—æ ¼å¼åŒ–å’Œè§£æä»¥åŠåŒå‘æ–‡æœ¬ Bidi, DateFormat, MicroMoney, TextDirection   json_serializable ä¸€ä¸ªæ˜“äºä½¿ç”¨çš„ä»£ç ç”ŸæˆåŒ…ã€‚æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… JSON æ”¯æŒ @JsonSerializable   logging ä¸€ä¸ªå¯é…ç½®çš„æœºåˆ¶ï¼Œä¸ºä½ çš„åº”ç”¨ç¨‹åºæ·»åŠ æ¶ˆæ¯è®°å½• LoggerHandler, Level, LogRecord   mockito ä¸€ä¸ªåœ¨æµ‹è¯•ä¸­æ¨¡æ‹Ÿå¯¹è±¡çš„æµè¡Œæ¡†æ¶ã€‚å¦‚æœä½ æ­£åœ¨ç¼–å†™ä¾èµ–æ³¨å…¥çš„æµ‹è¯•ï¼Œç‰¹åˆ«æœ‰ç”¨ã€‚ä¸ test åŒ…ä¸€èµ·ä½¿ç”¨ Answering, Expectation, Verification   path æ“ä½œä¸åŒç±»å‹è·¯å¾„çš„å¸¸ç”¨æ“ä½œã€‚æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§æ‹†åŒ…: path absolute(), basename(), extension(), join(), normalize(), relative(), split()   quiver å®ç”¨å·¥å…·ï¼Œä½¿ Dart æ ¸å¿ƒåº“çš„ä½¿ç”¨æ›´åŠ æ–¹ä¾¿ã€‚Quiver æä¾›é¢å¤–æ”¯æŒçš„ä¸€äº›åº“åŒ…æ‹¬ asyncã€cacheã€collectionã€coreã€iterablesã€pattern å’Œ æµ‹è¯• CountdownTimer (quiver.async); MapCache (quiver.cache); MultiMap, TreeSet (quiver.collection); EnumerateIterable (quiver.iterables); center(), compareIgnoreCase(), isWhiteSpace() (quiver.strings)   shelf Dart çš„ Web æœåŠ¡å™¨ä¸­é—´ä»¶ã€‚Shelf ä½¿å®ƒèƒ½è½»æ¾åœ°åˆ›å»ºå’Œç»„æˆ Web æœåŠ¡å™¨ï¼Œä»¥åŠ Web æœåŠ¡å™¨çš„ä¸€éƒ¨åˆ† Cascade, Pipeline, Request, Response, Server   stack_trace ç”¨äºè§£æã€æ£€æŸ¥å’Œå¤„ç†ç”±åº•å±‚ Dart å®ç°äº§ç”Ÿçš„å †æ ˆç—•è¿¹çš„æ–¹æ³•ã€‚è¿˜æä¾›äº†ä»¥æ¯”åŸç”Ÿ StackTrace å®ç°æ›´å¯è¯»çš„æ ¼å¼ç”Ÿæˆå †æ ˆè·Ÿè¸ªçš„å­—ç¬¦ä¸²è¡¨ç¤ºçš„å‡½æ•°, æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§æ‹†åŒ…: stack_trace Trace.current(), Trace.format(), Trace.from()   stagehand ä¸€ä¸ª Dart é¡¹ç›®ç”Ÿæˆå™¨ã€‚å½“ä½ åˆ›å»ºä¸€ä¸ªæ–°çš„åº”ç”¨ç¨‹åºæ—¶ï¼ŒWebStorm å’Œ IntelliJ ä½¿ç”¨ Stagehand æ¨¡æ¿ï¼Œä½†ä½ ä¹Ÿå¯ä»¥ä»å‘½ä»¤è¡Œä½¿ç”¨æ¨¡æ¿ ä¸€èˆ¬é€šè¿‡ IDE æˆ– stagehand å‘½ä»¤æ¥ä½¿ç”¨   test åœ¨ Dart ä¸­ç¼–å†™å’Œè¿è¡Œæµ‹è¯•çš„æ ‡å‡†æ–¹æ³• expect(), group(), test()   yaml YAML è§£æå™¨ loadYaml(), loadYamlStream()    æ‰©å±• Dart æ ¸å¿ƒåº“çš„åŒ… ä»¥ä¸‹æ¯ä¸ªåŒ…éƒ½å»ºç«‹åœ¨ä¸€ä¸ªæ ¸å¿ƒåº“çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†åŠŸèƒ½å¹¶å¡«è¡¥äº†ç¼ºå¤±çš„åŠŸèƒ½:\n   åŒ… æè¿° å¸¸ç”¨çš„ API     async åœ¨ dart:async çš„åŸºç¡€ä¸Šè¿›è¡Œäº†æ‰©å±•ï¼Œå¢åŠ äº†å®ç”¨ç±»æ¥å¤„ç†å¼‚æ­¥è®¡ç®—ã€‚æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§æ‹†åŒ…: async ç¬¬1éƒ¨åˆ†ã€ç¬¬2éƒ¨åˆ†å’Œç¬¬3éƒ¨åˆ† AsyncMemoizer, CancelableOperation, FutureGroup, LazyStream, Result, StreamCompleter, StreamGroup, StreamSplitter   collection åœ¨ dart:collection çš„åŸºç¡€ä¸Šè¿›è¡Œäº†æ‰©å±•ï¼Œå¢åŠ äº†å®ç”¨å‡½æ•°å’Œç±»ï¼Œä½¿å¤„ç†é›†åˆçš„å·¥ä½œå˜å¾—æ›´åŠ å®¹æ˜“ã€‚æ›´å¤šä¿¡æ¯ï¼Œè¯·çœ‹æ‹†åŒ…ï¼šcollection Equality, CanonicalizedMap, MapKeySet, MapValueSet, PriorityQueue, QueueList   convert åœ¨ dart:convert çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†ç¼–ç å™¨å’Œè§£ç å™¨ï¼Œç”¨äºåœ¨ä¸åŒçš„æ•°æ®è¡¨ç°å½¢å¼ä¹‹é—´è¿›è¡Œè½¬æ¢ã€‚å…¶ä¸­ä¸€ç§æ•°æ®è¡¨ç¤ºæ–¹å¼æ˜¯ç™¾åˆ†æ¯”ç¼–ç ï¼Œä¹Ÿè¢«ç§°ä¸º URL ç¼–ç  HexDecoder, PercentDecoder   io åŒ…å«ä¸¤ä¸ªåº“ï¼Œansiå’Œioï¼Œä»¥ç®€åŒ–å¯¹æ–‡ä»¶ã€æ ‡å‡†æµå’Œè¿›ç¨‹çš„å¤„ç†ã€‚ä½¿ç”¨ ansi åº“å¯ä»¥è‡ªå®šä¹‰ç»ˆç«¯è¾“å‡ºã€‚io åº“æœ‰å¤„ç†è¿›ç¨‹ã€stdin å’Œæ–‡ä»¶å¤åˆ¶çš„ API copyPath(), isExecutable(), ExitCode, ProcessManager, sharedStdIn    ä¸“ç”¨åŒ… ä¸‹é¢æ˜¯ä¸€äº›å¯»æ‰¾æ¯”è¾ƒä¸“ä¸šçš„åŒ…çš„æŠ€å·§ï¼Œæ¯”å¦‚æ‰‹æœºçš„åŒ…(Flutter)å’Œç½‘é¡µå¼€å‘çš„åŒ…ã€‚\nFlutter åŒ… è¯·çœ‹ Flutter ç½‘ç«™ä¸Šçš„ä½¿ç”¨åŒ…ã€‚æˆ–è€…ä½¿ç”¨ pub.dev ç½‘ç«™æœç´¢ Flutter åŒ…ã€‚\nç½‘ç»œåŒ… å‚è§ç½‘ç»œåº“å’ŒåŒ…ã€‚æˆ–è€…ä½¿ç”¨ pub.dev ç«™ç‚¹æœç´¢ web åŒ…ã€‚\nå‘½ä»¤è¡Œå’ŒæœåŠ¡å™¨è½¯ä»¶åŒ… å‚è§å‘½ä»¤è¡Œå’ŒæœåŠ¡å™¨åº“å’ŒåŒ…ã€‚æˆ–è€…ä½¿ç”¨ pub.dev ç«™ç‚¹æœç´¢å…¶ä»–åŒ…ã€‚\n","permalink":"https://ohmyweekly.github.io/notes/commonly-used-packages/","tags":["flutter","packages"],"title":"å¸¸ç”¨çš„åŒ…"},{"categories":["programming"],"contents":"async-await\nè¿™ä¸ª codelab æ•™ä½ å¦‚ä½•ä½¿ç”¨ futuresã€async å’Œ await å…³é”®å­—ç¼–å†™å¼‚æ­¥ä»£ç ã€‚ä½¿ç”¨å†…åµŒçš„ DartPad ç¼–è¾‘å™¨ï¼Œä½ å¯ä»¥é€šè¿‡è¿è¡Œç¤ºä¾‹ä»£ç å’Œå®Œæˆç»ƒä¹ æ¥æµ‹è¯•ä½ çš„çŸ¥è¯†ã€‚\nè¦æƒ³ä»è¿™ä¸ª codelab ä¸­è·å¾—æœ€å¤§çš„æ”¶è·ï¼Œä½ åº”è¯¥å…·å¤‡ä»¥ä¸‹æ¡ä»¶ã€‚\n æŒæ¡åŸºæœ¬çš„ Dart è¯­æ³• æœ‰ç”¨å…¶ä»–è¯­è¨€ç¼–å†™å¼‚æ­¥ä»£ç çš„ç»éªŒã€‚  è¿™ä¸ª codelab åŒ…æ‹¬ä»¥ä¸‹ææ–™ã€‚\n å¦‚ä½•ä»¥åŠä½•æ—¶ä½¿ç”¨ async å’Œ await å…³é”®å­—ã€‚ ä½¿ç”¨ async å’Œ await å¦‚ä½•å½±å“æ‰§è¡Œé¡ºåºã€‚ å¦‚ä½•åœ¨ async å‡½æ•°ä¸­ä½¿ç”¨ try-catch è¡¨è¾¾å¼å¤„ç†å¼‚æ­¥è°ƒç”¨ä¸­çš„é”™è¯¯ã€‚  ä¼°è®¡å®Œæˆè¿™ä¸ªä»£ç å®éªŒçš„æ—¶é—´ã€‚40-60åˆ†é’Ÿ\næ³¨æ„ï¼šæœ¬é¡µé¢ä½¿ç”¨åµŒå…¥å¼ DartPads æ¥æ˜¾ç¤ºç¤ºä¾‹å’Œç»ƒä¹ ã€‚å¦‚æœä½ çœ‹åˆ°çš„æ˜¯ç©ºæ¡†è€Œä¸æ˜¯ DartPadsï¼Œè¯·è½¬åˆ° DartPad æ•…éšœæ’é™¤é¡µé¢ã€‚\nä¸ºä»€ä¹ˆå¼‚æ­¥ä»£ç å¾ˆé‡è¦ å¼‚æ­¥æ“ä½œè®©ä½ çš„ç¨‹åºåœ¨ç­‰å¾…å¦ä¸€ä¸ªæ“ä½œå®Œæˆæ—¶å®Œæˆå·¥ä½œã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„å¼‚æ­¥æ“ä½œã€‚\n é€šè¿‡ç½‘ç»œè·å–æ•°æ®ã€‚ å†™å…¥æ•°æ®åº“ã€‚ ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚  è¦åœ¨ Dart ä¸­æ‰§è¡Œå¼‚æ­¥æ“ä½œï¼Œä½ å¯ä»¥ä½¿ç”¨ Future ç±»ä»¥åŠ async å’Œ await å…³é”®å­—ã€‚\nä¾‹å­: é”™è¯¯åœ°ä½¿ç”¨å¼‚æ­¥å‡½æ•° ä¸‹é¢çš„ä¾‹å­æ˜¾ç¤ºäº†ä½¿ç”¨å¼‚æ­¥å‡½æ•°(fetchUserOrder())çš„é”™è¯¯æ–¹æ³•ã€‚ç¨åä½ å°†ä½¿ç”¨ async å’Œ await æ¥ä¿®å¤è¿™ä¸ªä¾‹å­ã€‚åœ¨è¿è¡Œè¿™ä¸ªä¾‹å­ä¹‹å‰ï¼Œè¯•ç€å‘ç°è¿™ä¸ªé—®é¢˜-ä½ è®¤ä¸ºè¾“å‡ºä¼šæ˜¯ä»€ä¹ˆï¼Ÿ\n// This example shows how *not* to write asynchronous Dart code.  String createOrderMessage() { var order = fetchUserOrder(); return \u0026#39;Your order is: $order\u0026#39;; } Future\u0026lt;String\u0026gt; fetchUserOrder() =\u0026gt; // Imagine that this function is more complex and slow.  Future.delayed( Duration(seconds: 2), () =\u0026gt; \u0026#39;Large Latte\u0026#39;, ); void main() { print(createOrderMessage()); } ä¸‹é¢æ˜¯è¿™ä¸ªä¾‹å­ä¸ºä»€ä¹ˆä¸èƒ½æ‰“å° fetchUserOrder() æœ€ç»ˆäº§ç”Ÿçš„å€¼ã€‚\n fetchUserOrder() æ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œåœ¨å»¶è¿Ÿä¹‹åï¼Œæä¾›ä¸€ä¸ªæè¿°ç”¨æˆ·è®¢å•çš„å­—ç¬¦ä¸²ï¼š\u0026ldquo;Large Latte\u0026rdquo;ã€‚ ä¸ºäº†å¾—åˆ°ç”¨æˆ·çš„è®¢å•ï¼ŒcreateOrderMessage() åº”è¯¥è°ƒç”¨ fetchUserOrder()ï¼Œå¹¶ç­‰å¾…å…¶å®Œæˆã€‚ç”±äº createOrderMessage() æ²¡æœ‰ç­‰å¾… fetchUserOrder() å®Œæˆï¼ŒcreateOrderMessage() æ— æ³•è·å¾— fetchUserOrder() æœ€ç»ˆæä¾›çš„å­—ç¬¦ä¸²å€¼ã€‚ å–è€Œä»£ä¹‹çš„æ˜¯ï¼ŒcreateOrderMessage() å¾—åˆ°çš„æ˜¯å¾…å®Œæˆå·¥ä½œçš„è¡¨ç¤ºï¼šä¸€ä¸ªæœªå®Œæˆçš„æœªæ¥ã€‚æ‚¨å°†åœ¨ä¸‹ä¸€èŠ‚äº†è§£æ›´å¤šå…³äºæœªæ¥çš„ä¿¡æ¯ã€‚ å› ä¸º createOrderMessage() æ²¡æœ‰å¾—åˆ°æè¿°ç”¨æˆ·è®¢å•çš„å€¼ï¼Œæ‰€ä»¥è¿™ä¸ªä¾‹å­æ²¡æœ‰æ‰“å° \u0026ldquo;Large Latte\u0026rdquo; åˆ°æ§åˆ¶å°ï¼Œè€Œæ˜¯æ‰“å° \u0026ldquo;Your order is: Instance of \u0026lsquo;_Future\u0026rsquo;\u0026quot;ã€‚  åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­ï¼Œä½ å°†å­¦ä¹ å…³äº futures å’Œå…³äºä½¿ç”¨ futures çš„å·¥ä½œï¼ˆä½¿ç”¨ async å’Œ awaitï¼‰ï¼Œè¿™æ ·ä½ å°±èƒ½ç¼–å†™å¿…è¦çš„ä»£ç ï¼Œä½¿ fetchUserOrder() å‘æ§åˆ¶å°æ‰“å°æ‰€éœ€çš„å€¼(\u0026ldquo;Large Latte\u0026rdquo;)ã€‚\nå…³é”®æœ¯è¯­:\n åŒæ­¥æ“ä½œ: åŒæ­¥æ“ä½œä¼šé˜»æ­¢å…¶ä»–æ“ä½œçš„æ‰§è¡Œï¼Œç›´åˆ°å®ƒå®Œæˆã€‚ åŒæ­¥å‡½æ•°ï¼šåŒæ­¥å‡½æ•°åªæ‰§è¡ŒåŒæ­¥æ“ä½œã€‚ å¼‚æ­¥æ“ä½œï¼šå¼‚æ­¥æ“ä½œä¸€æ—¦å¯åŠ¨ï¼Œå°±å…è®¸å…¶ä»–æ“ä½œåœ¨å®ƒå®Œæˆä¹‹å‰æ‰§è¡Œã€‚ å¼‚æ­¥å‡½æ•°ï¼šå¼‚æ­¥å‡½æ•°è‡³å°‘æ‰§è¡Œä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œä¹Ÿå¯ä»¥æ‰§è¡ŒåŒæ­¥æ“ä½œã€‚  ä»€ä¹ˆæ˜¯æœªæ¥ï¼Ÿ future(å°å†™ \u0026ldquo;f\u0026rdquo;)æ˜¯ Futureï¼ˆå¤§å†™ \u0026ldquo;F\u0026rdquo;ï¼‰ç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚ä¸€ä¸ª future ä»£è¡¨å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œå¯ä»¥æœ‰ä¸¤ç§çŠ¶æ€ï¼šæœªå®Œæˆæˆ–å®Œæˆã€‚\næ³¨æ„ï¼šæœªå®Œæˆæ˜¯ä¸€ä¸ª Dart æœ¯è¯­ï¼ŒæŒ‡çš„æ˜¯ä¸€ä¸ªæœªæ¥çš„çŠ¶æ€ï¼Œåœ¨å®ƒäº§ç”Ÿä¸€ä¸ªå€¼ä¹‹å‰ã€‚\næœªå®Œæˆçš„ å½“ä½ è°ƒç”¨ä¸€ä¸ªå¼‚æ­¥å‡½æ•°æ—¶ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªæœªå®Œæˆçš„æœªæ¥ã€‚è¿™ä¸ªæœªæ¥æ­£åœ¨ç­‰å¾…å‡½æ•°çš„å¼‚æ­¥æ“ä½œå®Œæˆæˆ–æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚\nå·²å®Œæˆçš„ å¦‚æœå¼‚æ­¥æ“ä½œæˆåŠŸï¼Œæœªæ¥å°±ä»¥ä¸€ä¸ªå€¼å®Œæˆã€‚å¦åˆ™å®ƒå°†ä»¥ä¸€ä¸ªé”™è¯¯å®Œæˆã€‚\nç”¨ä¸€ä¸ªå€¼æ¥å®Œæˆ ç±»å‹ä¸º Future\u0026lt;T\u0026gt; çš„ future ç”¨ä¸€ä¸ªç±»å‹ä¸º T çš„å€¼æ¥å®Œæˆã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç±»å‹ä¸º Future\u0026lt;String\u0026gt; çš„ future ä¼šäº§ç”Ÿä¸€ä¸ªå­—ç¬¦ä¸²å€¼ã€‚å¦‚æœä¸€ä¸ª future æ²¡æœ‰äº§ç”Ÿä¸€ä¸ªå¯ç”¨çš„å€¼ï¼Œé‚£ä¹ˆ future çš„ç±»å‹æ˜¯ Future\u0026lt;void\u0026gt;ã€‚\nç”¨ä¸€ä¸ªé”™è¯¯æ¥å®Œæˆ å¦‚æœå‡½æ•°æ‰§è¡Œçš„å¼‚æ­¥æ“ä½œå› ä¸ºä»»ä½•åŸå› è€Œå¤±è´¥ï¼Œfuture å°±ä¼šä»¥é”™è¯¯çš„æ–¹å¼å®Œæˆã€‚\nä¾‹å­: ä»‹ç» future åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼ŒfetchUserOrder() è¿”å›ä¸€ä¸ªåœ¨æ‰“å°åˆ°æ§åˆ¶å°åå®Œæˆçš„ futureã€‚å› ä¸ºå®ƒæ²¡æœ‰è¿”å›ä¸€ä¸ªå¯ç”¨çš„å€¼ï¼ŒfetchUserOrder() çš„ç±»å‹æ˜¯ Future\u0026lt;void\u0026gt;ã€‚åœ¨è¿è¡Œè¿™ä¸ªä¾‹å­ä¹‹å‰ï¼Œè¯•ç€é¢„æµ‹ä¸€ä¸‹å“ªä¸ªä¼šå…ˆæ‰“å°ï¼š\u0026ldquo;Large Latte\u0026rdquo; æˆ– \u0026ldquo;Fetching user order\u0026hellip;\u0026quot;ã€‚\nFuture\u0026lt;void\u0026gt; fetchUserOrder() { // Imagine that this function is fetching user info from another service or database.  return Future.delayed(Duration(seconds: 2), () =\u0026gt; print(\u0026#39;Large Latte\u0026#39;)); } void main() { fetchUserOrder(); print(\u0026#39;Fetching user order...\u0026#39;); } åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œå°½ç®¡ fetchUserOrder() åœ¨ç¬¬8è¡Œçš„ print() è°ƒç”¨ä¹‹å‰æ‰§è¡Œï¼Œæ§åˆ¶å°è¿˜æ˜¯åœ¨ fetchUserOrder() çš„è¾“å‡º (\u0026ldquo;Large Latte\u0026rdquo;) ä¹‹å‰æ˜¾ç¤ºäº†ç¬¬8è¡Œçš„è¾“å‡º (\u0026ldquo;Fetching user order\u0026hellip;\u0026quot;)ã€‚è¿™æ˜¯å› ä¸º fetchUserOrder() åœ¨æ‰“å° \u0026ldquo;Large Latte\u0026rdquo; ä¹‹å‰ä¼šæœ‰å»¶è¿Ÿã€‚\nä¾‹å­: å®Œæˆæ—¶å‡ºç°é”™è¯¯ è¿è¡Œä¸‹é¢çš„ä¾‹å­ï¼Œçœ‹çœ‹æœªæ¥å¦‚ä½•å®Œæˆä¸€ä¸ªé”™è¯¯ã€‚ç¨åä½ å°†å­¦ä¹ å¦‚ä½•å¤„ç†é”™è¯¯ã€‚\nFuture\u0026lt;void\u0026gt; fetchUserOrder() { // Imagine that this function is fetching user info but encounters a bug  return Future.delayed(Duration(seconds: 2), () =\u0026gt; throw Exception(\u0026#39;Logout failed: user ID is invalid\u0026#39;)); } void main() { fetchUserOrder(); print(\u0026#39;Fetching user order...\u0026#39;); } åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒfetchUserOrder() å®Œæˆæ—¶å‡ºç°é”™è¯¯ï¼Œè¡¨æ˜ç”¨æˆ·IDæ— æ•ˆã€‚\nä½ å·²ç»å­¦ä¹ äº† future å’Œå®ƒä»¬å¦‚ä½•å®Œæˆï¼Œä½†ä½ å¦‚ä½•ä½¿ç”¨å¼‚æ­¥å‡½æ•°çš„ç»“æœå‘¢ï¼Ÿåœ¨ä¸‹ä¸€èŠ‚ä¸­ï¼Œä½ å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ async å’Œ await å…³é”®å­—æ¥è·å–ç»“æœã€‚\nå¿«é€Ÿå›é¡¾:\n ä¸€ä¸ª Future\u0026lt;T\u0026gt; å®ä¾‹ä¼šäº§ç”Ÿä¸€ä¸ª T ç±»å‹çš„å€¼ã€‚ å¦‚æœä¸€ä¸ª future æ²¡æœ‰äº§ç”Ÿä¸€ä¸ªå¯ç”¨çš„å€¼ï¼Œé‚£ä¹ˆ future çš„ç±»å‹æ˜¯ Future\u0026lt;void\u0026gt;ã€‚ ä¸€ä¸ª future å¯ä»¥å¤„äºä¸¤ç§çŠ¶æ€ä¹‹ä¸€ï¼šæœªå®Œæˆæˆ–å®Œæˆã€‚ å½“ä½ è°ƒç”¨ä¸€ä¸ªè¿”å› future çš„å‡½æ•°æ—¶ï¼Œå‡½æ•°ä¼šæŠŠè¦åšçš„å·¥ä½œæ’é˜Ÿï¼Œå¹¶è¿”å›ä¸€ä¸ªæœªå®Œæˆçš„ futureã€‚ å½“ä¸€ä¸ª future çš„æ“ä½œå®Œæˆæ—¶ï¼Œfuture ä»¥ä¸€ä¸ªå€¼æˆ–ä»¥ä¸€ä¸ªé”™è¯¯å®Œæˆã€‚  å…³é”®æœ¯è¯­:\n Future: Dart Future ç±»ã€‚ futureï¼šDart Future ç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚  ä½¿ç”¨ futureï¼šasync å’Œ await async å’Œ await å…³é”®å­—æä¾›äº†ä¸€ç§å£°æ˜å¼çš„æ–¹å¼æ¥å®šä¹‰å¼‚æ­¥å‡½æ•°å¹¶ä½¿ç”¨å®ƒä»¬çš„ç»“æœã€‚åœ¨ä½¿ç”¨ async å’Œ await æ—¶ï¼Œè¯·è®°ä½ä»¥ä¸‹ä¸¤ä¸ªåŸºæœ¬å‡†åˆ™ã€‚\n è¦å®šä¹‰ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œè¯·åœ¨å‡½æ•°ä¸»ä½“å‰æ·»åŠ  asyncã€‚ await å…³é”®å­—åªèƒ½åœ¨ async å‡½æ•°ä¸­ä½¿ç”¨ã€‚  ä¸‹é¢æ˜¯ä¸€ä¸ªå°† main() ä»åŒæ­¥å‡½æ•°è½¬æ¢ä¸ºå¼‚æ­¥å‡½æ•°çš„ä¾‹å­ã€‚\né¦–å…ˆï¼Œåœ¨å‡½æ•°ä½“å‰æ·»åŠ  async å…³é”®å­—:\nvoid main() async { Â·Â·Â· } å¦‚æœå‡½æ•°æœ‰å£°æ˜çš„è¿”å›ç±»å‹ï¼Œé‚£ä¹ˆæ›´æ–°ç±»å‹ä¸º Future\u0026lt;T\u0026gt;ï¼Œå…¶ä¸­ T æ˜¯å‡½æ•°è¿”å›çš„å€¼çš„ç±»å‹ã€‚å¦‚æœå‡½æ•°æ²¡æœ‰æ˜ç¡®è¿”å›å€¼ï¼Œé‚£ä¹ˆè¿”å›ç±»å‹ä¸º Future\u0026lt;void\u0026gt;ã€‚\nFuture\u0026lt;void\u0026gt; main() async { Â·Â·Â· } ç°åœ¨ä½ å·²ç»æœ‰äº†ä¸€ä¸ª async å‡½æ•°ï¼Œä½ å¯ä»¥ä½¿ç”¨ await å…³é”®å­—æ¥ç­‰å¾…ä¸€ä¸ª future çš„å®Œæˆ:\nprint(await createOrderMessage()); æ­£å¦‚ä¸‹é¢ä¸¤ä¸ªä¾‹å­æ‰€æ˜¾ç¤ºçš„ï¼Œasync å’Œa wait å…³é”®å­—å¯¼è‡´å¼‚æ­¥ä»£ç çœ‹èµ·æ¥å¾ˆåƒåŒæ­¥ä»£ç ã€‚å”¯ä¸€çš„åŒºåˆ«åœ¨å¼‚æ­¥ç¤ºä¾‹ä¸­çªå‡ºæ˜¾ç¤ºï¼Œå¦‚æœä½ çš„çª—å£è¶³å¤Ÿå®½ï¼Œå®ƒå°±åœ¨åŒæ­¥ç¤ºä¾‹çš„å³è¾¹ã€‚\nç¤ºä¾‹ï¼šåŒæ­¥å‡½æ•°\nString createOrderMessage() { var order = fetchUserOrder(); return \u0026#39;Your order is: $order\u0026#39;; } Future\u0026lt;String\u0026gt; fetchUserOrder() =\u0026gt; // Imagine that this function is  // more complex and slow.  Future.delayed( Duration(seconds: 2), () =\u0026gt; \u0026#39;Large Latte\u0026#39;, ); void main() { print(\u0026#39;Fetching user order...\u0026#39;); print(createOrderMessage()); } Fetching user order... Your order is: Instance of _Future\u0026lt;String\u0026gt; ä¾‹å­ï¼šå¼‚æ­¥å‡½æ•°\nFuture\u0026lt;String\u0026gt; createOrderMessage() async { var order = await fetchUserOrder(); return \u0026#39;Your order is: $order\u0026#39;; } Future\u0026lt;String\u0026gt; fetchUserOrder() =\u0026gt; // Imagine that this function is  // more complex and slow.  Future.delayed( Duration(seconds: 2), () =\u0026gt; \u0026#39;Large Latte\u0026#39;, ); Future\u0026lt;void\u0026gt; main() async { print(\u0026#39;Fetching user order...\u0026#39;); print(await createOrderMessage()); } Fetching user order... Your order is: Large Latte å¼‚æ­¥ç¤ºä¾‹åœ¨ä¸‰ä¸ªæ–¹é¢æœ‰æ‰€ä¸åŒã€‚\n createOrderMessage() çš„è¿”å›ç±»å‹ä» String å˜ä¸º Future\u0026lt;String\u0026gt;ã€‚ async å…³é”®å­—å‡ºç°åœ¨ createOrderMessage() å’Œ main() çš„å‡½æ•°ä½“ä¹‹å‰ã€‚ await å…³é”®å­—å‡ºç°åœ¨è°ƒç”¨å¼‚æ­¥å‡½æ•° fetchUserOrder() å’Œ createOrderMessage() ä¹‹å‰ã€‚  å…³é”®æœ¯è¯­:\n async: ä½ å¯ä»¥åœ¨ä¸€ä¸ªå‡½æ•°çš„ä¸»ä½“å‰ä½¿ç”¨ async å…³é”®å­—æ¥æ ‡è®°å®ƒä¸ºå¼‚æ­¥å‡½æ•°ã€‚ async å‡½æ•°: async å‡½æ•°æ˜¯ä¸€ä¸ªæ ‡æœ‰ async å…³é”®å­—çš„å‡½æ•°ã€‚ awaitï¼šå¯ä»¥ä½¿ç”¨ await å…³é”®å­—æ¥è·å–å¼‚æ­¥è¡¨è¾¾å¼çš„å®Œæˆç»“æœã€‚await å…³é”®å­—åªåœ¨ async å‡½æ•°ä¸­èµ·ä½œç”¨ã€‚  ä½¿ç”¨ async å’Œ await çš„æ‰§è¡Œæµç¨‹ ä¸€ä¸ªå¼‚æ­¥å‡½æ•°åœ¨ç¬¬ä¸€ä¸ª await å…³é”®å­—ä¹‹å‰æ˜¯åŒæ­¥è¿è¡Œçš„ã€‚è¿™æ„å‘³ç€åœ¨ä¸€ä¸ª async å‡½æ•°ä½“ä¸­ï¼Œç¬¬ä¸€ä¸ª await å…³é”®å­—ä¹‹å‰çš„æ‰€æœ‰åŒæ­¥ä»£ç éƒ½ä¼šç«‹å³æ‰§è¡Œã€‚\nç‰ˆæœ¬è¯´æ˜ï¼šåœ¨ Dart 2.0 ä¹‹å‰ï¼Œä¸€ä¸ªå¼‚æ­¥å‡½æ•°ç«‹å³è¿”å›ï¼Œè€Œä¸ä¼šåœ¨å¼‚æ­¥å‡½æ•°ä½“ä¸­æ‰§è¡Œä»»ä½•ä»£ç ã€‚\nä¾‹å­ï¼šåœ¨å¼‚æ­¥å‡½æ•°å†…æ‰§è¡Œã€‚åœ¨å¼‚æ­¥å‡½æ•°ä¸­æ‰§è¡Œ è¿è¡Œä¸‹é¢çš„ä¾‹å­ï¼Œçœ‹çœ‹å¦‚ä½•åœ¨å¼‚æ­¥å‡½æ•°ä½“ä¸­æ‰§è¡Œã€‚ä½ è®¤ä¸ºè¾“å‡ºä¼šæ˜¯ä»€ä¹ˆï¼Ÿ\nFuture\u0026lt;void\u0026gt; printOrderMessage() async { print(\u0026#39;Awaiting user order...\u0026#39;); var order = await fetchUserOrder(); print(\u0026#39;Your order is: $order\u0026#39;); } Future\u0026lt;String\u0026gt; fetchUserOrder() { // Imagine that this function is more complex and slow.  return Future.delayed(Duration(seconds: 4), () =\u0026gt; \u0026#39;Large Latte\u0026#39;); } Future\u0026lt;void\u0026gt; main() async { countSeconds(4); await printOrderMessage(); } // You can ignore this function - it\u0026#39;s here to visualize delay time in this example. void countSeconds(int s) { for (var i = 1; i \u0026lt;= s; i++) { Future.delayed(Duration(seconds: i), () =\u0026gt; print(i)); } } è¿è¡Œä¸Šä¾‹ä¸­çš„ä»£ç åï¼Œå°è¯•å°†ç¬¬2è¡Œå’Œç¬¬3è¡Œåè¿‡æ¥ã€‚\nvar order = await fetchUserOrder(); print(\u0026#39;Awaiting user order...\u0026#39;); æ³¨æ„åˆ°è¾“å‡ºçš„æ—¶é—´å‘ç”Ÿäº†å˜åŒ–ï¼Œç°åœ¨ print('Awaiting user order') å‡ºç°åœ¨ printOrderMessage() ä¸­ç¬¬ä¸€ä¸ª await å…³é”®å­—ä¹‹åã€‚\nç»ƒä¹ : ç»ƒä¹ ä½¿ç”¨ async å’Œ await ä¸‹é¢çš„ç»ƒä¹ æ˜¯ä¸€ä¸ªå¤±è´¥çš„å•å…ƒæµ‹è¯•ï¼Œå…¶ä¸­åŒ…å«éƒ¨åˆ†å®Œæˆçš„ä»£ç ç‰‡æ®µã€‚ä½ çš„ä»»åŠ¡æ˜¯é€šè¿‡ç¼–å†™ä»£ç ä½¿æµ‹è¯•é€šè¿‡æ¥å®Œæˆç»ƒä¹ ã€‚ä½ ä¸éœ€è¦å®ç° main()ã€‚\nä¸ºäº†æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œï¼Œè°ƒç”¨ä»¥ä¸‹å‡½æ•°ï¼Œè¿™äº›å‡½æ•°æ˜¯ä¸ºä½ æä¾›çš„ã€‚\n   å‡½æ•° ç±»å‹ç­¾å æè¿°     fetchRole() FuturefetchRole() è·å–ç”¨æˆ·è§’è‰²çš„ç®€çŸ­æè¿°ã€‚   fetchLoginAmount() FuturefetchLoginAmount() è·å–ç”¨æˆ·çš„ç™»å½•æ¬¡æ•°ã€‚    ç¬¬1éƒ¨åˆ†ï¼šreportUserRole()\nä¸º reportUserRole() å‡½æ•°æ·»åŠ ä»£ç ï¼Œä½¿å…¶æ‰§è¡Œä»¥ä¸‹æ“ä½œã€‚\n è¿”å›ä¸€ä¸ªä»¥ä¸‹åˆ—å­—ç¬¦ä¸²å®Œæˆçš„ futureï¼š \u0026quot;User role: \u0026lt;user role\u0026gt;\u0026quot;ã€‚  æ³¨æ„ï¼šä½ å¿…é¡»ä½¿ç”¨ fetchRole() è¿”å›çš„å®é™…å€¼ï¼›å¤åˆ¶å’Œç²˜è´´ç¤ºä¾‹è¿”å›å€¼ä¸ä¼šä½¿æµ‹è¯•é€šè¿‡ã€‚ ç¤ºä¾‹è¿”å›å€¼: \u0026ldquo;User role: tester\u0026rdquo;   é€šè¿‡è°ƒç”¨æä¾›çš„å‡½æ•° fetchRole() è·å–ç”¨æˆ·è§’è‰²ã€‚  ç¬¬äºŒéƒ¨åˆ†ï¼šreportLogins()\nå®ç°ä¸€ä¸ªå¼‚æ­¥å‡½æ•° reportLogins()ï¼Œä½¿å…¶æ‰§è¡Œä»¥ä¸‹æ“ä½œã€‚\n è¿”å›å­—ç¬¦ä¸² \u0026ldquo;Total number of logins: \u0026lt;# of logins\u0026gt;\u0026quot;ã€‚  æ³¨æ„ï¼šä½ å¿…é¡»ä½¿ç”¨ fetchLoginAmount() è¿”å›çš„å®é™…å€¼ï¼›å¤åˆ¶å’Œç²˜è´´ç¤ºä¾‹è¿”å›å€¼ä¸ä¼šä½¿æµ‹è¯•é€šè¿‡ã€‚ reportLogins() çš„è¿”å›å€¼ç¤ºä¾‹: \u0026quot;Total number of logins: 57\u0026quot;ã€‚   é€šè¿‡è°ƒç”¨æä¾›çš„å‡½æ•° fetchLoginAmount() æ¥è·å–ç™»å½•æ¬¡æ•°ã€‚  Future\u0026lt;String\u0026gt; reportUserRole() async { var username = await fetchRole(); return \u0026#39;User role: $username\u0026#39;; } Future\u0026lt;String\u0026gt; reportLogins() async { var logins = await fetchLoginAmount(); return \u0026#39;Total number of logins: $logins\u0026#39;; } æ³¨æ„ï¼šå¦‚æœä½ çš„ä»£ç é€šè¿‡äº†æµ‹è¯•ï¼Œä½ å¯ä»¥å¿½ç•¥ä¿¡æ¯çº§çš„æ¶ˆæ¯ã€‚\nå¤„ç†é”™è¯¯ è¦å¤„ç† async å‡½æ•°ä¸­çš„é”™è¯¯ï¼Œä½¿ç”¨ try-catch:\ntry { var order = await fetchUserOrder(); print(\u0026#39;Awaiting user order...\u0026#39;); } catch (err) { print(\u0026#39;Caught error: $err\u0026#39;); } åœ¨ä¸€ä¸ª async å‡½æ•°ä¸­ï¼Œä½ å¯ä»¥åƒåœ¨åŒæ­¥ä»£ç ä¸­ä¸€æ ·ç¼–å†™ try-catch å­å¥ã€‚\nä¾‹å­ï¼šasync å’Œ await çš„ try-catch å­å¥ è¿è¡Œä¸‹é¢çš„ä¾‹å­ï¼Œçœ‹çœ‹å¦‚ä½•å¤„ç†ä¸€ä¸ªå¼‚æ­¥å‡½æ•°çš„é”™è¯¯ã€‚ä½ è®¤ä¸ºè¾“å‡ºä¼šæ˜¯ä»€ä¹ˆï¼Ÿ\nFuture\u0026lt;void\u0026gt; printOrderMessage() async { try { var order = await fetchUserOrder(); print(\u0026#39;Awaiting user order...\u0026#39;); print(order); } catch (err) { print(\u0026#39;Caught error: $err\u0026#39;); } } Future\u0026lt;String\u0026gt; fetchUserOrder() { // Imagine that this function is more complex.  var str = Future.delayed( Duration(seconds: 4), () =\u0026gt; throw \u0026#39;Cannot locate user order\u0026#39;); return str; } Future\u0026lt;void\u0026gt; main() async { await printOrderMessage(); } ç»ƒä¹ : ç»ƒä¹ å¤„ç†é”™è¯¯ ä¸‹é¢çš„ç»ƒä¹ æä¾›äº†ä½¿ç”¨å¼‚æ­¥ä»£ç å¤„ç†é”™è¯¯çš„ç»ƒä¹ ï¼Œä½¿ç”¨ä¸Šä¸€èŠ‚ä¸­æè¿°çš„æ–¹æ³•ã€‚ä¸ºäº†æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œï¼Œä½ çš„ä»£ç å°†è°ƒç”¨ä»¥ä¸‹å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¸ºä½ æä¾›ã€‚\n| å‡½æ•° | ç±»å‹ç­¾å | æè¿° | | fetchNewUsername() | FuturefetchNewUsername() |\tè¿”å›ä½ å¯ä»¥ç”¨æ¥æ›¿æ¢æ—§ç”¨æˆ·åçš„æ–°ç”¨æˆ·åã€‚|\nä½¿ç”¨ async å’Œ await æ¥å®ç°ä¸€ä¸ªå¼‚æ­¥çš„ changeUsername() å‡½æ•°ï¼Œè¯¥å‡½æ•°æ‰§è¡Œä»¥ä¸‹æ“ä½œã€‚\n è°ƒç”¨æä¾›çš„å¼‚æ­¥å‡½æ•° fetchNewUsername() å¹¶è¿”å›å…¶ç»“æœã€‚  changeUsername() çš„è¿”å›å€¼ç¤ºä¾‹: \u0026ldquo;jane_smith_92\u0026rdquo;   æ•è·ä»»ä½•å‘ç”Ÿçš„é”™è¯¯å¹¶è¿”å›é”™è¯¯çš„å­—ç¬¦ä¸²å€¼ã€‚  ä½ å¯ä»¥ä½¿ç”¨ toString() æ–¹æ³•å¯¹ Exceptions å’ŒErrors è¿›è¡Œå­—ç¬¦ä¸²åŒ–ã€‚    Future\u0026lt;String\u0026gt; changeUsername () async { try { return await fetchNewUsername(); } catch (err) { return err.toString(); } } ç»ƒä¹ : æŠŠæ‰€æœ‰çš„ä¸œè¥¿æ”¾åœ¨ä¸€èµ· ç°åœ¨æ˜¯æ—¶å€™åœ¨æœ€åä¸€ä¸ªç»ƒä¹ ä¸­ç»ƒä¹ æ‰€å­¦çš„çŸ¥è¯†äº†ã€‚ä¸ºäº†æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œï¼Œæœ¬ç»ƒä¹ æä¾›äº†å¼‚æ­¥å‡½æ•° fetchUsername() å’Œ logoutUser():\n| å‡½æ•° | ç±»å‹ç­¾å | æè¿° | | fetchUsername() |\tFuturefetchUsername() | è¿”å›ä¸å½“å‰ç”¨æˆ·ç›¸å…³è”çš„åç§°ã€‚ | | logoutUser()\t| FuturelogoutUser()\t| æ‰§è¡Œå½“å‰ç”¨æˆ·çš„æ³¨é”€ï¼Œå¹¶è¿”å›è¢«æ³¨é”€çš„ç”¨æˆ·åã€‚ |\nç¼–å†™ä»¥ä¸‹å†…å®¹ã€‚\nç¬¬ä¸€éƒ¨åˆ†ï¼šaddHello()\n ç¼–å†™ä¸€ä¸ªå‡½æ•° addHello()ï¼Œå®ƒæ¥å—ä¸€ä¸ªå•ä¸€çš„ String å‚æ•°ã€‚ addHello() è¿”å›å®ƒçš„ String å‚æ•°ï¼Œå‰é¢åŠ  \u0026lsquo;Hello\u0026rsquo;ã€‚ ä¾‹å¦‚ï¼šaddHello('Jon') è¿”å› \u0026lsquo;Hello Jon\u0026rsquo;ã€‚  ç¬¬äºŒéƒ¨åˆ†ï¼šgreetUser()\n ç¼–å†™ä¸€ä¸ªä¸æ¥å—å‚æ•°çš„å‡½æ•° greetUser()ã€‚ ä¸ºäº†å¾—åˆ°ç”¨æˆ·åï¼ŒgreetUser() è°ƒç”¨æä¾›çš„å¼‚æ­¥å‡½æ•° fetchUsername()ã€‚ greetUser() é€šè¿‡è°ƒç”¨ addHello() ä¸ºç”¨æˆ·åˆ›å»ºä¸€ä¸ªé—®å€™è¯­ï¼Œä¼ é€’ç”¨æˆ·åï¼Œå¹¶è¿”å›ç»“æœã€‚ ä¾‹å­: å¦‚æœ fetchUsername() è¿”å› \u0026lsquo;Jenny\u0026rsquo;, é‚£ä¹ˆ greetUser() è¿”å› \u0026lsquo;Hello Jenny\u0026rsquo;.  ç¬¬ä¸‰éƒ¨åˆ†ï¼šsayGoodbye()\n  ç¼–å†™ä¸€ä¸ªå‡½æ•° sayGoodbye()ï¼Œå®ƒçš„åŠŸèƒ½å¦‚ä¸‹ã€‚\n ä¸æ¥å—ä»»ä½•å‚æ•° æ•è·ä»»ä½•é”™è¯¯ã€‚ è°ƒç”¨æ‰€æä¾›çš„å¼‚æ­¥å‡½æ•° logoutUser().    å¦‚æœ logoutUser() å¤±è´¥ï¼ŒsayGoodbye() è¿”å›ä»»ä½•ä½ å–œæ¬¢çš„å­—ç¬¦ä¸²ã€‚\n  å¦‚æœ logoutUser() æˆåŠŸï¼ŒsayGoodbye() è¿”å›å­—ç¬¦ä¸² '\u0026lt;result\u0026gt; Thanks, see you next time'ï¼Œå…¶ä¸­ \u0026lt;result\u0026gt; æ˜¯è°ƒç”¨ logoutUser() è¿”å›çš„å­—ç¬¦ä¸²å€¼ã€‚\n  String addHello(user) =\u0026gt; \u0026#39;Hello $user\u0026#39;; Future\u0026lt;String\u0026gt; greetUser() async { var username = await fetchUsername(); return addHello(username); } Future\u0026lt;String\u0026gt; sayGoodbye() async { try { var result = await logoutUser(); return \u0026#39;$resultThanks, see you next time\u0026#39;; } catch (e) { return \u0026#39;Failed to logout user: $e\u0026#39;; } } ä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆï¼Ÿ æ­å–œä½ ï¼Œä½ å·²ç»å®Œæˆäº† codelab çš„å­¦ä¹ ï¼å¦‚æœä½ è¿˜æƒ³äº†è§£æ›´å¤šï¼Œè¿™é‡Œæœ‰ä¸€äº›ä¸‹ä¸€æ­¥çš„å»ºè®®ã€‚\n ç©ç© DartPadã€‚ å°è¯•å¦ä¸€ä¸ª codelabã€‚ å­¦ä¹ æ›´å¤šå…³äº futures å’Œå¼‚æ­¥çš„çŸ¥è¯†ã€‚  Streams tutorial: å­¦ä¹ å¦‚ä½•ä½¿ç”¨å¼‚æ­¥äº‹ä»¶çš„åºåˆ—ã€‚ æ¥è‡ª Google çš„ Dartè§†é¢‘: è§‚çœ‹ä¸€ä¸ªæˆ–å¤šä¸ªå…³äºå¼‚æ­¥ç¼–ç çš„è§†é¢‘ã€‚æˆ–è€…ï¼Œå¦‚æœä½ å–œæ¬¢ï¼Œé˜…è¯»åŸºäºè¿™äº›è§†é¢‘çš„æ–‡ç« ã€‚(ä»éš”ç¦»å’Œäº‹ä»¶å¾ªç¯å¼€å§‹ã€‚)   è·å– Dart SDKã€‚  å¦‚æœä½ å¯¹ä½¿ç”¨åµŒå…¥å¼ DartPads æ„Ÿå…´è¶£ï¼Œå°±åƒè¿™ä¸ª codelab ä¸€æ ·ï¼Œè¯·çœ‹æ•™ç¨‹ä¸­ä½¿ç”¨ DartPad çš„æœ€ä½³å®è·µã€‚\n","permalink":"https://ohmyweekly.github.io/notes/futures-async-await/","tags":["async","futures","await","dart"],"title":"å¼‚æ­¥ç¼–ç¨‹ï¼šfuturesã€asyncã€awaitã€‚"},{"categories":["programming"],"contents":"ä»‹ç» Flutter æ˜¯ Google çš„ UI å·¥å…·åŒ…ï¼Œç”¨äºä»å•ä¸€ä»£ç åº“ä¸­ä¸ºæ‰‹æœºã€ç½‘é¡µå’Œæ¡Œé¢æ„å»ºæ¼‚äº®çš„ã€åŸç”Ÿç¼–è¯‘çš„åº”ç”¨ç¨‹åºã€‚Flutter å¯ä»¥ä¸ç°æœ‰çš„ä»£ç ä¸€èµ·å·¥ä½œï¼Œè¢«ä¸–ç•Œå„åœ°çš„å¼€å‘è€…å’Œç»„ç»‡ä½¿ç”¨ï¼Œå¹¶ä¸”æ˜¯å…è´¹å’Œå¼€æºçš„ã€‚\nåœ¨è¿™ä¸ªä»£ç å®éªŒå®¤ä¸­ï¼Œä½ å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„æ‰‹æœº Flutter åº”ç”¨ã€‚å¦‚æœä½ ç†Ÿæ‚‰é¢å‘å¯¹è±¡çš„ä»£ç å’ŒåŸºæœ¬çš„ç¼–ç¨‹æ¦‚å¿µ-å¦‚å˜é‡ã€å¾ªç¯å’Œæ¡ä»¶, é‚£ä¹ˆä½ å°±å¯ä»¥å®Œæˆè¿™ä¸ª codelabã€‚ä½ ä¸éœ€è¦ä»¥å‰æœ‰ Dartã€æ‰‹æœºæˆ– Web ç¼–ç¨‹çš„ç»éªŒã€‚\nä½ å°†åœ¨ç¬¬1éƒ¨åˆ†å­¦åˆ°ä»€ä¹ˆ  å¦‚ä½•ç¼–å†™ä¸€æ¬¾åœ¨ iOSã€Android å’Œ Web ä¸Šçœ‹èµ·æ¥å¾ˆè‡ªç„¶çš„ Flutter åº”ç”¨ï¼Ÿ Flutter åº”ç”¨ç¨‹åºçš„åŸºæœ¬ç»“æ„ã€‚ å¯»æ‰¾å’Œä½¿ç”¨åŒ…æ¥æ‰©å±•åŠŸèƒ½ã€‚ ä½¿ç”¨çƒ­é‡è£…æ¥åŠ å¿«å¼€å‘å‘¨æœŸã€‚ å¦‚ä½•å®ç°ä¸€ä¸ªæœ‰çŠ¶æ€çš„å°ç»„ä»¶ã€‚ å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ— é™çš„ã€æ‡’åŠ è½½çš„åˆ—è¡¨ã€‚  åœ¨è¿™ä¸ª codelab çš„ç¬¬2éƒ¨åˆ†ä¸­ï¼Œä½ å°†æ·»åŠ äº¤äº’æ€§ï¼Œä¿®æ”¹åº”ç”¨ç¨‹åºçš„ä¸»é¢˜ï¼Œå¹¶æ·»åŠ å¯¼èˆªåˆ°æ–°é¡µé¢çš„èƒ½åŠ›(åœ¨ Flutter ä¸­ç§°ä¸ºè·¯ç”±)ã€‚\nä½ å°†åœ¨ç¬¬1éƒ¨åˆ†ä¸­æ„å»ºä»€ä¹ˆ ä½ å°†å®ç°ä¸€ä¸ªç§»åŠ¨åº”ç”¨ï¼Œä¸ºä¸€å®¶åˆ›ä¸šå…¬å¸ç”Ÿæˆå»ºè®®çš„åå­—ã€‚ç”¨æˆ·å¯ä»¥é€‰æ‹©å’Œå–æ¶ˆé€‰æ‹©åå­—ï¼Œä¿å­˜æœ€å¥½çš„åå­—ã€‚ä»£ç ä¸€æ¬¡æ‡’æƒ°åœ°ç”Ÿæˆ10ä¸ªåå­—ã€‚éšç€ç”¨æˆ·çš„æ»šåŠ¨ï¼Œä¼šç”Ÿæˆæ›´å¤šçš„åå­—ã€‚ç”¨æˆ·å¯ä»¥æ»šåŠ¨çš„èŒƒå›´æ²¡æœ‰é™åˆ¶ã€‚\nä¸‹é¢çš„ GIF åŠ¨ç”»æ˜¾ç¤ºäº†åº”ç”¨ç¨‹åºåœ¨å®Œæˆéƒ¨åˆ†æ—¶çš„å·¥ä½œæƒ…å†µã€‚\nè®¾ç½®ä½ çš„ Flutter ç¯å¢ƒ ä½ éœ€è¦ä¸¤ä¸ªè½¯ä»¶æ¥å®Œæˆè¿™ä¸ªå®éªŒå®¤-Flutter SDKå’Œä¸€ä¸ªç¼–è¾‘å™¨ã€‚(codelab å‡è®¾ä½ ä½¿ç”¨ Android Studioï¼Œä½†ä½ å¯ä»¥ä½¿ç”¨ä½ çš„é¦–é€‰ç¼–è¾‘å™¨ã€‚)\nä½ å¯ä»¥é€šè¿‡ä½¿ç”¨ä»¥ä¸‹ä»»ä½•è®¾å¤‡æ¥è¿è¡Œ codelabã€‚\n ä¸€ä¸ªç‰©ç†çš„ Android æˆ– iOS è®¾å¤‡è¿æ¥åˆ°ä½ çš„è®¡ç®—æœºå¹¶è®¾ç½®ä¸ºå¼€å‘è€…æ¨¡å¼ã€‚ iOS æ¨¡æ‹Ÿå™¨(éœ€è¦å®‰è£… Xcode å·¥å…·) å®‰å“æ¨¡æ‹Ÿå™¨(éœ€è¦åœ¨ Android Studio ä¸­è¿›è¡Œè®¾ç½®) æµè§ˆå™¨(è°ƒè¯•æ—¶éœ€è¦ä½¿ç”¨ Chrome æµè§ˆå™¨)  å¦‚æœä½ æƒ³ç¼–è¯‘ä½ çš„åº”ç”¨ç¨‹åºä»¥åœ¨ web ä¸Šè¿è¡Œï¼Œä½ å¿…é¡»å¯ç”¨æ­¤åŠŸèƒ½ï¼ˆç›®å‰å¤„äºæµ‹è¯•é˜¶æ®µï¼‰ã€‚è¦å¯ç”¨ web æ”¯æŒï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹è¯´æ˜ã€‚\nflutter channel beta flutter upgrade flutter config --enable-web ä½ åªéœ€è¦è¿è¡Œä¸€æ¬¡ config å‘½ä»¤ã€‚å¯ç”¨ Web æ”¯æŒåï¼Œä½ åˆ›å»ºçš„æ¯ä¸ª Flutter åº”ç”¨ä¹Ÿä¼šä¸º Web ç¼–è¯‘ã€‚åœ¨ä½ çš„ IDE çš„è®¾å¤‡ä¸‹æ‹‰èœå•ä¸‹é¢ï¼Œæˆ–è€…åœ¨å‘½ä»¤è¡Œä½¿ç”¨ flutter devicesï¼Œä½ ç°åœ¨åº”è¯¥çœ‹åˆ° Chrome å’Œ Web æœåŠ¡å™¨è¢«åˆ—å‡ºã€‚Chrome è®¾å¤‡ä¼šè‡ªåŠ¨å¯åŠ¨ Chromeã€‚Web æœåŠ¡å™¨ä¼šå¯åŠ¨ä¸€ä¸ªæ‰˜ç®¡åº”ç”¨ç¨‹åºçš„æœåŠ¡å™¨ï¼Œè¿™æ ·ä½ å°±å¯ä»¥ä»ä»»ä½•æµè§ˆå™¨åŠ è½½å®ƒã€‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨ Chrome è®¾å¤‡ï¼Œä»¥ä¾¿ä½ å¯ä»¥ä½¿ç”¨ DevToolsï¼Œè€Œå½“ä½ è¦åœ¨å…¶ä»–æµè§ˆå™¨ä¸Šè¿›è¡Œæµ‹è¯•æ—¶ä½¿ç”¨ Web æœåŠ¡å™¨ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…ä½¿ç”¨ Flutter æ„å»º Web åº”ç”¨ç¨‹åºå’Œåœ¨ Web ä¸Šç¼–å†™ä½ çš„ç¬¬ä¸€ä¸ª Flutter åº”ç”¨ç¨‹åºã€‚\nåˆ›å»º Flutter åº”ç”¨ç¨‹åºçš„å¯åŠ¨å™¨ é€šè¿‡ä½¿ç”¨åˆ›å»ºåº”ç”¨ç¨‹åºä¸­çš„è¯´æ˜æ¥åˆ›å»ºä¸€ä¸ªç®€å•çš„ã€æ¨¡æ¿åŒ–çš„ Flutter åº”ç”¨ç¨‹åºã€‚è¾“å…¥ startup_namer(è€Œä¸æ˜¯ flutter_app)ä½œä¸ºé¡¹ç›®åç§°ã€‚æ‚¨å°†ä¿®æ”¹å¯åŠ¨å™¨åº”ç”¨ç¨‹åºæ¥åˆ›å»ºå®Œæˆçš„åº”ç”¨ç¨‹åºã€‚\næç¤ºï¼šå¦‚æœä½ åœ¨ IDE ä¸­æ²¡æœ‰çœ‹åˆ°èƒ½å¤Ÿå¯åŠ¨ä¸€ä¸ªæ–°çš„ Flutter é¡¹ç›®ä½œä¸ºä¸€ä¸ªé€‰é¡¹ï¼Œé‚£ä¹ˆè¯·ç¡®ä¿ä½ å·²ç»å®‰è£…äº† Flutter å’Œ Dart çš„æ’ä»¶ã€‚\nä½ å°†ä¸»è¦ç¼–è¾‘ lib/main.dartï¼ŒDart çš„ä»£ç å°±åœ¨è¿™é‡Œã€‚\næ›¿æ¢ lib/main.dart çš„å†…å®¹ã€‚ åˆ é™¤ lib/main.dart ä¸­çš„æ‰€æœ‰ä»£ç ï¼Œå¹¶ç”¨ä¸‹é¢çš„ä»£ç æ›¿æ¢ï¼Œåœ¨å±å¹•ä¸­å¤®æ˜¾ç¤º \u0026ldquo;Hello World\u0026rdquo;ã€‚\nimport \u0026#39;package:flutter/material.dart\u0026#39;; void main() =\u0026gt; runApp(MyApp()); class MyApp extends StatelessWidget { @override Widget build(BuildContext context) { return MaterialApp( title: \u0026#39;Welcome to Flutter\u0026#39;, home: Scaffold( appBar: AppBar( title: const Text(\u0026#39;Welcome to Flutter\u0026#39;), ), body: const Center( child: const Text(\u0026#39;Hello World\u0026#39;), ), ), ); } } æç¤ºï¼šå½“æŠŠä»£ç ç²˜è´´åˆ°ä½ çš„åº”ç”¨ç¨‹åºä¸­æ—¶ï¼Œç¼©è¿›ä¼šå˜å¾—æ­ªæ–œã€‚ä½ å¯ä»¥ç”¨ä»¥ä¸‹ Flutter å·¥å…·æ¥è§£å†³ã€‚\n Android Studio/IntelliJ IDEA: å³é”®ç‚¹å‡» Dart ä»£ç ï¼Œé€‰æ‹©ç”¨ dartfmt é‡æ ¼å¼ä»£ç ã€‚ VS code: å³é”®ç‚¹å‡»å¹¶é€‰æ‹©æ ¼å¼åŒ–æ–‡æ¡£ã€‚ ç»ˆç«¯: è¿è¡Œ flutter format \u0026lt;æ–‡ä»¶å\u0026gt;ã€‚  è¿è¡Œåº”ç”¨ç¨‹åºã€‚æ‚¨åº”è¯¥çœ‹åˆ° Androidï¼ŒiOS æˆ– Web è¾“å‡ºï¼Œå–å†³äºæ‚¨çš„è®¾å¤‡ã€‚\nå®‰å“ç³»ç»Ÿ:\niOS:\nå°è´´å£«ï¼šç¬¬ä¸€æ¬¡åœ¨ç‰©ç†è®¾å¤‡ä¸Šè¿è¡Œæ—¶ï¼Œå¯èƒ½éœ€è¦ä¸€æ®µæ—¶é—´æ¥åŠ è½½ã€‚ä¹‹åï¼Œä½ å¯ä»¥ä½¿ç”¨çƒ­é‡è½½æ¥å¿«é€Ÿæ›´æ–°ã€‚åœ¨æ”¯æŒçš„ IDE ä¸­ï¼Œå¦‚æœåº”ç”¨æ­£åœ¨è¿è¡Œï¼ŒSave ä¹Ÿä¼šæ‰§è¡Œçƒ­é‡è½½ã€‚å½“ä½¿ç”¨ flutter run ç›´æ¥ä»æ§åˆ¶å°è¿è¡Œåº”ç”¨ç¨‹åºæ—¶ï¼Œè¾“å…¥ r æ¥æ‰§è¡Œçƒ­é‡è½½ã€‚\nè§‚å¯Ÿ:\n è¿™ä¸ªä¾‹å­åˆ›å»ºäº†ä¸€ä¸ª Material åº”ç”¨ã€‚Material æ˜¯ä¸€ç§è§†è§‰è®¾è®¡è¯­è¨€ï¼Œæ˜¯ç§»åŠ¨å’Œ Web çš„æ ‡å‡†ã€‚Flutter æä¾›äº†ä¸€å¥—ä¸°å¯Œçš„ Material éƒ¨ä»¶ã€‚ main æ–¹æ³•ä½¿ç”¨ç®­å¤´(=\u0026gt;)ç¬¦å·ã€‚å¯¹å•è¡Œå‡½æ•°æˆ–æ–¹æ³•ä½¿ç”¨ç®­å¤´ç¬¦å·ã€‚ åº”ç”¨ç¨‹åºæ‰©å±•äº† StatelessWidgetï¼Œè¿™ä½¿å¾—åº”ç”¨ç¨‹åºæœ¬èº«æˆä¸ºä¸€ä¸ªç»„ä»¶ã€‚åœ¨ Flutter ä¸­ï¼Œå‡ ä¹æ‰€æœ‰çš„ä¸œè¥¿éƒ½æ˜¯ç»„ä»¶ï¼ŒåŒ…æ‹¬å¯¹é½ã€å¡«å……å’Œå¸ƒå±€ã€‚ Scaffold ç»„ä»¶æ¥è‡ª Material åº“ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªé»˜è®¤çš„åº”ç”¨æ ã€ä¸€ä¸ªæ ‡é¢˜å’Œä¸€ä¸ª body å±æ€§ï¼Œå…¶ä¸­å­˜æ”¾ç€ä¸»å±å¹•çš„ç»„ä»¶æ ‘ã€‚ç»„ä»¶å­æ ‘å¯ä»¥ç›¸å½“å¤æ‚ã€‚ ç»„ä»¶çš„ä¸»è¦å·¥ä½œæ˜¯æä¾›ä¸€ä¸ª build æ–¹æ³•ï¼Œæè¿°å¦‚ä½•ç”¨å…¶ä»–ä½çº§ç»„ä»¶æ¥æ˜¾ç¤ºè¯¥ç»„ä»¶ã€‚ æœ¬ä¾‹çš„ä¸»ä½“ç”±åŒ…å« Text å­éƒ¨ä»¶çš„ Center éƒ¨ä»¶ç»„æˆã€‚Center ç»„ä»¶å°†å…¶ç»„ä»¶å­æ ‘å¯¹é½åˆ°å±å¹•çš„ä¸­å¿ƒã€‚  ä½¿ç”¨å¤–éƒ¨è½¯ä»¶åŒ… åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæ‚¨å°†å¼€å§‹ä½¿ç”¨ä¸€ä¸ªåä¸º english_words çš„å¼€æºåŒ…ï¼Œå®ƒåŒ…å«äº†å‡ åƒä¸ªæœ€å¸¸ç”¨çš„è‹±è¯­å•è¯ï¼Œè¿˜æœ‰ä¸€äº›å®ç”¨å‡½æ•°ã€‚\nä½ å¯ä»¥åœ¨ pub.dev æ‰¾åˆ° english_words åŒ…ï¼Œä»¥åŠè®¸å¤šå…¶ä»–å¼€æºåŒ…ã€‚\npubspec æ–‡ä»¶ç®¡ç†ç€ Flutter åº”ç”¨çš„èµ„äº§ã€‚åœ¨ pubspec.yaml ä¸­ï¼Œé™„åŠ  english_words: ^3.1.5(english_words 3.1.5 æˆ–æ›´é«˜)åˆ°ä¾èµ–åˆ—è¡¨ä¸­ã€‚\ndependencies:flutter:sdk:fluttercupertino_icons:^0.1.2english_words:^3.1.5 # add this lineåœ¨ Android Studio çš„ç¼–è¾‘å™¨è§†å›¾ä¸­æŸ¥çœ‹ pubspec æ—¶ï¼Œç‚¹å‡» Packages getã€‚è¿™å°†æŠŠåŒ…æ‹‰åˆ°ä½ çš„é¡¹ç›®ä¸­ã€‚ä½ åº”è¯¥åœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°ä»¥ä¸‹å†…å®¹ã€‚\nflutter packages get Running \u0026#34;flutter packages get\u0026#34; in startup_namer... Process finished with exit code 0 æ‰§è¡Œ Pub get ä¹Ÿä¼šè‡ªåŠ¨ç”Ÿæˆ \u0026ldquo;pubspec.lock\u0026rdquo; æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ‰€æœ‰æ‹‰å…¥é¡¹ç›®çš„åŒ…çš„åˆ—è¡¨å’Œå®ƒä»¬çš„ç‰ˆæœ¬å·ã€‚\nåœ¨ lib/main.dart ä¸­ï¼Œå¯¼å…¥æ–°åŒ…:\nimport \u0026#39;package:flutter/material.dart\u0026#39;; import \u0026#39;package:english_words/english_words.dart\u0026#39;; // Add this line. å½“ä½ è¾“å…¥æ—¶ï¼ŒAndroid Studio ä¼šç»™ä½ å»ºè®®å¯¼å…¥çš„åº“ã€‚ç„¶åï¼Œå®ƒå°†å¯¼å…¥çš„å­—ç¬¦ä¸²æ¸²æŸ“æˆç°è‰²ï¼Œè®©ä½ çŸ¥é“å¯¼å…¥çš„åº“æ˜¯æœªä½¿ç”¨çš„ï¼ˆåˆ°ç›®å‰ä¸ºæ­¢ï¼‰ã€‚\næ¥ä¸‹æ¥ï¼Œä½ å°†ä½¿ç”¨ english_words åŒ…æ¥ç”Ÿæˆæ–‡æœ¬ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ \u0026ldquo;Hello World\u0026rdquo;ã€‚\nåšä»¥ä¸‹ä¿®æ”¹ã€‚\nimport \u0026#39;package:flutter/material.dart\u0026#39;; import \u0026#39;package:english_words/english_words.dart\u0026#39;; void main() =\u0026gt; runApp(MyApp()); class MyApp extends StatelessWidget { @override Widget build(BuildContext context) { final wordPair = WordPair.random(); // Add this line.  return MaterialApp( title: \u0026#39;Welcome to Flutter\u0026#39;, home: Scaffold( appBar: AppBar( title: Text(\u0026#39;Welcome to Flutter\u0026#39;), ), body: Center( //child: Text(\u0026#39;Hello World\u0026#39;), // Replace this text...  child: Text(wordPair.asPascalCase), // With this text.  ), ), ); } } æç¤º: Pascal å¤§å°å†™(ä¹Ÿç§°ä¸ºä¸Šé©¼å½¢å¤§å°å†™)æ„å‘³ç€å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå•è¯ï¼ŒåŒ…æ‹¬ç¬¬ä¸€ä¸ªå•è¯ï¼Œéƒ½ä»¥å¤§å†™å­—æ¯å¼€å¤´ã€‚æ‰€ä»¥ï¼Œuppercamelcase å°±å˜æˆäº† UpperCamelCaseã€‚\nå¦‚æœåº”ç”¨ç¨‹åºæ­£åœ¨è¿è¡Œï¼Œçƒ­é‡è½½æ¥æ›´æ–°æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºã€‚(åœ¨å‘½ä»¤è¡Œä¸­ï¼Œä½ å¯ä»¥è¾“å…¥ r æ¥çƒ­é‡è½½ã€‚)æ¯æ¬¡ç‚¹å‡»çƒ­é‡è½½æˆ–ä¿å­˜é¡¹ç›®æ—¶ï¼Œä½ åº”è¯¥ä¼šåœ¨è¿è¡Œä¸­çš„åº”ç”¨ç¨‹åºä¸­çœ‹åˆ°ä¸€ä¸ªä¸åŒçš„å•è¯å¯¹ï¼Œéšæœºé€‰æ‹©ã€‚è¿™æ˜¯å› ä¸ºå•è¯å¯¹æ˜¯åœ¨ build æ–¹æ³•é‡Œé¢ç”Ÿæˆçš„ï¼Œæ¯æ¬¡ MaterialApp éœ€è¦æ¸²æŸ“æ—¶ï¼Œæˆ–è€…åœ¨ Flutter Inspector ä¸­åˆ‡æ¢ Platform æ—¶ï¼Œéƒ½ä¼šè¿è¡Œè¯¥æ–¹æ³•ã€‚\nAndroid:\niOS:\næœ‰é—®é¢˜ï¼Ÿ å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºæ²¡æœ‰æ­£ç¡®è¿è¡Œï¼Œè¯·æŸ¥æ‰¾é”™åˆ«å­—ã€‚å¦‚æœéœ€è¦ï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹é“¾æ¥ä¸­çš„ä»£ç æ¥æ¢å¤æ­£å¸¸ã€‚\n pubspec.yaml lib/main.dart  æ·»åŠ ä¸€ä¸ªæœ‰çŠ¶æ€çš„ç»„ä»¶ æ— çŠ¶æ€ç»„ä»¶æ˜¯ä¸å¯æ”¹å˜çš„ï¼Œè¿™æ„å‘³ç€å®ƒä»¬çš„å±æ€§ä¸èƒ½æ”¹å˜-æ‰€æœ‰å€¼éƒ½æ˜¯æœ€ç»ˆå€¼ã€‚\næœ‰çŠ¶æ€ç»„ä»¶ç»´æŠ¤çš„çŠ¶æ€å¯èƒ½åœ¨ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå†…å‘ç”Ÿå˜åŒ–ã€‚å®ç°ä¸€ä¸ªæœ‰çŠ¶æ€çš„ç»„ä»¶è‡³å°‘éœ€è¦ä¸¤ä¸ªç±»ã€‚1) ä¸€ä¸ª StatefulWidgetï¼Œå®ƒå¯ä»¥åˆ›å»ºä¸€ä¸ª State ç±»çš„å®ä¾‹ã€‚StatefulWidget å¯¹è±¡æœ¬èº«æ˜¯ä¸å¯å˜çš„ï¼Œå¯ä»¥è¢«ä¸¢å¼ƒå’Œå†ç”Ÿï¼Œä½† State å¯¹è±¡ä¼šåœ¨ widget çš„ç”Ÿå‘½å‘¨æœŸå†…æŒä¹…å­˜åœ¨ã€‚\nåœ¨è¿™ä¸€æ­¥éª¤ä¸­ï¼Œæ‚¨å°†æ·»åŠ ä¸€ä¸ªæœ‰çŠ¶æ€çš„ç»„ä»¶ RandomWordsï¼Œå¹¶åˆ›å»ºå…¶ State ç±» _RandomWordsStateã€‚ç„¶åï¼Œæ‚¨å°†åœ¨ç°æœ‰çš„ MyApp æ— çŠ¶æ€ç»„ä»¶ä¸­ä½¿ç”¨ RandomWords ä½œä¸ºå­ç±»ã€‚\nä¸ºæœ‰çŠ¶æ€ç»„ä»¶åˆ›å»ºæ¨¡æ¿ä»£ç ã€‚\nå®ƒå¯ä»¥æ”¾åœ¨ MyApp ä»¥å¤–çš„æ–‡ä»¶ä¸­çš„ä»»ä½•ä½ç½®ï¼Œä½†è§£å†³æ–¹æ¡ˆå°†å…¶æ”¾åœ¨æ–‡ä»¶çš„åº•éƒ¨ã€‚åœ¨ lib/main.dart ä¸­ï¼Œå°†å…‰æ ‡å®šä½åœ¨æ‰€æœ‰ä»£ç ä¹‹åï¼Œè¾“å…¥å›è½¦é”®å‡ æ¬¡ï¼Œé‡æ–°å¼€å§‹ä¸€è¡Œã€‚åœ¨ä½ çš„ IDE ä¸­ï¼Œå¼€å§‹è¾“å…¥ stfulã€‚ç¼–è¾‘å™¨ä¼šè¯¢é—®ä½ æ˜¯å¦è¦åˆ›å»ºä¸€ä¸ª Stateful çš„ç»„ä»¶ã€‚æŒ‰å›è½¦é”®æ¥å—ã€‚ä¸¤ä¸ªç±»çš„æ¨¡æ¿ä»£ç å‡ºç°äº†ï¼Œå…‰æ ‡å®šä½è®©ä½ è¾“å…¥æ— çŠ¶æ€ç»„ä»¶çš„åç§°ã€‚\nè¾“å…¥ RandomWords ä½œä¸ºæ‚¨çš„å°ç»„ä»¶çš„åç§°ã€‚\næ­£å¦‚æ‚¨åœ¨ä¸‹é¢çš„ä»£ç ä¸­æ‰€çœ‹åˆ°çš„ï¼ŒRandomWords ç»„ä»¶é™¤äº†åˆ›å»ºå®ƒçš„ State ç±»ä¹‹å¤–ï¼Œå‡ ä¹æ²¡æœ‰å…¶ä»–çš„åŠŸèƒ½ã€‚\nä¸€æ—¦æ‚¨è¾“å…¥ RandomWords ä½œä¸ºæœ‰çŠ¶æ€ç»„ä»¶çš„åç§°ï¼ŒIDE ä¼šè‡ªåŠ¨æ›´æ–°ç›¸åº”çš„ State ç±»ï¼Œå°†å…¶å‘½åä¸º _RandomWordStateã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒState ç±»çš„åç§°æ˜¯ä»¥ä¸‹åˆ’çº¿ä¸ºå‰ç¼€çš„ã€‚åœ¨æ ‡è¯†ç¬¦å‰åŠ ä¸Šä¸‹åˆ’çº¿å¯ä»¥åŠ å¼º Dart è¯­è¨€çš„éšç§æ€§ï¼Œä¹Ÿæ˜¯ State å¯¹è±¡çš„æœ€ä½³å®è·µã€‚\nIDE ä¹Ÿä¼šè‡ªåŠ¨æ›´æ–° State ç±»ä»¥æ‰©å±• State\u0026lt;RandomWords\u0026gt;ï¼Œè¡¨æ˜ä½ æ­£åœ¨ä½¿ç”¨ä¸€ä¸ªä¸“é—¨ç”¨äº RandomWords çš„é€šç”¨ State ç±»ã€‚åº”ç”¨ç¨‹åºçš„å¤§éƒ¨åˆ†é€»è¾‘éƒ½åœ¨è¿™é‡Œ-å®ƒä¸º RandomWords ç»„ä»¶ç»´æŠ¤çŠ¶æ€ã€‚è¿™ä¸ªç±»ä¿å­˜äº†ç”Ÿæˆçš„è¯å¯¹åˆ—è¡¨ï¼Œéšç€ç”¨æˆ·çš„æ»šåŠ¨è€Œæ— é™å¢é•¿ï¼Œåœ¨æœ¬å®éªŒå®¤çš„ç¬¬äºŒéƒ¨åˆ†ä¸­ï¼Œå½“ç”¨æˆ·é€šè¿‡åˆ‡æ¢å¿ƒå½¢å›¾æ ‡ä»åˆ—è¡¨ä¸­æ·»åŠ æˆ–åˆ é™¤è¿™äº›è¯å¯¹æ—¶ï¼Œè¯¥ç±»ä¼šå¯¹å…¶è¿›è¡Œæ”¶è—ã€‚\nç°åœ¨ä¸¤ä¸ªç±»çš„å¤–è§‚å¦‚ä¸‹:\nclass RandomWords extends StatefulWidget { @override _RandomWordsState createState() =\u0026gt; _RandomWordsState(); } class _RandomWordsState extends State\u0026lt;RandomWords\u0026gt; { @override Widget build(BuildContext context) { return Container(); } } æ›´æ–° _RandomWordsState ä¸­çš„ build() æ–¹æ³•ã€‚\nç”¨ä»¥ä¸‹ä¸¤è¡Œæ›¿æ¢ return Container();:\nclass _RandomWordsState extends State\u0026lt;RandomWords\u0026gt; { @override Widget build(BuildContext context) { final wordPair = WordPair.random(); // NEW  return Text(wordPair.asPascalCase); // NEW  } } é€šè¿‡ä»¥ä¸‹ä¿®æ”¹ï¼Œåˆ é™¤ MyApp ä¸­çš„æ–‡å­—ç”Ÿæˆä»£ç :\nclass MyApp extends StatelessWidget { @override Widget build(BuildContext context) { final wordPair = WordPair.random(); // DELETE  return MaterialApp( title: \u0026#39;Welcome to Flutter\u0026#39;, home: Scaffold( appBar: AppBar( title: Text(\u0026#39;Welcome to Flutter\u0026#39;), ), body: Center( //child: Text(wordPair.asPascalCase), // REPLACE with...  child: RandomWords(), // ...this line  ), ), ); } } çƒ­é‡è½½åº”ç”¨ç¨‹åºã€‚åº”ç”¨ç¨‹åºåº”è¯¥åƒä»¥å‰ä¸€æ ·ï¼Œæ¯æ¬¡çƒ­é‡è½½æˆ–ä¿å­˜åº”ç”¨ç¨‹åºæ—¶éƒ½ä¼šæ˜¾ç¤ºä¸€ä¸ªå•è¯é…å¯¹ã€‚\næç¤ºï¼šå¦‚æœæ‚¨åœ¨çƒ­é‡è½½æ—¶çœ‹åˆ°è­¦å‘Šï¼Œè¡¨æ˜æ‚¨å¯èƒ½éœ€è¦é‡æ–°å¯åŠ¨åº”ç”¨ç¨‹åºï¼Œæ‚¨åº”è¯¥è€ƒè™‘é‡æ–°å¯åŠ¨åº”ç”¨ç¨‹åºã€‚è¿™å¯èƒ½æ˜¯ä¸€ä¸ªå‡é˜³æ€§ï¼Œä½†é‡å¯å¯ä»¥ç¡®ä¿æ‚¨çš„æ›´æ”¹åæ˜ åœ¨åº”ç”¨ç¨‹åºçš„ UI ä¸­ã€‚\né‡åˆ°é—®é¢˜äº†ï¼Ÿ å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºæ²¡æœ‰æ­£ç¡®è¿è¡Œï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹é“¾æ¥ä¸­çš„ä»£ç æ¥æ¢å¤æ­£å¸¸ã€‚\n lib/main.dart  åˆ›å»ºä¸€ä¸ªæ— é™æ»šåŠ¨çš„ ListView åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæ‚¨å°†å±•å¼€ _RandomWordsState æ¥ç”Ÿæˆå¹¶æ˜¾ç¤ºå•è¯é…å¯¹åˆ—è¡¨ã€‚éšç€ç”¨æˆ·çš„æ»šåŠ¨ï¼Œåˆ—è¡¨ï¼ˆæ˜¾ç¤ºåœ¨ ListView å°ç»„ä»¶ä¸­ï¼‰ä¼šæ— é™å¢é•¿ã€‚ListView ä¸­çš„æ„å»ºå™¨å·¥å‚æ„é€ å‡½æ•°å…è®¸ä½ æŒ‰éœ€æ‡’æƒ°åœ°æ„å»ºä¸€ä¸ªåˆ—è¡¨è§†å›¾ã€‚\nåœ¨ _RandomWordState ç±»ä¸­æ·»åŠ ä¸€äº›çŠ¶æ€å˜é‡ã€‚\nå¢åŠ ä¸€ä¸ª _suggestions åˆ—è¡¨ï¼Œç”¨äºä¿å­˜å»ºè®®çš„å•è¯é…å¯¹ã€‚å¦å¤–ï¼Œæ·»åŠ ä¸€ä¸ª _biggerFont å˜é‡ï¼Œç”¨äºä½¿å­—ä½“å¤§å°å˜å¤§ã€‚\nclass _RandomWordsState extends State\u0026lt;RandomWords\u0026gt; { final List\u0026lt;WordPair\u0026gt; _suggestions = \u0026lt;WordPair\u0026gt;[]; // NEW  final TextStyle _biggerFont = const TextStyle(fontSize: 18); // NEW  ... } æ¥ä¸‹æ¥ï¼Œä½ å°†åœ¨ _RandomWordsState ç±»ä¸­æ·»åŠ ä¸€ä¸ª _buildSuggestions() å‡½æ•°ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥æ„å»ºæ˜¾ç¤ºå»ºè®®è¯å¯¹çš„ ListViewã€‚\nListView ç±»æä¾›äº†ä¸€ä¸ªæ„å»ºå™¨å±æ€§ itemBuilderï¼Œå®ƒæ˜¯ä¸€ä¸ªå·¥å‚æ„å»ºå™¨å’Œå›è°ƒå‡½æ•°ï¼ŒæŒ‡å®šä¸ºä¸€ä¸ªåŒ¿åå‡½æ•°ã€‚ä¸¤ä¸ªå‚æ•°è¢«ä¼ é€’ç»™å‡½æ•°\u0026ndash;BuildContext å’Œè¡Œè¿­ä»£å™¨ iã€‚è¿­ä»£å™¨ä»0å¼€å§‹ï¼Œæ¯æ¬¡è°ƒç”¨å‡½æ•°æ—¶é€’å¢ï¼Œæ¯ä¸€ä¸ªå»ºè®®çš„å•è¯é…å¯¹éƒ½ä¼šé€’å¢ä¸€æ¬¡ã€‚è¿™ä¸ªæ¨¡å‹å…è®¸å»ºè®®åˆ—è¡¨åœ¨ç”¨æˆ·æ»šåŠ¨æ—¶ç»§ç»­å¢é•¿ã€‚\næ·»åŠ æ•´ä¸ª _buildSuggestions å‡½æ•°ã€‚\nåœ¨ _RandomWordsState ç±»ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹å‡½æ•°ï¼Œå¦‚æœä½ å–œæ¬¢ï¼Œè¯·åˆ é™¤æ³¨é‡Š:\nWidget _buildSuggestions() { return ListView.builder( padding: const EdgeInsets.all(16), // The itemBuilder callback is called once per suggested  // word pairing, and places each suggestion into a ListTile  // row. For even rows, the function adds a ListTile row for  // the word pairing. For odd rows, the function adds a  // Divider widget to visually separate the entries. Note that  // the divider may be difficult to see on smaller devices.  itemBuilder: (BuildContext _context, int i) { // Add a one-pixel-high divider widget before each row  // in the ListView.  if (i.isOdd) { return Divider(); } // The syntax \u0026#34;i ~/ 2\u0026#34; divides i by 2 and returns an  // integer result.  // For example: 1, 2, 3, 4, 5 becomes 0, 1, 1, 2, 2.  // This calculates the actual number of word pairings  // in the ListView,minus the divider widgets.  final int index = i ~/ 2; // If you\u0026#39;ve reached the end of the available word  // pairings...  if (index \u0026gt;= _suggestions.length) { // ...then generate 10 more and add them to the  // suggestions list.  _suggestions.addAll(generateWordPairs().take(10)); } return _buildRow(_suggestions[index]); } ); } _buildSuggestions å‡½æ•°å¯¹æ¯ä¸ªè¯å¯¹è°ƒç”¨ä¸€æ¬¡ _buildRowã€‚è¯¥å‡½æ•°åœ¨ ListTile ä¸­æ˜¾ç¤ºæ¯ä¸€ä¸ªæ–°çš„è¯å¯¹ï¼Œè¿™ä½¿å¾—ä½ å¯ä»¥åœ¨ç¬¬2éƒ¨åˆ†ä¸­ä½¿è¡Œæ›´æœ‰å¸å¼•åŠ›ã€‚\nåœ¨ _RandomWordsState ä¸­æ·»åŠ ä¸€ä¸ª _buildRow å‡½æ•°ã€‚\nWidget _buildRow(WordPair pair) { return ListTile( title: Text( pair.asPascalCase, style: _biggerFont, ), ); } æ›´æ–° _RandomWordsState çš„æ„å»ºæ–¹æ³•ã€‚\nå°†å…¶æ”¹ä¸ºä½¿ç”¨ _buildSuggestions()ï¼Œè€Œä¸æ˜¯ç›´æ¥è°ƒç”¨å•è¯ç”Ÿæˆåº“ã€‚(Scaffold å®ç°äº†åŸºæœ¬çš„ Material Design è§†è§‰å¸ƒå±€ã€‚)\n@override Widget build(BuildContext context) { //final wordPair = WordPair.random(); // Delete these...  //return Text(wordPair.asPascalCase); // ... two lines.  return Scaffold ( // Add from here...  appBar: AppBar( title: Text(\u0026#39;Startup Name Generator\u0026#39;), ), body: _buildSuggestions(), ); // ... to here.  } æ›´æ–° MyApp çš„æ„å»ºæ–¹æ³•ï¼Œæ›´æ”¹æ ‡é¢˜ï¼Œåˆ é™¤ AppBarï¼Œå¹¶å°† home å±æ€§æ”¹ä¸º RandomWords éƒ¨ä»¶ã€‚\n@override Widget build(BuildContext context) { return MaterialApp( title: \u0026#39;Startup Name Generator\u0026#39;, home: RandomWords(), ); } é‡æ–°å¯åŠ¨åº”ç”¨ç¨‹åºã€‚æ— è®ºä½ æ»šåŠ¨å¤šè¿œï¼Œä½ éƒ½åº”è¯¥çœ‹åˆ°ä¸€ä¸ªå•è¯é…å¯¹çš„åˆ—è¡¨ã€‚\nAndroid:\niOS:\né‡åˆ°é—®é¢˜äº†ï¼Ÿ å¦‚æœä½ çš„åº”ç”¨ç¨‹åºä¸èƒ½æ­£å¸¸è¿è¡Œï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢é“¾æ¥ä¸­çš„ä»£ç æ¥å›åˆ°æ­£è½¨ã€‚\n lib/main.dart  ä»Šåçš„æ­¥éª¤ æ­å–œä½ ï¼\nä½ å·²ç»å®Œæˆäº†è¿™ä¸ªä»£ç å®éªŒå®¤çš„ç¬¬ä¸€éƒ¨åˆ†! å¦‚æœä½ æƒ³æ‰©å±•è¿™æ¬¾åº”ç”¨ï¼Œè¯·è¿›å…¥ç¬¬äºŒéƒ¨åˆ†ï¼Œä½ å°†å¯¹åº”ç”¨è¿›è¡Œå¦‚ä¸‹ä¿®æ”¹ã€‚\n å¢åŠ äº’åŠ¨æ€§ å¢åŠ å¯¼èˆªåˆ°æ–°è·¯ç”±çš„åŠŸèƒ½ã€‚ ä¿®æ”¹ä¸»é¢˜é¢œè‰²ã€‚  å½“ç¬¬2éƒ¨åˆ†å®Œæˆåï¼Œåº”ç”¨ç¨‹åºå°†æ˜¯è¿™æ ·çš„ï¼š\nå…¶ä»–åç»­æ­¥éª¤ é€šè¿‡ä»¥ä¸‹èµ„æºäº†è§£æ›´å¤šå…³äº Flutter SDK çš„ä¿¡æ¯ã€‚\n Flutter ä¸­çš„å¸ƒå±€ å¢åŠ äº’åŠ¨æ€§æ•™ç¨‹ ç»„ä»¶ä»‹ç» ä¸º Android å¼€å‘è€…æä¾›çš„ Flutter é’ˆå¯¹ React Native å¼€å‘è€…çš„ Flutter Web å¼€å‘äººå‘˜çš„ Flutter Flutter YouTube é¢‘é“  å…¶ä»–èµ„æºåŒ…æ‹¬ä»¥ä¸‹å‡ ç‚¹:\n ç”¨ Flutter æ„å»ºæœ¬åœ°ç§»åŠ¨åº”ç”¨ ä» Java åˆ° Dart codelab Flutter cookbook èå…¥ Dart çš„ Bootstrapï¼šäº†è§£æ›´å¤šå…³äºè¿™é—¨è¯­è¨€çš„ä¿¡æ¯  åŒæ—¶ï¼Œä¸ Flutter ç¤¾åŒºè”ç³»èµ·æ¥!\n","permalink":"https://ohmyweekly.github.io/notes/write-your-first-flutter-app/","tags":["flutter","app"],"title":"ç¼–å†™ä½ çš„ç¬¬ä¸€ä¸ª Flutter åº”ç”¨ï¼Œç¬¬ä¸€éƒ¨åˆ†"},{"categories":["programming"],"contents":"ä»‹ç» Flutter æ˜¯ Google çš„ UI å·¥å…·åŒ…ï¼Œç”¨äºä»å•ä¸€ä»£ç åº“ä¸­ä¸ºç§»åŠ¨ã€Web å’Œæ¡Œé¢æ„å»ºæ¼‚äº®çš„ã€åŸç”Ÿç¼–è¯‘çš„åº”ç”¨ç¨‹åºã€‚Flutter å¯ä»¥ä¸ç°æœ‰çš„ä»£ç ä¸€èµ·å·¥ä½œï¼Œè¢«ä¸–ç•Œå„åœ°çš„å¼€å‘è€…å’Œç»„ç»‡ä½¿ç”¨ï¼Œå¹¶ä¸”æ˜¯å…è´¹å’Œå¼€æºçš„ã€‚\nåœ¨è¿™ä¸ªä»£ç å®éªŒå®¤ä¸­ï¼Œæ‚¨å°†æ‰©å±•ä¸€ä¸ªåŸºæœ¬çš„ã€ç§»åŠ¨çš„ Flutter åº”ç”¨ç¨‹åºï¼Œä»¥åŒ…å«äº¤äº’æ€§ã€‚æ‚¨è¿˜å°†åˆ›å»ºä¸€ä¸ªç”¨æˆ·å¯ä»¥å¯¼èˆªåˆ°çš„ç¬¬äºŒä¸ªé¡µé¢ï¼ˆç§°ä¸ºè·¯ç”±ï¼‰ã€‚æœ€åï¼Œæ‚¨å°†ä¿®æ”¹åº”ç”¨ç¨‹åºçš„ä¸»é¢˜ï¼ˆé¢œè‰²ï¼‰ã€‚è¿™ä¸ªä»£ç å®éªŒå®¤æ‰©å±•äº†ç¬¬1éƒ¨åˆ†ï¼Œåœ¨è¿™éƒ¨åˆ†ä¸­ï¼Œä½ å°†åˆ›å»ºä¸€ä¸ªæ— é™çš„æ‡’æƒ°åŠ è½½çš„åˆ—è¡¨ï¼Œä½†å¦‚æœä½ æƒ³ä»ç¬¬2éƒ¨åˆ†å¼€å§‹ï¼Œæˆ‘ä»¬å°†æä¾›èµ·å§‹ä»£ç ã€‚\nä½ å°†åœ¨ç¬¬äºŒéƒ¨åˆ†å­¦åˆ°ä»€ä¹ˆ  å¦‚ä½•ç¼–å†™ä¸€æ¬¾åœ¨ iOSã€Android å’Œ Web ä¸Šçœ‹èµ·æ¥å¾ˆè‡ªç„¶çš„ Flutter åº”ç”¨ï¼Ÿ å¦‚ä½•ä½¿ç”¨çƒ­é‡è£…ï¼ŒåŠ å¿«å¼€å‘å‘¨æœŸï¼Ÿ å¦‚ä½•ä¸ºæœ‰çŠ¶æ€çš„ widget æ·»åŠ äº¤äº’æ€§ï¼Ÿ å¦‚ä½•åˆ›å»ºå¹¶å¯¼èˆªåˆ°ç¬¬äºŒä¸ªå±å¹•ï¼Ÿ å¦‚ä½•ä½¿ç”¨ä¸»é¢˜æ¥æ”¹å˜åº”ç”¨ç¨‹åºçš„å¤–è§‚ï¼Ÿ  ä½ å°†åœ¨ç¬¬äºŒéƒ¨åˆ†å»ºç«‹ä»€ä¹ˆ æ‚¨å°†ä»ä¸€ä¸ªç®€å•çš„ç§»åŠ¨åº”ç”¨ç¨‹åºå¼€å§‹ï¼Œä¸ºåˆ›ä¸šå…¬å¸ç”Ÿæˆä¸€ä¸ªæ— å°½çš„å»ºè®®åç§°åˆ—è¡¨ã€‚åœ¨ä»£ç å®éªŒå®¤ç»“æŸæ—¶ï¼Œæ‚¨çš„æœ€ç»ˆç”¨æˆ·å¯ä»¥é€‰æ‹©å’Œå–æ¶ˆé€‰æ‹©åç§°ï¼Œä¿å­˜æœ€å¥½çš„åç§°ã€‚ç‚¹å‡»åº”ç”¨æ å³ä¸Šè§’çš„åˆ—è¡¨å›¾æ ‡å¯ä»¥å¯¼èˆªåˆ°ä¸€ä¸ªæ–°çš„é¡µé¢ï¼ˆç§°ä¸ºè·¯ç”±ï¼‰ï¼Œè¯¥é¡µé¢åªåˆ—å‡ºäº†æœ€å–œæ¬¢çš„åå­—ã€‚\nä¸‹é¢çš„ GIF åŠ¨ç”»æ˜¾ç¤ºäº†å®Œæˆçš„åº”ç”¨ç¨‹åºå°†å¦‚ä½•å·¥ä½œã€‚\nè®¾ç½®æ‚¨çš„ Flutter ç¯å¢ƒ å¦‚æœä½ è¿˜æ²¡æœ‰å®Œæˆç¬¬1éƒ¨åˆ†ï¼Œè¯·çœ‹è®¾ç½®ä½ çš„ Flutter ç¯å¢ƒï¼Œåœ¨ç¼–å†™ä½ çš„ç¬¬ä¸€ä¸ªFlutteråº”ç”¨ï¼Œç¬¬1éƒ¨åˆ†ï¼Œè®¾ç½®ä½ çš„ Flutter å¼€å‘ç¯å¢ƒã€‚\nè·å–å¯åŠ¨åº”ç”¨ç¨‹åº å¦‚æœä½ å·²ç»å®Œæˆäº†è¿™ä¸ª codelab çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œä½ å·²ç»æœ‰äº†å¯åŠ¨åº”ç”¨ç¨‹åºï¼Œstartup_namerã€‚ä½ å¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥ã€‚\nå¦‚æœä½ æ²¡æœ‰ startup_namerï¼Œä¸è¦å®³æ€•ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„è¯´æ˜å¾—åˆ°å®ƒã€‚\nä½¿ç”¨åˆ›å»ºåº”ç”¨ç¨‹åºä¸­çš„è¯´æ˜åˆ›å»ºä¸€ä¸ªç®€å•çš„æ¨¡æ¿åŒ– Flutter åº”ç”¨ç¨‹åºã€‚å°†é¡¹ç›®å‘½åä¸º startup_namerï¼ˆè€Œä¸æ˜¯ flutter_appï¼‰ã€‚\nåˆ é™¤ lib/main.dart ä¸­çš„æ‰€æœ‰ä»£ç ã€‚ç”¨è¿™ä¸ªæ–‡ä»¶ä¸­çš„ä»£ç æ›¿æ¢ï¼Œå®ƒæ˜¾ç¤ºäº†ä¸€ä¸ªæ— é™çš„ï¼Œæ‡’æƒ°åŠ è½½çš„å»ºè®®å¯åŠ¨åç§°åˆ—è¡¨ã€‚\næ›´æ–° pubspec.yamlï¼ŒåŠ å…¥è‹±æ–‡å•è¯åŒ…ã€‚\ndependencies:flutter:sdk:fluttercupertino_icons:^0.1.2english_words:^3.1.5 // NEWè‹±æ–‡å•è¯åŒ…ä¼šç”Ÿæˆä¸€å¯¹éšæœºçš„å•è¯ï¼Œä½œä¸ºæ½œåœ¨çš„å¯åŠ¨åç§°ã€‚\nåœ¨ Android Studio çš„ç¼–è¾‘å™¨è§†å›¾ä¸­æŸ¥çœ‹ pubspec æ—¶ï¼Œç‚¹å‡»å³ä¸Šè§’çš„ Pub getï¼Œè¿™å°†åŒ…æ‹‰åˆ°ä½ çš„é¡¹ç›®ä¸­ã€‚ä½ åº”è¯¥åœ¨æ§åˆ¶å°ä¸­çœ‹åˆ°ä»¥ä¸‹å†…å®¹:\nflutter pub get Running \u0026#34;flutter pub get\u0026#34; in startup_namer... Process finished with exit code 0 è¿è¡Œè¯¥åº”ç”¨ã€‚\néšæ„æ»šåŠ¨ï¼ŒæŸ¥çœ‹æŒç»­ä¾›åº”çš„æ‹Ÿåˆ›ä¸šå…¬å¸åç§°ã€‚\nå°†å›¾æ ‡æ·»åŠ åˆ°åˆ—è¡¨ä¸­ åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œä½ å°†ä¸ºæ¯ä¸€è¡Œæ·»åŠ å¿ƒå½¢å›¾æ ‡ã€‚åœ¨ä¸‹ä¸€æ­¥ä¸­ï¼Œæ‚¨å°†ä½¿å®ƒä»¬å¯ç‚¹å‡»å¹¶ä¿å­˜æ”¶è—å¤¹ã€‚\nåœ¨ _RandomWordsState ä¸­æ·»åŠ ä¸€ä¸ª _saved Setã€‚è¿™ä¸ª Set å­˜å‚¨äº†ç”¨æˆ·æ”¶è—çš„å•è¯é…å¯¹ã€‚Set æ¯” List æ›´å—æ¬¢è¿ï¼Œå› ä¸ºä¸€ä¸ªæ­£ç¡®å®ç°çš„ Set ä¸å…è®¸é‡å¤çš„æ¡ç›®ã€‚\nclass _RandomWordsState extends State\u0026lt;RandomWords\u0026gt; { final _suggestions = \u0026lt;WordPair\u0026gt;[]; final _saved = Set\u0026lt;WordPair\u0026gt;(); // NEW  final _biggerFont = TextStyle(fontSize: 18.0); ... } åœ¨ _buildRow å‡½æ•°ä¸­ï¼Œæ·»åŠ ä¸€ä¸ª alreadySaved æ£€æŸ¥ï¼Œä»¥ç¡®ä¿ä¸€ä¸ªå•è¯é…å¯¹è¿˜æ²¡æœ‰è¢«æ·»åŠ åˆ°æ”¶è—å¤¹ä¸­ã€‚\nWidget _buildRow(WordPair pair) { final alreadySaved = _saved.contains(pair); // NEW  ... } åœ¨ _buildRow() ä¸­ï¼Œä½ è¿˜å°†ä¸º ListTile å¯¹è±¡æ·»åŠ å¿ƒå½¢å›¾æ ‡ä»¥å®ç°æ”¶è—å¤¹ã€‚åœ¨ä¸‹ä¸€æ­¥ä¸­ï¼Œä½ å°†æ·»åŠ ä¸å¿ƒå½¢å›¾æ ‡äº¤äº’çš„åŠŸèƒ½ã€‚\nåœ¨æ–‡æœ¬ä¹‹åæ·»åŠ å›¾æ ‡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚\nWidget _buildRow(WordPair pair) { final alreadySaved = _saved.contains(pair); return ListTile( title: Text( pair.asPascalCase, style: _biggerFont, ), trailing: Icon( // NEW from here...  alreadySaved ? Icons.favorite : Icons.favorite_border, color: alreadySaved ? Colors.red : null, ), // ... to here.  ); } çƒ­é‡æ–°åŠ è½½åº”ç”¨ç¨‹åºã€‚\nä½ ç°åœ¨åº”è¯¥çœ‹åˆ°æ¯ä¸€è¡Œéƒ½æœ‰ç©ºå¿ƒï¼Œä½†å®ƒä»¬è¿˜æ²¡æœ‰äº’åŠ¨ã€‚\nAndroid\niOS\né‡åˆ°é—®é¢˜äº†ï¼Ÿ å¦‚æœä½ çš„åº”ç”¨ç¨‹åºä¸èƒ½æ­£å¸¸è¿è¡Œï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢é“¾æ¥ä¸­çš„ä»£ç æ¥å›åˆ°æ­£è½¨ã€‚\n lib/main.dart  å¢åŠ äº’åŠ¨æ€§ åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œä½ å°†ä½¿å¿ƒå½¢å›¾æ ‡å¯ä»¥ç‚¹å‡»ã€‚å½“ç”¨æˆ·ç‚¹å‡»åˆ—è¡¨ä¸­çš„ä¸€ä¸ªæ¡ç›®ï¼Œåˆ‡æ¢å…¶æ”¶è—çŠ¶æ€æ—¶ï¼Œè¯¥è¯å¯¹å°±ä¼šä»ä¸€ç»„ä¿å­˜çš„æ”¶è—å¤¹ä¸­æ·»åŠ æˆ–åˆ é™¤ã€‚\nè¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½ å°†ä¿®æ”¹ _buildRow å‡½æ•°ã€‚å¦‚æœä¸€ä¸ªè¯æ¡å·²ç»è¢«æ·»åŠ åˆ°æ”¶è—å¤¹ä¸­ï¼Œå†æ¬¡ç‚¹å‡»å®ƒå°±ä¼šå°†å…¶ä»æ”¶è—å¤¹ä¸­åˆ é™¤ã€‚å½“ä¸€ä¸ªç£è´´è¢«ç‚¹å‡»åï¼Œå‡½æ•°ä¼šè°ƒç”¨ setState() æ¥é€šçŸ¥æ¡†æ¶çŠ¶æ€å·²ç»æ”¹å˜ã€‚\nåœ¨ _buildRow æ–¹æ³•ä¸­åŠ å…¥ onTapï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:\nWidget _buildRow(WordPair pair) { final alreadySaved = _saved.contains(pair); return ListTile( title: Text( pair.asPascalCase, style: _biggerFont, ), trailing: Icon( alreadySaved ? Icons.favorite : Icons.favorite_border, color: alreadySaved ? Colors.red : null, ), onTap: () { // NEW lines from here...  setState(() { if (alreadySaved) { _saved.remove(pair); } else { _saved.add(pair); } }); }, // ... to here.  ); } æç¤ºï¼šåœ¨ Flutter çš„ååº”å¼æ¡†æ¶ä¸­ï¼Œè°ƒç”¨ setState() ä¼šè§¦å‘å¯¹ State å¯¹è±¡çš„ build() æ–¹æ³•çš„è°ƒç”¨ï¼Œå¯¼è‡´ UI çš„æ›´æ–°ã€‚\nçƒ­é‡è½½åº”ç”¨ã€‚\nä½ åº”è¯¥èƒ½å¤Ÿç‚¹å‡»ä»»ä½•ç£è´´æ¥æ”¶è—æˆ–ä¸æ”¶è—è¯¥æ¡ç›®ã€‚ç‚¹å‡»ç“·ç –ä¼šäº§ç”Ÿä¸€ä¸ªéšå«çš„ä»ç‚¹å‡»ç‚¹å‘å‡ºçš„æ³¼å¢¨åŠ¨ç”»ã€‚\nAndroid\niOS\né‡åˆ°é—®é¢˜äº†ï¼Ÿ å¦‚æœä½ çš„åº”ç”¨ç¨‹åºä¸èƒ½æ­£å¸¸è¿è¡Œï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢é“¾æ¥ä¸­çš„ä»£ç æ¥å›åˆ°æ­£è½¨ã€‚\n lib/main.dart  å¯¼èˆªåˆ°ä¸€ä¸ªæ–°çš„å±å¹• åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæ‚¨å°†æ·»åŠ ä¸€ä¸ªæ–°çš„é¡µé¢ï¼ˆåœ¨ Flutter ä¸­ç§°ä¸ºè·¯ç”±ï¼‰ï¼Œæ˜¾ç¤ºæ”¶è—å¤¹ã€‚æ‚¨å°†å­¦ä¹ å¦‚ä½•åœ¨ä¸»é¡µè·¯çº¿å’Œæ–°è·¯ç”±ä¹‹é—´è¿›è¡Œå¯¼èˆªã€‚\nåœ¨ Flutter ä¸­ï¼ŒNavigator ç®¡ç†ç€ä¸€ä¸ªåŒ…å«åº”ç”¨ç¨‹åºè·¯ç”±çš„å †æ ˆã€‚å°†ä¸€ä¸ªè·¯ç”±æ¨åˆ° Navigator çš„å †æ ˆä¸Šï¼Œä¼šå°†æ˜¾ç¤ºæ›´æ–°åˆ°è¯¥è·¯ç”±ã€‚ä» Navigator çš„å †æ ˆä¸­å¼¹å‡ºä¸€æ¡è·¯ç”±ï¼Œä¼šå°†æ˜¾ç¤ºè¿”å›åˆ°ä¹‹å‰çš„è·¯ç”±ã€‚\næ¥ä¸‹æ¥ï¼Œæ‚¨å°†åœ¨ _RandomWordsState çš„ build æ–¹æ³•ä¸­ä¸º AppBar æ·»åŠ ä¸€ä¸ªåˆ—è¡¨å›¾æ ‡ã€‚å½“ç”¨æˆ·ç‚¹å‡»åˆ—è¡¨å›¾æ ‡æ—¶ï¼Œä¸€ä¸ªåŒ…å«ä¿å­˜çš„æ”¶è—å¤¹çš„æ–°è·¯ç”±ä¼šè¢«æ¨é€åˆ° Navigatorï¼Œæ˜¾ç¤ºå›¾æ ‡ã€‚\nåœ¨ build æ–¹æ³•ä¸­æ·»åŠ å›¾æ ‡åŠå…¶å¯¹åº”çš„æ“ä½œ:\nclass _RandomWordsState extends State\u0026lt;RandomWords\u0026gt; { ... @override Widget build(BuildContext context) { return Scaffold( appBar: AppBar( title: Text(\u0026#39;Startup Name Generator\u0026#39;), actions: [ // NEW lines from here...  IconButton(icon: Icon(Icons.list), onPressed: _pushSaved), ], // ... to here.  ), home: RandomWords(), ); } ... } æç¤ºï¼šä¸€äº›å°ç»„ä»¶å±æ€§ä¼šå–ä¸€ä¸ªå°ç»„ä»¶(child)ï¼Œè€Œå…¶ä»–å±æ€§ï¼Œå¦‚ actionï¼Œä¼šå–ä¸€ç»„å°ç»„ä»¶(children), å¦‚æ–¹æ‹¬å·([])æ‰€ç¤ºã€‚\nåœ¨ _RandomWordsState ç±»ä¸­æ·»åŠ ä¸€ä¸ª _pushSaved() å‡½æ•°ã€‚\nvoid _pushSaved() { } çƒ­é‡æ–°åŠ è½½åº”ç”¨ç¨‹åºã€‚åˆ—è¡¨å›¾æ ‡å‡ºç°åœ¨åº”ç”¨æ ä¸­ã€‚ç‚¹å‡»å®ƒè¿˜æ²¡æœ‰ä»»ä½•ä½œç”¨ï¼Œå› ä¸º _pushSaved å‡½æ•°æ˜¯ç©ºçš„ã€‚\næ¥ä¸‹æ¥ï¼Œä½ å°†å»ºç«‹ä¸€æ¡è·¯ç”±ï¼Œå¹¶å°†å…¶æ¨é€åˆ° Navigator çš„æ ˆä¸­ã€‚è¿™ä¸ªæ“ä½œä¼šæ”¹å˜å±å¹•ä»¥æ˜¾ç¤ºæ–°çš„è·¯ç”±ã€‚æ–°é¡µé¢çš„å†…å®¹æ˜¯åœ¨ MaterialPageRoute çš„æ„å»ºå™¨å±æ€§ä¸­ä»¥åŒ¿åå‡½æ•°çš„æ–¹å¼æ„å»ºçš„ã€‚\nè°ƒç”¨ Navigator.pushï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå®ƒå°†è·¯ç”±æ¨é€åˆ° Navigator çš„å †æ ˆä¸­ã€‚IDE ä¼šæŠ±æ€¨æ— æ•ˆä»£ç ï¼Œä½†ä½ ä¼šåœ¨ä¸‹ä¸€èŠ‚ä¸­è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\nvoid _pushSaved() { Navigator.of(context).push( ); } æ¥ä¸‹æ¥ï¼Œä½ å°†æ·»åŠ  MaterialPageRoute å’Œå®ƒçš„æ„å»ºå™¨ã€‚ç°åœ¨ï¼Œæ·»åŠ ç”Ÿæˆ ListTile è¡Œçš„ä»£ç ã€‚ListTile çš„ divideTiles() æ–¹æ³•åœ¨æ¯ä¸ª ListTile ä¹‹é—´å¢åŠ äº†æ°´å¹³é—´è·ã€‚è¢«åˆ’åˆ†çš„å˜é‡æŒæœ‰é€šè¿‡æ–¹ä¾¿å‡½æ•° toList() è½¬æ¢ä¸ºåˆ—è¡¨çš„æœ€ç»ˆè¡Œã€‚\næ·»åŠ ä»£ç ï¼Œå¦‚ä¸‹é¢çš„ä»£ç ç‰‡æ®µæ‰€ç¤º:\nvoid _pushSaved() { Navigator.of(context).push( MaterialPageRoute\u0026lt;void\u0026gt;( // NEW lines from here...  builder: (BuildContext context) { final tiles = _saved.map( (WordPair pair) { return ListTile( title: Text( pair.asPascalCase, style: _biggerFont, ), ); }, ); final divided = ListTile.divideTiles( context: context, tiles: tiles, ).toList(); return Scaffold( appBar: AppBar( title: Text(\u0026#39;Saved Suggestions\u0026#39;), ), body: ListView(children: divided), ); }, // ...to here.  ), ); } } builder å±æ€§è¿”å›ä¸€ä¸ª Scaffoldï¼ŒåŒ…å«åä¸º SavedSuggestions çš„æ–°è·¯ç”±çš„åº”ç”¨æ ã€‚æ–°è·¯ç”±çš„ä¸»ä½“ç”±ä¸€ä¸ªåŒ…å« ListTiles è¡Œçš„ ListView ç»„æˆã€‚æ¯ä¸€è¡Œéƒ½ç”±ä¸€ä¸ªåˆ†éš”ç¬¦éš”å¼€ã€‚\nçƒ­é‡è½½åº”ç”¨ã€‚å°†ä¸€äº›é€‰æ‹©æ”¶è—èµ·æ¥ï¼Œç„¶åç‚¹å‡»åº”ç”¨æ ä¸­çš„åˆ—è¡¨å›¾æ ‡ã€‚æ–°çš„è·¯ç”±å‡ºç°ï¼ŒåŒ…å«æ”¶è—å¤¹ã€‚è¯·æ³¨æ„ï¼ŒNavigator åœ¨åº”ç”¨æ ä¸­å¢åŠ äº†ä¸€ä¸ª\u0026quot;è¿”å›\u0026quot;æŒ‰é’®ã€‚ä½ ä¸å¿…æ˜ç¡®åœ°å®ç° Navigator.popã€‚ç‚¹å‡»\u0026quot;è¿”å›\u0026quot;æŒ‰é’®å°±å¯ä»¥è¿”å›åˆ°ä¸»è·¯ç”±ã€‚\niOS - Main route\niOS - Saved suggestions route\né‡åˆ°é—®é¢˜äº†ï¼Ÿ å¦‚æœä½ çš„åº”ç”¨ç¨‹åºæ²¡æœ‰æ­£ç¡®è¿è¡Œï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢é“¾æ¥ä¸­çš„ä»£ç æ¥å›åˆ°æ­£è½¨ã€‚\n lib/main.dart  ä½¿ç”¨ä¸»é¢˜æ”¹å˜ç”¨æˆ·ç•Œé¢ åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œæ‚¨å°†ä¿®æ”¹åº”ç”¨ç¨‹åºçš„ä¸»é¢˜ã€‚ä¸»é¢˜æ§åˆ¶ä½ çš„åº”ç”¨ç¨‹åºçš„å¤–è§‚å’Œæ„Ÿè§‰ã€‚æ‚¨å¯ä»¥ä½¿ç”¨é»˜è®¤ä¸»é¢˜ï¼Œè¿™å–å†³äºç‰©ç†è®¾å¤‡æˆ–æ¨¡æ‹Ÿå™¨ï¼Œæˆ–è€…è‡ªå®šä¹‰ä¸»é¢˜ä»¥åæ˜ æ‚¨çš„å“ç‰Œã€‚\næ‚¨å¯ä»¥é€šè¿‡é…ç½® ThemeData ç±»è½»æ¾æ›´æ”¹åº”ç”¨ç¨‹åºçš„ä¸»é¢˜ã€‚åº”ç”¨ç¨‹åºä½¿ç”¨é»˜è®¤ä¸»é¢˜ï¼Œä½†ä½ ä¼šå°†åº”ç”¨ç¨‹åºçš„ä¸»è‰²è°ƒæ”¹ä¸ºç™½è‰²ã€‚\nåœ¨ MyApp ç±»ä¸­æ›´æ”¹é¢œè‰²:\nclass MyApp extends StatelessWidget { @override Widget build(BuildContext context) { return MaterialApp( title: \u0026#39;Startup Name Generator\u0026#39;, theme: ThemeData( // Add the 3 lines from here...  primaryColor: Colors.white, ), // ... to here.  home: RandomWords(), ); } } çƒ­é‡è½½åº”ç”¨ã€‚ç°åœ¨æ•´ä¸ªèƒŒæ™¯éƒ½æ˜¯ç™½è‰²çš„ï¼Œç”šè‡³åº”ç”¨æ ä¹Ÿæ˜¯ç™½è‰²çš„ã€‚\nä½œä¸ºä¸€ä¸ªç»ƒä¹ ï¼Œä½¿ç”¨ ThemeData æ¥æ”¹å˜ UI çš„å…¶ä»–æ–¹é¢ã€‚Material åº“ä¸­çš„ Colors ç±»æä¾›äº†è®¸å¤šä½ å¯ä»¥ç©çš„é¢œè‰²å¸¸é‡ã€‚çƒ­é‡è½½ä½¿å¾—å¯¹ UI çš„å®éªŒå˜å¾—å¿«é€Ÿè€Œç®€å•ã€‚\nAndroid\niOS\né‡åˆ°é—®é¢˜äº†ï¼Ÿ å¦‚æœä½ å·²ç»åç¦»äº†è½¨é“ï¼Œé‚£ä¹ˆä½¿ç”¨ä¸‹é¢é“¾æ¥ä¸­çš„ä»£ç æ¥æŸ¥çœ‹æœ€ç»ˆåº”ç”¨çš„ä»£ç ã€‚\n= lib/main.dart\nåšå¾—å¾ˆå¥½ï¼ ä½ å†™äº†ä¸€ä¸ªäº¤äº’å¼çš„ Flutter åº”ç”¨ï¼Œå¯ä»¥åœ¨ iOS å’Œ Android ä¸Šè¿è¡Œï¼Œå…·ä½“åšæ³•å¦‚ä¸‹\n ç¼–å†™ Dart ä»£ç ã€‚ ä½¿ç”¨çƒ­é‡è½½æ¥åŠ å¿«å¼€å‘å‘¨æœŸã€‚ å®ç°ä¸€ä¸ªæœ‰çŠ¶æ€çš„ widgetï¼Œä¸ºä½ çš„åº”ç”¨æ·»åŠ äº¤äº’æ€§ã€‚ åˆ›å»ºé€”å¾„å¹¶æ·»åŠ åœ¨åŸé€”å¾„å’Œæ–°é€”å¾„ä¹‹é—´ç§»åŠ¨çš„é€»è¾‘ã€‚ å­¦ä¹ å¦‚ä½•ä½¿ç”¨ä¸»é¢˜æ”¹å˜ä½ çš„åº”ç”¨ç¨‹åºçš„ UI å¤–è§‚ã€‚  ä»Šåçš„æ­¥éª¤ ä»ä»¥ä¸‹èµ„æºä¸­äº†è§£æ›´å¤šå…³äº Flutter SDK çš„ä¿¡æ¯ã€‚\n Flutter ä¸­çš„å¸ƒå±€ å¢åŠ äº’åŠ¨æ€§æ•™ç¨‹ ç»„ä»¶ä»‹ç» ä¸º Android å¼€å‘è€…æä¾›çš„ Flutter é’ˆå¯¹ React Native å¼€å‘è€…çš„ Flutter Web å¼€å‘äººå‘˜çš„ Flutter Flutter YouTube é¢‘é“  å…¶ä»–èµ„æºåŒ…æ‹¬ä»¥ä¸‹å‡ ç‚¹:\n ç”¨ Flutter æ„å»ºæœ¬åœ°ç§»åŠ¨åº”ç”¨ ä» Java åˆ° Dart codelab Flutter cookbook èå…¥ Dart çš„ Bootstrapï¼šäº†è§£æ›´å¤šå…³äºè¿™é—¨è¯­è¨€çš„ä¿¡æ¯  åŒæ—¶ï¼Œä¸ Flutter ç¤¾åŒºè”ç³»èµ·æ¥!\n","permalink":"https://ohmyweekly.github.io/notes/write-your-first-flutter-app-part-two/","tags":["flutter","app"],"title":"ç¼–å†™ä½ çš„ç¬¬ä¸€ä¸ª Flutter åº”ç”¨ï¼Œç¬¬äºŒéƒ¨åˆ†"},{"categories":null,"contents":"æ¯•ç«Ÿè°äººç»ˆå¾—é¹¿, ä¸å¦‚ç»ˆæ—¥æ¢¦ä¸ºé±¼ã€‚\nå‹æƒ…é“¾æ¥  ohmycloud âœ” ohmycloudy âœ” ohmysummer âœ” ohmyshunny âœ” ohmysunny âœ” ohmyraku âœ” ohmypanda âœ” ohmyweekly âœ” rakulang âœ” ","permalink":"https://ohmyweekly.github.io/posts/about/","tags":null,"title":"ç¬¬ä¸€ç¯‡æ—¥å¿—"},{"categories":["programming"],"contents":"é‡è¦çš„æ¦‚å¿µ ä¸ Java ä¸åŒï¼ŒDart æ²¡æœ‰å…³é”®å­— \u0026ldquo;public\u0026rdquo;, \u0026ldquo;protected\u0026rdquo; å’Œ \u0026ldquo;private\u0026rdquo;ã€‚ å¦‚æœæ ‡è¯†ç¬¦ä»¥ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰å¼€å¤´ï¼Œåˆ™å®ƒç›¸å¯¹äºåº“æ˜¯ç§æœ‰çš„ã€‚ æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œå‚è€ƒåº“å’Œå¯è§æ€§ã€‚\nå˜é‡ var name = \u0026#39;Bob\u0026#39;; // ç±»å‹æ¨æ–­  dynamic name = \u0026#39;Bob\u0026#39;; // åŠ¨æ€ç±»å‹ String name = \u0026#39;Bob\u0026#39;; // æ˜¾å¼å£°æ˜ é»˜è®¤å€¼ æœªåˆå§‹åŒ–çš„å˜é‡é»˜è®¤å€¼æ˜¯ nullã€‚å³ä½¿å˜é‡æ˜¯æ•°å­—, ç±»å‹é»˜è®¤å€¼ä¹Ÿæ˜¯ null, å› ä¸ºåœ¨ Dart ä¸­ä¸€åˆ‡éƒ½æ˜¯å¯¹è±¡ï¼Œæ•°å­—ç±»å‹ä¹Ÿä¸ä¾‹å¤–ã€‚\nint lineCount; assert(lineCount == null); final å’Œ const ä½¿ç”¨ final å…³é”®å­—å£°æ˜çš„å˜é‡, å…¶å€¼åªèƒ½è¢«è®¾ç½®ä¸€æ¬¡, ä½¿ç”¨ const å…³é”®å­—å£°æ˜çš„å˜é‡, å…¶å€¼åœ¨ç¼–è¯‘æ—¶å°±å·²å›ºå®š:\nfinal name = \u0026#39;Bob\u0026#39;; // ä¸ä½¿ç”¨ç±»å‹æ³¨è§£ final String nickname = \u0026#39;Bobby\u0026#39;; name = \u0026#39;Alice\u0026#39;; // Error: final å˜é‡åªèƒ½è¢«è®¾ç½®ä¸€æ¬¡ const å£°æ˜ä¸€ä¸ªåœ¨ç¼–è¯‘æ—¶å°±å›ºå®šä¸å˜çš„å€¼, ä¾‹å¦‚æ•°å­—å­—é¢é‡ã€å­—ç¬¦ä¸²å­—é¢é‡:\nconst bar = 1000000; // å‹åŠ›å•ä½(dynes/cm2) const double atm = 1.01325 * bar; // ä¸€ä¸ªæ ‡å‡†å¤§æ°”å‹å¼º å†…ç½®ç±»å‹ Dart è¯­è¨€æ”¯æŒä»¥ä¸‹å†…ç½®ç±»å‹:\n   ç±»å‹ å­—é¢é‡ å¯¹è±¡     Number 2â¶Â³ -1    String \u0026lsquo;Hello\u0026rsquo;    Boolean true,false    List [1,2,3]    Set {\u0026lsquo;raku\u0026rsquo;,\u0026lsquo;perl\u0026rsquo;}    Map {\u0026lsquo;lan\u0026rsquo;: \u0026lsquo;raku\u0026rsquo;}    Rune \\u2665, \\u{1f600}    Symbol #dadix, #bar     ","permalink":"https://ohmyweekly.github.io/notes/dart/","tags":["dart","examples"],"title":"Dart å…¥é—¨"},{"categories":["programming"],"contents":"è¿™ä¸ªä»£ç å®éªŒå®¤æ•™ä½ å¦‚ä½•ä½¿ç”¨å®ç° Iterableç±»çš„é›†åˆ-ä¾‹å¦‚ Listå’Œ Setã€‚è¿­ä»£ç±»æ˜¯å„ç§ Dart åº”ç”¨ç¨‹åºçš„åŸºæœ¬æ„å»ºæ¨¡å—ï¼Œä½ å¯èƒ½å·²ç»åœ¨ä½¿ç”¨å®ƒä»¬ï¼Œç”šè‡³æ²¡æœ‰æ³¨æ„åˆ°ã€‚è¿™ä¸ªä»£ç å®éªŒå®¤å°†å¸®åŠ©ä½ å……åˆ†åˆ©ç”¨å®ƒä»¬ã€‚\nä½¿ç”¨åµŒå…¥å¼ DartPad ç¼–è¾‘å™¨ï¼Œä½ å¯ä»¥é€šè¿‡è¿è¡Œç¤ºä¾‹ä»£ç å’Œå®Œæˆç»ƒä¹ æ¥æµ‹è¯•ä½ çš„çŸ¥è¯†ã€‚\nè¦æƒ³ä»è¿™ä¸ª codelab ä¸­è·å¾—æœ€å¤§çš„æ”¶è·ï¼Œä½ åº”è¯¥å…·å¤‡åŸºæœ¬çš„ Dart è¯­æ³•çŸ¥è¯†ã€‚\næœ¬è¯¾ç¨‹åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ã€‚\n å¦‚ä½•è¯»å–ä¸€ä¸ª Iterable çš„å…ƒç´ ã€‚ å¦‚ä½•æ£€æŸ¥ä¸€ä¸ª Iterable çš„å…ƒç´ æ˜¯å¦æ»¡è¶³ä¸€ä¸ªæ¡ä»¶ã€‚ å¦‚ä½•è¿‡æ»¤ä¸€ä¸ª Iterable çš„å†…å®¹ã€‚ å¦‚ä½•å°†ä¸€ä¸ª Iterable çš„å†…å®¹æ˜ å°„åˆ°ä¸åŒçš„å€¼ã€‚  ä¼°è®¡å®Œæˆè¿™ä¸ªä»£ç å®éªŒæ‰€éœ€çš„æ—¶é—´: 60åˆ†é’Ÿã€‚\nä»€ä¹ˆæ˜¯é›†åˆ? é›†åˆæ˜¯ä»£è¡¨ä¸€ç»„å¯¹è±¡çš„å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡ç§°ä¸ºå…ƒç´ ã€‚è¿­ä»£å…ƒç´ æ˜¯é›†åˆçš„ä¸€ç§ã€‚\né›†åˆå¯ä»¥æ˜¯ç©ºçš„ï¼Œä¹Ÿå¯ä»¥åŒ…å«è®¸å¤šå…ƒç´ ã€‚æ ¹æ®ä¸åŒçš„ç›®çš„ï¼Œé›†åˆå¯ä»¥æœ‰ä¸åŒçš„ç»“æ„å’Œå®ç°ã€‚è¿™äº›æ˜¯ä¸€äº›æœ€å¸¸è§çš„é›†åˆç±»å‹:\n List: ç”¨æ¥é€šè¿‡ç´¢å¼•è¯»å–å…ƒç´ ã€‚ Set: ç”¨äºåŒ…å«åªèƒ½å‡ºç°ä¸€æ¬¡çš„å…ƒç´ ã€‚ Mapï¼šç”¨äºé€šè¿‡é”®æ¥è¯»å–å…ƒç´ ã€‚  ä»€ä¹ˆæ˜¯Iterable? Iterable æ˜¯ä¸€ä¸ªå…ƒç´ çš„é›†åˆï¼Œå®ƒå¯ä»¥è¢«ä¾æ¬¡è®¿é—®ã€‚\nåœ¨ Dart ä¸­ï¼ŒIterable æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œè¿™æ„å‘³ç€ä½ ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–å®ƒã€‚ç„¶è€Œï¼Œä½ å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªæ–°çš„ List æˆ– Set æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ Iterableã€‚\nList å’Œ Set éƒ½æ˜¯ Iterableï¼Œæ‰€ä»¥å®ƒä»¬å’Œ Iterable ç±»æœ‰ç›¸åŒçš„æ–¹æ³•å’Œå±æ€§ã€‚\nMap åœ¨å†…éƒ¨ä½¿ç”¨ä¸åŒçš„æ•°æ®ç»“æ„ï¼Œè¿™å–å†³äºå®ƒçš„å®ç°ã€‚ä¾‹å¦‚ï¼ŒHashMap ä½¿ç”¨äº†ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œå…¶ä¸­çš„å…ƒç´ (ä¹Ÿç§°ä¸ºå€¼)æ˜¯é€šè¿‡ä¸€ä¸ªé”®è·å¾—çš„ã€‚é€šè¿‡ä½¿ç”¨ Map çš„ entries æˆ– values å±æ€§ï¼ŒMap çš„å…ƒç´ ä¹Ÿå¯ä»¥ä½œä¸º Iterable å¯¹è±¡è¯»å–ã€‚\nè¿™ä¸ªä¾‹å­æ˜¾ç¤ºäº†ä¸€ä¸ª int çš„ Listï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ª int çš„ Iterable:\nIterable\u0026lt;int\u0026gt; iterable = [1, 2, 3]; ä¸ List çš„åŒºåˆ«åœ¨äºï¼Œä½¿ç”¨ Iterableï¼Œä½ æ— æ³•ä¿è¯æŒ‰ç´¢å¼•è¯»å–å…ƒç´ çš„æ•ˆç‡ã€‚Iterable ä¸ List ç›¸æ¯”ï¼Œæ²¡æœ‰ [] æ“ä½œç¬¦ã€‚\nä¾‹å¦‚ï¼Œè€ƒè™‘ä»¥ä¸‹ä»£ç ï¼Œè¿™æ˜¯æ— æ•ˆçš„:\nIterable\u0026lt;int\u0026gt; iterable = [1, 2, 3]; int value = iterable[1]; å¦‚æœä½ ç”¨ [] è¯»å–å…ƒç´ ï¼Œç¼–è¯‘å™¨ä¼šå‘Šè¯‰ä½  '[]' è¿™ä¸ªè¿ç®—ç¬¦æ²¡æœ‰ä¸º Iterable ç±»å®šä¹‰ï¼Œè¿™æ„å‘³ç€åœ¨è¿™ç§æƒ…å†µä¸‹ä½ ä¸èƒ½ä½¿ç”¨ [index]ã€‚\nä½ å¯ä»¥ç”¨ elementAt() æ¥è¯»å–å…ƒç´ ï¼Œå®ƒå¯ä»¥éå†è¿­ä»£çš„å…ƒç´ ï¼Œç›´åˆ°å®ƒåˆ°è¾¾é‚£ä¸ªä½ç½®ã€‚\nIterable\u0026lt;int\u0026gt; iterable = [1, 2, 3]; int value = iterable.elementAt(1); ç»§ç»­ä¸‹ä¸€èŠ‚ï¼Œäº†è§£æ›´å¤šå…³äºå¦‚ä½•è®¿é—® Iterable çš„å…ƒç´ ã€‚\nè¯»å–å…ƒç´  ä½ å¯ä»¥ä½¿ç”¨ for-in å¾ªç¯ï¼Œä¾æ¬¡è¯»å–ä¸€ä¸ªè¿­ä»£å…ƒç´ ã€‚\nä¾‹å­: ä½¿ç”¨ for-in å¾ªç¯ ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ for-in å¾ªç¯è¯»å–å…ƒç´ ã€‚\nvoid main() { var iterable = [\u0026#39;Salad\u0026#39;, \u0026#39;Popcorn\u0026#39;, \u0026#39;Toast\u0026#39;]; for (var element in iterable) { print(element); } } åœ¨å¹•åï¼Œfor-in å¾ªç¯ä½¿ç”¨äº†ä¸€ä¸ªè¿­ä»£å™¨ã€‚ç„¶è€Œï¼Œä½ å¾ˆå°‘çœ‹åˆ°ç›´æ¥ä½¿ç”¨è¿­ä»£å™¨ APIï¼Œå› ä¸º for-in æ›´å®¹æ˜“é˜…è¯»å’Œç†è§£ï¼Œè€Œä¸”ä¸å®¹æ˜“å‡ºé”™ã€‚\nå…³é”®æœ¯è¯­:\n Iterable: Dart Iterable ç±»ã€‚ Iterator: for-in ç”¨æ¥ä»ä¸€ä¸ª Iterable å¯¹è±¡ä¸­è¯»å–å…ƒç´ çš„å¯¹è±¡ã€‚ for-in å¾ªç¯: ä»ä¸€ä¸ª Iterable å¯¹è±¡ä¸­ä¾æ¬¡è¯»å–å…ƒç´ çš„ç®€å•æ–¹æ³•ã€‚  ä¾‹å­ï¼šä½¿ç”¨ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå…ƒç´  åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ åªæƒ³è®¿é—®ä¸€ä¸ª Iterable çš„ç¬¬ä¸€ä¸ªæˆ–æœ€åä¸€ä¸ªå…ƒç´ ã€‚\nåœ¨ Iterable ç±»ä¸­ï¼Œä½ ä¸èƒ½ç›´æ¥è®¿é—®å…ƒç´ ï¼Œæ‰€ä»¥ä½ ä¸èƒ½è°ƒç”¨ iterable[0] æ¥è®¿é—®ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ç›¸åï¼Œä½ å¯ä»¥ä½¿ç”¨ firstï¼Œå®ƒå¯ä»¥è·å–ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚\nå¦å¤–ï¼Œä½¿ç”¨ Iterable ç±»ï¼Œä½ ä¸èƒ½ä½¿ç”¨æ“ä½œç¬¦ [] æ¥è®¿é—®æœ€åä¸€ä¸ªå…ƒç´ ï¼Œä½†æ˜¯ä½ å¯ä»¥ä½¿ç”¨ last å±æ€§ã€‚\nå› ä¸ºè®¿é—®ä¸€ä¸ª Iterable çš„æœ€åä¸€ä¸ªå…ƒç´ éœ€è¦è¸è¿‡æ‰€æœ‰å…¶ä»–å…ƒç´ ï¼Œæ‰€ä»¥ last å¯èƒ½ä¼šå¾ˆæ…¢ã€‚åœ¨ä¸€ä¸ªç©ºçš„ Iterable ä¸Šä½¿ç”¨ first æˆ– last ä¼šå¯¼è‡´ä¸€ä¸ª StateErrorã€‚\nvoid main() { Iterable iterable = [\u0026#39;Salad\u0026#39;, \u0026#39;Popcorn\u0026#39;, \u0026#39;Toast\u0026#39;]; print(\u0026#39;The first element is ${iterable.first}\u0026#39;); print(\u0026#39;The last element is ${iterable.last}\u0026#39;); } åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨ first å’Œ last æ¥è·å¾—ä¸€ä¸ª Iterable çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå…ƒç´ ã€‚ä¹Ÿå¯ä»¥æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ä¸‹ä¸€èŠ‚å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨åä¸º firstWhere() çš„æ–¹æ³•æ¥å®ç°è¿™ä¸€ç›®æ ‡ã€‚\nä¾‹å­: ä½¿ç”¨ firstWhere() ä½ å·²ç»çœ‹åˆ°ï¼Œä½ å¯ä»¥ä¾æ¬¡è®¿é—®ä¸€ä¸ª Iterable çš„å…ƒç´ ï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°å¾—åˆ°ç¬¬ä¸€ä¸ªæˆ–æœ€åä¸€ä¸ªå…ƒç´ ã€‚\nç°åœ¨ï¼Œä½ è¦å­¦ä¹ å¦‚ä½•ä½¿ç”¨ firstWhere() æ¥å¯»æ‰¾æ»¡è¶³æŸäº›æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚è¿™ä¸ªæ–¹æ³•éœ€è¦ä½ ä¼ é€’ä¸€ä¸ªè°“è¯ï¼Œå®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœè¾“å…¥æ»¡è¶³ä¸€å®šçš„æ¡ä»¶å°±è¿”å› trueã€‚\nString element = iterable.firstWhere((element) =\u0026gt; element.length \u0026gt; 5); ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³æ‰¾åˆ°ç¬¬ä¸€ä¸ªè¶…è¿‡ 5 ä¸ªå­—ç¬¦çš„ Stringï¼Œä½ å¿…é¡»ä¼ é€’ä¸€ä¸ªå½“å…ƒç´ å¤§å°å¤§äº 5 æ—¶è¿”å› true çš„è°“è¯ã€‚\nè¿è¡Œä¸‹é¢çš„ä¾‹å­ï¼Œçœ‹çœ‹ firstWhere() æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚ä½ è®¤ä¸ºæ‰€æœ‰çš„å‡½æ•°éƒ½ä¼šç»™å‡ºç›¸åŒçš„ç»“æœå—ï¼Ÿ\nbool predicate(String element) { return element.length \u0026gt; 5; } main() { var items = [\u0026#39;Salad\u0026#39;, \u0026#39;Popcorn\u0026#39;, \u0026#39;Toast\u0026#39;, \u0026#39;Lasagne\u0026#39;]; // You can find with a simple expression:  var element1 = items.firstWhere((element) =\u0026gt; element.length \u0026gt; 5); print(element1); // Or try using a function block:  var element2 = items.firstWhere((element) { return element.length \u0026gt; 5; }); print(element2); // Or even pass in a function reference:  var element3 = items.firstWhere(predicate); print(element3); // You can also use an `orElse` function in case no value is found!  var element4 = items.firstWhere( (element) =\u0026gt; element.length \u0026gt; 10, orElse: () =\u0026gt; \u0026#39;None!\u0026#39;, ); print(element4); } åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°ä¸‰ç§ä¸åŒçš„æ–¹å¼æ¥å†™ä¸€ä¸ªè°“è¯ã€‚\n ä½œä¸ºä¸€ä¸ªè¡¨è¾¾å¼: æµ‹è¯•ä»£ç ä¸­æœ‰ä¸€è¡Œä½¿ç”¨äº†ç®­å¤´è¯­æ³•(=\u0026gt;)ã€‚ ä½œä¸ºä¸€ä¸ªå—: æµ‹è¯•ä»£ç åœ¨æ‹¬å·å’Œè¿”å›è¯­å¥ä¹‹é—´æœ‰å¤šè¡Œã€‚ ä½œä¸ºä¸€ä¸ªå‡½æ•°: æµ‹è¯•ä»£ç åœ¨ä¸€ä¸ªå¤–éƒ¨å‡½æ•°ä¸­ï¼Œä½œä¸ºå‚æ•°ä¼ é€’ç»™ firstWhere() æ–¹æ³•ã€‚  æ²¡æœ‰æ­£ç¡®æˆ–é”™è¯¯çš„æ–¹å¼ã€‚ä½¿ç”¨æœ€é€‚åˆä½ çš„æ–¹å¼ï¼Œå¹¶ä¸”è®©ä½ çš„ä»£ç æ›´å®¹æ˜“é˜…è¯»å’Œç†è§£ã€‚\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒfirstWhereWithOrElse() è°ƒç”¨ firstWhere() æ—¶ï¼Œä½¿ç”¨äº†å¯é€‰çš„å‘½åå‚æ•° orElseï¼Œå®ƒåœ¨æ²¡æœ‰æ‰¾åˆ°å…ƒç´ æ—¶æä¾›äº†ä¸€ä¸ªæ›¿ä»£æ–¹æ¡ˆã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿”å›æ–‡æœ¬ \u0026ldquo;None!\u0026quot;ï¼Œå› ä¸ºæ²¡æœ‰å…ƒç´ æ»¡è¶³æä¾›çš„æ¡ä»¶ã€‚\næ³¨æ„ï¼šå¦‚æœæ²¡æœ‰å…ƒç´ æ»¡è¶³æµ‹è¯•è°“è¯ï¼Œå¹¶ä¸”æ²¡æœ‰æä¾› orElse å‚æ•°ï¼Œé‚£ä¹ˆ firstWhere() ä¼šæŠ›å‡ºä¸€ä¸ª StateErrorã€‚\nå¿«é€Ÿå›é¡¾ã€‚\n Iterable çš„å…ƒç´ å¿…é¡»æŒ‰é¡ºåºè®¿é—®ã€‚ è¿­ä»£æ‰€æœ‰å…ƒç´ çš„æœ€ç®€å•æ–¹æ³•æ˜¯ä½¿ç”¨ for-in å¾ªç¯ã€‚ ä½ å¯ä»¥ä½¿ç”¨ first å’Œ last getters æ¥è·å–ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå…ƒç´ ã€‚ ä½ ä¹Ÿå¯ä»¥ç”¨ firstWhere() æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ ä½ å¯ä»¥æŠŠæµ‹è¯•è°“è¯å†™æˆè¡¨è¾¾å¼ã€å—æˆ–å‡½æ•°ã€‚  å…³é”®æœ¯è¯­ã€‚\nè°“è¯: å½“æŸä¸ªæ¡ä»¶è¢«æ»¡è¶³æ—¶ï¼Œè¿”å› true çš„å‡½æ•°ã€‚\nç»ƒä¹ : ç»ƒä¹ å†™ä¸€ä¸ªæµ‹è¯•è°“è¯ ä¸‹é¢çš„ç»ƒä¹ æ˜¯ä¸€ä¸ªå¤±è´¥çš„å•å…ƒæµ‹è¯•ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªéƒ¨åˆ†å®Œæ•´çš„ä»£ç ç‰‡æ®µã€‚ä½ çš„ä»»åŠ¡æ˜¯é€šè¿‡ç¼–å†™ä»£ç ä½¿æµ‹è¯•é€šè¿‡æ¥å®Œæˆç»ƒä¹ ã€‚ä½ ä¸éœ€è¦å®ç° main()ã€‚\nè¿™ä¸ªç»ƒä¹ ä»‹ç»äº† singleWhere() è¿™ä¸ªæ–¹æ³•çš„å·¥ä½œåŸç†ç±»ä¼¼äº firstWhere()ï¼Œä½†åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒåªæœŸæœ› Iterable ä¸­çš„ä¸€ä¸ªå…ƒç´ æ»¡è¶³è°“è¯ã€‚å¦‚æœ Iterable ä¸­è¶…è¿‡ä¸€ä¸ªæˆ–æ²¡æœ‰å…ƒç´ æ»¡è¶³è°“è¯æ¡ä»¶ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•ä¼šæŠ›å‡ºä¸€ä¸ª StateError å¼‚å¸¸ã€‚\nsingleWhere() å¯¹æ•´ä¸ª Iterable è¿›è¡Œæ­¥è¿›ï¼Œç›´åˆ°æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœ Iterable æ˜¯æ— é™çš„æˆ–åŒ…å«ä¸€ä¸ªå¤§çš„å…ƒç´ é›†åˆï¼Œè¿™å¯èƒ½ä¼šå¼•èµ·é—®é¢˜ã€‚\nä½ çš„ç›®æ ‡æ˜¯å®ç°æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„ singleWhere() è°“è¯ã€‚\n å…ƒç´ åŒ…å«å­—ç¬¦ \u0026lsquo;a\u0026rsquo;ã€‚ è¯¥å…ƒç´ ä»¥å­—ç¬¦ \u0026lsquo;M\u0026rsquo; å¼€å¤´ã€‚  æµ‹è¯•æ•°æ®ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œä½ å¯ä»¥æŸ¥çœ‹ç±»æ–‡æ¡£ä»¥è·å¾—å¸®åŠ©ã€‚\nString singleWhere(Iterable\u0026lt;String\u0026gt; items) { return items.singleWhere((element) =\u0026gt; element.startsWith(\u0026#39;M\u0026#39;) \u0026amp;\u0026amp; element.contains(\u0026#39;a\u0026#39;)); } æ£€æŸ¥æ¡ä»¶ åœ¨ä½¿ç”¨ Iterable æ—¶ï¼Œæœ‰æ—¶ä½ éœ€è¦éªŒè¯ä¸€ä¸ªé›†åˆçš„æ‰€æœ‰å…ƒç´ æ˜¯å¦æ»¡è¶³æŸäº›æ¡ä»¶ã€‚\nä½ å¯èƒ½ä¼šæƒ³ç”¨ for-in å¾ªç¯æ¥å†™ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚è¿™ä¸ª:\nfor (var item in items) { if (item.length \u0026lt; 5) { return false; } } return true; ç„¶è€Œï¼Œä½ å¯ä»¥ä½¿ç”¨ every() æ–¹æ³•å®ç°åŒæ ·çš„ç›®çš„:\nreturn items.every((element) =\u0026gt; element.length \u0026gt;= 5); ä½¿ç”¨ every() æ–¹æ³•å¯ä»¥ä½¿ä»£ç æ›´æ˜“è¯»ã€æ›´ç´§å‡‘ã€æ›´ä¸å®¹æ˜“å‡ºé”™ã€‚\nä¾‹å­: ä½¿ç”¨ any() å’Œ every() Iterable ç±»æä¾›äº†ä¸¤ä¸ªå¯ä»¥ç”¨æ¥éªŒè¯æ¡ä»¶çš„æ–¹æ³•ã€‚\n any(): å¦‚æœè‡³å°‘æœ‰ä¸€ä¸ªå…ƒç´ æ»¡è¶³æ¡ä»¶ï¼Œåˆ™è¿”å› trueã€‚ every(): å¦‚æœæ‰€æœ‰å…ƒç´ éƒ½æ»¡è¶³æ¡ä»¶ï¼Œåˆ™è¿”å› trueã€‚  è¿è¡Œè¿™ä¸ªç»ƒä¹ æ¥çœ‹çœ‹å®ƒä»¬çš„ä½œç”¨ã€‚\nvoid main() { var items = [\u0026#39;Salad\u0026#39;, \u0026#39;Popcorn\u0026#39;, \u0026#39;Toast\u0026#39;]; if (items.any((element) =\u0026gt; element.contains(\u0026#39;a\u0026#39;))) { print(\u0026#39;At least one element contains \u0026#34;a\u0026#34;\u0026#39;); } if (items.every((element) =\u0026gt; element.length \u0026gt;= 5)) { print(\u0026#39;All elements have length \u0026gt;= 5\u0026#39;); } } åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œany() éªŒè¯äº†è‡³å°‘ä¸€ä¸ªå…ƒç´ åŒ…å«å­—ç¬¦ aï¼Œevery() éªŒè¯äº†æ‰€æœ‰å…ƒç´ çš„é•¿åº¦ç­‰äºæˆ–å¤§äº 5ã€‚\nè¿è¡Œä»£ç åï¼Œå°è¯•æ›´æ”¹ any() çš„è°“è¯ï¼Œä½¿å…¶è¿”å› false:\nif (items.any((element) =\u0026gt; element.contains(\u0026#39;Z\u0026#39;))) { print(\u0026#39;At least one element contains \u0026#34;Z\u0026#34;\u0026#39;); } else { print(\u0026#39;No element contains \u0026#34;Z\u0026#34;\u0026#39;); } ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ any() æ¥éªŒè¯ä¸€ä¸ª Iterable ä¸­æ²¡æœ‰å…ƒç´ æ»¡è¶³æŸä¸ªæ¡ä»¶ã€‚\nç»ƒä¹ ï¼š éªŒè¯ä¸€ä¸ª Iterable æ˜¯å¦æ»¡è¶³ä¸€ä¸ªæ¡ä»¶ ä¸‹é¢çš„ç»ƒä¹ æä¾›äº†ä½¿ç”¨å‰é¢ä¾‹å­ä¸­æè¿°çš„ any() å’Œ every() æ–¹æ³•çš„ç»ƒä¹ ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œä½ çš„å·¥ä½œå¯¹è±¡æ˜¯ä¸€ç»„ç”¨æˆ·ï¼Œç”±å…·æœ‰æˆå‘˜å­—æ®µ age çš„ User å¯¹è±¡è¡¨ç¤ºã€‚\nä½¿ç”¨ any() å’Œ every() å®ç°ä¸¤ä¸ªå‡½æ•°ã€‚\n ç¬¬1éƒ¨åˆ†ï¼šå®ç° anyUserUnder18()ã€‚  å¦‚æœè‡³å°‘æœ‰ä¸€ä¸ªç”¨æˆ·æ˜¯17å²æˆ–æ›´å°ï¼Œåˆ™è¿”å› trueã€‚   ç¬¬2éƒ¨åˆ†ï¼šå®ç° everyUserOver13()ã€‚  å¦‚æœæ‰€æœ‰ç”¨æˆ·éƒ½æ˜¯14å²æˆ–ä»¥ä¸Šï¼Œåˆ™è¿”å› trueã€‚    bool anyUserUnder18(Iterable\u0026lt;User\u0026gt; users) { return users.any((user) =\u0026gt; user.age \u0026lt; 18); } bool everyUserOver13(Iterable\u0026lt;User\u0026gt; users) { return users.every((user) =\u0026gt; user.age \u0026gt; 13); } class User { String name; int age; User( this.name, this.age, ); } å¿«é€Ÿå›é¡¾:\n è™½ç„¶ä½ å¯ä»¥ä½¿ç”¨ for-in å¾ªç¯æ¥æ£€æŸ¥æ¡ä»¶ï¼Œä½†è¿˜æœ‰æ›´å¥½çš„æ–¹æ³•ã€‚ æ–¹æ³• any() å¯ä»¥è®©ä½ æ£€æŸ¥ä»»ä½•å…ƒç´ æ˜¯å¦æ»¡è¶³æ¡ä»¶ã€‚ æ–¹æ³• every() å¯ä»¥è®©ä½ éªŒè¯æ‰€æœ‰å…ƒç´ æ˜¯å¦æ»¡è¶³æ¡ä»¶ã€‚  è¿‡æ»¤ å‰é¢çš„ç« èŠ‚ä»‹ç»äº† firstWhere() æˆ– singleWhere() ç­‰æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å¯ä»¥å¸®åŠ©ä½ æ‰¾åˆ°æ»¡è¶³æŸä¸ªè°“è¯çš„å…ƒç´ ã€‚\nä½†æ˜¯å¦‚æœä½ æƒ³æ‰¾åˆ°æ»¡è¶³æŸä¸ªæ¡ä»¶çš„æ‰€æœ‰å…ƒç´ å‘¢ï¼Ÿä½ å¯ä»¥ä½¿ç”¨ where() æ–¹æ³•æ¥å®ç°ã€‚\nvar evenNumbers = numbers.where((number) =\u0026gt; number.isEven); åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œnumbers åŒ…å«ä¸€ä¸ªæœ‰å¤šä¸ª int å€¼çš„ Iterableï¼Œwhere() å¯ä»¥æ‰¾åˆ°æ‰€æœ‰å¶æ•°çš„æ•°å­—ã€‚\nwhere() çš„è¾“å‡ºæ˜¯å¦ä¸€ä¸ª Iterableï¼Œä½ å¯ä»¥ç”¨å®ƒæ¥è¿­ä»£å®ƒæˆ–åº”ç”¨å…¶ä»– Iterable æ–¹æ³•ã€‚åœ¨ä¸‹ä¸€ä¸ªä¾‹å­ä¸­ï¼Œwhere() çš„è¾“å‡ºç›´æ¥åœ¨ for-in å¾ªç¯ä¸­ä½¿ç”¨ã€‚\nvar evenNumbers = numbers.where((number) =\u0026gt; number.isEven); for (var number in evenNumbers) { print(\u0026#39;$numberis even\u0026#39;); } ä¾‹å­: ä½¿ç”¨ where() è¿è¡Œè¿™ä¸ªä¾‹å­ï¼Œçœ‹çœ‹å¦‚ä½•å°† where() ä¸å…¶ä»–æ–¹æ³•å¦‚ any() ä¸€èµ·ä½¿ç”¨ã€‚\nmain() { var evenNumbers = [1, -2, 3, 42].where((number) =\u0026gt; number.isEven); for (var number in evenNumbers) { print(\u0026#39;$numberis even.\u0026#39;); } if (evenNumbers.any((number) =\u0026gt; number.isNegative)) { print(\u0026#39;evenNumbers contains negative numbers.\u0026#39;); } // If no element satisfies the predicate, the output is empty.  var largeNumbers = evenNumbers.where((number) =\u0026gt; number \u0026gt; 1000); if (largeNumbers.isEmpty) { print(\u0026#39;largeNumbers is empty!\u0026#39;); } } åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œwhere() ç”¨äºæŸ¥æ‰¾æ‰€æœ‰å¶æ•°ï¼Œç„¶åç”¨ any() æ£€æŸ¥ç»“æœæ˜¯å¦åŒ…å«è´Ÿæ•°ã€‚\nåœ¨æœ¬ä¾‹çš„åé¢ï¼Œå†æ¬¡ä½¿ç”¨ where() æ¥æŸ¥æ‰¾æ‰€æœ‰å¤§äº1000çš„æ•°å­—ï¼Œç”±äºæ²¡æœ‰ï¼Œç»“æœæ˜¯ä¸€ä¸ªç©ºçš„ Iterableã€‚\næ³¨æ„ï¼šå¦‚æœæ²¡æœ‰å…ƒç´ æ»¡è¶³ where() ä¸­çš„è°“è¯ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªç©ºçš„ Iterableã€‚ä¸ singleWhere() æˆ– firstWhere() ä¸åŒï¼Œwhere() ä¸ä¼šæŠ›å‡º StateError å¼‚å¸¸ã€‚\nä¾‹å­: ä½¿ç”¨ takeWhile æ–¹æ³• takeWhile() å’Œ skipWhile() ä¹Ÿå¯ä»¥å¸®åŠ©ä½ ä»ä¸€ä¸ª Iterable ä¸­è¿‡æ»¤å…ƒç´ ã€‚\nè¿è¡Œè¿™ä¸ªä¾‹å­ï¼Œçœ‹çœ‹ takeWhile() å’Œ skipWhile() å¦‚ä½•åˆ†å‰²ä¸€ä¸ªåŒ…å«æ•°å­—çš„ Iterableã€‚\nmain() { var numbers = [1, 3, -2, 0, 4, 5]; var numbersUntilZero = numbers.takeWhile((number) =\u0026gt; number != 0); print(\u0026#39;Numbers until 0: $numbersUntilZero\u0026#39;); var numbersAfterZero = numbers.skipWhile((number) =\u0026gt; number != 0); print(\u0026#39;Numbers after 0: $numbersAfterZero\u0026#39;); } è¾“å‡ºå¦‚ä¸‹:\nNumbers until 0: (1, 3, -2) Numbers after 0: (0, 4, 5) åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒtakeWhile() è¿”å›ä¸€ä¸ª Iterableï¼Œå®ƒåŒ…å«äº†é€šå¾€æ»¡è¶³è°“è¯çš„å…ƒç´ çš„æ‰€æœ‰å…ƒç´ ã€‚å¦ä¸€æ–¹é¢ï¼Œ skipWhile() è¿”å›ä¸€ä¸ª Iterableï¼ŒåŒæ—¶è·³è¿‡æ»¡è¶³è°“è¯çš„å…ƒç´ ä¹‹å‰çš„æ‰€æœ‰å…ƒç´ ã€‚è¯·æ³¨æ„ï¼Œæ»¡è¶³è°“è¯çš„å…ƒç´ ä¹Ÿä¼šè¢«åŒ…å«åœ¨å†…ã€‚\nè¿è¡Œè¯¥ç¤ºä¾‹åï¼Œå°† takeWhile() æ”¹ä¸ºå–å…ƒç´ ï¼Œç›´åˆ°åˆ°è¾¾ç¬¬ä¸€ä¸ªè´Ÿæ•°ã€‚\nvar numbersUntilNegative = numbers.takeWhile((number) =\u0026gt; !number.isNegative); æ³¨æ„ï¼Œæ¡ä»¶ number.isNegative æ˜¯ç”¨ ! å¦å®šçš„ã€‚\nç»ƒä¹ : ä»åˆ—è¡¨ä¸­è¿‡æ»¤å…ƒç´  ä¸‹é¢çš„ç»ƒä¹ æä¾›äº†ä½¿ç”¨ä¸Šä¸€ç»ƒä¹ ä¸­çš„ User ç±»çš„ where() æ–¹æ³•çš„ç»ƒä¹ ã€‚\nä½¿ç”¨ where() å®ç°ä¸¤ä¸ªå‡½æ•°ã€‚\n ç¬¬1éƒ¨åˆ†ï¼šå®ç° filterUnder21()ã€‚  è¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰21å²ä»¥ä¸Šç”¨æˆ·çš„ Iterableã€‚   ç¬¬2éƒ¨åˆ†ï¼šå®ç° findShortNamed()ã€‚  è¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰åå­—é•¿åº¦ä¸º 3 æˆ–æ›´å°‘çš„ç”¨æˆ·çš„ Iterableã€‚    Iterable\u0026lt;User\u0026gt; filterUnder21(Iterable\u0026lt;User\u0026gt; users) { return users.where((user) =\u0026gt; user.age \u0026gt;= 21); } Iterable\u0026lt;User\u0026gt; findShortNamed(Iterable\u0026lt;User\u0026gt; users) { return users.where((user) =\u0026gt; user.name.length \u0026lt;= 3); } class User { String name; int age; User( this.name, this.age, ); } å¿«é€Ÿå›é¡¾:\n ç”¨ where() è¿‡æ»¤ä¸€ä¸ª Iterable çš„å…ƒç´ ã€‚ where() çš„è¾“å‡ºæ˜¯å¦ä¸€ä¸ª Iterableã€‚ ä½¿ç”¨ takeWhile() å’Œ skipWhile() æ¥è·å–å…ƒç´ ï¼Œç›´åˆ°æ»¡è¶³ä¸€ä¸ªæ¡ä»¶æˆ–ä¹‹åã€‚ è¿™äº›æ–¹æ³•çš„è¾“å‡ºå¯ä»¥æ˜¯ä¸€ä¸ªç©ºçš„ Iterableã€‚  Map é€šè¿‡ map() æ–¹æ³•æ˜ å°„ Iterablesï¼Œä½ å¯ä»¥åœ¨æ¯ä¸ªå…ƒç´ ä¸Šåº”ç”¨ä¸€ä¸ªå‡½æ•°ï¼Œç”¨ä¸€ä¸ªæ–°çš„å…ƒç´ æ›¿æ¢æ¯ä¸ªå…ƒç´ ã€‚\nIterable\u0026lt;int\u0026gt; output = numbers.map((number) =\u0026gt; number * 10); åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒIterable æ•°å­—çš„æ¯ä¸ªå…ƒç´ éƒ½è¢«ä¹˜ä»¥ 10ã€‚\nä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ map() å°†ä¸€ä¸ªå…ƒç´ è½¬æ¢ä¸ºä¸åŒçš„å¯¹è±¡-ä¾‹å¦‚ï¼Œå°†æ‰€æœ‰ int è½¬æ¢ä¸º Stringï¼Œåœ¨ä¸‹é¢çš„ä¾‹å­ä¸­å¯ä»¥çœ‹åˆ°ã€‚\nIterable\u0026lt;String\u0026gt; output = numbers.map((number) =\u0026gt; number.toString()); æ³¨æ„ï¼šmap() è¿”å›ä¸€ä¸ªæ‡’æƒ°çš„ Iterableï¼Œè¿™æ„å‘³ç€åªæœ‰åœ¨å…ƒç´ è¢«è¿­ä»£æ—¶æ‰ä¼šè°ƒç”¨æ‰€æä¾›çš„å‡½æ•°ã€‚\nä¾‹å­: ä½¿ç”¨ map æ”¹å˜å…ƒç´  è¿è¡Œè¿™ä¸ªä¾‹å­ï¼Œçœ‹çœ‹å¦‚ä½•ä½¿ç”¨ map() å°†ä¸€ä¸ª Iterable ä¸­çš„æ‰€æœ‰å…ƒç´ ä¹˜ä»¥2ï¼Œä½ è®¤ä¸ºè¾“å‡ºä¼šæ˜¯ä»€ä¹ˆï¼Ÿ\nmain() { var numbersByTwo = [1, -2, 3, 42].map((number) =\u0026gt; number * 2); print(\u0026#39;Numbers: $numbersByTwo.\u0026#39;); } ç»ƒä¹ : æ˜ å°„åˆ°ä¸åŒç±»å‹ åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œä½ æŠŠä¸€ä¸ª Iterable çš„å…ƒç´ ä¹˜ä»¥2ï¼Œè¾“å…¥å’Œè¾“å‡ºéƒ½æ˜¯ int çš„ Iterableã€‚\nåœ¨è¿™ä¸ªç»ƒä¹ ä¸­ï¼Œä½ çš„ä»£ç æ¥æ”¶ä¸€ä¸ª Userçš„ Iterableï¼Œä½ éœ€è¦è¿”å›ä¸€ä¸ªåŒ…å«ç”¨æˆ·åå’Œå¹´é¾„çš„å­—ç¬¦ä¸²çš„ Iterableã€‚\nIterable ä¸­çš„æ¯ä¸ªå­—ç¬¦ä¸²å¿…é¡»éµå¾ªè¿™æ ·çš„æ ¼å¼ã€‚'{name} is {age}'-ä¾‹å¦‚ 'Alice is 21'ã€‚\nIterable\u0026lt;String\u0026gt; getNameAndAges(Iterable\u0026lt;User\u0026gt; users) { return users.map((user) =\u0026gt; \u0026#39;${user.name}is ${user.age}\u0026#39;); } class User { String name; int age; User( this.name, this.age, ); } å¿«é€Ÿå›é¡¾:\n map() å°†ä¸€ä¸ªå‡½æ•°åº”ç”¨äºä¸€ä¸ª Iterable çš„æ‰€æœ‰å…ƒç´ ã€‚ map() çš„è¾“å‡ºæ˜¯å¦ä¸€ä¸ª Iterableã€‚ åœ¨ Iterable è¢«è¿­ä»£ä¹‹å‰ï¼Œå‡½æ•°ä¸ä¼šè¢«è®¡ç®—ã€‚  ç»ƒä¹ : æŠŠæ‰€æœ‰çš„ä¸œè¥¿æ”¾åœ¨ä¸€èµ· ç°åœ¨æ˜¯ç»ƒä¹ æ‰€å­¦çŸ¥è¯†çš„æ—¶å€™äº†ï¼Œåœ¨æœ€åä¸€ä¸ªç»ƒä¹ ä¸­ã€‚\nè¿™ä¸ªç»ƒä¹ æä¾›äº†ç±» EmailAddressï¼Œå®ƒæœ‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚å¦ä¸€ä¸ªæä¾›çš„å‡½æ•°æ˜¯ isValidEmailAddress()ï¼Œå®ƒæµ‹è¯•ä¸€ä¸ªç”µå­é‚®ä»¶åœ°å€æ˜¯å¦æœ‰æ•ˆã€‚\n   æ„é€ å‡½æ•°/å‡½æ•° ç±»å‹ç­¾å æè¿°     EmailAddress() EmailAddress(String address) ä¸ºæŒ‡å®šçš„åœ°å€åˆ›å»ºä¸€ä¸ª EmailAddressã€‚   isValidEmailAddress() bool isValidEmailAddress(EmailAddress) å¦‚æœæä¾›çš„ EmailAddress æœ‰æ•ˆï¼Œè¿”å› trueã€‚    ç¼–å†™ä»¥ä¸‹ä»£ç ã€‚\nç¬¬1éƒ¨åˆ†ï¼šå®ç° parseEmailAddresses()ã€‚\n ç¼–å†™å‡½æ•° parseEmailAddresses()ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªåŒ…å«ç”µå­é‚®ä»¶åœ°å€çš„ Iterable\u0026lt;String\u0026gt;ï¼Œå¹¶è¿”å›ä¸€ä¸ª Iterable\u0026lt;EmailAddress\u0026gt;ã€‚ ä½¿ç”¨æ–¹æ³• map() ä» String æ˜ å°„åˆ° EmailAddressã€‚ ä½¿ç”¨æ„é€ å‡½æ•° EmailAddress(String) åˆ›å»º EmailAddress å¯¹è±¡ã€‚  ç¬¬äºŒéƒ¨åˆ†ï¼šå®ç° anyInvalidEmailAddress()ã€‚\n ç¼–å†™å‡½æ•° anyInvalidEmailAddress()ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ª Iterable\u0026lt;EmailAddress\u0026gt;ï¼Œå¹¶åœ¨ Iterable ä¸­çš„ä»»ä½• EmailAddress æ— æ•ˆæ—¶è¿”å› trueã€‚ ä½¿ç”¨æ–¹æ³• any() å’Œæä¾›çš„å‡½ isValidEmailAddress()ã€‚  ç¬¬3éƒ¨åˆ†ï¼šå®ç° validEmailAddresses()ã€‚\n ç¼–å†™å‡½æ•° validEmailAddresses()ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ª Iterable\u0026lt;EmailAddress\u0026gt; å¹¶è¿”å›å¦ä¸€ä¸ªåªåŒ…å«æœ‰æ•ˆåœ°å€çš„ Iterable\u0026lt;EmailAddress\u0026gt;ã€‚ ä½¿ç”¨æ–¹æ³• where() æ¥è¿‡æ»¤ Iterable\u0026lt;EmailAddress\u0026gt;ã€‚ ä½¿ç”¨æä¾›çš„å‡½æ•° isValidEmailAddress() æ¥è¯„ä¼°ä¸€ä¸ª EmailAddress æ˜¯å¦æœ‰æ•ˆã€‚  Iterable\u0026lt;EmailAddress\u0026gt; parseEmailAddresses(Iterable\u0026lt;String\u0026gt; strings) { return strings.map((s) =\u0026gt; EmailAddress(s)); } bool anyInvalidEmailAddress(Iterable\u0026lt;EmailAddress\u0026gt; emails) { return emails.any((email) =\u0026gt; !isValidEmailAddress(email)); } Iterable\u0026lt;EmailAddress\u0026gt; validEmailAddresses(Iterable\u0026lt;EmailAddress\u0026gt; emails) { return emails.where((email) =\u0026gt; isValidEmailAddress(email)); } class EmailAddress { String address; EmailAddress(this.address); @override bool operator ==(Object other) =\u0026gt; identical(this, other) || other is EmailAddress \u0026amp;\u0026amp; runtimeType == other.runtimeType \u0026amp;\u0026amp; address == other.address; @override int get hashCode =\u0026gt; address.hashCode; @override String toString() { return \u0026#39;EmailAddress{address: $address}\u0026#39;; } } ä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆ? æ­å–œä½ ï¼Œä½ å®Œæˆäº† codelab çš„å­¦ä¹ ! å¦‚æœä½ æƒ³äº†è§£æ›´å¤šï¼Œè¿™é‡Œæœ‰ä¸€äº›ä¸‹ä¸€æ­¥çš„å»ºè®®ã€‚\n ç©ç© DartPadã€‚ è¯•è¯•å¦ä¸€ä¸ªä»£ç å®éªŒã€‚ é˜…è¯» Iterable API å‚è€ƒèµ„æ–™ï¼Œäº†è§£æœ¬ codelab æœªæ¶‰åŠçš„æ–¹æ³•ã€‚  ","permalink":"https://ohmyweekly.github.io/notes/dart-iterable-collections/","tags":["iterable","collection","dart"],"title":"Dart å¯è¿­ä»£é›†åˆ"},{"categories":["programming"],"contents":"å­—ç¬¦ä¸²æ’å€¼ ä½¿ç”¨ ${expression} å°†è¡¨è¾¾å¼çš„å€¼æ”¾åˆ°å­—ç¬¦ä¸²é‡Œé¢ã€‚å¦‚æœè¡¨è¾¾å¼æ˜¯ä¸€ä¸ªæ ‡è¯†ç¬¦, å°±å¯ä»¥çœç•¥ {}ã€‚\nä¸‹é¢æ˜¯å­—ç¬¦ä¸²æ’å€¼çš„ä¾‹å­:\n   å­—ç¬¦ä¸² ç»“æœ     \u0026lsquo;${3 + 2}\u0026rsquo; \u0026lsquo;5\u0026rsquo;   \u0026lsquo;${\u0026ldquo;word\u0026rdquo;.toUpperCase()}\u0026rsquo; \u0026lsquo;WORD\u0026rsquo;   \u0026lsquo;$myObject\u0026rsquo; The value of myObject.toString()    ä»£ç ç¤ºä¾‹ ä¸‹é¢çš„å‡½æ•°æ¥æ”¶ä¸¤ä¸ªæ•´æ•°ä½œä¸ºå‚æ•°ã€‚ä½¿å…¶è¿”å›ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªæ•´æ•°çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä»¥ç©ºæ ¼åˆ†éš”ã€‚ä¾‹å¦‚ stringify(2, 3) åº”è¯¥è¿”å› \u0026lsquo;2 3\u0026rsquo;ã€‚\nString stringify(int x, int y) { return \u0026#39;$x$y\u0026#39;; } Null æ— æ„ŸçŸ¥æ“ä½œç¬¦ Dart æä¾›äº†ä¸€äº›æ–¹ä¾¿çš„æ“ä½œç¬¦æ¥å¤„ç†å¯èƒ½ä¸ºç©ºçš„å€¼ã€‚å…¶ä¸­ä¸€ä¸ªæ˜¯ ??= èµ‹å€¼è¿ç®—ç¬¦ï¼Œåªæœ‰å½“ä¸€ä¸ªå˜é‡å½“å‰ä¸ºç©ºæ—¶ï¼Œå®ƒæ‰ä¼šç»™è¿™ä¸ªå˜é‡èµ‹å€¼:\nint a; // a çš„åˆå§‹å€¼ä¸º null a ??= 3; print(a); // æ‰“å° 3  a ??= 5; print(a); // ä»ç„¶æ‰“å° 3 å¦ä¸€ä¸ª null-aware æ“ä½œç¬¦æ˜¯ ??ï¼Œå®ƒè¿”å›å…¶å·¦è¾¹çš„è¡¨è¾¾å¼ï¼Œé™¤éè¯¥è¡¨è¾¾å¼çš„å€¼ä¸º nullï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒè®¡ç®—å¹¶è¿”å›å…¶å³è¾¹çš„è¡¨è¾¾å¼:\nprint(1 ?? 3); // æ‰“å° 1 print(null ?? 12); // æ‰“å° 12 ä»£ç ç¤ºä¾‹ String foo = \u0026#39;a string\u0026#39;; String bar; // Unassigned objects are null by default.  // makes \u0026#39;a string\u0026#39; be assigned to baz. String baz = foo ?? bar; void updateSomeVars() { // makes \u0026#39;a string\u0026#39; be assigned to bar.  bar ??= \u0026#39;a string\u0026#39;; } æœ‰æ¡ä»¶çš„å±æ€§è®¿é—® è¦ä¿æŠ¤å¯¹å¯¹è±¡çš„ä¸€ä¸ªå¯èƒ½ä¸ºç©ºçš„å±æ€§æˆ–æ–¹æ³•çš„è®¿é—®ï¼Œè¯·åœ¨ç‚¹(.)å‰åŠ ä¸Šä¸€ä¸ªé—®å·(?):\nmyObject?.someProperty ä¸Šè¿°ä»£ç ç­‰åŒäºä»¥ä¸‹ä»£ç :\n(myObject != null) ? myObject.someProperty : null ä½ å¯ä»¥åœ¨ä¸€ä¸ªè¡¨è¾¾å¼ä¸­æŠŠ ?. çš„å¤šä¸ªä½¿ç”¨é“¾æ¥åœ¨ä¸€èµ·:\nmyObject?.someProperty?.someMethod() å¦‚æœ myObject æˆ– myObject.someProperty ä¸º nullï¼Œå‰é¢çš„ä»£ç å°†è¿”å› null(å¹¶ä¸”ä»ä¸è°ƒç”¨ someMethod())ã€‚\nä»£ç ç¤ºä¾‹ å°è¯•ä½¿ç”¨æ¡ä»¶å±æ€§è®¿é—®æ¥å®Œæˆä¸‹é¢çš„ä»£ç ç‰‡æ®µã€‚\n// This method should return the uppercase version of `str` // or null if `str` is null. String upperCaseIt(String str) { // Try conditionally accessing the `toUpperCase` method here.  return str?.toUpperCase(); } é›†åˆå­—é¢é‡ Dart å†…ç½®äº†å¯¹åˆ—è¡¨ã€æ˜ å°„å’Œé›†åˆçš„æ”¯æŒã€‚ä½ å¯ä»¥ä½¿ç”¨å­—é¢é‡åˆ›å»ºå®ƒä»¬:\nfinal aListOfStrings = [\u0026#39;one\u0026#39;, \u0026#39;two\u0026#39;, \u0026#39;three\u0026#39;]; final aSetOfStrings = {\u0026#39;one\u0026#39;, \u0026#39;two\u0026#39;, \u0026#39;three\u0026#39;}; final aMapOfStringsToInts = { \u0026#39;one\u0026#39;: 1, \u0026#39;two\u0026#39;: 2, \u0026#39;three\u0026#39;: 3, } Dart çš„ç±»å‹æ¨ç†å¯ä»¥ä¸ºä½ åˆ†é…ç±»å‹ç»™è¿™äº›å˜é‡ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæ¨æ–­çš„ç±»å‹æ˜¯ List\u0026lt;String\u0026gt;ã€Set\u0026lt;String\u0026gt; å’Œ Map\u0026lt;String, int\u0026gt;ã€‚\næˆ–è€…ä½ å¯ä»¥è‡ªå·±æŒ‡å®šç±»å‹:\nfinal aListOfInts = \u0026lt;int\u0026gt;[]; final aSetOfInts = \u0026lt;int\u0026gt;{}; final aMapOfIntToDouble = \u0026lt;int, double\u0026gt;{}; å½“ä½ ç”¨å­ç±»å‹çš„å†…å®¹åˆå§‹åŒ–ä¸€ä¸ªåˆ—è¡¨ï¼Œä½†ä»ç„¶å¸Œæœ›åˆ—è¡¨æ˜¯ List\u0026lt;BaseType\u0026gt; æ—¶ï¼ŒæŒ‡å®šç±»å‹æ˜¯å¾ˆæ–¹ä¾¿çš„:\nfinal aListOfBaseType = \u0026lt;BaseType\u0026gt;[SubType(), SubType()]; ä»£ç ç¤ºä¾‹ å°è¯•å°†ä»¥ä¸‹å˜é‡è®¾ç½®ä¸ºæŒ‡å®šçš„å€¼ã€‚\n// Assign this a list containing \u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;, and \u0026#39;c\u0026#39; in that order: final aListOfStrings = [\u0026#39;a\u0026#39;, \u0026#39;b\u0026#39;, \u0026#39;c\u0026#39;]; // Assign this a set containing 3, 4, and 5: final aSetOfInts = {3, 4, 5}; // Assign this a map of String to int so that aMapOfStringsToInts[\u0026#39;myKey\u0026#39;] returns 12: final aMapOfStringsToInts = {\u0026#39;myKey\u0026#39;: 12}; // Assign this an empty List\u0026lt;double\u0026gt;: final anEmptyListOfDouble = \u0026lt;double\u0026gt;[]; // Assign this an empty Set\u0026lt;String\u0026gt;: final anEmptySetOfString = \u0026lt;String\u0026gt;{}; // Assign this an empty Map of double to int: final anEmptyMapOfDoublesToInts = \u0026lt;double, int\u0026gt;{}; ç®­å¤´è¯­æ³• ä½ å¯èƒ½åœ¨ Dart ä»£ç ä¸­çœ‹åˆ°è¿‡ =\u0026gt; ç¬¦å·ã€‚è¿™ç§ç®­å¤´è¯­æ³•æ˜¯ä¸€ç§å®šä¹‰å‡½æ•°çš„æ–¹å¼ï¼Œè¯¥å‡½æ•°æ‰§è¡Œå…¶å³è¾¹çš„è¡¨è¾¾å¼å¹¶è¿”å›å…¶å€¼ã€‚\nä¾‹å¦‚ï¼Œè€ƒè™‘è¿™ä¸ªå¯¹ List ç±»çš„ any() æ–¹æ³•çš„è°ƒç”¨:\nbool hasEmpty = aListOfStrings.any((s) { return s.isEmpty; }); è¿™é‡Œæœ‰ä¸€ä¸ªæ›´ç®€å•çš„æ–¹æ³•æ¥å†™è¿™ä¸ªä»£ç :\nbool hasEmpty = aListOfStrings.any((s) =\u0026gt; s.isEmpty); ä»£ç ç¤ºä¾‹ è¯•ç€å®Œæˆä»¥ä¸‹ä½¿ç”¨ç®­å¤´è¯­æ³•çš„è¯­å¥:\nclass MyClass { int _value1 = 2; int _value2 = 3; int _value3 = 5; // Returns the product of the above values:  int get product =\u0026gt; _value1 * _value2 * _value3; // Adds one to _value1:  void incrementValue1() =\u0026gt; _value1++; // Returns a string containing each item in the  // list, separated by commas (e.g. \u0026#39;a,b,c\u0026#39;):  String joinWithCommas(List\u0026lt;String\u0026gt; strings) =\u0026gt; strings.join(\u0026#39;,\u0026#39;); } çº§è” è¦å¯¹åŒä¸€å¯¹è±¡è¿›è¡Œä¸€ç³»åˆ—æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨çº§è”(...)ã€‚æˆ‘ä»¬éƒ½è§è¿‡è¿™æ ·çš„è¡¨è¾¾å¼:\nmyObject.someMethod() å®ƒåœ¨ myObject ä¸Šè°ƒç”¨ someMethod()ï¼Œè¡¨è¾¾å¼çš„ç»“æœæ˜¯ someMethod() çš„è¿”å›å€¼ã€‚\nä¸‹é¢æ˜¯åŒæ ·çš„è¡¨è¾¾å¼ï¼Œæœ‰ä¸€ä¸ªçº§è”:\nmyObject..someMethod() è™½ç„¶å®ƒä»ç„¶åœ¨ myObject ä¸Šè°ƒç”¨ someMethod()ï¼Œä½†è¡¨è¾¾å¼çš„ç»“æœå¹¶ä¸æ˜¯è¿”å›å€¼-å®ƒæ˜¯å¯¹ myObject çš„å¼•ç”¨! ä½¿ç”¨çº§è”ï¼Œä½ å¯ä»¥å°†åŸæœ¬éœ€è¦å•ç‹¬è¯­å¥çš„æ“ä½œä¸²è”èµ·æ¥ã€‚ä¾‹å¦‚ï¼Œè¯·çœ‹ä»¥ä¸‹ä»£ç :\nvar button = querySelector(\u0026#39;#confirm\u0026#39;); button.text = \u0026#39;Confirm\u0026#39;; button.classes.add(\u0026#39;important\u0026#39;); button.onClick.listen((e) =\u0026gt; window.alert(\u0026#39;Confirmed!\u0026#39;)); æœ‰äº†çº§è”ï¼Œä»£ç å°±ä¼šå˜å¾—çŸ­å¾—å¤šï¼Œè€Œä¸”ä½ ä¹Ÿä¸éœ€è¦ button å˜é‡:\nquerySelector(\u0026#39;#confirm\u0026#39;) ..text = \u0026#39;Confirm\u0026#39; ..class.add(\u0026#39;important\u0026#39;) ..onClick.listen((e) =\u0026gt; window.alert(\u0026#39;Confirmed!\u0026#39;)); ä»£ç ç¤ºä¾‹ ä½¿ç”¨çº§è”æ¥åˆ›å»ºä¸€ä¸ªå•ä¸€çš„è¯­å¥ï¼Œå°†ä¸€ä¸ª BigObject çš„ anIntã€aString å’Œ aList å±æ€§è®¾ç½®ä¸º 1ã€\u0026lsquo;String!\u0026rsquo; å’Œ [3.0](åˆ†åˆ«åœ°)ï¼Œç„¶åè°ƒç”¨ allDone()ã€‚\nclass BigObject{ int anInt = 0; String aString = \u0026#39;\u0026#39;; List\u0026lt;double\u0026gt; aList = []; bool _done = false; void allDone() { _done = true; } } BigObject fillBigObject(BigObject obj) { return obj ..anInt = 1 ..aString = \u0026#39;String!\u0026#39; ..aList.add(3) ..allDone(); } getters å’Œ setters å½“ä½ éœ€è¦å¯¹ä¸€ä¸ªå±æ€§è¿›è¡Œæ›´å¤šçš„æ§åˆ¶æ—¶ï¼Œä½ å¯ä»¥å®šä¹‰ getter å’Œ setterï¼Œè€Œä¸æ˜¯ç®€å•çš„å­—æ®µã€‚\nä¾‹å¦‚ï¼Œä½ å¯ä»¥ç¡®ä¿ä¸€ä¸ªå±æ€§çš„å€¼æ˜¯æœ‰æ•ˆçš„:\nclass MyClass { int _aProperty = 0; int get aProperty =\u0026gt; _aProperty; set aProperty(int value) { if (value \u0026gt;= 0) { _aProperty = value; } } } ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ getter æ¥å®šä¹‰è®¡ç®—å±æ€§:\nclass MyClass { List\u0026lt;int\u0026gt; _values = []; void addValue(int value) { _values.add(value); } // ä¸€ä¸ªè®¡ç®—å±æ€§  int get count { return _values.length; } } ä»£ç ç¤ºä¾‹ æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€ä¸ªè´­ç‰©è½¦ç±»ï¼Œå®ƒä¿å­˜äº†ä¸€ä¸ªç§æœ‰çš„ List\u0026lt;double\u0026gt; çš„ä»·æ ¼ã€‚æ·»åŠ ä»¥ä¸‹å†…å®¹:\n ä¸€ä¸ªå«åš total çš„ getterï¼Œè¿”å›ä»·æ ¼çš„æ€»å’Œã€‚ ç”¨ä¸€ä¸ªæ–°çš„åˆ—è¡¨æ›¿æ¢åˆ—è¡¨çš„ setterï¼Œåªè¦æ–°çš„åˆ—è¡¨ä¸åŒ…å«ä»»ä½•è´Ÿä»·æ ¼(åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œsetter åº”è¯¥æŠ›å‡ºä¸€ä¸ª InvalidPriceException)ã€‚  class InvalidPriceException {} class ShoppingCart { List\u0026lt;double\u0026gt; _prices = []; double get total =\u0026gt; _prices.fold(0, (e, t) =\u0026gt; e + t); set prices(List\u0026lt;double\u0026gt; value) { if (value.any((p) =\u0026gt; p \u0026lt; 0)) { throw InvalidPriceException(); } _prices = value; } } å¯é€‰ä½ç½®å‚æ•° Dart æœ‰ä¸¤ç§å‡½æ•°å‚æ•°ï¼šä½ç½®å‚æ•°å’Œå‘½åå‚æ•°ã€‚ä½ç½®å‚æ•°æ˜¯ä½ å¯èƒ½ç†Ÿæ‚‰çš„é‚£ç§:\nint sumUp(int a, int b, int c) { return a + b + c; } // ... int total = sumUp(1, 2, 3); åœ¨ Dart ä¸­ï¼Œä½ å¯ä»¥å°†è¿™äº›ä½ç½®å‚æ•°ç”¨æ‹¬å·åŒ…è£¹èµ·æ¥ï¼Œä½¿å…¶æˆä¸ºå¯é€‰çš„å‚æ•°:\nint sumUpToFive(int a, [int b, int c, int d, int e]) { int sum = a; if (b != null) sum += b; if (c != null) sum += c; if (d != null) sum += d; if (e != null) sum += e; return sum; } // ... int total = sumUpToFive(1,2); int otherTotal = sumUpToFive(1, 2, 3, 4, 5); å¯é€‰çš„ä½ç½®å‚æ•°åœ¨å‡½æ•°çš„å‚æ•°åˆ—è¡¨ä¸­æ€»æ˜¯æœ€åä¸€ä¸ªã€‚å®ƒä»¬çš„é»˜è®¤å€¼æ˜¯ç©ºçš„ï¼Œé™¤éä½ æä¾›äº†å¦ä¸€ä¸ªé»˜è®¤å€¼:\nint sumUpToFive(int a, [int b = 2, int c = 3, int d = 4, int e = 5]) { // Â·Â·Â· } // Â·Â·Â· int newTotal = sumUpToFive(1); print(newTotal); // \u0026lt;-- prints 15 ä»£ç ç¤ºä¾‹ å®ç°ä¸€ä¸ªåä¸º joinWithCommas() çš„å‡½æ•°ï¼Œæ¥å— 1 åˆ° 5 ä¸ªæ•´æ•°ï¼Œç„¶åè¿”å›ä¸€ä¸ªç”¨é€—å·åˆ†éš”çš„æ•°å­—å­—ç¬¦ä¸²ã€‚ä¸‹é¢æ˜¯ä¸€äº›å‡½æ•°è°ƒç”¨å’Œè¿”å›å€¼çš„ä¾‹å­:\n   å‡½æ•°è°ƒç”¨ è¿”å›å€¼     joinWithCommas(1) \u0026lsquo;1\u0026rsquo;   joinWithCommas(1, 2, 3) \u0026lsquo;1,2,3\u0026rsquo;   joinWithCommas(1, 1, 1, 1, 1) \u0026lsquo;1,1,1,1,1\u0026rsquo;    main() { var res = joinWithCommas(1,2,3,4); print(res); } String joinWithCommas(int a, [int b, int c, int d, int e]) { List\u0026lt;int\u0026gt; sum = []; sum.add(a); if (b != null) sum.add(b); if (c != null) sum.add(c); if (d != null) sum.add(d); if (e != null) sum.add(e); return sum.join(\u0026#39;,\u0026#39;); } å¯é€‰å‘½åå‚æ•° ä½¿ç”¨å¤§æ‹¬å·è¯­æ³•ï¼Œä½ å¯ä»¥å®šä¹‰æœ‰åç§°çš„å¯é€‰å‚æ•°ã€‚\nvoid printName(String firstName, String lastName, {String suffix}) { print(\u0026#39;$firstName$lastName${suffix ?? \u0026#39;\u0026#39;}\u0026#39;); } // Â·Â·Â· printName(\u0026#39;Avinash\u0026#39;, \u0026#39;Gupta\u0026#39;); printName(\u0026#39;Poshmeister\u0026#39;, \u0026#39;Moneybuckets\u0026#39;, suffix: \u0026#39;IV\u0026#39;); æ­£å¦‚ä½ æ‰€æœŸæœ›çš„ï¼Œè¿™äº›å‚æ•°çš„å€¼é»˜è®¤ä¸ºç©ºï¼Œä½†ä½ å¯ä»¥æä¾›é»˜è®¤å€¼ã€‚\nvoid printName(String firstName, String lastName, {String suffix = \u0026#39;\u0026#39;}) { print(\u0026#39;$firstName$lastName$suffix\u0026#39;); } ä¸€ä¸ªå‡½æ•°ä¸èƒ½åŒæ—¶æ‹¥æœ‰å¯é€‰çš„ä½ç½®å‚æ•°å’Œå¯é€‰çš„å‘½åå‚æ•°ã€‚\nä»£ç ç¤ºä¾‹ ä¸º MyDataObject ç±»æ·»åŠ ä¸€ä¸ª copyWith() å®ä¾‹æ–¹æ³•ã€‚å®ƒåº”è¯¥æ¥å—ä¸‰ä¸ªå‘½åå‚æ•°:\n int newInt String newString double newDouble  å½“è°ƒç”¨æ—¶ï¼ŒcopyWith() åº”è¯¥åŸºäºå½“å‰å®ä¾‹è¿”å›ä¸€ä¸ªæ–°çš„ MyDataObjectï¼Œå¹¶å°†å‰é¢å‚æ•°ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰çš„æ•°æ®å¤åˆ¶åˆ°å¯¹è±¡çš„å±æ€§ä¸­ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ newInt æ˜¯éç©ºçš„ï¼Œé‚£ä¹ˆå°†å…¶å€¼å¤åˆ¶åˆ° anInt ä¸­ã€‚\nclass MyDataObject { final int anInt; final String aString; final double aDouble; MyDataObject({ this.anInt = 1, this.aString = \u0026#39;Old!\u0026#39;, this.aDouble = 2.0, }); MyDataObject copyWith({int newInt, String newString, double newDouble}) { return MyDataObject( anInt: newInt ?? this.anInt, aString: newString ?? this.aString, aDouble: newDouble ?? this.aDouble, ); } } å¼‚å¸¸ Dart ä»£ç å¯ä»¥æŠ›å‡ºå’Œæ•è·å¼‚å¸¸ã€‚ä¸ Java ç›¸æ¯”ï¼ŒDart çš„æ‰€æœ‰å¼‚å¸¸éƒ½æ˜¯æœªæ£€æŸ¥çš„å¼‚å¸¸ã€‚æ–¹æ³•ä¸å£°æ˜å®ƒä»¬å¯èƒ½ä¼šæŠ›å‡ºå“ªäº›å¼‚å¸¸ï¼Œä½ ä¹Ÿä¸éœ€è¦æ•æ‰ä»»ä½•å¼‚å¸¸ã€‚\nDart æä¾›äº† Exception å’Œ Error ç±»å‹ï¼Œä½†ä½ å¯ä»¥æŠ›å‡ºä»»ä½•éç©ºå¯¹è±¡:\nthrow Exception(\u0026#39;Something bad happened.\u0026#39;); throw \u0026#39;Waaaaaaah!\u0026#39;; åœ¨å¤„ç†å¼‚å¸¸æ—¶ä½¿ç”¨ tryã€on å’Œ catch å…³é”®å­—:\ntry { breedMoreLlamas(); } on OutOfLlamasException { // A specific exception  buyMoreLlamas(); } on Exception catch (e) { // Anything else that is an exception  print(\u0026#39;Unknown exception: $e\u0026#39;); } catch (e) { // No specified type, handles all  print(\u0026#39;Something really unknown: $e\u0026#39;); } try å…³é”®å­—çš„å·¥ä½œåŸç†å’Œå…¶ä»–å¤§å¤šæ•°è¯­è¨€ä¸€æ ·ã€‚ä½¿ç”¨ on å…³é”®å­—æŒ‰ç±»å‹è¿‡æ»¤ç‰¹å®šçš„å¼‚å¸¸ï¼Œä½¿ç”¨ catch å…³é”®å­—è·å–å¼‚å¸¸å¯¹è±¡çš„å¼•ç”¨ã€‚\nå¦‚æœä¸èƒ½å®Œå…¨å¤„ç†å¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨ rethrow å…³é”®å­—æ¥ä¼ æ’­å¼‚å¸¸:\ntry { breedMoreLlamas(); } catch (e) { print(\u0026#39;I was just trying to breed llamas!.\u0026#39;); rethrow; } æ— è®ºæ˜¯å¦æŠ›å‡ºå¼‚å¸¸ï¼Œéƒ½è¦æ‰§è¡Œä»£ç ï¼Œä½¿ç”¨ final:\ntry { breedMoreLlamas(); } catch (e) { // ... handle exception ... } finally { // Always clean up, even if an exception is thrown.  cleanLlamaStalls(); } ä»£ç ç¤ºä¾‹ å®ç°ä¸‹é¢çš„ tryFunction()ã€‚å®ƒåº”è¯¥æ‰§è¡Œä¸€ä¸ªä¸å¯ä¿¡çš„æ–¹æ³•ï¼Œç„¶ååšå¦‚ä¸‹æ“ä½œ:\n å¦‚æœ untrustworthy() æŠ›å‡ºä¸€ä¸ª ExceptionWithMessageï¼Œè°ƒç”¨ logger.logExceptionï¼Œå¹¶æä¾›å¼‚å¸¸ç±»å‹å’Œæ¶ˆæ¯(å°è¯•ä½¿ç”¨ on å’Œ catch)ã€‚ å¦‚æœ untrustworthy() æŠ›å‡ºä¸€ä¸ª Exceptionï¼Œè°ƒç”¨ logger.logExceptionï¼Œå¹¶æ³¨æ˜å¼‚å¸¸ç±»å‹(å°è¯•ä½¿ç”¨ on)ã€‚ å¦‚æœ untrustworthy() æŠ›å‡ºä»»ä½•å…¶ä»–å¯¹è±¡ï¼Œä¸è¦æ•è·å¼‚å¸¸ã€‚ å½“æ‰€æœ‰çš„ä¸œè¥¿éƒ½è¢«æ•è·å’Œå¤„ç†åï¼Œè°ƒç”¨ logger.doneLogging(å°è¯•ä½¿ç”¨ finally)ã€‚  typedef VoidFunction = void Function(); class ExceptionWithMessage { final String message; const ExceptionWithMessage(this.message); } abstract class Logger { void logException(Type t, [String msg]); void doneLogging(); } void tryFunction(VoidFunction untrustworthy, Logger logger) { try { untrustworthy(); } on ExceptionWithMessage catch (e) { logger.logException(e.runtimeType, e.message); } on Exception { logger.logException(Exception); } finally { logger.doneLogging(); } } åœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨ this Dart æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„å¿«æ·æ–¹å¼æ¥ä¸ºæ„é€ å‡½æ•°ä¸­çš„å±æ€§èµ‹å€¼ï¼šåœ¨å£°æ˜æ„é€ å‡½æ•°æ—¶ä½¿ç”¨ this.propertyName:\nclass MyColor { int red; int green; int blue; MyColor(this.red, this.green, this.blue) } final color = MyColor(80, 80, 128); è¿™ç§æŠ€æœ¯ä¹Ÿé€‚ç”¨äºå‘½åå‚æ•°ã€‚å±æ€§åæˆä¸ºå‚æ•°çš„åç§°:\nclass MyColor { ... MyColor({this.red, this.green, this.blue}); } final color = MyColor(red: 80, green: 80, blue: 80); å¯¹äºå¯é€‰å‚æ•°ï¼Œé»˜è®¤å€¼æŒ‰é¢„æœŸå·¥ä½œ:\nMyColor([this.red = 0, this.green = 0, this.blue = 0]); // or MyColor({this.red = 0, this.green = 0, this.blue = 0}); ä»£ç ç¤ºä¾‹ ä¸º MyClass æ·»åŠ ä¸€ä¸ªå•è¡Œæ„é€ å‡½æ•°ï¼Œä½¿ç”¨ this. è¯­æ³•æ¥æ¥æ”¶å’Œåˆ†é…ç±»çš„ä¸‰ä¸ªå±æ€§çš„å€¼:\nclass MyClass { final int anInt; final String aString; final double aDouble; MyClass(this.anInt, this.aString, this.aDouble); } åˆå§‹åŒ–å™¨åˆ—è¡¨ æœ‰æ—¶å€™ï¼Œå½“ä½ å®ç°ä¸€ä¸ªæ„é€ å‡½æ•°æ—¶ï¼Œä½ éœ€è¦åœ¨æ„é€ å‡½æ•°ä½“æ‰§è¡Œä¹‹å‰åšä¸€äº›è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œåœ¨æ„é€ å‡½æ•°ä½“æ‰§è¡Œä¹‹å‰ï¼Œfinal å­—æ®µå¿…é¡»æœ‰å€¼ã€‚åœ¨ä¸€ä¸ªåˆå§‹åŒ–å™¨åˆ—è¡¨ä¸­åšè¿™äº›å·¥ä½œï¼Œå®ƒä½äºæ„é€ å‡½æ•°çš„ç­¾åå’Œå®ƒçš„ä¸»ä½“ä¹‹é—´ã€‚\nPoint.fromJson(Map\u0026lt;String, num\u0026gt; json) : x = json[\u0026#39;x\u0026#39;], y = json[\u0026#39;y\u0026#39;] { print(\u0026#39;In Point.fromJson(): ($x, $y)\u0026#39;); } åˆå§‹åŒ–å™¨åˆ—è¡¨ä¹Ÿæ˜¯ä¸€ä¸ªæ–¹ä¾¿æ”¾ç½®æ–­è¨€çš„åœ°æ–¹ï¼Œå®ƒåªåœ¨å¼€å‘è¿‡ç¨‹ä¸­è¿è¡Œ:\nNonNegativePoint(this.x, this.y) : assert(x \u0026gt;= 0), assert(y \u0026gt;= 0) { print(\u0026#39;I just made a NonNegativePoint: ($x, $y)\u0026#39;); } ä»£ç ç¤ºä¾‹ å®Œæˆä¸‹é¢çš„ FirstTwoLetters æ„é€ å‡½æ•°ã€‚ä½¿ç”¨åˆå§‹åŒ–å™¨åˆ—è¡¨å°† word ä¸­çš„å‰ä¸¤ä¸ªå­—ç¬¦åˆ†é…ç»™ letterOne å’Œ LetterTwo å±æ€§ã€‚ä¸ºäº†è·å¾—é¢å¤–çš„ç§¯åˆ†ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªæ–­è¨€æ¥æ•è·å°‘äºä¸¤ä¸ªå­—ç¬¦çš„å•è¯ã€‚\nclass FirstTwoLetters { final String letterOne; final String letterTwo; // Create a constructor with an initializer list here:  FirstTwoLetters(String word) : assert(word.length \u0026gt;=2), letterOne = word[0], letterTwo = word[1]; } å‘½åæ„é€ å™¨ ä¸ºäº†å…è®¸ç±»æœ‰å¤šä¸ªæ„é€ å‡½æ•°ï¼ŒDart æ”¯æŒå‘½åæ„é€ å‡½æ•°:\nclass Point { double x, y; Point(this.x, this.y); Point.origin() { x = 0; y = 0; } } è¦ä½¿ç”¨å‘½åæ„é€ å‡½æ•°ï¼Œè¯·ä½¿ç”¨å®ƒçš„å…¨åæ¥è°ƒç”¨å®ƒ:\nfinal myPoint = Point.origin(); ä»£ç ç¤ºä¾‹ ç»™ Color ç±»ä¸€ä¸ªåä¸º Color.black çš„æ„é€ å‡½æ•°ï¼Œå°†ä¸‰ä¸ªå±æ€§éƒ½è®¾ç½®ä¸º 0ã€‚\nclass Color { int red; int green; int blue; Color(this.red, this.green, this.blue); Color.black() { red = 0; green = 0; blue = 0; } } å·¥å‚æ„é€ å‡½æ•° Dart æ”¯æŒå·¥å‚æ„é€ å‡½æ•°ï¼Œå®ƒå¯ä»¥è¿”å›å­ç±»å‹ç”šè‡³ nullã€‚è¦åˆ›å»ºä¸€ä¸ªå·¥å‚æ„é€ å‡½æ•°ï¼Œè¯·ä½¿ç”¨ factory å…³é”®å­—:\nclass Square extends Shape {} class Circle extends Shape {} class Shape { Shape(); factory Shape.fromTypeName(String typeName) { if (typeName == \u0026#39;square\u0026#39;) return Square(); if (typeName == \u0026#39;circle\u0026#39;) return Circle(); print(\u0026#39;I don\\\u0026#39;t recognize $typeName\u0026#39;); return null } } ä»£ç ç¤ºä¾‹ å¡«å…¥åä¸º IntegerHolder.fromList çš„å·¥å‚æ„é€ å‡½æ•°ï¼Œä½¿å…¶åšä»¥ä¸‹å·¥ä½œ:\n å¦‚æœåˆ—è¡¨æœ‰ä¸€ä¸ªå€¼ï¼Œå°±ç”¨è¿™ä¸ªå€¼åˆ›å»ºä¸€ä¸ª IntegerSingleã€‚ å¦‚æœåˆ—è¡¨æœ‰ä¸¤ä¸ªå€¼ï¼Œåˆ™ç”¨è¯¥å€¼ä¾æ¬¡åˆ›å»ºä¸€ä¸ª IntegerDoubleã€‚ å¦‚æœåˆ—è¡¨æœ‰ä¸‰ä¸ªå€¼ï¼Œåˆ™æŒ‰é¡ºåºåˆ›å»ºä¸€ä¸ª IntegerTripleã€‚ å¦åˆ™ï¼Œè¿”å› nullã€‚  class IntegerHolder { IntegerHolder(); factory IntegerHolder.fromList(List\u0026lt;int\u0026gt; list) { if (list?.length == 1) { return IntegerSingle(list[0]); } else if (list?.length == 2) { return IntegerDouble(list[0], list[1]); } else if (list?.length == 3) { return IntegerTriple(list[0], list[1], list[2]); } else { return null; } } } class IntegerSingle extends IntegerHolder { final int a; IntegerSingle(this.a); } class IntegerDouble extends IntegerHolder { final int a; final int b; IntegerDouble(this.a, this.b); } class IntegerTriple extends IntegerHolder { final int a; final int b; final int c; IntegerTriple(this.a, this.b, this.c); } é‡å®šå‘æ„é€ å‡½æ•° æœ‰æ—¶ï¼Œä¸€ä¸ªæ„é€ å‡½æ•°çš„å”¯ä¸€ç›®çš„æ˜¯é‡å®šå‘åˆ°åŒä¸€ç±»ä¸­çš„å¦ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚é‡å®šå‘æ„é€ å‡½æ•°çš„ä¸»ä½“æ˜¯ç©ºçš„ï¼Œæ„é€ å‡½æ•°è°ƒç”¨å‡ºç°åœ¨å†’å·(:)ä¹‹åã€‚\nclass Automobile { String make; String model; int mpg; // è¿™ä¸ªç±»çš„ä¸»æ„é€ å‡½æ•°  Automobile(this.make, this.model, this.mpg); // ä»£ç†åˆ°ä¸»æ„é€ å‡½æ•°  Automobile.hybrid(String make, String model) : this(make, model, 60); // ä»£ç†åˆ°å‘½åæ„é€ å‡½æ•°  Automobile.fancyHybrid() : this.hybrid(\u0026#39;Futurecar\u0026#39;, \u0026#39;Mark 2\u0026#39;); } ä»£ç ç¤ºä¾‹ è¿˜è®°å¾—ä¸Šé¢çš„ Color ç±»å—ï¼Ÿåˆ›å»ºä¸€ä¸ªåä¸º black çš„å‘½åæ„é€ å‡½æ•°ï¼Œä½†ä¸æ˜¯æ‰‹åŠ¨åˆ†é…å±æ€§ï¼Œè€Œæ˜¯å°†å…¶é‡å®šå‘åˆ°é»˜è®¤æ„é€ å‡½æ•°ï¼Œå‚æ•°ä¸º 0ã€‚\nclass Color { int red; int green; int blue; Color(this.red, this.green, this.blue); Color.black() : this(0, 0, 0); } å¸¸é‡æ„é€ å‡½æ•° å¦‚æœä½ çš„ç±»äº§ç”Ÿçš„å¯¹è±¡æ°¸è¿œä¸ä¼šæ”¹å˜ï¼Œä½ å¯ä»¥è®©è¿™äº›å¯¹è±¡æˆä¸ºç¼–è¯‘æ—¶å¸¸é‡ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œè¯·å®šä¹‰ä¸€ä¸ª const æ„é€ å‡½æ•°ï¼Œå¹¶ç¡®ä¿æ‰€æœ‰çš„å®ä¾‹å˜é‡éƒ½æ˜¯æœ€ç»ˆå˜é‡ã€‚\nclass ImmutablePoint { const ImmutablePoint(this.x, this.y); final int x; final int y; static const ImmutablePoint origin = ImmutablePoint(0, 0); } ä»£ç ç¤ºä¾‹ ä¿®æ”¹ Recipe ç±»ï¼Œä½¿å®ƒçš„å®ä¾‹å¯ä»¥æ˜¯å¸¸é‡ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªå¸¸é‡æ„é€ å‡½æ•°ï¼Œæ‰§è¡Œä»¥ä¸‹æ“ä½œã€‚\n æœ‰ä¸‰ä¸ªå‚æ•°ï¼š ingredients, calories å’Œ milligramsOfSodium(æŒ‰é¡ºåº)ã€‚ ä½¿ç”¨ this. è¯­æ³•ï¼Œè‡ªåŠ¨å°†å‚æ•°å€¼åˆ†é…ç»™åŒåçš„å¯¹è±¡å±æ€§ã€‚ æ˜¯å¸¸é‡ï¼Œåœ¨æ„é€ å‡½æ•°å£°æ˜ä¸­ï¼Œconst å…³é”®å­—å°±åœ¨ Recipe å‰é¢ã€‚  class Recipe { final List\u0026lt;String\u0026gt; ingredients; final int calories; final double milligramsOfSodium; const Recipe(this.ingredients, this.calories, this.milligramsOfSodium); } ä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆï¼Ÿ æˆ‘ä»¬å¸Œæœ›ä½ å–œæ¬¢ä½¿ç”¨è¿™ä¸ª codelab æ¥å­¦ä¹ æˆ–æµ‹è¯•ä½ å¯¹ Dart è¯­è¨€ä¸€äº›æœ€æœ‰è¶£çš„åŠŸèƒ½çš„çŸ¥è¯†ã€‚è¿™é‡Œæœ‰ä¸€äº›å…³äºç°åœ¨è¦åšä»€ä¹ˆçš„å»ºè®®ã€‚\n è¯•è¯•å…¶ä»–çš„ Dart ä»£ç å®éªŒå®¤. é˜…è¯» Dart è¯­è¨€ä¹‹æ—…ã€‚ ç© DartPadã€‚ è·å– Dart SDKã€‚  ","permalink":"https://ohmyweekly.github.io/notes/dart-cheatsheet-codelab/","tags":["string","cheatsheet","dart"],"title":"Dart è¯­è¨€é€ŸæŸ¥è¡¨"},{"categories":["programming"],"contents":"ç«¯åˆèŠ‚å¿«ä¹, ä¸€èµ·çˆ¬å±±å—ï¼Ÿ\n","permalink":"https://ohmyweekly.github.io/notes/go-hiking/","tags":["hiking","holiday"],"title":"ä¸€èµ·çˆ¬å±±å—?"},{"categories":null,"contents":"Results from static site search implemented using Fusejs, jquery and mark.js. \u0026ndash; Source\n","permalink":"https://ohmyweekly.github.io/search/","tags":null,"title":"Search"}]