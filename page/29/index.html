<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">

    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
    
    
    

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5">

    
    <meta name="referrer" content="no-referrer">

    <title>
        
            焉知非鱼 ❚
        
    </title>

    
    


    
    
    
    

    
    
    
    

    
    
    

    
    
    
    <style>
     
     
     :root {
         --theme-color: #ac4142;
         --theme-color-light: rgba(172, 65, 66, 0.2);
     }
     
     html {
         line-height: 1.5;
     }
    </style>

    
    

    
    
    
    
    <link rel="stylesheet" href="/css/refined.min.7f6d3ee611034e4ebcbc063f1db3bc042fecdc8901afbedad80ff02bae409204.css">
    
    <link rel="preload" href="/css/refined.min.7f6d3ee611034e4ebcbc063f1db3bc042fecdc8901afbedad80ff02bae409204.css" as="style">

    



    
        <style>
         
         /* Background */ .chroma { background-color: #ffffff }
/* Error */ .chroma .err { color: #a61717; background-color: #e3d2d2 }
/* LineTableTD */ .chroma .lntd { vertical-align: top; padding: 0; margin: 0; border: 0; }
/* LineTable */ .chroma .lntable { border-spacing: 0; padding: 0; margin: 0; border: 0; width: auto; overflow: auto; display: block; }
/* LineHighlight */ .chroma .hl { display: block; width: 100%;background-color: #ffffcc }
/* LineNumbersTable */ .chroma .lnt { margin-right: 0.4em; padding: 0 0.4em 0 0.4em; }
/* LineNumbers */ .chroma .ln { margin-right: 0.4em; padding: 0 0.4em 0 0.4em; }
/* Keyword */ .chroma .k { color: #000000; font-weight: bold }
/* KeywordConstant */ .chroma .kc { color: #000000; font-weight: bold }
/* KeywordDeclaration */ .chroma .kd { color: #000000; font-weight: bold }
/* KeywordNamespace */ .chroma .kn { color: #000000; font-weight: bold }
/* KeywordPseudo */ .chroma .kp { color: #000000; font-weight: bold }
/* KeywordReserved */ .chroma .kr { color: #000000; font-weight: bold }
/* KeywordType */ .chroma .kt { color: #445588; font-weight: bold }
/* NameAttribute */ .chroma .na { color: #008080 }
/* NameBuiltin */ .chroma .nb { color: #0086b3 }
/* NameBuiltinPseudo */ .chroma .bp { color: #999999 }
/* NameClass */ .chroma .nc { color: #445588; font-weight: bold }
/* NameConstant */ .chroma .no { color: #008080 }
/* NameDecorator */ .chroma .nd { color: #3c5d5d; font-weight: bold }
/* NameEntity */ .chroma .ni { color: #800080 }
/* NameException */ .chroma .ne { color: #990000; font-weight: bold }
/* NameFunction */ .chroma .nf { color: #990000; font-weight: bold }
/* NameLabel */ .chroma .nl { color: #990000; font-weight: bold }
/* NameNamespace */ .chroma .nn { color: #555555 }
/* NameTag */ .chroma .nt { color: #000080 }
/* NameVariable */ .chroma .nv { color: #008080 }
/* NameVariableClass */ .chroma .vc { color: #008080 }
/* NameVariableGlobal */ .chroma .vg { color: #008080 }
/* NameVariableInstance */ .chroma .vi { color: #008080 }
/* LiteralString */ .chroma .s { color: #dd1144 }
/* LiteralStringAffix */ .chroma .sa { color: #dd1144 }
/* LiteralStringBacktick */ .chroma .sb { color: #dd1144 }
/* LiteralStringChar */ .chroma .sc { color: #dd1144 }
/* LiteralStringDelimiter */ .chroma .dl { color: #dd1144 }
/* LiteralStringDoc */ .chroma .sd { color: #dd1144 }
/* LiteralStringDouble */ .chroma .s2 { color: #dd1144 }
/* LiteralStringEscape */ .chroma .se { color: #dd1144 }
/* LiteralStringHeredoc */ .chroma .sh { color: #dd1144 }
/* LiteralStringInterpol */ .chroma .si { color: #dd1144 }
/* LiteralStringOther */ .chroma .sx { color: #dd1144 }
/* LiteralStringRegex */ .chroma .sr { color: #009926 }
/* LiteralStringSingle */ .chroma .s1 { color: #dd1144 }
/* LiteralStringSymbol */ .chroma .ss { color: #990073 }
/* LiteralNumber */ .chroma .m { color: #009999 }
/* LiteralNumberBin */ .chroma .mb { color: #009999 }
/* LiteralNumberFloat */ .chroma .mf { color: #009999 }
/* LiteralNumberHex */ .chroma .mh { color: #009999 }
/* LiteralNumberInteger */ .chroma .mi { color: #009999 }
/* LiteralNumberIntegerLong */ .chroma .il { color: #009999 }
/* LiteralNumberOct */ .chroma .mo { color: #009999 }
/* Operator */ .chroma .o { color: #000000; font-weight: bold }
/* OperatorWord */ .chroma .ow { color: #000000; font-weight: bold }
/* Comment */ .chroma .c { color: #999988; font-style: italic }
/* CommentHashbang */ .chroma .ch { color: #999988; font-style: italic }
/* CommentMultiline */ .chroma .cm { color: #999988; font-style: italic }
/* CommentSingle */ .chroma .c1 { color: #999988; font-style: italic }
/* CommentSpecial */ .chroma .cs { color: #999999; font-weight: bold; font-style: italic }
/* CommentPreproc */ .chroma .cp { color: #999999; font-weight: bold; font-style: italic }
/* CommentPreprocFile */ .chroma .cpf { color: #999999; font-weight: bold; font-style: italic }
/* GenericDeleted */ .chroma .gd { color: #000000; background-color: #ffdddd }
/* GenericEmph */ .chroma .ge { color: #000000; font-style: italic }
/* GenericError */ .chroma .gr { color: #aa0000 }
/* GenericHeading */ .chroma .gh { color: #999999 }
/* GenericInserted */ .chroma .gi { color: #000000; background-color: #ddffdd }
/* GenericOutput */ .chroma .go { color: #888888 }
/* GenericPrompt */ .chroma .gp { color: #555555 }
/* GenericStrong */ .chroma .gs { font-weight: bold }
/* GenericSubheading */ .chroma .gu { color: #aaaaaa }
/* GenericTraceback */ .chroma .gt { color: #aa0000 }
/* GenericUnderline */ .chroma .gl { text-decoration: underline }
/* TextWhitespace */ .chroma .w { color: #bbbbbb }

         
         /* Overrides on top of the theme and Chroma CSS */
/* Chroma-based lines highlighting in code blocks */
.chroma .hl {
    background-color: #e8e8e8;
    /* Extend highlight up to 100 characters (assuming that the code blocks never have more than 100 characters in a line) */
    min-width: 100ch;
}
/* GenericHeading */ .chroma .gh { color: #999999; font-weight: bold }
/* GenericSubheading */ .chroma .gu { color: #aaaaaa; font-weight: bold }

         
        </style>
    

    

    
    
    

    
    <script src="/js/responsive-nav-orig.min.e2b5f2a956b488f466da513820636134defdc38b90ed566248960593f2bb4ba5.js"></script>
    
    <link rel="preload" href="/js/responsive-nav-orig.min.e2b5f2a956b488f466da513820636134defdc38b90ed566248960593f2bb4ba5.js" as="script">

    
    
    <script defer src="/js/libs/fa/fontawesome-all.min.08916ac0fd078adfb58edc890460e2c8990729aee02bca7586404b56805f5219.js"></script>
    
    <link rel="preload" href="/js/libs/fa/fontawesome-all.min.08916ac0fd078adfb58edc890460e2c8990729aee02bca7586404b56805f5219.js" as="script">

    

    

    
    
    

    
    
<!-- rel="me" links for IndieAuth -->







    
 
<meta property="og:title" content="焉知非鱼" />
<meta property="og:description"
      content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://ohmyweekly.github.io/" />


    
        <meta property="og:updated_time" content="2022-12-27T00:00:00&#43;00:00"/>
    












     <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="焉知非鱼"/>
<meta name="twitter:description" content=""/>


    
    
    <link rel="alternate" type="application/rss+xml" href="https://ohmyweekly.github.io/index.xml" title="Rss for 焉知非鱼" />
    <link rel="alternate" type="application/atom+xml" href="https://ohmyweekly.github.io/atom.xml" title="Atom for 焉知非鱼" />
    <link rel="alternate" type="application/jf2feed+json" href="https://ohmyweekly.github.io/jf2feed.json" title="Jf2feed for 焉知非鱼" />
    
     






    
    
    
    <meta name="hugo-build-date" content="2024-03-01T16:16:06Z"/>
    <meta name="hugo-commit-hash" content="312735366b20d64bd61bff8627f593749f86c964"/>
    <meta name="generator" content="Hugo 0.123.7">
</head>


    
        <body lang="en">
    

        
        <div class="border" id="home"></div>

        <div class="wrapper">   
            
<nav id="nav" class="nav-collapse opened" aria-hidden="false">
    <ul class="navbar">
        <li><a class="active" href="/">Home</a></li>
        
            
                <li><a class="" href="https://ohmyweekly.github.io/posts/">Posts</a></li>
            
        
            
                <li><a class="" href="https://ohmyweekly.github.io/notes/">Notes</a></li>
            
        
        
            <li><a class="" href="https://ohmyweekly.github.io/search/">Search</a></li>
        
    </ul>
</nav>

            <div class="container">
                <header class="masthead">
                    <div class="masthead-title no-text-decoration">
                        <a href="/">焉知非鱼</a> <span class="blinking-cursor">❚</span>
                    </div>
                    <div class="masthead-tagline">
                        rakulang, dartlang, nimlang, golang, rustlang, lang lang no see
                    </div>
                </header>

                

<div class="posts h-feed">
    <header>
        
        <data class="u-url" value="https://ohmyweekly.github.io/"></data>
         





        <data class="p-name" value="焉知非鱼"></data>
    </header>
    
    
        <article class="summary h-entry notes">
    <header>
        <h2 class="post-title p-name no-text-decoration"><a class="u-url" href='https://ohmyweekly.github.io/notes/six-slices-of-pie/'> six slices of pie</a> </h2>
        
    <div class="taxo no-text-decoration">
         
            
                <ul class="no-bullets inline categories">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts categorized in ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/categories/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
         
            
                <ul class="no-bullets inline tags">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts tagged with ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/tags/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
        
    </div>


        


    
    
    <div class="post-date">
        
        <time datetime="2019-07-27T15:33:57+0000" class="dt-published">Sat Jul 27, 2019</time>
        
        
    </div>


    </header>

    <div class="post p-summary" >
        <p>第 15 周挑战赛的第一个任务是找到甜品的最佳排队位置。
这是对创造越野车鞭子或牛仔电影或实体书店或碳基能源的老难题的重新表述：什么时候才是选择在一个不断缩小的馅饼中获得一块不断增加的最佳时机？
在这个任务中，馅饼足够大，可以容纳100个人，但排在第一位的人只能得到相当于其中1%的一块。第二个人得到剩下的2%，第三个人得到之后剩下的3%，等等，等等，直到第一百个人得到前面99个人分到自己那份后剩下的100%的碎屑。换句话说，我们要&quot;让苹果派再次伟大！&quot;
实际的任务是确定哪一个是队伍中的最佳位置。是早早地进入，得到一小块还算大的馅饼呢？还是等待，最终获得一块更大的剩饼？让我们用六种不同的方式来回答这个问题。
必需的切片 我的开发者生涯是以C语言程序员的身份开始的，我仍然觉得以命令式模式来处理像这样的小问题是很自然的。所以，我第一次尝试回答这个问题（幸好是用 Raku 而不是C语言）的时候是这样的。
# Start with a full pie, and no idea who gets the most... my $pie = 1.00; # i.e. 100% my $max-share = 0.00; # i.e. 0% my $max-index; # For everyone in line... for 1..100 -&gt; $N { # Take N% of what’s left as the next share... my $share = $pie * $N/100; $pie -= $share; # Remember it if it’s maximal.</p>

    </div>

    
    
    
        <div class="readmore no-text-decoration">
            <a href='https://ohmyweekly.github.io/notes/six-slices-of-pie/'
               title="Read more about six slices of pie">
                read <span class="more"> more</span>
                <span class="screen-readers-only" > about six slices of pie</span>
            </a>
        </div>
    
</article>
      
    
        <article class="summary h-entry notes">
    <header>
        <h2 class="post-title p-name no-text-decoration"><a class="u-url" href='https://ohmyweekly.github.io/notes/import-external-libs-in-idea/'> 在 IDEA 中导入外部库</a> </h2>
        
    <div class="taxo no-text-decoration">
         
            
                <ul class="no-bullets inline categories">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts categorized in ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/categories/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
         
            
                <ul class="no-bullets inline tags">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts tagged with ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/tags/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
        
    </div>


        


    
    
    <div class="post-date">
        
        <time datetime="2019-07-26T13:50:59+0000" class="dt-published">Fri Jul 26, 2019</time>
        
        
    </div>


    </header>

    <div class="post p-summary" >
        <p>有一个解析报文的 Java 程序, 里面封装好了可用的函数, 用来解析车辆上的原始报文, kafka 数据如下所示(rawData 字段为报文)。我们用它提供的 libs 来解析该报文。
{&#34;keyId&#34;:&#34;XXXXXXXXXXXXX&#34;,&#34;sampleTime&#34;:&#34;1563348447814&#34;,&#34;msgType&#34;:&#34;gbdata&#34;,&#34;dataList&#34;:{&#34;msgType&#34;:&#34;gbdata&#34;,&#34;vehicleModelCode&#34;:&#34;1xd9&#34;,&#34;vehicleSeries&#34;:&#34;A76&#34;,&#34;vin&#34;:&#34;LLLLLLLLLLLLLL&#34;,&#34;rawData&#34;:&#34;131302fe4c4e414132414131354b355331303236330101271307110f1b190102010100000000546d0eae26c063010f03e80000050006c3a1fd015f5e080601431018010c100801184a010344070000000000000000000801010eae26c0005c00015c100f101310111010101110101014100b10121010100f1008100e100c100c1010101210111013100e100c1010101310101015101310131015101410141013100e100c100e100d1010100f10131013101410131015100c100d100d100f100e100e101210161015101510431016101710131016101510151016100f101310131016101210101018101010151014101710141014101310131017100e10101013100e100f10111013101410141017101410181016101510161017090101002048474445454545454546444545454545454645464545494a4949464849484849bb&#34;,&#34;sampleTime&#34;:&#34;1563348447814&#34;}} 要在新的项目中使用它们的库, 需要做的是:
在 src 同级目录下, 创建一个 libs 目录, 把 xx.jar 复制到 libs 目录里面 在 src 同级目录下, 创建一个 out 目录, 用于 build Artifact 时存放最后的 jar 包文件 File -&gt; Project Structure -&gt; Artifacts -&gt; + -&gt; Extracted Directory -&gt; 选择外部库.jar File -&gt; Project Structure -&gt; Artifacts -&gt; 勾选 include in projects. (重要) File -&gt; Project Structure -&gt; Libraries -&gt; + -&gt; 选择 libs 目录和外部库.</p>

    </div>

    
    
    
        <div class="readmore no-text-decoration">
            <a href='https://ohmyweekly.github.io/notes/import-external-libs-in-idea/'
               title="Read more about 在 IDEA 中导入外部库">
                read <span class="more"> more</span>
                <span class="screen-readers-only" > about 在 IDEA 中导入外部库</span>
            </a>
        </div>
    
</article>
      
    
        <article class="summary h-entry notes">
    <header>
        <h2 class="post-title p-name no-text-decoration"><a class="u-url" href='https://ohmyweekly.github.io/notes/nqp-exercises/'> NQP 练习题</a> </h2>
        
    <div class="taxo no-text-decoration">
         
            
                <ul class="no-bullets inline categories">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts categorized in ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/categories/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
         
            
                <ul class="no-bullets inline tags">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts tagged with ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/tags/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
        
    </div>


        


    
    
    <div class="post-date">
        
        <time datetime="2019-07-20T11:05:26+0800" class="dt-published">Sat Jul 20, 2019</time>
        
        
    </div>


    </header>

    <div class="post p-summary" >
        <p>练习 1 本练习将让您在 NQP 中执行一些简单的任务，以熟悉基本语法。
Hello, world 最简单的事情:
say('Hello, world'); 现在把它弄错:
say 'Hello, world'; 请注意你将如何大声地抱怨。
变量 将值绑定到标量。 使用 say 来输出它. 尝试使用赋值代替绑定。 观察它的失败。 声明一个数组。 使用索引, 例如 @a[0], 去绑定并访问元素。 注意在 Raku 中, 符号是不变的; 使用 $a[0] 则会抱怨未声明的 $a! 尝试绑定一个数组字面量, 例如 [1,2,3] 到一个 @arr 变量上。现在把该数组字面量绑定到一个 $scalar 变量上。注意观察索引是怎样在这两种结构上都工作良好的。 声明一个哈希变量, %h. 尝试使用字面值语法索引 (%h&lt;key&gt;) 和花括号语法索引 (%h{'key'})。 循环 使用 for 来迭代数组, 一次迭代一个元素, 先使用 $_ 迭代, 然后使用 pointy block (for @a -&gt; $val { ... }) 迭代。 你可以一次迭代两个元素吗？ 试试看！ 迭代散列变量, 打印出该散列每个 pair 对儿的 .</p>

    </div>

    
    
    
        <div class="readmore no-text-decoration">
            <a href='https://ohmyweekly.github.io/notes/nqp-exercises/'
               title="Read more about NQP 练习题">
                read <span class="more"> more</span>
                <span class="screen-readers-only" > about NQP 练习题</span>
            </a>
        </div>
    
</article>
      
    
        <article class="summary h-entry notes">
    <header>
        <h2 class="post-title p-name no-text-decoration"><a class="u-url" href='https://ohmyweekly.github.io/notes/yet-another-udaf/'> Spark 中的 UDAF 函数</a> </h2>
        
    <div class="taxo no-text-decoration">
         
            
                <ul class="no-bullets inline categories">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts categorized in ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/categories/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
         
            
                <ul class="no-bullets inline tags">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts tagged with ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/tags/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
        
    </div>


        


    
    
    <div class="post-date">
        
        <time datetime="2019-07-04T16:53:45+0000" class="dt-published">Thu Jul 4, 2019</time>
        
        
    </div>


    </header>

    <div class="post p-summary" >
        <p>上午介绍了 Spark 的用户自定义聚合函数, 其实是官网的例子, 它使用 Spark SQL。下午我们来看一个稍微复杂点的例子, 这次我们在 agg 中使用自定义的聚合函数。
我们的程序读取 JSON数据, 其中 vin 是车架号; timestamp 是信号发生时间, 信号每隔 1 秒发生一次; PtcConsmp 是一个 Long 类型的值。
{&#34;vin&#34;:&#34;KLSAP5S09K1214720&#34;,&#34;timestamp&#34;:1543766400000,&#34;PtcConsmp&#34;:5000} {&#34;vin&#34;:&#34;KLSAP5S09K1214720&#34;,&#34;timestamp&#34;:1543766401000,&#34;PtcConsmp&#34;:5000} {&#34;vin&#34;:&#34;KLSAP5S09K1214720&#34;,&#34;timestamp&#34;:1543766402000,&#34;PtcConsmp&#34;:5000} {&#34;vin&#34;:&#34;KLSAP5S09K1214720&#34;,&#34;timestamp&#34;:1543766403000,&#34;PtcConsmp&#34;:5000} {&#34;vin&#34;:&#34;KLSAP5S09K1214720&#34;,&#34;timestamp&#34;:1543766405000,&#34;PtcConsmp&#34;:5000} {&#34;vin&#34;:&#34;KLSAP5S09K1214720&#34;,&#34;timestamp&#34;:1543766406000,&#34;PtcConsmp&#34;:850} {&#34;vin&#34;:&#34;KLSAP5S09K1214720&#34;,&#34;timestamp&#34;:1543766407000,&#34;PtcConsmp&#34;:850} {&#34;vin&#34;:&#34;KLSAP5S09K1214720&#34;,&#34;timestamp&#34;:1543766408000,&#34;PtcConsmp&#34;:850} {&#34;vin&#34;:&#34;KLSAP5S09K1214720&#34;,&#34;timestamp&#34;:1543766409000,&#34;PtcConsmp&#34;:850} {&#34;vin&#34;:&#34;KLSAP5S09K1214720&#34;,&#34;timestamp&#34;:1543766410000,&#34;PtcConsmp&#34;:850} {&#34;vin&#34;:&#34;KLSAP5S09K1214720&#34;,&#34;timestamp&#34;:1543766411000,&#34;PtcConsmp&#34;:850} {&#34;vin&#34;:&#34;KLSAP5S09K1214720&#34;,&#34;timestamp&#34;:1543766412000,&#34;PtcConsmp&#34;:850} {&#34;vin&#34;:&#34;KLSAP5S09K1214720&#34;,&#34;timestamp&#34;:1543766424000,&#34;PtcConsmp&#34;:1650} {&#34;vin&#34;:&#34;KLSAP5S09K1214720&#34;,&#34;timestamp&#34;:1543766425000,&#34;PtcConsmp&#34;:1650} {&#34;vin&#34;:&#34;KLSAP5S09K1214720&#34;,&#34;timestamp&#34;:1543766426000,&#34;PtcConsmp&#34;:1650} ... 我们规定：
如果一段连续的时间内, PtcConsmp 的值发生变化, 则记为一次 PTC 切换。 如果发生一次时间缺失, 也记为一次 PTC 切换。 计算每个 vin 的 PtcConsmp 切换次数。
我们借助 Spark 的 UDAF 函数来计算这个需求。首先我们定义一个 PTCPwrAgg 对象, 它扩展自 UserDefinedAggregateFunction。所以 PTCPwrAgg 里必须实现如下几个函数:
inputSchema 输入数据 bufferSchema 中间状态 dataType 返回值类型 deterministic true initialize 初始化缓冲区 update 更新缓冲区 merge 合并缓冲区 evaluate 计算最终结果 package ohmysummer import org.</p>

    </div>

    
    
    
        <div class="readmore no-text-decoration">
            <a href='https://ohmyweekly.github.io/notes/yet-another-udaf/'
               title="Read more about Spark 中的 UDAF 函数">
                read <span class="more"> more</span>
                <span class="screen-readers-only" > about Spark 中的 UDAF 函数</span>
            </a>
        </div>
    
</article>
      
    
        <article class="summary h-entry notes">
    <header>
        <h2 class="post-title p-name no-text-decoration"><a class="u-url" href='https://ohmyweekly.github.io/notes/udaf/'> 用户自定义聚合函数</a> </h2>
        
    <div class="taxo no-text-decoration">
         
            
                <ul class="no-bullets inline categories">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts categorized in ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/categories/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
         
            
                <ul class="no-bullets inline tags">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts tagged with ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/tags/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
        
    </div>


        


    
    
    <div class="post-date">
        
        <time datetime="2019-07-04T10:08:18+0000" class="dt-published">Thu Jul 4, 2019</time>
        
        
    </div>


    </header>

    <div class="post p-summary" >
        <p>聚合 内置的 DataFrame 函数提供常见的聚合，如 count()，countDistinct()，avg()，max()，min() 等。虽然这些函数是为 DataFrame 设计的，但 Spark SQL 也有类型安全的版本其中一些在 Scala 和 Java 中使用强类型数据集。此外，用户不限于预定义的聚合函数，并且可以创建自己的聚合函数。
无类型用户自定义函数 用户必须扩展 UserDefinedAggregateFunction 抽象类以实现自定义无类型聚合函数。例如，用户定义的平均值可能看起来像这样:
import org.apache.spark.sql.{Row, SparkSession} import org.apache.spark.sql.expressions.MutableAggregationBuffer import org.apache.spark.sql.expressions.UserDefinedAggregateFunction import org.apache.spark.sql.types._ object MyAverage extends UserDefinedAggregateFunction { // 该聚合函数输入参数的数据类型 def inputSchema: StructType = StructType(StructField(&#34;inputColumn&#34;, LongType) :: Nil) // 聚合缓冲区中值的数据类型 def bufferSchema: StructType = { StructType(StructField(&#34;sum&#34;, LongType) :: StructField(&#34;count&#34;, LongType) :: Nil) } // 返回值的数据类型 def dataType: DataType = DoubleType // 对于相同输入该函数是否始终返回相同输出 def deterministic: Boolean = true // 初始化给定的聚合缓冲区。缓冲区本身是一个 &#34;Row&#34;，除了诸如在索引处检索值(例如，get()，getBoolean()) 标准方法之外，提供了更新其值的机会。 // 请注意，缓冲区内的数组和 map 映射仍然是不可变的 def initialize(buffer: MutableAggregationBuffer): Unit = { buffer(0) = 0L // sum 值 buffer(1) = 0L // 元素个数 } // 使用来自 `input` 的新输入数据更新给定的聚合缓冲区 `buffer` def update(buffer: MutableAggregationBuffer, input: Row): Unit = { if (!</p>

    </div>

    
    
    
        <div class="readmore no-text-decoration">
            <a href='https://ohmyweekly.github.io/notes/udaf/'
               title="Read more about 用户自定义聚合函数">
                read <span class="more"> more</span>
                <span class="screen-readers-only" > about 用户自定义聚合函数</span>
            </a>
        </div>
    
</article>
      
    
        <article class="summary h-entry notes">
    <header>
        <h2 class="post-title p-name no-text-decoration"><a class="u-url" href='https://ohmyweekly.github.io/notes/google-guice/'> Google Guice - 依赖注入</a> </h2>
        
    <div class="taxo no-text-decoration">
         
            
                <ul class="no-bullets inline categories">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts categorized in ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/categories/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
         
            
                <ul class="no-bullets inline tags">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts tagged with ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/tags/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
        
    </div>


        


    
    
    <div class="post-date">
        
        <time datetime="2019-07-02T15:19:52+0000" class="dt-published">Tue Jul 2, 2019</time>
        
        
    </div>


    </header>

    <div class="post p-summary" >
        <p>动机 将所有内容连接在一起是应用程序开发的一个单调乏味的部分。有几种方法可以将数据、服务和表示类相互连接起来。为了对比这些方法，我们将为披萨订购网站编写支付代码：
public interface BillingService { /** * Attempts to charge the order to the credit card. Both successful and * failed transactions will be recorded. * * @return a receipt of the transaction. If the charge was successful, the * receipt will be successful. Otherwise, the receipt will contain a * decline note describing why the charge failed. */ Receipt chargeOrder(PizzaOrder order, CreditCard creditCard); } 伴随着实现，我们会给我们的代码写单元测试。在测试中，我们需要一个 FakeCreditCardProcessor 来避免支付到真实的信用卡。
直接构造函数调用 以下是我们刚刚刷新信用卡处理器和事务记录器时代码的样子：</p>

    </div>

    
    
    
        <div class="readmore no-text-decoration">
            <a href='https://ohmyweekly.github.io/notes/google-guice/'
               title="Read more about Google Guice - 依赖注入">
                read <span class="more"> more</span>
                <span class="screen-readers-only" > about Google Guice - 依赖注入</span>
            </a>
        </div>
    
</article>
      
    
        <article class="summary h-entry notes">
    <header>
        <h2 class="post-title p-name no-text-decoration"><a class="u-url" href='https://ohmyweekly.github.io/notes/running-raku-on-my-phone/'> 使用 Termux 在手机中运行 Raku</a> </h2>
        
    <div class="taxo no-text-decoration">
         
            
                <ul class="no-bullets inline categories">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts categorized in ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/categories/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
         
            
                <ul class="no-bullets inline tags">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts tagged with ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/tags/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
        
    </div>


        


    
    
    <div class="post-date">
        
        <time datetime="2019-06-01T12:30:42+0000" class="dt-published">Sat Jun 1, 2019</time>
        
        
    </div>


    </header>

    <div class="post p-summary" >
        <p>之前介绍过在安卓手机上运行 Raku, 那是一种很费劲的折腾, 你得下载一个完整的 Ubuntu 系统, 然后自行编译安装 Raku。虽然现在 Docker 很方便, 但是我不想用它。 有了 Termux 就发现下面这个操作更清凉, 更环保。 我们到 https://github.com/its-pointless/gcc_termux 看到里面的 readme 说得语焉不详, 对于刚接触 Termux 的人来说有点毫无头绪, 但是作者依然提供了一个傻瓜式一键设置脚本, 我拿来改造下:
#!/data/data/com.termux/files/usr/bin/sh # Get some needed tools. coreutils for mkdir command, gnugp for the signing key, and apt-transport-https to actually connect to the repo # and clang and make for installing Zef apt-get update apt-get --assume-yes upgrade apt-get --assume-yes install coreutils gnupg wget clang make git # Make the sources.</p>

    </div>

    
    
    
        <div class="readmore no-text-decoration">
            <a href='https://ohmyweekly.github.io/notes/running-raku-on-my-phone/'
               title="Read more about 使用 Termux 在手机中运行 Raku">
                read <span class="more"> more</span>
                <span class="screen-readers-only" > about 使用 Termux 在手机中运行 Raku</span>
            </a>
        </div>
    
</article>
      
    
        <article class="summary h-entry notes">
    <header>
        <h2 class="post-title p-name no-text-decoration"><a class="u-url" href='https://ohmyweekly.github.io/notes/delete-all-history-commit-in-git/'> 删除 git 中所有历史提交</a> </h2>
        
    <div class="taxo no-text-decoration">
         
            
                <ul class="no-bullets inline categories">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts categorized in ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/categories/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
         
            
                <ul class="no-bullets inline tags">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts tagged with ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/tags/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
        
    </div>


        


    
    
    <div class="post-date">
        
        <time datetime="2019-05-27T19:39:38+0000" class="dt-published">Mon May 27, 2019</time>
        
        
    </div>


    </header>

    <div class="post p-summary" >
        <p>把旧项目改一改, 提交到 git 仓库中, 这是很多程序员的学习手段。但是, 旧项目的 history commit 中往往有很多敏感信息, 例如数据库登录信息。我就比较奇特了, 我误 commit 了一个大文件(jar 包, 囧)。 历史提交信息正好我也不想保留了, 我想把改好的这个版本当作一次完整的原子提交。即当作一个新仓库了。做法如下：
1）切换到一个新分支 git checkout --orphan latest_branch 缓存所有文件(.gitignore中的除外) git add -A 提交跟踪后的文件 git commit -am &#34;init commit&#34; 删除 master 分支 git branch -D master 重命名当前分支为 master git branch -m master 提交到远程 master 分支 git push -f origin master </p>

    </div>

    
    
    
</article>
      
    
        <article class="summary h-entry notes">
    <header>
        <h2 class="post-title p-name no-text-decoration"><a class="u-url" href='https://ohmyweekly.github.io/notes/reference-and-borrow-in-rust/'> Rust 中的所有权</a> </h2>
        
    <div class="taxo no-text-decoration">
         
            
                <ul class="no-bullets inline categories">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts categorized in ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/categories/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
         
            
                <ul class="no-bullets inline tags">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts tagged with ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/tags/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
        
    </div>


        


    
    
    <div class="post-date">
        
        <time datetime="2019-05-25T08:38:17+0000" class="dt-published">Sat May 25, 2019</time>
        
        
    </div>


    </header>

    <div class="post p-summary" >
        <p>变量绑定 在 Rust 中, 我们将一些值绑定到一个名字上, 称之为变量绑定。使用 let 来声明一个绑定：
fn main() { let x = 5; } 所有权 Rust 中的变量绑定有一个属性: 变量拥有它们所绑定的值的所有权。当绑定超出作用域, 变量绑定的资源就会被释放。例如：
fn foo() { let v = vec![1,2,3,4,5]; } 当 v 进入作用域, 会在栈上创建一个新的 vector, 并在堆上为该 vector 的 5 个元素分配空间。当 v 在 foo() 的末尾离开作用域时, Rust 会释放该 vector 占用的资源。
移动语义 在 Rust 中, 一个值一次只能有一个所有者。
let v = vec![1,2,3,4,5]; // ① 声明一个绑定 let s = v; // ② v moved to s println!(&#34;v[0] is: {}&#34;, v[0]); // ③ error: use of moved value: `v` 除了 ② 里面发生所有权转移(move)外, 另外一种常见的的 move 语义发生在将变量作为参数传递给函数时:</p>

    </div>

    
    
    
        <div class="readmore no-text-decoration">
            <a href='https://ohmyweekly.github.io/notes/reference-and-borrow-in-rust/'
               title="Read more about Rust 中的所有权">
                read <span class="more"> more</span>
                <span class="screen-readers-only" > about Rust 中的所有权</span>
            </a>
        </div>
    
</article>
      
    
        <article class="summary h-entry notes">
    <header>
        <h2 class="post-title p-name no-text-decoration"><a class="u-url" href='https://ohmyweekly.github.io/notes/refactoring-with-spark-structured-streaming/'> 使用 Spark Structured Streaming 重构项目</a> </h2>
        
    <div class="taxo no-text-decoration">
         
            
                <ul class="no-bullets inline categories">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts categorized in ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/categories/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
         
            
                <ul class="no-bullets inline tags">
                    
                        
                        
                        
                            
                            
                            
                            
                            
                            <li class="__rakulang__"
                                
                                
                                title="See all 0 posts tagged with ‘rakulang’"
                                
                            >
                                <a class="p-category" href="https://ohmyweekly.github.io/tags/rakulang/">rakulang</a>
                            </li>
                        
                    
                </ul>
            
        
    </div>


        


    
    
    <div class="post-date">
        
        <time datetime="2019-05-19T21:50:48+0000" class="dt-published">Sun May 19, 2019</time>
        
        
    </div>


    </header>

    <div class="post p-summary" >
        <p>现在这个项目唯一的乐趣就是使用我学到的新技术重构之前的项目。今天完成了数据适配, 该项目目录结构如下:
├── EnApplication.scala ├── NaApplication.scala ├── conf │ ├── HbaseConfiguration.scala │ ├── KafkaConfiguration.scala │ ├── MysqlConfiguration.scala │ └── SparkConfiguration.scala ├── core │ ├── Adapter.scala │ └── impl │ ├── AdapterImpl.scala │ └── EnAdapterImpl.scala ├── model │ ├── EnSourceData.scala │ └── SourceData.scala ├── module │ ├── EnMainModule.scala │ └── MainModule.scala ├── pipeline │ ├── NaSchema.scala │ ├── NaSparkSession.scala │ └── SourceDataFrame.scala └── util └── XsUdfs.scala 与之前的项目一样, 依旧使用了依赖注入:
Kafka 配置 class KafkaConfiguration extends Serializable{ private val config: Config = ConfigFactory.</p>

    </div>

    
    
    
        <div class="readmore no-text-decoration">
            <a href='https://ohmyweekly.github.io/notes/refactoring-with-spark-structured-streaming/'
               title="Read more about 使用 Spark Structured Streaming 重构项目">
                read <span class="more"> more</span>
                <span class="screen-readers-only" > about 使用 Spark Structured Streaming 重构项目</span>
            </a>
        </div>
    
</article>
      
    
</div>



                <footer>
                    

<div class="pagination no-text-decoration">
    
        <a class="pagination-item newer" href="/page/28/">Newer</a>
    
    
        <a class="pagination-item older" href="/page/30/">Older</a>
    
</div>




                    <ul class="no-bullets feed right inline">
    
        
        
            <li class="inline no-text-decoration">
                <a href="https://ohmyweekly.github.io/index.xml">RSS</a>
            </li>
        
    
        
        
            <li class="inline no-text-decoration">
                <a href="https://ohmyweekly.github.io/atom.xml">ATOM</a>
            </li>
        
    
        
        
    
</ul>
<div class="clear-float"></div>

                </footer>
                <hr />
            </div>               

            <footer> 
                

<ul class="social no-text-decoration">
    
</ul>










 
    
    



<p class="generated no-text-decoration">
    Generated using  <a href="https://gitlab.com/kaushalmodi/hugo-theme-refined"><code class="nobr">hugo-theme-refined</code></a> + <span class="nobr">Hugo <a href="https://github.com/gohugoio/hugo/commit/312735366b20d64bd61bff8627f593749f86c964">0.123.7</a></span>
</p>

<p>
    
</p>




<div class="badges no-text-decoration">
    
    

    
</div>




<script type="application/javascript">var nav=responsiveNav("#nav");</script>




<script defer src="/js/libs/fragmentions/wrapper.min.e8c468c89edc4f5dccaa8c720c6b220b3088a16cd7b1e4a1e3345985788260c9.js"></script>









            </footer>
        </div> 
    </body>
</html>
